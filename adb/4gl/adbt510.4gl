#該程式未解開Section, 採用最新樣板產出!
{<section id="adbt510.description" >}
#應用 a00 樣板自動產生(Version:3)
#+ Standard Version.....: SD版次:0022(2017-02-19 16:42:18), PR版次:0022(2017-02-19 18:14:06)
#+ Customerized Version.: SD版次:0000(1900-01-01 00:00:00), PR版次:0000(1900-01-01 00:00:00)
#+ Build......: 000334
#+ Filename...: adbt510
#+ Description: 分銷訂單變更維護作業
#+ Creator....: 02748(2014-06-17 00:00:00)
#+ Modifier...: 02749 -SD/PR- 02749
 
{</section>}
 
{<section id="adbt510.global" >}
#應用 t01 樣板自動產生(Version:79)
#add-point:填寫註解說明 name="global.memo" 
#160318-00005#6  2016/03/21 By Jessy    修正azzi920重複定義之錯誤訊息
#160318-00025#28 2016/04/06 By 07959    修正azzi920重複定義之錯誤訊息
#160328-00029#5  2016/04/06 By Jessy    將重複內容的錯誤訊息置換為公用錯誤訊息
#160816-00068#2  2016/08/17 By earl     調整transaction
#160815-00016#1  2016/08/17 By 02749    T類作業在browser_fill()組SQL前,呼叫s_aooi200_filter_slip將回傳條件組進去g_wc中
#160308-00010#36 2016/08/12 By Jessica  adbt510_send中呼叫確認元件後若有錯誤時應該RETURN FALSE。
#160816-00001#7  2016/08/21 By 08742    抓取理由碼改CALL sub
#160818-00017#6  2016/08/24 by 08172    修改删除时重新检查状态
#161006-00008#5  2016/10/19 by 08729    處理組織開窗
#161104-00002#1  2016/11/04 by 02749    變數定義與INSERT調整不使用*
#161123-00042#1  2016/11/24 By 06137    161104-00002 星號寫法, 應補上自定義欄位
#161228-00033#1  2016/12/29 By 06137    後續T100 應會有不同的DB支持  ROWNUM只適用於ORACLE DB 予以改寫 應將rownum寫法移除，ORDER BY 後FETCH FIRST抓第一筆
#170207-00004#2  2017/02/19 By 02749    效能調整
#end add-point
#add-point:填寫註解說明(客製用) name="global.memo_customerization"

#end add-point
 
IMPORT os
IMPORT util
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目 name="global.import"
 
#end add-point 
 
SCHEMA ds 
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔 name="global.inc"
GLOBALS
DEFINE g_xmek007       LIKE xmek_t.xmek007
END GLOBALS
#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_xmee_m        RECORD
       xmeesite LIKE xmee_t.xmeesite, 
   xmeesite_desc LIKE type_t.chr80, 
   xmee902 LIKE xmee_t.xmee902, 
   xmeedocno LIKE xmee_t.xmeedocno, 
   xmee900 LIKE xmee_t.xmee900, 
   xmee901 LIKE xmee_t.xmee901, 
   xmee001 LIKE xmee_t.xmee001, 
   xmee202 LIKE xmee_t.xmee202, 
   xmee202_desc LIKE type_t.chr80, 
   xmee023 LIKE xmee_t.xmee023, 
   xmee023_desc LIKE type_t.chr80, 
   xmee004 LIKE xmee_t.xmee004, 
   xmee004_desc LIKE type_t.chr80, 
   xmee200 LIKE xmee_t.xmee200, 
   xmee200_desc LIKE type_t.chr80, 
   xmee201 LIKE xmee_t.xmee201, 
   xmee201_desc LIKE type_t.chr80, 
   xmeestus LIKE xmee_t.xmeestus, 
   xmee005 LIKE xmee_t.xmee005, 
   xmee007 LIKE xmee_t.xmee007, 
   xmee008 LIKE xmee_t.xmee008, 
   xmeedocdt LIKE xmee_t.xmeedocdt, 
   xmee024 LIKE xmee_t.xmee024, 
   xmee024_desc LIKE type_t.chr80, 
   xmee002 LIKE xmee_t.xmee002, 
   xmee002_desc LIKE type_t.chr80, 
   xmee003 LIKE xmee_t.xmee003, 
   xmee003_desc LIKE type_t.chr80, 
   xmeeacti LIKE xmee_t.xmeeacti, 
   xmee021 LIKE xmee_t.xmee021, 
   xmee021_desc LIKE type_t.chr80, 
   xmee022 LIKE xmee_t.xmee022, 
   xmee022_desc LIKE type_t.chr80, 
   xmee203 LIKE xmee_t.xmee203, 
   xmee203_desc LIKE type_t.chr80, 
   xmee027 LIKE xmee_t.xmee027, 
   xmee027_desc LIKE type_t.chr80, 
   xmee211 LIKE xmee_t.xmee211, 
   xmee211_desc LIKE type_t.chr80, 
   xmee210 LIKE xmee_t.xmee210, 
   xmee210_desc LIKE type_t.chr80, 
   xmee209 LIKE xmee_t.xmee209, 
   xmee209_desc LIKE type_t.chr80, 
   xmee208 LIKE xmee_t.xmee208, 
   xmee208_desc LIKE type_t.chr80, 
   xmeeunit LIKE xmee_t.xmeeunit, 
   xmeeunit_desc LIKE type_t.chr80, 
   xmee204 LIKE xmee_t.xmee204, 
   xmee204_desc LIKE type_t.chr80, 
   xmee205 LIKE xmee_t.xmee205, 
   xmee032 LIKE xmee_t.xmee032, 
   xmee032_desc LIKE type_t.chr80, 
   xmee071 LIKE xmee_t.xmee071, 
   xmee903 LIKE xmee_t.xmee903, 
   xmee903_desc LIKE type_t.chr80, 
   xmee904 LIKE xmee_t.xmee904, 
   xmee025 LIKE xmee_t.xmee025, 
   xmee025_desc LIKE type_t.chr80, 
   oofb017 LIKE type_t.chr500, 
   xmee026 LIKE xmee_t.xmee026, 
   xmee026_desc LIKE type_t.chr80, 
   oofb017_1 LIKE type_t.chr500, 
   xmee206 LIKE xmee_t.xmee206, 
   xmee206_desc LIKE type_t.chr80, 
   xmee207 LIKE xmee_t.xmee207, 
   xmee207_desc LIKE type_t.chr80, 
   xmee020 LIKE xmee_t.xmee020, 
   xmee020_desc LIKE type_t.chr80, 
   xmee036 LIKE xmee_t.xmee036, 
   xmee036_desc LIKE type_t.chr80, 
   xmee048 LIKE xmee_t.xmee048, 
   xmee049 LIKE xmee_t.xmee049, 
   xmee009 LIKE xmee_t.xmee009, 
   xmee009_desc LIKE type_t.chr80, 
   xmee010 LIKE xmee_t.xmee010, 
   xmee010_desc LIKE type_t.chr80, 
   xmee015 LIKE xmee_t.xmee015, 
   xmee015_desc LIKE type_t.chr80, 
   xmee016 LIKE xmee_t.xmee016, 
   xmee011 LIKE xmee_t.xmee011, 
   xmee011_desc LIKE type_t.chr80, 
   xmee012 LIKE xmee_t.xmee012, 
   xmee013 LIKE xmee_t.xmee013, 
   xmee035 LIKE xmee_t.xmee035, 
   xmee035_desc LIKE type_t.chr80, 
   isaf011 LIKE type_t.chr500, 
   xmee039 LIKE xmee_t.xmee039, 
   xmeeownid LIKE xmee_t.xmeeownid, 
   xmeeownid_desc LIKE type_t.chr80, 
   xmeeowndp LIKE xmee_t.xmeeowndp, 
   xmeeowndp_desc LIKE type_t.chr80, 
   xmeecrtid LIKE xmee_t.xmeecrtid, 
   xmeecrtid_desc LIKE type_t.chr80, 
   xmeecrtdp LIKE xmee_t.xmeecrtdp, 
   xmeecrtdp_desc LIKE type_t.chr80, 
   xmeecrtdt LIKE xmee_t.xmeecrtdt, 
   xmeemodid LIKE xmee_t.xmeemodid, 
   xmeemodid_desc LIKE type_t.chr80, 
   xmeemoddt LIKE xmee_t.xmeemoddt, 
   xmeecnfid LIKE xmee_t.xmeecnfid, 
   xmeecnfid_desc LIKE type_t.chr80, 
   xmeecnfdt LIKE xmee_t.xmeecnfdt, 
   xmee034 LIKE xmee_t.xmee034, 
   xmee034_desc LIKE type_t.chr80, 
   xmee041 LIKE xmee_t.xmee041, 
   xmee006 LIKE xmee_t.xmee006, 
   xmee042 LIKE xmee_t.xmee042, 
   xmee017 LIKE xmee_t.xmee017, 
   xmee017_desc LIKE type_t.chr80, 
   xmee043 LIKE xmee_t.xmee043, 
   xmee018 LIKE xmee_t.xmee018, 
   xmee018_desc LIKE type_t.chr80, 
   xmee019 LIKE xmee_t.xmee019, 
   xmee028 LIKE xmee_t.xmee028
       END RECORD
 
#單身 type 宣告
PRIVATE TYPE type_g_xmeg_d        RECORD
       xmegsite LIKE xmeg_t.xmegsite, 
   xmegseq LIKE xmeg_t.xmegseq, 
   xmeg027 LIKE xmeg_t.xmeg027, 
   xmeg001 LIKE xmeg_t.xmeg001, 
   xmeg001_desc LIKE type_t.chr500, 
   xmeg001_desc_desc LIKE type_t.chr500, 
   xmeg002 LIKE xmeg_t.xmeg002, 
   xmeg004 LIKE xmeg_t.xmeg004, 
   xmeg004_desc LIKE type_t.chr500, 
   xmeg005 LIKE xmeg_t.xmeg005, 
   xmeg006 LIKE xmeg_t.xmeg006, 
   xmeg006_desc LIKE type_t.chr500, 
   xmeg007 LIKE xmeg_t.xmeg007, 
   xmeg008 LIKE xmeg_t.xmeg008, 
   xmeg008_desc LIKE type_t.chr500, 
   xmeg009 LIKE xmeg_t.xmeg009, 
   xmeg024 LIKE xmeg_t.xmeg024, 
   xmeg012 LIKE xmeg_t.xmeg012, 
   xmeg013 LIKE xmeg_t.xmeg013, 
   xmeg045 LIKE xmeg_t.xmeg045, 
   xmeg010 LIKE xmeg_t.xmeg010, 
   xmeg010_desc LIKE type_t.chr500, 
   xmeg011 LIKE xmeg_t.xmeg011, 
   xmeg015 LIKE xmeg_t.xmeg015, 
   xmeg016 LIKE xmeg_t.xmeg016, 
   xmeg016_desc LIKE type_t.chr500, 
   xmeg017 LIKE xmeg_t.xmeg017, 
   xmeg046 LIKE xmeg_t.xmeg046, 
   xmeg047 LIKE xmeg_t.xmeg047, 
   xmeg048 LIKE xmeg_t.xmeg048, 
   xmeg023 LIKE xmeg_t.xmeg023, 
   xmeg019 LIKE xmeg_t.xmeg019, 
   xmeg020 LIKE xmeg_t.xmeg020, 
   xmeg021 LIKE xmeg_t.xmeg021, 
   xmeg022 LIKE xmeg_t.xmeg022, 
   xmeg051 LIKE xmeg_t.xmeg051, 
   xmegunit LIKE xmeg_t.xmegunit, 
   xmegunit_desc LIKE type_t.chr500, 
   xmegorga LIKE xmeg_t.xmegorga, 
   xmegorga_desc LIKE type_t.chr500, 
   xmeg052 LIKE xmeg_t.xmeg052, 
   xmeg049 LIKE xmeg_t.xmeg049, 
   xmeg049_desc LIKE type_t.chr500, 
   xmeg053 LIKE xmeg_t.xmeg053, 
   xmeg053_desc LIKE type_t.chr500, 
   xmeg050 LIKE xmeg_t.xmeg050, 
   xmeg901 LIKE xmeg_t.xmeg901, 
   xmeg902 LIKE xmeg_t.xmeg902, 
   xmeg902_desc LIKE type_t.chr500, 
   xmeg903 LIKE xmeg_t.xmeg903
       END RECORD
PRIVATE TYPE type_g_xmeg2_d RECORD
       rticseq LIKE rtic_t.rticseq, 
   xmjb0021 LIKE type_t.chr500, 
   xmjb0031 LIKE type_t.chr500, 
   xmjb0031_desc LIKE type_t.chr500, 
   xmjb0031_desc_desc LIKE type_t.chr500, 
   xmjb0171 LIKE type_t.chr10, 
   xmjb0171_desc LIKE type_t.chr500, 
   xmjb0181 LIKE type_t.num20_6, 
   xmjb0081 LIKE type_t.num20_6, 
   xmjb0091 LIKE type_t.num20_6, 
   xmjb0101 LIKE type_t.num20_6, 
   xmjb0211 LIKE type_t.num20_6, 
   rticseq1 LIKE rtic_t.rticseq1, 
   rtic001 LIKE rtic_t.rtic001, 
   rtic002 LIKE rtic_t.rtic002, 
   rtic003 LIKE rtic_t.rtic003, 
   rtic004 LIKE rtic_t.rtic004, 
   rtic005 LIKE rtic_t.rtic005, 
   rtic006 LIKE rtic_t.rtic006, 
   rtic007 LIKE rtic_t.rtic007, 
   rtic008 LIKE rtic_t.rtic008, 
   rtic009 LIKE rtic_t.rtic009, 
   rtic010 LIKE rtic_t.rtic010, 
   rtic011 LIKE rtic_t.rtic011, 
   rtic012 LIKE rtic_t.rtic012, 
   rtic013 LIKE rtic_t.rtic013, 
   rtic014 LIKE rtic_t.rtic014, 
   rtic015 LIKE rtic_t.rtic015, 
   rtic016 LIKE rtic_t.rtic016, 
   rtic017 LIKE rtic_t.rtic017, 
   rtic018 LIKE rtic_t.rtic018, 
   rtic019 LIKE rtic_t.rtic019, 
   rtic020 LIKE rtic_t.rtic020, 
   rtic021 LIKE rtic_t.rtic021, 
   rtic022 LIKE rtic_t.rtic022, 
   rtic023 LIKE rtic_t.rtic023, 
   rtic024 LIKE rtic_t.rtic024, 
   rtic025 LIKE rtic_t.rtic025, 
   rtic026 LIKE rtic_t.rtic026, 
   rtic027 LIKE rtic_t.rtic027, 
   rtic028 LIKE rtic_t.rtic028, 
   rtic029 LIKE rtic_t.rtic029
       END RECORD
PRIVATE TYPE type_g_xmeg3_d RECORD
       xmehdocno LIKE xmeh_t.xmehdocno, 
   xmehseq LIKE xmeh_t.xmehseq, 
   xmehseq1 LIKE xmeh_t.xmehseq1, 
   xmeh229 LIKE xmeh_t.xmeh229, 
   xmeh003 LIKE xmeh_t.xmeh003, 
   xmeh001 LIKE xmeh_t.xmeh001, 
   xmeh001_desc LIKE type_t.chr500, 
   xmeh001_desc_desc LIKE type_t.chr500, 
   xmeh002 LIKE xmeh_t.xmeh002, 
   xmeh200 LIKE xmeh_t.xmeh200, 
   xmeh200_desc LIKE type_t.chr500, 
   xmeh004 LIKE xmeh_t.xmeh004, 
   xmeh004_desc LIKE type_t.chr500, 
   xmeh005 LIKE xmeh_t.xmeh005, 
   xmeh011 LIKE xmeh_t.xmeh011, 
   xmeh012 LIKE xmeh_t.xmeh012, 
   xmeg012 LIKE xmeg_t.xmeg012, 
   xmeg013 LIKE xmeg_t.xmeg013, 
   xmehseq2 LIKE xmeh_t.xmehseq2, 
   xmeh006 LIKE xmeh_t.xmeh006, 
   xmeh201 LIKE xmeh_t.xmeh201, 
   xmeh201_desc LIKE type_t.chr500, 
   xmeh202 LIKE xmeh_t.xmeh202, 
   xmeh024 LIKE xmeh_t.xmeh024, 
   xmeh024_desc LIKE type_t.chr500, 
   xmeh025 LIKE xmeh_t.xmeh025, 
   xmeh026 LIKE xmeh_t.xmeh026, 
   xmeh026_desc LIKE type_t.chr500, 
   xmeh027 LIKE xmeh_t.xmeh027, 
   xmeh203 LIKE xmeh_t.xmeh203, 
   xmeh204 LIKE xmeh_t.xmeh204, 
   xmeh205 LIKE xmeh_t.xmeh205, 
   xmeh206 LIKE xmeh_t.xmeh206, 
   xmeh029 LIKE xmeh_t.xmeh029, 
   xmeh028 LIKE xmeh_t.xmeh028, 
   xmeh019 LIKE xmeh_t.xmeh019, 
   xmeh019_desc LIKE type_t.chr500, 
   xmeh030 LIKE xmeh_t.xmeh030, 
   xmeh207 LIKE xmeh_t.xmeh207, 
   xmeh207_desc LIKE type_t.chr500, 
   xmehunit LIKE xmeh_t.xmehunit, 
   xmehunit_desc LIKE type_t.chr500, 
   xmeh210 LIKE xmeh_t.xmeh210, 
   xmeh210_desc LIKE type_t.chr500, 
   xmeh212 LIKE xmeh_t.xmeh212, 
   xmeh213 LIKE xmeh_t.xmeh213, 
   xmeh213_desc LIKE type_t.chr500, 
   xmeh214 LIKE xmeh_t.xmeh214, 
   xmeh214_desc LIKE type_t.chr500, 
   xmeh215 LIKE xmeh_t.xmeh215, 
   xmeh031 LIKE xmeh_t.xmeh031, 
   xmeh014 LIKE xmeh_t.xmeh014, 
   xmeh015 LIKE xmeh_t.xmeh015, 
   xmeh016 LIKE xmeh_t.xmeh016, 
   xmeh017 LIKE xmeh_t.xmeh017, 
   xmeh221 LIKE xmeh_t.xmeh221, 
   xmehsite LIKE xmeh_t.xmehsite, 
   xmehsite_desc LIKE type_t.chr500, 
   xmeh218 LIKE xmeh_t.xmeh218, 
   xmeh218_desc LIKE type_t.chr500, 
   xmeh219 LIKE xmeh_t.xmeh219, 
   xmeh219_desc LIKE type_t.chr500, 
   xmeh220 LIKE xmeh_t.xmeh220, 
   xmeh220_desc LIKE type_t.chr500, 
   xmeh222 LIKE xmeh_t.xmeh222, 
   xmeh222_desc LIKE type_t.chr500, 
   xmeh223 LIKE xmeh_t.xmeh223, 
   xmeh223_desc LIKE type_t.chr500, 
   xmeh224 LIKE xmeh_t.xmeh224, 
   xmeh224_desc LIKE type_t.chr500, 
   xmehorga LIKE xmeh_t.xmehorga, 
   xmehorga_desc LIKE type_t.chr500, 
   xmeh226 LIKE xmeh_t.xmeh226, 
   xmeh227 LIKE xmeh_t.xmeh227, 
   xmeh227_desc LIKE type_t.chr500, 
   xmeh228 LIKE xmeh_t.xmeh228, 
   xmeh228_desc LIKE type_t.chr500, 
   xmeh901 LIKE xmeh_t.xmeh901
       END RECORD
PRIVATE TYPE type_g_xmeg4_d RECORD
       xmjbunit LIKE xmjb_t.xmjbunit, 
   xmjbseq LIKE xmjb_t.xmjbseq, 
   xmjbsite LIKE xmjb_t.xmjbsite, 
   xmjbsite_desc LIKE type_t.chr500, 
   xmjb001 LIKE xmjb_t.xmjb001, 
   xmjb002 LIKE xmjb_t.xmjb002, 
   xmjb003 LIKE xmjb_t.xmjb003, 
   xmjb003_desc LIKE type_t.chr500, 
   xmjb003_desc_desc LIKE type_t.chr500, 
   xmjb033 LIKE xmjb_t.xmjb033, 
   xmjb004 LIKE xmjb_t.xmjb004, 
   xmjb005 LIKE xmjb_t.xmjb005, 
   xmjb005_desc LIKE type_t.chr500, 
   xmjb006 LIKE xmjb_t.xmjb006, 
   xmjb006_desc LIKE type_t.chr500, 
   xmjb007 LIKE xmjb_t.xmjb007, 
   xmjb011 LIKE xmjb_t.xmjb011, 
   xmjb011_desc LIKE type_t.chr500, 
   xmjb012 LIKE xmjb_t.xmjb012, 
   xmjb013 LIKE xmjb_t.xmjb013, 
   xmjb013_desc LIKE type_t.chr500, 
   xmjb014 LIKE xmjb_t.xmjb014, 
   xmjb015 LIKE xmjb_t.xmjb015, 
   xmjb015_desc LIKE type_t.chr500, 
   xmjb016 LIKE xmjb_t.xmjb016, 
   xmjb017 LIKE xmjb_t.xmjb017, 
   xmjb017_desc LIKE type_t.chr500, 
   xmjb018 LIKE xmjb_t.xmjb018, 
   xmjb008 LIKE xmjb_t.xmjb008, 
   xmjb009 LIKE xmjb_t.xmjb009, 
   xmjb010 LIKE xmjb_t.xmjb010, 
   xmjb022 LIKE xmjb_t.xmjb022, 
   xmjb019 LIKE xmjb_t.xmjb019, 
   xmjb020 LIKE xmjb_t.xmjb020, 
   xmjb021 LIKE xmjb_t.xmjb021, 
   xmjb024 LIKE xmjb_t.xmjb024, 
   xmjb024_desc LIKE type_t.chr500, 
   xmjb025 LIKE xmjb_t.xmjb025, 
   xmjb026 LIKE xmjb_t.xmjb026, 
   xmjb026_desc LIKE type_t.chr500, 
   xmjb027 LIKE xmjb_t.xmjb027, 
   xmjb027_desc LIKE type_t.chr500, 
   xmjb028 LIKE xmjb_t.xmjb028, 
   xmjb029 LIKE xmjb_t.xmjb029, 
   xmjb030 LIKE xmjb_t.xmjb030, 
   xmjb031 LIKE xmjb_t.xmjb031, 
   xmjb032 LIKE xmjb_t.xmjb032, 
   xmjb040 LIKE xmjb_t.xmjb040, 
   xmjb040_desc LIKE type_t.chr500, 
   xmjb039 LIKE xmjb_t.xmjb039, 
   xmjb039_desc LIKE type_t.chr500, 
   xmjb038 LIKE xmjb_t.xmjb038, 
   xmjb038_desc LIKE type_t.chr500, 
   xmjb037 LIKE xmjb_t.xmjb037, 
   xmjb037_desc LIKE type_t.chr500, 
   xmjb034 LIKE xmjb_t.xmjb034, 
   xmjb901 LIKE xmjb_t.xmjb901, 
   xmjb902 LIKE xmjb_t.xmjb902, 
   xmjb902_desc LIKE type_t.chr500, 
   xmjb903 LIKE xmjb_t.xmjb903
       END RECORD
PRIVATE TYPE type_g_xmeg5_d RECORD
       xmefsite LIKE xmef_t.xmefsite, 
   xmef001 LIKE xmef_t.xmef001, 
   xmef002 LIKE xmef_t.xmef002, 
   xmef002_desc LIKE type_t.chr500, 
   xmef003 LIKE xmef_t.xmef003, 
   xmef004 LIKE xmef_t.xmef004, 
   xmef005 LIKE xmef_t.xmef005, 
   xmef006 LIKE xmef_t.xmef006, 
   xmef016 LIKE xmef_t.xmef016, 
   xmef017 LIKE xmef_t.xmef017, 
   xmef007 LIKE xmef_t.xmef007, 
   xmef008 LIKE xmef_t.xmef008, 
   xmef009 LIKE xmef_t.xmef009, 
   xmef901 LIKE xmef_t.xmef901, 
   xmef902 LIKE xmef_t.xmef902, 
   xmef902_desc LIKE type_t.chr500, 
   xmef903 LIKE xmef_t.xmef903
       END RECORD
 
 
PRIVATE TYPE type_browser RECORD
         b_statepic     LIKE type_t.chr50,
            b_xmeedocno LIKE xmee_t.xmeedocno,
      b_xmee900 LIKE xmee_t.xmee900,
      b_xmeedocdt LIKE xmee_t.xmeedocdt,
      b_xmee001 LIKE xmee_t.xmee001,
      b_xmee002 LIKE xmee_t.xmee002,
   b_xmee002_desc LIKE type_t.chr80,
      b_xmee003 LIKE xmee_t.xmee003,
   b_xmee003_desc LIKE type_t.chr80,
      b_xmee004 LIKE xmee_t.xmee004,
   b_xmee004_desc LIKE type_t.chr80
       END RECORD
       
#add-point:自定義模組變數(Module Variable) (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="global.variable"
#DEFINE g_wc2_rtic     STRING                 #170207-00004#2 170219 by 02749 mark
DEFINE g_flag         LIKE type_t.num5
DEFINE g_flag1        LIKE type_t.num5
DEFINE g_flag2        LIKE type_t.num5
DEFINE g_oofa001      LIKE oofa_t.oofa001
DEFINE g_ooef019      LIKE ooef_t.ooef019
DEFINE g_acc          LIKE gzcb_t.gzcb007
DEFINE g_acc_282      LIKE gzcb_t.gzcb007      #02749  150121  add
DEFINE g_tax_app      LIKE oodb_t.oodb011      #取得稅別類型1:正常稅率2:依料件設定
DEFINE g_oodbl004     LIKE oodbl_t.oodbl004    #課稅原则
DEFINE g_oodb005      LIKE oodb_t.oodb005      #單價是否含稅
DEFINE g_oodb006      LIKE oodb_t.oodb006      #稅率
DEFINE g_slip_wc      STRING                   #160815-00016#1 160817 by 02749 add
DEFINE g_slip_wc1      STRING                  #160815-00016#1 160817 by 02749 add

#170207-00004#2 170219 by 02749 mark---(S)
#TYPE type_g_xmeg2_d RECORD
#  rticseq            LIKE rtic_t.rticseq,
#  xmjb0021           LIKE type_t.chr500,
#  xmjb0031           LIKE type_t.chr500,
#  xmjb0031_desc      LIKE type_t.chr500,
#  xmjb0031_desc_desc LIKE type_t.chr500,
#  xmjb0171           LIKE type_t.chr10,
#  xmjb0171_desc      LIKE type_t.chr500,
#  xmjb0181           LIKE type_t.num20_6,
#  xmjb0081           LIKE type_t.num20_6,
#  xmjb0091           LIKE type_t.num20_6,
#  xmjb0101           LIKE type_t.num20_6,
#  xmjb0211           LIKE type_t.num20_6,
#  rticseq1           LIKE rtic_t.rticseq1,
#  rtic001            LIKE rtic_t.rtic001,
#  rtic002            LIKE rtic_t.rtic002,
#  rtic003            LIKE rtic_t.rtic003,
#  rtic004            LIKE rtic_t.rtic004,
#  rtic005            LIKE rtic_t.rtic005,
#  rtic006            LIKE rtic_t.rtic006,
#  rtic007            LIKE rtic_t.rtic007,
#  rtic008            LIKE rtic_t.rtic008,
#  rtic009            LIKE rtic_t.rtic009,
#  rtic010            LIKE rtic_t.rtic010,
#  rtic011            LIKE rtic_t.rtic011,
#  rtic012            LIKE rtic_t.rtic012,
#  rtic013            LIKE rtic_t.rtic013,
#  rtic014            LIKE rtic_t.rtic014,
#  rtic015            LIKE rtic_t.rtic015,
#  rtic016            LIKE rtic_t.rtic016,
#  rtic017            LIKE rtic_t.rtic017,
#  rtic018            LIKE rtic_t.rtic018,
#  rtic019            LIKE rtic_t.rtic019,
#  rtic020            LIKE rtic_t.rtic020,
#  rtic021            LIKE rtic_t.rtic021,
#  rtic022            LIKE rtic_t.rtic022,
#  rtic023            LIKE rtic_t.rtic023,
#  rtic024            LIKE rtic_t.rtic024,
#  rtic025            LIKE rtic_t.rtic025,
#  rtic026            LIKE rtic_t.rtic026,
#  rtic027            LIKE rtic_t.rtic027,
#  rtic028            LIKE rtic_t.rtic028,
#  rtic029            LIKE rtic_t.rtic029
#                     END RECORD
#
#DEFINE g_xmeg2_d      DYNAMIC ARRAY OF type_g_xmeg2_d
#170207-00004#2 170219 by 02749 mark---(E)

 TYPE type_g_xmeg7_d RECORD
       rtieseq LIKE rtie_t.rtieseq, 
   imay0032 LIKE type_t.chr80, 
   imaa0012 LIKE type_t.chr80, 
   imaa0012_desc LIKE type_t.chr500, 
   imaa0012_desc_desc LIKE type_t.chr500, 
   rtieseq1 LIKE rtie_t.rtieseq1, 
   rtie001 LIKE rtie_t.rtie001, 
   rtie002 LIKE rtie_t.rtie002, 
   rtie002_desc LIKE type_t.chr500, 
   rtie006 LIKE rtie_t.rtie006
      END RECORD 
DEFINE g_xmeg7_d   DYNAMIC ARRAY OF type_g_xmeg7_d
DEFINE g_xmeg7_d_t type_g_xmeg7_d
DEFINE g_xmeg_d_color   DYNAMIC ARRAY OF RECORD 
       xmegsite          STRING,
       xmegseq           STRING,
       xmeg027           STRING,
       xmeg001           STRING,
       xmeg001_desc      STRING,
       imaal004          STRING,
       xmeg002           STRING,
       xmeg004           STRING,
       xmeg004_desc      STRING,
       xmeg005           STRING,
       xmeg006           STRING,
       xmeg006_desc      STRING,
       xmeg007           STRING,
       xmeg008           STRING,
       xmeg008_desc      STRING,
       xmeg009           STRING,
       xmeg024           STRING,
       xmeg012           STRING,
       xmeg013           STRING,
       xmeg045           STRING,
       xmeg010           STRING,
       xmeg010_desc      STRING,
       xmeg011           STRING,
       xmeg015           STRING,
       xmeg016           STRING,
       xmeg016_desc      STRING,
       xmeg017           STRING,
       xmeg046           STRING,
       xmeg047           STRING,
       xmeg048           STRING,
       xmeg023           STRING,
       xmeg019           STRING,
       xmeg020           STRING,
       xmeg021           STRING,
       xmeg022           STRING,
       xmeg051           STRING,
       xmegunit          STRING,
       xmegunit_desc     STRING,
       xmegorga          STRING,
       xmegorga_desc     STRING,
       xmeg052           STRING,
       xmeg049           STRING,
       xmeg049_desc      STRING,
       xmeg053           STRING,
       xmeg053_desc      STRING,
       xmeg050           STRING,
       xmeg901           STRING,
       xmeg902           STRING,
       xmeg902_desc      STRING,
       xmeg903           STRING
       END RECORD

DEFINE g_xmeg3_d_color   DYNAMIC ARRAY OF RECORD 
       xmehdocno         STRING,
       xmehseq           STRING,
       xmehseq1          STRING,
       xmeh229           STRING,
       xmeh003           STRING,
       xmeh001           STRING,
       xmeh001_desc      STRING,
       xmeh001_desc_desc STRING,
       xmeh002           STRING,
       xmeh200           STRING,
       xmeh200_desc      STRING,
       xmeh004           STRING,
       xmeh004_desc      STRING,
       xmeh005           STRING,
       xmeh011           STRING,
       xmeh012           STRING,
       xmeg012           STRING,
       xmeg013           STRING,
       xmehseq2          STRING,
       xmeh006           STRING,
       xmeh201           STRING,
       xmeh201_desc      STRING,
       xmeh202           STRING,
       xmeh024           STRING,
       xmeh024_desc      STRING,
       xmeh025           STRING,
       xmeh026           STRING,
       xmeh026_desc      STRING,
       xmeh027           STRING,
       xmeh203           STRING,
       xmeh204           STRING,
       xmeh205           STRING,
       xmeh206           STRING,
       xmeh029           STRING,
       xmeh028           STRING,
       xmeh019           STRING,
       xmeh019_desc      STRING,
       xmeh030           STRING,
       xmeh207           STRING,
       xmeh207_desc      STRING,
       xmehunit          STRING,
       xmehunit_desc     STRING,
       xmeh210           STRING,
       xmeh210_desc      STRING,
       xmeh212           STRING,
       xmeh213           STRING,
       xmeh213_desc      STRING,
       xmeh214           STRING,
       xmeh214_desc      STRING,
       xmeh215           STRING,
       xmeh031           STRING,
       xmeh014           STRING,
       xmeh015           STRING,
       xmeh016           STRING,
       xmeh017           STRING,
       xmeh221           STRING,
       xmehsite          STRING,
       xmehsite_desc     STRING,
       xmeh218           STRING,
       xmeh218_desc      STRING,
       xmeh219           STRING,
       xmeh219_desc      STRING,
       xmeh220           STRING,
       xmeh220_desc      STRING,
       xmeh222           STRING,
       xmeh222_desc      STRING,
       xmeh223           STRING,
       xmeh223_desc      STRING,
       xmeh224           STRING,
       xmeh224_desc      STRING,
       xmehorga          STRING,
       xmehorga_desc     STRING,
       xmeh226           STRING,
       xmeh227           STRING,
       xmeh227_desc      STRING,
       xmeh228           STRING,
       xmeh228_desc      STRING,
       xmeh901           STRING
       END RECORD

DEFINE g_xmeg4_d_color   DYNAMIC ARRAY OF RECORD         
       xmjbunit          STRING, 
       xmjbseq           STRING, 
       xmjbsite          STRING, 
       xmjbsite_desc     STRING,
       xmjb001           STRING, 
       xmjb002           STRING, 
       xmjb003           STRING, 
       xmjb003_desc      STRING,
       xmjb003_desc_desc STRING,
       xmjb033           STRING, 
       xmjb004           STRING, 
       xmjb005           STRING, 
       xmjb005_desc      STRING,
       xmjb006           STRING, 
       xmjb006_desc      STRING,
       xmjb007           STRING, 
       xmjb011           STRING, 
       xmjb011_desc      STRING,
       xmjb012           STRING, 
       xmjb013           STRING, 
       xmjb013_desc      STRING,
       xmjb014           STRING, 
       xmjb015           STRING, 
       xmjb015_desc      STRING,
       xmjb016           STRING, 
       xmjb017           STRING, 
       xmjb017_desc      STRING,
       xmjb018           STRING, 
       xmjb008           STRING, 
       xmjb009           STRING, 
       xmjb010           STRING, 
       xmjb022           STRING, 
       xmjb019           STRING, 
       xmjb020           STRING, 
       xmjb021           STRING, 
       xmjb024           STRING, 
       xmjb024_desc      STRING,
       xmjb025           STRING, 
       xmjb026           STRING, 
       xmjb026_desc      STRING,
       xmjb027           STRING, 
       xmjb027_desc      STRING,
       xmjb028           STRING, 
       xmjb029           STRING, 
       xmjb030           STRING, 
       xmjb031           STRING, 
       xmjb032           STRING, 
       xmjb034           STRING, 
       xmjb901           STRING,
       xmjb902           STRING, 
       xmjb902_desc      STRING,
       xmjb903           STRING
       END RECORD

DEFINE g_xmeg5_d_color   DYNAMIC ARRAY OF RECORD
       xmefsite          STRING,                   
       xmef001           STRING,                  
       xmef002           STRING,                  
       xmef002_desc      STRING,                  
       xmef003           STRING,                  
       xmef004           STRING,                  
       xmef005           STRING,                  
       xmef006           STRING,                  
       xmef007           STRING,                  
       xmef008           STRING,                  
       xmef009           STRING,                  
       xmef901           STRING,                  
       xmef902           STRING,                  
       xmef902_desc      STRING,                  
       xmef903           STRING                  
       END RECORD  
DEFINE g_upd_unit        LIKE type_t.chr1

#161104-00002#1 161104 by 02749 add---(S)
TYPE   type_g_xmej    RECORD
          xmejent     LIKE xmej_t.xmejent   ,   #企業編號
          xmejsite    LIKE xmej_t.xmejsite  ,   #營運據點
          xmejdocno   LIKE xmej_t.xmejdocno ,   #訂單單號
          xmejseq     LIKE xmej_t.xmejseq   ,   #訂單項次
          xmejseq2    LIKE xmej_t.xmejseq2  ,   #分批序
          xmej002     LIKE xmej_t.xmej002   ,   #分批數量
          xmej003     LIKE xmej_t.xmej003   ,   #約定交貨日期
          xmej004     LIKE xmej_t.xmej004   ,   #預計簽收日
          xmej005     LIKE xmej_t.xmej005   ,   #出貨時段
          xmej006     LIKE xmej_t.xmej006   ,   #MRP凍結否
          xmej007     LIKE xmej_t.xmej007   ,   #交期類型
          xmej900     LIKE xmej_t.xmej900   ,   #變更序
          xmej901     LIKE xmej_t.xmej901   ,   #變更類型
          xmej200     LIKE xmej_t.xmej200   ,   #庫區/庫位
          xmej201     LIKE xmej_t.xmej201   ,   #儲位
          xmej202     LIKE xmej_t.xmej202   ,   #批號
          xmejunit    LIKE xmej_t.xmejunit  ,   #應用組織
          #161123-00042#1 Add By Ken 161124(S)
          xmejud001 LIKE xmej_t.xmejud001, #自定義欄位(文字)001
          xmejud002 LIKE xmej_t.xmejud002, #自定義欄位(文字)002
          xmejud003 LIKE xmej_t.xmejud003, #自定義欄位(文字)003
          xmejud004 LIKE xmej_t.xmejud004, #自定義欄位(文字)004
          xmejud005 LIKE xmej_t.xmejud005, #自定義欄位(文字)005
          xmejud006 LIKE xmej_t.xmejud006, #自定義欄位(文字)006
          xmejud007 LIKE xmej_t.xmejud007, #自定義欄位(文字)007
          xmejud008 LIKE xmej_t.xmejud008, #自定義欄位(文字)008
          xmejud009 LIKE xmej_t.xmejud009, #自定義欄位(文字)009
          xmejud010 LIKE xmej_t.xmejud010, #自定義欄位(文字)010
          xmejud011 LIKE xmej_t.xmejud011, #自定義欄位(數字)011
          xmejud012 LIKE xmej_t.xmejud012, #自定義欄位(數字)012
          xmejud013 LIKE xmej_t.xmejud013, #自定義欄位(數字)013
          xmejud014 LIKE xmej_t.xmejud014, #自定義欄位(數字)014
          xmejud015 LIKE xmej_t.xmejud015, #自定義欄位(數字)015
          xmejud016 LIKE xmej_t.xmejud016, #自定義欄位(數字)016
          xmejud017 LIKE xmej_t.xmejud017, #自定義欄位(數字)017
          xmejud018 LIKE xmej_t.xmejud018, #自定義欄位(數字)018
          xmejud019 LIKE xmej_t.xmejud019, #自定義欄位(數字)019
          xmejud020 LIKE xmej_t.xmejud020, #自定義欄位(數字)020
          xmejud021 LIKE xmej_t.xmejud021, #自定義欄位(日期時間)021
          xmejud022 LIKE xmej_t.xmejud022, #自定義欄位(日期時間)022
          xmejud023 LIKE xmej_t.xmejud023, #自定義欄位(日期時間)023
          xmejud024 LIKE xmej_t.xmejud024, #自定義欄位(日期時間)024
          xmejud025 LIKE xmej_t.xmejud025, #自定義欄位(日期時間)025
          xmejud026 LIKE xmej_t.xmejud026, #自定義欄位(日期時間)026
          xmejud027 LIKE xmej_t.xmejud027, #自定義欄位(日期時間)027
          xmejud028 LIKE xmej_t.xmejud028, #自定義欄位(日期時間)028
          xmejud029 LIKE xmej_t.xmejud029, #自定義欄位(日期時間)029
          xmejud030 LIKE xmej_t.xmejud030  #自定義欄位(日期時間)030
          #161123-00042#1 Add By Ken 161124(E)
                      END RECORD
#161104-00002#1 161104 by 02749 add---(E)
#end add-point
       
#模組變數(Module Variables)
DEFINE g_xmee_m          type_g_xmee_m
DEFINE g_xmee_m_t        type_g_xmee_m
DEFINE g_xmee_m_o        type_g_xmee_m
DEFINE g_xmee_m_mask_o   type_g_xmee_m #轉換遮罩前資料
DEFINE g_xmee_m_mask_n   type_g_xmee_m #轉換遮罩後資料
 
   DEFINE g_xmeedocno_t LIKE xmee_t.xmeedocno
DEFINE g_xmee900_t LIKE xmee_t.xmee900
 
 
DEFINE g_xmeg_d          DYNAMIC ARRAY OF type_g_xmeg_d
DEFINE g_xmeg_d_t        type_g_xmeg_d
DEFINE g_xmeg_d_o        type_g_xmeg_d
DEFINE g_xmeg_d_mask_o   DYNAMIC ARRAY OF type_g_xmeg_d #轉換遮罩前資料
DEFINE g_xmeg_d_mask_n   DYNAMIC ARRAY OF type_g_xmeg_d #轉換遮罩後資料
DEFINE g_xmeg2_d          DYNAMIC ARRAY OF type_g_xmeg2_d
DEFINE g_xmeg2_d_t        type_g_xmeg2_d
DEFINE g_xmeg2_d_o        type_g_xmeg2_d
DEFINE g_xmeg2_d_mask_o   DYNAMIC ARRAY OF type_g_xmeg2_d #轉換遮罩前資料
DEFINE g_xmeg2_d_mask_n   DYNAMIC ARRAY OF type_g_xmeg2_d #轉換遮罩後資料
DEFINE g_xmeg3_d          DYNAMIC ARRAY OF type_g_xmeg3_d
DEFINE g_xmeg3_d_t        type_g_xmeg3_d
DEFINE g_xmeg3_d_o        type_g_xmeg3_d
DEFINE g_xmeg3_d_mask_o   DYNAMIC ARRAY OF type_g_xmeg3_d #轉換遮罩前資料
DEFINE g_xmeg3_d_mask_n   DYNAMIC ARRAY OF type_g_xmeg3_d #轉換遮罩後資料
DEFINE g_xmeg4_d          DYNAMIC ARRAY OF type_g_xmeg4_d
DEFINE g_xmeg4_d_t        type_g_xmeg4_d
DEFINE g_xmeg4_d_o        type_g_xmeg4_d
DEFINE g_xmeg4_d_mask_o   DYNAMIC ARRAY OF type_g_xmeg4_d #轉換遮罩前資料
DEFINE g_xmeg4_d_mask_n   DYNAMIC ARRAY OF type_g_xmeg4_d #轉換遮罩後資料
DEFINE g_xmeg5_d          DYNAMIC ARRAY OF type_g_xmeg5_d
DEFINE g_xmeg5_d_t        type_g_xmeg5_d
DEFINE g_xmeg5_d_o        type_g_xmeg5_d
DEFINE g_xmeg5_d_mask_o   DYNAMIC ARRAY OF type_g_xmeg5_d #轉換遮罩前資料
DEFINE g_xmeg5_d_mask_n   DYNAMIC ARRAY OF type_g_xmeg5_d #轉換遮罩後資料
 
 
DEFINE g_browser         DYNAMIC ARRAY OF type_browser
DEFINE g_browser_f       DYNAMIC ARRAY OF type_browser
 
 
DEFINE g_wc                  STRING
DEFINE g_wc_t                STRING
DEFINE g_wc2                 STRING                          #單身CONSTRUCT結果
DEFINE g_wc2_table1          STRING
DEFINE g_wc2_table2   STRING
 
DEFINE g_wc2_table3   STRING
 
DEFINE g_wc2_table4   STRING
 
DEFINE g_wc2_table5   STRING
 
 
 
DEFINE g_wc2_extend          STRING
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING
 
DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10     
DEFINE g_jump                LIKE type_t.num10        
DEFINE g_no_ask              LIKE type_t.num5        
DEFINE g_rec_b               LIKE type_t.num10           
DEFINE l_ac                  LIKE type_t.num10    
DEFINE g_curr_diag           ui.Dialog                         #Current Dialog
                                                               
DEFINE g_pagestart           LIKE type_t.num10                 
DEFINE gwin_curr             ui.Window                         #Current Window
DEFINE gfrm_curr             ui.Form                           #Current Form
DEFINE g_page_action         STRING                            #page action
DEFINE g_header_hidden       LIKE type_t.num5                  #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5                  #隱藏工作Panel
DEFINE g_page                STRING                            #第幾頁
DEFINE g_state               STRING       
DEFINE g_header_cnt          LIKE type_t.num10
DEFINE g_detail_cnt          LIKE type_t.num10                  #單身總筆數
DEFINE g_detail_idx          LIKE type_t.num10                  #單身目前所在筆數
DEFINE g_detail_idx_tmp      LIKE type_t.num10                  #單身目前所在筆數
DEFINE g_detail_idx2         LIKE type_t.num10                  #單身2目前所在筆數
DEFINE g_detail_idx_list     DYNAMIC ARRAY OF LIKE type_t.num10 #單身2目前所在筆數
DEFINE g_browser_cnt         LIKE type_t.num10                  #Browser總筆數
DEFINE g_browser_idx         LIKE type_t.num10                  #Browser目前所在筆數
DEFINE g_temp_idx            LIKE type_t.num10                  #Browser目前所在筆數(暫存用)
DEFINE g_order               STRING                             #查詢排序欄位
                                                        
DEFINE g_current_row         LIKE type_t.num10                  #Browser所在筆數
DEFINE g_current_sw          BOOLEAN                            #Browser所在筆數用開關
DEFINE g_current_page        LIKE type_t.num10                  #目前所在頁數
DEFINE g_insert              LIKE type_t.chr5                   #是否導到其他page
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys               DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak           DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_bfill               LIKE type_t.chr5              #是否刷新單身
DEFINE g_error_show          LIKE type_t.num5              #是否顯示筆數提示訊息
DEFINE g_master_insert       BOOLEAN                       #確認單頭資料是否寫入
 
DEFINE g_wc_frozen           STRING                        #凍結欄位使用
DEFINE g_chk                 BOOLEAN                       #助記碼判斷用
DEFINE g_aw                  STRING                        #確定當下點擊的單身
DEFINE g_default             BOOLEAN                       #是否有外部參數查詢
DEFINE g_log1                STRING                        #log用
DEFINE g_log2                STRING                        #log用
DEFINE g_loc                 LIKE type_t.chr5              #判斷游標所在位置
DEFINE g_add_browse          STRING                        #新增填充用WC
DEFINE g_update              BOOLEAN                       #確定單頭/身是否異動過
DEFINE g_idx_group           om.SaxAttributes              #頁籤群組
DEFINE g_master_commit       LIKE type_t.chr1              #確認單頭是否修改過
 
#add-point:自定義客戶專用模組變數(Module Variable) name="global.variable_customerization"

#end add-point
 
#add-point:傳入參數說明(global.argv) name="global.argv"

#end add-point
 
{</section>}
 
{<section id="adbt510.main" >}
#應用 a26 樣板自動產生(Version:7)
#+ 作業開始(主程式類型)
MAIN
   #add-point:main段define(客製用) name="main.define_customerization"
   
   #end add-point   
   #add-point:main段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="main.define"
   DEFINE  l_forupd_sql    STRING 
   DEFINE l_success LIKE type_t.num5 #150308-00001#1  By Ken 150309
   #end add-point   
   
   OPTIONS
   INPUT NO WRAP
   DEFER INTERRUPT
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
       
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("adb","")
 
   #add-point:作業初始化 name="main.init"
   #獲取當前營運據點的聯絡對象識別碼
   LET g_oofa001 = ''
   SELECT oofa001 INTO g_oofa001 FROM oofa_t WHERE oofaent = g_enterprise AND oofa002 = '1' AND oofa003 = g_site
   
   #獲得當前營運據點的所屬稅區
   LET g_ooef019 = ''
   SELECT ooef019 INTO g_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site

   LET g_acc = ''
   #抓取[T:系統分類值檔].[C:系統分類碼]=24且[T:系統分類值檔].[C:系統分類碼]=g_prog 的[T:系統分類值檔].[C:參考欄位>
   
   #SELECT gzcb004 INTO g_acc FROM gzcb_t WHERE gzcb001 = '24' AND gzcb002 = g_prog   #160816-00001#7 mark   
   LET g_acc = s_fin_get_scc_value('24',g_prog,'2')   #160816-00001#7  Add  

   

   #02749  150121  add ----------------------(S)
   #抓取[T:系統分類值檔].[C:系統分類碼]=24且[T:系統分類值檔].[C:系統分類碼]=訂單 的[T:系統分類值檔].[C:參考欄位>
   #SELECT gzcb008 INTO g_acc_282 FROM gzcb_t  WHERE gzcb001 = '24' AND gzcb002 = 'adbt500'   #160816-00001#7 mark   
   #02749  150121  add ----------------------(E)  
   LET g_acc_282 = s_fin_get_scc_value('24','adbt500','2')   #160816-00001#7  Add  

   
   LET g_flag1 = FALSE
   
   #end add-point
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define name="main.define_sql"
   LET l_forupd_sql = "SELECT xmeesite,xmeedocno,xmee001,xmeedocdt,xmee004,'',xmee002,'',xmee003, 
       '',xmeestus,xmee005,xmee006,xmee007,xmee008,xmee027,'',xmee009,'',xmee010,'',xmee011, 
       '',xmee012,xmee013,xmee035,'',xmee015,'',xmee016,xmee017,'',xmee018,'',xmee019,xmee023,'',xmee032, 
       '',xmee071,xmee021,'',xmee022,'',xmee034,'',xmee024,'', 
       xmee028,xmee041,xmee042,xmee043,xmee025,'','',xmee026,'','',xmee020,'',
       xmee036,'',xmeeownid,'',xmeeowndp,'',xmeecrtid,'',xmeecrtdp,'',xmeecrtdt,xmeemodid, 
       '',xmeemoddt,xmeecnfid,'',xmeecnfdt FROM xmee_t WHERE xmeeent= ? AND xmeedocno=? AND xmee900=? FOR UPDATE"

   LET l_forupd_sql = cl_sql_forupd(l_forupd_sql)                #轉換不同資料庫語法
   DECLARE adbt510_cl2 CURSOR FROM l_forupd_sql       
   #end add-point
   LET g_forupd_sql = " SELECT xmeesite,'',xmee902,xmeedocno,xmee900,xmee901,xmee001,xmee202,'',xmee023, 
       '',xmee004,'',xmee200,'',xmee201,'',xmeestus,xmee005,xmee007,xmee008,xmeedocdt,xmee024,'',xmee002, 
       '',xmee003,'',xmeeacti,xmee021,'',xmee022,'',xmee203,'',xmee027,'',xmee211,'',xmee210,'',xmee209, 
       '',xmee208,'',xmeeunit,'',xmee204,'',xmee205,xmee032,'',xmee071,xmee903,'',xmee904,xmee025,'', 
       '',xmee026,'','',xmee206,'',xmee207,'',xmee020,'',xmee036,'',xmee048,xmee049,xmee009,'',xmee010, 
       '',xmee015,'',xmee016,xmee011,'',xmee012,xmee013,xmee035,'','',xmee039,xmeeownid,'',xmeeowndp, 
       '',xmeecrtid,'',xmeecrtdp,'',xmeecrtdt,xmeemodid,'',xmeemoddt,xmeecnfid,'',xmeecnfdt,xmee034, 
       '',xmee041,xmee006,xmee042,xmee017,'',xmee043,xmee018,'',xmee019,xmee028", 
                      " FROM xmee_t",
                      " WHERE xmeeent= ? AND xmeedocno=? AND xmee900=? FOR UPDATE"
   #add-point:SQL_define name="main.after_define_sql"
                  
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)                #轉換不同資料庫語法
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE adbt510_cl CURSOR FROM g_forupd_sql                 # LOCK CURSOR
 
   LET g_sql = " SELECT DISTINCT t0.xmeesite,t0.xmee902,t0.xmeedocno,t0.xmee900,t0.xmee901,t0.xmee001, 
       t0.xmee202,t0.xmee023,t0.xmee004,t0.xmee200,t0.xmee201,t0.xmeestus,t0.xmee005,t0.xmee007,t0.xmee008, 
       t0.xmeedocdt,t0.xmee024,t0.xmee002,t0.xmee003,t0.xmeeacti,t0.xmee021,t0.xmee022,t0.xmee203,t0.xmee027, 
       t0.xmee211,t0.xmee210,t0.xmee209,t0.xmee208,t0.xmeeunit,t0.xmee204,t0.xmee205,t0.xmee032,t0.xmee071, 
       t0.xmee903,t0.xmee904,t0.xmee025,t0.xmee026,t0.xmee206,t0.xmee207,t0.xmee020,t0.xmee036,t0.xmee048, 
       t0.xmee049,t0.xmee009,t0.xmee010,t0.xmee015,t0.xmee016,t0.xmee011,t0.xmee012,t0.xmee013,t0.xmee035, 
       t0.xmee039,t0.xmeeownid,t0.xmeeowndp,t0.xmeecrtid,t0.xmeecrtdp,t0.xmeecrtdt,t0.xmeemodid,t0.xmeemoddt, 
       t0.xmeecnfid,t0.xmeecnfdt,t0.xmee034,t0.xmee041,t0.xmee006,t0.xmee042,t0.xmee017,t0.xmee043,t0.xmee018, 
       t0.xmee019,t0.xmee028,t1.ooefl003 ,t2.ooefl003 ,t3.oojdl003 ,t4.pmaal004 ,t5.pmaal004 ,t6.pmaal004 , 
       t7.oocql004 ,t8.ooag011 ,t9.ooefl003 ,t10.pmaal004 ,t11.pmaal004 ,t12.pmaal004 ,t13.oofa011 , 
       t14.dbaal003 ,t15.dbaal003 ,t16.dbaal003 ,t17.dbaal003 ,t18.ooefl003 ,t19.prcfl003 ,t20.oocql004 , 
       t21.oocql004 ,t22.dbadl003 ,t23.dbabl003 ,t24.oocql004 ,t25.pmaal004 ,t26.ooibl004 ,t27.oocql004 , 
       t28.ooail003 ,t29.ooag011 ,t30.ooefl003 ,t31.ooag011 ,t32.ooefl003 ,t33.ooag011 ,t34.ooag011 , 
       t35.pmaal003 ,t36.pmaml003 ,t37.ooidl003",
               " FROM xmee_t t0",
                              " LEFT JOIN ooefl_t t1 ON t1.ooeflent="||g_enterprise||" AND t1.ooefl001=t0.xmeesite AND t1.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.xmee202 AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN oojdl_t t3 ON t3.oojdlent="||g_enterprise||" AND t3.oojdl001=t0.xmee023 AND t3.oojdl002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t4 ON t4.pmaalent="||g_enterprise||" AND t4.pmaal001=t0.xmee004 AND t4.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t5 ON t5.pmaalent="||g_enterprise||" AND t5.pmaal001=t0.xmee200 AND t5.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t6 ON t6.pmaalent="||g_enterprise||" AND t6.pmaal001=t0.xmee201 AND t6.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t7 ON t7.oocqlent="||g_enterprise||" AND t7.oocql001='295' AND t7.oocql002=t0.xmee024 AND t7.oocql003='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t8 ON t8.ooagent="||g_enterprise||" AND t8.ooag001=t0.xmee002  ",
               " LEFT JOIN ooefl_t t9 ON t9.ooeflent="||g_enterprise||" AND t9.ooefl001=t0.xmee003 AND t9.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t10 ON t10.pmaalent="||g_enterprise||" AND t10.pmaal001=t0.xmee021 AND t10.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t11 ON t11.pmaalent="||g_enterprise||" AND t11.pmaal001=t0.xmee022 AND t11.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t12 ON t12.pmaalent="||g_enterprise||" AND t12.pmaal001=t0.xmee203 AND t12.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN oofa_t t13 ON t13.oofaent="||g_enterprise||" AND t13.oofa001=t0.xmee027  ",
               " LEFT JOIN dbaal_t t14 ON t14.dbaalent="||g_enterprise||" AND t14.dbaal001=t0.xmee211 AND t14.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN dbaal_t t15 ON t15.dbaalent="||g_enterprise||" AND t15.dbaal001=t0.xmee210 AND t15.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN dbaal_t t16 ON t16.dbaalent="||g_enterprise||" AND t16.dbaal001=t0.xmee209 AND t16.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN dbaal_t t17 ON t17.dbaalent="||g_enterprise||" AND t17.dbaal001=t0.xmee208 AND t17.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t18 ON t18.ooeflent="||g_enterprise||" AND t18.ooefl001=t0.xmeeunit AND t18.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN prcfl_t t19 ON t19.prcflent="||g_enterprise||" AND t19.prcfl001=t0.xmee204 AND t19.prcfl002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t20 ON t20.oocqlent="||g_enterprise||" AND t20.oocql001='297' AND t20.oocql002=t0.xmee032 AND t20.oocql003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t21 ON t21.oocqlent="||g_enterprise||" AND t21.oocql001='282' AND t21.oocql002=t0.xmee903 AND t21.oocql003='"||g_dlang||"' ",
               " LEFT JOIN dbadl_t t22 ON t22.dbadlent="||g_enterprise||" AND t22.dbadl001=t0.xmee206 AND t22.dbadl002='"||g_dlang||"' ",
               " LEFT JOIN dbabl_t t23 ON t23.dbablent="||g_enterprise||" AND t23.dbabl001=t0.xmee207 AND t23.dbabl002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t24 ON t24.oocqlent="||g_enterprise||" AND t24.oocql001='263' AND t24.oocql002=t0.xmee020 AND t24.oocql003='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t25 ON t25.pmaalent="||g_enterprise||" AND t25.pmaal001=t0.xmee036 AND t25.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN ooibl_t t26 ON t26.ooiblent="||g_enterprise||" AND t26.ooibl002=t0.xmee009 AND t26.ooibl003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t27 ON t27.oocqlent="||g_enterprise||" AND t27.oocql001='238' AND t27.oocql002=t0.xmee010 AND t27.oocql003='"||g_dlang||"' ",
               " LEFT JOIN ooail_t t28 ON t28.ooailent="||g_enterprise||" AND t28.ooail001=t0.xmee015 AND t28.ooail002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t29 ON t29.ooagent="||g_enterprise||" AND t29.ooag001=t0.xmeeownid  ",
               " LEFT JOIN ooefl_t t30 ON t30.ooeflent="||g_enterprise||" AND t30.ooefl001=t0.xmeeowndp AND t30.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t31 ON t31.ooagent="||g_enterprise||" AND t31.ooag001=t0.xmeecrtid  ",
               " LEFT JOIN ooefl_t t32 ON t32.ooeflent="||g_enterprise||" AND t32.ooefl001=t0.xmeecrtdp AND t32.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t33 ON t33.ooagent="||g_enterprise||" AND t33.ooag001=t0.xmeemodid  ",
               " LEFT JOIN ooag_t t34 ON t34.ooagent="||g_enterprise||" AND t34.ooag001=t0.xmeecnfid  ",
               " LEFT JOIN pmaal_t t35 ON t35.pmaalent="||g_enterprise||" AND t35.pmaal001=t0.xmee034 AND t35.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaml_t t36 ON t36.pmamlent="||g_enterprise||" AND t36.pmaml001=t0.xmee017 AND t36.pmaml002='"||g_dlang||"' ",
               " LEFT JOIN ooidl_t t37 ON t37.ooidlent="||g_enterprise||" AND t37.ooidl001=t0.xmee018 AND t37.ooidl002='"||g_dlang||"' ",
 
               " WHERE t0.xmeeent = " ||g_enterprise|| " AND t0.xmeedocno = ? AND t0.xmee900 = ?"
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   #add-point:SQL_define name="main.after_refresh_sql"
   
   #end add-point
   PREPARE adbt510_master_referesh FROM g_sql
 
    
 
   
   IF g_bgjob = "Y" THEN
      #add-point:Service Call name="main.servicecall"
                                    
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_adbt510 WITH FORM cl_ap_formpath("adb",g_code)
   
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
   
      #程式初始化
      CALL adbt510_init()   
 
      #進入選單 Menu (="N")
      CALL adbt510_ui_dialog() 
      
      #add-point:畫面關閉前 name="main.before_close"
                                     
      #end add-point
 
      #畫面關閉
      CLOSE WINDOW w_adbt510
      
   END IF 
   
   CLOSE adbt510_cl
   
   
 
   #add-point:作業離開前 name="main.exit"
   CALL s_aooi500_drop_temp() RETURNING l_success    #150308-00001#1 150309 By Ken 
   CALL s_axmt510_drop_temp()                        #160505-00018#2 160510 by 02749 add 
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
END MAIN
 
 
 
 
{</section>}
 
{<section id="adbt510.init" >}
#+ 瀏覽頁簽資料初始化
PRIVATE FUNCTION adbt510_init()
   #add-point:init段define(客製用) name="init.define_customerization"
   
   #end add-point    
   #add-point:init段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="init.define"
   DEFINE l_success LIKE type_t.num5   #150308-00001#1  By Ken 150309  
   DEFINE l_prog    LIKE type_t.chr30  #160815-00016#1 160817 by 02749 add   
   #end add-point   
   
   #add-point:Function前置處理  name="init.pre_function"
   
   #end add-point
   
   LET g_bfill       = "Y"
   LET g_detail_idx  = 1 #第一層單身指標
   LET g_detail_idx2 = 1 #第二層單身指標
   
   #各個page指標
   LET g_detail_idx_list[1] = 1 
   LET g_detail_idx_list[2] = 1
   LET g_detail_idx_list[3] = 1
   LET g_detail_idx_list[4] = 1
   LET g_detail_idx_list[5] = 1
 
   LET g_error_show  = 1
   LET l_ac = 1 #單身指標
      CALL cl_set_combo_scc_part('xmeestus','13','N,Y,A,D,R,W,X')
 
      CALL cl_set_combo_scc('xmee005','2063') 
   CALL cl_set_combo_scc('xmee007','2065') 
   CALL cl_set_combo_scc('xmee048','2085') 
   CALL cl_set_combo_scc('xmee049','2084') 
   CALL cl_set_combo_scc('xmee039','8321') 
   CALL cl_set_combo_scc('xmee006','2064') 
   CALL cl_set_combo_scc('xmeg045','2035') 
   CALL cl_set_combo_scc('xmeg019','2055') 
   CALL cl_set_combo_scc('xmeg020','2036') 
   CALL cl_set_combo_scc('rtic001','6707') 
   CALL cl_set_combo_scc('rtic002','6708') 
   CALL cl_set_combo_scc('rtic006','6564') 
   CALL cl_set_combo_scc('rtic007','6565') 
   CALL cl_set_combo_scc('xmeh003','2055') 
   CALL cl_set_combo_scc('xmeh017','2058') 
   CALL cl_set_combo_scc('xmef016','3015') 
   CALL cl_set_combo_scc('xmef017','3016') 
 
   LET gwin_curr = ui.Window.getCurrent()  #取得現行畫面
   LET gfrm_curr = gwin_curr.getForm()     #取出物件化後的畫面物件
   
   #page群組
   LET g_idx_group = om.SaxAttributes.create()
   CALL g_idx_group.addAttribute("'1',","1")
   CALL g_idx_group.addAttribute("'2',","1")
   CALL g_idx_group.addAttribute("'3',","1")
   CALL g_idx_group.addAttribute("'4',","1")
   CALL g_idx_group.addAttribute("'5',","1")
 
 
   #add-point:畫面資料初始化 name="init.init"
   CALL s_aooi500_create_temp() RETURNING l_success #150308-00001#1  By Ken 150309   
   CALL cl_set_combo_scc('xmeg035','2039') 
   CALL cl_set_combo_scc('xmeg040','2067') 
   CALL cl_set_combo_scc_part('xmeg019','2055','1,2,3')
   CALL cl_set_combo_scc('xmeh003','2055')  
   CALL cl_set_combo_scc('xmeh017','2058')
   CALL cl_set_combo_scc_part('xmee005','2063','1,2,3,6')  
   CALL cl_set_combo_scc_part('xmee007','2065','1,5')  
   CALL cl_set_combo_scc('xmjb001','6064')   
   CALL cl_set_combo_scc('xmeh226','6013') 
   CALL cl_set_combo_scc('xmeh229','6064')
   CALL cl_set_combo_scc('rtie001','8310')
   CALL cl_set_combo_scc('xmee048','2085')
   CALL cl_set_combo_scc('xmee049','2084')
   LET g_errshow = '1'
   CALL cl_set_toolbaritem_visible("open_adbt510_04",FALSE)
   CALL cl_set_combo_scc_part('xmef016','3015','2')
   CALL cl_set_combo_scc('xmef017','3016') 
   
   #160815-00016#1 160817 by 02749 add---(S)
   LET l_prog = g_prog
   LET g_prog = 'adbt500'  
   LET g_slip_wc = ''                 
   LET g_slip_wc1 = ''   
   CALL s_aooi200_filter_slip('xmdadocno') RETURNING g_slip_wc 
   CALL s_aooi200_filter_slip('xmeedocno') RETURNING g_slip_wc1 
   LET g_prog = l_prog   
   #160815-00016#1 160817 by 02749 add---(E)
   #end add-point
   
   #初始化搜尋條件
   CALL adbt510_default_search()
    
END FUNCTION
 
{</section>}
 
{<section id="adbt510.ui_dialog" >}
#+ 功能選單
PRIVATE FUNCTION adbt510_ui_dialog()
   #add-point:ui_dialog段define(客製用) name="ui_dialog.define_customerization"
   
   #end add-point
   DEFINE li_idx     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE lb_first   BOOLEAN
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE la_param   RECORD
          prog       STRING,
          actionid   STRING,
          background LIKE type_t.chr1,
          param      DYNAMIC ARRAY OF STRING
          END RECORD
   DEFINE ls_js      STRING
   DEFINE la_output  DYNAMIC ARRAY OF STRING   #報表元件鬆耦合使用
   DEFINE  l_cmd_token           base.StringTokenizer   #報表作業cmdrun使用 
   DEFINE  l_cmd_next            STRING                 #報表作業cmdrun使用
   DEFINE  l_cmd_cnt             LIKE type_t.num5       #報表作業cmdrun使用
   DEFINE  l_cmd_prog_arg        STRING                 #報表作業cmdrun使用
   DEFINE  l_cmd_arg             STRING                 #報表作業cmdrun使用
   #add-point:ui_dialog段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_dialog.define"
   DEFINE l_pmaa004    LIKE pmaa_t.pmaa004 
   DEFINE l_rtiadocno  LIKE rtia_t.rtiadocno
   DEFINE l_success    LIKE type_t.num5
   #end add-point
   
   #add-point:Function前置處理  name="ui_dialog.pre_function"
   
   #end add-point
   
   CALL cl_set_act_visible("accept,cancel", FALSE)
 
   #因應查詢方案進行處理
   IF g_default THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   ELSE
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF
   
   #action default動作
   #應用 a42 樣板自動產生(Version:3)
   #進入程式時預設執行的動作
   CASE g_actdefault
      WHEN "insert"
         LET g_action_choice="insert"
         LET g_actdefault = ""
         IF cl_auth_chk_act("insert") THEN
            CALL adbt510_insert()
            #add-point:ON ACTION insert name="menu.default.insert"
                                                                        
            #END add-point
         END IF
 
      #add-point:action default自訂 name="ui_dialog.action_default"
                                    
      #end add-point
      OTHERWISE
   END CASE
 
 
 
   
   LET lb_first = TRUE
   
   #add-point:ui_dialog段before dialog  name="ui_dialog.before_dialog"
                  
   #end add-point
   
   WHILE TRUE 
   
      IF g_action_choice = "logistics" THEN
         #清除畫面及相關資料
         CLEAR FORM
         CALL g_browser.clear()       
         INITIALIZE g_xmee_m.* TO NULL
         CALL g_xmeg_d.clear()
         CALL g_xmeg2_d.clear()
         CALL g_xmeg3_d.clear()
         CALL g_xmeg4_d.clear()
         CALL g_xmeg5_d.clear()
 
         LET g_wc  = ' 1=2'
         LET g_wc2 = ' 1=1'
         LET g_action_choice = ""
         CALL adbt510_init()
      END IF
   
      CALL lib_cl_dlg.cl_dlg_before_display()
            
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
         #左側瀏覽頁簽
         DISPLAY ARRAY g_browser TO s_browse.* ATTRIBUTES(COUNT=g_header_cnt)
            BEFORE ROW
               #回歸舊筆數位置 (回到當時異動的筆數)
               LET g_current_idx = DIALOG.getCurrentRow("s_browse")
               IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                  LET g_current_idx = g_current_row
               END IF
               LET g_current_row = g_current_idx #目前指標
               LET g_current_sw = TRUE
         
               IF g_current_idx > g_browser.getLength() THEN
                  LET g_current_idx = g_browser.getLength()
               END IF 
               
               CALL adbt510_fetch('') # reload data
               LET l_ac = 1
               CALL adbt510_ui_detailshow() #Setting the current row 
         
               CALL adbt510_idx_chk()
               #NEXT FIELD xmegseq
         
               ON ACTION qbefield_user   #欄位隱藏設定 
                  LET g_action_choice="qbefield_user"
                  CALL cl_ui_qbefield_user()
         END DISPLAY
    
         DISPLAY ARRAY g_xmeg_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) #page1  
    
            BEFORE ROW
               #顯示單身筆數
               CALL adbt510_idx_chk()
               #確定當下選擇的筆數
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[1] = l_ac
               CALL g_idx_group.addAttribute("'1',",l_ac)
               
               #add-point:page1, before row動作 name="ui_dialog.page1.before_row"
               #CALL s_hint_show('xmek_t','xmeg_t','xmdc_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg_d[g_detail_idx].xmegseq,'','')                                                                            
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'1',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_current_page = 1
               #顯示單身筆數
               CALL adbt510_idx_chk()
               #add-point:page1自定義行為 name="ui_dialog.page1.before_display"
               CALL DIALOG.setCellAttributes(g_xmeg_d_color)  
               CALL adbt510_b_fill()
               CALL adbt510_show()                
               #end add-point
               
            #自訂ACTION(detail_show,page_1)
            
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_adbt510_03
            LET g_action_choice="open_adbt510_03"
            IF cl_auth_chk_act("open_adbt510_03") THEN
               
               #add-point:ON ACTION open_adbt510_03 name="menu.detail_show.page1.open_adbt510_03"
               IF l_ac > 0 THEN
                  IF NOT cl_null(g_xmeg_d[l_ac].xmegseq) THEN
                     CALL adbt510_03(g_xmee_m.xmeedocno,g_xmeg_d[l_ac].xmegseq,g_xmee_m.xmee900,'','','','')
                     RETURNING g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                     DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                     IF NOT cl_null(g_xmeg4_d[l_ac].xmjb031) AND NOT cl_null(g_xmeg4_d[l_ac].xmjb032) THEN
                        UPDATE xmjb_t
                           SET xmjb031 = g_xmeg4_d[l_ac].xmjb031,
                               xmjb032 = g_xmeg4_d[l_ac].xmjb032,
                               xmjb901 = '2'
                         WHERE xmjbent = g_enterprise
                           AND xmjbdocno = g_xmee_m.xmeedocno
                           AND xmjbseq = g_xmeg_d[l_ac].xmegseq
                           AND xmjb900 = g_xmee_m.xmee900
                     END IF
                     CALL s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg_d[l_ac].xmegseq,g_xmee_m.xmee900) RETURNING l_success 
                  END IF
               END IF
               #END add-point
               
            END IF
 
 
 
 
               
            #add-point:page1自定義行為 name="ui_dialog.page1.action"
                                                                        
            #end add-point
               
         END DISPLAY
        
         #第一階單身段落
         DISPLAY ARRAY g_xmeg2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL adbt510_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[2] = l_ac
               CALL g_idx_group.addAttribute("'2',",l_ac)
               
               #add-point:page2, before row動作 name="ui_dialog.body2.before_row"
                                                                                          
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'2',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_current_page = 2
               #顯示單身筆數
               CALL adbt510_idx_chk()
               #add-point:page2自定義行為 name="ui_dialog.body2.before_display"
                                                                                          
               #end add-point
      
            #自訂ACTION(detail_show,page_2)
            
         
            #add-point:page2自定義行為 name="ui_dialog.body2.action"
            #170207-00004#2 170219 by 02749 add---(S)
            ON ACTION open_adbt510_03
               LET g_action_choice="open_adbt510_03"
               IF cl_auth_chk_act("open_adbt510_03") THEN
                  IF l_ac > 0 THEN
                     IF NOT cl_null(g_xmeg7_d[l_ac].rtieseq) THEN
                        CALL adbt510_03(g_xmee_m.xmeedocno,g_xmeg7_d[l_ac].rtieseq,g_xmee_m.xmee900,'','','','')
                        RETURNING g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                        DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                        IF NOT cl_null(g_xmeg4_d[l_ac].xmjb031) AND NOT cl_null(g_xmeg4_d[l_ac].xmjb032) THEN
                           UPDATE xmjb_t
                              SET xmjb031 = g_xmeg4_d[l_ac].xmjb031,
                                  xmjb032 = g_xmeg4_d[l_ac].xmjb032,
                                  xmjb901 = '2'
                            WHERE xmjbent = g_enterprise
                              AND xmjbdocno = g_xmee_m.xmeedocno
                              AND xmjbseq = g_xmeg7_d[l_ac].rtieseq
                              AND xmjb900 = g_xmee_m.xmee900
                        END IF
                        CALL s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg7_d[l_ac].rtieseq,g_xmee_m.xmee900) RETURNING l_success 
                     END IF
                  END IF
                  EXIT DIALOG
               END IF  
            #170207-00004#2 170219 by 02749 add---(E)               
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_xmeg3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL adbt510_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[3] = l_ac
               CALL g_idx_group.addAttribute("'3',",l_ac)
               
               #add-point:page3, before row動作 name="ui_dialog.body3.before_row"
               #CALL s_hint_show('xmek_t','xmeh_t','xmdd_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg3_d[g_detail_idx].xmehseq,
               #                  g_xmeg3_d[g_detail_idx].xmehseq1,g_xmeg3_d[g_detail_idx].xmehseq2)                                                                           
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'3',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_current_page = 3
               #顯示單身筆數
               CALL adbt510_idx_chk()
               #add-point:page3自定義行為 name="ui_dialog.body3.before_display"
               CALL DIALOG.setCellAttributes(g_xmeg3_d_color)    
               CALL adbt510_b_fill()
               CALL adbt510_show()                 
               #end add-point
      
            #自訂ACTION(detail_show,page_3)
            
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_adbt510_03
            LET g_action_choice="open_adbt510_03"
            IF cl_auth_chk_act("open_adbt510_03") THEN
               
               #add-point:ON ACTION open_adbt510_03 name="menu.detail_show.page3.open_adbt510_03"
               IF l_ac > 0 THEN
                  IF NOT cl_null(g_xmeg4_d[l_ac].xmjbseq) THEN
                     CALL adbt510_03(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900,g_xmeg4_d[l_ac].xmjb018,g_xmeg4_d[l_ac].xmjb030,g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb025)
                     RETURNING g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                     DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                     IF NOT cl_null(g_xmeg4_d[l_ac].xmjb031) AND NOT cl_null(g_xmeg4_d[l_ac].xmjb032) THEN
                        UPDATE xmjb_t
                           SET xmjb031 = g_xmeg4_d[l_ac].xmjb031,
                               xmjb032 = g_xmeg4_d[l_ac].xmjb032,
                               xmjb901 = '2'
                         WHERE xmjbent = g_enterprise
                           AND xmjbdocno = g_xmee_m.xmeedocno
                           AND xmjbseq = g_xmeg4_d[l_ac].xmjbseq
                           AND xmjb900 = g_xmee_m.xmee900
                     END IF
                     CALL s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900) RETURNING l_success 
                  END IF
               END IF
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_adbt510_04
            LET g_action_choice="open_adbt510_04"
            IF cl_auth_chk_act("open_adbt510_04") THEN
               
               #add-point:ON ACTION open_adbt510_04 name="menu.detail_show.page3.open_adbt510_04"
               IF l_ac > 0 THEN
                  CALL adbt510_04(g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg4_d[l_ac].xmjbseq)
               END IF
               #END add-point
               
            END IF
 
 
 
 
         
            #add-point:page3自定義行為 name="ui_dialog.body3.action"
                                                     
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_xmeg4_d TO s_detail4.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL adbt510_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[4] = l_ac
               CALL g_idx_group.addAttribute("'4',",l_ac)
               
               #add-point:page4, before row動作 name="ui_dialog.body4.before_row"
               CALL s_hint_show('xmek_t','xmjb_t','xmja_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg4_d[g_detail_idx].xmjbseq,'','') 
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'4',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_current_page = 4
               #顯示單身筆數
               CALL adbt510_idx_chk()
               #add-point:page4自定義行為 name="ui_dialog.body4.before_display"
               CALL DIALOG.setCellAttributes(g_xmeg4_d_color) 
               #end add-point
      
            #自訂ACTION(detail_show,page_4)
            
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_adbt510_03
            LET g_action_choice="open_adbt510_03"
            IF cl_auth_chk_act("open_adbt510_03") THEN
               
               #add-point:ON ACTION open_adbt510_03 name="menu.detail_show.page4.open_adbt510_03"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_adbt510_04
            LET g_action_choice="open_adbt510_04"
            IF cl_auth_chk_act("open_adbt510_04") THEN
               
               #add-point:ON ACTION open_adbt510_04 name="menu.detail_show.page4.open_adbt510_04"
               
               #END add-point
               
            END IF
 
 
 
 
         
            #add-point:page4自定義行為 name="ui_dialog.body4.action"
            
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_xmeg5_d TO s_detail5.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL adbt510_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail5")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[5] = l_ac
               CALL g_idx_group.addAttribute("'5',",l_ac)
               
               #add-point:page5, before row動作 name="ui_dialog.body5.before_row"
               CALL s_hint_show('xmek_t','xmef_t','xmdb_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,0,'','')                                                                            
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'5',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail5")
               LET g_current_page = 5
               #顯示單身筆數
               CALL adbt510_idx_chk()
               #add-point:page5自定義行為 name="ui_dialog.body5.before_display"
               CALL DIALOG.setCellAttributes(g_xmeg5_d_color)                                                                           
               #end add-point
      
            #自訂ACTION(detail_show,page_5)
            
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_adbt510_03
            LET g_action_choice="open_adbt510_03"
            IF cl_auth_chk_act("open_adbt510_03") THEN
               
               #add-point:ON ACTION open_adbt510_03 name="menu.detail_show.page5.open_adbt510_03"
               
               #END add-point
               
            END IF
 
 
 
 
         
            #add-point:page5自定義行為 name="ui_dialog.body5.action"
                                                                        
            #end add-point
         
         END DISPLAY
 
         
 
         
         #add-point:ui_dialog段自定義display array name="ui_dialog.more_displayarray"
         #170207-00004#2 170219 by 02749 mark---(S)
         #DISPLAY ARRAY g_xmeg2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
         #
         #   BEFORE ROW
         #      CALL adbt510_idx_chk()
         #      LET l_ac = DIALOG.getCurrentRow("s_detail2")
         #      LET g_detail_idx = l_ac
         #      
         #   BEFORE DISPLAY
         #      CALL FGL_SET_ARR_CURR(g_detail_idx)
         #      LET l_ac = DIALOG.getCurrentRow("s_detail2")
         #      LET g_current_page = 6
         #      CALL adbt510_idx_chk()
         #      CALL adbt510_b_fill()
         #      CALL adbt510_show()  
         #      
         #   ON ACTION open_adbt510_03
         #      LET g_action_choice="open_adbt510_03"
         #      IF cl_auth_chk_act("open_adbt510_03") THEN
         #         IF l_ac > 0 THEN
         #            IF NOT cl_null(g_xmeg7_d[l_ac].rtieseq) THEN
         #               CALL adbt510_03(g_xmee_m.xmeedocno,g_xmeg7_d[l_ac].rtieseq,g_xmee_m.xmee900,'','','','')
         #               RETURNING g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
         #               DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
         #               IF NOT cl_null(g_xmeg4_d[l_ac].xmjb031) AND NOT cl_null(g_xmeg4_d[l_ac].xmjb032) THEN
         #                  UPDATE xmjb_t
         #                     SET xmjb031 = g_xmeg4_d[l_ac].xmjb031,
         #                         xmjb032 = g_xmeg4_d[l_ac].xmjb032,
         #                         xmjb901 = '2'
         #                   WHERE xmjbent = g_enterprise
         #                     AND xmjbdocno = g_xmee_m.xmeedocno
         #                     AND xmjbseq = g_xmeg7_d[l_ac].rtieseq
         #                     AND xmjb900 = g_xmee_m.xmee900
         #               END IF
         #               CALL s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg7_d[l_ac].rtieseq,g_xmee_m.xmee900) RETURNING l_success 
         #            END IF
         #         END IF
         #         EXIT DIALOG
         #      END IF      
         #END DISPLAY  
         #170207-00004#2 170219 by 02749 mark---(E)
         
         DISPLAY ARRAY g_xmeg7_d TO s_detail7.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               CALL adbt510_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail7")
               LET g_detail_idx = l_ac
               
            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac = DIALOG.getCurrentRow("s_detail7")
               LET g_current_page = 6
               CALL adbt510_idx_chk()
               CALL adbt510_b_fill()
               CALL adbt510_show()  
               
            ON ACTION open_adbt510_03
               LET g_action_choice="open_adbt510_03"
               IF cl_auth_chk_act("open_adbt510_03") THEN
                  IF l_ac > 0 THEN
                     IF NOT cl_null(g_xmeg7_d[l_ac].rtieseq) THEN
                        CALL adbt510_03(g_xmee_m.xmeedocno,g_xmeg7_d[l_ac].rtieseq,g_xmee_m.xmee900,'','','','')
                        RETURNING g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                        DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
                        IF NOT cl_null(g_xmeg4_d[l_ac].xmjb031) AND NOT cl_null(g_xmeg4_d[l_ac].xmjb032) THEN
                           UPDATE xmjb_t
                              SET xmjb031 = g_xmeg4_d[l_ac].xmjb031,
                                  xmjb032 = g_xmeg4_d[l_ac].xmjb032,
                                  xmjb901 = '2'
                            WHERE xmjbent = g_enterprise
                              AND xmjbdocno = g_xmee_m.xmeedocno
                              AND xmjbseq = g_xmeg7_d[l_ac].rtieseq
                              AND xmjb900 = g_xmee_m.xmee900
                        END IF
                        CALL s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg7_d[l_ac].rtieseq,g_xmee_m.xmee900) RETURNING l_success 
                     END IF
                  END IF
                  EXIT DIALOG
               END IF      
         END DISPLAY                                             
         #end add-point
         
         SUBDIALOG lib_cl_dlg.cl_dlg_qryplan
         SUBDIALOG lib_cl_dlg.cl_dlg_relateapps
      
         BEFORE DIALOG
            #先填充browser資料
            CALL adbt510_browser_fill("")
            CALL cl_notice()
            CALL cl_navigator_setting(g_current_idx, g_detail_cnt)
            LET g_curr_diag = ui.DIALOG.getCurrent()
            LET g_current_sw = FALSE
            #回歸舊筆數位置 (回到當時異動的筆數)
            LET g_current_idx = DIALOG.getCurrentRow("s_browse")
            IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
               CALL DIALOG.setCurrentRow("s_browse",g_current_row)
               LET g_current_idx = g_current_row
            END IF
            
            #確保g_current_idx位於正常區間內
            #小於,等於0則指到第1筆
            IF g_current_idx <= 0 THEN
               LET g_current_idx = 1
            END IF
            #超過最大筆數則指到最後1筆
            IF g_current_idx > g_browser.getLength() THEN
               LEt g_current_idx = g_browser.getLength()
            END IF 
            
            LET g_current_sw = TRUE
            LET g_current_row = g_current_idx #目前指標
            
            #有資料才進行fetch
            IF g_current_idx <> 0 THEN
               CALL adbt510_fetch('') # reload data
            END IF
            #LET g_detail_idx = 1
            CALL adbt510_ui_detailshow() #Setting the current row 
            
            #筆數顯示
            LET g_current_page = 1
            CALL adbt510_idx_chk()
            CALL cl_ap_performance_cal()
            #add-point:ui_dialog段before_dialog2 name="ui_dialog.before_dialog2"
            IF lb_first THEN
               LET lb_first = FALSE   
            END IF
            NEXT FIELD xmjbseq
            #end add-point
 
         #add-point:ui_dialog段more_action name="ui_dialog.more_action"
         
         #end add-point
 
         #狀態碼切換
         ON ACTION statechange
            LET g_action_choice = "statechange"
            CALL adbt510_statechange()
            #根據資料狀態切換action狀態
            CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
            CALL adbt510_set_act_visible()   
            CALL adbt510_set_act_no_visible()
            IF NOT (g_xmee_m.xmeedocno IS NULL
              OR g_xmee_m.xmee900 IS NULL
 
              ) THEN
               #組合條件
               LET g_add_browse = " xmeeent = " ||g_enterprise|| " AND",
                                  " xmeedocno = '", g_xmee_m.xmeedocno, "' "
                                  ," AND xmee900 = '", g_xmee_m.xmee900, "' "
 
               #填到對應位置
               CALL adbt510_browser_fill("")
            END IF
         #應用 a32 樣板自動產生(Version:3)
         #簽核狀況
         ON ACTION bpm_status
            #查詢簽核狀況, 統一建立HyperLink
            CALL cl_bpm_status()
            #add-point:ON ACTION bpm_status name="menu.bpm_status"
            
            #END add-point
 
 
 
          
         #查詢方案選擇 
         ON ACTION queryplansel
            CALL cl_dlg_qryplan_select() RETURNING ls_wc
            #不是空條件才寫入g_wc跟重新找資料
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
               INITIALIZE g_wc2_table3 TO NULL
 
               INITIALIZE g_wc2_table4 TO NULL
 
               INITIALIZE g_wc2_table5 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "xmee_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "xmeg_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "rtic_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "xmeh_t" 
                        LET g_wc2_table3 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "xmjb_t" 
                        LET g_wc2_table4 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "xmef_t" 
                        LET g_wc2_table5 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
                  OR NOT cl_null(g_wc2_table2)
 
                  OR NOT cl_null(g_wc2_table3)
 
                  OR NOT cl_null(g_wc2_table4)
 
                  OR NOT cl_null(g_wc2_table5)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  #組合g_wc2
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
                  IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
                  END IF
 
                  IF g_wc2_table4 <> " 1=1" AND NOT cl_null(g_wc2_table4) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table4
                  END IF
 
                  IF g_wc2_table5 <> " 1=1" AND NOT cl_null(g_wc2_table5) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table5
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
 
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
               END IF
               CALL adbt510_browser_fill("F")   #browser_fill()會將notice區塊清空
               CALL cl_notice()   #重新顯示,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            END IF
         
         #查詢方案選擇
         ON ACTION qbe_select
            CALL cl_qbe_list("m") RETURNING ls_wc
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
               INITIALIZE g_wc2_table3 TO NULL
 
               INITIALIZE g_wc2_table4 TO NULL
 
               INITIALIZE g_wc2_table5 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "xmee_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "xmeg_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "rtic_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "xmeh_t" 
                        LET g_wc2_table3 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "xmjb_t" 
                        LET g_wc2_table4 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "xmef_t" 
                        LET g_wc2_table5 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1)
                  OR NOT cl_null(g_wc2_table2)
 
                  OR NOT cl_null(g_wc2_table3)
 
                  OR NOT cl_null(g_wc2_table4)
 
                  OR NOT cl_null(g_wc2_table5)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
                  IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
                  END IF
 
                  IF g_wc2_table4 <> " 1=1" AND NOT cl_null(g_wc2_table4) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table4
                  END IF
 
                  IF g_wc2_table5 <> " 1=1" AND NOT cl_null(g_wc2_table5) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table5
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
                  #取得條件後需要重查、跳到結果第一筆資料的功能程式段
                  CALL adbt510_browser_fill("F")
                  IF g_browser_cnt = 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code = "-100" 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     CLEAR FORM
                  ELSE
                     CALL adbt510_fetch("F")
                  END IF
               END IF
            END IF
            #重新搜尋會將notice區塊清空,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            CALL cl_notice()
          
         #應用 a49 樣板自動產生(Version:4)
            #過濾瀏覽頁資料
            ON ACTION filter
               LET g_action_choice = "fetch"
               #add-point:filter action name="ui_dialog.action.filter"
               
               #end add-point
               CALL adbt510_filter()
               EXIT DIALOG
 
 
 
         
         ON ACTION first
            LET g_action_choice = "fetch"
            CALL adbt510_fetch('F')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL adbt510_idx_chk()
            
         ON ACTION previous
            LET g_action_choice = "fetch"
            CALL adbt510_fetch('P')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL adbt510_idx_chk()
            
         ON ACTION jump
            LET g_action_choice = "fetch"
            CALL adbt510_fetch('/')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL adbt510_idx_chk()
            
         ON ACTION next
            LET g_action_choice = "fetch"
            CALL adbt510_fetch('N')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL adbt510_idx_chk()
            
         ON ACTION last
            LET g_action_choice = "fetch"
            CALL adbt510_fetch('L')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL adbt510_idx_chk()
          
         #excel匯出功能          
         ON ACTION exporttoexcel
            LET g_action_choice="exporttoexcel"
            IF cl_auth_chk_act("exporttoexcel") THEN
               #browser
               CALL g_export_node.clear()
               IF g_main_hidden = 1 THEN
                  LET g_export_node[1] = base.typeInfo.create(g_browser)
                  LET g_export_id[1]   = "s_browse"
                  CALL cl_export_to_excel()
               #非browser
               ELSE
                  LET g_export_node[1] = base.typeInfo.create(g_xmeg_d)
                  LET g_export_id[1]   = "s_detail1"
                  LET g_export_node[2] = base.typeInfo.create(g_xmeg2_d)
                  LET g_export_id[2]   = "s_detail2"
                  LET g_export_node[3] = base.typeInfo.create(g_xmeg3_d)
                  LET g_export_id[3]   = "s_detail3"
                  LET g_export_node[4] = base.typeInfo.create(g_xmeg4_d)
                  LET g_export_id[4]   = "s_detail4"
                  LET g_export_node[5] = base.typeInfo.create(g_xmeg5_d)
                  LET g_export_id[5]   = "s_detail5"
 
                  #add-point:ON ACTION exporttoexcel name="menu.exporttoexcel"
                  #ken---add---s 需求單號：150107-00009 項次：4
                  LET g_export_node[5] = base.typeInfo.create(g_xmeg7_d)
                  LET g_export_id[5]   = "s_detail7"
                  LET g_export_node[6] = base.typeInfo.create(g_xmeg2_d)
                  LET g_export_id[6]   = "s_detail2"
                  #ken---add---e
                  #END add-point
                  CALL cl_export_to_excel_getpage()
                  CALL cl_export_to_excel()
               END IF
            END IF
        
         ON ACTION close
            LET INT_FLAG = FALSE
            LET g_action_choice = "exit"
            EXIT DIALOG
          
         ON ACTION exit
            LET g_action_choice = "exit"
            EXIT DIALOG
    
         #主頁摺疊
         ON ACTION mainhidden       
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
               CALL cl_notice()
            END IF
            
         #瀏覽頁折疊
         ON ACTION worksheethidden   
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF
            IF lb_first THEN
               LET lb_first = FALSE
               NEXT FIELD xmegseq
            END IF
       
         #單頭摺疊，可利用hot key "Alt-s"開啟/關閉單頭
         ON ACTION controls     
            IF g_header_hidden THEN
               CALL gfrm_curr.setElementHidden("vb_master",0)
               CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
               LET g_header_hidden = 0     #visible
            ELSE
               CALL gfrm_curr.setElementHidden("vb_master",1)
               CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
               LET g_header_hidden = 1     #hidden     
            END IF
    
         
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL adbt510_modify()
               #add-point:ON ACTION modify name="menu.modify"
               #160818-00017#6 -s by 08172
               CALL adbt510_set_act_visible()
               CALL adbt510_set_act_no_visible()
               #160818-00017#6 -e by 08172                                                                            
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify_detail
            LET g_action_choice="modify_detail"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = g_curr_diag.getCurrentItem()
               CALL adbt510_modify()
               #add-point:ON ACTION modify_detail name="menu.modify_detail"
               #160818-00017#6 -s by 08172
               CALL adbt510_set_act_visible()
               CALL adbt510_set_act_no_visible()
               #160818-00017#6 -e by 08172                                                                             
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_xmef_w
            LET g_action_choice="open_xmef_w"
            IF cl_auth_chk_act("open_xmef_w") THEN
               
               #add-point:ON ACTION open_xmef_w name="menu.open_xmef_w"
               CALL adbt510_open_xmef()
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL adbt510_delete()
               #add-point:ON ACTION delete name="menu.delete"
               #160818-00017#6 -s by 08172
               CALL adbt510_set_act_visible()
               CALL adbt510_set_act_no_visible()
               #160818-00017#6 -e by 08172                                                                             
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL adbt510_insert()
               #add-point:ON ACTION insert name="menu.insert"
                                                                                          
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output name="menu.output"
                                                                                          
               #END add-point
               &include "erp/adb/adbt510_rep.4gl"
               #add-point:ON ACTION output.after name="menu.after_output"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION quickprint
            LET g_action_choice="quickprint"
            IF cl_auth_chk_act("quickprint") THEN
               
               #add-point:ON ACTION quickprint name="menu.quickprint"
                                                                                          
               #END add-point
               &include "erp/adb/adbt510_rep.4gl"
               #add-point:ON ACTION quickprint.after name="menu.after_quickprint"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL adbt510_query()
               #add-point:ON ACTION query name="menu.query"
                                                                                          
               #END add-point
               #應用 a59 樣板自動產生(Version:3)  
               CALL g_curr_diag.setCurrentRow("s_detail1",1)
               CALL g_curr_diag.setCurrentRow("s_detail2",1)
               CALL g_curr_diag.setCurrentRow("s_detail3",1)
               CALL g_curr_diag.setCurrentRow("s_detail4",1)
               CALL g_curr_diag.setCurrentRow("s_detail5",1)
 
 
 
 
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION prog_adbt600
            LET g_action_choice="prog_adbt600"
            IF cl_auth_chk_act("prog_adbt600") THEN
               
               #add-point:ON ACTION prog_adbt600 name="menu.prog_adbt600"
               #應用 a41 樣板自動產生(Version:2)
               #使用JSON格式組合參數與作業編號(串查)
               #150409-00006#3 20150828 s983961 add(s)
               INITIALIZE la_param.* TO NULL
               LET la_param.prog     = 'adbt600'
               LET la_param.param[2] = g_xmee_m.xmee008
               LET ls_js = util.JSON.stringify(la_param)
               CALL cl_cmdrun_wait(ls_js)
               #150409-00006#3 20150828 s983961 add(e)
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION prog_xmee002
            LET g_action_choice="prog_xmee002"
            IF cl_auth_chk_act("prog_xmee002") THEN
               
               #add-point:ON ACTION prog_xmee002 name="menu.prog_xmee002"
               #應用 a45 樣板自動產生(Version:2)
               CALL cl_user_contact("aooi130", "ooag_t", "ooag002", "ooag001",g_xmee_m.xmee002)
 


               #END add-point
               
            END IF
 
 
 
 
         
         #應用 a46 樣板自動產生(Version:3)
         #新增相關文件
         ON ACTION related_document
            CALL adbt510_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document name="ui_dialog.dialog.related_document"
               
               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL adbt510_set_pk_array()
            #add-point:ON ACTION agendum name="ui_dialog.dialog.agendum"
            
            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL adbt510_set_pk_array()
            #add-point:ON ACTION followup name="ui_dialog.dialog.followup"
            
            #END add-point
            CALL cl_user_overview_follow(g_xmee_m.xmeedocdt)
 
 
 
         
         #主選單用ACTION
         &include "main_menu_exit_dialog.4gl"
         &include "relating_action.4gl"
    
         #交談指令共用ACTION
         &include "common_action.4gl" 
            CONTINUE DIALOG
      END DIALOG
 
      #(ver:79) ---add start---
      #add-point:ui_dialog段 after dialog name="ui_dialog.exit_dialog"
      
      #end add-point
      #(ver:79) --- add end ---
    
      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         #add-point:ui_dialog段離開dialog前 name="ui_dialog.b_exit"
         
         #end add-point
         EXIT WHILE
      END IF
    
   END WHILE    
      
   CALL cl_set_act_visible("accept,cancel", TRUE)
    
END FUNCTION
 
{</section>}
 
{<section id="adbt510.browser_fill" >}
#+ 瀏覽頁簽資料填充
PRIVATE FUNCTION adbt510_browser_fill(ps_page_action)
   #add-point:browser_fill段define(客製用) name="browser_fill.define_customerization"
   
   #end add-point  
   DEFINE ps_page_action    STRING
   DEFINE l_wc              STRING
   DEFINE l_wc2             STRING
   DEFINE l_sql             STRING
   DEFINE l_sub_sql         STRING
   DEFINE l_sql_rank        STRING
   #add-point:browser_fill段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="browser_fill.define"
   DEFINE l_where           STRING               
   #end add-point    
   
   #add-point:Function前置處理 name="browser_fill.before_browser_fill"
   LET l_where = s_aooi500_sql_where(g_prog,'xmeesite')
   #end add-point
   
   IF cl_null(g_wc) THEN
      LET g_wc = " 1=1"
   END IF
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   LET l_wc  = g_wc.trim() 
   LET l_wc2 = g_wc2.trim()
 
   #add-point:browser_fill,foreach前 name="browser_fill.before_foreach"

   IF cl_null(g_wc) THEN
      #LET g_wc = " xmeesite = '",g_site,"' AND xmee005 IN ('1','2','3','6') AND xmee007 IN ('1','5') "
      LET g_wc = " AND xmee005 IN ('1','2','3','6') AND xmee007 IN ('1','5') "
   ELSE
      #LET g_wc = g_wc," AND xmeesite = '",g_site,"'  AND xmee005 IN ('1','2','3','6') AND xmee007 IN ('1','5') "
      LET g_wc = g_wc," AND xmee005 IN ('1','2','3','6') AND xmee007 IN ('1','5') "
   END IF
   LET l_wc  = g_wc.trim()  

   #160815-00016#1 160817 by 02749 add---(S)
   IF NOT cl_null(g_slip_wc1) THEN
      LET g_wc = g_wc," AND ",g_slip_wc1
      LET l_wc  = g_wc.trim()
   END IF
   #160815-00016#1 160817 by 02749 add---(E)
   #end add-point
   
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件                      
      LET l_sub_sql = " SELECT DISTINCT xmeedocno,xmee900 ",
                      " FROM xmee_t ",
                      " ",
                      " LEFT JOIN xmeg_t ON xmegent = xmeeent AND xmeedocno = xmegdocno AND xmee900 = xmeg900 ", "  ",
                      #add-point:browser_fill段sql(xmeg_t1) name="browser_fill.cnt.join.}"
                      
                      #end add-point
                      " LEFT JOIN rtic_t ON rticent = xmeeent AND xmeedocno = rticdocno", "  ",
                      #add-point:browser_fill段sql(rtic_t1) name="browser_fill.cnt.join.rtic_t1"
                      
                      #end add-point
 
                      " LEFT JOIN xmeh_t ON xmehent = xmeeent AND xmeedocno = xmehdocno AND xmee900 = xmeh900", "  ",
                      #add-point:browser_fill段sql(xmeh_t1) name="browser_fill.cnt.join.xmeh_t1"
                      
                      #end add-point
 
                      " LEFT JOIN xmjb_t ON xmjbent = xmeeent AND xmeedocno = xmjbdocno AND xmee900 = xmjb900", "  ",
                      #add-point:browser_fill段sql(xmjb_t1) name="browser_fill.cnt.join.xmjb_t1"
                      
                      #end add-point
 
                      " LEFT JOIN xmef_t ON xmefent = xmeeent AND xmeedocno = xmefdocno AND xmee900 = xmef900", "  ",
                      #add-point:browser_fill段sql(xmef_t1) name="browser_fill.cnt.join.xmef_t1"
                      
                      #end add-point
 
 
 
                      " ", 
                      " ", 
                      " ",                      
 
                      " ",                      
 
                      " ",                      
 
                      " ",                      
 
 
 
                      " WHERE xmeeent = " ||g_enterprise|| " AND xmegent = " ||g_enterprise|| " AND ",l_wc, " AND ", l_wc2, cl_sql_add_filter("xmee_t")
   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT DISTINCT xmeedocno,xmee900 ",
                      " FROM xmee_t ", 
                      "  ",
                      "  ",
                      " WHERE xmeeent = " ||g_enterprise|| " AND ",l_wc CLIPPED, cl_sql_add_filter("xmee_t")
   END IF
   
   #add-point:browser_fill,cnt wc name="browser_fill.cnt_sqlwc"
   #170207-00004#2 170219 by 02749 mark---(S)
   # rtic_t 已透過程式樣板產生組入SQL,無須覆寫 l_sub_sql
   #IF g_wc2 <> " 1=1" THEN
   #   LET l_sub_sql = " SELECT UNIQUE xmeedocno,xmee900 ",
   #                   " FROM xmee_t ",
   #                   " LEFT JOIN xmeg_t ON xmegent = xmeeent AND xmeedocno = xmegdocno AND xmee900 = xmeg900 ",
   #                   " LEFT JOIN xmeh_t ON xmehent = xmeeent AND xmeedocno = xmehdocno AND xmee900 = xmeh900", 
   #                   " LEFT JOIN xmjb_t ON xmjbent = xmeeent AND xmeedocno = xmjbdocno AND xmee900 = xmjb900", 
   #                   " LEFT JOIN xmef_t ON xmefent = xmeeent AND xmeedocno = xmefdocno AND xmee900 = xmef900", 
   #                   " LEFT JOIN rtic_t ON rticent = xmeeent AND xmeedocno = rticdocno", 
   #                   " WHERE xmeeent = '" ||g_enterprise|| "'",
   #                   "   AND xmegent = '" ||g_enterprise|| "'",
   #                   "   AND ",l_wc, 
   #                   "   AND ", l_wc2, cl_sql_add_filter("xmee_t")
   #ELSE
   #   #單身未輸入搜尋條件
   #   LET l_sub_sql = " SELECT UNIQUE xmeedocno,xmee900 ",
   #                   " FROM xmee_t ", 
   #                   " WHERE xmeeent = '" ||g_enterprise|| "' AND ",l_wc CLIPPED, cl_sql_add_filter("xmee_t")
   #END IF
   #170207-000 04#2 170219 by 02749 mark---(E)
   
   LET l_sub_sql = l_sub_sql CLIPPED," AND ",l_where
   #end add-point
   
   LET g_sql = " SELECT COUNT(1) FROM (",l_sub_sql,")"
   
   #add-point:browser_fill,count前 name="browser_fill.before_count"
                  
   #end add-point
   
   IF g_sql.getIndexOf(" 1=2",1) THEN
      DISPLAY "INFO: 1=2 jumped!"
   ELSE
      PREPARE header_cnt_pre FROM g_sql
      EXECUTE header_cnt_pre INTO g_browser_cnt   #總筆數
      FREE header_cnt_pre
   END IF
    
   IF g_browser_cnt > g_max_browse THEN
      IF g_error_show = 1 THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_browser_cnt
         LET g_errparam.code = 9035 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
      END IF
      LET g_browser_cnt = g_max_browse
   END IF
   
   DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
   DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
 
   #根據行為確定資料填充位置及WC
   IF cl_null(g_add_browse) THEN
      #清除畫面
      CLEAR FORM                
      INITIALIZE g_xmee_m.* TO NULL
      CALL g_xmeg_d.clear()        
      CALL g_xmeg2_d.clear() 
      CALL g_xmeg3_d.clear() 
      CALL g_xmeg4_d.clear() 
      CALL g_xmeg5_d.clear() 
 
      #add-point:browser_fill g_add_browse段額外處理 name="browser_fill.add_browse.other"
      
      #end add-point   
      CALL g_browser.clear()
      LET g_cnt = 1
   ELSE
      LET l_wc  = g_add_browse
      LET l_wc2 = " 1=1" 
      LET g_cnt = g_current_idx
   END IF
 
   #依照t0.xmeedocno,t0.xmee900,t0.xmeedocdt,t0.xmee001,t0.xmee002,t0.xmee003,t0.xmee004 Browser欄位定義(取代原本bs_sql功能)
   #考量到單身可能下條件, 所以此處需join單身所有table
   #DISTINCT是為了避免在join時出現重複的資料(如果不加DISTINCT則須在程式中過濾)
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件   
      LET g_sql = " SELECT DISTINCT t0.xmeestus,t0.xmeedocno,t0.xmee900,t0.xmeedocdt,t0.xmee001,t0.xmee002, 
          t0.xmee003,t0.xmee004,t1.ooag011 ,t2.ooefl003 ,t3.pmaal004 ",
                  " FROM xmee_t t0",
                  "  ",
                  "  LEFT JOIN xmeg_t ON xmegent = xmeeent AND xmeedocno = xmegdocno AND xmee900 = xmeg900 ", "  ", 
                  #add-point:browser_fill段sql(xmeg_t1) name="browser_fill.join.xmeg_t1"
                  
                  #end add-point
                  "  LEFT JOIN rtic_t ON rticent = xmeeent AND xmeedocno = rticdocno", "  ", 
                  #add-point:browser_fill段sql(rtic_t1) name="browser_fill.join.rtic_t1"
                  
                  #end add-point
 
                  "  LEFT JOIN xmeh_t ON xmehent = xmeeent AND xmeedocno = xmehdocno AND xmee900 = xmeh900", "  ", 
                  #add-point:browser_fill段sql(xmeh_t1) name="browser_fill.join.xmeh_t1"
                  
                  #end add-point
 
                  "  LEFT JOIN xmjb_t ON xmjbent = xmeeent AND xmeedocno = xmjbdocno AND xmee900 = xmjb900", "  ", 
                  #add-point:browser_fill段sql(xmjb_t1) name="browser_fill.join.xmjb_t1"
                  
                  #end add-point
 
                  "  LEFT JOIN xmef_t ON xmefent = xmeeent AND xmeedocno = xmefdocno AND xmee900 = xmef900", "  ", 
                  #add-point:browser_fill段sql(xmef_t1) name="browser_fill.join.xmef_t1"
                  
                  #end add-point
 
 
 
                  " ", 
                  " ",                      
 
                  " ",                      
 
                  " ",                      
 
                  " ",                      
 
 
 
                                 " LEFT JOIN ooag_t t1 ON t1.ooagent="||g_enterprise||" AND t1.ooag001=t0.xmee002  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.xmee003 AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t3 ON t3.pmaalent="||g_enterprise||" AND t3.pmaal001=t0.xmee004 AND t3.pmaal002='"||g_dlang||"' ",
 
                  " WHERE t0.xmeeent = " ||g_enterprise|| " AND ",l_wc," AND ",l_wc2, cl_sql_add_filter("xmee_t")
   ELSE
      #單身無輸入搜尋條件   
      LET g_sql = " SELECT DISTINCT t0.xmeestus,t0.xmeedocno,t0.xmee900,t0.xmeedocdt,t0.xmee001,t0.xmee002, 
          t0.xmee003,t0.xmee004,t1.ooag011 ,t2.ooefl003 ,t3.pmaal004 ",
                  " FROM xmee_t t0",
                  "  ",
                                 " LEFT JOIN ooag_t t1 ON t1.ooagent="||g_enterprise||" AND t1.ooag001=t0.xmee002  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.xmee003 AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t3 ON t3.pmaalent="||g_enterprise||" AND t3.pmaal001=t0.xmee004 AND t3.pmaal002='"||g_dlang||"' ",
 
                  " WHERE t0.xmeeent = " ||g_enterprise|| " AND ",l_wc, cl_sql_add_filter("xmee_t")
   END IF
   #add-point:browser_fill,sql wc name="browser_fill.fill_sqlwc"
   #170207-00004#2 170219 by 02749 mark---(S)
   # rtic_t 已透過程式樣板產生組入SQL,無須覆寫 g_sql
   #LET g_sql = " SELECT DISTINCT t0.xmeestus,t0.xmeedocno,t0.xmee900,t0.xmeedocdt,t0.xmee001,",
   #            "                 t0.xmee002, t0.xmee003,  t0.xmee004,t1.ooag011,  t2.ooefl003,",
   #            "                 t3.pmaal004 ",
   #            " FROM xmee_t t0",
   #            " LEFT JOIN xmeg_t ON xmegent = xmeeent AND xmeedocno = xmegdocno AND xmee900 = xmeg900 ",
   #            " LEFT JOIN xmeh_t ON xmehent = xmeeent AND xmeedocno = xmehdocno AND xmee900 = xmeh900",
   #            " LEFT JOIN xmjb_t ON xmjbent = xmeeent AND xmeedocno = xmjbdocno AND xmee900 = xmjb900",
   #            " LEFT JOIN xmef_t ON xmefent = xmeeent AND xmeedocno = xmefdocno AND xmee900 = xmef900",
   #            " LEFT JOIN rtic_t ON rticent = xmeeent AND xmeedocno = rticdocno", 
   #            " LEFT JOIN ooag_t t1 ON t1.ooagent='"||g_enterprise||"' AND t1.ooag001=t0.xmee002  ",
   #            " LEFT JOIN ooefl_t t2 ON t2.ooeflent='"||g_enterprise||"' AND t2.ooefl001=t0.xmee003 AND t2.ooefl002='"||g_lang||"' ",
   #            " LEFT JOIN pmaal_t t3 ON t3.pmaalent='"||g_enterprise||"' AND t3.pmaal001=t0.xmee004 AND t3.pmaal002='"||g_lang||"' ",
   #            " WHERE t0.xmeeent = '" ||g_enterprise|| "' AND ",l_wc," AND ",l_wc2, cl_sql_add_filter("xmee_t")
   #170207-00004#2 170219 by 02749 mark---(E)
   
   LET g_sql = g_sql CLIPPED," AND ",l_where
   #end add-point
   LET g_sql = g_sql, " ORDER BY xmeedocno,xmee900 ",g_order
 
   #add-point:browser_fill,before_prepare name="browser_fill.before_prepare"
                  
   #end add-point
        
   #LET g_sql = cl_sql_add_tabid(g_sql,"xmee_t") #WC重組
   LET g_sql = cl_sql_add_mask(g_sql) #遮蔽特定資料
   
   IF g_sql.getIndexOf(" 1=2",1) THEN
      DISPLAY "INFO: 1=2 jumped!"
   ELSE
      PREPARE browse_pre FROM g_sql
      DECLARE browse_cur CURSOR FOR browse_pre
      
      #add-point:browser_fill段open cursor name="browser_fill.open"
                  
      #end add-point
      
      FOREACH browse_cur INTO g_browser[g_cnt].b_statepic,g_browser[g_cnt].b_xmeedocno,g_browser[g_cnt].b_xmee900, 
          g_browser[g_cnt].b_xmeedocdt,g_browser[g_cnt].b_xmee001,g_browser[g_cnt].b_xmee002,g_browser[g_cnt].b_xmee003, 
          g_browser[g_cnt].b_xmee004,g_browser[g_cnt].b_xmee002_desc,g_browser[g_cnt].b_xmee003_desc, 
          g_browser[g_cnt].b_xmee004_desc
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "Foreach:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
      
         #add-point:browser_fill段reference name="browser_fill.reference"
                                    
         #end add-point
      
         #遮罩相關處理
         CALL adbt510_browser_mask()
      
               #應用 a24 樣板自動產生(Version:3)
      #browser顯示圖片
      CASE g_browser[g_cnt].b_statepic
         WHEN "N"
            LET g_browser[g_cnt].b_statepic = "stus/16/unconfirmed.png"
         WHEN "Y"
            LET g_browser[g_cnt].b_statepic = "stus/16/confirmed.png"
         WHEN "A"
            LET g_browser[g_cnt].b_statepic = "stus/16/approved.png"
         WHEN "D"
            LET g_browser[g_cnt].b_statepic = "stus/16/withdraw.png"
         WHEN "R"
            LET g_browser[g_cnt].b_statepic = "stus/16/rejection.png"
         WHEN "W"
            LET g_browser[g_cnt].b_statepic = "stus/16/signing.png"
         WHEN "X"
            LET g_browser[g_cnt].b_statepic = "stus/16/invalid.png"
         
      END CASE
 
 
 
         LET g_cnt = g_cnt + 1
         IF g_cnt > g_max_browse THEN
            EXIT FOREACH
         END IF
         
      END FOREACH
      FREE browse_pre
   END IF
   
   #清空g_add_browse, 並指定指標位置
   IF NOT cl_null(g_add_browse) THEN
      LET g_add_browse = ""
      CALL g_curr_diag.setCurrentRow("s_browse",g_current_idx)
   END IF
   
   IF cl_null(g_browser[g_cnt].b_xmeedocno) THEN
      CALL g_browser.deleteElement(g_cnt)
   END IF
   
   LET g_header_cnt  = g_browser.getLength()
   LET g_browser_cnt = g_browser.getLength()
   
   #筆數顯示
   IF g_browser_cnt > 0 THEN
      DISPLAY g_browser_idx TO FORMONLY.b_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.b_count #總筆數
      DISPLAY g_browser_idx TO FORMONLY.h_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.h_count #總筆數
      DISPLAY g_detail_idx  TO FORMONLY.idx     #單身當下筆數
      DISPLAY g_detail_cnt  TO FORMONLY.cnt     #單身總筆數
   ELSE
      DISPLAY '' TO FORMONLY.b_index #當下筆數
      DISPLAY '' TO FORMONLY.b_count #總筆數
      DISPLAY '' TO FORMONLY.h_index #當下筆數
      DISPLAY '' TO FORMONLY.h_count #總筆數
      DISPLAY '' TO FORMONLY.idx     #單身當下筆數
      DISPLAY '' TO FORMONLY.cnt     #單身總筆數
   END IF
 
   LET g_rec_b = g_cnt - 1
   LET g_detail_cnt = g_rec_b
   LET g_cnt = 0
 
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
                  
   
   #add-point:browser_fill段結束前 name="browser_fill.after"
                  
   #end add-point   
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.ui_headershow" >}
#+ 單頭資料重新顯示
PRIVATE FUNCTION adbt510_ui_headershow()
   #add-point:ui_headershow段define(客製用) name="ui_headershow.define_customerization"
   
   #end add-point  
   #add-point:ui_headershow段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_headershow.define"
                  
   #end add-point      
   
   #add-point:Function前置處理  name="ui_headershow.pre_function"
   
   #end add-point
   
   LET g_xmee_m.xmeedocno = g_browser[g_current_idx].b_xmeedocno   
   LET g_xmee_m.xmee900 = g_browser[g_current_idx].b_xmee900   
 
   EXECUTE adbt510_master_referesh USING g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmee_m.xmeesite, 
       g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202, 
       g_xmee_m.xmee023,g_xmee_m.xmee004,g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005, 
       g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
       g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
       g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee204,g_xmee_m.xmee205, 
       g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026, 
       g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049, 
       g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
       g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,g_xmee_m.xmeecrtid, 
       g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017, 
       g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028,g_xmee_m.xmeesite_desc,g_xmee_m.xmee202_desc, 
       g_xmee_m.xmee023_desc,g_xmee_m.xmee004_desc,g_xmee_m.xmee200_desc,g_xmee_m.xmee201_desc,g_xmee_m.xmee024_desc, 
       g_xmee_m.xmee002_desc,g_xmee_m.xmee003_desc,g_xmee_m.xmee021_desc,g_xmee_m.xmee022_desc,g_xmee_m.xmee203_desc, 
       g_xmee_m.xmee027_desc,g_xmee_m.xmee211_desc,g_xmee_m.xmee210_desc,g_xmee_m.xmee209_desc,g_xmee_m.xmee208_desc, 
       g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204_desc,g_xmee_m.xmee032_desc,g_xmee_m.xmee903_desc,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207_desc,g_xmee_m.xmee020_desc,g_xmee_m.xmee036_desc,g_xmee_m.xmee009_desc,g_xmee_m.xmee010_desc, 
       g_xmee_m.xmee015_desc,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid_desc, 
       g_xmee_m.xmeecrtdp_desc,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeecnfid_desc,g_xmee_m.xmee034_desc, 
       g_xmee_m.xmee017_desc,g_xmee_m.xmee018_desc
   
   CALL adbt510_xmee_t_mask()
   CALL adbt510_show()
      
END FUNCTION
 
{</section>}
 
{<section id="adbt510.ui_detailshow" >}
#+ 單身資料重新顯示
PRIVATE FUNCTION adbt510_ui_detailshow()
   #add-point:ui_detailshow段define(客製用) name="ui_detailshow.define_customerization"
   
   #end add-point    
   #add-point:ui_detailshow段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_detailshow.define"
                  
   #end add-point    
 
   #add-point:Function前置處理 name="ui_detailshow.before"
                  
   #end add-point    
   
   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail1",g_detail_idx)      
      CALL g_curr_diag.setCurrentRow("s_detail2",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail3",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail4",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail5",g_detail_idx)
 
   END IF
   
   #add-point:ui_detailshow段after name="ui_detailshow.after"
                  
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.ui_browser_refresh" >}
#+ 瀏覽頁簽資料重新顯示
PRIVATE FUNCTION adbt510_ui_browser_refresh()
   #add-point:ui_browser_refresh段define(客製用) name="ui_browser_refresh.define_customerization"
   
   #end add-point    
   DEFINE l_i  LIKE type_t.num10
   #add-point:ui_browser_refresh段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_browser_refresh.define"
                  
   #end add-point    
   
   #add-point:Function前置處理  name="ui_browser_refresh.pre_function"
   
   #end add-point
   
   LET g_browser_cnt = g_browser.getLength()
   LET g_header_cnt  = g_browser.getLength()
   FOR l_i =1 TO g_browser.getLength()
      IF g_browser[l_i].b_xmeedocno = g_xmee_m.xmeedocno 
         AND g_browser[l_i].b_xmee900 = g_xmee_m.xmee900 
 
         THEN
         CALL g_browser.deleteElement(l_i)
         EXIT FOR
      END IF
   END FOR
   LET g_browser_cnt = g_browser_cnt - 1
   LET g_header_cnt = g_header_cnt - 1
    
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
      CLEAR FORM
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
   
   #add-point:ui_browser_refresh段after name="ui_browser_refresh.after"
   
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.construct" >}
#+ QBE資料查詢
PRIVATE FUNCTION adbt510_construct()
   #add-point:cs段define(客製用) name="cs.define_customerization"
   
   #end add-point    
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING 
   DEFINE ls_wc       STRING 
   DEFINE la_wc       DYNAMIC ARRAY OF RECORD
          tableid     STRING,
          wc          STRING
          END RECORD
   DEFINE li_idx      LIKE type_t.num10
   #add-point:cs段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="cs.define"
   DEFINE l_sql       STRING
   DEFINE l_success   LIKE type_t.num5  
   DEFINE l_pmaa027   LIKE pmaa_t.pmaa027   
   DEFINE l_where     STRING   #160809-00015#1 160829 by 02749 add
   #end add-point    
   
   #add-point:Function前置處理  name="cs.pre_function"
   
   #end add-point
    
   #清除畫面
   CLEAR FORM                
   INITIALIZE g_xmee_m.* TO NULL
   CALL g_xmeg_d.clear()        
   CALL g_xmeg2_d.clear() 
   CALL g_xmeg3_d.clear() 
   CALL g_xmeg4_d.clear() 
   CALL g_xmeg5_d.clear() 
 
   
   LET g_action_choice = ""
    
   INITIALIZE g_wc TO NULL
   INITIALIZE g_wc2 TO NULL
   
   INITIALIZE g_wc2_table1 TO NULL
   INITIALIZE g_wc2_table2 TO NULL
 
   INITIALIZE g_wc2_table3 TO NULL
 
   INITIALIZE g_wc2_table4 TO NULL
 
   INITIALIZE g_wc2_table5 TO NULL
 
 
    
   LET g_qryparam.state = 'c'
   
   #add-point:cs段開始前 name="cs.before_construct"
  #INITIALIZE g_wc2_rtic TO NULL   #170207-00004#2 170219 by 02749 mark
   #end add-point 
   
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      
      #單頭
      CONSTRUCT BY NAME g_wc ON xmeesite,xmee902,xmeedocno,xmee900,xmee901,xmee001,xmee202,xmee023,xmee004, 
          xmee200,xmee201,xmeestus,xmee005,xmee007,xmee008,xmeedocdt,xmee024,xmee002,xmee003,xmeeacti, 
          xmee021,xmee022,xmee203,xmee027,xmee211,xmee210,xmee209,xmee208,xmeeunit,xmee204,xmee205,xmee032, 
          xmee071,xmee903,xmee904,xmee025,xmee025_desc,oofb017,xmee026,xmee026_desc,oofb017_1,xmee206, 
          xmee207,xmee020,xmee036,xmee048,xmee049,xmee009,xmee010,xmee015,xmee016,xmee011,xmee011_desc, 
          xmee012,xmee013,xmee035,xmee035_desc,xmee039,xmeeownid,xmeeowndp,xmeecrtid,xmeecrtdp,xmeecrtdt, 
          xmeemodid,xmeemoddt,xmeecnfid,xmeecnfdt,xmee034,xmee006,xmee017,xmee018,xmee019,xmee028
 
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.head.before_construct"
                                                                        
            #end add-point 
            
         #公用欄位開窗相關處理
         #應用 a11 樣板自動產生(Version:3)
         #共用欄位查詢處理  
         ##----<<xmeecrtdt>>----
         AFTER FIELD xmeecrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
 
         #----<<xmeemoddt>>----
         AFTER FIELD xmeemoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<xmeecnfdt>>----
         AFTER FIELD xmeecnfdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<xmeepstdt>>----
 
 
 
            
         #一般欄位開窗相關處理    
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeesite
            #add-point:BEFORE FIELD xmeesite name="construct.b.xmeesite"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeesite
            
            #add-point:AFTER FIELD xmeesite name="construct.a.xmeesite"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeesite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeesite
            #add-point:ON ACTION controlp INFIELD xmeesite name="construct.c.xmeesite"
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmeesite',g_site,'c') #150308-00001#1  By Ken add 'c' 150309
            CALL q_ooef001_24()
            DISPLAY g_qryparam.return1 TO xmeesite  #顯示到畫面上           
            NEXT FIELD xmeesite                     #返回原欄位                                                     
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee902
            #add-point:BEFORE FIELD xmee902 name="construct.b.xmee902"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee902
            
            #add-point:AFTER FIELD xmee902 name="construct.a.xmee902"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee902
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee902
            #add-point:ON ACTION controlp INFIELD xmee902 name="construct.c.xmee902"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmeedocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeedocno
            #add-point:ON ACTION controlp INFIELD xmeedocno name="construct.c.xmeedocno"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
           #160809-00015#1 160829 by 02749 mark---(S)  
			  ##160815-00016#1 160817 by 02749 add---(S)
           #IF NOT cl_null(g_slip_wc) THEN
           #   LET g_qryparam.where = g_slip_wc
           #END IF
           ##160815-00016#1 160817 by 02749 add---(E)
           #160809-00015#1 160829 by 02749 mark---(E) 

            #160809-00015#1 160829 by 02749 add---(S)
            LET l_where = ""
            LET l_where = s_aooi500_sql_where(g_prog,'xmdasite')
            
            IF NOT cl_null(g_slip_wc) THEN
               LET l_where = l_where," AND ",g_slip_wc
            END IF
            LET g_qryparam.where = l_where
            #160809-00015#1 160829 by 02749 add---(E)           
            
            CALL q_xmdadocno_5()                    
            DISPLAY g_qryparam.return1 TO xmeedocno 
                                                     
            NEXT FIELD xmeedocno 
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeedocno
            #add-point:BEFORE FIELD xmeedocno name="construct.b.xmeedocno"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeedocno
            
            #add-point:AFTER FIELD xmeedocno name="construct.a.xmeedocno"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee900
            #add-point:BEFORE FIELD xmee900 name="construct.b.xmee900"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee900
            
            #add-point:AFTER FIELD xmee900 name="construct.a.xmee900"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee900
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee900
            #add-point:ON ACTION controlp INFIELD xmee900 name="construct.c.xmee900"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee901
            #add-point:BEFORE FIELD xmee901 name="construct.b.xmee901"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee901
            
            #add-point:AFTER FIELD xmee901 name="construct.a.xmee901"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee901
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee901
            #add-point:ON ACTION controlp INFIELD xmee901 name="construct.c.xmee901"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee001
            #add-point:BEFORE FIELD xmee001 name="construct.b.xmee001"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee001
            
            #add-point:AFTER FIELD xmee001 name="construct.a.xmee001"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee001
            #add-point:ON ACTION controlp INFIELD xmee001 name="construct.c.xmee001"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmee202
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee202
            #add-point:ON ACTION controlp INFIELD xmee202 name="construct.c.xmee202"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "G"
            CALL q_ooef001_3()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee202  #顯示到畫面上
            NEXT FIELD xmee202                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee202
            #add-point:BEFORE FIELD xmee202 name="construct.b.xmee202"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee202
            
            #add-point:AFTER FIELD xmee202 name="construct.a.xmee202"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee023
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee023
            #add-point:ON ACTION controlp INFIELD xmee023 name="construct.c.xmee023"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
		      LET g_qryparam.arg1 = "1"
            CALL q_oojd001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee023  #顯示到畫面上

            NEXT FIELD xmee023                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee023
            #add-point:BEFORE FIELD xmee023 name="construct.b.xmee023"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee023
            
            #add-point:AFTER FIELD xmee023 name="construct.a.xmee023"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee004
            #add-point:ON ACTION controlp INFIELD xmee004 name="construct.c.xmee004"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
		   	INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg1 = 'ALL'
            CALL q_pmaa001_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee004        #顯示到畫面上

            NEXT FIELD xmee004                           #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee004
            #add-point:BEFORE FIELD xmee004 name="construct.b.xmee004"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee004
            
            #add-point:AFTER FIELD xmee004 name="construct.a.xmee004"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee200
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee200
            #add-point:ON ACTION controlp INFIELD xmee200 name="construct.c.xmee200"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001_20()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee200  #顯示到畫面上
            NEXT FIELD xmee200                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee200
            #add-point:BEFORE FIELD xmee200 name="construct.b.xmee200"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee200
            
            #add-point:AFTER FIELD xmee200 name="construct.a.xmee200"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee201
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee201
            #add-point:ON ACTION controlp INFIELD xmee201 name="construct.c.xmee201"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001_10()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee201  #顯示到畫面上
            NEXT FIELD xmee201                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee201
            #add-point:BEFORE FIELD xmee201 name="construct.b.xmee201"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee201
            
            #add-point:AFTER FIELD xmee201 name="construct.a.xmee201"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeestus
            #add-point:BEFORE FIELD xmeestus name="construct.b.xmeestus"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeestus
            
            #add-point:AFTER FIELD xmeestus name="construct.a.xmeestus"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeestus
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeestus
            #add-point:ON ACTION controlp INFIELD xmeestus name="construct.c.xmeestus"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee005
            #add-point:BEFORE FIELD xmee005 name="construct.b.xmee005"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee005
            
            #add-point:AFTER FIELD xmee005 name="construct.a.xmee005"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee005
            #add-point:ON ACTION controlp INFIELD xmee005 name="construct.c.xmee005"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee007
            #add-point:BEFORE FIELD xmee007 name="construct.b.xmee007"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee007
            
            #add-point:AFTER FIELD xmee007 name="construct.a.xmee007"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee007
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee007
            #add-point:ON ACTION controlp INFIELD xmee007 name="construct.c.xmee007"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmee008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee008
            #add-point:ON ACTION controlp INFIELD xmee008 name="construct.c.xmee008"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_xmda008()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee008  #顯示到畫面上

            NEXT FIELD xmee008                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee008
            #add-point:BEFORE FIELD xmee008 name="construct.b.xmee008"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee008
            
            #add-point:AFTER FIELD xmee008 name="construct.a.xmee008"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeedocdt
            #add-point:BEFORE FIELD xmeedocdt name="construct.b.xmeedocdt"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeedocdt
            
            #add-point:AFTER FIELD xmeedocdt name="construct.a.xmeedocdt"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeedocdt
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeedocdt
            #add-point:ON ACTION controlp INFIELD xmeedocdt name="construct.c.xmeedocdt"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmee024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee024
            #add-point:ON ACTION controlp INFIELD xmee024 name="construct.c.xmee024"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = "295"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee024  #顯示到畫面上

            NEXT FIELD xmee024                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee024
            #add-point:BEFORE FIELD xmee024 name="construct.b.xmee024"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee024
            
            #add-point:AFTER FIELD xmee024 name="construct.a.xmee024"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee002
            #add-point:ON ACTION controlp INFIELD xmee002 name="construct.c.xmee002"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee002  #顯示到畫面上

            NEXT FIELD xmee002                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee002
            #add-point:BEFORE FIELD xmee002 name="construct.b.xmee002"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee002
            
            #add-point:AFTER FIELD xmee002 name="construct.a.xmee002"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee003
            #add-point:ON ACTION controlp INFIELD xmee003 name="construct.c.xmee003"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = g_xmee_m.xmeedocdt
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee003  #顯示到畫面上

            NEXT FIELD xmee003                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee003
            #add-point:BEFORE FIELD xmee003 name="construct.b.xmee003"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee003
            
            #add-point:AFTER FIELD xmee003 name="construct.a.xmee003"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeeacti
            #add-point:BEFORE FIELD xmeeacti name="construct.b.xmeeacti"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeeacti
            
            #add-point:AFTER FIELD xmeeacti name="construct.a.xmeeacti"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeeacti
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeeacti
            #add-point:ON ACTION controlp INFIELD xmeeacti name="construct.c.xmeeacti"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmee021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee021
            #add-point:ON ACTION controlp INFIELD xmee021 name="construct.c.xmee021"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg2 = 'ALL'
            CALL q_pmac002_5()                       #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee021    #顯示到畫面上
            

            NEXT FIELD xmee021                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee021
            #add-point:BEFORE FIELD xmee021 name="construct.b.xmee021"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee021
            
            #add-point:AFTER FIELD xmee021 name="construct.a.xmee021"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee022
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee022
            #add-point:ON ACTION controlp INFIELD xmee022 name="construct.c.xmee022"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
		      INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg2 = 'ALL'
            CALL q_pmac002_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee022  #顯示到畫面上
               

            NEXT FIELD xmee022                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee022
            #add-point:BEFORE FIELD xmee022 name="construct.b.xmee022"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee022
            
            #add-point:AFTER FIELD xmee022 name="construct.a.xmee022"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee203
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee203
            #add-point:ON ACTION controlp INFIELD xmee203 name="construct.c.xmee203"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #02749  150121  add ----------------------(S)
            #LET g_qryparam.arg1 = g_xmee_m.xmee004
            #LET g_qryparam.arg2 = '3'
            #CALL q_pmac002_9()                    #呼叫開窗
            LET g_qryparam.arg2 = 'ALL'
            CALL q_pmac002_7()
            #02749  150121  add ----------------------(E)
            DISPLAY g_qryparam.return1 TO xmee203  #顯示到畫面上
            NEXT FIELD xmee203                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee203
            #add-point:BEFORE FIELD xmee203 name="construct.b.xmee203"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee203
            
            #add-point:AFTER FIELD xmee203 name="construct.a.xmee203"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee027
            #add-point:BEFORE FIELD xmee027 name="construct.b.xmee027"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee027
            
            #add-point:AFTER FIELD xmee027 name="construct.a.xmee027"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee027
            #add-point:ON ACTION controlp INFIELD xmee027 name="construct.c.xmee027"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			   #INITIALIZE g_qryparam.* TO NULL
            #LET g_qryparam.state = 'c'
			   #LET g_qryparam.reqry = FALSE
			   #LET g_qryparam.arg1 = g_xmee_m.xmee004
            #CALL q_pmaj002()                           #呼叫開窗
            #DISPLAY g_qryparam.return1 TO xmee027  #顯示到畫面上
            #CALL adbt510_xmee027_ref(g_xmee_m.xmee027) RETURNING g_xmee_m.xmee027_desc
            #DISPLAY BY NAME g_xmee_m.xmee027_desc
            #NEXT FIELD xmee027                     #返回原欄位


            #END add-point
 
 
         #Ctrlp:construct.c.xmee211
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee211
            #add-point:ON ACTION controlp INFIELD xmee211 name="construct.c.xmee211"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "1"
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee211  #顯示到畫面上
            NEXT FIELD xmee211                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee211
            #add-point:BEFORE FIELD xmee211 name="construct.b.xmee211"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee211
            
            #add-point:AFTER FIELD xmee211 name="construct.a.xmee211"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee210
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee210
            #add-point:ON ACTION controlp INFIELD xmee210 name="construct.c.xmee210"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "2"
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee210  #顯示到畫面上
            NEXT FIELD xmee210                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee210
            #add-point:BEFORE FIELD xmee210 name="construct.b.xmee210"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee210
            
            #add-point:AFTER FIELD xmee210 name="construct.a.xmee210"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee209
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee209
            #add-point:ON ACTION controlp INFIELD xmee209 name="construct.c.xmee209"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "3"
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee209  #顯示到畫面上
            NEXT FIELD xmee209                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee209
            #add-point:BEFORE FIELD xmee209 name="construct.b.xmee209"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee209
            
            #add-point:AFTER FIELD xmee209 name="construct.a.xmee209"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee208
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee208
            #add-point:ON ACTION controlp INFIELD xmee208 name="construct.c.xmee208"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "4"
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee208  #顯示到畫面上
            NEXT FIELD xmee208                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee208
            #add-point:BEFORE FIELD xmee208 name="construct.b.xmee208"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee208
            
            #add-point:AFTER FIELD xmee208 name="construct.a.xmee208"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeeunit
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeeunit
            #add-point:ON ACTION controlp INFIELD xmeeunit name="construct.c.xmeeunit"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
#            LET g_qryparam.arg1 = '2'
#            CALL q_ooed004_2()                           #呼叫開窗
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmeeunit',g_site,'c') #150308-00001#1  By Ken add 'c' 150309
            CALL q_ooef001_24()
            DISPLAY g_qryparam.return1 TO xmeeunit  #顯示到畫面上
            NEXT FIELD xmeeunit                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeeunit
            #add-point:BEFORE FIELD xmeeunit name="construct.b.xmeeunit"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeeunit
            
            #add-point:AFTER FIELD xmeeunit name="construct.a.xmeeunit"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee204
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee204
            #add-point:ON ACTION controlp INFIELD xmee204 name="construct.c.xmee204"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_prcf001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee204  #顯示到畫面上
            NEXT FIELD xmee204                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee204
            #add-point:BEFORE FIELD xmee204 name="construct.b.xmee204"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee204
            
            #add-point:AFTER FIELD xmee204 name="construct.a.xmee204"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee205
            #add-point:BEFORE FIELD xmee205 name="construct.b.xmee205"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee205
            
            #add-point:AFTER FIELD xmee205 name="construct.a.xmee205"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee205
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee205
            #add-point:ON ACTION controlp INFIELD xmee205 name="construct.c.xmee205"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmee032
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee032
            #add-point:ON ACTION controlp INFIELD xmee032 name="construct.c.xmee032"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
		    LET g_qryparam.arg1 = "297"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee032  #顯示到畫面上

            NEXT FIELD xmee032                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee032
            #add-point:BEFORE FIELD xmee032 name="construct.b.xmee032"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee032
            
            #add-point:AFTER FIELD xmee032 name="construct.a.xmee032"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee071
            #add-point:BEFORE FIELD xmee071 name="construct.b.xmee071"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee071
            
            #add-point:AFTER FIELD xmee071 name="construct.a.xmee071"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee071
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee071
            #add-point:ON ACTION controlp INFIELD xmee071 name="construct.c.xmee071"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmee903
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee903
            #add-point:ON ACTION controlp INFIELD xmee903 name="construct.c.xmee903"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "267"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee903  #顯示到畫面上
            NEXT FIELD xmee903                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee903
            #add-point:BEFORE FIELD xmee903 name="construct.b.xmee903"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee903
            
            #add-point:AFTER FIELD xmee903 name="construct.a.xmee903"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee904
            #add-point:BEFORE FIELD xmee904 name="construct.b.xmee904"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee904
            
            #add-point:AFTER FIELD xmee904 name="construct.a.xmee904"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee904
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee904
            #add-point:ON ACTION controlp INFIELD xmee904 name="construct.c.xmee904"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmee025
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee025
            #add-point:ON ACTION controlp INFIELD xmee025 name="construct.c.xmee025"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " oofb008 = '3' " 
			LET g_qryparam.arg1 = g_oofa001
            CALL q_oofb019_1()                           #呼叫開窗
            
            DISPLAY g_qryparam.return1 TO xmee025  #顯示到畫面上

            NEXT FIELD xmee025                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee025
            #add-point:BEFORE FIELD xmee025 name="construct.b.xmee025"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee025
            
            #add-point:AFTER FIELD xmee025 name="construct.a.xmee025"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee025_desc
            #add-point:BEFORE FIELD xmee025_desc name="construct.b.xmee025_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee025_desc
            
            #add-point:AFTER FIELD xmee025_desc name="construct.a.xmee025_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee025_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee025_desc
            #add-point:ON ACTION controlp INFIELD xmee025_desc name="construct.c.xmee025_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oofb017
            #add-point:BEFORE FIELD oofb017 name="construct.b.oofb017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oofb017
            
            #add-point:AFTER FIELD oofb017 name="construct.a.oofb017"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oofb017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oofb017
            #add-point:ON ACTION controlp INFIELD oofb017 name="construct.c.oofb017"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmee026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee026
            #add-point:ON ACTION controlp INFIELD xmee026 name="construct.c.xmee026"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " oofb008 = '5' "
			LET g_qryparam.arg1 = g_oofa001
            CALL q_oofb019_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee026  #顯示到畫面上

            NEXT FIELD xmee026                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee026
            #add-point:BEFORE FIELD xmee026 name="construct.b.xmee026"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee026
            
            #add-point:AFTER FIELD xmee026 name="construct.a.xmee026"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee026_desc
            #add-point:BEFORE FIELD xmee026_desc name="construct.b.xmee026_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee026_desc
            
            #add-point:AFTER FIELD xmee026_desc name="construct.a.xmee026_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee026_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee026_desc
            #add-point:ON ACTION controlp INFIELD xmee026_desc name="construct.c.xmee026_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oofb017_1
            #add-point:BEFORE FIELD oofb017_1 name="construct.b.oofb017_1"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oofb017_1
            
            #add-point:AFTER FIELD oofb017_1 name="construct.a.oofb017_1"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oofb017_1
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oofb017_1
            #add-point:ON ACTION controlp INFIELD oofb017_1 name="construct.c.oofb017_1"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmee206
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee206
            #add-point:ON ACTION controlp INFIELD xmee206 name="construct.c.xmee206"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_dbad001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee206  #顯示到畫面上
            NEXT FIELD xmee206                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee206
            #add-point:BEFORE FIELD xmee206 name="construct.b.xmee206"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee206
            
            #add-point:AFTER FIELD xmee206 name="construct.a.xmee206"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee207
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee207
            #add-point:ON ACTION controlp INFIELD xmee207 name="construct.c.xmee207"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_dbab001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee207  #顯示到畫面上
            NEXT FIELD xmee207                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee207
            #add-point:BEFORE FIELD xmee207 name="construct.b.xmee207"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee207
            
            #add-point:AFTER FIELD xmee207 name="construct.a.xmee207"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee020
            #add-point:ON ACTION controlp INFIELD xmee020 name="construct.c.xmee020"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = "263"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee020  #顯示到畫面上

            NEXT FIELD xmee020                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee020
            #add-point:BEFORE FIELD xmee020 name="construct.b.xmee020"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee020
            
            #add-point:AFTER FIELD xmee020 name="construct.a.xmee020"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee036
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee036
            #add-point:ON ACTION controlp INFIELD xmee036 name="construct.c.xmee036"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pmaa001_3()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee036  #顯示到畫面上

            NEXT FIELD xmee036                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee036
            #add-point:BEFORE FIELD xmee036 name="construct.b.xmee036"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee036
            
            #add-point:AFTER FIELD xmee036 name="construct.a.xmee036"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee048
            #add-point:BEFORE FIELD xmee048 name="construct.b.xmee048"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee048
            
            #add-point:AFTER FIELD xmee048 name="construct.a.xmee048"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee048
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee048
            #add-point:ON ACTION controlp INFIELD xmee048 name="construct.c.xmee048"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee049
            #add-point:BEFORE FIELD xmee049 name="construct.b.xmee049"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee049
            
            #add-point:AFTER FIELD xmee049 name="construct.a.xmee049"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee049
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee049
            #add-point:ON ACTION controlp INFIELD xmee049 name="construct.c.xmee049"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xmee009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee009
            #add-point:ON ACTION controlp INFIELD xmee009 name="construct.c.xmee009"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_xmee_m.xmee004
            CALL q_ooib002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee009        #顯示到畫面上            
            CALL s_desc_get_ooib002_desc(g_xmee_m.xmee009) RETURNING g_xmee_m.xmee009_desc
            DISPLAY BY NAME g_xmee_m.xmee009_desc
            NEXT FIELD xmee009                            #返回原欄位
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee009
            #add-point:BEFORE FIELD xmee009 name="construct.b.xmee009"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee009
            
            #add-point:AFTER FIELD xmee009 name="construct.a.xmee009"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee010
            #add-point:ON ACTION controlp INFIELD xmee010 name="construct.c.xmee010"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '238'
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee010  #顯示到畫面上

            NEXT FIELD xmee010                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee010
            #add-point:BEFORE FIELD xmee010 name="construct.b.xmee010"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee010
            
            #add-point:AFTER FIELD xmee010 name="construct.a.xmee010"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee015
            #add-point:ON ACTION controlp INFIELD xmee015 name="construct.c.xmee015"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = g_site
            CALL q_ooaj002_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee015  #顯示到畫面上

            NEXT FIELD xmee015                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee015
            #add-point:BEFORE FIELD xmee015 name="construct.b.xmee015"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee015
            
            #add-point:AFTER FIELD xmee015 name="construct.a.xmee015"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee016
            #add-point:BEFORE FIELD xmee016 name="construct.b.xmee016"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee016
            
            #add-point:AFTER FIELD xmee016 name="construct.a.xmee016"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee016
            #add-point:ON ACTION controlp INFIELD xmee016 name="construct.c.xmee016"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmee011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee011
            #add-point:ON ACTION controlp INFIELD xmee011 name="construct.c.xmee011"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_oodb002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee011  #顯示到畫面上

            NEXT FIELD xmee011                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee011
            #add-point:BEFORE FIELD xmee011 name="construct.b.xmee011"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee011
            
            #add-point:AFTER FIELD xmee011 name="construct.a.xmee011"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee011_desc
            #add-point:BEFORE FIELD xmee011_desc name="construct.b.xmee011_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee011_desc
            
            #add-point:AFTER FIELD xmee011_desc name="construct.a.xmee011_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee011_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee011_desc
            #add-point:ON ACTION controlp INFIELD xmee011_desc name="construct.c.xmee011_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee012
            #add-point:BEFORE FIELD xmee012 name="construct.b.xmee012"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee012
            
            #add-point:AFTER FIELD xmee012 name="construct.a.xmee012"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee012
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee012
            #add-point:ON ACTION controlp INFIELD xmee012 name="construct.c.xmee012"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee013
            #add-point:BEFORE FIELD xmee013 name="construct.b.xmee013"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee013
            
            #add-point:AFTER FIELD xmee013 name="construct.a.xmee013"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee013
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee013
            #add-point:ON ACTION controlp INFIELD xmee013 name="construct.c.xmee013"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmee035
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee035
            #add-point:ON ACTION controlp INFIELD xmee035 name="construct.c.xmee035"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
		      #LET g_qryparam.arg1 = g_ooef019 
            #LET g_qryparam.arg2 = "2"                
            CALL q_isac002_3()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee035       #顯示到畫面上
            NEXT FIELD xmee035                     #返回原欄位

            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee035
            #add-point:BEFORE FIELD xmee035 name="construct.b.xmee035"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee035
            
            #add-point:AFTER FIELD xmee035 name="construct.a.xmee035"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee035_desc
            #add-point:BEFORE FIELD xmee035_desc name="construct.b.xmee035_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee035_desc
            
            #add-point:AFTER FIELD xmee035_desc name="construct.a.xmee035_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee035_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee035_desc
            #add-point:ON ACTION controlp INFIELD xmee035_desc name="construct.c.xmee035_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee039
            #add-point:BEFORE FIELD xmee039 name="construct.b.xmee039"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee039
            
            #add-point:AFTER FIELD xmee039 name="construct.a.xmee039"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee039
            #add-point:ON ACTION controlp INFIELD xmee039 name="construct.c.xmee039"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmeeownid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeeownid
            #add-point:ON ACTION controlp INFIELD xmeeownid name="construct.c.xmeeownid"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeeownid  #顯示到畫面上

            NEXT FIELD xmeeownid                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeeownid
            #add-point:BEFORE FIELD xmeeownid name="construct.b.xmeeownid"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeeownid
            
            #add-point:AFTER FIELD xmeeownid name="construct.a.xmeeownid"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeeowndp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeeowndp
            #add-point:ON ACTION controlp INFIELD xmeeowndp name="construct.c.xmeeowndp"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeeowndp  #顯示到畫面上

            NEXT FIELD xmeeowndp                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeeowndp
            #add-point:BEFORE FIELD xmeeowndp name="construct.b.xmeeowndp"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeeowndp
            
            #add-point:AFTER FIELD xmeeowndp name="construct.a.xmeeowndp"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeecrtid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeecrtid
            #add-point:ON ACTION controlp INFIELD xmeecrtid name="construct.c.xmeecrtid"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeecrtid  #顯示到畫面上

            NEXT FIELD xmeecrtid                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeecrtid
            #add-point:BEFORE FIELD xmeecrtid name="construct.b.xmeecrtid"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeecrtid
            
            #add-point:AFTER FIELD xmeecrtid name="construct.a.xmeecrtid"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmeecrtdp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeecrtdp
            #add-point:ON ACTION controlp INFIELD xmeecrtdp name="construct.c.xmeecrtdp"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeecrtdp  #顯示到畫面上

            NEXT FIELD xmeecrtdp                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeecrtdp
            #add-point:BEFORE FIELD xmeecrtdp name="construct.b.xmeecrtdp"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeecrtdp
            
            #add-point:AFTER FIELD xmeecrtdp name="construct.a.xmeecrtdp"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeecrtdt
            #add-point:BEFORE FIELD xmeecrtdt name="construct.b.xmeecrtdt"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmeemodid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeemodid
            #add-point:ON ACTION controlp INFIELD xmeemodid name="construct.c.xmeemodid"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeemodid  #顯示到畫面上

            NEXT FIELD xmeemodid                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeemodid
            #add-point:BEFORE FIELD xmeemodid name="construct.b.xmeemodid"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeemodid
            
            #add-point:AFTER FIELD xmeemodid name="construct.a.xmeemodid"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeemoddt
            #add-point:BEFORE FIELD xmeemoddt name="construct.b.xmeemoddt"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmeecnfid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeecnfid
            #add-point:ON ACTION controlp INFIELD xmeecnfid name="construct.c.xmeecnfid"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeecnfid  #顯示到畫面上

            NEXT FIELD xmeecnfid                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeecnfid
            #add-point:BEFORE FIELD xmeecnfid name="construct.b.xmeecnfid"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeecnfid
            
            #add-point:AFTER FIELD xmeecnfid name="construct.a.xmeecnfid"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeecnfdt
            #add-point:BEFORE FIELD xmeecnfdt name="construct.b.xmeecnfdt"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmee034
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee034
            #add-point:ON ACTION controlp INFIELD xmee034 name="construct.c.xmee034"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg1 = 'ALL'
            CALL q_pmaa001_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee034  #顯示到畫面上
               #DISPLAY g_qryparam.return2 TO pmaal004 #交易對象簡稱 

            NEXT FIELD xmee034                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee034
            #add-point:BEFORE FIELD xmee034 name="construct.b.xmee034"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee034
            
            #add-point:AFTER FIELD xmee034 name="construct.a.xmee034"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee006
            #add-point:BEFORE FIELD xmee006 name="construct.b.xmee006"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee006
            
            #add-point:AFTER FIELD xmee006 name="construct.a.xmee006"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee006
            #add-point:ON ACTION controlp INFIELD xmee006 name="construct.c.xmee006"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.xmee017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee017
            #add-point:ON ACTION controlp INFIELD xmee017 name="construct.c.xmee017"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_xmah001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee017  #顯示到畫面上

            NEXT FIELD xmee017                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee017
            #add-point:BEFORE FIELD xmee017 name="construct.b.xmee017"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee017
            
            #add-point:AFTER FIELD xmee017 name="construct.a.xmee017"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee018
            #add-point:ON ACTION controlp INFIELD xmee018 name="construct.c.xmee018"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooid001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmee018  #顯示到畫面上

            NEXT FIELD xmee018                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee018
            #add-point:BEFORE FIELD xmee018 name="construct.b.xmee018"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee018
            
            #add-point:AFTER FIELD xmee018 name="construct.a.xmee018"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee019
            #add-point:BEFORE FIELD xmee019 name="construct.b.xmee019"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee019
            
            #add-point:AFTER FIELD xmee019 name="construct.a.xmee019"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee019
            #add-point:ON ACTION controlp INFIELD xmee019 name="construct.c.xmee019"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee028
            #add-point:BEFORE FIELD xmee028 name="construct.b.xmee028"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee028
            
            #add-point:AFTER FIELD xmee028 name="construct.a.xmee028"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.xmee028
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee028
            #add-point:ON ACTION controlp INFIELD xmee028 name="construct.c.xmee028"
                                                                        
            #END add-point
 
 
 
         
      END CONSTRUCT
 
      #單身根據table分拆construct
      CONSTRUCT g_wc2_table1 ON xmegsite,xmegseq,xmeg027,xmeg001,xmeg002,xmeg004,xmeg005,xmeg006,xmeg007, 
          xmeg008,xmeg009,xmeg024,xmeg012,xmeg013,xmeg045,xmeg010,xmeg011,xmeg015,xmeg016,xmeg016_desc, 
          xmeg017,xmeg046,xmeg047,xmeg048,xmeg023,xmeg019,xmeg020,xmeg021,xmeg022,xmeg051,xmegunit,xmegorga, 
          xmeg052,xmeg049,xmeg053,xmeg050,xmeg901,xmeg902,xmeg903
           FROM s_detail1[1].xmegsite,s_detail1[1].xmegseq,s_detail1[1].xmeg027,s_detail1[1].xmeg001, 
               s_detail1[1].xmeg002,s_detail1[1].xmeg004,s_detail1[1].xmeg005,s_detail1[1].xmeg006,s_detail1[1].xmeg007, 
               s_detail1[1].xmeg008,s_detail1[1].xmeg009,s_detail1[1].xmeg024,s_detail1[1].xmeg012,s_detail1[1].xmeg013, 
               s_detail1[1].xmeg045,s_detail1[1].xmeg010,s_detail1[1].xmeg011,s_detail1[1].xmeg015,s_detail1[1].xmeg016, 
               s_detail1[1].xmeg016_desc,s_detail1[1].xmeg017,s_detail1[1].xmeg046,s_detail1[1].xmeg047, 
               s_detail1[1].xmeg048,s_detail1[1].xmeg023,s_detail1[1].xmeg019,s_detail1[1].xmeg020,s_detail1[1].xmeg021, 
               s_detail1[1].xmeg022,s_detail1[1].xmeg051,s_detail1[1].xmegunit,s_detail1[1].xmegorga, 
               s_detail1[1].xmeg052,s_detail1[1].xmeg049,s_detail1[1].xmeg053,s_detail1[1].xmeg050,s_detail1[1].xmeg901, 
               s_detail1[1].xmeg902,s_detail1[1].xmeg903
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body.before_construct"
                                                                        
            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmegsite
            #add-point:BEFORE FIELD xmegsite name="construct.b.page1.xmegsite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmegsite
            
            #add-point:AFTER FIELD xmegsite name="construct.a.page1.xmegsite"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmegsite
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmegsite
            #add-point:ON ACTION controlp INFIELD xmegsite name="construct.c.page1.xmegsite"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmegseq
            #add-point:BEFORE FIELD xmegseq name="construct.b.page1.xmegseq"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmegseq
            
            #add-point:AFTER FIELD xmegseq name="construct.a.page1.xmegseq"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmegseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmegseq
            #add-point:ON ACTION controlp INFIELD xmegseq name="construct.c.page1.xmegseq"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg027
            #add-point:ON ACTION controlp INFIELD xmeg027 name="construct.c.page1.xmeg027"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pmao004_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg027  #顯示到畫面上

            NEXT FIELD xmeg027                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg027
            #add-point:BEFORE FIELD xmeg027 name="construct.b.page1.xmeg027"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg027
            
            #add-point:AFTER FIELD xmeg027 name="construct.a.page1.xmeg027"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg001
            #add-point:ON ACTION controlp INFIELD xmeg001 name="construct.c.page1.xmeg001"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg001  #顯示到畫面上

            NEXT FIELD xmeg001                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg001
            #add-point:BEFORE FIELD xmeg001 name="construct.b.page1.xmeg001"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg001
            
            #add-point:AFTER FIELD xmeg001 name="construct.a.page1.xmeg001"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg002
            #add-point:BEFORE FIELD xmeg002 name="construct.b.page1.xmeg002"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg002
            
            #add-point:AFTER FIELD xmeg002 name="construct.a.page1.xmeg002"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg002
            #add-point:ON ACTION controlp INFIELD xmeg002 name="construct.c.page1.xmeg002"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg004
            #add-point:ON ACTION controlp INFIELD xmeg004 name="construct.c.page1.xmeg004"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = '221'
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg004  #顯示到畫面上

            NEXT FIELD xmeg004                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg004
            #add-point:BEFORE FIELD xmeg004 name="construct.b.page1.xmeg004"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg004
            
            #add-point:AFTER FIELD xmeg004 name="construct.a.page1.xmeg004"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg005
            #add-point:BEFORE FIELD xmeg005 name="construct.b.page1.xmeg005"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg005
            
            #add-point:AFTER FIELD xmeg005 name="construct.a.page1.xmeg005"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg005
            #add-point:ON ACTION controlp INFIELD xmeg005 name="construct.c.page1.xmeg005"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg006
            #add-point:ON ACTION controlp INFIELD xmeg006 name="construct.c.page1.xmeg006"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg006  #顯示到畫面上

            NEXT FIELD xmeg006                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg006
            #add-point:BEFORE FIELD xmeg006 name="construct.b.page1.xmeg006"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg006
            
            #add-point:AFTER FIELD xmeg006 name="construct.a.page1.xmeg006"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg007
            #add-point:BEFORE FIELD xmeg007 name="construct.b.page1.xmeg007"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg007
            
            #add-point:AFTER FIELD xmeg007 name="construct.a.page1.xmeg007"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg007
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg007
            #add-point:ON ACTION controlp INFIELD xmeg007 name="construct.c.page1.xmeg007"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg008
            #add-point:ON ACTION controlp INFIELD xmeg008 name="construct.c.page1.xmeg008"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg008  #顯示到畫面上

            NEXT FIELD xmeg008                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg008
            #add-point:BEFORE FIELD xmeg008 name="construct.b.page1.xmeg008"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg008
            
            #add-point:AFTER FIELD xmeg008 name="construct.a.page1.xmeg008"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg009
            #add-point:BEFORE FIELD xmeg009 name="construct.b.page1.xmeg009"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg009
            
            #add-point:AFTER FIELD xmeg009 name="construct.a.page1.xmeg009"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg009
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg009
            #add-point:ON ACTION controlp INFIELD xmeg009 name="construct.c.page1.xmeg009"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg024
            #add-point:BEFORE FIELD xmeg024 name="construct.b.page1.xmeg024"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg024
            
            #add-point:AFTER FIELD xmeg024 name="construct.a.page1.xmeg024"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg024
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg024
            #add-point:ON ACTION controlp INFIELD xmeg024 name="construct.c.page1.xmeg024"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg012
            #add-point:BEFORE FIELD xmeg012 name="construct.b.page1.xmeg012"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg012
            
            #add-point:AFTER FIELD xmeg012 name="construct.a.page1.xmeg012"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg012
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg012
            #add-point:ON ACTION controlp INFIELD xmeg012 name="construct.c.page1.xmeg012"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg013
            #add-point:BEFORE FIELD xmeg013 name="construct.b.page1.xmeg013"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg013
            
            #add-point:AFTER FIELD xmeg013 name="construct.a.page1.xmeg013"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg013
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg013
            #add-point:ON ACTION controlp INFIELD xmeg013 name="construct.c.page1.xmeg013"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg045
            #add-point:BEFORE FIELD xmeg045 name="construct.b.page1.xmeg045"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg045
            
            #add-point:AFTER FIELD xmeg045 name="construct.a.page1.xmeg045"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg045
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg045
            #add-point:ON ACTION controlp INFIELD xmeg045 name="construct.c.page1.xmeg045"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg010
            #add-point:ON ACTION controlp INFIELD xmeg010 name="construct.c.page1.xmeg010"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg010  #顯示到畫面上

            NEXT FIELD xmeg010                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg010
            #add-point:BEFORE FIELD xmeg010 name="construct.b.page1.xmeg010"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg010
            
            #add-point:AFTER FIELD xmeg010 name="construct.a.page1.xmeg010"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg011
            #add-point:BEFORE FIELD xmeg011 name="construct.b.page1.xmeg011"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg011
            
            #add-point:AFTER FIELD xmeg011 name="construct.a.page1.xmeg011"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg011
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg011
            #add-point:ON ACTION controlp INFIELD xmeg011 name="construct.c.page1.xmeg011"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg015
            #add-point:BEFORE FIELD xmeg015 name="construct.b.page1.xmeg015"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg015
            
            #add-point:AFTER FIELD xmeg015 name="construct.a.page1.xmeg015"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg015
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg015
            #add-point:ON ACTION controlp INFIELD xmeg015 name="construct.c.page1.xmeg015"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg016
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg016
            #add-point:ON ACTION controlp INFIELD xmeg016 name="construct.c.page1.xmeg016"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_oodb002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg016  #顯示到畫面上

            NEXT FIELD xmeg016                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg016
            #add-point:BEFORE FIELD xmeg016 name="construct.b.page1.xmeg016"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg016
            
            #add-point:AFTER FIELD xmeg016 name="construct.a.page1.xmeg016"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg016_desc
            #add-point:BEFORE FIELD xmeg016_desc name="construct.b.page1.xmeg016_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg016_desc
            
            #add-point:AFTER FIELD xmeg016_desc name="construct.a.page1.xmeg016_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg016_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg016_desc
            #add-point:ON ACTION controlp INFIELD xmeg016_desc name="construct.c.page1.xmeg016_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg017
            #add-point:BEFORE FIELD xmeg017 name="construct.b.page1.xmeg017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg017
            
            #add-point:AFTER FIELD xmeg017 name="construct.a.page1.xmeg017"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg017
            #add-point:ON ACTION controlp INFIELD xmeg017 name="construct.c.page1.xmeg017"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg046
            #add-point:BEFORE FIELD xmeg046 name="construct.b.page1.xmeg046"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg046
            
            #add-point:AFTER FIELD xmeg046 name="construct.a.page1.xmeg046"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg046
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg046
            #add-point:ON ACTION controlp INFIELD xmeg046 name="construct.c.page1.xmeg046"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg047
            #add-point:BEFORE FIELD xmeg047 name="construct.b.page1.xmeg047"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg047
            
            #add-point:AFTER FIELD xmeg047 name="construct.a.page1.xmeg047"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg047
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg047
            #add-point:ON ACTION controlp INFIELD xmeg047 name="construct.c.page1.xmeg047"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg048
            #add-point:BEFORE FIELD xmeg048 name="construct.b.page1.xmeg048"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg048
            
            #add-point:AFTER FIELD xmeg048 name="construct.a.page1.xmeg048"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg048
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg048
            #add-point:ON ACTION controlp INFIELD xmeg048 name="construct.c.page1.xmeg048"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg023
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg023
            #add-point:ON ACTION controlp INFIELD xmeg023 name="construct.c.page1.xmeg023"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg2 = 'ALL'
            CALL q_pmac002_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg023  #顯示到畫面上
               #DISPLAY g_qryparam.return2 TO pmaal004 #交易對象簡稱 

            NEXT FIELD xmeg023                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg023
            #add-point:BEFORE FIELD xmeg023 name="construct.b.page1.xmeg023"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg023
            
            #add-point:AFTER FIELD xmeg023 name="construct.a.page1.xmeg023"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg019
            #add-point:BEFORE FIELD xmeg019 name="construct.b.page1.xmeg019"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg019
            
            #add-point:AFTER FIELD xmeg019 name="construct.a.page1.xmeg019"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg019
            #add-point:ON ACTION controlp INFIELD xmeg019 name="construct.c.page1.xmeg019"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg020
            #add-point:BEFORE FIELD xmeg020 name="construct.b.page1.xmeg020"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg020
            
            #add-point:AFTER FIELD xmeg020 name="construct.a.page1.xmeg020"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg020
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg020
            #add-point:ON ACTION controlp INFIELD xmeg020 name="construct.c.page1.xmeg020"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg021
            #add-point:BEFORE FIELD xmeg021 name="construct.b.page1.xmeg021"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg021
            
            #add-point:AFTER FIELD xmeg021 name="construct.a.page1.xmeg021"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg021
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg021
            #add-point:ON ACTION controlp INFIELD xmeg021 name="construct.c.page1.xmeg021"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg022
            #add-point:BEFORE FIELD xmeg022 name="construct.b.page1.xmeg022"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg022
            
            #add-point:AFTER FIELD xmeg022 name="construct.a.page1.xmeg022"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg022
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg022
            #add-point:ON ACTION controlp INFIELD xmeg022 name="construct.c.page1.xmeg022"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg051
            #add-point:BEFORE FIELD xmeg051 name="construct.b.page1.xmeg051"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg051
            
            #add-point:AFTER FIELD xmeg051 name="construct.a.page1.xmeg051"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg051
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg051
            #add-point:ON ACTION controlp INFIELD xmeg051 name="construct.c.page1.xmeg051"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmegunit
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmegunit
            #add-point:ON ACTION controlp INFIELD xmegunit name="construct.c.page1.xmegunit"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			   #161006-00008#5-add(s)
			   LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmegunit',g_xmeg_d[l_ac].xmegsite,'c')
			   CALL q_ooef001_24()
			   #161006-00008#5-add(e)
            #CALL q_ooef001()                           #呼叫開窗  #161006-00008#5 mark
            DISPLAY g_qryparam.return1 TO xmegunit  #顯示到畫面上

            NEXT FIELD xmegunit                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmegunit
            #add-point:BEFORE FIELD xmegunit name="construct.b.page1.xmegunit"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmegunit
            
            #add-point:AFTER FIELD xmegunit name="construct.a.page1.xmegunit"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmegorga
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmegorga
            #add-point:ON ACTION controlp INFIELD xmegorga name="construct.c.page1.xmegorga"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooef001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmegorga  #顯示到畫面上

            NEXT FIELD xmegorga                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmegorga
            #add-point:BEFORE FIELD xmegorga name="construct.b.page1.xmegorga"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmegorga
            
            #add-point:AFTER FIELD xmegorga name="construct.a.page1.xmegorga"
                                                                        
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg052
            #add-point:BEFORE FIELD xmeg052 name="construct.b.page1.xmeg052"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg052
            
            #add-point:AFTER FIELD xmeg052 name="construct.a.page1.xmeg052"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg052
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg052
            #add-point:ON ACTION controlp INFIELD xmeg052 name="construct.c.page1.xmeg052"
                                                                        
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg049
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg049
            #add-point:ON ACTION controlp INFIELD xmeg049 name="construct.c.page1.xmeg049"
                                                                                    #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = g_acc
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg049  #顯示到畫面上

            NEXT FIELD xmeg049                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg049
            #add-point:BEFORE FIELD xmeg049 name="construct.b.page1.xmeg049"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg049
            
            #add-point:AFTER FIELD xmeg049 name="construct.a.page1.xmeg049"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg053
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg053
            #add-point:ON ACTION controlp INFIELD xmeg053 name="construct.c.page1.xmeg053"
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = g_acc
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg053  #顯示到畫面上

            NEXT FIELD xmeg053                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg053
            #add-point:BEFORE FIELD xmeg053 name="construct.b.page1.xmeg053"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg053
            
            #add-point:AFTER FIELD xmeg053 name="construct.a.page1.xmeg053"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg050
            #add-point:BEFORE FIELD xmeg050 name="construct.b.page1.xmeg050"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg050
            
            #add-point:AFTER FIELD xmeg050 name="construct.a.page1.xmeg050"
                                                                        
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg050
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg050
            #add-point:ON ACTION controlp INFIELD xmeg050 name="construct.c.page1.xmeg050"
                                                                        
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg901
            #add-point:BEFORE FIELD xmeg901 name="construct.b.page1.xmeg901"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg901
            
            #add-point:AFTER FIELD xmeg901 name="construct.a.page1.xmeg901"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg901
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg901
            #add-point:ON ACTION controlp INFIELD xmeg901 name="construct.c.page1.xmeg901"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xmeg902
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg902
            #add-point:ON ACTION controlp INFIELD xmeg902 name="construct.c.page1.xmeg902"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "267"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeg902  #顯示到畫面上
            NEXT FIELD xmeg902                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg902
            #add-point:BEFORE FIELD xmeg902 name="construct.b.page1.xmeg902"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg902
            
            #add-point:AFTER FIELD xmeg902 name="construct.a.page1.xmeg902"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeg903
            #add-point:BEFORE FIELD xmeg903 name="construct.b.page1.xmeg903"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeg903
            
            #add-point:AFTER FIELD xmeg903 name="construct.a.page1.xmeg903"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xmeg903
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeg903
            #add-point:ON ACTION controlp INFIELD xmeg903 name="construct.c.page1.xmeg903"
            
            #END add-point
 
 
   
       
      END CONSTRUCT
      
      CONSTRUCT g_wc2_table2 ON rticseq,rticseq1,rtic001,rtic002,rtic003,rtic004,rtic005,rtic006,rtic007, 
          rtic008,rtic009,rtic010,rtic011,rtic012,rtic013,rtic014,rtic015,rtic016,rtic017,rtic018,rtic019, 
          rtic020,rtic021,rtic022,rtic023,rtic024,rtic025,rtic026,rtic027,rtic028,rtic029
           FROM s_detail2[1].rticseq,s_detail2[1].rticseq1,s_detail2[1].rtic001,s_detail2[1].rtic002, 
               s_detail2[1].rtic003,s_detail2[1].rtic004,s_detail2[1].rtic005,s_detail2[1].rtic006,s_detail2[1].rtic007, 
               s_detail2[1].rtic008,s_detail2[1].rtic009,s_detail2[1].rtic010,s_detail2[1].rtic011,s_detail2[1].rtic012, 
               s_detail2[1].rtic013,s_detail2[1].rtic014,s_detail2[1].rtic015,s_detail2[1].rtic016,s_detail2[1].rtic017, 
               s_detail2[1].rtic018,s_detail2[1].rtic019,s_detail2[1].rtic020,s_detail2[1].rtic021,s_detail2[1].rtic022, 
               s_detail2[1].rtic023,s_detail2[1].rtic024,s_detail2[1].rtic025,s_detail2[1].rtic026,s_detail2[1].rtic027, 
               s_detail2[1].rtic028,s_detail2[1].rtic029
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body2.before_construct"
                                                                        
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 2)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rticseq
            #add-point:BEFORE FIELD rticseq name="construct.b.page2.rticseq"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rticseq
            
            #add-point:AFTER FIELD rticseq name="construct.a.page2.rticseq"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rticseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rticseq
            #add-point:ON ACTION controlp INFIELD rticseq name="construct.c.page2.rticseq"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rticseq1
            #add-point:BEFORE FIELD rticseq1 name="construct.b.page2.rticseq1"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rticseq1
            
            #add-point:AFTER FIELD rticseq1 name="construct.a.page2.rticseq1"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rticseq1
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rticseq1
            #add-point:ON ACTION controlp INFIELD rticseq1 name="construct.c.page2.rticseq1"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic001
            #add-point:BEFORE FIELD rtic001 name="construct.b.page2.rtic001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic001
            
            #add-point:AFTER FIELD rtic001 name="construct.a.page2.rtic001"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic001
            #add-point:ON ACTION controlp INFIELD rtic001 name="construct.c.page2.rtic001"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic002
            #add-point:BEFORE FIELD rtic002 name="construct.b.page2.rtic002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic002
            
            #add-point:AFTER FIELD rtic002 name="construct.a.page2.rtic002"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic002
            #add-point:ON ACTION controlp INFIELD rtic002 name="construct.c.page2.rtic002"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic003
            #add-point:BEFORE FIELD rtic003 name="construct.b.page2.rtic003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic003
            
            #add-point:AFTER FIELD rtic003 name="construct.a.page2.rtic003"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic003
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic003
            #add-point:ON ACTION controlp INFIELD rtic003 name="construct.c.page2.rtic003"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic004
            #add-point:BEFORE FIELD rtic004 name="construct.b.page2.rtic004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic004
            
            #add-point:AFTER FIELD rtic004 name="construct.a.page2.rtic004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic004
            #add-point:ON ACTION controlp INFIELD rtic004 name="construct.c.page2.rtic004"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic005
            #add-point:BEFORE FIELD rtic005 name="construct.b.page2.rtic005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic005
            
            #add-point:AFTER FIELD rtic005 name="construct.a.page2.rtic005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic005
            #add-point:ON ACTION controlp INFIELD rtic005 name="construct.c.page2.rtic005"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic006
            #add-point:BEFORE FIELD rtic006 name="construct.b.page2.rtic006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic006
            
            #add-point:AFTER FIELD rtic006 name="construct.a.page2.rtic006"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic006
            #add-point:ON ACTION controlp INFIELD rtic006 name="construct.c.page2.rtic006"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic007
            #add-point:BEFORE FIELD rtic007 name="construct.b.page2.rtic007"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic007
            
            #add-point:AFTER FIELD rtic007 name="construct.a.page2.rtic007"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic007
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic007
            #add-point:ON ACTION controlp INFIELD rtic007 name="construct.c.page2.rtic007"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic008
            #add-point:BEFORE FIELD rtic008 name="construct.b.page2.rtic008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic008
            
            #add-point:AFTER FIELD rtic008 name="construct.a.page2.rtic008"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic008
            #add-point:ON ACTION controlp INFIELD rtic008 name="construct.c.page2.rtic008"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic009
            #add-point:BEFORE FIELD rtic009 name="construct.b.page2.rtic009"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic009
            
            #add-point:AFTER FIELD rtic009 name="construct.a.page2.rtic009"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic009
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic009
            #add-point:ON ACTION controlp INFIELD rtic009 name="construct.c.page2.rtic009"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic010
            #add-point:BEFORE FIELD rtic010 name="construct.b.page2.rtic010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic010
            
            #add-point:AFTER FIELD rtic010 name="construct.a.page2.rtic010"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic010
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic010
            #add-point:ON ACTION controlp INFIELD rtic010 name="construct.c.page2.rtic010"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic011
            #add-point:BEFORE FIELD rtic011 name="construct.b.page2.rtic011"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic011
            
            #add-point:AFTER FIELD rtic011 name="construct.a.page2.rtic011"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic011
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic011
            #add-point:ON ACTION controlp INFIELD rtic011 name="construct.c.page2.rtic011"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic012
            #add-point:BEFORE FIELD rtic012 name="construct.b.page2.rtic012"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic012
            
            #add-point:AFTER FIELD rtic012 name="construct.a.page2.rtic012"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic012
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic012
            #add-point:ON ACTION controlp INFIELD rtic012 name="construct.c.page2.rtic012"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic013
            #add-point:BEFORE FIELD rtic013 name="construct.b.page2.rtic013"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic013
            
            #add-point:AFTER FIELD rtic013 name="construct.a.page2.rtic013"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic013
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic013
            #add-point:ON ACTION controlp INFIELD rtic013 name="construct.c.page2.rtic013"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic014
            #add-point:BEFORE FIELD rtic014 name="construct.b.page2.rtic014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic014
            
            #add-point:AFTER FIELD rtic014 name="construct.a.page2.rtic014"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic014
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic014
            #add-point:ON ACTION controlp INFIELD rtic014 name="construct.c.page2.rtic014"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic015
            #add-point:BEFORE FIELD rtic015 name="construct.b.page2.rtic015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic015
            
            #add-point:AFTER FIELD rtic015 name="construct.a.page2.rtic015"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic015
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic015
            #add-point:ON ACTION controlp INFIELD rtic015 name="construct.c.page2.rtic015"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic016
            #add-point:BEFORE FIELD rtic016 name="construct.b.page2.rtic016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic016
            
            #add-point:AFTER FIELD rtic016 name="construct.a.page2.rtic016"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic016
            #add-point:ON ACTION controlp INFIELD rtic016 name="construct.c.page2.rtic016"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic017
            #add-point:BEFORE FIELD rtic017 name="construct.b.page2.rtic017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic017
            
            #add-point:AFTER FIELD rtic017 name="construct.a.page2.rtic017"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic017
            #add-point:ON ACTION controlp INFIELD rtic017 name="construct.c.page2.rtic017"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic018
            #add-point:BEFORE FIELD rtic018 name="construct.b.page2.rtic018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic018
            
            #add-point:AFTER FIELD rtic018 name="construct.a.page2.rtic018"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic018
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic018
            #add-point:ON ACTION controlp INFIELD rtic018 name="construct.c.page2.rtic018"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic019
            #add-point:BEFORE FIELD rtic019 name="construct.b.page2.rtic019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic019
            
            #add-point:AFTER FIELD rtic019 name="construct.a.page2.rtic019"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic019
            #add-point:ON ACTION controlp INFIELD rtic019 name="construct.c.page2.rtic019"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic020
            #add-point:BEFORE FIELD rtic020 name="construct.b.page2.rtic020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic020
            
            #add-point:AFTER FIELD rtic020 name="construct.a.page2.rtic020"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic020
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic020
            #add-point:ON ACTION controlp INFIELD rtic020 name="construct.c.page2.rtic020"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic021
            #add-point:BEFORE FIELD rtic021 name="construct.b.page2.rtic021"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic021
            
            #add-point:AFTER FIELD rtic021 name="construct.a.page2.rtic021"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic021
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic021
            #add-point:ON ACTION controlp INFIELD rtic021 name="construct.c.page2.rtic021"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic022
            #add-point:BEFORE FIELD rtic022 name="construct.b.page2.rtic022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic022
            
            #add-point:AFTER FIELD rtic022 name="construct.a.page2.rtic022"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic022
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic022
            #add-point:ON ACTION controlp INFIELD rtic022 name="construct.c.page2.rtic022"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic023
            #add-point:BEFORE FIELD rtic023 name="construct.b.page2.rtic023"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic023
            
            #add-point:AFTER FIELD rtic023 name="construct.a.page2.rtic023"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic023
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic023
            #add-point:ON ACTION controlp INFIELD rtic023 name="construct.c.page2.rtic023"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic024
            #add-point:BEFORE FIELD rtic024 name="construct.b.page2.rtic024"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic024
            
            #add-point:AFTER FIELD rtic024 name="construct.a.page2.rtic024"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic024
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic024
            #add-point:ON ACTION controlp INFIELD rtic024 name="construct.c.page2.rtic024"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic025
            #add-point:BEFORE FIELD rtic025 name="construct.b.page2.rtic025"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic025
            
            #add-point:AFTER FIELD rtic025 name="construct.a.page2.rtic025"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic025
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic025
            #add-point:ON ACTION controlp INFIELD rtic025 name="construct.c.page2.rtic025"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic026
            #add-point:BEFORE FIELD rtic026 name="construct.b.page2.rtic026"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic026
            
            #add-point:AFTER FIELD rtic026 name="construct.a.page2.rtic026"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic026
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic026
            #add-point:ON ACTION controlp INFIELD rtic026 name="construct.c.page2.rtic026"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic027
            #add-point:BEFORE FIELD rtic027 name="construct.b.page2.rtic027"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic027
            
            #add-point:AFTER FIELD rtic027 name="construct.a.page2.rtic027"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic027
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic027
            #add-point:ON ACTION controlp INFIELD rtic027 name="construct.c.page2.rtic027"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic028
            #add-point:BEFORE FIELD rtic028 name="construct.b.page2.rtic028"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic028
            
            #add-point:AFTER FIELD rtic028 name="construct.a.page2.rtic028"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic028
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic028
            #add-point:ON ACTION controlp INFIELD rtic028 name="construct.c.page2.rtic028"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD rtic029
            #add-point:BEFORE FIELD rtic029 name="construct.b.page2.rtic029"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD rtic029
            
            #add-point:AFTER FIELD rtic029 name="construct.a.page2.rtic029"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.rtic029
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD rtic029
            #add-point:ON ACTION controlp INFIELD rtic029 name="construct.c.page2.rtic029"
            
            #END add-point
 
 
   
       
      END CONSTRUCT
 
      CONSTRUCT g_wc2_table3 ON xmehdocno,xmehseq,xmehseq1,xmeh229,xmeh003,xmeh001,xmeh002,xmeh200,xmeh004, 
          xmeh005,xmeh011,xmeh012,xmehseq2,xmeh006,xmeh201,xmeh202,xmeh024,xmeh025,xmeh026,xmeh027,xmeh203, 
          xmeh204,xmeh205,xmeh206,xmeh029,xmeh028,xmeh019,xmeh019_desc,xmeh030,xmeh207,xmehunit,xmeh210, 
          xmeh212,xmeh213,xmeh214,xmeh215,xmeh031,xmeh014,xmeh015,xmeh016,xmeh017,xmeh221,xmehsite,xmeh218, 
          xmeh219,xmeh220,xmeh222,xmeh223,xmeh224,xmehorga,xmeh226,xmeh227,xmeh228,xmeh901
           FROM s_detail3[1].xmehdocno,s_detail3[1].xmehseq,s_detail3[1].xmehseq1,s_detail3[1].xmeh229, 
               s_detail3[1].xmeh003,s_detail3[1].xmeh001,s_detail3[1].xmeh002,s_detail3[1].xmeh200,s_detail3[1].xmeh004, 
               s_detail3[1].xmeh005,s_detail3[1].xmeh011,s_detail3[1].xmeh012,s_detail3[1].xmehseq2, 
               s_detail3[1].xmeh006,s_detail3[1].xmeh201,s_detail3[1].xmeh202,s_detail3[1].xmeh024,s_detail3[1].xmeh025, 
               s_detail3[1].xmeh026,s_detail3[1].xmeh027,s_detail3[1].xmeh203,s_detail3[1].xmeh204,s_detail3[1].xmeh205, 
               s_detail3[1].xmeh206,s_detail3[1].xmeh029,s_detail3[1].xmeh028,s_detail3[1].xmeh019,s_detail3[1].xmeh019_desc, 
               s_detail3[1].xmeh030,s_detail3[1].xmeh207,s_detail3[1].xmehunit,s_detail3[1].xmeh210, 
               s_detail3[1].xmeh212,s_detail3[1].xmeh213,s_detail3[1].xmeh214,s_detail3[1].xmeh215,s_detail3[1].xmeh031, 
               s_detail3[1].xmeh014,s_detail3[1].xmeh015,s_detail3[1].xmeh016,s_detail3[1].xmeh017,s_detail3[1].xmeh221, 
               s_detail3[1].xmehsite,s_detail3[1].xmeh218,s_detail3[1].xmeh219,s_detail3[1].xmeh220, 
               s_detail3[1].xmeh222,s_detail3[1].xmeh223,s_detail3[1].xmeh224,s_detail3[1].xmehorga, 
               s_detail3[1].xmeh226,s_detail3[1].xmeh227,s_detail3[1].xmeh228,s_detail3[1].xmeh901
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body3.before_construct"
                                                                        
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 3)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmehdocno
            #add-point:BEFORE FIELD xmehdocno name="construct.b.page3.xmehdocno"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmehdocno
            
            #add-point:AFTER FIELD xmehdocno name="construct.a.page3.xmehdocno"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmehdocno
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmehdocno
            #add-point:ON ACTION controlp INFIELD xmehdocno name="construct.c.page3.xmehdocno"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmehseq
            #add-point:BEFORE FIELD xmehseq name="construct.b.page3.xmehseq"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmehseq
            
            #add-point:AFTER FIELD xmehseq name="construct.a.page3.xmehseq"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmehseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmehseq
            #add-point:ON ACTION controlp INFIELD xmehseq name="construct.c.page3.xmehseq"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmehseq1
            #add-point:BEFORE FIELD xmehseq1 name="construct.b.page3.xmehseq1"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmehseq1
            
            #add-point:AFTER FIELD xmehseq1 name="construct.a.page3.xmehseq1"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmehseq1
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmehseq1
            #add-point:ON ACTION controlp INFIELD xmehseq1 name="construct.c.page3.xmehseq1"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh229
            #add-point:BEFORE FIELD xmeh229 name="construct.b.page3.xmeh229"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh229
            
            #add-point:AFTER FIELD xmeh229 name="construct.a.page3.xmeh229"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh229
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh229
            #add-point:ON ACTION controlp INFIELD xmeh229 name="construct.c.page3.xmeh229"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh003
            #add-point:BEFORE FIELD xmeh003 name="construct.b.page3.xmeh003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh003
            
            #add-point:AFTER FIELD xmeh003 name="construct.a.page3.xmeh003"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh003
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh003
            #add-point:ON ACTION controlp INFIELD xmeh003 name="construct.c.page3.xmeh003"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh001
            #add-point:ON ACTION controlp INFIELD xmeh001 name="construct.c.page3.xmeh001"
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh001  #顯示到畫面上

            NEXT FIELD xmeh001                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh001
            #add-point:BEFORE FIELD xmeh001 name="construct.b.page3.xmeh001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh001
            
            #add-point:AFTER FIELD xmeh001 name="construct.a.page3.xmeh001"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh002
            #add-point:BEFORE FIELD xmeh002 name="construct.b.page3.xmeh002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh002
            
            #add-point:AFTER FIELD xmeh002 name="construct.a.page3.xmeh002"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh002
            #add-point:ON ACTION controlp INFIELD xmeh002 name="construct.c.page3.xmeh002"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh200
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh200
            #add-point:ON ACTION controlp INFIELD xmeh200 name="construct.c.page3.xmeh200"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_prcf001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh200  #顯示到畫面上
            NEXT FIELD xmeh200                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh200
            #add-point:BEFORE FIELD xmeh200 name="construct.b.page3.xmeh200"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh200
            
            #add-point:AFTER FIELD xmeh200 name="construct.a.page3.xmeh200"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh004
            #add-point:ON ACTION controlp INFIELD xmeh004 name="construct.c.page3.xmeh004"
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh004  #顯示到畫面上

            NEXT FIELD xmeh004                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh004
            #add-point:BEFORE FIELD xmeh004 name="construct.b.page3.xmeh004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh004
            
            #add-point:AFTER FIELD xmeh004 name="construct.a.page3.xmeh004"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh005
            #add-point:BEFORE FIELD xmeh005 name="construct.b.page3.xmeh005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh005
            
            #add-point:AFTER FIELD xmeh005 name="construct.a.page3.xmeh005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh005
            #add-point:ON ACTION controlp INFIELD xmeh005 name="construct.c.page3.xmeh005"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh011
            #add-point:BEFORE FIELD xmeh011 name="construct.b.page3.xmeh011"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh011
            
            #add-point:AFTER FIELD xmeh011 name="construct.a.page3.xmeh011"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh011
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh011
            #add-point:ON ACTION controlp INFIELD xmeh011 name="construct.c.page3.xmeh011"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh012
            #add-point:BEFORE FIELD xmeh012 name="construct.b.page3.xmeh012"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh012
            
            #add-point:AFTER FIELD xmeh012 name="construct.a.page3.xmeh012"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh012
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh012
            #add-point:ON ACTION controlp INFIELD xmeh012 name="construct.c.page3.xmeh012"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmehseq2
            #add-point:BEFORE FIELD xmehseq2 name="construct.b.page3.xmehseq2"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmehseq2
            
            #add-point:AFTER FIELD xmehseq2 name="construct.a.page3.xmehseq2"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmehseq2
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmehseq2
            #add-point:ON ACTION controlp INFIELD xmehseq2 name="construct.c.page3.xmehseq2"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh006
            #add-point:BEFORE FIELD xmeh006 name="construct.b.page3.xmeh006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh006
            
            #add-point:AFTER FIELD xmeh006 name="construct.a.page3.xmeh006"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh006
            #add-point:ON ACTION controlp INFIELD xmeh006 name="construct.c.page3.xmeh006"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh201
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh201
            #add-point:ON ACTION controlp INFIELD xmeh201 name="construct.c.page3.xmeh201"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh201  #顯示到畫面上
            NEXT FIELD xmeh201                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh201
            #add-point:BEFORE FIELD xmeh201 name="construct.b.page3.xmeh201"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh201
            
            #add-point:AFTER FIELD xmeh201 name="construct.a.page3.xmeh201"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh202
            #add-point:BEFORE FIELD xmeh202 name="construct.b.page3.xmeh202"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh202
            
            #add-point:AFTER FIELD xmeh202 name="construct.a.page3.xmeh202"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh202
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh202
            #add-point:ON ACTION controlp INFIELD xmeh202 name="construct.c.page3.xmeh202"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh024
            #add-point:ON ACTION controlp INFIELD xmeh024 name="construct.c.page3.xmeh024"
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh024  #顯示到畫面上

            NEXT FIELD xmeh024                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh024
            #add-point:BEFORE FIELD xmeh024 name="construct.b.page3.xmeh024"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh024
            
            #add-point:AFTER FIELD xmeh024 name="construct.a.page3.xmeh024"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh025
            #add-point:BEFORE FIELD xmeh025 name="construct.b.page3.xmeh025"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh025
            
            #add-point:AFTER FIELD xmeh025 name="construct.a.page3.xmeh025"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh025
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh025
            #add-point:ON ACTION controlp INFIELD xmeh025 name="construct.c.page3.xmeh025"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh026
            #add-point:ON ACTION controlp INFIELD xmeh026 name="construct.c.page3.xmeh026"
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh026  #顯示到畫面上

            NEXT FIELD xmeh026                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh026
            #add-point:BEFORE FIELD xmeh026 name="construct.b.page3.xmeh026"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh026
            
            #add-point:AFTER FIELD xmeh026 name="construct.a.page3.xmeh026"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh027
            #add-point:BEFORE FIELD xmeh027 name="construct.b.page3.xmeh027"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh027
            
            #add-point:AFTER FIELD xmeh027 name="construct.a.page3.xmeh027"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh027
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh027
            #add-point:ON ACTION controlp INFIELD xmeh027 name="construct.c.page3.xmeh027"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh203
            #add-point:BEFORE FIELD xmeh203 name="construct.b.page3.xmeh203"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh203
            
            #add-point:AFTER FIELD xmeh203 name="construct.a.page3.xmeh203"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh203
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh203
            #add-point:ON ACTION controlp INFIELD xmeh203 name="construct.c.page3.xmeh203"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh204
            #add-point:BEFORE FIELD xmeh204 name="construct.b.page3.xmeh204"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh204
            
            #add-point:AFTER FIELD xmeh204 name="construct.a.page3.xmeh204"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh204
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh204
            #add-point:ON ACTION controlp INFIELD xmeh204 name="construct.c.page3.xmeh204"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh205
            #add-point:BEFORE FIELD xmeh205 name="construct.b.page3.xmeh205"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh205
            
            #add-point:AFTER FIELD xmeh205 name="construct.a.page3.xmeh205"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh205
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh205
            #add-point:ON ACTION controlp INFIELD xmeh205 name="construct.c.page3.xmeh205"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh206
            #add-point:BEFORE FIELD xmeh206 name="construct.b.page3.xmeh206"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh206
            
            #add-point:AFTER FIELD xmeh206 name="construct.a.page3.xmeh206"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh206
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh206
            #add-point:ON ACTION controlp INFIELD xmeh206 name="construct.c.page3.xmeh206"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh029
            #add-point:BEFORE FIELD xmeh029 name="construct.b.page3.xmeh029"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh029
            
            #add-point:AFTER FIELD xmeh029 name="construct.a.page3.xmeh029"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh029
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh029
            #add-point:ON ACTION controlp INFIELD xmeh029 name="construct.c.page3.xmeh029"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh028
            #add-point:BEFORE FIELD xmeh028 name="construct.b.page3.xmeh028"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh028
            
            #add-point:AFTER FIELD xmeh028 name="construct.a.page3.xmeh028"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh028
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh028
            #add-point:ON ACTION controlp INFIELD xmeh028 name="construct.c.page3.xmeh028"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh019
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh019
            #add-point:ON ACTION controlp INFIELD xmeh019 name="construct.c.page3.xmeh019"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oodb002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh019  #顯示到畫面上
            NEXT FIELD xmeh019                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh019
            #add-point:BEFORE FIELD xmeh019 name="construct.b.page3.xmeh019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh019
            
            #add-point:AFTER FIELD xmeh019 name="construct.a.page3.xmeh019"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh019_desc
            #add-point:BEFORE FIELD xmeh019_desc name="construct.b.page3.xmeh019_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh019_desc
            
            #add-point:AFTER FIELD xmeh019_desc name="construct.a.page3.xmeh019_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh019_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh019_desc
            #add-point:ON ACTION controlp INFIELD xmeh019_desc name="construct.c.page3.xmeh019_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh030
            #add-point:BEFORE FIELD xmeh030 name="construct.b.page3.xmeh030"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh030
            
            #add-point:AFTER FIELD xmeh030 name="construct.a.page3.xmeh030"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh030
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh030
            #add-point:ON ACTION controlp INFIELD xmeh030 name="construct.c.page3.xmeh030"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh207
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh207
            #add-point:ON ACTION controlp INFIELD xmeh207 name="construct.c.page3.xmeh207"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001_18()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh207  #顯示到畫面上
            NEXT FIELD xmeh207                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh207
            #add-point:BEFORE FIELD xmeh207 name="construct.b.page3.xmeh207"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh207
            
            #add-point:AFTER FIELD xmeh207 name="construct.a.page3.xmeh207"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmehunit
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmehunit
            #add-point:ON ACTION controlp INFIELD xmehunit name="construct.c.page3.xmehunit"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
#			   LET g_qryparam.arg1 = g_site
#			   LET g_qryparam.arg2 = '2'
#            CALL q_ooed004_3()                           #呼叫開窗
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmehunit',g_site,'c') #150308-00001#1  By Ken add 'c' 150309
            CALL q_ooef001_24()
            DISPLAY g_qryparam.return1 TO xmehunit  #顯示到畫面上
            NEXT FIELD xmehunit                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmehunit
            #add-point:BEFORE FIELD xmehunit name="construct.b.page3.xmehunit"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmehunit
            
            #add-point:AFTER FIELD xmehunit name="construct.a.page3.xmehunit"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh210
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh210
            #add-point:ON ACTION controlp INFIELD xmeh210 name="construct.c.page3.xmeh210"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "274"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh210  #顯示到畫面上
            NEXT FIELD xmeh210                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh210
            #add-point:BEFORE FIELD xmeh210 name="construct.b.page3.xmeh210"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh210
            
            #add-point:AFTER FIELD xmeh210 name="construct.a.page3.xmeh210"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh212
            #add-point:BEFORE FIELD xmeh212 name="construct.b.page3.xmeh212"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh212
            
            #add-point:AFTER FIELD xmeh212 name="construct.a.page3.xmeh212"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh212
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh212
            #add-point:ON ACTION controlp INFIELD xmeh212 name="construct.c.page3.xmeh212"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh213
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh213
            #add-point:ON ACTION controlp INFIELD xmeh213 name="construct.c.page3.xmeh213"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #02749  150116  add ----------------------(S)
            #LET g_qryparam.arg1 = g_site
            #CALL q_inaa001_4()                    #呼叫開窗
            #
            #提供庫位基本資料開窗
            CALL q_inaa001_23()
            #02749  150116  add ----------------------(E)
            DISPLAY g_qryparam.return1 TO xmeh213  #顯示到畫面上
            NEXT FIELD xmeh213                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh213
            #add-point:BEFORE FIELD xmeh213 name="construct.b.page3.xmeh213"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh213
            
            #add-point:AFTER FIELD xmeh213 name="construct.a.page3.xmeh213"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh214
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh214
            #add-point:ON ACTION controlp INFIELD xmeh214 name="construct.c.page3.xmeh214"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #02749  150116  add ----------------------(S)
            #LET g_qryparam.arg1 = g_site
            #CALL q_inab002_8()                    #呼叫開窗
            #提供所有儲位資訊
            CALL q_inab002_11()
            #02749  150116  add ----------------------(E)
            DISPLAY g_qryparam.return1 TO xmeh214  #顯示到畫面上
            NEXT FIELD xmeh214                     #返回原欄位
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh214
            #add-point:BEFORE FIELD xmeh214 name="construct.b.page3.xmeh214"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh214
            
            #add-point:AFTER FIELD xmeh214 name="construct.a.page3.xmeh214"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh215
            #add-point:BEFORE FIELD xmeh215 name="construct.b.page3.xmeh215"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh215
            
            #add-point:AFTER FIELD xmeh215 name="construct.a.page3.xmeh215"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh215
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh215
            #add-point:ON ACTION controlp INFIELD xmeh215 name="construct.c.page3.xmeh215"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh031
            #add-point:BEFORE FIELD xmeh031 name="construct.b.page3.xmeh031"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh031
            
            #add-point:AFTER FIELD xmeh031 name="construct.a.page3.xmeh031"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh031
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh031
            #add-point:ON ACTION controlp INFIELD xmeh031 name="construct.c.page3.xmeh031"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh014
            #add-point:BEFORE FIELD xmeh014 name="construct.b.page3.xmeh014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh014
            
            #add-point:AFTER FIELD xmeh014 name="construct.a.page3.xmeh014"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh014
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh014
            #add-point:ON ACTION controlp INFIELD xmeh014 name="construct.c.page3.xmeh014"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh015
            #add-point:BEFORE FIELD xmeh015 name="construct.b.page3.xmeh015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh015
            
            #add-point:AFTER FIELD xmeh015 name="construct.a.page3.xmeh015"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh015
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh015
            #add-point:ON ACTION controlp INFIELD xmeh015 name="construct.c.page3.xmeh015"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh016
            #add-point:BEFORE FIELD xmeh016 name="construct.b.page3.xmeh016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh016
            
            #add-point:AFTER FIELD xmeh016 name="construct.a.page3.xmeh016"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh016
            #add-point:ON ACTION controlp INFIELD xmeh016 name="construct.c.page3.xmeh016"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh017
            #add-point:ON ACTION controlp INFIELD xmeh017 name="construct.c.page3.xmeh017"
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_oodb002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh017  #顯示到畫面上

            NEXT FIELD xmeh017                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh017
            #add-point:BEFORE FIELD xmeh017 name="construct.b.page3.xmeh017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh017
            
            #add-point:AFTER FIELD xmeh017 name="construct.a.page3.xmeh017"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh221
            #add-point:BEFORE FIELD xmeh221 name="construct.b.page3.xmeh221"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh221
            
            #add-point:AFTER FIELD xmeh221 name="construct.a.page3.xmeh221"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh221
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh221
            #add-point:ON ACTION controlp INFIELD xmeh221 name="construct.c.page3.xmeh221"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmehsite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmehsite
            #add-point:ON ACTION controlp INFIELD xmehsite name="construct.c.page3.xmehsite"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
#            LET g_qryparam.arg1 = g_site
#			   LET g_qryparam.arg2 = '2'
#            CALL q_ooed004_3()                           #呼叫開窗
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmehsite',g_site,'c') #150308-00001#1  By Ken add 'c' 150309
            CALL q_ooef001_24()
            DISPLAY g_qryparam.return1 TO xmehsite  #顯示到畫面上
            NEXT FIELD xmehsite                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmehsite
            #add-point:BEFORE FIELD xmehsite name="construct.b.page3.xmehsite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmehsite
            
            #add-point:AFTER FIELD xmehsite name="construct.a.page3.xmehsite"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh218
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh218
            #add-point:ON ACTION controlp INFIELD xmeh218 name="construct.c.page3.xmeh218"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "1"
            CALL q_oojd001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh218  #顯示到畫面上
            NEXT FIELD xmeh218                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh218
            #add-point:BEFORE FIELD xmeh218 name="construct.b.page3.xmeh218"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh218
            
            #add-point:AFTER FIELD xmeh218 name="construct.a.page3.xmeh218"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh219
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh219
            #add-point:ON ACTION controlp INFIELD xmeh219 name="construct.c.page3.xmeh219"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_dbba001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh219  #顯示到畫面上
            NEXT FIELD xmeh219                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh219
            #add-point:BEFORE FIELD xmeh219 name="construct.b.page3.xmeh219"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh219
            
            #add-point:AFTER FIELD xmeh219 name="construct.a.page3.xmeh219"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh220
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh220
            #add-point:ON ACTION controlp INFIELD xmeh220 name="construct.c.page3.xmeh220"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_dbbc001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh220  #顯示到畫面上
            NEXT FIELD xmeh220                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh220
            #add-point:BEFORE FIELD xmeh220 name="construct.b.page3.xmeh220"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh220
            
            #add-point:AFTER FIELD xmeh220 name="construct.a.page3.xmeh220"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh222
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh222
            #add-point:ON ACTION controlp INFIELD xmeh222 name="construct.c.page3.xmeh222"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "G"
            CALL q_ooef001_3()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh222  #顯示到畫面上
            NEXT FIELD xmeh222                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh222
            #add-point:BEFORE FIELD xmeh222 name="construct.b.page3.xmeh222"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh222
            
            #add-point:AFTER FIELD xmeh222 name="construct.a.page3.xmeh222"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh223
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh223
            #add-point:ON ACTION controlp INFIELD xmeh223 name="construct.c.page3.xmeh223"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh223  #顯示到畫面上
            NEXT FIELD xmeh223                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh223
            #add-point:BEFORE FIELD xmeh223 name="construct.b.page3.xmeh223"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh223
            
            #add-point:AFTER FIELD xmeh223 name="construct.a.page3.xmeh223"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh224
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh224
            #add-point:ON ACTION controlp INFIELD xmeh224 name="construct.c.page3.xmeh224"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_xmee_m.xmeedocdt
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh224  #顯示到畫面上
            NEXT FIELD xmeh224                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh224
            #add-point:BEFORE FIELD xmeh224 name="construct.b.page3.xmeh224"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh224
            
            #add-point:AFTER FIELD xmeh224 name="construct.a.page3.xmeh224"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmehorga
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmehorga
            #add-point:ON ACTION controlp INFIELD xmehorga name="construct.c.page3.xmehorga"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "A"
            CALL q_ooef001_3()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmehorga  #顯示到畫面上
            NEXT FIELD xmehorga                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmehorga
            #add-point:BEFORE FIELD xmehorga name="construct.b.page3.xmehorga"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmehorga
            
            #add-point:AFTER FIELD xmehorga name="construct.a.page3.xmehorga"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh226
            #add-point:BEFORE FIELD xmeh226 name="construct.b.page3.xmeh226"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh226
            
            #add-point:AFTER FIELD xmeh226 name="construct.a.page3.xmeh226"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh226
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh226
            #add-point:ON ACTION controlp INFIELD xmeh226 name="construct.c.page3.xmeh226"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page3.xmeh227
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh227
            #add-point:ON ACTION controlp INFIELD xmeh227 name="construct.c.page3.xmeh227"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "2060"
            CALL q_oocq002_5()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh227  #顯示到畫面上
            NEXT FIELD xmeh227                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh227
            #add-point:BEFORE FIELD xmeh227 name="construct.b.page3.xmeh227"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh227
            
            #add-point:AFTER FIELD xmeh227 name="construct.a.page3.xmeh227"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh228
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh228
            #add-point:ON ACTION controlp INFIELD xmeh228 name="construct.c.page3.xmeh228"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_staa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmeh228  #顯示到畫面上
            NEXT FIELD xmeh228                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh228
            #add-point:BEFORE FIELD xmeh228 name="construct.b.page3.xmeh228"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh228
            
            #add-point:AFTER FIELD xmeh228 name="construct.a.page3.xmeh228"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeh901
            #add-point:BEFORE FIELD xmeh901 name="construct.b.page3.xmeh901"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeh901
            
            #add-point:AFTER FIELD xmeh901 name="construct.a.page3.xmeh901"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xmeh901
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeh901
            #add-point:ON ACTION controlp INFIELD xmeh901 name="construct.c.page3.xmeh901"
            
            #END add-point
 
 
   
       
      END CONSTRUCT
 
      CONSTRUCT g_wc2_table4 ON xmjbseq,xmjbsite,xmjb001,xmjb002,xmjb003,xmjb033,xmjb004,xmjb005,xmjb006, 
          xmjb006_desc,xmjb007,xmjb011,xmjb012,xmjb013,xmjb014,xmjb015,xmjb016,xmjb017,xmjb018,xmjb008, 
          xmjb009,xmjb010,xmjb022,xmjb019,xmjb020,xmjb021,xmjb024,xmjb025,xmjb026,xmjb027,xmjb028,xmjb029, 
          xmjb030,xmjb031,xmjb032,xmjb040,xmjb039,xmjb038,xmjb037,xmjb034,xmjb901,xmjb902,xmjb903
           FROM s_detail4[1].xmjbseq,s_detail4[1].xmjbsite,s_detail4[1].xmjb001,s_detail4[1].xmjb002, 
               s_detail4[1].xmjb003,s_detail4[1].xmjb033,s_detail4[1].xmjb004,s_detail4[1].xmjb005,s_detail4[1].xmjb006, 
               s_detail4[1].xmjb006_desc,s_detail4[1].xmjb007,s_detail4[1].xmjb011,s_detail4[1].xmjb012, 
               s_detail4[1].xmjb013,s_detail4[1].xmjb014,s_detail4[1].xmjb015,s_detail4[1].xmjb016,s_detail4[1].xmjb017, 
               s_detail4[1].xmjb018,s_detail4[1].xmjb008,s_detail4[1].xmjb009,s_detail4[1].xmjb010,s_detail4[1].xmjb022, 
               s_detail4[1].xmjb019,s_detail4[1].xmjb020,s_detail4[1].xmjb021,s_detail4[1].xmjb024,s_detail4[1].xmjb025, 
               s_detail4[1].xmjb026,s_detail4[1].xmjb027,s_detail4[1].xmjb028,s_detail4[1].xmjb029,s_detail4[1].xmjb030, 
               s_detail4[1].xmjb031,s_detail4[1].xmjb032,s_detail4[1].xmjb040,s_detail4[1].xmjb039,s_detail4[1].xmjb038, 
               s_detail4[1].xmjb037,s_detail4[1].xmjb034,s_detail4[1].xmjb901,s_detail4[1].xmjb902,s_detail4[1].xmjb903 
 
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body4.before_construct"
            
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 4)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjbseq
            #add-point:BEFORE FIELD xmjbseq name="construct.b.page4.xmjbseq"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjbseq
            
            #add-point:AFTER FIELD xmjbseq name="construct.a.page4.xmjbseq"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjbseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjbseq
            #add-point:ON ACTION controlp INFIELD xmjbseq name="construct.c.page4.xmjbseq"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjbsite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjbsite
            #add-point:ON ACTION controlp INFIELD xmjbsite name="construct.c.page4.xmjbsite"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
#            LET g_qryparam.arg1 = g_site
#			   LET g_qryparam.arg2 = '2'
#            CALL q_ooed004_3()                           #呼叫開窗
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmjbsite',g_site,'c') #150308-00001#1  By Ken add 'c' 150309
            CALL q_ooef001_24()
            DISPLAY g_qryparam.return1 TO xmjbsite  #顯示到畫面上
            NEXT FIELD xmjbsite                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjbsite
            #add-point:BEFORE FIELD xmjbsite name="construct.b.page4.xmjbsite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjbsite
            
            #add-point:AFTER FIELD xmjbsite name="construct.a.page4.xmjbsite"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb001
            #add-point:BEFORE FIELD xmjb001 name="construct.b.page4.xmjb001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb001
            
            #add-point:AFTER FIELD xmjb001 name="construct.a.page4.xmjb001"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb001
            #add-point:ON ACTION controlp INFIELD xmjb001 name="construct.c.page4.xmjb001"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb002
            #add-point:ON ACTION controlp INFIELD xmjb002 name="construct.c.page4.xmjb002"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_imay003_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb002  #顯示到畫面上
            NEXT FIELD xmjb002                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb002
            #add-point:BEFORE FIELD xmjb002 name="construct.b.page4.xmjb002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb002
            
            #add-point:AFTER FIELD xmjb002 name="construct.a.page4.xmjb002"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb003
            #add-point:ON ACTION controlp INFIELD xmjb003 name="construct.c.page4.xmjb003"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_imaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb003  #顯示到畫面上
            NEXT FIELD xmjb003                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb003
            #add-point:BEFORE FIELD xmjb003 name="construct.b.page4.xmjb003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb003
            
            #add-point:AFTER FIELD xmjb003 name="construct.a.page4.xmjb003"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb033
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb033
            #add-point:ON ACTION controlp INFIELD xmjb033 name="construct.c.page4.xmjb033"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmao004_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb033  #顯示到畫面上
            NEXT FIELD xmjb033                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb033
            #add-point:BEFORE FIELD xmjb033 name="construct.b.page4.xmjb033"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb033
            
            #add-point:AFTER FIELD xmjb033 name="construct.a.page4.xmjb033"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb004
            #add-point:ON ACTION controlp INFIELD xmjb004 name="construct.c.page4.xmjb004"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_xmja004()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb004  #顯示到畫面上
            NEXT FIELD xmjb004                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb004
            #add-point:BEFORE FIELD xmjb004 name="construct.b.page4.xmjb004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb004
            
            #add-point:AFTER FIELD xmjb004 name="construct.a.page4.xmjb004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb005
            #add-point:ON ACTION controlp INFIELD xmjb005 name="construct.c.page4.xmjb005"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_prcf001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb005  #顯示到畫面上
            NEXT FIELD xmjb005                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb005
            #add-point:BEFORE FIELD xmjb005 name="construct.b.page4.xmjb005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb005
            
            #add-point:AFTER FIELD xmjb005 name="construct.a.page4.xmjb005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb006
            #add-point:ON ACTION controlp INFIELD xmjb006 name="construct.c.page4.xmjb006"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oodb002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb006  #顯示到畫面上
            NEXT FIELD xmjb006                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb006
            #add-point:BEFORE FIELD xmjb006 name="construct.b.page4.xmjb006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb006
            
            #add-point:AFTER FIELD xmjb006 name="construct.a.page4.xmjb006"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb006_desc
            #add-point:BEFORE FIELD xmjb006_desc name="construct.b.page4.xmjb006_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb006_desc
            
            #add-point:AFTER FIELD xmjb006_desc name="construct.a.page4.xmjb006_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb006_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb006_desc
            #add-point:ON ACTION controlp INFIELD xmjb006_desc name="construct.c.page4.xmjb006_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb007
            #add-point:BEFORE FIELD xmjb007 name="construct.b.page4.xmjb007"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb007
            
            #add-point:AFTER FIELD xmjb007 name="construct.a.page4.xmjb007"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb007
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb007
            #add-point:ON ACTION controlp INFIELD xmjb007 name="construct.c.page4.xmjb007"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb011
            #add-point:ON ACTION controlp INFIELD xmjb011 name="construct.c.page4.xmjb011"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb011  #顯示到畫面上
            NEXT FIELD xmjb011                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb011
            #add-point:BEFORE FIELD xmjb011 name="construct.b.page4.xmjb011"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb011
            
            #add-point:AFTER FIELD xmjb011 name="construct.a.page4.xmjb011"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb012
            #add-point:BEFORE FIELD xmjb012 name="construct.b.page4.xmjb012"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb012
            
            #add-point:AFTER FIELD xmjb012 name="construct.a.page4.xmjb012"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb012
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb012
            #add-point:ON ACTION controlp INFIELD xmjb012 name="construct.c.page4.xmjb012"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb013
            #add-point:ON ACTION controlp INFIELD xmjb013 name="construct.c.page4.xmjb013"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb013  #顯示到畫面上
            NEXT FIELD xmjb013                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb013
            #add-point:BEFORE FIELD xmjb013 name="construct.b.page4.xmjb013"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb013
            
            #add-point:AFTER FIELD xmjb013 name="construct.a.page4.xmjb013"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb014
            #add-point:BEFORE FIELD xmjb014 name="construct.b.page4.xmjb014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb014
            
            #add-point:AFTER FIELD xmjb014 name="construct.a.page4.xmjb014"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb014
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb014
            #add-point:ON ACTION controlp INFIELD xmjb014 name="construct.c.page4.xmjb014"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb015
            #add-point:ON ACTION controlp INFIELD xmjb015 name="construct.c.page4.xmjb015"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb015  #顯示到畫面上
            NEXT FIELD xmjb015                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb015
            #add-point:BEFORE FIELD xmjb015 name="construct.b.page4.xmjb015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb015
            
            #add-point:AFTER FIELD xmjb015 name="construct.a.page4.xmjb015"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb016
            #add-point:BEFORE FIELD xmjb016 name="construct.b.page4.xmjb016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb016
            
            #add-point:AFTER FIELD xmjb016 name="construct.a.page4.xmjb016"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb016
            #add-point:ON ACTION controlp INFIELD xmjb016 name="construct.c.page4.xmjb016"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb017
            #add-point:ON ACTION controlp INFIELD xmjb017 name="construct.c.page4.xmjb017"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb017  #顯示到畫面上
            NEXT FIELD xmjb017                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb017
            #add-point:BEFORE FIELD xmjb017 name="construct.b.page4.xmjb017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb017
            
            #add-point:AFTER FIELD xmjb017 name="construct.a.page4.xmjb017"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb018
            #add-point:BEFORE FIELD xmjb018 name="construct.b.page4.xmjb018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb018
            
            #add-point:AFTER FIELD xmjb018 name="construct.a.page4.xmjb018"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb018
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb018
            #add-point:ON ACTION controlp INFIELD xmjb018 name="construct.c.page4.xmjb018"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb008
            #add-point:BEFORE FIELD xmjb008 name="construct.b.page4.xmjb008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb008
            
            #add-point:AFTER FIELD xmjb008 name="construct.a.page4.xmjb008"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb008
            #add-point:ON ACTION controlp INFIELD xmjb008 name="construct.c.page4.xmjb008"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb009
            #add-point:BEFORE FIELD xmjb009 name="construct.b.page4.xmjb009"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb009
            
            #add-point:AFTER FIELD xmjb009 name="construct.a.page4.xmjb009"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb009
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb009
            #add-point:ON ACTION controlp INFIELD xmjb009 name="construct.c.page4.xmjb009"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb010
            #add-point:BEFORE FIELD xmjb010 name="construct.b.page4.xmjb010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb010
            
            #add-point:AFTER FIELD xmjb010 name="construct.a.page4.xmjb010"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb010
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb010
            #add-point:ON ACTION controlp INFIELD xmjb010 name="construct.c.page4.xmjb010"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb022
            #add-point:BEFORE FIELD xmjb022 name="construct.b.page4.xmjb022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb022
            
            #add-point:AFTER FIELD xmjb022 name="construct.a.page4.xmjb022"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb022
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb022
            #add-point:ON ACTION controlp INFIELD xmjb022 name="construct.c.page4.xmjb022"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb019
            #add-point:BEFORE FIELD xmjb019 name="construct.b.page4.xmjb019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb019
            
            #add-point:AFTER FIELD xmjb019 name="construct.a.page4.xmjb019"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb019
            #add-point:ON ACTION controlp INFIELD xmjb019 name="construct.c.page4.xmjb019"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb020
            #add-point:BEFORE FIELD xmjb020 name="construct.b.page4.xmjb020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb020
            
            #add-point:AFTER FIELD xmjb020 name="construct.a.page4.xmjb020"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb020
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb020
            #add-point:ON ACTION controlp INFIELD xmjb020 name="construct.c.page4.xmjb020"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb021
            #add-point:BEFORE FIELD xmjb021 name="construct.b.page4.xmjb021"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb021
            
            #add-point:AFTER FIELD xmjb021 name="construct.a.page4.xmjb021"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb021
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb021
            #add-point:ON ACTION controlp INFIELD xmjb021 name="construct.c.page4.xmjb021"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb024
            #add-point:ON ACTION controlp INFIELD xmjb024 name="construct.c.page4.xmjb024"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001_18()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb024  #顯示到畫面上
            NEXT FIELD xmjb024                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb024
            #add-point:BEFORE FIELD xmjb024 name="construct.b.page4.xmjb024"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb024
            
            #add-point:AFTER FIELD xmjb024 name="construct.a.page4.xmjb024"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb025
            #add-point:BEFORE FIELD xmjb025 name="construct.b.page4.xmjb025"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb025
            
            #add-point:AFTER FIELD xmjb025 name="construct.a.page4.xmjb025"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb025
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb025
            #add-point:ON ACTION controlp INFIELD xmjb025 name="construct.c.page4.xmjb025"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb026
            #add-point:ON ACTION controlp INFIELD xmjb026 name="construct.c.page4.xmjb026"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oofb019()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb026  #顯示到畫面上
            NEXT FIELD xmjb026                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb026
            #add-point:BEFORE FIELD xmjb026 name="construct.b.page4.xmjb026"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb026
            
            #add-point:AFTER FIELD xmjb026 name="construct.a.page4.xmjb026"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb027
            #add-point:ON ACTION controlp INFIELD xmjb027 name="construct.c.page4.xmjb027"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_dbad001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb027  #顯示到畫面上
            NEXT FIELD xmjb027                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb027
            #add-point:BEFORE FIELD xmjb027 name="construct.b.page4.xmjb027"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb027
            
            #add-point:AFTER FIELD xmjb027 name="construct.a.page4.xmjb027"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb028
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb028
            #add-point:ON ACTION controlp INFIELD xmjb028 name="construct.c.page4.xmjb028"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_stce001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb028  #顯示到畫面上
            NEXT FIELD xmjb028                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb028
            #add-point:BEFORE FIELD xmjb028 name="construct.b.page4.xmjb028"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb028
            
            #add-point:AFTER FIELD xmjb028 name="construct.a.page4.xmjb028"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb029
            #add-point:BEFORE FIELD xmjb029 name="construct.b.page4.xmjb029"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb029
            
            #add-point:AFTER FIELD xmjb029 name="construct.a.page4.xmjb029"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb029
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb029
            #add-point:ON ACTION controlp INFIELD xmjb029 name="construct.c.page4.xmjb029"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb030
            #add-point:BEFORE FIELD xmjb030 name="construct.b.page4.xmjb030"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb030
            
            #add-point:AFTER FIELD xmjb030 name="construct.a.page4.xmjb030"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb030
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb030
            #add-point:ON ACTION controlp INFIELD xmjb030 name="construct.c.page4.xmjb030"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb031
            #add-point:BEFORE FIELD xmjb031 name="construct.b.page4.xmjb031"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb031
            
            #add-point:AFTER FIELD xmjb031 name="construct.a.page4.xmjb031"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb031
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb031
            #add-point:ON ACTION controlp INFIELD xmjb031 name="construct.c.page4.xmjb031"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb032
            #add-point:BEFORE FIELD xmjb032 name="construct.b.page4.xmjb032"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb032
            
            #add-point:AFTER FIELD xmjb032 name="construct.a.page4.xmjb032"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb032
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb032
            #add-point:ON ACTION controlp INFIELD xmjb032 name="construct.c.page4.xmjb032"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb040
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb040
            #add-point:ON ACTION controlp INFIELD xmjb040 name="construct.c.page4.xmjb040"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '1'
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb040  #顯示到畫面上
            NEXT FIELD xmjb040                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb040
            #add-point:BEFORE FIELD xmjb040 name="construct.b.page4.xmjb040"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb040
            
            #add-point:AFTER FIELD xmjb040 name="construct.a.page4.xmjb040"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb039
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb039
            #add-point:ON ACTION controlp INFIELD xmjb039 name="construct.c.page4.xmjb039"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '2'
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb039  #顯示到畫面上
            NEXT FIELD xmjb039                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb039
            #add-point:BEFORE FIELD xmjb039 name="construct.b.page4.xmjb039"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb039
            
            #add-point:AFTER FIELD xmjb039 name="construct.a.page4.xmjb039"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb038
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb038
            #add-point:ON ACTION controlp INFIELD xmjb038 name="construct.c.page4.xmjb038"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '3'
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb038  #顯示到畫面上
            NEXT FIELD xmjb038                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb038
            #add-point:BEFORE FIELD xmjb038 name="construct.b.page4.xmjb038"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb038
            
            #add-point:AFTER FIELD xmjb038 name="construct.a.page4.xmjb038"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb037
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb037
            #add-point:ON ACTION controlp INFIELD xmjb037 name="construct.c.page4.xmjb037"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '4'
            CALL q_dbaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb037  #顯示到畫面上
            NEXT FIELD xmjb037                     #返回原欄位
   


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb037
            #add-point:BEFORE FIELD xmjb037 name="construct.b.page4.xmjb037"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb037
            
            #add-point:AFTER FIELD xmjb037 name="construct.a.page4.xmjb037"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb034
            #add-point:BEFORE FIELD xmjb034 name="construct.b.page4.xmjb034"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb034
            
            #add-point:AFTER FIELD xmjb034 name="construct.a.page4.xmjb034"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb034
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb034
            #add-point:ON ACTION controlp INFIELD xmjb034 name="construct.c.page4.xmjb034"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb901
            #add-point:BEFORE FIELD xmjb901 name="construct.b.page4.xmjb901"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb901
            
            #add-point:AFTER FIELD xmjb901 name="construct.a.page4.xmjb901"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb901
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb901
            #add-point:ON ACTION controlp INFIELD xmjb901 name="construct.c.page4.xmjb901"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xmjb902
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb902
            #add-point:ON ACTION controlp INFIELD xmjb902 name="construct.c.page4.xmjb902"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #02749  150122 add ----------------------(S)
            #LET g_qryparam.arg1 = '267'
            LET g_qryparam.arg1 = g_acc_282
            #02749  150122 add ----------------------(E)
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmjb902  #顯示到畫面上
            NEXT FIELD xmjb902                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb902
            #add-point:BEFORE FIELD xmjb902 name="construct.b.page4.xmjb902"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb902
            
            #add-point:AFTER FIELD xmjb902 name="construct.a.page4.xmjb902"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb903
            #add-point:BEFORE FIELD xmjb903 name="construct.b.page4.xmjb903"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb903
            
            #add-point:AFTER FIELD xmjb903 name="construct.a.page4.xmjb903"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xmjb903
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb903
            #add-point:ON ACTION controlp INFIELD xmjb903 name="construct.c.page4.xmjb903"
            
            #END add-point
 
 
   
       
      END CONSTRUCT
 
      CONSTRUCT g_wc2_table5 ON xmefsite,xmef001,xmef002,xmef003,xmef004,xmef005,xmef006,xmef016,xmef017, 
          xmef007,xmef008,xmef009,xmef901,xmef902,xmef903
           FROM s_detail5[1].xmefsite,s_detail5[1].xmef001,s_detail5[1].xmef002,s_detail5[1].xmef003, 
               s_detail5[1].xmef004,s_detail5[1].xmef005,s_detail5[1].xmef006,s_detail5[1].xmef016,s_detail5[1].xmef017, 
               s_detail5[1].xmef007,s_detail5[1].xmef008,s_detail5[1].xmef009,s_detail5[1].xmef901,s_detail5[1].xmef902, 
               s_detail5[1].xmef903
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body5.before_construct"
            
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 5)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmefsite
            #add-point:BEFORE FIELD xmefsite name="construct.b.page5.xmefsite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmefsite
            
            #add-point:AFTER FIELD xmefsite name="construct.a.page5.xmefsite"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmefsite
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmefsite
            #add-point:ON ACTION controlp INFIELD xmefsite name="construct.c.page5.xmefsite"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef001
            #add-point:BEFORE FIELD xmef001 name="construct.b.page5.xmef001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef001
            
            #add-point:AFTER FIELD xmef001 name="construct.a.page5.xmef001"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef001
            #add-point:ON ACTION controlp INFIELD xmef001 name="construct.c.page5.xmef001"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page5.xmef002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef002
            #add-point:ON ACTION controlp INFIELD xmef002 name="construct.c.page5.xmef002"
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooib002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmef002  #顯示到畫面上

            NEXT FIELD xmef002                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef002
            #add-point:BEFORE FIELD xmef002 name="construct.b.page5.xmef002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef002
            
            #add-point:AFTER FIELD xmef002 name="construct.a.page5.xmef002"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef003
            #add-point:BEFORE FIELD xmef003 name="construct.b.page5.xmef003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef003
            
            #add-point:AFTER FIELD xmef003 name="construct.a.page5.xmef003"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef003
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef003
            #add-point:ON ACTION controlp INFIELD xmef003 name="construct.c.page5.xmef003"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef004
            #add-point:BEFORE FIELD xmef004 name="construct.b.page5.xmef004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef004
            
            #add-point:AFTER FIELD xmef004 name="construct.a.page5.xmef004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef004
            #add-point:ON ACTION controlp INFIELD xmef004 name="construct.c.page5.xmef004"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef005
            #add-point:BEFORE FIELD xmef005 name="construct.b.page5.xmef005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef005
            
            #add-point:AFTER FIELD xmef005 name="construct.a.page5.xmef005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef005
            #add-point:ON ACTION controlp INFIELD xmef005 name="construct.c.page5.xmef005"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef006
            #add-point:BEFORE FIELD xmef006 name="construct.b.page5.xmef006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef006
            
            #add-point:AFTER FIELD xmef006 name="construct.a.page5.xmef006"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef006
            #add-point:ON ACTION controlp INFIELD xmef006 name="construct.c.page5.xmef006"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef016
            #add-point:BEFORE FIELD xmef016 name="construct.b.page5.xmef016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef016
            
            #add-point:AFTER FIELD xmef016 name="construct.a.page5.xmef016"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef016
            #add-point:ON ACTION controlp INFIELD xmef016 name="construct.c.page5.xmef016"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef017
            #add-point:BEFORE FIELD xmef017 name="construct.b.page5.xmef017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef017
            
            #add-point:AFTER FIELD xmef017 name="construct.a.page5.xmef017"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef017
            #add-point:ON ACTION controlp INFIELD xmef017 name="construct.c.page5.xmef017"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef007
            #add-point:BEFORE FIELD xmef007 name="construct.b.page5.xmef007"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef007
            
            #add-point:AFTER FIELD xmef007 name="construct.a.page5.xmef007"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef007
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef007
            #add-point:ON ACTION controlp INFIELD xmef007 name="construct.c.page5.xmef007"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef008
            #add-point:BEFORE FIELD xmef008 name="construct.b.page5.xmef008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef008
            
            #add-point:AFTER FIELD xmef008 name="construct.a.page5.xmef008"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef008
            #add-point:ON ACTION controlp INFIELD xmef008 name="construct.c.page5.xmef008"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef009
            #add-point:BEFORE FIELD xmef009 name="construct.b.page5.xmef009"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef009
            
            #add-point:AFTER FIELD xmef009 name="construct.a.page5.xmef009"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef009
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef009
            #add-point:ON ACTION controlp INFIELD xmef009 name="construct.c.page5.xmef009"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef901
            #add-point:BEFORE FIELD xmef901 name="construct.b.page5.xmef901"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef901
            
            #add-point:AFTER FIELD xmef901 name="construct.a.page5.xmef901"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef901
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef901
            #add-point:ON ACTION controlp INFIELD xmef901 name="construct.c.page5.xmef901"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page5.xmef902
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef902
            #add-point:ON ACTION controlp INFIELD xmef902 name="construct.c.page5.xmef902"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #02749  150121  add ----------------------(S)
            #LET g_qryparam.arg1 = '267'
            LET g_qryparam.arg1 = g_acc_282
            #02749  150121  add ----------------------(E)
            CALL q_oocq002()                       #呼叫開窗
            DISPLAY g_qryparam.return1 TO xmef902  #顯示到畫面上
            NEXT FIELD xmef902                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef902
            #add-point:BEFORE FIELD xmef902 name="construct.b.page5.xmef902"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef902
            
            #add-point:AFTER FIELD xmef902 name="construct.a.page5.xmef902"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef903
            #add-point:BEFORE FIELD xmef903 name="construct.b.page5.xmef903"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef903
            
            #add-point:AFTER FIELD xmef903 name="construct.a.page5.xmef903"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xmef903
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef903
            #add-point:ON ACTION controlp INFIELD xmef903 name="construct.c.page5.xmef903"
            
            #END add-point
 
 
   
       
      END CONSTRUCT
 
 
      
 
      
      #add-point:cs段add_cs(本段內只能出現新的CONSTRUCT指令) name="cs.add_cs"
      #170207-00004#2 170219 by 02749 mark---(S)
      #CONSTRUCT g_wc2_rtic ON
      #    rticseq,rtic001,rtic002,rtic003,rtic004,
      #    rtic005,rtic006,rtic007,rtic008,rtic009,
      #    rtic010,rtic011,rtic012,rtic013,rtic014,
      #    rtic015,rtic016,rtic017,rtic018,rtic019,
      #    rtic020,rtic021,rtic022,rtic023,rtic024,
      #    rtic025,rtic026,rtic027,rtic028,rtic029
      #    
      #     FROM s_detail2[1].rticseq,s_detail2[1].rtic001,s_detail2[1].rtic002,s_detail2[1].rtic003,s_detail2[1].rtic004,
      #          s_detail2[1].rtic005,s_detail2[1].rtic006,s_detail2[1].rtic007,s_detail2[1].rtic008,s_detail2[1].rtic009,
      #          s_detail2[1].rtic010,s_detail2[1].rtic011,s_detail2[1].rtic012,s_detail2[1].rtic013,s_detail2[1].rtic014,
      #          s_detail2[1].rtic015,s_detail2[1].rtic016,s_detail2[1].rtic017,s_detail2[1].rtic018,s_detail2[1].rtic019,
      #          s_detail2[1].rtic020,s_detail2[1].rtic021,s_detail2[1].rtic022,s_detail2[1].rtic023,s_detail2[1].rtic024,
      #          s_detail2[1].rtic025,s_detail2[1].rtic026,s_detail2[1].rtic027,s_detail2[1].rtic028,s_detail2[1].rtic029
      #          
      #END CONSTRUCT
      #170207-00004#2 170219 by 02749 mark---(E)
      #end add-point
 
      BEFORE DIALOG
         CALL cl_qbe_init()
         #add-point:cs段b_dialog name="cs.b_dialog"
         LET g_xmeg_d[1].xmegseq = ""
         DISPLAY ARRAY g_xmeg_d TO s_detail1.*
            BEFORE DISPLAY
               EXIT DISPLAY
         END DISPLAY  
         LET g_xmeg3_d[1].xmehseq = ""
         DISPLAY ARRAY g_xmeg3_d TO s_detail3.*
            BEFORE DISPLAY
               EXIT DISPLAY
         END DISPLAY  
         LET g_xmeg4_d[1].xmjbseq = ""
         DISPLAY ARRAY g_xmeg4_d TO s_detail4.*
            BEFORE DISPLAY
               EXIT DISPLAY
         END DISPLAY          
         #end add-point  
 
      #查詢方案列表
      ON ACTION qbe_select
         LET ls_wc = ""
         CALL cl_qbe_list("c") RETURNING ls_wc
         IF NOT cl_null(ls_wc) THEN
            CALL util.JSON.parse(ls_wc, la_wc)
            INITIALIZE g_wc, g_wc2, g_wc2_table1, g_wc2_extend TO NULL
            INITIALIZE g_wc2_table2 TO NULL
 
            INITIALIZE g_wc2_table3 TO NULL
 
            INITIALIZE g_wc2_table4 TO NULL
 
            INITIALIZE g_wc2_table5 TO NULL
 
 
            FOR li_idx = 1 TO la_wc.getLength()
               CASE
                  WHEN la_wc[li_idx].tableid = "xmee_t" 
                     LET g_wc = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "xmeg_t" 
                     LET g_wc2_table1 = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "rtic_t" 
                     LET g_wc2_table2 = la_wc[li_idx].wc
 
                  WHEN la_wc[li_idx].tableid = "xmeh_t" 
                     LET g_wc2_table3 = la_wc[li_idx].wc
 
                  WHEN la_wc[li_idx].tableid = "xmjb_t" 
                     LET g_wc2_table4 = la_wc[li_idx].wc
 
                  WHEN la_wc[li_idx].tableid = "xmef_t" 
                     LET g_wc2_table5 = la_wc[li_idx].wc
 
 
               END CASE
            END FOR
         END IF
    
      #條件儲存為方案
      ON ACTION qbe_save
         CALL cl_qbe_save()
 
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   END DIALOG
   
   #組合g_wc2
   LET g_wc2 = g_wc2_table1
   IF g_wc2_table2 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
   END IF
 
   IF g_wc2_table3 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
   END IF
 
   IF g_wc2_table4 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table4
   END IF
 
   IF g_wc2_table5 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table5
   END IF
 
 
 
 
   
   #add-point:cs段結束前 name="cs.after_construct"
   #170207-00004#2 170219 by 02749 mark---(S)
   #IF g_wc2_rtic <> " 1=1" THEN
   #   LET g_wc2 = g_wc2 ," AND ", g_wc2_rtic
   #END IF
   #170207-00004#2 170219 by 02749 marl---(E)
   #end add-point    
 
   IF INT_FLAG THEN
      RETURN
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.filter" >}
#應用 a50 樣板自動產生(Version:8)
#+ filter過濾功能
PRIVATE FUNCTION adbt510_filter()
   #add-point:filter段define name="filter.define_customerization"
   
   #end add-point   
   #add-point:filter段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="filter.define"
                  
   #end add-point   
   
   #add-point:Function前置處理  name="filter.pre_function"
   
   #end add-point
   
   #切換畫面
   IF NOT g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF   
 
   LET INT_FLAG = 0
 
   LET g_qryparam.state = 'c'
 
   LET g_wc_filter_t = g_wc_filter.trim()
   LET g_wc_t = g_wc
 
   LET g_wc = cl_replace_str(g_wc, g_wc_filter_t, '')
 
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
      #單頭
      CONSTRUCT g_wc_filter ON xmeedocno,xmee900,xmeedocdt,xmee001,xmee002,xmee003,xmee004
                          FROM s_browse[1].b_xmeedocno,s_browse[1].b_xmee900,s_browse[1].b_xmeedocdt, 
                              s_browse[1].b_xmee001,s_browse[1].b_xmee002,s_browse[1].b_xmee003,s_browse[1].b_xmee004 
 
 
         BEFORE CONSTRUCT
               DISPLAY adbt510_filter_parser('xmeedocno') TO s_browse[1].b_xmeedocno
            DISPLAY adbt510_filter_parser('xmee900') TO s_browse[1].b_xmee900
            DISPLAY adbt510_filter_parser('xmeedocdt') TO s_browse[1].b_xmeedocdt
            DISPLAY adbt510_filter_parser('xmee001') TO s_browse[1].b_xmee001
            DISPLAY adbt510_filter_parser('xmee002') TO s_browse[1].b_xmee002
            DISPLAY adbt510_filter_parser('xmee003') TO s_browse[1].b_xmee003
            DISPLAY adbt510_filter_parser('xmee004') TO s_browse[1].b_xmee004
      
         #add-point:filter段cs_ctrl name="filter.cs_ctrl"
         
         #end add-point
      
      END CONSTRUCT
 
      #add-point:filter段add_cs name="filter.add_cs"
                                    
      #end add-point
 
      BEFORE DIALOG
         #add-point:filter段b_dialog name="filter.b_dialog"
                                                      
         #end add-point  
      
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   
   END DIALOG
 
   IF NOT INT_FLAG THEN
      LET g_wc_filter = "   AND   ", g_wc_filter, "   "
      LET g_wc = g_wc , g_wc_filter
   ELSE
      LET g_wc_filter = g_wc_filter_t
      LET g_wc = g_wc_t
   END IF
 
      CALL adbt510_filter_show('xmeedocno')
   CALL adbt510_filter_show('xmee900')
   CALL adbt510_filter_show('xmeedocdt')
   CALL adbt510_filter_show('xmee001')
   CALL adbt510_filter_show('xmee002')
   CALL adbt510_filter_show('xmee003')
   CALL adbt510_filter_show('xmee004')
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.filter_parser" >}
#+ filter過濾功能
PRIVATE FUNCTION adbt510_filter_parser(ps_field)
   #add-point:filter段define name="filter_parser.define_customerization"
   
   #end add-point    
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num10
   DEFINE li_tmp2    LIKE type_t.num10
   DEFINE ls_var     STRING
   #add-point:filter段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="filter_parser.define"
                  
   #end add-point    
   
   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF
 
   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF
 
   RETURN ls_var
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.filter_show" >}
#+ 顯示過濾條件
PRIVATE FUNCTION adbt510_filter_show(ps_field)
   DEFINE ps_field         STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING
 
   LET ls_name = "formonly.b_", ps_field
   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LEt ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF
 
   #顯示資料組合
   LET ls_condition = adbt510_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF
 
   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.query" >}
#+ 資料查詢QBE功能準備
PRIVATE FUNCTION adbt510_query()
   #add-point:query段define(客製用) name="query.define_customerization"
   
   #end add-point   
   DEFINE ls_wc STRING
   #add-point:query段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="query.define"
                  
   #end add-point   
   
   #add-point:Function前置處理  name="query.pre_function"
   
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF   
   
   LET ls_wc = g_wc
   
   LET INT_FLAG = 0
   CALL cl_navigator_setting( g_current_idx, g_detail_cnt )
   ERROR ""
   
   #清除畫面及相關資料
   CLEAR FORM
   CALL g_browser.clear()       
   CALL g_xmeg_d.clear()
   CALL g_xmeg2_d.clear()
   CALL g_xmeg3_d.clear()
   CALL g_xmeg4_d.clear()
   CALL g_xmeg5_d.clear()
 
   
   #add-point:query段other name="query.other"
                  
   #end add-point   
   
   DISPLAY '' TO FORMONLY.idx
   DISPLAY '' TO FORMONLY.cnt
   DISPLAY '' TO FORMONLY.b_index
   DISPLAY '' TO FORMONLY.b_count
   DISPLAY '' TO FORMONLY.h_index
   DISPLAY '' TO FORMONLY.h_count
   
   CALL adbt510_construct()
 
   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      #LET g_wc = ls_wc
      LET g_wc = " 1=2"
      CALL adbt510_browser_fill("")
      CALL adbt510_fetch("")
      RETURN
   END IF
   
   #儲存WC資訊
   CALL cl_dlg_save_user_latestqry("("||g_wc||") AND ("||g_wc2||")")
   
   #搜尋後資料初始化 
   LET g_detail_cnt  = 0
   LET g_current_idx = 1
   LET g_current_row = 0
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   LET g_detail_idx_list[1] = 1
   LET g_detail_idx_list[2] = 1
   LET g_detail_idx_list[3] = 1
   LET g_detail_idx_list[4] = 1
   LET g_detail_idx_list[5] = 1
 
   LET g_error_show  = 1
   LET g_wc_filter   = ""
   LET l_ac = 1
   CALL FGL_SET_ARR_CURR(1)
      CALL adbt510_filter_show('xmeedocno')
   CALL adbt510_filter_show('xmee900')
   CALL adbt510_filter_show('xmeedocdt')
   CALL adbt510_filter_show('xmee001')
   CALL adbt510_filter_show('xmee002')
   CALL adbt510_filter_show('xmee003')
   CALL adbt510_filter_show('xmee004')
   CALL adbt510_browser_fill("F")
         
   IF g_browser_cnt = 0 THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "-100" 
      LET g_errparam.popup = TRUE 
      CALL cl_err()
   ELSE
      CALL adbt510_fetch("F") 
      #顯示單身筆數
      CALL adbt510_idx_chk()
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.fetch" >}
#+ 指定PK後抓取單頭其他資料
PRIVATE FUNCTION adbt510_fetch(p_flag)
   #add-point:fetch段define(客製用) name="fetch.define_customerization"
   
   #end add-point    
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   #add-point:fetch段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="fetch.define"
   DEFINE l_pmaa004  LIKE pmaa_t.pmaa004 
   DEFINE l_success  LIKE type_t.num5
   DEFINE l_flag     LIKE type_t.num5  
   #end add-point    
   
   #add-point:Function前置處理  name="fetch.pre_function"
   
   #end add-point
   
   IF g_browser_cnt = 0 THEN
      RETURN
   END IF
 
   #清空第二階單身
 
   
   CALL cl_ap_performance_next_start()
   CASE p_flag
      WHEN 'F' 
         LET g_current_idx = 1
      WHEN 'L'  
         LET g_current_idx = g_browser.getLength()              
      WHEN 'P'
         IF g_current_idx > 1 THEN               
            LET g_current_idx = g_current_idx - 1
         END IF 
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF        
      WHEN '/'
         IF (NOT g_no_ask) THEN    
            CALL cl_set_act_visible("accept,cancel", TRUE)    
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0
 
            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl" 
            END PROMPT
 
            CALL cl_set_act_visible("accept,cancel", FALSE)    
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE  
            END IF           
         END IF
         
         IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
             LET g_current_idx = g_jump
         END IF
         LET g_no_ask = FALSE  
   END CASE 
 
   CALL g_curr_diag.setCurrentRow("s_browse", g_current_idx) #設定browse 索引
   
   LET g_current_row = g_current_idx
   LET g_detail_cnt = g_header_cnt                  
   
   #單身總筆數顯示
   IF g_detail_cnt > 0 THEN
      #若單身有資料時, idx至少為1
      IF g_detail_idx <= 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx  
   ELSE
      LET g_detail_idx = 0
      DISPLAY '' TO FORMONLY.idx    
   END IF
   
   #瀏覽頁筆數顯示
   LET g_browser_idx = g_pagestart+g_current_idx-1
   DISPLAY g_browser_idx TO FORMONLY.b_index   #當下筆數
   DISPLAY g_browser_idx TO FORMONLY.h_index   #當下筆數
   
   CALL cl_navigator_setting( g_current_idx, g_browser_cnt )
 
   #代表沒有資料
   IF g_current_idx = 0 OR g_browser.getLength() = 0 THEN
      RETURN
   END IF
   
   #避免超出browser資料筆數上限
   IF g_current_idx > g_browser.getLength() THEN
      LET g_browser_idx = g_browser.getLength()
      LET g_current_idx = g_browser.getLength()
   END IF
   
   LET g_xmee_m.xmeedocno = g_browser[g_current_idx].b_xmeedocno
   LET g_xmee_m.xmee900 = g_browser[g_current_idx].b_xmee900
 
   
   #重讀DB,因TEMP有不被更新特性
   EXECUTE adbt510_master_referesh USING g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmee_m.xmeesite, 
       g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202, 
       g_xmee_m.xmee023,g_xmee_m.xmee004,g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005, 
       g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
       g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
       g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee204,g_xmee_m.xmee205, 
       g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026, 
       g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049, 
       g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
       g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,g_xmee_m.xmeecrtid, 
       g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017, 
       g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028,g_xmee_m.xmeesite_desc,g_xmee_m.xmee202_desc, 
       g_xmee_m.xmee023_desc,g_xmee_m.xmee004_desc,g_xmee_m.xmee200_desc,g_xmee_m.xmee201_desc,g_xmee_m.xmee024_desc, 
       g_xmee_m.xmee002_desc,g_xmee_m.xmee003_desc,g_xmee_m.xmee021_desc,g_xmee_m.xmee022_desc,g_xmee_m.xmee203_desc, 
       g_xmee_m.xmee027_desc,g_xmee_m.xmee211_desc,g_xmee_m.xmee210_desc,g_xmee_m.xmee209_desc,g_xmee_m.xmee208_desc, 
       g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204_desc,g_xmee_m.xmee032_desc,g_xmee_m.xmee903_desc,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207_desc,g_xmee_m.xmee020_desc,g_xmee_m.xmee036_desc,g_xmee_m.xmee009_desc,g_xmee_m.xmee010_desc, 
       g_xmee_m.xmee015_desc,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid_desc, 
       g_xmee_m.xmeecrtdp_desc,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeecnfid_desc,g_xmee_m.xmee034_desc, 
       g_xmee_m.xmee017_desc,g_xmee_m.xmee018_desc
   
   #遮罩相關處理
   LET g_xmee_m_mask_o.* =  g_xmee_m.*
   CALL adbt510_xmee_t_mask()
   LET g_xmee_m_mask_n.* =  g_xmee_m.*
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL adbt510_set_act_visible()   
   CALL adbt510_set_act_no_visible()
   
   #add-point:fetch段action控制 name="fetch.action_control"
   CALL cl_set_act_visible("modify,delete,modify_detail,open_xmef_w,open_adbt510_03,open_adbt510_04", TRUE)
   #IF g_xmee_m.xmeestus <> 'N' THEN
   IF g_xmee_m.xmeestus NOT MATCHES "[NDR]" THEN   # N未確認/D抽單/R已拒絕允許修改
      CALL cl_set_act_visible("modify,delete,modify_detail,open_adbt510_03,open_adbt510_04,open_xmef_w", FALSE)
   END IF
  CALL cl_set_toolbaritem_visible("open_adbt510_04",FALSE)
   #end add-point  
   
   
   
   #add-point:fetch結束前 name="fetch.after"
   #判斷當下的營運據點是否在控制組限制的營運據點範圍內，若不在限制內則不允許新增
   CALL cl_set_act_visible("modify,delete,insert,open_xmef_w", TRUE)
   
   #02749  150121  add ----------------------(S)
   #不使用控制組
   #CALL s_control_chk_group('5','3',g_user,g_dept,g_site,'','','','') RETURNING l_success,l_flag
   #IF l_success THEN                            #處理狀態為FALSE，則隱藏新增按鈕
   #   IF NOT l_flag THEN                        #不在控制組範圍內
   #      CALL cl_set_act_visible("insert", FALSE)
   #   END IF
   #ELSE
   #   CALL cl_set_act_visible("insert", FALSE)
   #END IF
   #02749  150121  add ----------------------(E)
   
   #IF g_xmee_m.xmeestus != 'N' THEN
   IF g_xmee_m.xmeestus NOT MATCHES "[NDR]" THEN   # N未確認/D抽單/R已拒絕允許修改
      CALL cl_set_act_visible("modify,delete,open_xmef_w", FALSE)
   END IF                         
   #end add-point
   
   #保存單頭舊值
   LET g_xmee_m_t.* = g_xmee_m.*
   LET g_xmee_m_o.* = g_xmee_m.*
   
   LET g_data_owner = g_xmee_m.xmeeownid      
   LET g_data_dept  = g_xmee_m.xmeeowndp
   
   #重新顯示   
   CALL adbt510_show()
 
   #應用 a56 樣板自動產生(Version:3)
   #檢查此單據是否需顯示BPM簽核狀況按鈕 
   IF cl_bpm_chk() THEN
      CALL cl_set_act_visible("bpm_status",TRUE)
   ELSE
      CALL cl_set_act_visible("bpm_status",FALSE)
   END IF
 
 
 
 
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.insert" >}
#+ 資料新增
PRIVATE FUNCTION adbt510_insert()
   #add-point:insert段define(客製用) name="insert.define_customerization"
   
   #end add-point    
   #add-point:insert段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="insert.define"
   DEFINE l_insert            LIKE type_t.num5
   #end add-point    
   
   #add-point:Function前置處理  name="insert.pre_function"
   
   #end add-point
   
   #清畫面欄位內容
   CLEAR FORM                    
   CALL g_xmeg_d.clear()   
   CALL g_xmeg2_d.clear()  
   CALL g_xmeg3_d.clear()  
   CALL g_xmeg4_d.clear()  
   CALL g_xmeg5_d.clear()  
 
 
   INITIALIZE g_xmee_m.* TO NULL             #DEFAULT 設定
   
   LET g_xmeedocno_t = NULL
   LET g_xmee900_t = NULL
 
   
   LET g_master_insert = FALSE
   
   #add-point:insert段before name="insert.before"
   
   #end add-point    
   
   CALL s_transaction_begin()
   WHILE TRUE
      #公用欄位給值(單頭)
      #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_xmee_m.xmeeownid = g_user
      LET g_xmee_m.xmeeowndp = g_dept
      LET g_xmee_m.xmeecrtid = g_user
      LET g_xmee_m.xmeecrtdp = g_dept 
      LET g_xmee_m.xmeecrtdt = cl_get_current()
      LET g_xmee_m.xmeemodid = g_user
      LET g_xmee_m.xmeemoddt = cl_get_current()
      LET g_xmee_m.xmeestus = 'N'
 
 
 
 
      #append欄位給值
      
     
      #一般欄位給值
            LET g_xmee_m.xmee900 = "0"
      LET g_xmee_m.xmee901 = "N"
      LET g_xmee_m.xmee001 = "0"
      LET g_xmee_m.xmeestus = "N"
      LET g_xmee_m.xmee005 = "1"
      LET g_xmee_m.xmee007 = "1"
      LET g_xmee_m.xmeeacti = "N"
      LET g_xmee_m.xmee205 = "100"
      LET g_xmee_m.xmee048 = "1"
      LET g_xmee_m.xmee049 = "1"
      LET g_xmee_m.xmee013 = "N"
      LET g_xmee_m.xmee039 = "1"
      LET g_xmee_m.xmee041 = "0"
      LET g_xmee_m.xmee006 = "1"
      LET g_xmee_m.xmee042 = "0"
      LET g_xmee_m.xmee043 = "0"
      LET g_xmee_m.xmee019 = "Y"
 
  
      #add-point:單頭預設值 name="insert.default"
      CALL s_hint_show('xmek_t','xmee_t','xmda_t',' ',0,0,'','')
      CALL s_hint_show('xmek_t','xmef_t','xmdb_t',' ',0,0,'','')
      #CALL s_hint_show('xmek_t','xmeg_t','xmdc_t',' ',' ','','','')
      #CALL s_hint_show('xmek_t','xmeh_t','xmdd_r',' ',' ','','','')
      CALL s_hint_show('xmek_t','xmjb_t','xmja_t',' ',0,0,'','')
      
      CALL s_aooi500_default(g_prog,'xmeesite',g_site)
       RETURNING l_insert,g_xmee_m.xmeesite
      IF NOT l_insert THEN
        RETURN
      END IF
      LET g_xmee_m.xmee902 = g_today
      LET g_xmee_m_t.* = g_xmee_m.*
      LET g_xmee_m_o.* = g_xmee_m.*              #舊值備份      
      #end add-point 
      
      #保存單頭舊值(用於資料輸入錯誤還原預設值時使用)
      LET g_xmee_m_t.* = g_xmee_m.*
      LET g_xmee_m_o.* = g_xmee_m.*
      
      #顯示狀態(stus)圖片
            #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_xmee_m.xmeestus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
    
      CALL adbt510_input("a")
      
      #add-point:單頭輸入後 name="insert.after_insert"
                                    
      #end add-point
      
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code = 9001 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
      END IF
      
      IF NOT g_master_insert THEN
         DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
         DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
         INITIALIZE g_xmee_m.* TO NULL
         INITIALIZE g_xmeg_d TO NULL
         INITIALIZE g_xmeg2_d TO NULL
         INITIALIZE g_xmeg3_d TO NULL
         INITIALIZE g_xmeg4_d TO NULL
         INITIALIZE g_xmeg5_d TO NULL
 
         #add-point:取消新增後 name="insert.cancel"
         
         #end add-point 
         CALL adbt510_show()
         RETURN
      END IF
      
      LET INT_FLAG = 0
      #CALL g_xmeg_d.clear()
      #CALL g_xmeg2_d.clear()
      #CALL g_xmeg3_d.clear()
      #CALL g_xmeg4_d.clear()
      #CALL g_xmeg5_d.clear()
 
 
      LET g_rec_b = 0
      CALL s_transaction_end('Y','0')
      EXIT WHILE
        
   END WHILE
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL adbt510_set_act_visible()   
   CALL adbt510_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_xmeedocno_t = g_xmee_m.xmeedocno
   LET g_xmee900_t = g_xmee_m.xmee900
 
   
   #組合新增資料的條件
   LET g_add_browse = " xmeeent = " ||g_enterprise|| " AND",
                      " xmeedocno = '", g_xmee_m.xmeedocno, "' "
                      ," AND xmee900 = '", g_xmee_m.xmee900, "' "
 
                      
   #add-point:組合新增資料的條件後 name="insert.after.add_browse"
   
   #end add-point
      
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL adbt510_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   CLOSE adbt510_cl
   
   CALL adbt510_idx_chk()
   
   #撈取異動後的資料(主要是帶出reference)
   EXECUTE adbt510_master_referesh USING g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmee_m.xmeesite, 
       g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202, 
       g_xmee_m.xmee023,g_xmee_m.xmee004,g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005, 
       g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
       g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
       g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee204,g_xmee_m.xmee205, 
       g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026, 
       g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049, 
       g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
       g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,g_xmee_m.xmeecrtid, 
       g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017, 
       g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028,g_xmee_m.xmeesite_desc,g_xmee_m.xmee202_desc, 
       g_xmee_m.xmee023_desc,g_xmee_m.xmee004_desc,g_xmee_m.xmee200_desc,g_xmee_m.xmee201_desc,g_xmee_m.xmee024_desc, 
       g_xmee_m.xmee002_desc,g_xmee_m.xmee003_desc,g_xmee_m.xmee021_desc,g_xmee_m.xmee022_desc,g_xmee_m.xmee203_desc, 
       g_xmee_m.xmee027_desc,g_xmee_m.xmee211_desc,g_xmee_m.xmee210_desc,g_xmee_m.xmee209_desc,g_xmee_m.xmee208_desc, 
       g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204_desc,g_xmee_m.xmee032_desc,g_xmee_m.xmee903_desc,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207_desc,g_xmee_m.xmee020_desc,g_xmee_m.xmee036_desc,g_xmee_m.xmee009_desc,g_xmee_m.xmee010_desc, 
       g_xmee_m.xmee015_desc,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid_desc, 
       g_xmee_m.xmeecrtdp_desc,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeecnfid_desc,g_xmee_m.xmee034_desc, 
       g_xmee_m.xmee017_desc,g_xmee_m.xmee018_desc
   
   
   #遮罩相關處理
   LET g_xmee_m_mask_o.* =  g_xmee_m.*
   CALL adbt510_xmee_t_mask()
   LET g_xmee_m_mask_n.* =  g_xmee_m.*
   
   #將資料顯示到畫面上
   DISPLAY BY NAME g_xmee_m.xmeesite,g_xmee_m.xmeesite_desc,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900, 
       g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202,g_xmee_m.xmee202_desc,g_xmee_m.xmee023,g_xmee_m.xmee023_desc, 
       g_xmee_m.xmee004,g_xmee_m.xmee004_desc,g_xmee_m.xmee200,g_xmee_m.xmee200_desc,g_xmee_m.xmee201, 
       g_xmee_m.xmee201_desc,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt, 
       g_xmee_m.xmee024,g_xmee_m.xmee024_desc,g_xmee_m.xmee002,g_xmee_m.xmee002_desc,g_xmee_m.xmee003, 
       g_xmee_m.xmee003_desc,g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee021_desc,g_xmee_m.xmee022, 
       g_xmee_m.xmee022_desc,g_xmee_m.xmee203,g_xmee_m.xmee203_desc,g_xmee_m.xmee027,g_xmee_m.xmee027_desc, 
       g_xmee_m.xmee211,g_xmee_m.xmee211_desc,g_xmee_m.xmee210,g_xmee_m.xmee210_desc,g_xmee_m.xmee209, 
       g_xmee_m.xmee209_desc,g_xmee_m.xmee208,g_xmee_m.xmee208_desc,g_xmee_m.xmeeunit,g_xmee_m.xmeeunit_desc, 
       g_xmee_m.xmee204,g_xmee_m.xmee204_desc,g_xmee_m.xmee205,g_xmee_m.xmee032,g_xmee_m.xmee032_desc, 
       g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee903_desc,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee025_desc, 
       g_xmee_m.oofb017,g_xmee_m.xmee026,g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1,g_xmee_m.xmee206,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207,g_xmee_m.xmee207_desc,g_xmee_m.xmee020,g_xmee_m.xmee020_desc,g_xmee_m.xmee036, 
       g_xmee_m.xmee036_desc,g_xmee_m.xmee048,g_xmee_m.xmee049,g_xmee_m.xmee009,g_xmee_m.xmee009_desc, 
       g_xmee_m.xmee010,g_xmee_m.xmee010_desc,g_xmee_m.xmee015,g_xmee_m.xmee015_desc,g_xmee_m.xmee016, 
       g_xmee_m.xmee011,g_xmee_m.xmee011_desc,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee035_desc, 
       g_xmee_m.isaf011,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp, 
       g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtid_desc,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdp_desc, 
       g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfid_desc,g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee034_desc,g_xmee_m.xmee041, 
       g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017,g_xmee_m.xmee017_desc,g_xmee_m.xmee043,g_xmee_m.xmee018, 
       g_xmee_m.xmee018_desc,g_xmee_m.xmee019,g_xmee_m.xmee028
   
   #add-point:新增結束後 name="insert.after"
   
   #end add-point 
   
   LET g_data_owner = g_xmee_m.xmeeownid      
   LET g_data_dept  = g_xmee_m.xmeeowndp
   
   #功能已完成,通報訊息中心
   CALL adbt510_msgcentre_notify('insert')
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.modify" >}
#+ 資料修改
PRIVATE FUNCTION adbt510_modify()
   #add-point:modify段define(客製用) name="modify.define_customerization"
   
   #end add-point    
   DEFINE l_new_key    DYNAMIC ARRAY OF STRING
   DEFINE l_old_key    DYNAMIC ARRAY OF STRING
   DEFINE l_field_key  DYNAMIC ARRAY OF STRING
   DEFINE l_wc2_table1          STRING
   DEFINE l_wc2_table2   STRING
 
   DEFINE l_wc2_table3   STRING
 
   DEFINE l_wc2_table4   STRING
 
   DEFINE l_wc2_table5   STRING
 
 
 
   #add-point:modify段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="modify.define"
                  
   #end add-point    
   
   #add-point:Function前置處理  name="modify.pre_function"
   
   #end add-point
   
   #保存單頭舊值
   LET g_xmee_m_t.* = g_xmee_m.*
   LET g_xmee_m_o.* = g_xmee_m.*
   
   IF g_xmee_m.xmeedocno IS NULL
   OR g_xmee_m.xmee900 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   ERROR ""
  
   LET g_xmeedocno_t = g_xmee_m.xmeedocno
   LET g_xmee900_t = g_xmee_m.xmee900
 
   CALL s_transaction_begin()
   
   OPEN adbt510_cl USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900
   IF SQLCA.SQLCODE THEN   #(ver:78)
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN adbt510_cl:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
      LET g_errparam.popup = TRUE 
      CLOSE adbt510_cl
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE adbt510_master_referesh USING g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmee_m.xmeesite, 
       g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202, 
       g_xmee_m.xmee023,g_xmee_m.xmee004,g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005, 
       g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
       g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
       g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee204,g_xmee_m.xmee205, 
       g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026, 
       g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049, 
       g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
       g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,g_xmee_m.xmeecrtid, 
       g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017, 
       g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028,g_xmee_m.xmeesite_desc,g_xmee_m.xmee202_desc, 
       g_xmee_m.xmee023_desc,g_xmee_m.xmee004_desc,g_xmee_m.xmee200_desc,g_xmee_m.xmee201_desc,g_xmee_m.xmee024_desc, 
       g_xmee_m.xmee002_desc,g_xmee_m.xmee003_desc,g_xmee_m.xmee021_desc,g_xmee_m.xmee022_desc,g_xmee_m.xmee203_desc, 
       g_xmee_m.xmee027_desc,g_xmee_m.xmee211_desc,g_xmee_m.xmee210_desc,g_xmee_m.xmee209_desc,g_xmee_m.xmee208_desc, 
       g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204_desc,g_xmee_m.xmee032_desc,g_xmee_m.xmee903_desc,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207_desc,g_xmee_m.xmee020_desc,g_xmee_m.xmee036_desc,g_xmee_m.xmee009_desc,g_xmee_m.xmee010_desc, 
       g_xmee_m.xmee015_desc,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid_desc, 
       g_xmee_m.xmeecrtdp_desc,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeecnfid_desc,g_xmee_m.xmee034_desc, 
       g_xmee_m.xmee017_desc,g_xmee_m.xmee018_desc
   
   #檢查是否允許此動作
   IF NOT adbt510_action_chk() THEN
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_xmee_m_mask_o.* =  g_xmee_m.*
   CALL adbt510_xmee_t_mask()
   LET g_xmee_m_mask_n.* =  g_xmee_m.*
   
   
   
   #add-point:modify段show之前 name="modify.before_show"
   
   #end add-point  
   
   #LET l_wc2_table1 = g_wc2_table1
   #LET g_wc2_table1 = " 1=1"
   #LET l_wc2_table2 = g_wc2_table2
   #LET l_wc2_table2 = " 1=1"
 
   #LET l_wc2_table3 = g_wc2_table3
   #LET l_wc2_table3 = " 1=1"
 
   #LET l_wc2_table4 = g_wc2_table4
   #LET l_wc2_table4 = " 1=1"
 
   #LET l_wc2_table5 = g_wc2_table5
   #LET l_wc2_table5 = " 1=1"
 
 
 
   
   CALL adbt510_show()
   #add-point:modify段show之後 name="modify.after_show"
   
   #end add-point
   
   #LET g_wc2_table1 = l_wc2_table1
   #LET  g_wc2_table2 = l_wc2_table2 
 
   #LET  g_wc2_table3 = l_wc2_table3 
 
   #LET  g_wc2_table4 = l_wc2_table4 
 
   #LET  g_wc2_table5 = l_wc2_table5 
 
 
 
    
   WHILE TRUE
      LET g_xmeedocno_t = g_xmee_m.xmeedocno
      LET g_xmee900_t = g_xmee_m.xmee900
 
      
      #寫入修改者/修改日期資訊(單頭)
      LET g_xmee_m.xmeemodid = g_user 
LET g_xmee_m.xmeemoddt = cl_get_current()
LET g_xmee_m.xmeemodid_desc = cl_get_username(g_xmee_m.xmeemodid)
      
      #add-point:modify段修改前 name="modify.before_input"
      LET g_xmee_m_o.* = g_xmee_m.*  #舊值備份
      #「D抽單 / R已拒絕」狀況碼更改資料後，需還原為「N未確認」
      IF g_xmee_m.xmeestus MATCHES "[DR]" THEN 
         LET g_xmee_m.xmeestus = "N"
      END IF

      #end add-point
      
      #欄位更改
      LET g_loc = 'n'
      LET g_update = FALSE
      LET g_master_commit = "N"
      CALL adbt510_input("u")
      LET g_loc = 'n'
 
      #add-point:modify段修改後 name="modify.after_input"
                                    
      #end add-point
      
      IF g_update OR NOT INT_FLAG THEN
         #若有modid跟moddt則進行update
         UPDATE xmee_t SET (xmeemodid,xmeemoddt) = (g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt)
          WHERE xmeeent = g_enterprise AND xmeedocno = g_xmeedocno_t
            AND xmee900 = g_xmee900_t
 
      END IF
    
      IF INT_FLAG THEN
         CALL s_transaction_end('N','0')
         LET INT_FLAG = 0
         #若單頭無commit則還原
         IF g_master_commit = "N" THEN
            LET g_xmee_m.* = g_xmee_m_t.*
            CALL adbt510_show()
         END IF
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code = 9001 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN
      END IF 
                  
      #若單頭key欄位有變更
      IF g_xmee_m.xmeedocno != g_xmee_m_t.xmeedocno
      OR g_xmee_m.xmee900 != g_xmee_m_t.xmee900
 
      THEN
         CALL s_transaction_begin()
         
         #add-point:單身fk修改前 name="modify.body.b_fk_update"
                                                      
         #end add-point
         
         #更新單身key值
         UPDATE xmeg_t SET xmegdocno = g_xmee_m.xmeedocno
                                       ,xmeg900 = g_xmee_m.xmee900
 
          WHERE xmegent = g_enterprise AND xmegdocno = g_xmee_m_t.xmeedocno
            AND xmeg900 = g_xmee_m_t.xmee900
 
            
         #add-point:單身fk修改中 name="modify.body.m_fk_update"
                                                      
         #end add-point
 
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "xmeg_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xmeg_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         
         #add-point:單身fk修改後 name="modify.body.a_fk_update"
                                                      
         #end add-point
         
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update2"
         #170207-00004#2 170219 by 02749 add---(S)   
         # rtic_t 沒有變更記錄,不需要串xmee900
         UPDATE rtic_t
            SET rticdocno = g_xmee_m.xmeedocno
          WHERE rticent = g_enterprise 
            AND rticdocno = g_xmeedocno_t
         #170207-00004#2 170219 by 02749 add---(E)              
#         #end add-point
#         
#         UPDATE rtic_t
#            SET rticdocno = g_xmee_m.xmeedocno
#               , = g_xmee_m.xmee900
# 
#          WHERE rticent = g_enterprise AND
#                rticdocno = g_xmeedocno_t
#            AND  = g_xmee900_t
# 
#         #add-point:單身fk修改中 name="modify.body.m_fk_update2"
                                                      
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "rtic_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "rtic_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update2"
                                                      
         #end add-point
 
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update3"
                                                      
         #end add-point
         
         UPDATE xmeh_t
            SET xmehdocno = g_xmee_m.xmeedocno
               ,xmeh900 = g_xmee_m.xmee900
 
          WHERE xmehent = g_enterprise AND
                xmehdocno = g_xmeedocno_t
            AND xmeh900 = g_xmee900_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update3"
                                                      
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "xmeh_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xmeh_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update3"
                                                      
         #end add-point
 
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update4"
         
         #end add-point
         
         UPDATE xmjb_t
            SET xmjbdocno = g_xmee_m.xmeedocno
               ,xmjb900 = g_xmee_m.xmee900
 
          WHERE xmjbent = g_enterprise AND
                xmjbdocno = g_xmeedocno_t
            AND xmjb900 = g_xmee900_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update4"
         
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "xmjb_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xmjb_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update4"
         
         #end add-point
 
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update5"
         
         #end add-point
         
         UPDATE xmef_t
            SET xmefdocno = g_xmee_m.xmeedocno
               ,xmef900 = g_xmee_m.xmee900
 
          WHERE xmefent = g_enterprise AND
                xmefdocno = g_xmeedocno_t
            AND xmef900 = g_xmee900_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update5"
         
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "xmef_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xmef_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update5"
         
         #end add-point
 
 
         
 
         
         #UPDATE 多語言table key值
         
         
         
         
         
 
         CALL s_transaction_end('Y','0')
      END IF
    
      EXIT WHILE
   END WHILE
 
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL adbt510_set_act_visible()   
   CALL adbt510_set_act_no_visible()
 
   #組合新增資料的條件
   LET g_add_browse = " xmeeent = " ||g_enterprise|| " AND",
                      " xmeedocno = '", g_xmee_m.xmeedocno, "' "
                      ," AND xmee900 = '", g_xmee_m.xmee900, "' "
 
   #填到對應位置
   CALL adbt510_browser_fill("")
 
   CLOSE adbt510_cl
   
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL adbt510_msgcentre_notify('modify')
 
END FUNCTION 
 
{</section>}
 
{<section id="adbt510.input" >}
#+ 資料輸入
PRIVATE FUNCTION adbt510_input(p_cmd)
   #add-point:input段define(客製用) name="input.define_customerization"
   
   #end add-point  
   DEFINE  p_cmd                 LIKE type_t.chr1
   DEFINE  l_cmd_t               LIKE type_t.chr1
   DEFINE  l_cmd                 LIKE type_t.chr1
   DEFINE  l_n                   LIKE type_t.num10                #檢查重複用  
   DEFINE  l_cnt                 LIKE type_t.num10                #檢查重複用  
   DEFINE  l_lock_sw             LIKE type_t.chr1                #單身鎖住否  
   DEFINE  l_allow_insert        LIKE type_t.num5                #可新增否 
   DEFINE  l_allow_delete        LIKE type_t.num5                #可刪除否  
   DEFINE  l_count               LIKE type_t.num10
   DEFINE  l_i                   LIKE type_t.num10
   DEFINE  l_ac_t                LIKE type_t.num10
   DEFINE  l_insert              BOOLEAN
   DEFINE  ls_return             STRING
   DEFINE  l_var_keys            DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys          DYNAMIC ARRAY OF STRING
   DEFINE  l_vars                DYNAMIC ARRAY OF STRING
   DEFINE  l_fields              DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak        DYNAMIC ARRAY OF STRING
   DEFINE  lb_reproduce          BOOLEAN
   DEFINE  li_reproduce          LIKE type_t.num10
   DEFINE  li_reproduce_target   LIKE type_t.num10
   DEFINE  ls_keys               DYNAMIC ARRAY OF VARCHAR(500)
   #add-point:input段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="input.define"
   DEFINE  l_success    LIKE type_t.num5
   DEFINE  l_flag       LIKE type_t.num5
   DEFINE  l_rate       LIKE inaj_t.inaj014
   DEFINE  l_sql        STRING
   DEFINE  l_sql1       STRING
   DEFINE  l_sql2       STRING             
   DEFINE  l_ooef004    LIKE ooef_t.ooef004
   DEFINE  l_ooef016    LIKE ooef_t.ooef016
   DEFINE  l_pmaa004    LIKE pmaa_t.pmaa004 
   DEFINE  l_pmaa027    LIKE pmaa_t.pmaa027 
   DEFINE  l_pmaa027_1  LIKE pmaa_t.pmaa027 
   DEFINE  l_pmaa002    LIKE pmaa_t.pmaa002
   DEFINE  l_oocq019    LIKE oocq_t.oocq019   
   DEFINE  l_xmah004    LIKE xmah_t.xmah004
   DEFINE  l_xmah005    LIKE xmah_t.xmah005
   DEFINE  l_xmah006    LIKE xmah_t.xmah006   
   DEFINE  l_pmao002    LIKE pmao_t.pmao002
   DEFINE  l_pmao003    LIKE pmao_t.pmao003 
   DEFINE  l_pmao004    LIKE pmao_t.pmao004
   DEFINE  l_address    STRING  
   DEFINE  l_oofb011    LIKE oofb_t.oofb011   
   DEFINE  l_imaa005    LIKE imaa_t.imaa005
   DEFINE  l_oodbl004   LIKE oodbl_t.oodbl004  #稅別名稱
   DEFINE  l_oodb005    LIKE oodb_t.oodb005    #含稅否
   DEFINE  l_oodb006    LIKE oodb_t.oodb006    #稅率 
   DEFINE  l_oodb011    LIKE oodb_t.oodb011    #取得稅別類型1:正常稅率2:依料件設定   
   DEFINE  l_imaa143    LIKE imaa_t.imaa143
   DEFINE  l_ooef019    LIKE ooef_t.ooef019
   DEFINE  l_delete     LIKE type_t.num5
   DEFINE  l_slip       LIKE ooba_t.ooba001
   DEFINE  l_para_data  LIKE type_t.chr80
   DEFINE  l_pmaa248    LIKE pmaa_t.pmaa248
   DEFINE  l_stce005    LIKE stce_t.stce005
   DEFINE  l_errno      LIKE type_t.chr10 
   DEFINE l_where       STRING                 #160809-00015#1 160829 by 02749 add
   #end add-point  
   
   #add-point:Function前置處理  name="input.pre_function"
   
   #end add-point
   
   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r'
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF   
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_xmee_m.xmeesite,g_xmee_m.xmeesite_desc,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900, 
       g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202,g_xmee_m.xmee202_desc,g_xmee_m.xmee023,g_xmee_m.xmee023_desc, 
       g_xmee_m.xmee004,g_xmee_m.xmee004_desc,g_xmee_m.xmee200,g_xmee_m.xmee200_desc,g_xmee_m.xmee201, 
       g_xmee_m.xmee201_desc,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt, 
       g_xmee_m.xmee024,g_xmee_m.xmee024_desc,g_xmee_m.xmee002,g_xmee_m.xmee002_desc,g_xmee_m.xmee003, 
       g_xmee_m.xmee003_desc,g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee021_desc,g_xmee_m.xmee022, 
       g_xmee_m.xmee022_desc,g_xmee_m.xmee203,g_xmee_m.xmee203_desc,g_xmee_m.xmee027,g_xmee_m.xmee027_desc, 
       g_xmee_m.xmee211,g_xmee_m.xmee211_desc,g_xmee_m.xmee210,g_xmee_m.xmee210_desc,g_xmee_m.xmee209, 
       g_xmee_m.xmee209_desc,g_xmee_m.xmee208,g_xmee_m.xmee208_desc,g_xmee_m.xmeeunit,g_xmee_m.xmeeunit_desc, 
       g_xmee_m.xmee204,g_xmee_m.xmee204_desc,g_xmee_m.xmee205,g_xmee_m.xmee032,g_xmee_m.xmee032_desc, 
       g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee903_desc,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee025_desc, 
       g_xmee_m.oofb017,g_xmee_m.xmee026,g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1,g_xmee_m.xmee206,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207,g_xmee_m.xmee207_desc,g_xmee_m.xmee020,g_xmee_m.xmee020_desc,g_xmee_m.xmee036, 
       g_xmee_m.xmee036_desc,g_xmee_m.xmee048,g_xmee_m.xmee049,g_xmee_m.xmee009,g_xmee_m.xmee009_desc, 
       g_xmee_m.xmee010,g_xmee_m.xmee010_desc,g_xmee_m.xmee015,g_xmee_m.xmee015_desc,g_xmee_m.xmee016, 
       g_xmee_m.xmee011,g_xmee_m.xmee011_desc,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee035_desc, 
       g_xmee_m.isaf011,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp, 
       g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtid_desc,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdp_desc, 
       g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfid_desc,g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee034_desc,g_xmee_m.xmee041, 
       g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017,g_xmee_m.xmee017_desc,g_xmee_m.xmee043,g_xmee_m.xmee018, 
       g_xmee_m.xmee018_desc,g_xmee_m.xmee019,g_xmee_m.xmee028
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
 
   CALL cl_set_head_visible("","YES")  
 
   LET l_insert = FALSE
   LET g_action_choice = ""
 
   #add-point:input段define_sql name="input.define_sql"
                  
   #end add-point 
   LET g_forupd_sql = "SELECT xmegsite,xmegseq,xmeg027,xmeg001,xmeg002,xmeg004,xmeg005,xmeg006,xmeg007, 
       xmeg008,xmeg009,xmeg024,xmeg012,xmeg013,xmeg045,xmeg010,xmeg011,xmeg015,xmeg016,xmeg017,xmeg046, 
       xmeg047,xmeg048,xmeg023,xmeg019,xmeg020,xmeg021,xmeg022,xmeg051,xmegunit,xmegorga,xmeg052,xmeg049, 
       xmeg053,xmeg050,xmeg901,xmeg902,xmeg903 FROM xmeg_t WHERE xmegent=? AND xmegdocno=? AND xmeg900=?  
       AND xmegseq=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql"
                  
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE adbt510_bcl CURSOR FROM g_forupd_sql
   
   #add-point:input段define_sql name="input.define_sql2"
                  
   #end add-point    
   LET g_forupd_sql = "SELECT rticseq,rticseq1,rtic001,rtic002,rtic003,rtic004,rtic005,rtic006,rtic007, 
       rtic008,rtic009,rtic010,rtic011,rtic012,rtic013,rtic014,rtic015,rtic016,rtic017,rtic018,rtic019, 
       rtic020,rtic021,rtic022,rtic023,rtic024,rtic025,rtic026,rtic027,rtic028,rtic029 FROM rtic_t WHERE  
       rticent=? AND rticdocno=? AND rticseq=? AND rticseq1=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql2"
                  
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE adbt510_bcl2 CURSOR FROM g_forupd_sql
 
   #add-point:input段define_sql name="input.define_sql3"
                  
   #end add-point    
   LET g_forupd_sql = "SELECT xmehdocno,xmehseq,xmehseq1,xmeh229,xmeh003,xmeh001,xmeh002,xmeh200,xmeh004, 
       xmeh005,xmeh011,xmeh012,xmehseq2,xmeh006,xmeh201,xmeh202,xmeh024,xmeh025,xmeh026,xmeh027,xmeh203, 
       xmeh204,xmeh205,xmeh206,xmeh029,xmeh028,xmeh019,xmeh030,xmeh207,xmehunit,xmeh210,xmeh212,xmeh213, 
       xmeh214,xmeh215,xmeh031,xmeh014,xmeh015,xmeh016,xmeh017,xmeh221,xmehsite,xmeh218,xmeh219,xmeh220, 
       xmeh222,xmeh223,xmeh224,xmehorga,xmeh226,xmeh227,xmeh228,xmeh901 FROM xmeh_t WHERE xmehent=?  
       AND xmehdocno=? AND xmeh900=? AND xmehseq=? AND xmehseq1=? AND xmehseq2=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql3"
                  
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE adbt510_bcl3 CURSOR FROM g_forupd_sql
 
   #add-point:input段define_sql name="input.define_sql4"
   
   #end add-point    
   LET g_forupd_sql = "SELECT xmjbunit,xmjbseq,xmjbsite,xmjb001,xmjb002,xmjb003,xmjb033,xmjb004,xmjb005, 
       xmjb006,xmjb007,xmjb011,xmjb012,xmjb013,xmjb014,xmjb015,xmjb016,xmjb017,xmjb018,xmjb008,xmjb009, 
       xmjb010,xmjb022,xmjb019,xmjb020,xmjb021,xmjb024,xmjb025,xmjb026,xmjb027,xmjb028,xmjb029,xmjb030, 
       xmjb031,xmjb032,xmjb040,xmjb039,xmjb038,xmjb037,xmjb034,xmjb901,xmjb902,xmjb903 FROM xmjb_t WHERE  
       xmjbent=? AND xmjbdocno=? AND xmjb900=? AND xmjbseq=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql4"
   
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE adbt510_bcl4 CURSOR FROM g_forupd_sql
 
   #add-point:input段define_sql name="input.define_sql5"
   
   #end add-point    
   LET g_forupd_sql = "SELECT xmefsite,xmef001,xmef002,xmef003,xmef004,xmef005,xmef006,xmef016,xmef017, 
       xmef007,xmef008,xmef009,xmef901,xmef902,xmef903 FROM xmef_t WHERE xmefent=? AND xmefdocno=? AND  
       xmef900=? AND xmef001=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql5"
   
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE adbt510_bcl5 CURSOR FROM g_forupd_sql
 
 
   
 
 
   #add-point:input段define_sql name="input.other_sql"
   LET g_flag2 = FALSE
   #end add-point 
 
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'
   
   #控制key欄位可否輸入
   CALL adbt510_set_entry(p_cmd)
   #add-point:set_entry後 name="input.after_set_entry"
                  
   #end add-point
   CALL adbt510_set_no_entry(p_cmd)
 
   DISPLAY BY NAME g_xmee_m.xmeesite,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901, 
       g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
       g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
       g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee071,g_xmee_m.xmee903, 
       g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048, 
       g_xmee_m.xmee049,g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmee034, 
       g_xmee_m.xmee006,g_xmee_m.xmee017,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028
   
   LET lb_reproduce = FALSE
   LET l_ac_t = 1
   
   #關閉被遮罩相關欄位輸入, 無法確定USER是否會需要輸入此欄位
   #因此先行關閉, 若有需要可於下方add-point中自行開啟
   CALL cl_mask_set_no_entry()
   
   #add-point:資料輸入前 name="input.before_input"
                     LET g_flag = FALSE
   CALL adbt510_set_entry(p_cmd)
   CALL adbt510_set_no_entry(p_cmd)

   #end add-point
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
{</section>}
 
{<section id="adbt510.input.head" >}
      #單頭段
      INPUT BY NAME g_xmee_m.xmeesite,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901, 
          g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
          g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
          g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee071,g_xmee_m.xmee903, 
          g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048, 
          g_xmee_m.xmee049,g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmee034, 
          g_xmee_m.xmee006,g_xmee_m.xmee017,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028 
         ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂ACTION(master_input)
         
     
         BEFORE INPUT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            OPEN adbt510_cl USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN adbt510_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE adbt510_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            IF l_cmd_t = 'r' THEN
               
            END IF
            #因應離開單頭後已寫入資料庫, 若重新回到單頭則視為修改
            #因此需於此處開啟/關閉欄位
            CALL adbt510_set_entry(p_cmd)
            #add-point:資料輸入前 name="input.m.before_input"
            LET g_upd_unit = 'N'                                                      
            #end add-point
            CALL adbt510_set_no_entry(p_cmd)
    
                  #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeesite
            
            #add-point:AFTER FIELD xmeesite name="input.a.xmeesite"
            IF NOT cl_null(g_xmee_m.xmeesite) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmeesite != g_xmee_m_o.xmeesite OR cl_null(g_xmee_m_o.xmeesite))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmeesite != g_xmee_m_o.xmeesite OR cl_null(g_xmee_m_o.xmeesite) THEN   #150427-00012#8 20150728 add by beckxie
                  CALL s_aooi500_chk(g_prog,'xmeesite',g_xmee_m.xmeesite,g_xmee_m.xmeesite) RETURNING l_success,l_errno
                  IF NOT l_success THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = '' 
                     LET g_errparam.code   = l_errno 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     
                     LET g_xmee_m.xmeesite = g_xmee_m_o.xmeesite
                     CALL s_desc_get_department_desc(g_xmee_m.xmeesite) RETURNING g_xmee_m.xmeesite_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            ELSE
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 'axc-00120'
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               
               LET g_xmee_m.xmeesite = g_xmee_m_o.xmeesite
               CALL s_desc_get_department_desc(g_xmee_m.xmeesite) RETURNING g_xmee_m.xmeesite_desc
               NEXT FIELD CURRENT
            END IF  
            LET g_xmee_m_o.xmeesite = g_xmee_m.xmeesite
            CALL s_desc_get_department_desc(g_xmee_m.xmeesite) RETURNING g_xmee_m.xmeesite_desc
            DISPLAY BY NAME g_xmee_m.xmeesite_desc
            LET g_flag2 = TRUE
            CALL adbt510_set_entry(p_cmd)
            CALL adbt510_set_no_entry(p_cmd)            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeesite
            #add-point:BEFORE FIELD xmeesite name="input.b.xmeesite"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmeesite
            #add-point:ON CHANGE xmeesite name="input.g.xmeesite"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee902
            #add-point:BEFORE FIELD xmee902 name="input.b.xmee902"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee902
            
            #add-point:AFTER FIELD xmee902 name="input.a.xmee902"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee902
            #add-point:ON CHANGE xmee902 name="input.g.xmee902"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeedocno
            
            #add-point:AFTER FIELD xmeedocno name="input.a.xmeedocno"
            IF NOT cl_null(g_xmee_m.xmeedocno) AND NOT cl_null(g_xmee_m.xmee900) THEN
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmeedocno != g_xmeedocno_t  OR g_xmee_m.xmee900 != g_xmee900_t )) THEN
                  #IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xmee_t WHERE "||"xmeeent = '" ||g_enterprise|| "' AND "||"xmeedocno = '"||g_xmee_m.xmeedocno ||"' AND "|| "xmee900 = '"||g_xmee_m.xmee900 ||"'",'std-00004',0) THEN            #170207-00004#2 170219 by 02749 mark
                   IF NOT ap_chk_notDup("","SELECT COUNT(xmeedocno) FROM xmee_t WHERE "||"xmeeent = '" ||g_enterprise|| "' AND "||"xmeedocno = '"||g_xmee_m.xmeedocno ||"' AND "|| "xmee900 = '"||g_xmee_m.xmee900 ||"'",'std-00004',0) THEN    #170207-00004#2 170219 by 02749 add 
                      LET g_xmee_m.xmeedocno = g_xmeedocno_t
                      NEXT FIELD CURRENT
                   END IF                  
               END IF   
            END IF
            IF NOT cl_null(g_xmee_m.xmeedocno) THEN
               IF p_cmd = 'a' OR (p_cmd = 'u' AND (g_xmee_m.xmeedocno != g_xmeedocno_t)) THEN
                  #校驗
                  IF NOT adbt510_xmeedocno_chk() THEN
                     LET g_xmee_m.xmeedocno = g_xmee_m_t.xmeedocno
                     DISPLAY BY NAME g_xmee_m.xmeedocno
                     NEXT FIELD CURRENT                 
                  END IF
                  
                  #02749 150124 add---(S)
                  #新增時輸入單號後,從變更單中取得最新的變更序
                  IF p_cmd = 'a' THEN
                     SELECT COALESCE(COUNT(xmeedocno),0) + 1 
                       INTO g_xmee_m.xmee900
                       FROM xmee_t 
                      WHERE xmeeent = g_enterprise 
                        AND xmdddocno = g_xmee_m.xmeedocno
                     DISPLAY BY NAMe g_xmee_m.xmee900
                  END IF
                  #02749 150124 add---(E)      
                  
                  #依據輸入的訂單單號，帶出單頭欄位的值
                  IF NOT adbt510_xmeedocno_xmee() THEN
                     LET g_xmee_m.xmeedocno = g_xmee_m_t.xmeedocno
                     DISPLAY BY NAME g_xmee_m.xmeedocno
                     NEXT FIELD CURRENT
                  END IF
                  #依據輸入的訂單單號，帶出單身欄位的值
                  IF NOT adbt510_xmeedocno_xmjb() THEN
                     LET g_xmee_m.xmeedocno = g_xmee_m_t.xmeedocno
                     DISPLAY BY NAME g_xmee_m.xmeedocno
                     NEXT FIELD CURRENT
                  END IF
                  #依據輸入的訂單單號，帶出單身欄位的值
                  IF NOT adbt510_xmeedocno_xmeg() THEN
                     LET g_xmee_m.xmeedocno = g_xmee_m_t.xmeedocno
                     DISPLAY BY NAME g_xmee_m.xmeedocno
                     NEXT FIELD CURRENT
                  END IF
                 #依據輸入的訂單單號，帶出訂單交期明細的值
                  IF NOT adbt510_xmeedocno_xmeh() THEN
                     LET g_xmee_m.xmeedocno = g_xmee_m_t.xmeedocno
                     DISPLAY BY NAME g_xmee_m.xmeedocno
                     NEXT FIELD CURRENT
                  END IF 
                 #依據輸入的訂單單號，帶出多期預收款的值
                  IF NOT adbt510_xmeedocno_xmef() THEN
                     LET g_xmee_m.xmeedocno = g_xmee_m_t.xmeedocno
                     DISPLAY BY NAME g_xmee_m.xmeedocno
                     NEXT FIELD CURRENT
                  END IF                  
                  
               END IF
            END IF 
            CALL adbt510_set_entry(p_cmd)
            CALL adbt510_set_no_entry(p_cmd)              
            #160513-00027#1 20160520 add by beckxie---S
            CALL adbt510_set_comp_visible_b()
            CALL adbt510_set_comp_no_visible_b()
            #160513-00027#1 20160520 add by beckxie---E
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeedocno
            #add-point:BEFORE FIELD xmeedocno name="input.b.xmeedocno"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmeedocno
            #add-point:ON CHANGE xmeedocno name="input.g.xmeedocno"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee900
            #add-point:BEFORE FIELD xmee900 name="input.b.xmee900"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee900
            
            #add-point:AFTER FIELD xmee900 name="input.a.xmee900"
            #此段落由子樣板a05產生
            IF  NOT cl_null(g_xmee_m.xmeedocno) AND NOT cl_null(g_xmee_m.xmee900) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmeedocno != g_xmeedocno_t  OR g_xmee_m.xmee900 != g_xmee900_t )) THEN 
                 #IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xmee_t WHERE "||"xmeeent = '" ||g_enterprise|| "' AND "||"xmeedocno = '"||g_xmee_m.xmeedocno ||"' AND "|| "xmee900 = '"||g_xmee_m.xmee900 ||"'",'std-00004',0) THEN            #170207-00004#2 170219 by 02749 mark
                  IF NOT ap_chk_notDup("","SELECT COUNT(xmeedocno) FROM xmee_t WHERE "||"xmeeent = '" ||g_enterprise|| "' AND "||"xmeedocno = '"||g_xmee_m.xmeedocno ||"' AND "|| "xmee900 = '"||g_xmee_m.xmee900 ||"'",'std-00004',0) THEN    #170207-00004#2 170219 by 02749 add                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF



            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee900
            #add-point:ON CHANGE xmee900 name="input.g.xmee900"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee901
            #add-point:BEFORE FIELD xmee901 name="input.b.xmee901"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee901
            
            #add-point:AFTER FIELD xmee901 name="input.a.xmee901"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee901
            #add-point:ON CHANGE xmee901 name="input.g.xmee901"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee200
            
            #add-point:AFTER FIELD xmee200 name="input.a.xmee200"
            IF NOT cl_null(g_xmee_m.xmee200) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee200 != g_xmee_m_o.xmee200 OR cl_null(g_xmee_m_o.xmee200))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee200 != g_xmee_m_o.xmee200 OR cl_null(g_xmee_m_o.xmee200) THEN   #150427-00012#8 20150728 add by beckxie
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee200
                  LET g_chkparam.err_str[1] = "apm-00201:sub-01302|axmm200|",cl_get_progname("axmm200",g_lang,"2"),"|:EXEPROGaxmm200"#要執行的建議程式待補 #160318-00025#28  add
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pmaa001_16") THEN
                     #檢查失敗時後續處理
                     LET g_xmee_m.xmee200 = g_xmee_m_o.xmee200
                     CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee200) RETURNING g_xmee_m.xmee200_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF 
            LET g_xmee_m_o.xmee200 = g_xmee_m.xmee200
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee200) RETURNING g_xmee_m.xmee200_desc
            DISPLAY BY NAME g_xmee_m.xmee200_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee200
            #add-point:BEFORE FIELD xmee200 name="input.b.xmee200"
            CALL adbt510_set_entry(p_cmd)
            CALL adbt510_set_no_entry(p_cmd)           
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee200
            #add-point:ON CHANGE xmee200 name="input.g.xmee200"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee201
            
            #add-point:AFTER FIELD xmee201 name="input.a.xmee201"
            IF NOT cl_null(g_xmee_m.xmee201) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee201 != g_xmee_m_o.xmee201 OR cl_null(g_xmee_m_o.xmee201))) THEN    #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee201 != g_xmee_m_o.xmee201 OR cl_null(g_xmee_m_o.xmee201) THEN    #150427-00012#8 20150728 add by beckxie 
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee201
                     
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pmaa001_1") THEN
                     #檢查失敗時後續處理
                     LET g_xmee_m.xmee201 = g_xmee_m_o.xmee201
                     CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee201) RETURNING g_xmee_m.xmee201_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF

            END IF 
            LET g_xmee_m_o.xmee201 = g_xmee_m.xmee201
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee201) RETURNING g_xmee_m.xmee201_desc
            DISPLAY BY NAME g_xmee_m.xmee201_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee201
            #add-point:BEFORE FIELD xmee201 name="input.b.xmee201"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee201
            #add-point:ON CHANGE xmee201 name="input.g.xmee201"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeestus
            #add-point:BEFORE FIELD xmeestus name="input.b.xmeestus"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeestus
            
            #add-point:AFTER FIELD xmeestus name="input.a.xmeestus"
                                                                        
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmeestus
            #add-point:ON CHANGE xmeestus name="input.g.xmeestus"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee024
            
            #add-point:AFTER FIELD xmee024 name="input.a.xmee024"
            CALL s_desc_get_acc_desc('295',g_xmee_m.xmee024) RETURNING g_xmee_m.xmee024_desc
            DISPLAY BY NAME g_xmee_m.xmee024_desc
            IF NOT cl_null(g_xmee_m.xmee024) THEN
               IF NOT adbt510_xmee024_chk(g_xmee_m.xmee024) THEN
                  LET g_xmee_m.xmee024 = g_xmee_m_t.xmee024
                  CALL s_desc_get_acc_desc('295',g_xmee_m.xmee024) RETURNING g_xmee_m.xmee024_desc
                  DISPLAY BY NAME g_xmee_m.xmee024_desc
                  NEXT FIELD CURRENT
               END IF
            END IF            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee024
            #add-point:BEFORE FIELD xmee024 name="input.b.xmee024"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee024
            #add-point:ON CHANGE xmee024 name="input.g.xmee024"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee002
            
            #add-point:AFTER FIELD xmee002 name="input.a.xmee002"
            IF NOT cl_null(g_xmee_m.xmee002) THEN  
               #此段落由子樣板a19產生   
               IF g_xmee_m.xmee002 != g_xmee_m_o.xmee002 OR cl_null(g_xmee_m_o.xmee002) THEN
                 #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL               
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee002
                  LET g_chkparam.err_str[1] = "aim-00070:sub-01302|aooi130|",cl_get_progname("aooi130",g_lang,"2"),"|:EXEPROGaooi130"#要執行的建議程式待補 #160318-00025#28  add
                 #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_ooag001") THEN
                     #檢查成功時後續處理
                      SELECT ooag003 INTO g_xmee_m.xmee003 FROM ooag_t WHERE ooagent = g_enterprise AND ooag001 = g_xmee_m.xmee002
                      CALL s_desc_get_department_desc(g_xmee_m.xmee003) RETURNING g_xmee_m.xmee003_desc
                      DISPLAY BY NAME g_xmee_m.xmee003_desc 
                  ELSE
                     #檢查失敗時後續處理
                      LET g_xmee_m.xmee002 = g_xmee_m_o.xmee002
                      CALL s_desc_get_person_desc(g_xmee_m.xmee002) RETURNING g_xmee_m.xmee002_desc
                      DISPLAY BY NAME g_xmee_m.xmee002_desc
                      NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            LET g_xmee_m_o.xmee002 = g_xmee_m.xmee002
            CALL s_desc_get_person_desc(g_xmee_m.xmee002) RETURNING g_xmee_m.xmee002_desc
            DISPLAY BY NAME g_xmee_m.xmee002_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee002
            #add-point:BEFORE FIELD xmee002 name="input.b.xmee002"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee002
            #add-point:ON CHANGE xmee002 name="input.g.xmee002"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee003
            
            #add-point:AFTER FIELD xmee003 name="input.a.xmee003"
            CALL s_desc_get_department_desc(g_xmee_m.xmee003) RETURNING g_xmee_m.xmee003_desc
            DISPLAY BY NAME g_xmee_m.xmee003_desc 
            
            IF NOT cl_null(g_xmee_m.xmee003) THEN 
               IF NOT adbt510_xmee003_chk(g_xmee_m.xmee003) THEN
                  LET g_xmee_m.xmee003 = g_xmee_m_t.xmee003
                  CALL s_desc_get_department_desc(g_xmee_m.xmee003) RETURNING g_xmee_m.xmee003_desc
                  DISPLAY BY NAME g_xmee_m.xmee003_desc 
                  NEXT FIELD CURRENT
               END IF   
                              
            END IF 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee003
            #add-point:BEFORE FIELD xmee003 name="input.b.xmee003"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee003
            #add-point:ON CHANGE xmee003 name="input.g.xmee003"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeeacti
            #add-point:BEFORE FIELD xmeeacti name="input.b.xmeeacti"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeeacti
            
            #add-point:AFTER FIELD xmeeacti name="input.a.xmeeacti"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmeeacti
            #add-point:ON CHANGE xmeeacti name="input.g.xmeeacti"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee021
            
            #add-point:AFTER FIELD xmee021 name="input.a.xmee021"
            IF NOT cl_null(g_xmee_m.xmee021) THEN 
               IF g_xmee_m.xmee021 != g_xmee_m_o.xmee021 OR cl_null(g_xmee_m_o.xmee021) THEN 
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  #02749  150121  add ----------------------(S)
                  #INITIALIZE g_chkparam.* TO NULL                  
                  #LET g_chkparam.arg1 = g_xmee_m.xmee004
                  #LET g_chkparam.arg2 = g_xmee_m.xmee021
                  #LET g_chkparam.arg3 = 'ALL'
                  #IF NOT cl_chk_exist("v_pmac002") THEN
                  #調整校驗方式
                  IF NOT s_adb_chk_pmac002(1,g_xmee_m.xmee004,g_xmee_m.xmee021,'1') THEN
                  #02749  150121  add ----------------------(E)
                     LET g_xmee_m.xmee021 = g_xmee_m_o.xmee021
                     CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee021) RETURNING g_xmee_m.xmee021_desc
                     DISPLAY BY NAME g_xmee_m.xmee021_desc                  
                     NEXT FIELD CURRENT
                  END IF
               END IF                  
            END IF 
            LET g_xmee_m_o.xmee021 = g_xmee_m.xmee021
            CALL adbt510_xmee026_desc()
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee021) RETURNING g_xmee_m.xmee021_desc
            DISPLAY BY NAME g_xmee_m.xmee021_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee021
            #add-point:BEFORE FIELD xmee021 name="input.b.xmee021"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee021
            #add-point:ON CHANGE xmee021 name="input.g.xmee021"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee022
            
            #add-point:AFTER FIELD xmee022 name="input.a.xmee022"
            IF NOT cl_null(g_xmee_m.xmee022) THEN 
               IF g_xmee_m.xmee022 != g_xmee_m_o.xmee022 OR cl_null(g_xmee_m_o.xmee022) THEN 
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  #02749  150121  add ----------------------(S)
                  #INITIALIZE g_chkparam.* TO NULL   
                  #LET g_chkparam.arg1 = g_xmee_m.xmee004
                  #LET g_chkparam.arg2 = g_xmee_m.xmee022
                  #LET g_chkparam.arg3 = 'ALL'
                  #IF NOT cl_chk_exist("v_pmac002_2") THEN
                  #調整校驗方式
                  IF NOT s_adb_chk_pmac002(1,g_xmee_m.xmee004,g_xmee_m.xmee022,'2') THEN
                  #02749  150121  add ----------------------(E)
                     LET g_xmee_m.xmee022 = g_xmee_m_o.xmee022                  
                     CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee022) RETURNING g_xmee_m.xmee022_desc
                     DISPLAY BY NAME g_xmee_m.xmee022_desc                 
                     NEXT FIELD CURRENT
                  END IF     
               END IF                  
            END IF 
            LET g_xmee_m_o.xmee022 = g_xmee_m.xmee022
            CALL adbt510_xmee025_desc()
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee022) RETURNING g_xmee_m.xmee022_desc
            DISPLAY BY NAME g_xmee_m.xmee022_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee022
            #add-point:BEFORE FIELD xmee022 name="input.b.xmee022"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee022
            #add-point:ON CHANGE xmee022 name="input.g.xmee022"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee203
            
            #add-point:AFTER FIELD xmee203 name="input.a.xmee203"
            IF NOT cl_null(g_xmee_m.xmee203) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee203 != g_xmee_m_o.xmee203 OR cl_null(g_xmee_m_o.xmee203))) THEN   #150427-00012#8 20160125 mark by beckxie
               IF g_xmee_m.xmee203 != g_xmee_m_o.xmee203 OR cl_null(g_xmee_m_o.xmee203) THEN   #150427-00012#8 20160125 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  #02749  150121  add ----------------------(S)
                  #INITIALIZE g_chkparam.* TO NULL
                  #LET g_chkparam.arg1 = g_xmee_m.xmee004
                  #LET g_chkparam.arg2 = g_xmee_m.xmee203
                  #IF NOT cl_chk_exist("v_pmac002_5") THEN
                  #調整校驗方式
                  IF NOT s_adb_chk_pmac002(1,g_xmee_m.xmee004,g_xmee_m.xmee203,'3') THEN
                  #02749  150121  add ----------------------(E)
                     LET g_xmee_m.xmee203 = g_xmee_m_o.xmee203
                     CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee203) RETURNING g_xmee_m.xmee203_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF  

            END IF 
            LET g_xmee_m_o.xmee203 = g_xmee_m.xmee203
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee203) RETURNING g_xmee_m.xmee203_desc
            DISPLAY BY NAME g_xmee_m.xmee203_desc

            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee203
            #add-point:BEFORE FIELD xmee203 name="input.b.xmee203"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee203
            #add-point:ON CHANGE xmee203 name="input.g.xmee203"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee027
            
            #add-point:AFTER FIELD xmee027 name="input.a.xmee027"
            IF NOT cl_null(g_xmee_m.xmee027) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee027 != g_xmee_m_o.xmee027 OR cl_null(g_xmee_m_o.xmee027))) THEN    #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee027 != g_xmee_m_o.xmee027 OR cl_null(g_xmee_m_o.xmee027) THEN    #150427-00012#8 20150728 add by beckxie
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee004
                  LET g_chkparam.arg2 = g_xmee_m.xmee027
                  LET g_chkparam.err_str[1] = "apm-00257:sub-01302|aomi005|",cl_get_progname("apmi005",g_lang,"2"),"|:EXEPROGapmi005"#要執行的建議程式待補 #160318-00025#28  add
                     
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pmaj002") THEN
                     LET g_xmee_m.xmee027 = g_xmee_m_o.xmee027
                     CALL adbt510_xmee027_ref(g_xmee_m.xmee027) RETURNING g_xmee_m.xmee027_desc
                     DISPLAY BY NAME g_xmee_m.xmee027_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF 
            LET g_xmee_m_o.xmee027 = g_xmee_m.xmee027
            CALL adbt510_xmee027_ref(g_xmee_m.xmee027) RETURNING g_xmee_m.xmee027_desc
            DISPLAY BY NAME g_xmee_m.xmee027_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee027
            #add-point:BEFORE FIELD xmee027 name="input.b.xmee027"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee027
            #add-point:ON CHANGE xmee027 name="input.g.xmee027"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee211
            
            #add-point:AFTER FIELD xmee211 name="input.a.xmee211"
            IF NOT cl_null(g_xmee_m.xmee211) THEN 
               #IF g_xmee_m.xmee211 != g_xmee_m_o.xmee211 OR g_xmee_m_o.xmee211 IS NULL THEN   #150427-00012#8 20160125 mark by beckxie
               IF g_xmee_m.xmee211 != g_xmee_m_o.xmee211 OR cl_null(g_xmee_m_o.xmee211) THEN   #150427-00012#8 20160125  add by beckxie
                  INITIALIZE g_chkparam.* TO NULL
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee211
                  LET g_chkparam.arg2 = '1'
                  LET g_errparam.replace[1] = '1'
                  IF NOT cl_chk_exist("v_dbaa001_1") THEN
                     LET g_xmee_m.xmee211 = g_xmee_m_o.xmee211
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee211) RETURNING g_xmee_m.xmee211_desc
                     DISPLAY BY NAME g_xmee_m.xmee211_desc
                     NEXT FIELD CURRENT
                  END IF 
                  LET g_xmee_m.xmee208 = ''
                  LET g_xmee_m.xmee209 = ''
                  LET g_xmee_m.xmee210 = ''
                  LET g_xmee_m.xmee208_desc = ''
                  LET g_xmee_m.xmee209_desc = ''
                  LET g_xmee_m.xmee210_desc = ''
                  DISPLAY BY NAME g_xmee_m.xmee208_desc
                  DISPLAY BY NAME g_xmee_m.xmee209_desc
                  DISPLAY BY NAME g_xmee_m.xmee210_desc
               END IF
            END IF 
            LET g_xmee_m_o.xmee208 = g_xmee_m.xmee208
            LET g_xmee_m_o.xmee209 = g_xmee_m.xmee209
            LET g_xmee_m_o.xmee210 = g_xmee_m.xmee210
            LET g_xmee_m_o.xmee211 = g_xmee_m.xmee211
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee211) RETURNING g_xmee_m.xmee211_desc
            DISPLAY BY NAME g_xmee_m.xmee211_desc

            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee211
            #add-point:BEFORE FIELD xmee211 name="input.b.xmee211"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee211
            #add-point:ON CHANGE xmee211 name="input.g.xmee211"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee210
            
            #add-point:AFTER FIELD xmee210 name="input.a.xmee210"
            IF NOT cl_null(g_xmee_m.xmee210) THEN 
               #IF g_xmee_m.xmee210 != g_xmee_m_o.xmee210 OR g_xmee_m_o.xmee210 IS NULL THEN   #150427-00012#8 20160125 mark by beckxie
               IF g_xmee_m.xmee210 != g_xmee_m_o.xmee210 OR cl_null(g_xmee_m_o.xmee210) THEN   #150427-00012#8 20160125  add by beckxie
                  INITIALIZE g_chkparam.* TO NULL
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee210
                  LET g_chkparam.arg2 = '2'
                  LET g_errparam.replace[1] = '2'
                  IF NOT cl_chk_exist("v_dbaa001_1") THEN
                     LET g_xmee_m.xmee210 = g_xmee_m_o.xmee210
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee210) RETURNING g_xmee_m.xmee210_desc
                     DISPLAY BY NAME g_xmee_m.xmee210_desc
                     NEXT FIELD CURRENT
                  END IF
                  IF cl_null(g_xmee_m.xmee211) THEN
                     CALL s_adb_get_dbaa003(g_xmee_m.xmee210,'2') RETURNING g_xmee_m.xmee211
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee211) RETURNING g_xmee_m.xmee211_desc
                     DISPLAY BY NAME g_xmee_m.xmee211_desc
                  END IF  
                  LET g_xmee_m.xmee208 = ''
                  LET g_xmee_m.xmee209 = ''
                  LET g_xmee_m.xmee208_desc = ''
                  LET g_xmee_m.xmee209_desc = ''
                  DISPLAY BY NAME g_xmee_m.xmee208_desc
                  DISPLAY BY NAME g_xmee_m.xmee209_desc
               END IF
            END IF 
            LET g_xmee_m_o.xmee208 = g_xmee_m.xmee208
            LET g_xmee_m_o.xmee209 = g_xmee_m.xmee209
            LET g_xmee_m_o.xmee210 = g_xmee_m.xmee210
            LET g_xmee_m_o.xmee211 = g_xmee_m.xmee211
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee210) RETURNING g_xmee_m.xmee210_desc
            DISPLAY BY NAME g_xmee_m.xmee210_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee210
            #add-point:BEFORE FIELD xmee210 name="input.b.xmee210"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee210
            #add-point:ON CHANGE xmee210 name="input.g.xmee210"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee209
            
            #add-point:AFTER FIELD xmee209 name="input.a.xmee209"
            IF NOT cl_null(g_xmee_m.xmee209) THEN 
               #IF g_xmee_m.xmee209 != g_xmee_m_o.xmee209 OR g_xmee_m_o.xmee209 IS NULL THEN   #150427-00012#8 20160125 mark by beckxie
               IF g_xmee_m.xmee209 != g_xmee_m_o.xmee209 OR cl_null(g_xmee_m_o.xmee209) THEN   #150427-00012#8 20160125  add by beckxie
                  INITIALIZE g_chkparam.* TO NULL
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee209
                  LET g_chkparam.arg2 = '3'
                  LET g_errparam.replace[1] = '3'
                  IF NOT cl_chk_exist("v_dbaa001_1") THEN
                     LET g_xmee_m.xmee209 = g_xmee_m_o.xmee209
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee209) RETURNING g_xmee_m.xmee209_desc
                     DISPLAY BY NAME g_xmee_m.xmee209_desc
                     NEXT FIELD CURRENT
                  END IF
                  IF cl_null(g_xmee_m.xmee210) THEN
                     CALL s_adb_get_dbaa003(g_xmee_m.xmee209,'3') RETURNING g_xmee_m.xmee210
                     CALL s_adb_get_dbaa003(g_xmee_m.xmee210,'2') RETURNING g_xmee_m.xmee211
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee210) RETURNING g_xmee_m.xmee210_desc
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee211) RETURNING g_xmee_m.xmee211_desc
                     DISPLAY BY NAME g_xmee_m.xmee210_desc
                     DISPLAY BY NAME g_xmee_m.xmee211_desc
                  END IF  
                  LET g_xmee_m.xmee208 = ''
                  LET g_xmee_m.xmee208_desc = ''
                  DISPLAY BY NAME g_xmee_m.xmee208_desc
               END IF
            END IF 
            LET g_xmee_m_o.xmee208 = g_xmee_m.xmee208
            LET g_xmee_m_o.xmee209 = g_xmee_m.xmee209
            LET g_xmee_m_o.xmee210 = g_xmee_m.xmee210
            LET g_xmee_m_o.xmee211 = g_xmee_m.xmee211
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee209) RETURNING g_xmee_m.xmee209_desc
            DISPLAY BY NAME g_xmee_m.xmee209_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee209
            #add-point:BEFORE FIELD xmee209 name="input.b.xmee209"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee209
            #add-point:ON CHANGE xmee209 name="input.g.xmee209"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee208
            
            #add-point:AFTER FIELD xmee208 name="input.a.xmee208"
            IF NOT cl_null(g_xmee_m.xmee208) THEN 
               #IF g_xmee_m.xmee208 != g_xmee_m_o.xmee208 OR g_xmee_m_o.xmee208 IS NULL THEN   #150427-00012#8 20160125 mark by beckxie
               IF g_xmee_m.xmee208 != g_xmee_m_o.xmee208 OR cl_null(g_xmee_m_o.xmee208) THEN   #150427-00012#8 20160125  add by beckxie
                  INITIALIZE g_chkparam.* TO NULL
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee208
                  LET g_chkparam.arg2 = '4'
                  LET g_errparam.replace[1] = '4'
                  IF NOT cl_chk_exist("v_dbaa001_1") THEN
                     LET g_xmee_m.xmee208 = g_xmee_m_o.xmee208
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee208) RETURNING g_xmee_m.xmee208_desc
                     DISPLAY BY NAME g_xmee_m.xmee208_desc
                     NEXT FIELD CURRENT
                  END IF
                  IF cl_null(g_xmee_m.xmee209) THEN
                     CALL s_adb_get_dbaa003(g_xmee_m.xmee208,'4') RETURNING g_xmee_m.xmee209
                     CALL s_adb_get_dbaa003(g_xmee_m.xmee209,'3') RETURNING g_xmee_m.xmee210
                     CALL s_adb_get_dbaa003(g_xmee_m.xmee210,'2') RETURNING g_xmee_m.xmee211
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee209) RETURNING g_xmee_m.xmee209_desc
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee210) RETURNING g_xmee_m.xmee210_desc
                     CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee211) RETURNING g_xmee_m.xmee211_desc
                     DISPLAY BY NAME g_xmee_m.xmee209_desc
                     DISPLAY BY NAME g_xmee_m.xmee210_desc
                     DISPLAY BY NAME g_xmee_m.xmee211_desc
                  END IF  
               END IF
            END IF 
            LET g_xmee_m_o.xmee208 = g_xmee_m.xmee208
            LET g_xmee_m_o.xmee209 = g_xmee_m.xmee209
            LET g_xmee_m_o.xmee210 = g_xmee_m.xmee210
            LET g_xmee_m_o.xmee211 = g_xmee_m.xmee211
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee208) RETURNING g_xmee_m.xmee208_desc
            DISPLAY BY NAME g_xmee_m.xmee208_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee208
            #add-point:BEFORE FIELD xmee208 name="input.b.xmee208"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee208
            #add-point:ON CHANGE xmee208 name="input.g.xmee208"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmeeunit
            
            #add-point:AFTER FIELD xmeeunit name="input.a.xmeeunit"
            IF NOT cl_null(g_xmee_m.xmeeunit) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmeeunit != g_xmee_m_o.xmeeunit OR cl_null(g_xmee_m_o.xmeeunit))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmeeunit != g_xmee_m_o.xmeeunit OR cl_null(g_xmee_m_o.xmeeunit) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
#                  INITIALIZE g_chkparam.* TO NULL
#                  
#                  #設定g_chkparam.*的參數
#                  LET g_chkparam.arg1 = g_xmee_m.xmeeunit
#                  LET g_chkparam.arg2 = '2'
#                     
#                  #呼叫檢查存在並帶值的library
#                  IF NOT cl_chk_exist("v_ooed004_1") THEN
                  CALL s_aooi500_chk(g_prog,'xmeeunit',g_xmee_m.xmeeunit,g_xmee_m.xmeesite) RETURNING l_success,l_errno
                  IF NOT l_success THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = '' 
                     LET g_errparam.code   = l_errno 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     
                     LET g_xmee_m.xmeeunit = g_xmee_m_o.xmeeunit
                     CALL s_desc_get_department_desc(g_xmee_m.xmeeunit) RETURNING g_xmee_m.xmeeunit_desc
                     DISPLAY BY NAME g_xmee_m.xmeeunit_desc
                     NEXT FIELD CURRENT
                  END IF
                  IF cl_ask_confirm('adb-00205') THEN
                     LET g_upd_unit = 'Y'
                     FOR l_i = 1 TO g_xmeg3_d.getLength()
                        LET g_xmeg3_d[l_i].xmehunit = g_xmee_m.xmeeunit
                        CALL s_desc_get_department_desc(g_xmeg3_d[l_i].xmehunit) RETURNING g_xmeg3_d[l_i].xmehunit_desc
                     END FOR
                  ELSE
                     LET g_upd_unit = 'N'
                     LET g_xmee_m.xmeeunit = g_xmee_m_o.xmeeunit
                     CALL s_desc_get_department_desc(g_xmee_m.xmeeunit) RETURNING g_xmee_m.xmeeunit_desc
                     DISPLAY BY NAME g_xmee_m.xmeeunit_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF 
            LET g_xmee_m_o.xmeeunit = g_xmee_m.xmeeunit
            CALL s_desc_get_department_desc(g_xmee_m.xmeeunit) RETURNING g_xmee_m.xmeeunit_desc
            DISPLAY BY NAME g_xmee_m.xmeeunit_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmeeunit
            #add-point:BEFORE FIELD xmeeunit name="input.b.xmeeunit"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmeeunit
            #add-point:ON CHANGE xmeeunit name="input.g.xmeeunit"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee071
            #add-point:BEFORE FIELD xmee071 name="input.b.xmee071"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee071
            
            #add-point:AFTER FIELD xmee071 name="input.a.xmee071"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee071
            #add-point:ON CHANGE xmee071 name="input.g.xmee071"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee903
            
            #add-point:AFTER FIELD xmee903 name="input.a.xmee903"
            IF NOT cl_null(g_xmee_m.xmee903) THEN
               #02749  150122 add ----------------------(S)
               #IF NOT s_azzi650_chk_exist('267',g_xmee_m.xmee903) THEN
               IF NOT s_azzi650_chk_exist(g_acc_282,g_xmee_m.xmee903) THEN
               #02749  150122 add ----------------------(E)
                  LET g_xmee_m.xmee903 = g_xmee_m_t.xmee903
                  NEXT FIELD xmee903
               END IF
            END IF
            #02749  150122 add ----------------------(S)
            #CALL s_desc_get_acc_desc('267',g_xmee_m.xmee903) RETURNING g_xmee_m.xmee903_desc
            CALL s_desc_get_acc_desc(g_acc_282,g_xmee_m.xmee903) RETURNING g_xmee_m.xmee903_desc
            #02749  150122 add ----------------------(E)
            DISPLAY BY NAME g_xmee_m.xmee903_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee903
            #add-point:BEFORE FIELD xmee903 name="input.b.xmee903"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee903
            #add-point:ON CHANGE xmee903 name="input.g.xmee903"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee904
            #add-point:BEFORE FIELD xmee904 name="input.b.xmee904"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee904
            
            #add-point:AFTER FIELD xmee904 name="input.a.xmee904"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee904
            #add-point:ON CHANGE xmee904 name="input.g.xmee904"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee025
            
            #add-point:AFTER FIELD xmee025 name="input.a.xmee025"
            IF NOT cl_null(g_xmee_m.xmee025) THEN 
#               IF p_cmd = 'a' OR (p_cmd = 'u' AND (g_xmee_m.xmee025 != g_xmee_m_o.xmee025 OR g_xmee_m_o.xmee025 IS NULL )) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee025 != g_xmee_m_o.xmee025 OR cl_null(g_xmee_m_o.xmee025) THEN   #150427-00012#8 20150728 add by beckxie
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
                  #設定g_chkparam.*的參數
                  
			         LET g_chkparam.arg1 = l_pmaa027
                  LET g_chkparam.arg2 = g_xmee_m.xmee025
                  
                  LET g_chkparam.err_str[1] = "apm-00214:adb-00362"
                  #LET g_chkparam.err_str[2] = "anm-00025:adb-00363"                                                                  #160328-00029#5 mark
                  LET g_chkparam.err_str[2] = "anm-00025:sub-01302|apmm800|",cl_get_progname("apmm800",g_lang,"2"),"|:EXEPROGapmm800" #160328-00029#5 add
                  LET g_chkparam.err_str[3] = "anm-00025:adb-00364"
                  LET g_chkparam.err_str[4] = "anm-00025:sub-01302|aooi350|",cl_get_progname("aooi350",g_lang,"2"),"|:EXEPROGaooi350"#要執行的建議程式待補 #160318-00025#28  add
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_oofb019_1") THEN
                  
                  ELSE
                     #檢查失敗時後續處理
                     LET g_xmee_m.xmee025 = g_xmee_m_o.xmee025
                     CALL s_adb_address_ref('3',g_xmee_m.xmee025,g_xmee_m.xmee022)
                        RETURNING l_oofb011,l_address
                     LET g_xmee_m.xmee025_desc = l_oofb011
                     LET g_xmee_m.oofb017 = l_address
                     DISPLAY BY NAME g_xmee_m.xmee025_desc,g_xmee_m.oofb017
                     NEXT FIELD CURRENT
                  END IF
                  CALL s_adb_delivery_site_default(g_xmee_m.xmee022,l_pmaa027,'3',g_xmee_m.xmee025)
                     RETURNING g_xmee_m.xmee206
                  CALL s_adb_get_dbaf001(g_xmee_m.xmee206)
                     RETURNING g_xmee_m.xmee207
               END IF
            ELSE               
               LET g_xmee_m.xmee206 = ''
               LET g_xmee_m.xmee207 = ''
               LET g_xmee_m.oofb017 = ''
            END IF
            LET g_xmee_m_o.xmee025 = g_xmee_m.xmee025
            CALL s_adb_address_ref('3',g_xmee_m.xmee025,g_xmee_m.xmee022)
               RETURNING l_oofb011,l_address
            LET g_xmee_m.xmee025_desc = l_oofb011
            LET g_xmee_m.oofb017 = l_address

            LET g_xmee_m.xmee206_desc = s_desc_get_dbad001_desc(g_xmee_m.xmee206)
            LET g_xmee_m.xmee207_desc = s_desc_get_dbab001_desc(g_xmee_m.xmee207) 
            
            DISPLAY BY NAME g_xmee_m.xmee025_desc,g_xmee_m.oofb017,g_xmee_m.xmee206,g_xmee_m.xmee207 
            DISPLAY BY NAME g_xmee_m.xmee206_desc,g_xmee_m.xmee207_desc   
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee025
            #add-point:BEFORE FIELD xmee025 name="input.b.xmee025"
            LET l_pmaa027 = ''
            CALL adbt510_get_pmaa027(g_xmee_m.xmee022) RETURNING l_pmaa027                                                           
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee025
            #add-point:ON CHANGE xmee025 name="input.g.xmee025"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee026
            
            #add-point:AFTER FIELD xmee026 name="input.a.xmee026"
            IF NOT cl_null(g_xmee_m.xmee026) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee026 != g_xmee_m_o.xmee026 OR cl_null(g_xmee_m_o.xmee026))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee026 != g_xmee_m_o.xmee026 OR cl_null(g_xmee_m_o.xmee026) THEN   #150427-00012#8 20150728 add by beckxie
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
                  #設定g_chkparam.*的參數
			         LET g_chkparam.arg1 = l_pmaa027
                  LET g_chkparam.arg2 = g_xmee_m.xmee026
                  LET g_chkparam.err_str[1] = "anm-00025:sub-01302|aooi350|",cl_get_progname("aooi350",g_lang,"2"),"|:EXEPROGaooi350"#要執行的建議程式待補 #160318-00025#28  add
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_oofb019_2") THEN
                     LET g_xmee_m.xmee026 = g_xmee_m_o.xmee026
                     CALL s_adb_address_ref('5',g_xmee_m.xmee026,g_xmee_m.xmee021)
                        RETURNING l_oofb011,l_address
                     LET g_xmee_m.xmee026_desc = l_oofb011
                     LET g_xmee_m.oofb017_1 = l_address 
                     DISPLAY BY NAME g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            LET g_xmee_m_o.xmee026 = g_xmee_m.xmee026
            CALL s_adb_address_ref('5',g_xmee_m.xmee026,g_xmee_m.xmee021)
               RETURNING l_oofb011,l_address
            LET g_xmee_m.xmee026_desc = l_oofb011
            LET g_xmee_m.oofb017_1 = l_address 
            DISPLAY BY NAME g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee026
            #add-point:BEFORE FIELD xmee026 name="input.b.xmee026"
            LET l_pmaa027 = ''
            CALL adbt510_get_pmaa027(g_xmee_m.xmee021) RETURNING l_pmaa027                                                             
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee026
            #add-point:ON CHANGE xmee026 name="input.g.xmee026"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee020
            
            #add-point:AFTER FIELD xmee020 name="input.a.xmee020"
            IF NOT cl_null(g_xmee_m.xmee020) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee020 != g_xmee_m_o.xmee020 OR cl_null(g_xmee_m_o.xmee020))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee020 != g_xmee_m_o.xmee020 OR cl_null(g_xmee_m_o.xmee020) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee020
                  
                  IF NOT s_azzi650_chk_exist('263',g_xmee_m.xmee020) THEN
                     LET g_xmee_m.xmee020 = g_xmee_m_o.xmee020
                     CALL s_desc_get_acc_desc('263',g_xmee_m.xmee020) RETURNING g_xmee_m.xmee020_desc
                     DISPLAY BY NAME g_xmee_m.xmee020_desc  
                     NEXT FIELD CURRENT
                  END IF          
               END IF   
            END IF 
            LET g_xmee_m_o.xmee020 = g_xmee_m.xmee020
            CALL s_desc_get_acc_desc('263',g_xmee_m.xmee020) RETURNING g_xmee_m.xmee020_desc
            DISPLAY BY NAME g_xmee_m.xmee020_desc 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee020
            #add-point:BEFORE FIELD xmee020 name="input.b.xmee020"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee020
            #add-point:ON CHANGE xmee020 name="input.g.xmee020"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee036
            
            #add-point:AFTER FIELD xmee036 name="input.a.xmee036"
            IF NOT cl_null(g_xmee_m.xmee036) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee036 != g_xmee_m_o.xmee036 OR cl_null(g_xmee_m_o.xmee036))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee036 != g_xmee_m_o.xmee036 OR cl_null(g_xmee_m_o.xmee036) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee036
                  
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pmaa001_1") THEN
                     LET g_xmee_m.xmee036=g_xmee_m_o.xmee036
                     CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee036) RETURNING g_xmee_m.xmee036_desc
                     DISPLAY BY NAME g_xmee_m.xmee036_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF

            END IF 
            LET g_xmee_m_o.xmee036 = g_xmee_m.xmee036
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee036) RETURNING g_xmee_m.xmee036_desc
            DISPLAY BY NAME g_xmee_m.xmee036_desc

            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee036
            #add-point:BEFORE FIELD xmee036 name="input.b.xmee036"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee036
            #add-point:ON CHANGE xmee036 name="input.g.xmee036"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee048
            #add-point:BEFORE FIELD xmee048 name="input.b.xmee048"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee048
            
            #add-point:AFTER FIELD xmee048 name="input.a.xmee048"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee048
            #add-point:ON CHANGE xmee048 name="input.g.xmee048"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee049
            #add-point:BEFORE FIELD xmee049 name="input.b.xmee049"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee049
            
            #add-point:AFTER FIELD xmee049 name="input.a.xmee049"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee049
            #add-point:ON CHANGE xmee049 name="input.g.xmee049"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee009
            
            #add-point:AFTER FIELD xmee009 name="input.a.xmee009"
            IF NOT cl_null(g_xmee_m.xmee009) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee009 != g_xmee_m_o.xmee009 OR cl_null(g_xmee_m_o.xmee009))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee009 != g_xmee_m_o.xmee009 OR cl_null(g_xmee_m_o.xmee009) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee004
                  LET g_chkparam.arg2 = g_xmee_m.xmee009                     
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pmad002_2") THEN
                     LET g_xmee_m.xmee009 = g_xmee_m_o.xmee009
                     CALL s_desc_get_ooib002_desc(g_xmee_m.xmee009) RETURNING g_xmee_m.xmee009_desc
                     DISPLAY BY NAME g_xmee_m.xmee009_desc                  
                     NEXT FIELD CURRENT
                  END IF 
                  IF g_xmee_m.xmee007 = '5' THEN
                    #SELECT COUNT(*)           #170207-00004#2 170219 by 02749 mark
                     SELECT COUNT(xmdkdocno)   #170207-00004#2 170219 by 02749 add
                       INTO l_cnt
                       FROM xmdk_t
                      WHERE xmdkent = g_enterprise 
                        AND xmdkdocno = g_xmee_m.xmee008
                        AND xmdk000 <> '2'
                        AND xmdk010 = g_xmee_m.xmee009
                     IF l_cnt = 0 THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'adb-00050'
                        LET g_errparam.extend = g_xmee_m.xmee009
                        LET g_errparam.popup = TRUE
                        CALL cl_err()
                  
                        LET g_xmee_m.xmee009 = g_xmee_m_o.xmee009
                        CALL s_desc_get_ooib002_desc(g_xmee_m.xmee009) RETURNING g_xmee_m.xmee009_desc
                        DISPLAY BY NAME g_xmee_m.xmee009_desc
                        NEXT FIELD CURRENT
                     END IF
                  END IF
               END IF
            END IF 
            LET g_xmee_m_o.xmee009 = g_xmee_m.xmee009
            CALL s_desc_get_ooib002_desc(g_xmee_m.xmee009) RETURNING g_xmee_m.xmee009_desc
            DISPLAY BY NAME g_xmee_m.xmee009_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee009
            #add-point:BEFORE FIELD xmee009 name="input.b.xmee009"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee009
            #add-point:ON CHANGE xmee009 name="input.g.xmee009"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee010
            
            #add-point:AFTER FIELD xmee010 name="input.a.xmee010"
            IF NOT cl_null(g_xmee_m.xmee010) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee010 != g_xmee_m_o.xmee010 OR cl_null(g_xmee_m_o.xmee010))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee010 != g_xmee_m_o.xmee010 OR cl_null(g_xmee_m_o.xmee010) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee010
                  
                  IF NOT s_azzi650_chk_exist('238',g_xmee_m.xmee010) THEN
                     #檢查失敗時後續處理
                     LET g_xmee_m.xmee010 = g_xmee_m_o.xmee010
                     CALL s_desc_get_acc_desc('238',g_xmee_m.xmee010) RETURNING g_xmee_m.xmee010_desc
                     DISPLAY BY NAME g_xmee_m.xmee010_desc                  
                     NEXT FIELD CURRENT
                  END IF
                  IF g_xmee_m.xmee007 = '5' THEN
                    #SELECT COUNT(*)           #170207-00004#2 170219 by 02749 mark
                     SELECT COUNT(xmdkdocno)   #170207-00004#2 170219 by 02749 add
                       INTO l_cnt
                       FROM xmdk_t
                      WHERE xmdkent = g_enterprise 
                        AND xmdkdocno = g_xmee_m.xmee008
                        AND xmdk000 <> '2'
                        AND xmdk011 = g_xmee_m.xmee010
                     IF l_cnt = 0 THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'adb-00050'
                        LET g_errparam.extend = g_xmee_m.xmee010
                        LET g_errparam.popup = TRUE
                        CALL cl_err()
                  
                        LET g_xmee_m.xmee010 = g_xmee_m_o.xmee010
                        CALL s_desc_get_acc_desc('238',g_xmee_m.xmee010) RETURNING g_xmee_m.xmee010_desc
                        DISPLAY BY NAME g_xmee_m.xmee010_desc   
                        NEXT FIELD CURRENT
                     END IF
                  END IF 
               END IF                  
            END IF 
            LET g_xmee_m_o.xmee010 = g_xmee_m.xmee010
            CALL s_desc_get_acc_desc('238',g_xmee_m.xmee010) RETURNING g_xmee_m.xmee010_desc
            DISPLAY BY NAME g_xmee_m.xmee010_desc  
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee010
            #add-point:BEFORE FIELD xmee010 name="input.b.xmee010"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee010
            #add-point:ON CHANGE xmee010 name="input.g.xmee010"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee035
            
            #add-point:AFTER FIELD xmee035 name="input.a.xmee035"
            IF NOT cl_null(g_xmee_m.xmee035) THEN
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee035 != g_xmee_m_o.xmee035 OR cl_null(g_xmee_m_o.xmee035))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee035 != g_xmee_m_o.xmee035 OR cl_null(g_xmee_m_o.xmee035) THEN   #150427-00012#8 20150728 add by beckxie
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  SELECT ooef019 INTO l_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_xmee_m.xmeesite
                  LET g_chkparam.arg1 = l_ooef019 
                  LET g_chkparam.arg2 = g_xmee_m.xmee035
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_isac002") THEN
                     LET g_xmee_m.xmee035 = g_xmee_m_o.xmee035
                     CALL s_desc_get_invoice_type_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee035) RETURNING g_xmee_m.xmee035_desc
                     DISPLAY BY NAME g_xmee_m.xmee035_desc 
                     NEXT FIELD CURRENT
                  END IF 
               END IF                  
            END IF
            LET g_xmee_m_o.xmee035 = g_xmee_m.xmee035
            CALL s_desc_get_invoice_type_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee035) RETURNING g_xmee_m.xmee035_desc
            DISPLAY BY NAME g_xmee_m.xmee035_desc  
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee035
            #add-point:BEFORE FIELD xmee035 name="input.b.xmee035"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee035
            #add-point:ON CHANGE xmee035 name="input.g.xmee035"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee039
            #add-point:BEFORE FIELD xmee039 name="input.b.xmee039"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee039
            
            #add-point:AFTER FIELD xmee039 name="input.a.xmee039"
                                                                        
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee039
            #add-point:ON CHANGE xmee039 name="input.g.xmee039"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee034
            
            #add-point:AFTER FIELD xmee034 name="input.a.xmee034"
            IF NOT cl_null(g_xmee_m.xmee034) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee034 != g_xmee_m_o.xmee034 OR cl_null(g_xmee_m_o.xmee034))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee034 != g_xmee_m_o.xmee034 OR cl_null(g_xmee_m_o.xmee034) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL 
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee034
                  LET g_chkparam.arg2 = 'ALL'                  
                  LET g_chkparam.err_str[1] = "apm-00201:sub-01302|axmm200|",cl_get_progname("axmm200",g_lang,"2"),"|:EXEPROGaxmm200"#要執行的建議程式待補 #160318-00025#28  add
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pmaa001_3") THEN
                     LET g_xmee_m.xmee034 = g_xmee_m_o.xmee034
                     CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee004) RETURNING g_xmee_m.xmee004_desc
                     DISPLAY BY NAME g_xmee_m.xmee034_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF

            END IF 
            LET g_xmee_m_o.xmee034 = g_xmee_m.xmee034
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee004) RETURNING g_xmee_m.xmee004_desc
            DISPLAY BY NAME g_xmee_m.xmee034_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee034
            #add-point:BEFORE FIELD xmee034 name="input.b.xmee034"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee034
            #add-point:ON CHANGE xmee034 name="input.g.xmee034"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee006
            #add-point:BEFORE FIELD xmee006 name="input.b.xmee006"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee006
            
            #add-point:AFTER FIELD xmee006 name="input.a.xmee006"
                                                                        
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee006
            #add-point:ON CHANGE xmee006 name="input.g.xmee006"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee017
            
            #add-point:AFTER FIELD xmee017 name="input.a.xmee017"
            IF NOT cl_null(g_xmee_m.xmee017) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee017 != g_xmee_m_o.xmee017 OR cl_null(g_xmee_m_o.xmee017))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee017 != g_xmee_m_o.xmee017 OR cl_null(g_xmee_m_o.xmee017) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL  
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee017                  
                  LET g_chkparam.err_str[1] = "axm-00026:sub-01302|axmi130|",cl_get_progname("axmi130",g_lang,"2"),"|:EXEPROGaxmi130"#要執行的建議程式待補 #160318-00025#28  add
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_xmah001") THEN
                     LET g_xmee_m.xmee017 = g_xmee_m_o.xmee017
                     CALL adbt510_xmee017_ref(g_xmee_m.xmee017) RETURNING g_xmee_m.xmee017_desc
                     DISPLAY BY NAME g_xmee_m.xmee017_desc
                     NEXT FIELD CURRENT                                 
                  END IF   
               END IF                  
            END IF 
            LET g_xmee_m_o.xmee017 = g_xmee_m.xmee017
            CALL adbt510_xmee017_ref(g_xmee_m.xmee017) RETURNING g_xmee_m.xmee017_desc
            DISPLAY BY NAME g_xmee_m.xmee017_desc 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee017
            #add-point:BEFORE FIELD xmee017 name="input.b.xmee017"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee017
            #add-point:ON CHANGE xmee017 name="input.g.xmee017"
                                                                        
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee018
            
            #add-point:AFTER FIELD xmee018 name="input.a.xmee018"
            IF NOT cl_null(g_xmee_m.xmee018) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xmee_m.xmee018 != g_xmee_m_o.xmee018 OR cl_null(g_xmee_m_o.xmee018))) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmee_m.xmee018 != g_xmee_m_o.xmee018 OR cl_null(g_xmee_m_o.xmee018) THEN   #150427-00012#8 20150728 add by beckxie
                  #此段落由子樣板a19產生
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee018
                  LET g_chkparam.err_str[1] = "aoo-00194:sub-01302|aooi717|",cl_get_progname("aooi717",g_lang,"2"),"|:EXEPROGaooi717"#要執行的建議程式待補 #160318-00025#28  add
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_ooid001_2") THEN
                     LET g_xmee_m.xmee018 = g_xmee_m_o.xmee018
                     CALL s_desc_ooid001_desc(g_xmee_m.xmee018) RETURNING g_xmee_m.xmee018_desc
                     DISPLAY BY NAME g_xmee_m.xmee018_desc                  
                     NEXT FIELD CURRENT
                  END IF
               END IF      
            END IF 
            LET g_xmee_m_o.xmee018 = g_xmee_m.xmee018
            CALL s_desc_ooid001_desc(g_xmee_m.xmee018) RETURNING g_xmee_m.xmee018_desc
            DISPLAY BY NAME g_xmee_m.xmee018_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee018
            #add-point:BEFORE FIELD xmee018 name="input.b.xmee018"
                                                                        
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee018
            #add-point:ON CHANGE xmee018 name="input.g.xmee018"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee019
            #add-point:BEFORE FIELD xmee019 name="input.b.xmee019"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee019
            
            #add-point:AFTER FIELD xmee019 name="input.a.xmee019"
                                                                        
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee019
            #add-point:ON CHANGE xmee019 name="input.g.xmee019"
                                                                        
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmee028
            #add-point:BEFORE FIELD xmee028 name="input.b.xmee028"
                                                                        
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmee028
            
            #add-point:AFTER FIELD xmee028 name="input.a.xmee028"
                                                                        
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmee028
            #add-point:ON CHANGE xmee028 name="input.g.xmee028"
                                                                        
            #END add-point 
 
 
 #欄位檢查
                  #Ctrlp:input.c.xmeesite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeesite
            #add-point:ON ACTION controlp INFIELD xmeesite name="input.c.xmeesite"
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmeesite             #給予default值
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmeesite',g_site,'i') #150308-00001#1  By Ken add 'i' 150309
            CALL q_ooef001_24()
            LET g_xmee_m.xmeesite = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_xmee_m.xmeesite TO xmeesite                   #顯示到畫面上
            CALL s_desc_get_department_desc(g_xmee_m.xmeesite) RETURNING g_xmee_m.xmeesite_desc
            NEXT FIELD xmeesite                                     #返回原欄位                                                           
            #END add-point
 
 
         #Ctrlp:input.c.xmee902
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee902
            #add-point:ON ACTION controlp INFIELD xmee902 name="input.c.xmee902"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmeedocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeedocno
            #add-point:ON ACTION controlp INFIELD xmeedocno name="input.c.xmeedocno"
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmeedocno 
          
           #160809-00015#1 160829 by 02749 mark---(S)        
			  ##160815-00016#1 160817 by 02749 add---(S)      
           #IF NOT cl_null(g_slip_wc) THEN                
           #   LET g_qryparam.where = g_slip_wc           
           #END IF                                        
           ##160815-00016#1 160817 by 02749 add---(E)      
           #LET g_qryparam.arg1 = g_xmee_m.xmeesite  
           #160809-00015#1 160829 by 02749 mark---(E)
           
            #160809-00015#1 160829 by 02749 add---(S)
            LET l_where = ""
            LET l_where = s_aooi500_q_where('adbt500','xmdasite',g_xmee_m.xmeesite,'i')
            LET l_where = cl_str_replace(l_where,"ooef001","xmdasite")
            
            IF NOT cl_null(g_slip_wc) THEN
               LET l_where = l_where," AND ",g_slip_wc
            END IF
            LET g_qryparam.where = l_where
            #160809-00015#1 160829 by 02749 add---(E)           
            CALL q_xmdadocno_5()                         
                                                          
            LET g_xmee_m.xmeedocno = g_qryparam.return1  
            DISPLAY g_xmee_m.xmeedocno TO xmeedocno      
            NEXT FIELD xmeedocno                         
                                                          
            #END add-point
 
 
         #Ctrlp:input.c.xmee900
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee900
            #add-point:ON ACTION controlp INFIELD xmee900 name="input.c.xmee900"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmee901
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee901
            #add-point:ON ACTION controlp INFIELD xmee901 name="input.c.xmee901"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmee200
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee200
            #add-point:ON ACTION controlp INFIELD xmee200 name="input.c.xmee200"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee200             #給予default值

            #給予arg

            CALL q_pmaa001_20()                                #呼叫開窗

            LET g_xmee_m.xmee200 = g_qryparam.return1              

            DISPLAY g_xmee_m.xmee200 TO xmee200              #
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee200) RETURNING g_xmee_m.xmee200_desc
            NEXT FIELD xmee200                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee201
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee201
            #add-point:ON ACTION controlp INFIELD xmee201 name="input.c.xmee201"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee201             #給予default值

            #給予arg
            
            CALL q_pmaa001_10()                                #呼叫開窗

            LET g_xmee_m.xmee201 = g_qryparam.return1              

            DISPLAY g_xmee_m.xmee201 TO xmee201              #
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee201) RETURNING g_xmee_m.xmee201_desc
            NEXT FIELD xmee201                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmeestus
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeestus
            #add-point:ON ACTION controlp INFIELD xmeestus name="input.c.xmeestus"
                                                                        
            #END add-point
 
 
         #Ctrlp:input.c.xmee024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee024
            #add-point:ON ACTION controlp INFIELD xmee024 name="input.c.xmee024"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee024             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "295"

            CALL q_oocq002()                                #呼叫開窗

            LET g_xmee_m.xmee024 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee024 TO xmee024              #顯示到畫面上
            CALL s_desc_get_acc_desc('295',g_xmee_m.xmee024) RETURNING g_xmee_m.xmee024_desc
            DISPLAY BY NAME g_xmee_m.xmee024_desc
            NEXT FIELD xmee024                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee002
            #add-point:ON ACTION controlp INFIELD xmee002 name="input.c.xmee002"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee002             #給予default值

            #給予arg

            CALL q_ooag001()                                #呼叫開窗

            LET g_xmee_m.xmee002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee002 TO xmee002              #顯示到畫面上

            NEXT FIELD xmee002                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee003
            #add-point:ON ACTION controlp INFIELD xmee003 name="input.c.xmee003"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee003             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_xmee_m.xmeedocdt

            CALL q_ooeg001()                                #呼叫開窗

            LET g_xmee_m.xmee003 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee003 TO xmee003              #顯示到畫面上

            NEXT FIELD xmee003                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmeeacti
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeeacti
            #add-point:ON ACTION controlp INFIELD xmeeacti name="input.c.xmeeacti"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmee021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee021
            #add-point:ON ACTION controlp INFIELD xmee021 name="input.c.xmee021"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee021             #給予default值
            #給予arg
            LET g_qryparam.arg1 = g_xmee_m.xmee004
            LET g_qryparam.arg2 = 'ALL'

            CALL q_pmac002_5()                                #呼叫開窗
            LET g_xmee_m.xmee021 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_xmee_m.xmee021 TO xmee021              #顯示到畫面上
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee021) RETURNING g_xmee_m.xmee021_desc
            DISPLAY BY NAME g_xmee_m.xmee021_desc
            NEXT FIELD xmee021                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee022
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee022
            #add-point:ON ACTION controlp INFIELD xmee022 name="input.c.xmee022"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee022             #給予default值
            LET g_qryparam.default2 = ""                           #g_xmee_m.pmaal004 #交易對象簡稱

            #給予arg
            LET g_qryparam.arg1 = g_xmee_m.xmee004 #
            LET g_qryparam.arg2 = 'ALL'

            CALL q_pmac002_6()                                #呼叫開窗
            LET g_xmee_m.xmee022 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_xmee_m.xmee022 TO xmee022              #顯示到畫面上
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee022) RETURNING g_xmee_m.xmee022_desc
            DISPLAY BY NAME g_xmee_m.xmee022_desc
            NEXT FIELD xmee022                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee203
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee203
            #add-point:ON ACTION controlp INFIELD xmee203 name="input.c.xmee203"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee203             #給予default值
            LET g_qryparam.default2 = "" #g_xmee_m.pmaal004 #交易對象簡稱
            #02749  150121  add ----------------------(S)
            #LET g_qryparam.arg1 = g_xmee_m.xmee004
            #LET g_qryparam.arg2 = '3'            
            #CALL q_pmac002_9()                                
            LET g_qryparam.arg1 = g_xmee_m.xmee004
            LET g_qryparam.arg2 = 'ALL'
            CALL q_pmac002_7()
            #02749  150121  add ----------------------(E)
            LET g_xmee_m.xmee203 = g_qryparam.return1              
            #LET g_xmee_m.pmaal004 = g_qryparam.return2 
            DISPLAY g_xmee_m.xmee203 TO xmee203              #
            #DISPLAY g_xmee_m.pmaal004 TO pmaal004 #交易對象簡稱
            CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee203) RETURNING g_xmee_m.xmee203_desc
            NEXT FIELD xmee203                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee027
            #add-point:ON ACTION controlp INFIELD xmee027 name="input.c.xmee027"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee027             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_xmee_m.xmee004 #

            CALL q_pmaj002()                                #呼叫開窗

            LET g_xmee_m.xmee027 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee027 TO xmee027              #顯示到畫面上
            CALL adbt510_xmee027_ref(g_xmee_m.xmee027) RETURNING g_xmee_m.xmee027_desc
            DISPLAY BY NAME g_xmee_m.xmee027_desc
            NEXT FIELD xmee027                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee211
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee211
            #add-point:ON ACTION controlp INFIELD xmee211 name="input.c.xmee211"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmee211             #給予default值
            #給予arg
            LET g_qryparam.arg1 = "1"
            CALL q_dbaa001_1()                                #呼叫開窗

            LET g_xmee_m.xmee211 = g_qryparam.return1              
            DISPLAY g_xmee_m.xmee211 TO xmee211              #
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee211) RETURNING g_xmee_m.xmee211_desc
            DISPLAY BY NAME g_xmee_m.xmee211_desc
            NEXT FIELD xmee211                          #返回原欄位

            #END add-point
 
 
         #Ctrlp:input.c.xmee210
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee210
            #add-point:ON ACTION controlp INFIELD xmee210 name="input.c.xmee210"
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmee210             #給予default值
            IF NOT cl_null(g_xmee_m.xmee211) THEN
               LET g_qryparam.arg1 = "2"
               LET g_qryparam.arg2 = g_xmee_m.xmee211
               CALL q_dbaa001_2()                                #呼叫開窗
            ELSE
               LET g_qryparam.arg1 = "2"
               CALL q_dbaa001_1()                                #呼叫開窗
            END IF
            LET g_xmee_m.xmee210 = g_qryparam.return1              

            DISPLAY g_xmee_m.xmee210 TO xmee210              #
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee210) RETURNING g_xmee_m.xmee210_desc
            DISPLAY BY NAME g_xmee_m.xmee210_desc
            NEXT FIELD xmee210                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.xmee209
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee209
            #add-point:ON ACTION controlp INFIELD xmee209 name="input.c.xmee209"
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmee209             #給予default值
            IF NOT cl_null(g_xmee_m.xmee210) THEN
               LET g_qryparam.arg1 = "3"
               LET g_qryparam.arg2 = g_xmee_m.xmee210
               CALL q_dbaa001_2()                                #呼叫開窗
            ELSE
               LET g_qryparam.arg1 = "3"
               CALL q_dbaa001_1()                                #呼叫開窗
            END IF
            LET g_xmee_m.xmee209 = g_qryparam.return1              
            DISPLAY g_xmee_m.xmee209 TO xmee209              #
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee209) RETURNING g_xmee_m.xmee209_desc
            DISPLAY BY NAME g_xmee_m.xmee209_desc
            NEXT FIELD xmee209                          #返回原欄位

            #END add-point
 
 
         #Ctrlp:input.c.xmee208
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee208
            #add-point:ON ACTION controlp INFIELD xmee208 name="input.c.xmee208"
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmee208             #給予default值
            IF NOT cl_null(g_xmee_m.xmee209) THEN
               LET g_qryparam.arg1 = "4"
               LET g_qryparam.arg2 = g_xmee_m.xmee209
               CALL q_dbaa001_2()                                #呼叫開窗
            ELSE
               LET g_qryparam.arg1 = "4"
               CALL q_dbaa001_1()                                #呼叫開窗
            END IF
            LET g_xmee_m.xmee208 = g_qryparam.return1              
            DISPLAY g_xmee_m.xmee208 TO xmee208              #
            CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee208) RETURNING g_xmee_m.xmee208_desc
            DISPLAY BY NAME g_xmee_m.xmee208_desc
            NEXT FIELD xmee208                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmeeunit
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmeeunit
            #add-point:ON ACTION controlp INFIELD xmeeunit name="input.c.xmeeunit"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmeeunit             #給予default值

            #給予arg
#            LET g_qryparam.arg1 = '2'
#            
#            CALL q_ooed004_2()                                #呼叫開窗
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'xmeeunit',g_xmee_m.xmeesite,'i') #150308-00001#1  By Ken add 'i' 150309
            CALL q_ooef001_24()
            LET g_xmee_m.xmeeunit = g_qryparam.return1              

            DISPLAY g_xmee_m.xmeeunit TO xmeeunit              #
            CALL s_desc_get_department_desc(g_xmee_m.xmeeunit) RETURNING g_xmee_m.xmeeunit_desc
            NEXT FIELD xmeeunit                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee071
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee071
            #add-point:ON ACTION controlp INFIELD xmee071 name="input.c.xmee071"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmee903
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee903
            #add-point:ON ACTION controlp INFIELD xmee903 name="input.c.xmee903"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee903             #給予default值
            LET g_qryparam.default2 = "" #g_xmee_m.oocq002 #應用分類碼
            #02749  150122 add ----------------------(S)
            #LET g_qryparam.arg1 = '267' 
            LET g_qryparam.arg1 = g_acc_282
            #02749  150122 add ----------------------(E) 
            
            CALL q_oocq002()                                #呼叫開窗

            LET g_xmee_m.xmee903 = g_qryparam.return1             
            DISPLAY g_xmee_m.xmee903 TO xmee903              #
            #02749  150122 add ----------------------(S)
            #CALL s_desc_get_acc_desc('267',g_xmee_m.xmee903) RETURNING g_xmee_m.xmee903_desc
            CALL s_desc_get_acc_desc(g_acc_282,g_xmee_m.xmee903) RETURNING g_xmee_m.xmee903_desc
            #02749  150122 add ----------------------(E)
            NEXT FIELD xmee903                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee904
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee904
            #add-point:ON ACTION controlp INFIELD xmee904 name="input.c.xmee904"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmee025
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee025
            #add-point:ON ACTION controlp INFIELD xmee025 name="input.c.xmee025"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee025             #給予default值
            LET g_qryparam.where = " oofb008 = '3' "               #聯絡地址
            #給予arg
			   LET g_qryparam.arg1 = l_pmaa027
            CALL q_oofb019_1()                                     #呼叫開窗
            LET g_xmee_m.xmee025 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_xmee_m.xmee025 TO xmee025                    #顯示到畫面上
            CALL s_adb_address_ref('3',g_xmee_m.xmee025,g_xmee_m.xmee022)
               RETURNING l_oofb011,l_address
            LET g_xmee_m.xmee025_desc = l_oofb011
            LET g_xmee_m.oofb017 = l_address
            DISPLAY BY NAME g_xmee_m.xmee025_desc,g_xmee_m.oofb017
            NEXT FIELD xmee025                                     #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee026
            #add-point:ON ACTION controlp INFIELD xmee026 name="input.c.xmee026"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmee026             #給予default值

            #給予arg
			   LET g_qryparam.arg1 = l_pmaa027
            LET g_qryparam.where = " oofb008 = '5' "          #聯絡地址
            CALL q_oofb019_1()                                #呼叫開窗

            LET g_xmee_m.xmee026 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee026 TO xmee026              #顯示到畫面上
            CALL s_adb_address_ref('5',g_xmee_m.xmee026,g_xmee_m.xmee021)
               RETURNING l_oofb011,l_address
            LET g_xmee_m.xmee026_desc = l_oofb011
            LET g_xmee_m.oofb017_1 = l_address 
            DISPLAY BY NAME g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1
            NEXT FIELD xmee026                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee020
            #add-point:ON ACTION controlp INFIELD xmee020 name="input.c.xmee020"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee020             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "263" #

            CALL q_oocq002()                                #呼叫開窗

            LET g_xmee_m.xmee020 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee020 TO xmee020              #顯示到畫面上
            CALL s_desc_get_acc_desc('263',g_xmee_m.xmee020) RETURNING g_xmee_m.xmee020_desc
            DISPLAY BY NAME g_xmee_m.xmee020_desc
            NEXT FIELD xmee020                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee036
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee036
            #add-point:ON ACTION controlp INFIELD xmee036 name="input.c.xmee036"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee036             #給予default值

            #給予arg

            CALL q_pmaa001_3()                                #呼叫開窗

            LET g_xmee_m.xmee036 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee036 TO xmee036              #顯示到畫面上

            NEXT FIELD xmee036                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee048
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee048
            #add-point:ON ACTION controlp INFIELD xmee048 name="input.c.xmee048"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmee049
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee049
            #add-point:ON ACTION controlp INFIELD xmee049 name="input.c.xmee049"
            
            #END add-point
 
 
         #Ctrlp:input.c.xmee009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee009
            #add-point:ON ACTION controlp INFIELD xmee009 name="input.c.xmee009"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmee_m.xmee009             #給予default值
            LET g_qryparam.arg1 = g_xmee_m.xmee004
            CALL q_pmad002_3()                                 #呼叫開窗
            LET g_xmee_m.xmee009 = g_qryparam.return1          #將開窗取得的值回傳到變數
            DISPLAY g_xmee_m.xmee009 TO xmee009                #顯示到畫面上
            CALL s_desc_get_ooib002_desc(g_xmee_m.xmee009) RETURNING g_xmee_m.xmee009_desc
            DISPLAY BY NAME g_xmee_m.xmee009_desc
            NEXT FIELD xmee009                                 #返回原欄位
  

            #END add-point
 
 
         #Ctrlp:input.c.xmee010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee010
            #add-point:ON ACTION controlp INFIELD xmee010 name="input.c.xmee010"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee010             #給予default值

            #給予arg
			LET g_qryparam.arg1 = '238'
            CALL q_oocq002()                                #呼叫開窗

            LET g_xmee_m.xmee010 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee010 TO xmee010              #顯示到畫面上
            CALL s_desc_get_acc_desc('238',g_xmee_m.xmee010) RETURNING g_xmee_m.xmee010_desc
            DISPLAY BY NAME g_xmee_m.xmee010_desc
            NEXT FIELD xmee010                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee035
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee035
            #add-point:ON ACTION controlp INFIELD xmee035 name="input.c.xmee035"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee035             #給予default值


            #給予arg
            SELECT ooef019 INTO l_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_xmee_m.xmeesite
            LET g_qryparam.arg1 = l_ooef019 
            LET g_qryparam.arg2 = "2" 
            CALL q_isac002_1()                            #呼叫開窗

            LET g_xmee_m.xmee035 = g_qryparam.return1              #將開窗取得的值回傳到變數
            CALL s_desc_get_invoice_type_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee035) RETURNING g_xmee_m.xmee035_desc
            DISPLAY BY NAME g_xmee_m.xmee035_desc           

            DISPLAY g_xmee_m.xmee035 TO xmee035              #顯示到畫面上
           

            NEXT FIELD xmee035                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee039
            #add-point:ON ACTION controlp INFIELD xmee039 name="input.c.xmee039"
                                                                        
            #END add-point
 
 
         #Ctrlp:input.c.xmee034
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee034
            #add-point:ON ACTION controlp INFIELD xmee034 name="input.c.xmee034"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee034             #給予default值
            LET g_qryparam.arg1 = 'ALL'
            CALL q_pmaa001_6()                                #呼叫開窗
            LET g_xmee_m.xmee034 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_xmee_m.xmee034 TO xmee034              #顯示到畫面上
            NEXT FIELD xmee034                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee006
            #add-point:ON ACTION controlp INFIELD xmee006 name="input.c.xmee006"
                                                                        
            #END add-point
 
 
         #Ctrlp:input.c.xmee017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee017
            #add-point:ON ACTION controlp INFIELD xmee017 name="input.c.xmee017"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee017             #給予default值

            #給予arg

            CALL q_xmah001()                                #呼叫開窗

            LET g_xmee_m.xmee017 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee017 TO xmee017              #顯示到畫面上

            NEXT FIELD xmee017                               #返回原欄位
            CALL adbt510_xmee017_ref(g_xmee_m.xmee017) RETURNING g_xmee_m.xmee017_desc
            DISPLAY BY NAME g_xmee_m.xmee017_desc

            #END add-point
 
 
         #Ctrlp:input.c.xmee018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee018
            #add-point:ON ACTION controlp INFIELD xmee018 name="input.c.xmee018"
                                                                        #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmee_m.xmee018             #給予default值

            #給予arg

            CALL q_ooid001_1()                                #呼叫開窗

            LET g_xmee_m.xmee018 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xmee_m.xmee018 TO xmee018              #顯示到畫面上
            CALL s_desc_ooid001_desc(g_xmee_m.xmee018) RETURNING g_xmee_m.xmee018_desc
            DISPLAY BY NAME g_xmee_m.xmee018_desc
            NEXT FIELD xmee018                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xmee019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee019
            #add-point:ON ACTION controlp INFIELD xmee019 name="input.c.xmee019"
                                                                        
            #END add-point
 
 
         #Ctrlp:input.c.xmee028
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmee028
            #add-point:ON ACTION controlp INFIELD xmee028 name="input.c.xmee028"
                                                                        
            #END add-point
 
 
 #欄位開窗
            
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
 
            #CALL cl_err_collect_show()      #錯誤訊息統整顯示
            #CALL cl_showmsg()
            DISPLAY BY NAME g_xmee_m.xmeedocno,g_xmee_m.xmee900
                        
            #add-point:單頭INPUT後 name="input.head.after_input"
            
            #end add-point
                        
            IF p_cmd <> 'u' THEN
    
               CALL s_transaction_begin()
               
               #add-point:單頭新增前 name="input.head.b_insert"
            
               #end add-point
               
               INSERT INTO xmee_t (xmeeent,xmeesite,xmee902,xmeedocno,xmee900,xmee901,xmee001,xmee202, 
                   xmee023,xmee004,xmee200,xmee201,xmeestus,xmee005,xmee007,xmee008,xmeedocdt,xmee024, 
                   xmee002,xmee003,xmeeacti,xmee021,xmee022,xmee203,xmee027,xmee211,xmee210,xmee209, 
                   xmee208,xmeeunit,xmee204,xmee205,xmee032,xmee071,xmee903,xmee904,xmee025,xmee026, 
                   xmee206,xmee207,xmee020,xmee036,xmee048,xmee049,xmee009,xmee010,xmee015,xmee016,xmee011, 
                   xmee012,xmee013,xmee035,xmee039,xmeeownid,xmeeowndp,xmeecrtid,xmeecrtdp,xmeecrtdt, 
                   xmeemodid,xmeemoddt,xmeecnfid,xmeecnfdt,xmee034,xmee041,xmee006,xmee042,xmee017,xmee043, 
                   xmee018,xmee019,xmee028)
               VALUES (g_enterprise,g_xmee_m.xmeesite,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900, 
                   g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202,g_xmee_m.xmee023,g_xmee_m.xmee004, 
                   g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee007, 
                   g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
                   g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027, 
                   g_xmee_m.xmee211,g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit, 
                   g_xmee_m.xmee204,g_xmee_m.xmee205,g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903, 
                   g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026,g_xmee_m.xmee206,g_xmee_m.xmee207, 
                   g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049,g_xmee_m.xmee009, 
                   g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
                   g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp, 
                   g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt, 
                   g_xmee_m.xmeecnfid,g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006, 
                   g_xmee_m.xmee042,g_xmee_m.xmee017,g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019, 
                   g_xmee_m.xmee028) 
               IF SQLCA.SQLCODE THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "g_xmee_m:",SQLERRMESSAGE 
                  LET g_errparam.code = SQLCA.SQLCODE 
                  LET g_errparam.popup = TRUE 
                  CALL s_transaction_end('N','0')
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭新增中 name="input.head.m_insert"
               #將單身資料新增到資料庫內
               IF NOT adbt510_ins_xmjb() THEN
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF 
               #將單身資料新增到資料庫內
               IF NOT adbt510_ins_xmeg() THEN
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF               
               #將多期預收款資料新增到資料庫內 
               IF NOT adbt510_ins_xmef() THEN
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF                 
               #將交期明細資料新增到資料庫內
               IF NOT adbt510_ins_xmeh() THEN
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF               
               #將交期明細匯總檔資料新增到資料庫內
               IF NOT adbt510_ins_xmej() THEN
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF   
               #單頭unit變更
               IF (g_xmee_m.xmeeunit <> g_xmee_m_t.xmeeunit OR
                  (cl_null(g_xmee_m.xmeeunit) AND NOT cl_null(g_xmee_m_t.xmeeunit)) OR
                  (NOT cl_null(g_xmee_m.xmeeunit) AND cl_null(g_xmee_m_t.xmeeunit))) AND g_upd_unit = 'Y' THEN
                  IF NOT adbt510_upd_xmeeunit() THEN
                     CALL s_transaction_end('N','0')
                     CONTINUE DIALOG
                  END IF
               END IF                
               #end add-point
               
               
               
               
               #add-point:單頭新增後 name="input.head.a_insert"
               IF NOT adbt510_upd_xmee901() THEN
                  CONTINUE DIALOG
               END IF                                                                       
               #end add-point
               CALL s_transaction_end('Y','0') 
               
               IF l_cmd_t = 'r' AND p_cmd = 'a' THEN
                  CALL adbt510_detail_reproduce()
                  #因應特定程式需求, 重新刷新單身資料
                  CALL adbt510_b_fill()
                  CALL adbt510_b_fill2('0')
               END IF
               
               #add-point:單頭新增後 name="input.head.a_insert2"
               
               #end add-point
               
               LET g_master_insert = TRUE
               
               LET p_cmd = 'u'
            ELSE
               CALL s_transaction_begin()
            
               #add-point:單頭修改前 name="input.head.b_update"
                                                                                          
               #end add-point
               
               #將遮罩欄位還原
               CALL adbt510_xmee_t_mask_restore('restore_mask_o')
               
               UPDATE xmee_t SET (xmeesite,xmee902,xmeedocno,xmee900,xmee901,xmee001,xmee202,xmee023, 
                   xmee004,xmee200,xmee201,xmeestus,xmee005,xmee007,xmee008,xmeedocdt,xmee024,xmee002, 
                   xmee003,xmeeacti,xmee021,xmee022,xmee203,xmee027,xmee211,xmee210,xmee209,xmee208, 
                   xmeeunit,xmee204,xmee205,xmee032,xmee071,xmee903,xmee904,xmee025,xmee026,xmee206, 
                   xmee207,xmee020,xmee036,xmee048,xmee049,xmee009,xmee010,xmee015,xmee016,xmee011,xmee012, 
                   xmee013,xmee035,xmee039,xmeeownid,xmeeowndp,xmeecrtid,xmeecrtdp,xmeecrtdt,xmeemodid, 
                   xmeemoddt,xmeecnfid,xmeecnfdt,xmee034,xmee041,xmee006,xmee042,xmee017,xmee043,xmee018, 
                   xmee019,xmee028) = (g_xmee_m.xmeesite,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900, 
                   g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202,g_xmee_m.xmee023,g_xmee_m.xmee004, 
                   g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee007, 
                   g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
                   g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027, 
                   g_xmee_m.xmee211,g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit, 
                   g_xmee_m.xmee204,g_xmee_m.xmee205,g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903, 
                   g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026,g_xmee_m.xmee206,g_xmee_m.xmee207, 
                   g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049,g_xmee_m.xmee009, 
                   g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
                   g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp, 
                   g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt, 
                   g_xmee_m.xmeecnfid,g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006, 
                   g_xmee_m.xmee042,g_xmee_m.xmee017,g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019, 
                   g_xmee_m.xmee028)
                WHERE xmeeent = g_enterprise AND xmeedocno = g_xmeedocno_t
                  AND xmee900 = g_xmee900_t
 
               IF SQLCA.SQLCODE THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "xmee_t:",SQLERRMESSAGE 
                  LET g_errparam.code = SQLCA.SQLCODE 
                  LET g_errparam.popup = TRUE 
                  CALL s_transaction_end('N','0')
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭修改中 name="input.head.m_update"
               IF g_xmee_m.xmee022 <> g_xmee_m_t.xmee022 THEN
                  CALL adbt510_change_xmee022()
               END IF 
               IF (g_xmee_m.xmeeunit <> g_xmee_m_t.xmeeunit OR
                  (cl_null(g_xmee_m.xmeeunit) AND NOT cl_null(g_xmee_m_t.xmeeunit)) OR
                  (NOT cl_null(g_xmee_m.xmeeunit) AND cl_null(g_xmee_m_t.xmeeunit))) AND g_upd_unit = 'Y' THEN
                  IF NOT adbt510_upd_xmeeunit() THEN
                     CALL s_transaction_end('N','0')
                     CONTINUE DIALOG
                  END IF
               END IF                  
               #end add-point
               
               
               
               
               #將遮罩欄位進行遮蔽
               CALL adbt510_xmee_t_mask_restore('restore_mask_n')
               
               #修改歷程記錄(單頭修改)
               LET g_log1 = util.JSON.stringify(g_xmee_m_t)
               LET g_log2 = util.JSON.stringify(g_xmee_m)
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
               
               #add-point:單頭修改後 name="input.head.a_update"
               IF NOT adbt510_upd_xmee901() THEN
                  CONTINUE DIALOG
               END IF                                                                      
               #end add-point
            END IF
            
            LET g_master_commit = "Y"
            LET g_xmeedocno_t = g_xmee_m.xmeedocno
            LET g_xmee900_t = g_xmee_m.xmee900
 
            
      END INPUT
   
 
{</section>}
 
{<section id="adbt510.input.body" >}
   
      #Page1 預設值產生於此處
      INPUT ARRAY g_xmeg_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = FALSE, 
                  DELETE ROW = FALSE,
                  APPEND ROW = FALSE)
 
         #自訂ACTION(detail_input,page_1)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body.before_input2"
            
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_xmeg_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL adbt510_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'1',"))
            END IF
            LET g_loc = 'm'
            LET g_rec_b = g_xmeg_d.getLength()
            #add-point:資料輸入前 name="input.d.before_input"
            RETURN                                                         
            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2 name="input.body.before_row2"
            
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_detail_idx_list[1] = l_ac
            LET g_current_page = 1
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN adbt510_cl USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN adbt510_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE adbt510_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xmeg_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xmeg_d[l_ac].xmegseq IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_xmeg_d_t.* = g_xmeg_d[l_ac].*  #BACKUP
               LET g_xmeg_d_o.* = g_xmeg_d[l_ac].*  #BACKUP
               CALL adbt510_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body.after_set_entry_b"
                                                                                          
               #end add-point  
               CALL adbt510_set_no_entry_b(l_cmd)
               IF NOT adbt510_lock_b("xmeg_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH adbt510_bcl INTO g_xmeg_d[l_ac].xmegsite,g_xmeg_d[l_ac].xmegseq,g_xmeg_d[l_ac].xmeg027, 
                      g_xmeg_d[l_ac].xmeg001,g_xmeg_d[l_ac].xmeg002,g_xmeg_d[l_ac].xmeg004,g_xmeg_d[l_ac].xmeg005, 
                      g_xmeg_d[l_ac].xmeg006,g_xmeg_d[l_ac].xmeg007,g_xmeg_d[l_ac].xmeg008,g_xmeg_d[l_ac].xmeg009, 
                      g_xmeg_d[l_ac].xmeg024,g_xmeg_d[l_ac].xmeg012,g_xmeg_d[l_ac].xmeg013,g_xmeg_d[l_ac].xmeg045, 
                      g_xmeg_d[l_ac].xmeg010,g_xmeg_d[l_ac].xmeg011,g_xmeg_d[l_ac].xmeg015,g_xmeg_d[l_ac].xmeg016, 
                      g_xmeg_d[l_ac].xmeg017,g_xmeg_d[l_ac].xmeg046,g_xmeg_d[l_ac].xmeg047,g_xmeg_d[l_ac].xmeg048, 
                      g_xmeg_d[l_ac].xmeg023,g_xmeg_d[l_ac].xmeg019,g_xmeg_d[l_ac].xmeg020,g_xmeg_d[l_ac].xmeg021, 
                      g_xmeg_d[l_ac].xmeg022,g_xmeg_d[l_ac].xmeg051,g_xmeg_d[l_ac].xmegunit,g_xmeg_d[l_ac].xmegorga, 
                      g_xmeg_d[l_ac].xmeg052,g_xmeg_d[l_ac].xmeg049,g_xmeg_d[l_ac].xmeg053,g_xmeg_d[l_ac].xmeg050, 
                      g_xmeg_d[l_ac].xmeg901,g_xmeg_d[l_ac].xmeg902,g_xmeg_d[l_ac].xmeg903
                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_xmeg_d_t.xmegseq,":",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xmeg_d_mask_o[l_ac].* =  g_xmeg_d[l_ac].*
                  CALL adbt510_xmeg_t_mask()
                  LET g_xmeg_d_mask_n[l_ac].* =  g_xmeg_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL adbt510_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body.before_row"
                                                                      
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
        
         BEFORE INSERT  
            
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xmeg_d[l_ac].* TO NULL 
            INITIALIZE g_xmeg_d_t.* TO NULL 
            INITIALIZE g_xmeg_d_o.* TO NULL 
            #公用欄位給值(單身)
            
            #自定義預設值
                  LET g_xmeg_d[l_ac].xmeg007 = "0"
      LET g_xmeg_d[l_ac].xmeg009 = "0"
      LET g_xmeg_d[l_ac].xmeg024 = "N"
      LET g_xmeg_d[l_ac].xmeg045 = "1"
      LET g_xmeg_d[l_ac].xmeg011 = "0"
      LET g_xmeg_d[l_ac].xmeg015 = "0"
      LET g_xmeg_d[l_ac].xmeg046 = "0"
      LET g_xmeg_d[l_ac].xmeg047 = "0"
      LET g_xmeg_d[l_ac].xmeg048 = "0"
      LET g_xmeg_d[l_ac].xmeg019 = "1"
      LET g_xmeg_d[l_ac].xmeg020 = "1"
      LET g_xmeg_d[l_ac].xmeg021 = "N"
      LET g_xmeg_d[l_ac].xmeg022 = "Y"
      LET g_xmeg_d[l_ac].xmeg052 = "Y"
 
            #add-point:modify段before備份 name="input.body.insert.before_bak"
            
            #end add-point
            LET g_xmeg_d_t.* = g_xmeg_d[l_ac].*     #新輸入資料
            LET g_xmeg_d_o.* = g_xmeg_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL adbt510_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body.insert.after_set_entry_b"
                                                                        
            #end add-point
            CALL adbt510_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xmeg_d[li_reproduce_target].* = g_xmeg_d[li_reproduce].*
 
               LET g_xmeg_d[li_reproduce_target].xmegseq = NULL
 
            END IF
            
 
            #add-point:modify段before insert name="input.body.before_insert"
         
            #end add-point  
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身新增 name="input.body.b_a_insert"
               
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xmeg_t 
             WHERE xmegent = g_enterprise AND xmegdocno = g_xmee_m.xmeedocno
               AND xmeg900 = g_xmee_m.xmee900
 
               AND xmegseq = g_xmeg_d[l_ac].xmegseq
 
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身新增前 name="input.body.b_insert"
                                                                                          
               #end add-point
            
               #同步新增到同層的table
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xmee_m.xmeedocno
               LET gs_keys[2] = g_xmee_m.xmee900
               LET gs_keys[3] = g_xmeg_d[g_detail_idx].xmegseq
               CALL adbt510_insert_b('xmeg_t',gs_keys,"'1'")
                           
               #add-point:單身新增後 name="input.body.a_insert"
                                                                                          
               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               INITIALIZE g_xmeg_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xmeg_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL adbt510_b_fill()
               #資料多語言用-增/改
               
               #add-point:input段-after_insert name="input.body.a_insert2"
         
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身刪除後(=d) name="input.body.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身刪除前 name="input.body.b_delete"
                                                                                          
               #end add-point 
               
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xmee_m.xmeedocno
               LET gs_keys[gs_keys.getLength()+1] = g_xmee_m.xmee900
 
               LET gs_keys[gs_keys.getLength()+1] = g_xmeg_d_t.xmegseq
 
            
               #刪除同層單身
               IF NOT adbt510_delete_b('xmeg_t',gs_keys,"'1'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE adbt510_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT adbt510_key_delete_b(gs_keys,'xmeg_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE adbt510_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身刪除中 name="input.body.m_delete"
                                                                                          
               #end add-point 
               
               CALL s_transaction_end('Y','0')
               CLOSE adbt510_bcl
            
               LET g_rec_b = g_rec_b-1
               #add-point:單身刪除後 name="input.body.a_delete"
    
               #end add-point
               LET l_count = g_xmeg_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body.after_delete"
                                                                        
               #end add-point
            END IF
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xmeg_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmegsite
            #add-point:BEFORE FIELD xmegsite name="input.b.page1.xmegsite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmegsite
            
            #add-point:AFTER FIELD xmegsite name="input.a.page1.xmegsite"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmegsite
            #add-point:ON CHANGE xmegsite name="input.g.page1.xmegsite"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page1.xmegsite
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmegsite
            #add-point:ON ACTION controlp INFIELD xmegsite name="input.c.page1.xmegsite"
            
            #END add-point
 
 
 
 
         ON ROW CHANGE
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xmeg_d[l_ac].* = g_xmeg_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE adbt510_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_xmeg_d[l_ac].xmegseq 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_xmeg_d[l_ac].* = g_xmeg_d_t.*
            ELSE
            
               #add-point:單身修改前 name="input.body.b_update"
                                                                                          
               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
               #將遮罩欄位還原
               CALL adbt510_xmeg_t_mask_restore('restore_mask_o')
      
               UPDATE xmeg_t SET (xmegdocno,xmeg900,xmegsite,xmegseq,xmeg027,xmeg001,xmeg002,xmeg004, 
                   xmeg005,xmeg006,xmeg007,xmeg008,xmeg009,xmeg024,xmeg012,xmeg013,xmeg045,xmeg010,xmeg011, 
                   xmeg015,xmeg016,xmeg017,xmeg046,xmeg047,xmeg048,xmeg023,xmeg019,xmeg020,xmeg021,xmeg022, 
                   xmeg051,xmegunit,xmegorga,xmeg052,xmeg049,xmeg053,xmeg050,xmeg901,xmeg902,xmeg903) = (g_xmee_m.xmeedocno, 
                   g_xmee_m.xmee900,g_xmeg_d[l_ac].xmegsite,g_xmeg_d[l_ac].xmegseq,g_xmeg_d[l_ac].xmeg027, 
                   g_xmeg_d[l_ac].xmeg001,g_xmeg_d[l_ac].xmeg002,g_xmeg_d[l_ac].xmeg004,g_xmeg_d[l_ac].xmeg005, 
                   g_xmeg_d[l_ac].xmeg006,g_xmeg_d[l_ac].xmeg007,g_xmeg_d[l_ac].xmeg008,g_xmeg_d[l_ac].xmeg009, 
                   g_xmeg_d[l_ac].xmeg024,g_xmeg_d[l_ac].xmeg012,g_xmeg_d[l_ac].xmeg013,g_xmeg_d[l_ac].xmeg045, 
                   g_xmeg_d[l_ac].xmeg010,g_xmeg_d[l_ac].xmeg011,g_xmeg_d[l_ac].xmeg015,g_xmeg_d[l_ac].xmeg016, 
                   g_xmeg_d[l_ac].xmeg017,g_xmeg_d[l_ac].xmeg046,g_xmeg_d[l_ac].xmeg047,g_xmeg_d[l_ac].xmeg048, 
                   g_xmeg_d[l_ac].xmeg023,g_xmeg_d[l_ac].xmeg019,g_xmeg_d[l_ac].xmeg020,g_xmeg_d[l_ac].xmeg021, 
                   g_xmeg_d[l_ac].xmeg022,g_xmeg_d[l_ac].xmeg051,g_xmeg_d[l_ac].xmegunit,g_xmeg_d[l_ac].xmegorga, 
                   g_xmeg_d[l_ac].xmeg052,g_xmeg_d[l_ac].xmeg049,g_xmeg_d[l_ac].xmeg053,g_xmeg_d[l_ac].xmeg050, 
                   g_xmeg_d[l_ac].xmeg901,g_xmeg_d[l_ac].xmeg902,g_xmeg_d[l_ac].xmeg903)
                WHERE xmegent = g_enterprise AND xmegdocno = g_xmee_m.xmeedocno 
                  AND xmeg900 = g_xmee_m.xmee900 
 
                  AND xmegseq = g_xmeg_d_t.xmegseq #項次   
 
                  
               #add-point:單身修改中 name="input.body.m_update"
                                                                                          
               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xmeg_d[l_ac].* = g_xmeg_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xmeg_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_xmeg_d[l_ac].* = g_xmeg_d_t.*  
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xmeg_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()                   
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xmee_m.xmeedocno
               LET gs_keys_bak[1] = g_xmeedocno_t
               LET gs_keys[2] = g_xmee_m.xmee900
               LET gs_keys_bak[2] = g_xmee900_t
               LET gs_keys[3] = g_xmeg_d[g_detail_idx].xmegseq
               LET gs_keys_bak[3] = g_xmeg_d_t.xmegseq
               CALL adbt510_update_b('xmeg_t',gs_keys,gs_keys_bak,"'1'")
               END CASE
 
               #將遮罩欄位進行遮蔽
               CALL adbt510_xmeg_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT(g_xmeg_d[g_detail_idx].xmegseq = g_xmeg_d_t.xmegseq 
 
                  ) THEN
                  LET gs_keys[01] = g_xmee_m.xmeedocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xmee_m.xmee900
 
                  LET gs_keys[gs_keys.getLength()+1] = g_xmeg_d_t.xmegseq
 
                  CALL adbt510_key_update_b(gs_keys,'xmeg_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xmee_m),util.JSON.stringify(g_xmeg_d_t)
               LET g_log2 = util.JSON.stringify(g_xmee_m),util.JSON.stringify(g_xmeg_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身修改後 name="input.body.a_update"
                                                                                                                                     
               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row name="input.body.after_row"
                                                                        
            #end add-point
            CALL adbt510_unlock_b("xmeg_t","'1'")
            CALL s_transaction_end('Y','0')
            #其他table進行unlock
            #add-point:單身after_row2 name="input.body.after_row2"
            
            #end add-point
              
         AFTER INPUT
            #add-point:input段after input  name="input.body.after_input"
                                                                        
            #end add-point 
    
         ON ACTION controlo    
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xmeg_d[li_reproduce_target].* = g_xmeg_d[li_reproduce].*
 
               LET g_xmeg_d[li_reproduce_target].xmegseq = NULL
 
            ELSE
               CALL FGL_SET_ARR_CURR(g_xmeg_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xmeg_d.getLength()+1
            END IF
            
         #ON ACTION cancel
         #   LET INT_FLAG = 1
         #   LET g_detail_idx = 1
         #   EXIT DIALOG 
 
      END INPUT
      
      INPUT ARRAY g_xmeg4_d FROM s_detail4.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = FALSE, #此頁面insert功能由產生器控制, 手動之設定無效! 
 
                 DELETE ROW = FALSE,
                 APPEND ROW = FALSE)
                 
         #自訂ACTION(detail_input,page_4)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body4.before_input2"
            
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_xmeg4_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL adbt510_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'4',"))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_xmeg4_d.getLength()
            #add-point:資料輸入前 name="input.body4.before_input"
            #160513-00027#1 20160520 add by beckxie---S
            CALL adbt510_set_comp_visible_b()
            CALL adbt510_set_comp_no_visible_b()
            #160513-00027#1 20160520 add by beckxie---E
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xmeg4_d[l_ac].* TO NULL 
            INITIALIZE g_xmeg4_d_t.* TO NULL 
            INITIALIZE g_xmeg4_d_o.* TO NULL 
            #公用欄位給值(單身4)
            
            #自定義預設值(單身4)
                  LET g_xmeg4_d[l_ac].xmjb012 = "0"
      LET g_xmeg4_d[l_ac].xmjb014 = "0"
      LET g_xmeg4_d[l_ac].xmjb016 = "0"
      LET g_xmeg4_d[l_ac].xmjb018 = "0"
      LET g_xmeg4_d[l_ac].xmjb008 = "0"
      LET g_xmeg4_d[l_ac].xmjb009 = "0"
      LET g_xmeg4_d[l_ac].xmjb010 = "0"
      LET g_xmeg4_d[l_ac].xmjb022 = "0"
      LET g_xmeg4_d[l_ac].xmjb019 = "0"
      LET g_xmeg4_d[l_ac].xmjb020 = "0"
      LET g_xmeg4_d[l_ac].xmjb021 = "0"
      LET g_xmeg4_d[l_ac].xmjb030 = "N"
 
            #add-point:modify段before備份 name="input.body4.insert.before_bak"
            LET g_xmeg4_d[l_ac].xmjb025 = g_xmee_m.xmee022   #160513-00027#1 20160520 add by beckxie
            #end add-point
            LET g_xmeg4_d_t.* = g_xmeg4_d[l_ac].*     #新輸入資料
            LET g_xmeg4_d_o.* = g_xmeg4_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL adbt510_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body4.insert.after_set_entry_b"
 
            #end add-point
            CALL adbt510_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xmeg4_d[li_reproduce_target].* = g_xmeg4_d[li_reproduce].*
 
               LET g_xmeg4_d[li_reproduce_target].xmjbseq = NULL
            END IF
            
 
            #add-point:modify段before insert name="input.body4.before_insert"
 
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body4.before_row2"
            LET l_delete =FALSE
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[4] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 4
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN adbt510_cl USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN adbt510_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE adbt510_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xmeg4_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xmeg4_d[l_ac].xmjbseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_xmeg4_d_t.* = g_xmeg4_d[l_ac].*  #BACKUP
               LET g_xmeg4_d_o.* = g_xmeg4_d[l_ac].*  #BACKUP
               CALL adbt510_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body4.after_set_entry_b"
               CALL adbt510_set_no_required_b()
               CALL adbt510_set_required_b()
               #end add-point  
               CALL adbt510_set_no_entry_b(l_cmd)
               IF NOT adbt510_lock_b("xmjb_t","'4'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH adbt510_bcl4 INTO g_xmeg4_d[l_ac].xmjbunit,g_xmeg4_d[l_ac].xmjbseq,g_xmeg4_d[l_ac].xmjbsite, 
                      g_xmeg4_d[l_ac].xmjb001,g_xmeg4_d[l_ac].xmjb002,g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb033, 
                      g_xmeg4_d[l_ac].xmjb004,g_xmeg4_d[l_ac].xmjb005,g_xmeg4_d[l_ac].xmjb006,g_xmeg4_d[l_ac].xmjb007, 
                      g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb012,g_xmeg4_d[l_ac].xmjb013,g_xmeg4_d[l_ac].xmjb014, 
                      g_xmeg4_d[l_ac].xmjb015,g_xmeg4_d[l_ac].xmjb016,g_xmeg4_d[l_ac].xmjb017,g_xmeg4_d[l_ac].xmjb018, 
                      g_xmeg4_d[l_ac].xmjb008,g_xmeg4_d[l_ac].xmjb009,g_xmeg4_d[l_ac].xmjb010,g_xmeg4_d[l_ac].xmjb022, 
                      g_xmeg4_d[l_ac].xmjb019,g_xmeg4_d[l_ac].xmjb020,g_xmeg4_d[l_ac].xmjb021,g_xmeg4_d[l_ac].xmjb024, 
                      g_xmeg4_d[l_ac].xmjb025,g_xmeg4_d[l_ac].xmjb026,g_xmeg4_d[l_ac].xmjb027,g_xmeg4_d[l_ac].xmjb028, 
                      g_xmeg4_d[l_ac].xmjb029,g_xmeg4_d[l_ac].xmjb030,g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032, 
                      g_xmeg4_d[l_ac].xmjb040,g_xmeg4_d[l_ac].xmjb039,g_xmeg4_d[l_ac].xmjb038,g_xmeg4_d[l_ac].xmjb037, 
                      g_xmeg4_d[l_ac].xmjb034,g_xmeg4_d[l_ac].xmjb901,g_xmeg4_d[l_ac].xmjb902,g_xmeg4_d[l_ac].xmjb903 
 
                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xmeg4_d_mask_o[l_ac].* =  g_xmeg4_d[l_ac].*
                  CALL adbt510_xmjb_t_mask()
                  LET g_xmeg4_d_mask_n[l_ac].* =  g_xmeg4_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL adbt510_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body4.before_row"
            
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body4.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body4.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身4刪除前 name="input.body4.b_delete"
 
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xmee_m.xmeedocno
               LET gs_keys[gs_keys.getLength()+1] = g_xmee_m.xmee900
               LET gs_keys[gs_keys.getLength()+1] = g_xmeg4_d_t.xmjbseq
            
               #刪除同層單身
               IF NOT adbt510_delete_b('xmjb_t',gs_keys,"'4'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE adbt510_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT adbt510_key_delete_b(gs_keys,'xmjb_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE adbt510_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身4刪除中 name="input.body4.m_delete"
               
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE adbt510_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身4刪除後 name="input.body4.a_delete"
                  DELETE FROM xmeh_t 
                   WHERE xmehent = g_enterprise 
                     AND xmehdocno = g_xmee_m.xmeedocno 
                     AND xmehseq = g_xmeg4_d_t.xmjbseq
                     AND xmeh900 = g_xmee_m.xmee900
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "xmeh_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     CANCEL DELETE
                  END IF 
                  #刪除訂單多交期匯總檔
                  LET l_cnt = 0
                 #SELECT COUNT(*) INTO l_cnt         #170207-00004#2 170219 by 02749 mark
                  SELECT COUNT(xmejseq) INTO l_cnt   #170207-00004#2 170219 by 02749 add
                    FROM xmej_t
                   WHERE xmejent = g_enterprise 
                     AND xmejdocno = g_xmee_m.xmeedocno 
                     AND xmejseq = g_xmeg4_d_t.xmjbseq
                     AND xmej900 = g_xmee_m.xmee900
                  IF l_cnt > 0 THEN                     
                     DELETE FROM xmej_t 
                      WHERE xmejent = g_enterprise 
                        AND xmejdocno = g_xmee_m.xmeedocno 
                        AND xmejseq = g_xmeg4_d_t.xmjbseq
                        AND xmej900 = g_xmee_m.xmee900
                     IF SQLCA.sqlcode THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = SQLCA.sqlcode
                        LET g_errparam.extend = "xmej_t"
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                        CALL s_transaction_end('N','0')
                        CANCEL DELETE
                     END IF           
                  END IF  
                  #刪除訂單單身明細
                  LET l_cnt = 0
                 #SELECT COUNT(*) INTO l_cnt         #170207-00004#2 170219 by 02749 mark
                  SELECT COUNT(xmegseq) INTO l_cnt   #170207-00004#2 170219 by 02749 add
                    FROM xmeg_t
                   WHERE xmegent = g_enterprise 
                     AND xmegdocno = g_xmee_m.xmeedocno 
                     AND xmegseq = g_xmeg4_d_t.xmjbseq
                     AND xmeg900 = g_xmee_m.xmee900
                  IF l_cnt > 0 THEN                     
                     DELETE FROM xmeg_t 
                      WHERE xmegent = g_enterprise 
                        AND xmegdocno = g_xmee_m.xmeedocno 
                        AND xmegseq = g_xmeg4_d_t.xmjbseq
                        AND xmeg900 = g_xmee_m.xmee900
                     IF SQLCA.sqlcode THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = SQLCA.sqlcode
                        LET g_errparam.extend = "xmeg_t"
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                        CALL s_transaction_end('N','0')
                        CANCEL DELETE
                     END IF           
                  END IF
                  #刪除變更歷程檔
                  DELETE FROM xmek_t
                   WHERE xmekent = g_enterprise
                     AND xmekdocno = g_xmee_m.xmeedocno 
                     AND xmek001 =  g_xmee_m.xmee900
                     AND xmekseq = g_xmeg4_d_t.xmjbseq
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "xmek_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     CANCEL DELETE
                  END IF  
                  LET l_delete =TRUE
               #end add-point
               LET l_count = g_xmeg_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body4.after_delete"
               
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xmeg4_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身4新增前 name="input.body4.b_a_insert"
 
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xmjb_t 
             WHERE xmjbent = g_enterprise AND xmjbdocno = g_xmee_m.xmeedocno
               AND xmjb900 = g_xmee_m.xmee900
               AND xmjbseq = g_xmeg4_d[l_ac].xmjbseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身4新增前 name="input.body4.b_insert"
               
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xmee_m.xmeedocno
               LET gs_keys[2] = g_xmee_m.xmee900
               LET gs_keys[3] = g_xmeg4_d[g_detail_idx].xmjbseq
               CALL adbt510_insert_b('xmjb_t',gs_keys,"'4'")
                           
               #add-point:單身新增後4 name="input.body4.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_xmeg_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xmjb_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL adbt510_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body4.after_insert"
 
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE adbt510_bcl4
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
            ELSE
               #add-point:單身page4修改前 name="input.body4.b_update"
               IF g_xmeg4_d[l_ac].xmjb901 = '1' THEN
                  LET g_xmeg4_d[l_ac].xmjb901 = '2'
               END IF 
               #end add-point
               
               #寫入修改者/修改日期資訊(單身4)
               
               
               #將遮罩欄位還原
               CALL adbt510_xmjb_t_mask_restore('restore_mask_o')
                              
               UPDATE xmjb_t SET (xmjbdocno,xmjb900,xmjbunit,xmjbseq,xmjbsite,xmjb001,xmjb002,xmjb003, 
                   xmjb033,xmjb004,xmjb005,xmjb006,xmjb007,xmjb011,xmjb012,xmjb013,xmjb014,xmjb015,xmjb016, 
                   xmjb017,xmjb018,xmjb008,xmjb009,xmjb010,xmjb022,xmjb019,xmjb020,xmjb021,xmjb024,xmjb025, 
                   xmjb026,xmjb027,xmjb028,xmjb029,xmjb030,xmjb031,xmjb032,xmjb040,xmjb039,xmjb038,xmjb037, 
                   xmjb034,xmjb901,xmjb902,xmjb903) = (g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg4_d[l_ac].xmjbunit, 
                   g_xmeg4_d[l_ac].xmjbseq,g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb001,g_xmeg4_d[l_ac].xmjb002, 
                   g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb033,g_xmeg4_d[l_ac].xmjb004,g_xmeg4_d[l_ac].xmjb005, 
                   g_xmeg4_d[l_ac].xmjb006,g_xmeg4_d[l_ac].xmjb007,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb012, 
                   g_xmeg4_d[l_ac].xmjb013,g_xmeg4_d[l_ac].xmjb014,g_xmeg4_d[l_ac].xmjb015,g_xmeg4_d[l_ac].xmjb016, 
                   g_xmeg4_d[l_ac].xmjb017,g_xmeg4_d[l_ac].xmjb018,g_xmeg4_d[l_ac].xmjb008,g_xmeg4_d[l_ac].xmjb009, 
                   g_xmeg4_d[l_ac].xmjb010,g_xmeg4_d[l_ac].xmjb022,g_xmeg4_d[l_ac].xmjb019,g_xmeg4_d[l_ac].xmjb020, 
                   g_xmeg4_d[l_ac].xmjb021,g_xmeg4_d[l_ac].xmjb024,g_xmeg4_d[l_ac].xmjb025,g_xmeg4_d[l_ac].xmjb026, 
                   g_xmeg4_d[l_ac].xmjb027,g_xmeg4_d[l_ac].xmjb028,g_xmeg4_d[l_ac].xmjb029,g_xmeg4_d[l_ac].xmjb030, 
                   g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032,g_xmeg4_d[l_ac].xmjb040,g_xmeg4_d[l_ac].xmjb039, 
                   g_xmeg4_d[l_ac].xmjb038,g_xmeg4_d[l_ac].xmjb037,g_xmeg4_d[l_ac].xmjb034,g_xmeg4_d[l_ac].xmjb901, 
                   g_xmeg4_d[l_ac].xmjb902,g_xmeg4_d[l_ac].xmjb903) #自訂欄位頁簽
                WHERE xmjbent = g_enterprise AND xmjbdocno = g_xmee_m.xmeedocno
                  AND xmjb900 = g_xmee_m.xmee900
                  AND xmjbseq = g_xmeg4_d_t.xmjbseq #項次 
                  
               #add-point:單身page4修改中 name="input.body4.m_update"
               
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xmjb_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xmjb_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xmee_m.xmeedocno
               LET gs_keys_bak[1] = g_xmeedocno_t
               LET gs_keys[2] = g_xmee_m.xmee900
               LET gs_keys_bak[2] = g_xmee900_t
               LET gs_keys[3] = g_xmeg4_d[g_detail_idx].xmjbseq
               LET gs_keys_bak[3] = g_xmeg4_d_t.xmjbseq
               CALL adbt510_update_b('xmjb_t',gs_keys,gs_keys_bak,"'4'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL adbt510_xmjb_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_xmeg4_d[g_detail_idx].xmjbseq = g_xmeg4_d_t.xmjbseq 
                  ) THEN
                  LET gs_keys[01] = g_xmee_m.xmeedocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xmee_m.xmee900
                  LET gs_keys[gs_keys.getLength()+1] = g_xmeg4_d_t.xmjbseq
                  CALL adbt510_key_update_b(gs_keys,'xmjb_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xmee_m),util.JSON.stringify(g_xmeg4_d_t)
               LET g_log2 = util.JSON.stringify(g_xmee_m),util.JSON.stringify(g_xmeg4_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page4修改後 name="input.body4.a_update"
               IF NOT s_adbt510_upd_xmeg(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "xmeg_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                  CALL s_transaction_end('N','0')
               END IF
               
               IF NOT s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "xmeh_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                  CALL s_transaction_end('N','0')
               END IF 

               #將單身資料寫入歷程檔中               
               IF NOT adbt510_xmjb_ins_xmek(g_xmeg4_d[l_ac].*) THEN
                  LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                  CALL s_transaction_end('N','0')
               END IF 
               IF NOT adbt510_xmeg_ins_xmek(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900) THEN
                  LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                  CALL s_transaction_end('N','0')
               END IF
               CALL adbt510_gen_xmej(2) RETURNING l_success
               IF NOT l_success THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "xmej_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                  CALL s_transaction_end('N','0')
               END IF 
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb001
            #add-point:BEFORE FIELD xmjb001 name="input.b.page4.xmjb001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb001
            
            #add-point:AFTER FIELD xmjb001 name="input.a.page4.xmjb001"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb001
            #add-point:ON CHANGE xmjb001 name="input.g.page4.xmjb001"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb003
            
            #add-point:AFTER FIELD xmjb003 name="input.a.page4.xmjb003"
 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb003
            #add-point:BEFORE FIELD xmjb003 name="input.b.page4.xmjb003"
 
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb003
            #add-point:ON CHANGE xmjb003 name="input.g.page4.xmjb003"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb006
            
            #add-point:AFTER FIELD xmjb006 name="input.a.page4.xmjb006"
 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb006
            #add-point:BEFORE FIELD xmjb006 name="input.b.page4.xmjb006"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb006
            #add-point:ON CHANGE xmjb006 name="input.g.page4.xmjb006"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb006_desc
            #add-point:BEFORE FIELD xmjb006_desc name="input.b.page4.xmjb006_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb006_desc
            
            #add-point:AFTER FIELD xmjb006_desc name="input.a.page4.xmjb006_desc"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb006_desc
            #add-point:ON CHANGE xmjb006_desc name="input.g.page4.xmjb006_desc"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb015
            
            #add-point:AFTER FIELD xmjb015 name="input.a.page4.xmjb015"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb015) THEN 
               #此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xmeg4_d[l_ac].xmjb003
               LET g_chkparam.arg2 = g_xmeg4_d[l_ac].xmjb015
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_imao002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xmeg4_d[l_ac].xmjb015 = g_xmeg4_d_t.xmjb015
                  CALL s_desc_get_unit_desc(g_xmeg4_d[l_ac].xmjb015) RETURNING g_xmeg4_d[l_ac].xmjb015_desc
                  NEXT FIELD CURRENT
               END IF
           
            END IF  
            
            CALL s_desc_get_unit_desc(g_xmeg4_d[l_ac].xmjb015) RETURNING g_xmeg4_d[l_ac].xmjb015_desc
            CALL adbt510_xmjb012_convert()


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb015
            #add-point:BEFORE FIELD xmjb015 name="input.b.page4.xmjb015"
            CALL adbt510_set_no_required_b()
            CALL adbt510_set_required_b()
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb015
            #add-point:ON CHANGE xmjb015 name="input.g.page4.xmjb015"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb016
            #應用 a15 樣板自動產生(Version:3)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_xmeg4_d[l_ac].xmjb016,"0.000","0","","","azz-00079",1) THEN
               NEXT FIELD xmjb016
            END IF 
 
 
 
            #add-point:AFTER FIELD xmjb016 name="input.a.page4.xmjb016"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb016) THEN 
               CALL s_aooi250_take_decimals(g_xmeg4_d[l_ac].xmjb015,g_xmeg4_d[l_ac].xmjb016) RETURNING l_success,g_xmeg4_d[l_ac].xmjb016
            END IF 

            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb016
            #add-point:BEFORE FIELD xmjb016 name="input.b.page4.xmjb016"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb016
            #add-point:ON CHANGE xmjb016 name="input.g.page4.xmjb016"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb024
            
            #add-point:AFTER FIELD xmjb024 name="input.a.page4.xmjb024"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb024) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xmeg4_d[l_ac].xmjb024
               LET g_chkparam.err_str[1] = "adb-00285:sub-01302|adbm201|",cl_get_progname("adbm201",g_lang,"2"),"|:EXEPROGadbm201"#要執行的建議程式待補 #160318-00025#28  add
               LET g_chkparam.err_str[2] = "ais-00019:sub-01302|",cl_get_progname("adbm201",g_lang,"2"),"|:EXEPROGadbm201" #160521-00005#1 20160602 add by beckxie
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmaa001_14") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xmeg4_d[l_ac].xmjb024 = g_xmeg4_d_t.xmjb024
                  CALL adbt510_xmjb024_ref()
                  NEXT FIELD CURRENT
               END IF

               IF NOT s_adbt510_xmdl003_exist(g_xmee_m.xmeedocno) THEN
                 CALL adbt510_xmjb024_desc()
               END IF
            END IF 
            LET g_xmeg4_d[l_ac].xmjb025 = g_xmeg4_d[l_ac].xmjb024
            CALL adbt510_xmjb024_ref()


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb024
            #add-point:BEFORE FIELD xmjb024 name="input.b.page4.xmjb024"
            CALL adbt510_set_entry_b(l_cmd)
            CALL adbt510_set_no_entry_b(l_cmd)
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb024
            #add-point:ON CHANGE xmjb024 name="input.g.page4.xmjb024"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb026
            
            #add-point:AFTER FIELD xmjb026 name="input.a.page4.xmjb026"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb026) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
               #設定g_chkparam.*的參數
               CALL adbt510_get_pmaa027(g_xmeg4_d[l_ac].xmjb025) RETURNING l_pmaa027_1
               LET g_chkparam.arg1 = l_pmaa027_1
               LET g_chkparam.arg2 = g_xmeg4_d[l_ac].xmjb026
               LET g_chkparam.err_str[1] = "anm-00025:sub-01302|aooi350|",cl_get_progname("aooi350",g_lang,"2"),"|:EXEPROGaooi350"#要執行的建議程式待補 #160318-00025#28  add
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oofb019_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xmeg4_d[l_ac].xmjb026 = g_xmeg4_d_t.xmjb026
                  CALL adbt510_xmjb026_ref()
                  NEXT FIELD CURRENT
               END IF
               CALL adbt510_get_pmaa027(g_xmeg4_d[l_ac].xmjb025) RETURNING l_pmaa027   
               #161228-00033#1 Mark By Ken 161229(S)
               #SELECT oofb022 INTO g_xmeg4_d[l_ac].xmjb027 FROM oofb_t
               # WHERE oofbent = g_enterprise   #160905-00003#4 160905 by 02749 add:ENT過濾條件
               #   AND oofb002 = l_pmaa027 AND oofb008 = '3' 
               #   AND oofbstus = 'Y' 
               #   AND oofb019 = g_xmeg4_d[l_ac].xmjb026
               #   AND rownum = 1 
               #161228-00033#1 Mark By Ken 161229(E)
               #161228-00033#1 Add By Ken 161229(S)
               LET l_sql = "SELECT oofb022 ",
                           "  FROM oofb_t ",
                           " WHERE oofbent = ", g_enterprise ,
                           "   AND oofb002 = '", l_pmaa027 ,"' ",
                           "   AND oofb008 = '3' ",
                           "   AND oofbstus = 'Y' ",
                           "   AND oofb019 = '", g_xmeg4_d[l_ac].xmjb026 ,"' "
               PREPARE adbt510_oofb_sel FROM l_sql
               DECLARE adbt510_oofb_sel_cur SCROLL CURSOR FOR adbt510_oofb_sel
               OPEN adbt510_oofb_sel_cur
               FETCH FIRST adbt510_oofb_sel_cur INTO g_xmeg4_d[l_ac].xmjb027
               FREE adbt510_oofb_sel
               CLOSE adbt510_oofb_sel_cur
               #161228-00033#1 Add By Ken 161229(E)                  
            ELSE
               LET g_xmeg4_d[l_ac].xmjb027 = NULL
            END IF 
            CALL adbt510_xmjb026_ref()
            LET g_xmeg4_d[l_ac].xmjb027_desc = s_desc_get_dbad001_desc(g_xmeg4_d[l_ac].xmjb027)

            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb026
            #add-point:BEFORE FIELD xmjb026 name="input.b.page4.xmjb026"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb026
            #add-point:ON CHANGE xmjb026 name="input.g.page4.xmjb026"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb026_desc
            #add-point:BEFORE FIELD xmjb026_desc name="input.b.page4.xmjb026_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb026_desc
            
            #add-point:AFTER FIELD xmjb026_desc name="input.a.page4.xmjb026_desc"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb026_desc
            #add-point:ON CHANGE xmjb026_desc name="input.g.page4.xmjb026_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb030
            #add-point:BEFORE FIELD xmjb030 name="input.b.page4.xmjb030"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb030
            
            #add-point:AFTER FIELD xmjb030 name="input.a.page4.xmjb030"
            IF g_xmeg4_d[l_ac].xmjb030= 'Y' THEN
               CALL adbt510_03(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900,g_xmeg4_d[l_ac].xmjb018,g_xmeg4_d[l_ac].xmjb030,g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb025)
               RETURNING g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
               DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032
               CALL s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900) RETURNING l_success 
            ELSE
               #從多交期改成非多交期需清空多交期資料
               IF g_xmeg4_d_t.xmjb030 = 'Y' THEN
                  DELETE FROM xmej_t
                   WHERE xmejent = g_enterprise
                     AND xmejdocno = g_xmee_m.xmeedocno
                     AND xmejseq = g_xmeg4_d[l_ac].xmjbseq
                     AND xmej900 = g_xmee_m.xmee900
               END IF
            END IF

            CALL adbt510_set_entry_b(l_cmd)
            CALL adbt510_set_no_entry_b(l_cmd)

            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb030
            #add-point:ON CHANGE xmjb030 name="input.g.page4.xmjb030"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb031
            #add-point:BEFORE FIELD xmjb031 name="input.b.page4.xmjb031"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb031
            
            #add-point:AFTER FIELD xmjb031 name="input.a.page4.xmjb031"
            IF g_xmeg4_d[l_ac].xmjb031 > g_xmeg4_d[l_ac].xmjb032 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'adb-00079'
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               NEXT FIELD  xmjb031
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb031
            #add-point:ON CHANGE xmjb031 name="input.g.page4.xmjb031"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb032
            #add-point:BEFORE FIELD xmjb032 name="input.b.page4.xmjb032"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb032
            
            #add-point:AFTER FIELD xmjb032 name="input.a.page4.xmjb032"
            IF g_xmeg4_d[l_ac].xmjb032 < g_xmeg4_d[l_ac].xmjb031 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'adb-00079'
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               NEXT FIELD  xmjb032
            END IF  
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb032
            #add-point:ON CHANGE xmjb032 name="input.g.page4.xmjb032"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb040
            
            #add-point:AFTER FIELD xmjb040 name="input.a.page4.xmjb040"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb040) THEN 
#應用 a19 樣板自動產生(Version:2)
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xmeg4_d[l_ac].xmjb040
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_dbaa001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmeg4_d[l_ac].xmjb040
            CALL ap_ref_array2(g_ref_fields,"SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmeg4_d[l_ac].xmjb040_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb040_desc


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb040
            #add-point:BEFORE FIELD xmjb040 name="input.b.page4.xmjb040"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb040
            #add-point:ON CHANGE xmjb040 name="input.g.page4.xmjb040"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb039
            
            #add-point:AFTER FIELD xmjb039 name="input.a.page4.xmjb039"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb039) THEN 
#應用 a19 樣板自動產生(Version:2)
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xmeg4_d[l_ac].xmjb039
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_dbaa001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmeg4_d[l_ac].xmjb039
            CALL ap_ref_array2(g_ref_fields,"SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmeg4_d[l_ac].xmjb039_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb039_desc


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb039
            #add-point:BEFORE FIELD xmjb039 name="input.b.page4.xmjb039"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb039
            #add-point:ON CHANGE xmjb039 name="input.g.page4.xmjb039"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb038
            
            #add-point:AFTER FIELD xmjb038 name="input.a.page4.xmjb038"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb038) THEN 
#應用 a19 樣板自動產生(Version:2)
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xmeg4_d[l_ac].xmjb038
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_dbaa001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmeg4_d[l_ac].xmjb038
            CALL ap_ref_array2(g_ref_fields,"SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmeg4_d[l_ac].xmjb038_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb038_desc


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb038
            #add-point:BEFORE FIELD xmjb038 name="input.b.page4.xmjb038"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb038
            #add-point:ON CHANGE xmjb038 name="input.g.page4.xmjb038"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb037
            
            #add-point:AFTER FIELD xmjb037 name="input.a.page4.xmjb037"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb037) THEN 
#應用 a19 樣板自動產生(Version:2)
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xmeg4_d[l_ac].xmjb037
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_dbaa001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmeg4_d[l_ac].xmjb037
            CALL ap_ref_array2(g_ref_fields,"SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmeg4_d[l_ac].xmjb037_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb037_desc


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb037
            #add-point:BEFORE FIELD xmjb037 name="input.b.page4.xmjb037"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb037
            #add-point:ON CHANGE xmjb037 name="input.g.page4.xmjb037"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb034
            #add-point:BEFORE FIELD xmjb034 name="input.b.page4.xmjb034"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb034
            
            #add-point:AFTER FIELD xmjb034 name="input.a.page4.xmjb034"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb034
            #add-point:ON CHANGE xmjb034 name="input.g.page4.xmjb034"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb901
            #add-point:BEFORE FIELD xmjb901 name="input.b.page4.xmjb901"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb901
            
            #add-point:AFTER FIELD xmjb901 name="input.a.page4.xmjb901"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb901
            #add-point:ON CHANGE xmjb901 name="input.g.page4.xmjb901"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb902
            
            #add-point:AFTER FIELD xmjb902 name="input.a.page4.xmjb902"
            IF NOT cl_null(g_xmeg4_d[l_ac].xmjb902) THEN
               #02749  150122 add ----------------------(S)
               #IF NOT s_azzi650_chk_exist('267',g_xmeg4_d[l_ac].xmjb902) THEN
               IF NOT s_azzi650_chk_exist(g_acc_282,g_xmeg4_d[l_ac].xmjb902) THEN
               #02749  150122 add ----------------------(E)
                  LET g_xmeg4_d[l_ac].xmjb902 = g_xmeg4_d_t.xmjb902
                  NEXT FIELD xmjb902
               END IF
            END IF
            #02749  150122 add ----------------------(S)
            #CALL s_desc_get_acc_desc('267',g_xmeg4_d[l_ac].xmjb902) RETURNING g_xmeg4_d[l_ac].xmjb902_desc
            CALL s_desc_get_acc_desc(g_acc_282,g_xmeg4_d[l_ac].xmjb902) RETURNING g_xmeg4_d[l_ac].xmjb902_desc
            #02749  150122 add ----------------------(E)
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb902
            #add-point:BEFORE FIELD xmjb902 name="input.b.page4.xmjb902"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb902
            #add-point:ON CHANGE xmjb902 name="input.g.page4.xmjb902"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmjb903
            #add-point:BEFORE FIELD xmjb903 name="input.b.page4.xmjb903"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmjb903
            
            #add-point:AFTER FIELD xmjb903 name="input.a.page4.xmjb903"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmjb903
            #add-point:ON CHANGE xmjb903 name="input.g.page4.xmjb903"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page4.xmjb001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb001
            #add-point:ON ACTION controlp INFIELD xmjb001 name="input.c.page4.xmjb001"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb003
            #add-point:ON ACTION controlp INFIELD xmjb003 name="input.c.page4.xmjb003"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb003             #給予default值
            LET g_qryparam.default2 = "" #g_xmeg4_d[l_ac].imaal003 #品名
            LET g_qryparam.default3 = "" #g_xmeg4_d[l_ac].imaal004 #規格
            #給予arg

            
            CALL q_imaa001()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb003 = g_qryparam.return1              
            DISPLAY g_xmeg4_d[l_ac].xmjb003 TO xmjb003              #
            CALL s_desc_get_item_desc(g_xmeg4_d[l_ac].xmjb003)RETURNING g_xmeg4_d[l_ac].xmjb003_desc,g_xmeg4_d[l_ac].xmjb003_desc_desc
            NEXT FIELD xmjb003                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb006
            #add-point:ON ACTION controlp INFIELD xmjb006 name="input.c.page4.xmjb006"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb006             #給予default值

            #給予arg
            
            CALL q_oodb002_2()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb006 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb006 TO xmjb006              #
            CALL adbt510_xmjb006_ref()
            NEXT FIELD xmjb006                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb006_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb006_desc
            #add-point:ON ACTION controlp INFIELD xmjb006_desc name="input.c.page4.xmjb006_desc"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb015
            #add-point:ON ACTION controlp INFIELD xmjb015 name="input.c.page4.xmjb015"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb015             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb015 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb015 TO xmjb015              #
            CALL s_desc_get_unit_desc(g_xmeg4_d[l_ac].xmjb015) RETURNING g_xmeg4_d[l_ac].xmjb015_desc
            NEXT FIELD xmjb015                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb016
            #add-point:ON ACTION controlp INFIELD xmjb016 name="input.c.page4.xmjb016"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb024
            #add-point:ON ACTION controlp INFIELD xmjb024 name="input.c.page4.xmjb024"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb024             #給予default值

            #給予arg

            
            CALL q_pmaa001_18()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb024 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb024 TO xmjb024              #
            CALL adbt510_xmjb024_ref()
            NEXT FIELD xmjb024                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb026
            #add-point:ON ACTION controlp INFIELD xmjb026 name="input.c.page4.xmjb026"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb026             #給予default值
            
            #給予arg
            CALL adbt510_get_pmaa027(g_xmeg4_d[l_ac].xmjb025) RETURNING l_pmaa027_1
            LET g_qryparam.arg1 = l_pmaa027_1

            
            CALL q_oofb019()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb026 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb026 TO xmjb026              #
            CALL adbt510_xmjb026_ref()
            NEXT FIELD xmjb026                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb026_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb026_desc
            #add-point:ON ACTION controlp INFIELD xmjb026_desc name="input.c.page4.xmjb026_desc"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb030
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb030
            #add-point:ON ACTION controlp INFIELD xmjb030 name="input.c.page4.xmjb030"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb031
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb031
            #add-point:ON ACTION controlp INFIELD xmjb031 name="input.c.page4.xmjb031"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb032
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb032
            #add-point:ON ACTION controlp INFIELD xmjb032 name="input.c.page4.xmjb032"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb040
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb040
            #add-point:ON ACTION controlp INFIELD xmjb040 name="input.c.page4.xmjb040"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb040             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_dbaa001_1()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb040 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb040 TO xmjb040              #

            NEXT FIELD xmjb040                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb039
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb039
            #add-point:ON ACTION controlp INFIELD xmjb039 name="input.c.page4.xmjb039"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb039             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_dbaa001_1()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb039 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb039 TO xmjb039              #

            NEXT FIELD xmjb039                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb038
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb038
            #add-point:ON ACTION controlp INFIELD xmjb038 name="input.c.page4.xmjb038"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb038             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_dbaa001_1()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb038 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb038 TO xmjb038              #

            NEXT FIELD xmjb038                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb037
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb037
            #add-point:ON ACTION controlp INFIELD xmjb037 name="input.c.page4.xmjb037"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb037             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_dbaa001_1()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb037 = g_qryparam.return1              

            DISPLAY g_xmeg4_d[l_ac].xmjb037 TO xmjb037              #

            NEXT FIELD xmjb037                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb034
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb034
            #add-point:ON ACTION controlp INFIELD xmjb034 name="input.c.page4.xmjb034"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb901
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb901
            #add-point:ON ACTION controlp INFIELD xmjb901 name="input.c.page4.xmjb901"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb902
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb902
            #add-point:ON ACTION controlp INFIELD xmjb902 name="input.c.page4.xmjb902"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg4_d[l_ac].xmjb902             #給予default值
            LET g_qryparam.default2 = "" #g_xmeg4_d[l_ac].oocq002 #應用分類碼
            #給予arg
            #02749  150122 add ----------------------(S)
            #LET g_qryparam.arg1 = '267' #
            LET g_qryparam.arg1 = g_acc_282
            #02749  150122 add ----------------------(E)
            CALL q_oocq002()                                #呼叫開窗

            LET g_xmeg4_d[l_ac].xmjb902 = g_qryparam.return1              
            DISPLAY g_xmeg4_d[l_ac].xmjb902 TO xmjb902              
            #02749  150122 add ----------------------(S)
            #CALL s_desc_get_acc_desc('267',g_xmeg4_d[l_ac].xmjb902) RETURNING g_xmeg4_d[l_ac].xmjb902_desc
            CALL s_desc_get_acc_desc(g_acc_282,g_xmeg4_d[l_ac].xmjb902) RETURNING g_xmeg4_d[l_ac].xmjb902_desc
            #02749  150122 add ----------------------(E)
            NEXT FIELD xmjb902                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xmjb903
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmjb903
            #add-point:ON ACTION controlp INFIELD xmjb903 name="input.c.page4.xmjb903"
            
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page4 after_row name="input.body4.after_row"
            IF NOT INT_FLAG THEN
               LET l_ac = ARR_CURR()
               IF (l_cmd='u' AND l_delete = FALSE) OR (l_cmd='a' AND l_insert = FALSE) THEN
                  CALL adbt510_gen_xmej(1) RETURNING l_success
                  IF NOT l_success THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "xmej_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
                     CALL s_transaction_end('N','0')
                  END IF
               END IF
            END IF
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xmeg4_d[l_ac].* = g_xmeg4_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE adbt510_bcl4
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL adbt510_unlock_b("xmjb_t","'4'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page4 after_row2 name="input.body4.after_row2"
            
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body4.after_input"
            
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xmeg4_d[li_reproduce_target].* = g_xmeg4_d[li_reproduce].*
 
               LET g_xmeg4_d[li_reproduce_target].xmjbseq = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_xmeg4_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xmeg4_d.getLength()+1
            END IF
            
      END INPUT
      INPUT ARRAY g_xmeg5_d FROM s_detail5.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = FALSE, #此頁面insert功能由產生器控制, 手動之設定無效! 
 
                 DELETE ROW = FALSE,
                 APPEND ROW = FALSE)
                 
         #自訂ACTION(detail_input,page_5)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body5.before_input2"
            
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_xmeg5_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL adbt510_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'5',"))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_xmeg5_d.getLength()
            #add-point:資料輸入前 name="input.body5.before_input"
            LET l_cnt = 0 
           #SELECT COUNT(*) INTO l_cnt FROM rtie_t           #170207-00004#2 170219 by 02749 nark
            SELECT COUNT(rtiedocno) INTO l_cnt FROM rtie_t   #170207-00004#2 170219 by 02749 add
             WHERE rtieent = g_enterprise
               AND rtiedocno = g_xmee_m.xmeedocno
            IF l_cnt > 0 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "" 
               LET g_errparam.code   = "adb-00399"
               LET g_errparam.popup  = TRUE 
               CALL cl_err()            
               NEXT FIELD xmee902
            END IF
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xmeg5_d[l_ac].* TO NULL 
            INITIALIZE g_xmeg5_d_t.* TO NULL 
            INITIALIZE g_xmeg5_d_o.* TO NULL 
            #公用欄位給值(單身5)
            
            #自定義預設值(單身5)
                  LET g_xmeg5_d[l_ac].xmef001 = "1"
      LET g_xmeg5_d[l_ac].xmef005 = "0"
      LET g_xmeg5_d[l_ac].xmef006 = "0"
      LET g_xmeg5_d[l_ac].xmef016 = "2"
      LET g_xmeg5_d[l_ac].xmef017 = "1"
      LET g_xmeg5_d[l_ac].xmef008 = "0"
      LET g_xmeg5_d[l_ac].xmef009 = "0"
      LET g_xmeg5_d[l_ac].xmef901 = "N"
 
            #add-point:modify段before備份 name="input.body5.insert.before_bak"
            
            #end add-point
            LET g_xmeg5_d_t.* = g_xmeg5_d[l_ac].*     #新輸入資料
            LET g_xmeg5_d_o.* = g_xmeg5_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL adbt510_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body5.insert.after_set_entry_b"
            
            #end add-point
            CALL adbt510_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xmeg5_d[li_reproduce_target].* = g_xmeg5_d[li_reproduce].*
 
               LET g_xmeg5_d[li_reproduce_target].xmef001 = NULL
            END IF
            
 
            #add-point:modify段before insert name="input.body5.before_insert"
            
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body5.before_row2"
            
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[5] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 5
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN adbt510_cl USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN adbt510_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE adbt510_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xmeg5_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xmeg5_d[l_ac].xmef001 IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_xmeg5_d_t.* = g_xmeg5_d[l_ac].*  #BACKUP
               LET g_xmeg5_d_o.* = g_xmeg5_d[l_ac].*  #BACKUP
               CALL adbt510_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body5.after_set_entry_b"
               
               #end add-point  
               CALL adbt510_set_no_entry_b(l_cmd)
               IF NOT adbt510_lock_b("xmef_t","'5'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH adbt510_bcl5 INTO g_xmeg5_d[l_ac].xmefsite,g_xmeg5_d[l_ac].xmef001,g_xmeg5_d[l_ac].xmef002, 
                      g_xmeg5_d[l_ac].xmef003,g_xmeg5_d[l_ac].xmef004,g_xmeg5_d[l_ac].xmef005,g_xmeg5_d[l_ac].xmef006, 
                      g_xmeg5_d[l_ac].xmef016,g_xmeg5_d[l_ac].xmef017,g_xmeg5_d[l_ac].xmef007,g_xmeg5_d[l_ac].xmef008, 
                      g_xmeg5_d[l_ac].xmef009,g_xmeg5_d[l_ac].xmef901,g_xmeg5_d[l_ac].xmef902,g_xmeg5_d[l_ac].xmef903 
 
                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xmeg5_d_mask_o[l_ac].* =  g_xmeg5_d[l_ac].*
                  CALL adbt510_xmef_t_mask()
                  LET g_xmeg5_d_mask_n[l_ac].* =  g_xmeg5_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL adbt510_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body5.before_row"
                                                                        
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body5.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body5.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身5刪除前 name="input.body5.b_delete"
               
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xmee_m.xmeedocno
               LET gs_keys[gs_keys.getLength()+1] = g_xmee_m.xmee900
               LET gs_keys[gs_keys.getLength()+1] = g_xmeg5_d_t.xmef001
            
               #刪除同層單身
               IF NOT adbt510_delete_b('xmef_t',gs_keys,"'5'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE adbt510_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT adbt510_key_delete_b(gs_keys,'xmef_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE adbt510_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身5刪除中 name="input.body5.m_delete"
               
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE adbt510_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身5刪除後 name="input.body5.a_delete"
               
               #end add-point
               LET l_count = g_xmeg_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body5.after_delete"
               
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xmeg5_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身5新增前 name="input.body5.b_a_insert"
            
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xmef_t 
             WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno
               AND xmef900 = g_xmee_m.xmee900
               AND xmef001 = g_xmeg5_d[l_ac].xmef001
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身5新增前 name="input.body5.b_insert"
               
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xmee_m.xmeedocno
               LET gs_keys[2] = g_xmee_m.xmee900
               LET gs_keys[3] = g_xmeg5_d[g_detail_idx].xmef001
               CALL adbt510_insert_b('xmef_t',gs_keys,"'5'")
                           
               #add-point:單身新增後5 name="input.body5.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_xmeg_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xmef_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL adbt510_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body5.after_insert"
               
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE adbt510_bcl5
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
            ELSE
               #add-point:單身page5修改前 name="input.body5.b_update"
               
               #end add-point
               
               #寫入修改者/修改日期資訊(單身5)
               
               
               #將遮罩欄位還原
               CALL adbt510_xmef_t_mask_restore('restore_mask_o')
                              
               UPDATE xmef_t SET (xmefdocno,xmef900,xmefsite,xmef001,xmef002,xmef003,xmef004,xmef005, 
                   xmef006,xmef016,xmef017,xmef007,xmef008,xmef009,xmef901,xmef902,xmef903) = (g_xmee_m.xmeedocno, 
                   g_xmee_m.xmee900,g_xmeg5_d[l_ac].xmefsite,g_xmeg5_d[l_ac].xmef001,g_xmeg5_d[l_ac].xmef002, 
                   g_xmeg5_d[l_ac].xmef003,g_xmeg5_d[l_ac].xmef004,g_xmeg5_d[l_ac].xmef005,g_xmeg5_d[l_ac].xmef006, 
                   g_xmeg5_d[l_ac].xmef016,g_xmeg5_d[l_ac].xmef017,g_xmeg5_d[l_ac].xmef007,g_xmeg5_d[l_ac].xmef008, 
                   g_xmeg5_d[l_ac].xmef009,g_xmeg5_d[l_ac].xmef901,g_xmeg5_d[l_ac].xmef902,g_xmeg5_d[l_ac].xmef903)  
                   #自訂欄位頁簽
                WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno
                  AND xmef900 = g_xmee_m.xmee900
                  AND xmef001 = g_xmeg5_d_t.xmef001 #項次 
                  
               #add-point:單身page5修改中 name="input.body5.m_update"
               
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xmef_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xmef_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xmee_m.xmeedocno
               LET gs_keys_bak[1] = g_xmeedocno_t
               LET gs_keys[2] = g_xmee_m.xmee900
               LET gs_keys_bak[2] = g_xmee900_t
               LET gs_keys[3] = g_xmeg5_d[g_detail_idx].xmef001
               LET gs_keys_bak[3] = g_xmeg5_d_t.xmef001
               CALL adbt510_update_b('xmef_t',gs_keys,gs_keys_bak,"'5'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL adbt510_xmef_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_xmeg5_d[g_detail_idx].xmef001 = g_xmeg5_d_t.xmef001 
                  ) THEN
                  LET gs_keys[01] = g_xmee_m.xmeedocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xmee_m.xmee900
                  LET gs_keys[gs_keys.getLength()+1] = g_xmeg5_d_t.xmef001
                  CALL adbt510_key_update_b(gs_keys,'xmef_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xmee_m),util.JSON.stringify(g_xmeg5_d_t)
               LET g_log2 = util.JSON.stringify(g_xmee_m),util.JSON.stringify(g_xmeg5_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page5修改後 name="input.body5.a_update"
               
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef016
            #add-point:BEFORE FIELD xmef016 name="input.b.page5.xmef016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef016
            
            #add-point:AFTER FIELD xmef016 name="input.a.page5.xmef016"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmef016
            #add-point:ON CHANGE xmef016 name="input.g.page5.xmef016"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xmef017
            #add-point:BEFORE FIELD xmef017 name="input.b.page5.xmef017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xmef017
            
            #add-point:AFTER FIELD xmef017 name="input.a.page5.xmef017"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xmef017
            #add-point:ON CHANGE xmef017 name="input.g.page5.xmef017"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page5.xmef016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef016
            #add-point:ON ACTION controlp INFIELD xmef016 name="input.c.page5.xmef016"
            
            #END add-point
 
 
         #Ctrlp:input.c.page5.xmef017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xmef017
            #add-point:ON ACTION controlp INFIELD xmef017 name="input.c.page5.xmef017"
            
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page5 after_row name="input.body5.after_row"
            
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE adbt510_bcl5
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL adbt510_unlock_b("xmef_t","'5'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page5 after_row2 name="input.body5.after_row2"
            
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body5.after_input"
            
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xmeg5_d[li_reproduce_target].* = g_xmeg5_d[li_reproduce].*
 
               LET g_xmeg5_d[li_reproduce_target].xmef001 = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_xmeg5_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xmeg5_d.getLength()+1
            END IF
            
      END INPUT
 
      
 
      DISPLAY ARRAY g_xmeg2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
    
         BEFORE ROW
            CALL adbt510_idx_chk()
            LET l_ac = DIALOG.getCurrentRow("s_detail2")
            LET g_detail_idx = l_ac
            
            #add-point:page2, before row動作 name="input.body2.before_row"
                                                                        
            #end add-point
            
         BEFORE DISPLAY
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'2',"))
            END IF
            LET g_loc = 'm'
            LET l_ac = DIALOG.getCurrentRow("s_detail2")
            CALL adbt510_idx_chk()
            LET g_current_page = 2
      
         #add-point:page2自定義行為 name="input.body2.action"
 
         #end add-point
      
      END DISPLAY
      DISPLAY ARRAY g_xmeg3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b)  
    
         BEFORE ROW
            CALL adbt510_idx_chk()
            LET l_ac = DIALOG.getCurrentRow("s_detail3")
            LET g_detail_idx = l_ac
            
            #add-point:page3, before row動作 name="input.body3.before_row"
                                                                        
            #end add-point
            
         BEFORE DISPLAY
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'3',"))
            END IF
            LET g_loc = 'm'
            LET l_ac = DIALOG.getCurrentRow("s_detail3")
            CALL adbt510_idx_chk()
            LET g_current_page = 3
      
         #add-point:page3自定義行為 name="input.body3.action"
         
         #end add-point
      
      END DISPLAY
 
 
 
{</section>}
 
{<section id="adbt510.input.other" >}
      
      #add-point:自定義input name="input.more_input"
      #170207-00004#2 170219 by 02749 mark---(S)
      #DISPLAY ARRAY g_xmeg2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
      #
      #   BEFORE ROW
      #      CALL adbt510_idx_chk()
      #      LET l_ac = DIALOG.getCurrentRow("s_detail2")
      #      LET g_detail_idx = l_ac
      #      
      #   BEFORE DISPLAY
      #      CALL FGL_SET_ARR_CURR(g_detail_idx)
      #      LET l_ac = DIALOG.getCurrentRow("s_detail3")
      #      CALL adbt510_idx_chk()
      #      LET g_current_page = 7
      #
      #END DISPLAY                            
      #170207-00004#2 170219 by 02749 mark---(E)
      #end add-point
    
      BEFORE DIALOG 
         #CALL cl_err_collect_init()    
         #add-point:input段before dialog name="input.before_dialog"
         #新增時強制從單頭開始填
         IF p_cmd = 'a' THEN
            NEXT FIELD xmeesite
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD xmegseq
               WHEN "s_detail2"
                  NEXT FIELD rticseq
               WHEN "s_detail3"
                  NEXT FIELD xmehseq
               WHEN "s_detail4"
                  NEXT FIELD xmjbseq
               WHEN "s_detail5"
                  NEXT FIELD xmef001
               WHEN "s_detail6"
                  NEXT FIELD xrcdseq
               WHEN "s_detail7"
                  NEXT FIELD rtieseq
 
            END CASE
         END IF                                                
         #end add-point    
         #重新導回資料到正確位置上
         CALL DIALOG.setCurrentRow("s_detail1",g_idx_group.getValue("'1',"))      
         CALL DIALOG.setCurrentRow("s_detail2",g_idx_group.getValue("'2',"))
         CALL DIALOG.setCurrentRow("s_detail3",g_idx_group.getValue("'3',"))
         CALL DIALOG.setCurrentRow("s_detail4",g_idx_group.getValue("'4',"))
         CALL DIALOG.setCurrentRow("s_detail5",g_idx_group.getValue("'5',"))
 
         #新增時強制從單頭開始填
         IF p_cmd = 'a' THEN
            #add-point:input段next_field name="input.next_field"
            
            #end add-point  
            NEXT FIELD xmeedocno
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD xmegsite
               WHEN "s_detail2"
                  NEXT FIELD rticseq
               WHEN "s_detail3"
                  NEXT FIELD xmehdocno
               WHEN "s_detail4"
                  NEXT FIELD xmjbunit
               WHEN "s_detail5"
                  NEXT FIELD xmefsite
 
               #add-point:input段modify_detail  name="input.modify_detail.other"
               
               #end add-point  
            END CASE
         END IF
      
      AFTER DIALOG
         #add-point:input段after_dialog name="input.after_dialog"
         
         #end add-point    
         
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         IF g_header_hidden THEN
            CALL gfrm_curr.setElementHidden("vb_master",0)
            CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
            LET g_header_hidden = 0     #visible
         ELSE
            CALL gfrm_curr.setElementHidden("vb_master",1)
            CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
            LET g_header_hidden = 1     #hidden     
         END IF
 
      ON ACTION accept
         #add-point:input段accept  name="input.accept"
         
         #end add-point    
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         #add-point:input段cancel name="input.cancel"
         
         #end add-point  
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
         LET g_detail_idx_list[4] = 1
         LET g_detail_idx_list[5] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail3",1)
         CALL g_curr_diag.setCurrentRow("s_detail4",1)
         CALL g_curr_diag.setCurrentRow("s_detail5",1)
 
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         #add-point:input段close name="input.close"
         
         #end add-point  
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         #add-point:input段exit name="input.exit"
         
         #end add-point
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
         LET g_detail_idx_list[4] = 1
         LET g_detail_idx_list[5] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail3",1)
         CALL g_curr_diag.setCurrentRow("s_detail4",1)
         CALL g_curr_diag.setCurrentRow("s_detail5",1)
 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
    
   #add-point:input段after input  name="input.after_input"
          
   #end add-point    
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.show" >}
#+ 單頭資料重新顯示及單身資料重抓
PRIVATE FUNCTION adbt510_show()
   #add-point:show段define(客製用) name="show.define_customerization"
   
   #end add-point  
   DEFINE l_ac_t    LIKE type_t.num10
   #add-point:show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="show.define"
   DEFINE l_success  LIKE type_t.num5 
   DEFINE l_address  STRING 
   DEFINE l_oofb011  LIKE oofb_t.oofb011
   DEFINE l_xmdlsite LIKE xmdl_t.xmdlsite
   DEFINE l_sql      STRING
   #end add-point  
   
   #add-point:Function前置處理 name="show.before"
   #170207-00004#2 170219 by 02749 mark---(S)
   #LET g_wc2_rtic = " 1=1"
   #LET l_sql = "SELECT xmjb002,xmjb003,imaal003,imaal004,",
   #            "       xmjb017,oocal003,xmjb018,xmjb008,",
   #            "       xmjb009,xmjb010,xmjb021",
   #            "  FROM xmjb_t",
   #            "  LEFT OUTER JOIN imaal_t ON xmjbent = imaalent AND xmjb003 = imaal001 AND imaal002 = '",g_dlang,"'",
   #            "  LEFT OUTER JOIN oocal_t ON xmjbent = oocalent AND xmjb017 = oocal001 AND oocal002 = '",g_dlang,"'",
   #            " WHERE xmjbent = ",g_enterprise,
   #            "   AND xmjbdocno = '",g_xmee_m.xmeedocno,"'",
   #            "   AND xmjbseq = ?"
   #PREPARE adbt510_detail2 FROM l_sql  
   #170207-00004#2 170219 by 02749 mark---(E)
   #end add-point
   
   
   
   IF g_bfill = "Y" THEN
      CALL adbt510_b_fill() #單身填充
      CALL adbt510_b_fill2('0') #單身填充
   END IF
     
   #帶出公用欄位reference值
   #應用 a12 樣板自動產生(Version:4)
 
 
 
   
   #顯示followup圖示
   #應用 a48 樣板自動產生(Version:3)
   CALL adbt510_set_pk_array()
   #add-point:ON ACTION agendum name="show.follow_pic"
   
   #END add-point
   CALL cl_user_overview_set_follow_pic()
  
 
 
 
   
   LET l_ac_t = l_ac
   
   #讀入ref值(單頭)
   #add-point:show段reference name="show.head.reference"
   CALL s_desc_get_tax_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee011) RETURNING g_xmee_m.xmee011_desc
   DISPLAY BY NAME g_xmee_m.xmee011_desc
   
   CALL s_desc_get_invoice_type_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee035) RETURNING g_xmee_m.xmee035_desc
   DISPLAY BY NAME g_xmee_m.xmee035_desc  
   
   LET g_xmee_m.xmee026_desc = ''
   LET g_xmee_m.oofb017_1 = ''
   IF NOT cl_null(g_xmee_m.xmee021) AND NOT cl_null(g_xmee_m.xmee026) THEN 
      CALL s_adb_address_ref('5',g_xmee_m.xmee026,g_xmee_m.xmee021)
         RETURNING l_oofb011,l_address
      LET g_xmee_m.xmee026_desc = l_oofb011
      LET g_xmee_m.oofb017_1 = l_address  
   END IF
   DISPLAY BY NAME g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1

   LET g_xmee_m.xmee025_desc = ''
   LET g_xmee_m.oofb017 = ''
   IF NOT cl_null(g_xmee_m.xmee022) AND NOT cl_null(g_xmee_m.xmee025) THEN
      CALL s_adb_address_ref('3',g_xmee_m.xmee025,g_xmee_m.xmee022)
         RETURNING l_oofb011,l_address
      LET g_xmee_m.xmee025_desc = l_oofb011
      LET g_xmee_m.oofb017 = l_address
   END IF
   DISPLAY BY NAME g_xmee_m.xmee025_desc,g_xmee_m.oofb017
   
   CALL adbt510_get_isaf011()
   #end add-point
   
   #遮罩相關處理
   LET g_xmee_m_mask_o.* =  g_xmee_m.*
   CALL adbt510_xmee_t_mask()
   LET g_xmee_m_mask_n.* =  g_xmee_m.*
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_xmee_m.xmeesite,g_xmee_m.xmeesite_desc,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900, 
       g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202,g_xmee_m.xmee202_desc,g_xmee_m.xmee023,g_xmee_m.xmee023_desc, 
       g_xmee_m.xmee004,g_xmee_m.xmee004_desc,g_xmee_m.xmee200,g_xmee_m.xmee200_desc,g_xmee_m.xmee201, 
       g_xmee_m.xmee201_desc,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt, 
       g_xmee_m.xmee024,g_xmee_m.xmee024_desc,g_xmee_m.xmee002,g_xmee_m.xmee002_desc,g_xmee_m.xmee003, 
       g_xmee_m.xmee003_desc,g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee021_desc,g_xmee_m.xmee022, 
       g_xmee_m.xmee022_desc,g_xmee_m.xmee203,g_xmee_m.xmee203_desc,g_xmee_m.xmee027,g_xmee_m.xmee027_desc, 
       g_xmee_m.xmee211,g_xmee_m.xmee211_desc,g_xmee_m.xmee210,g_xmee_m.xmee210_desc,g_xmee_m.xmee209, 
       g_xmee_m.xmee209_desc,g_xmee_m.xmee208,g_xmee_m.xmee208_desc,g_xmee_m.xmeeunit,g_xmee_m.xmeeunit_desc, 
       g_xmee_m.xmee204,g_xmee_m.xmee204_desc,g_xmee_m.xmee205,g_xmee_m.xmee032,g_xmee_m.xmee032_desc, 
       g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee903_desc,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee025_desc, 
       g_xmee_m.oofb017,g_xmee_m.xmee026,g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1,g_xmee_m.xmee206,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207,g_xmee_m.xmee207_desc,g_xmee_m.xmee020,g_xmee_m.xmee020_desc,g_xmee_m.xmee036, 
       g_xmee_m.xmee036_desc,g_xmee_m.xmee048,g_xmee_m.xmee049,g_xmee_m.xmee009,g_xmee_m.xmee009_desc, 
       g_xmee_m.xmee010,g_xmee_m.xmee010_desc,g_xmee_m.xmee015,g_xmee_m.xmee015_desc,g_xmee_m.xmee016, 
       g_xmee_m.xmee011,g_xmee_m.xmee011_desc,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee035_desc, 
       g_xmee_m.isaf011,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp, 
       g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtid_desc,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdp_desc, 
       g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfid_desc,g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee034_desc,g_xmee_m.xmee041, 
       g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017,g_xmee_m.xmee017_desc,g_xmee_m.xmee043,g_xmee_m.xmee018, 
       g_xmee_m.xmee018_desc,g_xmee_m.xmee019,g_xmee_m.xmee028
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_xmee_m.xmeestus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
   
   #讀入ref值(單身)
   FOR l_ac = 1 TO g_xmeg_d.getLength()
      #add-point:show段單身reference name="show.body.reference"
#      #抓取約定交貨日、預計簽收日期
#     SELECT xmeg012,xmeg013 
#        INTO g_xmeg3_d[l_ac].xmeg012,g_xmeg3_d[l_ac].xmeg013
#        FROM xmeg_t
#       WHERE xmegent = g_enterprise
#         AND xmegdocno = g_xmeg3_d[l_ac].xmehdocno
#         AND xmegseq = g_xmeg3_d[l_ac].xmehseq
#      DISPLAY BY NAME g_xmeg3_d[l_ac].xmeg012,g_xmeg3_d[l_ac].xmeg013
      #end add-point
   END FOR
   
   FOR l_ac = 1 TO g_xmeg2_d.getLength()
      #add-point:show段單身reference name="show.body2.reference"
      #170207-00004#2 170219 by 02749 mark---(S)
      #LET g_xmeg2_d[l_ac].xmegseq = g_xmeg_d[l_ac].xmegseq
      #LET g_xmeg2_d[l_ac].imaa001 = g_xmeg_d[l_ac].xmeg001
      #LET g_xmeg2_d[l_ac].imaal003 = g_xmeg_d[l_ac].xmeg001_desc
      #LET g_xmeg2_d[l_ac].imaal004 = g_xmeg_d[l_ac].imaal004
      #LET g_xmeg2_d[l_ac].imaa005 = g_xmeg_d[l_ac].xmeg002
      #LET g_xmeg2_d[l_ac].xmeg0272 = g_xmeg_d[l_ac].xmeg027
      #DISPLAY BY NAME g_xmeg2_d[l_ac].xmegseq,g_xmeg2_d[l_ac].imaa001,g_xmeg2_d[l_ac].imaal003,
      #                g_xmeg2_d[l_ac].imaal004,g_xmeg2_d[l_ac].imaa005,g_xmeg2_d[l_ac].xmeg0272            
      #
      #CALL adbt510_xmeg028_ref(g_xmeg2_d[l_ac].xmeg028) RETURNING g_xmeg2_d[l_ac].xmeg028_desc
      #DISPLAY BY NAME g_xmeg2_d[l_ac].xmeg028_desc
      # 
      #CALL adbt510_xmeg029_ref(g_xmeg2_d[l_ac].xmeg028,g_xmeg2_d[l_ac].xmeg029) RETURNING g_xmeg2_d[l_ac].xmeg029_desc
      #DISPLAY BY NAME g_xmeg2_d[l_ac].xmeg029_desc
      #
      #INITIALIZE g_ref_fields TO NULL
      #LET g_ref_fields[1] = g_xmeg2_d[l_ac].xmeg028
      #CALL ap_ref_array2(g_ref_fields,"SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaa001=? ","") RETURNING g_rtn_fields
      #LET g_xmeg2_d[l_ac].xmeg028_desc = '', g_rtn_fields[1] , ''
      #DISPLAY BY NAME g_xmeg2_d[l_ac].xmeg028_desc
      # 
      #INITIALIZE g_ref_fields TO NULL
      #LET g_ref_fields[1] = g_xmeg2_d[l_ac].xmeg028
      #LET g_ref_fields[2] = g_xmeg2_d[l_ac].xmeg029
      #CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
      #LET g_xmeg2_d[l_ac].xmeg029_desc = '', g_rtn_fields[1] , ''
      #DISPLAY BY NAME g_xmeg2_d[l_ac].xmeg029_desc
      #170207-00004#2 170219 by 02749 mark---(E) 
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_xmeg3_d.getLength()
      #add-point:show段單身reference name="show.body3.reference"
      CALL s_desc_get_tax_desc1(g_xmeg3_d[l_ac].xmehsite,g_xmeg3_d[l_ac].xmeh019) RETURNING g_xmeg3_d[l_ac].xmeh019_desc
      CALL s_desc_get_trading_partner_abbr_desc(g_xmeg3_d[l_ac].xmeh207) RETURNING g_xmeg3_d[l_ac].xmeh207_desc
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_xmeg4_d.getLength()
      #add-point:show段單身reference name="show.body4.reference"
            CALL s_desc_get_tax_desc1(g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb006) RETURNING g_xmeg4_d[l_ac].xmjb006_desc
            CALL adbt510_xmjb026_ref()
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_xmeg5_d.getLength()
      #add-point:show段單身reference name="show.body5.reference"
                                    
      #end add-point
   END FOR
 
   
    
   
   #add-point:show段other name="show.other"
   #170207-00004#2 170219 by 02749 mark---(S)
   #FOR l_ac = 1 TO g_xmeg2_d.getLength()
   #   EXECUTE adbt510_detail2 USING g_xmeg2_d[l_ac].rticseq
   #      INTO g_xmeg2_d[l_ac].xmjb0021,g_xmeg2_d[l_ac].xmjb0031,g_xmeg2_d[l_ac].xmjb0031_desc,g_xmeg2_d[l_ac].xmjb0031_desc_desc,
   #           g_xmeg2_d[l_ac].xmjb0171,g_xmeg2_d[l_ac].xmjb0171_desc,g_xmeg2_d[l_ac].xmjb0181,g_xmeg2_d[l_ac].xmjb0081,
   #           g_xmeg2_d[l_ac].xmjb0091,g_xmeg2_d[l_ac].xmjb0101,g_xmeg2_d[l_ac].xmjb0211
   #
   #END FOR
   #170207-00004#2 170219 by 02749---(E)   
   
   FOR l_ac = 1 TO g_xmeg7_d.getLength()
      CALL adbt510_rtie002_ref()
      CALL s_desc_get_item_desc(g_xmeg7_d[l_ac].imaa0012)RETURNING g_xmeg7_d[l_ac].imaa0012_desc,g_xmeg7_d[l_ac].imaa0012_desc_desc
   END FOR   
   #end add-point  
   
   LET l_ac = l_ac_t
   
   #移動上下筆可以連動切換資料
   CALL cl_show_fld_cont()     
 
   CALL adbt510_detail_show()
 
   #add-point:show段之後 name="show.after"
   CALL adbt510_head_color()
   CALL s_hint_show('xmek_t','xmee_t','xmda_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,0,'','')
   CALL s_hint_show('xmek_t','xmef_t','xmdb_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,0,'','')
   IF g_detail_idx > 0 THEN
      #CALL s_hint_show('xmek_t','xmeg_t','xmdc_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg_d[g_detail_idx].xmegseq,'','')
      CALL s_hint_show('xmek_t','xmjb_t','xmja_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg4_d[g_detail_idx].xmjbseq,'','')
      #CALL s_hint_show('xmek_t','xmeh_t','xmdd_t',g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg3_d[g_detail_idx].xmehseq,
      #                  g_xmeg3_d[g_detail_idx].xmehseq1,g_xmeg3_d[g_detail_idx].xmehseq2)   
   END IF                         
   #160513-00027#1 20160520 add by beckxie---S
   CALL adbt510_set_comp_visible_b()
   CALL adbt510_set_comp_no_visible_b()
   #160513-00027#1 20160520 add by beckxie---E
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.detail_show" >}
#+ 第二階單身reference
PRIVATE FUNCTION adbt510_detail_show()
   #add-point:detail_show段define(客製用) name="detail_show.define_customerization"
   
   #end add-point  
   #add-point:detail_show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="detail_show.define"
                  
   #end add-point  
   
   #add-point:Function前置處理 name="detail_show.before"
                  
   #end add-point
   
   #add-point:detail_show段之後 name="detail_show.after"
                  
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.reproduce" >}
#+ 資料複製
PRIVATE FUNCTION adbt510_reproduce()
   #add-point:reproduce段define(客製用) name="reproduce.define_customerization"
   
   #end add-point   
   DEFINE l_newno     LIKE xmee_t.xmeedocno 
   DEFINE l_oldno     LIKE xmee_t.xmeedocno 
   DEFINE l_newno02     LIKE xmee_t.xmee900 
   DEFINE l_oldno02     LIKE xmee_t.xmee900 
 
   DEFINE l_master    RECORD LIKE xmee_t.* #此變數樣板目前無使用
   DEFINE l_detail    RECORD LIKE xmeg_t.* #此變數樣板目前無使用
   DEFINE l_detail2    RECORD LIKE rtic_t.* #此變數樣板目前無使用
 
   DEFINE l_detail3    RECORD LIKE xmeh_t.* #此變數樣板目前無使用
 
   DEFINE l_detail4    RECORD LIKE xmjb_t.* #此變數樣板目前無使用
 
   DEFINE l_detail5    RECORD LIKE xmef_t.* #此變數樣板目前無使用
 
 
 
   DEFINE l_cnt       LIKE type_t.num10
   #add-point:reproduce段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="reproduce.define"
                  
   #end add-point   
   
   #add-point:Function前置處理  name="reproduce.pre_function"
   
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
   
   LET g_master_insert = FALSE
   
   IF g_xmee_m.xmeedocno IS NULL
   OR g_xmee_m.xmee900 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
    
   LET g_xmeedocno_t = g_xmee_m.xmeedocno
   LET g_xmee900_t = g_xmee_m.xmee900
 
    
   LET g_xmee_m.xmeedocno = ""
   LET g_xmee_m.xmee900 = ""
 
 
   CALL cl_set_head_visible("","YES")
 
   #公用欄位給予預設值
   #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_xmee_m.xmeeownid = g_user
      LET g_xmee_m.xmeeowndp = g_dept
      LET g_xmee_m.xmeecrtid = g_user
      LET g_xmee_m.xmeecrtdp = g_dept 
      LET g_xmee_m.xmeecrtdt = cl_get_current()
      LET g_xmee_m.xmeemodid = g_user
      LET g_xmee_m.xmeemoddt = cl_get_current()
      LET g_xmee_m.xmeestus = 'N'
 
 
 
   
   CALL s_transaction_begin()
   
   #add-point:複製輸入前 name="reproduce.head.b_input"
   LET g_xmee_m.xmeestus = 'N' 
   LET g_xmee_m.xmee902 = g_today
   LET g_xmee_m.xmeecnfid = ""
   LET g_xmee_m.xmeecnfdt = ""
   LET g_xmee_m_t.* = g_xmee_m.*
   LET g_xmee_m_o.* = g_xmee_m.*              #舊值備份   
   #end add-point
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_xmee_m.xmeestus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
   
   #清空key欄位的desc
   
   
   CALL adbt510_input("r")
   
   IF INT_FLAG AND NOT g_master_insert THEN
      LET INT_FLAG = 0
      DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
      DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
      LET INT_FLAG = 0
      INITIALIZE g_xmee_m.* TO NULL
      INITIALIZE g_xmeg_d TO NULL
      INITIALIZE g_xmeg2_d TO NULL
      INITIALIZE g_xmeg3_d TO NULL
      INITIALIZE g_xmeg4_d TO NULL
      INITIALIZE g_xmeg5_d TO NULL
 
      #add-point:複製取消後 name="reproduce.cancel"
      
      #end add-point
      CALL adbt510_show()
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = '' 
      LET g_errparam.code = 9001 
      LET g_errparam.popup = FALSE 
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL adbt510_set_act_visible()   
   CALL adbt510_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_xmeedocno_t = g_xmee_m.xmeedocno
   LET g_xmee900_t = g_xmee_m.xmee900
 
   
   #組合新增資料的條件
   LET g_add_browse = " xmeeent = " ||g_enterprise|| " AND",
                      " xmeedocno = '", g_xmee_m.xmeedocno, "' "
                      ," AND xmee900 = '", g_xmee_m.xmee900, "' "
 
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL adbt510_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   #add-point:完成複製段落後 name="reproduce.after_reproduce"
                  
   #end add-point
   
   CALL adbt510_idx_chk()
   
   LET g_data_owner = g_xmee_m.xmeeownid      
   LET g_data_dept  = g_xmee_m.xmeeowndp
   
   #功能已完成,通報訊息中心
   CALL adbt510_msgcentre_notify('reproduce')
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.detail_reproduce" >}
#+ 單身自動複製
PRIVATE FUNCTION adbt510_detail_reproduce()
   #add-point:delete段define(客製用) name="detail_reproduce.define_customerization"
   
   #end add-point    
   DEFINE ls_sql      STRING
   DEFINE ld_date     DATETIME YEAR TO SECOND
   DEFINE l_detail    RECORD LIKE xmeg_t.* #此變數樣板目前無使用
   DEFINE l_detail2    RECORD LIKE rtic_t.* #此變數樣板目前無使用
 
   DEFINE l_detail3    RECORD LIKE xmeh_t.* #此變數樣板目前無使用
 
   DEFINE l_detail4    RECORD LIKE xmjb_t.* #此變數樣板目前無使用
 
   DEFINE l_detail5    RECORD LIKE xmef_t.* #此變數樣板目前無使用
 
 
 
   #add-point:delete段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="detail_reproduce.define"
                  
   #end add-point    
   
   #add-point:Function前置處理  name="detail_reproduce.pre_function"
   
   #end add-point
   
   CALL s_transaction_begin()
   
   LET ld_date = cl_get_current()
   
   DROP TABLE adbt510_detail
   
   #add-point:單身複製前1 name="detail_reproduce.body.table1.b_insert"
                  
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM xmeg_t
    WHERE xmegent = g_enterprise AND xmegdocno = g_xmeedocno_t
     AND xmeg900 = g_xmee900_t
 
    INTO TEMP adbt510_detail
 
   #將key修正為調整後   
   UPDATE adbt510_detail 
      #更新key欄位
      SET xmegdocno = g_xmee_m.xmeedocno
          , xmeg900 = g_xmee_m.xmee900
 
      #更新共用欄位
      
 
   #add-point:單身修改前 name="detail_reproduce.body.table1.b_update"
   
   #end add-point                                       
  
   #將資料塞回原table   
   INSERT INTO xmeg_t SELECT * FROM adbt510_detail
   
   IF SQLCA.SQLCODE THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "reproduce:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE 
      LET g_errparam.popup = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #add-point:單身複製中1 name="detail_reproduce.body.table1.m_insert"
                  
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE adbt510_detail
   
   #add-point:單身複製後1 name="detail_reproduce.body.table1.a_insert"
                  
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table2.b_insert"
   #170207-00004#2 170219 by 02749 memo---(S)
   #1.adbt510 未提供複製功能,此段落無須重寫
   #2.rtic_t 沒有變更記錄,不需要串xmee900
   #170207-00004#2 170219 by 02749 memo---(E)
#   #end add-point
#   
#   #CREATE TEMP TABLE
#   SELECT * FROM rtic_t 
#    WHERE rticent = g_enterprise AND rticdocno = g_xmeedocno_t
#      AND  = g_xmee900_t   
# 
#    INTO TEMP adbt510_detail
# 
#   #將key修正為調整後   
#   UPDATE adbt510_detail SET rticdocno = g_xmee_m.xmeedocno
#                                       ,  = g_xmee_m.xmee900
# 
#  
#   #add-point:單身修改前 name="detail_reproduce.body.table2.b_update"
   
   #end add-point    
 
   #將資料塞回原table   
   INSERT INTO rtic_t SELECT * FROM adbt510_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table2.m_insert"
                  
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE adbt510_detail
   
   #add-point:單身複製後 name="detail_reproduce.body.table2.a_insert"
                  
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table3.b_insert"
                  
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM xmeh_t 
    WHERE xmehent = g_enterprise AND xmehdocno = g_xmeedocno_t
      AND xmeh900 = g_xmee900_t   
 
    INTO TEMP adbt510_detail
 
   #將key修正為調整後   
   UPDATE adbt510_detail SET xmehdocno = g_xmee_m.xmeedocno
                                       , xmeh900 = g_xmee_m.xmee900
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table3.b_update"
   
   #end add-point    
 
   #將資料塞回原table   
   INSERT INTO xmeh_t SELECT * FROM adbt510_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table3.m_insert"
                  
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE adbt510_detail
   
   #add-point:單身複製後 name="detail_reproduce.body.table3.a_insert"
                  
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table4.b_insert"
   
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM xmjb_t 
    WHERE xmjbent = g_enterprise AND xmjbdocno = g_xmeedocno_t
      AND xmjb900 = g_xmee900_t   
 
    INTO TEMP adbt510_detail
 
   #將key修正為調整後   
   UPDATE adbt510_detail SET xmjbdocno = g_xmee_m.xmeedocno
                                       , xmjb900 = g_xmee_m.xmee900
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table4.b_update"
   
   #end add-point    
 
   #將資料塞回原table   
   INSERT INTO xmjb_t SELECT * FROM adbt510_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table4.m_insert"
   
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE adbt510_detail
   
   #add-point:單身複製後 name="detail_reproduce.body.table4.a_insert"
   
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table5.b_insert"
   
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM xmef_t 
    WHERE xmefent = g_enterprise AND xmefdocno = g_xmeedocno_t
      AND xmef900 = g_xmee900_t   
 
    INTO TEMP adbt510_detail
 
   #將key修正為調整後   
   UPDATE adbt510_detail SET xmefdocno = g_xmee_m.xmeedocno
                                       , xmef900 = g_xmee_m.xmee900
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table5.b_update"
   
   #end add-point    
 
   #將資料塞回原table   
   INSERT INTO xmef_t SELECT * FROM adbt510_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table5.m_insert"
   
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE adbt510_detail
   
   #add-point:單身複製後 name="detail_reproduce.body.table5.a_insert"
   
   #end add-point
 
 
   
 
   
   #多語言複製段落
   
   
   CALL s_transaction_end('Y','0')
   
   #已新增完, 調整資料內容(修改時使用)
   LET g_xmeedocno_t = g_xmee_m.xmeedocno
   LET g_xmee900_t = g_xmee_m.xmee900
 
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.delete" >}
#+ 資料刪除
PRIVATE FUNCTION adbt510_delete()
   #add-point:delete段define(客製用) name="delete.define_customerization"
   
   #end add-point     
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   #add-point:delete段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="delete.define"
   DEFINE  l_cnt   LIKE type_t.num5
   #end add-point     
   
   #add-point:Function前置處理  name="delete.pre_function"
   
   #end add-point
   
   IF g_xmee_m.xmeedocno IS NULL
   OR g_xmee_m.xmee900 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
   
   
   
   CALL s_transaction_begin()
 
   OPEN adbt510_cl USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900
   IF SQLCA.SQLCODE THEN   #(ver:78)
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN adbt510_cl:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
      LET g_errparam.popup = TRUE 
      CLOSE adbt510_cl
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE adbt510_master_referesh USING g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmee_m.xmeesite, 
       g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202, 
       g_xmee_m.xmee023,g_xmee_m.xmee004,g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005, 
       g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
       g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
       g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee204,g_xmee_m.xmee205, 
       g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026, 
       g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049, 
       g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
       g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,g_xmee_m.xmeecrtid, 
       g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017, 
       g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028,g_xmee_m.xmeesite_desc,g_xmee_m.xmee202_desc, 
       g_xmee_m.xmee023_desc,g_xmee_m.xmee004_desc,g_xmee_m.xmee200_desc,g_xmee_m.xmee201_desc,g_xmee_m.xmee024_desc, 
       g_xmee_m.xmee002_desc,g_xmee_m.xmee003_desc,g_xmee_m.xmee021_desc,g_xmee_m.xmee022_desc,g_xmee_m.xmee203_desc, 
       g_xmee_m.xmee027_desc,g_xmee_m.xmee211_desc,g_xmee_m.xmee210_desc,g_xmee_m.xmee209_desc,g_xmee_m.xmee208_desc, 
       g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204_desc,g_xmee_m.xmee032_desc,g_xmee_m.xmee903_desc,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207_desc,g_xmee_m.xmee020_desc,g_xmee_m.xmee036_desc,g_xmee_m.xmee009_desc,g_xmee_m.xmee010_desc, 
       g_xmee_m.xmee015_desc,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid_desc, 
       g_xmee_m.xmeecrtdp_desc,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeecnfid_desc,g_xmee_m.xmee034_desc, 
       g_xmee_m.xmee017_desc,g_xmee_m.xmee018_desc
   
   
   #檢查是否允許此動作
   IF NOT adbt510_action_chk() THEN
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_xmee_m_mask_o.* =  g_xmee_m.*
   CALL adbt510_xmee_t_mask()
   LET g_xmee_m_mask_n.* =  g_xmee_m.*
   
   CALL adbt510_show()
   
   #add-point:delete段before ask name="delete.before_ask"
   
   #end add-point 
 
   IF cl_ask_del_master() THEN              #確認一下
   
      #add-point:單頭刪除前 name="delete.head.b_delete"
                                    
      #end add-point   
      
      #應用 a47 樣板自動產生(Version:4)
      #刪除相關文件
      CALL adbt510_set_pk_array()
      #add-point:相關文件刪除前 name="delete.befroe.related_document_remove"
      
      #end add-point   
      CALL cl_doc_remove()  
 
 
 
  
  
      #資料備份
      LET g_xmeedocno_t = g_xmee_m.xmeedocno
      LET g_xmee900_t = g_xmee_m.xmee900
 
 
      DELETE FROM xmee_t
       WHERE xmeeent = g_enterprise AND xmeedocno = g_xmee_m.xmeedocno
         AND xmee900 = g_xmee_m.xmee900
 
       
      #add-point:單頭刪除中 name="delete.head.m_delete"
                          
      #end add-point
       
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_xmee_m.xmeedocno,":",SQLERRMESSAGE  
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF
      
      #add-point:單頭刪除後 name="delete.head.a_delete"
 
      #end add-point
  
      #add-point:單身刪除前 name="delete.body.b_delete"
                                    
      #end add-point
      
      DELETE FROM xmeg_t
       WHERE xmegent = g_enterprise AND xmegdocno = g_xmee_m.xmeedocno
         AND xmeg900 = g_xmee_m.xmee900
 
 
      #add-point:單身刪除中 name="delete.body.m_delete"
                                    
      #end add-point
         
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmeg_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF    
 
      #add-point:單身刪除後 name="delete.body.a_delete"
                                    
      #end add-point
      
            
                                                               
      #add-point:單身刪除前 name="delete.body.b_delete2"
                                    
      #end add-point
      DELETE FROM rtic_t
       WHERE rticent = g_enterprise AND
             rticdocno = g_xmee_m.xmeedocno
      #add-point:單身刪除中 name="delete.body.m_delete2"
                                    
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "rtic_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete2"
                                    
      #end add-point
 
      #add-point:單身刪除前 name="delete.body.b_delete3"
                                    
      #end add-point
      DELETE FROM xmeh_t
       WHERE xmehent = g_enterprise AND
             xmehdocno = g_xmee_m.xmeedocno AND xmeh900 = g_xmee_m.xmee900
      #add-point:單身刪除中 name="delete.body.m_delete3"
                                    
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmeh_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete3"
 
      #end add-point
 
      #add-point:單身刪除前 name="delete.body.b_delete4"
      
      #end add-point
      DELETE FROM xmjb_t
       WHERE xmjbent = g_enterprise AND
             xmjbdocno = g_xmee_m.xmeedocno AND xmjb900 = g_xmee_m.xmee900
      #add-point:單身刪除中 name="delete.body.m_delete4"
      
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmjb_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete4"
      #刪除訂單多交期匯總檔
       DELETE FROM xmej_t 
        WHERE xmejent = g_enterprise 
          AND xmejdocno = g_xmee_m.xmeedocno
          AND xmej900 = g_xmee_m.xmee900          
       IF SQLCA.sqlcode THEN
          INITIALIZE g_errparam TO NULL
          LET g_errparam.code = SQLCA.sqlcode
          LET g_errparam.extend = "xmej_t"
          LET g_errparam.popup = FALSE
          CALL cl_err()

          CALL s_transaction_end('N','0')
         RETURN
       END IF
       #刪除變更歷程檔
       DELETE FROM xmek_t
        WHERE xmekent = g_enterprise
          AND xmekdocno = g_xmee_m.xmeedocno
          AND xmek001 = g_xmee_m.xmee900 
       IF SQLCA.sqlcode THEN
          INITIALIZE g_errparam TO NULL
          LET g_errparam.code = SQLCA.sqlcode
          LET g_errparam.extend = "xmek_t"
          LET g_errparam.popup = TRUE
          CALL cl_err()

          CALL s_transaction_end('N','0')
       END IF 
      #end add-point
 
      #add-point:單身刪除前 name="delete.body.b_delete5"
      
      #end add-point
      DELETE FROM xmef_t
       WHERE xmefent = g_enterprise AND
             xmefdocno = g_xmee_m.xmeedocno AND xmef900 = g_xmee_m.xmee900
      #add-point:單身刪除中 name="delete.body.m_delete5"
      
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmef_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete5"
      
      #end add-point
 
 
 
 
      
      #修改歷程記錄(刪除)
      LET g_log1 = util.JSON.stringify(g_xmee_m)   #(ver:78)
      IF NOT cl_log_modified_record(g_log1,'') THEN    #(ver:78)
         CLOSE adbt510_cl
         CALL s_transaction_end('N','0')
         RETURN
      END IF
             
      CLEAR FORM
      CALL g_xmeg_d.clear() 
      CALL g_xmeg2_d.clear()       
      CALL g_xmeg3_d.clear()       
      CALL g_xmeg4_d.clear()       
      CALL g_xmeg5_d.clear()       
 
     
      CALL adbt510_ui_browser_refresh()  
      #CALL adbt510_ui_headershow()  
      #CALL adbt510_ui_detailshow()
 
      #add-point:多語言刪除 name="delete.lang.before_delete"
      
      #end add-point
      
      #單頭多語言刪除
      
      
      #單身多語言刪除
      
      
      
      
      
 
   
      #add-point:多語言刪除 name="delete.lang.delete"
      
      #end add-point
      
      IF g_browser_cnt > 0 THEN 
         #CALL adbt510_browser_fill("")
         CALL adbt510_fetch('P')
         DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
         DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
      ELSE
         CLEAR FORM
      END IF
      
      CALL s_transaction_end('Y','0')
   ELSE
      CALL s_transaction_end('N','0')
   END IF
 
   CLOSE adbt510_cl
 
   #功能已完成,通報訊息中心
   CALL adbt510_msgcentre_notify('delete')
    
END FUNCTION
 
{</section>}
 
{<section id="adbt510.b_fill" >}
#+ 單身陣列填充
PRIVATE FUNCTION adbt510_b_fill()
   #add-point:b_fill段define(客製用) name="b_fill.define_customerization"
   
   #end add-point     
   DEFINE p_wc2      STRING
   DEFINE li_idx     LIKE type_t.num10
   #add-point:b_fill段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="b_fill.define"
   DEFINE l_sql      STRING
   #end add-point     
   
   #add-point:Function前置處理  name="b_fill.pre_function"
   
   #end add-point
   
   #清空第一階單身
   CALL g_xmeg_d.clear()
   CALL g_xmeg2_d.clear()
   CALL g_xmeg3_d.clear()
   CALL g_xmeg4_d.clear()
   CALL g_xmeg5_d.clear()
 
 
   #add-point:b_fill段sql_before name="b_fill.sql_before"
  #CALL g_xmeg2_d.clear()   #170207-00004#2 170219 by 02749 mark
   #end add-point
   
   #判斷是否填充
   IF adbt510_fill_chk(1) THEN
      #切換上下筆時不重組SQL
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
      #add-point:b_fill段long_sql_if name="b_fill.long_sql_if"
      
      #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT xmegsite,xmegseq,xmeg027,xmeg001,xmeg002,xmeg004,xmeg005,xmeg006, 
             xmeg007,xmeg008,xmeg009,xmeg024,xmeg012,xmeg013,xmeg045,xmeg010,xmeg011,xmeg015,xmeg016, 
             xmeg017,xmeg046,xmeg047,xmeg048,xmeg023,xmeg019,xmeg020,xmeg021,xmeg022,xmeg051,xmegunit, 
             xmegorga,xmeg052,xmeg049,xmeg053,xmeg050,xmeg901,xmeg902,xmeg903 ,t1.imaal003 ,t2.imaal004 , 
             t3.oocql004 ,t4.oocal003 ,t5.oocal003 ,t6.oocal003 ,t7.ooefl003 ,t8.ooefl003 ,t9.oocql004 , 
             t10.oocql004 ,t11.oocql004 FROM xmeg_t",   
                     " INNER JOIN xmee_t ON xmeeent = " ||g_enterprise|| " AND xmeedocno = xmegdocno ",
                     " AND xmee900 = xmeg900 ",
 
                     #"",
                     
                     "",
                     #下層單身所需的join條件
 
                                    " LEFT JOIN imaal_t t1 ON t1.imaalent="||g_enterprise||" AND t1.imaal001=xmeg001 AND t1.imaal002='"||g_dlang||"' ",
               " LEFT JOIN imaal_t t2 ON t2.imaalent="||g_enterprise||" AND t2.imaal001=xmeg001 AND t2.imaal002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t3 ON t3.oocqlent="||g_enterprise||" AND t3.oocql001='221' AND t3.oocql002=xmeg004 AND t3.oocql003='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t4 ON t4.oocalent="||g_enterprise||" AND t4.oocal001=xmeg006 AND t4.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t5 ON t5.oocalent="||g_enterprise||" AND t5.oocal001=xmeg008 AND t5.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t6 ON t6.oocalent="||g_enterprise||" AND t6.oocal001=xmeg010 AND t6.oocal002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t7 ON t7.ooeflent="||g_enterprise||" AND t7.ooefl001=xmegunit AND t7.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t8 ON t8.ooeflent="||g_enterprise||" AND t8.ooefl001=xmegorga AND t8.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t9 ON t9.oocqlent="||g_enterprise||" AND t9.oocql001='265' AND t9.oocql002=xmeg049 AND t9.oocql003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t10 ON t10.oocqlent="||g_enterprise||" AND t10.oocql001='265' AND t10.oocql002=xmeg053 AND t10.oocql003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t11 ON t11.oocqlent="||g_enterprise||" AND t11.oocql001='282' AND t11.oocql002=xmeg902 AND t11.oocql003='"||g_dlang||"' ",
 
                     " WHERE xmegent=? AND xmegdocno=? AND xmeg900=?"
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段sql_before name="b_fill.body.fill_sql"
                                    
         #end add-point
         IF NOT cl_null(g_wc2_table1) THEN
            LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY xmeg_t.xmegseq"
         
         #add-point:單身填充控制 name="b_fill.sql"
                           
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE adbt510_pb FROM g_sql
         DECLARE b_fill_cs CURSOR FOR adbt510_pb
      END IF
      
      LET g_cnt = l_ac
      LET l_ac = 1
      
   #  OPEN b_fill_cs USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900   #(ver:78)
                                               
      FOREACH b_fill_cs USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmeg_d[l_ac].xmegsite, 
          g_xmeg_d[l_ac].xmegseq,g_xmeg_d[l_ac].xmeg027,g_xmeg_d[l_ac].xmeg001,g_xmeg_d[l_ac].xmeg002, 
          g_xmeg_d[l_ac].xmeg004,g_xmeg_d[l_ac].xmeg005,g_xmeg_d[l_ac].xmeg006,g_xmeg_d[l_ac].xmeg007, 
          g_xmeg_d[l_ac].xmeg008,g_xmeg_d[l_ac].xmeg009,g_xmeg_d[l_ac].xmeg024,g_xmeg_d[l_ac].xmeg012, 
          g_xmeg_d[l_ac].xmeg013,g_xmeg_d[l_ac].xmeg045,g_xmeg_d[l_ac].xmeg010,g_xmeg_d[l_ac].xmeg011, 
          g_xmeg_d[l_ac].xmeg015,g_xmeg_d[l_ac].xmeg016,g_xmeg_d[l_ac].xmeg017,g_xmeg_d[l_ac].xmeg046, 
          g_xmeg_d[l_ac].xmeg047,g_xmeg_d[l_ac].xmeg048,g_xmeg_d[l_ac].xmeg023,g_xmeg_d[l_ac].xmeg019, 
          g_xmeg_d[l_ac].xmeg020,g_xmeg_d[l_ac].xmeg021,g_xmeg_d[l_ac].xmeg022,g_xmeg_d[l_ac].xmeg051, 
          g_xmeg_d[l_ac].xmegunit,g_xmeg_d[l_ac].xmegorga,g_xmeg_d[l_ac].xmeg052,g_xmeg_d[l_ac].xmeg049, 
          g_xmeg_d[l_ac].xmeg053,g_xmeg_d[l_ac].xmeg050,g_xmeg_d[l_ac].xmeg901,g_xmeg_d[l_ac].xmeg902, 
          g_xmeg_d[l_ac].xmeg903,g_xmeg_d[l_ac].xmeg001_desc,g_xmeg_d[l_ac].xmeg001_desc_desc,g_xmeg_d[l_ac].xmeg004_desc, 
          g_xmeg_d[l_ac].xmeg006_desc,g_xmeg_d[l_ac].xmeg008_desc,g_xmeg_d[l_ac].xmeg010_desc,g_xmeg_d[l_ac].xmegunit_desc, 
          g_xmeg_d[l_ac].xmegorga_desc,g_xmeg_d[l_ac].xmeg049_desc,g_xmeg_d[l_ac].xmeg053_desc,g_xmeg_d[l_ac].xmeg902_desc  
            #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill.fill"
         #單身文字的顏色顯示
         CALL adbt510_detail_color() 
         #end add-point
      
         IF l_ac > g_max_rec THEN
            IF g_error_show = 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code = 9035 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
            END IF
            EXIT FOREACH
         END IF
         
         LET l_ac = l_ac + 1
      END FOREACH
      LET g_error_show = 0
   
   END IF
    
   #判斷是否填充
   IF adbt510_fill_chk(2) THEN
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
         #add-point:b_fill段long_sql_if name="b_fill.body2.long_sql_if"
         
         #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT rticseq,rticseq1,rtic001,rtic002,rtic003,rtic004,rtic005,rtic006, 
             rtic007,rtic008,rtic009,rtic010,rtic011,rtic012,rtic013,rtic014,rtic015,rtic016,rtic017, 
             rtic018,rtic019,rtic020,rtic021,rtic022,rtic023,rtic024,rtic025,rtic026,rtic027,rtic028, 
             rtic029  FROM rtic_t",   
                     " INNER JOIN  xmee_t ON xmeeent = " ||g_enterprise|| " AND xmeedocno = rticdocno ",
                     " AND xmee900 =  ",
 
                     "",
                     
                     
                     " WHERE rticent=? AND rticdocno=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段fill_sql name="b_fill.body2.fill_sql"
         #170207-00004#2 170219 by 02749 add---(S)
         #1.rtic_t 沒有變更記錄,不需要串xmee900
         #2.FOREACH傳入三個變數
         LET g_sql = "SELECT  DISTINCT rticseq,rticseq1,rtic001,rtic002,rtic003,rtic004,rtic005,rtic006, 
                                       rtic007,rtic008,rtic009,rtic010,rtic011,rtic012,rtic013,rtic014,rtic015,rtic016,rtic017, 
                                       rtic018,rtic019,rtic020,rtic021,rtic022,rtic023,rtic024,rtic025,rtic026,rtic027,rtic028, 
                                       rtic029  FROM rtic_t",   
                     " INNER JOIN  xmee_t ON xmeeent = " ||g_enterprise|| " AND xmeedocno = rticdocno ",
                     " WHERE rticent=? AND rticdocno=? ",
                     "   AND xmee900 = ? "                     
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料                                    
         #170207-00004#2 170219 by 02749 add---(E)
         #end add-point
         IF NOT cl_null(g_wc2_table2) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table2 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY rtic_t.rticseq,rtic_t.rticseq1"
         
         #add-point:單身填充控制 name="b_fill.sql2"
                                    
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE adbt510_pb2 FROM g_sql
         DECLARE b_fill_cs2 CURSOR FOR adbt510_pb2
      END IF
    
      LET l_ac = 1
      
   #  OPEN b_fill_cs2 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900   #(ver:78)
                                               
      FOREACH b_fill_cs2 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmeg2_d[l_ac].rticseq, 
          g_xmeg2_d[l_ac].rticseq1,g_xmeg2_d[l_ac].rtic001,g_xmeg2_d[l_ac].rtic002,g_xmeg2_d[l_ac].rtic003, 
          g_xmeg2_d[l_ac].rtic004,g_xmeg2_d[l_ac].rtic005,g_xmeg2_d[l_ac].rtic006,g_xmeg2_d[l_ac].rtic007, 
          g_xmeg2_d[l_ac].rtic008,g_xmeg2_d[l_ac].rtic009,g_xmeg2_d[l_ac].rtic010,g_xmeg2_d[l_ac].rtic011, 
          g_xmeg2_d[l_ac].rtic012,g_xmeg2_d[l_ac].rtic013,g_xmeg2_d[l_ac].rtic014,g_xmeg2_d[l_ac].rtic015, 
          g_xmeg2_d[l_ac].rtic016,g_xmeg2_d[l_ac].rtic017,g_xmeg2_d[l_ac].rtic018,g_xmeg2_d[l_ac].rtic019, 
          g_xmeg2_d[l_ac].rtic020,g_xmeg2_d[l_ac].rtic021,g_xmeg2_d[l_ac].rtic022,g_xmeg2_d[l_ac].rtic023, 
          g_xmeg2_d[l_ac].rtic024,g_xmeg2_d[l_ac].rtic025,g_xmeg2_d[l_ac].rtic026,g_xmeg2_d[l_ac].rtic027, 
          g_xmeg2_d[l_ac].rtic028,g_xmeg2_d[l_ac].rtic029   #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill2.fill"
         #單身文字的顏色顯示
        #CALL adbt510_detail3_color()   #170207-00004#2 170219 by 02749 mark
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code = 9035 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
   #判斷是否填充
   IF adbt510_fill_chk(3) THEN
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
         #add-point:b_fill段long_sql_if name="b_fill.body3.long_sql_if"
         
         #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT xmehdocno,xmehseq,xmehseq1,xmeh229,xmeh003,xmeh001,xmeh002,xmeh200, 
             xmeh004,xmeh005,xmeh011,xmeh012,xmehseq2,xmeh006,xmeh201,xmeh202,xmeh024,xmeh025,xmeh026, 
             xmeh027,xmeh203,xmeh204,xmeh205,xmeh206,xmeh029,xmeh028,xmeh019,xmeh030,xmeh207,xmehunit, 
             xmeh210,xmeh212,xmeh213,xmeh214,xmeh215,xmeh031,xmeh014,xmeh015,xmeh016,xmeh017,xmeh221, 
             xmehsite,xmeh218,xmeh219,xmeh220,xmeh222,xmeh223,xmeh224,xmehorga,xmeh226,xmeh227,xmeh228, 
             xmeh901 ,t15.imaal003 ,t16.imaal004 ,t17.prcfl003 ,t18.oocal003 ,t19.oocal003 ,t20.oocal003 , 
             t21.oocal003 ,t22.pmaal004 ,t23.ooefl003 ,t24.oocql004 ,t25.inayl003 ,t26.inab003 ,t27.ooefl003 , 
             t28.oojdl003 ,t29.dbbal003 ,t30.dbbcl003 ,t31.ooefl003 ,t32.ooag011 ,t33.ooefl003 ,t34.ooefl003 , 
             t35.oocql004 ,t36.staal003 FROM xmeh_t",   
                     " INNER JOIN  xmee_t ON xmeeent = " ||g_enterprise|| " AND xmeedocno = xmehdocno ",
                     " AND xmee900 = xmeh900 ",
 
                     "",
                     
                                    " LEFT JOIN imaal_t t15 ON t15.imaalent="||g_enterprise||" AND t15.imaal001=xmeh001 AND t15.imaal002='"||g_dlang||"' ",
               " LEFT JOIN imaal_t t16 ON t16.imaalent="||g_enterprise||" AND t16.imaal001=xmeh001 AND t16.imaal002='"||g_dlang||"' ",
               " LEFT JOIN prcfl_t t17 ON t17.prcflent="||g_enterprise||" AND t17.prcfl001=xmeh200 AND t17.prcfl002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t18 ON t18.oocalent="||g_enterprise||" AND t18.oocal001=xmeh004 AND t18.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t19 ON t19.oocalent="||g_enterprise||" AND t19.oocal001=xmeh201 AND t19.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t20 ON t20.oocalent="||g_enterprise||" AND t20.oocal001=xmeh024 AND t20.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t21 ON t21.oocalent="||g_enterprise||" AND t21.oocal001=xmeh026 AND t21.oocal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t22 ON t22.pmaalent="||g_enterprise||" AND t22.pmaal001=xmeh207 AND t22.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t23 ON t23.ooeflent="||g_enterprise||" AND t23.ooefl001=xmehunit AND t23.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t24 ON t24.oocqlent="||g_enterprise||" AND t24.oocql001='274' AND t24.oocql002=xmeh210 AND t24.oocql003='"||g_dlang||"' ",
               " LEFT JOIN inayl_t t25 ON t25.inaylent="||g_enterprise||" AND t25.inayl001=xmeh213 AND t25.inayl002='"||g_dlang||"' ",
               " LEFT JOIN inab_t t26 ON t26.inabent="||g_enterprise||" AND t26.inabsite=xmehunit AND t26.inab001=xmeh213 AND t26.inab002=xmeh214  ",
               " LEFT JOIN ooefl_t t27 ON t27.ooeflent="||g_enterprise||" AND t27.ooefl001=xmehsite AND t27.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN oojdl_t t28 ON t28.oojdlent="||g_enterprise||" AND t28.oojdl001=xmeh218 AND t28.oojdl002='"||g_dlang||"' ",
               " LEFT JOIN dbbal_t t29 ON t29.dbbalent="||g_enterprise||" AND t29.dbbal001=xmeh219 AND t29.dbbal002='"||g_dlang||"' ",
               " LEFT JOIN dbbcl_t t30 ON t30.dbbclent="||g_enterprise||" AND t30.dbbcl001=xmeh220 AND t30.dbbcl002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t31 ON t31.ooeflent="||g_enterprise||" AND t31.ooefl001=xmeh222 AND t31.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t32 ON t32.ooagent="||g_enterprise||" AND t32.ooag001=xmeh223  ",
               " LEFT JOIN ooefl_t t33 ON t33.ooeflent="||g_enterprise||" AND t33.ooefl001=xmeh224 AND t33.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t34 ON t34.ooeflent="||g_enterprise||" AND t34.ooefl001=xmehorga AND t34.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t35 ON t35.oocqlent="||g_enterprise||" AND t35.oocql001='2060' AND t35.oocql002=xmeh227 AND t35.oocql003='"||g_dlang||"' ",
               " LEFT JOIN staal_t t36 ON t36.staalent="||g_enterprise||" AND t36.staal001=xmeh228 AND t36.staal002='"||g_dlang||"' ",
 
                     " WHERE xmehent=? AND xmehdocno=? AND xmeh900=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段fill_sql name="b_fill.body3.fill_sql"
                                    
         #end add-point
         IF NOT cl_null(g_wc2_table3) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table3 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY xmeh_t.xmehseq,xmeh_t.xmehseq1,xmeh_t.xmehseq2"
         
         #add-point:單身填充控制 name="b_fill.sql3"
                                    
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE adbt510_pb3 FROM g_sql
         DECLARE b_fill_cs3 CURSOR FOR adbt510_pb3
      END IF
    
      LET l_ac = 1
      
   #  OPEN b_fill_cs3 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900   #(ver:78)
                                               
      FOREACH b_fill_cs3 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmeg3_d[l_ac].xmehdocno, 
          g_xmeg3_d[l_ac].xmehseq,g_xmeg3_d[l_ac].xmehseq1,g_xmeg3_d[l_ac].xmeh229,g_xmeg3_d[l_ac].xmeh003, 
          g_xmeg3_d[l_ac].xmeh001,g_xmeg3_d[l_ac].xmeh002,g_xmeg3_d[l_ac].xmeh200,g_xmeg3_d[l_ac].xmeh004, 
          g_xmeg3_d[l_ac].xmeh005,g_xmeg3_d[l_ac].xmeh011,g_xmeg3_d[l_ac].xmeh012,g_xmeg3_d[l_ac].xmehseq2, 
          g_xmeg3_d[l_ac].xmeh006,g_xmeg3_d[l_ac].xmeh201,g_xmeg3_d[l_ac].xmeh202,g_xmeg3_d[l_ac].xmeh024, 
          g_xmeg3_d[l_ac].xmeh025,g_xmeg3_d[l_ac].xmeh026,g_xmeg3_d[l_ac].xmeh027,g_xmeg3_d[l_ac].xmeh203, 
          g_xmeg3_d[l_ac].xmeh204,g_xmeg3_d[l_ac].xmeh205,g_xmeg3_d[l_ac].xmeh206,g_xmeg3_d[l_ac].xmeh029, 
          g_xmeg3_d[l_ac].xmeh028,g_xmeg3_d[l_ac].xmeh019,g_xmeg3_d[l_ac].xmeh030,g_xmeg3_d[l_ac].xmeh207, 
          g_xmeg3_d[l_ac].xmehunit,g_xmeg3_d[l_ac].xmeh210,g_xmeg3_d[l_ac].xmeh212,g_xmeg3_d[l_ac].xmeh213, 
          g_xmeg3_d[l_ac].xmeh214,g_xmeg3_d[l_ac].xmeh215,g_xmeg3_d[l_ac].xmeh031,g_xmeg3_d[l_ac].xmeh014, 
          g_xmeg3_d[l_ac].xmeh015,g_xmeg3_d[l_ac].xmeh016,g_xmeg3_d[l_ac].xmeh017,g_xmeg3_d[l_ac].xmeh221, 
          g_xmeg3_d[l_ac].xmehsite,g_xmeg3_d[l_ac].xmeh218,g_xmeg3_d[l_ac].xmeh219,g_xmeg3_d[l_ac].xmeh220, 
          g_xmeg3_d[l_ac].xmeh222,g_xmeg3_d[l_ac].xmeh223,g_xmeg3_d[l_ac].xmeh224,g_xmeg3_d[l_ac].xmehorga, 
          g_xmeg3_d[l_ac].xmeh226,g_xmeg3_d[l_ac].xmeh227,g_xmeg3_d[l_ac].xmeh228,g_xmeg3_d[l_ac].xmeh901, 
          g_xmeg3_d[l_ac].xmeh001_desc,g_xmeg3_d[l_ac].xmeh001_desc_desc,g_xmeg3_d[l_ac].xmeh200_desc, 
          g_xmeg3_d[l_ac].xmeh004_desc,g_xmeg3_d[l_ac].xmeh201_desc,g_xmeg3_d[l_ac].xmeh024_desc,g_xmeg3_d[l_ac].xmeh026_desc, 
          g_xmeg3_d[l_ac].xmeh207_desc,g_xmeg3_d[l_ac].xmehunit_desc,g_xmeg3_d[l_ac].xmeh210_desc,g_xmeg3_d[l_ac].xmeh213_desc, 
          g_xmeg3_d[l_ac].xmeh214_desc,g_xmeg3_d[l_ac].xmehsite_desc,g_xmeg3_d[l_ac].xmeh218_desc,g_xmeg3_d[l_ac].xmeh219_desc, 
          g_xmeg3_d[l_ac].xmeh220_desc,g_xmeg3_d[l_ac].xmeh222_desc,g_xmeg3_d[l_ac].xmeh223_desc,g_xmeg3_d[l_ac].xmeh224_desc, 
          g_xmeg3_d[l_ac].xmehorga_desc,g_xmeg3_d[l_ac].xmeh227_desc,g_xmeg3_d[l_ac].xmeh228_desc    
          #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill3.fill"
         #單身文字的顏色顯示
        #CALL adbt510_detail4_color()    #170207-00004#2 170219 by 02749 mark
         CALL adbt510_detail3_color()    #170207-00004#2 170219 by 02749 add                                         
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code = 9035 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
   #判斷是否填充
   IF adbt510_fill_chk(4) THEN
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
         #add-point:b_fill段long_sql_if name="b_fill.body4.long_sql_if"
         
         #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT xmjbunit,xmjbseq,xmjbsite,xmjb001,xmjb002,xmjb003,xmjb033,xmjb004, 
             xmjb005,xmjb006,xmjb007,xmjb011,xmjb012,xmjb013,xmjb014,xmjb015,xmjb016,xmjb017,xmjb018, 
             xmjb008,xmjb009,xmjb010,xmjb022,xmjb019,xmjb020,xmjb021,xmjb024,xmjb025,xmjb026,xmjb027, 
             xmjb028,xmjb029,xmjb030,xmjb031,xmjb032,xmjb040,xmjb039,xmjb038,xmjb037,xmjb034,xmjb901, 
             xmjb902,xmjb903 ,t37.ooefl003 ,t38.imaal003 ,t39.imaal004 ,t40.prcfl003 ,t41.oocal003 , 
             t42.oocal003 ,t43.oocal003 ,t44.oocal003 ,t45.pmaal004 ,t46.dbadl003 ,t47.dbaal003 ,t48.dbaal003 , 
             t49.dbaal003 ,t50.dbaal003 ,t51.oocql004 FROM xmjb_t",   
                     " INNER JOIN  xmee_t ON xmeeent = " ||g_enterprise|| " AND xmeedocno = xmjbdocno ",
                     " AND xmee900 = xmjb900 ",
 
                     "",
                     
                                    " LEFT JOIN ooefl_t t37 ON t37.ooeflent="||g_enterprise||" AND t37.ooefl001=xmjbsite AND t37.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN imaal_t t38 ON t38.imaalent="||g_enterprise||" AND t38.imaal001=xmjb003 AND t38.imaal002='"||g_dlang||"' ",
               " LEFT JOIN imaal_t t39 ON t39.imaalent="||g_enterprise||" AND t39.imaal001=xmjb003 AND t39.imaal002='"||g_dlang||"' ",
               " LEFT JOIN prcfl_t t40 ON t40.prcflent="||g_enterprise||" AND t40.prcfl001=xmjb005 AND t40.prcfl002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t41 ON t41.oocalent="||g_enterprise||" AND t41.oocal001=xmjb011 AND t41.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t42 ON t42.oocalent="||g_enterprise||" AND t42.oocal001=xmjb013 AND t42.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t43 ON t43.oocalent="||g_enterprise||" AND t43.oocal001=xmjb015 AND t43.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t44 ON t44.oocalent="||g_enterprise||" AND t44.oocal001=xmjb017 AND t44.oocal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t45 ON t45.pmaalent="||g_enterprise||" AND t45.pmaal001=xmjb024 AND t45.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN dbadl_t t46 ON t46.dbadlent="||g_enterprise||" AND t46.dbadl001=xmjb027 AND t46.dbadl002='"||g_dlang||"' ",
               " LEFT JOIN dbaal_t t47 ON t47.dbaalent="||g_enterprise||" AND t47.dbaal001=xmjb040 AND t47.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN dbaal_t t48 ON t48.dbaalent="||g_enterprise||" AND t48.dbaal001=xmjb039 AND t48.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN dbaal_t t49 ON t49.dbaalent="||g_enterprise||" AND t49.dbaal001=xmjb038 AND t49.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN dbaal_t t50 ON t50.dbaalent="||g_enterprise||" AND t50.dbaal001=xmjb037 AND t50.dbaal002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t51 ON t51.oocqlent="||g_enterprise||" AND t51.oocql001='282' AND t51.oocql002=xmjb902 AND t51.oocql003='"||g_dlang||"' ",
 
                     " WHERE xmjbent=? AND xmjbdocno=? AND xmjb900=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段fill_sql name="b_fill.body4.fill_sql"
         
         #end add-point
         IF NOT cl_null(g_wc2_table4) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table4 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY xmjb_t.xmjbseq"
         
         #add-point:單身填充控制 name="b_fill.sql4"
         
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE adbt510_pb4 FROM g_sql
         DECLARE b_fill_cs4 CURSOR FOR adbt510_pb4
      END IF
    
      LET l_ac = 1
      
   #  OPEN b_fill_cs4 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900   #(ver:78)
                                               
      FOREACH b_fill_cs4 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmeg4_d[l_ac].xmjbunit, 
          g_xmeg4_d[l_ac].xmjbseq,g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb001,g_xmeg4_d[l_ac].xmjb002, 
          g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb033,g_xmeg4_d[l_ac].xmjb004,g_xmeg4_d[l_ac].xmjb005, 
          g_xmeg4_d[l_ac].xmjb006,g_xmeg4_d[l_ac].xmjb007,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb012, 
          g_xmeg4_d[l_ac].xmjb013,g_xmeg4_d[l_ac].xmjb014,g_xmeg4_d[l_ac].xmjb015,g_xmeg4_d[l_ac].xmjb016, 
          g_xmeg4_d[l_ac].xmjb017,g_xmeg4_d[l_ac].xmjb018,g_xmeg4_d[l_ac].xmjb008,g_xmeg4_d[l_ac].xmjb009, 
          g_xmeg4_d[l_ac].xmjb010,g_xmeg4_d[l_ac].xmjb022,g_xmeg4_d[l_ac].xmjb019,g_xmeg4_d[l_ac].xmjb020, 
          g_xmeg4_d[l_ac].xmjb021,g_xmeg4_d[l_ac].xmjb024,g_xmeg4_d[l_ac].xmjb025,g_xmeg4_d[l_ac].xmjb026, 
          g_xmeg4_d[l_ac].xmjb027,g_xmeg4_d[l_ac].xmjb028,g_xmeg4_d[l_ac].xmjb029,g_xmeg4_d[l_ac].xmjb030, 
          g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032,g_xmeg4_d[l_ac].xmjb040,g_xmeg4_d[l_ac].xmjb039, 
          g_xmeg4_d[l_ac].xmjb038,g_xmeg4_d[l_ac].xmjb037,g_xmeg4_d[l_ac].xmjb034,g_xmeg4_d[l_ac].xmjb901, 
          g_xmeg4_d[l_ac].xmjb902,g_xmeg4_d[l_ac].xmjb903,g_xmeg4_d[l_ac].xmjbsite_desc,g_xmeg4_d[l_ac].xmjb003_desc, 
          g_xmeg4_d[l_ac].xmjb003_desc_desc,g_xmeg4_d[l_ac].xmjb005_desc,g_xmeg4_d[l_ac].xmjb011_desc, 
          g_xmeg4_d[l_ac].xmjb013_desc,g_xmeg4_d[l_ac].xmjb015_desc,g_xmeg4_d[l_ac].xmjb017_desc,g_xmeg4_d[l_ac].xmjb024_desc, 
          g_xmeg4_d[l_ac].xmjb027_desc,g_xmeg4_d[l_ac].xmjb040_desc,g_xmeg4_d[l_ac].xmjb039_desc,g_xmeg4_d[l_ac].xmjb038_desc, 
          g_xmeg4_d[l_ac].xmjb037_desc,g_xmeg4_d[l_ac].xmjb902_desc   #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill4.fill"
         #170207-00004#2 170219 by 02749 add---(S)
         #折扣明細(rtic_t)頁簽是對應商品明細(xmjb_t),因此商品明細資料填充時,一併填充折扣明細
         LET g_xmeg2_d[l_ac].xmjb0021           = g_xmeg4_d[l_ac].xmjb002            
         LET g_xmeg2_d[l_ac].xmjb0031           = g_xmeg4_d[l_ac].xmjb003           
         LET g_xmeg2_d[l_ac].xmjb0031_desc      = g_xmeg4_d[l_ac].xmjb003_desc      
         LET g_xmeg2_d[l_ac].xmjb0031_desc_desc = g_xmeg4_d[l_ac].xmjb003_desc_desc 
         LET g_xmeg2_d[l_ac].xmjb0171           = g_xmeg4_d[l_ac].xmjb017           
         LET g_xmeg2_d[l_ac].xmjb0171_desc      = g_xmeg4_d[l_ac].xmjb017_desc      
         LET g_xmeg2_d[l_ac].xmjb0181           = g_xmeg4_d[l_ac].xmjb018             
         LET g_xmeg2_d[l_ac].xmjb0081           = g_xmeg4_d[l_ac].xmjb008             
         LET g_xmeg2_d[l_ac].xmjb0091           = g_xmeg4_d[l_ac].xmjb009             
         LET g_xmeg2_d[l_ac].xmjb0101           = g_xmeg4_d[l_ac].xmjb010             
         LET g_xmeg2_d[l_ac].xmjb0211           = g_xmeg4_d[l_ac].xmjb021                      
         #170207-00004#2 170219 by 02749 add---(E)
         
         #單身文字的顏色顯示                   
        #CALL adbt510_detail5_color()    #170207-00004#2 170219 by 02749 mark
         CALL adbt510_detail4_color()    #170207-00004#2 170219 by 02749 add
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code = 9035 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
   #判斷是否填充
   IF adbt510_fill_chk(5) THEN
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
         #add-point:b_fill段long_sql_if name="b_fill.body5.long_sql_if"
         
         #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT xmefsite,xmef001,xmef002,xmef003,xmef004,xmef005,xmef006,xmef016, 
             xmef017,xmef007,xmef008,xmef009,xmef901,xmef902,xmef903 ,t52.ooibl004 ,t53.oocql004 FROM xmef_t", 
                
                     " INNER JOIN  xmee_t ON xmeeent = " ||g_enterprise|| " AND xmeedocno = xmefdocno ",
                     " AND xmee900 = xmef900 ",
 
                     "",
                     
                                    " LEFT JOIN ooibl_t t52 ON t52.ooiblent="||g_enterprise||" AND t52.ooibl002=xmef002 AND t52.ooibl003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t53 ON t53.oocqlent="||g_enterprise||" AND t53.oocql001='282' AND t53.oocql002=xmef902 AND t53.oocql003='"||g_dlang||"' ",
 
                     " WHERE xmefent=? AND xmefdocno=? AND xmef900=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段fill_sql name="b_fill.body5.fill_sql"
         
         #end add-point
         IF NOT cl_null(g_wc2_table5) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table5 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY xmef_t.xmef001"
         
         #add-point:單身填充控制 name="b_fill.sql5"
         
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE adbt510_pb5 FROM g_sql
         DECLARE b_fill_cs5 CURSOR FOR adbt510_pb5
      END IF
    
      LET l_ac = 1
      
   #  OPEN b_fill_cs5 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900   #(ver:78)
                                               
      FOREACH b_fill_cs5 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmeg5_d[l_ac].xmefsite, 
          g_xmeg5_d[l_ac].xmef001,g_xmeg5_d[l_ac].xmef002,g_xmeg5_d[l_ac].xmef003,g_xmeg5_d[l_ac].xmef004, 
          g_xmeg5_d[l_ac].xmef005,g_xmeg5_d[l_ac].xmef006,g_xmeg5_d[l_ac].xmef016,g_xmeg5_d[l_ac].xmef017, 
          g_xmeg5_d[l_ac].xmef007,g_xmeg5_d[l_ac].xmef008,g_xmeg5_d[l_ac].xmef009,g_xmeg5_d[l_ac].xmef901, 
          g_xmeg5_d[l_ac].xmef902,g_xmeg5_d[l_ac].xmef903,g_xmeg5_d[l_ac].xmef002_desc,g_xmeg5_d[l_ac].xmef902_desc  
            #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill5.fill"
         #單身文字的顏色顯示                   
         CALL adbt510_detail5_color()    #170207-00004#2 170219 by 02749 add
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code = 9035 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
 
   
   #add-point:browser_fill段其他table處理 name="browser_fill.other_fill"
   #170207-00004#2 170219 by 02749 mark---(S)
   #LET g_sql = "SELECT UNIQUE rticseq,rticseq1,rtic001,rtic002,rtic003,",
   #            "              rtic004,rtic005, rtic006,rtic007,rtic008,",
   #            "              rtic009,rtic010, rtic011,rtic012,rtic013,",
   #            "              rtic014,rtic015, rtic016,rtic017,rtic018,",
   #            "              rtic019,rtic020, rtic021,rtic022,rtic023,",
   #            "              rtic024,rtic025, rtic026,rtic027,rtic028,",
   #            "              rtic029",
   #            "  FROM rtic_t",
   #            " WHERE rticent=? AND rticdocno=?" 
   #IF NOT cl_null(g_wc2_rtic) THEN
   #   LET g_sql = g_sql CLIPPED," AND ",g_wc2_rtic CLIPPED
   #END IF
   #LET g_sql = g_sql, " ORDER BY rticseq,rticseq1"
   #      
   #PREPARE adbt510_pre1 FROM g_sql
   #DECLARE adbt510_b_fill_cs1 CURSOR FOR adbt510_pre1
   #
   #LET l_ac = 1
   #
   #OPEN adbt510_b_fill_cs1 USING g_enterprise,g_xmee_m.xmeedocno
   #FOREACH adbt510_b_fill_cs1 INTO
   #   g_xmeg2_d[l_ac].rticseq,g_xmeg2_d[l_ac].rticseq1,g_xmeg2_d[l_ac].rtic001,
   #   g_xmeg2_d[l_ac].rtic002,g_xmeg2_d[l_ac].rtic003, g_xmeg2_d[l_ac].rtic004,
   #   g_xmeg2_d[l_ac].rtic005,g_xmeg2_d[l_ac].rtic006, g_xmeg2_d[l_ac].rtic007,
   #   g_xmeg2_d[l_ac].rtic008,g_xmeg2_d[l_ac].rtic009, g_xmeg2_d[l_ac].rtic010,
   #   g_xmeg2_d[l_ac].rtic011,g_xmeg2_d[l_ac].rtic012, g_xmeg2_d[l_ac].rtic013,
   #   g_xmeg2_d[l_ac].rtic014,g_xmeg2_d[l_ac].rtic015, g_xmeg2_d[l_ac].rtic016,
   #   g_xmeg2_d[l_ac].rtic017,g_xmeg2_d[l_ac].rtic018, g_xmeg2_d[l_ac].rtic019,
   #   g_xmeg2_d[l_ac].rtic020,g_xmeg2_d[l_ac].rtic021, g_xmeg2_d[l_ac].rtic022,
   #   g_xmeg2_d[l_ac].rtic023,g_xmeg2_d[l_ac].rtic024, g_xmeg2_d[l_ac].rtic025,
   #   g_xmeg2_d[l_ac].rtic026,g_xmeg2_d[l_ac].rtic027, g_xmeg2_d[l_ac].rtic028,
   #   g_xmeg2_d[l_ac].rtic029
   #
   #   IF SQLCA.sqlcode THEN
   #      INITIALIZE g_errparam TO NULL
   #      LET g_errparam.code = SQLCA.sqlcode
   #      LET g_errparam.extend = "FOREACH:"
   #      LET g_errparam.popup = TRUE
   #      CALL cl_err()
   #
   #      EXIT FOREACH
   #   END IF
   #
   #   LET l_ac = l_ac + 1
   #   IF l_ac > g_max_rec THEN
   #      INITIALIZE g_errparam TO NULL
   #      LET g_errparam.code =  9035
   #      LET g_errparam.extend =  ''
   #      LET g_errparam.popup = TRUE
   #      CALL cl_err()
   #
   #      EXIT FOREACH
   #   END IF
   #   
   #END FOREACH
   #CALL g_xmeg2_d.deleteElement(g_xmeg2_d.getLength())
   #170207-00004#2 170219 by 02749 mark---(E)
   
   LET g_sql = "SELECT  UNIQUE rtieseq,rtib003,rtib004,'','',rtieseq1,rtie001,rtie002,'',rtie006 FROM rtie_t", 
               " INNER JOIN rtia_t ON rtiaent = rtieent AND rtiadocno = rtiedocno ",
               " INNER JOIN rtib_t ON rtibent = rtiaent AND rtibdocno = rtiadocno AND rtibseq = rtieseq ",
               " INNER JOIN xmee_t ON xmeeent = rtieent AND xmeedocno = rtia007 ",   #170207-00004#2 170219 by 02749 mod:補ENT條件
               " WHERE rtieent=? AND xmeedocno=?"   
   LET g_sql = g_sql, " ORDER BY rtie_t.rtieseq,rtie_t.rtieseq1"
         
   PREPARE adbt510_pb6 FROM g_sql
   DECLARE b_fill_cs6 CURSOR FOR adbt510_pb6
   
   LET l_ac = 1
   
   OPEN b_fill_cs6 USING g_enterprise,g_xmee_m.xmeedocno
   FOREACH b_fill_cs6 INTO g_xmeg7_d[l_ac].rtieseq,g_xmeg7_d[l_ac].imay0032,g_xmeg7_d[l_ac].imaa0012, 
       g_xmeg7_d[l_ac].imaa0012_desc,g_xmeg7_d[l_ac].imaa0012_desc_desc,g_xmeg7_d[l_ac].rtieseq1, 
       g_xmeg7_d[l_ac].rtie001,g_xmeg7_d[l_ac].rtie002,g_xmeg7_d[l_ac].rtie002_desc,g_xmeg7_d[l_ac].rtie006 

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF
   
      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code =  9035
         LET g_errparam.extend =  ''
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF
      
   END FOREACH
   CALL g_xmeg7_d.deleteElement(g_xmeg7_d.getLength())
   #end add-point
   
   CALL g_xmeg_d.deleteElement(g_xmeg_d.getLength())
   CALL g_xmeg2_d.deleteElement(g_xmeg2_d.getLength())
   CALL g_xmeg3_d.deleteElement(g_xmeg3_d.getLength())
   CALL g_xmeg4_d.deleteElement(g_xmeg4_d.getLength())
   CALL g_xmeg5_d.deleteElement(g_xmeg5_d.getLength())
 
   
 
   LET l_ac = g_cnt
   LET g_cnt = 0  
   
   FREE adbt510_pb
   FREE adbt510_pb2
 
   FREE adbt510_pb3
 
   FREE adbt510_pb4
 
   FREE adbt510_pb5
 
 
   
   LET li_idx = l_ac
   
   #遮罩相關處理
   FOR l_ac = 1 TO g_xmeg_d.getLength()
      LET g_xmeg_d_mask_o[l_ac].* =  g_xmeg_d[l_ac].*
      CALL adbt510_xmeg_t_mask()
      LET g_xmeg_d_mask_n[l_ac].* =  g_xmeg_d[l_ac].*
   END FOR
   
   LET g_xmeg2_d_mask_o.* =  g_xmeg2_d.*
   FOR l_ac = 1 TO g_xmeg2_d.getLength()
      LET g_xmeg2_d_mask_o[l_ac].* =  g_xmeg2_d[l_ac].*
      CALL adbt510_rtic_t_mask()
      LET g_xmeg2_d_mask_n[l_ac].* =  g_xmeg2_d[l_ac].*
   END FOR
   LET g_xmeg3_d_mask_o.* =  g_xmeg3_d.*
   FOR l_ac = 1 TO g_xmeg3_d.getLength()
      LET g_xmeg3_d_mask_o[l_ac].* =  g_xmeg3_d[l_ac].*
      CALL adbt510_xmeh_t_mask()
      LET g_xmeg3_d_mask_n[l_ac].* =  g_xmeg3_d[l_ac].*
   END FOR
   LET g_xmeg4_d_mask_o.* =  g_xmeg4_d.*
   FOR l_ac = 1 TO g_xmeg4_d.getLength()
      LET g_xmeg4_d_mask_o[l_ac].* =  g_xmeg4_d[l_ac].*
      CALL adbt510_xmjb_t_mask()
      LET g_xmeg4_d_mask_n[l_ac].* =  g_xmeg4_d[l_ac].*
   END FOR
   LET g_xmeg5_d_mask_o.* =  g_xmeg5_d.*
   FOR l_ac = 1 TO g_xmeg5_d.getLength()
      LET g_xmeg5_d_mask_o[l_ac].* =  g_xmeg5_d[l_ac].*
      CALL adbt510_xmef_t_mask()
      LET g_xmeg5_d_mask_n[l_ac].* =  g_xmeg5_d[l_ac].*
   END FOR
 
   
   LET l_ac = li_idx
   
   CALL cl_ap_performance_next_end()
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.delete_b" >}
#+ 刪除單身後其他table連動
PRIVATE FUNCTION adbt510_delete_b(ps_table,ps_keys_bak,ps_page)
   #add-point:delete_b段define(客製用) name="delete_b.define_customerization"
   
   #end add-point     
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:delete_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="delete_b.define"
                  
   #end add-point     
   
   #add-point:Function前置處理  name="delete_b.pre_function"
   
   #end add-point
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete"
                                    
      #end add-point    
      DELETE FROM xmeg_t
       WHERE xmegent = g_enterprise AND
         xmegdocno = ps_keys_bak[1] AND xmeg900 = ps_keys_bak[2] AND xmegseq = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete"
                                    
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = ":",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_xmeg_d.deleteElement(li_idx) 
      END IF 
 
   END IF
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete2"
                                    
      #end add-point    
      DELETE FROM rtic_t
       WHERE rticent = g_enterprise AND
             rticdocno = ps_keys_bak[1] AND rticseq = ps_keys_bak[2] AND rticseq1 = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete2"
                                    
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "rtic_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'2'" THEN 
         CALL g_xmeg2_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete2"
                                    
      #end add-point    
   END IF
 
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete3"
                                    
      #end add-point    
      DELETE FROM xmeh_t
       WHERE xmehent = g_enterprise AND
             xmehdocno = ps_keys_bak[1] AND xmeh900 = ps_keys_bak[2] AND xmehseq = ps_keys_bak[3] AND xmehseq1 = ps_keys_bak[4] AND xmehseq2 = ps_keys_bak[5]
      #add-point:delete_b段刪除中 name="delete_b.m_delete3"
                                    
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmeh_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'3'" THEN 
         CALL g_xmeg3_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete3"
                                    
      #end add-point    
   END IF
 
   LET ls_group = "'4',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete4"
      
      #end add-point    
      DELETE FROM xmjb_t
       WHERE xmjbent = g_enterprise AND
             xmjbdocno = ps_keys_bak[1] AND xmjb900 = ps_keys_bak[2] AND xmjbseq = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete4"
      
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmjb_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'4'" THEN 
         CALL g_xmeg4_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete4"
      
      #end add-point    
   END IF
 
   LET ls_group = "'5',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete5"
      
      #end add-point    
      DELETE FROM xmef_t
       WHERE xmefent = g_enterprise AND
             xmefdocno = ps_keys_bak[1] AND xmef900 = ps_keys_bak[2] AND xmef001 = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete5"
      
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmef_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'5'" THEN 
         CALL g_xmeg5_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete5"
      
      #end add-point    
   END IF
 
 
   
 
   
   #add-point:delete_b段other name="delete_b.other"
                  
   #end add-point  
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.insert_b" >}
#+ 新增單身後其他table連動
PRIVATE FUNCTION adbt510_insert_b(ps_table,ps_keys,ps_page)
   #add-point:insert_b段define(客製用) name="insert_b.define_customerization"
   
   #end add-point     
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys     DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE ls_page     STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:insert_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="insert_b.define"
                  
   #end add-point     
   
   #add-point:Function前置處理  name="insert_b.pre_function"
   
   #end add-point
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert"
                                    
      #end add-point 
      INSERT INTO xmeg_t
                  (xmegent,
                   xmegdocno,xmeg900,
                   xmegseq
                   ,xmegsite,xmeg027,xmeg001,xmeg002,xmeg004,xmeg005,xmeg006,xmeg007,xmeg008,xmeg009,xmeg024,xmeg012,xmeg013,xmeg045,xmeg010,xmeg011,xmeg015,xmeg016,xmeg017,xmeg046,xmeg047,xmeg048,xmeg023,xmeg019,xmeg020,xmeg021,xmeg022,xmeg051,xmegunit,xmegorga,xmeg052,xmeg049,xmeg053,xmeg050,xmeg901,xmeg902,xmeg903) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_xmeg_d[g_detail_idx].xmegsite,g_xmeg_d[g_detail_idx].xmeg027,g_xmeg_d[g_detail_idx].xmeg001, 
                       g_xmeg_d[g_detail_idx].xmeg002,g_xmeg_d[g_detail_idx].xmeg004,g_xmeg_d[g_detail_idx].xmeg005, 
                       g_xmeg_d[g_detail_idx].xmeg006,g_xmeg_d[g_detail_idx].xmeg007,g_xmeg_d[g_detail_idx].xmeg008, 
                       g_xmeg_d[g_detail_idx].xmeg009,g_xmeg_d[g_detail_idx].xmeg024,g_xmeg_d[g_detail_idx].xmeg012, 
                       g_xmeg_d[g_detail_idx].xmeg013,g_xmeg_d[g_detail_idx].xmeg045,g_xmeg_d[g_detail_idx].xmeg010, 
                       g_xmeg_d[g_detail_idx].xmeg011,g_xmeg_d[g_detail_idx].xmeg015,g_xmeg_d[g_detail_idx].xmeg016, 
                       g_xmeg_d[g_detail_idx].xmeg017,g_xmeg_d[g_detail_idx].xmeg046,g_xmeg_d[g_detail_idx].xmeg047, 
                       g_xmeg_d[g_detail_idx].xmeg048,g_xmeg_d[g_detail_idx].xmeg023,g_xmeg_d[g_detail_idx].xmeg019, 
                       g_xmeg_d[g_detail_idx].xmeg020,g_xmeg_d[g_detail_idx].xmeg021,g_xmeg_d[g_detail_idx].xmeg022, 
                       g_xmeg_d[g_detail_idx].xmeg051,g_xmeg_d[g_detail_idx].xmegunit,g_xmeg_d[g_detail_idx].xmegorga, 
                       g_xmeg_d[g_detail_idx].xmeg052,g_xmeg_d[g_detail_idx].xmeg049,g_xmeg_d[g_detail_idx].xmeg053, 
                       g_xmeg_d[g_detail_idx].xmeg050,g_xmeg_d[g_detail_idx].xmeg901,g_xmeg_d[g_detail_idx].xmeg902, 
                       g_xmeg_d[g_detail_idx].xmeg903)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert"
                                    
      #end add-point 
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmeg_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_xmeg_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert"
                                    
      #end add-point 
   END IF
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert2"
                                    
      #end add-point 
      INSERT INTO rtic_t
                  (rticent,
                   rticdocno,
                   rticseq,rticseq1
                   ,rtic001,rtic002,rtic003,rtic004,rtic005,rtic006,rtic007,rtic008,rtic009,rtic010,rtic011,rtic012,rtic013,rtic014,rtic015,rtic016,rtic017,rtic018,rtic019,rtic020,rtic021,rtic022,rtic023,rtic024,rtic025,rtic026,rtic027,rtic028,rtic029) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_xmeg2_d[g_detail_idx].rtic001,g_xmeg2_d[g_detail_idx].rtic002,g_xmeg2_d[g_detail_idx].rtic003, 
                       g_xmeg2_d[g_detail_idx].rtic004,g_xmeg2_d[g_detail_idx].rtic005,g_xmeg2_d[g_detail_idx].rtic006, 
                       g_xmeg2_d[g_detail_idx].rtic007,g_xmeg2_d[g_detail_idx].rtic008,g_xmeg2_d[g_detail_idx].rtic009, 
                       g_xmeg2_d[g_detail_idx].rtic010,g_xmeg2_d[g_detail_idx].rtic011,g_xmeg2_d[g_detail_idx].rtic012, 
                       g_xmeg2_d[g_detail_idx].rtic013,g_xmeg2_d[g_detail_idx].rtic014,g_xmeg2_d[g_detail_idx].rtic015, 
                       g_xmeg2_d[g_detail_idx].rtic016,g_xmeg2_d[g_detail_idx].rtic017,g_xmeg2_d[g_detail_idx].rtic018, 
                       g_xmeg2_d[g_detail_idx].rtic019,g_xmeg2_d[g_detail_idx].rtic020,g_xmeg2_d[g_detail_idx].rtic021, 
                       g_xmeg2_d[g_detail_idx].rtic022,g_xmeg2_d[g_detail_idx].rtic023,g_xmeg2_d[g_detail_idx].rtic024, 
                       g_xmeg2_d[g_detail_idx].rtic025,g_xmeg2_d[g_detail_idx].rtic026,g_xmeg2_d[g_detail_idx].rtic027, 
                       g_xmeg2_d[g_detail_idx].rtic028,g_xmeg2_d[g_detail_idx].rtic029)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert2"
                                    
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "rtic_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'2'" THEN 
         CALL g_xmeg2_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert2"
                                    
      #end add-point
   END IF
 
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert3"
                                    
      #end add-point 
      INSERT INTO xmeh_t
                  (xmehent,
                   xmehdocno,xmeh900,
                   xmehseq,xmehseq1,xmehseq2
                   ,xmeh229,xmeh003,xmeh001,xmeh002,xmeh200,xmeh004,xmeh005,xmeh011,xmeh012,xmeh006,xmeh201,xmeh202,xmeh024,xmeh025,xmeh026,xmeh027,xmeh203,xmeh204,xmeh205,xmeh206,xmeh029,xmeh028,xmeh019,xmeh030,xmeh207,xmehunit,xmeh210,xmeh212,xmeh213,xmeh214,xmeh215,xmeh031,xmeh014,xmeh015,xmeh016,xmeh017,xmeh221,xmehsite,xmeh218,xmeh219,xmeh220,xmeh222,xmeh223,xmeh224,xmehorga,xmeh226,xmeh227,xmeh228,xmeh901) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4],ps_keys[5]
                   ,g_xmeg3_d[g_detail_idx].xmeh229,g_xmeg3_d[g_detail_idx].xmeh003,g_xmeg3_d[g_detail_idx].xmeh001, 
                       g_xmeg3_d[g_detail_idx].xmeh002,g_xmeg3_d[g_detail_idx].xmeh200,g_xmeg3_d[g_detail_idx].xmeh004, 
                       g_xmeg3_d[g_detail_idx].xmeh005,g_xmeg3_d[g_detail_idx].xmeh011,g_xmeg3_d[g_detail_idx].xmeh012, 
                       g_xmeg3_d[g_detail_idx].xmeh006,g_xmeg3_d[g_detail_idx].xmeh201,g_xmeg3_d[g_detail_idx].xmeh202, 
                       g_xmeg3_d[g_detail_idx].xmeh024,g_xmeg3_d[g_detail_idx].xmeh025,g_xmeg3_d[g_detail_idx].xmeh026, 
                       g_xmeg3_d[g_detail_idx].xmeh027,g_xmeg3_d[g_detail_idx].xmeh203,g_xmeg3_d[g_detail_idx].xmeh204, 
                       g_xmeg3_d[g_detail_idx].xmeh205,g_xmeg3_d[g_detail_idx].xmeh206,g_xmeg3_d[g_detail_idx].xmeh029, 
                       g_xmeg3_d[g_detail_idx].xmeh028,g_xmeg3_d[g_detail_idx].xmeh019,g_xmeg3_d[g_detail_idx].xmeh030, 
                       g_xmeg3_d[g_detail_idx].xmeh207,g_xmeg3_d[g_detail_idx].xmehunit,g_xmeg3_d[g_detail_idx].xmeh210, 
                       g_xmeg3_d[g_detail_idx].xmeh212,g_xmeg3_d[g_detail_idx].xmeh213,g_xmeg3_d[g_detail_idx].xmeh214, 
                       g_xmeg3_d[g_detail_idx].xmeh215,g_xmeg3_d[g_detail_idx].xmeh031,g_xmeg3_d[g_detail_idx].xmeh014, 
                       g_xmeg3_d[g_detail_idx].xmeh015,g_xmeg3_d[g_detail_idx].xmeh016,g_xmeg3_d[g_detail_idx].xmeh017, 
                       g_xmeg3_d[g_detail_idx].xmeh221,g_xmeg3_d[g_detail_idx].xmehsite,g_xmeg3_d[g_detail_idx].xmeh218, 
                       g_xmeg3_d[g_detail_idx].xmeh219,g_xmeg3_d[g_detail_idx].xmeh220,g_xmeg3_d[g_detail_idx].xmeh222, 
                       g_xmeg3_d[g_detail_idx].xmeh223,g_xmeg3_d[g_detail_idx].xmeh224,g_xmeg3_d[g_detail_idx].xmehorga, 
                       g_xmeg3_d[g_detail_idx].xmeh226,g_xmeg3_d[g_detail_idx].xmeh227,g_xmeg3_d[g_detail_idx].xmeh228, 
                       g_xmeg3_d[g_detail_idx].xmeh901)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert3"
                                    
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmeh_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'3'" THEN 
         CALL g_xmeg3_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert3"
                                    
      #end add-point
   END IF
 
   LET ls_group = "'4',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert4"
      
      #end add-point 
      INSERT INTO xmjb_t
                  (xmjbent,
                   xmjbdocno,xmjb900,
                   xmjbseq
                   ,xmjbunit,xmjbsite,xmjb001,xmjb002,xmjb003,xmjb033,xmjb004,xmjb005,xmjb006,xmjb007,xmjb011,xmjb012,xmjb013,xmjb014,xmjb015,xmjb016,xmjb017,xmjb018,xmjb008,xmjb009,xmjb010,xmjb022,xmjb019,xmjb020,xmjb021,xmjb024,xmjb025,xmjb026,xmjb027,xmjb028,xmjb029,xmjb030,xmjb031,xmjb032,xmjb040,xmjb039,xmjb038,xmjb037,xmjb034,xmjb901,xmjb902,xmjb903) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_xmeg4_d[g_detail_idx].xmjbunit,g_xmeg4_d[g_detail_idx].xmjbsite,g_xmeg4_d[g_detail_idx].xmjb001, 
                       g_xmeg4_d[g_detail_idx].xmjb002,g_xmeg4_d[g_detail_idx].xmjb003,g_xmeg4_d[g_detail_idx].xmjb033, 
                       g_xmeg4_d[g_detail_idx].xmjb004,g_xmeg4_d[g_detail_idx].xmjb005,g_xmeg4_d[g_detail_idx].xmjb006, 
                       g_xmeg4_d[g_detail_idx].xmjb007,g_xmeg4_d[g_detail_idx].xmjb011,g_xmeg4_d[g_detail_idx].xmjb012, 
                       g_xmeg4_d[g_detail_idx].xmjb013,g_xmeg4_d[g_detail_idx].xmjb014,g_xmeg4_d[g_detail_idx].xmjb015, 
                       g_xmeg4_d[g_detail_idx].xmjb016,g_xmeg4_d[g_detail_idx].xmjb017,g_xmeg4_d[g_detail_idx].xmjb018, 
                       g_xmeg4_d[g_detail_idx].xmjb008,g_xmeg4_d[g_detail_idx].xmjb009,g_xmeg4_d[g_detail_idx].xmjb010, 
                       g_xmeg4_d[g_detail_idx].xmjb022,g_xmeg4_d[g_detail_idx].xmjb019,g_xmeg4_d[g_detail_idx].xmjb020, 
                       g_xmeg4_d[g_detail_idx].xmjb021,g_xmeg4_d[g_detail_idx].xmjb024,g_xmeg4_d[g_detail_idx].xmjb025, 
                       g_xmeg4_d[g_detail_idx].xmjb026,g_xmeg4_d[g_detail_idx].xmjb027,g_xmeg4_d[g_detail_idx].xmjb028, 
                       g_xmeg4_d[g_detail_idx].xmjb029,g_xmeg4_d[g_detail_idx].xmjb030,g_xmeg4_d[g_detail_idx].xmjb031, 
                       g_xmeg4_d[g_detail_idx].xmjb032,g_xmeg4_d[g_detail_idx].xmjb040,g_xmeg4_d[g_detail_idx].xmjb039, 
                       g_xmeg4_d[g_detail_idx].xmjb038,g_xmeg4_d[g_detail_idx].xmjb037,g_xmeg4_d[g_detail_idx].xmjb034, 
                       g_xmeg4_d[g_detail_idx].xmjb901,g_xmeg4_d[g_detail_idx].xmjb902,g_xmeg4_d[g_detail_idx].xmjb903) 
 
      #add-point:insert_b段資料新增中 name="insert_b.m_insert4"
      
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmjb_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'4'" THEN 
         CALL g_xmeg4_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert4"
      
      #end add-point
   END IF
 
   LET ls_group = "'5',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert5"
      
      #end add-point 
      INSERT INTO xmef_t
                  (xmefent,
                   xmefdocno,xmef900,
                   xmef001
                   ,xmefsite,xmef002,xmef003,xmef004,xmef005,xmef006,xmef016,xmef017,xmef007,xmef008,xmef009,xmef901,xmef902,xmef903) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_xmeg5_d[g_detail_idx].xmefsite,g_xmeg5_d[g_detail_idx].xmef002,g_xmeg5_d[g_detail_idx].xmef003, 
                       g_xmeg5_d[g_detail_idx].xmef004,g_xmeg5_d[g_detail_idx].xmef005,g_xmeg5_d[g_detail_idx].xmef006, 
                       g_xmeg5_d[g_detail_idx].xmef016,g_xmeg5_d[g_detail_idx].xmef017,g_xmeg5_d[g_detail_idx].xmef007, 
                       g_xmeg5_d[g_detail_idx].xmef008,g_xmeg5_d[g_detail_idx].xmef009,g_xmeg5_d[g_detail_idx].xmef901, 
                       g_xmeg5_d[g_detail_idx].xmef902,g_xmeg5_d[g_detail_idx].xmef903)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert5"
      
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xmef_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'5'" THEN 
         CALL g_xmeg5_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert5"
      
      #end add-point
   END IF
 
 
   
 
   
   #add-point:insert_b段other name="insert_b.other"
                  
   #end add-point     
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.update_b" >}
#+ 修改單身後其他table連動
PRIVATE FUNCTION adbt510_update_b(ps_table,ps_keys,ps_keys_bak,ps_page)
   #add-point:update_b段define(客製用) name="update_b.define_customerization"
   
   #end add-point   
   DEFINE ps_table         STRING
   DEFINE ps_page          STRING
   DEFINE ps_keys          DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_keys_bak      DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group         STRING
   DEFINE li_idx           LIKE type_t.num10 
   DEFINE lb_chk           BOOLEAN
   DEFINE l_new_key        DYNAMIC ARRAY OF STRING
   DEFINE l_old_key        DYNAMIC ARRAY OF STRING
   DEFINE l_field_key      DYNAMIC ARRAY OF STRING
   #add-point:update_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="update_b.define"
                  
   #end add-point   
   
   #add-point:Function前置處理  name="update_b.pre_function"
   
   #end add-point
   
   LET g_update = TRUE   
   
   #判斷key是否有改變
   LET lb_chk = TRUE
   FOR li_idx = 1 TO ps_keys.getLength()
      IF ps_keys[li_idx] <> ps_keys_bak[li_idx] THEN
         LET lb_chk = FALSE
         EXIT FOR
      END IF
   END FOR
   
   #不需要做處理
   IF lb_chk THEN
      RETURN
   END IF
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "xmeg_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update"
                                    
      #end add-point 
      
      #將遮罩欄位還原
      CALL adbt510_xmeg_t_mask_restore('restore_mask_o')
               
      UPDATE xmeg_t 
         SET (xmegdocno,xmeg900,
              xmegseq
              ,xmegsite,xmeg027,xmeg001,xmeg002,xmeg004,xmeg005,xmeg006,xmeg007,xmeg008,xmeg009,xmeg024,xmeg012,xmeg013,xmeg045,xmeg010,xmeg011,xmeg015,xmeg016,xmeg017,xmeg046,xmeg047,xmeg048,xmeg023,xmeg019,xmeg020,xmeg021,xmeg022,xmeg051,xmegunit,xmegorga,xmeg052,xmeg049,xmeg053,xmeg050,xmeg901,xmeg902,xmeg903) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_xmeg_d[g_detail_idx].xmegsite,g_xmeg_d[g_detail_idx].xmeg027,g_xmeg_d[g_detail_idx].xmeg001, 
                  g_xmeg_d[g_detail_idx].xmeg002,g_xmeg_d[g_detail_idx].xmeg004,g_xmeg_d[g_detail_idx].xmeg005, 
                  g_xmeg_d[g_detail_idx].xmeg006,g_xmeg_d[g_detail_idx].xmeg007,g_xmeg_d[g_detail_idx].xmeg008, 
                  g_xmeg_d[g_detail_idx].xmeg009,g_xmeg_d[g_detail_idx].xmeg024,g_xmeg_d[g_detail_idx].xmeg012, 
                  g_xmeg_d[g_detail_idx].xmeg013,g_xmeg_d[g_detail_idx].xmeg045,g_xmeg_d[g_detail_idx].xmeg010, 
                  g_xmeg_d[g_detail_idx].xmeg011,g_xmeg_d[g_detail_idx].xmeg015,g_xmeg_d[g_detail_idx].xmeg016, 
                  g_xmeg_d[g_detail_idx].xmeg017,g_xmeg_d[g_detail_idx].xmeg046,g_xmeg_d[g_detail_idx].xmeg047, 
                  g_xmeg_d[g_detail_idx].xmeg048,g_xmeg_d[g_detail_idx].xmeg023,g_xmeg_d[g_detail_idx].xmeg019, 
                  g_xmeg_d[g_detail_idx].xmeg020,g_xmeg_d[g_detail_idx].xmeg021,g_xmeg_d[g_detail_idx].xmeg022, 
                  g_xmeg_d[g_detail_idx].xmeg051,g_xmeg_d[g_detail_idx].xmegunit,g_xmeg_d[g_detail_idx].xmegorga, 
                  g_xmeg_d[g_detail_idx].xmeg052,g_xmeg_d[g_detail_idx].xmeg049,g_xmeg_d[g_detail_idx].xmeg053, 
                  g_xmeg_d[g_detail_idx].xmeg050,g_xmeg_d[g_detail_idx].xmeg901,g_xmeg_d[g_detail_idx].xmeg902, 
                  g_xmeg_d[g_detail_idx].xmeg903) 
         WHERE xmegent = g_enterprise AND xmegdocno = ps_keys_bak[1] AND xmeg900 = ps_keys_bak[2] AND xmegseq = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update"
                                    
      #end add-point   
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmeg_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmeg_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
 
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL adbt510_xmeg_t_mask_restore('restore_mask_n')
               
      #add-point:update_b段修改後 name="update_b.after_update"
                                    
      #end add-point  
   END IF
   
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
   
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "rtic_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update2"
                                    
      #end add-point  
      
      #將遮罩欄位還原
      CALL adbt510_rtic_t_mask_restore('restore_mask_o')
               
      UPDATE rtic_t 
         SET (rticdocno,
              rticseq,rticseq1
              ,rtic001,rtic002,rtic003,rtic004,rtic005,rtic006,rtic007,rtic008,rtic009,rtic010,rtic011,rtic012,rtic013,rtic014,rtic015,rtic016,rtic017,rtic018,rtic019,rtic020,rtic021,rtic022,rtic023,rtic024,rtic025,rtic026,rtic027,rtic028,rtic029) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_xmeg2_d[g_detail_idx].rtic001,g_xmeg2_d[g_detail_idx].rtic002,g_xmeg2_d[g_detail_idx].rtic003, 
                  g_xmeg2_d[g_detail_idx].rtic004,g_xmeg2_d[g_detail_idx].rtic005,g_xmeg2_d[g_detail_idx].rtic006, 
                  g_xmeg2_d[g_detail_idx].rtic007,g_xmeg2_d[g_detail_idx].rtic008,g_xmeg2_d[g_detail_idx].rtic009, 
                  g_xmeg2_d[g_detail_idx].rtic010,g_xmeg2_d[g_detail_idx].rtic011,g_xmeg2_d[g_detail_idx].rtic012, 
                  g_xmeg2_d[g_detail_idx].rtic013,g_xmeg2_d[g_detail_idx].rtic014,g_xmeg2_d[g_detail_idx].rtic015, 
                  g_xmeg2_d[g_detail_idx].rtic016,g_xmeg2_d[g_detail_idx].rtic017,g_xmeg2_d[g_detail_idx].rtic018, 
                  g_xmeg2_d[g_detail_idx].rtic019,g_xmeg2_d[g_detail_idx].rtic020,g_xmeg2_d[g_detail_idx].rtic021, 
                  g_xmeg2_d[g_detail_idx].rtic022,g_xmeg2_d[g_detail_idx].rtic023,g_xmeg2_d[g_detail_idx].rtic024, 
                  g_xmeg2_d[g_detail_idx].rtic025,g_xmeg2_d[g_detail_idx].rtic026,g_xmeg2_d[g_detail_idx].rtic027, 
                  g_xmeg2_d[g_detail_idx].rtic028,g_xmeg2_d[g_detail_idx].rtic029) 
         WHERE rticent = g_enterprise AND rticdocno = ps_keys_bak[1] AND rticseq = ps_keys_bak[2] AND rticseq1 = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update2"
                                    
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "rtic_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "rtic_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
          
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL adbt510_rtic_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後 name="update_b.after_update2"
                                    
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "xmeh_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update3"
                                    
      #end add-point  
      
      #將遮罩欄位還原
      CALL adbt510_xmeh_t_mask_restore('restore_mask_o')
               
      UPDATE xmeh_t 
         SET (xmehdocno,xmeh900,
              xmehseq,xmehseq1,xmehseq2
              ,xmeh229,xmeh003,xmeh001,xmeh002,xmeh200,xmeh004,xmeh005,xmeh011,xmeh012,xmeh006,xmeh201,xmeh202,xmeh024,xmeh025,xmeh026,xmeh027,xmeh203,xmeh204,xmeh205,xmeh206,xmeh029,xmeh028,xmeh019,xmeh030,xmeh207,xmehunit,xmeh210,xmeh212,xmeh213,xmeh214,xmeh215,xmeh031,xmeh014,xmeh015,xmeh016,xmeh017,xmeh221,xmehsite,xmeh218,xmeh219,xmeh220,xmeh222,xmeh223,xmeh224,xmehorga,xmeh226,xmeh227,xmeh228,xmeh901) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4],ps_keys[5]
              ,g_xmeg3_d[g_detail_idx].xmeh229,g_xmeg3_d[g_detail_idx].xmeh003,g_xmeg3_d[g_detail_idx].xmeh001, 
                  g_xmeg3_d[g_detail_idx].xmeh002,g_xmeg3_d[g_detail_idx].xmeh200,g_xmeg3_d[g_detail_idx].xmeh004, 
                  g_xmeg3_d[g_detail_idx].xmeh005,g_xmeg3_d[g_detail_idx].xmeh011,g_xmeg3_d[g_detail_idx].xmeh012, 
                  g_xmeg3_d[g_detail_idx].xmeh006,g_xmeg3_d[g_detail_idx].xmeh201,g_xmeg3_d[g_detail_idx].xmeh202, 
                  g_xmeg3_d[g_detail_idx].xmeh024,g_xmeg3_d[g_detail_idx].xmeh025,g_xmeg3_d[g_detail_idx].xmeh026, 
                  g_xmeg3_d[g_detail_idx].xmeh027,g_xmeg3_d[g_detail_idx].xmeh203,g_xmeg3_d[g_detail_idx].xmeh204, 
                  g_xmeg3_d[g_detail_idx].xmeh205,g_xmeg3_d[g_detail_idx].xmeh206,g_xmeg3_d[g_detail_idx].xmeh029, 
                  g_xmeg3_d[g_detail_idx].xmeh028,g_xmeg3_d[g_detail_idx].xmeh019,g_xmeg3_d[g_detail_idx].xmeh030, 
                  g_xmeg3_d[g_detail_idx].xmeh207,g_xmeg3_d[g_detail_idx].xmehunit,g_xmeg3_d[g_detail_idx].xmeh210, 
                  g_xmeg3_d[g_detail_idx].xmeh212,g_xmeg3_d[g_detail_idx].xmeh213,g_xmeg3_d[g_detail_idx].xmeh214, 
                  g_xmeg3_d[g_detail_idx].xmeh215,g_xmeg3_d[g_detail_idx].xmeh031,g_xmeg3_d[g_detail_idx].xmeh014, 
                  g_xmeg3_d[g_detail_idx].xmeh015,g_xmeg3_d[g_detail_idx].xmeh016,g_xmeg3_d[g_detail_idx].xmeh017, 
                  g_xmeg3_d[g_detail_idx].xmeh221,g_xmeg3_d[g_detail_idx].xmehsite,g_xmeg3_d[g_detail_idx].xmeh218, 
                  g_xmeg3_d[g_detail_idx].xmeh219,g_xmeg3_d[g_detail_idx].xmeh220,g_xmeg3_d[g_detail_idx].xmeh222, 
                  g_xmeg3_d[g_detail_idx].xmeh223,g_xmeg3_d[g_detail_idx].xmeh224,g_xmeg3_d[g_detail_idx].xmehorga, 
                  g_xmeg3_d[g_detail_idx].xmeh226,g_xmeg3_d[g_detail_idx].xmeh227,g_xmeg3_d[g_detail_idx].xmeh228, 
                  g_xmeg3_d[g_detail_idx].xmeh901) 
         WHERE xmehent = g_enterprise AND xmehdocno = ps_keys_bak[1] AND xmeh900 = ps_keys_bak[2] AND xmehseq = ps_keys_bak[3] AND xmehseq1 = ps_keys_bak[4] AND xmehseq2 = ps_keys_bak[5]
      #add-point:update_b段修改中 name="update_b.m_update3"
                                    
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmeh_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmeh_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
          
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL adbt510_xmeh_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後 name="update_b.after_update3"
                                    
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
   LET ls_group = "'4',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "xmjb_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update4"
      
      #end add-point  
      
      #將遮罩欄位還原
      CALL adbt510_xmjb_t_mask_restore('restore_mask_o')
               
      UPDATE xmjb_t 
         SET (xmjbdocno,xmjb900,
              xmjbseq
              ,xmjbunit,xmjbsite,xmjb001,xmjb002,xmjb003,xmjb033,xmjb004,xmjb005,xmjb006,xmjb007,xmjb011,xmjb012,xmjb013,xmjb014,xmjb015,xmjb016,xmjb017,xmjb018,xmjb008,xmjb009,xmjb010,xmjb022,xmjb019,xmjb020,xmjb021,xmjb024,xmjb025,xmjb026,xmjb027,xmjb028,xmjb029,xmjb030,xmjb031,xmjb032,xmjb040,xmjb039,xmjb038,xmjb037,xmjb034,xmjb901,xmjb902,xmjb903) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_xmeg4_d[g_detail_idx].xmjbunit,g_xmeg4_d[g_detail_idx].xmjbsite,g_xmeg4_d[g_detail_idx].xmjb001, 
                  g_xmeg4_d[g_detail_idx].xmjb002,g_xmeg4_d[g_detail_idx].xmjb003,g_xmeg4_d[g_detail_idx].xmjb033, 
                  g_xmeg4_d[g_detail_idx].xmjb004,g_xmeg4_d[g_detail_idx].xmjb005,g_xmeg4_d[g_detail_idx].xmjb006, 
                  g_xmeg4_d[g_detail_idx].xmjb007,g_xmeg4_d[g_detail_idx].xmjb011,g_xmeg4_d[g_detail_idx].xmjb012, 
                  g_xmeg4_d[g_detail_idx].xmjb013,g_xmeg4_d[g_detail_idx].xmjb014,g_xmeg4_d[g_detail_idx].xmjb015, 
                  g_xmeg4_d[g_detail_idx].xmjb016,g_xmeg4_d[g_detail_idx].xmjb017,g_xmeg4_d[g_detail_idx].xmjb018, 
                  g_xmeg4_d[g_detail_idx].xmjb008,g_xmeg4_d[g_detail_idx].xmjb009,g_xmeg4_d[g_detail_idx].xmjb010, 
                  g_xmeg4_d[g_detail_idx].xmjb022,g_xmeg4_d[g_detail_idx].xmjb019,g_xmeg4_d[g_detail_idx].xmjb020, 
                  g_xmeg4_d[g_detail_idx].xmjb021,g_xmeg4_d[g_detail_idx].xmjb024,g_xmeg4_d[g_detail_idx].xmjb025, 
                  g_xmeg4_d[g_detail_idx].xmjb026,g_xmeg4_d[g_detail_idx].xmjb027,g_xmeg4_d[g_detail_idx].xmjb028, 
                  g_xmeg4_d[g_detail_idx].xmjb029,g_xmeg4_d[g_detail_idx].xmjb030,g_xmeg4_d[g_detail_idx].xmjb031, 
                  g_xmeg4_d[g_detail_idx].xmjb032,g_xmeg4_d[g_detail_idx].xmjb040,g_xmeg4_d[g_detail_idx].xmjb039, 
                  g_xmeg4_d[g_detail_idx].xmjb038,g_xmeg4_d[g_detail_idx].xmjb037,g_xmeg4_d[g_detail_idx].xmjb034, 
                  g_xmeg4_d[g_detail_idx].xmjb901,g_xmeg4_d[g_detail_idx].xmjb902,g_xmeg4_d[g_detail_idx].xmjb903)  
 
         WHERE xmjbent = g_enterprise AND xmjbdocno = ps_keys_bak[1] AND xmjb900 = ps_keys_bak[2] AND xmjbseq = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update4"
      
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmjb_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmjb_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
          
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL adbt510_xmjb_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後 name="update_b.after_update4"
      
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
   LET ls_group = "'5',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "xmef_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update5"
      
      #end add-point  
      
      #將遮罩欄位還原
      CALL adbt510_xmef_t_mask_restore('restore_mask_o')
               
      UPDATE xmef_t 
         SET (xmefdocno,xmef900,
              xmef001
              ,xmefsite,xmef002,xmef003,xmef004,xmef005,xmef006,xmef016,xmef017,xmef007,xmef008,xmef009,xmef901,xmef902,xmef903) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_xmeg5_d[g_detail_idx].xmefsite,g_xmeg5_d[g_detail_idx].xmef002,g_xmeg5_d[g_detail_idx].xmef003, 
                  g_xmeg5_d[g_detail_idx].xmef004,g_xmeg5_d[g_detail_idx].xmef005,g_xmeg5_d[g_detail_idx].xmef006, 
                  g_xmeg5_d[g_detail_idx].xmef016,g_xmeg5_d[g_detail_idx].xmef017,g_xmeg5_d[g_detail_idx].xmef007, 
                  g_xmeg5_d[g_detail_idx].xmef008,g_xmeg5_d[g_detail_idx].xmef009,g_xmeg5_d[g_detail_idx].xmef901, 
                  g_xmeg5_d[g_detail_idx].xmef902,g_xmeg5_d[g_detail_idx].xmef903) 
         WHERE xmefent = g_enterprise AND xmefdocno = ps_keys_bak[1] AND xmef900 = ps_keys_bak[2] AND xmef001 = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update5"
      
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmef_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xmef_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
          
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL adbt510_xmef_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後 name="update_b.after_update5"
      
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
 
   
 
   
   #add-point:update_b段other name="update_b.other"
                  
   #end add-point  
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.key_update_b" >}
#+ 上層單身key欄位變動後, 連帶修正下層單身key欄位
PRIVATE FUNCTION adbt510_key_update_b(ps_keys_bak,ps_table)
   #add-point:update_b段define(客製用) name="key_update_b.define_customerization"
   
   #end add-point
   DEFINE ps_keys_bak       DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table          STRING
   DEFINE l_field_key       DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak    DYNAMIC ARRAY OF STRING
   DEFINE l_new_key         DYNAMIC ARRAY OF STRING
   DEFINE l_old_key         DYNAMIC ARRAY OF STRING
   #add-point:update_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="key_update_b.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="key_update_b.pre_function"
   
   #end add-point
   
 
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.key_delete_b" >}
#+ 上層單身刪除後, 連帶刪除下層單身key欄位
PRIVATE FUNCTION adbt510_key_delete_b(ps_keys_bak,ps_table)
   #add-point:delete_b段define(客製用) name="key_delete_b.define_customerization"
   
   #end add-point
   DEFINE ps_keys_bak       DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table          STRING
   DEFINE l_field_keys      DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak    DYNAMIC ARRAY OF STRING
   DEFINE l_new_key         DYNAMIC ARRAY OF STRING
   DEFINE l_old_key         DYNAMIC ARRAY OF STRING
   #add-point:delete_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="key_delete_b.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="key_delete_b.pre_function"
   
   #end add-point
   
 
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.lock_b" >}
#+ 連動lock其他單身table資料
PRIVATE FUNCTION adbt510_lock_b(ps_table,ps_page)
   #add-point:lock_b段define(客製用) name="lock_b.define_customerization"
   
   #end add-point   
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:lock_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="lock_b.define"
                  
   #end add-point   
   
   #add-point:Function前置處理  name="lock_b.pre_function"
   
   #end add-point
    
   #先刷新資料
   #CALL adbt510_b_fill()
   
   #鎖定整組table
   #LET ls_group = "'1',"
   #僅鎖定自身table
   LET ls_group = "xmeg_t"
   
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN adbt510_bcl USING g_enterprise,
                                       g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg_d[g_detail_idx].xmegseq  
                                               
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "adbt510_bcl:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
                                    
   #鎖定整組table
   #LET ls_group = "'2',"
   #僅鎖定自身table
   LET ls_group = "rtic_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN adbt510_bcl2 USING g_enterprise,
                                             g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg2_d[g_detail_idx].rticseq, 
                                                 g_xmeg2_d[g_detail_idx].rticseq1
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "adbt510_bcl2:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
   #鎖定整組table
   #LET ls_group = "'3',"
   #僅鎖定自身table
   LET ls_group = "xmeh_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN adbt510_bcl3 USING g_enterprise,
                                             g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg3_d[g_detail_idx].xmehseq, 
                                                 g_xmeg3_d[g_detail_idx].xmehseq1,g_xmeg3_d[g_detail_idx].xmehseq2 
 
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "adbt510_bcl3:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
   #鎖定整組table
   #LET ls_group = "'4',"
   #僅鎖定自身table
   LET ls_group = "xmjb_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN adbt510_bcl4 USING g_enterprise,
                                             g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg4_d[g_detail_idx].xmjbseq 
 
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "adbt510_bcl4:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
   #鎖定整組table
   #LET ls_group = "'5',"
   #僅鎖定自身table
   LET ls_group = "xmef_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN adbt510_bcl5 USING g_enterprise,
                                             g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg5_d[g_detail_idx].xmef001 
 
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "adbt510_bcl5:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
 
   
 
   
   #add-point:lock_b段other name="lock_b.other"
                  
   #end add-point  
   
   RETURN TRUE
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.unlock_b" >}
#+ 連動unlock其他單身table資料
PRIVATE FUNCTION adbt510_unlock_b(ps_table,ps_page)
   #add-point:unlock_b段define(客製用) name="unlock_b.define_customerization"
   
   #end add-point  
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:unlock_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="unlock_b.define"
                  
   #end add-point  
   
   #add-point:Function前置處理  name="unlock_b.pre_function"
   
   #end add-point
    
   LET ls_group = "'1',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE adbt510_bcl
   END IF
   
   LET ls_group = "'2',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE adbt510_bcl2
   END IF
 
   LET ls_group = "'3',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE adbt510_bcl3
   END IF
 
   LET ls_group = "'4',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE adbt510_bcl4
   END IF
 
   LET ls_group = "'5',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE adbt510_bcl5
   END IF
 
 
   
 
 
   #add-point:unlock_b段other name="unlock_b.other"
                  
   #end add-point  
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_entry" >}
#+ 單頭欄位開啟設定
PRIVATE FUNCTION adbt510_set_entry(p_cmd)
   #add-point:set_entry段define(客製用) name="set_entry.define_customerization"
   
   #end add-point       
   DEFINE p_cmd   LIKE type_t.chr1  
   #add-point:set_entry段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_entry.define"
                  
   #end add-point       
   
   #add-point:Function前置處理  name="set_entry.pre_function"
   
   #end add-point
   
   CALL cl_set_comp_entry("xmeedocno",TRUE)
   
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("xmeedocno,xmee900",TRUE)
      CALL cl_set_comp_entry("xmeedocdt",TRUE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,TRUE)
      END IF
      #add-point:set_entry段欄位控制 name="set_entry.field_control"
      CALL cl_set_comp_entry("xmeedocdt",TRUE)
      CALL cl_set_comp_entry("xmeesite",TRUE)
      #end add-point  
   END IF
   
   #add-point:set_entry段欄位控制後 name="set_entry.after_control"
   CALL cl_set_comp_entry("xmee039",TRUE)
   #CALL cl_set_comp_entry("xmeg015,xmegunit,xmegorga",TRUE)
   
   CALL cl_set_comp_entry("xmee200,xmee201,xmee021,xmee022,xmee203,xmeeunit",TRUE)
   CALL cl_set_comp_required("xmee200,xmee021,xmee203",TRUE)
   CALL cl_set_comp_entry("xmee208,xmee209,xmee210,xmee211",TRUE)
   #end add-point 
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_no_entry" >}
#+ 單頭欄位關閉設定
PRIVATE FUNCTION adbt510_set_no_entry(p_cmd)
   #add-point:set_no_entry段define(客製用) name="set_no_entry.define_customerization"
   
   #end add-point     
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_no_entry.define"
   DEFINE l_pmam003   LIKE pmam_t.pmam003
   DEFINE l_cnt       LIKE type_t.num5
   DEFINE l_i         LIKE type_t.num5
   #end add-point     
   
   #add-point:Function前置處理  name="set_no_entry.pre_function"
   
   #end add-point
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("xmeedocno,xmee900",FALSE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,FALSE)
      END IF
      #add-point:set_no_entry段欄位控制 name="set_no_entry.field_control"
      CALL cl_set_comp_entry("xmeedocdt",FALSE)
      CALL cl_set_comp_entry("xmeesite",FALSE)                                    
      #end add-point 
   END IF 
   
   IF p_cmd = 'u' THEN  #docno,ld欄位確認是絕對關閉
      CALL cl_set_comp_entry("xmeedocno",FALSE)
   END IF 
 
#  IF p_cmd = 'u' THEN  #docdt欄位依照設定關閉(FALSE則為設定不同意修正) #(ver:78)
      IF NOT cl_chk_update_docdt() THEN
         CALL cl_set_comp_entry("xmeedocdt",FALSE)
      END IF
#  END IF 
   
   #add-point:set_no_entry段欄位控制後 name="set_no_entry.after_control"
   CALL cl_set_comp_entry("xmee900",FALSE)
   IF NOT s_aooi500_comp_entry(g_prog,'xmeesite') OR g_flag2 THEN
      CALL cl_set_comp_entry("xmeesite",FALSE)
   END IF
   
   IF NOT g_flag1 THEN
      CALL cl_set_comp_entry("xmee039",FALSE)
   END IF
      
   IF g_xmee_m.xmee005 <> '6' THEN
      CALL cl_set_comp_entry("xmee200",FALSE)
   ELSE
      CALL cl_set_comp_entry("xmee201",FALSE)
   END IF
   IF s_adbt510_xmdl003_exist(g_xmee_m.xmeedocno) OR adbt510_xmef008_exist() THEN
      CALL cl_set_comp_entry("xmee200,xmee201,xmee021,xmee022,xmrr203",FALSE)
      CALL cl_set_comp_required("xmee200,xmee021,xmee203",FALSE)
   END IF
   IF s_adbt510_xmdl003_exist(g_xmee_m.xmeedocno) THEN
      CALL cl_set_comp_entry("xmeeunit",FALSE)
   END IF
   #單身有資料
#   LET l_cnt = 0
#   SELECT COUNT(*) INTO l_cnt
#     FROM xmjb_t
#    WHERE xmjbent = g_enterprise
#      AND xmjbdocno = g_xmee_m.xmeedocno
#      AND xmjb900 = g_xmee_m.xmee900
#   IF l_cnt > 0 THEN
   IF g_xmeg4_d.getLength() > 0 THEN
      CALL cl_set_comp_entry("xmee022",FALSE)
   END IF
   #限定庫位
#   LET l_cnt = 0
#   SELECT COUNT(*) INTO l_cnt
#     FROM xmeh_t
#    WHERE xmehent = g_enterprise
#      AND xmehdocno = g_xmee_m.xmeedocno
#      AND xmeh900 = g_xmee_m.xmee900
#      AND xmeh213 IS NOT NULL
#      AND xmeh213 <> ' '
   LET l_cnt = 0
   FOR l_i = 1 TO g_xmeg3_d.getLength()
      IF NOT cl_null(g_xmeg3_d[l_i].xmeh213) THEN
         LET l_cnt = l_cnt + 1
      END IF
   END FOR
   IF l_cnt > 0 THEN
      CALL cl_set_comp_entry("xmee208,xmee209,xmee210,xmee211",FALSE)
   END IF
   #end add-point 
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_entry_b" >}
#+ 單身欄位開啟設定
PRIVATE FUNCTION adbt510_set_entry_b(p_cmd)
   #add-point:set_entry_b段define(客製用) name="set_entry_b.define_customerization"
   
   #end add-point     
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_entry_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_entry_b.define"
                  
   #end add-point     
   
   #add-point:Function前置處理  name="set_entry_b.pre_function"
   
   #end add-point
    
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("",TRUE)
      #add-point:set_entry段欄位控制 name="set_entry_b.field_control"
      
      #end add-point  
   END IF
   
   #add-point:set_entry_b段 name="set_entry_b.set_entry_b"
   #CALL cl_set_comp_entry("xmehseq",TRUE)
   CALL cl_set_comp_entry("xmef001,xmef002,xmef003,xmef004,xmef005,xmef006",TRUE)
   CALL cl_set_comp_entry("xmjb024,xmjb026,xmjb030,xmjb031,xmjb032",TRUE)
   #end add-point  
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_no_entry_b" >}
#+ 單身欄位關閉設定
PRIVATE FUNCTION adbt510_set_no_entry_b(p_cmd)
   #add-point:set_no_entry_b段define(客製用) name="set_no_entry_b.define_customerization"
   
   #end add-point    
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_no_entry_b.define"
   DEFINE l_pmaa002   LIKE pmaa_t.pmaa002    
   DEFINE l_xmja030   LIKE xmja_t.xmja030   
   #end add-point    
   
   #add-point:Function前置處理  name="set_no_entry_b.pre_function"
   
   #end add-point
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("",FALSE)
      #add-point:set_no_entry_b段欄位控制 name="set_no_entry_b.field_control"
      
      #end add-point 
   END IF 
   
   #add-point:set_no_entry_b段 name="set_no_entry_b.set_no_entry_b"
   CALL cl_set_comp_entry("xmef001",FALSE)
   IF (NOT cl_null(g_xmeg5_d_t.xmef007)) AND (g_xmeg5_d_t.xmef008> 0 OR g_xmeg5_d_t.xmef009 > 0)  OR  NOT g_flag1 THEN
      CALL cl_set_comp_entry("xmef001,xmef002,xmef003,xmef004,xmef005,xmef006",FALSE)
   END IF

   IF l_ac > 0 THEN   
      SELECT xmja030 INTO l_xmja030
        FROM xmja_t
       WHERE xmjaent = g_enterprise
         AND xmjadocno = g_xmee_m.xmeedocno
         AND xmjaseq = g_xmeg4_d[l_ac].xmjbseq
      IF l_xmja030 = 'Y' THEN
         CALL cl_set_comp_entry("xmjb030",FALSE)
      END IF
      IF g_xmeg4_d[l_ac].xmjb030 = "Y" THEN
         CALL cl_set_comp_entry("xmjb031,xmjb032",FALSE)
      END IF
   END IF   
   SELECT pmaa002
     INTO l_pmaa002
     FROM pmaa_t
    WHERE pmaaent = g_enterprise
      AND pmaa001 = g_xmee_m.xmee004
   #160513-00027#1 20160520 mark by beckxie---S
   #IF l_pmaa002 = '2' THEN
   #   CALL cl_set_comp_visible("xmjb024,xmjb024_desc",TRUE) 
   #ELSE
   #   IF l_ac > 0 THEN
   #      LET g_xmeg4_d[l_ac].xmjb024 = NULL
   #      DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb024
   #   END IF
   #   CALL cl_set_comp_entry("xmjb024",FALSE)
   #   CALL cl_set_comp_visible("xmjb024,xmjb024_desc",FALSE) 
   #END IF 
   #160513-00027#1 20160520 mark by beckxie---E
   IF s_adbt510_xmdl003_exist(g_xmee_m.xmeedocno) THEN
      CALL cl_set_comp_entry("xmjb026",FALSE)
   END IF
   #end add-point     
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_act_visible" >}
#+ 單頭權限開啟
PRIVATE FUNCTION adbt510_set_act_visible()
   #add-point:set_act_visible段define(客製用) name="set_act_visible.define_customerization"
   
   #end add-point   
   #add-point:set_act_visible段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_visible.define"
   
   #end add-point   
   #add-point:set_act_visible段 name="set_act_visible.set_act_visible"
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_act_no_visible" >}
#+ 單頭權限關閉
PRIVATE FUNCTION adbt510_set_act_no_visible()
   #add-point:set_act_no_visible段define(客製用) name="set_act_no_visible.define_customerization"
   
   #end add-point   
   #add-point:set_act_no_visible段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_no_visible.define"
   
   #end add-point   
   #add-point:set_act_no_visible段 name="set_act_no_visible.set_act_no_visible"
   #應用 a63 樣板自動產生(Version:1)
   IF g_xmee_m.xmeestus NOT MATCHES "[NDR]" THEN   # N未確認/D抽單/R已拒絕允許修改
      CALL cl_set_act_visible("modify,delete,modify_detail", FALSE)
   END IF


   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_act_visible_b" >}
#+ 單身權限開啟
PRIVATE FUNCTION adbt510_set_act_visible_b()
   #add-point:set_act_visible_b段define(客製用) name="set_act_visible_b.define_customerization"
   
   #end add-point   
   #add-point:set_act_visible_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_visible_b.define"
   
   #end add-point   
   #add-point:set_act_visible_b段 name="set_act_visible_b.set_act_visible_b"
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.set_act_no_visible_b" >}
#+ 單身權限關閉
PRIVATE FUNCTION adbt510_set_act_no_visible_b()
   #add-point:set_act_no_visible_b段define(客製用) name="set_act_no_visible_b.define_customerization"
   
   #end add-point   
   #add-point:set_act_no_visible_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_no_visible_b.define"
   
   #end add-point   
   #add-point:set_act_no_visible_b段 name="set_act_no_visible_b.set_act_no_visible_b"
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.default_search" >}
#+ 外部參數搜尋
PRIVATE FUNCTION adbt510_default_search()
   #add-point:default_search段define(客製用) name="default_search.define_customerization"
   
   #end add-point  
   DEFINE li_idx     LIKE type_t.num10
   DEFINE li_cnt     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE ls_where   STRING
   #add-point:default_search段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="default_search.define"
                  
   #end add-point  
   
   #add-point:Function前置處理 name="default_search.before"
                  
   #end add-point  
   
   LET g_pagestart = 1
   
   IF cl_null(g_order) THEN
      LET g_order = "ASC"
   END IF
   
   IF NOT cl_null(g_argv[01]) THEN
      LET ls_wc = ls_wc, " xmeedocno = '", g_argv[01], "' AND "
   END IF
   
   IF NOT cl_null(g_argv[02]) THEN
      LET ls_wc = ls_wc, " xmee900 = '", g_argv[02], "' AND "
   END IF
 
   
   #add-point:default_search段after sql name="default_search.after_sql"
   
   #end add-point  
   
   IF NOT cl_null(ls_wc) THEN
      LET g_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_default = TRUE
   ELSE
      #若無外部參數則預設為1=2
      LET g_default = FALSE
      
      #預設查詢條件
      CALL cl_qbe_get_default_qryplan() RETURNING ls_where
      IF NOT cl_null(ls_where) THEN
         CALL util.JSON.parse(ls_where, la_wc)
         INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
         INITIALIZE g_wc2_table2 TO NULL
 
         INITIALIZE g_wc2_table3 TO NULL
 
         INITIALIZE g_wc2_table4 TO NULL
 
         INITIALIZE g_wc2_table5 TO NULL
 
 
         FOR li_idx = 1 TO la_wc.getLength()
            CASE
               WHEN la_wc[li_idx].tableid = "xmee_t" 
                  LET g_wc = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "xmeg_t" 
                  LET g_wc2_table1 = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "rtic_t" 
                  LET g_wc2_table2 = la_wc[li_idx].wc
 
               WHEN la_wc[li_idx].tableid = "xmeh_t" 
                  LET g_wc2_table3 = la_wc[li_idx].wc
 
               WHEN la_wc[li_idx].tableid = "xmjb_t" 
                  LET g_wc2_table4 = la_wc[li_idx].wc
 
               WHEN la_wc[li_idx].tableid = "xmef_t" 
                  LET g_wc2_table5 = la_wc[li_idx].wc
 
 
               WHEN la_wc[li_idx].tableid = "EXTENDWC"
                  LET g_wc2_extend = la_wc[li_idx].wc
            END CASE
         END FOR
         IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
            OR NOT cl_null(g_wc2_table2)
 
            OR NOT cl_null(g_wc2_table3)
 
            OR NOT cl_null(g_wc2_table4)
 
            OR NOT cl_null(g_wc2_table5)
 
 
            OR NOT cl_null(g_wc2_extend)
            THEN
            #組合g_wc2
            IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
               LET g_wc2 = g_wc2_table1
            END IF
            IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
            END IF
 
            IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
            END IF
 
            IF g_wc2_table4 <> " 1=1" AND NOT cl_null(g_wc2_table4) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table4
            END IF
 
            IF g_wc2_table5 <> " 1=1" AND NOT cl_null(g_wc2_table5) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table5
            END IF
 
 
            IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
            END IF
         
            IF g_wc2.subString(1,5) = " AND " THEN
               LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
            END IF
         END IF
      END IF
    
      IF cl_null(g_wc) AND cl_null(g_wc2) THEN
         LET g_wc = " 1=2"
      END IF
   END IF
   
   #add-point:default_search段結束前 name="default_search.after"
                  
   #end add-point  
 
   IF g_wc.getIndexOf(" 1=2", 1) THEN
      LET g_default = TRUE
   END IF
 
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.state_change" >}
   #應用 a09 樣板自動產生(Version:17)
#+ 確認碼變更 
PRIVATE FUNCTION adbt510_statechange()
   #add-point:statechange段define(客製用) name="statechange.define_customerization"
   
   #end add-point  
   DEFINE lc_state LIKE type_t.chr5
   #add-point:statechange段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="statechange.define"
                     DEFINE l_success  LIKE type_t.num5
   #end add-point  
   
   #add-point:Function前置處理 name="statechange.before"
   CALL s_axmt510_drop_temp()     #160505-00018#2 160510 by 02749 add
   CALL s_axmt510_create_temp()   #160505-00018#2 160510 by 02749 add
   
   IF g_xmee_m.xmeestus MATCHES '[XY]' THEN
      RETURN
   END IF       
   #end add-point  
   
   ERROR ""     #清空畫面右下側ERROR區塊
 
   IF g_xmee_m.xmeedocno IS NULL
      OR g_xmee_m.xmee900 IS NULL
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   CALL s_transaction_begin()
   
   OPEN adbt510_cl USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900
   IF STATUS THEN
      CLOSE adbt510_cl
      CALL s_transaction_end('N','0')
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN adbt510_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #顯示最新的資料
   EXECUTE adbt510_master_referesh USING g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmee_m.xmeesite, 
       g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202, 
       g_xmee_m.xmee023,g_xmee_m.xmee004,g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005, 
       g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
       g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
       g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee204,g_xmee_m.xmee205, 
       g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026, 
       g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049, 
       g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
       g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,g_xmee_m.xmeecrtid, 
       g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017, 
       g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028,g_xmee_m.xmeesite_desc,g_xmee_m.xmee202_desc, 
       g_xmee_m.xmee023_desc,g_xmee_m.xmee004_desc,g_xmee_m.xmee200_desc,g_xmee_m.xmee201_desc,g_xmee_m.xmee024_desc, 
       g_xmee_m.xmee002_desc,g_xmee_m.xmee003_desc,g_xmee_m.xmee021_desc,g_xmee_m.xmee022_desc,g_xmee_m.xmee203_desc, 
       g_xmee_m.xmee027_desc,g_xmee_m.xmee211_desc,g_xmee_m.xmee210_desc,g_xmee_m.xmee209_desc,g_xmee_m.xmee208_desc, 
       g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204_desc,g_xmee_m.xmee032_desc,g_xmee_m.xmee903_desc,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207_desc,g_xmee_m.xmee020_desc,g_xmee_m.xmee036_desc,g_xmee_m.xmee009_desc,g_xmee_m.xmee010_desc, 
       g_xmee_m.xmee015_desc,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid_desc, 
       g_xmee_m.xmeecrtdp_desc,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeecnfid_desc,g_xmee_m.xmee034_desc, 
       g_xmee_m.xmee017_desc,g_xmee_m.xmee018_desc
   
 
   #檢查是否允許此動作
   IF NOT adbt510_action_chk() THEN
      CLOSE adbt510_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #將資料顯示到畫面上
   DISPLAY BY NAME g_xmee_m.xmeesite,g_xmee_m.xmeesite_desc,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900, 
       g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202,g_xmee_m.xmee202_desc,g_xmee_m.xmee023,g_xmee_m.xmee023_desc, 
       g_xmee_m.xmee004,g_xmee_m.xmee004_desc,g_xmee_m.xmee200,g_xmee_m.xmee200_desc,g_xmee_m.xmee201, 
       g_xmee_m.xmee201_desc,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt, 
       g_xmee_m.xmee024,g_xmee_m.xmee024_desc,g_xmee_m.xmee002,g_xmee_m.xmee002_desc,g_xmee_m.xmee003, 
       g_xmee_m.xmee003_desc,g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee021_desc,g_xmee_m.xmee022, 
       g_xmee_m.xmee022_desc,g_xmee_m.xmee203,g_xmee_m.xmee203_desc,g_xmee_m.xmee027,g_xmee_m.xmee027_desc, 
       g_xmee_m.xmee211,g_xmee_m.xmee211_desc,g_xmee_m.xmee210,g_xmee_m.xmee210_desc,g_xmee_m.xmee209, 
       g_xmee_m.xmee209_desc,g_xmee_m.xmee208,g_xmee_m.xmee208_desc,g_xmee_m.xmeeunit,g_xmee_m.xmeeunit_desc, 
       g_xmee_m.xmee204,g_xmee_m.xmee204_desc,g_xmee_m.xmee205,g_xmee_m.xmee032,g_xmee_m.xmee032_desc, 
       g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee903_desc,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee025_desc, 
       g_xmee_m.oofb017,g_xmee_m.xmee026,g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1,g_xmee_m.xmee206,g_xmee_m.xmee206_desc, 
       g_xmee_m.xmee207,g_xmee_m.xmee207_desc,g_xmee_m.xmee020,g_xmee_m.xmee020_desc,g_xmee_m.xmee036, 
       g_xmee_m.xmee036_desc,g_xmee_m.xmee048,g_xmee_m.xmee049,g_xmee_m.xmee009,g_xmee_m.xmee009_desc, 
       g_xmee_m.xmee010,g_xmee_m.xmee010_desc,g_xmee_m.xmee015,g_xmee_m.xmee015_desc,g_xmee_m.xmee016, 
       g_xmee_m.xmee011,g_xmee_m.xmee011_desc,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee035_desc, 
       g_xmee_m.isaf011,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp, 
       g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtid_desc,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdp_desc, 
       g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfid_desc,g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee034_desc,g_xmee_m.xmee041, 
       g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017,g_xmee_m.xmee017_desc,g_xmee_m.xmee043,g_xmee_m.xmee018, 
       g_xmee_m.xmee018_desc,g_xmee_m.xmee019,g_xmee_m.xmee028
 
   CASE g_xmee_m.xmeestus
      WHEN "N"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
      WHEN "Y"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
      WHEN "A"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
      WHEN "D"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
      WHEN "R"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
      WHEN "W"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
      WHEN "X"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
      
   END CASE
 
   #add-point:資料刷新後 name="statechange.after_refresh"
   
   #end add-point
 
   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_xmee_m.xmeestus
            
            WHEN "N"
               HIDE OPTION "unconfirmed"
            WHEN "Y"
               HIDE OPTION "confirmed"
            WHEN "A"
               HIDE OPTION "approved"
            WHEN "D"
               HIDE OPTION "withdraw"
            WHEN "R"
               HIDE OPTION "rejection"
            WHEN "W"
               HIDE OPTION "signing"
            WHEN "X"
               HIDE OPTION "invalid"
         END CASE
     
      #add-point:menu前 name="statechange.before_menu"
      CALL cl_set_act_visible("signing,withdraw,closed",FALSE)
      #將open改為unconfirmed
      CALL cl_set_act_visible("unconfirmed,invalid,confirmed",TRUE)
      CASE g_xmee_m.xmeestus
         WHEN "N"
            CALL cl_set_act_visible("unconfirmed,hold",FALSE)
            #需提交至BPM時，則顯示「提交」功能並隱藏「確認」功能
            IF cl_bpm_chk() THEN
                CALL cl_set_act_visible("signing",TRUE)
                CALL cl_set_act_visible("confirmed",FALSE)
            END IF
         WHEN "R"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
            CALL cl_set_act_visible("confirmed,unconfirmed,hold",FALSE)
            
         WHEN "D"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
            CALL cl_set_act_visible("confirmed,unconfirmed,hold",FALSE) 

         WHEN "X"
            CALL cl_set_act_visible("unconfirmed,invalid,confirmed,hold",FALSE)
            CALL s_transaction_end('N','0')   #160816-00068#2 add
            RETURN
         WHEN "Y"
            CALL cl_set_act_visible("invalid,confirmed,hold",FALSE)
            
         WHEN "W"    #只能顯示抽單;其餘應用功能皆隱藏
             CALL cl_set_act_visible("withdraw",TRUE)  
             CALL cl_set_act_visible("unconfirmed,invalid,confirmed,hold",FALSE)
         
         WHEN "A"     #只能顯示確認; 其餘應用功能皆隱藏
             CALL cl_set_act_visible("confirmed ",TRUE)  
             CALL cl_set_act_visible("unconfirmed,invalid,hold",FALSE)

      END CASE
      #end add-point
      
      #應用 a36 樣板自動產生(Version:5)
      #提交
      ON ACTION signing
         IF cl_auth_chk_act("signing") THEN
            IF NOT adbt510_send() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE adbt510_cl
            RETURN
         END IF
    
      #抽單
      ON ACTION withdraw
         IF cl_auth_chk_act("withdraw") THEN
            IF NOT adbt510_draw_out() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE adbt510_cl
            RETURN
         END IF
 
 
 
	  
      ON ACTION unconfirmed
         IF cl_auth_chk_act("unconfirmed") THEN
            LET lc_state = "N"
            #add-point:action控制 name="statechange.unconfirmed"
            
            #end add-point
         END IF
         EXIT MENU
      ON ACTION confirmed
         IF cl_auth_chk_act("confirmed") THEN
            LET lc_state = "Y"
            #add-point:action控制 name="statechange.confirmed"
                                                      
            #end add-point
         END IF
         EXIT MENU
      ON ACTION approved
         IF cl_auth_chk_act("approved") THEN
            LET lc_state = "A"
            #add-point:action控制 name="statechange.approved"
            
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION withdraw
      #   IF cl_auth_chk_act("withdraw") THEN
      #      LET lc_state = "D"
      #      #add-point:action控制 name="statechange.withdraw"
      #      
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION rejection
         IF cl_auth_chk_act("rejection") THEN
            LET lc_state = "R"
            #add-point:action控制 name="statechange.rejection"
            
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION signing
      #   IF cl_auth_chk_act("signing") THEN
      #      LET lc_state = "W"
      #      #add-point:action控制 name="statechange.signing"
      #      
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION invalid
         IF cl_auth_chk_act("invalid") THEN
            LET lc_state = "X"
            #add-point:action控制 name="statechange.invalid"
                                                      
            #end add-point
         END IF
         EXIT MENU
 
      #add-point:stus控制 name="statechange.more_control"
                                    
      #end add-point
      
   END MENU
   
   #確認被選取的狀態碼在清單中
   IF (lc_state <> "N" 
      AND lc_state <> "Y"
      AND lc_state <> "A"
      AND lc_state <> "D"
      AND lc_state <> "R"
      AND lc_state <> "W"
      AND lc_state <> "X"
      ) OR 
      g_xmee_m.xmeestus = lc_state OR cl_null(lc_state) THEN
      CLOSE adbt510_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #add-point:stus修改前 name="statechange.b_update"
   CALL s_transaction_begin()
   IF lc_state = 'Y' THEN
      CALL s_adbt510_conf_chk(g_xmee_m.xmeedocno,g_xmee_m.xmee900) RETURNING l_success
      IF NOT l_success THEN
         CALL s_transaction_end('N','0')   #160816-00068#2 add
         RETURN
      ELSE
         IF NOT cl_ask_confirm('aim-00108') THEN
            CALL s_transaction_end('N','0')   #160816-00068#2 add
            RETURN
         ELSE
            CALL s_adbt510_conf_upd(g_xmee_m.xmeedocno,g_xmee_m.xmee900) RETURNING l_success
            IF NOT l_success THEN
               CALL s_transaction_end('N','0')
               RETURN
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
         END IF
      END IF
   END IF
   IF lc_state = 'X' THEN
      CALL s_adbt510_invalid_chk(g_xmee_m.xmeedocno,g_xmee_m.xmee900) RETURNING l_success
      IF NOT l_success THEN
         CALL s_transaction_end('N','0')   #160816-00068#2 add
         RETURN
      ELSE
         IF NOT cl_ask_confirm('aim-00109') THEN
            CALL s_transaction_end('N','0')   #160816-00068#2 add
            RETURN
         ELSE
            CALL s_adbt510_invalid_upd(g_xmee_m.xmeedocno,g_xmee_m.xmee900) RETURNING l_success
            IF NOT l_success THEN
               CALL s_transaction_end('N','0')
               RETURN
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
         END IF
      END IF
   END IF
   #end add-point
   
   LET g_xmee_m.xmeemodid = g_user
   LET g_xmee_m.xmeemoddt = cl_get_current()
   LET g_xmee_m.xmeestus = lc_state
   
   #異動狀態碼欄位/修改人/修改日期
   UPDATE xmee_t 
      SET (xmeestus,xmeemodid,xmeemoddt) 
        = (g_xmee_m.xmeestus,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt)     
    WHERE xmeeent = g_enterprise AND xmeedocno = g_xmee_m.xmeedocno
      AND xmee900 = g_xmee_m.xmee900
    
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
   ELSE
      CASE lc_state
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
    
      #撈取異動後的資料
      EXECUTE adbt510_master_referesh USING g_xmee_m.xmeedocno,g_xmee_m.xmee900 INTO g_xmee_m.xmeesite, 
          g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202, 
          g_xmee_m.xmee023,g_xmee_m.xmee004,g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmeestus,g_xmee_m.xmee005, 
          g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee002,g_xmee_m.xmee003, 
          g_xmee_m.xmeeacti,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee203,g_xmee_m.xmee027,g_xmee_m.xmee211, 
          g_xmee_m.xmee210,g_xmee_m.xmee209,g_xmee_m.xmee208,g_xmee_m.xmeeunit,g_xmee_m.xmee204,g_xmee_m.xmee205, 
          g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee026, 
          g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee048,g_xmee_m.xmee049, 
          g_xmee_m.xmee009,g_xmee_m.xmee010,g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee011,g_xmee_m.xmee012, 
          g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,g_xmee_m.xmeecrtid, 
          g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
          g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee041,g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017, 
          g_xmee_m.xmee043,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee028,g_xmee_m.xmeesite_desc, 
          g_xmee_m.xmee202_desc,g_xmee_m.xmee023_desc,g_xmee_m.xmee004_desc,g_xmee_m.xmee200_desc,g_xmee_m.xmee201_desc, 
          g_xmee_m.xmee024_desc,g_xmee_m.xmee002_desc,g_xmee_m.xmee003_desc,g_xmee_m.xmee021_desc,g_xmee_m.xmee022_desc, 
          g_xmee_m.xmee203_desc,g_xmee_m.xmee027_desc,g_xmee_m.xmee211_desc,g_xmee_m.xmee210_desc,g_xmee_m.xmee209_desc, 
          g_xmee_m.xmee208_desc,g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204_desc,g_xmee_m.xmee032_desc,g_xmee_m.xmee903_desc, 
          g_xmee_m.xmee206_desc,g_xmee_m.xmee207_desc,g_xmee_m.xmee020_desc,g_xmee_m.xmee036_desc,g_xmee_m.xmee009_desc, 
          g_xmee_m.xmee010_desc,g_xmee_m.xmee015_desc,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp_desc, 
          g_xmee_m.xmeecrtid_desc,g_xmee_m.xmeecrtdp_desc,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeecnfid_desc, 
          g_xmee_m.xmee034_desc,g_xmee_m.xmee017_desc,g_xmee_m.xmee018_desc
      
      #將資料顯示到畫面上
      DISPLAY BY NAME g_xmee_m.xmeesite,g_xmee_m.xmeesite_desc,g_xmee_m.xmee902,g_xmee_m.xmeedocno,g_xmee_m.xmee900, 
          g_xmee_m.xmee901,g_xmee_m.xmee001,g_xmee_m.xmee202,g_xmee_m.xmee202_desc,g_xmee_m.xmee023, 
          g_xmee_m.xmee023_desc,g_xmee_m.xmee004,g_xmee_m.xmee004_desc,g_xmee_m.xmee200,g_xmee_m.xmee200_desc, 
          g_xmee_m.xmee201,g_xmee_m.xmee201_desc,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee007, 
          g_xmee_m.xmee008,g_xmee_m.xmeedocdt,g_xmee_m.xmee024,g_xmee_m.xmee024_desc,g_xmee_m.xmee002, 
          g_xmee_m.xmee002_desc,g_xmee_m.xmee003,g_xmee_m.xmee003_desc,g_xmee_m.xmeeacti,g_xmee_m.xmee021, 
          g_xmee_m.xmee021_desc,g_xmee_m.xmee022,g_xmee_m.xmee022_desc,g_xmee_m.xmee203,g_xmee_m.xmee203_desc, 
          g_xmee_m.xmee027,g_xmee_m.xmee027_desc,g_xmee_m.xmee211,g_xmee_m.xmee211_desc,g_xmee_m.xmee210, 
          g_xmee_m.xmee210_desc,g_xmee_m.xmee209,g_xmee_m.xmee209_desc,g_xmee_m.xmee208,g_xmee_m.xmee208_desc, 
          g_xmee_m.xmeeunit,g_xmee_m.xmeeunit_desc,g_xmee_m.xmee204,g_xmee_m.xmee204_desc,g_xmee_m.xmee205, 
          g_xmee_m.xmee032,g_xmee_m.xmee032_desc,g_xmee_m.xmee071,g_xmee_m.xmee903,g_xmee_m.xmee903_desc, 
          g_xmee_m.xmee904,g_xmee_m.xmee025,g_xmee_m.xmee025_desc,g_xmee_m.oofb017,g_xmee_m.xmee026, 
          g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1,g_xmee_m.xmee206,g_xmee_m.xmee206_desc,g_xmee_m.xmee207, 
          g_xmee_m.xmee207_desc,g_xmee_m.xmee020,g_xmee_m.xmee020_desc,g_xmee_m.xmee036,g_xmee_m.xmee036_desc, 
          g_xmee_m.xmee048,g_xmee_m.xmee049,g_xmee_m.xmee009,g_xmee_m.xmee009_desc,g_xmee_m.xmee010, 
          g_xmee_m.xmee010_desc,g_xmee_m.xmee015,g_xmee_m.xmee015_desc,g_xmee_m.xmee016,g_xmee_m.xmee011, 
          g_xmee_m.xmee011_desc,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee035_desc, 
          g_xmee_m.isaf011,g_xmee_m.xmee039,g_xmee_m.xmeeownid,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp, 
          g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtid_desc,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdp_desc, 
          g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
          g_xmee_m.xmeecnfid_desc,g_xmee_m.xmeecnfdt,g_xmee_m.xmee034,g_xmee_m.xmee034_desc,g_xmee_m.xmee041, 
          g_xmee_m.xmee006,g_xmee_m.xmee042,g_xmee_m.xmee017,g_xmee_m.xmee017_desc,g_xmee_m.xmee043, 
          g_xmee_m.xmee018,g_xmee_m.xmee018_desc,g_xmee_m.xmee019,g_xmee_m.xmee028
   END IF
 
   #add-point:stus修改後 name="statechange.a_update"
                  
   #end add-point
 
   #add-point:statechange段結束前 name="statechange.after"
                  
   #end add-point  
 
   CLOSE adbt510_cl
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL adbt510_msgcentre_notify('statechange:'||lc_state)
   
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="adbt510.idx_chk" >}
#+ 顯示正確的單身資料筆數
PRIVATE FUNCTION adbt510_idx_chk()
   #add-point:idx_chk段define(客製用) name="idx_chk.define_customerization"
   
   #end add-point  
   #add-point:idx_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="idx_chk.define"
                  
   #end add-point  
   
   #add-point:Function前置處理  name="idx_chk.pre_function"
   
   #end add-point
   
   IF g_current_page = 1 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail1")
      IF g_detail_idx > g_xmeg_d.getLength() THEN
         LET g_detail_idx = g_xmeg_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xmeg_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xmeg_d.getLength() TO FORMONLY.cnt
   END IF
   
   IF g_current_page = 2 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail2")
      IF g_detail_idx > g_xmeg2_d.getLength() THEN
         LET g_detail_idx = g_xmeg2_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xmeg2_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xmeg2_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 3 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail3")
      IF g_detail_idx > g_xmeg3_d.getLength() THEN
         LET g_detail_idx = g_xmeg3_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xmeg3_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xmeg3_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 4 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail4")
      IF g_detail_idx > g_xmeg4_d.getLength() THEN
         LET g_detail_idx = g_xmeg4_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xmeg4_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xmeg4_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 5 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail5")
      IF g_detail_idx > g_xmeg5_d.getLength() THEN
         LET g_detail_idx = g_xmeg5_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xmeg5_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xmeg5_d.getLength() TO FORMONLY.cnt
   END IF
 
   
   #add-point:idx_chk段other name="idx_chk.other"
   IF g_current_page = 6 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail7")
      IF g_detail_idx > g_xmeg7_d.getLength() THEN
         LET g_detail_idx = g_xmeg7_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xmeg7_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xmeg7_d.getLength() TO FORMONLY.cnt
   END IF
   
   #170207-00004#2 170219 by 02749 mark---(S)
   #IF g_current_page = 7 THEN
   #   LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail2")
   #   IF g_detail_idx > g_xmeg2_d.getLength() THEN
   #      LET g_detail_idx = g_xmeg2_d.getLength()
   #   END IF
   #   IF g_detail_idx = 0 AND g_xmeg2_d.getLength() <> 0 THEN
   #      LET g_detail_idx = 1
   #   END IF
   #   DISPLAY g_detail_idx TO FORMONLY.idx
   #   DISPLAY g_xmeg2_d.getLength() TO FORMONLY.cnt
   #END IF
   #170207-00004#2 170219 by 02749 mark---(E)
   #end add-point  
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.b_fill2" >}
#+ 單身陣列填充2
PRIVATE FUNCTION adbt510_b_fill2(pi_idx)
   #add-point:b_fill2段define(客製用) name="b_fill2.define_customerization"
   
   #end add-point
   DEFINE pi_idx                 LIKE type_t.num10
   DEFINE li_ac                  LIKE type_t.num10
   DEFINE li_detail_idx_tmp      LIKE type_t.num10
   DEFINE ls_chk                 LIKE type_t.chr1
   #add-point:b_fill2段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="b_fill2.define"
                  
   #end add-point
   
   #add-point:Function前置處理  name="b_fill2.pre_function"
   
   #end add-point
   
   LET li_ac = l_ac 
   
   IF g_detail_idx <= 0 THEN
      RETURN
   END IF
   
   LET li_detail_idx_tmp = g_detail_idx
   
 
      
 
      
   #add-point:單身填充後 name="b_fill2.after_fill"
                  
   #end add-point
    
   LET l_ac = li_ac
   
   CALL adbt510_detail_show()
   
   LET g_detail_idx = li_detail_idx_tmp
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.fill_chk" >}
#+ 單身填充確認
PRIVATE FUNCTION adbt510_fill_chk(ps_idx)
   #add-point:fill_chk段define(客製用) name="fill_chk.define_customerization"
   
   #end add-point
   DEFINE ps_idx        LIKE type_t.chr10
   #add-point:fill_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="fill_chk.define"
                  
   #end add-point
   
   #add-point:Function前置處理 name="fill_chk.before_chk"
   
   #end add-point
   
   #此funtion功能暫時停用(2015/1/12)
   #無論傳入值為何皆回傳true(代表要填充該單身)
 
   #全部為1=1 or null時回傳true
   IF (cl_null(g_wc2_table1) OR g_wc2_table1.trim() = '1=1')  AND 
      (cl_null(g_wc2_table2) OR g_wc2_table2.trim() = '1=1')  AND 
      (cl_null(g_wc2_table3) OR g_wc2_table3.trim() = '1=1')  AND 
      (cl_null(g_wc2_table4) OR g_wc2_table4.trim() = '1=1')  AND 
      (cl_null(g_wc2_table5) OR g_wc2_table5.trim() = '1=1') THEN
      #add-point:fill_chk段other_chk name="fill_chk.other_chk"
                                    
      #end add-point
      RETURN TRUE
   END IF
   
   #add-point:fill_chk段after_chk name="fill_chk.after_chk"
   
   #end add-point
   
   RETURN TRUE
 
END FUNCTION
 
{</section>}
 
{<section id="adbt510.status_show" >}
PRIVATE FUNCTION adbt510_status_show()
   #add-point:status_show段define(客製用) name="status_show.define_customerization"
   
   #end add-point
   #add-point:status_show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="status_show.define"
   
   #end add-point
   
   #add-point:status_show段status_show name="status_show.status_show"
   
   #end add-point
END FUNCTION
 
{</section>}
 
{<section id="adbt510.mask_functions" >}
&include "erp/adb/adbt510_mask.4gl"
 
{</section>}
 
{<section id="adbt510.signature" >}
   #應用 a39 樣板自動產生(Version:10)
#+ BPM提交
PRIVATE FUNCTION adbt510_send()
   #add-point:send段define(客製用) name="send.define_customerization"
   
   #end add-point 
   #add-point:send段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="send.define"
   
   #end add-point 
   
   #add-point:Function前置處理  name="send.pre_function"
   
   #end add-point
   
   #依據單據個數，需要指定所有單身條件為" 1=1"  (單身有幾個就要設幾個)
   LET g_wc2_table1 = " 1=1"
   LET g_wc2_table2 = " 1=1"
   LET g_wc2_table3 = " 1=1"
   LET g_wc2_table4 = " 1=1"
   LET g_wc2_table5 = " 1=1"
 
 
   CALL adbt510_show()
   CALL adbt510_set_pk_array()
   
   #add-point: 初始化的ADP name="send.before_send"
   IF NOT s_adbt510_conf_chk(g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
      CLOSE adbt510_cl
      CALL s_transaction_end('N','0')
      #RETURN         #160308-00010#36 mark
      RETURN FALSE    #160308-00010#36 add
   END IF

   #end add-point
   
   #公用變數初始化
   CALL cl_bpm_data_init()
                  
   #依照主檔/單身個數產生 CALL cl_bpm_set_master_data() / cl_bpm_set_detail_data() 
   #單頭固定為 CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(xxxx)) 傳入參數: (1)單頭陣列  ; 回傳值: 無
   CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(g_xmee_m))
                              
   #單身固定為 CALL cl_bpm_set_detail_data(s_detailX, util.JSONArray.fromFGL(xxxx)) 傳入參數: (1)單身SR名稱  (2)單身陣列  ; 回傳值: 無
   CALL cl_bpm_set_detail_data("s_detail1", util.JSONArray.fromFGL(g_xmeg_d))
   CALL cl_bpm_set_detail_data("s_detail2", util.JSONArray.fromFGL(g_xmeg2_d))
   CALL cl_bpm_set_detail_data("s_detail3", util.JSONArray.fromFGL(g_xmeg3_d))
   CALL cl_bpm_set_detail_data("s_detail4", util.JSONArray.fromFGL(g_xmeg4_d))
   CALL cl_bpm_set_detail_data("s_detail5", util.JSONArray.fromFGL(g_xmeg5_d))
 
 
   # cl_bpm_cli() 裡有包含以前的aws_condition()=>送簽資料檢核和更新單據狀況碼為'W'
   # cl_bpm_cli() 傳入參數:無  ;  回傳值: 0 開單失敗; 1 開單成功
 
   #add-point: 提交前的ADP name="send.before_cli"
   
   #end add-point
 
   #開單失敗
   IF NOT cl_bpm_cli() THEN 
      RETURN FALSE
   END IF
 
   #add-point: 提交後的ADP name="send.after_send"
   
   #end add-point
 
   #此段落不需要刪除資料,但是否需要refresh圖片樣式???
   #CALL adbt510_ui_browser_refresh()
 
   #重新指定此筆單據資料狀態圖片=>送簽中
   LET g_browser[g_current_idx].b_statepic = "stus/16/signing.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL adbt510_ui_headershow()
   CALL adbt510_ui_detailshow()
 
   RETURN TRUE
   
END FUNCTION
 
 
 
#應用 a40 樣板自動產生(Version:9)
#+ BPM抽單
PRIVATE FUNCTION adbt510_draw_out()
   #add-point:draw段define name="draw.define_customerization"
   
   #end add-point
   #add-point:draw段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="draw.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="draw.pre_function"
   
   #end add-point
   
   #抽單失敗
   IF NOT cl_bpm_draw_out() THEN 
      RETURN FALSE
   END IF    
          
   #重新指定此筆單據資料狀態圖片=>抽單
   LET g_browser[g_current_idx].b_statepic = "stus/16/draw_out.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL adbt510_ui_headershow()  
   CALL adbt510_ui_detailshow()
 
   #add-point:Function後置處理  name="draw.after_function"
   
   #end add-point
 
   RETURN TRUE
   
END FUNCTION
 
 
 
 
 
{</section>}
 
{<section id="adbt510.set_pk_array" >}
   #應用 a51 樣板自動產生(Version:8)
#+ 給予pk_array內容
PRIVATE FUNCTION adbt510_set_pk_array()
   #add-point:set_pk_array段define name="set_pk_array.define_customerization"
   
   #end add-point
   #add-point:set_pk_array段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_pk_array.define"
   
   #end add-point
   
   #add-point:Function前置處理 name="set_pk_array.before"
   
   #end add-point  
   
   #若l_ac<=0代表沒有資料
   IF l_ac <= 0 THEN
      RETURN
   END IF
   
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_xmee_m.xmeedocno
   LET g_pk_array[1].column = 'xmeedocno'
   LET g_pk_array[2].values = g_xmee_m.xmee900
   LET g_pk_array[2].column = 'xmee900'
   
   #add-point:set_pk_array段之後 name="set_pk_array.after"
   
   #end add-point  
   
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="adbt510.other_dialog" readonly="Y" >}
   
 
{</section>}
 
{<section id="adbt510.msgcentre_notify" >}
#應用 a66 樣板自動產生(Version:6)
PRIVATE FUNCTION adbt510_msgcentre_notify(lc_state)
   #add-point:msgcentre_notify段define name="msgcentre_notify.define_customerization"
   
   #end add-point   
   DEFINE lc_state LIKE type_t.chr80
   #add-point:msgcentre_notify段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="msgcentre_notify.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="msgcentre_notify.pre_function"
   
   #end add-point
   
   INITIALIZE g_msgparam TO NULL
 
   #action-id與狀態填寫
   LET g_msgparam.state = lc_state
 
   #PK資料填寫
   CALL adbt510_set_pk_array()
   #單頭資料填寫
   LET g_msgparam.data[1] = util.JSON.stringify(g_xmee_m)
 
   #add-point:msgcentre其他通知 name="msgcentre_notify.process"
   
   #end add-point
 
   #呼叫訊息中心傳遞本關完成訊息
   CALL cl_msgcentre_notify()
 
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="adbt510.action_chk" >}
#+ 修改/刪除前行為檢查(是否可允許此動作), 若有其他行為須管控也可透過此段落
PRIVATE FUNCTION adbt510_action_chk()
   #add-point:action_chk段define(客製用) name="action_chk.define_customerization"
   
   #end add-point
   #add-point:action_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="action_chk.define"
   
   #end add-point
   
   #add-point:action_chk段action_chk name="action_chk.action_chk"
   #160818-00017#6 -s by 08172
   SELECT xmeestus  INTO g_xmee_m.xmeestus
     FROM xmee_t
    WHERE xmeeent = g_enterprise
      AND xmeedocno = g_xmee_m.xmeedocno
      AND xmee900 = g_xmee_m.xmee900
   LET g_errno = NULL
   IF (g_action_choice="modify" OR g_action_choice="modify_detail" OR g_action_choice="delete")  THEN
     CASE g_xmee_m.xmeestus
        WHEN 'W'
           LET g_errno = 'sub-00180'
        WHEN 'X'
           LET g_errno = 'sub-00229'
        WHEN 'Y'
           LET g_errno = 'sub-00178'
        WHEN 'S'
           LET g_errno = 'sub-00230'
     END CASE

     IF NOT cl_null(g_errno) THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = g_errno
        LET g_errparam.extend = g_xmee_m.xmeedocno
        LET g_errparam.popup = TRUE
        CALL cl_err()
        LET g_errno = NULL
        CALL adbt510_show()
        RETURN FALSE
     END IF
   END IF
   #160818-00017#6 -e by 08172
   #end add-point
      
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="adbt510.other_function" readonly="Y" >}
#部門檢查
PRIVATE FUNCTION adbt510_xmee003_chk(p_xmee003)
DEFINE p_xmee003      LIKE xmee_t.xmee003
DEFINE r_success   LIKE type_t.num5

       LET r_success = TRUE
       IF NOT cl_null(p_xmee003) THEN 
         #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
          INITIALIZE g_chkparam.* TO NULL
          LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
         #設定g_chkparam.*的參數
          LET g_chkparam.arg1 = p_xmee003
          LET g_chkparam.arg2 = g_xmee_m.xmeedocdt
          LET g_chkparam.err_str[1] = "aoo-00029:sub-01302|aooi125|",cl_get_progname("aooi125",g_lang,"2"),"|:EXEPROGaooi125"#要執行的建議程式待補 #160318-00025#28  add
         #呼叫檢查存在並帶值的library
          IF NOT cl_chk_exist("v_ooeg001") THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
       END IF 
       RETURN r_success
END FUNCTION
#取價方式顯示
PRIVATE FUNCTION adbt510_xmee017_ref(p_xmee017)
DEFINE p_xmee017    LIKE xmee_t.xmee017
DEFINE r_pmaml003   LIKE pmaml_t.pmaml003

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee017
       CALL ap_ref_array2(g_ref_fields,"SELECT xmahl003 FROM xmahl_t WHERE xmahlent='"||g_enterprise||"' AND xmahl001=? AND xmahl002='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_pmaml003 = '', g_rtn_fields[1] , ''
       RETURN r_pmaml003
       
END FUNCTION
#銷售通路顯示
PRIVATE FUNCTION adbt510_xmee023_ref(p_xmee023)
DEFINE p_xmee023   LIKE xmee_t.xmee023
DEFINE r_oocql004  LIKE oocql_t.oocql004

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee023
       CALL ap_ref_array2(g_ref_fields,"SELECT oojdl003 FROM oojdl_t WHERE oojdlent='"||g_enterprise||"' AND oojdl001=? AND oojdl002='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_oocql004 = '', g_rtn_fields[1] , ''
       RETURN r_oocql004   
       
END FUNCTION
#銷售分類檢查
PRIVATE FUNCTION adbt510_xmee024_chk(p_xmee024)
DEFINE p_xmee024    LIKE xmee_t.xmee024
DEFINE r_success    LIKE type_t.num5

       LET r_success = TRUE

       IF NOT cl_null(p_xmee024) THEN
          IF NOT s_azzi650_chk_exist('295',p_xmee024) THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
       END IF
       RETURN r_success
END FUNCTION

PRIVATE FUNCTION adbt510_xmee025_desc()
  DEFINE l_address   STRING
  DEFINE l_oofb011   LIKE oofb_t.oofb011
  DEFINE l_success   LIKE type_t.num5     
  DEFINE l_oofb019   LIKE oofb_t.oofb019    #簡要代碼
  DEFINE l_oofb022   LIKE oofb_t.oofb022    #送貨站點
  DEFINE l_dbaf001   LIKE dbaf_t.dbaf001    #路線編號 
  
      #收貨地址
      LET l_address = '' 
      LET g_xmee_m.xmee025 = ''
      LET g_xmee_m.xmee025_desc = ''
      LET g_xmee_m.xmee206 = ''
      LET g_xmee_m.xmee207 = ''
      LET g_xmee_m.oofb017 = ''
      IF NOT cl_null(g_xmee_m.xmee022) THEN    
         CALL s_adb_address_default('3',g_xmee_m.xmee022)
            RETURNING l_oofb019,l_oofb022,l_dbaf001
            
         LET g_xmee_m.xmee025 = l_oofb019   #簡要代碼
         LET g_xmee_m.xmee206 = l_oofb022   #送貨站點
         LET g_xmee_m.xmee207 = l_dbaf001   #路線編號
         
         IF NOT cl_null(g_xmee_m.xmee025) THEN
            CALL s_adb_address_ref('3',g_xmee_m.xmee025,g_xmee_m.xmee022)
               RETURNING l_oofb011,l_address
            LET g_xmee_m.xmee025_desc = l_oofb011
            LET g_xmee_m.oofb017 = l_address
         END IF
      END IF
      LET g_xmee_m_o.xmee025 = g_xmee_m.xmee025
      LET g_xmee_m.xmee206_desc = s_desc_get_dbad001_desc(g_xmee_m.xmee206)
      LET g_xmee_m.xmee207_desc = s_desc_get_dbab001_desc(g_xmee_m.xmee207)
      DISPLAY BY NAME g_xmee_m.xmee025,g_xmee_m.xmee025_desc,
                      g_xmee_m.xmee206,g_xmee_m.xmee207,
                      g_xmee_m.oofb017
END FUNCTION

PRIVATE FUNCTION adbt510_xmee026_desc()
  DEFINE l_address   STRING
  DEFINE l_oofb011   LIKE oofb_t.oofb011
  DEFINE l_success   LIKE type_t.num5  
  DEFINE l_oofb022   LIKE oofb_t.oofb022
  
      #收款地址
      LET l_address = ''
      LET g_xmee_m.xmee026 = ''
      LET g_xmee_m.xmee026_desc = ''
      LET g_xmee_m.oofb017_1 = ''
      
      IF NOT cl_null(g_xmee_m.xmee021) THEN      
         CALL s_adb_main_address('5',g_xmee_m.xmee021) 
            RETURNING g_xmee_m.xmee026,l_oofb022
         
         DISPLAY BY NAME g_xmee_m.xmee026
 
         IF NOT cl_null(g_xmee_m.xmee026) THEN
            CALL s_adb_address_ref('5',g_xmee_m.xmee026,g_xmee_m.xmee021)
               RETURNING l_oofb011,l_address
            LET g_xmee_m.xmee026_desc = l_oofb011
            LET g_xmee_m.oofb017_1 = l_address  
         END IF 
      END IF
      LET g_xmee_m_o.xmee026 = g_xmee_m.xmee026
      DISPLAY BY NAME g_xmee_m.xmee026,g_xmee_m.xmee026_desc 
      DISPLAY BY NAME g_xmee_m.oofb017_1
END FUNCTION

PRIVATE FUNCTION adbt510_xmee027_ref(p_xmee027)
DEFINE p_xmee027   LIKE xmee_t.xmee027
DEFINE r_oofa011   LIKE oofa_t.oofa011

       LET r_oofa011 = ''
       SELECT oofa011 INTO r_oofa011 FROM oofa_t WHERE oofaent=g_enterprise AND oofa001=p_xmee027
       RETURN r_oofa011
END FUNCTION

PRIVATE FUNCTION adbt510_xmee202_chk()
DEFINE l_cnt     LIKE type_t.num5
DEFINE r_return  LIKE type_t.num5

      LET r_return = TRUE
      IF NOT cl_null(g_xmee_m.xmee202) 
         AND cl_null(g_xmee_m.xmee023) THEN
        #SELECT COUNT(*)         #170207-00004#2 170219 by 02749 mark
         SELECT COUNT(dbbc005)   #170207-00004#2 170219 by 02749 add
           INTO l_cnt
           FROM dbbc_t
          WHERE dbbcent = g_enterprise   #160905-00003#4 160905 by 02749 add:ENT過濾條件
            AND dbbc002 = g_xmee_m.xmeesite
            AND dbbc005 = g_xmee_m.xmee202
          IF l_cnt = 0 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'adb-00042'
             LET g_errparam.extend = ""
             LET g_errparam.popup = TRUE
             CALL cl_err()

             LET r_return = FALSE
             RETURN r_return
          END IF
      END IF
      IF NOT cl_null(g_xmee_m.xmee023) 
         AND cl_null(g_xmee_m.xmee202) THEN
        #SELECT COUNT(*)         #170207-00004#2 170219 by 02749 mark
         SELECT COUNT(dbbc003)   #170207-00004#2 170219 by 02749 add
           INTO l_cnt
           FROM dbbc_t
          WHERE dbbcent = g_enterprise   #160905-00003#4 160905 by 02749 add:ENT過濾條件
            AND dbbc002 = g_xmee_m.xmeesite
            AND dbbc003 = g_xmee_m.xmee023
          IF l_cnt = 0 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'adb-00042'
             LET g_errparam.extend = ""
             LET g_errparam.popup = TRUE
             CALL cl_err()

             LET r_return = FALSE
             RETURN r_return
          END IF
      END IF
      IF NOT cl_null(g_xmee_m.xmee202) 
         AND NOT cl_null(g_xmee_m.xmee023) THEN
        #SELECT COUNT(*)         #170207-00004#2 170219 by 02749 mark
         SELECT COUNT(dbbc002)   #170207-00004#2 170219 by 02749 add
           INTO l_cnt
           FROM dbbc_t
          WHERE dbbcent = g_enterprise   #160905-00003#4 160905 by 02749 add:ENT過濾條件
            AND dbbc002 = g_xmee_m.xmeesite
            AND dbbc005 = g_xmee_m.xmee202
            AND dbbc003 = g_xmee_m.xmee023
          IF l_cnt = 0 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'adb-00042'
             LET g_errparam.extend = ""
             LET g_errparam.popup = TRUE
             CALL cl_err()

             LET r_return = FALSE
             RETURN r_return
          END IF
      END IF
      RETURN r_return
END FUNCTION

PRIVATE FUNCTION adbt510_xmee204_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmee_m.xmee204
      CALL ap_ref_array2(g_ref_fields,"SELECT prcfl003 FROM prcfl_t WHERE prcflent='"||g_enterprise||"' AND prcfl001=? AND prcfl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmee_m.xmee204_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmee_m.xmee204_desc
END FUNCTION
#根據交貨日期計算緊急度
PRIVATE FUNCTION adbt510_xmeg012_to_xmeg020()
DEFINE l_imae071    LIKE imae_t.imae071  #固定
DEFINE l_imae072    LIKE imae_t.imae072  #變動
DEFINE l_imae074    LIKE imae_t.imae074  #QC
DEFINE l_imae076    LIKE imae_t.imae076  #嚴守交期前置時間
DEFINE l_time1      LIKE imaf_t.imaf171
DEFINE l_time2      LIKE imaf_t.imaf171

        IF NOT cl_null(g_xmeg_d[l_ac].xmeg012) THEN
           LET l_imae071 = 0   
           LET l_imae072 = 0   
           LET l_imae074 = 0  
           LET l_imae076 = 0             
           LET l_time1 = 0
           LET l_time2 = 0

          SELECT imae071,imae072,imae074,imae076 
            INTO l_imae071,l_imae072,l_imae074,l_imae076
            FROM imae_t
           WHERE imaeent = g_enterprise AND imaesite = g_xmee_m.xmeesite 
             AND imae001 = g_xmeg_d[l_ac].xmeg001

          LET l_time1 = g_xmeg_d[l_ac].xmeg012 - g_today      #交貨日期  - g_today
          LET l_time2 = l_imae071 + l_imae072 + l_imae074     #[T:料件據點生管資料檔]設置的(固定+變動+QC)前置天數

          #若輸入的交貨日期 - g_today > [T:料件據點生管資料檔]設置的(固定+變動+QC)前置天數，則[C:緊急度] = '1'(一般)
          IF l_time1 >= l_time2 THEN
             LET g_xmeg_d[l_ac].xmeg020 = '1'
          END IF

          #若輸入的交貨日期 - g_today < [T:料件據點生管資料檔]設置的(固定+變動+QC)前置天數，
          #且約定交貨日期 - g_today >[T:料件據點生管資料檔].[C:嚴守交期前置時間]時，則[C:緊急度] = '2'(緊急)
          IF l_time1 < l_time2 AND l_time1 >= l_imae076 THEN
             LET g_xmeg_d[l_ac].xmeg020 = '2'
          END IF

          #若約定交貨日期 - g_today <[T:料件據點生管資料檔].[C:嚴守交期前置時間]時，則[C:緊急度] = '3'(特急)
          IF l_time1 < l_imae076 THEN
             LET g_xmeg_d[l_ac].xmeg020 = '3'
          END IF
       END IF
END FUNCTION
#檢查理由碼
PRIVATE FUNCTION adbt510_xmeg049_chk(p_xmeg049)
DEFINE p_xmeg049  LIKE xmeg_t.xmeg049
DEFINE l_success  LIKE type_t.num5
DEFINE r_success  LIKE type_t.num5
DEFINE l_flag     LIKE type_t.num5

        LET r_success = TRUE
        
        IF NOT cl_null(p_xmeg049) THEN
           CALL s_azzi650_chk_exist(g_acc,p_xmeg049) RETURNING l_success
           IF NOT l_success THEN
               LET r_success = FALSE
               RETURN r_success
           END IF
           #02749  150121  add ----------------------(S)
           #不使用控制組
           ##檢核輸入的理由碼是否在單據別限制範圍內，若不在限制內則不允許使用此理由碼
           #CALL s_control_chk_doc('8',g_xmee_m.xmeedocno,p_xmeg049,'','','','') RETURNING l_success,l_flag
           #IF NOT r_success THEN
           #   LET r_success = FALSE
           #   RETURN r_success
           #ELSE
           #   IF NOT l_flag THEN
           #      LET r_success = FALSE
           #      RETURN r_success
           #   END IF
           #END IF
           #02749  150121  add ----------------------(E)
        END IF           
        RETURN r_success
END FUNCTION
#檢查營運據點
PRIVATE FUNCTION adbt510_xmegunit_chk(p_xmegunit)
DEFINE p_xmegunit   LIKE xmeg_t.xmegunit
DEFINE l_success    LIKE type_t.num5
DEFINE l_flag       LIKE type_t.num5
DEFINE r_success    LIKE type_t.num5

       LET r_success = TRUE
       
       IF NOT cl_null(p_xmegunit) THEN 
          #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
          INITIALIZE g_chkparam.* TO NULL
          LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
          #設定g_chkparam.*的參數
          LET g_chkparam.arg1 = p_xmegunit
          LET g_chkparam.err_str[1] = "aoo-00095:sub-01302|aooi125|",cl_get_progname("aooi125",g_lang,"2"),"|:EXEPROGaooi125"#要執行的建議程式待補 #160318-00025#28  add
          #呼叫檢查存在並帶值的library
          IF NOT cl_chk_exist("v_ooef001") THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
          #02749  150121  add ----------------------(S)
          #不使用控制組
          ##檢核輸入的營運據點是否在採購控制組的限制範圍內
          #CALL s_control_chk_group('5','2',g_user,g_dept,p_xmegunit ,'','','','') RETURNING l_success,l_flag
          #IF NOT l_success THEN      #處理狀況
          #   LET r_success = FALSE
          #   RETURN r_success
          #ELSE
          #   IF NOT l_flag THEN      #是否存在
          #      INITIALIZE g_errparam TO NULL
          #      LET g_errparam.code = 'apm-00274'
          #      LET g_errparam.extend = p_xmegunit
          #      LET g_errparam.popup = TRUE
          #      CALL cl_err()
          #
          #      LET r_success = FALSE
          #      RETURN r_success
          #   END IF 
          #END IF
          #02749  150121  add ----------------------(E)
       END IF 
       RETURN r_success
END FUNCTION

PRIVATE FUNCTION adbt510_xmjb005_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg4_d[l_ac].xmjb005
      CALL ap_ref_array2(g_ref_fields,"SELECT prcfl003 FROM prcfl_t WHERE prcflent='"||g_enterprise||"' AND prcfl001=? AND prcfl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg4_d[l_ac].xmjb005_desc = '', g_rtn_fields[1] , ''
      #DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb005_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmjb024_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg4_d[l_ac].xmjb024
      CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg4_d[l_ac].xmjb024_desc = '', g_rtn_fields[1] , ''
      #DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb024_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmjb024_desc()
#  DEFINE l_pmaa027   LIKE pmaa_t.pmaa027  
#      
#      #送貨地址
#      LET l_pmaa027 = ''                                      
#      CALL adbt510_get_pmaa027(g_xmeg4_d[l_ac].xmjb025) RETURNING l_pmaa027
#      SELECT oofb019,oofb022 INTO g_xmeg4_d[l_ac].xmjb026,g_xmeg4_d[l_ac].xmjb027 FROM oofb_t
#       WHERE oofbent = g_enterprise
#         AND oofb002 = l_pmaa027 AND oofb008 = '3' 
#         AND oofbstus = 'Y' AND oofb010 = 'Y' AND rownum = 1 
      CALL s_adb_main_address('3',g_xmeg4_d[l_ac].xmjb025) 
         RETURNING g_xmeg4_d[l_ac].xmjb026,g_xmeg4_d[l_ac].xmjb027
         
      CALL adbt510_xmjb026_ref()
      LET g_xmeg4_d[l_ac].xmjb027_desc = s_desc_get_dbad001_desc(g_xmeg4_d[l_ac].xmjb027)
END FUNCTION

PRIVATE FUNCTION adbt510_xmjb026_ref()
  DEFINE l_pmaa027   LIKE pmaa_t.pmaa027
  DEFINE l_address   STRING
  DEFINE l_success   LIKE type_t.num5  
  
      LET l_pmaa027 = ''
      LET l_address = ''                                       
      CALL adbt510_get_pmaa027(g_xmeg4_d[l_ac].xmjb025) RETURNING l_pmaa027
      IF NOT cl_null(g_xmeg4_d[l_ac].xmjb026) THEN
         CALL s_aooi350_get_address(l_pmaa027,g_xmeg4_d[l_ac].xmjb026,g_lang)RETURNING l_success,l_address
         LET g_xmeg4_d[l_ac].xmjb026_desc = l_address
         #DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb026_desc
      ELSE
         LET g_xmeg4_d[l_ac].xmjb026_desc = ''
        # DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb026_desc
      END IF
END FUNCTION

PRIVATE FUNCTION adbt510_rtie002_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg7_d[l_ac].rtie002
      CALL ap_ref_array2(g_ref_fields,"SELECT ooial003 FROM ooial_t WHERE ooialent='"||g_enterprise||"' AND ooial001=? AND ooial002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg7_d[l_ac].rtie002_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmeg7_d[l_ac].rtie002_desc
END FUNCTION
#單頭變更送貨客戶
PRIVATE FUNCTION adbt510_change_xmee022()
DEFINE l_pmaa002      LIKE pmaa_t.pmaa002

      SELECT pmaa002
        INTO l_pmaa002
        FROM pmaa_t
       WHERE pmaaent = g_enterprise
         AND pmaa001 = g_xmee_m.xmee004
      IF l_pmaa002 <> '2' THEN
         UPDATE xmjb_t
            SET xmjb024 = NULL,
                xmjb025 = g_xmee_m.xmee022,
                xmjb026 = g_xmee_m.xmee025,
                xmjb027 = g_xmee_m.xmee206
          WHERE xmjbent = g_enterprise
            AND xmjbdocno = g_xmee_m.xmeedocno
            AND xmjb900 = g_xmee_m.xmee900
         CALL adbt510_b_fill()
      END IF
END FUNCTION
#抓取聯絡對象識別碼
PRIVATE FUNCTION adbt510_get_pmaa027(p_pmaa001)
DEFINE p_pmaa001 LIKE pmaa_t.pmaa001
DEFINE r_pmaa027 LIKE pmaa_t.pmaa003

      LET r_pmaa027 = ''
      
      SELECT pmaa027 INTO r_pmaa027
        FROM pmaa_t
       WHERE pmaaent = g_enterprise
         AND pmaa001 = p_pmaa001
         
      RETURN r_pmaa027
END FUNCTION
################################################################################
# Descriptions...: 取得單據別設定的欄位預設值
# Memo...........: 需搭配單據別aooi200的設定
################################################################################
PRIVATE FUNCTION adbt510_get_col_default()
   LET g_xmee_m.xmeedocdt = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmeedocdt',g_xmee_m.xmeedocdt)
   LET g_xmee_m.xmee004 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee004',g_xmee_m.xmee004)
   LET g_xmee_m.xmee002 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee002',g_xmee_m.xmee002)
   LET g_xmee_m.xmee003 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee003',g_xmee_m.xmee003)
   LET g_xmee_m.xmee005 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee005',g_xmee_m.xmee005)
   LET g_xmee_m.xmee006 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee006',g_xmee_m.xmee006)
   LET g_xmee_m.xmee007 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee007',g_xmee_m.xmee007)
   LET g_xmee_m.xmee008 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee008',g_xmee_m.xmee008)
   LET g_xmee_m.xmee027 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee027',g_xmee_m.xmee027)
   LET g_xmee_m.xmee009 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee009',g_xmee_m.xmee009)
   LET g_xmee_m.xmee010 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee010',g_xmee_m.xmee010)
   LET g_xmee_m.xmee011 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee011',g_xmee_m.xmee011)
   LET g_xmee_m.xmee012 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee012',g_xmee_m.xmee012)
   LET g_xmee_m.xmee013 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee013',g_xmee_m.xmee013)
   LET g_xmee_m.xmee035 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee035',g_xmee_m.xmee035)
   LET g_xmee_m.xmee015 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee015',g_xmee_m.xmee015)
   LET g_xmee_m.xmee016 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee016',g_xmee_m.xmee016)
   LET g_xmee_m.xmee017 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee017',g_xmee_m.xmee017)
   LET g_xmee_m.xmee018 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee018',g_xmee_m.xmee018)
   LET g_xmee_m.xmee019 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee019',g_xmee_m.xmee019)
   LET g_xmee_m.xmee023 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee023',g_xmee_m.xmee023)
   LET g_xmee_m.xmee032 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee032',g_xmee_m.xmee032)
   LET g_xmee_m.xmee043 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee043',g_xmee_m.xmee043)
   LET g_xmee_m.xmee021 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee021',g_xmee_m.xmee021)
   LET g_xmee_m.xmee022 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee022',g_xmee_m.xmee022)
   LET g_xmee_m.xmee034 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee034',g_xmee_m.xmee034)
   LET g_xmee_m.xmee024 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee024',g_xmee_m.xmee024)
   LET g_xmee_m.xmee025 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee025',g_xmee_m.xmee025)
   LET g_xmee_m.xmee026 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee026',g_xmee_m.xmee026)
   LET g_xmee_m.xmee020 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee020',g_xmee_m.xmee020)
   LET g_xmee_m.xmee036 = s_aooi200_get_doc_default(g_xmee_m.xmeesite,'1',g_xmee_m.xmeedocno,'xmee036',g_xmee_m.xmee036)
   
   DISPLAY g_xmee_m.xmeedocdt TO xmeedocdt
   DISPLAY g_xmee_m.xmee004 TO xmee004
   DISPLAY g_xmee_m.xmee002 TO xmee002
   DISPLAY g_xmee_m.xmee003 TO xmee003 
   DISPLAY g_xmee_m.xmee005 TO xmee005
   DISPLAY g_xmee_m.xmee006 TO xmee006
   DISPLAY g_xmee_m.xmee007 TO xmee007
   DISPLAY g_xmee_m.xmee008 TO xmee008
   DISPLAY g_xmee_m.xmee027 TO xmee027
   DISPLAY g_xmee_m.xmee009 TO xmee009
   DISPLAY g_xmee_m.xmee010 TO xmee010
   DISPLAY g_xmee_m.xmee011 TO xmee011
   DISPLAY g_xmee_m.xmee012 TO xmee012
   DISPLAY g_xmee_m.xmee013 TO xmee013
   DISPLAY g_xmee_m.xmee035 TO xmee035
   DISPLAY g_xmee_m.xmee015 TO xmee015
   DISPLAY g_xmee_m.xmee016 TO xmee016
   DISPLAY g_xmee_m.xmee017 TO xmee017
   DISPLAY g_xmee_m.xmee018 TO xmee018
   DISPLAY g_xmee_m.xmee019 TO xmee019
   DISPLAY g_xmee_m.xmee023 TO xmee023
   DISPLAY g_xmee_m.xmee032 TO xmee032
   DISPLAY g_xmee_m.xmee043 TO xmee043
   DISPLAY g_xmee_m.xmee021 TO xmee021
   DISPLAY g_xmee_m.xmee022 TO xmee022
   DISPLAY g_xmee_m.xmee034 TO xmee034
   DISPLAY g_xmee_m.xmee024 TO xmee024
   DISPLAY g_xmee_m.xmee025 TO xmee025
   DISPLAY g_xmee_m.xmee026 TO xmee026
   DISPLAY g_xmee_m.xmee020 TO xmee020
   DISPLAY g_xmee_m.xmee036 TO xmee036

   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee004) RETURNING g_xmee_m.xmee004_desc
   CALL s_desc_get_person_desc(g_xmee_m.xmee002) RETURNING g_xmee_m.xmee002_desc
   CALL s_desc_get_department_desc(g_xmee_m.xmee003) RETURNING g_xmee_m.xmee003_desc
   CALL adbt510_xmee027_ref(g_xmee_m.xmee027) RETURNING g_xmee_m.xmee027_desc
   CALL s_desc_get_ooib002_desc(g_xmee_m.xmee009) RETURNING g_xmee_m.xmee009_desc
   CALL s_desc_get_acc_desc('238',g_xmee_m.xmee010) RETURNING g_xmee_m.xmee010_desc
   CALL s_desc_get_tax_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee011) RETURNING g_xmee_m.xmee011_desc
   CALL s_desc_get_invoice_type_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee035) RETURNING g_xmee_m.xmee035_desc
   CALL s_desc_get_currency_desc(g_xmee_m.xmee015) RETURNING g_xmee_m.xmee015_desc
   CALL adbt510_xmee017_ref(g_xmee_m.xmee017) RETURNING g_xmee_m.xmee017_desc
   CALL s_desc_ooid001_desc(g_xmee_m.xmee018) RETURNING g_xmee_m.xmee018_desc
   CALL adbt510_xmee023_ref(g_xmee_m.xmee023) RETURNING g_xmee_m.xmee023_desc
   CALL s_desc_get_acc_desc('297',g_xmee_m.xmee032) RETURNING g_xmee_m.xmee032_desc
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee021) RETURNING g_xmee_m.xmee021_desc
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee022) RETURNING g_xmee_m.xmee022_desc
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee034) RETURNING g_xmee_m.xmee034_desc
   CALL s_desc_get_acc_desc('295',g_xmee_m.xmee024) RETURNING g_xmee_m.xmee024_desc
   CALL s_desc_get_acc_desc('263',g_xmee_m.xmee020) RETURNING g_xmee_m.xmee020_desc

   DISPLAY BY NAME g_xmee_m.xmee004_desc
   DISPLAY BY NAME g_xmee_m.xmee002_desc
   DISPLAY BY NAME g_xmee_m.xmee003_desc
   DISPLAY BY NAME g_xmee_m.xmee027_desc
   DISPLAY BY NAME g_xmee_m.xmee009_desc
   DISPLAY BY NAME g_xmee_m.xmee010_desc
   DISPLAY BY NAME g_xmee_m.xmee011_desc
   DISPLAY BY NAME g_xmee_m.xmee035_desc
   DISPLAY BY NAME g_xmee_m.xmee015_desc
   DISPLAY BY NAME g_xmee_m.xmee017_desc
   DISPLAY BY NAME g_xmee_m.xmee018_desc
   DISPLAY BY NAME g_xmee_m.xmee023_desc
   DISPLAY BY NAME g_xmee_m.xmee032_desc
   DISPLAY BY NAME g_xmee_m.xmee021_desc
   DISPLAY BY NAME g_xmee_m.xmee022_desc
   DISPLAY BY NAME g_xmee_m.xmee034_desc
   DISPLAY BY NAME g_xmee_m.xmee024_desc
   DISPLAY BY NAME g_xmee_m.xmee020_desc
   DISPLAY BY NAME g_xmee_m.xmee036_desc
   
END FUNCTION
#取得產品特徵類別
PRIVATE FUNCTION adbt510_get_imaa005(p_enterprise,p_xmeg001)
DEFINE p_enterprise   LIKE type_t.num5,
       p_xmeg001      LIKE xmeg_t.xmeg001
DEFINE r_imaa005      LIKE imaa_t.imaa005

   LET r_imaa005 = ''
   SELECT imaa005 INTO r_imaa005
     FROM imaa_t
    WHERE imaaent = p_enterprise
      AND imaa001 = p_xmeg001

   RETURN r_imaa005
END FUNCTION

PRIVATE FUNCTION adbt510_get_xmjb022()
      IF g_xmeg4_d[l_ac].xmjb008 <> 0 AND g_xmeg4_d[l_ac].xmjb010 <> 0 AND g_xmeg4_d[l_ac].xmjb018 <> 0 THEN
         LET g_xmeg4_d[l_ac].xmjb022 = (g_xmeg4_d[l_ac].xmjb008 - g_xmeg4_d[l_ac].xmjb010) * g_xmeg4_d[l_ac].xmjb018
      END IF
END FUNCTION

PRIVATE FUNCTION adbt510_gen_xmej(p_type)
DEFINE p_type                LIKE type_t.num5
DEFINE r_success             LIKE type_t.num5
DEFINE l_cnt                 LIKE type_t.num5
DEFINE l_xmjb031             LIKE xmjb_t.xmjb031
DEFINE l_xmjb032             LIKE xmjb_t.xmjb032
DEFINE l_xmej200             LIKE xmej_t.xmej200
DEFINE l_xmej201             LIKE xmej_t.xmej201
DEFINE l_xmejunit            LIKE xmej_t.xmejunit

   LET r_success = TRUE
   IF cl_null(g_xmeg4_d[l_ac].xmjbseq) THEN
      RETURN r_success
   END IF
   IF g_xmeg4_d[l_ac].xmjb030 = 'N' THEN
      IF p_type = 1 THEN
         LET l_cnt = 0
        #SELECT COUNT(*)         #170207-00004#2 170219 by 02749 mark
         SELECT COUNT(xmejseq)   #170207-00004#2 170219 by 02749 add
           INTO l_cnt
           FROM xmej_t
          WHERE xmejent = g_enterprise
            AND xmejdocno = g_xmee_m.xmeedocno
            AND xmejseq = g_xmeg4_d[l_ac].xmjbseq
            AND xmej900 = g_xmee_m.xmee900
         IF l_cnt = 0 THEN
            IF NOT cl_null(g_xmee_m.xmeeunit) THEN
               LET l_xmejunit = g_xmee_m.xmeeunit
            ELSE
               LET l_xmejunit = g_xmeg4_d[l_ac].xmjbsite
            END IF
            
            SELECT dbag004,dbag005
              INTO l_xmej200,l_xmej201
              FROM dbag_t
             WHERE dbagent = g_enterprise
               AND dbagsite = l_xmdfunit
               AND dbag001 = '1'
               AND dbag002 = g_xmee_m.xmee004
               AND dbag003 = g_xmeg4_d[l_ac].xmjb025
               
            INSERT INTO xmej_t(xmejent,xmejsite,xmejunit,xmejdocno,xmejseq,xmejseq2,xmej002,xmej003,xmej004,xmej006,xmej200,xmej201,xmej900,xmej901)
                        VALUES(g_enterprise,g_xmeg4_d[l_ac].xmjbsite,l_xmdfunit,g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,1,
                               g_xmeg4_d[l_ac].xmjb014,g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032,'N',l_xmdf200,l_xmdf201,g_xmee_m.xmee900,'3')
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "xmej_t"
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET r_success = FALSE
               RETURN r_success
            END IF 
            CALL adbt510_03(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900,g_xmeg4_d[l_ac].xmjb014,g_xmeg4_d[l_ac].xmjb030,g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb025)
            RETURNING l_xmjb031,l_xmjb032
            CALL s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg4_d[l_ac].xmjbseq,g_xmee_m.xmee900) RETURNING r_success  
         END IF
      ELSE
         LET l_cnt = 0
        #SELECT COUNT(*)         #170207-00004#2 170219 by 02749 mark
         SELECT COUNT(xmejseq)   #170207-00004#2 170219 by 02749 add
           INTO l_cnt
           FROM xmej_t
          WHERE xmejent = g_enterprise
            AND xmejdocno = g_xmee_m.xmeedocno
            AND xmejseq = g_xmeg4_d_t.xmjbseq
            AND xmej900 = g_xmee_m.xmee900
         IF l_cnt > 0 THEN
            UPDATE xmej_t
               SET xmej003 = g_xmeg4_d[l_ac].xmjb031,
                   xmej004 = g_xmeg4_d[l_ac].xmjb032,
                   xmej901 = CASE WHEN xmej901 = '1' THEN '2' ELSE xmej901 END
             WHERE xmejent = g_enterprise
               AND xmejdocno = g_xmee_m.xmeedocno
               AND xmejseq = g_xmeg4_d_t.xmjbseq
               AND xmej900 = g_xmee_m.xmee900
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "xmej_t"
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET r_success = FALSE
               RETURN r_success
            END IF 
         END IF
      END IF
   END IF
   RETURN r_success
END FUNCTION

PRIVATE FUNCTION adbt510_get_isaf011()
DEFINE l_isaf011       LIKE isaf_t.isaf011
   
   LET g_xmee_m.isaf011 = ''
   DECLARE adbt510_isaf_cl1 CURSOR FOR
    SELECT DISTINCT isaf011
      FROM isaf_t,isag_t
     WHERE isafent = isagent
       AND isafcomp = isagcomp
       AND isafdocno = isagdocno
       AND isafent = g_enterprise
       AND isaf001 = '1'
       AND isag001 = 'axmt500'
       AND isag002 = g_xmee_m.xmeedocno
       AND isaf011 IS NOT NULL
       ORDER BY isaf011
       
   FOREACH adbt510_isaf_cl1 INTO l_isaf011
      IF cl_null(g_xmee_m.isaf011) THEN
         LET g_xmee_m.isaf011 = l_isaf011
      ELSE
         LET g_xmee_m.isaf011 = g_xmee_m.isaf011,",",l_isaf011
      END IF
   END FOREACH
END FUNCTION
#依據運輸方式所設置的運輸類型(ACC='263'對應的參考欄位16)檢核起目的地的合理性
PRIVATE FUNCTION adbt510_location_chk(p_location,p_oocq019)
   DEFINE p_location            LIKE type_t.chr10     #地點
   DEFINE l_n                   LIKE type_t.num5
   DEFINE l_stus                LIKE type_t.chr10
   DEFINE p_oocq019             LIKE oocq_t.oocq019

   LET g_errno = ''
   LET l_n = 0
   LET l_stus = ''

   CASE
      WHEN p_oocq019 ='1' OR   #1:陸運
           p_oocq019 ='4'      #4:其它    
         LET l_n=0
         SELECT COUNT(oock003) INTO l_n
           FROM oock_t
          WHERE oockent = g_enterprise
            AND oock003 = p_location
            AND oockstus = 'Y'

             #輸入資料不存在 縣市資料檔 中！
          IF l_n = 0 THEN LET g_errno = 'aoo-00015' RETURN END IF

      WHEN p_oocq019 ='2'      #2:海運
         SELECT oocqstus INTO l_stus
           FROM oocq_t
          WHERE oocqent = g_enterprise
            AND oocq001 = '262'
            AND oocq002 = p_location

         CASE
            WHEN SQLCA.sqlcode = 100
               #LET g_errno = 'axm-00032' #160318-00005#6 mark
               #160318-00005#6 --s add
               LET g_errno = 'sub-01303'  
               LET g_errparam.replace[1] = 'apmi010'
               LET g_errparam.replace[2] = cl_get_progname('apmi010',g_lang,"2")
               LET g_errparam.exeprog = 'apmi010'
               #160318-00005#6 --e add
            WHEN l_stus <> 'Y'
               #LET g_errno = 'axm-00033' #160318-00005#6 mark
               #160318-00005#6 --s add
               LET g_errno = 'sub-01302'  
               LET g_errparam.replace[1] = 'apmi010'
               LET g_errparam.replace[2] = cl_get_progname('apmi010',g_lang,"2")
               LET g_errparam.exeprog = 'apmi010'
               #160318-00005#6 --e add
            OTHERWISE
               LET g_errno = SQLCA.sqlcode USING '------'
         END CASE

      WHEN p_oocq019 ='3'      #3:空運                     
         SELECT oocqstus INTO l_stus
           FROM oocq_t
          WHERE oocqent = g_enterprise
            AND oocq001 = '276'
            AND oocq002 = p_location

         CASE
            WHEN SQLCA.sqlcode = 100
               #LET g_errno = 'axm-00086' #160318-00005#6 mark
               #160318-00005#6 --s add
               LET g_errno = 'sub-01303'  
               LET g_errparam.replace[1] = 'apmi014'
               LET g_errparam.replace[2] = cl_get_progname('apmi014',g_lang,"2")
               LET g_errparam.exeprog = 'apmi014'
               #160318-00005#6 --e add
               
            WHEN l_stus <> 'Y'
               #LET g_errno = 'axm-00087' #160318-00005#6 mark
               #160318-00005#6 --s add
               LET g_errno = 'sub-01302'  
               LET g_errparam.replace[1] = 'apmi014'
               LET g_errparam.replace[2] = cl_get_progname('apmi014',g_lang,"2")
               LET g_errparam.exeprog = 'apmi014'
               #160318-00005#6 --e add
            OTHERWISE
               LET g_errno = SQLCA.sqlcode USING '------'
         END CASE

   END CASE
   RETURN

END FUNCTION
#維護多期預付款單身
PRIVATE FUNCTION adbt510_open_xmef()
DEFINE  l_cmd           LIKE type_t.chr1
DEFINE  l_ac_t          LIKE type_t.num5                #未取消的ARRAY CNT 
DEFINE  l_n             LIKE type_t.num5                #檢查重複用  
DEFINE  l_cnt           LIKE type_t.num5                #檢查重複用  
DEFINE  l_lock_sw       LIKE type_t.chr1                #單身鎖住否  
DEFINE  l_allow_insert  LIKE type_t.num5                #可新增否 
DEFINE  l_allow_delete  LIKE type_t.num5                #可刪除否  
DEFINE  l_count         LIKE type_t.num5
DEFINE  l_i             LIKE type_t.num5
DEFINE  l_insert        BOOLEAN
DEFINE  ls_return       STRING
DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
DEFINE  l_vars          DYNAMIC ARRAY OF STRING
DEFINE  l_fields        DYNAMIC ARRAY OF STRING
DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
DEFINE  l_xmef005       LIKE xmef_t.xmef005
DEFINE  l_xmef006       LIKE xmef_t.xmef006
DEFINE  l_forupd_sql    STRING
DEFINE  l_success       LIKE type_t.num5
DEFINE  l_sum           LIKE xmef_t.xmef005
DEFINE  l_ooib007       LIKE ooib_t.ooib007

   IF g_xmee_m.xmeedocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF
   
   SELECT UNIQUE xmeesite,xmeedocno,xmee001,xmeedocdt,xmee002,
                 xmee004,xmee003,xmeestus,xmee005,xmee006,
                 xmee007,xmee008,xmee027,xmee009,
                 xmee010,xmee011,xmee012,xmee013,xmee035,
                 xmee015,xmee016,xmee017,xmee018,xmee019,
                 xmee023,xmee032,xmee071,xmee021,xmee022,
                 xmee034,xmee024,xmee028,xmee041,
                 xmee042,xmee043,xmee025,xmee026,xmee020,
                 xmee036,xmeeownid,xmeeowndp,
                 xmeecrtid,xmeecrtdp,xmeecrtdt,xmeemodid,xmeemoddt,
                 xmeecnfid,xmeecnfdt,xmee900,xmee901,xmee902,xmee903,xmee904
                 
     INTO g_xmee_m.xmeesite,g_xmee_m.xmeedocno,g_xmee_m.xmee001,g_xmee_m.xmeedocdt,g_xmee_m.xmee002,
          g_xmee_m.xmee004,g_xmee_m.xmee003,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee006,
          g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmee027,g_xmee_m.xmee009,
          g_xmee_m.xmee010,g_xmee_m.xmee011,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,
          g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee017,g_xmee_m.xmee018,g_xmee_m.xmee019,
          g_xmee_m.xmee023,g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee021,g_xmee_m.xmee022,
          g_xmee_m.xmee034,g_xmee_m.xmee024,g_xmee_m.xmee028,g_xmee_m.xmee041,
          g_xmee_m.xmee042,g_xmee_m.xmee043,g_xmee_m.xmee025,g_xmee_m.xmee026,g_xmee_m.xmee020,
          g_xmee_m.xmee036,g_xmee_m.xmeeownid,g_xmee_m.xmeeowndp,
          g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemoddt,
          g_xmee_m.xmeecnfid,g_xmee_m.xmeecnfdt,g_xmee_m.xmee900,g_xmee_m.xmee901,g_xmee_m.xmee902,g_xmee_m.xmee903,g_xmee_m.xmee904
          
     FROM xmee_t
    WHERE xmeeent = g_enterprise AND xmeedocno = g_xmee_m.xmeedocno AND xmee900 = g_xmee_m.xmee900
 
   ERROR ""
  
   CALL s_transaction_begin()
           
   OPEN adbt510_cl2 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900

   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN adbt510_cl2:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE adbt510_cl2
      CALL s_transaction_end('N','0')
      RETURN
   END IF

   #鎖住將被更改或取消的資料
    FETCH adbt510_cl2 INTO g_xmee_m.xmeesite,g_xmee_m.xmeedocno,g_xmee_m.xmee001, 
       g_xmee_m.xmeedocdt,g_xmee_m.xmee004,g_xmee_m.xmee004_desc,g_xmee_m.xmee002,g_xmee_m.xmee002_desc, 
       g_xmee_m.xmee003,g_xmee_m.xmee003_desc,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee006,g_xmee_m.xmee007, 
       g_xmee_m.xmee008,g_xmee_m.xmee027,g_xmee_m.xmee027_desc,g_xmee_m.xmee009,g_xmee_m.xmee009_desc, 
       g_xmee_m.xmee010,g_xmee_m.xmee010_desc,g_xmee_m.xmee011,g_xmee_m.xmee011_desc,g_xmee_m.xmee012, 
       g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee035_desc,g_xmee_m.xmee015,g_xmee_m.xmee015_desc, 
       g_xmee_m.xmee016,g_xmee_m.xmee017,g_xmee_m.xmee017_desc,g_xmee_m.xmee018,g_xmee_m.xmee018_desc, 
       g_xmee_m.xmee019,g_xmee_m.xmee023,g_xmee_m.xmee023_desc,g_xmee_m.xmee032,g_xmee_m.xmee032_desc, 
       g_xmee_m.xmee071,g_xmee_m.xmee021,g_xmee_m.xmee021_desc,g_xmee_m.xmee022,g_xmee_m.xmee022_desc, 
       g_xmee_m.xmee034,g_xmee_m.xmee034_desc,g_xmee_m.xmee024,g_xmee_m.xmee024_desc,
       g_xmee_m.xmee028,g_xmee_m.xmee041,g_xmee_m.xmee042,g_xmee_m.xmee043,g_xmee_m.xmee025,g_xmee_m.xmee025_desc,g_xmee_m.oofb017, 
       g_xmee_m.xmee026,g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1,g_xmee_m.xmee020,g_xmee_m.xmee020_desc, 
       g_xmee_m.xmee036, 
       g_xmee_m.xmee036_desc,g_xmee_m.xmeeownid,g_xmee_m.xmeeownid_desc,g_xmee_m.xmeeowndp, 
       g_xmee_m.xmeeowndp_desc,g_xmee_m.xmeecrtid,g_xmee_m.xmeecrtid_desc,g_xmee_m.xmeecrtdp,g_xmee_m.xmeecrtdp_desc, 
       g_xmee_m.xmeecrtdt,g_xmee_m.xmeemodid,g_xmee_m.xmeemodid_desc,g_xmee_m.xmeemoddt,g_xmee_m.xmeecnfid, 
       g_xmee_m.xmeecnfid_desc,g_xmee_m.xmeecnfdt
 
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_xmee_m.xmeedocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE adbt510_cl2
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   CALL adbt510_show()  
   LET g_forupd_sql = "SELECT xmefsite,xmef001,xmef002,'',xmef003,xmef004,xmef005,xmef006,xmef007,xmef008,xmef009,xmef901,xmef902,'',xmef903,xmef016,xmef017 FROM xmef_t WHERE xmefent=? AND xmefdocno=? AND xmef900=? AND xmef001=? FOR UPDATE"

   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE adbt510_bcl15 CURSOR FROM g_forupd_sql

   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'

   DISPLAY BY NAME g_xmee_m.xmeesite,g_xmee_m.xmeedocno,g_xmee_m.xmee001,g_xmee_m.xmeedocdt,g_xmee_m.xmee002,
                   g_xmee_m.xmee004,g_xmee_m.xmee003,g_xmee_m.xmeestus,g_xmee_m.xmee005,g_xmee_m.xmee006,
                   g_xmee_m.xmee007,g_xmee_m.xmee008,g_xmee_m.xmee027,g_xmee_m.xmee009,
                   g_xmee_m.xmee010,g_xmee_m.xmee011,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,
                   g_xmee_m.xmee015,g_xmee_m.xmee016,g_xmee_m.xmee017,g_xmee_m.xmee018,g_xmee_m.xmee019,
                   g_xmee_m.xmee023,g_xmee_m.xmee032,g_xmee_m.xmee043,g_xmee_m.xmee021,g_xmee_m.xmee022,
                   g_xmee_m.xmee034,g_xmee_m.xmee024,g_xmee_m.xmee028,g_xmee_m.xmee025,
                   g_xmee_m.xmee026,g_xmee_m.xmee020,g_xmee_m.xmee036,
                   g_xmee_m.xmee900,g_xmee_m.xmee903,g_xmee_m.xmee904
                  
   
   LET g_errshow = 1
   
   LET g_flag1 = TRUE
   CALL adbt510_set_entry('u')
   CALL adbt510_set_no_entry('u')
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      INPUT BY NAME g_xmee_m.xmee039 ATTRIBUTE(WITHOUT DEFAULTS)         
                        
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
            UPDATE xmee_t SET xmee039 = g_xmee_m.xmee039 
              WHERE xmeeent = g_enterprise AND xmeedocno = g_xmee_m.xmeedocno
                AND xmee900 =  g_xmee_m.xmee900
            CASE
               WHEN SQLCA.sqlerrd[3] = 0                   #更新不到的處理
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = "std-00009"
                  LET g_errparam.extend = "xmee_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
               WHEN SQLCA.sqlcode                          #其他錯誤
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "xmee_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
               OTHERWISE
                  CALL s_transaction_end('Y','0')
            END CASE              
            IF NOT adbt510_upd_xmee901() THEN
               CONTINUE DIALOG
            END IF  
      END INPUT
      
      INPUT ARRAY g_xmeg5_d FROM s_detail5.*
         ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                 INSERT ROW = l_allow_insert,
                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 

         BEFORE INPUT
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_xmeg5_d.getLength()+1) 
              LET g_insert = 'N' 
            END IF

            CALL s_tax_chk(g_xmee_m.xmeesite,g_xmee_m.xmee011)
               RETURNING l_success,g_oodbl004,g_oodb005,g_oodb006,g_tax_app

            CALL adbt510_b_fill()
            LET g_rec_b = g_xmeg5_d.getLength()
            
         BEFORE INSERT
            
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xmeg5_d[l_ac].* TO NULL 
            LET g_xmeg5_d[l_ac].xmefsite = g_xmee_m.xmeesite
            LET g_xmeg5_d[l_ac].xmef004 = g_today
            #DISPLAY BY NAME g_xmeg5_d[l_ac].xmef004
            LET g_xmeg5_d[l_ac].xmef901 = '3'       #單身新增
            LET g_xmeg5_d[l_ac].xmef016 = "2"
            LET g_xmeg5_d[l_ac].xmef017 = "1"
            
            SELECT MAX(xmef001)+1 INTO g_xmeg5_d[l_ac].xmef001 FROM xmef_t
              WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno
                AND xmef900 = g_xmee_m.xmee900
            IF cl_null(g_xmeg5_d[l_ac].xmef001) OR g_xmeg5_d[l_ac].xmef001 = 0 THEN
               LET g_xmeg5_d[l_ac].xmef001 = 1
            END IF
            
            LET g_xmeg5_d_t.* = g_xmeg5_d[l_ac].*     #新輸入資料
            LET g_xmeg5_d_o.* = g_xmeg5_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL adbt510_set_entry_b(l_cmd)

            CALL adbt510_set_no_entry_b(l_cmd)
            
         BEFORE ROW     
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()

           
            LET g_rec_b = g_xmeg5_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xmeg5_d[l_ac].xmef001 IS NOT NULL
            THEN 
               LET l_cmd = 'u'
               LET g_xmeg5_d_t.* = g_xmeg5_d[l_ac].*  #BACKUP
               LET g_xmeg5_d_o.* = g_xmeg5_d[l_ac].*  #BACKUP
               CALL adbt510_set_entry_b(l_cmd)
               CALL adbt510_set_no_entry_b(l_cmd)
               
               OPEN adbt510_bcl15 USING g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg5_d[l_ac].xmef001
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "adbt510_bcl15"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET l_lock_sw = 'Y'
               ELSE
                  FETCH adbt510_bcl15 INTO g_xmeg5_d[l_ac].xmefsite,g_xmeg5_d[l_ac].xmef001,g_xmeg5_d[l_ac].xmef002,g_xmeg5_d[l_ac].xmef002_desc,g_xmeg5_d[l_ac].xmef003,
                                           g_xmeg5_d[l_ac].xmef004,g_xmeg5_d[l_ac].xmef005,g_xmeg5_d[l_ac].xmef006,g_xmeg5_d[l_ac].xmef007,g_xmeg5_d[l_ac].xmef008,
                                           g_xmeg5_d[l_ac].xmef009,g_xmeg5_d[l_ac].xmef901,g_xmeg5_d[l_ac].xmef902,g_xmeg5_d[l_ac].xmef902_desc,g_xmeg5_d[l_ac].xmef903,
                                           g_xmeg5_d[l_ac].xmef016,g_xmeg5_d[l_ac].xmef017
                   IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = 'Y'
                  END IF
                  
                  LET g_bfill = 'N'
                  CALL adbt510_show()
                  LET g_bfill = 'Y'
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF            
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
               CALL g_xmeg5_d.deleteElement(l_ac)
               NEXT FIELD xmef001
            END IF
         
            IF g_xmeg5_d[l_ac].xmef001 IS NOT NULL
            THEN
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = 'Y' THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF
              
               #已經有應收帳款與已收金額的資料不可以進行刪除
               IF NOT cl_null(g_xmeg5_d[l_ac].xmef007) OR NOT cl_null(g_xmeg5_d[l_ac].xmef008) OR
                  NOT cl_null(g_xmeg5_d[l_ac].xmef009) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'axm-00396'
                  LET g_errparam.extend = g_xmeg5_d[l_ac].xmef001
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE                     
               END IF 
               
               DELETE FROM xmef_t
                WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno AND
                      xmef001 = g_xmeg5_d_t.xmef001 AND xmef900 = g_xmee_m.xmee900

               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "pmdn_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE   
               ELSE
                  LET g_rec_b = g_rec_b-1

                  CALL s_transaction_end('Y','0')
               END IF 
               LET l_count = g_xmeg_d.getLength()
            END IF 

         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CLOSE adbt510_bcl15
               CANCEL INSERT
            END IF
               
            LET l_count = 1  
           #SELECT COUNT(*) INTO l_count FROM xmef_t          #170207-00004#2 170219 by 02749 mark
            SELECT COUNT(xmef001) INTO l_count FROM xmef_t    #170207-00004#2 170219 by 02749 add
             WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno
               AND xmef001 = g_xmeg5_d[l_ac].xmef001 AND xmef900 = g_xmee_m.xmee900
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               INSERT INTO xmef_t
                  (xmefent,xmefdocno,xmef001,
                   xmefsite,xmef002,xmef003,
                   xmef004,xmef005,xmef006,
                   xmef007,xmef008,xmef009,
                   xmef900,xmef901,xmef902,
                   xmef903,xmef016,xmef017) 
                 VALUES(g_enterprise,g_xmee_m.xmeedocno,g_xmeg5_d[l_ac].xmef001,
                   g_xmeg5_d[l_ac].xmefsite,g_xmeg5_d[l_ac].xmef002,g_xmeg5_d[l_ac].xmef003, 
                   g_xmeg5_d[l_ac].xmef004,g_xmeg5_d[l_ac].xmef005,g_xmeg5_d[l_ac].xmef006, 
                   g_xmeg5_d[l_ac].xmef007,g_xmeg5_d[l_ac].xmef008,g_xmeg5_d[l_ac].xmef009,
                   g_xmee_m.xmee900,g_xmeg5_d[l_ac].xmef901,g_xmeg5_d[l_ac].xmef902,
                   g_xmeg5_d[l_ac].xmef903,g_xmeg5_d[l_ac].xmef016,g_xmeg5_d[l_ac].xmef017) 

               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "xmef_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
  
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               ELSE
                  #將單身資料寫入歷程檔中               
                  IF NOT adbt510_xmef_ins_xmek(g_xmeg5_d[l_ac].*) THEN
                     LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
                     CALL s_transaction_end('N','0')
                  END IF 
               END IF
            ELSE    
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_xmeg_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
            
            CALL s_transaction_end('Y','0')
            ERROR 'INSERT O.K'
            LET g_rec_b = g_rec_b + 1
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
            ELSE
               IF g_xmeg5_d[l_ac].xmef901 = '1' THEN
                  LET g_xmeg5_d[l_ac].xmef901 = '2'
               END IF
            
               UPDATE xmef_t SET (xmefdocno,xmefsite,xmef001,xmef002,xmef003,xmef004,
                                  xmef005,xmef006,xmef007,xmef008,xmef009,
                                  xmef901,xmef902,xmef903,xmef016,xmef017)
                               = (g_xmee_m.xmeedocno,g_xmeg5_d[l_ac].xmefsite,g_xmeg5_d[l_ac].xmef001,g_xmeg5_d[l_ac].xmef002,g_xmeg5_d[l_ac].xmef003,g_xmeg5_d[l_ac].xmef004,
                                  g_xmeg5_d[l_ac].xmef005,g_xmeg5_d[l_ac].xmef006,g_xmeg5_d[l_ac].xmef007,g_xmeg5_d[l_ac].xmef008,g_xmeg5_d[l_ac].xmef009,
                                  g_xmeg5_d[l_ac].xmef901,g_xmeg5_d[l_ac].xmef902,g_xmeg5_d[l_ac].xmef903,g_xmeg5_d[l_ac].xmef016,g_xmeg5_d[l_ac].xmef017) #自訂欄位頁簽
                WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno
                  AND xmef001 = g_xmeg5_d_t.xmef001 
                  AND xmef900 = g_xmee_m.xmee900                   
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "xmef_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "xmef_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
  
                     CALL s_transaction_end('N','0')
                     LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
                  OTHERWISE
#                      INITIALIZE gs_keys TO NULL 
#                      LET gs_keys[1] = g_xmee_m.xmeedocno
#                      LET gs_keys_bak[1] = g_xmeedocno_t
#                      LET gs_keys[2] = g_xmeg5_d[g_detail_idx].xmef001
#                      LET gs_keys_bak[2] = g_xmeg5_d_t.xmef001
#                      CALL adbt510_update_b('xmef_t',gs_keys,gs_keys_bak,"'5'")
                     #資料多語言用-增/改
               END CASE
               IF NOT SQLCA.sqlcode THEN
                  #將單身資料寫入歷程檔中               
                  IF NOT adbt510_xmef_ins_xmek(g_xmeg5_d[l_ac].*) THEN
                     LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
                     CALL s_transaction_end('N','0')
                  END IF 
               END IF
            END IF
         
         #---------------------<  Detail: page5  >---------------------
         #----<<xmef001>>----
         #此段落由子樣板a02產生
         AFTER FIELD xmef001
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_xmeg5_d[l_ac].xmef001,"0.000","0","","","azz-00079",1) THEN
               LET g_xmeg5_d[l_ac].xmef001 = g_xmeg5_d_t.xmef001
               NEXT FIELD xmef001
            END IF

            #此段落由子樣板a05產生
            IF  g_xmee_m.xmeedocno IS NOT NULL AND g_xmeg5_d[l_ac].xmef001 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xmee_m.xmeedocno != g_xmeedocno_t OR g_xmeg5_d[l_ac].xmef001 != g_xmeg5_d_t.xmef001)) THEN 
                 #IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xmef_t WHERE "||"xmefent = '" ||g_enterprise|| "' AND "||"xmefdocno = '"||g_xmee_m.xmeedocno ||"' AND "|| "xmef001 = '"||g_xmeg5_d[l_ac].xmef001 ||"' AND "|| "xmef900 = '"||g_xmee_m.xmee900 ||"'",'std-00004',0) THEN          #170207-00004#2 170219 by 02749 mark
                  IF NOT ap_chk_notDup("","SELECT COUNT(xmef001) FROM xmef_t WHERE "||"xmefent = '" ||g_enterprise|| "' AND "||"xmefdocno = '"||g_xmee_m.xmeedocno ||"' AND "|| "xmef001 = '"||g_xmeg5_d[l_ac].xmef001 ||"' AND "|| "xmef900 = '"||g_xmee_m.xmee900 ||"'",'std-00004',0) THEN    #170207-00004#2 170219 by 02749 add
                     LET g_xmeg5_d[l_ac].xmef001 = g_xmeg5_d_t.xmef001
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

         #----<<xmef002>>----
         #此段落由子樣板a02產生
         AFTER FIELD xmef002
            IF NOT cl_null(g_xmeg5_d[l_ac].xmef002) THEN 
               IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_xmeg5_d[l_ac].xmef002 != g_xmeg5_d_t.xmef002 OR g_xmeg5_d_t.xmef002 IS NULL )) THEN
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_xmee_m.xmee004
                  LET g_chkparam.arg2 = g_xmeg5_d[l_ac].xmef002
                     
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pmad002_2") THEN
                     #檢查失敗時後續處理
                     LET g_xmeg5_d[l_ac].xmef002 = g_xmeg5_d_t.xmef002
                     CALL s_desc_get_ooib002_desc(g_xmeg5_d[l_ac].xmef002) RETURNING g_xmeg5_d[l_ac].xmef002_desc
                     DISPLAY BY NAME g_xmeg5_d[l_ac].xmef002_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
               IF l_cmd = 'a' THEN
                  LET l_ooib007 = ''
                  SELECT ooib007 INTO l_ooib007
                    FROM ooib_t
                   WHERE ooibent = g_enterprise
                     AND ooib002 = g_xmeg5_d[l_ac].xmef002
                  IF l_ooib007 = 'Y' THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'adb-00299'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = FALSE
                     CALL cl_err()
                     
                     LET g_xmeg5_d[l_ac].xmef002 = g_xmeg5_d_t.xmef002
                     CALL s_desc_get_ooib002_desc(g_xmeg5_d[l_ac].xmef002) RETURNING g_xmeg5_d[l_ac].xmef002_desc
                     DISPLAY BY NAME g_xmeg5_d[l_ac].xmef002_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF 
            CALL s_desc_get_ooib002_desc(g_xmeg5_d[l_ac].xmef002) RETURNING g_xmeg5_d[l_ac].xmef002_desc
            DISPLAY BY NAME g_xmeg5_d[l_ac].xmef002_desc
            
         AFTER FIELD xmef003
            IF g_xmeg5_d[l_ac].xmef003 > g_xmeg5_d[l_ac].xmef004 THEN
               LET g_xmeg5_d[l_ac].xmef003 = g_xmeg5_d_t.xmef003
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'adb-00080'
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               NEXT FIELD xmef003
            END IF  
            
         AFTER FIELD xmef004
            IF g_xmeg5_d[l_ac].xmef004 < g_xmeg5_d[l_ac].xmef003 THEN
               LET g_xmeg5_d[l_ac].xmef004 = g_xmeg5_d_t.xmef004
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'adb-00080'
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               NEXT FIELD xmef004
            END IF  

         #----<<xmef005>>----
         #此段落由子樣板a02產生
         AFTER FIELD xmef005
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_xmeg5_d[l_ac].xmef005,"0.000","0","","","azz-00079",1) THEN
               LET g_xmeg5_d[l_ac].xmef005 = g_xmeg5_d_t.xmef005
               NEXT FIELD xmef005
            END IF
            IF NOT cl_null(g_xmeg5_d[l_ac].xmef005) THEN
#               IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_xmeg5_d[l_ac].xmef005 != g_xmeg5_d_o.xmef005 OR g_xmeg5_d_o.xmef005 IS NULL )) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmeg5_d[l_ac].xmef005 != g_xmeg5_d_o.xmef005 OR cl_null(g_xmeg5_d_o.xmef005) THEN   #150427-00012#8 20150728 add by beckxie
                   LET l_sum = 0
                   FOR l_i = 1 TO g_xmeg5_d.getLength()
                      LET l_sum = l_sum + g_xmeg5_d[l_i].xmef005
                   END FOR
                   IF l_sum > g_xmee_m.xmee041 THEN
                      LET g_xmeg5_d[l_ac].xmef005 = g_xmeg5_d_t.xmef005
                      INITIALIZE g_errparam TO NULL
                      LET g_errparam.code = 'adb-00086'
                      LET g_errparam.extend = ''
                      LET g_errparam.popup = FALSE
                      CALL cl_err()
                   
                      NEXT FIELD xmef005
                   END IF
                   
                   #稅率依單頭需自動推算未稅金額
                   IF g_tax_app = '1' THEN
                     IF cl_null(g_xmeg5_d[l_ac].xmef006) OR g_xmeg5_d[l_ac].xmef006 = 0 OR 
                         g_xmeg5_d[l_ac].xmef006 = g_xmeg5_d_t.xmef006 THEN
                         CALL s_tax_get_xrcd105(g_xmeg5_d[l_ac].xmef005,g_xmee_m.xmee012,g_xmee_m.xmee015)
                           RETURNING g_xmeg5_d[l_ac].xmef006
                         DISPLAY BY NAME g_xmeg5_d[l_ac].xmef006  
                     END IF
                   END IF
                   LET g_xmeg5_d_o.xmef005 = g_xmeg5_d[l_ac].xmef005
                END IF
             END IF
         #----<<xmef006>>----
         #此段落由子樣板a02產生
         AFTER FIELD xmef006
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_xmeg5_d[l_ac].xmef006,"0.000","0","","","azz-00079",1) THEN
               LET g_xmeg5_d[l_ac].xmef006 = g_xmeg5_d_t.xmef006
               NEXT FIELD xmef006
            END IF
            IF NOT cl_null(g_xmeg5_d[l_ac].xmef006) THEN
#               IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_xmeg5_d[l_ac].xmef006 != g_xmeg5_d_o.xmef006 OR g_xmeg5_d_o.xmef006 IS NULL )) THEN   #150427-00012#8 20150728 mark by beckxie
               IF g_xmeg5_d[l_ac].xmef006 != g_xmeg5_d_o.xmef006 OR cl_null(g_xmeg5_d_o.xmef006) THEN   #150427-00012#8 20150728 add by beckxie
                  LET l_sum = 0
                  FOR l_i = 1 TO g_xmeg5_d.getLength()
                     LET l_sum = l_sum + g_xmeg5_d[l_i].xmef006
                  END FOR
                  IF l_sum > g_xmee_m.xmee042 THEN
                     LET g_xmeg5_d[l_ac].xmef006 = g_xmeg5_d_t.xmef006
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'adb-00087'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = FALSE
                     CALL cl_err()
                  
                     NEXT FIELD xmef006
                  END IF
                   #稅率依單頭需含稅金額自動推算未稅金額
                   IF g_tax_app = '1' THEN
                      IF cl_null(g_xmeg5_d[l_ac].xmef005) OR g_xmeg5_d[l_ac].xmef005 = 0 OR 
                          g_xmeg5_d[l_ac].xmef005 = g_xmeg5_d_t.xmef005 THEN
                          CALL s_tax_get_xrcd103(g_xmeg5_d[l_ac].xmef006,g_xmee_m.xmee012,g_xmee_m.xmee015)
                            RETURNING g_xmeg5_d[l_ac].xmef005
                          DISPLAY BY NAME g_xmeg5_d[l_ac].xmef005  
                      END IF
                   END IF
                   LET g_xmeg5_d_o.xmef006 = g_xmeg5_d[l_ac].xmef006
               END IF
            END IF   
            
         AFTER FIELD xmef902
            IF NOT cl_null(g_xmeg5_d[l_ac].xmef902) THEN
               #02749  150122 add ----------------------(S)
               #IF NOT s_azzi650_chk_exist('267',g_xmeg5_d[l_ac].xmef902) THEN
               IF NOT s_azzi650_chk_exist(g_acc_282,g_xmeg5_d[l_ac].xmef902) THEN
               #02749  150122 add ----------------------(E)
                  LET g_xmeg5_d[l_ac].xmef902 = g_xmeg5_d_t.xmef902
                  NEXT FIELD xmef902
               END IF
            END IF
            #02749  150122 add ----------------------(S)
            #CALL s_desc_get_acc_desc('267',g_xmeg5_d[l_ac].xmef902) RETURNING g_xmeg5_d[l_ac].xmef902_desc
            CALL s_desc_get_acc_desc(g_acc_282,g_xmeg5_d[l_ac].xmef902) RETURNING g_xmeg5_d[l_ac].xmef902_desc
            #02749  150122 add ----------------------(E)
            
         #---------------------<  Detail: page5  >---------------------
         #----<<xmef002>>----
         #Ctrlp:input.c.page5.xmef002
         ON ACTION controlp INFIELD xmef002
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xmeg5_d[l_ac].xmef002             #給予default值
            LET g_qryparam.arg1 = g_xmee_m.xmee004
            CALL q_pmad002_3()                                #呼叫開窗
            LET g_xmeg5_d[l_ac].xmef002 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_xmeg5_d[l_ac].xmef002 TO xmef002              #顯示到畫面上
            CALL s_desc_get_ooib002_desc(g_xmeg5_d[l_ac].xmef002) RETURNING g_xmeg5_d[l_ac].xmef002_desc
            DISPLAY BY NAME g_xmeg5_d[l_ac].xmef002_desc
            NEXT FIELD xmef002                          #返回原欄位
         ON ACTION controlp INFIELD xmef902
             #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmeg5_d[l_ac].xmef902             #給予default值
            LET g_qryparam.default2 = "" 
            #給予arg
            #02749  150121  add ----------------------(S)
            #LET g_qryparam.arg1 = '267'
            LET g_qryparam.arg1 = g_acc_282
            #02749  150121  add ----------------------(E)
            CALL q_oocq002()                                #呼叫開窗

            LET g_xmeg5_d[l_ac].xmef902 = g_qryparam.return1              
            DISPLAY g_xmeg5_d[l_ac].xmef902 TO xmef902
            #02749  150122 add ----------------------(S)            
            #CALL s_desc_get_acc_desc('267',g_xmeg5_d[l_ac].xmef902) RETURNING g_xmeg5_d[l_ac].xmef902_desc            
            CALL s_desc_get_acc_desc(g_acc_282,g_xmeg5_d[l_ac].xmef902) RETURNING g_xmeg5_d[l_ac].xmef902_desc   
            #02749  150122 add ----------------------(E)
            NEXT FIELD xmef902                              #返回原欄位


 
         AFTER ROW
            LET l_ac = ARR_CURR()
            LET l_ac_t = l_ac

            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xmeg5_d[l_ac].* = g_xmeg5_d_t.*
               END IF
               CLOSE adbt510_bcl15
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
            
            #多帳期預付款金額加總不可超過整張訂購單總訂購金額(含未稅金額均不能超過)
            LET l_xmef005 = 0
            LET l_xmef006 = 0
            SELECT SUM(xmef005),SUM(xmef006) 
              INTO l_xmef005,l_xmef006 FROM xmef_t 
               WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno
                 AND xmef900 = g_xmee_m.xmee900

            IF l_xmef005 > g_xmee_m.xmee041 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'apm-00263'
               LET g_errparam.extend = g_xmee_m.xmeedocno
               LET g_errparam.popup = TRUE
               CALL cl_err()

               NEXT FIELD xmef005
            END IF
            IF l_xmef006 > g_xmee_m.xmee042 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'apm-00264'
               LET g_errparam.extend = g_xmee_m.xmeedocno
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_xmeg5_d[l_ac].xmef006 = g_xmeg5_d_t.xmef006
               NEXT FIELD xmef006
            END IF
            
            #其他table進行unlock
            CLOSE adbt510_bcl15
            CALL s_transaction_end('Y','0')  
            
         AFTER INPUT
            #多帳期預付款金額加總不可超過整張訂購單總訂金額(含未稅金額均不能超過)
            LET l_xmef005 = 0
            LET l_xmef006 = 0
            SELECT SUM(xmef005),SUM(xmef006) 
              INTO l_xmef005,l_xmef006 FROM xmef_t 
             WHERE xmefent = g_enterprise AND xmefdocno = g_xmee_m.xmeedocno
               AND xmef900 = g_xmee_m.xmee900
            IF l_xmef005 > g_xmee_m.xmee041 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'apm-00263'
               LET g_errparam.extend = g_xmee_m.xmeedocno
               LET g_errparam.popup = TRUE
               CALL cl_err()

               NEXT FIELD xmef005
            END IF
            IF l_xmef006 > g_xmee_m.xmee042 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'apm-00264'
               LET g_errparam.extend = g_xmee_m.xmeedocno
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_xmeg5_d[l_ac].xmef006 = g_xmeg5_d_t.xmef006
               NEXT FIELD xmef006
            END IF
 
      END INPUT
   
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         CALL cl_set_head_visible("","AUTO")
 
      ON ACTION accept
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
         
   END DIALOG

   CLOSE adbt510_cl2
   LET g_flag1 = FALSE
   IF INT_FLAG THEN
      LET INT_FLAG = FALSE
   END IF
   
END FUNCTION

PRIVATE FUNCTION adbt510_set_required_b()
   DEFINE l_imaf015     LIKE imaf_t.imaf015
   DEFINE l_imaa106     LIKE imaa_t.imaa106
   DEFINE l_pmaa002     LIKE pmaa_t.pmaa002
   
      IF l_ac > 0 THEN
         SELECT imaf015
           INTO l_imaf015
           FROM imaf_t
          WHERE imafent = g_enterprise
            AND imafsite = 'ALL'  #g_xmee_m.xmeesite
            AND imaf001 = g_xmeg4_d[l_ac].xmjb003
         IF NOT cl_null(l_imaf015) THEN
            CALL cl_set_comp_required("xmjb015",TRUE)
         END IF
         
         SELECT imaa106
           INTO l_imaa106
           FROM imaa_t
          WHERE imaaent = g_enterprise
            AND imaa001 = g_xmeg4_d[l_ac].xmjb003
          
         IF NOT cl_null(l_imaa106) THEN
            CALL cl_set_comp_required("xmjb017",TRUE)
         END IF
         IF g_xmeg4_d[l_ac].xmjb030 = "N" THEN
            CALL cl_set_comp_required("xmjb031,xmjb032",TRUE) 
         END IF
      END IF
      SELECT pmaa002
        INTO l_pmaa002
        FROM pmaa_t
       WHERE pmaaent = g_enterprise
         AND pmaa001 = g_xmee_m.xmee004
      IF l_pmaa002 = '2' THEN
         CALL cl_set_comp_required("xmjb024",TRUE)
      END IF 
END FUNCTION

PRIVATE FUNCTION adbt510_set_no_required_b()
      CALL cl_set_comp_required("xmjb015,xmjb017",FALSE)  
      CALL cl_set_comp_required("xmjb024,xmjb031,xmjb032",FALSE)       
END FUNCTION
#單位資料檢查
PRIVATE FUNCTION adbt510_unit_chk(p_xmeg006)
DEFINE p_xmeg006    LIKE xmeg_t.xmeg006
DEFINE r_success    LIKE type_t.num5
       
       LET r_success = TRUE
       
       IF NOT cl_null(p_xmeg006) THEN 
          #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
          INITIALIZE g_chkparam.* TO NULL
          LET g_errshow = TRUE #是否開窗 #160318-00025#28  add
          #設定g_chkparam.*的參數
          LET g_chkparam.arg1 = p_xmeg006
          LET g_chkparam.err_str[1] = "aim-00005:sub-01302|aooi250|",cl_get_progname("aooi250",g_lang,"2"),"|:EXEPROGaooi125"#要執行的建議程式待補 #160318-00025#28  add
          #呼叫檢查存在並帶值的library
          IF NOT cl_chk_exist("v_ooca001") THEN
             LET r_success = FALSE
             RETURN r_success             
          END IF
       END IF 
       RETURN r_success 
END FUNCTION

PRIVATE FUNCTION adbt510_xmjb012_convert()
DEFINE l_rate       LIKE inaj_t.inaj014
DEFINE l_success    LIKE type_t.num5  
     
   IF cl_null(g_xmeg4_d[l_ac].xmjb012) OR cl_null(g_xmeg4_d[l_ac].xmjb011) THEN
      RETURN
   END IF
  #141224-00013#15---sakura---mod---str   
   #銷售數量
   IF NOT cl_null(g_xmeg4_d[l_ac].xmjb013) THEN  
     #CALL s_aimi190_get_convert(g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb013) RETURNING l_success,l_rate
     #LET g_xmeg4_d[l_ac].xmjb014 = g_xmeg4_d[l_ac].xmjb012 * l_rate
      CALL s_aooi250_convert_qty(g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb013,g_xmeg4_d[l_ac].xmjb012) RETURNING l_success,g_xmeg4_d[l_ac].xmjb014
      CALL s_aooi250_take_decimals(g_xmeg4_d[l_ac].xmjb013,g_xmeg4_d[l_ac].xmjb014) RETURNING l_success,g_xmeg4_d[l_ac].xmjb014
   END IF
   #參考單位
   IF NOT cl_null(g_xmeg4_d[l_ac].xmjb015) THEN  
     #CALL s_aimi190_get_convert(g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb015) RETURNING l_success,l_rate
     #LET g_xmeg4_d[l_ac].xmjb016 = g_xmeg4_d[l_ac].xmjb012 * l_rate
      CALL s_aooi250_convert_qty(g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb015,g_xmeg4_d[l_ac].xmjb012) RETURNING l_success,g_xmeg4_d[l_ac].xmjb016
      CALL s_aooi250_take_decimals(g_xmeg4_d[l_ac].xmjb015,g_xmeg4_d[l_ac].xmjb016) RETURNING l_success,g_xmeg4_d[l_ac].xmjb016
   END IF
   #計價數量
   IF NOT cl_null(g_xmeg4_d[l_ac].xmjb017) THEN  
     #CALL s_aimi190_get_convert(g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb017) RETURNING l_success,l_rate
     #LET g_xmeg4_d[l_ac].xmjb018 = g_xmeg4_d[l_ac].xmjb012 * l_rate
      CALL s_aooi250_convert_qty(g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb017,g_xmeg4_d[l_ac].xmjb012) RETURNING l_success,g_xmeg4_d[l_ac].xmjb018
      CALL s_aooi250_take_decimals(g_xmeg4_d[l_ac].xmjb017,g_xmeg4_d[l_ac].xmjb018) RETURNING l_success,g_xmeg4_d[l_ac].xmjb018
   END IF
  #141224-00013#15---sakura---mod---end 
END FUNCTION

PRIVATE FUNCTION adbt510_xmeedocno_chk()
 DEFINE l_n               LIKE type_t.num5
 DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE

   IF cl_null(g_xmee_m.xmeedocno) THEN
      RETURN r_success
   END IF

   INITIALIZE g_chkparam.* TO NULL
	#160815-00016#1 160817 by 02749 add---(S)      
   IF NOT cl_null(g_slip_wc) THEN                
      LET g_chkparam.where = g_slip_wc           
   END IF                                        
   #160815-00016#1 160817 by 02749 add---(E) 
   
   LET g_chkparam.arg1 = g_xmee_m.xmeedocno
   LET g_chkparam.arg2 = g_xmee_m.xmeesite
   #呼叫檢查存在並帶值的library
   IF NOT cl_chk_exist("v_xmdadocno_6") THEN
      #檢查失敗時後續處理
      LET r_success = FALSE
      RETURN r_success
   END IF

   #同一張訂單不能同時有兩張以上未確認的變更單存在
   LET l_n = 0
  #SELECT COUNT(*) INTO l_n           #170207-00004#2 170219 by 02749 mark
   SELECT COUNT(xmeedocno) INTO l_n   #170207-00004#2 170219 by 02749 add
     FROM xmee_t
    WHERE xmeeent = g_enterprise
      AND xmeedocno = g_xmee_m.xmeedocno
      AND xmeestus = 'N'
      
   IF l_n > 0 THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'axm-00221'
      LET g_errparam.extend = g_xmee_m.xmeedocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF

   RETURN r_success
END FUNCTION
#依據輸入的訂單單號，帶出單頭欄位的值
PRIVATE FUNCTION adbt510_xmeedocno_xmee()
   DEFINE  r_success    LIKE type_t.num5
   DEFINE  l_address    STRING
   DEFINE  l_oofb011    LIKE oofb_t.oofb011

   LET r_success = TRUE

   LET g_xmee_m.xmee901 = 'N'         #未變更
   DISPLAY BY NAME g_xmee_m.xmee901
   
   #抓取訂單單單頭資料，顯示在畫面上
   #版本=訂單的版本+1
   SELECT xmda001+1,xmdasite,xmdadocno,xmda002,
          xmda003,xmda004,xmda005,xmda006,xmda007,
          xmda008,xmda027,xmda009,xmda010,
          xmda011,xmda012,xmda013,xmda035,xmda015,
          xmda016,xmda017,xmda018,xmda019,xmda023,
          xmda032,xmda071,xmda021,xmda022,xmda034,
          xmda024,xmda028,xmdadocdt,
          xmda041,xmda042,xmda043,xmda025,xmda026,
          xmda020,xmda036,xmda039,xmda048,xmda049,
          xmda200,xmda201,xmda202,xmda203,xmda204,
          xmda205,xmda206,xmda207,xmdaunit,
          xmda208,xmda209,xmda210,xmda211          
     INTO g_xmee_m.xmee001,g_xmee_m.xmeesite,g_xmee_m.xmeedocno,g_xmee_m.xmee002,
          g_xmee_m.xmee003,g_xmee_m.xmee004,g_xmee_m.xmee005,g_xmee_m.xmee006,g_xmee_m.xmee007,
          g_xmee_m.xmee008,g_xmee_m.xmee027,g_xmee_m.xmee009,g_xmee_m.xmee010,
          g_xmee_m.xmee011,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee015,
          g_xmee_m.xmee016,g_xmee_m.xmee017,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee023,
          g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee034,
          g_xmee_m.xmee024,g_xmee_m.xmee028,g_xmee_m.xmeedocdt,
          g_xmee_m.xmee041,g_xmee_m.xmee042,g_xmee_m.xmee043,g_xmee_m.xmee025,g_xmee_m.xmee026,
          g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee039,g_xmee_m.xmee048,g_xmee_m.xmee049,
          g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmee202,g_xmee_m.xmee203,g_xmee_m.xmee204,
          g_xmee_m.xmee205,g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmeeunit,
          g_xmee_m.xmee208,g_xmee_m.xmee209,g_xmee_m.xmee210,g_xmee_m.xmee211  
     FROM xmda_t
    WHERE xmdaent = g_enterprise
      AND xmdadocno = g_xmee_m.xmeedocno
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'sel xmda_t'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF   
   DISPLAY BY NAME g_xmee_m.xmee001,g_xmee_m.xmeesite,g_xmee_m.xmeedocno,g_xmee_m.xmeedocdt,g_xmee_m.xmee002,
                   g_xmee_m.xmee003,g_xmee_m.xmee004,g_xmee_m.xmee005,g_xmee_m.xmee006,g_xmee_m.xmee007,
                   g_xmee_m.xmee008,g_xmee_m.xmee027,g_xmee_m.xmee009,g_xmee_m.xmee010,
                   g_xmee_m.xmee011,g_xmee_m.xmee012,g_xmee_m.xmee013,g_xmee_m.xmee035,g_xmee_m.xmee015,
                   g_xmee_m.xmee016,g_xmee_m.xmee017,g_xmee_m.xmee018,g_xmee_m.xmee019,g_xmee_m.xmee023,
                   g_xmee_m.xmee032,g_xmee_m.xmee071,g_xmee_m.xmee021,g_xmee_m.xmee022,g_xmee_m.xmee034,
                   g_xmee_m.xmee024,g_xmee_m.xmee028,g_xmee_m.xmeedocdt,
                   g_xmee_m.xmee041,g_xmee_m.xmee042,g_xmee_m.xmee043,g_xmee_m.xmee025,g_xmee_m.xmee026,
                   g_xmee_m.xmee020,g_xmee_m.xmee036,g_xmee_m.xmee039,g_xmee_m.xmee048,g_xmee_m.xmee049,
                   g_xmee_m.xmee200,g_xmee_m.xmee201,g_xmee_m.xmee202,g_xmee_m.xmee203,g_xmee_m.xmee204,
                   g_xmee_m.xmee205,g_xmee_m.xmee206,g_xmee_m.xmee207,g_xmee_m.xmeeunit,
                   g_xmee_m.xmee208,g_xmee_m.xmee209,g_xmee_m.xmee210,g_xmee_m.xmee211                    

   #變更序=訂單變更單的變更序最大值+1
   SELECT MAX(xmee900)+1 INTO g_xmee_m.xmee900
     FROM xmee_t
    WHERE xmeeent = g_enterprise
      AND xmeedocno = g_xmee_m.xmeedocno

   IF cl_null(g_xmee_m.xmee900) THEN
      LET g_xmee_m.xmee900 = 1
   END IF
   DISPLAY BY NAME g_xmee_m.xmee900

   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee004) RETURNING g_xmee_m.xmee004_desc
   DISPLAY BY NAME g_xmee_m.xmee004_desc

   CALL s_desc_get_person_desc(g_xmee_m.xmee002) RETURNING g_xmee_m.xmee002_desc
   DISPLAY BY NAME g_xmee_m.xmee002_desc

   CALL s_desc_get_department_desc(g_xmee_m.xmee003) RETURNING g_xmee_m.xmee003_desc
   DISPLAY BY NAME g_xmee_m.xmee003_desc 
    
   CALL adbt510_xmee027_ref(g_xmee_m.xmee027) RETURNING g_xmee_m.xmee027_desc
   DISPLAY BY NAME g_xmee_m.xmee027_desc
    
   CALL s_desc_get_ooib002_desc(g_xmee_m.xmee009) RETURNING g_xmee_m.xmee009_desc
   DISPLAY BY NAME g_xmee_m.xmee009_desc
    
   CALL s_desc_get_acc_desc('238',g_xmee_m.xmee010) RETURNING g_xmee_m.xmee010_desc
   DISPLAY BY NAME g_xmee_m.xmee010_desc
    
   CALL s_desc_get_tax_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee011) RETURNING g_xmee_m.xmee011_desc
   DISPLAY BY NAME g_xmee_m.xmee011_desc
    
   CALL s_desc_get_currency_desc(g_xmee_m.xmee015) RETURNING g_xmee_m.xmee015_desc
   DISPLAY BY NAME g_xmee_m.xmee015_desc
    
   CALL adbt510_xmee017_ref(g_xmee_m.xmee017) RETURNING g_xmee_m.xmee017_desc
   DISPLAY BY NAME g_xmee_m.xmee017_desc
    
   CALL s_desc_ooid001_desc(g_xmee_m.xmee018) RETURNING g_xmee_m.xmee018_desc
   DISPLAY BY NAME g_xmee_m.xmee018_desc         
    
   CALL s_desc_get_acc_desc('263',g_xmee_m.xmee020) RETURNING g_xmee_m.xmee020_desc
   DISPLAY BY NAME g_xmee_m.xmee020_desc
                
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee021) RETURNING g_xmee_m.xmee021_desc
   DISPLAY BY NAME g_xmee_m.xmee021_desc 
    
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee022) RETURNING g_xmee_m.xmee022_desc
   DISPLAY BY NAME g_xmee_m.xmee022_desc 
   
   LET g_xmee_m_o.xmee203 = g_xmee_m.xmee203
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee203) RETURNING g_xmee_m.xmee203_desc
             
   CALL adbt510_xmee023_ref(g_xmee_m.xmee023) RETURNING g_xmee_m.xmee023_desc
   DISPLAY BY NAME g_xmee_m.xmee023_desc
    
   CALL s_desc_get_acc_desc('295',g_xmee_m.xmee024) RETURNING g_xmee_m.xmee024_desc
   DISPLAY BY NAME g_xmee_m.xmee024_desc

   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee034) RETURNING g_xmee_m.xmee034_desc
   DISPLAY BY NAME g_xmee_m.xmee034_desc
    
   CALL s_desc_get_acc_desc('297',g_xmee_m.xmee032) RETURNING g_xmee_m.xmee032_desc
   DISPLAY BY NAME g_xmee_m.xmee032_desc
    
   CALL s_desc_get_invoice_type_desc1(g_xmee_m.xmeesite,g_xmee_m.xmee035) RETURNING g_xmee_m.xmee035_desc
   DISPLAY BY NAME g_xmee_m.xmee035_desc
    
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee036) RETURNING g_xmee_m.xmee036_desc
   DISPLAY BY NAME g_xmee_m.xmee036_desc
   
   CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee208) RETURNING g_xmee_m.xmee208_desc
   DISPLAY BY NAME g_xmee_m.xmee208_desc
    
   CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee209) RETURNING g_xmee_m.xmee209_desc
   DISPLAY BY NAME g_xmee_m.xmee209_desc
   
   CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee210) RETURNING g_xmee_m.xmee210_desc
   DISPLAY BY NAME g_xmee_m.xmee210_desc
   
   CALL s_desc_get_dbaa001_desc(g_xmee_m.xmee211) RETURNING g_xmee_m.xmee211_desc
   DISPLAY BY NAME g_xmee_m.xmee211_desc
   
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee200) RETURNING g_xmee_m.xmee200_desc
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee201) RETURNING g_xmee_m.xmee201_desc
   CALL s_desc_get_department_desc(g_xmee_m.xmee202) RETURNING g_xmee_m.xmee202_desc
   CALL s_desc_get_trading_partner_abbr_desc(g_xmee_m.xmee203) RETURNING g_xmee_m.xmee203_desc
   CALL adbt510_xmee204_ref()
   LET g_xmee_m.xmee206_desc = s_desc_get_dbad001_desc(g_xmee_m.xmee206)
   LET g_xmee_m.xmee207_desc = s_desc_get_dbab001_desc(g_xmee_m.xmee207)   
   CALL s_desc_get_department_desc(g_xmee_m.xmeeunit) RETURNING g_xmee_m.xmeeunit_desc
    
   LET g_xmee_m.xmee026_desc = ''
   LET g_xmee_m.oofb017_1 = ''
   IF NOT cl_null(g_xmee_m.xmee021) AND NOT cl_null(g_xmee_m.xmee026) THEN 
      CALL s_adb_address_ref('5',g_xmee_m.xmee026,g_xmee_m.xmee021)
         RETURNING l_oofb011,l_address
      LET g_xmee_m.xmee026_desc = l_oofb011
      LET g_xmee_m.oofb017_1 = l_address   
      DISPLAY BY NAME g_xmee_m.xmee026_desc,g_xmee_m.oofb017_1
   END IF

   LET g_xmee_m.xmee025_desc = ''
   LET g_xmee_m.oofb017 = ''
   IF NOT cl_null(g_xmee_m.xmee022) AND NOT cl_null(g_xmee_m.xmee025) THEN   
      CALL s_adb_address_ref('3',g_xmee_m.xmee025,g_xmee_m.xmee022)
         RETURNING l_oofb011,l_address
      LET g_xmee_m.xmee025_desc = l_oofb011
      LET g_xmee_m.oofb017 = l_address  
      DISPLAY BY NAME g_xmee_m.xmee025_desc,g_xmee_m.oofb017
   END IF

   LET g_xmee_m_t.* = g_xmee_m.*
   LET g_xmee_m_o.* = g_xmee_m.*
   
   RETURN r_success
END FUNCTION
################################################################################
# Descriptions...: 依據輸入的訂單單號，帶出商品明細欄位的值
# Memo...........:
# Usage..........: CALL adbt510_xmeedocno_xmjb()
#                  RETURNING r_success
# Input parameter: 
# Return code....: r_success 執行結果
# Date & Author..:               bartscott
# Modify.........: 2015/01/24 By Lori 新增銷售區域欄位:xmjb037,xmjb038,xmjb039,xmjb040
################################################################################
PRIVATE FUNCTION adbt510_xmeedocno_xmjb()
DEFINE l_sql             STRING
DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE

   IF cl_null(g_xmee_m.xmeedocno) THEN
      LET r_success = FALSE
      RETURN r_success
   END IF

   LET l_sql = "SELECT xmjaunit,xmjaseq,xmjasite,xmja001,xmja002, ",
               "       xmja003,xmja033,xmja004,xmja005,xmja006, ",
               "       xmja007,xmja011,xmja012,xmja013,xmja014, ",
               "       xmja015,xmja016,xmja017,xmja018,xmja008, ",
               "       xmja009,xmja010,xmja022,xmja019,xmja020, ",
               "       xmja021,xmja024,xmja025,xmja026,xmja027, ",
               "       xmja028,xmja029,xmja030,xmja031,xmja032, ",
               "       xmja034,xmja037,xmja038,xmja039,xmja040  ",    #02749  150124 add:xmja037,xmja038,xmja039,xmja04
               "  FROM xmja_t ",
               " WHERE xmjaent = '",g_enterprise,"'", 
               "   AND xmjadocno = '",g_xmee_m.xmeedocno,"'",  
               " ORDER BY xmjaseq "

   PREPARE sel_xmja_pre FROM l_sql
   DECLARE sel_xmja_cur CURSOR FOR sel_xmja_pre

   LET l_ac = 1               
   FOREACH sel_xmja_cur INTO g_xmeg4_d[l_ac].xmjbunit,g_xmeg4_d[l_ac].xmjbseq,g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb001,g_xmeg4_d[l_ac].xmjb002, 
                             g_xmeg4_d[l_ac].xmjb003,g_xmeg4_d[l_ac].xmjb033,g_xmeg4_d[l_ac].xmjb004,g_xmeg4_d[l_ac].xmjb005,g_xmeg4_d[l_ac].xmjb006, 
                             g_xmeg4_d[l_ac].xmjb007,g_xmeg4_d[l_ac].xmjb011,g_xmeg4_d[l_ac].xmjb012,g_xmeg4_d[l_ac].xmjb013,g_xmeg4_d[l_ac].xmjb014, 
                             g_xmeg4_d[l_ac].xmjb015,g_xmeg4_d[l_ac].xmjb016,g_xmeg4_d[l_ac].xmjb017,g_xmeg4_d[l_ac].xmjb018,g_xmeg4_d[l_ac].xmjb008, 
                             g_xmeg4_d[l_ac].xmjb009,g_xmeg4_d[l_ac].xmjb010,g_xmeg4_d[l_ac].xmjb022,g_xmeg4_d[l_ac].xmjb019,g_xmeg4_d[l_ac].xmjb020, 
                             g_xmeg4_d[l_ac].xmjb021,g_xmeg4_d[l_ac].xmjb024,g_xmeg4_d[l_ac].xmjb025,g_xmeg4_d[l_ac].xmjb026,g_xmeg4_d[l_ac].xmjb027, 
                             g_xmeg4_d[l_ac].xmjb028,g_xmeg4_d[l_ac].xmjb029,g_xmeg4_d[l_ac].xmjb030,g_xmeg4_d[l_ac].xmjb031,g_xmeg4_d[l_ac].xmjb032, 
                             g_xmeg4_d[l_ac].xmjb034,g_xmeg4_d[l_ac].xmjb037,g_xmeg4_d[l_ac].xmjb038,g_xmeg4_d[l_ac].xmjb039,g_xmeg4_d[l_ac].xmjb040      #02749  150124 add:xmjb037,xmjb038,xmjb039,xmjb04 
 
      LET g_xmeg4_d[l_ac].xmjb901 = '1'   #未變更
      #160513-00027#1 20160520 add by beckxie---S
      IF NOT cl_null(g_xmee_m.xmee022) THEN
         LET g_xmeg4_d[l_ac].xmjb025 = g_xmee_m.xmee022   
      END IF
      #160513-00027#1 20160520 add by beckxie---E
      CALL s_desc_get_department_desc(g_xmeg4_d[l_ac].xmjbsite) RETURNING g_xmeg4_d[l_ac].xmjbsite_desc      
      CALL s_desc_get_item_desc(g_xmeg4_d[l_ac].xmjb003)RETURNING g_xmeg4_d[l_ac].xmjb003_desc,g_xmeg4_d[l_ac].xmjb003_desc_desc
      CALL adbt510_xmjb005_ref()
      CALL s_desc_get_tax_desc1(g_xmeg4_d[l_ac].xmjbsite,g_xmeg4_d[l_ac].xmjb006) RETURNING g_xmeg4_d[l_ac].xmjb006_desc
      CALL s_desc_get_unit_desc(g_xmeg4_d[l_ac].xmjb011) RETURNING g_xmeg4_d[l_ac].xmjb011_desc
      CALL s_desc_get_unit_desc(g_xmeg4_d[l_ac].xmjb013) RETURNING g_xmeg4_d[l_ac].xmjb013_desc
      CALL s_desc_get_unit_desc(g_xmeg4_d[l_ac].xmjb015) RETURNING g_xmeg4_d[l_ac].xmjb015_desc
      CALL s_desc_get_unit_desc(g_xmeg4_d[l_ac].xmjb017) RETURNING g_xmeg4_d[l_ac].xmjb017_desc
      CALL adbt510_xmjb024_ref()
      CALL adbt510_xmjb026_ref()
      LET g_xmeg4_d[l_ac].xmjb027_desc = s_desc_get_dbad001_desc(g_xmeg4_d[l_ac].xmjb027)
      
      #02749  150124 add -----------------------(S)
      CALL s_desc_get_dbaa001_desc(g_xmeg4_d[l_ac].xmjb037) RETURNING g_xmeg4_d[l_ac].xmjb037_desc
      CALL s_desc_get_dbaa001_desc(g_xmeg4_d[l_ac].xmjb038) RETURNING g_xmeg4_d[l_ac].xmjb038_desc
      CALL s_desc_get_dbaa001_desc(g_xmeg4_d[l_ac].xmjb039) RETURNING g_xmeg4_d[l_ac].xmjb039_desc
      CALL s_desc_get_dbaa001_desc(g_xmeg4_d[l_ac].xmjb040) RETURNING g_xmeg4_d[l_ac].xmjb040_desc
      #02749  150124 add -----------------------(E)

      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 9035
         LET g_errparam.extend = ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF
        
    END FOREACH

   CALL g_xmeg4_d.deleteElement(g_xmeg4_d.getLength())

   LET g_rec_b = l_ac - 1
   LET l_ac = 0
   FREE sel_xmja_pre

   DISPLAY ARRAY g_xmeg4_d TO s_detail4.* ATTRIBUTES(COUNT = g_rec_b)
      BEFORE DISPLAY
         EXIT DISPLAY
   END DISPLAY

   RETURN r_success
END FUNCTION
################################################################################
# Descriptions...: 依據輸入的訂單單號，帶出單身欄位的值
# Memo...........:
# Usage..........: CALL adbt510_xmeedocno_xmeg()
#                  RETURNING r_success
# Input parameter: 
# Return code....: r_success 執行結果
# Date & Author..:               bartscott
################################################################################
PRIVATE FUNCTION adbt510_xmeedocno_xmeg()
DEFINE l_sql             STRING
DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE

   IF cl_null(g_xmee_m.xmeedocno) THEN
      LET r_success = FALSE
      RETURN r_success
   END IF

   LET l_sql = "SELECT xmdcsite,xmdcseq,xmdc027,xmdc001,xmdc002, ",
               "       xmdc004,xmdc005,xmdc006,xmdc007,xmdc008, ",
               "       xmdc009,xmdc024,xmdc012,xmdc013,xmdc045, ",
               "       xmdc010,xmdc011,xmdc015,xmdc016,xmdc017, ",
               "       xmdc046,xmdc047,xmdc048,xmdc023,xmdc019, ",
               "       xmdc020,xmdc021,xmdc022,xmdcunit,xmdcorga, ",
               "       xmdc052,xmdc049,xmdc053,xmdc050 ",               
               "  FROM xmdc_t ",
               " WHERE xmdcent = '",g_enterprise,"'", 
               "   AND xmdcdocno = '",g_xmee_m.xmeedocno,"'",  
               " ORDER BY xmdcseq "

   PREPARE sel_xmdc_pre FROM l_sql
   DECLARE sel_xmdc_cur CURSOR FOR sel_xmdc_pre

   LET l_ac = 1               
   FOREACH sel_xmdc_cur INTO g_xmeg_d[l_ac].xmegsite,g_xmeg_d[l_ac].xmegseq,g_xmeg_d[l_ac].xmeg027,g_xmeg_d[l_ac].xmeg001,g_xmeg_d[l_ac].xmeg002,
                             g_xmeg_d[l_ac].xmeg004,g_xmeg_d[l_ac].xmeg005,g_xmeg_d[l_ac].xmeg006,g_xmeg_d[l_ac].xmeg007,g_xmeg_d[l_ac].xmeg008,
                             g_xmeg_d[l_ac].xmeg009,g_xmeg_d[l_ac].xmeg024,g_xmeg_d[l_ac].xmeg012,g_xmeg_d[l_ac].xmeg013,g_xmeg_d[l_ac].xmeg045,
                             g_xmeg_d[l_ac].xmeg010,g_xmeg_d[l_ac].xmeg011,g_xmeg_d[l_ac].xmeg015,g_xmeg_d[l_ac].xmeg016,g_xmeg_d[l_ac].xmeg017,
                             g_xmeg_d[l_ac].xmeg046,g_xmeg_d[l_ac].xmeg047,g_xmeg_d[l_ac].xmeg048,g_xmeg_d[l_ac].xmeg023,g_xmeg_d[l_ac].xmeg019, 
                             g_xmeg_d[l_ac].xmeg020,g_xmeg_d[l_ac].xmeg021,g_xmeg_d[l_ac].xmeg022,g_xmeg_d[l_ac].xmegunit,g_xmeg_d[l_ac].xmegorga, 
                             g_xmeg_d[l_ac].xmeg052,g_xmeg_d[l_ac].xmeg049,g_xmeg_d[l_ac].xmeg053,g_xmeg_d[l_ac].xmeg050
                             
      LET g_xmeg_d[l_ac].xmeg901 = '1'   #未變更

      CALL s_desc_get_item_desc(g_xmeg_d[l_ac].xmeg001) RETURNING g_xmeg_d[l_ac].xmeg001_desc,g_xmeg_d[l_ac].xmeg001_desc_desc
      CALL s_desc_get_acc_desc('221',g_xmeg_d[l_ac].xmeg004) RETURNING g_xmeg_d[l_ac].xmeg004_desc
      CALL s_desc_get_unit_desc(g_xmeg_d[l_ac].xmeg006) RETURNING g_xmeg_d[l_ac].xmeg006_desc
      CALL s_desc_get_unit_desc(g_xmeg_d[l_ac].xmeg008) RETURNING g_xmeg_d[l_ac].xmeg008_desc
      CALL s_desc_get_unit_desc(g_xmeg_d[l_ac].xmeg010) RETURNING g_xmeg_d[l_ac].xmeg010_desc
      CALL s_desc_get_tax_desc1(g_xmeg_d[l_ac].xmegsite,g_xmeg_d[l_ac].xmeg016) RETURNING g_xmeg_d[l_ac].xmeg016_desc
      CALL s_desc_get_department_desc(g_xmeg_d[l_ac].xmegunit) RETURNING g_xmeg_d[l_ac].xmegunit_desc
      CALL s_desc_get_department_desc(g_xmeg_d[l_ac].xmegorga) RETURNING g_xmeg_d[l_ac].xmegorga_desc
      CALL s_desc_get_acc_desc(g_acc,g_xmeg_d[l_ac].xmeg049) RETURNING g_xmeg_d[l_ac].xmeg049_desc
                     
      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 9035
         LET g_errparam.extend = ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF
        
    END FOREACH

   CALL g_xmeg_d.deleteElement(g_xmeg_d.getLength())

   LET g_rec_b = l_ac - 1
   LET l_ac = 0
   FREE sel_xmdc_pre

   DISPLAY ARRAY g_xmeg_d TO s_detail1.* ATTRIBUTES(COUNT = g_rec_b)
      BEFORE DISPLAY
         EXIT DISPLAY
   END DISPLAY

   RETURN r_success
   
END FUNCTION
#依據輸入的訂單單號，帶出單身欄位的值
PRIVATE FUNCTION adbt510_xmeedocno_xmeh()
DEFINE l_sql             STRING
DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE

   IF cl_null(g_xmee_m.xmeedocno) THEN
      LET r_success = FALSE
      RETURN r_success
   END IF
   
   LET l_sql = "SELECT xmddsite,xmdddocno,xmddseq,xmddseq1,xmdd003, ",
               "       xmdd001,xmdd002,xmdd004,xmdd005,xmddseq2, ",
               "       xmdd006,xmdd024,xmdd025,xmdd011,xmdd012, ",
               "       xmdd031,xmdd014,xmdd015,xmdd016,xmdd017, ",
               "       xmdd026,xmdd027,xmdd019,xmdd028,xmdd029, ",
               "       xmdd030,xmdd200,xmdd201,xmdd202,xmdd203, ",
               "       xmdd204,xmdd205,xmdd206,xmdd207,xmddunit, ",
               "       xmdd210,xmdd212,xmdd213,xmdd214,xmdd215, ",
               "       xmdd218,xmdd219,xmdd220,xmdd221,xmdd222, ",
               "       xmdd223,xmdd224,xmddorga,xmdd226,xmdd227, ",
               "       xmdd228,xmdd229 ",
               "  FROM xmdd_t ",
               " WHERE xmddent = '",g_enterprise,"'", 
               "   AND xmdddocno = '",g_xmee_m.xmeedocno,"'",         
               " ORDER BY xmddseq,xmddseq1 "

   PREPARE sel_xmdd_pre FROM l_sql
   DECLARE sel_xmdd_cur CURSOR FOR sel_xmdd_pre

   LET l_ac = 1               
   FOREACH sel_xmdd_cur INTO g_xmeg3_d[l_ac].xmehsite,g_xmeg3_d[l_ac].xmehdocno,g_xmeg3_d[l_ac].xmehseq,g_xmeg3_d[l_ac].xmehseq1,g_xmeg3_d[l_ac].xmeh003, 
                             g_xmeg3_d[l_ac].xmeh001,g_xmeg3_d[l_ac].xmeh002,g_xmeg3_d[l_ac].xmeh004,g_xmeg3_d[l_ac].xmeh005,g_xmeg3_d[l_ac].xmehseq2, 
                             g_xmeg3_d[l_ac].xmeh006,g_xmeg3_d[l_ac].xmeh024,g_xmeg3_d[l_ac].xmeh025,g_xmeg3_d[l_ac].xmeh011,g_xmeg3_d[l_ac].xmeh012, 
                             g_xmeg3_d[l_ac].xmeh031,g_xmeg3_d[l_ac].xmeh014,g_xmeg3_d[l_ac].xmeh015,g_xmeg3_d[l_ac].xmeh016,g_xmeg3_d[l_ac].xmeh017, 
                             g_xmeg3_d[l_ac].xmeh026,g_xmeg3_d[l_ac].xmeh027,g_xmeg3_d[l_ac].xmeh019,g_xmeg3_d[l_ac].xmeh028,g_xmeg3_d[l_ac].xmeh029,  
                             g_xmeg3_d[l_ac].xmeh030, g_xmeg3_d[l_ac].xmeh200,g_xmeg3_d[l_ac].xmeh201,g_xmeg3_d[l_ac].xmeh202,g_xmeg3_d[l_ac].xmeh203,
                             g_xmeg3_d[l_ac].xmeh204,g_xmeg3_d[l_ac].xmeh205,g_xmeg3_d[l_ac].xmeh206,g_xmeg3_d[l_ac].xmeh207,g_xmeg3_d[l_ac].xmehunit,
                             g_xmeg3_d[l_ac].xmeh210,g_xmeg3_d[l_ac].xmeh212,g_xmeg3_d[l_ac].xmeh213,g_xmeg3_d[l_ac].xmeh214,g_xmeg3_d[l_ac].xmeh215,
                             g_xmeg3_d[l_ac].xmeh218,g_xmeg3_d[l_ac].xmeh219,g_xmeg3_d[l_ac].xmeh220,g_xmeg3_d[l_ac].xmeh221,g_xmeg3_d[l_ac].xmeh222,
                             g_xmeg3_d[l_ac].xmeh223,g_xmeg3_d[l_ac].xmeh224,g_xmeg3_d[l_ac].xmehorga,g_xmeg3_d[l_ac].xmeh226,g_xmeg3_d[l_ac].xmeh227,
                             g_xmeg3_d[l_ac].xmeh228,g_xmeg3_d[l_ac].xmeh229


      #抓取約定交貨日、預計簽收日期
      SELECT xmdc012,xmdc013
        INTO g_xmeg3_d[l_ac].xmeg012,g_xmeg3_d[l_ac].xmeg013
        FROM xmdc_t
       WHERE xmdcent = g_enterprise
         AND xmdcdocno = g_xmeg3_d[l_ac].xmehdocno
         AND xmdcseq = g_xmeg3_d[l_ac].xmehseq

      LET g_xmeg3_d[l_ac].xmeh901 = '1'   #未變更 
      
      CALL s_desc_get_item_desc(g_xmeg3_d[l_ac].xmeh001)RETURNING g_xmeg3_d[l_ac].xmeh001_desc,g_xmeg3_d[l_ac].xmeh001_desc_desc
      CALL s_desc_get_unit_desc(g_xmeg3_d[l_ac].xmeh004) RETURNING g_xmeg3_d[l_ac].xmeh004_desc
      CALL s_desc_get_tax_desc1(g_xmeg3_d[l_ac].xmehsite,g_xmeg3_d[l_ac].xmeh019) RETURNING g_xmeg3_d[l_ac].xmeh019_desc
      CALL s_desc_get_unit_desc(g_xmeg3_d[l_ac].xmeh024) RETURNING g_xmeg3_d[l_ac].xmeh024_desc
      CALL s_desc_get_unit_desc(g_xmeg3_d[l_ac].xmeh026) RETURNING g_xmeg3_d[l_ac].xmeh026_desc
      CALL s_desc_get_unit_desc(g_xmeg3_d[l_ac].xmeh201) RETURNING g_xmeg3_d[l_ac].xmeh201_desc
      CALL s_desc_get_trading_partner_abbr_desc(g_xmeg3_d[l_ac].xmeh207) RETURNING g_xmeg3_d[l_ac].xmeh207_desc
      CALL s_desc_get_department_desc(g_xmeg3_d[l_ac].xmehunit) RETURNING g_xmeg3_d[l_ac].xmehunit_desc
      CALL s_desc_get_department_desc(g_xmeg3_d[l_ac].xmehsite) RETURNING g_xmeg3_d[l_ac].xmehsite_desc
      CALL s_desc_get_department_desc(g_xmeg3_d[l_ac].xmehorga) RETURNING g_xmeg3_d[l_ac].xmehorga_desc
      CALL s_desc_get_acc_desc('274',g_xmeg3_d[l_ac].xmeh210) RETURNING g_xmeg3_d[l_ac].xmeh210_desc
      CALL s_desc_get_stock_desc(g_xmeg3_d[l_ac].xmehsite,g_xmeg3_d[l_ac].xmeh213) RETURNING g_xmeg3_d[l_ac].xmeh213_desc
      CALL s_desc_get_locator_desc(g_xmeg3_d[l_ac].xmehsite,g_xmeg3_d[l_ac].xmeh213,g_xmeg3_d[l_ac].xmeh214) RETURNING g_xmeg3_d[l_ac].xmeh214_desc
      CALL s_desc_get_oojdl003_desc(g_xmeg3_d[l_ac].xmeh218) RETURNING g_xmeg3_d[l_ac].xmeh218_desc
      CALL s_desc_get_prod_group_desc(g_xmeg3_d[l_ac].xmeh219) RETURNING g_xmeg3_d[l_ac].xmeh219_desc
      CALL s_desc_get_sales_range_desc(g_xmeg3_d[l_ac].xmeh220) RETURNING g_xmeg3_d[l_ac].xmeh220_desc
      CALL s_desc_get_department_desc(g_xmeg3_d[l_ac].xmeh222) RETURNING g_xmeg3_d[l_ac].xmeh222_desc
      CALL s_desc_get_person_desc(g_xmeg3_d[l_ac].xmeh223) RETURNING g_xmeg3_d[l_ac].xmeh223_desc
      CALL s_desc_get_department_desc(g_xmeg3_d[l_ac].xmeh224) RETURNING g_xmeg3_d[l_ac].xmeh224_desc
      CALL s_desc_get_acc_desc('2060',g_xmeg3_d[l_ac].xmeh227) RETURNING g_xmeg3_d[l_ac].xmeh227_desc
      
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh228
      CALL ap_ref_array2(g_ref_fields,"SELECT staal003 FROM staal_t WHERE staalent='"||g_enterprise||"' AND staal001=? AND staal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg3_d[l_ac].xmeh228_desc = '', g_rtn_fields[1] , ''
      
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh200
      CALL ap_ref_array2(g_ref_fields,"SELECT prcfl003 FROM prcfl_t WHERE prcflent='"||g_enterprise||"' AND prcfl001=? AND prcfl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg3_d[l_ac].xmeh200_desc = '', g_rtn_fields[1] , ''

      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 9035
         LET g_errparam.extend = ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF
        
    END FOREACH

    CALL g_xmeg3_d.deleteElement(g_xmeg3_d.getLength())
    
    LET g_rec_b = l_ac - 1
    LET l_ac = 0
    FREE sel_xmdd_pre

    DISPLAY ARRAY g_xmeg3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b)
       BEFORE DISPLAY
          EXIT DISPLAY
    END DISPLAY
    RETURN r_success
END FUNCTION
#依據輸入的訂單單號，帶出單身欄位的值
PRIVATE FUNCTION adbt510_xmeedocno_xmef()
DEFINE l_sql             STRING
DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE

   IF cl_null(g_xmee_m.xmeedocno) THEN
      LET r_success = FALSE
      RETURN r_success
   END IF
   
   LET l_sql = "SELECT xmdbsite,xmdb001,xmdb002,xmdb003,xmdb004, ",
               "       xmdb005,xmdb006,xmdb007,xmdb008,xmdb009, ",
               "       xmdb016,xmdb017 ",
               "  FROM xmdb_t ",
               " WHERE xmdbent = '",g_enterprise,"'",
               "   AND xmdbdocno= '",g_xmee_m.xmeedocno,"'",  
               "  ORDER BY xmdb001 "                  

   PREPARE sel_xmdb_pre FROM l_sql
   DECLARE sel_xmdb_cur CURSOR FOR sel_xmdb_pre

   LET l_ac = 1               
   FOREACH sel_xmdb_cur INTO g_xmeg5_d[l_ac].xmefsite,g_xmeg5_d[l_ac].xmef001,g_xmeg5_d[l_ac].xmef002,g_xmeg5_d[l_ac].xmef003,g_xmeg5_d[l_ac].xmef004, 
                             g_xmeg5_d[l_ac].xmef005,g_xmeg5_d[l_ac].xmef006,g_xmeg5_d[l_ac].xmef007,g_xmeg5_d[l_ac].xmef008,g_xmeg5_d[l_ac].xmef009,
                             g_xmeg5_d[l_ac].xmef016,g_xmeg5_d[l_ac].xmef017                    

      LET g_xmeg5_d[l_ac].xmef901 = '1'   #未變更
      CALL s_desc_get_ooib002_desc(g_xmeg5_d[l_ac].xmef002) RETURNING g_xmeg5_d[l_ac].xmef002_desc

      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 9035
         LET g_errparam.extend = ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF
        
    END FOREACH
    
    CALL g_xmeg5_d.deleteElement(g_xmeg5_d.getLength())
    LET g_rec_b = l_ac - 1
    LET l_ac = 0
    FREE sel_xmdb_pre 
    
    DISPLAY ARRAY g_xmeg5_d TO s_detail5.* ATTRIBUTES(COUNT=g_rec_b) 
       BEFORE DISPLAY
          EXIT DISPLAY
    END DISPLAY
    
    RETURN r_success  
END FUNCTION
#將單身資料新增到資料庫內
PRIVATE FUNCTION adbt510_ins_xmjb()
DEFINE l_i               LIKE type_t.num5
DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE
 
   FOR l_i = 1 TO g_xmeg4_d.getLength()  
      INSERT INTO xmjb_t
                  (xmjbent,xmjbsite,xmjbunit,xmjbdocno,xmjbseq,
                   xmjb001,xmjb002,xmjb003,xmjb004,xmjb005,xmjb006,
                   xmjb007,xmjb008,xmjb009,xmjb010,xmjb011,xmjb012,
                   xmjb013,xmjb014,xmjb015,xmjb016,xmjb017,xmjb018,
                   xmjb900,xmjb901,xmjb902,xmjb903,xmjb019,xmjb020,
                   xmjb021,xmjb022,xmjb024,xmjb025,xmjb026,xmjb027,
                   xmjb028,xmjb029,xmjb030,xmjb031,xmjb032,xmjb033,
                   xmjb034) 
            VALUES(g_enterprise,g_xmeg4_d[l_i].xmjbsite,g_xmeg4_d[l_i].xmjbunit,g_xmee_m.xmeedocno,g_xmeg4_d[l_i].xmjbseq,
                   g_xmeg4_d[l_i].xmjb001,g_xmeg4_d[l_i].xmjb002,g_xmeg4_d[l_i].xmjb003,g_xmeg4_d[l_i].xmjb004,g_xmeg4_d[l_i].xmjb005,g_xmeg4_d[l_i].xmjb006,
                   g_xmeg4_d[l_i].xmjb007,g_xmeg4_d[l_i].xmjb008,g_xmeg4_d[l_i].xmjb009,g_xmeg4_d[l_i].xmjb010,g_xmeg4_d[l_i].xmjb011,g_xmeg4_d[l_i].xmjb012,
                   g_xmeg4_d[l_i].xmjb013,g_xmeg4_d[l_i].xmjb014,g_xmeg4_d[l_i].xmjb015,g_xmeg4_d[l_i].xmjb016,g_xmeg4_d[l_i].xmjb017,g_xmeg4_d[l_i].xmjb018,
                   g_xmee_m.xmee900,g_xmeg4_d[l_i].xmjb901,g_xmeg4_d[l_i].xmjb902,g_xmeg4_d[l_i].xmjb903,g_xmeg4_d[l_i].xmjb019,g_xmeg4_d[l_i].xmjb020,
                   g_xmeg4_d[l_i].xmjb021,g_xmeg4_d[l_i].xmjb022,g_xmeg4_d[l_i].xmjb024,g_xmeg4_d[l_i].xmjb025,g_xmeg4_d[l_i].xmjb026,g_xmeg4_d[l_i].xmjb027,
                   g_xmeg4_d[l_i].xmjb028,g_xmeg4_d[l_i].xmjb029,g_xmeg4_d[l_i].xmjb030,g_xmeg4_d[l_i].xmjb031,g_xmeg4_d[l_i].xmjb032,g_xmeg4_d[l_i].xmjb033,
                   g_xmeg4_d[l_i].xmjb034)       

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'ins xmjb_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         EXIT FOR
      END IF

   END FOR

   RETURN r_success 
END FUNCTION
#將單身資料新增到資料庫內
PRIVATE FUNCTION adbt510_ins_xmeg()
DEFINE l_i               LIKE type_t.num5
DEFINE r_success         LIKE type_t.num5
DEFINE l_xmeg            RECORD
          xmeg003        LIKE xmeg_t.xmeg003,
          xmeg031        LIKE xmeg_t.xmeg031,
          xmeg032        LIKE xmeg_t.xmeg032,
          xmeg033        LIKE xmeg_t.xmeg033,
          xmeg034        LIKE xmeg_t.xmeg034,
          xmeg036        LIKE xmeg_t.xmeg036,
          xmeg037        LIKE xmeg_t.xmeg037,
          xmeg038        LIKE xmeg_t.xmeg038,
          xmeg039        LIKE xmeg_t.xmeg039
       END RECORD
   LET r_success = TRUE

   FOR l_i = 1 TO g_xmeg_d.getLength()
       INITIALIZE l_xmeg.* TO NULL
       #其他資料
       SELECT xmdc003,xmdc031,xmdc032,xmdc033,
              xmdc034,xmdc036,xmdc037,xmdc038,xmdc039
         INTO l_xmeg.xmeg003,l_xmeg.xmeg031,l_xmeg.xmeg032,l_xmeg.xmeg033,
              l_xmeg.xmeg034,l_xmeg.xmeg036,l_xmeg.xmeg037,l_xmeg.xmeg038,l_xmeg.xmeg039
         FROM xmdc_t
        WHERE xmdcent = g_enterprise
          AND xmdcdocno = g_xmee_m.xmeedocno
          AND xmdcseq = g_xmeg_d[l_i].xmegseq
       
       INSERT INTO xmeg_t
                   (xmegent,xmegdocno,xmeg900,xmegseq,xmegsite,
                    xmeg027,xmeg001,xmeg002,xmeg004,xmeg005,
                    xmeg006,xmeg007,xmeg008,xmeg009,xmeg024,
                    xmeg012,xmeg013,xmeg045,xmeg016,xmeg017,
                    xmeg010,xmeg011,xmeg015,xmeg046,xmeg047,
                    xmeg048,xmeg023,xmeg019,xmeg020,xmeg021,
                    xmeg022,xmegunit,xmegorga,xmeg052,xmeg049,
                    xmeg053,xmeg050,xmeg901,xmeg902,xmeg903,
                    xmeg003,xmeg031,xmeg032,xmeg033,
                    xmeg034,xmeg036,xmeg037,xmeg038,xmeg039) 
             VALUES(g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg_d[l_i].xmegseq,g_xmeg_d[l_i].xmegsite,
                    g_xmeg_d[l_i].xmeg027,g_xmeg_d[l_i].xmeg001,g_xmeg_d[l_i].xmeg002,g_xmeg_d[l_i].xmeg004,g_xmeg_d[l_i].xmeg005,
                    g_xmeg_d[l_i].xmeg006,g_xmeg_d[l_i].xmeg007,g_xmeg_d[l_i].xmeg008,g_xmeg_d[l_i].xmeg009,g_xmeg_d[l_i].xmeg024,
                    g_xmeg_d[l_i].xmeg012,g_xmeg_d[l_i].xmeg013,g_xmeg_d[l_i].xmeg045,g_xmeg_d[l_i].xmeg016,g_xmeg_d[l_i].xmeg017,
                    g_xmeg_d[l_i].xmeg010,g_xmeg_d[l_i].xmeg011,g_xmeg_d[l_i].xmeg015,g_xmeg_d[l_i].xmeg046,g_xmeg_d[l_i].xmeg047,
                    g_xmeg_d[l_i].xmeg048,g_xmeg_d[l_i].xmeg023,g_xmeg_d[l_i].xmeg019,g_xmeg_d[l_i].xmeg020,g_xmeg_d[l_i].xmeg021,
                    g_xmeg_d[l_i].xmeg022,g_xmeg_d[l_i].xmegunit,g_xmeg_d[l_i].xmegorga,g_xmeg_d[l_i].xmeg052,g_xmeg_d[l_i].xmeg049,
                    g_xmeg_d[l_i].xmeg053,g_xmeg_d[l_i].xmeg050,g_xmeg_d[l_i].xmeg901,g_xmeg_d[l_i].xmeg902,g_xmeg_d[l_i].xmeg903,
                    l_xmeg.xmeg003,l_xmeg.xmeg031,l_xmeg.xmeg032,l_xmeg.xmeg033,
                    l_xmeg.xmeg034,l_xmeg.xmeg036,l_xmeg.xmeg037,l_xmeg.xmeg038,l_xmeg.xmeg039) 
                   
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'ins xmeg_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         EXIT FOR
      END IF

   END FOR

   RETURN r_success  
END FUNCTION
#將多期預收款資料新增到資料庫內
PRIVATE FUNCTION adbt510_ins_xmef()
DEFINE l_i               LIKE type_t.num5
DEFINE l_cnt             LIKE type_t.num5
DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE

      FOR l_i = 1 TO g_xmeg5_d.getLength()  
         INSERT INTO xmef_t
                     (xmefent,xmefdocno,xmef900,xmef001,xmefsite,
                      xmef002,xmef003,xmef004,xmef005,xmef006,
                      xmef007,xmef008,xmef009,xmef901,xmef016,xmef017) 
               VALUES(g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg5_d[l_i].xmef001,g_xmee_m.xmeesite,
                      g_xmeg5_d[l_i].xmef002,g_xmeg5_d[l_i].xmef003,g_xmeg5_d[l_i].xmef004,g_xmeg5_d[l_i].xmef005,g_xmeg5_d[l_i].xmef006, 
                      g_xmeg5_d[l_i].xmef007,g_xmeg5_d[l_i].xmef008,g_xmeg5_d[l_i].xmef009,g_xmeg5_d[l_i].xmef901,g_xmeg5_d[l_i].xmef016,g_xmeg5_d[l_i].xmef017) 
                      
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = 'ins xmef_t'
            LET g_errparam.popup = TRUE
            CALL cl_err()

            LET r_success = FALSE
            EXIT FOR
         END IF  
      END FOR

   RETURN r_success 

END FUNCTION
#將交期明細資料新增到資料庫內
PRIVATE FUNCTION adbt510_ins_xmeh()
DEFINE l_i               LIKE type_t.num5
DEFINE r_success         LIKE type_t.num5

   LET r_success = TRUE
 
   FOR l_i = 1 TO g_xmeg3_d.getLength()  
      INSERT INTO xmeh_t
                  (xmehent,xmehdocno,xmeh900,xmehseq,xmehseq1,
                   xmehseq2,xmehsite,xmeh003,xmeh001,xmeh002,
                   xmeh004,xmeh005,xmeh006,xmeh024,xmeh025,
                   xmeh011,xmeh012,xmeh031,xmeh014,xmeh015,
                   xmeh016,xmeh017,xmeh026,xmeh027,xmeh019,
                   xmeh028,xmeh029,xmeh030,
                   xmeh901,xmeh200,xmeh201,xmeh202,xmeh203, 
                   xmeh204,xmeh205,xmeh206,xmeh207,xmehunit, 
                   xmeh210,xmeh212,xmeh213,xmeh214,xmeh215, 
                   xmeh218,xmeh219,xmeh220,xmeh221,xmeh222, 
                   xmeh223,xmeh224,xmehorga,xmeh226,xmeh227, 
                   xmeh228,xmeh229) 
            VALUES(g_enterprise,g_xmee_m.xmeedocno,g_xmee_m.xmee900,g_xmeg3_d[l_i].xmehseq,g_xmeg3_d[l_i].xmehseq1,
                   g_xmeg3_d[l_i].xmehseq2,g_xmee_m.xmeesite,g_xmeg3_d[l_i].xmeh003,g_xmeg3_d[l_i].xmeh001,g_xmeg3_d[l_i].xmeh002,
                   g_xmeg3_d[l_i].xmeh004,g_xmeg3_d[l_i].xmeh005,g_xmeg3_d[l_i].xmeh006,g_xmeg3_d[l_i].xmeh024,g_xmeg3_d[l_i].xmeh025, 
                   g_xmeg3_d[l_i].xmeh011,g_xmeg3_d[l_i].xmeh012,g_xmeg3_d[l_i].xmeh031,g_xmeg3_d[l_i].xmeh014,g_xmeg3_d[l_i].xmeh015,
                   g_xmeg3_d[l_i].xmeh016,g_xmeg3_d[l_i].xmeh017,g_xmeg3_d[l_i].xmeh026,g_xmeg3_d[l_i].xmeh027,g_xmeg3_d[l_i].xmeh019,
                   g_xmeg3_d[l_i].xmeh028,g_xmeg3_d[l_i].xmeh029,g_xmeg3_d[l_i].xmeh030,
                   g_xmeg3_d[l_i].xmeh901,g_xmeg3_d[l_i].xmeh200,g_xmeg3_d[l_i].xmeh201,g_xmeg3_d[l_i].xmeh202,g_xmeg3_d[l_i].xmeh203, 
                   g_xmeg3_d[l_i].xmeh204,g_xmeg3_d[l_i].xmeh205,g_xmeg3_d[l_i].xmeh206,g_xmeg3_d[l_i].xmeh207,g_xmeg3_d[l_i].xmehunit, 
                   g_xmeg3_d[l_i].xmeh210,g_xmeg3_d[l_i].xmeh212,g_xmeg3_d[l_i].xmeh213,g_xmeg3_d[l_i].xmeh214,g_xmeg3_d[l_i].xmeh215, 
                   g_xmeg3_d[l_i].xmeh218,g_xmeg3_d[l_i].xmeh219,g_xmeg3_d[l_i].xmeh220,g_xmeg3_d[l_i].xmeh221,g_xmeg3_d[l_i].xmeh222, 
                   g_xmeg3_d[l_i].xmeh223,g_xmeg3_d[l_i].xmeh224,g_xmeg3_d[l_i].xmehorga,g_xmeg3_d[l_i].xmeh226,g_xmeg3_d[l_i].xmeh227, 
                   g_xmeg3_d[l_i].xmeh228,g_xmeg3_d[l_i].xmeh229) 

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'ins xmeh_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         EXIT FOR
      END IF

   END FOR

   RETURN r_success 
END FUNCTION
#將交期明細資料新增到資料庫內
PRIVATE FUNCTION adbt510_ins_xmej()
   DEFINE l_sql      STRING
   DEFINE r_success  LIKE type_t.num5
  #DEFINE l_xmej     RECORD LIKE xmej_t.*   #161104-00002#1 161104 by 02749 mark
   DEFINE l_xmej     type_g_xmej            #161104-00002#1 161104 by 02749 add

   LET r_success = TRUE
   IF cl_null(g_xmee_m.xmeedocno) THEN
      LET r_success = FALSE
      RETURN r_success
   END IF 

   LET l_sql = "SELECT xmdfseq,xmdfseq2,xmdf002,xmdf003,xmdf004, ",
               "       xmdf005,xmdf006,xmdf200,xmdf201,xmdf202,xmdfunit ", 
               "  FROM xmdf_t WHERE xmdfent = '",g_enterprise,"'",
               "   AND xmdfdocno = '",g_xmee_m.xmeedocno,"'", 
               " ORDER BY xmdfseq,xmdfseq2 "         

   PREPARE sel_xmdf_pre FROM l_sql
   DECLARE sel_xmdf_cur CURSOR FOR sel_xmdf_pre
   
   FOREACH sel_xmdf_cur INTO l_xmej.xmejseq,l_xmej.xmejseq2,l_xmej.xmej002,l_xmej.xmej003,l_xmej.xmej004,
                             l_xmej.xmej005,l_xmej.xmej006,l_xmej.xmej200,l_xmej.xmej201,l_xmej.xmej202,l_xmej.xmejunit
      IF SQLCA.sqlcode THEN
         LET r_success = FALSE
         EXIT FOREACH
      END IF
                             
      INSERT INTO xmej_t 
                 (xmejent,xmejsite,xmejdocno,xmej900,xmejseq,
                  xmejseq2,xmej002,xmej003,xmej004,xmej005,
                  xmej006,xmej901,xmej200,xmej201,xmej202,xmejunit)  
           VALUES(g_enterprise,g_xmee_m.xmeesite,g_xmee_m.xmeedocno,g_xmee_m.xmee900,l_xmej.xmejseq,
                  l_xmej.xmejseq2,l_xmej.xmej002,l_xmej.xmej003,l_xmej.xmej004,l_xmej.xmej005,
                  l_xmej.xmej006,'1',l_xmej.xmej200,l_xmej.xmej201,l_xmej.xmej202,l_xmej.xmejunit)
                  
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'ins xmej_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         EXIT FOREACH
      END IF                             
   END FOREACH   
   RETURN r_success 
END FUNCTION
#單頭文字顯示的初始化
PRIVATE FUNCTION adbt510_head_init_color()
    CALL cl_set_comp_font_color("xmeestus,xmeeacti,xmee200,xmee201","black")
    CALL cl_set_comp_font_color("xmee021,xmee022,xmee203,xmee027,xmee002,xmee003","black")
    CALL cl_set_comp_font_color("xmeeunit,xmee904,xmee025,xmee026,xmee009,xmee010","black")
    CALL cl_set_comp_font_color("xmee035,xmee039,xmee071","black")
END FUNCTION

PRIVATE FUNCTION adbt510_detail_init_color()
    LET g_xmeg_d_color[l_ac].xmegsite          = 'black'
    LET g_xmeg_d_color[l_ac].xmegseq           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg027           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg001           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg001_desc      = 'black'
    LET g_xmeg_d_color[l_ac].imaal004          = 'black'
    LET g_xmeg_d_color[l_ac].xmeg002           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg004           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg004_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg005           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg006           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg006_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg007           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg008           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg008_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg009           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg024           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg012           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg013           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg045           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg010           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg010_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg011           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg015           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg016           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg016_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg017           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg046           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg047           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg048           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg023           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg019           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg020           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg021           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg022           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg051           = 'black'
    LET g_xmeg_d_color[l_ac].xmegunit          = 'black'
    LET g_xmeg_d_color[l_ac].xmegunit_desc     = 'black'
    LET g_xmeg_d_color[l_ac].xmegorga          = 'black'
    LET g_xmeg_d_color[l_ac].xmegorga_desc     = 'black'
    LET g_xmeg_d_color[l_ac].xmeg052           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg049           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg049_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg053           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg053_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg050           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg901           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg902           = 'black'
    LET g_xmeg_d_color[l_ac].xmeg902_desc      = 'black'
    LET g_xmeg_d_color[l_ac].xmeg903           = 'black'
END FUNCTION

PRIVATE FUNCTION adbt510_detail3_init_color()
    LET g_xmeg3_d_color[l_ac].xmehdocno         = 'black'
    LET g_xmeg3_d_color[l_ac].xmehseq           = 'black'
    LET g_xmeg3_d_color[l_ac].xmehseq1          = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh229           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh003           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh001           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh001_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh001_desc_desc = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh002           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh200           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh200_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh004           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh004_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh005           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh011           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh012           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeg012           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeg013           = 'black'
    LET g_xmeg3_d_color[l_ac].xmehseq2          = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh006           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh201           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh201_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh202           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh024           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh024_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh025           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh026           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh026_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh027           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh203           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh204           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh205           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh206           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh029           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh028           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh019           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh019_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh030           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh207           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh207_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmehunit          = 'black'
    LET g_xmeg3_d_color[l_ac].xmehunit_desc     = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh210           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh210_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh212           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh213           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh213_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh214           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh214_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh215           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh031           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh014           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh015           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh016           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh017           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh221           = 'black'
    LET g_xmeg3_d_color[l_ac].xmehsite          = 'black'
    LET g_xmeg3_d_color[l_ac].xmehsite_desc     = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh218           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh218_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh219           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh219_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh220           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh220_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh222           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh222_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh223           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh223_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh224           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh224_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmehorga          = 'black'
    LET g_xmeg3_d_color[l_ac].xmehorga_desc     = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh226           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh227           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh227_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh228           = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh228_desc      = 'black'
    LET g_xmeg3_d_color[l_ac].xmeh901           = 'black'
END FUNCTION

PRIVATE FUNCTION adbt510_detail4_init_color()
    LET g_xmeg4_d_color[l_ac].xmjbunit          = 'black'
    LET g_xmeg4_d_color[l_ac].xmjbseq           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjbsite          = 'black'
    LET g_xmeg4_d_color[l_ac].xmjbsite_desc     = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb001           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb002           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb003           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb003_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb003_desc_desc = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb033           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb004           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb005           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb005_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb006           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb006_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb007           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb011           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb011_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb012           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb013           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb013_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb014           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb015           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb015_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb016           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb017           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb017_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb018           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb008           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb009           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb010           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb022           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb019           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb020           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb021           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb024           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb024_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb025           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb026           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb026_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb027           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb027_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb028           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb029           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb030           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb031           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb032           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb034           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb901           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb902           = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb902_desc      = 'black'
    LET g_xmeg4_d_color[l_ac].xmjb903           = 'black'
END FUNCTION

PRIVATE FUNCTION adbt510_detail5_init_color()
    LET g_xmeg5_d_color[l_ac].xmefsite          = 'black'                   
    LET g_xmeg5_d_color[l_ac].xmef001           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef002           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef002_desc      = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef003           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef004           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef005           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef006           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef007           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef008           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef009           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef901           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef902           = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef902_desc      = 'black'                  
    LET g_xmeg5_d_color[l_ac].xmef903           = 'black' 
END FUNCTION

PRIVATE FUNCTION adbt510_head_color()
DEFINE l_xmek002      LIKE xmek_t.xmek002

   CALL adbt510_head_init_color()

   DECLARE sel_xmek_cs1 CURSOR FOR
    SELECT xmek002 FROM xmek_t
     WHERE xmekent = g_enterprise
       AND xmekdocno = g_xmee_m.xmeedocno
       AND xmek001 = g_xmee_m.xmee900
       AND xmekseq = 0
       AND xmekseq1= 0
       AND xmekseq2= 0

   FOREACH sel_xmek_cs1 INTO l_xmek002
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      LET l_xmek002 = cl_replace_str(l_xmek002,'xmda','xmee')

      CALL cl_set_comp_font_color(l_xmek002,"red")

   END FOREACH

END FUNCTION

PRIVATE FUNCTION adbt510_detail_color()
DEFINE l_xmek002         LIKE xmek_t.xmek002

   CALL adbt510_detail_init_color()

   DECLARE sel_xmek_cs CURSOR FOR
    SELECT xmek002 FROM xmek_t
     WHERE xmekent   = g_enterprise
       AND xmekdocno = g_xmee_m.xmeedocno
       AND xmek001   = g_xmee_m.xmee900
       AND xmekseq   = g_xmeg_d[l_ac].xmegseq
       AND xmekseq1  = 0
       AND xmekseq2  = 0
       AND xmek002 LIKE 'xmdc%'
   FOREACH sel_xmek_cs INTO l_xmek002
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      LET l_xmek002 = cl_replace_str(l_xmek002,'xmdc','xmeg')

      CASE l_xmek002
          WHEN 'xmeg012'                         
             LET g_xmeg_d_color[l_ac].xmeg012            = 'red'  
          WHEN 'xmeg013'                         
             LET g_xmeg_d_color[l_ac].xmeg013            = 'red'  
          WHEN 'xmeg024'                         
             LET g_xmeg_d_color[l_ac].xmeg024            = 'red'  
          WHEN 'xmeg050'                         
             LET g_xmeg_d_color[l_ac].xmeg050            = 'red'  
          WHEN 'xmeg008'                         
             LET g_xmeg_d_color[l_ac].xmeg008            = 'red'
             LET g_xmeg_d_color[l_ac].xmeg008_desc       = 'red'             
          WHEN 'xmeg009'                         
             LET g_xmeg_d_color[l_ac].xmeg009            = 'red' 
          WHEN 'xmegunit'            
             LET g_xmeg_d_color[l_ac].xmegunit           = 'red' 
             LET g_xmeg_d_color[l_ac].xmegunit_desc      = 'red'             
      END CASE
   END FOREACH 
END FUNCTION

PRIVATE FUNCTION adbt510_detail3_color()
DEFINE l_xmek002         LIKE xmek_t.xmek002

   CALL adbt510_detail3_init_color()

   DECLARE sel_xmek_cs3 CURSOR FOR
    SELECT xmek002 FROM xmek_t
     WHERE xmekent   = g_enterprise
       AND xmekdocno = g_xmee_m.xmeedocno
       AND xmek001   = g_xmee_m.xmee900
       AND xmekseq   = g_xmeg3_d[l_ac].xmehseq
       AND xmekseq1  = g_xmeg3_d[l_ac].xmehseq1
       AND xmekseq2  = g_xmeg3_d[l_ac].xmehseq2
   FOREACH sel_xmek_cs3 INTO l_xmek002
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      LET l_xmek002 = cl_replace_str(l_xmek002,'xmdd','xmeh')

      CASE l_xmek002
         WHEN 'xmehseq'
            LET g_xmeg3_d_color[l_ac].xmehseq           = 'red'
         WHEN 'xmehseq1'            
            LET g_xmeg3_d_color[l_ac].xmehseq1          = 'red'
         WHEN 'xmeh003'            
            LET g_xmeg3_d_color[l_ac].xmeh003           = 'red'
         WHEN 'xmeh001'            
            LET g_xmeg3_d_color[l_ac].xmeh001           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh001_desc      = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh001_desc_desc = 'red'
         WHEN 'xmeh002'            
            LET g_xmeg3_d_color[l_ac].xmeh002           = 'red'
         WHEN 'xmeh004'            
            LET g_xmeg3_d_color[l_ac].xmeh004           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh004_desc      = 'red'
         WHEN 'xmeh005'            
            LET g_xmeg3_d_color[l_ac].xmeh005           = 'red'
         WHEN 'xmehseq2'            
            LET g_xmeg3_d_color[l_ac].xmehseq2          = 'red'
         WHEN 'xmeh006'            
            LET g_xmeg3_d_color[l_ac].xmeh006           = 'red'
         WHEN 'xmeh024'            
            LET g_xmeg3_d_color[l_ac].xmeh024           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh024_desc      = 'red'
         WHEN 'xmeh025'            
            LET g_xmeg3_d_color[l_ac].xmeh025           = 'red'
         WHEN 'xmeh011'            
            LET g_xmeg3_d_color[l_ac].xmeh011           = 'red'
         WHEN 'xmeh012'            
            LET g_xmeg3_d_color[l_ac].xmeh012           = 'red'
         WHEN 'xmeh031'            
            LET g_xmeg3_d_color[l_ac].xmeh031           = 'red'
         WHEN 'xmeh014'            
            LET g_xmeg3_d_color[l_ac].xmeh014           = 'red'
         WHEN 'xmeh015'            
            LET g_xmeg3_d_color[l_ac].xmeh015           = 'red'
         WHEN 'xmeh016'            
            LET g_xmeg3_d_color[l_ac].xmeh016           = 'red'
         WHEN 'xmeh017'            
            LET g_xmeg3_d_color[l_ac].xmeh017           = 'red'
         WHEN 'xmeh026'            
            LET g_xmeg3_d_color[l_ac].xmeh026           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh026_desc      = 'red'
         WHEN 'xmeh027'            
            LET g_xmeg3_d_color[l_ac].xmeh027           = 'red'
         WHEN 'xmeh019'            
            LET g_xmeg3_d_color[l_ac].xmeh019           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh019_desc      = 'red'
         WHEN 'xmeh028'            
            LET g_xmeg3_d_color[l_ac].xmeh028           = 'red'
         WHEN 'xmeh029'            
            LET g_xmeg3_d_color[l_ac].xmeh029           = 'red'
         WHEN 'xmeh030'            
            LET g_xmeg3_d_color[l_ac].xmeh030           = 'red'
         WHEN 'xmeh229'            
            LET g_xmeg3_d_color[l_ac].xmeh229           = 'red' 
         WHEN 'xmeh200'            
            LET g_xmeg3_d_color[l_ac].xmeh200           = 'red' 
            LET g_xmeg3_d_color[l_ac].xmeh200_desc      = 'red' 
         WHEN 'xmeh201'            
            LET g_xmeg3_d_color[l_ac].xmeh201           = 'red' 
            LET g_xmeg3_d_color[l_ac].xmeh201_desc      = 'red'  
         WHEN 'xmeh202'            
            LET g_xmeg3_d_color[l_ac].xmeh202           = 'red' 
         WHEN 'xmeh203'            
            LET g_xmeg3_d_color[l_ac].xmeh203           = 'red' 
         WHEN 'xmeh204'            
            LET g_xmeg3_d_color[l_ac].xmeh204           = 'red' 
         WHEN 'xmeh205'            
            LET g_xmeg3_d_color[l_ac].xmeh205           = 'red' 
         WHEN 'xmeh206'            
            LET g_xmeg3_d_color[l_ac].xmeh206           = 'red' 
         WHEN 'xmeh207'            
            LET g_xmeg3_d_color[l_ac].xmeh207           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh207_desc      = 'red'   
         WHEN 'xmehunit'            
            LET g_xmeg3_d_color[l_ac].xmehunit          = 'red'
            LET g_xmeg3_d_color[l_ac].xmehunit_desc     = 'red'
         WHEN 'xmeh210'            
            LET g_xmeg3_d_color[l_ac].xmeh210           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh210_desc      = 'red' 
         WHEN 'xmeh212'            
            LET g_xmeg3_d_color[l_ac].xmeh212           = 'red'
         WHEN 'xmeh213'            
            LET g_xmeg3_d_color[l_ac].xmeh213           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh213_desc      = 'red' 
         WHEN 'xmeh214'            
            LET g_xmeg3_d_color[l_ac].xmeh214           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh214_desc      = 'red'  
         WHEN 'xmeh215'            
            LET g_xmeg3_d_color[l_ac].xmeh215           = 'red'
         WHEN 'xmeh221'            
            LET g_xmeg3_d_color[l_ac].xmeh221           = 'red'
         WHEN 'xmehsite'            
            LET g_xmeg3_d_color[l_ac].xmehsite          = 'red'
            LET g_xmeg3_d_color[l_ac].xmehsite_desc     = 'red'  
         WHEN 'xmeh218'            
            LET g_xmeg3_d_color[l_ac].xmeh218           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh218_desc      = 'red'  
         WHEN 'xmeh219'            
            LET g_xmeg3_d_color[l_ac].xmeh219           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh219_desc      = 'red'  
         WHEN 'xmeh220'            
            LET g_xmeg3_d_color[l_ac].xmeh220           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh220_desc      = 'red'  
         WHEN 'xmeh222'            
            LET g_xmeg3_d_color[l_ac].xmeh222           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh222_desc      = 'red'
         WHEN 'xmeh223'            
            LET g_xmeg3_d_color[l_ac].xmeh223           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh223_desc      = 'red'
         WHEN 'xmeh224'            
            LET g_xmeg3_d_color[l_ac].xmeh224           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh224_desc      = 'red'
         WHEN 'xmehorga'            
            LET g_xmeg3_d_color[l_ac].xmehorga          = 'red'
            LET g_xmeg3_d_color[l_ac].xmehorga_desc     = 'red'
         WHEN 'xmeh226'            
            LET g_xmeg3_d_color[l_ac].xmeh226           = 'red'
         WHEN 'xmeh227'            
            LET g_xmeg3_d_color[l_ac].xmeh227           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh227_desc      = 'red'
         WHEN 'xmeh228'            
            LET g_xmeg3_d_color[l_ac].xmeh228           = 'red'
            LET g_xmeg3_d_color[l_ac].xmeh228_desc      = 'red'       
      END CASE
   END FOREACH
END FUNCTION

PRIVATE FUNCTION adbt510_detail4_color()
DEFINE l_xmek002         LIKE xmek_t.xmek002

   CALL adbt510_detail4_init_color()

   DECLARE sel_xmek_cs4 CURSOR FOR
    SELECT xmek002 FROM xmek_t
     WHERE xmekent   = g_enterprise
       AND xmekdocno = g_xmee_m.xmeedocno
       AND xmek001   = g_xmee_m.xmee900
       AND xmekseq   = g_xmeg4_d[l_ac].xmjbseq
       AND xmekseq1  = 0
       AND xmekseq2  = 0
       AND xmek002 LIKE 'xmja%'
   FOREACH sel_xmek_cs4 INTO l_xmek002
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      LET l_xmek002 = cl_replace_str(l_xmek002,'xmja','xmjb')

      CASE l_xmek002
          WHEN 'xmjb001'                         
             LET g_xmeg4_d_color[l_ac].xmjb001           = 'red'  
          WHEN 'xmjb024'                         
             LET g_xmeg4_d_color[l_ac].xmjb024           = 'red'      
             LET g_xmeg4_d_color[l_ac].xmjb024_desc      = 'red' 
          WHEN 'xmjb026'                         
             LET g_xmeg4_d_color[l_ac].xmjb026           = 'red'      
             LET g_xmeg4_d_color[l_ac].xmjb026_desc      = 'red' 
          WHEN 'xmjb030'                         
             LET g_xmeg4_d_color[l_ac].xmjb030           = 'red' 
          WHEN 'xmjb031'                         
             LET g_xmeg4_d_color[l_ac].xmjb031           = 'red' 
          WHEN 'xmjb032'                         
             LET g_xmeg4_d_color[l_ac].xmjb032           = 'red' 
          WHEN 'xmjb034'                         
             LET g_xmeg4_d_color[l_ac].xmjb034           = 'red'  
          WHEN 'xmjbunit'                         
             LET g_xmeg4_d_color[l_ac].xmjbunit          = 'red'               
      END CASE
   END FOREACH  
END FUNCTION

PRIVATE FUNCTION adbt510_detail5_color()
DEFINE l_xmek002         LIKE xmek_t.xmek002

   CALL adbt510_detail5_init_color()

   DECLARE sel_xmek_cs5 CURSOR FOR
    SELECT xmek002 FROM xmek_t
     WHERE xmekent   = g_enterprise
       AND xmekdocno = g_xmee_m.xmeedocno
       AND xmek001   = g_xmee_m.xmee900
       AND xmekseq   = 0
       AND xmekseq1  = 0
       AND xmekseq2  = g_xmeg5_d[l_ac].xmef001
   FOREACH sel_xmek_cs5 INTO l_xmek002
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      LET l_xmek002 = cl_replace_str(l_xmek002,'xmdb','xmef')

      CASE l_xmek002
          WHEN 'xmef001'                         
             LET g_xmeg5_d_color[l_ac].xmef001           = 'red'  
          WHEN 'xmef002'                             
             LET g_xmeg5_d_color[l_ac].xmef002           = 'red'                  
             LET g_xmeg5_d_color[l_ac].xmef002_desc      = 'red'                  
          WHEN 'xmef003'                       
             LET g_xmeg5_d_color[l_ac].xmef003           = 'red'                  
          WHEN 'xmef004'             
             LET g_xmeg5_d_color[l_ac].xmef004           = 'red'                  
          WHEN 'xmef005'             
             LET g_xmeg5_d_color[l_ac].xmef005           = 'red'                  
          WHEN 'xmef006'             
             LET g_xmeg5_d_color[l_ac].xmef006           = 'red'                  
          WHEN 'xmef007'             
             LET g_xmeg5_d_color[l_ac].xmef007           = 'red'                  
          WHEN 'xmef008'             
             LET g_xmeg5_d_color[l_ac].xmef008           = 'red'                  
          WHEN 'xmef009'             
             LET g_xmeg5_d_color[l_ac].xmef009           = 'red'                  
      END CASE
   END FOREACH   
END FUNCTION
#新增訂單變更歷程檔並修改單頭變更否欄位
PRIVATE FUNCTION adbt510_upd_xmee901()
  #DEFINE l_xmda_m     RECORD LIKE xmda_t.*  #訂單單頭檔   #161104-00002#1 161104 by 02749 mark
  
   #161104-00002#1 161104 by 02749 add---(S)
   DEFINE l_xmda_m     RECORD
             xmdaent     LIKE xmda_t.xmdaent   ,   #企業編號
             xmdasite    LIKE xmda_t.xmdasite  ,   #營運據點
             xmdadocno   LIKE xmda_t.xmdadocno ,   #訂單單號
             xmdadocdt   LIKE xmda_t.xmdadocdt ,   #訂單日期
             xmda001     LIKE xmda_t.xmda001   ,   #版次
             xmda002     LIKE xmda_t.xmda002   ,   #業務人員
             xmda003     LIKE xmda_t.xmda003   ,   #業務部門
             xmda004     LIKE xmda_t.xmda004   ,   #客戶編號
             xmda005     LIKE xmda_t.xmda005   ,   #訂單性質
             xmda006     LIKE xmda_t.xmda006   ,   #多角性質
             xmda007     LIKE xmda_t.xmda007   ,   #資料來源
             xmda008     LIKE xmda_t.xmda008   ,   #來源單號
             xmda009     LIKE xmda_t.xmda009   ,   #收款條件
             xmda010     LIKE xmda_t.xmda010   ,   #交易條件
             xmda011     LIKE xmda_t.xmda011   ,   #稅別
             xmda012     LIKE xmda_t.xmda012   ,   #稅率
             xmda013     LIKE xmda_t.xmda013   ,   #單價含稅否
             xmda015     LIKE xmda_t.xmda015   ,   #幣別
             xmda016     LIKE xmda_t.xmda016   ,   #匯率
             xmda017     LIKE xmda_t.xmda017   ,   #取價方式
             xmda018     LIKE xmda_t.xmda018   ,   #收款優惠條件
             xmda019     LIKE xmda_t.xmda019   ,   #納入APS計算
             xmda020     LIKE xmda_t.xmda020   ,   #運送方式
             xmda021     LIKE xmda_t.xmda021   ,   #帳款客戶
             xmda022     LIKE xmda_t.xmda022   ,   #收貨客戶
             xmda023     LIKE xmda_t.xmda023   ,   #銷售通路
             xmda024     LIKE xmda_t.xmda024   ,   #銷售分類二
             xmda025     LIKE xmda_t.xmda025   ,   #出貨地址
             xmda026     LIKE xmda_t.xmda026   ,   #帳款地址
             xmda027     LIKE xmda_t.xmda027   ,   #客戶連絡人
             xmda028     LIKE xmda_t.xmda028   ,   #一次性交易對象識別碼
             xmda029     LIKE xmda_t.xmda029   ,   #出貨部門
             xmda030     LIKE xmda_t.xmda030   ,   #多角貿易已拋轉
             xmda031     LIKE xmda_t.xmda031   ,   #多角序號
             xmda032     LIKE xmda_t.xmda032   ,   #留置原因
             xmda033     LIKE xmda_t.xmda033   ,   #客戶訂購單號
             xmda034     LIKE xmda_t.xmda034   ,   #最終客戶
             xmda035     LIKE xmda_t.xmda035   ,   #發票類型
             xmda036     LIKE xmda_t.xmda036   ,   #送貨供應商
             xmda037     LIKE xmda_t.xmda037   ,   #起運點
             xmda038     LIKE xmda_t.xmda038   ,   #目的地
             xmda039     LIKE xmda_t.xmda039   ,   #預收款發票開立方式
             xmda041     LIKE xmda_t.xmda041   ,   #訂單總未稅金額
             xmda042     LIKE xmda_t.xmda042   ,   #訂單總含稅金額
             xmda043     LIKE xmda_t.xmda043   ,   #訂單總稅額
             xmda044     LIKE xmda_t.xmda044   ,   #嘜頭編號
             xmda045     LIKE xmda_t.xmda045   ,   #物流結案
             xmda046     LIKE xmda_t.xmda046   ,   #帳流結案
             xmda047     LIKE xmda_t.xmda047   ,   #金流結案
             xmda048     LIKE xmda_t.xmda048   ,   #內外銷
             xmda049     LIKE xmda_t.xmda049   ,   #匯率計算基準
             xmda050     LIKE xmda_t.xmda050   ,   #多角流程編號
             xmda051     LIKE xmda_t.xmda051   ,   #多角最終站
             xmda071     LIKE xmda_t.xmda071   ,   #備註
             xmda200     LIKE xmda_t.xmda200   ,   #調貨經銷商編號
             xmda201     LIKE xmda_t.xmda201   ,   #代送商編號
             xmda202     LIKE xmda_t.xmda202   ,   #銷售辦事處
             xmda203     LIKE xmda_t.xmda203   ,   #發票客戶
             xmda204     LIKE xmda_t.xmda204   ,   #促銷方案編號
             xmda205     LIKE xmda_t.xmda205   ,   #整單折扣
             xmda206     LIKE xmda_t.xmda206   ,   #送貨站點編號
             xmda207     LIKE xmda_t.xmda207   ,   #運輸路線編號
             xmda208     LIKE xmda_t.xmda208   ,   #地區編號
             xmda209     LIKE xmda_t.xmda209   ,   #縣市編號
             xmda210     LIKE xmda_t.xmda210   ,   #省區編號
             xmda211     LIKE xmda_t.xmda211   ,   #區域編號
             xmda212     LIKE xmda_t.xmda212   ,   #本幣含稅總金額
             xmda213     LIKE xmda_t.xmda213   ,   #收款完成否
             xmdaunit    LIKE xmda_t.xmdaunit  ,   #發貨組織      
             xmdaownid   LIKE xmda_t.xmdaownid ,   #資料所有者
             xmdaowndp   LIKE xmda_t.xmdaowndp ,   #資料所屬部門
             xmdacrtid   LIKE xmda_t.xmdacrtid ,   #資料建立者
             xmdacrtdp   LIKE xmda_t.xmdacrtdp ,   #資料建立部門
             xmdacrtdt   LIKE xmda_t.xmdacrtdt ,   #資料創建日
             xmdamodid   LIKE xmda_t.xmdamodid ,   #資料修改者
             xmdamoddt   LIKE xmda_t.xmdamoddt ,   #最近修改日
             xmdacnfid   LIKE xmda_t.xmdacnfid ,   #資料確認者
             xmdacnfdt   LIKE xmda_t.xmdacnfdt ,   #資料確認日
             xmdapstid   LIKE xmda_t.xmdapstid ,   #資料過帳者
             xmdapstdt   LIKE xmda_t.xmdapstdt ,   #資料過帳日
             xmdastus    LIKE xmda_t.xmdastus  ,   #狀態碼
             #161123-00042#1 Add By Ken 161124(S)
             xmdaud001 LIKE xmda_t.xmdaud001, #自定義欄位(文字)001
             xmdaud002 LIKE xmda_t.xmdaud002, #自定義欄位(文字)002
             xmdaud003 LIKE xmda_t.xmdaud003, #自定義欄位(文字)003
             xmdaud004 LIKE xmda_t.xmdaud004, #自定義欄位(文字)004
             xmdaud005 LIKE xmda_t.xmdaud005, #自定義欄位(文字)005
             xmdaud006 LIKE xmda_t.xmdaud006, #自定義欄位(文字)006
             xmdaud007 LIKE xmda_t.xmdaud007, #自定義欄位(文字)007
             xmdaud008 LIKE xmda_t.xmdaud008, #自定義欄位(文字)008
             xmdaud009 LIKE xmda_t.xmdaud009, #自定義欄位(文字)009
             xmdaud010 LIKE xmda_t.xmdaud010, #自定義欄位(文字)010
             xmdaud011 LIKE xmda_t.xmdaud011, #自定義欄位(數字)011
             xmdaud012 LIKE xmda_t.xmdaud012, #自定義欄位(數字)012
             xmdaud013 LIKE xmda_t.xmdaud013, #自定義欄位(數字)013
             xmdaud014 LIKE xmda_t.xmdaud014, #自定義欄位(數字)014
             xmdaud015 LIKE xmda_t.xmdaud015, #自定義欄位(數字)015
             xmdaud016 LIKE xmda_t.xmdaud016, #自定義欄位(數字)016
             xmdaud017 LIKE xmda_t.xmdaud017, #自定義欄位(數字)017
             xmdaud018 LIKE xmda_t.xmdaud018, #自定義欄位(數字)018
             xmdaud019 LIKE xmda_t.xmdaud019, #自定義欄位(數字)019
             xmdaud020 LIKE xmda_t.xmdaud020, #自定義欄位(數字)020
             xmdaud021 LIKE xmda_t.xmdaud021, #自定義欄位(日期時間)021
             xmdaud022 LIKE xmda_t.xmdaud022, #自定義欄位(日期時間)022
             xmdaud023 LIKE xmda_t.xmdaud023, #自定義欄位(日期時間)023
             xmdaud024 LIKE xmda_t.xmdaud024, #自定義欄位(日期時間)024
             xmdaud025 LIKE xmda_t.xmdaud025, #自定義欄位(日期時間)025
             xmdaud026 LIKE xmda_t.xmdaud026, #自定義欄位(日期時間)026
             xmdaud027 LIKE xmda_t.xmdaud027, #自定義欄位(日期時間)027
             xmdaud028 LIKE xmda_t.xmdaud028, #自定義欄位(日期時間)028
             xmdaud029 LIKE xmda_t.xmdaud029, #自定義欄位(日期時間)029
             xmdaud030 LIKE xmda_t.xmdaud030  #自定義欄位(日期時間)030
             #161123-00042#1 Add By Ken 161124(E)
                       END RECORD
   #161104-00002#1 161104 by 02749 add---(E)
   DEFINE l_flag       LIKE type_t.num5      #記錄是否有欄位變更
   DEFINE r_success    LIKE type_t.num5
   DEFINE l_ooef019    LIKE ooef_t.ooef019
   DEFINE l_pmaa027    LIKE pmaa_t.pmaa027   #聯絡對象識別碼
   DEFINE l_oocq019    LIKE oocq_t.oocq019

   LET r_success = TRUE
   LET l_flag = FALSE

   #抓取訂單單頭的值
   INITIALIZE l_xmda_m.* TO NULL
   SELECT xmdasite,xmdadocno,xmda001,xmdadocdt,xmda004,
          xmda002,xmda003,xmda005,xmda006,
          xmda007,xmda008,xmda033,xmda027,xmda009,
          xmda010,xmda011,xmda012,xmda013,xmda035,
          xmda015,xmda016,xmda017,xmda018,xmda019,
          xmda023,xmda032,xmda071,xmda021,xmda022,
          xmda034,xmda024,xmda044,xmda030,xmda031,
          xmda045,xmda046,xmda047,xmda028,xmda041,
          xmda042,xmda043,xmda025,xmda026,xmda020,
          xmda036,xmda039,xmda200,
          xmda201,xmda203,xmdaunit,xmda206,xmda207,
          xmda208,xmda209,xmda210,xmda211
     INTO l_xmda_m.xmdasite,l_xmda_m.xmdadocno,l_xmda_m.xmda001,l_xmda_m.xmdadocdt,l_xmda_m.xmda004,
          l_xmda_m.xmda002,l_xmda_m.xmda003,l_xmda_m.xmda005,l_xmda_m.xmda006,
          l_xmda_m.xmda007,l_xmda_m.xmda008,l_xmda_m.xmda033,l_xmda_m.xmda027,l_xmda_m.xmda009,
          l_xmda_m.xmda010,l_xmda_m.xmda011,l_xmda_m.xmda012,l_xmda_m.xmda013,l_xmda_m.xmda035,
          l_xmda_m.xmda015,l_xmda_m.xmda016,l_xmda_m.xmda017,l_xmda_m.xmda018,l_xmda_m.xmda019,
          l_xmda_m.xmda023,l_xmda_m.xmda032,l_xmda_m.xmda071,l_xmda_m.xmda021,l_xmda_m.xmda022,
          l_xmda_m.xmda034,l_xmda_m.xmda024,l_xmda_m.xmda044,l_xmda_m.xmda030,l_xmda_m.xmda031,
          l_xmda_m.xmda045,l_xmda_m.xmda046,l_xmda_m.xmda047,l_xmda_m.xmda028,l_xmda_m.xmda041,
          l_xmda_m.xmda042,l_xmda_m.xmda043,l_xmda_m.xmda025,l_xmda_m.xmda026,l_xmda_m.xmda020,
          l_xmda_m.xmda036,l_xmda_m.xmda039,l_xmda_m.xmda200,
          l_xmda_m.xmda201,l_xmda_m.xmda203,l_xmda_m.xmdaunit,l_xmda_m.xmda206,l_xmda_m.xmda207,
          l_xmda_m.xmda208,l_xmda_m.xmda209,l_xmda_m.xmda210,l_xmda_m.xmda211          
     FROM xmda_t
    WHERE xmdaent = g_enterprise
      AND xmdadocno = g_xmee_m.xmeedocno


   #業務人員
   IF (NOT cl_null(g_xmee_m.xmee002) AND (g_xmee_m.xmee002 != l_xmda_m.xmda002 OR cl_null(l_xmda_m.xmda002))) OR
      (cl_null(g_xmee_m.xmee002) AND NOT cl_null(l_xmda_m.xmda002)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT oofa011 FROM oofa_t WHERE oofaent ='"||g_enterprise||"' AND oofa002 = '2' AND oofa003 ='"||l_xmda_m.xmda002||"' "
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda002",'1',l_xmda_m.xmda002,g_xmee_m.xmee002,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda002",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF   

   #業務部門
   IF (NOT cl_null(g_xmee_m.xmee003) AND (g_xmee_m.xmee003 != l_xmda_m.xmda003 OR cl_null(l_xmda_m.xmda003))) OR
      (cl_null(g_xmee_m.xmee003) AND NOT cl_null(l_xmda_m.xmda003)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_lang||"'"
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda003",'1',l_xmda_m.xmda003,g_xmee_m.xmee003,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda003",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   #客戶連絡人
   IF (NOT cl_null(g_xmee_m.xmee027) AND (g_xmee_m.xmee027 != l_xmda_m.xmda027 OR cl_null(l_xmda_m.xmda027))) OR
      (cl_null(g_xmee_m.xmee027) AND NOT cl_null(l_xmda_m.xmda027)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT oofa011 FROM oofa_t WHERE oofaent ='"||g_enterprise||"' AND oofa002 = '2' AND oofa003 ='"||l_xmda_m.xmda027||"' "
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda027",'1',l_xmda_m.xmda027,g_xmee_m.xmee027,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda027",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF   

   #收款條件
   IF (NOT cl_null(g_xmee_m.xmee009) AND (g_xmee_m.xmee009 != l_xmda_m.xmda009 OR cl_null(l_xmda_m.xmda009))) OR
      (cl_null(g_xmee_m.xmee009) AND NOT cl_null(l_xmda_m.xmda009)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT ooibl004 FROM ooibl_t WHERE ooiblent='"||g_enterprise||"' AND ooibl002=? AND ooibl003='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda009",'1',l_xmda_m.xmda009,g_xmee_m.xmee009,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda009",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 

   #交易條件
   IF (NOT cl_null(g_xmee_m.xmee010) AND (g_xmee_m.xmee010 != l_xmda_m.xmda010 OR cl_null(l_xmda_m.xmda010))) OR
      (cl_null(g_xmee_m.xmee010) AND NOT cl_null(l_xmda_m.xmda010)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='238' AND oocql002=? AND oocql003='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda010",'1',l_xmda_m.xmda010,g_xmee_m.xmee010,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda010",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 

   #發票類型
   IF (NOT cl_null(g_xmee_m.xmee035) AND (g_xmee_m.xmee035 != l_xmda_m.xmda035 OR cl_null(l_xmda_m.xmda035))) OR
      (cl_null(g_xmee_m.xmee035) AND NOT cl_null(l_xmda_m.xmda035)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT isacl004 FROM isacl_t WHERE isaclent='"||g_enterprise||"' AND isacl002=? AND isacl003='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda035",'1',l_xmda_m.xmda035,g_xmee_m.xmee035,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda035",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
   
   #備註
   IF (NOT cl_null(g_xmee_m.xmee071) AND (g_xmee_m.xmee071 != l_xmda_m.xmda071 OR cl_null(l_xmda_m.xmda071))) OR
      (cl_null(g_xmee_m.xmee071) AND NOT cl_null(l_xmda_m.xmda071)) THEN
      #其說明的SQL
      LET g_xmek007 = NULL
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda071",'1',l_xmda_m.xmda071,g_xmee_m.xmee071,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda071",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 

   #帳款客戶
   IF (NOT cl_null(g_xmee_m.xmee021) AND (g_xmee_m.xmee021 != l_xmda_m.xmda021 OR cl_null(l_xmda_m.xmda021))) OR
      (cl_null(g_xmee_m.xmee021) AND NOT cl_null(l_xmda_m.xmda021)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda021",'1',l_xmda_m.xmda021,g_xmee_m.xmee021,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda021",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #收貨客戶
   IF (NOT cl_null(g_xmee_m.xmee022) AND (g_xmee_m.xmee022 != l_xmda_m.xmda022 OR cl_null(l_xmda_m.xmda022))) OR
      (cl_null(g_xmee_m.xmee022) AND NOT cl_null(l_xmda_m.xmda022)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda022",'1',l_xmda_m.xmda022,g_xmee_m.xmee022,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda022",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 
   
   #發票客戶
   IF (NOT cl_null(g_xmee_m.xmee203) AND (g_xmee_m.xmee203 != l_xmda_m.xmda203 OR cl_null(l_xmda_m.xmda203))) OR
      (cl_null(g_xmee_m.xmee203) AND NOT cl_null(l_xmda_m.xmda203)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda203",'1',l_xmda_m.xmda203,g_xmee_m.xmee203,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda203",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 
   
   #調貨經銷商
   IF (NOT cl_null(g_xmee_m.xmee200) AND (g_xmee_m.xmee200 != l_xmda_m.xmda200 OR cl_null(l_xmda_m.xmda200))) OR
      (cl_null(g_xmee_m.xmee200) AND NOT cl_null(l_xmda_m.xmda200)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda200",'1',l_xmda_m.xmda200,g_xmee_m.xmee200,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda200",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 
   
   #代送商
   IF (NOT cl_null(g_xmee_m.xmee201) AND (g_xmee_m.xmee201 != l_xmda_m.xmda201 OR cl_null(l_xmda_m.xmda201))) OR
      (cl_null(g_xmee_m.xmee201) AND NOT cl_null(l_xmda_m.xmda201)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda201",'1',l_xmda_m.xmda201,g_xmee_m.xmee201,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda201",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 
   
   #發貨組織
   IF (NOT cl_null(g_xmee_m.xmeeunit) AND (g_xmee_m.xmeeunit != l_xmda_m.xmdaunit OR cl_null(l_xmda_m.xmdaunit))) OR
      (cl_null(g_xmee_m.xmeeunit) AND NOT cl_null(l_xmda_m.xmdaunit)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"' "

      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmdaunit",'1',l_xmda_m.xmdaunit,g_xmee_m.xmeeunit,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmdaunit",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 
   
   #銷售分類
   IF (NOT cl_null(g_xmee_m.xmee024) AND (g_xmee_m.xmee024 != l_xmda_m.xmda024 OR cl_null(l_xmda_m.xmda024))) OR
      (cl_null(g_xmee_m.xmee024) AND NOT cl_null(l_xmda_m.xmda024)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='295' AND oocql002=? AND oocql003='"||g_dlang||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda024",'1',l_xmda_m.xmda024,g_xmee_m.xmee024,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda024",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 

   #出貨地址
   IF (NOT cl_null(g_xmee_m.xmee025) AND (g_xmee_m.xmee025 != l_xmda_m.xmda025 OR cl_null(l_xmda_m.xmda025))) OR
      (cl_null(g_xmee_m.xmee025) AND NOT cl_null(l_xmda_m.xmda025)) THEN
      #其說明的SQL
      CALL adbt510_get_pmaa027(g_xmee_m.xmee021) RETURNING l_pmaa027    
      LET g_xmek007 = "SELECT oofb011 FROM oofb_t WHERE oofbent='"||g_enterprise||"' AND oofb002='"||l_pmaa027||"' AND oofb008 = '2' AND oofb019='"||l_xmda_m.xmda025||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda025",'1',l_xmda_m.xmda025,g_xmee_m.xmee025,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda025",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   #組合地址oofb017    
   
   #帳款地址
   IF (NOT cl_null(g_xmee_m.xmee026) AND (g_xmee_m.xmee026 != l_xmda_m.xmda026 OR cl_null(l_xmda_m.xmda026))) OR
      (cl_null(g_xmee_m.xmee026) AND NOT cl_null(l_xmda_m.xmda026)) THEN
      #其說明的SQL
      CALL adbt510_get_pmaa027(g_xmee_m.xmee021) RETURNING l_pmaa027    
      LET g_xmek007 = "SELECT oofb011 FROM oofb_t WHERE oofbent='"||g_enterprise||"' AND oofb002='"||l_pmaa027||"' AND oofb008 = '2' AND oofb019='"||l_xmda_m.xmda026||"' "
      
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda026",'1',l_xmda_m.xmda026,g_xmee_m.xmee026,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda026",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
   #組合地址oofb017_1   
 
   #送貨站點
   IF (NOT cl_null(g_xmee_m.xmee206) AND (g_xmee_m.xmee206 != l_xmda_m.xmda206 OR cl_null(l_xmda_m.xmda206))) OR
      (cl_null(g_xmee_m.xmee206) AND NOT cl_null(l_xmda_m.xmda206)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT dbadl003 FROM dbadl_t WHERE dbadlent='"||g_enterprise||"' AND dbadl001=? AND dbadl002='"||g_dlang||"'"

      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda206",'1',l_xmda_m.xmda206,g_xmee_m.xmee206,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda206",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
  
   #運輸路線
   IF (NOT cl_null(g_xmee_m.xmee207) AND (g_xmee_m.xmee207 != l_xmda_m.xmda207 OR cl_null(l_xmda_m.xmda207))) OR
      (cl_null(g_xmee_m.xmee207) AND NOT cl_null(l_xmda_m.xmda207)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT dbabl003 FROM dbabl_t WHERE dbablent='"||g_enterprise||"' AND dbabl001=? AND dbabl002='"||g_dlang||"'"

      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda207",'1',l_xmda_m.xmda207,g_xmee_m.xmee207,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda207",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
 
   #預收款發票開立方式
   IF (NOT cl_null(g_xmee_m.xmee039) AND (g_xmee_m.xmee039 != l_xmda_m.xmda039 OR cl_null(l_xmda_m.xmda039))) OR
      (cl_null(g_xmee_m.xmee039) AND NOT cl_null(l_xmda_m.xmda039)) THEN
      #其說明的SQL
      LET g_xmek007 = NULL
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda039",'1',l_xmda_m.xmda039,g_xmee_m.xmee039,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda039",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 

   #區域編號
   IF (NOT cl_null(g_xmee_m.xmee211) AND (g_xmee_m.xmee211 != l_xmda_m.xmda211 OR cl_null(l_xmda_m.xmda211))) OR
      (cl_null(g_xmee_m.xmee211) AND NOT cl_null(l_xmda_m.xmda211)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'"

      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda211",'1',l_xmda_m.xmda211,g_xmee_m.xmee211,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda211",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
   
   #省區編號
   IF (NOT cl_null(g_xmee_m.xmee210) AND (g_xmee_m.xmee210 != l_xmda_m.xmda210 OR cl_null(l_xmda_m.xmda210))) OR
      (cl_null(g_xmee_m.xmee210) AND NOT cl_null(l_xmda_m.xmda210)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'"

      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda210",'1',l_xmda_m.xmda210,g_xmee_m.xmee210,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda210",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
   
   #縣市編號
   IF (NOT cl_null(g_xmee_m.xmee209) AND (g_xmee_m.xmee209 != l_xmda_m.xmda209 OR cl_null(l_xmda_m.xmda209))) OR
      (cl_null(g_xmee_m.xmee209) AND NOT cl_null(l_xmda_m.xmda209)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'"

      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda209",'1',l_xmda_m.xmda209,g_xmee_m.xmee209,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda209",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  

   #地區編號
   IF (NOT cl_null(g_xmee_m.xmee208) AND (g_xmee_m.xmee208 != l_xmda_m.xmda208 OR cl_null(l_xmda_m.xmda208))) OR
      (cl_null(g_xmee_m.xmee208) AND NOT cl_null(l_xmda_m.xmda208)) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT dbaal003 FROM dbaal_t WHERE dbaalent='"||g_enterprise||"' AND dbaal001=? AND dbaal002='"||g_dlang||"'"

      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,0,"xmda208",'1',l_xmda_m.xmda208,g_xmee_m.xmee208,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      ELSE
         LET l_flag = TRUE     #有欄位變更，則更新為'Y'
      END IF
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,0,"xmda208",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  

   IF l_flag THEN
      UPDATE xmee_t SET xmee901 = 'Y'
       WHERE xmeeent = g_enterprise
         AND xmeedocno = g_xmee_m.xmeedocno
         AND xmee900 = g_xmee_m.xmee900
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "upd xmee901"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   RETURN r_success
   
END FUNCTION

PRIVATE FUNCTION adbt510_xmjb_ins_xmek(p_xmjb_d)
   DEFINE p_xmjb_d          type_g_xmeg4_d
   DEFINE r_success         LIKE type_t.num5
  #DEFINE l_xmja            RECORD LIKE xmja_t.*  #161104-00002#1 161104 by 02749 mark
  
   #161104-00002#1 161104 by 02749 add---(S)
   DEFINE l_xmja            RECORD
             xmjaent      LIKE xmja_t.xmjaent   ,   #企業編號
             xmjasite     LIKE xmja_t.xmjasite  ,   #營運據點
             xmjaunit     LIKE xmja_t.xmjaunit  ,   #應用組織
             xmjadocno    LIKE xmja_t.xmjadocno ,   #單據編號
             xmjaseq      LIKE xmja_t.xmjaseq   ,   #項次
             xmja001      LIKE xmja_t.xmja001   ,   #交易類型
             xmja002      LIKE xmja_t.xmja002   ,   #商品條碼
             xmja003      LIKE xmja_t.xmja003   ,   #商品編號
             xmja004      LIKE xmja_t.xmja004   ,   #產品特徵
             xmja005      LIKE xmja_t.xmja005   ,   #促銷方案
             xmja006      LIKE xmja_t.xmja006   ,   #稅別編號
             xmja007      LIKE xmja_t.xmja007   ,   #稅率
             xmja008      LIKE xmja_t.xmja008   ,   #標準售價
             xmja009      LIKE xmja_t.xmja009   ,   #促銷價
             xmja010      LIKE xmja_t.xmja010   ,   #交易價
             xmja011      LIKE xmja_t.xmja011   ,   #包裝單位
             xmja012      LIKE xmja_t.xmja012   ,   #包裝數量
             xmja013      LIKE xmja_t.xmja013   ,   #銷售單位
             xmja014      LIKE xmja_t.xmja014   ,   #銷售數量
             xmja015      LIKE xmja_t.xmja015   ,   #參考單位
             xmja016      LIKE xmja_t.xmja016   ,   #參考數量
             xmja017      LIKE xmja_t.xmja017   ,   #計價單位
             xmja018      LIKE xmja_t.xmja018   ,   #計價數量
             xmja019      LIKE xmja_t.xmja019   ,   #未稅金額
             xmja020      LIKE xmja_t.xmja020   ,   #稅額
             xmja021      LIKE xmja_t.xmja021   ,   #含稅金額
             xmja022      LIKE xmja_t.xmja022   ,   #折價金額
             xmja024      LIKE xmja_t.xmja024   ,   #收貨網點
             xmja025      LIKE xmja_t.xmja025   ,   #送貨客戶
             xmja026      LIKE xmja_t.xmja026   ,   #送貨地址碼
             xmja027      LIKE xmja_t.xmja027   ,   #送貨站點
             xmja028      LIKE xmja_t.xmja028   ,   #主合約編號
             xmja029      LIKE xmja_t.xmja029   ,   #協議編號
             xmja030      LIKE xmja_t.xmja030   ,   #多交期
             xmja031      LIKE xmja_t.xmja031   ,   #約定交貨日
             xmja032      LIKE xmja_t.xmja032   ,   #約定簽收日
             xmja033      LIKE xmja_t.xmja033   ,   #客戶料號
             xmja034      LIKE xmja_t.xmja034   ,   #備註
             xmja035      LIKE xmja_t.xmja035   ,   #來源促銷分配單號
             xmja036      LIKE xmja_t.xmja036   ,   #來源促銷分配項次
             xmja037      LIKE xmja_t.xmja037   ,   #地區編號
             xmja038      LIKE xmja_t.xmja038   ,   #縣市編號
             xmja039      LIKE xmja_t.xmja039   ,   #省區編號
             xmja040      LIKE xmja_t.xmja040   ,   #區域編號   
             #161123-00042#1 Add By Ken 161124(S)
             xmjaud001 LIKE xmja_t.xmjaud001, #自定義欄位(文字)001
             xmjaud002 LIKE xmja_t.xmjaud002, #自定義欄位(文字)002
             xmjaud003 LIKE xmja_t.xmjaud003, #自定義欄位(文字)003
             xmjaud004 LIKE xmja_t.xmjaud004, #自定義欄位(文字)004
             xmjaud005 LIKE xmja_t.xmjaud005, #自定義欄位(文字)005
             xmjaud006 LIKE xmja_t.xmjaud006, #自定義欄位(文字)006
             xmjaud007 LIKE xmja_t.xmjaud007, #自定義欄位(文字)007
             xmjaud008 LIKE xmja_t.xmjaud008, #自定義欄位(文字)008
             xmjaud009 LIKE xmja_t.xmjaud009, #自定義欄位(文字)009
             xmjaud010 LIKE xmja_t.xmjaud010, #自定義欄位(文字)010
             xmjaud011 LIKE xmja_t.xmjaud011, #自定義欄位(數字)011
             xmjaud012 LIKE xmja_t.xmjaud012, #自定義欄位(數字)012
             xmjaud013 LIKE xmja_t.xmjaud013, #自定義欄位(數字)013
             xmjaud014 LIKE xmja_t.xmjaud014, #自定義欄位(數字)014
             xmjaud015 LIKE xmja_t.xmjaud015, #自定義欄位(數字)015
             xmjaud016 LIKE xmja_t.xmjaud016, #自定義欄位(數字)016
             xmjaud017 LIKE xmja_t.xmjaud017, #自定義欄位(數字)017
             xmjaud018 LIKE xmja_t.xmjaud018, #自定義欄位(數字)018
             xmjaud019 LIKE xmja_t.xmjaud019, #自定義欄位(數字)019
             xmjaud020 LIKE xmja_t.xmjaud020, #自定義欄位(數字)020
             xmjaud021 LIKE xmja_t.xmjaud021, #自定義欄位(日期時間)021
             xmjaud022 LIKE xmja_t.xmjaud022, #自定義欄位(日期時間)022
             xmjaud023 LIKE xmja_t.xmjaud023, #自定義欄位(日期時間)023
             xmjaud024 LIKE xmja_t.xmjaud024, #自定義欄位(日期時間)024
             xmjaud025 LIKE xmja_t.xmjaud025, #自定義欄位(日期時間)025
             xmjaud026 LIKE xmja_t.xmjaud026, #自定義欄位(日期時間)026
             xmjaud027 LIKE xmja_t.xmjaud027, #自定義欄位(日期時間)027
             xmjaud028 LIKE xmja_t.xmjaud028, #自定義欄位(日期時間)028
             xmjaud029 LIKE xmja_t.xmjaud029, #自定義欄位(日期時間)029
             xmjaud030 LIKE xmja_t.xmjaud030  #自定義欄位(日期時間)030
             #161123-00042#1 Add By Ken 161124(E)
                            END RECORD
   #161104-00002#1 161104 by 02749 add---(E)
   
   DEFINE l_flag            LIKE type_t.num5      #單身是否有修改
   DEFINE l_xmjbseq         LIKE xmjb_t.xmjbseq

   LET r_success = TRUE

   IF p_xmjb_d.xmjb901 = '1' THEN       #未變更不需寫入歷程檔內  
      RETURN r_success
   END IF

   INITIALIZE l_xmja.* TO NULL
   LET l_flag = FALSE

   IF p_xmjb_d.xmjb901 = '2' THEN     
      SELECT xmja001,xmja024,xmja026,xmja027,
             xmja030,xmja031,xmja032,xmja034,
             xmja015,xmja016
        INTO l_xmja.xmja001,l_xmja.xmja024,l_xmja.xmja026,l_xmja.xmja027,
             l_xmja.xmja030,l_xmja.xmja031,l_xmja.xmja032,l_xmja.xmja034,
             l_xmja.xmja015,l_xmja.xmja016
        FROM xmja_t 
       WHERE xmjaent = g_enterprise
         AND xmjadocno = g_xmee_m.xmeedocno
         AND xmjaseq = p_xmjb_d.xmjbseq
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'sel xmja_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF 
   END IF
   LET l_xmjbseq = p_xmjb_d.xmjbseq   

   #交易類型
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb001 <> l_xmja.xmja001) OR
      (p_xmjb_d.xmjb001 IS NULL AND l_xmja.xmja001 IS NOT NULL) OR
      (p_xmjb_d.xmjb001 IS NOT NULL AND l_xmja.xmja001 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja001",p_xmjb_d.xmjb901,l_xmja.xmja001,p_xmjb_d.xmjb001,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja001",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   #收貨網點
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb024 <> l_xmja.xmja024) OR
      (p_xmjb_d.xmjb024 IS NULL AND l_xmja.xmja024 IS NOT NULL) OR
      (p_xmjb_d.xmjb024 IS NOT NULL AND l_xmja.xmja024 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'"
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja024",p_xmjb_d.xmjb901,l_xmja.xmja024,p_xmjb_d.xmjb024,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja024",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  

   #送貨地址
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb026 <> l_xmja.xmja026) OR
      (p_xmjb_d.xmjb026 IS NULL AND l_xmja.xmja026 IS NOT NULL) OR
      (p_xmjb_d.xmjb026 IS NOT NULL AND l_xmja.xmja026 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja026",p_xmjb_d.xmjb901,l_xmja.xmja026,p_xmjb_d.xmjb026,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja026",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   #送貨站點
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb027 <> l_xmja.xmja027) OR
      (p_xmjb_d.xmjb027 IS NULL AND l_xmja.xmja027 IS NOT NULL) OR
      (p_xmjb_d.xmjb027 IS NOT NULL AND l_xmja.xmja027 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT dbadl003 FROM dbadl_t WHERE dbadlent='"||g_enterprise||"' AND dbadl001=? AND dbadl002='"||g_dlang||"'"
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja027",p_xmjb_d.xmjb901,l_xmja.xmja027,p_xmjb_d.xmjb027,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja027",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF 

   #多交期
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb030 <> l_xmja.xmja030) OR
      (p_xmjb_d.xmjb030 IS NULL AND l_xmja.xmja030 IS NOT NULL) OR
      (p_xmjb_d.xmjb030 IS NOT NULL AND l_xmja.xmja030 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja030",p_xmjb_d.xmjb901,l_xmja.xmja030,p_xmjb_d.xmjb030,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja030",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #約定交貨日
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb031 <> l_xmja.xmja031) OR
      (p_xmjb_d.xmjb031 IS NULL AND l_xmja.xmja031 IS NOT NULL) OR
      (p_xmjb_d.xmjb031 IS NOT NULL AND l_xmja.xmja031 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja031",p_xmjb_d.xmjb901,l_xmja.xmja031,p_xmjb_d.xmjb031,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja031",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #約定簽收日
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb032 <> l_xmja.xmja032) OR
      (p_xmjb_d.xmjb032 IS NULL AND l_xmja.xmja032 IS NOT NULL) OR
      (p_xmjb_d.xmjb032 IS NOT NULL AND l_xmja.xmja032 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja032",p_xmjb_d.xmjb901,l_xmja.xmja032,p_xmjb_d.xmjb032,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja032",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #參考單位
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb015 <> l_xmja.xmja015) OR
      (p_xmjb_d.xmjb015 IS NULL AND l_xmja.xmja015 IS NOT NULL) OR
      (p_xmjb_d.xmjb015 IS NOT NULL AND l_xmja.xmja015 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'"
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja015",p_xmjb_d.xmjb901,l_xmja.xmja015,p_xmjb_d.xmjb015,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja015",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #參考數量
   IF p_xmjb_d.xmjb901 = '3' OR (p_xmjb_d.xmjb901 = '2' AND
      ((p_xmjb_d.xmjb016 <> l_xmja.xmja016) OR
      (p_xmjb_d.xmjb016 IS NULL AND l_xmja.xmja016 IS NOT NULL) OR
      (p_xmjb_d.xmjb016 IS NOT NULL AND l_xmja.xmja016 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(l_xmjbseq,0,0,"xmja016",p_xmjb_d.xmjb901,l_xmja.xmja016,p_xmjb_d.xmjb016,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(l_xmjbseq,0,0,"xmja016",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #表示此筆單身與訂單該筆單身一致
   IF l_flag = FALSE THEN
      UPDATE xmjb_t SET xmjb901 = '1'
       WHERE xmjbent = g_enterprise
         AND xmjbdocno = g_xmee_m.xmeedocno
         AND xmjb900 = g_xmee_m.xmee900
         AND xmjbseq = p_xmjb_d.xmjbseq
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'xmjb_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   RETURN r_success
END FUNCTION

################################################################################
# Descriptions...: 將單身交期明細有修改的欄位新增到變更歷程檔內
# Memo...........:
# Usage..........: adbt510_xmeg_ins_xmek(p_xmegdocno,p_xmegseq,p_xmeg900)
#                  RETURNING r_success
# Input parameter: p_xmegdocno    單號
#                : p_xmegseq      項次
#                : p_xmeg900      變更序
# Return code....: r_success      TRUE/FALSE
#                : 
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION adbt510_xmeg_ins_xmek(p_xmegdocno,p_xmegseq,p_xmeg900)
   DEFINE p_xmegdocno       LIKE xmeg_t.xmegdocno
   DEFINE p_xmegseq         LIKE xmeg_t.xmegseq
   DEFINE p_xmeg900         LIKE xmeg_t.xmeg900
   DEFINE l_xmeg_d          type_g_xmeg_d
   DEFINE r_success         LIKE type_t.num5
  #DEFINE l_xmdc            RECORD LIKE xmdc_t.*   #161104-00002#1 161104 by 02749 
  
   #161104-00002#1 161104 by 02749 add---(S)
   DEFINE l_xmdc            RECORD              
             xmdcent     LIKE xmdc_t.xmdcent   ,   #企業編號
             xmdcsite    LIKE xmdc_t.xmdcsite  ,   #營運據點
             xmdcdocno   LIKE xmdc_t.xmdcdocno ,   #訂單單號
             xmdcseq     LIKE xmdc_t.xmdcseq   ,   #項次	
             xmdc001     LIKE xmdc_t.xmdc001   ,   #料件編號
             xmdc002     LIKE xmdc_t.xmdc002   ,   #產品特徵
             xmdc003     LIKE xmdc_t.xmdc003   ,   #包裝容器
             xmdc004     LIKE xmdc_t.xmdc004   ,   #作業編號
             xmdc005     LIKE xmdc_t.xmdc005   ,   #製程式
             xmdc006     LIKE xmdc_t.xmdc006   ,   #銷售單位
             xmdc007     LIKE xmdc_t.xmdc007   ,   #銷售數量
             xmdc008     LIKE xmdc_t.xmdc008   ,   #參考單位
             xmdc009     LIKE xmdc_t.xmdc009   ,   #參考數量
             xmdc010     LIKE xmdc_t.xmdc010   ,   #計價單位
             xmdc011     LIKE xmdc_t.xmdc011   ,   #計價數量
             xmdc012     LIKE xmdc_t.xmdc012   ,   #約定交貨日
             xmdc013     LIKE xmdc_t.xmdc013   ,   #預定簽收日
             xmdc015     LIKE xmdc_t.xmdc015   ,   #單價
             xmdc016     LIKE xmdc_t.xmdc016   ,   #稅別
             xmdc017     LIKE xmdc_t.xmdc017   ,   #稅率
             xmdc019     LIKE xmdc_t.xmdc019   ,   #子件特性
             xmdc020     LIKE xmdc_t.xmdc020   ,   #急料
             xmdc021     LIKE xmdc_t.xmdc021   ,   #保稅
             xmdc022     LIKE xmdc_t.xmdc022   ,   #部分交貨
             xmdcunit    LIKE xmdc_t.xmdcunit  ,   #出貨據點
             xmdcorga    LIKE xmdc_t.xmdcorga  ,   #收款據點
             xmdc023     LIKE xmdc_t.xmdc023   ,   #收貨客戶
             xmdc024     LIKE xmdc_t.xmdc024   ,   #多交期
             xmdc025     LIKE xmdc_t.xmdc025   ,   #收貨地址編號
             xmdc026     LIKE xmdc_t.xmdc026   ,   #帳款地址編號
             xmdc027     LIKE xmdc_t.xmdc027   ,   #客戶料號
             xmdc028     LIKE xmdc_t.xmdc028   ,   #限定庫位
             xmdc029     LIKE xmdc_t.xmdc029   ,   #限定儲位
             xmdc030     LIKE xmdc_t.xmdc030   ,   #限定批號
             xmdc031     LIKE xmdc_t.xmdc031   ,   #運輸方式
             xmdc032     LIKE xmdc_t.xmdc032   ,   #取貨模式
             xmdc033     LIKE xmdc_t.xmdc033   ,   #備品率
             xmdc034     LIKE xmdc_t.xmdc034   ,   #可超交率
             xmdc035     LIKE xmdc_t.xmdc035   ,   #價格核決
             xmdc036     LIKE xmdc_t.xmdc036   ,   #專案編號
             xmdc037     LIKE xmdc_t.xmdc037   ,   #WBS編號
             xmdc038     LIKE xmdc_t.xmdc038   ,   #活動編號
             xmdc039     LIKE xmdc_t.xmdc039   ,   #費用原因
             xmdc040     LIKE xmdc_t.xmdc040   ,   #取價來源
             xmdc041     LIKE xmdc_t.xmdc041   ,   #價格參考單號
             xmdc042     LIKE xmdc_t.xmdc042   ,   #價格參考項次
             xmdc043     LIKE xmdc_t.xmdc043   ,   #取出價格
             xmdc044     LIKE xmdc_t.xmdc044   ,   #價差比
             xmdc045     LIKE xmdc_t.xmdc045   ,   #狀態碼
             xmdc046     LIKE xmdc_t.xmdc046   ,   #未稅金額
             xmdc047     LIKE xmdc_t.xmdc047   ,   #含稅金額
             xmdc048     LIKE xmdc_t.xmdc048   ,   #稅額
             xmdc049     LIKE xmdc_t.xmdc049   ,   #理由碼
             xmdc050     LIKE xmdc_t.xmdc050   ,   #備註
             xmdc051     LIKE xmdc_t.xmdc051   ,   #客戶訂單項次
             xmdc052     LIKE xmdc_t.xmdc052   ,   #檢驗否	
             xmdc053     LIKE xmdc_t.xmdc053   ,   #結案理由碼
             xmdc054     LIKE xmdc_t.xmdc054   ,   #BOM有效日期
             xmdc055     LIKE xmdc_t.xmdc055   ,   #來源單號
             xmdc056     LIKE xmdc_t.xmdc056   ,   #來源項次
             xmdc057     LIKE xmdc_t.xmdc057   ,   #庫存管理特徵
             xmdc058     LIKE xmdc_t.xmdc058   ,   #還量數量
             xmdc059     LIKE xmdc_t.xmdc059   ,   #還量參考數量
             xmdc060     LIKE xmdc_t.xmdc060   ,   #還價數量
             xmdc061     LIKE xmdc_t.xmdc061   ,   #還價參考數量
             xmdc062     LIKE xmdc_t.xmdc062   ,   #BOM特性
             xmdc200     LIKE xmdc_t.xmdc200   ,   #現金折扣單號
             xmdc201     LIKE xmdc_t.xmdc201   ,   #現金折扣單項次
             #161123-00042#1 Add By Ken 161124(S)
             xmdcud001 LIKE xmdc_t.xmdcud001, #自定義欄位(文字)001
             xmdcud002 LIKE xmdc_t.xmdcud002, #自定義欄位(文字)002
             xmdcud003 LIKE xmdc_t.xmdcud003, #自定義欄位(文字)003
             xmdcud004 LIKE xmdc_t.xmdcud004, #自定義欄位(文字)004
             xmdcud005 LIKE xmdc_t.xmdcud005, #自定義欄位(文字)005
             xmdcud006 LIKE xmdc_t.xmdcud006, #自定義欄位(文字)006
             xmdcud007 LIKE xmdc_t.xmdcud007, #自定義欄位(文字)007
             xmdcud008 LIKE xmdc_t.xmdcud008, #自定義欄位(文字)008
             xmdcud009 LIKE xmdc_t.xmdcud009, #自定義欄位(文字)009
             xmdcud010 LIKE xmdc_t.xmdcud010, #自定義欄位(文字)010
             xmdcud011 LIKE xmdc_t.xmdcud011, #自定義欄位(數字)011
             xmdcud012 LIKE xmdc_t.xmdcud012, #自定義欄位(數字)012
             xmdcud013 LIKE xmdc_t.xmdcud013, #自定義欄位(數字)013
             xmdcud014 LIKE xmdc_t.xmdcud014, #自定義欄位(數字)014
             xmdcud015 LIKE xmdc_t.xmdcud015, #自定義欄位(數字)015
             xmdcud016 LIKE xmdc_t.xmdcud016, #自定義欄位(數字)016
             xmdcud017 LIKE xmdc_t.xmdcud017, #自定義欄位(數字)017
             xmdcud018 LIKE xmdc_t.xmdcud018, #自定義欄位(數字)018
             xmdcud019 LIKE xmdc_t.xmdcud019, #自定義欄位(數字)019
             xmdcud020 LIKE xmdc_t.xmdcud020, #自定義欄位(數字)020
             xmdcud021 LIKE xmdc_t.xmdcud021, #自定義欄位(日期時間)021
             xmdcud022 LIKE xmdc_t.xmdcud022, #自定義欄位(日期時間)022
             xmdcud023 LIKE xmdc_t.xmdcud023, #自定義欄位(日期時間)023
             xmdcud024 LIKE xmdc_t.xmdcud024, #自定義欄位(日期時間)024
             xmdcud025 LIKE xmdc_t.xmdcud025, #自定義欄位(日期時間)025
             xmdcud026 LIKE xmdc_t.xmdcud026, #自定義欄位(日期時間)026
             xmdcud027 LIKE xmdc_t.xmdcud027, #自定義欄位(日期時間)027
             xmdcud028 LIKE xmdc_t.xmdcud028, #自定義欄位(日期時間)028
             xmdcud029 LIKE xmdc_t.xmdcud029, #自定義欄位(日期時間)029
             xmdcud030 LIKE xmdc_t.xmdcud030  #自定義欄位(日期時間)030             
             #161123-00042#1 Add By Ken 161124(E)
                            END RECORD
   #161104-00002#1 161104 by 02749 add---(E)
   
   DEFINE l_ooef019         LIKE ooef_t.ooef019
   DEFINE l_xmekseq         LIKE xmek_t.xmekseq
   DEFINE l_flag            LIKE type_t.num5      #單身是否有修改

   LET r_success = TRUE

   IF l_xmeg_d.xmeg901 = '1' THEN       #未變更不需寫入歷程檔內  
      RETURN r_success
   END IF
   INITIALIZE l_xmeg_d.* TO NULL
   INITIALIZE l_xmdc.* TO NULL
   LET l_flag = FALSE
   
   SELECT xmeg901,xmeg008,xmeg009,xmeg024,xmeg012,
          xmeg013,xmegunit,xmeg050
     INTO l_xmeg_d.xmeg901,l_xmeg_d.xmeg008,l_xmeg_d.xmeg009,l_xmeg_d.xmeg024,l_xmeg_d.xmeg012,
          l_xmeg_d.xmeg013,l_xmeg_d.xmegunit,l_xmeg_d.xmeg050
     FROM xmeg_t
    WHERE xmegent = g_enterprise
      AND xmegdocno = p_xmegdocno
      AND xmegseq = p_xmegseq
      AND xmeg900 = p_xmeg900

   IF l_xmeg_d.xmeg901 = '2' THEN     
      SELECT xmdc008,xmdc009,xmdc024,xmdc012,
             xmdc013,xmdcunit,xmdc050
        INTO l_xmdc.xmdc008,l_xmdc.xmdc009,l_xmdc.xmdc024,l_xmdc.xmdc012,
             l_xmdc.xmdc013,l_xmdc.xmdcunit,l_xmdc.xmdc050
        FROM xmdc_t
       WHERE xmdcent = g_enterprise
         AND xmdcdocno = p_xmegdocno
         AND xmdcseq = p_xmegseq  
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'sel xmdc_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF 
   END IF                    
   LET l_xmekseq = p_xmegseq

   #參考單位
   IF l_xmeg_d.xmeg901 = '3' OR (l_xmeg_d.xmeg901 = '2' AND
      ((l_xmeg_d.xmeg008 <> l_xmdc.xmdc008) OR
      (l_xmeg_d.xmeg008 IS NULL AND l_xmdc.xmdc008 IS NOT NULL) OR
      (l_xmeg_d.xmeg008 IS NOT NULL AND l_xmdc.xmdc008 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"' "
      #新增資料到變更歷程檔
      IF NOT s_axmt510_ins_xmek(l_xmekseq,0,0,"xmdc008",l_xmeg_d.xmeg901,l_xmdc.xmdc008,l_xmeg_d.xmeg008,p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_axmt510_del_xmek(l_xmekseq,0,0,"xmdc008",p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
   
   #參考數量
   IF l_xmeg_d.xmeg901 = '3' OR (l_xmeg_d.xmeg901 = '2' AND
      ((l_xmeg_d.xmeg009 <> l_xmdc.xmdc009) OR
      (l_xmeg_d.xmeg009 IS NULL AND l_xmdc.xmdc009 IS NOT NULL) OR
      (l_xmeg_d.xmeg009 IS NOT NULL AND l_xmdc.xmdc009 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_axmt510_ins_xmek(l_xmekseq,0,0,"xmdc009",l_xmeg_d.xmeg901,l_xmdc.xmdc009,l_xmeg_d.xmeg009,p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_axmt510_del_xmek(l_xmekseq,0,0,"xmdc009",p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #多交期
   IF l_xmeg_d.xmeg901 = '3' OR (l_xmeg_d.xmeg901 = '2' AND
      ((l_xmeg_d.xmeg024 <> l_xmdc.xmdc024) OR
      (l_xmeg_d.xmeg024 IS NULL AND l_xmdc.xmdc024 IS NOT NULL) OR
      (l_xmeg_d.xmeg024 IS NOT NULL AND l_xmdc.xmdc024 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_axmt510_ins_xmek(l_xmekseq,0,0,"xmdc024",l_xmeg_d.xmeg901,l_xmdc.xmdc024,l_xmeg_d.xmeg024,p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_axmt510_del_xmek(l_xmekseq,0,0,"xmdc024",p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #約定交貨日
   IF l_xmeg_d.xmeg901 = '3' OR (l_xmeg_d.xmeg901 = '2' AND
      ((l_xmeg_d.xmeg012 <> l_xmdc.xmdc012) OR
      (l_xmeg_d.xmeg012 IS NULL AND l_xmdc.xmdc012 IS NOT NULL) OR
      (l_xmeg_d.xmeg012 IS NOT NULL AND l_xmdc.xmdc012 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_axmt510_ins_xmek(l_xmekseq,0,0,"xmdc012",l_xmeg_d.xmeg901,l_xmdc.xmdc012,l_xmeg_d.xmeg012,p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_axmt510_del_xmek(l_xmekseq,0,0,"xmdc012",p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #預定簽收日
   IF l_xmeg_d.xmeg901 = '3' OR (l_xmeg_d.xmeg901 = '2' AND
      ((l_xmeg_d.xmeg013 <> l_xmdc.xmdc013) OR
      (l_xmeg_d.xmeg013 IS NULL AND l_xmdc.xmdc013 IS NOT NULL) OR
      (l_xmeg_d.xmeg013 IS NOT NULL AND l_xmdc.xmdc013 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_axmt510_ins_xmek(l_xmekseq,0,0,"xmdc013",l_xmeg_d.xmeg901,l_xmdc.xmdc013,l_xmeg_d.xmeg013,p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_axmt510_del_xmek(l_xmekseq,0,0,"xmdc013",p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #出貨據點
   IF l_xmeg_d.xmeg901 = '3' OR (l_xmeg_d.xmeg901 = '2' AND
      ((l_xmeg_d.xmegunit <> l_xmdc.xmdcunit) OR
      (l_xmeg_d.xmegunit IS NULL AND l_xmdc.xmdcunit IS NOT NULL) OR
      (l_xmeg_d.xmegunit IS NOT NULL AND l_xmdc.xmdcunit IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"' "
      #新增資料到變更歷程檔
      IF NOT s_axmt510_ins_xmek(l_xmekseq,0,0,"xmdcunit",l_xmeg_d.xmeg901,l_xmdc.xmdcunit,l_xmeg_d.xmegunit,p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_axmt510_del_xmek(l_xmekseq,0,0,"xmdcunit",p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   
   #備註
   IF l_xmeg_d.xmeg901 = '3' OR (l_xmeg_d.xmeg901 = '2' AND
      ((l_xmeg_d.xmeg050 <> l_xmdc.xmdc050) OR
      (l_xmeg_d.xmeg050 IS NULL AND l_xmdc.xmdc050 IS NOT NULL) OR
      (l_xmeg_d.xmeg050 IS NOT NULL AND l_xmdc.xmdc050 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_axmt510_ins_xmek(l_xmekseq,0,0,"xmdc050",l_xmeg_d.xmeg901,l_xmdc.xmdc050,l_xmeg_d.xmeg050,p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_axmt510_del_xmek(l_xmekseq,0,0,"xmdc050",p_xmegdocno,p_xmeg900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   #表示此筆單身與訂單該筆單身一致
   IF l_flag = FALSE THEN
      UPDATE xmeg_t SET xmeg901 = '1'
       WHERE xmegent = g_enterprise
         AND xmegdocno = p_xmegdocno
         AND xmeg900 = p_xmeg900
         AND xmegseq = p_xmegseq
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'xmeg_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   RETURN r_success
END FUNCTION

PRIVATE FUNCTION adbt510_xmef_ins_xmek(p_xmef_d)
   DEFINE p_xmef_d          type_g_xmeg5_d
   DEFINE r_success         LIKE type_t.num5
  #DEFINE l_xmdb            RECORD LIKE xmdb_t.*  #161104-00002#1 161104 by 02749 mark
  
   #161104-00002#1 161104 by 02749 add---(S)
   DEFINE l_xmdb            RECORD 
             xmdbent      LIKE xmdb_t.xmdbent   ,   #企業編號
             xmdbsite     LIKE xmdb_t.xmdbsite  ,   #營運據點
             xmdbdocno    LIKE xmdb_t.xmdbdocno ,   #訂單單號
             xmdb001      LIKE xmdb_t.xmdb001   ,   #期別
             xmdb002      LIKE xmdb_t.xmdb002   ,   #收款條件
             xmdb003      LIKE xmdb_t.xmdb003   ,   #預計應收款日
             xmdb004      LIKE xmdb_t.xmdb004   ,   #預計票據到期日
             xmdb005      LIKE xmdb_t.xmdb005   ,   #未稅金額
             xmdb006      LIKE xmdb_t.xmdb006   ,   #含稅金額
             xmdb007      LIKE xmdb_t.xmdb007   ,   #應收帳款單號
             xmdb008      LIKE xmdb_t.xmdb008   ,   #主帳套立帳未稅金額
             xmdb009      LIKE xmdb_t.xmdb009   ,   #主帳套立帳含稅金額
             xmdb010      LIKE xmdb_t.xmdb010   ,   #帳套二立帳未稅金額
             xmdb011      LIKE xmdb_t.xmdb011   ,   #帳套二立帳含稅金額
             xmdb014      LIKE xmdb_t.xmdb014   ,   #帳套三立帳未稅金額
             xmdb015      LIKE xmdb_t.xmdb015   ,   #帳套三立帳含稅金額
             xmdb016      LIKE xmdb_t.xmdb016   ,   #帳款類型
             xmdb017      LIKE xmdb_t.xmdb017   ,   #帳款影響出貨模式
             xmdb200      LIKE xmdb_t.xmdb200   ,   #本幣含稅總金額
             #161123-00042#1 Add By Ken 161124(S)
             xmdbud001 LIKE xmdb_t.xmdbud001, #自定義欄位(文字)001
             xmdbud002 LIKE xmdb_t.xmdbud002, #自定義欄位(文字)002
             xmdbud003 LIKE xmdb_t.xmdbud003, #自定義欄位(文字)003
             xmdbud004 LIKE xmdb_t.xmdbud004, #自定義欄位(文字)004
             xmdbud005 LIKE xmdb_t.xmdbud005, #自定義欄位(文字)005
             xmdbud006 LIKE xmdb_t.xmdbud006, #自定義欄位(文字)006
             xmdbud007 LIKE xmdb_t.xmdbud007, #自定義欄位(文字)007
             xmdbud008 LIKE xmdb_t.xmdbud008, #自定義欄位(文字)008
             xmdbud009 LIKE xmdb_t.xmdbud009, #自定義欄位(文字)009
             xmdbud010 LIKE xmdb_t.xmdbud010, #自定義欄位(文字)010
             xmdbud011 LIKE xmdb_t.xmdbud011, #自定義欄位(數字)011
             xmdbud012 LIKE xmdb_t.xmdbud012, #自定義欄位(數字)012
             xmdbud013 LIKE xmdb_t.xmdbud013, #自定義欄位(數字)013
             xmdbud014 LIKE xmdb_t.xmdbud014, #自定義欄位(數字)014
             xmdbud015 LIKE xmdb_t.xmdbud015, #自定義欄位(數字)015
             xmdbud016 LIKE xmdb_t.xmdbud016, #自定義欄位(數字)016
             xmdbud017 LIKE xmdb_t.xmdbud017, #自定義欄位(數字)017
             xmdbud018 LIKE xmdb_t.xmdbud018, #自定義欄位(數字)018
             xmdbud019 LIKE xmdb_t.xmdbud019, #自定義欄位(數字)019
             xmdbud020 LIKE xmdb_t.xmdbud020, #自定義欄位(數字)020
             xmdbud021 LIKE xmdb_t.xmdbud021, #自定義欄位(日期時間)021
             xmdbud022 LIKE xmdb_t.xmdbud022, #自定義欄位(日期時間)022
             xmdbud023 LIKE xmdb_t.xmdbud023, #自定義欄位(日期時間)023
             xmdbud024 LIKE xmdb_t.xmdbud024, #自定義欄位(日期時間)024
             xmdbud025 LIKE xmdb_t.xmdbud025, #自定義欄位(日期時間)025
             xmdbud026 LIKE xmdb_t.xmdbud026, #自定義欄位(日期時間)026
             xmdbud027 LIKE xmdb_t.xmdbud027, #自定義欄位(日期時間)027
             xmdbud028 LIKE xmdb_t.xmdbud028, #自定義欄位(日期時間)028
             xmdbud029 LIKE xmdb_t.xmdbud029, #自定義欄位(日期時間)029
             xmdbud030 LIKE xmdb_t.xmdbud030  #自定義欄位(日期時間)030
             #161123-00042#1 Add By Ken 161124(E)
                            END RECORD
   #161104-00002#1 161104 by 02749 add---(E)
   
   DEFINE l_flag            LIKE type_t.num5      #單身是否有修改

   LET r_success = TRUE

   IF p_xmef_d.xmef901 = '1' THEN       #未變更不需寫入歷程檔內  
      RETURN r_success
   END IF

   INITIALIZE l_xmdb.* TO NULL
   LET l_flag = FALSE

   IF p_xmef_d.xmef901 = '2' THEN     
      SELECT xmdbsite,xmdb001,xmdb002,xmdb003,xmdb004,
             xmdb005,xmdb006,xmdb007,xmdb008,xmdb009 
        INTO l_xmdb.xmdbsite,l_xmdb.xmdb001,l_xmdb.xmdb002,l_xmdb.xmdb003,l_xmdb.xmdb004,
             l_xmdb.xmdb005,l_xmdb.xmdb006,l_xmdb.xmdb007,l_xmdb.xmdb008,l_xmdb.xmdb009        
        FROM xmdb_t 
       WHERE xmdbent = g_enterprise
         AND xmdbdocno = g_xmee_m.xmeedocno
         AND xmdb001 = p_xmef_d.xmef001
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'sel xmdb_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF 
   END IF                    

   #期別
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef001 <> l_xmdb.xmdb001) OR
      (p_xmef_d.xmef001 IS NULL AND l_xmdb.xmdb001 IS NOT NULL) OR
      (p_xmef_d.xmef001 IS NOT NULL AND l_xmdb.xmdb001 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb001",p_xmef_d.xmef901,l_xmdb.xmdb001,p_xmef_d.xmef001,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb001",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   #收款條件
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef002 <> l_xmdb.xmdb002) OR
      (p_xmef_d.xmef002 IS NULL AND l_xmdb.xmdb002 IS NOT NULL) OR
      (p_xmef_d.xmef002 IS NOT NULL AND l_xmdb.xmdb002 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = "SELECT ooibl004 FROM ooibl_t WHERE ooiblent='"||g_enterprise||"' AND ooibl002=? AND ooibl003='"||g_dlang||"' "
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb002",p_xmef_d.xmef901,l_xmdb.xmdb002,p_xmef_d.xmef002,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb002",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  

   #預計應收款日
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef003 <> l_xmdb.xmdb003) OR
      (p_xmef_d.xmef003 IS NULL AND l_xmdb.xmdb003 IS NOT NULL) OR
      (p_xmef_d.xmef003 IS NOT NULL AND l_xmdb.xmdb003 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb003",p_xmef_d.xmef901,l_xmdb.xmdb003,p_xmef_d.xmef003,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb003",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   #預計票據到期日
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef004 <> l_xmdb.xmdb004) OR
      (p_xmef_d.xmef004 IS NULL AND l_xmdb.xmdb004 IS NOT NULL) OR
      (p_xmef_d.xmef004 IS NOT NULL AND l_xmdb.xmdb004 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb004",p_xmef_d.xmef901,l_xmdb.xmdb004,p_xmef_d.xmef004,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb004",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #預計票據到期日
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef005 <> l_xmdb.xmdb005) OR
      (p_xmef_d.xmef005 IS NULL AND l_xmdb.xmdb005 IS NOT NULL) OR
      (p_xmef_d.xmef005 IS NOT NULL AND l_xmdb.xmdb005 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb005",p_xmef_d.xmef901,l_xmdb.xmdb005,p_xmef_d.xmef005,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb005",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
   
   #含稅金額
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef006 <> l_xmdb.xmdb006) OR
      (p_xmef_d.xmef006 IS NULL AND l_xmdb.xmdb006 IS NOT NULL) OR
      (p_xmef_d.xmef006 IS NOT NULL AND l_xmdb.xmdb006 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb006",p_xmef_d.xmef901,l_xmdb.xmdb006,p_xmef_d.xmef006,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb006",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  

   #應收帳款單號
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef007 <> l_xmdb.xmdb007) OR
      (p_xmef_d.xmef007 IS NULL AND l_xmdb.xmdb007 IS NOT NULL) OR
      (p_xmef_d.xmef007 IS NOT NULL AND l_xmdb.xmdb007 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb007",p_xmef_d.xmef901,l_xmdb.xmdb007,p_xmef_d.xmef007,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb007",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  
   
   #主帳套已收未稅金額
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef008 <> l_xmdb.xmdb008) OR
      (p_xmef_d.xmef008 IS NULL AND l_xmdb.xmdb008 IS NOT NULL) OR
      (p_xmef_d.xmef008 IS NOT NULL AND l_xmdb.xmdb008 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb008",p_xmef_d.xmef901,l_xmdb.xmdb008,p_xmef_d.xmef008,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb008",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  

   #主帳套已收未稅金額
   IF p_xmef_d.xmef901 = '3' OR (p_xmef_d.xmef901 = '2' AND
      ((p_xmef_d.xmef009 <> l_xmdb.xmdb009) OR
      (p_xmef_d.xmef009 IS NULL AND l_xmdb.xmdb009 IS NOT NULL) OR
      (p_xmef_d.xmef009 IS NOT NULL AND l_xmdb.xmdb009 IS NULL))) THEN
      #其說明的SQL
      LET g_xmek007 = ''
      #新增資料到變更歷程檔
      IF NOT s_adbt510_ins_xmek(0,0,p_xmef_d.xmef001,"xmdb009",p_xmef_d.xmef901,l_xmdb.xmdb009,p_xmef_d.xmef009,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      LET l_flag = TRUE
   ELSE
      #資料一樣，表示無變更，將變更歷程檔刪除
      IF NOT s_adbt510_del_xmek(0,0,p_xmef_d.xmef001,"xmdb009",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF  

   #表示此筆單身與訂單該筆單身一致
   IF l_flag = FALSE THEN
      UPDATE xmef_t SET xmef901 = '1'
       WHERE xmefent = g_enterprise
         AND xmefdocno = g_xmee_m.xmeedocno
         AND xmef900 = g_xmee_m.xmee900
         AND xmef001 = p_xmef_d.xmef001
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'xmef_t'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   RETURN r_success
END FUNCTION

PRIVATE FUNCTION adbt510_xmef008_exist()
   DEFINE r_exist    LIKE type_t.num5
   DEFINE l_sum        LIKE xmef_t.xmef008
   
   LET r_exist = FALSE
   
   SELECT SUM(xmef008)
     INTO l_sum
     FROM xmef_t
    WHERE xmefent = g_enterprise
      AND xmefdocno = g_xmee_m.xmeedocno 
      AND xmef900 = g_xmee_m.xmee900
   
   IF l_sum <> 0 THEN
      LET r_exist = TRUE
   END IF
   
   RETURN r_exist
END FUNCTION

PRIVATE FUNCTION adbt510_upd_xmeeunit()
   DEFINE r_success    LIKE type_t.num5
   DEFINE l_i          LIKE type_t.num5
   DEFINE l_xmej200    LIKE xmej_t.xmej200
   DEFINE l_xmej201    LIKE xmej_t.xmej201
   
   LET r_success = TRUE

   #xmej
   #若代送商則重新取倉庫,儲位.其它則清空倉庫,儲位
   IF NOT cl_null(g_xmee_m.xmee201) THEN
     FOR l_i = 1 TO g_xmeg4_d.getLength()
        SELECT dbag004,dbag005
          INTO l_xmej200,l_xmej201
          FROM dbag_t
         WHERE dbagent = g_enterprise
           AND dbagsite = g_xmee_m.xmeeunit
           AND dbag001 = '1'
           AND dbag002 = g_xmee_m.xmee004
           AND dbag003 = g_xmeg4_d[l_i].xmjb025
           
        UPDATE xmej_t
           SET xmejunit = g_xmee_m.xmeeunit,
               xmej200 = l_xmej200,
               xmej201 = l_xmej201,
               xmej901 = CASE WHEN xmej901 = '1' THEN '2' ELSE xmej901 END
         WHERE xmejent = g_enterprise
           AND xmejdocno = g_xmee_m.xmeedocno
           AND xmej900 = g_xmee_m.xmee900
           AND xmejseq = g_xmeg4_d[l_i].xmjbseq
           
        IF SQLCA.sqlcode THEN
           INITIALIZE g_errparam TO NULL
           LET g_errparam.code = SQLCA.sqlcode
           LET g_errparam.extend = 'xmej_t'
           LET g_errparam.popup = TRUE
           CALL cl_err()

           LET r_success = FALSE
           RETURN r_success
        END IF 
     END FOR
   ELSE
      LET l_xmej200 = ''
      LET l_xmej201 = ''
      UPDATE xmej_t
         SET xmejunit = g_xmee_m.xmeeunit,
             xmej200 = l_xmej200,
             xmej201 = l_xmej201,
             xmej901 = CASE WHEN xmej901 = '1' THEN '2' ELSE xmej901 END
       WHERE xmejent = g_enterprise
         AND xmejdocno = g_xmee_m.xmeedocno
         AND xmej900 = g_xmee_m.xmee900
         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
           LET g_errparam.code = SQLCA.sqlcode
           LET g_errparam.extend = 'xmej_t'
           LET g_errparam.popup = TRUE
           CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   IF NOT adbt510_xmej_ins_xmek() THEN
      LET r_success = FALSE
      RETURN r_success
   END IF
   #xmeg
   UPDATE xmeg_t
      SET xmegunit = g_xmee_m.xmeeunit,
          xmeg901 = CASE WHEN xmeg901 = '1' THEN '2' ELSE xmeg901 END
    WHERE xmegent = g_enterprise
      AND xmegdocno = g_xmee_m.xmeedocno
      AND xmeg900 = g_xmee_m.xmee900
      
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'xmeg_t'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF
   
   FOR l_i = 1 TO g_xmeg_d.getLength()
      LET g_xmeg_d[l_i].xmegunit = g_xmee_m.xmeeunit 
      IF g_xmeg_d[l_i].xmeg901 = '1' THEN
         LET g_xmeg_d[l_i].xmeg901 = '2'
      END IF
      IF NOT adbt510_xmeg_ins_xmek(g_xmee_m.xmeedocno,g_xmeg_d[l_i].xmegseq,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
      #xmeh 重新產生
      IF NOT s_adbt510_gen_xmeh(g_xmee_m.xmeedocno,g_xmeg_d[l_i].xmegseq,g_xmee_m.xmee900) THEN
         LET r_success = FALSE
         RETURN r_success
      END IF 
   END FOR
   
   FOR l_i = 1 TO g_xmeg3_d.getLength()
      LET g_xmeg3_d[l_i].xmehunit = g_xmee_m.xmeeunit 
   END FOR
   
   RETURN r_success
END FUNCTION

PRIVATE FUNCTION adbt510_xmej_ins_xmek()
   DEFINE r_success         LIKE type_t.num5
  #DEFINE l_xmej            RECORD LIKE xmej_t.*   #161104-00002#1 161104 by 02749 mark
  #DEFINE l_xmdf            RECORD LIKE xmdf_t.*   #161104-00002#1 161104 by 02749 mark
  
   #161104-00002#1 161104 by 02749 add---(S)
   DEFINE l_xmej            type_g_xmej
   DEFINE l_xmdf            RECORD
             xmdfent      LIKE xmdf_t.xmdfent   ,   #企業編號
             xmdfsite     LIKE xmdf_t.xmdfsite  ,   #營運據點
             xmdfdocno    LIKE xmdf_t.xmdfdocno ,   #訂單單號
             xmdfseq      LIKE xmdf_t.xmdfseq   ,   #訂單項次
             xmdfseq2     LIKE xmdf_t.xmdfseq2  ,   #分批序	
             xmdf002      LIKE xmdf_t.xmdf002   ,   #分批數量
             xmdf003      LIKE xmdf_t.xmdf003   ,   #約定交貨日期
             xmdf004      LIKE xmdf_t.xmdf004   ,   #預計簽收日
             xmdf005      LIKE xmdf_t.xmdf005   ,   #出貨時段
             xmdf006      LIKE xmdf_t.xmdf006   ,   #MRP凍結否
             xmdf007      LIKE xmdf_t.xmdf007   ,   #交期類型
             xmdf200      LIKE xmdf_t.xmdf200   ,   #庫區/庫位
             xmdf201      LIKE xmdf_t.xmdf201   ,   #儲位
             xmdf202      LIKE xmdf_t.xmdf202   ,   #批號
             xmdf203      LIKE xmdf_t.xmdf203   ,   #庫存管理特徵
             xmdfunit     LIKE xmdf_t.xmdfunit  ,   #發貨組織
             #161123-00042#1 Add By Ken 161124(S)
             xmdfud001 LIKE xmdf_t.xmdfud001, #自定義欄位(文字)001
             xmdfud002 LIKE xmdf_t.xmdfud002, #自定義欄位(文字)002
             xmdfud003 LIKE xmdf_t.xmdfud003, #自定義欄位(文字)003
             xmdfud004 LIKE xmdf_t.xmdfud004, #自定義欄位(文字)004
             xmdfud005 LIKE xmdf_t.xmdfud005, #自定義欄位(文字)005
             xmdfud006 LIKE xmdf_t.xmdfud006, #自定義欄位(文字)006
             xmdfud007 LIKE xmdf_t.xmdfud007, #自定義欄位(文字)007
             xmdfud008 LIKE xmdf_t.xmdfud008, #自定義欄位(文字)008
             xmdfud009 LIKE xmdf_t.xmdfud009, #自定義欄位(文字)009
             xmdfud010 LIKE xmdf_t.xmdfud010, #自定義欄位(文字)010
             xmdfud011 LIKE xmdf_t.xmdfud011, #自定義欄位(數字)011
             xmdfud012 LIKE xmdf_t.xmdfud012, #自定義欄位(數字)012
             xmdfud013 LIKE xmdf_t.xmdfud013, #自定義欄位(數字)013
             xmdfud014 LIKE xmdf_t.xmdfud014, #自定義欄位(數字)014
             xmdfud015 LIKE xmdf_t.xmdfud015, #自定義欄位(數字)015
             xmdfud016 LIKE xmdf_t.xmdfud016, #自定義欄位(數字)016
             xmdfud017 LIKE xmdf_t.xmdfud017, #自定義欄位(數字)017
             xmdfud018 LIKE xmdf_t.xmdfud018, #自定義欄位(數字)018
             xmdfud019 LIKE xmdf_t.xmdfud019, #自定義欄位(數字)019
             xmdfud020 LIKE xmdf_t.xmdfud020, #自定義欄位(數字)020
             xmdfud021 LIKE xmdf_t.xmdfud021, #自定義欄位(日期時間)021
             xmdfud022 LIKE xmdf_t.xmdfud022, #自定義欄位(日期時間)022
             xmdfud023 LIKE xmdf_t.xmdfud023, #自定義欄位(日期時間)023
             xmdfud024 LIKE xmdf_t.xmdfud024, #自定義欄位(日期時間)024
             xmdfud025 LIKE xmdf_t.xmdfud025, #自定義欄位(日期時間)025
             xmdfud026 LIKE xmdf_t.xmdfud026, #自定義欄位(日期時間)026
             xmdfud027 LIKE xmdf_t.xmdfud027, #自定義欄位(日期時間)027
             xmdfud028 LIKE xmdf_t.xmdfud028, #自定義欄位(日期時間)028
             xmdfud029 LIKE xmdf_t.xmdfud029, #自定義欄位(日期時間)029
             xmdfud030 LIKE xmdf_t.xmdfud030  #自定義欄位(日期時間)030
             #161123-00042#1 Add By Ken 161124(E)
                            END RECORD
   #161104-00002#1 161104 by 02749 add---(E)
   
   DEFINE l_flag            LIKE type_t.num5 

   LET r_success = TRUE

   DECLARE adbt510_xmej_cl1 CURSOR FOR
   SELECT xmejseq,xmejseq2,xmej901,xmej200,xmej201,xmejunit
     FROM xmej_t
    WHERE xmejent = g_enterprise
      AND xmejdocno = g_xmee_m.xmeedocno
      AND xmej900 = g_xmee_m.xmee900
      
   FOREACH adbt510_xmej_cl1 INTO l_xmej.xmejseq,l_xmej.xmejseq2,l_xmej.xmej901,l_xmej.xmej200,l_xmej.xmej201,l_xmej.xmejunit
      IF l_xmej.xmej901 = '1' THEN     
         CONTINUE FOREACH
      END IF
      
      INITIALIZE l_xmdf.* TO NULL
      LET l_flag = FALSE
         
      IF l_xmej.xmej901 = '2' THEN
         SELECT xmdf200,xmdf201,xmdfunit
           INTO l_xmdf.xmdf200,l_xmdf.xmdf201,l_xmdf.xmdfunit
           FROM xmdf_t
          WHERE xmdfent = g_enterprise
            AND xmdfdocno = g_xmee_m.xmeedocno
            AND xmdfseq = l_xmej.xmejseq
            AND xmdfseq2 = l_xmej.xmejseq2
            
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = 'sel xmdf_t'
            LET g_errparam.popup = TRUE
            CALL cl_err()

            LET r_success = FALSE
            RETURN r_success
         END IF 
      END IF
      
      #倉庫
      IF l_xmej.xmej901 = '3' OR (l_xmej.xmej901 = '2' AND
         ((l_xmej.xmej200 <> l_xmdf.xmdf200) OR
         (l_xmej.xmej200 IS NULL AND l_xmdf.xmdf200 IS NOT NULL) OR
         (l_xmej.xmej200 IS NOT NULL AND l_xmdf.xmdf200 IS NULL))) THEN
         #其說明的SQL
         LET g_xmek007 = "SELECT inayl003 FROM inayl_t WHERE inaylent='"||g_enterprise||"' AND inayl001=? AND inayl002='"||g_dlang||"' "
         #新增資料到變更歷程檔
         IF NOT s_axmt510_ins_xmek(l_xmej.xmejseq,0,l_xmej.xmejseq2,"xmdf200",l_xmej.xmej901,l_xmdf.xmdf200,l_xmej.xmej200,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
            LET r_success = FALSE
            RETURN r_success
         END IF
         LET l_flag = TRUE
      ELSE
         #資料一樣，表示無變更，將變更歷程檔刪除
         IF NOT s_axmt510_del_xmek(l_xmej.xmejseq,0,l_xmej.xmejseq2,"xmdf200",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
            LET r_success = FALSE
            RETURN r_success
         END IF
      END IF
      
      #儲位
      IF l_xmej.xmej901 = '3' OR (l_xmej.xmej901 = '2' AND
         ((l_xmej.xmej201 <> l_xmdf.xmdf201) OR
         (l_xmej.xmej201 IS NULL AND l_xmdf.xmdf201 IS NOT NULL) OR
         (l_xmej.xmej201 IS NOT NULL AND l_xmdf.xmdf201 IS NULL))) THEN
         #其說明的SQL
         LET g_xmek007 = "SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inab001=? AND inab002=? AND inabsite=? "
         #新增資料到變更歷程檔
         IF NOT s_axmt510_ins_xmek(l_xmej.xmejseq,0,l_xmej.xmejseq2,"xmdf201",l_xmej.xmej901,l_xmdf.xmdf201,l_xmej.xmej201,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
            LET r_success = FALSE
            RETURN r_success
         END IF
         LET l_flag = TRUE
      ELSE
         #資料一樣，表示無變更，將變更歷程檔刪除
         IF NOT s_axmt510_del_xmek(l_xmej.xmejseq,0,l_xmej.xmejseq2,"xmdf201",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
            LET r_success = FALSE
            RETURN r_success
         END IF
      END IF

      #發貨組織
      IF l_xmej.xmej901 = '3' OR (l_xmej.xmej901 = '2' AND
         ((l_xmej.xmejunit <> l_xmdf.xmdfunit) OR
         (l_xmej.xmejunit IS NULL AND l_xmdf.xmdfunit IS NOT NULL) OR
         (l_xmej.xmejunit IS NOT NULL AND l_xmdf.xmdfunit IS NULL))) THEN
         #其說明的SQL
         LET g_xmek007 = "SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"' "
         #新增資料到變更歷程檔
         IF NOT s_axmt510_ins_xmek(l_xmej.xmejseq,0,l_xmej.xmejseq2,"xmdfunit",l_xmej.xmej901,l_xmdf.xmdfunit,l_xmej.xmejunit,g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
            LET r_success = FALSE
            RETURN r_success
         END IF
         LET l_flag = TRUE
      ELSE
         #資料一樣，表示無變更，將變更歷程檔刪除
         IF NOT s_axmt510_del_xmek(l_xmej.xmejseq,0,l_xmej.xmejseq2,"xmdfunit",g_xmee_m.xmeedocno,g_xmee_m.xmee900) THEN
            LET r_success = FALSE
            RETURN r_success
         END IF
      END IF
   END FOREACH   

   RETURN r_success
END FUNCTION

PRIVATE FUNCTION adbt510_xmeh214_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh213
      LET g_ref_fields[2] = g_xmeg3_d[l_ac].xmeh214
      LET g_ref_fields[3] = g_xmeg3_d[l_ac].xmehunit
      CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inab001=? AND inab002=? AND inabsite=? ","") RETURNING g_rtn_fields
      LET g_xmeg3_d[l_ac].xmeh214_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmeg3_d[l_ac].xmeh214_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmeh213_ref()
      #150907-00033#1 20150916 mark by beckxie---S
      #INITIALIZE g_ref_fields TO NULL
      #LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh213
      #LET g_ref_fields[2] = g_xmeg3_d[l_ac].xmehunit
      #CALL ap_ref_array2(g_ref_fields,"SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaa001=?  AND inaasite=? ","") RETURNING g_rtn_fields
      #LET g_xmeg3_d[l_ac].xmeh213_desc = '', g_rtn_fields[1] , ''
      #DISPLAY BY NAME g_xmeg3_d[l_ac].xmeh213_desc
      #150907-00033#1 20150916 mark by beckxie---E
      #150907-00033#1 20150916  add by beckxie---S
      CALL s_desc_get_stock_desc(g_xmeg3_d[l_ac].xmehunit,g_xmeg3_d[l_ac].xmeh213) RETURNING g_xmeg3_d[l_ac].xmeh213_desc
      DISPLAY BY NAME g_xmeg3_d[l_ac].xmeh213_desc
      #150907-00033#1 20150916  add by beckxie---E
END FUNCTION

PRIVATE FUNCTION adbt510_xmeh210_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh210
      CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='274' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg3_d[l_ac].xmeh210_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmeg3_d[l_ac].xmeh210_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmeh207_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh207
      CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg3_d[l_ac].xmeh207_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmeg3_d[l_ac].xmeh207_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmeh201_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh201
      CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg3_d[l_ac].xmeh201_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmeg3_d[l_ac].xmeh201_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmeh200_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg3_d[l_ac].xmeh200
      CALL ap_ref_array2(g_ref_fields,"SELECT prcfl003 FROM prcfl_t WHERE prcflent='"||g_enterprise||"' AND prcfl001=? AND prcfl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg3_d[l_ac].xmeh200_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmeg3_d[l_ac].xmeh200_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmjb006_ref()
DEFINE l_ooef019      LIKE ooef_t.ooef019

      SELECT ooef019 INTO l_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_xmee_m.xmeesite
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmeg4_d[l_ac].xmjb006
      CALL ap_ref_array2(g_ref_fields,"SELECT oodbl004 FROM oodbl_t WHERE oodblent='"||g_enterprise||"' AND oodbl001='"||l_ooef019||"' AND oodbl002=? AND oodbl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmeg4_d[l_ac].xmjb006_desc = '', g_rtn_fields[1] , ''
      #DISPLAY BY NAME g_xmeg4_d[l_ac].xmjb006_desc
END FUNCTION
#料件編號帶品名、規格
PRIVATE FUNCTION adbt510_xmeg001_ref(p_xmeg001)
DEFINE p_xmeg001     LIKE xmeg_t.xmeg001
DEFINE r_imaal003    LIKE imaal_t.imaal003
DEFINE r_imaal004    LIKE imaal_t.imaal004

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmeg001
       CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_imaal003 = '', g_rtn_fields[1] , ''
       LET r_imaal004 = '', g_rtn_fields[2] , ''
       RETURN r_imaal003,r_imaal004
END FUNCTION

PRIVATE FUNCTION adbt510_xmee203_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmee_m.xmee203
      CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmee_m.xmee203_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmee_m.xmee203_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmee202_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmee_m.xmee202
      CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmee_m.xmee202_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmee_m.xmee202_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmee201_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmee_m.xmee201
      CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmee_m.xmee201_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmee_m.xmee201_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmee200_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmee_m.xmee200
      CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmee_m.xmee200_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmee_m.xmee200_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmeeunit_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmee_m.xmeeunit
      CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmee_m.xmeeunit_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmee_m.xmeeunit_desc
END FUNCTION

PRIVATE FUNCTION adbt510_xmeesite_ref()
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_xmee_m.xmeesite
      CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_xmee_m.xmeesite_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_xmee_m.xmeesite_desc
END FUNCTION
#發票類型顯示
PRIVATE FUNCTION adbt510_xmee035_ref(p_xmee035)
DEFINE p_xmee035    LIKE xmee_t.xmee035
DEFINE r_isacl004   LIKE isacl_t.isacl004
DEFINE l_ooef019    LIKE ooef_t.ooef019
        
        IF NOT cl_null(g_xmee_m.xmeesite) THEN
           SELECT ooef019 INTO l_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_xmee_m.xmeesite
        ELSE
           SELECT ooef019 INTO l_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
        END IF
        
        INITIALIZE g_ref_fields TO NULL
        LET g_ref_fields[1] = p_xmee035
                    CALL ap_ref_array2(g_ref_fields,"SELECT isacl004 FROM isacl_t WHERE isaclent='"||g_enterprise||"' AND isacl001= '"||l_ooef019||"' AND isacl002=? AND isacl003='"||g_dlang||"'","") RETURNING g_rtn_fields
        LET r_isacl004 = '', g_rtn_fields[1] , ''
        RETURN r_isacl004
         
END FUNCTION
#留置原因顯示
PRIVATE FUNCTION adbt510_xmee032_ref(p_xmee032)
DEFINE p_xmee032   LIKE xmee_t.xmee032
DEFINE r_oocql004  LIKE oocql_t.oocql004

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee032
       CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='297' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_oocql004 = '', g_rtn_fields[1] , ''
       RETURN r_oocql004   
             
END FUNCTION
#銷售分類顯示
PRIVATE FUNCTION adbt510_xmee024_ref(p_xmee024)
DEFINE p_xmee024   LIKE xmee_t.xmee024
DEFINE r_oocql004  LIKE oocql_t.oocql004

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee024
       CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='295' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_oocql004 = '', g_rtn_fields[1] , ''
       RETURN r_oocql004
END FUNCTION
#幣別顯示
PRIVATE FUNCTION adbt510_xmee015_ref(p_xmee015)
DEFINE p_xmee015      LIKE xmee_t.xmee015
DEFINE r_ooail003     LIKE ooail_t.ooail003

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee015
       CALL ap_ref_array2(g_ref_fields,"SELECT ooail003 FROM ooail_t WHERE ooailent='"||g_enterprise||"' AND ooail001=? AND ooail002='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_ooail003 = '', g_rtn_fields[1] , ''
       RETURN r_ooail003
END FUNCTION
#稅別顯示
PRIVATE FUNCTION adbt510_xmee011_ref(p_xmee011)
DEFINE p_xmee011      LIKE xmee_t.xmee011
DEFINE r_oodbl004     LIKE oodbl_t.oodbl004
DEFINE l_ooef019      LIKE ooef_t.ooef019

       SELECT ooef019 INTO l_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_xmee_m.xmeesite
       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee011
       CALL ap_ref_array2(g_ref_fields,"SELECT oodbl004 FROM oodbl_t WHERE oodblent='"||g_enterprise||"' AND oodbl001='"||l_ooef019||"' AND oodbl002=? AND oodbl003='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_oodbl004 = '', g_rtn_fields[1] , ''
       RETURN r_oodbl004
END FUNCTION
#交昜條件顯示
PRIVATE FUNCTION adbt510_xmee010_ref(p_xmee010)
DEFINE p_xmee010      LIKE xmee_t.xmee010
DEFINE r_oocql004     LIKE oocql_t.oocql004

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee010
       CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='238' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_oocql004 = g_rtn_fields[1]
       RETURN r_oocql004
END FUNCTION
#收款條件顯示
PRIVATE FUNCTION adbt510_xmee009_ref(p_xmee009)
DEFINE p_xmee009      LIKE xmee_t.xmee009
DEFINE r_ooibl004     LIKE ooibl_t.ooibl004

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee009
       CALL ap_ref_array2(g_ref_fields,"SELECT ooibl004 FROM ooibl_t WHERE ooiblent='"||g_enterprise||"' AND ooibl002=? AND ooibl003='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_ooibl004 = g_rtn_fields[1]
       RETURN r_ooibl004
END FUNCTION
#帶出供應商說明
PRIVATE FUNCTION adbt510_xmee004_ref(p_xmee004)
DEFINE p_xmee004    LIKE xmee_t.xmee004
DEFINE r_pmaal004   LIKE pmaal_t.pmaal004

        INITIALIZE g_ref_fields TO NULL
        LET g_ref_fields[1] = p_xmee004
        CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
        LET r_pmaal004 = '', g_rtn_fields[1] , ''
        RETURN r_pmaal004
END FUNCTION
#獲取部門編號說明
PRIVATE FUNCTION adbt510_xmee003_ref(p_xmee003)
DEFINE p_xmee003      LIKE xmee_t.xmee003
DEFINE r_xmee003_desc LIKE ooefl_t.ooefl003

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee003
       CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_xmee003_desc = '', g_rtn_fields[1] , ''
       RETURN r_xmee003_desc
END FUNCTION
#獲取員工編號說明
PRIVATE FUNCTION adbt510_xmee002_ref(p_xmee002)
DEFINE p_xmee002      LIKE xmee_t.xmee002
DEFINE r_xmee002_desc LIKE oofa_t.oofa011

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_xmee002
       CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
       LET r_xmee002_desc = '', g_rtn_fields[1] , ''
       RETURN r_xmee002_desc
END FUNCTION

PRIVATE FUNCTION adbt510_set_comp_visible_b()
   CALL cl_set_comp_visible("xmjb024,xmjb024_desc",TRUE) #160513-00027#1 20160520 add by beckxie
END FUNCTION

PRIVATE FUNCTION adbt510_set_comp_no_visible_b()
   #160513-00027#1 20160520 add by beckxie---S
   IF NOT cl_null(g_xmee_m.xmee022) THEN
      CALL cl_set_comp_visible("xmjb024,xmjb024_desc",FALSE) 
   END IF
   #160513-00027#1 20160520 add by beckxie---E
END FUNCTION

 
{</section>}
 
