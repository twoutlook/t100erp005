<add_points prog="aqct300" std_prog="aqct300" erpver="1.0" module="AQC" ver="42" env="s" zone="topprd" booking="Y" type="M" identity="s" section_flag="N" designer_ver="1.0" login_user="topstd">
  <other>
    <code_template value="F" status="" />
    <free_style value="N" status="" />
    <start_arg value="" status="" />
  </other>
  <point name="construct.c.page2.qcbe001" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbe001  #顯示到畫面上

            NEXT FIELD qcbe001                     #返回原欄位

]]>
</point>
  <point name="construct.c.page3.qcbf001" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbf001  #顯示到畫面上

            NEXT FIELD qcbf001                     #返回原欄位

]]>
</point>
  <point name="construct.c.page5.qcbc002" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_qcao002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbc002  #顯示到畫面上

            NEXT FIELD qcbc002                     #返回原欄位

]]>
</point>
  <point name="construct.c.page5.qcbc003" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbc003  #顯示到畫面上

            NEXT FIELD qcbc003                     #返回原欄位

]]>
</point>
  <point name="construct.c.page5.qcbc005" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_inaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbc005  #顯示到畫面上

            NEXT FIELD qcbc005                     #返回原欄位

]]>
</point>
  <point name="construct.c.page5.qcbc006" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_inab002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbc006  #顯示到畫面上

            NEXT FIELD qcbc006                     #返回原欄位

]]>
</point>
  <point name="construct.c.page5.qcbc008" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbc008  #顯示到畫面上

            NEXT FIELD qcbc008                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba010" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba010  #顯示到畫面上

            NEXT FIELD qcba010                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba016" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba016  #顯示到畫面上

            NEXT FIELD qcba016                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba024" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba024  #顯示到畫面上

            NEXT FIELD qcba024                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba900" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba900  #顯示到畫面上

            NEXT FIELD qcba900                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba901" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba901  #顯示到畫面上

            NEXT FIELD qcba901                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcbacnfid" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbacnfid  #顯示到畫面上

            NEXT FIELD qcbacnfid                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcbacrtdp" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbacrtdp  #顯示到畫面上

            NEXT FIELD qcbacrtdp                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcbacrtid" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbacrtid  #顯示到畫面上

            NEXT FIELD qcbacrtid                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcbamodid" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbamodid  #顯示到畫面上

            NEXT FIELD qcbamodid                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcbaowndp" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbaowndp  #顯示到畫面上

            NEXT FIELD qcbaowndp                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcbaownid" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbaownid  #顯示到畫面上

            NEXT FIELD qcbaownid                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcbapstid" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbapstid  #顯示到畫面上

            NEXT FIELD qcbapstid                     #返回原欄位

]]>
</point>
  <point name="input.a.page2.qcbeseq" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_qcba_m.qcbasite IS NOT NULL AND g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd2_d[g_detail_idx].qcbeseq IS NOT NULL AND g_qcbd2_d[g_detail_idx].qcbe001 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t OR g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd2_d[g_detail_idx].qcbeseq != g_qcbd2_d_t.qcbeseq OR g_qcbd2_d[g_detail_idx].qcbe001 != g_qcbd2_d_t.qcbe001)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbe_t WHERE "||"qcbeent = '" ||g_enterprise|| "' AND "||"qcbesite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbedocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbeseq = '"||g_qcbd2_d[g_detail_idx].qcbeseq ||"' AND "|| "qcbe001 = '"||g_qcbd2_d[g_detail_idx].qcbe001 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            CALL aqct300_qcbe_ref('')
            IF NOT cl_null(g_qcbd2_d[g_detail_idx].qcbeseq) THEN 
               LET l_n = 0
               SELECT COUNT(*) INTO l_n FROM qcbd_t WHERE qcbdent = g_enterprise
                  AND qcbdsite = g_qcba_m.qcbasite AND qcbddocno = g_qcba_m.qcbadocno
                  AND qcbdseq = g_qcbd2_d[g_detail_idx].qcbeseq
               IF l_n = 0 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'aqc-00034'
                  LET g_errparam.extend = g_qcbd2_d[g_detail_idx].qcbeseq
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_qcbd2_d[g_detail_idx].qcbeseq = g_qcbd2_d_t.qcbeseq
                  CALL aqct300_qcbe_ref(g_qcbd2_d[g_detail_idx].qcbeseq)
                  NEXT FIELD CURRENT
               END IF
               IF NOT aqct300_qcbe002_chk() THEN
                  LET g_qcbd2_d[g_detail_idx].qcbeseq = g_qcbd2_d_t.qcbeseq
                  CALL aqct300_qcbe_ref(g_qcbd2_d[g_detail_idx].qcbeseq)
                  NEXT FIELD CURRENT
               END IF
               CALL aqct300_qcbe_ref(g_qcbd2_d[g_detail_idx].qcbeseq)
            ELSE            
               NEXT FIELD CURRENT
            END IF
]]>
</point>
  <point name="input.a.page3.qcbf001" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            CALL aqct300_qcbf001_desc('')
            IF NOT cl_null(g_qcbd3_d[l_ac].qcbf001) THEN 

               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcbd3_d[l_ac].qcbf001

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_1053") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd3_d[l_ac].qcbf001 = g_qcbd3_d_t.qcbf001
                  CALL aqct300_qcbf001_desc(g_qcbd3_d[l_ac].qcbf001)
                  NEXT FIELD CURRENT
               END IF
               IF NOT aqct300_qcbfseq_qcbf001_chk() THEN
                  LET g_qcbd3_d[g_detail_idx].qcbf001 = g_qcbd3_d_t.qcbf001
                  CALL aqct300_qcbf001_desc(g_qcbd3_d[l_ac].qcbf001)
                  NEXT FIELD CURRENT
               END IF

            END IF
            IF  g_qcba_m.qcbasite IS NOT NULL AND g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbfseq IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf001 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf002 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t OR g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd3_d[g_detail_idx].qcbfseq != g_qcbd3_d_t.qcbfseq OR g_qcbd3_d[g_detail_idx].qcbf001 != g_qcbd3_d_t.qcbf001 OR g_qcbd3_d[g_detail_idx].qcbf002 != g_qcbd3_d_t.qcbf002 OR g_qcbd3_d[g_detail_idx].qcbf003 != g_qcbd3_d_t.qcbf003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbf_t WHERE "||"qcbfent = '" ||g_enterprise|| "' AND "||"qcbfsite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbfdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbfseq = '"||g_qcbd3_d[g_detail_idx].qcbfseq ||"' AND "|| "qcbf001 = '"||g_qcbd3_d[g_detail_idx].qcbf001 ||"' AND "|| "qcbf002 = '"||g_qcbd3_d[g_detail_idx].qcbf002 ||"' AND "|| "qcbf003 = '"||g_qcbd3_d[g_detail_idx].qcbf003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            
            CALL aqct300_qcbf001_desc(g_qcbd3_d[l_ac].qcbf001)]]>
</point>
  <point name="input.a.page3.qcbf002" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_qcba_m.qcbasite IS NOT NULL AND g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbfseq IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf001 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf002 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t OR g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd3_d[g_detail_idx].qcbfseq != g_qcbd3_d_t.qcbfseq OR g_qcbd3_d[g_detail_idx].qcbf001 != g_qcbd3_d_t.qcbf001 OR g_qcbd3_d[g_detail_idx].qcbf002 != g_qcbd3_d_t.qcbf002 OR g_qcbd3_d[g_detail_idx].qcbf003 != g_qcbd3_d_t.qcbf003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbf_t WHERE "||"qcbfent = '" ||g_enterprise|| "' AND "||"qcbfsite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbfdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbfseq = '"||g_qcbd3_d[g_detail_idx].qcbfseq ||"' AND "|| "qcbf001 = '"||g_qcbd3_d[g_detail_idx].qcbf001 ||"' AND "|| "qcbf002 = '"||g_qcbd3_d[g_detail_idx].qcbf002 ||"' AND "|| "qcbf003 = '"||g_qcbd3_d[g_detail_idx].qcbf003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page3.qcbf003" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_qcba_m.qcbasite IS NOT NULL AND g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbfseq IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf001 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf002 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t OR g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd3_d[g_detail_idx].qcbfseq != g_qcbd3_d_t.qcbfseq OR g_qcbd3_d[g_detail_idx].qcbf001 != g_qcbd3_d_t.qcbf001 OR g_qcbd3_d[g_detail_idx].qcbf002 != g_qcbd3_d_t.qcbf002 OR g_qcbd3_d[g_detail_idx].qcbf003 != g_qcbd3_d_t.qcbf003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbf_t WHERE "||"qcbfent = '" ||g_enterprise|| "' AND "||"qcbfsite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbfdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbfseq = '"||g_qcbd3_d[g_detail_idx].qcbfseq ||"' AND "|| "qcbf001 = '"||g_qcbd3_d[g_detail_idx].qcbf001 ||"' AND "|| "qcbf002 = '"||g_qcbd3_d[g_detail_idx].qcbf002 ||"' AND "|| "qcbf003 = '"||g_qcbd3_d[g_detail_idx].qcbf003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page3.qcbfseq" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_qcba_m.qcbasite IS NOT NULL AND g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbfseq IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf001 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf002 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t OR g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd3_d[g_detail_idx].qcbfseq != g_qcbd3_d_t.qcbfseq OR g_qcbd3_d[g_detail_idx].qcbf001 != g_qcbd3_d_t.qcbf001 OR g_qcbd3_d[g_detail_idx].qcbf002 != g_qcbd3_d_t.qcbf002 OR g_qcbd3_d[g_detail_idx].qcbf003 != g_qcbd3_d_t.qcbf003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbf_t WHERE "||"qcbfent = '" ||g_enterprise|| "' AND "||"qcbfsite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbfdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbfseq = '"||g_qcbd3_d[g_detail_idx].qcbfseq ||"' AND "|| "qcbf001 = '"||g_qcbd3_d[g_detail_idx].qcbf001 ||"' AND "|| "qcbf002 = '"||g_qcbd3_d[g_detail_idx].qcbf002 ||"' AND "|| "qcbf003 = '"||g_qcbd3_d[g_detail_idx].qcbf003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            IF NOT aqct300_qcbfseq_qcbf001_chk() THEN
               LET g_qcbd3_d[g_detail_idx].qcbfseq = g_qcbd3_d_t.qcbfseq
               NEXT FIELD CURRENT
            END IF
]]>
</point>
  <point name="input.a.qcba009" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            
]]>
</point>
  <point name="input.a.qcba013" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            
]]>
</point>
  <point name="input.a.qcba901" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcba901_desc('')
            IF NOT cl_null(g_qcba_m.qcba901) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcba901
               LET g_chkparam.arg2 = g_qcba_m.qcbadocdt

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooeg001_2") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcba_m.qcba901 = g_qcba_m_t.qcba901
                  CALL aqct300_qcba901_desc(g_qcba_m.qcba901)
                  NEXT FIELD CURRENT
               END IF
               CALL aqct300_qcba901_desc(g_qcba_m.qcba901)

            END IF 
            
]]>
</point>
  <point name="input.c.page3.qcbf001" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd3_d[l_ac].qcbf001             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "1053" #

            CALL q_oocq002()                                #呼叫開窗

            LET g_qcbd3_d[l_ac].qcbf001 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd3_d[l_ac].qcbf001 TO qcbf001              #顯示到畫面上
            CALL aqct300_qcbf001_desc(g_qcbd3_d[l_ac].qcbf001)
            NEXT FIELD qcbf001                          #返回原欄位

]]>
</point>
  <point name="input.c.page5.qcbc003" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc003             #給予default值

            #給予arg

            CALL q_imaa001()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc003 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc003 TO qcbc003              #顯示到畫面上

            NEXT FIELD qcbc003                          #返回原欄位

]]>
</point>
  <point name="input.c.page5.qcbc006" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc006             #給予default值
            LET g_qryparam.arg1 = g_qcba_m.qcbasite
            LET g_qryparam.arg2 = g_qcbd5_d[l_ac].qcbc005
            #給予arg

            CALL q_inab002_6()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc006 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc006 TO qcbc006              #顯示到畫面上
            CALL aqct300_qcbc006_desc(g_qcbd5_d[l_ac].qcbc006)
            NEXT FIELD qcbc006                          #返回原欄位

]]>
</point>
  <point name="input.c.page5.qcbc008" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc008             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc008 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc008 TO qcbc008              #顯示到畫面上
            CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
            NEXT FIELD qcbc008                          #返回原欄位

]]>
</point>
  <point name="input.c.qcba005" order="0" ver="22" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcba_m.qcba005             #給予default值

            #CALL q_pmaa001()                                #呼叫開窗  #160913-00055#5
            CALL q_pmaa001_25()        #160913-00055#5

            LET g_qcba_m.qcba005 = g_qryparam.return1              #將開窗取得的值回傳到變數
         
            DISPLAY g_qcba_m.qcba005 TO qcba005              #顯示到畫面上
            CALL aqct300_qcba005_desc(g_qcba_m.qcba005)
            NEXT FIELD qcba005                          #返回原欄位

]]>
</point>
  <point name="input.c.qcba016" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcba_m.qcba016             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_qcba_m.qcba016 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcba_m.qcba016 TO qcba016              #顯示到畫面上
            CALL aqct300_qcba016_desc(g_qcba_m.qcba016)
            NEXT FIELD qcba016                          #返回原欄位

]]>
</point>
  <point name="input.c.qcba024" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcba_m.qcba024             #給予default值

            #給予arg

            CALL q_ooag001()                                #呼叫開窗

            LET g_qcba_m.qcba024 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcba_m.qcba024 TO qcba024              #顯示到畫面上
            CALL aqct300_qcba024_desc(g_qcba_m.qcba024)
            NEXT FIELD qcba024                          #返回原欄位

]]>
</point>
  <point name="input.c.qcba900" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcba_m.qcba900             #給予default值

            #給予arg

            CALL q_ooag001()                                #呼叫開窗

            LET g_qcba_m.qcba900 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcba_m.qcba900 TO qcba900              #顯示到畫面上
            CALL aqct300_qcba900_desc(g_qcba_m.qcba900)
            NEXT FIELD qcba900                          #返回原欄位

]]>
</point>
  <point name="input.c.qcba901" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcba_m.qcba901             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_qcba_m.qcbadocdt #單據日期

            CALL q_ooeg001()                                #呼叫開窗

            LET g_qcba_m.qcba901 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcba_m.qcba901 TO qcba901              #顯示到畫面上

            NEXT FIELD qcba901                          #返回原欄位

]]>
</point>
  <point name="input.c.qcbadocno" order="0" ver="16" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcba_m.qcbadocno             #給予default值

            #給予arg
            SELECT ooef004 INTO l_ooef004 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
            LET g_qryparam.arg1 = l_ooef004 #參照表號
            #160705-00001 by whitney modify start
            #LET g_qryparam.arg2 = "aqct300" #對應作業編號
            LET g_qryparam.arg2 = g_prog
            #160705-00001 by whitney modify end

            CALL q_ooba002_1()                                #呼叫開窗

            LET g_qcba_m.qcbadocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcba_m.qcbadocno TO qcbadocno              #顯示到畫面上
            CALL aqct300_qcbadocno_desc(g_qcba_m.qcbadocno)
            NEXT FIELD qcbadocno                          #返回原欄位

]]>
</point>
  <point name="show.body3.reference" order="0" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_qcbd3_d[l_ac].qcbf001
            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='1053' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_qcbd3_d[l_ac].qcbf001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_qcbd3_d[l_ac].qcbf001_desc
]]>
</point>
  <point name="function.aqct300_qcbadocno_desc" order="1" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbadocno_desc(p_qcbadocno)
DEFINE  p_qcbadocno    LIKE qcba_t.qcbadocno
DEFINE  l_slip         STRING
      IF NOT cl_null(p_qcbadocno) THEN
         CALL s_aooi200_get_slip(p_qcbadocno) RETURNING g_success,l_slip
         CALL s_aooi200_get_slip_desc(l_slip) RETURNING g_qcba_m.qcbadocno_desc
         DISPLAY BY NAME g_qcba_m.qcbadocno_desc
      END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba900_desc" order="2" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba900_desc(p_qcba900)
DEFINE p_qcba900     LIKE qcba_t.qcba900
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcba900
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET g_qcba_m.qcba900_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcba_m.qcba900_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba901_desc" order="3" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba901_desc(p_qcba901)
DEFINE   p_qcba901     LIKE qcba_t.qcba901
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcba901
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcba_m.qcba901_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcba_m.qcba901_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba005_desc" order="4" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba005_desc(p_qcba005)
DEFINE  p_qcba005     LIKE qcba_t.qcba005
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcba005
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcba_m.qcba005_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcba_m.qcba005_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba006_required" order="5" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba006_required()
   IF g_qcba_m.qcba000 = '3' THEN
      CALL cl_set_comp_required("qcba006,qcba007",TRUE)
   ELSE   
      CALL cl_set_comp_required("qcba006,qcba007",FALSE)
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba010_ref" order="6" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba010_ref()
   IF NOT cl_null(g_qcba_m.qcba010) THEN
      SELECT qcap008 INTO g_qcba_m.imae116 FROM qcap_t
       WHERE qcapent = g_enterprise AND qcapsite = g_qcba_m.qcbasite
         AND qcap001 = g_qcba_m.qcba010 AND qcap002 = g_qcba_m.qcba005
         AND qcap003 = 'ALL' AND qcap004 = 0
         AND qcap005 = 'ALL'
      IF cl_null(g_qcba_m.imae116) THEN
         SELECT imae116 INTO g_qcba_m.imae116 FROM imae_t 
          WHERE imaesite = g_qcba_m.qcbasite AND imaeent = g_enterprise AND imae001 = g_qcba_m.qcba010 
      END IF 
      
      SELECT imaal003,imaal004,imae111 INTO g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.qcba013 FROM imaa_t
         LEFT OUTER JOIN imaal_t ON imaalent = imaaent AND imaal001 = imaa001 AND imaal002 = g_dlang
         LEFT OUTER JOIN imae_t  ON imaeent = imaaent AND imaesite = g_site AND imae001 = imaa001
      WHERE imaaent = g_enterprise AND imaa001 = g_qcba_m.qcba010   
      
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_qcba_m.qcba013
      CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='205' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_qcba_m.qcba013_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.qcba013_desc,g_qcba_m.imae116      
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba024_desc" order="7" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba024_desc(p_qcba024)
DEFINE   p_qcba024    LIKE qcba_t.qcba024
    INITIALIZE g_ref_fields TO NULL
    LET g_ref_fields[1] = p_qcba024
    CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
    LET g_qcba_m.qcba024_desc = '', g_rtn_fields[1] , ''
    DISPLAY BY NAME g_qcba_m.qcba024_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba030_insert" order="8" ver="40" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#新增qcba030的資料
PRIVATE FUNCTION aqct300_qcba030_insert()
DEFINE l_n           LIKE type_t.num5
DEFINE l_qcam010     LIKE qcam_t.qcam010
   
   LET l_n = 0
   
   SELECT COUNT(1) INTO l_n FROM qcam_t 
      WHERE qcam001 = g_qcaz001
        AND (qcam002 = g_qcba_m.qcba013 OR qcam002 = 'ALL')
        AND (qcam003 = g_qcba_m.qcba010 OR qcam003 = 'ALL')
        AND (qcam004 = g_qcba_m.qcba012 OR qcam004 = 'ALL')
        AND (qcam005 = g_qcba_m.qcba006 OR qcam005 = 'ALL')
        AND (qcam006 = g_qcba_m.qcba007 OR qcam006 = 0)
        AND (qcam008 = g_qcba_m.qcba005 OR qcam008 = 'ALL')
        AND (qcam009 = g_qcba_m.qcba000 OR qcam009 = '0')     
        AND qcamstus = 'Y'
        AND qcament = g_enterprise #add by geza 20160905 #160905-00007#13
   #170207-00018#3    2017/02/16   By 08734 mark(S)     
   #SELECT qcam010 INTO g_qcba_m.qcba030 FROM qcam_t 
   #WHERE qcam001 = g_qcaz001
   #  AND (qcam002 = g_qcba_m.qcba013 OR qcam002 = 'ALL')
   #  AND (qcam003 = g_qcba_m.qcba010 OR qcam003 = 'ALL')
   #  AND (qcam004 = g_qcba_m.qcba012 OR qcam004 = 'ALL')
   #  AND (qcam005 = g_qcba_m.qcba006 OR qcam005 = 'ALL')
   #  AND (qcam006 = g_qcba_m.qcba007 OR qcam006 = 0)
   #  AND (qcam008 = g_qcba_m.qcba005 OR qcam008 = 'ALL')
   #  AND (qcam009 = g_qcba_m.qcba000 OR qcam009 = '0') 
   #  AND qcamstus = 'Y'     
   #  AND qcament = g_enterprise #add by geza 20160905 #160905-00007#13
   #  AND ROWNUM = 1 ORDER BY qcam010
   #170207-00018#3    2017/02/16   By 08734 mark(E)  
   #170207-00018#3    2017/02/16   By 08734 add(S)
   SELECT A.qcam010 INTO g_qcba_m.qcba030 FROM(SELECT qcam010  FROM qcam_t 
   WHERE qcam001 = g_qcaz001
     AND (qcam002 = g_qcba_m.qcba013 OR qcam002 = 'ALL')
     AND (qcam003 = g_qcba_m.qcba010 OR qcam003 = 'ALL')
     AND (qcam004 = g_qcba_m.qcba012 OR qcam004 = 'ALL')
     AND (qcam005 = g_qcba_m.qcba006 OR qcam005 = 'ALL')
     AND (qcam006 = g_qcba_m.qcba007 OR qcam006 = 0)
     AND (qcam008 = g_qcba_m.qcba005 OR qcam008 = 'ALL')
     AND (qcam009 = g_qcba_m.qcba000 OR qcam009 = '0') 
     AND qcamstus = 'Y'     
     AND qcament = g_enterprise 
     ORDER BY qcam010) A
   WHERE ROWNUM = 1
   #170207-00018#3    2017/02/16   By 08734 add(E)
   IF l_n >1 THEN
      INITIALIZE g_qryparam.* TO NULL
      LET g_qryparam.state = 'i'
	  LET g_qryparam.reqry = FALSE
      
      LET g_qryparam.default1 = g_qcba_m.qcba030             #給予default值

      #給予arg
      CALL aqct300_qcba_default()
      LET g_qryparam.where = " qcam001 = '",g_qcaz001,"'",
                             " AND (qcam002 = '",g_qcba_m.qcba013 CLIPPED,"' OR qcam002 = 'ALL') ",
                             " AND (qcam003 = '",g_qcba_m.qcba010 CLIPPED,"' OR qcam003 = 'ALL') ",
                             " AND (qcam004 = '",g_qcba_m.qcba012 CLIPPED,"' OR qcam004 = 'ALL') ",
                             " AND (qcam005 = '",g_qcba_m.qcba006 CLIPPED,"' OR qcam005 = 'ALL') ",
                             " AND (qcam006 = ",g_qcba_m.qcba007," OR qcam006 = 0 ) ",
                             " AND (qcam008 = '",g_qcba_m.qcba005 CLIPPED,"' OR qcam008 = 'ALL') ",
                             " AND (qcam009 = '",g_qcba_m.qcba000 CLIPPED,"' OR qcam009 = '0') "

      CALL q_qcam010()                              #呼叫開窗

      LET g_qcba_m.qcba030 = g_qryparam.return1              #將開窗取得的值回傳到變數
      
   END IF
   UPDATE qcba_t SET qcba030 = g_qcba_m.qcba030 
               WHERE qcbaent = g_enterprise 
                 AND qcbadocno = g_qcba_m.qcbadocno
   IF SQLCA.SQLCODE THEN
      RETURN FALSE
   END IF
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd_insert" order="9" ver="30" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#新增qcbd_t的資料
PRIVATE FUNCTION aqct300_qcbd_insert()
DEFINE l_sql     STRING
DEFINE l_n       LIKE type_t.num5
DEFINE l_qcbd    RECORD 
                 qcbdent    LIKE qcbd_t.qcbdent,
                 qcbdsite   LIKE qcbd_t.qcbdsite,
                 qcbddocno  LIKE qcbd_t.qcbddocno,
                 qcbdseq    LIKE qcbd_t.qcbdseq,
                 qcbd001    LIKE qcbd_t.qcbd001, 
                 qcbd002    LIKE qcbd_t.qcbd002, 
                 qcbd003    LIKE qcbd_t.qcbd003, 
                 qcbd004    LIKE qcbd_t.qcbd004, 
                 qcbd005    LIKE qcbd_t.qcbd005, 
                 qcbd006    LIKE qcbd_t.qcbd006, 
                 qcbd007    LIKE qcbd_t.qcbd007, 
                 qcbd008    LIKE qcbd_t.qcbd008, 
                 qcbd009    LIKE qcbd_t.qcbd009, 
                 qcbd010    LIKE qcbd_t.qcbd010, 
                 qcbd011    LIKE qcbd_t.qcbd011,
                 qcbd012    LIKE qcbd_t.qcbd012,
                 qcbd013    LIKE qcbd_t.qcbd013,
                 qcbd014    LIKE qcbd_t.qcbd014,
                 qcbd015    LIKE qcbd_t.qcbd015,
                 qcbd016    LIKE qcbd_t.qcbd016,
                 qcbd017    LIKE qcbd_t.qcbd017,
                 qcbd018    LIKE qcbd_t.qcbd018,
                 qcbd019    LIKE qcbd_t.qcbd019,
                 qcbd020    LIKE qcbd_t.qcbd020,
                 qcbd021    LIKE qcbd_t.qcbd021
             END RECORD
#DEFINE l_qcan    RECORD LIKE qcan_t.* #161124-00048#10 marl
#161124-00048#10 add(s)
DEFINE l_qcan RECORD  #品質檢驗項目單身檔
       qcanent LIKE qcan_t.qcanent, #企业编号
       qcan001 LIKE qcan_t.qcan001, #参照表号
       qcan002 LIKE qcan_t.qcan002, #品管分群
       qcan003 LIKE qcan_t.qcan003, #料件编号
       qcan004 LIKE qcan_t.qcan004, #产品特征
       qcan005 LIKE qcan_t.qcan005, #作业编号
       qcan006 LIKE qcan_t.qcan006, #加工序
       qcan007 LIKE qcan_t.qcan007, #交易对象编号
       qcan008 LIKE qcan_t.qcan008, #检验类型
       qcan009 LIKE qcan_t.qcan009, #项次
       qcan010 LIKE qcan_t.qcan010, #检验项目
       qcan011 LIKE qcan_t.qcan011, #检验位置
       qcan012 LIKE qcan_t.qcan012, #缺点等级
       qcan013 LIKE qcan_t.qcan013, #抽样计划
       qcan014 LIKE qcan_t.qcan014, #AQL
       qcan015 LIKE qcan_t.qcan015, #测量值控制方式
       qcan016 LIKE qcan_t.qcan016, #检验方式
       qcan017 LIKE qcan_t.qcan017, #资源类型
       qcan018 LIKE qcan_t.qcan018, #指定仪器
       qcan019 LIKE qcan_t.qcan019, #规范上限
       qcan020 LIKE qcan_t.qcan020, #检验上限
       qcan021 LIKE qcan_t.qcan021, #检验标准值
       qcan022 LIKE qcan_t.qcan022, #检验下限
       qcan023 LIKE qcan_t.qcan023, #规范下限
       qcan024 LIKE qcan_t.qcan024, #计量单位
       qcan025 LIKE qcan_t.qcan025, #检验规格说明
       qcan026 LIKE qcan_t.qcan026  #备注
END RECORD
#161124-00048#10 add(e)
DEFINE l_rate_qcbd009 LIKE qcbd_t.qcbd009   #161219-00061#1 add
#   LET l_sql = " SELECT * FROM qcan_t,qcam_t WHERE  qcan001 = '",g_qcaz001,"'", #161124-00048#10 mark
    #161124-00048#10 add(s)
    LET l_sql = " SELECT qcanent,qcan001,qcan002,qcan003,qcan004,qcan005,",
                "        qcan006,qcan007,qcan008,qcan009,qcan010,qcan011,",
                "        qcan012,qcan013,qcan014,qcan015,qcan016,qcan017,",
                "        qcan018,qcan019,qcan020,qcan021,qcan022,qcan023,",
                "        qcan024,qcan025,qcan026 FROM qcan_t,qcam_t WHERE  qcan001 = '",g_qcaz001,"'",
    #161124-00048#10 add(e)
               "    AND qcanent = qcament  AND qcam001 = qcan001 ",
               "    AND qcan002 = qcam002  AND qcan003 = qcam003 ",
               "    AND qcan004 = qcam004  AND qcan005 = qcam005 ",
               "    AND qcan006 = qcam006  AND qcan007 = qcam008 ",
               "    AND qcan008 = qcam009 ",
               "    AND qcanent = '",g_enterprise,"'",   #160324-00033#1
               "    AND qcam010 = '",g_qcba_m.qcba030,"'",
               "   ORDER BY qcan009" 
   PREPARE qcbd_ins_pre1 FROM l_sql
   DECLARE qcbd_ins_cur1 CURSOR FOR qcbd_ins_pre1
   FOREACH qcbd_ins_cur1 INTO l_qcan.*
      IF SQLCA.SQLCODE THEN
         RETURN FALSE
      END IF
  
      LET l_qcbd.qcbdent = g_enterprise           LET l_qcbd.qcbdsite = g_qcba_m.qcbasite
      LET l_qcbd.qcbddocno = g_qcba_m.qcbadocno   LET l_qcbd.qcbdseq = l_qcan.qcan009
      LET l_qcbd.qcbd001 = l_qcan.qcan010         LET l_qcbd.qcbd002 = l_qcan.qcan011
      LET l_qcbd.qcbd003 = l_qcan.qcan012         LET l_qcbd.qcbd004 = l_qcan.qcan014
      CALL aqct300_qcbd005_qcbd006_result(l_qcan.qcan013,l_qcan.qcan014) RETURNING l_qcbd.qcbd005,l_qcbd.qcbd006      
      CALL aqct300_qcbd007_qcbd008_result(l_qcan.qcan013)  RETURNING l_qcbd.qcbd007,l_qcbd.qcbd008
      CALL aqct300_qcbd009_result(l_qcan.qcan013,l_qcan.qcan014) RETURNING l_qcbd.qcbd009
      #161219-00061#1 add---start---
      IF NOT cl_null(l_qcbd.qcbd009) THEN
         IF g_qcba_m.qcba009 <> g_qcba_m.qcba016 THEN
            LET l_rate_qcbd009 = 0
            CALL s_aooi250_convert_qty(g_qcba_m.qcba010,g_qcba_m.qcba009,g_qcba_m.qcba016,l_qcbd.qcbd009)
                 RETURNING g_success,l_rate_qcbd009
            IF l_rate_qcbd009 <> 0 THEN
               LET l_qcbd.qcbd009 = l_rate_qcbd009
            END IF
         END IF
      END IF
      #161219-00061#1 add---end---
      LET l_qcbd.qcbd010 = 0                      LET l_qcbd.qcbd011 = '1'
      LET l_qcbd.qcbd012 = l_qcan.qcan019         LET l_qcbd.qcbd013 = l_qcan.qcan020
      LET l_qcbd.qcbd014 = l_qcan.qcan021         LET l_qcbd.qcbd015 = l_qcan.qcan022
      LET l_qcbd.qcbd016 = l_qcan.qcan023         LET l_qcbd.qcbd017 = l_qcan.qcan024
      LET l_qcbd.qcbd018 = l_qcan.qcan025         LET l_qcbd.qcbd019 = l_qcan.qcan026
      LET l_qcbd.qcbd020 = l_qcan.qcan013         LET l_qcbd.qcbd021 = 0
      INSERT INTO qcbd_t(qcbdent,qcbdsite,qcbddocno,qcbdseq,qcbd001,qcbd002,qcbd003,qcbd004,
                         qcbd005,qcbd006,qcbd007,qcbd008,qcbd009,qcbd010,qcbd011,qcbd012,
                         qcbd013,qcbd014,qcbd015,qcbd016,qcbd017,qcbd018,qcbd019,qcbd020,qcbd021) 
                  VALUES(l_qcbd.*)
      IF SQLCA.SQLCODE OR SQLCA.SQLERRD[3] = 0 THEN
         RETURN FALSE
      END IF
   END FOREACH
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd005_qcbd006_result" order="10" ver="27" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[################################################################################
# 計算qcbd005,qcbd006的數量
################################################################################
PRIVATE FUNCTION aqct300_qcbd005_qcbd006_result(p_qcan013,p_qcan014)
DEFINE p_qcan013   LIKE qcan_t.qcan013
DEFINE p_qcan014   LIKE qcan_t.qcan014
DEFINE r_qcbd005   LIKE qcbd_t.qcbd005
DEFINE r_qcbd006   LIKE qcbd_t.qcbd006
DEFINE l_n         LIKE type_t.num5   
DEFINE l_qcaa004   LIKE qcaa_t.qcaa004
   IF p_qcan013 = '1' THEN
      IF g_qcba_m.qcba017 = 1 THEN
         LET r_qcbd005 = 0 LET r_qcbd006 = 1
      END IF
      
      LET l_n = 0 
      SELECT COUNT(1) INTO l_n FROM imae_t WHERE imaeent = g_enterprise 
         AND imaesite = g_site AND imae001 = g_qcba_m.qcba010
      IF l_n = 0 THEN
         LET r_qcbd005 = 0 LET r_qcbd006 = 0
      END IF  
      
      LET l_n = 0
      SELECT COUNT(1) INTO l_n FROM qcap_t WHERE qcapent = g_enterprise
         AND qcap001 = g_qcba_m.qcba010 AND qcap002 = g_qcba_m.qcba005
      IF l_n = 0 THEN
         LET r_qcbd005 = 0 LET r_qcbd006 = 0
      END IF
      
      IF g_qcba_m.imae116 = '1' THEN
         SELECT qcaa004 INTO l_qcaa004 FROM qcaa_t 
          WHERE qcaa003 = g_qcba_m.qcba019 AND (g_qcba_m.qcba017 BETWEEN qcaa001 AND qcaa002)
            AND qcaaent = g_enterprise #add by geza 20160905 #160905-00007#13
         IF l_n = 0 THEN
            LET r_qcbd005 = 0 LET r_qcbd006 = 0
         END IF
      END IF
      
      IF g_qcba_m.imae116 = '2' THEN
         SELECT qcab004 INTO l_qcaa004 FROM qcab_t 
          WHERE qcab003 = g_qcba_m.qcba019 AND (g_qcba_m.qcba017 BETWEEN qcab001 AND qcab002)
            AND qcabent = g_enterprise #add by geza 20160905 #160905-00007#13
         IF l_n = 0 THEN
            LET r_qcbd005 = 0 LET r_qcbd006 = 0
         END IF
      END IF
      
      IF g_qcba_m.imae116 MATCHES '[12]' AND NOT cl_null(l_qcaa004) THEN
         SELECT qcac005,qcac006 INTO r_qcbd005,r_qcbd006 FROM qcac_t
          WHERE qcacent = g_enterprise AND qcac001 = g_qcba_m.qcba018
            AND qcac002 = p_qcan014 AND qcac003 = l_qcaa004
      END IF
   END IF
   
   IF p_qcan013 MATCHES '[2357]' THEN    
      LET r_qcbd005 = 0   LET r_qcbd006 = 1
   END IF
   
   IF p_qcan013 = '6' THEN   #自定义公式
       SELECT qcah007 INTO r_qcbd005
        FROM qcah_t
       WHERE qcahent = g_enterprise
         AND (g_qcba_m.qcba017 BETWEEN qcah004 AND qcah005)
         AND qcah001 = g_qcaz.qcaz001
         AND qcah002 = p_qcan014
         AND qcah003 = g_qcba_m.qcba018
       IF cl_null(r_qcbd005) THEN LET r_qcbd005 = 0 END IF
#       LET r_qcbd006 = 1  #161115-00040#1 mark
       LET r_qcbd006 = r_qcbd005 + 1 #161115-00040#1 add
   END IF
   
   IF p_qcan013 = '4' THEN
      LET r_qcbd005 = 0  LET r_qcbd006 = 1
   END IF
   IF r_qcbd005 > g_qcba_m.qcba017 THEN
      LET r_qcbd005 = g_qcba_m.qcba017 - 1
   END IF
   
   IF r_qcbd006 > g_qcba_m.qcba017 THEN
      LET r_qcbd006 = g_qcba_m.qcba017
   END IF
   RETURN r_qcbd005,r_qcbd006
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd007_qcbd008_result" order="11" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[################################################################################
# 計算qcbd007，qcbd008的數值
################################################################################
PRIVATE FUNCTION aqct300_qcbd007_qcbd008_result(p_qcan013)
DEFINE p_qcan013   LIKE qcan_t.qcan013
DEFINE r_qcbd007   LIKE qcbd_t.qcbd007
DEFINE r_qcbd008   LIKE qcbd_t.qcbd008
DEFINE l_qcad002   LIKE qcad_t.qcad002

   IF p_qcan013 MATCHES '[123567]' THEN
      LET r_qcbd007 = ''  LET r_qcbd008 = ''
   END IF
   
   IF p_qcan013 = '4' THEN
      SELECT qcad002 INTO l_qcad002 FROM qcad_t WHERE qcadent = g_enterprise 
         AND qcad001 = g_qcba_m.qcba019 AND (g_qcba_m.qcba017 BETWEEN qcad003 AND qcad004) 
         
      SELECT qcae005,qcae006 INTO r_qcbd007,r_qcbd008 FROM qcae_t
       WHERE qcaeent = g_enterprise AND qcae001 = '4' AND qcae002 = g_qcba_m.qcba019
         AND qcae003 = l_qcad002
   END IF
   RETURN r_qcbd007,r_qcbd008
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd009_result" order="12" ver="10" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[################################################################################
# 計算qcad009的數值
################################################################################
PRIVATE FUNCTION aqct300_qcbd009_result(p_qcan013,p_qcan014)
DEFINE p_qcan013   LIKE qcan_t.qcan013
DEFINE l_qcac004   LIKE qcac_t.qcac004
DEFINE p_qcan014   LIKE qcan_t.qcan014
DEFINE p_qcan012   LIKE qcan_t.qcan012
DEFINE l_qcaa005   LIKE qcaa_t.qcaa005
DEFINE l_qcaa006   LIKE qcaa_t.qcaa006
DEFINE l_qcaa007   LIKE qcaa_t.qcaa007
DEFINE l_qcab005   LIKE qcab_t.qcab005
DEFINE l_qcab006   LIKE qcab_t.qcab006
DEFINE l_qcab007   LIKE qcab_t.qcab007
DEFINE r_qcbd009   LIKE qcbd_t.qcbd009
DEFINE l_qcad001   LIKE qcad_t.qcad001
DEFINE l_qcad002   LIKE qcad_t.qcad002
DEFINE l_qcac003   LIKE qcac_t.qcac003

   IF p_qcan013 = '1' THEN
     #160114-00018#1 mark(s)
#add by xujing 151203 start    #抓取抽樣數時，改直接抓取qcac007資料  
#      SELECT qcac007 INTO r_qcbd009 FROM qcac_t,qcaa_t
#       WHERE (g_qcba_m.qcba017 BETWEEN qcaa001 AND qcaa002)
#         AND qcac002 = p_qcan014
#         AND qcaa004 = qcac003
#         AND qcaa003 = g_qcba_m.qcba019	
#         AND qcac001 = g_qcba_m.qcba018
#         AND qcaaent = g_enterprise
#         AND qcaaent = qcacent
     #160114-00018#1 mark(e)
     #160114-00018#1 add(s)     
     CASE g_qcba_m.imae116 
        WHEN '1'
            SELECT DISTINCT qcaa004 INTO l_qcac003 FROM qcaa_t
             WHERE qcaaent = g_enterprise
               AND qcaa003 = g_qcba_m.qcba019
               AND (g_qcba_m.qcba017 BETWEEN qcaa001 AND qcaa002)
        WHEN '2'
             SELECT DISTINCT qcab004 INTO l_qcac003 FROM qcab_t
              WHERE qcabent = g_enterprise
                AND qcab003 = g_qcba_m.qcba019
                AND (g_qcba_m.qcba017 BETWEEN qcab001 AND qcab002)       
     END CASE
     
     IF g_qcba_m.imae116 MATCHES '[12]' THEN
        SELECT qcac007 INTO r_qcbd009 FROM qcac_t
          WHERE qcacent = g_enterprise
            AND qcac001 = g_qcba_m.qcba018
            AND qcac002 = p_qcan014
            AND qcac003 = l_qcac003
     END IF 
#mark by xujing 151203 start      
#      SELECT qcac004 INTO l_qcac004 FROM qcaa_t,qcac_t
#       WHERE (g_qcba_m.qcba017 BETWEEN qcaa001 AND qcaa002)
#         AND qcac002 = p_qcan014
#         AND qcaa004 = qcac003
#         AND qcaa003 = g_qcba_m.qcba019	
#         AND qcac001 = g_qcba_m.qcba018
#         AND qcaaent = g_enterprise
#         AND qcaaent = qcacent
#
##     IF p_qcan013 = '1' THEN
#      IF g_qcba_m.imae116 = '1' THEN
#         SELECT DISTINCT qcaa005,qcaa006,qcaa007 INTO l_qcaa005,l_qcaa006,l_qcaa007
#           FROM qcaa_t WHERE qcaaent = g_enterprise
##            AND (g_qcba_m.qcba017 BETWEEN qcaa001 AND qcaa002)
#            AND qcaa003 = g_qcba_m.qcba019
#            AND qcaa004 = l_qcac004
#            AND rownum = 1 ORDER BY qcaa004,qcaa003
#            
#         CASE g_qcba_m.qcba018
#            WHEN 'N' LET r_qcbd009 = l_qcaa005
#            WHEN 'T' LET r_qcbd009 = l_qcaa006
#            WHEN 'R' LET r_qcbd009 = l_qcaa007
#         END CASE
#      END IF
##     IF p_qcan013 = '2' THEN
#      IF g_qcba_m.imae116 = '2' THEN
#         SELECT DISTINCT qcab005,qcab006,qcab007 INTO l_qcab005,l_qcab006,l_qcab007
#           FROM qcab_t WHERE qcabent = g_enterprise
##           AND (g_qcba_m.qcba017 BETWEEN qcab001 AND qcab002)
#            AND qcab003 = g_qcba_m.qcba019
#            AND qcab004 = l_qcac004 
#            AND rownum = 1 ORDER BY qcab004,qcab003
#         CASE g_qcba_m.qcba018
#            WHEN 'N' LET r_qcbd009 = l_qcab005
#            WHEN 'T' LET r_qcbd009 = l_qcab006
#            WHEN 'R' LET r_qcbd009 = l_qcab007
#         END CASE
#      END IF
#mark by xujing 151203 end 
   END IF
 
   IF p_qcan013 = '2' THEN            #C=0 时抓 aqci007
      SELECT qcag005 INTO r_qcbd009
        FROM qcag_t
       WHERE qcagent = g_enterprise
         AND (g_qcba_m.qcba017 BETWEEN qcag001 AND qcag002)
         AND qcag003 = p_qcan014
         AND qcag004 = g_qcba_m.qcba019
      IF cl_null(r_qcbd009) THEN LET r_qcbd009 = 0 END IF
   END IF
 
   IF p_qcan013 MATCHES '[34]' THEN
      LET l_qcad001 = g_qcba_m.qcba019
      CASE g_qcba_m.qcba018 
         WHEN 'T' 
            #160217-00011#1 add str
              CASE g_qcba_m.qcba019 
                 WHEN '1'
                    LET l_qcad001 = '2'
                 WHEN '2'
                    LET l_qcad001 = '3'
                 WHEN '3'
                    LET l_qcad001 = '4'
                 WHEN '4'
                    LET l_qcad001 = '5'
                 WHEN '5'
                    LET l_qcad001 = '6'
                 WHEN '6'
                    LET l_qcad001 = '7'
                 WHEN '7'
                    LET l_qcad001 = 'T'
              END CASE
            #160217-00011#1 add end
#            IF (g_qcba_m.qcba019 + 1) = 8 THEN  #160217-00011#1 mark
#               LET l_qcad001 = 'T'              #160217-00011#1 mark
#            END IF                              #160217-00011#1 mark
         WHEN 'R'  
#            IF (g_qcba_m.qcba019 - 1) = 0 THEN  #160217-00011#1 mark
#               LET l_qcad001 = 'R'              #160217-00011#1 mark
#            END IF                              #160217-00011#1 mark
            #160217-00011#1 add str
              CASE g_qcba_m.qcba019 
                 WHEN '1'
                    LET l_qcad001 = 'R'
                 WHEN '2'
                    LET l_qcad001 = '1'
                 WHEN '3'
                    LET l_qcad001 = '2'
                 WHEN '4'
                    LET l_qcad001 = '3'
                 WHEN '5'
                    LET l_qcad001 = '4'
                 WHEN '6'
                    LET l_qcad001 = '5'
                 WHEN '7'
                    LET l_qcad001 = '6'
              END CASE
            #160217-00011#1 add end
      END CASE
      
      SELECT qcad002 INTO l_qcad002 FROM qcad_t
       WHERE qcadent = g_enterprise
         AND (g_qcba_m.qcba017 BETWEEN qcad003 AND qcad004)
         AND qcad001 = l_qcad001
         
      SELECT qcae004 INTO r_qcbd009 FROM qcae_t
       WHERE qcaeent = g_enterprise
         AND qcae001 = p_qcan013
         AND qcae002 = g_qcba_m.qcba019
         AND qcae003 = l_qcad002
   END IF
   
   IF p_qcan013 = '5' THEN #百分比
      LET r_qcbd009 = g_qcba_m.qcba017 * (p_qcan014 * 0.01)
   END IF
   
   IF p_qcan013 = '6' THEN  #自定義公式
      SELECT qcah006 INTO r_qcbd009
        FROM qcah_t
       WHERE qcahent = g_enterprise
         AND (g_qcba_m.qcba017 BETWEEN qcah004 AND qcah005)
         AND qcah001 = g_qcaz.qcaz001
         AND qcah002 = p_qcan014
         AND qcah003 = g_qcba_m.qcba018
   END IF
   
   IF p_qcan013 = '7' THEN
      LET r_qcbd009 = g_qcba_m.qcba017
   END IF
   IF r_qcbd009 > g_qcba_m.qcba017 THEN
      LET r_qcbd009 = g_qcba_m.qcba017
   END IF
   RETURN r_qcbd009
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd001_desc" order="13" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbd001_desc(p_qcbd001)
DEFINE p_qcbd001    LIKE qcbd_t.qcbd001 

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcbd001
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='1051' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcbd_d[l_ac].qcbd001_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcbd_d[l_ac].qcbd001_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd001_2_desc" order="14" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbd001_2_desc(p_qcbd001)
DEFINE p_qcbd001    LIKE qcbd_t.qcbd001 

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcbd001
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='1051' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   #LET g_qcbd6_d[l_ac].qcbd001_2_desc = '', g_rtn_fields[1] , '' #160607-00004#1 mark
   #DISPLAY BY NAME g_qcbd6_d[l_ac].qcbd001_2_desc                #160607-00004#1 mark
   LET g_qcbd99_d[l_ac].qcbd001_2_desc = '', g_rtn_fields[1] , '' #160607-00004#1 add
   DISPLAY BY NAME g_qcbd99_d[l_ac].qcbd001_2_desc                #160607-00004#1 add
END FUNCTION]]>
</point>
  <point name="function.aqct300_detail99_idx_chk" order="15" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#PRIVATE FUNCTION aqct300_detail6_idx_chk()
PRIVATE FUNCTION aqct300_detail99_idx_chk()
   #160607-00004#1 --s mark 
   #IF g_current_page = 6 THEN
      #LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail6") 
      #IF g_detail_idx > g_qcbd6_d.getLength() THEN  
      #   LET g_detail_idx = g_qcbd6_d.getLength()   
   #160607-00004#1 --e mark 
   #160607-00004#1 --s add
   IF g_current_page = 99 THEN 
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail99") 
      IF g_detail_idx > g_qcbd99_d.getLength() THEN 
         LET g_detail_idx = g_qcbd99_d.getLength()  
   #160607-00004#1 --e add
      END IF
      #IF g_detail_idx = 0 AND g_qcbd6_d.getLength() <> 0 THEN #160607-00004#1 mark
      IF g_detail_idx = 0 AND g_qcbd99_d.getLength() <> 0 THEN #160607-00004#1 add
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      #DISPLAY g_qcbd6_d.getLength() TO FORMONLY.cnt #160607-00004#1 mark
      DISPLAY g_qcbd99_d.getLength() TO FORMONLY.cnt #160607-00004#1 add
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbe_ref" order="16" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#抓去qcbd_t资料显示
PRIVATE FUNCTION aqct300_qcbe_ref(p_qcbeseq)
DEFINE p_qcbeseq     LIKE qcbe_t.qcbeseq
#   SELECT qcbd001,qcbd002 INTO g_qcbd2_d[l_ac].qcbd001,g_qcbd2_d[l_ac].qcbd002 FROM qcbd_t
#    WHERE qcbdent = g_enterprise 
#      AND qcbddocno = g_qcba_m.qcbadocno
#      AND qcbdseq = p_qcbeseq  
#   DISPLAY BY NAME g_qcbd2_d[l_ac].qcbd001,g_qcbd2_d[l_ac].qcbd002      
#   CALL aqct300_qcbd001_1_desc(g_qcbd2_d[l_ac].qcbd001)     
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd001_1_desc" order="17" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbd001_1_desc(p_qcbd001)
DEFINE p_qcbd001    LIKE qcbd_t.qcbd001 

#   INITIALIZE g_ref_fields TO NULL
#   LET g_ref_fields[1] = p_qcbd001
#   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='1051' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
#   LET g_qcbd2_d[l_ac].qcbd001_1_desc = '', g_rtn_fields[1] , ''
#   DISPLAY BY NAME g_qcbd2_d[l_ac].qcbd001_1_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbe001_desc" order="18" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbe001_desc(p_qcbe001)
DEFINE p_qcbe001    LIKE qcbe_t.qcbe001

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcbe001
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='1053' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcbd2_d[l_ac].qcbe001_desc = '', g_rtn_fields[1] , '' 
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbe002_chk" order="19" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbe002_chk()
DEFINE   l_sum    LIKE qcbd_t.qcbd010
    IF NOT cl_null(g_qcbd_d[l_ac].qcbdseq) AND NOT cl_null(g_qcbd2_d[l_ac].qcbe002) THEN
       LET l_sum = 0 
       SELECT SUM(qcbd010) INTO l_sum FROM qcbd_t
        WHERE qcbdent = g_enterprise 
          AND qcbddocno = g_qcba_m.qcbadocno
          AND qcbdseq = g_qcbd_d[l_ac].qcbdseq
       IF g_qcbd2_d[l_ac].qcbe002 > l_sum THEN
          INITIALIZE g_errparam TO NULL
          LET g_errparam.code = 'aqc-00035'
          LET g_errparam.extend = g_qcbd2_d[l_ac].qcbe002||" > "|| l_sum
          LET g_errparam.popup = TRUE
          CALL cl_err()

          RETURN FALSE
       END IF
    END IF
    RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc001_scc" order="20" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc001_scc()
DEFINE l_n        LIKE type_t.num5
DEFINE l_ooab002  LIKE ooab_t.ooab002
   
#   SELECT ooab002 INTO l_ooab002 FROM ooab_t 
#    WHERE ooabent = g_enterprise AND ooabsite = g_site
#      AND ooab001 = 'S-MFG-0002'
#
#   IF l_ooab002 = '2' THEN
#      CALL cl_set_combo_scc_part('qcbc001','1002','1')
#   END IF
#   
#   LET l_n = 0
#   SELECT COUNT(1) INTO l_n FROM bmab_t 
#    WHERE bmabent = g_enterprise
#      AND bmabsite = g_site
#      AND bmab003 = g_qcba_m.qcba010
#   IF l_n = 0 THEN
#      CALL cl_set_combo_scc_part('qcbc001','1002','0')
#   END IF
   IF NOT s_aqct300_joint_chk(g_qcba_m.qcbadocno) THEN
      CALL cl_set_combo_scc_part('qcbc001','1002','0')
   ELSE
      CALL cl_set_combo_scc('qcbc001','1002') 
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc002_desc" order="21" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc002_desc(p_qcbc002)
DEFINE p_qcbc002     LIKE qcbc_t.qcbc002
DEFINE l_qcao001     LIKE qcao_t.qcao001   
DEFINE l_slip        STRING
DEFINE l_success     LIKE type_t.num5
   LET l_qcao001 = g_qcaz001
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcbc002
   CALL ap_ref_array2(g_ref_fields,"SELECT qcaol004 FROM qcaol_t WHERE qcaolent='"||g_enterprise||"' AND qcaol001='"||l_qcao001||"' AND qcaol002=? AND qcaol003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcbd5_d[l_ac].qcbc002_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc002_desc
   
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc005_desc" order="22" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc005_desc(p_qcbc005)
DEFINE p_qcbc005   LIKE qcbc_t.qcbc005
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = p_qcbc005
      CALL ap_ref_array2(g_ref_fields,"SELECT inayl003 FROM inayl_t WHERE inaylent='"||g_enterprise||"' AND inayl001=? AND inayl002 = '"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_qcbd5_d[l_ac].qcbc005_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc005_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc006_desc" order="23" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc006_desc(p_qcbc006)
DEFINE p_qcbc006    LIKE qcbc_t.qcbc006
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_qcba_m.qcbasite
   LET g_ref_fields[2] = g_qcbd5_d[l_ac].qcbc005
   LET g_ref_fields[3] = p_qcbc006
   CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inabsite=? AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
   LET g_qcbd5_d[l_ac].qcbc006_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc006_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc008_desc" order="24" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc008_desc(p_qcbc008)
DEFINE p_qcbc008   LIKE qcbc_t.qcbc008
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcbc008
   CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcbd5_d[l_ac].qcbc008_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc008_desc

END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc009_chk" order="25" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc009_chk(p_qcbc009)
DEFINE p_qcbc009   LIKE qcbc_t.qcbc009
   IF p_qcbc009 > g_qcba_m.qcba017 THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'aqc-00037'
      LET g_errparam.extend = p_qcbc009 ||">"|| g_qcba_m.qcba017
      LET g_errparam.popup = TRUE
      CALL cl_err()

      RETURN FALSE
   END IF
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc009_Compare" order="26" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc009_Compare()
DEFINE l_success       LIKE type_t.num5
DEFINE l_rate          LIKE type_t.num20_6
DEFINE l_rate_qcbc009  LIKE qcbc_t.qcbc009
    IF NOT cl_null(g_qcbd5_d[l_ac].qcbc008) AND NOT cl_null(g_qcbd5_d[l_ac].qcbc009) THEN
       IF g_qcbd5_d[l_ac].qcbc008 != g_qcba_m.qcba016 THEN
          CALL s_aimi190_get_convert(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc008,g_qcba_m.qcba016) RETURNING l_success,l_rate
          IF l_success  THEN
             LET l_rate_qcbc009 = g_qcbd5_d[l_ac].qcbc009 * l_rate
             IF NOT aqct300_qcbc009_chk(l_rate_qcbc009) THEN
                RETURN FALSE
             END IF
          ELSE
             RETURN FALSE
          END IF
       END IF
    END IF
    RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_qc_values" order="27" ver="39" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[################################################################################
#根據來源單號+項次帶出畫面資料
################################################################################
PRIVATE FUNCTION aqct300_get_qc_values()
DEFINE  l_sql    STRING
#DEFINE l_indc    RECORD LIKE indc_t.* #161124-00048#10 mark
#161124-00048#10 add(s)
DEFINE l_indc RECORD  #調撥單單頭檔
       indcent LIKE indc_t.indcent, #企业编号
       indcsite LIKE indc_t.indcsite, #营运据点
       indcunit LIKE indc_t.indcunit, #应用组织
       indcdocno LIKE indc_t.indcdocno, #调拨单号
       indcdocdt LIKE indc_t.indcdocdt, #调拨日期
       indc000 LIKE indc_t.indc000, #单据性质
       indc001 LIKE indc_t.indc001, #对应调拨单号
       indc002 LIKE indc_t.indc002, #来源类别
       indc003 LIKE indc_t.indc003, #来源单号
       indc004 LIKE indc_t.indc004, #调拨人员
       indc005 LIKE indc_t.indc005, #拨出营运据点
       indc006 LIKE indc_t.indc006, #拨入营运据点
       indc007 LIKE indc_t.indc007, #在途仓
       indc008 LIKE indc_t.indc008, #备注
       indc021 LIKE indc_t.indc021, #拨出审核人员
       indc022 LIKE indc_t.indc022, #拨出审核日期
       indc023 LIKE indc_t.indc023, #拨入审核人员
       indc024 LIKE indc_t.indc024, #拨入审核日期
       indcstus LIKE indc_t.indcstus, #状态码
       indcownid LIKE indc_t.indcownid, #资料所有者
       indcowndp LIKE indc_t.indcowndp, #资料所有部门
       indccrtid LIKE indc_t.indccrtid, #资料录入者
       indccrtdp LIKE indc_t.indccrtdp, #资料录入部门
       indccrtdt LIKE indc_t.indccrtdt, #资料创建日
       indcmodid LIKE indc_t.indcmodid, #资料更改者
       indcmoddt LIKE indc_t.indcmoddt, #最近更改日
       indccnfid LIKE indc_t.indccnfid, #资料审核者
       indccnfdt LIKE indc_t.indccnfdt, #数据审核日
       indcpstid LIKE indc_t.indcpstid, #资料过账者
       indcpstdt LIKE indc_t.indcpstdt, #资料过账日
       indc101 LIKE indc_t.indc101, #调拨部门
       indc102 LIKE indc_t.indc102, #检验方式
       indc103 LIKE indc_t.indc103, #包装单制作
       indc104 LIKE indc_t.indc104, #Invoice制作
       indc105 LIKE indc_t.indc105, #送货地址
       indc106 LIKE indc_t.indc106, #运输方式
       indc107 LIKE indc_t.indc107, #起运地点
       indc108 LIKE indc_t.indc108, #到达地点
       indc109 LIKE indc_t.indc109, #在途非成本库位
       indc151 LIKE indc_t.indc151, #调拨理由
       indc199 LIKE indc_t.indc199, #调拨性质
       indc009 LIKE indc_t.indc009, #单一单位库存单位变更
       indc200 LIKE indc_t.indc200, #拨出仓库
       indc201 LIKE indc_t.indc201, #拨入仓库
       indc010 LIKE indc_t.indc010, #调整单号
       indc202 LIKE indc_t.indc202, #操作类型
       indc025 LIKE indc_t.indc025, #前端单号
       indc026 LIKE indc_t.indc026  #前端类型
END RECORD
#161124-00048#10 add(e)
DEFINE l_sfcb012 LIKE sfcb_t.sfcb012  #160107-00005#1 add
   
   #160324-00033#1---s
   #160517-00013#1---s
   #IF cl_null(g_qcba_m.qcba001) OR cl_null(g_qcba_m.qcba002) THEN
   #   RETURN
   #END IF
   IF cl_null(g_qcba_m.qcba001) THEN
      RETURN
   END IF
   #IF (NOT (g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '6')) AND cl_null(g_qcba_m.qcba002) THEN  #161103-00007#3
   IF (NOT ((g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '6') OR g_qcba_m.qcba000 = '3')) AND cl_null(g_qcba_m.qcba002) THEN  #161103-00007#3
      RETURN
   END IF
   
   #161103-00007#3---s
   ##160324-00033#1---e
   #IF g_qcba_m.qcba000 = '3' AND cl_null(g_qcba_m.qcba029) THEN
   #   RETURN
   #END IF
   ##160517-00013#1---e
   #161103-00007#3---e
   
   CASE WHEN g_qcba_m.qcba000 = '1'
            LET l_sql = "SELECT pmdt001,pmdt002,pmds007,pmdt020,pmdt019,pmdt006,pmdt007 FROM pmds_t,pmdt_t ",
                        " WHERE pmdtent = ",g_enterprise," AND pmdtdocno = '",g_qcba_m.qcba001,"'",
                        "   AND pmdtseq = ",g_qcba_m.qcba002," AND pmdtent = pmdsent AND pmdtdocno = pmdsdocno"  
                        
        WHEN g_qcba_m.qcba000 = '2'
#            LET l_sql = "SELECT sfeb001,1,sfaa009,sfeb008,sfeb010,sfeb004,sfeb005 FROM sfeb_t ",
             LET l_sql = "SELECT sfeb001,1,sfaa009,sfeb008,sfeb007,sfeb004,sfeb005 FROM sfeb_t ",
                        " LEFT JOIN sfaa_t ON sfaadocno = sfeb001 AND sfaaent = ",g_enterprise,
                        " WHERE sfebent = ",g_enterprise,
                        "   AND sfebdocno = '",g_qcba_m.qcba001,"'",
                        "   AND sfebseq = ",g_qcba_m.qcba002
        WHEN g_qcba_m.qcba000 = '3'
             #LET l_sql = "SELECT sfaa006,'',sfaa009,sfcb050,sfcb052,sfaa010,sfaa011 FROM sfcb_t ",  #160411-00004#1 mark
             #LET l_sql = "SELECT sfaa006,'',sfaa009,sfcb050,sfcb052,sfaa010,'' FROM sfcb_t ",  #160411-00004#1 add  #161103-00007#3
              LET l_sql = "SELECT sfaadocno,'',sfaa009,sffb017,sffb016,sfaa010,'' FROM sffb_t ",  #161103-00007#3
                         " LEFT OUTER JOIN sfaa_t ON sfaaent = sffbent AND sfaadocno = sffb005 ",
#                         " LEFT OUTER JOIN sffb_t ON sffbent = sfcbent AND sffb005 = sfcbdocno AND sffb006 = sfcb001 AND sffb007 = sfcb003 AND sffb008 = sfcb004",
                         #" WHERE sfcbent = ",g_enterprise,            #161103-00007#3
                         #"   AND sfcbdocno = '",g_qcba_m.qcba001,"'"   #161103-00007#3
                         " WHERE sffbent = ",g_enterprise,            #161103-00007#3
                         "   AND sffbdocno = '",g_qcba_m.qcba001,"'",   #161103-00007#3
                         #"   AND sfcb002 = ",g_qcba_m.qcba002,   #161103-00007#3
                         #"   AND sfcb001 = ",g_qcba_m.qcba029    #161103-00007#3
                         "    AND sffbseq = ",g_qcba_m.qcba002    #170110-00056#1 add
        WHEN g_qcba_m.qcba000 MATCHES '[46]'
             IF g_qcba_m.qcba000 = '4' THEN
                IF g_qcba_m.qcba031 = '1' THEN
                   LET l_sql = "SELECT xmdh001,xmdh002,xmdg005,xmdh016,xmdh015,xmdh006,xmdh007 FROM xmdg_t,xmdh_t",
                               " WHERE xmdhent = ",g_enterprise," AND xmdhdocno = '",g_qcba_m.qcba001,"'",
                               "   AND xmdhseq = ",g_qcba_m.qcba002," AND xmdhent = xmdgent AND xmdhdocno = xmdgdocno"
                ELSE
                   LET l_sql = "SELECT xmdl001,xmdl002,xmdk007,xmdl018,xmdl017,xmdl008,xmdl009 FROM xmdk_t,xmdl_t ",  
                               " WHERE xmdlent = ",g_enterprise," AND xmdldocno = '",g_qcba_m.qcba001,"'",
                               "   AND xmdlseq = ",g_qcba_m.qcba002," AND xmdlent = xmdkent AND xmdldocno = xmdkdocno"
                END IF
             END IF
             
             #160128-00017#1 add(s)
             IF g_qcba_m.qcba000 = '6' THEN   
                LET l_sql = "SELECT xmdl001,xmdl002,xmdk007,xmdl092,xmdl017,xmdl008,xmdl009 FROM xmdk_t,xmdl_t ",  #160531-00017#1   #170213-00006#1
                #LET l_sql = "SELECT xmdl001,xmdl002,xmdk007,xmdl081,xmdl017,xmdl008,xmdl009 FROM xmdk_t,xmdl_t ",  #160531-00017#1    #170213-00006#1---mark
                               " WHERE xmdlent = ",g_enterprise," AND xmdldocno = '",g_qcba_m.qcba001,"'",
                               "   AND xmdlseq = ",g_qcba_m.qcba002," AND xmdlent = xmdkent AND xmdldocno = xmdkdocno"
             END IF
             #160128-00017#1 add(e)
        WHEN g_qcba_m.qcba000='5'
           CASE WHEN g_qcba_m.qcba031 MATCHES '[12]'
                    LET l_sql = "SELECT '','','',inbb011,inbb010,inbb001,inbb002 FROM inbb_t ",
                                " WHERE inbbent = ",g_enterprise," AND inbbdocno = '",g_qcba_m.qcba001,"'",
                                "   AND inbbseq = ",g_qcba_m.qcba002
                                
                WHEN g_qcba_m.qcba031 MATCHES '[34]'
#                    SELECT * INTO l_indc.* FROM indc_t #161124-00048#10 mark
                     #161124-00048#10 add(s)
                     SELECT indcent,indcsite,indcunit,indcdocno,indcdocdt,indc000,indc001,
                            indc002,indc003,indc004,indc005,indc006,indc007,indc008,indc021,
                            indc022,indc023,indc024,indcstus,indcownid,indcowndp,indccrtid,
                            indccrtdp,indccrtdt,indcmodid,indcmoddt,indccnfid,indccnfdt,indcpstid,
                            indcpstdt,indc101,indc102,indc103,indc104,indc105,indc106,indc107,
                            indc108,indc109,indc151,indc199,indc009,indc200,indc201,indc010,indc202,
                            indc025,indc026 
                       INTO l_indc.* FROM indc_t
                    #161124-00048#10 add(e)
                     WHERE indcent = g_enterprise AND indcdocno = g_qcba_m.qcba001
                    IF (l_indc.indc000 = '1' OR l_indc.indc000 = '2') AND l_indc.indc102 = '2' THEN
                       LET l_sql = "SELECT indd101,indd001,'',indd103,indd006,indd002,indd004 FROM indd_t ",
                                   " WHERE inddent = ",g_enterprise," AND indddocno = '",g_qcba_m.qcba001,"'",
                                   "   AND inddseq = ",g_qcba_m.qcba002
                    END IF
                    
                    IF l_indc.indc000 = '3' AND l_indc.indc102 = '3' THEN
                        LET l_sql = "SELECT indd101,indd001,'',indd107,indd041,indd002,indd004 FROM indd_t ",
                                   " WHERE inddent = ",g_enterprise," AND indddocno = '",g_qcba_m.qcba001,"'",
                                   "   AND inddseq = ",g_qcba_m.qcba002
                    END IF
                WHEN g_qcba_m.qcba031 = '5'
                
                    LET l_sql = "SELECT '','','',inbj009,inbj008,inbj001,inbj002 FROM inbj_t ",
                                " WHERE inbjent = ",g_enterprise," AND inbjdocno = '",g_qcba_m.qcba001,"'",
                                "   AND inbjseq = ",g_qcba_m.qcba002
               
                #160324-00033#1---s
                WHEN g_qcba_m.qcba031 = '6'
                    LET l_sql = "SELECT '','',qcbn009,qcbn011,qcbn010,qcbn003,qcbn004 FROM qcbn_t ",
                                " WHERE qcbnent = ",g_enterprise," AND qcbndocno = '",g_qcba_m.qcba001,"'"
                #160324-00033#1---e  
                #161024-00041#1 --(S)--
                WHEN g_qcba_m.qcba031 = '7'
                    LET l_sql = "SELECT xmdl001,xmdl002,xmdk007,xmdl018,xmdl017,xmdl008,xmdl009 FROM xmdk_t,xmdl_t ",  
                               " WHERE xmdlent = ",g_enterprise," AND xmdldocno = '",g_qcba_m.qcba001,"'",
                               "   AND xmdlseq = ",g_qcba_m.qcba002," AND xmdlent = xmdkent AND xmdldocno = xmdkdocno"
                #161024-00041#1 --(E)--
           END CASE  
                 
   END CASE
   
   PREPARE get_values_pre FROM l_sql
   EXECUTE get_values_pre INTO g_qcba_m.qcba003,g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba010,g_qcba_m.qcba012
   #160107-00005#1 add(s)
   IF g_qcba_m.qcba000 = '3' THEN
      SELECT sfcb012 INTO l_sfcb012 FROM sfcb_t
       WHERE sfcbent = g_enterprise AND sfcbdocno = g_qcba_m.qcba001 
         AND sfcb001 = g_qcba_m.qcba029 AND sfcb002 = g_qcba_m.qcba002
      IF NOT cl_null(l_sfcb012) AND l_sfcb012 = 'Y' THEN
         SELECT SUM(sfeb008) INTO g_qcba_m.qcba008 FROM sfeb_t
          WHERE sfebent = g_enterprise AND sfeb001 = g_qcba_m.qcba001
            AND sfeb026 = g_qcba_m.qcba029 AND sfebsite = g_site
      END IF
      
      #161103-00007#3---s
      SELECT sffb006,sffb007,sffb008 INTO g_qcba_m.qcba029,g_qcba_m.qcba006,g_qcba_m.qcba007 
        FROM sffb_t WHERE sfFbent = g_enterprise AND sfFbdocno = g_qcba_m.qcba001
         AND sffbseq = g_qcba_m.qcba002 #170110-00056#1 add
      DISPLAY BY NAME g_qcba_m.qcba029,g_qcba_m.qcba006,g_qcba_m.qcba007
      #161103-00007#3--e
      
   END IF
   #161014-00048#1 add---start---
   SELECT imae112 INTO g_qcba_m.qcba024
     FROM imae_t
    WHERE imaeent = g_enterprise
      AND imaesite = g_qcba_m.qcbasite
      AND imae001 = g_qcba_m.qcba010
   IF cl_null(g_qcba_m.qcba024) THEN
      LET g_qcba_m.qcba024 = g_user
   END IF
   #161014-00048#1 add---end---
   #160107-00005#1 add(e)
#   IF SQLCA.SQLCODE THEN
#      INITIALIZE g_errparam TO NULL
#      LET g_errparam.code = SQLCA.SQLCODE
#      LET g_errparam.extend = ''
#      LET g_errparam.popup = TRUE
#      CALL cl_err()
#   END IF
#   IF g_qcba_m.qcba000='2' THEN
#      SELECT sfeb001 INTO g_qcba_m.qcba003 FROM sfeb_t 
#        WHERE sfebent = g_enterprise
#          AND sfebdocno = g_qcba_m.qcba001
#           AND sfebseq = g_qcba_m.qcba002
#   END IF
   IF cl_null(g_qcba_m.qcba012) THEN
      LET g_qcba_m.qcba012 = ' '
   END IF
   
   #160324-00033#1---s
   IF g_qcba_m.qcba000='5' AND g_qcba_m.qcba031 = '6' THEN
      SELECT qcbn012 INTO g_qcba_m.qcba021 FROM qcbn_t WHERE qcbnent = g_enterprise AND qcbndocno = g_qcba_m.qcba001
      DISPLAY BY NAME g_qcba_m.qcba021
   END IF
   #160324-00033#1---e      
                
   CALL s_feature_description(g_qcba_m.qcba010,g_qcba_m.qcba012) RETURNING g_success,g_qcba_m.qcba012_desc
   DISPLAY BY NAME g_qcba_m.qcba003,g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba012_desc
   CALL aqct300_formonly_desc()
   CALL aqct300_qcba001_ref()
   CALL aqct300_page_visible()
#  LET g_qcba_m_o.* = g_qcba_m.*
END FUNCTION]]>
</point>
  <point name="function.aqct300_formonly_desc" order="28" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_formonly_desc()
   CALL aqct300_qcba005_desc(g_qcba_m.qcba005)
   CALL aqct300_qcba009_desc(g_qcba_m.qcba009)
   CALL aqct300_qcba013_desc()
   
   SELECT imaal003,imaal004 INTO g_qcba_m.imaal003,g_qcba_m.imaal004
     FROM imaa_t LEFT OUTER JOIN imaal_t ON imaalent = imaaent AND imaal001 = imaa001 AND imaal002 = g_dlang                
    WHERE imaaent = g_enterprise AND imaa001 = g_qcba_m.qcba010   
    
#   SELECT imae116 INTO g_qcba_m.imae116
#     FROM imae_t 
#    WHERE imaesite = g_qcba_m.qcbasite AND imaeent = g_enterprise AND imae001 = g_qcba_m.qcba010 
   SELECT qcap008 INTO g_qcba_m.imae116 FROM qcap_t
       WHERE qcapent = g_enterprise AND qcapsite = g_qcba_m.qcbasite
        AND qcap001 = g_qcba_m.qcba010 AND qcap002 = g_qcba_m.qcba005
         AND qcap003 = 'ALL' AND qcap004 = 0
         AND qcap005 = 'ALL'
   IF cl_null(g_qcba_m.imae116) THEN
      SELECT imae116 INTO g_qcba_m.imae116 FROM imae_t 
       WHERE imaesite = g_qcba_m.qcbasite AND imaeent = g_enterprise AND imae001 = g_qcba_m.qcba010 
   END IF 
   CALL aqct300_qcba019_scc()
   
   DISPLAY BY NAME g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.imae116
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba009_desc" order="29" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba009_desc(p_qcba009)
DEFINE p_qcba009  LIKE qcba_t.qcba009
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_qcba009
   CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcba_m.qcba009_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcba_m.qcba009_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba001_chk" order="30" ver="41" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba001_chk()
DEFINE l_n   LIKE type_t.num5
#170216-00008#1 add(s)
DEFINE l_success LIKE type_t.num5
DEFINE l_slip    STRING
DEFINE l_para    LIKE type_t.chr1
#170216-00008#1 add(e)
   INITIALIZE g_chkparam.* TO NULL
   LET g_chkparam.arg1 = g_qcba_m.qcba001
   CASE 
      WHEN g_qcba_m.qcba000 = '1'
         #160318-00025#21  by 07900 --add-str
         LET g_errshow = TRUE #是否開窗                   
         LET g_chkparam.err_str[1] ="aqc-00048:sub-01302|apmt520|",cl_get_progname("apmt520",g_lang,"2"),"|:EXEPROGapmt520"
        #160318-00025#21  by 07900 --add-end
         IF NOT cl_chk_exist("v_pmdsdocno_7") THEN
            RETURN FALSE
         END IF
         
      WHEN g_qcba_m.qcba000 = '2'
         IF NOT cl_chk_exist("v_sfeadocno") THEN
            RETURN FALSE
         END IF
      WHEN g_qcba_m.qcba000 = '3'
         #IF NOT cl_chk_exist("v_sfcadocno") THEN  #161103-00007#3
         LET g_chkparam.where = " sffb001 = '3' AND sffb005 IN (SELECT sfcbdocno FROM sfcb_t WHERE sfcbent = ",g_enterprise," AND sfcbsite = '",g_site,"' AND sfcb017 = 'Y') "   #161103-00007#3
         IF NOT cl_chk_exist("v_sffbdocno_1") THEN   #161103-00007#3
            RETURN FALSE
         END IF
      WHEN g_qcba_m.qcba000 = '4'
         IF g_qcba_m.qcba031 = '2' THEN
            IF NOT cl_chk_exist("v_xmdkdocno_4") THEN
               RETURN FALSE
            END IF
         ELSE
            #160318-00025#21  by 07900 --add-str
            LET g_errshow = TRUE #是否開窗                   
            LET g_chkparam.err_str[1] ="axm-00044:sub-01302"
            #160318-00025#21  by 07900 --add-end 
            IF NOT cl_chk_exist("v_xmdgdocno") THEN
               RETURN FALSE
            END IF
         END IF
      WHEN g_qcba_m.qcba000 = '5'
         CASE g_qcba_m.qcba031
            WHEN '1'
              #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aqc-00074:sub-01318|aint301|",cl_get_progname("aint301",g_lang,"2"),"|:EXEPROGaint301"
               #160318-00025#21  by 07900 --add-end 
               IF NOT cl_chk_exist("v_inbadocno_5") THEN
                  RETURN FALSE
               END IF
            WHEN '2'
               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aqc-00045:sub-01318|aint302|",cl_get_progname("aint302",g_lang,"2"),"|:EXEPROGaint302"
               #160318-00025#21  by 07900 --add-end 
               IF NOT cl_chk_exist("v_inbadocno") THEN
                  RETURN FALSE
               END IF
            WHEN '3'
               IF NOT cl_chk_exist("v_indcdocno_1") THEN
                  RETURN FALSE
               END IF
            WHEN '4'
               IF NOT cl_chk_exist("v_indcdocno_2") THEN
                  RETURN FALSE
               END IF
            WHEN '5'
               IF NOT cl_chk_exist("v_inbidocno_1") THEN
                  RETURN FALSE
               END IF
            #160324-00033#1---s
            WHEN '6'
               IF NOT cl_chk_exist("v_qcbndocno") THEN
                  RETURN FALSE
               END IF
            #160324-00033#1---e
            #161024-00041#1---s
            WHEN '7'
               IF NOT cl_chk_exist("v_xmdkdocno_10") THEN
                  RETURN FALSE
               END IF
            #161024-00041#1---e         
         END CASE
      WHEN g_qcba_m.qcba000 = '6'
           #170216-00008#1 add(s)
           CALL s_aooi200_get_slip(g_qcba_m.qcba001) RETURNING l_success,l_slip
           IF NOT l_success THEN
              RETURN FALSE
           END IF
           CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-BAS-0091') RETURNING l_para
           IF l_para = 'N' OR cl_null(l_para) THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'aqc-00145'
              LET g_errparam.extend = l_para
              LET g_errparam.popup = TRUE
              CALL cl_err()
              
              RETURN FALSE
           END IF
           #170216-00008#1 add(e)
           #IF NOT cl_chk_exist("v_xmdkdocno_5") THEN  #160531-00017#1
           #IF NOT cl_chk_exist("v_xmdkdocno_8") THEN  #160531-00017#1   #170213-00006#1---mark
           IF NOT cl_chk_exist("v_xmdkdocno_5") THEN   #170213-00006#1---add
              RETURN FALSE
           END IF
   END CASE
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba002_chk" order="31" ver="39" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba002_chk()
   INITIALIZE g_chkparam.* TO NULL
   LET g_chkparam.arg1 = g_qcba_m.qcba001
   LET g_chkparam.arg2 = g_qcba_m.qcba002

   CASE 
      WHEN g_qcba_m.qcba000 = '1'
         #160318-00025#21  by 07900 --add-str
         LET g_errshow = TRUE #是否開窗                   
         LET g_chkparam.err_str[1] ="aqc-00048:sub-01302|apmt520|",cl_get_progname("apmt520",g_lang,"2"),"|:EXEPROGapmt520"
        #160318-00025#21  by 07900 --add-end
         IF NOT cl_chk_exist("v_pmdsdocno_pmdtseq") THEN
            RETURN FALSE
         END IF
         
      WHEN g_qcba_m.qcba000 = '2'
         IF NOT cl_chk_exist("v_sfebdocno_sfebseq") THEN
            RETURN FALSE
         END IF
      WHEN g_qcba_m.qcba000 = '3'
          #170110-00056#1 mark(s)
#         IF NOT cl_chk_exist("v_sfcbdocno_5") THEN
#            RETURN FALSE
#         END IF
          #170110-00056#1 mark(e)
          #170110-00056#1 add(s)
          IF NOT cl_chk_exist("v_sffbdocno_sffbseq") THEN
             RETURN FALSE
          END IF
          #170110-00056#1 add(e)
      WHEN g_qcba_m.qcba000 = '4'
         IF g_qcba_m.qcba031 = '2' THEN
            #160318-00025#21  by 07900 --add-str
            LET g_errshow = TRUE #是否開窗                   
            LET g_chkparam.err_str[1] ="axm-00208:sub-01306|axmt540|",cl_get_progname("axmt540",g_lang,"2"),"|:EXEPROGaxmt540"
            #160318-00025#21  by 07900 --add-end 
            #IF NOT cl_chk_exist("v_xmdlseq_2") THEN   #160808-00035#1 mark
            IF NOT cl_chk_exist("v_xmdlseq_4") THEN   #160808-00035#1 add
              RETURN FALSE
            END IF
         ELSE
            #160318-00025#21  by 07900 --add-str
            LET g_errshow = TRUE #是否開窗                   
            LET g_chkparam.err_str[1] ="axm-00070:sub-01302|axmt520|",cl_get_progname("axmt520",g_lang,"2"),"|:EXEPROGaxmt520"
            #160318-00025#21  by 07900 --add-end
            IF NOT cl_chk_exist("v_xmdhseq_2") THEN
              RETURN FALSE
            END IF
         END IF
         IF NOT aqct300_oqc_chk() THEN
            RETURN FALSE
         END IF
      WHEN g_qcba_m.qcba000 = '5'
         CASE g_qcba_m.qcba031 
            WHEN '1'
               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aqc-00093:sub-01317|aint301|",cl_get_progname("aint301",g_lang,"2"),"|:EXEPROGaint301"
               #160318-00025#21  by 07900 --add-end
               IF NOT cl_chk_exist("v_inbbseq_3") THEN
                  RETURN FALSE
               END IF
            WHEN '2'
               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aqc-00094:sub-01317|aint302|",cl_get_progname("aint302",g_lang,"2"),"|:EXEPROGaint302"
               #160318-00025#21  by 07900 --add-end 
               IF NOT cl_chk_exist("v_inbbdocno_inbbseq") THEN
                  RETURN FALSE
               END IF
            WHEN '3'
               IF NOT cl_chk_exist("v_indddocno") THEN
                  RETURN FALSE
               END IF

            WHEN '4'
               IF NOT cl_chk_exist("v_indddocno_1") THEN
                  RETURN FALSE
               END IF
            WHEN '5'
               IF NOT cl_chk_exist("v_inbjseq_1") THEN
                  RETURN FALSE
               END IF
            #161024-00041#1 add --(S)--
            WHEN '7'
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aqc-00135:sub-01317|axmt600|",cl_get_progname("axmt600",g_lang,"2"),"|:EXEPROGaxmt600"
               IF NOT cl_chk_exist("v_xmdlseq_4") THEN
                  RETURN FALSE
               END IF
            #161024-00041#1 add --(E)--            
         END CASE
      WHEN g_qcba_m.qcba000 = '6'
           #160318-00025#21  by 07900 --add-str
            LET g_errshow = TRUE #是否開窗                   
            #LET g_chkparam.err_str[1] ="aqc-00105:sub-01317|axmt540|",cl_get_progname("axmt540",g_lang,"2"),"|:EXEPROGaxmt540"  #160531-00017#1
            #LET g_chkparam.err_str[1] ="aqc-00105:sub-01317|axmt581|",cl_get_progname("axmt581",g_lang,"2"),"|:EXEPROGaxmt581"  #160531-00017#1 #170213-00006#1-mark
            LET g_chkparam.err_str[1] ="aqc-00105:sub-01317|axmt591|",cl_get_progname("axmt591",g_lang,"2"),"|:EXEPROGaxmt591"  #170213-00006#1-add
            #160318-00025#21  by 07900 --add-end 
            IF NOT cl_chk_exist("v_xmdlseq_3") THEN  
               RETURN FALSE
            END IF
   END CASE
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_controlp_qcba001_select" order="32" ver="39" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_controlp_qcba001_select()
#160204-00004#4 Add By Ken 160222(S)
DEFINE l_success        LIKE type_t.num5
DEFINE l_where          STRING
#160204-00004#4 Add By Ken 160222(E)
   CASE 
      WHEN g_qcba_m.qcba000 = '1'
          LET g_qryparam.arg1 = "('1','8','2','9','16')"
          LET g_qryparam.where = " pmdt026 = 'Y'"
          #160204-00004#4 Add By Ken 160222(S)
          #組合過濾前後置單據資料SQL
          CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','pmdtdocno') RETURNING l_success,l_where
          IF l_success THEN
             LET g_qryparam.where = g_qryparam.where," AND ",l_where
             CALL q_pmdtdocno_3()
          END IF
          #160204-00004#4 Add By Ken 160222(E)           
          #CALL q_pmdtdocno_3()  #160204-00004#4 Mark By Ken 160222(S)
          
      WHEN g_qcba_m.qcba000 = '2'
          #160204-00004#4 Add By Ken 160222(S)
          #組合過濾前後置單據資料SQL
          CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','sfebdocno') RETURNING l_success,l_where
          IF l_success THEN
             LET g_qryparam.where = l_where
             CALL q_sfebdocno_sfebseq()
          END IF
          #160204-00004#4 Add By Ken 160222(E)         
          #CALL q_sfebdocno_sfebseq()   #160204-00004#4 Mark By Ken 160222(S)
      WHEN g_qcba_m.qcba000 = '3'
          #160204-00004#4 Add By Ken 160222(S)
          #組合過濾前後置單據資料SQL
          #CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','sfcadocno') RETURNING l_success,l_where  #161103-00007#3
          CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','sffbdocno') RETURNING l_success,l_where  #161103-00007#3
          IF l_success THEN
             LET g_qryparam.where = l_where
             #161103-00007#2---s
             IF NOT cl_null(l_where) THEN
                LET g_qryparam.where = g_qryparam.where , " AND sffb001 = '3' AND sffb017 > 0 AND sffbstus = 'Y' AND sffb005 IN (SELECT sfcbdocno FROM sfcb_t WHERE sfcbent = ",g_enterprise," AND sfcbsite = '",g_site,"' AND sfcb017 = 'Y')"
             ELSE
                LET g_qryparam.where = " AND sffb001 = '3' AND sffb017 > 0 AND sffbstus = 'Y' AND sffb005 IN (SELECT sfcbdocno FROM sfcb_t WHERE sfcbent = ",g_enterprise," AND sfcbsite = '",g_site,"' AND sfcb017 = 'Y') "
             END IF
             #161103-00007#2---e
             #CALL q_sfcadocno_2()   #161103-00007#2
#             CALL q_sffbdocno()    #170110-00056#1 mark
             CALL q_sffbdocno_sffbseq() #170110-00056#1 add
          END IF
          #160204-00004#4 Add By Ken 160222(E)      
          #CALL q_sfcadocno_2()      #160204-00004#4 Mark By Ken 160222(S)
      WHEN g_qcba_m.qcba000 = '4'
         IF g_qcba_m.qcba031 = '2' THEN
            #160204-00004#4 Add By Ken 160222(S)
            #組合過濾前後置單據資料SQL
            CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','xmdkdocno') RETURNING l_success,l_where
            IF l_success THEN
               LET g_qryparam.where = l_where
               CALL q_xmdkdocno_13()
            END IF
            #160204-00004#4 Add By Ken 160222(E)            
            #CALL q_xmdkdocno_13()     #160204-00004#4 Mark By Ken 160222(S)
         ELSE
            #160204-00004#4 Add By Ken 160222(S)
            #組合過濾前後置單據資料SQL
            CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','xmdgdocno') RETURNING l_success,l_where
            IF l_success THEN
               LET g_qryparam.where = l_where
               #CALL q_xmdgdocno_4()          #170102-00010#1 mark
               CALL q_xmdgdocno_5()           #170102-00010#1 add
            END IF
            #160204-00004#4 Add By Ken 160222(E)           
            #CALL q_xmdgdocno_4()      #160204-00004#4 Mark By Ken 160222(S)
         END IF
      WHEN g_qcba_m.qcba000 = '5'
         CASE g_qcba_m.qcba031 
            WHEN '1'
               LET g_qryparam.arg1 = '1'
               #160204-00004#4 Add By Ken 160222(S)
               #組合過濾前後置單據資料SQL
               CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','inbbdocno') RETURNING l_success,l_where
               IF l_success THEN
                  LET g_qryparam.where = l_where
                  CALL q_inbbdocno_inbbseq()
               END IF
               #160204-00004#4 Add By Ken 160222(E)                 
               #CALL q_inbbdocno_inbbseq() #160204-00004#4 Mark By Ken 160222(S)
            WHEN '2'
               LET g_qryparam.arg1 = '2'
               #160204-00004#4 Add By Ken 160222(S)
               #組合過濾前後置單據資料SQL
               CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','inbbdocno') RETURNING l_success,l_where
               IF l_success THEN
                  LET g_qryparam.where = l_where
                  CALL q_inbbdocno_inbbseq()
               END IF
               #160204-00004#4 Add By Ken 160222(E)               
               #CALL q_inbbdocno_inbbseq() #160204-00004#4 Mark By Ken 160222(S)
            WHEN '3'
               LET g_qryparam.arg1 = "('1')"
               LET g_qryparam.arg2 = "('2')"
               #160204-00004#4 Add By Ken 160222(S)
               #組合過濾前後置單據資料SQL
               CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','indddocno') RETURNING l_success,l_where
               IF l_success THEN
                  LET g_qryparam.where = l_where
                  CALL q_inddseq_1()
               END IF
               #160204-00004#4 Add By Ken 160222(E)               
               #CALL q_inddseq_1()        #160204-00004#4 Mark By Ken 160222(S)
            WHEN '4'
               LET g_qryparam.arg1 = "('2','3')"
               LET g_qryparam.arg2 = "('2','3')"
               #160204-00004#4 Add By Ken 160222(S)
               #組合過濾前後置單據資料SQL
               CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','indddocno') RETURNING l_success,l_where
               IF l_success THEN
                  LET g_qryparam.where = l_where
                  CALL q_inddseq_1()
               END IF
               #160204-00004#4 Add By Ken 160222(E)               
               #CALL q_inddseq_1()        #160204-00004#4 Mark By Ken 160222(S)
            WHEN '5'
               LET g_qryparam.arg1 = '1'
               #160204-00004#4 Add By Ken 160222(S)
               #組合過濾前後置單據資料SQL
               CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','inbjdocno') RETURNING l_success,l_where
               IF l_success THEN
                  LET g_qryparam.where = l_where
                  CALL q_inbjdocno()
               END IF
               #160204-00004#4 Add By Ken 160222(E)                
               #CALL q_inbjdocno()        #160204-00004#4 Mark By Ken 160222(S)
               
            #160324-00033#1------s
            WHEN '6'
               LET g_qryparam.arg1 = '1'
               #組合過濾前後置單據資料SQL
               CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','qcbndocno') RETURNING l_success,l_where
               IF l_success THEN
                  LET g_qryparam.where = l_where
                  CALL q_qcbndocno()
               END IF  
            #160324-00033#1------e
            #161024-00041#1------s
            WHEN '7'
               LET g_qryparam.arg1 = '1'
               #組合過濾前後置單據資料SQL
               CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','xmdkdocno') RETURNING l_success,l_where
               IF l_success THEN
                  LET g_qryparam.where = l_where
                  CALL q_xmdkdocno_23()
               END IF  
            #161024-00041#1------e
         END CASE
      WHEN g_qcba_m.qcba000 = '6'
           #160204-00004#4 Add By Ken 160222(S)
           #組合過濾前後置單據資料SQL
           CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','xmdkdocno') RETURNING l_success,l_where
           IF l_success THEN
              LET g_qryparam.where = l_where
              #CALL q_xmdkdocno_15()  #160531-00017#1
              #CALL q_xmdkdocno_18()  #160531-00017#1  #170213-00006#1-mark
               CALL q_xmdkdocno_15()  #170213-00006#1-mark
           END IF
           #160204-00004#4 Add By Ken 160222(E)      
           #CALL q_xmdkdocno_15()     #160204-00004#4 Mark By Ken 160222(S)
   END CASE
END FUNCTION]]>
</point>
  <point name="function.aqct300_controlp_qcba002_select" order="33" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_controlp_qcba002_select()
DEFINE l_success        LIKE type_t.num5  #170110-00056#1 add
DEFINE l_where          STRING            #170110-00056#1 add
   CASE 
      WHEN g_qcba_m.qcba000 = '1'
          LET g_qryparam.arg1 = "('1','8','2','9','16')"
          LET g_qryparam.where = " pmdt026 = 'Y'"
          IF NOT cl_null(g_qcba_m.qcba001) THEN
             LET g_qryparam.where = g_qryparam.where," AND pmdtdocno = '",g_qcba_m.qcba001,"'"
          END IF
          CALL q_pmdtdocno_3()
      WHEN g_qcba_m.qcba000 = '2'
          IF NOT cl_null(g_qcba_m.qcba001) THEN
             LET g_qryparam.where = " sfebdocno = '",g_qcba_m.qcba001,"'"
          END IF
          CALL q_sfebdocno_sfebseq()
      WHEN g_qcba_m.qcba000 = '3'
           #170110-00056#1 mark(s)
#          LET g_qryparam.where = " 1=1"
#          IF NOT cl_null(g_qcba_m.qcba001) THEN
#             LET g_qryparam.where = g_qryparam.where," AND sfcadocno = '",g_qcba_m.qcba001,"'"
#          END IF
#          IF NOT cl_null(g_qcba_m.qcba029) THEN
#             LET g_qryparam.where = g_qryparam.where," AND sfca001 = '",g_qcba_m.qcba029,"'"
#          END IF 
#         CALL q_sfcadocno_2()
          #170110-00056#1 mark(e)
          #170110-00056#1 add(s)
           CALL s_aooi210_get_check_sql(g_site,'',g_qcba_m.qcbadocno,'4','','sffbdocno') RETURNING l_success,l_where  #161103-00007#3
          IF l_success THEN
             LET g_qryparam.where = l_where
             #161103-00007#2---s
             IF NOT cl_null(l_where) THEN
                LET g_qryparam.where = g_qryparam.where , " AND sffb001 = '3' AND sffb017 > 0 AND sffbstus = 'Y' AND sffb005 IN (SELECT sfcbdocno FROM sfcb_t WHERE sfcbent = ",g_enterprise," AND sfcbsite = '",g_site,"' AND sfcb017 = 'Y')"
             ELSE
                LET g_qryparam.where = " AND sffb001 = '3' AND sffb017 > 0 AND sffbstus = 'Y' AND sffb005 IN (SELECT sfcbdocno FROM sfcb_t WHERE sfcbent = ",g_enterprise," AND sfcbsite = '",g_site,"' AND sfcb017 = 'Y') "
             END IF
             #161103-00007#2---e
             #CALL q_sfcadocno_2()   #161103-00007#2
#             CALL q_sffbdocno()    #170110-00056#1 mark
             CALL q_sffbdocno_sffbseq() #170110-00056#1 add
             #170110-00056#1 add(e)
          END IF
      WHEN g_qcba_m.qcba000 = '4'
         IF g_qcba_m.qcba031 = '2' THEN
            IF NOT cl_null(g_qcba_m.qcba001) THEN
               LET g_qryparam.where = " xmdkdocno = '",g_qcba_m.qcba001,"'"
            END IF
            CALL q_xmdkdocno_13()
           
         ELSE
            IF NOT cl_null(g_qcba_m.qcba001) THEN
               LET g_qryparam.where = " xmdgdocno = '",g_qcba_m.qcba001,"'"
            END IF
            #CALL q_xmdgdocno_4()        #170102-00010#1 mark
            CALL q_xmdgdocno_5()         #170102-00010#1 add
         END IF
         
      WHEN g_qcba_m.qcba000 = '5'
         CASE g_qcba_m.qcba031 
            WHEN '1'
               LET g_qryparam.arg1 = '1'
               IF NOT cl_null(g_qcba_m.qcba001) THEN
                 LET g_qryparam.where = " inbbdocno = '",g_qcba_m.qcba001,"'" 
               END IF
               CALL q_inbbdocno_inbbseq()
            WHEN '2'
               LET g_qryparam.arg1 = '2'
               IF NOT cl_null(g_qcba_m.qcba001) THEN
                 LET g_qryparam.where = " inbbdocno = '",g_qcba_m.qcba001,"'" 
               END IF
               CALL q_inbbdocno_inbbseq()
            WHEN '3'
               LET g_qryparam.arg1 = "('1')"
               LET g_qryparam.arg2 = "('2')"
               IF NOT cl_null(g_qcba_m.qcba001) THEN
                 LET g_qryparam.where = " indddocno = '",g_qcba_m.qcba001,"'" 
               END IF
               CALL q_inddseq_1()
            WHEN '4'
               LET g_qryparam.arg1 = "('2','3')"
               LET g_qryparam.arg2 = "('2','3')"
               IF NOT cl_null(g_qcba_m.qcba001) THEN
                 LET g_qryparam.where = " indddocno = '",g_qcba_m.qcba001,"'" 
               END IF
               CALL q_inddseq_1()
            WHEN '5'
               LET g_qryparam.arg1 = '1'
               IF NOT cl_null(g_qcba_m.qcba001) THEN
                 LET g_qryparam.where = " inbjdocno = '",g_qcba_m.qcba001,"'" 
               END IF
               CALL q_inbjdocno() 
         END CASE
      WHEN g_qcba_m.qcba000 = '6' 
           IF NOT cl_null(g_qcba_m.qcba001) THEN
              LET g_qryparam.where = " xmdkdocno = '",g_qcba_m.qcba001,"'"
           END IF
           CALL q_xmdkdocno_15()
   END CASE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba019_scc" order="34" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba019_scc()
   CASE WHEN g_qcba_m.imae116 = '1'
           CALL cl_set_combo_scc_part('qcba019','5053','1,2,3')

        WHEN g_qcba_m.imae116 = '2'
           CALL cl_set_combo_scc_part('qcba019','5053','1,2,3,4')

        WHEN g_qcba_m.imae116 MATCHES '[34]'
           CALL cl_set_combo_scc_part('qcba019','5053','1,2,3,4,5,6,7')
   END CASE
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_qcbadocno" order="35" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_get_qcbadocno()
      IF NOT cl_null(g_qcba_m.qcbadocdt) AND NOT cl_null(g_qcba_m.qcbadocno) THEN
         CALL s_aooi200_gen_docno(g_site,g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_prog) RETURNING g_success,g_qcba_m.qcbadocno
         IF NOT g_success THEN
            RETURN FALSE
         END IF
      END IF
      RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_qcba017" order="36" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_get_qcba017()
#DEFINE l_qcba    RECORD LIKE qcba_t.*  #161124-00048#10 mark
#161124-00048#10 add(s)
DEFINE l_qcba RECORD  #品質檢驗單頭檔
       qcbaent LIKE qcba_t.qcbaent, #企业编号
       qcbasite LIKE qcba_t.qcbasite, #营运据点
       qcbadocno LIKE qcba_t.qcbadocno, #单号
       qcbadocdt LIKE qcba_t.qcbadocdt, #单据日期
       qcba000 LIKE qcba_t.qcba000, #检验类型
       qcba001 LIKE qcba_t.qcba001, #来源单号
       qcba002 LIKE qcba_t.qcba002, #来源单项次
       qcba003 LIKE qcba_t.qcba003, #参考单号
       qcba004 LIKE qcba_t.qcba004, #参考单项次
       qcba005 LIKE qcba_t.qcba005, #交易对象编号
       qcba006 LIKE qcba_t.qcba006, #作业编号
       qcba007 LIKE qcba_t.qcba007, #加工序
       qcba008 LIKE qcba_t.qcba008, #来源数量
       qcba009 LIKE qcba_t.qcba009, #单位
       qcba010 LIKE qcba_t.qcba010, #料件编号
       qcba011 LIKE qcba_t.qcba011, #版本
       qcba012 LIKE qcba_t.qcba012, #产品特征
       qcba013 LIKE qcba_t.qcba013, #品管分群
       qcba014 LIKE qcba_t.qcba014, #检验日期
       qcba015 LIKE qcba_t.qcba015, #检验时间
       qcba016 LIKE qcba_t.qcba016, #检验单位
       qcba017 LIKE qcba_t.qcba017, #送验量
       qcba018 LIKE qcba_t.qcba018, #检验程度
       qcba019 LIKE qcba_t.qcba019, #检验级数
       qcba020 LIKE qcba_t.qcba020, #承认文号
       qcba021 LIKE qcba_t.qcba021, #紧急度
       qcba022 LIKE qcba_t.qcba022, #判定结果
       qcba023 LIKE qcba_t.qcba023, #合格量
       qcba024 LIKE qcba_t.qcba024, #检验员
       qcba030 LIKE qcba_t.qcba030, #检验项目识别码
       qcba900 LIKE qcba_t.qcba900, #开单人员
       qcba901 LIKE qcba_t.qcba901, #开单部门
       qcbaownid LIKE qcba_t.qcbaownid, #资料所有者
       qcbaowndp LIKE qcba_t.qcbaowndp, #资料所有部门
       qcbacrtid LIKE qcba_t.qcbacrtid, #资料录入者
       qcbacrtdp LIKE qcba_t.qcbacrtdp, #资料录入部门
       qcbacrtdt LIKE qcba_t.qcbacrtdt, #资料创建日
       qcbamodid LIKE qcba_t.qcbamodid, #资料更改者
       qcbamoddt LIKE qcba_t.qcbamoddt, #最近更改日
       qcbacnfid LIKE qcba_t.qcbacnfid, #资料审核者
       qcbacnfdt LIKE qcba_t.qcbacnfdt, #数据审核日
       qcbapstid LIKE qcba_t.qcbapstid, #资料过账者
       qcbapstdt LIKE qcba_t.qcbapstdt, #资料过账日
       qcbastus LIKE qcba_t.qcbastus, #状态码
       qcba025 LIKE qcba_t.qcba025, #完成检验时间
       qcba026 LIKE qcba_t.qcba026, #检验时间
       qcba027 LIKE qcba_t.qcba027, #不良数
       qcba028 LIKE qcba_t.qcba028, #完成检验日期
       qcba031 LIKE qcba_t.qcba031, #类型分类
       qcba029 LIKE qcba_t.qcba029, #RunCard
       qcba032 LIKE qcba_t.qcba032, #质量异常申请单号
       qcba033 LIKE qcba_t.qcba033  #电子质检单号
END RECORD
#161124-00048#10 add(e)
DEFINE l_rate_qcba017  LIKE qcba_t.qcba017
DEFINE l_qcba017 LIKE qcba_t.qcba017
DEFINE l_rate    LIKE type_t.num20_6
DEFINE l_success LIKE type_t.num5
DEFINE r_qcba017 LIKE qcba_t.qcba017
DEFINE l_sql STRING
DEFINE l_rate_num LIKE qcba_t.qcba023 #160216-00008#1 add 
DEFINE l_oqc_qcba017 LIKE qcba_t.qcba017 #160216-00008#1 add 
#   LET l_sql = "SELECT * FROM qcba_t WHERE qcbaent = ",g_enterprise,  #161124-00048#10 mark
    #161124-00048#10 add(s)
    LET l_sql = "SELECT qcbaent,qcbasite,qcbadocno,qcbadocdt,qcba000,qcba001,qcba002,qcba003,",
                "       qcba004,qcba005,qcba006,qcba007,qcba008,qcba009,qcba010,qcba011,qcba012,",
                "       qcba013,qcba014,qcba015,qcba016,qcba017,qcba018,qcba019,qcba020,qcba021,",
                "       qcba022,qcba023,qcba024,qcba030,qcba900,qcba901,qcbaownid,qcbaowndp,qcbacrtid,",
                "       qcbacrtdp,qcbacrtdt,qcbamodid,qcbamoddt,qcbacnfid,qcbacnfdt,qcbapstid,qcbapstdt,",
                "       qcbastus,qcba025,qcba026,qcba027,qcba028,qcba031,qcba029,qcba032,qcba033", 
                "  FROM qcba_t WHERE qcbaent = ",g_enterprise,
    #161124-00048#10 add(e)
               " AND qcba001 = '",g_qcba_m.qcba001,"'",
               #" AND qcba002 = ",g_qcba_m.qcba002,  #160324-00033#1
               " AND qcbadocno <> '",g_qcba_m.qcbadocno,"'",
               " AND qcbastus IN ('N','Y')"
   #160324-00033#1---s
   IF NOT cl_null(g_qcba_m.qcba002) THEN
      LET l_sql = l_sql," AND qcba002 = ",g_qcba_m.qcba002
   END IF
   #160324-00033#1---e 
                
   IF g_qcba_m.qcba000 = '3' THEN
      LET l_sql = l_sql," AND qcba029 = ",g_qcba_m.qcba029
   END IF
   PREPARE sel_qcba_pre FROM l_sql
   DECLARE sel_qcba_cur CURSOR FOR sel_qcba_pre
    
   LET l_qcba017 = 0
   FOREACH sel_qcba_cur INTO l_qcba.* 
      IF STATUS THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = STATUS
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF
      LET l_rate_qcba017 = 0
      #IF g_qcba_m.qcba000 != '4' THEN   #160216-00008#1 add   #160516-00016#1 mark
      IF  g_qcba_m.qcba000 NOT MATCHES '[34]' THEN #160516-00016#1 add
         IF l_qcba.qcba009 != l_qcba.qcba016 THEN
#            CALL s_aimi190_get_convert(l_qcba.qcba010,l_qcba.qcba009,l_qcba.qcba016) RETURNING l_success,l_rate  #xj mod
            CALL s_aooi250_convert_qty(l_qcba.qcba010,l_qcba.qcba009,l_qcba.qcba016,l_qcba.qcba017) RETURNING l_success,l_rate_qcba017 
            IF l_success  THEN
#               LET l_rate_qcba017  = l_qcba.qcba017 * l_rate   #換算後的數量   #xj mod
               LET l_qcba.qcba017 = 0
            END IF
         END IF  
         
         LET l_qcba017 = l_qcba017  + l_qcba.qcba017 + l_rate_qcba017
      #160216-00008#1 add str
      ELSE
         IF l_qcba.qcbastus = 'N' THEN
            LET l_oqc_qcba017 = l_qcba.qcba017
            LET l_rate_num = l_qcba.qcba017
         ELSE
            LET l_rate_num = l_qcba.qcba023
            LET l_oqc_qcba017 = l_qcba.qcba023         
         END IF
         IF l_qcba.qcba009 != l_qcba.qcba016 THEN
            CALL s_aooi250_convert_qty(l_qcba.qcba010,l_qcba.qcba009,l_qcba.qcba016,l_rate_num) RETURNING l_success,l_rate_num
#            IF l_success  THEN
#               LET l_rate_num = 0
#            END IF
         END IF 
         LET l_qcba017 = l_qcba017 + l_rate_num 
      END IF
      #160216-00008#1 add end
   END FOREACH 
   LET r_qcba017 = g_qcba_m.qcba008 - l_qcba017
   RETURN r_qcba017
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba016_desc" order="37" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba016_desc(p_qcba016)
DEFINE p_qcba016   LIKE qcba_t.qcba016
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = p_qcba016
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_qcba_m.qcba016_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_qcba_m.qcba016_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba_default" order="38" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba_default()
   IF cl_null(g_qcba_m.qcba013) THEN LET g_qcba_m.qcba013 = '' END IF
   IF cl_null(g_qcba_m.qcba000) THEN LET g_qcba_m.qcba000 = '' END IF
   IF cl_null(g_qcba_m.qcba005) THEN LET g_qcba_m.qcba005 = '' END IF
   IF cl_null(g_qcba_m.qcba006) THEN LET g_qcba_m.qcba006 = '' END IF
   IF cl_null(g_qcba_m.qcba007) THEN LET g_qcba_m.qcba007 = 0 END IF
   IF cl_null(g_qcba_m.qcba010) THEN LET g_qcba_m.qcba010 = '' END IF
   IF cl_null(g_qcba_m.qcba012) THEN LET g_qcba_m.qcba012 = '' END IF
                            
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba017_chk" order="39" ver="23" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba017_chk(p_cmd)
DEFINE l_qcba017   LIKE qcba_t.qcba017 
DEFINE l_rate_qcba017  LIKE qcba_t.qcba017
DEFINE l_rate   LIKE inaj_t.inaj014
DEFINE p_cmd    LIKE type_t.chr1
DEFINE l_n LIKE type_t.num10
DEFINE l_imaf071 LIKE imaf_t.imaf071
DEFINE l_imaf081 LIKE imaf_t.imaf081
   IF g_qcba_m.qcba016 != g_qcba_m.qcba009 THEN
      CALL s_aimi190_get_convert(g_qcba_m.qcba010,g_qcba_m.qcba009,g_qcba_m.qcba016) RETURNING g_success,l_rate
      IF g_success  THEN
         LET l_qcba017  = g_qcba_m.qcba017 * l_rate   #換算後的數量
      END IF
   ELSE
      LET l_qcba017 = g_qcba_m.qcba017 
   END IF
   #160912-00021#3-s
   IF g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '3' AND g_qcba_m.qcba008 < 0 THEN
      IF g_qcba_m.qcba017 > 0 THEN   #送验量不可大于0！
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'aqc-00143'
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()     
         RETURN FALSE         
      END IF
      IF l_qcba017 < g_qcba017_t THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'aqc-00049'
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()     
         RETURN FALSE
      END IF       
   ELSE
   #160912-00021#3-e
      IF l_qcba017 > g_qcba017_t THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'aqc-00049'
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
     
         RETURN FALSE
      END IF
   END IF  #160912-00021#3
   IF NOT aqct300_qcbc009_sum_chk() THEN
      RETURN FALSE
   END IF
   
   #如果送验量修改后,更改制造批序号
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0049') = 'Y' OR cl_get_para(g_enterprise,g_site,'S-BAS-0048') = 'Y' OR g_qcba_m.qcba000 MATCHES '[25]' THEN 
      CALL aqct300_get_imaf071_imaf081() RETURNING l_imaf071,l_imaf081
      IF l_imaf071 = '1' OR l_imaf081 = '1' THEN   #如果必须有制造批序号
         LET l_n = 0
         SELECT COUNT(1) INTO l_n FROM qcbc_t WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
         IF (NOT s_aqct300_joint_chk(g_qcba_m.qcbadocno) AND NOT s_aqct300_qc_chk(g_qcba_m.qcbadocno)) OR ((s_aqct300_joint_chk(g_qcba_m.qcbadocno) OR s_aqct300_qc_chk(g_qcba_m.qcbadocno)) AND l_n = 0)THEN
            IF p_cmd = 'u' AND g_qcba_m_o.qcba017 != g_qcba_m.qcba017 THEN
               #先还原已转QC量
               IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,1) THEN
                  RETURN FALSE
               END IF
               IF NOT aqct300_upd_inao(1,g_qcba_m.qcba017,g_qcba_m.qcba012,'','','') THEN
                  RETURN FALSE
               END IF
               #回写已转QC量
               IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,1) THEN
                  RETURN FALSE
               END IF
            END IF
         END IF
      END IF
   END IF
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba001_ref" order="40" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba001_ref()
#   SELECT imaa002 INTO g_qcba_m.qcba011 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_qcba_m.qcba010
#   DISPLAY BY NAME g_qcba_m.qcba011
DEFINE l_qcap003 LIKE qcap_t.qcap003
DEFINE l_qcap004 LIKE qcap_t.qcap004  
DEFINE l_sum LIKE type_t.num5
   #SELECT imae111,oocql004 INTO  g_qcba_m.qcba013,g_qcba_m.qcba013_desc    #161219-00061#1 mark
   SELECT imae111,oocql004,imae113 INTO g_qcba_m.qcba013,g_qcba_m.qcba013_desc,g_qcba_m.qcba016  #161219-00061#1 add
     FROM imae_t LEFT OUTER JOIN oocql_t ON oocqlent = imaeent AND oocql001 = 205 AND oocql002 = imae111 AND oocql003 = g_dlang
    WHERE imaesite = g_qcba_m.qcbasite AND imaeent = g_enterprise AND imae001 = g_qcba_m.qcba010 
   CALL aqct300_qcba019_scc()

   IF cl_null(g_qcba_m.qcba016) THEN             #161219-00061#1 add
      LET g_qcba_m.qcba016 = g_qcba_m.qcba009
   END IF                                        #161219-00061#1 add
   IF g_qcba_m.qcba000 = '3' THEN
      #161103-00007#3---s
      #SELECT sfcb003,sfcb004 INTO g_qcba_m.qcba006,g_qcba_m.qcba007 FROM sfcb_t
      # WHERE sfcbent = g_enterprise
      #   AND sfcbdocno = g_qcba_m.qcba001
      #   AND sfcb002 = g_qcba_m.qcba002
      #   AND sfcb001 = g_qcba_m.qcba029
      # DISPLAY BY NAME g_qcba_m.qcba006,g_qcba_m.qcba007
      
      SELECT sffb006,sffb007,sffb008 INTO g_qcba_m.qcba029,g_qcba_m.qcba006,g_qcba_m.qcba007 
       FROM sffb_t WHERE sfFbent = g_enterprise AND sfFbdocno = g_qcba_m.qcba001
        AND sffbseq = g_qcba_m.qcba002  #170110-00056#1 add
      DISPLAY BY NAME g_qcba_m.qcba029,g_qcba_m.qcba006,g_qcba_m.qcba007
      
      #LET l_sum = 0
      #SELECT (NVL(SUM(sffb017),0)+NVL(SUM(sffb018),0)+NVL(SUM(sffb019),0)+NVL(SUM(sffb020),0)) INTO l_sum
      #  FROM sffb_t
      # WHERE sffbent = g_enterprise  AND sffb005 = g_qcba_m.qcba001 
      #   AND sffb006 = g_qcba_m.qcba029 AND sffb007 = g_qcba_m.qcba006 
      #   AND sffb008 = g_qcba_m.qcba007 AND sffb001 = '3'
      #LET g_qcba_m.qcba008 = g_qcba_m.qcba008 + l_sum
      #DISPLAY BY NAME g_qcba_m.qcba008
      #161103-00007#3--e 
   END IF
   
   LET l_qcap003 = g_qcba_m.qcba006
   LET l_qcap004 = g_qcba_m.qcba007
   IF cl_null(l_qcap003) THEN
      LET l_qcap003 = 'ALL'
   END IF
   
   IF cl_null(l_qcap004) THEN
      LET l_qcap004 = 0
   END IF
   SELECT qcap007,qcap009 INTO g_qcba_m.qcba018,g_qcba_m.qcba019 FROM qcap_t
       WHERE qcapent = g_enterprise AND qcapsite = g_qcba_m.qcbasite
         AND qcap001 = g_qcba_m.qcba010 AND qcap002 = g_qcba_m.qcba005
         AND qcap003 = l_qcap003 AND qcap004 = l_qcap004
         AND (qcap005 = g_qcba_m.qcba012 OR qcap005 = 'ALL')
   IF cl_null(g_qcba_m.qcba018) OR cl_null(g_qcba_m.qcba019) THEN
         SELECT imae115,imae117 INTO g_qcba_m.qcba018,g_qcba_m.qcba019 FROM imae_t
          WHERE imaeent = g_enterprise AND imaesite =g_qcba_m.qcbasite 
            AND imae001 = g_qcba_m.qcba010
   END IF 
   
   CALL aqct300_get_qcba017() RETURNING g_qcba_m.qcba017
   LET g_qcba017_t = g_qcba_m.qcba017
   
  
   DISPLAY BY NAME g_qcba_m.qcba013,g_qcba_m.qcba013_desc,g_qcba_m.qcba016,
                   g_qcba_m.qcba017,g_qcba_m.qcba018,g_qcba_m.qcba019
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcba013_desc" order="41" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcba013_desc()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_qcba_m.qcba013
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='205' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcba_m.qcba013_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_qcba_m.qcba013_desc  
END FUNCTION]]>
</point>
  <point name="function.aqct300_upd_qcba023" order="42" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_upd_qcba023()
#DEFINE l_qcba   RECORD LIKE qcba_t.*  #161124-00048#10 mark
#161124-00048#10 add(s)
DEFINE l_qcba RECORD  #品質檢驗單頭檔
       qcbaent LIKE qcba_t.qcbaent, #企业编号
       qcbasite LIKE qcba_t.qcbasite, #营运据点
       qcbadocno LIKE qcba_t.qcbadocno, #单号
       qcbadocdt LIKE qcba_t.qcbadocdt, #单据日期
       qcba000 LIKE qcba_t.qcba000, #检验类型
       qcba001 LIKE qcba_t.qcba001, #来源单号
       qcba002 LIKE qcba_t.qcba002, #来源单项次
       qcba003 LIKE qcba_t.qcba003, #参考单号
       qcba004 LIKE qcba_t.qcba004, #参考单项次
       qcba005 LIKE qcba_t.qcba005, #交易对象编号
       qcba006 LIKE qcba_t.qcba006, #作业编号
       qcba007 LIKE qcba_t.qcba007, #加工序
       qcba008 LIKE qcba_t.qcba008, #来源数量
       qcba009 LIKE qcba_t.qcba009, #单位
       qcba010 LIKE qcba_t.qcba010, #料件编号
       qcba011 LIKE qcba_t.qcba011, #版本
       qcba012 LIKE qcba_t.qcba012, #产品特征
       qcba013 LIKE qcba_t.qcba013, #品管分群
       qcba014 LIKE qcba_t.qcba014, #检验日期
       qcba015 LIKE qcba_t.qcba015, #检验时间
       qcba016 LIKE qcba_t.qcba016, #检验单位
       qcba017 LIKE qcba_t.qcba017, #送验量
       qcba018 LIKE qcba_t.qcba018, #检验程度
       qcba019 LIKE qcba_t.qcba019, #检验级数
       qcba020 LIKE qcba_t.qcba020, #承认文号
       qcba021 LIKE qcba_t.qcba021, #紧急度
       qcba022 LIKE qcba_t.qcba022, #判定结果
       qcba023 LIKE qcba_t.qcba023, #合格量
       qcba024 LIKE qcba_t.qcba024, #检验员
       qcba030 LIKE qcba_t.qcba030, #检验项目识别码
       qcba900 LIKE qcba_t.qcba900, #开单人员
       qcba901 LIKE qcba_t.qcba901, #开单部门
       qcbaownid LIKE qcba_t.qcbaownid, #资料所有者
       qcbaowndp LIKE qcba_t.qcbaowndp, #资料所有部门
       qcbacrtid LIKE qcba_t.qcbacrtid, #资料录入者
       qcbacrtdp LIKE qcba_t.qcbacrtdp, #资料录入部门
       qcbacrtdt LIKE qcba_t.qcbacrtdt, #资料创建日
       qcbamodid LIKE qcba_t.qcbamodid, #资料更改者
       qcbamoddt LIKE qcba_t.qcbamoddt, #最近更改日
       qcbacnfid LIKE qcba_t.qcbacnfid, #资料审核者
       qcbacnfdt LIKE qcba_t.qcbacnfdt, #数据审核日
       qcbapstid LIKE qcba_t.qcbapstid, #资料过账者
       qcbapstdt LIKE qcba_t.qcbapstdt, #资料过账日
       qcbastus LIKE qcba_t.qcbastus, #状态码
       qcba025 LIKE qcba_t.qcba025, #完成检验时间
       qcba026 LIKE qcba_t.qcba026, #检验时间
       qcba027 LIKE qcba_t.qcba027, #不良数
       qcba028 LIKE qcba_t.qcba028, #完成检验日期
       qcba031 LIKE qcba_t.qcba031, #类型分类
       qcba029 LIKE qcba_t.qcba029, #RunCard
       qcba032 LIKE qcba_t.qcba032, #质量异常申请单号
       qcba033 LIKE qcba_t.qcba033  #电子质检单号
END RECORD
#161124-00048#10 add(e)
DEFINE l_n      LIKE type_t.num5
DEFINE l_n1     LIKE type_t.num5
DEFINE l_sum_qcbb004 LIKE qcbb_t.qcbb004
DEFINE l_sum_qcbc009 LIKE qcbc_t.qcbc009
#   SELECT * INTO l_qcba.* FROM qcba_t  #161124-00048#10 mark
   #161124-00048#10 add(s)
   SELECT qcbaent,qcbasite,qcbadocno,qcbadocdt,qcba000,qcba001,qcba002,qcba003,
          qcba004,qcba005,qcba006,qcba007,qcba008,qcba009,qcba010,qcba011,qcba012,
          qcba013,qcba014,qcba015,qcba016,qcba017,qcba018,qcba019,qcba020,qcba021,
          qcba022,qcba023,qcba024,qcba030,qcba900,qcba901,qcbaownid,qcbaowndp,qcbacrtid,
          qcbacrtdp,qcbacrtdt,qcbamodid,qcbamoddt,qcbacnfid,qcbacnfdt,qcbapstid,qcbapstdt,
          qcbastus,qcba025,qcba026,qcba027,qcba028,qcba031,qcba029,qcba032,qcba033
     INTO l_qcba.* FROM qcba_t
   #161124-00048#10 add(e)
    WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
   IF l_qcba.qcba022 MATCHES '[23]' THEN
      UPDATE qcba_t SET qcba023 = 0 WHERE qcbaent = g_enterprise 
         AND qcbadocno = g_qcba_m.qcbadocno
   END IF
   
   IF l_qcba.qcba022 = '1' THEN
      LET l_n = 0
      SELECT COUNT(1) INTO l_n FROM qcbb_t WHERE qcbbent = g_enterprise AND qcbbdocno = g_qcba_m.qcbadocno
      LET l_n1 = 0
      SELECT COUNT(1) INTO l_n1 FROM qcbc_t WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
      IF l_n = 0 AND l_n1 = 0 THEN
         UPDATE qcba_t SET qcba023 = g_qcba_m.qcba017 WHERE qcbaent = g_enterprise 
            AND qcbadocno = g_qcba_m.qcbadocno
      END IF
      
      IF l_n > 0 THEN
         LET l_n = 0
         SELECT COUNT(1) INTO l_n FROM qcbb_t WHERE qcbbent = g_enterprise AND qcbbdocno = g_qcba_m.qcbadocno AND qcbb005 = 'Y' 
         IF l_n = 0 THEN
            SELECT SUM(qcbb004) INTO l_sum_qcbb004 FROM qcbb_t WHERE qcbbent = g_enterprise AND qcbbdocno = g_qcba_m.qcbadocno AND qcbb006 = '1'
            UPDATE qcba_t SET qcba023 = l_sum_qcbb004,qcba027 = 0
             WHERE qcbaent = g_enterprise 
               AND qcbadocno = g_qcba_m.qcbadocno
         END IF
      END IF
      
      IF l_n1 > 0 THEN
         SELECT SUM(qcbc009) INTO l_sum_qcbc009 FROM qcbc_t WHERE qcbcent = g_enterprise 
           AND qcbcdocno = g_qcba_m.qcbadocno AND qcbc012 IN ('1','2','3') 
         UPDATE qcba_t SET qcba023 = l_sum_qcbc009,qcba027 = l_qcba.qcba017 - l_sum_qcbc009  
          WHERE qcbaent = g_enterprise 
            AND qcbadocno = g_qcba_m.qcbadocno
      END IF
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd004_chk" order="43" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbd004_chk()
DEFINE l_sql      STRING
DEFINE l_n        LIKE type_t.num5
   IF NOT cl_null(g_qcbd_d[l_ac].qcbd020) AND NOT cl_null(g_qcbd_d[l_ac].qcbd004) THEN
      IF g_qcbd_d[l_ac].qcbd020 = '1' THEN
         LET l_sql = "SELECT COUNT(1) FROM qcac_t WHERE qcacent=",g_enterprise," AND qcac002=?"
         IF NOT ap_chk_isExist(g_qcbd_d[l_ac].qcbd004,l_sql,'aqc-00021',1) THEN
            RETURN FALSE
         END IF
         LET l_sql = l_sql," AND qcacstus='Y'"
#         IF NOT ap_chk_isExist(g_qcbd_d[l_ac].qcbd004,l_sql,'aqc-00022',1) THEN    #160318-00005#42  mark
         IF NOT ap_chk_isExist(g_qcbd_d[l_ac].qcbd004,l_sql,'sub-01302','aqci003') THEN     #160318-00005#42  add
            RETURN FALSE
         END IF
      END IF
      IF g_qcbd_d[l_ac].qcbd020 = '2' THEN
         LET l_sql = "SELECT COUNT(1) FROM qcag_t WHERE qcagent=",g_enterprise," AND qcag003=?"
         IF NOT ap_chk_isExist(g_qcbd_d[l_ac].qcbd004,l_sql,'aqc-00023',1) THEN
            RETURN FALSE
         END IF
         LET l_sql = l_sql," AND qcagstus='Y'"
#         IF NOT ap_chk_isExist(g_qcbd_d[l_ac].qcbd004,l_sql,'aqc-00024',1) THEN    #160318-00005#42  mark
         IF NOT ap_chk_isExist(g_qcbd_d[l_ac].qcbd004,l_sql,'sub-01302','aqci007') THEN   #160318-00005#42  add
            RETURN FALSE
         END IF
      END IF
      IF g_qcbd_d[l_ac].qcbd020 = '5' THEN 
         IF g_qcbd_d[l_ac].qcbd004 < 0 OR g_qcbd_d[l_ac].qcbd004 > 100 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aqc-00057'
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()

            RETURN FALSE
         END IF
      END IF
      IF g_qcbd_d[l_ac].qcbd020 = '6' THEN 
         LET l_n = 0 
         SELECT COUNT(1) INTO l_n FROM qcah_t 
          WHERE qcahent = g_enterprise AND qcah001 = g_qcaz.qcaz001
            AND qcah002 =  g_qcbd_d[l_ac].qcbd004
          IF l_n = 0 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'aqc-00058'
             LET g_errparam.extend = g_qcbd_d[l_ac].qcbd004
             LET g_errparam.popup = TRUE
             CALL cl_err()

             RETURN FALSE
          END IF
          
          LET l_n = 0 
         SELECT COUNT(1) INTO l_n FROM qcah_t 
          WHERE qcahent = g_enterprise AND qcah001 = g_qcaz.qcaz001
            AND qcah002 =  g_qcbd_d[l_ac].qcbd004 AND qcahstus = 'Y'
          IF l_n = 0 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'aqc-00059'
             LET g_errparam.extend = g_qcbd_d[l_ac].qcbd004
             LET g_errparam.popup = TRUE
             CALL cl_err()

             RETURN FALSE
          END IF
      END IF
      
      IF g_qcbd_d[l_ac].qcbd020 = '7' THEN
         IF g_qcbd_d[l_ac].qcbd009 != g_qcba_m.qcba017 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aqc-00085'
            LET g_errparam.extend = g_qcbd_d[l_ac].qcbd004
            LET g_errparam.popup = TRUE
            CALL cl_err()

            RETURN FALSE
         END IF
      END IF
   END IF
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_upd_qcba022" order="44" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#更新檢驗狀態
PRIVATE FUNCTION aqct300_upd_qcba022()
DEFINE l_n LIKE type_t.num5
   
   IF g_qcba_m.qcba000 MATCHES '[145]' THEN
      LET l_n = 0
      SELECT COUNT(1) INTO l_n FROM qcbd_t WHERE qcbdent = g_enterprise
         AND qcbddocno = g_qcba_m.qcbadocno AND qcbd011 = '2'
      IF l_n > 0 THEN
         UPDATE qcba_t SET qcba022 = '2' WHERE qcbaent = g_enterprise 
            AND qcbadocno = g_qcba_m.qcbadocno     
      END IF
      
      LET l_n = 0
      SELECT COUNT(1) INTO l_n FROM qcbb_t WHERE qcbbent = g_enteprise
         AND qcbbdocno = g_qcba_m.qcbadocno AND qcbb006 = '2'
      IF l_n > 0 THEN
         UPDATE qcba_t SET qcba022 = '2' WHERE qcbaent = g_enterprise 
            AND qcbadocno = g_qcba_m.qcbadocno     
      END IF
   END IF
   
   IF g_qcba_m.qcba000 MATCHES '[23]' THEN
      LET l_n = 0
      SELECT COUNT(1) INTO l_n FROM qcbd_t WHERE qcbdent = g_enterprise
         AND qcbddocno = g_qcba_m.qcbadocno AND qcbd011 = '2'
      IF l_n > 0 THEN
         UPDATE qcba_t SET qcba022 = '3' WHERE qcbaent = g_enterprise 
            AND qcbadocno = g_qcba_m.qcbadocno        
      END IF
      
      LET l_n = 0
      SELECT COUNT(1) INTO l_n FROM qcbb_t WHERE qcbbent = g_enteprise
         AND qcbbdocno = g_qcba_m.qcbadocno AND qcbb006 = '2'
      IF l_n > 0 THEN
         UPDATE qcba_t SET qcba022 = '3' WHERE qcbaent = g_enterprise 
            AND qcbadocno = g_qcba_m.qcbadocno         
      END IF
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_special_purchase_upd" order="45" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#特採
PRIVATE FUNCTION aqct300_special_purchase_upd()
DEFINE l_n LIKE type_t.num5
DEFINE l_sum_qcbc009  LIKE qcbc_t.qcbc009
DEFINE l_cut_num LIKE type_t.num5
DEFINE l_over_num LIKE type_t.num5
#DEFINE l_pmdu   RECORD LIKE pmdu_t.*   #161124-00048#10
#161124-00048#10 add(s)
DEFINE l_pmdu RECORD  #收貨/驗退/入庫/倉退單多庫儲批收貨明細檔
       pmduent LIKE pmdu_t.pmduent, #企业编号
       pmdusite LIKE pmdu_t.pmdusite, #营运据点
       pmdudocno LIKE pmdu_t.pmdudocno, #单据编号
       pmduseq LIKE pmdu_t.pmduseq, #项次
       pmduseq1 LIKE pmdu_t.pmduseq1, #项序
       pmdu001 LIKE pmdu_t.pmdu001, #料件编号
       pmdu002 LIKE pmdu_t.pmdu002, #产品特征
       pmdu003 LIKE pmdu_t.pmdu003, #作业编号
       pmdu004 LIKE pmdu_t.pmdu004, #作业序
       pmdu005 LIKE pmdu_t.pmdu005, #库存管理特征
       pmdu006 LIKE pmdu_t.pmdu006, #库位
       pmdu007 LIKE pmdu_t.pmdu007, #储位
       pmdu008 LIKE pmdu_t.pmdu008, #批号
       pmdu009 LIKE pmdu_t.pmdu009, #单位
       pmdu010 LIKE pmdu_t.pmdu010, #数量
       pmdu011 LIKE pmdu_t.pmdu011, #参考单位
       pmdu012 LIKE pmdu_t.pmdu012, #参考数量
       pmdu013 LIKE pmdu_t.pmdu013, #允收数量
       pmdu014 LIKE pmdu_t.pmdu014, #已入库量
       pmdu015 LIKE pmdu_t.pmdu015, #已验退量
       pmdu016 LIKE pmdu_t.pmdu016, #存货备注
       pmdu017 LIKE pmdu_t.pmdu017, #有效日期
       pmdu200 LIKE pmdu_t.pmdu200, #包装单位
       pmdu201 LIKE pmdu_t.pmdu201, #包装数量
       pmdu202 LIKE pmdu_t.pmdu202  #制造日期
END RECORD
#161124-00048#20 add(e)
DEFINE r_success LIKE type_t.num5
DEFINE l_imaf071 LIKE imaf_t.imaf071
DEFINE l_imaf081 LIKE imaf_t.imaf081
   CALL s_transaction_begin()
#   LET l_n = 0 
#   SELECT COUNT(1) INTO l_n FROM qcbc_t WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
#   IF l_n > 0 THEN
   IF s_aqct300_joint_chk(g_qcba_m.qcbadocno) OR s_aqct300_qc_chk(g_qcba_m.qcbadocno) THEN 
      
      CALL aqct300_input_qcbd5('u')
      IF INT_FLAG THEN
         RETURN FALSE
      END IF 
      SELECT SUM(qcbc009) INTO l_sum_qcbc009 FROM qcbc_t WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno 
        AND qcbc012 IN ('1','2','3')
      IF cl_null(l_sum_qcbc009) THEN LET l_sum_qcbc009 = 0 END IF
      UPDATE qcba_t SET qcba023 = l_sum_qcbc009,qcba027 = g_qcba_m.qcba017 - l_sum_qcbc009
       WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = SQLCA.SQLCODE
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   ELSE
      CALL aqct300_set_entry('')
      CALL aqct300_set_no_entry('')
      LET l_n = 0                               #先将来源单据的inao020 还原
      SELECT COUNT(1) INTO l_n FROM inao_t 
       WHERE inaoent = g_enterprise
         AND inaodocno = g_qcba_m.qcbadocno
      IF l_n <> 0 THEN
         CALL s_aqct300_upd_inao020(g_qcba_m.qcbadocno) RETURNING r_success,g_errno
         IF NOT r_success THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = g_errno
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            RETURN FALSE
         END IF
      END IF 
      DELETE FROM qcbc_t WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
      LET g_qcba_m_o.qcba023 = g_qcba_m.qcba023
      INPUT BY NAME g_qcba_m.qcba023 ATTRIBUTE(WITHOUT DEFAULTS)
         BEFORE INPUT
            
         AFTER FIELD qcba023
            IF g_qcba_m.qcba023 > g_qcba_m.qcba017 OR g_qcba_m.qcba023 < 0 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "" 
               LET g_errparam.code   = "aqc-00066" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               NEXT FIELD CURRENT
            END IF
            #特采合格数量需回写制造批序号
            IF cl_get_para(g_enterprise,g_site,'S-BAS-0049') = 'Y' OR cl_get_para(g_enterprise,g_site,'S-BAS-0048') = 'Y' OR g_qcba_m.qcba000 MATCHES '[25]' THEN 
               CALL aqct300_get_imaf071_imaf081() RETURNING l_imaf071,l_imaf081
               IF l_imaf071 = '1' OR l_imaf081 = '1' THEN   #如果必须有制造批序号
                  IF g_qcba_m_o.qcba023 != g_qcba_m.qcba023 THEN
                     #先还原已转QC量
#                     IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,1) THEN
#                        NEXT FIELD CURRENT
#                     END IF
                     IF NOT aqct300_upd_inao(1,g_qcba_m.qcba023,g_qcba_m.qcba012,'','','') THEN
                        NEXT FIELD CURRENT
                     END IF
                     #回写已转QC量
#                     IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,1) THEN
#                        NEXT FIELD CURRENT
#                     END IF
                  END IF
               END IF
            END IF
            LET g_qcba_m_o.qcba023 = g_qcba_m.qcba023
            
         ON ACTION accept
            #add-point:input段accept 
       
            #end add-point    
            ACCEPT INPUT
           
         ON ACTION cancel      #在dialog button (放棄)
            LET INT_FLAG = TRUE 
            EXIT INPUT
      
         ON ACTION close       #在dialog 右上角 (X)
            LET INT_FLAG = TRUE 
            EXIT INPUT
      
         ON ACTION exit        #toolbar 離開
            LET INT_FLAG = TRUE 
            EXIT INPUT
      END INPUT
          
      IF INT_FLAG THEN
         RETURN FALSE
      ELSE
         UPDATE qcba_t SET qcba023 = g_qcba_m.qcba023,qcba027 = g_qcba_m.qcba017 - g_qcba_m.qcba023
          WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = SQLCA.SQLCODE
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            RETURN FALSE
         END IF 
         
         CALL s_aqct300_ins_qcbc(g_qcba_m.qcbadocno) RETURNING r_success,g_errno
         IF NOT r_success THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = g_errno
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            RETURN r_success
         END IF
      END IF
   END IF
   UPDATE qcba_t SET qcba022 = '4'
     WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
   IF SQLCA.SQLCODE THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.SQLCODE
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN FALSE
   END IF
   
   #xujing---add---160422 特采回写inao_t

   IF NOT s_aqct300_del_aint350_inao(g_qcba_m.qcbadocno) THEN
      LET g_errno = 'sub-00034'
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = g_errno
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN FALSE
   END IF
   
   #新增aint350 拨入方检验的制造批序号资料
   IF NOT s_aqct300_ins_aint350_inao(g_qcba_m.qcbadocno) THEN
      LET g_errno = 'sub-00034'
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = g_errno
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN FALSE
   END IF
   
   LET l_n = 0
   SELECT COUNT(1) INTO l_n FROM inao_t 
    WHERE inaoent = g_enterprise
      AND inaodocno = g_qcba_m.qcbadocno
   IF l_n <> 0 THEN
      CALL s_aqct300_upd_inao020(g_qcba_m.qcbadocno) RETURNING r_success,g_errno
      IF NOT r_success THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = g_errno
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
   #xujing---add---160422 特采回写inao_t
   
   
   CASE g_qcba_m.qcba000
      WHEN '1'  #IQC
         CALL s_aqct300_iqc_upd(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
      WHEN '2'  #FQC
         CALL s_aqct300_fqc_upd(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno 
         CALL s_aqct300_gen_store_in_by_fqc(g_qcba_m.qcbadocno,g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
      WHEN '4'  #OQC 
         IF g_qcba_m.qcba031 = '1' THEN #出通单
            CALL s_aqct300_oqc_upd_1(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno    
         ELSE                         #出货单
            CALL s_aqct300_oqc_upd_2(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
         END IF         
      WHEN '5'  #invenctory
         CASE WHEN g_qcba_m.qcba031 MATCHES '[12]'  #杂收发
                 CALL s_aqct300_inventory_qc_upd_1(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
              WHEN g_qcba_m.qcba031 MATCHES '[34]'  #1/2 阶段调拨
                 CALL s_aqct300_inventory_qc_upd_2(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
              WHEN g_qcba_m.qcba031 = '5'  #报废单
                 CALL s_aqct300_inventory_qc_upd_3(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
         END CASE
      WHEN '6'
         CALL s_aqct300_rqc_upd(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno  
   END CASE
   IF NOT r_success THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = g_errno
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN r_success
   END IF

   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_qcao001" order="46" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_get_qcao001()
DEFINE r_qcao001    LIKE qcao_t.qcao001
   SELECT ooef025 INTO r_qcao001 FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = g_site
   RETURN r_qcao001
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_qcan015" order="47" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_get_qcan015(p_qcbdseq)
DEFINE r_qcan015  LIKE qcan_t.qcan015
DEFINE p_qcbdseq  LIKE qcbd_t.qcbdseq
   SELECT qcan015 INTO r_qcan015 FROM qcan_t,qcam_t WHERE qcan001 = qcam001
      AND qcanent = qcament  AND qcam001 = qcan001 
      AND qcan002 = qcam002  AND qcan003 = qcam003 
      AND qcan004 = qcam004  AND qcan005 = qcam005 
      AND qcan006 = qcam006  AND qcan007 = qcam008 
      AND qcan008 = qcam009  AND qcan009 = p_qcbdseq 
      AND qcam010 = g_qcba_m.qcba030
   RETURN r_qcan015
END FUNCTION]]>
</point>
  <point name="function.aqct300_page_visible" order="48" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#判断是否开启联产品与结果判定页签
PRIVATE FUNCTION aqct300_page_visible()
   CALL cl_set_comp_visible("page_3,page_4",TRUE)
   IF g_qcba_m.qcba000 MATCHES '[14]' THEN
      IF cl_get_para(g_enterprise,g_site,'S-BAS-0049') = 'N' AND cl_get_para(g_enterprise,g_site,'S-BAS-0048') = 'N' THEN 
         CALL cl_set_comp_visible("page_4",FALSE)
      END IF
   END IF
   
   IF NOT s_aqct300_joint_chk(g_qcba_m.qcbadocno) AND NOT s_aqct300_qc_chk(g_qcba_m.qcbadocno) THEN
      CALL cl_set_comp_visible("page_3",FALSE)
   END IF
   CALL ui.interface.refresh()
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbg_exists" order="49" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#检查项目是否有测量值
PRIVATE FUNCTION aqct300_qcbg_exists()
#DEFINE l_qcbd       RECORD LIKE qcbd_t.* #161124-00048#10 mark
#161124-00048#10 add(s)
DEFINE l_qcbd RECORD  #品質檢驗單身檔
       qcbdent LIKE qcbd_t.qcbdent, #企业编号
       qcbdsite LIKE qcbd_t.qcbdsite, #营运据点
       qcbddocno LIKE qcbd_t.qcbddocno, #单号
       qcbdseq LIKE qcbd_t.qcbdseq, #行序
       qcbd001 LIKE qcbd_t.qcbd001, #检验项目
       qcbd002 LIKE qcbd_t.qcbd002, #检验位置
       qcbd003 LIKE qcbd_t.qcbd003, #缺点等级
       qcbd004 LIKE qcbd_t.qcbd004, #AQL
       qcbd005 LIKE qcbd_t.qcbd005, #允收数
       qcbd006 LIKE qcbd_t.qcbd006, #拒绝数
       qcbd007 LIKE qcbd_t.qcbd007, #K法标准值
       qcbd008 LIKE qcbd_t.qcbd008, #F法标准值
       qcbd009 LIKE qcbd_t.qcbd009, #抽验量
       qcbd010 LIKE qcbd_t.qcbd010, #缺点数
       qcbd011 LIKE qcbd_t.qcbd011, #项目判定结果
       qcbd012 LIKE qcbd_t.qcbd012, #规范上限
       qcbd013 LIKE qcbd_t.qcbd013, #检验上限
       qcbd014 LIKE qcbd_t.qcbd014, #检验标准值
       qcbd015 LIKE qcbd_t.qcbd015, #检验下限
       qcbd016 LIKE qcbd_t.qcbd016, #规范下限
       qcbd017 LIKE qcbd_t.qcbd017, #计量单位
       qcbd018 LIKE qcbd_t.qcbd018, #检验规格说明
       qcbd019 LIKE qcbd_t.qcbd019, #备注
       qcbd020 LIKE qcbd_t.qcbd020, #抽样计划
       qcbd021 LIKE qcbd_t.qcbd021  #不良数
END RECORD
#161124-00048#10 add(e)
DEFINE l_qcan015    LIKE qcan_t.qcan015
DEFINE l_n          LIKE type_t.num5
DEFINE l_sql        STRING
#   LET l_sql = "SELECT * FROM qcbd_t WHERE qcbdent = ",g_enterprise," AND qcbddocno = '",g_qcba_m.qcbadocno,"'" #161124-00048#10 mark
   #161124-00048#10 add(s)
   LET l_sql = "SELECT qcbdent,qcbdsite,qcbddocno,qcbdseq,qcbd001,qcbd002,qcbd003,",
               "       qcbd004,qcbd005,qcbd006,qcbd007,qcbd008,qcbd009,qcbd010,qcbd011,",
               "       qcbd012,qcbd013,qcbd014,qcbd015,qcbd016,qcbd017,qcbd018,qcbd019,",
               "       qcbd020,qcbd021 FROM qcbd_t WHERE qcbdent = ",g_enterprise," AND qcbddocno = '",g_qcba_m.qcbadocno,"'"
   #161124-00048#10 add(e)
   PREPARE qcbg_exists_prep FROM l_sql
   DECLARE qcbg_exists_curs CURSOR FOR qcbg_exists_prep
   FOREACH qcbg_exists_curs INTO l_qcbd.*
      CALL aqct300_get_qcan015(l_qcbd.qcbdseq) RETURNING l_qcan015
      IF l_qcan015 MATCHES '[23]' THEN
         LET l_n = 0
         SELECT COUNT(1) INTO l_n FROM qcbg_t 
          WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
            AND qcbgseq = l_qcbd.qcbdseq
         IF l_n = 0 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aqc-00083'
            LET g_errparam.extend = l_qcbd.qcbdseq
            LET g_errparam.popup = TRUE
            CALL cl_err()
      
            RETURN FALSE
         END IF
         IF l_qcan015 = '3' THEN             #检查测量并勾稽的数量是否足够
            LET l_n = 0
            SELECT COUNT(1) INTO l_n FROM qcbg_t 
             WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
               AND qcbgseq = l_qcbd.qcbdseq
            IF l_n != l_qcbd.qcbd009 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'aqc-00084'
               LET g_errparam.extend = l_qcbd.qcbdseq
               LET g_errparam.popup = TRUE
               CALL cl_err()
               
               RETURN FALSE
            END IF
         END IF
      END IF
   END FOREACH
   
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_special_purchase_refesh" order="50" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_special_purchase_refesh()
    SELECT qcba022,qcba023,qcba027 INTO g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027 
      FROM qcba_t WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
    DISPLAY BY NAME g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027  
END FUNCTION]]>
</point>
  <point name="function.aqct300_un_special_purchase_upd" order="51" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_un_special_purchase_upd()
DEFINE r_success LIKE type_t.num5
DEFINE l_n  LIKE type_t.num5
   LET r_success = TRUE #160222-00013#1 add
   IF g_qcba_m.qcba000 MATCHES '[145]' THEN
      UPDATE qcba_t SET qcba022 = '2',qcba023 = 0,qcba027 = qcba027 + g_qcba_m.qcba023 
       WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = SQLCA.SQLCODE
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
   
   IF g_qcba_m.qcba000 MATCHES '[23]' THEN
      UPDATE qcba_t SET qcba022 = '3',qcba023 = 0,qcba027 = qcba027 + g_qcba_m.qcba023  
       WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno 
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = SQLCA.SQLCODE
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
   
   LET l_n = 0                               #先将来源单据的inao020 还原
   SELECT COUNT(1) INTO l_n FROM inao_t 
    WHERE inaoent = g_enterprise
      AND inaodocno = g_qcba_m.qcbadocno
   IF l_n <> 0 THEN
      CALL s_aqct300_upd_inao020(g_qcba_m.qcbadocno) RETURNING r_success,g_errno
      IF NOT r_success THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = g_errno
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF 
   
  #160222-00008#1 add(s) 
  CALL s_aqct300_ins_qcbc(g_qcba_m.qcbadocno) RETURNING r_success,g_errno
  IF NOT r_success THEN
     INITIALIZE g_errparam TO NULL 
     LET g_errparam.extend = "" 
     LET g_errparam.code   = g_errno
     LET g_errparam.popup  = TRUE 
     CALL cl_err()
     RETURN r_success
  END IF
  ##160222-00008#1 add(e)
  
  #xujing---add---160422 特采回写inao_t
  
   
  
   IF NOT s_aqct300_del_aint350_inao(g_qcba_m.qcbadocno) THEN
      LET g_errno = 'sub-00034'
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = g_errno
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN FALSE
   END IF
   
   #新增aint350 拨入方检验的制造批序号资料
   IF NOT s_aqct300_ins_aint350_inao(g_qcba_m.qcbadocno) THEN
      LET g_errno = 'sub-00034'
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = g_errno
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN FALSE
   END IF
  
   #xujing---add---160422 特采回写inao_t
   CASE g_qcba_m.qcba000
      WHEN '1'  #IQC
         CALL s_aqct300_iqc_upd(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
      WHEN '2'  #FQC
         CALL s_aqct300_fqc_upd(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno 
         CALL s_aqct300_gen_store_in_by_fqc(g_qcba_m.qcbadocno,g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
      WHEN '4'  #OQC
         IF g_qcba_m.qcba031 = '1' THEN #出通单
            CALL s_aqct300_oqc_upd_1(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno    
         ELSE                         #出货单
            CALL s_aqct300_oqc_upd_2(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
         END IF
      WHEN '5'  #invenctory
         CASE WHEN g_qcba_m.qcba031 MATCHES '[12]'  #杂收发
                 CALL s_aqct300_inventory_qc_upd_1(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
              WHEN g_qcba_m.qcba031 MATCHES '[34]'  #1/2 阶段调拨
                 CALL s_aqct300_inventory_qc_upd_2(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
              WHEN g_qcba_m.qcba031 = '5'  #报废单
                 CALL s_aqct300_inventory_qc_upd_3(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno
         END CASE
      WHEN '6'
         CALL s_aqct300_rqc_upd(g_qcba_m.qcba001,g_qcba_m.qcba002) RETURNING r_success,g_errno  
   END CASE
   IF NOT r_success THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = g_errno
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN r_success
   END IF
##160222-00008#1 mark  
#   CALL s_aqct300_ins_qcbc(g_qcba_m.qcbadocno) RETURNING r_success,g_errno
#   IF NOT r_success THEN
#      INITIALIZE g_errparam TO NULL 
#      LET g_errparam.extend = "" 
#      LET g_errparam.code   = g_errno
#      LET g_errparam.popup  = TRUE 
#      CALL cl_err()
#      RETURN r_success
#   END IF
#160222-00008#1 mark   
   
   
   
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_qcbd021" order="52" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#获取不良数
PRIVATE FUNCTION aqct300_get_qcbd021(p_qcbd003,p_qcbd010)
DEFINE p_qcbd003 LIKE qcbd_t.qcbd003
DEFINE r_qcbd021 LIKE qcbd_t.qcbd021
DEFINE p_qcbd010 LIKE qcbd_t.qcbd010
   CASE p_qcbd003
      WHEN '1'
         LET r_qcbd021 = p_qcbd010 * (g_qcaz.qcaz002 / g_qcaz.qcaz003)
      WHEN '2'
         LET r_qcbd021 = p_qcbd010 * (g_qcaz.qcaz004 / g_qcaz.qcaz005)
      WHEN '3'
         LET r_qcbd021 = p_qcbd010 * (g_qcaz.qcaz006 / g_qcaz.qcaz007)
   END CASE
   RETURN r_qcbd021
END FUNCTION]]>
</point>
  <point name="function.aqct300_upd_qcba027" order="53" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#回写单头不良数
PRIVATE FUNCTION aqct300_upd_qcba027()
DEFINE l_n LIKE type_t.num5
DEFINE l_qcbd021 LIKE qcbd_t.qcbd021
   SELECT COUNT(1) INTO l_n FROM qcbd_t
     WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno
        AND qcbd011 = '2' 
   IF l_n != 0 THEN       

      UPDATE qcba_t SET  qcba027 = g_qcba_m.qcba017,
                         qcba023 = 0
            WHERE qcbaent = g_enterprise
              AND qcbadocno = g_qcba_m.qcbadocno     
      IF SQLCA.SQLCODE OR SQLCA.SQLERRD[3] = 0 THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = ''
         LET g_errparam.code   = STATUS 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()   
      END IF
   ELSE
       UPDATE qcba_t SET qcba027 = 0,
                         qcba023 = 0
            WHERE qcbaent = g_enterprise
              AND qcbadocno = g_qcba_m.qcbadocno    
      IF SQLCA.SQLCODE OR SQLCA.SQLERRD[3] = 0 THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = ''
         LET g_errparam.code   = STATUS 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()   
      END IF       
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_input_qcba027" order="54" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_input_qcba027()
 CALL aqct300_set_entry('')
 CALL aqct300_set_no_entry('')
     DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM) 
        INPUT BY NAME g_qcba_m.qcba027 ATTRIBUTE(WITHOUT DEFAULTS)
           AFTER FIELD qcba027
               IF g_qcba_m.qcba027 > g_qcba_m.qcba017 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'aqc-00053'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_qcba_m.qcba027 = g_qcba_m_t.qcba027
                  NEXT FIELD CURRENT
               END IF
        END INPUT
        
      ON ACTION accept
         #add-point:input段accept
         
         #end add-point    
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
      
      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
      
      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE 
         EXIT DIALOG
     END DIALOG
     
   IF INT_FLAG THEN
      LET INT_FLAG = FALSE
      RETURN 
   ELSE
      UPDATE qcba_t SET qcba027 = g_qcba_m.qcba027
                  WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
      IF SQLCA.SQLCODE OR SQLCA.SQLERRD[3] = 0 THEN
         RETURN 
      END IF
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_rmake_detail" order="55" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_rmake_detail()
DEFINE l_n LIKE type_t.num5
   LET l_n = 0 
   SELECT COUNT(1) INTO l_n FROM qcbd_t
    WHERE qcbdent = g_enterprise 
      AND qcbddocno = g_qcba_m.qcbadocno
   IF l_n > 0 THEN
      IF cl_ask_confirm("aqc-00096") THEN
         DELETE FROM qcbd_t WHERE qcbdent = g_enterprise
            AND qcbddocno = g_qcba_m.qcbadocno
          IF NOT aqct300_qcba030_insert() THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = SQLCA.sqlcode
             LET g_errparam.extend = "g_qcba_m"
             LET g_errparam.popup = TRUE
             CALL cl_err()
  
             RETURN
          END IF
          IF NOT aqct300_qcbd_insert() THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = SQLCA.sqlcode
             LET g_errparam.extend = "g_qcbd_d"
             LET g_errparam.popup = TRUE
             CALL cl_err()
  
             RETURN
          ELSE
             CALL aqct300_b_fill()
             DISPLAY ARRAY g_qcbd_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) 
                BEFORE DISPLAY 
                   EXIT DISPLAY
             END DISPLAY 
             
             #DISPLAY ARRAY g_qcbd6_d TO s_detail6.* ATTRIBUTES(COUNT=g_rec_b)  #160607-00004#1 mark
             DISPLAY ARRAY g_qcbd99_d TO s_detail99.* ATTRIBUTES(COUNT=g_rec_b) #160607-00004#1 add
                BEFORE DISPLAY 
                   EXIT DISPLAY
             END DISPLAY 
          END IF
      END IF
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc002_ref" order="56" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc002_ref(p_qcbc002,p_cmd)
DEFINE p_qcbc002     LIKE qcbc_t.qcbc002
DEFINE l_qcao001     LIKE qcao_t.qcao001   
DEFINE l_slip        STRING
DEFINE l_success     LIKE type_t.num5
DEFINE p_cmd         LIKE type_t.chr1
   LET l_qcao001 = g_qcaz001
   SELECT qcao003,qcao004 INTO g_qcbd5_d[l_ac].qcbc012,g_qcbd5_d[l_ac].qcbc013
     FROM qcao_t WHERE qcaoent = g_enterprise AND qcao001 = l_qcao001
      AND qcao002 = p_qcbc002
   DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc012,g_qcbd5_d[l_ac].qcbc013
   IF NOT cl_null(g_qcba_m.qcbadocno) THEN    #160304-00005#1 add
      CALL s_aooi200_get_slip(g_qcba_m.qcbadocno) RETURNING l_success,l_slip
   END IF                                     #160304-00005#1 add
   IF l_success THEN
      IF NOT cl_null(g_qcbd5_d[l_ac].qcbc012) AND g_qcbd5_d[l_ac].qcbc012 = '2' AND p_cmd = 'a' THEN
         CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0026') RETURNING g_qcbd5_d[l_ac].qcbc005
         CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0027') RETURNING g_qcbd5_d[l_ac].qcbc006
      END IF
      IF NOT cl_null(g_qcbd5_d[l_ac].qcbc012) AND g_qcbd5_d[l_ac].qcbc012 = '3' AND p_cmd = 'a' THEN
         CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0028') RETURNING g_qcbd5_d[l_ac].qcbc005
         CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0029') RETURNING g_qcbd5_d[l_ac].qcbc006
      END IF
      DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_data_exists" order="57" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#判断时候已经有入库或验退单据
PRIVATE FUNCTION aqct300_data_exists()
DEFINE l_n LIKE type_t.num5
   CASE g_qcba_m.qcba000 
      WHEN '1' 
         LET l_n = 0
         SELECT COUNT(1) INTO l_n FROM pmds_t,pmdt_t
          WHERE pmdsent = g_enterprise AND pmdsent = pmdtent AND pmdsdocno = pmdtdocno
            AND pmds006 = g_qcba_m.qcba001 AND pmds000 IN ('5','6') AND pmdsstus <> 'X' AND pmdt028 = g_qcba_m.qcba002
            AND pmdt081 = g_qcba_m.qcbadocno #160304-00014#1 add
         IF l_n > 0 THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = "aqc-00098"
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            RETURN FALSE
         END IF
      WHEN '2'
         LET l_n = 0
         SELECT COUNT(1) INTO l_n FROM sfec_t WHERE sfecent = g_enterprise
            AND sfecdocno = g_qcba_m.qcba001 AND sfecseq = g_qcba_m.qcba002 
            AND sfec002 = g_qcba_m.qcbadocno
         IF l_n > 0 THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = "aqc-00099"
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            RETURN FALSE
         END IF
      WHEN '4'
         LET l_n = 0
         SELECT COUNT(1) INTO l_n FROM xmdk_t,xmdl_t
          WHERE xmdkent = g_enterprise AND xmdkent = xmdlent AND xmdkdocno = xmdldocno
            AND xmdkdocno = g_qcba_m.qcba001 AND xmdk000 IN ('4','5','6') AND xmdkstus <> 'X' AND xmdl002 = g_qcba_m.qcba002
         IF l_n > 0 THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = "aqc-00104"
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            RETURN FALSE
         END IF
             
       WHEN '5'
          CASE WHEN g_qcba_m.qcba031 MATCHES '[12]'
                  LET l_n = 0
                  SELECT COUNT(1) INTO l_n FROM inba_t WHERE inbaent = g_enterprise
                     AND inbadocno = g_qcba_m.qcba001 AND inbastus = 'S'
                  IF l_n > 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "aqc-00101"
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     RETURN FALSE
                  END IF
                  
                  
                  #160318-00033#1 mark(s)
#                  LET l_n = 0
#                  SELECT COUNT(1) INTO l_n FROM inbc_t WHERE inbcent = g_enterprise
#                     AND inbcdocno = g_qcba_m.qcba001 AND inbcseq = g_qcba_m.qcba002
#                  IF l_n > 0 THEN
#                     INITIALIZE g_errparam TO NULL 
#                     LET g_errparam.extend = "" 
#                     LET g_errparam.code   = "aqc-00108"
#                     LET g_errparam.popup  = TRUE 
#                     CALL cl_err()
#                     RETURN FALSE
#                  END IF
                  #160318-00033#1 mark(e)
               WHEN g_qcba_m.qcba031 MATCHES '[34]'
                  LET l_n = 0
                  SELECT COUNT(1) INTO l_n FROM indc_t WHERE indcent = g_enterprise
                     AND indcdocno = g_qcba_m.qcba001 AND indcstus = 'S'
                  IF l_n > 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "aqc-00102"
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     RETURN FALSE
                  END IF
               WHEN g_qcba_m.qcba031 = '5'
                  LET l_n = 0
                  SELECT COUNT(1) INTO l_n FROM inbi_t WHERE inbient = g_enterprise
                     AND inbidocno = g_qcba_m.qcba001 AND inbistus = 'S'
                  IF l_n > 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "aqc-00103"
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     RETURN FALSE
                  END IF
           END CASE
   END CASE
   
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_xbar" order="58" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#获取xbar平均值
PRIVATE FUNCTION aqct300_get_xbar()
DEFINE l_qcbg002_sum  LIKE qcbg_t.qcbg002
DEFINE l_xbar  LIKE qcbg_t.qcbg002
DEFINE l_cnt   LIKE type_t.num5
   LET l_cnt = 0
   LET l_qcbg002_sum = 0
   
   SELECT COUNT(qcbg002),SUM(qcbg002) INTO l_cnt,l_qcbg002_sum FROM qcbg_t
    WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
      AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq #AND qcbg003 = 'Y'
   LET l_xbar = l_qcbg002_sum / l_cnt  #得出xbar平均值
   RETURN l_xbar   
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_standard_deviation" order="59" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#获取标准差
PRIVATE FUNCTION aqct300_get_standard_deviation(p_xbar)
DEFINE l_sd     LIKE qcbg_t.qcbg002 
DEFINE l_sql   STRING
#DEFINE l_qcbg  RECORD LIKE qcbg_t.*  #161124-00048#10 mark 
#161124-00048#10 add(s)
DEFINE l_qcbg RECORD  #品質檢驗測量值檔
       qcbgent LIKE qcbg_t.qcbgent, #企业编号
       qcbgsite LIKE qcbg_t.qcbgsite, #营运据点
       qcbgdocno LIKE qcbg_t.qcbgdocno, #单号
       qcbgseq LIKE qcbg_t.qcbgseq, #行序
       qcbg001 LIKE qcbg_t.qcbg001, #序号
       qcbg002 LIKE qcbg_t.qcbg002, #测量值
       qcbg003 LIKE qcbg_t.qcbg003  #合格
END RECORD
#161124-00048#10 add(e)
DEFINE l_cnt   LIKE type_t.num5
DEFINE p_xbar  LIKE qcbg_t.qcbg002
#   LET l_sql = "SELECT * FROM qcbg_t WHERE qcbgent = ",g_enterprise, #161124-00048#10 mark 
    #161124-00048#10 add(s)
    LET l_sql = "SELECT qcbgent,qcbgsite,qcbgdocno,qcbgseq,qcbg001,qcbg002,qcbg003", 
                "  FROM qcbg_t WHERE qcbgent = ",g_enterprise,
    #161124-00048#10 add(e)
               "   AND qcbgdocno = '",g_qcba_m.qcbadocno,"'",
               "   AND qcbgseq = ",g_qcbd_d[g_detail_idx].qcbdseq
   PREPARE sel_qcbg_prep1 FROM l_sql
   DECLARE sel_qcbg_curs1 CURSOR FOR sel_qcbg_prep1

   LET l_cnt = 0
   LET l_sd = 0   #标准差
   FOREACH sel_qcbg_curs1 INTO l_qcbg.*
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()
      
         EXIT FOREACH
      END IF
    #  IF l_qcbg.qcbg003 = 'Y' THEN
         LET l_sd = l_sd + (l_qcbg.qcbg002 - p_xbar) * (l_qcbg.qcbg002 - p_xbar)
         LET l_cnt = l_cnt + 1
     # END IF
   END FOREACH
   LET l_sd = l_sd / l_cnt
   LET l_sd = util.Math.sqrt(l_sd)
   
   RETURN l_sd
END FUNCTION]]>
</point>
  <point name="function.aqct300_u_k" order="60" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#检测上限判断K法
PRIVATE FUNCTION aqct300_u_k(p_xbar,p_sd)
DEFINE p_xbar LIKE qcbg_t.qcbg002
DEFINE p_sd   LIKE qcbg_t.qcbg002
   #IF (g_qcbd6_d[g_detail_idx].qcbd013 - p_xbar) / p_sd >= g_qcbd_d[g_detail_idx].qcbd007 THEN #160607-00004#1 mark
   IF (g_qcbd99_d[g_detail_idx].qcbd013 - p_xbar) / p_sd >= g_qcbd_d[g_detail_idx].qcbd007 THEN #160607-00004#1 add
      RETURN TRUE
   ELSE
      RETURN FALSE
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_l_k" order="61" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#检测下限判断K法
PRIVATE FUNCTION aqct300_l_k(p_xbar,p_sd)
DEFINE p_xbar LIKE qcbg_t.qcbg002
DEFINE p_sd   LIKE qcbg_t.qcbg002
   #IF (p_xbar - g_qcbd6_d[g_detail_idx].qcbd015) / p_sd >= g_qcbd_d[g_detail_idx].qcbd007 THEN #160607-00004#1 mark
   IF (p_xbar - g_qcbd99_d[g_detail_idx].qcbd015) / p_sd >= g_qcbd_d[g_detail_idx].qcbd007 THEN #160607-00004#1 add
      RETURN TRUE
   ELSE
      RETURN FALSE
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_u_l_f" order="62" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#检测上下限F法标
PRIVATE FUNCTION aqct300_u_l_f(p_sd)
DEFINE p_sd   LIKE qcbg_t.qcbg002
   #IF p_sd / (g_qcbd6_d[g_detail_idx].qcbd013 - g_qcbd6_d[g_detail_idx].qcbd015) <= g_qcbd_d[g_detail_idx].qcbd008 THEN  #160607-00004#1 mark
   IF p_sd / (g_qcbd99_d[g_detail_idx].qcbd013 - g_qcbd99_d[g_detail_idx].qcbd015) <= g_qcbd_d[g_detail_idx].qcbd008 THEN #160607-00004#1 add
      RETURN TRUE
   ELSE
      RETURN FALSE
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_input_qcbd5" order="63" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#单独维护联产品与结果判定页签
PRIVATE FUNCTION aqct300_input_qcbd5(l_cmd)
   DEFINE  p_cmd                 LIKE type_t.chr1
   DEFINE  l_cmd_t               LIKE type_t.chr1
   DEFINE  l_cmd                 LIKE type_t.chr1
   DEFINE  l_n                   LIKE type_t.num5                #檢查重複用  
   DEFINE  l_cnt                 LIKE type_t.num5                #檢查重複用  
   DEFINE  l_lock_sw             LIKE type_t.chr1                #單身鎖住否  
   DEFINE  l_allow_insert        LIKE type_t.num5                #可新增否 
   DEFINE  l_allow_delete        LIKE type_t.num5                #可刪除否  
   DEFINE  l_count               LIKE type_t.num5
   DEFINE  l_i                   LIKE type_t.num5
   DEFINE  l_insert              BOOLEAN
   DEFINE  ls_return             STRING
   DEFINE  l_var_keys            DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys          DYNAMIC ARRAY OF STRING
   DEFINE  l_vars                DYNAMIC ARRAY OF STRING
   DEFINE  l_fields              DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak        DYNAMIC ARRAY OF STRING
   DEFINE  lb_reproduce          BOOLEAN
   DEFINE  li_reproduce          LIKE type_t.num5
   DEFINE  li_reproduce_target   LIKE type_t.num5
   DEFINE  ls_keys               DYNAMIC ARRAY OF VARCHAR(500)   
    DEFINE  l_ooef004       LIKE ooef_t.ooef004
   DEFINE  l_rate_qcbc009  LIKE qcbc_t.qcbc009
   DEFINE  l_qcbc009       LIKE qcbc_t.qcbc009
   DEFINE  l_qcba023       LIKE qcba_t.qcba023
#   DEFINE  l_qcbc   RECORD LIKE qcbc_t.* #161124-00048#10 mark
   #161124-00048#10 add(s)
   DEFINE l_qcbc RECORD  #品質檢驗判定結果檔
       qcbcent LIKE qcbc_t.qcbcent, #企业编号
       qcbcsite LIKE qcbc_t.qcbcsite, #营运据点
       qcbcdocno LIKE qcbc_t.qcbcdocno, #单号
       qcbcseq LIKE qcbc_t.qcbcseq, #行序
       qcbc001 LIKE qcbc_t.qcbc001, #类型
       qcbc002 LIKE qcbc_t.qcbc002, #判定结果编号
       qcbc003 LIKE qcbc_t.qcbc003, #料件编号
       qcbc004 LIKE qcbc_t.qcbc004, #产品特征
       qcbc005 LIKE qcbc_t.qcbc005, #库位
       qcbc006 LIKE qcbc_t.qcbc006, #储位
       qcbc007 LIKE qcbc_t.qcbc007, #批号
       qcbc008 LIKE qcbc_t.qcbc008, #单位
       qcbc009 LIKE qcbc_t.qcbc009, #判定数量
       qcbc010 LIKE qcbc_t.qcbc010, #已入库数
       qcbc011 LIKE qcbc_t.qcbc011, #库存备注
       qcbc012 LIKE qcbc_t.qcbc012, #判定区分
       qcbc013 LIKE qcbc_t.qcbc013  #处理方式
   END RECORD
   #161124-00048#10 add(e)
   DEFINE  l_success       LIKE type_t.num5
   DEFINE  l_rate          LIKE type_t.num20_6
   DEFINE  l_bad_num       LIKE type_t.num5
   DEFINE  l_qcba015       STRING
   DEFINE  l_qcba025       STRING
   DEFINE  l_qcba015_1       LIKE type_t.num5
   DEFINE  l_qcba015_2       LIKE type_t.num5
   DEFINE  l_qcba015_3       LIKE type_t.chr10
   DEFINE  l_qcba015_4       LIKE type_t.chr10
   DEFINE  l_qcba025_1       LIKE type_t.num5
   DEFINE  l_qcba025_2       LIKE type_t.num5
   DEFINE  l_qcba025_3       LIKE type_t.chr10
   DEFINE  l_qcba025_4       LIKE type_t.chr10   
   DEFINE  l_hour_top        LIKE type_t.num5
   DEFINE  l_minute_top      LIKE type_t.num5
   DEFINE  l_max_qcbe002     LIKE qcbe_t.qcbe002
   DEFINE  l_qcbd011         LIKE qcbd_t.qcbd011
   DEFINE  l_max_qcbe004     LIKE qcbe_t.qcbe004
   DEFINE  l_qcan015       LIKE qcan_t.qcan015
#   DEFINE  l_qcbd      RECORD LIKE qcbd_t.*  #161124-00048#10 mark 没有用到
   DEFINE  l_qcbd021       LIKE qcbd_t.qcbd021
   DEFINE  l_sum_qcbe002   LIKE qcbe_t.qcbe002
   DEFINE  l_xbar          LIKE qcbg_t.qcbg002
   DEFINE  l_sd            LIKE qcbg_t.qcbg002
   DEFINE  l_cnt_old       LIKE type_t.num5
   DEFINE  l_cnt_n_old     LIKE type_t.num5
   DEFINE  l_cnt_new       LIKE type_t.num5
   DEFINE  l_cnt_n_new     LIKE type_t.num5
   
   LET g_forupd_sql = "SELECT qcbcseq,qcbc001,qcbc002,qcbc012,qcbc013,qcbc003,qcbc004,qcbc005,qcbc006, 
       qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbcsite FROM qcbc_t WHERE qcbcent=? AND qcbcdocno=?  
       AND qcbcseq=? FOR UPDATE"
   #add-point:input段define_sql

   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_bcl3_2 CURSOR FROM g_forupd_sql
   
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      INPUT ARRAY g_qcbd5_d FROM s_detail5.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = l_allow_insert, #此頁面insert功能由產生器控制, 手動之設定無效! 

                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 
         #自訂ACTION(detail_input,page_4)
         
         
         BEFORE INPUT
            #add-point:資料輸入前

            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd5_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL aqct300_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_detail_idx)
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_qcbd5_d.getLength()
            #add-point:資料輸入前
            CALL aqct300_qcbc001_scc()
            #end add-point
            
         BEFORE INSERT
            
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_qcbd5_d[l_ac].* TO NULL 
            INITIALIZE g_qcbd5_d_t.* TO NULL 
            INITIALIZE g_qcbd5_d_o.* TO NULL 
            #公用欄位給值(單身4)
            
            #自定義預設值(單身4)
                  LET g_qcbd5_d[l_ac].qcbc001 = "0"
 
            #add-point:modify段before備份

            #end add-point
            LET g_qcbd5_d_t.* = g_qcbd5_d[l_ac].*     #新輸入資料
            LET g_qcbd5_d_o.* = g_qcbd5_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aqct300_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b

            #end add-point
            CALL aqct300_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_qcbd5_d[li_reproduce_target].* = g_qcbd5_d[li_reproduce].*
 
               LET g_qcbd5_d[li_reproduce_target].qcbcseq = NULL
            END IF
            
            #add-point:modify段before insert
            SELECT MAX(qcbcseq) + 1 INTO g_qcbd5_d[l_ac].qcbcseq FROM qcbc_t
             WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
            IF cl_null(g_qcbd5_d[l_ac].qcbcseq) THEN LET g_qcbd5_d[l_ac].qcbcseq = 1 END IF
            IF g_qcbd5_d[l_ac].qcbc001 = '0' THEN
               LET g_qcbd5_d[l_ac].qcbc003 = g_qcba_m.qcba010
               CALL aqct300_qcbc003_desc()
               LET g_qcbd5_d[l_ac].qcbc004 = g_qcba_m.qcba012   #160407-00024#1 add
               CALL s_feature_description(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) RETURNING g_success,g_qcbd5_d[l_ac].qcbc004_desc  #160407-00024#1 add
               DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004_desc #160407-00024#1 add
               CALL aqct300_set_entry_b(l_cmd)
               CALL aqct300_set_no_entry_b(l_cmd)
            END IF
            LET g_qcbd5_d[l_ac].qcbcsite = g_qcba_m.qcbasite
            LET g_qcbd5_d[l_ac].qcbc008 = g_qcba_m.qcba009
            CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
            #end add-point  
            
         BEFORE ROW     
            #add-point:modify段before row2

            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd5_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd5_d[l_ac].qcbcseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_qcbd5_d_t.* = g_qcbd5_d[l_ac].*  #BACKUP
               LET g_qcbd5_d_o.* = g_qcbd5_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b

               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               OPEN aqct300_bcl3_2 USING g_enterprise,
                                             g_qcba_m.qcbadocno,g_qcbd5_d[g_detail_idx].qcbcseq
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "aqct300_bcl3_2" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aqct300_bcl3_2 INTO g_qcbd5_d[l_ac].qcbcseq,g_qcbd5_d[l_ac].qcbc001,g_qcbd5_d[l_ac].qcbc002, 
                      g_qcbd5_d[l_ac].qcbc012,g_qcbd5_d[l_ac].qcbc013,g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004, 
                      g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_qcbd5_d[l_ac].qcbc008, 
                      g_qcbd5_d[l_ac].qcbc009,g_qcbd5_d[l_ac].qcbc010,g_qcbd5_d[l_ac].qcbc011,g_qcbd5_d[l_ac].qcbcsite 

                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = '' 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row

            #end add-point  
            #其他table資料備份(確定是否更改用)
            
            #其他table進行lock
            
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d)

               #end add-point
            ELSE
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身4刪除前

               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_qcba_m.qcbadocno
               LET gs_keys[gs_keys.getLength()+1] = g_qcbd5_d_t.qcbcseq
            
               #刪除同層單身
               IF NOT aqct300_delete_b('qcbc_t',gs_keys,"'4'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT aqct300_key_delete_b(gs_keys,'qcbc_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
               
               #add-point:單身4刪除中

               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE aqct300_bcl
               LET g_rec_b = g_rec_b-1
               
               #add-point:單身4刪除後

               #end add-point
               LET l_count = g_qcbd_d.getLength()
               
               #add-point:單身刪除後(<>d)

               #end add-point
            END IF 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_qcbd5_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身4新增前
            IF cl_null(g_qcbd5_d[l_ac].qcbc002) THEN
               LET g_qcbd5_d[l_ac].qcbc002 = ' '
            END IF
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM qcbc_t 
             WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
               AND qcbcseq = g_qcbd5_d[l_ac].qcbcseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身4新增前

               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd5_d[g_detail_idx].qcbcseq
               CALL aqct300_insert_b('qcbc_t',gs_keys,"'4'")
                           
               #add-point:單身新增後4

               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               INITIALIZE g_qcbd_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbc_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')                    
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aqct300_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後

               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
               CLOSE aqct300_bcl3_2
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
            ELSE
               #add-point:單身page4修改前
               IF cl_null(g_qcbd5_d[l_ac].qcbc002) THEN
                  LET g_qcbd5_d[l_ac].qcbc002 = ' '
               END IF
               #end add-point
               
               #寫入修改者/修改日期資訊(單身4)
               
               
               UPDATE qcbc_t SET (qcbcdocno,qcbcseq,qcbc001,qcbc002,qcbc012,qcbc013,qcbc003,qcbc004, 
                   qcbc005,qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbcsite) = (g_qcba_m.qcbadocno, 
                   g_qcbd5_d[l_ac].qcbcseq,g_qcbd5_d[l_ac].qcbc001,g_qcbd5_d[l_ac].qcbc002,g_qcbd5_d[l_ac].qcbc012, 
                   g_qcbd5_d[l_ac].qcbc013,g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004,g_qcbd5_d[l_ac].qcbc005, 
                   g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_qcbd5_d[l_ac].qcbc008,g_qcbd5_d[l_ac].qcbc009, 
                   g_qcbd5_d[l_ac].qcbc010,g_qcbd5_d[l_ac].qcbc011,g_qcbd5_d[l_ac].qcbcsite) #自訂欄位頁簽 

                WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
                  AND qcbcseq = g_qcbd5_d_t.qcbcseq #項次 
                  
               #add-point:單身page4修改中

               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbc_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     CALL s_transaction_end('N','0')
                     LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbc_t" 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     CALL s_transaction_end('N','0')
                     LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
                  OTHERWISE
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd5_d[g_detail_idx].qcbcseq
               LET gs_keys_bak[2] = g_qcbd5_d_t.qcbcseq
               CALL aqct300_update_b('qcbc_t',gs_keys,gs_keys_bak,"'4'")
                     #資料多語言用-增/改
                     
               END CASE
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_qcbd5_d[g_detail_idx].qcbcseq = g_qcbd5_d_t.qcbcseq 
                  ) THEN
                  LET gs_keys[01] = g_qcba_m.qcbadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_qcbd5_d_t.qcbcseq
                  CALL aqct300_key_update_b(gs_keys,'qcbc_t')
               END IF
               
               #修改歷程記錄
               LET g_log1 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd5_d_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd5_d[l_ac])
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page4修改後

               #end add-point
            END IF
         

 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD qcbcseq
            
            #add-point:AFTER FIELD qcbcseq
            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd5_d[g_detail_idx].qcbcseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd5_d[g_detail_idx].qcbcseq != g_qcbd5_d_t.qcbcseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbc_t WHERE "||"qcbcent = '" ||g_enterprise|| "' AND "|| "qcbcdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbcseq = '"||g_qcbd5_d[g_detail_idx].qcbcseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF



         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE qcbc001
            #add-point:ON CHANGE qcbc001
            CALL aqct300_set_entry_b(l_cmd)
            CALL aqct300_set_no_entry_b(l_cmd)
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD qcbc002
            
            #add-point:AFTER FIELD qcbc002
            CALL aqct300_qcbc002_desc(g_qcbd5_d[l_ac].qcbc002)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc002) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcaz001
               LET g_chkparam.arg2 = g_qcbd5_d[l_ac].qcbc002

              #160318-00025#21  by 07900 --add-str
              LET g_errshow = TRUE #是否開窗                   
              LET g_chkparam.err_str[1] ="aqc-00030:sub-01302|aqci020|",cl_get_progname("aqci020",g_lang,"2"),"|:EXEPROGaqci020"
              #160318-00025#21  by 07900 --add-end    
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_qcao002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd5_d[l_ac].qcbc002 = g_qcbd5_d_t.qcbc002
                 
                  NEXT FIELD CURRENT
               END IF
#               IF l_cmd = 'a' OR (l_cmd = 'u' AND g_qcbd5_d_o.qcbc002 != g_qcbd5_d[l_ac].qcbc002) THEN
                  CALL aqct300_qcbc002_ref(g_qcbd5_d[l_ac].qcbc002,l_cmd)
#               END IF
            ELSE
               LET g_qcbd5_d[l_ac].qcbc012 = '4'
               LET g_qcbd5_d[l_ac].qcbc002 = ' '
            END IF 
#            LET g_qcbd5_d_o.qcbc002 = g_qcbd5_d[l_ac].qcbc002

            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD qcbc002
            #add-point:BEFORE FIELD qcbc002
             CALL aqct300_qcbc002_desc(g_qcbd5_d[l_ac].qcbc002)
            #END add-point

 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD qcbc003
            
            #add-point:AFTER FIELD qcbc003
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_qcbd5_d[l_ac].qcbc003
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_qcbd5_d[l_ac].qcbc003_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc003_desc
            
            
            CALL aqct300_set_entry_b(l_cmd)
            CALL aqct300_set_no_entry_b(l_cmd)
            #END add-point
         
          AFTER FIELD qcbc004
            
            #add-point:AFTER FIELD qcbc004 name="input.a.page5.qcbc004"
            #160407-00024#1 add(s)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc004) THEN
               IF NOT s_feature_check(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) THEN 
                  LET g_qcbd5_d[l_ac].qcbc004 = g_qcbd5_d_t.qcbc004
                  NEXT FIELD CURRENT
               END IF
            END IF
            CALL s_feature_description(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) RETURNING g_success,g_qcbd5_d[l_ac].qcbc004_desc  
            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004_desc 
            #160407-00024#1 add(e)
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc004
            #add-point:BEFORE FIELD qcbc004 name="input.b.page5.qcbc004"
            #160407-00024#1 add(s)
            
            IF s_feature_auto_chk(g_qcbd5_d[l_ac].qcbc003) AND cl_null(g_qcbd5_d[l_ac].qcbc004) THEN 
               CALL s_feature_single(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004,'ALL','') RETURNING l_success,g_qcbd5_d[l_ac].qcbc004
               DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004
            END IF
            CALL s_feature_description(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) RETURNING g_success,g_qcbd5_d[l_ac].qcbc004_desc  
            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004_desc 
            #160407-00024#1 add(e)
            #END add-point         

         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD qcbc005
            
            #add-point:AFTER FIELD qcbc005
            CALL aqct300_qcbc005_desc(g_qcbd5_d[l_ac].qcbc005)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc005) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcbasite
               LET g_chkparam.arg2 = g_qcbd5_d[l_ac].qcbc005

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_inaa001_1") THEN


               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd5_d[l_ac].qcbc005 = g_qcbd5_d_t.qcbc005
                  CALL aqct300_qcbc005_desc(g_qcbd5_d[l_ac].qcbc005)
                  NEXT FIELD CURRENT
               END IF
               IF s_lot_batch_number_1n3(g_qcbd5_d[l_ac].qcbc003,g_site) THEN #160314-00008#1 add
                  IF NOT s_lot_upd_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,0,'2',g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_site,' ') THEN
                     LET g_qcbd5_d[l_ac].qcbc005 = g_qcbd5_d_o.qcbc005
                     NEXT FIELD CURRENT
                  END IF
               END IF

            END IF 
            


 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD qcbc006
            
            #add-point:AFTER FIELD qcbc006
            CALL aqct300_qcbc006_desc(g_qcbd5_d[l_ac].qcbc006)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc006) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcbasite
               LET g_chkparam.arg2 = g_qcbd5_d[l_ac].qcbc005
               LET g_chkparam.arg3 = g_qcbd5_d[l_ac].qcbc006

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_inab002_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd5_d[l_ac].qcbc006 = g_qcbd5_d_t.qcbc006
                  CALL aqct300_qcbc006_desc(g_qcbd5_d[l_ac].qcbc006)
                  NEXT FIELD CURRENT
               END IF
               IF s_lot_batch_number_1n3(g_qcbd5_d[l_ac].qcbc003,g_site) THEN #160314-00008#1 add
                  IF NOT s_lot_upd_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,0,'2',g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_site,' ') THEN
                     LET g_qcbd5_d[l_ac].qcbc006 = g_qcbd5_d_o.qcbc006
                     NEXT FIELD CURRENT
                  END IF
               END IF

            END IF 
            
         AFTER FIELD qcbc007
            
            #add-point:AFTER FIELD qcbc007 name="input.a.page5.qcbc007"
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc007) AND (g_qcbd5_d[l_ac].qcbc007 != g_qcbd5_d_o.qcbc007 OR cl_null(g_qcbd5_d_o.qcbc007))THEN 
              #IF s_lot_batch_number(g_qcbd5_d[l_ac].qcbc003,g_site) THEN     #160314-00008#1 mark
               IF s_lot_batch_number_1n3(g_qcbd5_d[l_ac].qcbc003,g_site) THEN #160314-00008#1 add
                  IF NOT s_lot_upd_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,0,'2',g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_site,' ') THEN
                     LET g_qcbd5_d[l_ac].qcbc007 = g_qcbd5_d_o.qcbc007
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            LET g_qcbd5_d_o.qcbc007 = g_qcbd5_d[l_ac].qcbc007
  
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD qcbc008
            
            #add-point:AFTER FIELD qcbc008
            CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc008) THEN
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcbd5_d[l_ac].qcbc008
               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aim-00005:sub-01302|aooi250|",cl_get_progname("aooi250",g_lang,"2"),"|:EXEPROGaooi250"
               #160318-00025#21  by 07900 --add-end
               IF NOT cl_chk_exist("v_ooca001") THEN
                  LET g_qcbd5_d[l_ac].qcbc008 = g_qcbd5_d_t.qcbc008
                  CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
                  NEXT FIELD CURRENT
               ELSE
                  IF NOT aqct300_qcbc009_Compare() THEN
                     LET g_qcbd5_d[l_ac].qcbc008 = g_qcbd5_d_t.qcbc008
                     CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
                     NEXT FIELD CURRENT 
                  END IF                 
               END IF
            END IF
            
            #END add-point

 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD qcbc009
            
            #add-point:AFTER FIELD qcbc009
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc009) THEN
               #161124-00048#20 mark(s)
               #161129-00005#1-(S)-add
               IF NOT aqct300_qcbc009_sum_chk2(g_qcbd5_d[l_ac].qcbcseq,g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbc009) THEN
                  NEXT FIELD qcbc009
               END IF
               #161129-00005#1-(E)-add
               #161124-00048#20 mark(e)
               IF NOT aqct300_qcbc009_Compare() THEN
                  LET g_qcbd5_d[l_ac].qcbc009 = g_qcbd5_d_t.qcbc009
                  NEXT FIELD CURRENT 
               END IF
               IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq) THEN
                  NEXT FIELD CURRENT
               END IF
               IF l_cmd = 'a' THEN 
                  DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno
                     AND inaoseq = g_qcbd5_d[l_ac].qcbcseq
                  IF NOT s_aqct300_ins_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,'N') THEN
                     NEXT FIELD CURRENT
                  END IF
               END IF
               IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_qcbd5_d_o.qcbc009 != g_qcbd5_d[l_ac].qcbc009)) THEN
                  IF NOT aqct300_upd_inao(g_qcbd5_d[g_detail_idx].qcbcseq,g_qcbd5_d[g_detail_idx].qcbc009,g_qcbd5_d[g_detail_idx].qcbc004,
                                        g_qcbd5_d[g_detail_idx].qcbc005,g_qcbd5_d[g_detail_idx].qcbc006,g_qcbd5_d[g_detail_idx].qcbc007) THEN
                     IF l_cmd = 'a' THEN
                        DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno
                           AND inaoseq = g_qcbd5_d[l_ac].qcbcseq
                        
                     END IF
                     IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq) THEN
                        NEXT FIELD CURRENT
                     END IF
                     NEXT FIELD CURRENT
                  END IF
               END IF
               IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq) THEN
                  NEXT FIELD CURRENT
               END IF
            END IF
            #END add-point
            
 
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD qcbc002
            #add-point:ON ACTION controlp INFIELD qcbc002
#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc002             #給予default值
            LET  g_qryparam.arg1 = g_qcaz001
            #給予arg

            CALL q_qcao002_1()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc002 TO qcbc002              #顯示到畫面上

            NEXT FIELD qcbc002                          #返回原欄位


         #Ctrlp:input.c.page5.qcbc003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD qcbc003
            #add-point:ON ACTION controlp INFIELD qcbc003
#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc003             #給予default值

            #給予arg

            CALL q_imaa001()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc003 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc003 TO qcbc003              #顯示到畫面上

            NEXT FIELD qcbc003                          #返回原欄位


            #END add-point
    
         ON ACTION controlp INFIELD qcbc004
            #add-point:ON ACTION controlp INFIELD qcbc004 name="input.c.page5.qcbc004"
            CALL s_feature_single(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004,'ALL','') RETURNING l_success,g_qcbd5_d[l_ac].qcbc004
            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004

         ON ACTION controlp INFIELD qcbc005
            #add-point:ON ACTION controlp INFIELD qcbc005
#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc005             #給予default值
            LET g_qryparam.arg1 = g_qcba_m.qcbasite
            #給予arg

            CALL q_inaa001_6()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc005 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc005 TO qcbc005              #顯示到畫面上
            CALL aqct300_qcbc005_desc(g_qcbd5_d[l_ac].qcbc005)
            NEXT FIELD qcbc005                          #返回原欄位


            #END add-point
 
         #Ctrlp:input.c.page5.qcbc006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD qcbc006
            #add-point:ON ACTION controlp INFIELD qcbc006
#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc006             #給予default值
            LET g_qryparam.arg1 = g_qcba_m.qcbasite
            LET g_qryparam.arg2 = g_qcbd5_d[l_ac].qcbc005
            #給予arg

            CALL q_inab002_6()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc006 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc006 TO qcbc006              #顯示到畫面上
            CALL aqct300_qcbc006_desc(g_qcbd5_d[l_ac].qcbc006)
            NEXT FIELD qcbc006                          #返回原欄位


         #Ctrlp:input.c.page5.qcbc008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD qcbc008
            #add-point:ON ACTION controlp INFIELD qcbc008
#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc008             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc008 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc008 TO qcbc008              #顯示到畫面上
            CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
            NEXT FIELD qcbc008                          #返回原欄位


            #END add-point
 
         AFTER ROW
            #add-point:單身page4 after_row

            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
               END IF
               CLOSE aqct300_bcl3
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF
            
            #其他table進行unlock
            
            CLOSE aqct300_bcl3_2
            CALL s_transaction_end('Y','0')
            #add-point:單身page4 after_row2

            #end add-point
 
         AFTER INPUT
            #add-point:input段after input 
#161124-00048#10 mark(s)            
#            DECLARE sel_qcbc_cur2 CURSOR FOR 
##             SELECT * FROM qcbc_t WHERE qcbcent = g_enterprise #161124-00048#10 mark
#            #161124-00048#10 add(s)
#              SELECT qcbcent,qcbcsite,qcbcdocno,qcbcseq,qcbc001,qcbc002,qcbc003,qcbc004,
#                     qcbc005,qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbc012,qcbc013 
#               FROM qcbc_t WHERE qcbcent = g_enterprise
#            #161124-00048#10 add(e)
#                AND qcbcdocno = g_qcba_m.qcbadocno
#            LET l_qcbc009 = 0   #SUM 單身的數量
#            LET l_qcba023 = 0
#            LET l_cnt = 0
#            FOREACH sel_qcbc_cur2 INTO l_qcbc.* 
#               IF STATUS THEN
#                  INITIALIZE g_errparam TO NULL
#                  LET g_errparam.code = STATUS
#                  LET g_errparam.extend = ''
#                  LET g_errparam.popup = TRUE
#                  CALL cl_err()
#
#                  EXIT FOREACH
#               END IF
#               LET l_rate_qcbc009 = 0
#               IF NOT cl_null(l_qcbc.qcbc008) AND l_qcbc.qcbc008 != g_qcba_m.qcba016 THEN
#                  CALL s_aimi190_get_convert(l_qcbc.qcbc003,l_qcbc.qcbc008,g_qcba_m.qcba016) RETURNING l_success,l_rate
#                  IF l_success  THEN
#                     LET l_rate_qcbc009 = l_qcbc.qcbc009 * l_rate   #換算後的數量
#                     LET l_qcbc.qcbc009 = 0
#                  END IF
#               END IF   
#               LET l_qcbc009 = l_qcbc009 + l_qcbc.qcbc009 + l_rate_qcbc009
#               IF l_qcbc.qcbc012 MATCHES '[123]' THEN
#                  LET l_qcba023 = l_qcba023 + l_qcbc.qcbc009 + l_rate_qcbc009    #計算單頭合格量
#               END IF
#               LET l_cnt = l_cnt + 1
#            END FOREACH
#            IF l_cnt > 0 THEN
#               IF l_qcbc009 != g_qcba_m.qcba017 THEN
#                  INITIALIZE g_errparam TO NULL
#                  LET g_errparam.code = 'aqc-00065'
#                  LET g_errparam.extend = ''
#                  LET g_errparam.popup = TRUE
#                  CALL cl_err()
#               
#                  NEXT FIELD CURRENT
#               END IF 
#            END IF
#161124-00048#10  mark(e)
            #161124-00048#10 add(s)  管控联产品判断结果页签数量与单头送验量一致
            IF NOT aqct300_qcbc009_sum_chk() THEN
               NEXT FIELD CURRENT
            END IF
            #161124-00048#10 add(e)
            #end add-point   
    
         ON ACTION controlo
            CALL FGL_SET_ARR_CURR(g_qcbd5_d.getLength()+1)
            LET lb_reproduce = TRUE
            LET li_reproduce = l_ac
            LET li_reproduce_target = g_qcbd5_d.getLength()+1
          
      END INPUT
      ON ACTION accept
         #161124-00048#10 add(s)
         IF NOT aqct300_qcbc009_sum_chk() THEN
            NEXT FIELD CURRENT
         END IF
         #161124-00048#10 add(e)
         ACCEPT DIALOG
      
      ON ACTION cancel      #在dialog button (放棄)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
      
      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
      
      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   END DIALOG
END FUNCTION]]>
</point>
  <point name="function.aqct300_scc_change" order="64" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_scc_change()
   IF g_qcba_m.qcba000 = '4' THEN
      CALL cl_set_combo_scc('qcba031','5061') 
   END IF
   
   IF g_qcba_m.qcba000 = '5' THEN
      CALL cl_set_combo_scc('qcba031','5060') 
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_oqc_chk" order="65" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#OQC的来源单据检验
PRIVATE FUNCTION aqct300_oqc_chk()
DEFINE l_slip  STRING
DEFINE l_docno  LIKE xmdh_t.xmdh001
DEFINE l_para   LIKE type_t.chr1
DEFINE l_para2  LIKE type_t.chr1
DEFINE l_xmdk000 LIKE xmdk_t.xmdk000 #檢查是否為無訂單出貨    #160319-00001#1  --- add
   IF g_qcba_m.qcba031 = '1' THEN
      SELECT xmdh001 INTO l_docno FROM xmdh_t
       WHERE xmdhent = g_enterprise AND xmdhdocno = g_qcba_m.qcba001
         AND xmdhseq = g_qcba_m.qcba002
      CALL s_aooi200_get_slip(l_docno) RETURNING g_success,l_slip
      IF g_success THEN
         LET l_para = cl_get_doc_para(g_enterprise,g_site,l_slip,'D-BAS-0094')
      ELSE
         RETURN FALSE
      END IF
      IF l_para = '2' THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'aqc-00114'
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
         RETURN FALSE
      END IF
   ELSE
      #160319-00001#1  By Ann_Huang  --- add Start ---      
      SELECT xmdk000 INTO l_xmdk000 FROM xmdk_t
      WHERE xmdkent = g_enterprise      
         AND xmdkdocno = g_qcba_m.qcba001     
      IF cl_null(l_xmdk000) THEN LET l_xmdk000 = ' ' END IF      
      #160319-00001#1  By Ann_Huang  --- add End ---
      IF l_xmdk000 <> '2' THEN    #非無訂單出貨  #160319-00001#1  --- add
         SELECT xmdl003 INTO l_docno FROM xmdl_t
          WHERE xmdlent = g_enterprise AND xmdldocno = g_qcba_m.qcba001
            AND xmdlseq = g_qcba_m.qcba002
           CALL s_aooi200_get_slip(l_docno) RETURNING g_success,l_slip
         IF g_success THEN
            LET l_para = cl_get_doc_para(g_enterprise,g_site,l_slip,'D-BAS-0077')
         ELSE
            RETURN FALSE
         END IF   
         IF l_para = 'Y' THEN
            LET l_para2 = cl_get_doc_para(g_enterprise,g_site,l_slip,'D-BAS-0094')
            IF l_para2 = '1' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'aqc-00115'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()
               RETURN FALSE
            END IF
         END IF
      END IF   #160319-00001#1  --- add
   END IF
   
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc003_desc" order="66" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_qcbc003_desc()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_qcbd5_d[l_ac].qcbc003
   CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_qcbd5_d[l_ac].qcbc003_desc = '', g_rtn_fields[1] , ''
   LET g_qcbd5_d[l_ac].qcbc003_desc_desc = g_rtn_fields[2]
   DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc003_desc,g_qcbd5_d[l_ac].qcbc003_desc_desc
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc009_sum_chk" order="67" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#检查qcbc009 合格数量的综合于单头送验量是否一致
PRIVATE FUNCTION aqct300_qcbc009_sum_chk()
   DEFINE  l_rate_qcbc009  LIKE qcbc_t.qcbc009
   DEFINE  l_qcbc009       LIKE qcbc_t.qcbc009
#   DEFINE  l_qcbc   RECORD LIKE qcbc_t.* #161124-00048#10 mark
   #161124-00048#10 add(s)
   DEFINE l_qcbc RECORD  #品質檢驗判定結果檔
       qcbcent LIKE qcbc_t.qcbcent, #企业编号
       qcbcsite LIKE qcbc_t.qcbcsite, #营运据点
       qcbcdocno LIKE qcbc_t.qcbcdocno, #单号
       qcbcseq LIKE qcbc_t.qcbcseq, #行序
       qcbc001 LIKE qcbc_t.qcbc001, #类型
       qcbc002 LIKE qcbc_t.qcbc002, #判定结果编号
       qcbc003 LIKE qcbc_t.qcbc003, #料件编号
       qcbc004 LIKE qcbc_t.qcbc004, #产品特征
       qcbc005 LIKE qcbc_t.qcbc005, #库位
       qcbc006 LIKE qcbc_t.qcbc006, #储位
       qcbc007 LIKE qcbc_t.qcbc007, #批号
       qcbc008 LIKE qcbc_t.qcbc008, #单位
       qcbc009 LIKE qcbc_t.qcbc009, #判定数量
       qcbc010 LIKE qcbc_t.qcbc010, #已入库数
       qcbc011 LIKE qcbc_t.qcbc011, #库存备注
       qcbc012 LIKE qcbc_t.qcbc012, #判定区分
       qcbc013 LIKE qcbc_t.qcbc013  #处理方式
   END RECORD
   #161124-00048#10 add(e)
   DEFINE  l_success       LIKE type_t.num5
   DEFINE  l_rate          LIKE type_t.num20_6  
   DEFINE  l_cnt           LIKE type_t.num10
   DECLARE sel_qcbc_cur CURSOR FOR 
#       SELECT * FROM qcbc_t WHERE qcbcent = g_enterprise #161124-00048#10 mark
      #161124-00048#10 add(s)
      SELECT qcbcent,qcbcsite,qcbcdocno,qcbcseq,qcbc001,qcbc002,qcbc003,qcbc004,qcbc005,
             qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbc012,qcbc013 
        FROM qcbc_t WHERE qcbcent = g_enterprise
      #161124-00048#10 add(e)
          AND qcbcdocno = g_qcba_m.qcbadocno
      LET l_qcbc009 = 0   #SUM 單身的數量
      LET l_cnt = 0
      FOREACH sel_qcbc_cur INTO l_qcbc.* 
         IF STATUS THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = STATUS
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
       
            EXIT FOREACH
         END IF
         LET l_rate_qcbc009 = 0
         IF NOT cl_null(l_qcbc.qcbc008) AND l_qcbc.qcbc008 != g_qcba_m.qcba016 THEN
            CALL s_aimi190_get_convert(l_qcbc.qcbc003,l_qcbc.qcbc008,g_qcba_m.qcba016) RETURNING l_success,l_rate
            IF l_success  THEN
               LET l_rate_qcbc009 = l_qcbc.qcbc009 * l_rate   #換算後的數量
               LET l_qcbc.qcbc009 = 0
            END IF
         END IF   
         LET l_qcbc009 = l_qcbc009 + l_qcbc.qcbc009 + l_rate_qcbc009
         LET l_cnt = l_cnt + 1
      END FOREACH
      IF l_cnt > 0 THEN
         IF l_qcbc009 != g_qcba_m.qcba017 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aqc-00065'
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            RETURN FALSE
         END IF 
      END IF
      RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_upd_inao" order="68" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_upd_inao(p_seq,p_qty,p_feature,p_stock,p_locat,p_lot)
DEFINE p_qty  LIKE inao_t.inao012   
DEFINE p_seq  LIKE qcbc_t.qcbcseq
DEFINE p_feature LIKE inao_t.inao002
DEFINE p_stock LIKE inao_t.inao005
DEFINE p_locat LIKE inao_t.inao006
DEFINE p_lot  LIKE inao_t.inao007
DEFINE l_imaf071 LIKE imaf_t.imaf071
DEFINE l_imaf081 LIKE imaf_t.imaf081
DEFINE l_inao013 LIKE inao_t.inao013
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0049') = 'Y' OR cl_get_para(g_enterprise,g_site,'S-BAS-0048') = 'Y' OR g_qcba_m.qcba000 MATCHES '[25]' THEN 
      CALL aqct300_get_imaf071_imaf081() RETURNING l_imaf071,l_imaf081
      IF l_imaf071 = '1' OR l_imaf081 = '1' THEN   #如果必须有制造批序号
#         IF g_qcba_m.qcba000 MATCHES '[125]' THEN
#            LET l_inao013 = 1
#            IF NOT s_aqct300_ins_inao(g_qcba_m.qcbadocno,p_seq,'Y') THEN
#               RETURN FALSE
#            END IF
#            IF NOT s_lot_sel('2','1',g_site,g_qcba_m.qcbadocno,p_seq,0,g_qcba_m.qcba010,p_feature,'',p_stock,p_locat,p_lot,g_qcba_m.qcba009,p_qty,1,g_prog,g_site,'','','',0) THEN
#               DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno AND inao000 = '1'
#               RETURN FALSE
#            ELSE
#               CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,g_inao013)
#            END IF
            
#         END IF
         
#         IF g_qcba_m.qcba000 = '4' THEN
#            LET l_inao013 = -1
#            IF NOT s_aqct300_ins_inao(g_qcba_m.qcbadocno,p_seq,'Y') THEN
#               RETURN FALSE
#            END IF
#            IF NOT s_lot_sel('2','1',g_site,g_qcba_m.qcbadocno,p_seq,0,g_qcba_m.qcba010,p_feature,'',p_stock,p_locat,p_lot,g_qcba_m.qcba009,p_qty,-1,g_prog,g_site,'','','',0) THEN
#               DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno AND inao000 = '1'
#               RETURN FALSE
#            ELSE
#               CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,g_inao013)
#            END IF
#         END IF
         IF NOT s_aqct300_ins_inao(g_qcba_m.qcbadocno,p_seq,'Y') THEN
            RETURN FALSE
         END IF
         IF NOT s_lot_sel('2','2',g_site,g_qcba_m.qcbadocno,p_seq,0,g_qcba_m.qcba010,p_feature,'',p_stock,p_locat,p_lot,g_qcba_m.qcba009,p_qty,g_inao013,g_prog,g_site,'','','',0) THEN
            DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno AND inao000 = '1'
            RETURN FALSE
         ELSE
            CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,g_inao013)
         END IF
         DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno AND inao000 = '1'
      END IF
   END IF
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_imaf071_imaf081" order="69" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_get_imaf071_imaf081()
DEFINE r_imaf071 LIKE imaf_t.imaf071
DEFINE r_imaf081 LIKE imaf_t.imaf081
   SELECT imaf071,imaf081 INTO r_imaf071,r_imaf081 FROM imaf_t 
    WHERE imafent = g_enterprise AND imafsite = g_site
      AND imaf001 = g_qcba_m.qcba010 
   RETURN r_imaf071,r_imaf081
END FUNCTION]]>
</point>
  <point name="function.aqct300_default_qc_values" order="70" ver="23" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 初始化画面预设值
#
PRIVATE FUNCTION aqct300_default_qc_values()
   CALL aqct300_get_qc_values()
   IF g_qcba_m.qcba017 <= 0 THEN             
      IF NOT (g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '3' AND g_qcba_m.qcba008 < 0) THEN   #160912-00021#3       
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'aqc-00086'
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
         LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
         RETURN FALSE
      END IF   #160912-00021#3
   END IF
   
   #160912-00021#3-s
   IF g_qcba_m.qcba017 >= 0 THEN 
      IF g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '3' AND g_qcba_m.qcba008 < 0 THEN      
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'aqc-00086'
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
         LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
         RETURN FALSE
      END IF     
   END IF
   #160912-00021#3-e
   
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_pqc_chk_1" order="71" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#单号+runcard校验
PRIVATE FUNCTION aqct300_pqc_chk_1()
  INITIALIZE g_chkparam.* TO NULL
  LET g_chkparam.arg1 = g_qcba_m.qcba001
  LET g_chkparam.arg2 = g_qcba_m.qcba029
  IF NOT cl_chk_exist("v_sfcbdocno_4") THEN
     RETURN FALSE
  END IF 
  RETURN TRUE  
END FUNCTION]]>
</point>
  <point name="function.aqct300_pqc_chk_2" order="72" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#校验工单+runcard+项次
PRIVATE FUNCTION aqct300_pqc_chk_2()
  INITIALIZE g_chkparam.* TO NULL
  LET g_chkparam.arg1 = g_qcba_m.qcba001
  LET g_chkparam.arg2 = g_qcba_m.qcba029
  LET g_chkparam.arg3 = g_qcba_m.qcba002
  IF NOT cl_chk_exist("v_sfcbdocno_3") THEN
     RETURN FALSE
  END IF 
  RETURN TRUE  
END FUNCTION]]>
</point>
  <point name="function.aqct300_get_inao013" order="73" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_get_inao013()
DEFINE l_indc102 LIKE indc_t.indc102   
   IF g_qcba_m.qcba000 MATCHES '[12]' THEN
      LET g_inao013 = 1
   END IF
   
   IF g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 MATCHES '[135]' THEN
      LET g_inao013 = -1
   END IF
   
   IF g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 MATCHES '[24]' THEN
      IF g_qcba_m.qcba031 = '4' THEN
         SELECT indc102 INTO l_indc102 FROM indc_t
          WHERE indcent = g_enterprise AND indcdocno = g_qcba_m.qcba001
         IF l_indc102 != '3' THEN
            LET g_inao013 = -1
         ELSE
            LET g_inao013 = 1
         END IF
      ELSE
         LET g_inao013 = 1
      END IF
      
   END IF
   
   IF g_qcba_m.qcba000 = '4' THEN
      LET g_inao013 = -1
   END IF
END FUNCTION]]>
</point>
  <point name="function.aqct300_default_qcbc" order="74" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aqct300_default_qcbc()
DEFINE l_sql STRING
DEFINE r_qcbc005 LIKE qcbc_t.qcbc005
DEFINE r_qcbc006 LIKE qcbc_t.qcbc006
DEFINE r_qcbc007 LIKE qcbc_t.qcbc007
#DEFINE l_indc RECORD LIKE indc_t.*   #161124-00048#10 mark
#161124-00048#10 add(s)
DEFINE l_indc RECORD  #調撥單單頭檔
       indcent LIKE indc_t.indcent, #企业编号
       indcsite LIKE indc_t.indcsite, #营运据点
       indcunit LIKE indc_t.indcunit, #应用组织
       indcdocno LIKE indc_t.indcdocno, #调拨单号
       indcdocdt LIKE indc_t.indcdocdt, #调拨日期
       indc000 LIKE indc_t.indc000, #单据性质
       indc001 LIKE indc_t.indc001, #对应调拨单号
       indc002 LIKE indc_t.indc002, #来源类别
       indc003 LIKE indc_t.indc003, #来源单号
       indc004 LIKE indc_t.indc004, #调拨人员
       indc005 LIKE indc_t.indc005, #拨出营运据点
       indc006 LIKE indc_t.indc006, #拨入营运据点
       indc007 LIKE indc_t.indc007, #在途仓
       indc008 LIKE indc_t.indc008, #备注
       indc021 LIKE indc_t.indc021, #拨出审核人员
       indc022 LIKE indc_t.indc022, #拨出审核日期
       indc023 LIKE indc_t.indc023, #拨入审核人员
       indc024 LIKE indc_t.indc024, #拨入审核日期
       indcstus LIKE indc_t.indcstus, #状态码
       indcownid LIKE indc_t.indcownid, #资料所有者
       indcowndp LIKE indc_t.indcowndp, #资料所有部门
       indccrtid LIKE indc_t.indccrtid, #资料录入者
       indccrtdp LIKE indc_t.indccrtdp, #资料录入部门
       indccrtdt LIKE indc_t.indccrtdt, #资料创建日
       indcmodid LIKE indc_t.indcmodid, #资料更改者
       indcmoddt LIKE indc_t.indcmoddt, #最近更改日
       indccnfid LIKE indc_t.indccnfid, #资料审核者
       indccnfdt LIKE indc_t.indccnfdt, #数据审核日
       indcpstid LIKE indc_t.indcpstid, #资料过账者
       indcpstdt LIKE indc_t.indcpstdt, #资料过账日
       indc101 LIKE indc_t.indc101, #调拨部门
       indc102 LIKE indc_t.indc102, #检验方式
       indc103 LIKE indc_t.indc103, #包装单制作
       indc104 LIKE indc_t.indc104, #Invoice制作
       indc105 LIKE indc_t.indc105, #送货地址
       indc106 LIKE indc_t.indc106, #运输方式
       indc107 LIKE indc_t.indc107, #起运地点
       indc108 LIKE indc_t.indc108, #到达地点
       indc109 LIKE indc_t.indc109, #在途非成本库位
       indc151 LIKE indc_t.indc151, #调拨理由
       indc199 LIKE indc_t.indc199, #调拨性质
       indc009 LIKE indc_t.indc009, #单一单位库存单位变更
       indc200 LIKE indc_t.indc200, #拨出仓库
       indc201 LIKE indc_t.indc201, #拨入仓库
       indc010 LIKE indc_t.indc010, #调整单号
       indc202 LIKE indc_t.indc202, #操作类型
       indc025 LIKE indc_t.indc025, #前端单号
       indc026 LIKE indc_t.indc026  #前端类型
END RECORD
#161124-00048#10 add(e)
   CASE 
#        WHEN g_qcba_m.qcba000 = '3'
#             LET l_sql = "SELECT sfaa006,'',sfaa009,sfcb050,sfcb052,sfaa010,sfaa011 FROM sfcb_t ",
#                         " LEFT OUTER JOIN sfaa_t ON sfaaent = sfcbent AND sfaadocno = sfcbdocno ",
##                         " LEFT OUTER JOIN sffb_t ON sffbent = sfcbent AND sffb005 = sfcbdocno AND sffb006 = sfcb001 AND sffb007 = sfcb003 AND sffb008 = sfcb004",
#                         " WHERE sfcbent = ",g_enterprise,
#                         "   AND sfcbdocno = '",g_qcba_m.qcba001,"'",
#                         "   AND sfcb002 = ",g_qcba_m.qcba002,
#                         "   AND sfcb001 = ",g_qcba_m.qcba029
        WHEN g_qcba_m.qcba000 MATCHES '[46]'
             IF g_qcba_m.qcba000 = '4' AND g_qcba_m.qcba031 = '1' THEN
                LET l_sql = "SELECT xmdh012,xmdh013,xmdh014 FROM xmdg_t,xmdh_t",
                            " WHERE xmdhent = ",g_enterprise," AND xmdhdocno = '",g_qcba_m.qcba001,"'",
                            "   AND xmdhseq = ",g_qcba_m.qcba002," AND xmdhent = xmdgent AND xmdhdocno = xmdgdocno"
             ELSE
                LET l_sql = "SELECT xmdl014,xmdl015,xmdl016 FROM xmdk_t,xmdl_t ",
                            " WHERE xmdlent = ",g_enterprise," AND xmdldocno = '",g_qcba_m.qcba001,"'",
                            "   AND xmdlseq = ",g_qcba_m.qcba002," AND xmdlent = xmdkent AND xmdldocno = xmdkdocno"
             END IF
           
        WHEN g_qcba_m.qcba000='5'
           CASE WHEN g_qcba_m.qcba031 = '1'
                    LET l_sql = "SELECT inbb007,inbb008,inbb009 FROM inbb_t ",
                                " WHERE inbbent = ",g_enterprise," AND inbbdocno = '",g_qcba_m.qcba001,"'",
                                "   AND inbbseq = ",g_qcba_m.qcba002
                                
                WHEN g_qcba_m.qcba031 MATCHES '[34]'
#                    SELECT * INTO l_indc.* FROM indc_t #161124-00048#10 mark
                    #161124-00048#10 add(s)
                    SELECT indcent,indcsite,indcunit,indcdocno,indcdocdt,indc000,
                           indc001,indc002,indc003,indc004,indc005,indc006,indc007,
                           indc008,indc021,indc022,indc023,indc024,indcstus,indcownid,
                           indcowndp,indccrtid,indccrtdp,indccrtdt,indcmodid,indcmoddt,
                           indccnfid,indccnfdt,indcpstid,indcpstdt,indc101,indc102,indc103,
                           indc104,indc105,indc106,indc107,indc108,indc109,indc151,indc199,
                           indc009,indc200,indc201,indc010,indc202,indc025,indc026
                      INTO l_indc.* FROM indc_t
                    ##161124-00048#10 add(e)
                     WHERE indcent = g_enterprise AND indcdocno = g_qcba_m.qcba001
                    IF (l_indc.indc000 = '1' OR l_indc.indc000 = '2') AND l_indc.indc102 = '2' THEN
                       LET l_sql = "SELECT indd022,indd023,indd024 FROM indd_t ",
                                   " WHERE inddent = ",g_enterprise," AND indddocno = '",g_qcba_m.qcba001,"'",
                                   "   AND inddseq = ",g_qcba_m.qcba002
                    END IF
                    
                    IF l_indc.indc000 = '3' AND l_indc.indc102 = '3' THEN
                        LET l_sql = "SELECT indd032,indd033,indd034 FROM indd_t ",
                                   " WHERE inddent = ",g_enterprise," AND indddocno = '",g_qcba_m.qcba001,"'",
                                   "   AND inddseq = ",g_qcba_m.qcba002
                    END IF
                WHEN g_qcba_m.qcba031 = '5'
                
                    LET l_sql = "SELECT inbj005,inbj006,inbj007 FROM inbj_t ",
                                " WHERE inbjent = ",g_enterprise," AND inbjdocno = '",g_qcba_m.qcba001,"'",
                                "   AND inbjseq = ",g_qcba_m.qcba002
           END CASE  
                 
   END CASE
   PREPARE get_values_pre2 FROM l_sql
   EXECUTE get_values_pre2 INTO r_qcbc005,r_qcbc006,r_qcbc007
   RETURN r_qcbc005,r_qcbc006,r_qcbc007
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbc009_sum_chk2" order="75" ver="28" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: #檢查qcbc009判定數量和是否超出單頭送驗量
# Memo...........:
# Usage..........: CALL aqct300_qcbc009_sum_chk2(p_qcbcseq,p_qcbadocno,p_qcbc009)
#                  RETURNING TRUE/FALSE
# Input parameter: p_qcbcseq     行序
#                : p_qcbadocno   檢驗單號
#                : p_qcbc009     目前當列輸入量
# Return code....: TRUE / FALSE
# Date & Author..: 2016/12/01 By Ann_Huang  #161129-00005#1 add
# Modify.........:
################################################################################
PRIVATE FUNCTION aqct300_qcbc009_sum_chk2(p_qcbcseq,p_qcbadocno,p_qcbc009)
   #161129-00005#1-(S)-add
   DEFINE p_qcbcseq        LIKE qcbc_t.qcbcseq
   DEFINE p_qcbadocno      LIKE qcba_t.qcbadocno
   DEFINE p_qcbc009        LIKE qcbc_t.qcbc009
   DEFINE l_qcbc009_sum    LIKE qcbc_t.qcbc009
   
   IF cl_null(p_qcbc009) THEN   LET p_qcbc009 = 0   END IF      
   #加總本身之外項目的判定數量
   SELECT SUM(qcbc009) INTO l_qcbc009_sum 
     FROM qcbc_t 
    WHERE qcbcent = g_enterprise
      AND qcbcdocno = p_qcbadocno
      AND qcbcseq   <> p_qcbcseq
       
   IF cl_null(l_qcbc009_sum) THEN
      LET l_qcbc009_sum = 0
   END IF
      
   IF (l_qcbc009_sum + p_qcbc009)  != g_qcba_m.qcba017 THEN      
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'aqc-00065'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
      RETURN FALSE
   END IF
   RETURN TRUE
   #161129-00005#1-(E)-add            
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd009_upd" order="76" ver="34" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 重新取得單身檢驗項目抽驗數量
# Memo...........:
# Usage..........: CALL aqct300_qcbc009_upd()
# Input parameter:
# Return code....: 
# Date & Author..: 2017/01/10 By ywtsai  #170109-00039#1 add
# Modify.........:
################################################################################
PRIVATE FUNCTION aqct300_qcbd009_upd()
   DEFINE l_qcbdent      LIKE qcbd_t.qcbdent
   DEFINE l_qcbdsite     LIKE qcbd_t.qcbdsite
   DEFINE l_qcbddocno    LIKE qcbd_t.qcbddocno
   DEFINE l_qcbdseq      LIKE qcbd_t.qcbdseq
   DEFINE l_qcbd001      LIKE qcbd_t.qcbd001
   DEFINE l_qcbd009      LIKE qcbd_t.qcbd009
   DEFINE l_sql          STRING
   DEFINE l_qcan013      LIKE qcan_t.qcan013
   DEFINE l_qcan014      LIKE qcan_t.qcan014
   DEFINE l_rate_qcbd009 LIKE qcbd_t.qcbd009
   DEFINE l_success      LIKE type_t.chr1

   LET l_sql = "SELECT qcbdent,qcbdsite,qcbddocno,qcbdseq,qcbd001,qcbd009",
               "  FROM qcbd_t",
               " WHERE qcbdent = '",g_enterprise,"'",
               "   AND qcbdsite = '",g_site,"'",
               "   AND qcbddocno = '",g_qcba_m.qcbadocno,"'",
               " ORDER BY qcbdseq"
   PREPARE aqct300_qcbd009_upd_pre FROM l_sql
   DECLARE aqct300_qcbd009_upd_cs CURSOR FOR aqct300_qcbd009_upd_pre

   FOREACH aqct300_qcbd009_upd_cs INTO l_qcbdent,l_qcbdsite,l_qcbddocno,l_qcbdseq,l_qcbd001,l_qcbd009 
      SELECT qcan013,qcan014 INTO l_qcan013,l_qcan014
        FROM qcan_t,qcam_t
       WHERE qcan001 = g_qcaz001
         AND qcanent = qcament
         AND qcam001 = qcan001
         AND qcan002 = qcam002
         AND qcan003 = qcam003
         AND qcan004 = qcam004
         AND qcan005 = qcam005
         AND qcan006 = qcam006
         AND qcan007 = qcam008
         AND qcan008 = qcam009
         AND qcanent = g_enterprise
         AND qcam010 = g_qcba_m.qcba030
         AND qcan010 = l_qcbd001
      
      CALL aqct300_qcbd009_result(l_qcan013,l_qcan014) RETURNING l_qcbd009
      IF NOT cl_null(l_qcbd009) THEN
         IF g_qcba_m.qcba009 <> g_qcba_m.qcba016 THEN
            LET l_rate_qcbd009 = 0
            CALL s_aooi250_convert_qty(g_qcba_m.qcba010,g_qcba_m.qcba009,g_qcba_m.qcba016,l_qcbd009)
                 RETURNING l_success,l_rate_qcbd009
            IF l_rate_qcbd009 <> 0 THEN
               LET l_qcbd009 = l_rate_qcbd009
            END IF
         END IF
      END IF

      UPDATE qcbd_t SET qcbd009 = l_qcbd009
       WHERE qcbdent = l_qcbdent
         AND qcbdsite = l_qcbdsite
         AND qcbddocno = l_qcbddocno
         AND qcbdseq = l_qcbdseq
         AND qcbd001 = l_qcbd001
   END FOREACH
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd013_qcbd015_chk" order="77" ver="37" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#170105-00062#1 add
PRIVATE FUNCTION aqct300_qcbd013_qcbd015_chk()
   IF NOT cl_null(g_qcbd99_d[l_ac].qcbd013) AND NOT cl_null(g_qcbd99_d[l_ac].qcbd015) THEN
      IF g_qcbd99_d[l_ac].qcbd013 < g_qcbd99_d[l_ac].qcbd015 THEN
         RETURN FALSE
      END IF
   END IF
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_qcbd012_qcbd016_chk" order="78" ver="37" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#170105-00062#1 add
PRIVATE FUNCTION aqct300_qcbd012_qcbd016_chk()
   IF NOT cl_null(g_qcbd99_d[l_ac].qcbd012) AND NOT cl_null(g_qcbd99_d[l_ac].qcbd016) THEN
      IF g_qcbd99_d[l_ac].qcbd012 < g_qcbd99_d[l_ac].qcbd016 THEN
         RETURN FALSE
      END IF
   END IF
   RETURN TRUE
END FUNCTION]]>
</point>
  <point name="function.aqct300_remarks" order="79" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#维护备注单身
#161031-00025#16 add
PRIVATE FUNCTION aqct300_remarks()
DEFINE l_sql      STRING

   IF g_qcba_m.qcbadocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()
      RETURN
   END IF
   
   LET l_sql = " SELECT qcbadocno,qcbadocdt,qcba900,qcba000,qcba031,qcba901,qcbasite, 
       qcba032,qcbastus,qcba001,qcba002,qcba029,qcba003,qcba004,qcba005,qcba006,qcba007,qcba008,qcba009, 
       qcba017,qcba010,qcba012,qcba013,qcba020,qcba021,qcba030,qcba024,qcba016,
       qcba022,qcba023,qcba027,qcba018,qcba019,qcba014,qcba015,qcba028,qcba025,qcba026,qcba033,qcbaownid, 
       qcbaowndp,qcbacrtid,qcbacrtdp,qcbacrtdt,qcbamodid,qcbamoddt,qcbacnfid,qcbacnfdt", 
        
                      " FROM qcba_t",
                      " WHERE qcbaent= ? AND qcbadocno=? FOR UPDATE"
   LET l_sql = cl_sql_forupd(l_sql)                #轉換不同資料庫語法
   LET l_sql = cl_sql_add_mask(l_sql)              #遮蔽特定資料
   DECLARE aqct300_ooff_cl CURSOR FROM l_sql
   
   CALL s_transaction_begin()
   
   OPEN aqct300_ooff_cl USING g_enterprise,g_qcba_m.qcbadocno

   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN aqct300_ooff_cl:"
      LET g_errparam.popup = TRUE
      CALL cl_err()
      CLOSE aqct300_ooff_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #鎖住將被更改的資料
   FETCH aqct300_ooff_cl INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite, 
       g_qcba_m.qcba032,g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009, 
       g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba016,
       g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018,g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033,g_qcba_m.qcbaownid, 
       g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt
   
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_qcba_m.qcbadocno
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      CLOSE aqct300_ooff_cl
      CALL s_transaction_end('N','0')
      RETURN 
   END IF
 
   #檢查是否允許此動作
   IF NOT aqct300_action_chk() THEN
      CLOSE aqct300_ooff_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #將資料顯示到畫面上
   DISPLAY BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite, 
       g_qcba_m.qcba032,g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009, 
       g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba016,
       g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018,g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033,g_qcba_m.qcbaownid, 
       g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt
 
   LET g_detail_insert = cl_auth_detail_input("insert")
   LET g_detail_delete = cl_auth_detail_input("delete")
   
   LET g_ooff001_d = '6'   #6.單據單頭備註
   LET g_ooff002_d = g_prog   
   LET g_ooff003_d = g_qcba_m.qcbadocno   #单号  
   LET g_ooff004_d = 0    #项次
   LET g_ooff005_d = ' '
   LET g_ooff006_d = ' '
   LET g_ooff007_d = ' '
   LET g_ooff008_d = ' '
   LET g_ooff009_d = ' '
   LET g_ooff010_d = ' '
   LET g_ooff011_d = ' '
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
      SUBDIALOG aoo_aooi360_01.aooi360_01_input   #备注单身
      
      ON ACTION accept  
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄) 
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail3",1)
 
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail3",1)
 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
    
   CLOSE aqct300_ooff_cl
   
   CALL s_transaction_end('Y','0')
   
   CALL aooi360_01_b_fill(g_ooff001_d,g_ooff002_d,g_ooff003_d,g_ooff004_d,g_ooff005_d,g_ooff006_d,g_ooff007_d,g_ooff008_d,g_ooff009_d,g_ooff010_d,g_ooff011_d)   #备注单身 
END FUNCTION]]>
</point>
  <point name="action_chk.action_chk" order="" ver="18" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #160818-00017#33-s
   SELECT qcbastus INTO g_qcba_m.qcbastus FROM qcba_t
    WHERE qcbaent = g_enterprise
      AND qcbasite = g_site
      AND qcbadocno = g_qcba_m.qcbadocno
   IF (g_action_choice="modify" OR g_action_choice="delete" OR g_action_choice="modify_detail")  THEN
     LET g_errno = NULL
     CASE g_qcba_m.qcbastus
        WHEN 'W'
           LET g_errno = 'sub-01347'
        WHEN 'X'
           LET g_errno = 'sub-00229'
        WHEN 'Y'
           LET g_errno = 'sub-00178'
     END CASE

     IF NOT cl_null(g_errno) THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = g_errno
        LET g_errparam.extend = g_qcba_m.qcbadocno
        LET g_errparam.popup = TRUE
        CALL cl_err()
        LET g_errno = NULL
        CALL aqct300_set_act_visible()
        CALL aqct300_set_act_no_visible()
        CALL aqct300_show()
        RETURN FALSE
     END IF
   END IF      
   #160818-00017#33-e]]>
</point>
  <point name="b_fill.body.fill_sql" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[         ]]>
</point>
  <point name="b_fill.define" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_success        LIKE type_t.num5 #161031-00025#16 add]]>
</point>
  <point name="b_fill.fill" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[         CALL aqct300_qcbd001_desc(g_qcbd_d[l_ac].qcbd001)
         #161031-00025#16 add(s)
         CALL s_aooi360_sel('7',g_prog,g_qcba_m.qcbadocno,g_qcbd_d[l_ac].qcbdseq,'','','','','','','','1') RETURNING l_success,g_qcbd_d[l_ac].ooff013
         #161031-00025#16 add(e)]]>
</point>
  <point name="b_fill.pre_function" order="" ver="6" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL s_lot_clear_detail()]]>
</point>
  <point name="b_fill.sql_before" order="" ver="40" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #CALL g_qcbd6_d.clear() #160607-00004#1 mark
   CALL g_qcbd99_d.clear() #160607-00004#1 add
   IF aqct300_fill_chk(1) THEN
      LET g_sql = "SELECT  UNIQUE qcbdseq,qcbd001,'',qcbd002,qcbd012,qcbd013,qcbd014,qcbd015,qcbd016,qcbd017,qcbd018,qcbd019 FROM qcbd_t",   
                  " INNER JOIN qcba_t ON qcbadocno = qcbddocno AND qcbaent=qcbdent ",
                  " WHERE qcbdent=? AND qcbddocno=?"
      
      IF NOT cl_null(g_wc2_table1) THEN
         LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
      END IF
      
      #子單身的WC
      
      
      LET g_sql = g_sql, " ORDER BY qcbd_t.qcbdseq"
      
      #add-point:單身填充控制
      
      #end add-point
      
      PREPARE aqct300_pb9 FROM g_sql
      DECLARE b_fill_cs9 CURSOR FOR aqct300_pb9
      
      LET g_cnt = l_ac
      LET l_ac = 1
      
      OPEN b_fill_cs9 USING g_enterprise,g_qcba_m.qcbadocno
      
      
                                               
      #FOREACH b_fill_cs9 INTO g_qcbd6_d[l_ac].qcbdseq_2,g_qcbd6_d[l_ac].qcbd001_2,g_qcbd6_d[l_ac].qcbd001_2_desc,g_qcbd6_d[l_ac].qcbd002_2,g_qcbd6_d[l_ac].qcbd012,g_qcbd6_d[l_ac].qcbd013,g_qcbd6_d[l_ac].qcbd014,g_qcbd6_d[l_ac].qcbd015,g_qcbd6_d[l_ac].qcbd016,g_qcbd6_d[l_ac].qcbd017,g_qcbd6_d[l_ac].qcbd018,g_qcbd6_d[l_ac].qcbd019              #160607-00004#1 mark
      FOREACH b_fill_cs9 INTO g_qcbd99_d[l_ac].qcbdseq_2,g_qcbd99_d[l_ac].qcbd001_2,g_qcbd99_d[l_ac].qcbd001_2_desc,g_qcbd99_d[l_ac].qcbd002_2,g_qcbd99_d[l_ac].qcbd012,g_qcbd99_d[l_ac].qcbd013,g_qcbd99_d[l_ac].qcbd014,g_qcbd99_d[l_ac].qcbd015,g_qcbd99_d[l_ac].qcbd016,g_qcbd99_d[l_ac].qcbd017,g_qcbd99_d[l_ac].qcbd018,g_qcbd99_d[l_ac].qcbd019   #160607-00004#1 add
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "FOREACH:"
            LET g_errparam.popup = TRUE
            CALL cl_err()
      
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充
         #CALL aqct300_qcbd001_2_desc(g_qcbd6_d[l_ac].qcbd001_2) #160607-00004#1 mark
         CALL aqct300_qcbd001_2_desc(g_qcbd99_d[l_ac].qcbd001_2) #160607-00004#1 add
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec AND g_error_show = 1 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code =  9035
            LET g_errparam.extend =  ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
      
            EXIT FOREACH
         END IF
         
      END FOREACH
      LET g_error_show = 0
      FREE aqct300_pb9
      LET l_ac = 1
   END IF]]>
</point>
  <point name="b_fill2.after_fill" order="" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #IF aqct300_fill_chk(6) THEN                                         #160607-00004#1 mark
      #IF (pi_idx = 6 OR pi_idx = 0) AND g_qcbd2_d.getLength() > 0 THEN #160607-00004#1 mark
   IF aqct300_fill_chk(99) THEN                                         #160607-00004#1 add
      IF (pi_idx = 99 OR pi_idx = 0) AND g_qcbd2_d.getLength() > 0 THEN #160607-00004#1 add
               CALL g_qcbd3_d.clear()
 
         LET g_sql = "SELECT  UNIQUE qcbf002,qcbf003,qcbf004,qcbfsite FROM qcbf_t",    
                     "",
                     " WHERE qcbfent=? AND qcbfdocno=? AND qcbfseq=? AND qcbf001=?"
         
         #160607-00004#1 --s mark
         #IF NOT cl_null(g_wc2_table6) THEN
         #   LET g_sql = g_sql CLIPPED," AND ",g_wc2_table6 CLIPPED
         #160607-00004#1 --e mark
         #160607-00004#1 --s add
         IF NOT cl_null(g_wc2_table99) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table99 CLIPPED
         #160607-00004#1 --e add
         END IF
         
         LET g_sql = g_sql, " ORDER BY  qcbf_t.qcbf001,qcbf_t.qcbf002,qcbf_t.qcbf003" 
                            
         #add-point:單身填充前

         #end add-point
         
         #PREPARE aqct300_pb6 FROM g_sql               #160607-00004#1 mark
         #DECLARE b_fill_curs6 CURSOR FOR aqct300_pb6  #160607-00004#1 mark
         PREPARE aqct300_pb99 FROM g_sql               #160607-00004#1 add
         DECLARE b_fill_curs99 CURSOR FOR aqct300_pb99 #160607-00004#1 add     
         
         IF cl_null(g_detail_idx2) OR g_detail_idx2 <=0 THEN
            LET g_detail_idx2 = 1
         END IF
         #OPEN b_fill_curs6 USING g_enterprise, #160607-00004#1 mark
         OPEN b_fill_curs99 USING g_enterprise, #160607-00004#1 add
                                        g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq,g_qcbd2_d[g_detail_idx2].qcbe001 

         LET l_ac = 1
         #FOREACH b_fill_curs6 INTO g_qcbd3_d[l_ac].qcbf002,g_qcbd3_d[l_ac].qcbf003,g_qcbd3_d[l_ac].qcbf004,g_qcbd3_d[l_ac].qcbfsite   #160607-00004#1 mark
         FOREACH b_fill_curs99 INTO g_qcbd3_d[l_ac].qcbf002,g_qcbd3_d[l_ac].qcbf003,g_qcbd3_d[l_ac].qcbf004,g_qcbd3_d[l_ac].qcbfsite   #160607-00004#1 add

            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "FOREACH:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               EXIT FOREACH
            END IF
            
            #add-point:b_fill段資料填充

            #end add-point
           
            LET l_ac = l_ac + 1
            IF l_ac > g_max_rec THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  9035
               LET g_errparam.extend =  ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               EXIT FOREACH
            END IF
            
         END FOREACH
               CALL g_qcbd3_d.deleteElement(g_qcbd3_d.getLength())
 
      END IF
   END IF
]]>
</point>
  <point name="b_fill2.fill4" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#            LET g_qcbd2_d[l_ac].qcbd001 = g_qcbd_d[g_detail_idx].qcbd001
#            LET g_qcbd2_d[l_ac].qcbd001_1_desc = g_qcbd_d[g_detail_idx].qcbd001_desc
#            LET g_qcbd2_d[l_ac].qcbd002 = g_qcbd_d[g_detail_idx].qcbd002]]>
</point>
  <point name="browser_fill.after" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL aqct300_fetch('')]]>
</point>
  <point name="browser_fill.before_browser_fill" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #161031-00025#16 add(s)
   IF cl_null(g_add_browse) THEN
      CALL aooi360_01_clear_detail()   #清除备注单身
   END IF
   #161031-00025#16 add(e)]]>
</point>
  <point name="browser_fill.before_count" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件                      
      LET l_sub_sql = " SELECT UNIQUE qcbasite ",
                                    ",qcbadocno ",
 
                        " FROM qcba_t ",
                              " ",
                              " LEFT JOIN qcbd_t ON qcbdent = qcbaent  AND qcbadocno = qcbddocno ",
                              " LEFT JOIN qcbb_t ON qcbbent = qcbaent  AND qcbadocno = qcbbdocno", 
 
                              " LEFT JOIN qcbc_t ON qcbcent = qcbaent  AND qcbadocno = qcbcdocno", 
 
 
                              " LEFT JOIN qcbe_t ON qcbeent = qcbaent  AND qcbddocno = qcbedocno AND qcbdseq = qcbeseq", 
 
                              " LEFT JOIN qcbf_t ON qcbfent = qcbaent  AND qcbedocno = qcbfdocno AND qcbeseq = qcbfseq AND qcbe001 = qcbf001", 
 
 
                              " ", 
                              " ", 
                       " WHERE qcbaent = '" ||g_enterprise|| "' AND qcbdent = '" ||g_enterprise|| "' AND ",l_wc, " AND ", l_wc2, cl_sql_add_filter("qcba_t")
 
   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT UNIQUE qcbadocno ",
 
                        " FROM qcba_t ", 
                              " ",
                              " ",
                        "WHERE qcbaent = '" ||g_enterprise|| "' AND ",l_wc CLIPPED, cl_sql_add_filter("qcba_t")
   END IF
   #161031-00025#16 add(s)
   IF NOT cl_null(g_wc2_i36001) AND g_wc2_i36001 <> " 1=1" THEN
      LET l_sub_sql = l_sub_sql CLIPPED, " AND qcbadocno IN ( SELECT ooff003 FROM ooff_t WHERE ooffent = ",g_enterprise," AND ooff001 = '6' AND ooff004= 0 AND ",g_wc2_i36001 CLIPPED ,")"
   END IF
   #161031-00025#16 add(e)
   LET g_sql = " SELECT COUNT(1) FROM (",l_sub_sql,")"]]>
</point>
  <point name="browser_fill.before_foreach" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   LET l_wc = l_wc," AND qcbasite = '",g_site,"'"]]>
</point>
  <point name="browser_fill.define" order="" ver="2" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_slip            STRING]]>
</point>
  <point name="browser_fill.other_fill" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   IF NOT cl_null(g_qcba_m.qcbadocno) THEN
#      IF g_qcba_m.qcba000 MATCHES '[12]' THEN
#         CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,1)
#      ELSE
#         CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,-1)
#      END IF
       CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,g_inao013)
   END IF
   CALL g_qcbd99_d.deleteElement(g_qcbd99_d.getLength())
   #161031-00025#16 add(s)
   LET g_ooff001_d = '6'   #6.單據單頭備註
   LET g_ooff002_d = g_prog
   LET g_ooff003_d = g_qcba_m.qcbadocno   #单号
   LET g_ooff004_d = 0     #项次
   LET g_ooff005_d = ' '
   LET g_ooff006_d = ' '
   LET g_ooff007_d = ' '
   LET g_ooff008_d = ' '
   LET g_ooff009_d = ' '
   LET g_ooff010_d = ' '
   LET g_ooff011_d = ' '
   CALL aooi360_01_b_fill(g_ooff001_d,g_ooff002_d,g_ooff003_d,g_ooff004_d,g_ooff005_d,g_ooff006_d,g_ooff007_d,g_ooff008_d,g_ooff009_d,g_ooff010_d,g_ooff011_d)   #备注单身 
   #161031-00025#16 add(e)]]>
</point>
  <point name="browser_fill.reference" order="" ver="8" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      IF NOT cl_null(g_browser[g_cnt].b_qcbadocno) THEN #160304-00005#1 add
         CALL s_aooi200_get_slip(g_browser[g_cnt].b_qcbadocno) RETURNING g_success,l_slip
      END IF
      CALL s_aooi200_get_slip_desc(l_slip) RETURNING g_browser[g_cnt].b_qcbadocno_desc
      DISPLAY BY NAME g_browser[g_cnt].b_qcbadocno_desc]]>
</point>
  <point name="construct.a.qcba001" order="" ver="36" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            LET l_qcba001 = GET_FLDBUF(qcba001)    #170116-00038#1 add]]>
</point>
  <point name="construct.c.page1.qcbd001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '1051'
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbd001  #顯示到畫面上
            NEXT FIELD qcbd001                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page2.qcbd001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbd001  #顯示到畫面上
            NEXT FIELD qcbd001                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.qcba001" order="" ver="36" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #170116-00038#1 add---start---
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_qcba001()
            DISPLAY g_qryparam.return1 TO qcba001
            NEXT FIELD qcba001
            #170116-00038#1 add---end---]]>
</point>
  <point name="construct.c.qcba002" order="" ver="36" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #170116-00038#1 add---start---
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            IF NOT cl_null(l_qcba001) THEN
               LET l_qcba001_1 = NULL
               FOR i = 1 TO l_qcba001.getLength()
                   IF l_qcba001.subString(i,i) = '|' THEN
                      LET l_qcba001_1 = l_qcba001_1 CLIPPED,"','"
                   ELSE
                      LET l_qcba001_1 = l_qcba001_1 CLIPPED,l_qcba001.subString(i,i)
                   END IF
               END FOR
               LET g_qryparam.where = " qcba001 IN ('",l_qcba001_1,"')"
            END IF
            CALL q_qcba002()
            DISPLAY g_qryparam.return1 TO qcba002
            NEXT FIELD qcba002
            #170116-00038#1 add---end---]]>
</point>
  <point name="construct.c.qcba005" order="" ver="22" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            #CALL q_pmaa001()                           #呼叫開窗 #160913-00055#5
            CALL q_pmaa001_25()        #160913-00055#5
            DISPLAY g_qryparam.return1 TO qcba005  #顯示到畫面上

            NEXT FIELD qcba005                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba006" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			   LET g_qryparam.where = " ecbb018 = 'Y'"

            CALL q_ecbb004()                            #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba006  #顯示到畫面上

            NEXT FIELD qcba006                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba009" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba009  #顯示到畫面上

            NEXT FIELD qcba009   ]]>
</point>
  <point name="construct.c.qcba013" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg1 = "205"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba013  #顯示到畫面上

            NEXT FIELD qcba013                     #返回原欄位

]]>
</point>
  <point name="construct.c.qcba032" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_qcbhdocno()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba032  #顯示到畫面上
            NEXT FIELD qcba032                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.qcba033" order="" ver="7" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #應用 a08 樣板自動產生(Version:3)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_qcba033()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcba033  #顯示到畫面上
            NEXT FIELD qcba033                     #返回原欄位
    


]]>
</point>
  <point name="construct.c.qcbadocno" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_qcbadocno()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO qcbadocno  #顯示到畫面上

            NEXT FIELD qcbadocno                     #返回原欄位

]]>
</point>
  <point name="cs.add_cs" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      #CONSTRUCT g_wc2_table6 ON qcbf002,qcbf003,qcbf004 #160607-00004#1 mark
      CONSTRUCT g_wc2_table99 ON qcbf002,qcbf003,qcbf004 #160607-00004#1 add
           FROM s_detail3[1].qcbf002,s_detail3[1].qcbf003,s_detail3[1].qcbf004
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct

            #end add-point 
            
       #單身公用欄位開窗相關處理(table 5)
       
       
       #單身一般欄位開窗相關處理       
       #---------------------<  Detail: page3  >---------------------
         #----<<qcbf002>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qcbf002
            #add-point:BEFORE FIELD qcbf002

            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qcbf002
            
            #add-point:AFTER FIELD qcbf002

            #END add-point
            
 
         #Ctrlp:construct.c.page3.qcbf002
         ON ACTION controlp INFIELD qcbf002
            #add-point:ON ACTION controlp INFIELD qcbf002

            #END add-point
 
         #----<<qcbf003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qcbf003
            #add-point:BEFORE FIELD qcbf003

            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qcbf003
            
            #add-point:AFTER FIELD qcbf003

            #END add-point
            
 
         #Ctrlp:construct.c.page3.qcbf003
         ON ACTION controlp INFIELD qcbf003
            #add-point:ON ACTION controlp INFIELD qcbf003

            #END add-point
 
         #----<<qcbf004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qcbf004
            #add-point:BEFORE FIELD qcbf004

            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qcbf004
            
            #add-point:AFTER FIELD qcbf004

            #END add-point
            
 
         #Ctrlp:construct.c.page3.qcbf004
         ON ACTION controlp INFIELD qcbf004
            #add-point:ON ACTION controlp INFIELD qcbf004

            #END add-point
 
   
       
      END CONSTRUCT
      SUBDIALOG aoo_aooi360_01.aooi360_01_construct   #备注单身  #161031-00025#16 add ]]>
</point>
  <point name="cs.define" order="" ver="36" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_qcba001   STRING             #170116-00038#1 add
   DEFINE i           LIKE type_t.num5   #170116-00038#1 add
   DEFINE l_qcba001_1 STRING             #170116-00038#1 add]]>
</point>
  <point name="cs.pre_function" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL aooi360_01_clear_detail()   #清除备注单身  #161031-00025#16 add]]>
</point>
  <point name="default_search.after_sql" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   IF NOT cl_null(g_argv[02]) THEN
      IF cl_null(ls_wc) THEN
         LET ls_wc = " 1=1"
      END IF
      LET ls_wc = ls_wc, " AND ", g_argv[02], " AND "
   END IF
   
   IF NOT cl_null(g_argv[03]) THEN
      IF cl_null(ls_wc) THEN
         LET ls_wc = " 1=1"
      END IF
      LET ls_wc = ls_wc, " AND qcba001 = '", g_argv[03], "' AND "
   END IF
   ]]>
</point>
  <point name="delete.body.a_delete4" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      DELETE FROM qcbf_t
       WHERE qcbfent = g_enterprise AND qcbfdocno = g_qcba_m.qcbadocno 

      #add-point:單身刪除中

      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "qcbf_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()
 
         CALL s_transaction_end('N','0')
         RETURN
      END IF  ]]>
</point>
  <point name="delete.body.a_delete5" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      #161031-00025#16 add(s)
      #单头的aooi360_01的备注单身资料同步删除
      DECLARE ooff_cs CURSOR FOR
         SELECT ooff012 INTO l_ooff012 FROM ooff_t WHERE ooffent = g_enterprise AND ooff001 = '6' AND ooff003 = g_qcba_m.qcbadocno AND ooff004 = 0
      FOREACH ooff_cs INTO l_ooff012   
         IF NOT s_aooi360_del('6',g_prog,g_qcba_m.qcbadocno,'','','','','','','','',l_ooff012) THEN
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      END FOREACH
      CALL aooi360_01_clear_detail()   #清除备注单身  
      
      #单身的长备注栏位也要同步删除
      IF NOT s_aooi360_del('7',g_prog,g_qcba_m.qcbadocno,'','','','','','','','','1') THEN
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      #161031-00025#16 add(e)]]>
</point>
  <point name="delete.define" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_ooff012        LIKE ooff_t.ooff012  #161031-00025#16 add]]>
</point>
  <point name="delete.head.a_delete" order="" ver="42" cite_std="N" new="Y" ind_extra="N" ch="Y" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      #170215-00017#1 add(s)
      CASE g_qcba_m.qcba000
         WHEN '1'
            UPDATE sfec_t SET sfec002 = '',
                              sfec003 = ''
                        WHERE sfecent = g_enterprise
                          AND sfecdocno = g_qcba_m.qcba001
                          AND sfecseq = g_qcba_m.qcba002
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_qcba_m.qcba001,":",SQLERRMESSAGE  
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = FALSE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF             
         WHEN '6'
            UPDATE xmdl_t SET xmdl089 = '',
                              xmdl090 = '',
                              xmdl091 = ''
                        WHERE xmdlent = g_enterprise
                          AND xmdldocno = g_qcba_m.qcba001
                          AND xmdlseq = g_qcba_m.qcba002
             IF SQLCA.SQLCODE THEN
                INITIALIZE g_errparam TO NULL 
                LET g_errparam.extend = g_qcba_m.qcba001,":",SQLERRMESSAGE  
                LET g_errparam.code = SQLCA.SQLCODE 
                LET g_errparam.popup = FALSE 
                CALL s_transaction_end('N','0')
                CALL cl_err()
                RETURN
             END IF
      END CASE
      #170215-00017#1 add(e)]]>
</point>
  <point name="delete.head.b_delete" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,0) THEN
         RETURN
      END IF
      DELETE FROM inao_t WHERE inaoent = g_enterprise
         AND inaodocno = g_qcba_m.qcbadocno
      CALL s_lot_clear_detail()]]>
</point>
  <point name="delete.head.m_delete" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      IF NOT s_aooi200_del_docno(g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt) THEN
         CALL s_transaction_end('N','0')
         RETURN
      END IF]]>
</point>
  <point name="delete_b.a_delete3" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      
      ]]>
</point>
  <point name="delete_b.b_delete3" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,ps_keys_bak[2]) THEN
         RETURN FALSE
      END IF
      DELETE FROM inao_t WHERE inaoent = g_enterprise
         AND inaodocno = ps_keys_bak[1] AND inaoseq = ps_keys_bak[2]
      IF NOT cl_null(g_qcba_m.qcbadocno) THEN
#         IF g_qcba_m.qcba000 MATCHES '[12]' THEN
#            CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,1)
#         ELSE
#            CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,-1)
#         END IF
          CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,g_inao013)
      END IF]]>
</point>
  <point name="delete_b.other" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#   LET ls_group = "'1',"
#   #判斷是否是同一群組的table2
#   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
#      #add-point:delete_b段刪除前
#
#      #end add-point    
#      DELETE FROM qcbf_t
#       WHERE qcbfdocno = ps_keys_bak[1] AND qcbfseq = ps_keys_bak[2] AND qcbf001 = ps_keys_bak[3] 
#      #add-point:delete_b段刪除中
#
#      #end add-point    
#      IF SQLCA.sqlcode THEN
#         INITIALIZE g_errparam TO NULL
#         LET g_errparam.code = SQLCA.sqlcode
#         LET g_errparam.extend = "qcbf_t"
#         LET g_errparam.popup = FALSE
#         CALL cl_err()
#
#      END IF
#      #add-point:delete_b段刪除後
#
#      #end add-point    
#   END IF
#   
#   LET ls_group = "'2',"
#   #判斷是否是同一群組的table2
#   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
#      #add-point:delete_b段刪除前
#
#      #end add-point    
#      DELETE FROM qcbe_t
#       WHERE qcbedocno = ps_keys_bak[1] AND qcbeseq = ps_keys_bak[2] AND qcbe001 = ps_keys_bak[3]
#      #add-point:delete_b段刪除中
#
#      #end add-point    
#      IF SQLCA.sqlcode THEN
#         INITIALIZE g_errparam TO NULL
#         LET g_errparam.code = SQLCA.sqlcode
#         LET g_errparam.extend = "qcbe_t"
#         LET g_errparam.popup = FALSE
#         CALL cl_err()
#
#      END IF
#      #add-point:delete_b段刪除後
#
#      DELETE FROM qcbf_t
#      WHERE  qcbfdocno = ps_keys_bak[1] AND qcbfseq = ps_keys_bak[2] AND qcbf001 = ps_keys_bak[3]
#      #add-point:delete_b段刪除中
#
#      #end add-point    
#      IF SQLCA.sqlcode THEN
#         INITIALIZE g_errparam TO NULL
#         LET g_errparam.code = SQLCA.sqlcode
#         LET g_errparam.extend = "qcbf_t"
#         LET g_errparam.popup = FALSE
#         CALL cl_err()
#
#      END IF
#      #end add-point    
#   END IF
#   
#   LET ls_group = "'5',"
#   #判斷是否是同一群組的table2
#   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
#      #add-point:delete_b段刪除前
#
#      #end add-point    
#      DELETE FROM qcbf_t
#       WHERE qcbfdocno = ps_keys_bak[1] AND qcbfseq = ps_keys_bak[2] AND qcbf001 = ps_keys_bak[3]
#      #add-point:delete_b段刪除中
#
#      #end add-point    
#      IF SQLCA.sqlcode THEN
#         INITIALIZE g_errparam TO NULL
#         LET g_errparam.code = SQLCA.sqlcode
#         LET g_errparam.extend = "qcbf_t"
#         LET g_errparam.popup = FALSE
#         CALL cl_err()
#
#      END IF
#      #add-point:delete_b段刪除後
#
#      #end add-point    
#   END IF]]>
</point>
  <point name="detail_reproduce.body.table4.a_insert" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   LET ls_sql = 
      "CREATE GLOBAL TEMPORARY TABLE aqct300_detail AS ",
      "SELECT * FROM qcbf_t "
   PREPARE repro_tbl6 FROM ls_sql
   EXECUTE repro_tbl6
   FREE repro_tbl6
      
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO aqct300_detail SELECT * FROM qcbf_t
                                         WHERE qcbfent = g_enterprise AND qcbfdocno = g_qcbadocno_t
 
 
   #將key修正為調整後   
   UPDATE aqct300_detail SET  qcbfdocno = g_qcba_m.qcbadocno
 
  
   #將資料塞回原table   
   INSERT INTO qcbf_t SELECT * FROM aqct300_detail
   
   #add-point:單身複製中

   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE aqct300_detail]]>
</point>
  <point name="detail_reproduce.define" order="" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #DEFINE l_detail6    RECORD LIKE qcbf_t.* #160607-00004#1 mark
#   DEFINE l_detail99    RECORD LIKE qcbf_t.* #160607-00004#1 add  #161124-00048#10 mark]]>
</point>
  <point name="fetch.action_control" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
   
   
   CALL aqct300_page_visible()]]>
</point>
  <point name="fill_chk.after_chk" order="" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #IF ps_idx = 6 AND #160607-00004#1 mark
   IF ps_idx = 99 AND #160607-00004#1 add
      ((NOT cl_null(g_wc2_table1) AND g_wc2_table1.trim() <> '1=1') OR 
      (NOT cl_null(g_wc2_table4) AND g_wc2_table4.trim() <> '1=1') OR
      #(NOT cl_null(g_wc2_table6) AND g_wc2_table6.trim() <> '1=1')) THEN  #160607-00004#1 mark
      (NOT cl_null(g_wc2_table99) AND g_wc2_table99.trim() <> '1=1')) THEN #160607-00004#1 add
      RETURN TRUE
   END IF]]>
</point>
  <point name="fill_chk.other_chk" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      ]]>
</point>
  <point name="global.import" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[IMPORT FGL sub_s_lot
IMPORT FGL aoo_aooi360_01  #161031-00025#16 add]]>
</point>
  <point name="global.memo" order="" ver="42" cite_std="N" new="Y" ind_extra="N" ch="Y" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[#160216-00008#1 by xujing 调整OQC送验量的计算方法
#160217-00011#1 by xujing 调整根据检验程度去计算检验级数的逻辑
#160224-00009#1 by xujing aqci100中【检验项目是否可人工新增/修改】设置为N,不可新增
#160222-00013#1 by xujing PQC时，特采后，点击【取消特采】无反应，也不会恢复成全部验退的状态，也不会报错
#160314-00008#1 by catmoon 批/序號3:不控管時,修改儲位/批號時沒有更新到inao_t
#160304-00005#1 160325 By xujing 获取单别的时候加上判断单号不为空
#160318-00033#1 160325 By xujing 杂收单检验取消判断是否已存在入库明细
#160224-00004#1 160327 By xujing 【联产品与结果判定】中的不良品和报废品入库，库位，储位依aooi200中的参数预设
#160319-00001#1 160328 By Ann_Huang  修正單頭若為檢驗類型"4.OQC 出貨單"且來源單號屬於無訂單出貨單,則不檢查來源單項次
#160128-00017#1 160330 By xujing 修改RQC来源数量
#160114-00018#1 160320 By xujing 调整带出抽验量的逻辑
#160407-00024#1 160419 By xujing 联产品与结果判定页签新增自动预设产品特征
#160407-00031#1 160419 By xujing 检验时间修正
#160318-00025#21 160420 BY 07900 校验代码重复错误讯息的修改
#160411-00004#1 160420 By xujing PQC检验不带入产品特征
#160222-00008#1 160422 By xujing 取消特采后因先产生qcbc_t再回写来源单据
#160304-00014#1 160422 By xujing IQC特采或取消特采前判断是否有入库单加上本单据的QC单号条件
#160107-00005#1 160423 By xujing PQC为制程委外时抓去完工入库数量作为来源数量
#160516-00016#1 160526 By lixiang 调整PQC的送验量的计算方法(与OQC一样)
#160517-00013#1 160526 By lixiang 抓取QC画面资料预设值时，先判断来源资料等是否都有值，否则导致执行sql报错，抓到的值错误
#160324-00033#1 160531 By lixiang 增加來源-倉庫檢驗申請單
#160531-00017#1 160601 By lixiang RQC检验程式完善(由axmt581审核后送检)
#160607-00004#1 160607 By Jessy   將程式內人工補入之頁籤type_g_qcbd6_d/s_detail6以及呼叫function傳入之參數，改為流水號99
#160405-00005#1 160808 By 00768   1.检验时间和完成时间，统一修改为时分秒的处理方式
#                                 2.检验时间（分）这个栏位开放可以输入，因为检验有可能是分批检验的，一批货我可以今天检验一部分，明天检验一部分，总共才几分钟，可是系统算出来的是几百分钟，因为跨了一天了，所以要把那个栏位开放可以输入。
#160808-00035#1 160811 By xianghui 错误信息‘此笔资料的检验否未勾选’的处理方式的提示作业应该是axmt540
#160818-00017#33  16/08/25  By lixh    单据类作业修改，删除时需重新检查状态
#160902-00011#1 160902 By ywtsai  測量值頁籤判斷上下限條件當合格否欄位值改變須DISPLAY以便能走到ON ROW CHANGE
#160905-00007#13  20160905 by geza           sql加上ent条件
#160909-00068#1 160912 By ywtsai  修改維護缺點原因記錄上階單身index時應先取得上階單身index再存入變數中，避免單身新增第二筆時出現閃退情形
#160913-00018#1 160926 By lixiang 录入完资料后提交保存，来源单项次的底色仍旧为编辑时必输状态
#160913-00055#5 160926 By lixiang 交易对象栏位开窗调整为q_pmaa001_25
#160912-00021#3 16/10/10 By lixh  一阶段调拨单送验量可以为负数（axct316截取成本时，若单据上调拨数量为负，应改抓拨入方指定年月成本）
#161014-00048#1 161017 By ywtsai  新增時須依照料號取得aimm216設定的品管員(imae112)為檢驗員資料，取不到才預設為g_user
#161103-00007#3  16/11/04 By lixiang 调整PQC与报工的顺序：
#                                    目前系统是先FPQC再报工，要调整为先报工再PQC
#                                    1.aqct300中PQC的来源改为报工单
#161127-00011#1 16/11/29 By ywtsai 修正錯誤訊息aqc-00088改為aqc-00144
#161115-00040#1 16/11/29 By xujing 抽樣計畫為6:自訂義公式,允收數和拒絕數正常永遠都差1,修正拒絕數=允收數+1
#161129-00005#1 16/12/01 By Ann_Huang  [聯產品與結果判定]頁籤加入判定數量總數控卡不得超出送驗量
#161124-00048#10 16/12/13  By xujing     整批调整系统RECORD LIKE xxxx_t.* 星号写法
#161219-00061#1 16/12/27 By ywtsai     修正抽樣數量需考慮單位與檢驗單位換算率
#170102-00010#1 17/01/02 By ywtsai 新增時出通單來源單號開窗改用q_xmdgdocno_5排除已轉QC的單據項次
#161024-00041#1 17/01/05 By fionchen 增加來源-倉庫QC銷退單
#160824-00007#352 17/01/09 By 06814  新舊值相關
#170109-00039#1 17/01/10 By ywtsai   當檢驗單位更改時，單身檢驗項目抽驗量需重新計算
#170110-00056#1 17/01/11 By xujing  1.PQC下站未设置报工点，PQC单审核时仍回写到下站转入数量，应调用报工单写入下站的逻辑（s_asft335_upd_next_station）
#                                   2.增加qcba002来源单项次支持录入报工项次,开窗,检查.
#170116-00038#1 17/01/17 By ywtsai   取消參考單號開窗(規格)，查詢時來源單號使用q_qcba001、來源單號項次使用q_qcba002
#170105-00062#1 17/01/26 By xujing  aqci100勾選[檢驗項目是否可人工新增/修改]，aqct300單身第二個頁籤[檢驗規格]中的欄位規範上限~備註需可以維護
#                                   欄位開放輸入後，欄位檢核比照aqci010上的欄位檢核邏輯
#161031-00025#16 17/02/07 By xujing ：1.單頭增加"備註"頁籤嵌入aooi360_01，放在異動資訊前面
#                                     2.原"備註"action，改為確認後，可維護"備註"頁籤資料
#                                     3.單身最後面增加顯示"長備註"欄位，要可開窗輸入，一樣抓取aooi360的備註顯示，項次 = 單身項次、控制類型 = 列印在後
#170213-00006#1 17/02/13 By dujuan  aqct300校驗類型為RQC的時候，來源單號應該是axmt591的單據
#170207-00018#3 17/02/16 By 08734   ROWNUM整批调整
#170216-00008#1 17/02/17 By xujing  来源6:RQC的qc单维护，来源单号栏位应该剔除axmt591还量单单别参数“D-BAS-0091借货还量进行QC检验”=N的借货还量单单据
#170215-00017#1 17/02/17 By xujing  aqct300整單刪除後,也應該要同時清空來源單據單身的QC相關欄位]]>
</point>
  <point name="global.variable" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#TYPE type_g_qcbd6_d        RECORD #160607-00004#1 mark
TYPE type_g_qcbd99_d        RECORD #160607-00004#1 add
       qcbdseq_2 LIKE qcbd_t.qcbdseq, 
   qcbd001_2 LIKE qcbd_t.qcbd001, 
   qcbd001_2_desc LIKE type_t.chr80, 
   qcbd002_2 LIKE qcbd_t.qcbd002, 
   qcbd012 LIKE qcbd_t.qcbd012, 
   qcbd013 LIKE qcbd_t.qcbd013, 
   qcbd014 LIKE qcbd_t.qcbd014, 
   qcbd015 LIKE qcbd_t.qcbd015, 
   qcbd016 LIKE qcbd_t.qcbd016, 
   qcbd017 LIKE qcbd_t.qcbd017, 
   qcbd018 LIKE qcbd_t.qcbd018, 
   qcbd019 LIKE qcbd_t.qcbd019
       END RECORD
#DEFINE g_qcbd6_d   DYNAMIC ARRAY OF type_g_qcbd6_d  #160607-00004#1 mark
#DEFINE g_qcbd6_d_t type_g_qcbd6_d                   #160607-00004#1 mark
DEFINE g_qcbd99_d   DYNAMIC ARRAY OF type_g_qcbd99_d #160607-00004#1 add
DEFINE g_qcbd99_d_t type_g_qcbd99_d                  #160607-00004#1 add
DEFINE g_qcbd99_d_o type_g_qcbd99_d                  #170105-00062#1 add
DEFINE g_qcbd99_d_mask_o   DYNAMIC ARRAY OF type_g_qcbd99_d #轉換遮罩前資料   #170105-00062#1 add
DEFINE g_qcbd99_d_mask_n   DYNAMIC ARRAY OF type_g_qcbd99_d #轉換遮罩後資料   #170105-00062#1 add 
DEFINE g_qcaz001         LIKE qcaz_t.qcaz001
#DEFINE g_qcaz     RECORD LIKE qcaz_t.* #161124-00048#10 mark
#161124-00048#10 add(s)
DEFINE g_qcaz RECORD  #品質檢驗參照表資料檔
       qcazent LIKE qcaz_t.qcazent, #企业编号
       qcaz001 LIKE qcaz_t.qcaz001, #参照表编号
       qcaz002 LIKE qcaz_t.qcaz002, #不良数基准分子-Crtical
       qcaz003 LIKE qcaz_t.qcaz003, #不良数基准分母-Crtical
       qcaz004 LIKE qcaz_t.qcaz004, #不良数基准分子-Major
       qcaz005 LIKE qcaz_t.qcaz005, #不良数基准分母-Major
       qcaz006 LIKE qcaz_t.qcaz006, #不良数基准分子-Minor
       qcaz007 LIKE qcaz_t.qcaz007, #不良数基准分母-Minor
       qcaz008 LIKE qcaz_t.qcaz008, #QC需控制承认文号
       qcaz009 LIKE qcaz_t.qcaz009, #启动检验程度转换规则
       qcaz010 LIKE qcaz_t.qcaz010, #连续几批中
       qcaz011 LIKE qcaz_t.qcaz011, #有几批退货则由正常转加严检验
       qcaz012 LIKE qcaz_t.qcaz012, #连续几批合格则由加严转正常检验
       qcaz013 LIKE qcaz_t.qcaz013, #连续几批合格则由正常转减量检验
       qcaz014 LIKE qcaz_t.qcaz014, #连续几批退货则由减量转正常检验
       qcaz015 LIKE qcaz_t.qcaz015, #连续几批减量合格则由减量转免验
       qcaz016 LIKE qcaz_t.qcaz016, #连续几批加严则由加严转除名
       qcaz017 LIKE qcaz_t.qcaz017, #使用质量判定功能
       qcaz018 LIKE qcaz_t.qcaz018, #检验项目是否可人工新增
       qcazownid LIKE qcaz_t.qcazownid, #资料所有者
       qcazowndp LIKE qcaz_t.qcazowndp, #资料所有部门
       qcazcrtid LIKE qcaz_t.qcazcrtid, #资料录入者
       qcazcrtdp LIKE qcaz_t.qcazcrtdp, #资料录入部门
       qcazcrtdt LIKE qcaz_t.qcazcrtdt, #资料创建日
       qcazmodid LIKE qcaz_t.qcazmodid, #资料更改者
       qcazmoddt LIKE qcaz_t.qcazmoddt, #最近更改日
       qcazstus LIKE qcaz_t.qcazstus #状态码
END RECORD
#161124-00048#10 add(e)
 TYPE type_g_qcbd3_d RECORD
       qcbf002 LIKE qcbf_t.qcbf002, 
   qcbf003 LIKE qcbf_t.qcbf003, 
   qcbf004 LIKE qcbf_t.qcbf004,
   qcbfsite LIKE qcbf_t.qcbfsite
       END RECORD
DEFINE g_qcbd3_d   DYNAMIC ARRAY OF type_g_qcbd3_d
DEFINE g_qcbd3_d_t type_g_qcbd3_d
#DEFINE g_wc2_table6   STRING #160607-00004#1 mark
DEFINE g_wc2_table99   STRING #160607-00004#1 add
DEFINE g_detail_idx3         LIKE type_t.num5
DEFINE g_qcba017_t   LIKE qcba_t.qcba017
DEFINE g_special      LIKE type_t.chr1
DEFINE g_auto_flag  LIKE type_t.num5
DEFINE g_qcba027_flag LIKE type_t.chr1
DEFINE g_lot_ins_flag LIKE type_t.chr1
DEFINE g_para       LIKE type_t.chr1
DEFINE g_inao013    LIKE inao_t.inao013
#161031-00025#16 add(s)
GLOBALS
TYPE type_g_ooff_d        RECORD
       ooff001 LIKE ooff_t.ooff001, 
   ooff002 LIKE ooff_t.ooff002, 
   ooff004 LIKE ooff_t.ooff004, 
   ooff005 LIKE ooff_t.ooff005, 
   ooff006 LIKE ooff_t.ooff006, 
   ooff007 LIKE ooff_t.ooff007, 
   ooff008 LIKE ooff_t.ooff008, 
   ooff009 LIKE ooff_t.ooff009, 
   ooff010 LIKE ooff_t.ooff010, 
   ooff011 LIKE ooff_t.ooff011, 
   ooff003 LIKE ooff_t.ooff003, 
   ooff012 LIKE ooff_t.ooff012, 
   ooff013 LIKE ooff_t.ooff013, 
   ooff014 LIKE ooff_t.ooff014
       END RECORD
 
DEFINE g_ooff_d4          DYNAMIC ARRAY OF type_g_ooff_d

DEFINE g_detail_insert   LIKE type_t.num5   #單身的新增權限
DEFINE g_detail_delete   LIKE type_t.num5   #單身的刪除權限
DEFINE g_wc2_i36001      STRING             #备注单身QBE條件
DEFINE g_d_idx_i36001    LIKE type_t.num5   #备注单身所在筆數
DEFINE g_d_cnt_i36001    LIKE type_t.num5   #备注单身總筆數
DEFINE g_appoint_idx     LIKE type_t.num5   #指定進入單身行數
DEFINE g_ooff001_d       LIKE ooff_t.ooff001
DEFINE g_ooff002_d       LIKE ooff_t.ooff002
DEFINE g_ooff003_d       LIKE ooff_t.ooff003
DEFINE g_ooff004_d       LIKE ooff_t.ooff004
DEFINE g_ooff005_d       LIKE ooff_t.ooff005
DEFINE g_ooff006_d       LIKE ooff_t.ooff006
DEFINE g_ooff007_d       LIKE ooff_t.ooff007
DEFINE g_ooff008_d       LIKE ooff_t.ooff008
DEFINE g_ooff009_d       LIKE ooff_t.ooff009
DEFINE g_ooff010_d       LIKE ooff_t.ooff010
DEFINE g_ooff011_d       LIKE ooff_t.ooff011
END GLOBALS
DEFINE g_detail_id          STRING           #紀錄停留在哪個Page
#161031-00025#16 add(e)]]>
</point>
  <point name="idx_chk.other" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   IF g_current_page = 5 THEN
      LET g_detail_idx3 = g_curr_diag.getCurrentRow("s_detail3")
      IF g_detail_idx3 > g_qcbd3_d.getLength() THEN
         LET g_detail_idx3 = g_qcbd3_d.getLength()
      END IF
      IF g_detail_idx3 = 0 AND g_qcbd3_d.getLength() <> 0 THEN
         LET g_detail_idx3 = 1
      END IF
      DISPLAY g_detail_idx3 TO FORMONLY.idx
      DISPLAY g_qcbd3_d.getLength() TO FORMONLY.cnt
   END IF]]>
</point>
  <point name="init.define" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[DEFINE l_gzze003 LIKE gzze_t.gzze003]]>
</point>
  <point name="init.init" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #161031-00025#16 add(s)
   CALL cl_ui_replace_sub_window(cl_ap_formpath("aoo", "aooi360_01"), "grid_remarks", "Table", "s_detail1_aooi360_01")
   CALL cl_set_combo_scc_part('ooff012','11','1,2,4')
   CALL cl_set_comp_visible("ooff003",FALSE)
   #161031-00025#16 add(e)
   CALL cl_set_combo_scc_part('qcbc001','1002','0,1')
   CALL cl_set_combo_scc_part('qcba000','5056','1,2,3,4,5,6') 
   CALL cl_set_combo_scc('imae116','5052')
   CALL cl_set_combo_scc_part('b_qcba000','5056','1,2,3,4,5,6')
   LET g_qcaz001 = cl_get_para(g_enterprise,g_site,'S-MFG-0046')
#   SELECT * INTO g_qcaz.* FROM qcaz_t WHERE qcazent = g_enterprise AND qcaz001 = g_qcaz001  #161124-00048#10 mark
   #161124-00048#10 add(s)
   SELECT qcazent,qcaz001,qcaz002,qcaz003,qcaz004,qcaz005,qcaz006,
          qcaz007,qcaz008,qcaz009,qcaz010,qcaz011,qcaz012,qcaz013,
          qcaz014,qcaz015,qcaz016,qcaz017,qcaz018,qcazownid,qcazowndp,
          qcazcrtid,qcazcrtdp,qcazcrtdt,qcazmodid,qcazmoddt,qcazstus 
     INTO g_qcaz.qcazent,g_qcaz.qcaz001,g_qcaz.qcaz002,g_qcaz.qcaz003,g_qcaz.qcaz004,g_qcaz.qcaz005,g_qcaz.qcaz006,
          g_qcaz.qcaz007,g_qcaz.qcaz008,g_qcaz.qcaz009,g_qcaz.qcaz010,g_qcaz.qcaz011,g_qcaz.qcaz012,g_qcaz.qcaz013,
          g_qcaz.qcaz014,g_qcaz.qcaz015,g_qcaz.qcaz016,g_qcaz.qcaz017,g_qcaz.qcaz018,g_qcaz.qcazownid,g_qcaz.qcazowndp,
          g_qcaz.qcazcrtid,g_qcaz.qcazcrtdp,g_qcaz.qcazcrtdt,g_qcaz.qcazmodid,g_qcaz.qcazmoddt,g_qcaz.qcazstus 
     FROM qcaz_t WHERE qcazent = g_enterprise AND qcaz001 = g_qcaz001
   #161124-00048#10 add(e)
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0036') = 'N' THEN 
      CALL cl_set_comp_visible("qcba012,qcbc004,qcbc004_desc",FALSE)
      LET l_gzze003 = ' '
#      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'axm-00647' AND gzze002 = g_dlang    #160318-00005#41  mark
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00939' AND gzze002 = g_dlang     #160318-00005#41  add
      CALL cl_set_comp_att_text('qcba010',l_gzze003)
   END IF    
   LET g_qcba027_flag = 'N'
   LET g_special = 'N'
   
   #xujing---add---制造批序号
   CALL cl_ui_replace_sub_window(cl_ap_formpath("sub", "s_lot_s01"), "grid_s_lot", "Table", "s_detail1_s_lot_s01")

   CALL s_lot_ins_create_tmp()
   CALL s_lot_sel_create_tmp()
   #170110-00056#1 add(s)
   CALL s_asft335_cre_tmp_table() RETURNING g_success
   #170110-00056#1 add(e)
   #xujing---add---制造批序号]]>
</point>
  <point name="input.a.page1.qcbd001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbd001_desc(g_qcbd_d[l_ac].qcbd001)
            IF NOT cl_null(g_qcbd_d[l_ac].qcbd001) THEN
               IF NOT s_azzi650_chk_exist('1051',g_qcbd_d[l_ac].qcbd001) THEN
                  LET g_qcbd_d[l_ac].qcbd001 = g_qcbd_d_t.qcbd001
                  NEXT FIELD CURRENT
               END IF
            END IF
]]>
</point>
  <point name="input.a.page1.qcbd004" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT aqct300_qcbd004_chk() THEN
               LET g_qcbd_d[l_ac].qcbd004 = g_qcbd_d_t.qcbd004
               NEXT FIELD CURRENT
            END IF
            IF NOT cl_null(g_qcbd_d[l_ac].qcbd020) AND NOT cl_null(g_qcbd_d[l_ac].qcbd004) THEN
               CALL aqct300_qcbd005_qcbd006_result(g_qcbd_d[l_ac].qcbd020,g_qcbd_d[l_ac].qcbd004) RETURNING g_qcbd_d[l_ac].qcbd005,g_qcbd_d[l_ac].qcbd006
            END IF
            IF NOT cl_null(g_qcbd_d[l_ac].qcbd020) AND NOT cl_null(g_qcbd_d[l_ac].qcbd004) THEN
               CALL aqct300_qcbd009_result(g_qcbd_d[l_ac].qcbd020,g_qcbd_d[l_ac].qcbd004) RETURNING g_qcbd_d[l_ac].qcbd009
            END IF]]>
</point>
  <point name="input.a.page1.qcbd009" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcbd_d[l_ac].qcbd009) THEN 
            END IF 

]]>
</point>
  <point name="input.a.page1.qcbd010" order="" ver="33" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[            
            IF NOT cl_null(g_qcbd_d[l_ac].qcbd010) THEN
               IF l_cmd = 'a' OR (l_cmd = 'u' AND g_qcbd_d[l_ac].qcbd010 != g_qcbd_d_t.qcbd010) THEN
                  LET l_sum_qcbe002 = 0
                  SELECT SUM(qcbe002) INTO l_sum_qcbe002 FROM qcbe_t
                   WHERE qcbeent = g_enterprise
                     AND qcbedocno = g_qcba_m.qcbadocno
                     AND qcbeseq = g_qcbd_d[l_ac].qcbdseq
                  IF NOT cl_null(l_sum_qcbe002) AND l_sum_qcbe002 > 0 AND g_qcbd_d[l_ac].qcbd010 != l_sum_qcbe002 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_qcbd_d[l_ac].qcbd010||" <> "||l_sum_qcbe002
                     LET g_errparam.code   = "aqc-00119" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     #LET g_qcbd_d[l_ac].qcbd010 = g_qcbd_d_t.qcbd010   #160824-00007#352 20170109 mark by beckxie
                     #160824-00007#352 20170109 add by beckxie---S
                     LET g_qcbd_d[l_ac].qcbd010 = g_qcbd_d_o.qcbd010
                     LET g_qcbd_d[l_ac].qcbd021 = g_qcbd_d_o.qcbd021
                     LET g_qcbd_d[l_ac].qcbd011 = g_qcbd_d_o.qcbd011
                     #160824-00007#352 20170109 add by beckxie---E
                     NEXT FIELD CURRENT
                  END IF

                  CALL aqct300_get_qcbd021(g_qcbd_d[l_ac].qcbd003,g_qcbd_d[l_ac].qcbd010) RETURNING g_qcbd_d[l_ac].qcbd021
                  IF g_qcbd_d[l_ac].qcbd021 > g_qcbd_d[l_ac].qcbd009 THEN
                     LET g_qcbd_d[l_ac].qcbd021 = g_qcbd_d[l_ac].qcbd009
                  END IF
                  IF g_qcbd_d[l_ac].qcbd021 >= g_qcbd_d[l_ac].qcbd006 THEN
                     LET g_qcbd_d[l_ac].qcbd011 = '2'
                  ELSE
                     LET g_qcbd_d[l_ac].qcbd011 = '1'
                  END IF
                  DISPLAY BY NAME g_qcbd_d[l_ac].qcbd021,g_qcbd_d[l_ac].qcbd011 
               END IF
            END IF
            LET g_qcbd_d_o.* = g_qcbd_d[l_ac].*   #160824-00007#352 20170109 add by beckxie]]>
</point>
  <point name="input.a.page1.qcbd021" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcbd_d[l_ac].qcbd021) THEN
               IF g_qcbd_d[l_ac].qcbd021 > g_qcbd_d[l_ac].qcbd009 THEN
                  LET g_qcbd_d[l_ac].qcbd021 = g_qcbd_d[l_ac].qcbd009
               END IF
               IF g_qcbd_d[l_ac].qcbd021 >= g_qcbd_d[l_ac].qcbd006 THEN
                  LET g_qcbd_d[l_ac].qcbd011 = '2'
               ELSE
                  LET g_qcbd_d[l_ac].qcbd011 = '1'
               END IF
               DISPLAY BY NAME g_qcbd_d[l_ac].qcbd021,g_qcbd_d[l_ac].qcbd011
            END IF]]>
</point>
  <point name="input.a.page1.qcbdseq" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd_d[g_detail_idx].qcbdseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd_d[g_detail_idx].qcbdseq != g_qcbd_d_t.qcbdseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbd_t WHERE "||"qcbdent = '" ||g_enterprise|| "' AND "||"qcbddocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbdseq = '"||g_qcbd_d[g_detail_idx].qcbdseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page2.qcbd001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
]]>
</point>
  <point name="input.a.page2.qcbe001" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbe001_desc(g_qcbd2_d[l_ac].qcbe001)
            IF NOT cl_null(g_qcbd2_d[l_ac].qcbe001) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcbd2_d[l_ac].qcbe001

               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aqc-00032:sub-01302|aqci030|",cl_get_progname("aqci030",g_lang,"2"),"|:EXEPROGaqci030"
               #160318-00025#21  by 07900 --add-end   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_1053") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd2_d[l_ac].qcbe001 = g_qcbd2_d_t.qcbe001
                  CALL aqct300_qcbe001_desc(g_qcbd2_d[l_ac].qcbe001)
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            

            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd2_d[g_detail_idx2].qcbe001 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR  g_qcbd2_d[g_detail_idx2].qcbe001 != g_qcbd2_d_t.qcbe001)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbe_t WHERE "||"qcbeent = '" ||g_enterprise|| "' AND "|| "qcbedocno = '"||g_qcba_m.qcbadocno ||"' AND  qcbeseq = "||g_qcbd_d[g_detail_idx].qcbdseq||" AND qcbe001 = '"||g_qcbd2_d[g_detail_idx2].qcbe001 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page2.qcbe002" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#            IF NOT aqct300_qcbe002_chk() THEN
#               LET g_qcbd2_d[l_ac].qcbd002 = g_qcbd2_d_t.qcbd002
#               NEXT FIELD CURRENT
#            END IF
             IF NOT cl_null(g_qcbd2_d[l_ac].qcbe002) THEN
                
                CALL aqct300_get_qcbd021(g_qcbd_d[g_detail_idx].qcbd003,g_qcbd2_d[l_ac].qcbe002)
                   RETURNING g_qcbd2_d[l_ac].qcbe004
                IF g_qcbd2_d[l_ac].qcbe004 > g_qcbd_d[g_detail_idx].qcbd009 THEN
                   LET g_qcbd2_d[l_ac].qcbe004 = g_qcbd_d[g_detail_idx].qcbd009
                END IF
                              
            END IF]]>
</point>
  <point name="input.a.page2.qcbe004" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcbd2_d[l_ac].qcbe004) THEN
               IF g_qcbd2_d[l_ac].qcbe004 > g_qcbd_d[g_detail_idx].qcbd009 THEN
                  LET g_qcbd2_d[l_ac].qcbe004 = g_qcbd_d[g_detail_idx].qcbd009
               END IF
            END IF]]>
</point>
  <point name="input.a.page2.qcbedocno" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_qcba_m.qcbasite IS NOT NULL AND g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd2_d[g_detail_idx].qcbedocno IS NOT NULL AND g_qcbd2_d[g_detail_idx].qcbeseq IS NOT NULL AND g_qcbd2_d[g_detail_idx].qcbe001 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t OR g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd2_d[g_detail_idx].qcbedocno != g_qcbd2_d_t.qcbedocno OR g_qcbd2_d[g_detail_idx].qcbeseq != g_qcbd2_d_t.qcbeseq OR g_qcbd2_d[g_detail_idx].qcbe001 != g_qcbd2_d_t.qcbe001)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbe_t WHERE "||"qcbeent = '" ||g_enterprise|| "' AND "||"qcbesite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbedocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbeseq = '"||g_qcbd2_d[g_detail_idx].qcbedocno ||"' AND "|| "qcbe001 = '"||g_qcbd2_d[g_detail_idx].qcbeseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page3.qcbfdocno" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_qcba_m.qcbasite IS NOT NULL AND g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbfdocno IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbfseq IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf001 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf002 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t OR g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd3_d[g_detail_idx].qcbfdocno != g_qcbd3_d_t.qcbfdocno OR g_qcbd3_d[g_detail_idx].qcbfseq != g_qcbd3_d_t.qcbfseq OR g_qcbd3_d[g_detail_idx].qcbf001 != g_qcbd3_d_t.qcbf001 OR g_qcbd3_d[g_detail_idx].qcbf002 != g_qcbd3_d_t.qcbf002 OR g_qcbd3_d[g_detail_idx].qcbf003 != g_qcbd3_d_t.qcbf003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbf_t WHERE "||"qcbfent = '" ||g_enterprise|| "' AND "||"qcbfsite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbfdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbfseq = '"||g_qcbd3_d[g_detail_idx].qcbfdocno ||"' AND "|| "qcbf001 = '"||g_qcbd3_d[g_detail_idx].qcbfseq ||"' AND "|| "qcbf002 = '"||g_qcbd3_d[g_detail_idx].qcbf001 ||"' AND "|| "qcbf003 = '"||g_qcbd3_d[g_detail_idx].qcbf002 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page4.qcbb001" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb001 IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb002 IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd4_d[g_detail_idx].qcbb001 != g_qcbd4_d_t.qcbb001 OR g_qcbd4_d[g_detail_idx].qcbb002 != g_qcbd4_d_t.qcbb002 OR g_qcbd4_d[g_detail_idx].qcbb003 != g_qcbd4_d_t.qcbb003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbb_t WHERE "||"qcbbent = '" ||g_enterprise|| "' AND "|| "qcbbdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbb001 = '"||g_qcbd4_d[g_detail_idx].qcbb001 ||"' AND "|| "qcbb002 = '"||g_qcbd4_d[g_detail_idx].qcbb002 ||"' AND "|| "qcbb003 = '"||g_qcbd4_d[g_detail_idx].qcbb003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page4.qcbb002" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb001 IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb002 IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd4_d[g_detail_idx].qcbb001 != g_qcbd4_d_t.qcbb001 OR g_qcbd4_d[g_detail_idx].qcbb002 != g_qcbd4_d_t.qcbb002 OR g_qcbd4_d[g_detail_idx].qcbb003 != g_qcbd4_d_t.qcbb003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbb_t WHERE "||"qcbbent = '" ||g_enterprise|| "' AND "|| "qcbbdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbb001 = '"||g_qcbd4_d[g_detail_idx].qcbb001 ||"' AND "|| "qcbb002 = '"||g_qcbd4_d[g_detail_idx].qcbb002 ||"' AND "|| "qcbb003 = '"||g_qcbd4_d[g_detail_idx].qcbb003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page4.qcbb003" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb001 IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb002 IS NOT NULL AND g_qcbd4_d[g_detail_idx].qcbb003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd4_d[g_detail_idx].qcbb001 != g_qcbd4_d_t.qcbb001 OR g_qcbd4_d[g_detail_idx].qcbb002 != g_qcbd4_d_t.qcbb002 OR g_qcbd4_d[g_detail_idx].qcbb003 != g_qcbd4_d_t.qcbb003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbb_t WHERE "||"qcbbent = '" ||g_enterprise|| "' AND "|| "qcbbdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbb001 = '"||g_qcbd4_d[g_detail_idx].qcbb001 ||"' AND "|| "qcbb002 = '"||g_qcbd4_d[g_detail_idx].qcbb002 ||"' AND "|| "qcbb003 = '"||g_qcbd4_d[g_detail_idx].qcbb003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page5.qcbc002" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc002_desc(g_qcbd5_d[l_ac].qcbc002)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc002) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcaz001
               LET g_chkparam.arg2 = g_qcbd5_d[l_ac].qcbc002

               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
                LET g_chkparam.err_str[1] ="aqc-00030:sub-01302|aqci020|",cl_get_progname("aqci020",g_lang,"2"),"|:EXEPROGaqci020"
                #160318-00025#21  by 07900 --add-end   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_qcao002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd5_d[l_ac].qcbc002 = g_qcbd5_d_t.qcbc002
                 
                  NEXT FIELD CURRENT
               END IF
#               IF l_cmd = 'a' OR (l_cmd = 'u' AND g_qcbd5_d_o.qcbc002 != g_qcbd5_d[l_ac].qcbc002) THEN
                  CALL aqct300_qcbc002_ref(g_qcbd5_d[l_ac].qcbc002,l_cmd)
#               END IF
            ELSE
               LET g_qcbd5_d[l_ac].qcbc012 = '4'
               LET g_qcbd5_d[l_ac].qcbc002 = ' '
            END IF 
#            LET g_qcbd5_d_o.qcbc002 = g_qcbd5_d[l_ac].qcbc002
]]>
</point>
  <point name="input.a.page5.qcbc003" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc003_desc()
            CALL aqct300_set_entry_b(l_cmd)
            CALL aqct300_set_no_entry_b(l_cmd)]]>
</point>
  <point name="input.a.page5.qcbc004" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #160407-00024#1 add(s)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc004) THEN
               IF NOT s_feature_check(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) THEN 
                  LET g_qcbd5_d[l_ac].qcbc004 = g_qcbd5_d_t.qcbc004
                  NEXT FIELD CURRENT
               END IF
            END IF
            CALL s_feature_description(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) RETURNING g_success,g_qcbd5_d[l_ac].qcbc004_desc  
            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004_desc 
            #160407-00024#1 add(e)]]>
</point>
  <point name="input.a.page5.qcbc005" order="" ver="7" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc005_desc(g_qcbd5_d[l_ac].qcbc005)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc005) AND (g_qcbd5_d[l_ac].qcbc005 != g_qcbd5_d_o.qcbc005 OR cl_null(g_qcbd5_d_o.qcbc005))THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcbasite
               LET g_chkparam.arg2 = g_qcbd5_d[l_ac].qcbc005

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_inaa001_1") THEN
                  

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd5_d[l_ac].qcbc005 = g_qcbd5_d_t.qcbc005
                  CALL aqct300_qcbc005_desc(g_qcbd5_d[l_ac].qcbc005)
                  NEXT FIELD CURRENT
               END IF
              #IF s_lot_batch_number(g_qcbd5_d[l_ac].qcbc003,g_site) THEN     #160314-00008#1 mark 
               IF s_lot_batch_number_1n3(g_qcbd5_d[l_ac].qcbc003,g_site) THEN #160314-00008#1 add
                  IF NOT s_lot_upd_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,0,'2',g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_site,' ') THEN
                     LET g_qcbd5_d[l_ac].qcbc005 = g_qcbd5_d_o.qcbc005
                     NEXT FIELD CURRENT
                  END IF
               END IF

            END IF 
            LET g_qcbd5_d_o.qcbc005 = g_qcbd5_d[l_ac].qcbc005
]]>
</point>
  <point name="input.a.page5.qcbc006" order="" ver="7" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc006_desc(g_qcbd5_d[l_ac].qcbc006)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc006) AND (g_qcbd5_d[l_ac].qcbc006 != g_qcbd5_d_o.qcbc006 OR cl_null(g_qcbd5_d_o.qcbc006))THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcbasite
               LET g_chkparam.arg2 = g_qcbd5_d[l_ac].qcbc005
               LET g_chkparam.arg3 = g_qcbd5_d[l_ac].qcbc006

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_inab002_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcbd5_d[l_ac].qcbc006 = g_qcbd5_d_t.qcbc006
                  CALL aqct300_qcbc006_desc(g_qcbd5_d[l_ac].qcbc006)
                  NEXT FIELD CURRENT
               END IF
              #IF s_lot_batch_number(g_qcbd5_d[l_ac].qcbc003,g_site) THEN     #160314-00008#1 mark
               IF s_lot_batch_number_1n3(g_qcbd5_d[l_ac].qcbc003,g_site) THEN #160314-00008#1 add
                  IF NOT s_lot_upd_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,0,'2',g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_site,' ') THEN
                     LET g_qcbd5_d[l_ac].qcbc006 = g_qcbd5_d_o.qcbc006
                     NEXT FIELD CURRENT
                  END IF
               END IF

            END IF 
            LET g_qcbd5_d_o.qcbc006 = g_qcbd5_d[l_ac].qcbc006
]]>
</point>
  <point name="input.a.page5.qcbc007" order="" ver="7" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc007) AND (g_qcbd5_d[l_ac].qcbc007 != g_qcbd5_d_o.qcbc007 OR cl_null(g_qcbd5_d_o.qcbc007))THEN 
              #IF s_lot_batch_number(g_qcbd5_d[l_ac].qcbc003,g_site) THEN     #160314-00008#1 mark
               IF s_lot_batch_number_1n3(g_qcbd5_d[l_ac].qcbc003,g_site) THEN #160314-00008#1 add
                  IF NOT s_lot_upd_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,0,'2',g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_site,' ') THEN
                     LET g_qcbd5_d[l_ac].qcbc007 = g_qcbd5_d_o.qcbc007
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            LET g_qcbd5_d_o.qcbc007 = g_qcbd5_d[l_ac].qcbc007]]>
</point>
  <point name="input.a.page5.qcbc008" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc008) THEN
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcbd5_d[l_ac].qcbc008
               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aim-00005:sub-01302|aooi250|",cl_get_progname("aooi250",g_lang,"2"),"|:EXEPROGaooi250"
               #160318-00025#21  by 07900 --add-end
               IF NOT cl_chk_exist("v_ooca001") THEN
                  LET g_qcbd5_d[l_ac].qcbc008 = g_qcbd5_d_t.qcbc008
                  CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
                  NEXT FIELD CURRENT
               ELSE
                  IF NOT aqct300_qcbc009_Compare() THEN
                     LET g_qcbd5_d[l_ac].qcbc008 = g_qcbd5_d_t.qcbc008
                     CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
                     NEXT FIELD CURRENT 
                  END IF                 
               END IF
               
            END IF
            ]]>
</point>
  <point name="input.a.page5.qcbc009" order="" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcbd5_d[l_ac].qcbc009) THEN
                #161124-00048#10 mark(s)
#               #161129-00005#1-(S)-add
#               IF NOT aqct300_qcbc009_sum_chk2(g_qcbd5_d[l_ac].qcbcseq,g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbc009) THEN
#                  NEXT FIELD qcbc009
#               END IF
#               #161129-00005#1-(E)-add
               #161124-00048#20 mark(e)
               IF NOT aqct300_qcbc009_Compare() THEN
                  LET g_qcbd5_d[l_ac].qcbc009 = g_qcbd5_d_t.qcbc009
                  NEXT FIELD CURRENT 
               END IF
               IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq) THEN
                  NEXT FIELD CURRENT
               END IF
               IF l_cmd = 'a' THEN 
                  DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno
                     AND inaoseq = g_qcbd5_d[l_ac].qcbcseq
                  IF NOT s_aqct300_ins_inao(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq,'N') THEN
                     NEXT FIELD CURRENT
                  END IF
               END IF
               IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_qcbd5_d_o.qcbc009 != g_qcbd5_d[l_ac].qcbc009)) THEN
                  IF NOT aqct300_upd_inao(g_qcbd5_d[g_detail_idx].qcbcseq,g_qcbd5_d[g_detail_idx].qcbc009,g_qcbd5_d[g_detail_idx].qcbc004,
                                        g_qcbd5_d[g_detail_idx].qcbc005,g_qcbd5_d[g_detail_idx].qcbc006,g_qcbd5_d[g_detail_idx].qcbc007) THEN
                     IF l_cmd = 'a' THEN
                        DELETE FROM inao_t WHERE inaoent = g_enterprise AND inaodocno = g_qcba_m.qcbadocno
                           AND inaoseq = g_qcbd5_d[l_ac].qcbcseq
                        
                     END IF
                     IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq) THEN
                        NEXT FIELD CURRENT
                     END IF
                     NEXT FIELD CURRENT
                  END IF
               END IF
               IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[l_ac].qcbcseq) THEN
                  NEXT FIELD CURRENT
               END IF
                
            END IF
            LET g_qcbd5_d_o.qcbc009 = g_qcbd5_d[l_ac].qcbc009]]>
</point>
  <point name="input.a.page5.qcbcseq" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd5_d[g_detail_idx].qcbcseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd5_d[g_detail_idx].qcbcseq != g_qcbd5_d_t.qcbcseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbc_t WHERE "||"qcbcent = '" ||g_enterprise|| "' AND "|| "qcbcdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbcseq = '"||g_qcbd5_d[g_detail_idx].qcbcseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page7.qcbg001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            #確認資料無重複
            

]]>
</point>
  <point name="input.a.page7.qcbg002" order="" ver="19" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcbd7_d[l_ac].qcbg002) THEN 
               IF l_qcan015 MATCHES '[23]' THEN
                  #IF NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd015) THEN    #160607-00004#1 mark
                  #   IF g_qcbd7_d[l_ac].qcbg002 <= g_qcbd6_d[g_detail_idx].qcbd013 AND g_qcbd7_d[l_ac].qcbg002 >= g_qcbd6_d[g_detail_idx].qcbd015 THEN  #160607-00004#1 mark
                  IF NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd015) THEN   #160607-00004#1 add
                     IF g_qcbd7_d[l_ac].qcbg002 <= g_qcbd99_d[g_detail_idx].qcbd013 AND g_qcbd7_d[l_ac].qcbg002 >= g_qcbd99_d[g_detail_idx].qcbd015 THEN #160607-00004#1 add
                        LET g_qcbd7_d[l_ac].qcbg003 = 'Y'
                     ELSE
                        LET g_qcbd7_d[l_ac].qcbg003 = 'N'
                     END IF
                  END IF
                  
                  #IF NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd013) AND cl_null(g_qcbd6_d[g_detail_idx].qcbd015) THEN #160607-00004#1 mark
                  #   IF g_qcbd7_d[l_ac].qcbg002 <= g_qcbd6_d[g_detail_idx].qcbd013 THEN  #160607-00004#1 mark
                  IF NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd013) AND cl_null(g_qcbd99_d[g_detail_idx].qcbd015) THEN #160607-00004#1 add                                                                  
                     IF g_qcbd7_d[l_ac].qcbg002 <= g_qcbd99_d[g_detail_idx].qcbd013 THEN  #160607-00004#1 add
                        LET g_qcbd7_d[l_ac].qcbg003 = 'Y'
                     ELSE
                        LET g_qcbd7_d[l_ac].qcbg003 = 'N'
                     END IF
                  END IF
                  
                  #IF cl_null(g_qcbd6_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd015) THEN #160607-00004#1 mark
                  #   IF g_qcbd7_d[l_ac].qcbg002 >= g_qcbd6_d[g_detail_idx].qcbd015 THEN   #160607-00004#1 mark
                  IF cl_null(g_qcbd99_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd015) THEN #160607-00004#1 add
                     IF g_qcbd7_d[l_ac].qcbg002 >= g_qcbd99_d[g_detail_idx].qcbd015 THEN #160607-00004#1 add
                        LET g_qcbd7_d[l_ac].qcbg003 = 'Y'
                     ELSE
                        LET g_qcbd7_d[l_ac].qcbg003 = 'N'
                     END IF
                  END IF
                  DISPLAY BY NAME g_qcbd7_d[l_ac].qcbg003      #160902-00011#1
               END IF
            END IF 

]]>
</point>
  <point name="input.a.page7.qcbgdocno" order="" ver="0" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd_d[g_detail_idx].qcbdseq IS NOT NULL AND g_qcbd7_d[g_detail_idx2].qcbgdocno IS NOT NULL AND g_qcbd7_d[g_detail_idx2].qcbgseq IS NOT NULL AND g_qcbd7_d[g_detail_idx2].qcbg001 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd_d[g_detail_idx].qcbdseq != g_qcbd_d[g_detail_idx].qcbdseq OR g_qcbd7_d[g_detail_idx2].qcbgdocno != g_qcbd7_d_t.qcbgdocno OR g_qcbd7_d[g_detail_idx2].qcbgseq != g_qcbd7_d_t.qcbgseq OR g_qcbd7_d[g_detail_idx2].qcbg001 != g_qcbd7_d_t.qcbg001)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbg_t WHERE "||"qcbgent = '" ||g_enterprise|| "' AND "||"qcbgdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbgseq = '"||g_qcbd_d[g_detail_idx].qcbdseq ||"' AND "|| "qcbg001 = '"||g_qcbd7_d[g_detail_idx2].qcbgdocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page7.qcbgseq" order="" ver="0" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_qcba_m.qcbadocno IS NOT NULL AND g_qcbd_d[g_detail_idx].qcbdseq IS NOT NULL AND g_qcbd7_d[g_detail_idx2].qcbgdocno IS NOT NULL AND g_qcbd7_d[g_detail_idx2].qcbgseq IS NOT NULL AND g_qcbd7_d[g_detail_idx2].qcbg001 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t OR g_qcbd_d[g_detail_idx].qcbdseq != g_qcbd_d[g_detail_idx].qcbdseq OR g_qcbd7_d[g_detail_idx2].qcbgdocno != g_qcbd7_d_t.qcbgdocno OR g_qcbd7_d[g_detail_idx2].qcbgseq != g_qcbd7_d_t.qcbgseq OR g_qcbd7_d[g_detail_idx2].qcbg001 != g_qcbd7_d_t.qcbg001)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM qcbg_t WHERE "||"qcbgent = '" ||g_enterprise|| "' AND "||"qcbgdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbgseq = '"||g_qcbd_d[g_detail_idx].qcbdseq ||"' AND "|| "qcbg001 = '"||g_qcbd7_d[g_detail_idx2].qcbgdocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.qcba001" order="" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcba_m.qcba001) THEN
               IF p_cmd = 'a' OR (g_qcba_m.qcba001 <> g_qcba_m_o.qcba001 OR cl_null(g_qcba_m_o.qcba001)) THEN
                  #160204-00004#4 Add By Ken 160222(S)
                  IF NOT s_aooi210_check_doc(g_site,'',g_qcba_m.qcba001,g_qcba_m.qcbadocno,'4','') THEN
                     LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                     NEXT FIELD CURRENT
                  END IF
                  #160204-00004#4 Add By Ken 160222(S)                  
                  
                  IF NOT aqct300_qcba001_chk() THEN
                     LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                     NEXT FIELD CURRENT
                  END IF
                  
                  IF g_qcba_m.qcba000 != '3' THEN    #非PQC逻辑
                     IF NOT cl_null(g_qcba_m.qcba001) AND NOT cl_null(g_qcba_m.qcba002) THEN
                        IF NOT aqct300_qcba002_chk() THEN
                           LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                           NEXT FIELD qcba002
                        END IF
                     #160324-00033#1----S
                     END IF 
                     IF g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '6' THEN
                        IF NOT aqct300_default_qc_values() THEN
                           LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                           CALL aqct300_get_qc_values()
                           NEXT FIELD CURRENT
                        END IF
                     ELSE
                        IF NOT cl_null(g_qcba_m.qcba002) THEN 
                     #160324-00033#1-----E                          
                           IF NOT aqct300_default_qc_values() THEN
                              LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                              CALL aqct300_get_qc_values()
                              NEXT FIELD CURRENT
                           END IF
                        END IF
                     END IF
                  ELSE
                     #161103-00007#3---s                  
                     #IF NOT cl_null(g_qcba_m.qcba002) AND cl_null(g_qcba_m.qcba029) THEN
                     #   IF NOT aqct300_qcba002_chk() THEN
                     #      LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                     #      NEXT FIELD qcba002
                     #   END IF
                     #END IF
                     #
                     #IF cl_null(g_qcba_m.qcba002) AND NOT cl_null(g_qcba_m.qcba029) THEN
                     #   IF NOT aqct300_pqc_chk_1() THEN
                     #      LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                     #      NEXT FIELD qcba029
                     #   END IF
                     #END IF
                     #
                     #IF NOT cl_null(g_qcba_m.qcba002) AND NOT cl_null(g_qcba_m.qcba029) THEN
                     #   IF NOT aqct300_pqc_chk_2() THEN
                     #      LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                     #      NEXT FIELD CURRENT
                     #   END IF
                     #   
                     #   IF NOT aqct300_default_qc_values() THEN
                     #      LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                     #      CALL aqct300_get_qc_values()
                     #      NEXT FIELD CURRENT
                     #   END IF
                     #END IF
                     #170110-00056#1 add(s)
                     IF NOT cl_null(g_qcba_m.qcba001) AND NOT cl_null(g_qcba_m.qcba002) THEN
                        IF NOT aqct300_qcba002_chk() THEN
                           LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                           NEXT FIELD qcba002
                        END IF
                     END IF 
                     #170110-00056#1 add(e)
                     IF NOT aqct300_default_qc_values() THEN
                        LET g_qcba_m.qcba001 = g_qcba_m_o.qcba001
                        CALL aqct300_get_qc_values()
                        NEXT FIELD CURRENT
                     END IF
                     #161103-00007#3---e
                  END IF
               END IF
               
            END IF
            
            LET g_qcba_m_o.* = g_qcba_m.*
            
            LET g_qcba_m_t.qcba017 = g_qcba_m.qcba017]]>
</point>
  <point name="input.a.qcba002" order="" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcba_m.qcba001) AND NOT cl_null(g_qcba_m.qcba002) THEN   
               IF g_qcba_m.qcba002 <> g_qcba_m_o.qcba002 OR cl_null(g_qcba_m_o.qcba002) THEN  
#                  IF g_qcba_m.qcba000 != '3' THEN                 #170110-00056#1 mark
                     IF NOT aqct300_qcba002_chk() THEN
                        LET g_qcba_m.qcba002 = g_qcba_m_o.qcba002
                        NEXT FIELD CURRENT 
                     END IF
                     
                     IF NOT aqct300_default_qc_values() THEN
                        LET g_qcba_m.qcba002 = g_qcba_m_o.qcba002
                        CALL aqct300_get_qc_values()
                        NEXT FIELD CURRENT
                     END IF
                #170110-00056#1 mark(s)
#                  ELSE
#                     IF NOT cl_null(g_qcba_m.qcba029) THEN
#                        IF NOT aqct300_pqc_chk_2() THEN
#                           LET g_qcba_m.qcba002 = g_qcba_m_o.qcba002
#                           NEXT FIELD CURRENT
#                        END IF
#                        
#                        IF NOT aqct300_default_qc_values() THEN
#                           LET g_qcba_m.qcba002 = g_qcba_m_o.qcba002
#                           CALL aqct300_get_qc_values()
#                           NEXT FIELD CURRENT
#                        END IF
#                     END IF
#                  END IF
                #170110-00056#1 mark(e)
               END IF
               
            END IF
            LET g_qcba_m_o.* = g_qcba_m.*
            LET g_qcba_m_t.qcba017 = g_qcba_m.qcba017]]>
</point>
  <point name="input.a.qcba005" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcba005_desc('')
            IF NOT cl_null(g_qcba_m.qcba005) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcba005

               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="apm-00044:sub-01302|apmm100|",cl_get_progname("apmm100",g_lang,"2"),"|:EXEPROGapmm100"
               #160318-00025#21  by 07900 --add-end   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmaa001_2") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcba_m.qcba005 = g_qcba_m_t.qcba005
                  CALL aqct300_qcba005_desc(g_qcba_m.qcba005)
                  NEXT FIELD CURRENT
               END IF
               CALL aqct300_qcba005_desc(g_qcba_m.qcba005)

            END IF 

]]>
</point>
  <point name="input.a.qcba006" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcba_m.qcba006) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcba006

               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aqc-00017:sub-01302|aeci004|",cl_get_progname("aeci004",g_lang,"2"),"|:EXEPROGaeci004"
               #160318-00025#21  by 07900 --add-end   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_221") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcba_m.qcba006 = g_qcba_m_t.qcba006
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcba006
#            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocq002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcba006_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcba006_desc
]]>
</point>
  <point name="input.a.qcba010" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
]]>
</point>
  <point name="input.a.qcba012" order="" ver="0" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
]]>
</point>
  <point name="input.a.qcba015" order="" ver="17" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcba_m.qcba015) THEN
               LET l_qcba015 = g_qcba_m.qcba015
               LET l_qcba015_1 = l_qcba015.subString(1,2)
               #160405-00005#1 mod--s
               #LET l_qcba015_2 = l_qcba015.subString(l_qcba015.getIndexOf(":",1)+1,l_qcba015.getLength()) 
               LET l_qcba015_2 = l_qcba015.subString(4,5)
               LET l_qcba015_5 = l_qcba015.subString(7,8) 
               #160405-00005#1 mod--e
               #IF l_qcba015_1 >24 OR l_qcba015_2 >60 THEN
               IF l_qcba015_1 >= 24 OR l_qcba015_2 >= 60 OR l_qcba015_5 >= 60 THEN  #160405-00005#1 mod
                  #输入的时间不正确
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'aoo-00712'  #160405-00005#1 mod aoo-00283->aoo-00712
                  LET g_errparam.extend = g_qcba_m.qcba015
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_qcba_m.qcba015 = g_qcba_m_t.qcba015
                  NEXT FIELD qcba015
               END IF 
               LET l_hour_top = l_qcba015_1
               LET l_minute_top = l_qcba015_2
               
               #160405-00005#1 mark --s
               #IF l_hour_top = 24 AND l_minute_top = 60 THEN
               #   LET l_qcba015_1 = 1
               #   LET l_qcba015_2 = 0
               #ELSE
               #   IF l_qcba015_2 = 60 THEN
               #      LET l_qcba015_2 = 0
               #      LET l_qcba015_1 = l_qcba015_1 + 1
               #   END IF
               #   
               #   IF l_qcba015_1 = 24 THEN
               #      LET l_qcba015_1 = 0
               #   END IF
               #END IF
               #160405-00005#1 mark --e
                          
               
               IF l_qcba015_1 < 10 THEN
                  LET l_qcba015_3 = l_qcba015_1
                  LET l_qcba015_3 = '0',l_qcba015_3
               ELSE
                  LET l_qcba015_3 = l_qcba015_1      
               END IF 
               IF l_qcba015_2 < 10 THEN
                  LET l_qcba015_4 = l_qcba015_2
                  LET l_qcba015_4 = '0',l_qcba015_4
               ELSE
                  LET l_qcba015_4 = l_qcba015_2     
               END IF 
               #160405-00005#1 add--s
               IF l_qcba015_5 < 10 THEN
                  LET l_qcba015_6 = l_qcba015_5
                  LET l_qcba015_6 = '0',l_qcba015_6
               ELSE
                  LET l_qcba015_6 = l_qcba015_5   
               END IF 
               #160405-00005#1 add--e
               IF cl_null(l_qcba015_1) THEN
                  LET l_qcba015_3 = '00'
               END IF
               IF cl_null(l_qcba015_2) THEN
                  LET l_qcba015_4 = '00'
               END IF
               #160405-00005#1 add--s
               IF cl_null(l_qcba015_5) THEN
                  LET l_qcba015_6 = '00'
               END IF
               #160405-00005#1 add--e
               #LET g_qcba_m.qcba015 = l_qcba015_3,':',l_qcba015_4
               LET g_qcba_m.qcba015 = l_qcba015_3,':',l_qcba015_4,':',l_qcba015_6   #160405-00005#1 mod
            END IF]]>
</point>
  <point name="input.a.qcba016" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcba016_desc(g_qcba_m.qcba016)          
            IF NOT cl_null(g_qcba_m.qcba016) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcba016

               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aim-00005:sub-01302|aooi250|",cl_get_progname("aooi250",g_lang,"2"),"|:EXEPROGaooi250"
               #160318-00025#21  by 07900 --add-end   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooca001") THEN
                  #檢查成功時後續處理
                  

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcba_m.qcba016 = g_qcba_m_t.qcba016
                  CALL aqct300_qcba016_desc(g_qcba_m.qcba016)  
                  NEXT FIELD CURRENT
               END IF
            
            END IF 
            
]]>
</point>
  <point name="input.a.qcba017" order="" ver="23" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #160912-00021#3-s
            IF NOT (g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '3' AND g_qcba_m.qcba008 < 0 ) THEN
               #確認欄位值在特定區間內
               IF NOT cl_ap_chk_range(g_qcba_m.qcba017,"0","0","","","azz-00079",1) THEN
                  NEXT FIELD qcba017
               END IF 
            END IF
            #160912-00021#3-e
            IF NOT cl_null(g_qcba_m.qcba017) THEN 
               IF NOT aqct300_qcba017_chk(p_cmd) THEN
                  LET g_qcba_m.qcba017 = g_qcba_m_t.qcba017
                  NEXT FIELD CURRENT 
               END IF
               IF NOT cl_null(g_qcba_m_o.qcba017) AND g_qcba_m_o.qcba017 != g_qcba_m.qcba017 THEN
                  CALL aqct300_rmake_detail()    #更改送验量后觉得是否要重产抽样与结果
               END IF
            END IF 
            LET g_qcba_m_o.qcba017 = g_qcba_m.qcba017
]]>
</point>
  <point name="input.a.qcba024" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcba024_desc('')
            IF NOT cl_null(g_qcba_m.qcba024) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcba024

               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aim-00070:sub-01302|aooi130|",cl_get_progname("aooi130",g_lang,"2"),"|:EXEPROGaooi130"
               #160318-00025#21  by 07900 --add-end    
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooag001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcba_m.qcba024 = g_qcba_m_t.qcba024
                  CALL aqct300_qcba024_desc(g_qcba_m.qcba024)
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            CALL aqct300_qcba024_desc(g_qcba_m.qcba024)
]]>
</point>
  <point name="input.a.qcba025" order="" ver="17" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcba_m.qcba025) THEN
               LET l_qcba025 = g_qcba_m.qcba025
               LET l_qcba025_1 = l_qcba025.subString(1,2)

               #160405-00005#1 mod--s
               #LET l_qcba025_2 = l_qcba025.subString(l_qcba025.getIndexOf(":",1)+1,l_qcba025.getLength())
               LET l_qcba025_2 = l_qcba025.subString(4,5)
               LET l_qcba025_5 = l_qcba025.subString(7,8) 
               #160405-00005#1 mod--e   
               #IF l_qcba025_1 >24 OR l_qcba025_2 >60 THEN
               IF l_qcba025_1 >= 24 OR l_qcba025_2 >= 60 OR l_qcba025_5 >= 60 THEN  #160405-00005#1 mod
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'aoo-00712'  #160405-00005#1 mod aoo-00283->aoo-00712
                  LET g_errparam.extend = g_qcba_m.qcba025
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
                  LET g_qcba_m.qcba025 = g_qcba_m_t.qcba025
                  NEXT FIELD qcba025
               END IF 
               LET l_hour_top = l_qcba025_1
               LET l_minute_top = l_qcba025_2 

               #160405-00005#1 mark --s
               #IF l_hour_top = 24 AND l_minute_top = 60 THEN
               #   LET l_qcba025_1 = 1
               #   LET l_qcba025_2 = 0
               #ELSE
               #   IF l_qcba025_2 = 60 THEN
               #      LET l_qcba025_2 = 0
               #      LET l_qcba025_1 = l_qcba025_1 + 1
               #   END IF
               #   
               #   IF l_qcba025_1 = 24 THEN
               #      LET l_qcba025_1 = 0
               #   END IF
               #END IF
               #160405-00005#1 mark --e
               
               IF l_qcba025_1 < 10 THEN
                  LET l_qcba025_3 = l_qcba025_1
                  LET l_qcba025_3 = '0',l_qcba025_3
               ELSE
                  LET l_qcba025_3 = l_qcba025_1      
               END IF 
               IF l_qcba025_2 < 10 THEN
                  LET l_qcba025_4 = l_qcba025_2
                  LET l_qcba025_4 = '0',l_qcba025_4
               ELSE
                  LET l_qcba025_4 = l_qcba025_2     
               END IF 
               #160405-00005#1 add--s
               IF l_qcba025_5 < 10 THEN
                  LET l_qcba025_6 = l_qcba025_5
                  LET l_qcba025_6 = '0',l_qcba025_6
               ELSE
                  LET l_qcba025_6 = l_qcba025_5   
               END IF 
               #160405-00005#1 add--e
               IF cl_null(l_qcba025_1) THEN
                  LET l_qcba025_3 = '00'
               END IF
               IF cl_null(l_qcba025_2) THEN
                  LET l_qcba025_4 = '00'
               END IF
               #160405-00005#1 add--s
               IF cl_null(l_qcba025_5) THEN
                  LET l_qcba025_6 = '00'
               END IF
               #160405-00005#1 add--e
               #LET g_qcba_m.qcba025 = l_qcba025_3,':',l_qcba025_4
               LET g_qcba_m.qcba025 = l_qcba025_3,':',l_qcba025_4,':',l_qcba025_6  #160405-00005#1 mod
            END IF
            
            #160405-00005#1 add--s
            #计算出检验时间
            IF NOT cl_null(g_qcba_m.qcba015) AND NOT cl_null(g_qcba_m.qcba025) AND NOT cl_null(g_qcba_m.qcba014) AND NOT cl_null(g_qcba_m.qcba028) THEN
               LET l_before_date = g_qcba_m.qcba014
               LET l_before_time = g_qcba_m.qcba015
               LET l_after_time = g_qcba_m.qcba025
               LET l_after_date = g_qcba_m.qcba028
               
               LET l_year_str = l_before_date.subString(1,4)
               LET l_month_str = l_before_date.subString(6,7)
               LET l_day_str = l_before_date.subString(9,10)
               LET l_hour_str = l_before_time.subString(1,2)
               LET l_minute_str  = l_before_time.subString(4,5)
               LET l_second_str  = l_before_time.subString(7,8)
               
               LET l_year_num = l_year_str  IF cl_null(l_year_num) THEN LET l_year_num = 0 END IF
               LET l_month_num = l_month_str IF cl_null(l_month_num) THEN LET l_month_str = 0 END IF
               LET l_day_num = l_day_str   IF cl_null(l_day_num) THEN LET l_day_num = 0 END IF
               LET l_hour_num = l_hour_str IF cl_null(l_hour_num) THEN LET l_hour_num = 0 END IF
               LET l_minute_num = l_minute_str IF cl_null(l_minute_num) THEN LET l_minute_num = 0 END IF
               LET l_second_num = l_second_str IF cl_null(l_second_num) THEN LET l_second_num = 0 END IF
               LET l_before_second = (l_year_num * 365 * 24 * 60 * 60 )+ (l_month_num * 31 * 24 * 60 * 60) +
                                     (l_day_num * 24 * 60 * 60) + (l_hour_num * 60 * 60) + (l_minute_num * 60) + l_second_num
               
               LET l_year_str = l_after_date.subString(1,4)
               LET l_month_str = l_after_date.subString(6,7)
               LET l_day_str = l_after_date.subString(9,10)
               LET l_hour_str = l_after_time.subString(1,2)
               LET l_minute_str  = l_after_time.subString(4,5)
               LET l_second_str  = l_after_time.subString(7,8)
               
               LET l_year_num = l_year_str  IF cl_null(l_year_num) THEN LET l_year_num = 0 END IF
               LET l_month_num = l_month_str  IF cl_null(l_month_num) THEN LET l_month_str = 0 END IF
               LET l_day_num = l_day_str  IF cl_null(l_day_num) THEN LET l_day_num = 0 END IF
               LET l_hour_num = l_hour_str  IF cl_null(l_hour_num) THEN LET l_hour_num = 0 END IF
               LET l_minute_num = l_minute_str  IF cl_null(l_minute_num) THEN LET l_minute_num = 0 END IF
               LET l_second_num = l_second_str  IF cl_null(l_second_num) THEN LET l_second_num = 0 END IF
               
               LET l_after_second = (l_year_num * 365 * 24 * 60 * 60 )+ (l_month_num * 31 * 24 * 60 * 60) +
                                    (l_day_num * 24 * 60 * 60) + (l_hour_num * 60 * 60) + (l_minute_num * 60) + l_second_num
               
               IF l_after_second - l_before_second < 0 THEN
                  #完成日期时间不可小于检验日期时间
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'aoo-00713'
                  LET g_errparam.extend = g_qcba_m.qcba025
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
                  LET g_qcba_m.qcba025 = g_qcba_m_t.qcba025
                  NEXT FIELD CURRENT
               END IF
               
               IF cl_null(g_qcba_m.qcba026) THEN
                  LET g_qcba_m.qcba026 = (l_after_second - l_before_second) / 60
                  DISPLAY BY NAME g_qcba_m.qcba026
               END IF
            END IF
            #160405-00005#1 add--]]>
</point>
  <point name="input.a.qcba027" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcba_m.qcba027) THEN
#               SELECT MAX(qcbe004) INTO l_max_qcbe004 FROM qcbe_t
#                WHERE qcbeent = g_enterprise
#                  AND qcbesite = g_site AND qcbedocno = g_qcba_m.qcbadocno
#               IF g_qcba_m.qcba027 < l_max_qcbe004 THEN
#                  INITIALIZE g_errparam TO NULL
#                  LET g_errparam.code = 'aqc-00052'
#                  LET g_errparam.extend = ''
#                  LET g_errparam.popup = TRUE
#                  CALL cl_err()
#
#                  LET g_qcba_m.qcba027 = g_qcba_m_t.qcba027
#                  NEXT FIELD CURRENT
#               END IF
               
               IF g_qcba_m.qcba027 > g_qcba_m.qcba017 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'aqc-00053'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_qcba_m.qcba027 = g_qcba_m_t.qcba027
                  NEXT FIELD CURRENT
               END IF
            END IF]]>
</point>
  <point name="input.a.qcba029" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT cl_null(g_qcba_m.qcba001) AND NOT cl_null(g_qcba_m.qcba029) THEN   
               IF g_qcba_m.qcba029 <> g_qcba_m_o.qcba029 OR cl_null(g_qcba_m_o.qcba029) THEN            
                  IF NOT aqct300_pqc_chk_1() THEN
                     LET g_qcba_m.qcba029 = g_qcba_m_o.qcba029
                     NEXT FIELD CURRENT
                  END IF
                  
                  IF NOT cl_null(g_qcba_m.qcba002) THEN
                     IF NOT aqct300_pqc_chk_2() THEN
                        LET g_qcba_m.qcba029 = g_qcba_m_o.qcba029
                        NEXT FIELD CURRENT
                     END IF
                     
                     IF NOT aqct300_default_qc_values() THEN
                        LET g_qcba_m.qcba029 = g_qcba_m_o.qcba029
                        CALL aqct300_get_qc_values()
                        NEXT FIELD CURRENT
                     END IF
                  END IF
               END IF
               
            END IF
            LET g_qcba_m_o.* = g_qcba_m.*
            LET g_qcba_m_t.qcba017 = g_qcba_m.qcba017]]>
</point>
  <point name="input.a.qcba900" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcba900_desc('')
            IF NOT cl_null(g_qcba_m.qcba900) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_qcba_m.qcba900

               #160318-00025#21  by 07900 --add-str
               LET g_errshow = TRUE #是否開窗                   
               LET g_chkparam.err_str[1] ="aim-00070:sub-01302|aooi130|",cl_get_progname("aooi130",g_lang,"2"),"|:EXEPROGaooi130"
               #160318-00025#21  by 07900 --add-end    
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooag001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_qcba_m.qcba900 = g_qcba_m_t.qcba900
                  CALL aqct300_qcba900_desc(g_qcba_m.qcba900)
                  NEXT FIELD CURRENT
               END IF
               CALL aqct300_qcba900_desc(g_qcba_m.qcba900)

            END IF 
            
]]>
</point>
  <point name="input.a.qcbadocdt" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[]]>
</point>
  <point name="input.a.qcbadocno" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            CALL aqct300_qcbadocno_desc(g_qcba_m.qcbadocno)
            IF  NOT cl_null(g_qcba_m.qcbadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND g_qcba_m.qcbadocno != g_qcbadocno_t ) THEN 
                  IF NOT ap_chk_notDup(g_qcba_m.qcbadocno,"SELECT COUNT(1) FROM qcba_t WHERE "||"qcbaent = '" ||g_enterprise||"' AND "|| "qcbadocno = '"||g_qcba_m.qcbadocno ||"'",'std-00004',0) THEN 
                     LET g_qcba_m.qcbadocno = g_qcba_m_t.qcbadocno
                     NEXT FIELD CURRENT
                  END IF
                  
                  IF NOT s_aooi200_chk_slip(g_site,'',g_qcba_m.qcbadocno,g_prog) THEN
                     LET g_qcba_m.qcbadocno = g_qcba_m_t.qcbadocno
                     NEXT FIELD CURRENT
                  ELSE
                     LET g_qcba_m.qcba000 = s_aooi200_get_doc_default(g_site,'1',g_qcba_m.qcbadocno,'qcba000',g_qcba_m.qcba000)
                     CALL aqct300_scc_change()
                  END IF
                  
                  CALL cl_get_doc_para(g_enterprise,g_site,g_qcba_m.qcbadocno,'D-BAS-0097') RETURNING g_para
                  CALL aqct300_set_act_visible()
                  CALL aqct300_set_act_no_visible()
               END IF
               #160204-00004#4 Add By Ken 160222(S)
               IF (g_qcba_m.qcbadocno <> g_qcba_m_o.qcbadocno) OR cl_null(g_qcba_m_o.qcbadocno) THEN
                  LET g_qcba_m.qcba001 = ''
                  LET g_qcba_m_o.qcba001 = g_qcba_m.qcba001
                  DISPLAY BY NAME g_qcba_m.qcba001
               END IF
               #160204-00004#4 Add By Ken 160222(E)
            END IF
            LET g_qcba_m_o.qcbadocno = g_qcba_m.qcbadocno #160204-00004#4 Add By Ken 160222(S)
            
]]>
</point>
  <point name="input.a.qcbasite" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
#            IF  NOT cl_null(g_qcba_m.qcbasite) AND NOT cl_null(g_qcba_m.qcbadocno) THEN 
#               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_qcba_m.qcbasite != g_qcbasite_t  OR g_qcba_m.qcbadocno != g_qcbadocno_t )) THEN 
#                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcba_t WHERE "||"qcbaent = '" ||g_enterprise|| "' AND "||"qcbasite = '"||g_qcba_m.qcbasite ||"' AND "|| "qcbadocno = '"||g_qcba_m.qcbadocno ||"'",'std-00004',0) THEN 
#                     NEXT FIELD CURRENT
#                  END IF
#               END IF
#            END IF


]]>
</point>
  <point name="input.after_dialog" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#         CALL aqct300_upd_qcba022()
#         CALL aqct300_upd_qcba023()]]>
</point>
  <point name="input.after_set_entry" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #161031-00025#16 add(s)
   LET g_detail_insert = l_allow_insert
   LET g_detail_delete = l_allow_delete
   #161031-00025#16 add(e)    ]]>
</point>
  <point name="input.b.page1.qcbd001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbd001_desc(g_qcbd_d[l_ac].qcbd001)]]>
</point>
  <point name="input.b.page2.qcbe001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbe001_desc(g_qcbd2_d[l_ac].qcbe001)]]>
</point>
  <point name="input.b.page5.qcbc002" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[             CALL aqct300_qcbc002_desc(g_qcbd5_d[l_ac].qcbc002)]]>
</point>
  <point name="input.b.page5.qcbc003" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc003_desc()]]>
</point>
  <point name="input.b.page5.qcbc004" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #160407-00024#1 add(s)
            
            IF s_feature_auto_chk(g_qcbd5_d[l_ac].qcbc003) AND cl_null(g_qcbd5_d[l_ac].qcbc004) THEN 
               CALL s_feature_single(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004,'ALL','') RETURNING l_success,g_qcbd5_d[l_ac].qcbc004
               DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004
            END IF
            CALL s_feature_description(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) RETURNING g_success,g_qcbd5_d[l_ac].qcbc004_desc  
            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004_desc 
            #160407-00024#1 add(e)]]>
</point>
  <point name="input.b.qcbadocno" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbadocno_desc(g_qcba_m.qcbadocno)]]>
</point>
  <point name="input.before_dialog" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[         #161031-00025#16 add(s)
         #為了修改功能doubleClick可以直接進入單身, 需指定要進入哪一個單身
         IF NOT cl_null(p_cmd) AND p_cmd != 'a' THEN
            CASE g_aw
               WHEN "s_detail1_aooi360_01"
                  NEXT FIELD ooff012     
            END CASE
         END IF
         #161031-00025#16 add(e)]]>
</point>
  <point name="input.before_input" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   LET g_errshow = 1
   IF g_qcba_m.qcba000 = '2' THEN
      LET l_inao000 = '1'
   ELSE
      LET l_inao000 = '2'
   END IF]]>
</point>
  <point name="input.body.a_insert" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #161031-00025#16 add(s)
               IF NOT cl_null(g_qcbd_d[l_ac].ooff013) THEN
                  CALL s_aooi360_gen('7',g_prog,g_qcba_m.qcbadocno,g_qcbd_d[l_ac].qcbdseq,'','','','','','','','1',g_qcbd_d[l_ac].ooff013) RETURNING l_success
               END IF
               #161031-00025#16 add(e)]]>
</point>
  <point name="input.body.a_update" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #161031-00025#16 add(s)
               CALL s_aooi360_del('7',g_prog,g_qcba_m.qcbadocno,g_qcbd_d_t.qcbdseq,'','','','','','','','1') RETURNING l_success
               IF NOT cl_null(g_qcbd_d[l_ac].ooff013) THEN
                  CALL s_aooi360_gen('7',g_prog,g_qcba_m.qcbadocno,g_qcbd_d[l_ac].qcbdseq,'','','','','','','','1',g_qcbd_d[l_ac].ooff013) RETURNING l_success
               END IF
               #161031-00025#16 add(e)]]>
</point>
  <point name="input.body.after_input" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[             
             
             ]]>
</point>
  <point name="input.body.after_row" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[    ]]>
</point>
  <point name="input.body.before_insert" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            LET g_qcbd_d[l_ac].qcbdsite = g_qcba_m.qcbasite
            SELECT MAX(qcbdseq) + 1 INTO g_qcbd_d[l_ac].qcbdseq FROM qcbd_t
             WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno
            IF cl_null(g_qcbd_d[l_ac].qcbdseq) THEN LET g_qcbd_d[l_ac].qcbdseq = 1 END IF]]>
</point>
  <point name="input.body.insert.before_bak" order="" ver="26" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF cl_null(g_qcaz.qcaz018) THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               #LET g_errparam.code   = "aqc-00088"      #161127-00011#1 mark
               LET g_errparam.code = "aqc-00144"         #161127-00011#1 add
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               CANCEL INSERT
            END IF
            #160224-00009#1 mark
#            IF g_qcaz.qcaz018 = 'N' THEN
#               IF l_ac = 1 THEN
#                  NEXT FIELD qcba001
#               END IF
#               CANCEL INSERT
#            END IF
            #160224-00009#1 mark
            #160224-00009#1 add start
             IF g_qcaz.qcaz018 = 'N' THEN
                CANCEL INSERT
             END IF
            #160224-00009#1 add end]]>
</point>
  <point name="input.body.m_delete" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #161031-00025#16 add(s)
               CALL s_aooi360_del('7',g_prog,g_qcba_m.qcbadocno,g_qcbd_d_t.qcbdseq,'','','','','','','','1') RETURNING l_success
               #161031-00025#16 add(e)]]>
</point>
  <point name="input.body2.after_input" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            LET l_n = 0
            IF g_detail_idx != 0 OR g_qcbd_d.getLength() != 0 THEN
               SELECT COUNT(1) INTO l_n FROM qcbe_t WHERE qcbeent = g_enterprise
                  AND qcbedocno = g_qcba_m.qcbadocno
                  AND qcbeseq = g_qcbd_d[g_detail_idx].qcbdseq 
            END IF
            IF l_n > 0 THEN
#               SELECT MAX(qcbe002) INTO l_max_qcbe002 FROM qcbe_t
#                WHERE qcbeent = g_enterprise
#                  AND qcbedocno = g_qcba_m.qcbadocno
#                  AND qcbeseq = g_qcbd_d[g_detail_idx].qcbdseq 
#               LET g_qcbd_d[g_detail_idx].qcbd010 = l_max_qcbe002
               SELECT SUM(qcbe002) INTO l_sum_qcbe002 FROM qcbe_t
                WHERE qcbeent = g_enterprise
                  AND qcbedocno = g_qcba_m.qcbadocno
                  AND qcbeseq = g_qcbd_d[g_detail_idx].qcbdseq 
               LET g_qcbd_d[g_detail_idx].qcbd010 = l_sum_qcbe002
               
               CALL aqct300_get_qcbd021(g_qcbd_d[g_detail_idx].qcbd003,g_qcbd_d[g_detail_idx].qcbd010)
                RETURNING l_qcbd021
               IF l_qcbd021 > g_qcbd_d[g_detail_idx].qcbd009 THEN
                  LET l_qcbd021 = g_qcbd_d[g_detail_idx].qcbd009
               END IF
               IF l_qcbd021 >= g_qcbd_d[g_detail_idx].qcbd006 THEN
                  LET l_qcbd011 = '2'
               ELSE
                  LET l_qcbd011 = '1'
               END IF
               
               LET g_qcbd_d[g_detail_idx].qcbd011 = l_qcbd011
               DISPLAY BY NAME g_qcbd_d[g_detail_idx].qcbd010,g_qcbd_d[g_detail_idx].qcbd011
               UPDATE qcbd_t SET qcbd010 = g_qcbd_d[g_detail_idx].qcbd010,qcbd011 = g_qcbd_d[g_detail_idx].qcbd011,
                                 qcbd021 = l_qcbd021              
                           WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno 
                             AND qcbdseq = g_qcbd_d[g_detail_idx].qcbdseq 
               IF SQLCA.SQLCODE THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.SQLCODE
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
               END IF                            
            END IF
             
           #CALL aqct300_upd_qcba027() ]]>
</point>
  <point name="input.body2.before_input" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF cl_null(g_detail_idx) OR g_detail_idx = 0 THEN
               EXIT DIALOG
            END IF]]>
</point>
  <point name="input.body2.before_input2" order="" ver="21" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            LET g_detail_idx_tmp = g_detail_idx                   #160909-00068#1 add]]>
</point>
  <point name="input.body2.before_insert" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            
#            IF cl_null(g_qcbd2_d[l_ac].qcbeseq) THEN
#               SELECT MAX(qcbdseq) + 1 INTO g_qcbd2_d[l_ac].qcbeseq FROM qcbe_t
#                WHERE qcbeent = g_enterprise AND qcbesite = g_qcba_m.qcbasite
#                  AND qcbedocno = g_qcba_m.qcbadocno
#               IF cl_null(g_qcbd2_d[l_ac].qcbeseq) THEN LET g_qcbd2_d[l_ac].qcbeseq =1 END IF 
#            END IF
            LET g_qcbd2_d[l_ac].qcbesite = g_qcba_m.qcbasite
            LET g_qcbd2_d_t.* = g_qcbd2_d[l_ac].* ]]>
</point>
  <point name="input.body2.before_row" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#            LET g_qcbd2_d[l_ac].qcbd001 = g_qcbd_d[g_detail_idx].qcbd001
#            LET g_qcbd2_d[l_ac].qcbd001_1_desc = g_qcbd_d[g_detail_idx].qcbd001_desc
#            LET g_qcbd2_d[l_ac].qcbd002 = g_qcbd_d[g_detail_idx].qcbd002]]>
</point>
  <point name="input.body2.m_delete" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               DELETE FROM qcbf_t WHERE qcbfent = g_enterprise
                  AND qcbfdocno = g_qcba_m.qcbadocno
                  AND qcbfseq = g_qcbd_d[g_detail_idx].qcbdseq
                  AND qcbf001 = g_qcbd2_d_t.qcbe001
               IF SQLCA.SQLCODE THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF]]>
</point>
  <point name="input.body3.before_insert" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF g_qcbd2_d.getLength() <= l_ac THEN
               LET g_qcbd3_d[l_ac].qcbfseq = g_qcbd2_d[l_ac].qcbeseq
            ELSE
               LET g_qcbd3_d[l_ac].qcbfseq = g_qcbd2_d[g_qcbd2_d.getLength()].qcbeseq
            END IF
            LET g_qcbd3_d_t.* = g_qcbd3_d[l_ac].*]]>
</point>
  <point name="input.body4.after_row" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="input.body4.before_insert" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            LET g_qcbd4_d[l_ac].qcbbsite = g_qcba_m.qcbasite]]>
</point>
  <point name="input.body5.after_delete_d" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               CALL s_transaction_end('N','0')]]>
</point>
  <point name="input.body5.after_input" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#            DECLARE sel_qcbc_cur CURSOR FOR 
#             SELECT * FROM qcbc_t WHERE qcbcent = g_enterprise
#                AND qcbcdocno = g_qcba_m.qcbadocno
#            LET l_qcbc009 = 0   #SUM 單身的數量
#            LET l_qcba023 = 0
#            LET l_cnt = 0
#            FOREACH sel_qcbc_cur INTO l_qcbc.* 
#               IF STATUS THEN
#                  INITIALIZE g_errparam TO NULL
#                  LET g_errparam.code = STATUS
#                  LET g_errparam.extend = ''
#                  LET g_errparam.popup = TRUE
#                  CALL cl_err()
#
#                  EXIT FOREACH
#               END IF
#               LET l_rate_qcbc009 = 0
#               IF NOT cl_null(l_qcbc.qcbc008) AND l_qcbc.qcbc008 != g_qcba_m.qcba016 THEN
#                  CALL s_aimi190_get_convert(l_qcbc.qcbc003,l_qcbc.qcbc008,g_qcba_m.qcba016) RETURNING l_success,l_rate
#                  IF l_success  THEN
#                     LET l_rate_qcbc009 = l_qcbc.qcbc009 * l_rate   #換算後的數量
#                     LET l_qcbc.qcbc009 = 0
#                  END IF
#               END IF   
#               LET l_qcbc009 = l_qcbc009 + l_qcbc.qcbc009 + l_rate_qcbc009
##              IF l_qcbc.qcbc012 = '1' THEN 
#               IF l_qcbc.qcbc012 MATCHES '[123]' THEN
#                  LET l_qcba023 = l_qcba023 + l_qcbc.qcbc009 + l_rate_qcbc009    #計算單頭合格量
#               END IF
#               LET l_cnt = l_cnt + 1
#            END FOREACH
#            IF l_cnt > 0 THEN
#               IF l_qcbc009 != g_qcba_m.qcba017 THEN
#                  INITIALIZE g_errparam TO NULL
#                  LET g_errparam.code = 'aqc-00065'
#                  LET g_errparam.extend = ''
#                  LET g_errparam.popup = TRUE
#                  CALL cl_err()
#               
#                  NEXT FIELD CURRENT
##               ELSE  
###                 LET g_qcba_m.qcba023 = l_qcba023 
##                  UPDATE qcba_t SET qcba027 = g_qcba_m.qcba017 - l_qcba023 
##                              WHERE qcbaent = g_enterprise
##                                AND qcbadocno = g_qcba_m.qcbadocno
##                  IF SQLCA.SQLCODE THEN
##                     INITIALIZE g_errparam TO NULL
##                     LET g_errparam.code = SQLCA.SQLCODE
##                     LET g_errparam.extend = ''
##                     LET g_errparam.popup = TRUE
##                     CALL cl_err()
##               
##                     NEXT FIELD CURRENT
##                  END IF
#               END IF 
#            END IF
            IF NOT aqct300_qcbc009_sum_chk() THEN
               NEXT FIELD CURRENT
            END IF]]>
</point>
  <point name="input.body5.b_a_insert" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF cl_null(g_qcbd5_d[l_ac].qcbc002) THEN
               LET g_qcbd5_d[l_ac].qcbc002 = ' '
            END IF]]>
</point>
  <point name="input.body5.b_update" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[                IF cl_null(g_qcbd5_d[l_ac].qcbc002) THEN
                   LET g_qcbd5_d[l_ac].qcbc002 = ' '
                END IF]]>
</point>
  <point name="input.body5.before_input" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc001_scc()]]>
</point>
  <point name="input.body5.before_insert" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            SELECT MAX(qcbcseq) + 1 INTO g_qcbd5_d[l_ac].qcbcseq FROM qcbc_t
             WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
            IF cl_null(g_qcbd5_d[l_ac].qcbcseq) THEN LET g_qcbd5_d[l_ac].qcbcseq = 1 END IF
            LET g_qcbd5_d[l_ac].qcbc004 = g_qcba_m.qcba012
            IF g_qcbd5_d[l_ac].qcbc001 = '0' THEN
               LET g_qcbd5_d[l_ac].qcbc003 = g_qcba_m.qcba010
               CALL aqct300_qcbc003_desc()
               LET g_qcbd5_d[l_ac].qcbc004 = g_qcba_m.qcba012   #160407-00024#1 add
               CALL s_feature_description(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004) RETURNING g_success,g_qcbd5_d[l_ac].qcbc004_desc  #160407-00024#1 add
               DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004_desc #160407-00024#1 add
               CALL aqct300_set_entry_b(l_cmd)
               CALL aqct300_set_no_entry_b(l_cmd)
            END IF
            LET g_qcbd5_d[l_ac].qcbcsite = g_qcba_m.qcbasite
            LET g_qcbd5_d[l_ac].qcbc008 = g_qcba_m.qcba009
            CALL aqct300_qcbc008_desc(g_qcbd5_d[l_ac].qcbc008)
            IF g_qcba_m.qcba000 MATCHES '[346]' OR (g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 != '2') THEN
               CALL aqct300_default_qcbc() RETURNING g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007
               CALL aqct300_qcbc005_desc(g_qcbd5_d[l_ac].qcbc005)
               CALL aqct300_qcbc006_desc(g_qcbd5_d[l_ac].qcbc006)
            END IF]]>
</point>
  <point name="input.body5.before_row" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#            IF g_qcba_m.qcba000 MATCHES '[124]' THEN
#               IF g_qcbd5_d[l_ac].qcbcseq = 1 THEN
#                  DELETE FROM inao_t WHERE inaoent = g_enterprise
#                     AND inaodocno = g_qcba_m.qcbadocno
#                     AND inaoseq = 1
#                  IF SQLCA.SQLCODE THEN
#                     INITIALIZE g_errparam TO NULL 
#                     LET g_errparam.extend = '' 
#                     LET g_errparam.code   = SQLCA.sqlcode 
#                     LET g_errparam.popup  = TRUE 
#                     CALL cl_err()
#                  END IF
#               END IF
#            END IF]]>
</point>
  <point name="input.body7.after_input" order="" ver="29" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            
            IF l_qcan015 = '3' THEN
#              IF l_ac != g_qcbd_d[g_detail_idx].qcbd009 THEN
               IF g_qcbd7_d.getLength() != g_qcbd_d[g_detail_idx].qcbd009 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = '' 
                  LET g_errparam.code   = 'aqc-00081'
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()
               END IF
            END IF
            
            IF l_qcan015 = '2' THEN
               IF g_qcbd7_d.getLength() = 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = '' 
                  LET g_errparam.code   = 'aqc-00090'
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()
               END IF  
            END IF
            
            LET l_cnt_new = 0
            SELECT COUNT(1) INTO l_cnt_new FROM qcbg_t 
             WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
               AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq 
            

            IF l_cnt_new > 0 THEN
               LET l_cnt_n_new = 0
               SELECT COUNT(1) INTO l_cnt_n_new FROM qcbg_t 
                WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
                  AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq AND qcbg003 = 'N'
               IF l_cnt_n_old != l_cnt_n_new THEN
#                  SELECT * INTO l_qcbd.* FROM qcbd_t WHERE qcbdent = g_enterprise #161124-00048#10 mark
                  #161124-00048#10 add(s)
                  SELECT qcbdent,qcbdsite,qcbddocno,qcbdseq,qcbd001,qcbd002,qcbd003,
                         qcbd004,qcbd005,qcbd006,qcbd007,qcbd008,qcbd009,qcbd010,
                         qcbd011,qcbd012,qcbd013,qcbd014,qcbd015,qcbd016,qcbd017,
                         qcbd018,qcbd019,qcbd020,qcbd021 
                    INTO l_qcbd.qcbdent,l_qcbd.qcbdsite,l_qcbd.qcbddocno,l_qcbd.qcbdseq,l_qcbd.qcbd001,l_qcbd.qcbd002,l_qcbd.qcbd003,
                         l_qcbd.qcbd004,l_qcbd.qcbd005,l_qcbd.qcbd006,l_qcbd.qcbd007,l_qcbd.qcbd008,l_qcbd.qcbd009,l_qcbd.qcbd010,
                         l_qcbd.qcbd011,l_qcbd.qcbd012,l_qcbd.qcbd013,l_qcbd.qcbd014,l_qcbd.qcbd015,l_qcbd.qcbd016,l_qcbd.qcbd017,
                         l_qcbd.qcbd018,l_qcbd.qcbd019,l_qcbd.qcbd020,l_qcbd.qcbd021
                    FROM qcbd_t WHERE qcbdent = g_enterprise
                  #161124-00048#10 add(e)
                     AND qcbddocno = g_qcba_m.qcbadocno AND qcbdseq = g_qcbd_d[g_detail_idx].qcbdseq
                  
                  CALL aqct300_get_qcbd021(l_qcbd.qcbd003,l_cnt_n_new) RETURNING l_qcbd.qcbd021 
                  IF l_qcbd.qcbd021 > l_qcbd.qcbd009 THEN
                     LET l_qcbd.qcbd021 = l_qcbd.qcbd009
                  END IF
                  IF l_qcbd.qcbd021 >=l_qcbd.qcbd006 THEN
                     LET l_qcbd.qcbd011 = '2'
                  ELSE
                     LET l_qcbd.qcbd011 = '1'
                  END IF
                  UPDATE qcbd_t SET qcbd010 = l_cnt_n_new,
                                    qcbd021 = l_qcbd.qcbd021,
                                    qcbd011 = l_qcbd.qcbd011
                              WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno
                                AND qcbdseq = g_qcbd_d[g_detail_idx].qcbdseq
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "update qcbd_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                  END IF
               END IF   
            END IF
            
            
            IF l_cnt_old != l_cnt_new THEN
               IF g_qcbd_d[g_detail_idx].qcbd020 = '4' THEN
                  LET l_xbar = aqct300_get_xbar()
                  LET l_sd = aqct300_get_standard_deviation(l_xbar)
                  
                  #双边规格 都符合
                  #IF NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd015) THEN   #160607-00004#1 mark
                  IF NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd015) THEN  #160607-00004#1 add
                     IF aqct300_u_k(l_xbar,l_sd) AND aqct300_l_k(l_xbar,l_sd) AND aqct300_u_l_f(l_sd) THEN
                        LET l_qcbd.qcbd011 = '1'
                     ELSE
                        LET l_qcbd.qcbd011 = '2'
                     END IF
                  END IF
                 #单边规格 符合上限
                  #IF NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd013) AND cl_null(g_qcbd6_d[g_detail_idx].qcbd015) THEN  #160607-00004#1 mark
                  IF NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd013) AND cl_null(g_qcbd99_d[g_detail_idx].qcbd015) THEN #160607-00004#1 add
                     IF aqct300_u_k(l_xbar,l_sd) THEN
                        LET l_qcbd.qcbd011 = '1'
                     ELSE
                        LET l_qcbd.qcbd011 = '2'
                     END IF
                  END IF
                  #单边规格 符合下限
                  #IF cl_null(g_qcbd6_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd6_d[g_detail_idx].qcbd015) THEN  #160607-00004#1 mark
                  IF cl_null(g_qcbd99_d[g_detail_idx].qcbd013) AND NOT cl_null(g_qcbd99_d[g_detail_idx].qcbd015) THEN #160607-00004#1 add
                     IF aqct300_l_k(l_xbar,l_sd) THEN
                        LET l_qcbd.qcbd011 = '1'
                     ELSE
                        LET l_qcbd.qcbd011 = '2'
                     END IF
                  END IF
               
                  UPDATE qcbd_t SET qcbd011 = l_qcbd.qcbd011
                              WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno
                                AND qcbdseq = g_qcbd_d[g_detail_idx].qcbdseq
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "update qcbd_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                  END IF
               END IF
            END IF]]>
</point>
  <point name="input.body7.before_input" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF cl_null(g_detail_idx) OR g_detail_idx = 0 THEN
               EXIT DIALOG
            END IF
            IF g_detail_idx > 0 THEN
               CALL aqct300_get_qcan015(g_qcbd_d[g_detail_idx].qcbdseq) RETURNING l_qcan015
            END IF
            
            LET l_cnt_old = 0
            SELECT COUNT(1) INTO l_cnt_old FROM qcbg_t 
              WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
                AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq
            LET l_cnt_n_old = 0
            SELECT COUNT(1) INTO l_cnt_n_old FROM qcbg_t 
              WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
                AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq AND qcbg003 = 'N']]>
</point>
  <point name="input.body7.before_insert" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            SELECT MAX(qcbg001) + 1 INTO g_qcbd7_d[l_ac].qcbg001 FROM qcbg_t
             WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno
               AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq
            IF cl_null(g_qcbd7_d[l_ac].qcbg001) THEN LET g_qcbd7_d[l_ac].qcbg001 = 1 END IF
            LET g_qcbd7_d[l_ac].qcbgsite = g_site
            LET g_qcbd7_d[l_ac].qcbg003 = 'N']]>
</point>
  <point name="input.body7.insert.after_set_entry_b" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[          ]]>
</point>
  <point name="input.body7.insert.before_bak" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF l_qcan015 = '1' OR cl_null(l_qcan015) THEN
               CANCEL INSERT
            END IF]]>
</point>
  <point name="input.c.page1.ooff013" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #161031-00025#16 add-S
            IF NOT cl_null(g_qcba_m.qcbadocno) AND l_ac > 0 THEN
               CALL aooi360_02('7',g_prog,g_qcba_m.qcbadocno,g_qcbd_d[l_ac].qcbdseq,'','','','','','','','1')
               CALL s_aooi360_sel('7',g_prog,g_qcba_m.qcbadocno,g_qcbd_d[l_ac].qcbdseq,'','','','','','','','1') RETURNING l_success,g_qcbd_d[l_ac].ooff013
               LET g_ooff001_d = '6'   #6.單據單頭備註
               LET g_ooff002_d = g_prog
               LET g_ooff003_d = g_qcba_m.qcbadocno   #单号
               LET g_ooff004_d = 0     #项次
               LET g_ooff005_d = ' '
               LET g_ooff006_d = ' '
               LET g_ooff007_d = ' '
               LET g_ooff008_d = ' '
               LET g_ooff009_d = ' '
               LET g_ooff010_d = ' '
               LET g_ooff011_d = ' '
               CALL aooi360_01_b_fill(g_ooff001_d,g_ooff002_d,g_ooff003_d,g_ooff004_d,g_ooff005_d,g_ooff006_d,g_ooff007_d,g_ooff008_d,g_ooff009_d,g_ooff010_d,g_ooff011_d)   #备注单身 
            END IF
            #161031-00025#16 add-E]]>
</point>
  <point name="input.c.page1.qcbd001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd_d[l_ac].qcbd001             #給予default值
            LET g_qryparam.default2 = "" #g_qcbd_d[l_ac].oocq002 #應用分類碼
            #給予arg
            LET g_qryparam.arg1 = "1051" #

            
            CALL q_oocq002()                                #呼叫開窗

            LET g_qcbd_d[l_ac].qcbd001 = g_qryparam.return1              
            #LET g_qcbd_d[l_ac].oocq002 = g_qryparam.return2 
            DISPLAY g_qcbd_d[l_ac].qcbd001 TO qcbd001              #
            #DISPLAY g_qcbd_d[l_ac].oocq002 TO oocq002 #應用分類碼
            NEXT FIELD qcbd001                          #返回原欄位

]]>
</point>
  <point name="input.c.page1.qcbd004" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd_d[l_ac].qcbd004             #給予default值
            CASE WHEN g_qcbd_d[l_ac].qcbd020 = '1' 
                    CALL q_qcac002()
                 WHEN g_qcbd_d[l_ac].qcbd020 = '2'
                    CALL q_qcag003()
                 WHEN g_qcbd_d[l_ac].qcbd020 = '6'
                    LET g_qryparam.where = " qcah001 = '",g_qcaz.qcaz001,"'"
                    CALL q_qcah002()
            END CASE
      

            LET g_qcbd_d[l_ac].qcbd004 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd_d[l_ac].qcbd004 TO qcbd004              #顯示到畫面上

            NEXT FIELD qcbd004            ]]>
</point>
  <point name="input.c.page2.qcbd001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd2_d[l_ac].qcbd001             #給予default值
            LET g_qryparam.default2 = "" #g_qcbd2_d[l_ac].oocq002 #應用分類碼
            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_oocq002()                                #呼叫開窗

            LET g_qcbd2_d[l_ac].qcbd001 = g_qryparam.return1              
            #LET g_qcbd2_d[l_ac].oocq002 = g_qryparam.return2 
            DISPLAY g_qcbd2_d[l_ac].qcbd001 TO qcbd001              #
            #DISPLAY g_qcbd2_d[l_ac].oocq002 TO oocq002 #應用分類碼
            NEXT FIELD qcbd001                          #返回原欄位

]]>
</point>
  <point name="input.c.page2.qcbe001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd2_d[l_ac].qcbe001             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "1053" #

            CALL q_oocq002()                                #呼叫開窗

            LET g_qcbd2_d[l_ac].qcbe001 = g_qryparam.return1              #將開窗取得的值回傳到變數
          
            DISPLAY g_qcbd2_d[l_ac].qcbe001 TO qcbe001              #顯示到畫面上
           
            NEXT FIELD qcbe001                          #返回原欄位

]]>
</point>
  <point name="input.c.page5.qcbc002" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc002             #給予default值
            LET  g_qryparam.arg1 = g_qcaz001
            #給予arg

            CALL q_qcao002_1()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc002 TO qcbc002              #顯示到畫面上

            NEXT FIELD qcbc002                          #返回原欄位

]]>
</point>
  <point name="input.c.page5.qcbc004" order="" ver="12" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL s_feature_single(g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004,'ALL','') RETURNING l_success,g_qcbd5_d[l_ac].qcbc004
            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc004]]>
</point>
  <point name="input.c.page5.qcbc005" order="" ver="2" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcbd5_d[l_ac].qcbc005             #給予default值
            LET g_qryparam.arg1 = g_qcba_m.qcbasite
            #給予arg

            CALL q_inaa001_6()                                #呼叫開窗

            LET g_qcbd5_d[l_ac].qcbc005 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_qcbd5_d[l_ac].qcbc005 TO qcbc005              #顯示到畫面上
            CALL aqct300_qcbc005_desc(g_qcbd5_d[l_ac].qcbc005)
            NEXT FIELD qcbc005                          #返回原欄位

]]>
</point>
  <point name="input.c.qcba001" order="" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_qcba_m.qcba001
            LET g_qryparam.default2 = g_qcba_m.qcba002
            IF g_qcba_m.qcba000 = '3' THEN
               LET g_qryparam.default2 = g_qcba_m.qcba029
               LET g_qryparam.default3 = g_qcba_m.qcba002
            END IF
            CALL aqct300_controlp_qcba001_select()
            LET g_qcba_m.qcba001 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_qcba_m.qcba002 = g_qryparam.return2
            #170110-00056#1 mark(s)
#            IF g_qcba_m.qcba000 = '3' THEN
#               LET g_qcba_m.qcba029 = g_qryparam.return2
#               LET g_qcba_m.qcba002 = g_qryparam.return3
#            END IF
            #170110-00056#1 mark(e)
            DISPLAY g_qcba_m.qcba001 TO qcba001              #顯示到畫面上
            DISPLAY g_qcba_m.qcba002 TO qcba002
            IF g_qcba_m.qcba000 = '3' THEN
               DISPLAY g_qcba_m.qcba029 TO qcba029
            END IF
            NEXT FIELD qcba001 ]]>
</point>
  <point name="input.c.qcba002" order="" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
		    	LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_qcba_m.qcba001
            LET g_qryparam.default2 = g_qcba_m.qcba002
            IF g_qcba_m.qcba000 = '3' THEN
               LET g_qryparam.default2 = g_qcba_m.qcba029
               LET g_qryparam.default3 = g_qcba_m.qcba002
            END IF
            CALL aqct300_controlp_qcba002_select()
            LET g_qcba_m.qcba001 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_qcba_m.qcba002 = g_qryparam.return2
            #170110-00056#1 mark(s)
#            IF g_qcba_m.qcba000 = '3' THEN
#               LET g_qcba_m.qcba029 = g_qryparam.return2
#               LET g_qcba_m.qcba002 = g_qryparam.return3
#            END IF
            #170110-00056#1 mark(e)
            DISPLAY g_qcba_m.qcba001 TO qcba001 
            DISPLAY g_qcba_m.qcba002 TO qcba002
            IF g_qcba_m.qcba000 = '3' THEN
               DISPLAY g_qcba_m.qcba029 TO qcba029
            END IF]]>
</point>
  <point name="input.c.qcba006" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
#			INITIALIZE g_qryparam.* TO NULL
#            LET g_qryparam.state = 'i'
#			LET g_qryparam.reqry = FALSE
#
#            LET g_qryparam.default1 = g_qcba_m.qcba006             #給予default值
#
#            #給予arg
#            LET g_qryparam.where = " ecbb018 = 'Y'"
#
#            CALL q_ecbb004()                                #呼叫開窗
#
#            LET g_qcba_m.qcba006 = g_qryparam.return1              #將開窗取得的值回傳到變數
#
#            DISPLAY g_qcba_m.qcba006 TO qcba006              #顯示到畫面上
#
#            NEXT FIELD qcba006                          #返回原欄位

]]>
</point>
  <point name="input.c.qcba009" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="input.d.before_input" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
            ]]>
</point>
  <point name="input.define" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE  l_ooef004       LIKE ooef_t.ooef004
   DEFINE  l_rate_qcbc009  LIKE qcbc_t.qcbc009
   DEFINE  l_qcbc009       LIKE qcbc_t.qcbc009
   DEFINE  l_qcba023       LIKE qcba_t.qcba023
#   DEFINE  l_qcbc   RECORD LIKE qcbc_t.*  #161124-00048#10 mark
   #161124-00048#10 add(s)
   DEFINE l_qcbc RECORD  #品質檢驗判定結果檔
       qcbcent LIKE qcbc_t.qcbcent, #企业编号
       qcbcsite LIKE qcbc_t.qcbcsite, #营运据点
       qcbcdocno LIKE qcbc_t.qcbcdocno, #单号
       qcbcseq LIKE qcbc_t.qcbcseq, #行序
       qcbc001 LIKE qcbc_t.qcbc001, #类型
       qcbc002 LIKE qcbc_t.qcbc002, #判定结果编号
       qcbc003 LIKE qcbc_t.qcbc003, #料件编号
       qcbc004 LIKE qcbc_t.qcbc004, #产品特征
       qcbc005 LIKE qcbc_t.qcbc005, #库位
       qcbc006 LIKE qcbc_t.qcbc006, #储位
       qcbc007 LIKE qcbc_t.qcbc007, #批号
       qcbc008 LIKE qcbc_t.qcbc008, #单位
       qcbc009 LIKE qcbc_t.qcbc009, #判定数量
       qcbc010 LIKE qcbc_t.qcbc010, #已入库数
       qcbc011 LIKE qcbc_t.qcbc011, #库存备注
       qcbc012 LIKE qcbc_t.qcbc012, #判定区分
       qcbc013 LIKE qcbc_t.qcbc013  #处理方式
END RECORD
   #161124-00048#10 add(e)
   DEFINE  l_success       LIKE type_t.num5
   DEFINE  l_rate          LIKE type_t.num20_6
   DEFINE  l_bad_num       LIKE type_t.num5
   DEFINE  l_qcba015       STRING
   DEFINE  l_qcba025       STRING
   DEFINE  l_qcba015_1       LIKE type_t.num5
   DEFINE  l_qcba015_2       LIKE type_t.num5
   DEFINE  l_qcba015_3       LIKE type_t.chr10
   DEFINE  l_qcba015_4       LIKE type_t.chr10
   DEFINE  l_qcba015_5       LIKE type_t.chr10 #160405-00005#1 add 秒
   DEFINE  l_qcba015_6       LIKE type_t.chr10 #160405-00005#1 add 秒
   DEFINE  l_qcba025_1       LIKE type_t.num5
   DEFINE  l_qcba025_2       LIKE type_t.num5
   DEFINE  l_qcba025_3       LIKE type_t.chr10
   DEFINE  l_qcba025_4       LIKE type_t.chr10
   DEFINE  l_qcba025_5       LIKE type_t.chr10 #160405-00005#1 add 秒
   DEFINE  l_qcba025_6       LIKE type_t.chr10 #160405-00005#1 add 秒
   DEFINE  l_hour_top        LIKE type_t.num5
   DEFINE  l_minute_top      LIKE type_t.num5
   DEFINE  l_max_qcbe002     LIKE qcbe_t.qcbe002
   DEFINE  l_qcbd011         LIKE qcbd_t.qcbd011
   DEFINE  l_max_qcbe004     LIKE qcbe_t.qcbe004
   DEFINE  l_qcan015       LIKE qcan_t.qcan015
#   DEFINE  l_qcbd      RECORD LIKE qcbd_t.*   #161124-00048#10 mark
   #161124-00048#10 add(s)
   DEFINE l_qcbd RECORD  #品質檢驗單身檔
       qcbdent LIKE qcbd_t.qcbdent, #企业编号
       qcbdsite LIKE qcbd_t.qcbdsite, #营运据点
       qcbddocno LIKE qcbd_t.qcbddocno, #单号
       qcbdseq LIKE qcbd_t.qcbdseq, #行序
       qcbd001 LIKE qcbd_t.qcbd001, #检验项目
       qcbd002 LIKE qcbd_t.qcbd002, #检验位置
       qcbd003 LIKE qcbd_t.qcbd003, #缺点等级
       qcbd004 LIKE qcbd_t.qcbd004, #AQL
       qcbd005 LIKE qcbd_t.qcbd005, #允收数
       qcbd006 LIKE qcbd_t.qcbd006, #拒绝数
       qcbd007 LIKE qcbd_t.qcbd007, #K法标准值
       qcbd008 LIKE qcbd_t.qcbd008, #F法标准值
       qcbd009 LIKE qcbd_t.qcbd009, #抽验量
       qcbd010 LIKE qcbd_t.qcbd010, #缺点数
       qcbd011 LIKE qcbd_t.qcbd011, #项目判定结果
       qcbd012 LIKE qcbd_t.qcbd012, #规范上限
       qcbd013 LIKE qcbd_t.qcbd013, #检验上限
       qcbd014 LIKE qcbd_t.qcbd014, #检验标准值
       qcbd015 LIKE qcbd_t.qcbd015, #检验下限
       qcbd016 LIKE qcbd_t.qcbd016, #规范下限
       qcbd017 LIKE qcbd_t.qcbd017, #计量单位
       qcbd018 LIKE qcbd_t.qcbd018, #检验规格说明
       qcbd019 LIKE qcbd_t.qcbd019, #备注
       qcbd020 LIKE qcbd_t.qcbd020, #抽样计划
       qcbd021 LIKE qcbd_t.qcbd021  #不良数
   END RECORD
   #161124-00048#10 add(e)
   DEFINE  l_qcbd021       LIKE qcbd_t.qcbd021
   DEFINE  l_sum_qcbe002   LIKE qcbe_t.qcbe002
   DEFINE  l_xbar          LIKE qcbg_t.qcbg002
   DEFINE  l_sd            LIKE qcbg_t.qcbg002
   DEFINE  l_cnt_old       LIKE type_t.num5
   DEFINE  l_cnt_n_old     LIKE type_t.num5
   DEFINE  l_cnt_new       LIKE type_t.num5
   DEFINE  l_cnt_n_new     LIKE type_t.num5
   DEFINE  l_slip          STRING   #160224-00004#1 add
   #160405-00005#1 --s
   DEFINE l_before_second  LIKE type_t.num20
   DEFINE l_after_second   LIKE type_t.num20
   DEFINE l_before_time    STRING
   DEFINE l_after_time     STRING
   DEFINE l_year_str       STRING
   DEFINE l_month_str      STRING
   DEFINE l_day_str        STRING
   DEFINE l_hour_str       STRING
   DEFINE l_minute_str     STRING
   DEFINE l_second_str     STRING
   DEFINE l_year_num       LIKE type_t.num5
   DEFINE l_month_num      LIKE type_t.num5
   DEFINE l_day_num        LIKE type_t.num5
   DEFINE l_hour_num       LIKE type_t.num5
   DEFINE l_minute_num     LIKE type_t.num5
   DEFINE l_second_num     LIKE type_t.num5
   DEFINE l_before_date    STRING
   DEFINE l_after_date     STRING
   #160405-00005#1 --e
]]>
</point>
  <point name="input.g.page1.qcbd002" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[ ]]>
</point>
  <point name="input.g.page1.qcbd003" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_get_qcbd021(g_qcbd_d[l_ac].qcbd003,g_qcbd_d[l_ac].qcbd010) RETURNING g_qcbd_d[l_ac].qcbd021
            IF g_qcbd_d[l_ac].qcbd021 > g_qcbd_d[l_ac].qcbd009 THEN
               LET g_qcbd_d[l_ac].qcbd021 = g_qcbd_d[l_ac].qcbd009
            END IF
            IF g_qcbd_d[l_ac].qcbd021 >= g_qcbd_d[l_ac].qcbd006 THEN
               LET g_qcbd_d[l_ac].qcbd011 = '2'
            ELSE
               LET g_qcbd_d[l_ac].qcbd011 = '1'
            END IF
            DISPLAY BY NAME g_qcbd_d[l_ac].qcbd021,g_qcbd_d[l_ac].qcbd011 ]]>
</point>
  <point name="input.g.page1.qcbd020" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            IF NOT aqct300_qcbd004_chk() THEN
               LET g_qcbd_d[l_ac].qcbd020 = g_qcbd_d_t.qcbd020
               NEXT FIELD CURRENT
            END IF
            IF NOT cl_null(g_qcbd_d[l_ac].qcbd020) AND NOT cl_null(g_qcbd_d[l_ac].qcbd004) THEN
               CALL aqct300_qcbd005_qcbd006_result(g_qcbd_d[l_ac].qcbd020,g_qcbd_d[l_ac].qcbd004) RETURNING g_qcbd_d[l_ac].qcbd005,g_qcbd_d[l_ac].qcbd006
            END IF
            
            IF NOT cl_null(g_qcbd_d[l_ac].qcbd020) THEN             
               CALL aqct300_qcbd007_qcbd008_result(g_qcbd_d[l_ac].qcbd020) RETURNING g_qcbd_d[l_ac].qcbd007,g_qcbd_d[l_ac].qcbd008
            END IF
            
            IF NOT cl_null(g_qcbd_d[l_ac].qcbd020) AND NOT cl_null(g_qcbd_d[l_ac].qcbd004) THEN
               CALL aqct300_qcbd009_result(g_qcbd_d[l_ac].qcbd020,g_qcbd_d[l_ac].qcbd004) RETURNING g_qcbd_d[l_ac].qcbd009
            END IF]]>
</point>
  <point name="input.g.page5.qcbc001" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_set_entry_b(l_cmd)
            CALL aqct300_set_no_entry_b(l_cmd)]]>
</point>
  <point name="input.g.page5.qcbc012" order="" ver="8" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #160224-00004#1 add(s)
             IF NOT cl_null(g_qcbd5_d[l_ac].qcbc012) THEN
                IF l_cmd = 'a' THEN
                   CALL s_aooi200_get_slip(g_qcba_m.qcbadocno) RETURNING g_success,l_slip
                   IF g_success THEN
                      CASE g_qcbd5_d[l_ac].qcbc012 
                        WHEN '2'
                           CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0026') RETURNING g_qcbd5_d[l_ac].qcbc005
                           CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0027') RETURNING g_qcbd5_d[l_ac].qcbc006
                        WHEN '3'
                           CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0028') RETURNING g_qcbd5_d[l_ac].qcbc005
                           CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-MFG-0029') RETURNING g_qcbd5_d[l_ac].qcbc006
                       END CASE
                   END IF
                END IF
             END IF
            #160224-00004#1 add(e)]]>
</point>
  <point name="input.g.qcba000" order="" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #170110-00056#1 add(s)
            IF g_qcba_m.qcba000 = '3' THEN
               LET g_qcba_m.qcba002 = 0
            END IF
            #170110-00056#1 add(e)
            CALL aqct300_qcba006_required()
            CALL aqct300_set_entry(p_cmd)
            CALL aqct300_set_no_entry(p_cmd)
            CALL aqct300_scc_change()
            CALL aqct300_page_visible()
            IF g_qcba_m.qcba000 MATCHES '[45]' AND g_qcba_m_o.qcba000 NOT MATCHES '[45]' THEN
               LET g_qcba_m.qcba031 = '1'
            END IF
            IF NOT cl_null(g_qcba_m.qcba001) THEN
               IF NOT aqct300_qcba001_chk() THEN
                  INITIALIZE g_qcba_m.qcba001 TO NULL
                  INITIALIZE g_qcba_m.qcba002 TO NULL
                  INITIALIZE g_qcba_m.qcba029 TO NULL
                  NEXT FIELD qcba001
               END IF
            END IF
            CALL aqct300_get_inao013()
            LET g_qcba_m_o.qcba000 = g_qcba_m.qcba000]]>
</point>
  <point name="input.g.qcba031" order="" ver="14" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            #160324-00033#1---s
            CALL aqct300_set_entry(p_cmd)
            CALL aqct300_set_no_entry(p_cmd)
            #160324-00033#1---e    
                
            IF NOT cl_null(g_qcba_m.qcba001) THEN
               IF NOT aqct300_qcba001_chk() THEN
                  INITIALIZE g_qcba_m.qcba001 TO NULL
                  INITIALIZE g_qcba_m.qcba002 TO NULL
                  INITIALIZE g_qcba_m.qcba029 TO NULL
                  NEXT FIELD qcba001
               END IF
            END IF
            CALL aqct300_get_inao013()]]>
</point>
  <point name="input.head.a_insert" order="" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[                  IF NOT aqct300_qcba030_insert() THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "g_qcba_m"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
  
                     CONTINUE DIALOG
                  END IF
                  IF NOT aqct300_qcbd_insert() THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "g_qcba_m"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
  
                     CONTINUE DIALOG
                  ELSE
                     CALL aqct300_b_fill()
                     DISPLAY ARRAY g_qcbd_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) 
                        BEFORE DISPLAY 
                           EXIT DISPLAY
                     END DISPLAY 
                     
                     #DISPLAY ARRAY g_qcbd6_d TO s_detail6.* ATTRIBUTES(COUNT=g_rec_b)   #160607-00004#1 mark
                     DISPLAY ARRAY g_qcbd99_d TO s_detail99.* ATTRIBUTES(COUNT=g_rec_b)  #160607-00004#1 add
                        BEFORE DISPLAY 
                           EXIT DISPLAY
                     END DISPLAY 
                  END IF]]>
</point>
  <point name="input.head.b_insert" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               IF NOT aqct300_get_qcbadocno() THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "g_qcba_m"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
  
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF
               LET g_auto_flag = FALSE
               CALL aqct300_set_entry(p_cmd)
               CALL aqct300_set_no_entry(p_cmd)
               
               ]]>
</point>
  <point name="input.head.m_insert" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               LET g_ooff003_d = g_qcba_m.qcbadocno   #161031-00025#16 add
               IF NOT s_aqct300_ins_inao(g_qcba_m.qcbadocno,1,'N') THEN
                  CALL s_transaction_end('N','0')
                  NEXT FIELD CURRENT
               END IF
               IF g_qcba_m.qcba017 != g_qcba017_t THEN
                  IF NOT aqct300_upd_inao(1,g_qcba_m.qcba017,g_qcba_m.qcba012,'','','') THEN
                     CALL s_transaction_end('N','0')
                     NEXT FIELD CURRENT
                  END IF
               END IF
               IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,1) THEN
                  CALL s_transaction_end('N','0')
                  NEXT FIELD CURRENT
               END IF]]>
</point>
  <point name="input.head.m_update" order="" ver="34" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #170109-00039#1 add---start---
               IF g_qcba_m.qcba016 <> g_qcba_m_t.qcba016 THEN
                  CALL aqct300_qcbd009_upd()
               END IF
               #170109-00039#1 add---end---]]>
</point>
  <point name="input.m.before_input" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#            IF p_cmd = 'a' THEN NEXT FIELD qcbadocno END IF
            CALL aqct300_qcba006_required()]]>
</point>
  <point name="input.more_input" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      INPUT ARRAY g_qcbd3_d FROM s_detail3.*
         ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                 INSERT ROW = l_allow_insert, #此頁面insert功能由產生器控制, 手動之設定無效! 

                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 
         #自訂ACTION(detail_input,page_3)
         
         
         BEFORE INPUT
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd3_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            LET g_rec_b = g_qcbd3_d.getLength()
            #add-point:資料輸入前
            IF cl_null(g_detail_idx2) OR g_detail_idx2 = 0 THEN
               EXIT DIALOG
            END IF
            #end add-point
            
         BEFORE INSERT
            
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_qcbd3_d[l_ac].* TO NULL 
            
            LET g_qcbd3_d_t.* = g_qcbd3_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aqct300_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b

            #end add-point
            CALL aqct300_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_qcbd3_d[li_reproduce_target].* = g_qcbd3_d[li_reproduce].*
 
               LET g_qcbd3_d[li_reproduce_target].qcbf002 = NULL
               LET g_qcbd3_d[li_reproduce_target].qcbf003 = NULL
            END IF
            #公用欄位給值(單身3)
            
            
            #add-point:modify段before insert
            LET g_qcbd3_d[l_ac].qcbfsite = g_qcba_m.qcbasite
            #end add-point  
            
         BEFORE ROW
            #add-point:modify段before row2

            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx3 = l_ac
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            OPEN aqct300_bcl USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq
            OPEN aqct300_bcl4 USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq,g_qcbd2_d[g_detail_idx2].qcbe001

            IF STATUS THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  STATUS
               LET g_errparam.extend = "OPEN aqct300_cl:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CLOSE aqct300_cl
               CLOSE aqct300_bcl
               CLOSE aqct300_bcl4
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd3_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd3_d[l_ac].qcbf002 IS NOT NULL
               AND g_qcbd3_d[l_ac].qcbf003 IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_qcbd3_d_t.* = g_qcbd3_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b

               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               IF NOT aqct300_lock_b("qcbf_t","'3'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  #FETCH aqct300_bcl6 INTO g_qcbd3_d[l_ac].qcbf002,g_qcbd3_d[l_ac].qcbf003,g_qcbd3_d[l_ac].qcbf004,g_qcbd3_d[l_ac].qcbfsite  #160607-00004#1 mark
                  FETCH aqct300_bcl99 INTO g_qcbd3_d[l_ac].qcbf002,g_qcbd3_d[l_ac].qcbf003,g_qcbd3_d[l_ac].qcbf004,g_qcbd3_d[l_ac].qcbfsite  #160607-00004#1 add

                   IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = "Y"
                  END IF
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row

            #end add-point  
            #其他table資料備份(確定是否更改用)
            
            #其他table進行lock
            
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' AND g_qcbd3_d.getLength() < l_ac THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
               CALL g_qcbd3_d.deleteElement(l_ac)
               NEXT FIELD qcbf002
            END IF
            IF g_qcbd3_d[l_ac].qcbf002 IS NOT NULL
               AND g_qcbd3_d_t.qcbf003 IS NOT NULL
            THEN
               
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF
               
               #add-point:單身3刪除前

               #end add-point    
               
               DELETE FROM qcbf_t
                WHERE qcbfent = g_enterprise  AND qcbfdocno = g_qcba_m.qcbadocno  
                    AND qcbfseq = g_qcbd_d[g_detail_idx].qcbdseq AND qcbf001 = g_qcbd2_d[g_detail_idx2].qcbe001 AND qcbf002 =  g_qcbd3_d[g_detail_idx3].qcbf002  
                    AND qcbf003 = g_qcbd3_d[g_detail_idx3].qcbf003
                  
               #add-point:單身3刪除中

               #end add-point    
                  
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "qcbd_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE   
               ELSE
                  LET g_rec_b = g_rec_b-1
                  
                  #add-point:單身3刪除後

                  #end add-point
                  CALL s_transaction_end('Y','0')
               END IF 
               CLOSE aqct300_bcl
               CLOSE aqct300_bcl4
               LET l_count = g_qcbd_d.getLength()
            END IF 
            
                           INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd2_d[g_detail_idx2].qcbe001
               LET gs_keys[4] = g_qcbd3_d[g_detail_idx3].qcbf002
               LET gs_keys[5] = g_qcbd3_d[g_detail_idx3].qcbf003
 
            
         AFTER DELETE 
            #add-point:單身AFTER DELETE 

#            #end add-point
#                           CALL aqct300_delete_b('qcbf_t',gs_keys,"'5'")
#               IF NOT aqct300_delete_b('qcbf_t',gs_keys,"'5'") THEN
#                  CALL s_transaction_end('N','0')
#                  CLOSE aqct300_bcl
#                  CANCEL DELETE
#               END IF
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身3新增前

            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM qcbf_t 
             WHERE qcbfent = g_enterprise AND qcbfdocno = g_qcba_m.qcbadocno  
                 AND qcbfseq = g_qcbd_d[g_detail_idx].qcbdseq AND qcbf001 = g_qcbd2_d[g_detail_idx2].qcbe001 AND qcbf002 = g_qcbd3_d[g_detail_idx3].qcbf002  
                 AND qcbf003 = g_qcbd3_d[g_detail_idx3].qcbf003 
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身3新增前

               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd2_d[g_detail_idx2].qcbe001
               LET gs_keys[4] = g_qcbd3_d[g_detail_idx3].qcbf002
               LET gs_keys[5] = g_qcbd3_d[g_detail_idx3].qcbf003
               #CALL aqct300_insert_b('qcbf_t',gs_keys,"'6'") #160607-00004#1 mark
               CALL aqct300_insert_b('qcbf_t',gs_keys,"'99'") #160607-00004#1 add
                           
               #add-point:單身新增後3

               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_qcbd_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "qcbf_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()
  
               CALL s_transaction_end('N','0')                    
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aqct300_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後

               #end add-point
               CALL s_transaction_end('Y','0')
               ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_qcbd3_d[l_ac].* = g_qcbd3_d_t.*
               #CLOSE aqct300_bcl6 #160607-00004#1 mark
               CLOSE aqct300_bcl99 #160607-00004#1 add
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_qcbd3_d[l_ac].* = g_qcbd3_d_t.*
            ELSE
               #add-point:單身page3修改前

               #end add-point
               
               #寫入修改者/修改日期資訊(單身3)
               
               
               UPDATE qcbf_t SET (qcbfdocno,qcbfseq,qcbf001,qcbf002,qcbf003,qcbf004,qcbfsite) = (
                   g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq,g_qcbd2_d[g_detail_idx2].qcbe001,g_qcbd3_d[l_ac].qcbf002,g_qcbd3_d[l_ac].qcbf003, 
                   g_qcbd3_d[l_ac].qcbf004,g_qcbd3_d[l_ac].qcbfsite) #自訂欄位頁簽
                WHERE qcbfent = g_enterprise AND qcbfdocno = g_qcbadocno_t AND qcbfseq = g_qcbd_d_t.qcbdseq AND qcbf001 = g_qcbd2_d_t.qcbe001 AND qcbf002 = g_qcbd3_d_t.qcbf002 AND qcbf003 = g_qcbd3_d_t.qcbf003 
                  
               #add-point:單身page3修改中

               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "qcbf_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     LET g_qcbd3_d[l_ac].* = g_qcbd3_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "qcbf_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()
  
                     CALL s_transaction_end('N','0')
                     LET g_qcbd3_d[l_ac].* = g_qcbd3_d_t.*
                  OTHERWISE
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys_bak[2] = g_qcbd_d_t.qcbdseq
               LET gs_keys[3] = g_qcbd2_d[g_detail_idx2].qcbe001
               LET gs_keys_bak[3] = g_qcbd2_d_t.qcbe001
               LET gs_keys[4] = g_qcbd3_d[g_detail_idx3].qcbf002
               LET gs_keys_bak[4] = g_qcbd3_d_t.qcbf002
               LET gs_keys[5] = g_qcbd3_d[g_detail_idx3].qcbf003
               LET gs_keys_bak[5] = g_qcbd3_d_t.qcbf003
               #CALL aqct300_update_b('qcbf_t',gs_keys,gs_keys_bak,"'6'") #160607-00004#1 mark
               CALL aqct300_update_b('qcbf_t',gs_keys,gs_keys_bak,"'99'") #160607-00004#1 add
                     #資料多語言用-增/改
                     
               END CASE
               #add-point:單身page3修改後

               #end add-point
            END IF
         
         #---------------------<  Detail: page3  >---------------------
         #----<<qcbf002>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qcbf002
            #add-point:BEFORE FIELD qcbf002

            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qcbf002
            
            #add-point:AFTER FIELD qcbf002
            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL  AND g_qcbd3_d[g_detail_idx].qcbf002 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t  OR g_qcbd3_d[g_detail_idx3].qcbf002 != g_qcbd3_d_t.qcbf002 OR g_qcbd3_d[g_detail_idx3].qcbf003 != g_qcbd3_d_t.qcbf003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbf_t WHERE "||"qcbfent = '" ||g_enterprise|| "' AND "|| "qcbfdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbfseq = '"||g_qcbd_d[g_detail_idx].qcbdseq ||"' AND "|| "qcbf001 = '"||g_qcbd2_d[g_detail_idx2].qcbe001 ||"' AND "|| "qcbf002 = '"||g_qcbd3_d[g_detail_idx].qcbf002 ||"' AND "|| "qcbf003 = '"||g_qcbd3_d[g_detail_idx].qcbf003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qcbf002
            #add-point:ON CHANGE qcbf002

            #END add-point
 
         #----<<qcbf003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qcbf003
            #add-point:BEFORE FIELD qcbf003

            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qcbf003
            
            #add-point:AFTER FIELD qcbf003
            #此段落由子樣板a05產生
            IF g_qcba_m.qcbadocno IS NOT NULL  AND g_qcbd3_d[g_detail_idx].qcbf002 IS NOT NULL AND g_qcbd3_d[g_detail_idx].qcbf003 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_qcba_m.qcbadocno != g_qcbadocno_t  OR g_qcbd3_d[g_detail_idx3].qcbf002 != g_qcbd3_d_t.qcbf002 OR g_qcbd3_d[g_detail_idx3].qcbf003 != g_qcbd3_d_t.qcbf003)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(1) FROM qcbf_t WHERE "||"qcbfent = '" ||g_enterprise|| "' AND "|| "qcbfdocno = '"||g_qcba_m.qcbadocno ||"' AND "|| "qcbfseq = '"||g_qcbd_d[g_detail_idx].qcbdseq ||"' AND "|| "qcbf001 = '"||g_qcbd2_d[g_detail_idx2].qcbe001 ||"' AND "|| "qcbf002 = '"||g_qcbd3_d[g_detail_idx3].qcbf002 ||"' AND "|| "qcbf003 = '"||g_qcbd3_d[g_detail_idx3].qcbf003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qcbf003
            #add-point:ON CHANGE qcbf003

            #END add-point
 
         #----<<qcbf004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qcbf004
            #add-point:BEFORE FIELD qcbf004

            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qcbf004
            
            #add-point:AFTER FIELD qcbf004

            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qcbf004
            #add-point:ON CHANGE qcbf004

            #END add-point
 
 
         #---------------------<  Detail: page3  >---------------------
         #----<<qcbf002>>----
         #Ctrlp:input.c.page3.qcbf002
         ON ACTION controlp INFIELD qcbf002
            #add-point:ON ACTION controlp INFIELD qcbf002

            #END add-point
 
         #----<<qcbf003>>----
         #Ctrlp:input.c.page3.qcbf003
         ON ACTION controlp INFIELD qcbf003
            #add-point:ON ACTION controlp INFIELD qcbf003

            #END add-point
 
         #----<<qcbf004>>----
         #Ctrlp:input.c.page3.qcbf004
         ON ACTION controlp INFIELD qcbf004
            #add-point:ON ACTION controlp INFIELD qcbf004

            #END add-point
 
 
 
         AFTER ROW
            #add-point:單身page3_after_row

            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_qcbd3_d[l_ac].* = g_qcbd3_d_t.*
               END IF
               #CLOSE aqct300_bcl6 #160607-00004#1 mark
               CLOSE aqct300_bcl99 #160607-00004#1 add
               CLOSE aqct300_bcl4
               CLOSE aqct300_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            #CALL aqct300_unlock_b("qcbf_t","'6'") #160607-00004#1 mark
            CALL aqct300_unlock_b("qcbf_t","'99'") #160607-00004#1 add
            CALL s_transaction_end('Y','0')
            #add-point:單身page3_after_row2

            #end add-point
 
         AFTER INPUT
            #add-point:input段after input 

            #end add-point  
         ON ACTION controlo    
            CALL FGL_SET_ARR_CURR(g_qcbd3_d.getLength()+1)
            LET lb_reproduce = TRUE
            LET li_reproduce = l_ac
            LET li_reproduce_target = g_qcbd3_d.getLength()+1
 
      END INPUT
      
      #170105-00062#1 add(s)
       INPUT ARRAY g_qcbd99_d FROM s_detail99.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = FALSE, 
                  DELETE ROW = FALSE,
                  APPEND ROW = FALSE)
 
         #自訂ACTION(detail_input,page_1)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body.before_input2"

            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd99_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL aqct300_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'1',"))
            END IF
            LET g_loc = 'm'
            LET g_rec_b = g_qcbd99_d.getLength()
            #add-point:資料輸入前 name="input.d.before_input"

            
            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2 name="input.body.before_row2"

            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_detail_idx_list[1] = l_ac
            LET g_current_page = 1
            CALL aqct300_b_fill2('4')
            CALL aqct300_b_fill2('5')
 
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd99_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd99_d[l_ac].qcbdseq_2 IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_qcbd99_d_t.* = g_qcbd99_d[l_ac].*  #BACKUP
               LET g_qcbd99_d_o.* = g_qcbd99_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body.after_set_entry_b"

               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               IF NOT aqct300_lock_b("qcbd2_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aqct300_bcl6 INTO g_qcbd99_d[l_ac].qcbdseq_2,g_qcbd99_d[l_ac].qcbd001_2,g_qcbd99_d[l_ac].qcbd002_2, 
                      g_qcbd99_d[l_ac].qcbd012,g_qcbd99_d[l_ac].qcbd013,g_qcbd99_d[l_ac].qcbd014,g_qcbd99_d[l_ac].qcbd015,
                      g_qcbd99_d[l_ac].qcbd016,g_qcbd99_d[l_ac].qcbd017,g_qcbd99_d[l_ac].qcbd018,g_qcbd99_d[l_ac].qcbd019

                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_qcbd99_d_t.qcbdseq_2,":",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_qcbd99_d_mask_o[l_ac].* =  g_qcbd99_d[l_ac].*
                  CALL aqct300_qcbd_t_mask()
                  LET g_qcbd99_d_mask_n[l_ac].* =  g_qcbd99_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            IF g_qcbd_d[l_ac].qcbd020 = '4' THEN
               CALL cl_set_comp_required("qcbd012",TRUE)
            ELSE
               CALL cl_set_comp_required("qcbd012",FALSE)
            END IF
          
          
          
          AFTER FIELD qcbd012
            IF NOT aqct300_qcbd012_qcbd016_chk() THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'aqc-00027'
               LET g_errparam.extend = g_qcbd99_d[l_ac].qcbd012
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_qcbd99_d[l_ac].qcbd012 = g_qcbd99_d_t.qcbd012
               NEXT FIELD CURRENT
            END IF
         AFTER FIELD qcbd013
            IF NOT aqct300_qcbd013_qcbd015_chk() THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'aqc-00028'
               LET g_errparam.extend = g_qcbd99_d[l_ac].qcbd013
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_qcbd99_d[l_ac].qcbd013 = g_qcbd99_d_t.qcbd013
               NEXT FIELD CURRENT
            END IF
         
         AFTER FIELD qcbd015
            IF NOT aqct300_qcbd013_qcbd015_chk() THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'aqc-00028'
               LET g_errparam.extend = g_qcbd99_d[l_ac].qcbd015
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_qcbd99_d[l_ac].qcbd015 = g_qcbd99_d_t.qcbd015
               NEXT FIELD CURRENT
            END IF
         AFTER FIELD qcbd016
            IF NOT aqct300_qcbd012_qcbd016_chk() THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'aqc-00027'
               LET g_errparam.extend = g_qcbd99_d[l_ac].qcbd016
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_qcbd99_d[l_ac].qcbd016 = g_qcbd99_d_t.qcbd016
               NEXT FIELD CURRENT
            END IF          


          ON ROW CHANGE
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_qcbd99_d[l_ac].* = g_qcbd99_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl6
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_qcbd99_d[l_ac].qcbdseq_2 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_qcbd99_d[l_ac].* = g_qcbd99_d_t.*
            ELSE
            
               #add-point:單身修改前 name="input.body.b_update"

               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
               #將遮罩欄位還原
               CALL aqct300_qcbd_t_mask_restore('restore_mask_o')
      
               UPDATE qcbd_t SET (qcbddocno,qcbdseq,qcbd001,qcbd002,qcbd012,qcbd013,qcbd014,
                                  qcbd015,qcbd016,qcbd017,qcbd018,qcbd019) = (g_qcba_m.qcbadocno, 
                   g_qcbd99_d[l_ac].qcbdseq_2,g_qcbd99_d[l_ac].qcbd001_2,g_qcbd99_d[l_ac].qcbd002_2, 
                      g_qcbd99_d[l_ac].qcbd012,g_qcbd99_d[l_ac].qcbd013,g_qcbd99_d[l_ac].qcbd014,g_qcbd99_d[l_ac].qcbd015,
                      g_qcbd99_d[l_ac].qcbd016,g_qcbd99_d[l_ac].qcbd017,g_qcbd99_d[l_ac].qcbd018,g_qcbd99_d[l_ac].qcbd019)
                WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno 
 
                  AND qcbdseq = g_qcbd99_d_t.qcbdseq_2 #項次   
 
                  
               #add-point:單身修改中 name="input.body.m_update"

               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_qcbd99_d[l_ac].* = g_qcbd99_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbd_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_qcbd99_d[l_ac].* = g_qcbd99_d_t.*  
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbd_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()                   
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd99_d[g_detail_idx].qcbdseq_2
               LET gs_keys_bak[2] = g_qcbd99_d_t.qcbdseq_2
               CALL aqct300_update_b('qcbd_t',gs_keys,gs_keys_bak,"'1'")
               END CASE
 
               #將遮罩欄位進行遮蔽
               CALL aqct300_qcbd_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT(g_qcbd99_d[g_detail_idx].qcbdseq_2 = g_qcbd99_d_t.qcbdseq_2 
 
                  ) THEN
                  LET gs_keys[01] = g_qcba_m.qcbadocno
 
                  LET gs_keys[gs_keys.getLength()+1] = g_qcbd99_d_t.qcbdseq_2
 
                  CALL aqct300_key_update_b(gs_keys,'qcbd_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd99_d_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd99_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身修改後 name="input.body.a_update"

               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row name="input.body.after_row"
             IF g_qcbd_d[l_ac].qcbd020 = '4' THEN
               IF cl_null(g_qcbd99_d[l_ac].qcbd012) AND cl_null(g_qcbd99_d[l_ac].qcbd016) THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "qcbd_t" 
                  LET g_errparam.code   = "aqc-00106"
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
               
               IF cl_null(g_qcbd99_d[l_ac].qcbd013) AND cl_null(g_qcbd99_d[l_ac].qcbd015) THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "qcbd_t" 
                  LET g_errparam.code   = "aqc-00107"
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
            END IF
            #end add-point
            CALL aqct300_unlock_b("qcbd2_t","'6'")
            CALL s_transaction_end('Y','0')
            
       END INPUT
      #170105-00062#1 add(e)
      
      #DISPLAY ARRAY g_qcbd6_d TO s_detail6.* ATTRIBUTES(COUNT=g_rec_b) #page1   #160607-00004#1 mark
      #170105-00062#1 mark(s)
#      DISPLAY ARRAY g_qcbd99_d TO s_detail99.* ATTRIBUTES(COUNT=g_rec_b) #page1  #160607-00004#1 add
#    
#            BEFORE ROW
#               CALL aqct300_idx_chk()
#               #LET l_ac = DIALOG.getCurrentRow("s_detail6") #160607-00004#1 mark
#               LET l_ac = DIALOG.getCurrentRow("s_detail99") #160607-00004#1 add
#               LET g_detail_idx = l_ac
#               
#               #add-point:page1, before row動作
#               CALL aqct300_b_fill2('4')
#               CALL aqct300_b_fill2('5')
# 
#               #add-point:page1, before row動作
#               #CALL aqct300_b_fill2('6') #160607-00004#1 mark
#               CALL aqct300_b_fill2('99') #160607-00004#1 add
#               #end add-point
#               
#            BEFORE DISPLAY
#               CALL FGL_SET_ARR_CURR(g_detail_idx)
#               #160607-00004#1 --s mark
#               #LET l_ac = DIALOG.getCurrentRow("s_detail6") 
#               #CALL aqct300_detail6_idx_chk()  
#               #LET g_current_page = 6 
#               #160607-00004#1 --e mark
#               #160607-00004#1 --s add
#               LET l_ac = DIALOG.getCurrentRow("s_detail99") 
#               CALL aqct300_detail99_idx_chk()   
#               LET g_current_page = 99 
#               #160607-00004#1 --e add
#            #自訂ACTION(detail_show,page_6)
#            
#               
#            #add-point:page6自定義行為
#
#            #end add-point
#               
#         END DISPLAY
         #170105-00062#1 mark(e)
       
      SUBDIALOG aoo_aooi360_01.aooi360_01_input   #备注单身  #161031-00025#16 add]]>
</point>
  <point name="input.next_field" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="input.other_sql" order="" ver="37" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   LET g_forupd_sql = "SELECT qcbf002,qcbf003,qcbf004,qcbfsite FROM qcbf_t WHERE qcbfent=? AND  
       qcbfdocno=? AND qcbfseq=? AND qcbf001=? AND qcbf002=? AND qcbf003=? FOR UPDATE"
   #add-point:input段define_sql

   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   #DECLARE aqct300_bcl6 CURSOR FROM g_forupd_sql #160607-00004#1 mark
   DECLARE aqct300_bcl99 CURSOR FROM g_forupd_sql #160607-00004#1 add
   
   #170105-00062#1 add(s)
    LET g_forupd_sql = "SELECT qcbdseq,qcbd001,qcbd002,qcbd012,qcbd013,qcbd014,qcbd015,",
                       "       qcbd016,qcbd017,qcbd018,qcbd019 ",    
                       "  FROM qcbd_t WHERE qcbdent=? AND qcbddocno=?  ",
                       "   AND qcbdseq=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql"

   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_bcl6 CURSOR FROM g_forupd_sql
   #170105-00062#1 add(e)]]>
</point>
  <point name="input.pre_function" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_inao000        LIKE inao_t.inao000]]>
</point>
  <point name="insert.before" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL aooi360_01_clear_detail()   #清除备注单身  #161031-00025#16 add]]>
</point>
  <point name="insert.default" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      CALL aqct300_page_visible()
      LET g_qcba_m.qcbasite = g_site
      LET g_qcba_m.qcbastus = "N"
      LET g_qcba_m.qcbadocdt = g_today
      LET g_qcba_m.qcba900 = g_user
      CALL aqct300_qcba900_desc(g_qcba_m.qcba900)
      SELECT ooag003 INTO g_qcba_m.qcba901 FROM ooag_t WHERE ooagent = g_enterprise AND ooag001 = g_user
      CALL aqct300_qcba901_desc(g_qcba_m.qcba901)
      LET g_qcba_m.qcba014 = g_today
      LET g_qcba_m.qcba015 = cl_get_time()   #160407-00031#1 add
#     LET g_qcba_m.qcba025 = TIME
      #LET g_qcba_m.qcba024 = g_user         #161014-00048#1 mark
      #161014-00048#1 add---start---
      SELECT imae112 INTO g_qcba_m.qcba024
        FROM imae_t
       WHERE imaeent = g_enterprise
         AND imaesite = g_qcba_m.qcbasite
         AND imae001 = g_qcba_m.qcba010
      IF cl_null(g_qcba_m.qcba024) THEN
         LET g_qcba_m.qcba024 = g_user
      END IF
      #161014-00048#1 add---end---
      CALL aqct300_qcba024_desc(g_qcba_m.qcba024)
      LET g_qcba_m_t.* = g_qcba_m.*
      LET g_auto_flag  = TRUE
      LET g_qcba_m_o.* = g_qcba_m.*
      #161031-00025#16 add(s)
      LET g_ooff001_d = '6'   #6.單據單頭備註
      LET g_ooff002_d = g_prog
      LET g_ooff003_d = ''    #单号
      LET g_ooff004_d = 0     #项次
      LET g_ooff005_d = ' '
      LET g_ooff006_d = ' '
      LET g_ooff007_d = ' '
      LET g_ooff008_d = ' '
      LET g_ooff009_d = ' '
      LET g_ooff010_d = ' '
      LET g_ooff011_d = ' '
      #161031-00025#16 add(e)]]>
</point>
  <point name="insert_b.other" order="" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #LET ls_group = "'6'," #160607-00004#1 mark
   LET ls_group = "'99'," #160607-00004#1 add
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前

      #end add-point 
      INSERT INTO qcbf_t
                  (qcbfent,
                   qcbfdocno,qcbfseq,qcbf001,
                   qcbf002,qcbf003
                   ,qcbf004,qcbfsite) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4],ps_keys[5]
                   ,g_qcbd3_d[g_detail_idx2].qcbf004,g_qcbd3_d[g_detail_idx2].qcbfsite)
      #add-point:insert_b段資料新增中

      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "qcbf_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

      END IF
      #add-point:insert_b段資料新增後

      #end add-point
   END IF]]>
</point>
  <point name="key_delete_b.after_delete4" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      DELETE FROM qcbf_t 
            WHERE qcbfent = g_enterprise AND
                  qcbfdocno = ps_keys_bak[1] AND qcbfseq = ps_keys_bak[2]
 
      #add-point:delete_b段修改中

      #end add-point
              
      CASE
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbf_t" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            CALL s_transaction_end('N','0')
            RETURN FALSE
         OTHERWISE
      END CASE]]>
</point>
  <point name="lock_b.other" order="" ver="37" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   LET ls_group = "qcbf_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      #OPEN aqct300_bcl6 USING g_enterprise, #160607-00004#1 mark
      OPEN aqct300_bcl99 USING g_enterprise, #160607-00004#1 add
                                             g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq, g_qcbd2_d[g_detail_idx2].qcbe001,

                                             g_qcbd3_d[g_detail_idx3].qcbf002,g_qcbd3_d[g_detail_idx3].qcbf003 

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         #LET g_errparam.extend = "aqct300_bcl6" #160607-00004#1 mark
         LET g_errparam.extend = "aqct300_bcl99" #160607-00004#1 add
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN FALSE
      END IF
   END IF
   
   #170105-00062#1 add(s)
   LET ls_group = "qcbd2_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN aqct300_bcl6 USING g_enterprise,
                                       g_qcba_m.qcbadocno,g_qcbd99_d[g_detail_idx].qcbdseq_2     
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "aqct300_bcl6:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
   #170105-00062#1 add(e)]]>
</point>
  <point name="main.before_close" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[]]>
</point>
  <point name="main.define" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[DEFINE l_n LIKE type_t.num5]]>
</point>
  <point name="main.exit" order="" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL s_asft335_drop_tmp_table() #170110-00056#1]]>
</point>
  <point name="main.init" order="" ver="20" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   LET l_n = 0 
   SELECT COUNT(1) INTO l_n FROM inao_t 
    WHERE inaoent = g_enterprise AND inaodocno = 'CNJ-WSD-201508220001'
      AND inaoseq = 1 AND inao012 <> inao024]]>
</point>
  <point name="menu.exporttoexcel" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[                  #161031-00025#16 add(s)
                  LET g_export_node[6] = base.typeInfo.create(g_ooff_d4)
                  LET g_export_id[6]   = "s_detail1_aooi360_01"
                  #161031-00025#16 add(e)]]>
</point>
  <point name="menu.ins_qcbg" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               IF g_qcbd_d.getLength() > 0 THEN
                  CALL aqct300_01(g_qcba_m.qcbadocno)
               END IF]]>
</point>
  <point name="menu.memo" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#               CALL aooi360_01('6',g_qcba_m.qcbadocno,'','','','','','','','','') #161031-00025#16 mark
               #161031-00025#16 add(s)
               IF NOT cl_null(g_qcba_m.qcbadocno) THEN
                  CALL aqct300_remarks()
               END IF
               #161031-00025#16 add(e)]]>
</point>
  <point name="menu.output" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               LET g_rep_wc = "qcbaent ="|| g_enterprise ||" AND qcbadocno ='"|| g_qcba_m.qcbadocno||"'"]]>
</point>
  <point name="menu.prog_qcba001" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #應用 a41 樣板自動產生(Version:2)
               #使用JSON格式組合參數與作業編號(串查)
               LET l_slip = ''
               LET l_prog = ''
               IF NOT cl_null(g_qcba_m.qcba001) THEN
                  CALL s_aooi200_get_slip(g_qcba_m.qcba001) RETURNING g_success,l_slip
                  IF NOT cl_null(l_slip) THEN
                     SELECT oobx004 INTO l_prog
                       FROM oobx_t
                      WHERE oobxent = g_enterprise
                        AND oobx001 = l_slip
                  END IF
                  IF NOT cl_null(l_prog) THEN
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = l_prog
                     LET la_param.param[1] = g_qcba_m.qcba001
                     
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun(ls_js)
                  END IF
               END IF
 

]]>
</point>
  <point name="menu.prog_qcba003" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #應用 a41 樣板自動產生(Version:2)
               #使用JSON格式組合參數與作業編號(串查)
              LET l_slip = ''
               LET l_prog = ''
               IF NOT cl_null(g_qcba_m.qcba003) THEN
                  CALL s_aooi200_get_slip(g_qcba_m.qcba003) RETURNING g_success,l_slip
                  IF NOT cl_null(l_slip) THEN
                     SELECT oobx004 INTO l_prog
                       FROM oobx_t
                      WHERE oobxent = g_enterprise
                        AND oobx001 = l_slip
                  END IF
                  IF NOT cl_null(l_prog) THEN
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = l_prog
                     LET la_param.param[1] = g_qcba_m.qcba003
                     
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun(ls_js)
                  END IF
               END IF
 

]]>
</point>
  <point name="menu.quickprint" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               LET g_rep_wc = "qcbaent ="|| g_enterprise ||" AND qcbadocno ='"|| g_qcba_m.qcbadocno||"'"]]>
</point>
  <point name="menu.s_lot_ins" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               CALL s_transaction_begin()
               IF g_lot_ins_flag = 'Y' AND g_qcbd5_d.getLength() > 0 THEN 
                  #先还原已转QC量
                  IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[g_detail_idx].qcbcseq) THEN
                     CALL s_transaction_end('N','0') 
                  END IF
                  IF NOT aqct300_upd_inao(g_qcbd5_d[g_detail_idx].qcbcseq,g_qcbd5_d[g_detail_idx].qcbc009,g_qcbd5_d[g_detail_idx].qcbc004,
                                        g_qcbd5_d[g_detail_idx].qcbc005,g_qcbd5_d[g_detail_idx].qcbc006,g_qcbd5_d[g_detail_idx].qcbc007) THEN
                     CALL s_transaction_end('N','0')     
                  ELSE
                     IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,g_qcbd5_d[g_detail_idx].qcbcseq) THEN
                        CALL s_transaction_end('N','0')
                     END IF
                     CALL s_transaction_end('Y','0')     
                                          
                  END IF
                  
               ELSE
                 #先还原已转QC量
                  IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,1) THEN
                     CALL s_transaction_end('N','0') 
                  END IF
                  IF NOT aqct300_upd_inao(1,g_qcba_m.qcba017,g_qcba_m.qcba012,'','','') THEN
                     CALL s_transaction_end('N','0')
                  ELSE
                     IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,1) THEN
                        CALL s_transaction_end('N','0')
                     END IF
                     CALL s_transaction_end('Y','0')
                  END IF
               END IF]]>
</point>
  <point name="menu.special_purchase" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               IF aqct300_data_exists() THEN
                  LET g_special = 'Y'
                  CALL s_transaction_begin()
                  IF NOT aqct300_special_purchase_upd() THEN
                     CALL s_transaction_end("N","0")
                  ELSE
                     CALL s_transaction_end("Y","0")
                  END IF
                  LET g_special = 'N' 
                  CALL aqct300_special_purchase_refesh()
                  CALL aqct300_set_act_visible()   
                  CALL aqct300_set_act_no_visible()
                  CALL aqct300_b_fill()
               END IF   ]]>
</point>
  <point name="menu.un_special_purchase" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               IF aqct300_data_exists() THEN
                  CALL s_transaction_begin()
                  IF NOT  aqct300_un_special_purchase_upd() THEN
                     CALL s_transaction_end("N","0")
                  ELSE
                     CALL s_transaction_end("Y","0")
                  END IF
                  CALL aqct300_special_purchase_refesh()
                  CALL aqct300_set_act_visible()   
                  CALL aqct300_set_act_no_visible()
                  CALL aqct300_b_fill()
               END IF ]]>
</point>
  <point name="modify.before_input" order="" ver="14" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      LET g_qcba_m_o.* = g_qcba_m.*
      LET g_qcba_m_t.* = g_qcba_m.*
      #「D抽單 / R已拒絕」狀況碼更改資料後，需還原為「N未確認」
      IF g_qcba_m.qcbastus MATCHES "[DR]" THEN 
         LET g_qcba_m.qcbastus = "N"
      END IF
      
      LET g_qcba017_t = g_qcba_m.qcba017  #160324-00033#1
]]>
</point>
  <point name="modify.body.a_fk_update4" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[         UPDATE qcbf_t
            SET qcbfdocno = g_qcba_m.qcbadocno
 
          WHERE qcbfent = g_enterprise 
            AND qcbfdocno = g_qcbadocno_t
 
         #add-point:單身fk修改中

         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00009"
               LET g_errparam.extend = "qcbf_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CALL s_transaction_end('N','0')
               CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "qcbf_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()
  
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
         END CASE]]>
</point>
  <point name="query.other" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL aooi360_01_clear_detail()   #清除备注单身  #161031-00025#16 ad]]>
</point>
  <point name="query.pre_function" order="" ver="9" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL cl_set_comp_visible("page_3",TRUE)]]>
</point>
  <point name="reproduce.define" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[]]>
</point>
  <point name="reproduce.head.b_input" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   LET g_auto_flag = TRUE
   LET g_qcba_m.qcba022 = '0']]>
</point>
  <point name="send.before_send" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL s_aqct300_conf_chk(g_qcba_m.qcbadocno) RETURNING g_success,g_errno
   IF NOT g_success THEN
      CLOSE aqct300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF]]>
</point>
  <point name="set_act_no_visible.define" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[DEFINE l_imaf071  LIKE imaf_t.imaf071
DEFINE l_imaf081  LIKE imaf_t.imaf081]]>
</point>
  <point name="set_act_no_visible.set_act_no_visible" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #應用 a63 樣板自動產生(Version:1)
   IF g_qcba_m.qcbastus NOT MATCHES "[NDR]" THEN   # N未確認/D抽單/R已拒絕允許修改
      CALL cl_set_act_visible("modify,delete,modify_detail", FALSE)
   END IF
   IF g_qcba_m.qcba022 NOT MATCHES '[23]' OR  g_qcba_m.qcbastus != 'Y' THEN
      CALL cl_set_act_visible("special_purchase",FALSE)
   END IF
   IF g_qcba_m.qcba022 != '4' THEN
      CALL cl_set_act_visible("un_special_purchase",FALSE)
   END IF
   CALL aqct300_get_imaf071_imaf081() RETURNING l_imaf071,l_imaf081
   IF (l_imaf071 ='2' AND l_imaf081 = '2') OR g_qcba_m.qcbastus MATCHES '[YX]' THEN
      CALL cl_set_act_visible("s_lot_ins",FALSE)
   END IF
   IF NOT cl_null(g_para) AND g_para = 'Y' THEN
      CALL cl_set_act_visible("special_purchase,un_special_purchase",FALSE)
   END IF]]>
</point>
  <point name="set_act_visible.set_act_visible" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL cl_set_act_visible("un_special_purchase,special_purchase,s_lot_ins",TRUE)
   CALL cl_set_act_visible("delete,modify,modify_detail",TRUE)]]>
</point>
  <point name="set_act_visible_b.set_act_visible_b" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[]]>
</point>
  <point name="set_entry.after_control" order="" ver="25" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[   CALL cl_set_comp_entry("qcba005,qcba023,qcba031",TRUE)
   CALL cl_set_comp_visible("qcba029",TRUE)
   
   CALL cl_set_comp_entry("qcba002",TRUE)   #160324-00033#1
   

   CALL cl_set_comp_entry("qcba003,qcba004",TRUE)  #161103-00007#3

]]>
</point>
  <point name="set_entry.field_control" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[       CALL cl_set_comp_entry("qcbadocdt",TRUE)]]>
</point>
  <point name="set_entry_b.set_entry_b" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL cl_set_comp_entry("qcbc003",TRUE)
   CALL cl_set_comp_entry("qcbdseq,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004",TRUE)
   CALL cl_set_comp_entry("qcbg001,qcbg002,qcbg003",TRUE)
   CALL cl_set_comp_visible("bpage_4",TRUE)
   CALL cl_set_comp_entry("qcbc005,qcbc006,qcbc007",TRUE)]]>
</point>
  <point name="set_no_entry.after_control" order="" ver="35" cite_std="N" new="Y" ind_extra="N" ch="" status="u" src="s" readonly="" mark_hard="N">
<![CDATA[   IF NOT g_auto_flag THEN
      CALL cl_set_comp_entry("qcbadocno,qcbadocdt",FALSE)
   END IF
   IF g_qcba_m.qcba000 NOT MATCHES '[45]' THEN
      CALL cl_set_comp_entry("qcba005,qcba031",FALSE)
      INITIALIZE g_qcba_m.qcba031 TO NULL
   END IF 
   IF g_qcba_m.qcba000 != '3' THEN
      CALL cl_set_comp_entry("qcba006,qcba007",FALSE)
      INITIALIZE g_qcba_m.qcba029 TO NULL
      CALL cl_set_comp_visible("qcba029",FALSE)
   END IF 
   IF g_special = 'N' THEN    
      CALL cl_set_comp_entry("qcba023",FALSE)
   END IF
   
   #160324-00033#1---s
   #當檢驗類型=5:Inventory QC時，當類型分類 = '6'.倉庫檢驗申請單，來源項次不可輸入
   #當檢驗類型=5:Inventory QC 且類型分類=6.倉庫檢驗申請單時，帶出倉庫檢驗申請單的交易對象編號，不可修改
   IF g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 = '6' THEN
      CALL cl_set_comp_entry("qcba002,qcba005",FALSE)
      LET g_qcba_m.qcba002 = ''
   END IF
   #160324-00033#1---e
   
   #161103-00007#3---s
   IF g_qcba_m.qcba000 = '3' THEN
#      CALL cl_set_comp_entry("qcba002,qcba029",FALSE) #170110-00056#1 mark
      CALL cl_set_comp_entry("qcba029",FALSE) #170110-00056#1 add
      CALL cl_set_comp_entry("qcba003,qcba004",FALSE)
   END IF
   #161103-00007#3---e
   
#   LET l_n = 0 
#   SELECT COUNT(1) INTO l_n FROM qcbd_t 
#    WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno
#      AND qcbd011 = '2'
#   IF l_n != 0 THEN
#      CALL cl_set_comp_entry("qcba027",FALSE)
#   END IF
#    IF g_qcba027_flag = 'N' THEN  
#       CALL cl_set_comp_entry("qcba027",FALSE)
#    END IF]]>
</point>
  <point name="set_no_entry.define" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_n     LIKE type_t.num5
   DEFINE l_imae120 LIKE imae_t.imae120]]>
</point>
  <point name="set_no_entry.field_control" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      CALL cl_set_comp_entry("qcbadocdt",FALSE)]]>
</point>
  <point name="set_no_entry_b.define" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_imaa005    LIKE imaa_t.imaa005
   DEFINE l_qcan015 LIKE qcan_t.qcan015]]>
</point>
  <point name="set_no_entry_b.set_no_entry_b" order="" ver="37" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   IF g_qcbd5_d[l_ac].qcbc001 = '0' THEN
      CALL cl_set_comp_entry("qcbc003",FALSE)
   END IF
   SELECT imaa005 INTO l_imaa005 FROM imaa_t
    WHERE imaaent = g_enterprise AND imaa001 = g_qcbd5_d[l_ac].qcbc003
   IF cl_null(l_imaa005) THEN
      INITIALIZE g_qcbd5_d[l_ac].qcbc004 TO NULL
      CALL cl_set_comp_entry("qcbc004",FALSE)
   END IF 
   
   IF g_qcaz.qcaz018 = 'N' THEN
      CALL cl_set_comp_entry("qcbdseq,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004",FALSE)
      CALL cl_set_comp_entry("qcbd012,qcbd013,qcbd014,qcbd015,qcbd016,qcbd017,qcbd018,qcbd019",FALSE) #170105-00062#1 add
   END IF
   
   IF g_qcbd_d[l_ac].qcbd020 NOT MATCHES '[1256]' THEN
      INITIALIZE g_qcbd_d[l_ac].qcbd004 TO NULL
      CALL cl_set_comp_entry("qcbd004",FALSE)
   END IF
   IF g_detail_idx > 0 THEN
      CALL aqct300_get_qcan015(g_qcbd_d[g_detail_idx].qcbdseq) RETURNING l_qcan015
   END IF
   IF l_qcan015 = '1' THEN
      CALL cl_set_comp_entry("qcbg001,qcbg002,qcbg003",FALSE)
      CALL cl_set_comp_visible("bpage_4",FALSE)
   END IF
   
   IF l_qcan015 = '3' THEN
      CALL cl_set_comp_entry("qcbg003",FALSE)
   END IF
   IF g_qcba_m.qcba000 MATCHES '[346]' OR (g_qcba_m.qcba000 = '5' AND g_qcba_m.qcba031 != '2') THEN
      CALL cl_set_comp_entry("qcbc005,qcbc006,qcbc007",FALSE)
   END IF]]>
</point>
  <point name="show.after" order="" ver="22" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL cl_set_comp_entry("qcba002",FALSE)    #160913-00018#1
   
   CALL aqct300_formonly_desc()
   IF NOT cl_null(g_qcba_m.qcbadocno) THEN
#      IF g_qcba_m.qcba000 MATCHES '[12]' THEN
         CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,g_inao013)
#      ELSE
#         CALL s_lot_b_fill('2',g_site,'2',g_qcba_m.qcbadocno,'',0,-1)
#      END IF
   END IF
   LET g_lot_ins_flag = 'N'
   IF NOT cl_null(g_qcba_m.qcbadocno) THEN#160304-00005#1 add
      CALL s_aooi200_get_slip(g_qcba_m.qcbadocno) RETURNING g_success,l_slip
   END IF
   CALL cl_get_doc_para(g_enterprise,g_site,l_slip,'D-BAS-0097') RETURNING g_para
   CALL aqct300_set_act_visible()
   CALL aqct300_set_act_no_visible()]]>
</point>
  <point name="show.before" order="" ver="7" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   CALL aqct300_get_inao013()
   CALL aqct300_scc_change()
   CALL aqct300_set_entry('')
   CALL aqct300_set_no_entry('')]]>
</point>
  <point name="show.body.reference" order="" ver="1" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[      CALL aqct300_qcbd001_desc(g_qcbd_d[l_ac].qcbd001)]]>
</point>
  <point name="show.body2.reference" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcbd2_d[l_ac].qcbe001
#            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='1053' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcbd2_d[l_ac].qcbe001_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcbd2_d[l_ac].qcbe001_desc
            
#            CALL aqct300_qcbe_ref(g_qcbd_d[l_ac].qcbdseq)]]>
</point>
  <point name="show.body5.reference" order="" ver="2" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbc002_desc(g_qcbd5_d[l_ac].qcbc002)

#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcbd5_d[l_ac].qcbc003
#            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcbd5_d[l_ac].qcbc003_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc003_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbasite
#            LET g_ref_fields[2] = g_qcbd5_d[l_ac].qcbc005
#            CALL ap_ref_array2(g_ref_fields,"SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaasite=? AND inaa001=? ","") RETURNING g_rtn_fields
#            LET g_qcbd5_d[l_ac].qcbc005_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc005_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbasite
#            LET g_ref_fields[2] = g_qcbd5_d[l_ac].qcbc005
#            LET g_ref_fields[3] = g_qcbd5_d[l_ac].qcbc006
#            CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inabsite=? AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
#            LET g_qcbd5_d[l_ac].qcbc006_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc006_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcbd5_d[l_ac].qcbc008
#            CALL ap_ref_array2(g_ref_fields,"SELECT oocql003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocql002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcbd5_d[l_ac].qcbc008_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcbd5_d[l_ac].qcbc008_desc
]]>
</point>
  <point name="show.define" order="" ver="5" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_slip STRING]]>
</point>
  <point name="show.head.reference" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            CALL aqct300_qcbadocno_desc(g_qcba_m.qcbadocno)
            CALL s_feature_description(g_qcba_m.qcba010,g_qcba_m.qcba012) RETURNING g_success,g_qcba_m.qcba012_desc
            CALL aqct300_qcba010_ref()
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcba900
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcba900_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcba900_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcba901
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcba901_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcba901_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcba005
#            CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcba005_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcba005_desc
#
##            INITIALIZE g_ref_fields TO NULL
##            LET g_ref_fields[1] = g_qcba_m.qcba006
##            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocq002='"||g_dlang||"'","") RETURNING g_rtn_fields
##            LET g_qcba_m.qcba006_desc = '', g_rtn_fields[1] , ''
##            DISPLAY BY NAME g_qcba_m.qcba006_desc
##
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcba009
#            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcba009_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcba009_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcba016
#            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcba016_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcba016_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcba024
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcba024_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcba024_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbaownid
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcbaownid_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcbaownid_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbaowndp
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcbaowndp_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcbaowndp_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbacrtid
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcbacrtid_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcbacrtid_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbacrtdp
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcbacrtdp_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcbacrtdp_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbamodid
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcbamodid_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcbamodid_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbacnfid
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcbacnfid_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcbacnfid_desc
#
#            INITIALIZE g_ref_fields TO NULL
#            LET g_ref_fields[1] = g_qcba_m.qcbapstid
#            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
#            LET g_qcba_m.qcbapstid_desc = '', g_rtn_fields[1] , ''
#            DISPLAY BY NAME g_qcba_m.qcbapstid_desc
]]>
</point>
  <point name="statechange.a_update" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[]]>
</point>
  <point name="statechange.b_update" order="" ver="18" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   IF lc_state = 'Y' THEN
      IF cl_ask_confirm('lib-054') THEN
         IF NOT aqct300_qcbg_exists() THEN
            CALL s_transaction_end('N','0')   #160812-00017#3 Add By Ken 160815
            RETURN 
         END IF
#         SELECT imae120 INTO l_imae120 FROM imae_t 
#          WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_qcba_m.qcba010
#         IF g_qcaz.qcaz017 != 'Y' OR l_imae120 != 'Y' THEN    #如果需要走QC联产品判定流程
#            IF cl_ask_confirm('aqc-00095') THEN               #询问是否修改不良数
#               LET g_qcba027_flag = 'Y'
#               CALL aqct300_input_qcba027()
#               CALL s_aqct300_conf_chk(g_qcba_m.qcbadocno) RETURNING g_success,g_errno
#               IF g_success THEN
#                  CALL s_transaction_begin()
#                  CALL s_aqct300_conf_upd(g_qcba_m.qcbadocno) RETURNING g_success,g_errno
#                  IF NOT g_success THEN
#                     INITIALIZE g_errparam TO NULL
#                     LET g_errparam.code = g_errno
#                     LET g_errparam.extend = ''
#                     LET g_errparam.popup = TRUE
#                     CALL cl_err()
#                     CALL s_transaction_end('N','0')
#                     RETURN
#                  ELSE
#                     CALL s_transaction_end('Y','1')
#                  END IF
#               ELSE
#                  INITIALIZE g_errparam TO NULL
#                  LET g_errparam.code = g_errno
#                  LET g_errparam.extend = ''
#                  LET g_errparam.popup = TRUE
#                  CALL cl_err()
#                  RETURN
#               END IF
#            ELSE
#               RETURN
#            END IF
#            LET g_qcba027_flag = 'N'
#         ELSE
            CALL s_aqct300_conf_chk(g_qcba_m.qcbadocno) RETURNING g_success,g_errno
            IF g_success THEN
               CALL s_transaction_begin()
               CALL s_aqct300_conf_upd(g_qcba_m.qcbadocno) RETURNING g_success,g_errno
               IF NOT g_success THEN
                  IF NOT cl_null(g_errno) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = g_errno
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                  END IF
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = g_errno
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()
               CALL s_transaction_end('N','0')   #160812-00017#3 Add By Ken 160815
               RETURN
            END IF
#         END IF
       ELSE
          CALL s_transaction_end('N','0')   #160812-00017#3 Add By Ken 160815
          RETURN 
       END IF
   END IF
   
   IF lc_state = 'N' THEN
      IF cl_ask_confirm('aim-00110') THEN

         CALL s_aqct300_unconf_chk(g_qcba_m.qcbadocno) RETURNING g_success,g_errno
         IF g_success THEN
            CALL s_transaction_begin()
            CALL s_aqct300_unconf_upd(g_qcba_m.qcbadocno) RETURNING g_success,g_errno
            IF NOT g_success THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = g_errno
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()
               CALL s_transaction_end('N','0')
               RETURN
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
         ELSE
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = g_errno
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
            CALL s_transaction_end('N','0')   #160812-00017#3 Add By Ken 160815
            RETURN
         END IF
      ELSE
         CALL s_transaction_end('N','0')   #160812-00017#3 Add By Ken 160815
         RETURN 
      END IF
   END IF
   
   IF lc_state = 'X' THEN
      IF NOT cl_ask_confirm("aim-00109") THEN
         CALL s_transaction_end('N','0')   #160812-00017#3 Add By Ken 160815
         RETURN
      END IF
      IF NOT s_aqct300_upd_inao024(g_qcba_m.qcbadocno,0) THEN
         CALL s_transaction_end('N','0')   #160812-00017#3 Add By Ken 160815
         RETURN
      END IF
   END IF]]>
</point>
  <point name="statechange.before" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   IF g_qcba_m.qcbastus = 'X' THEN
      RETURN
   END IF]]>
</point>
  <point name="statechange.before_menu" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[#         CASE g_qcba_m.qcbastus
#            WHEN "N"
#               HIDE OPTION "unconfirmed"
#            WHEN "Y"
#               HIDE OPTION "confirmed"
#               HIDE OPTION "invalid"
#            WHEN "X"
#               HIDE OPTION "invalid"
#               HIDE OPTION "confirmed"
#         END CASE
         CALL cl_set_act_visible("signing,withdraw",FALSE)
         CALL cl_set_act_visible("unconfirmed,invalid,confirmed",TRUE)
         CALL cl_set_act_visible("closed",FALSE)

         CASE g_qcba_m.qcbastus
            WHEN "N"  
               CALL cl_set_act_visible("unconfirmed,hold",FALSE)
               #需提交至BPM時，則顯示「提交」功能並隱藏「確認」功能
               IF cl_bpm_chk() THEN
                   CALL cl_set_act_visible("signing",TRUE)
                   CALL cl_set_act_visible("confirmed",FALSE)
               END IF
         
            WHEN "R"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
               CALL cl_set_act_visible("confirmed,unconfirmed,hold",FALSE)
         
            WHEN "D"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
               CALL cl_set_act_visible("confirmed,unconfirmed,hold",FALSE) 
             
            WHEN "X"
               CALL cl_set_act_visible("unconfirmed,invalid,confirmed,hold",FALSE)
         
            WHEN "Y"
               CALL cl_set_act_visible("invalid,confirmed,hold",FALSE)
            
            WHEN "W"    #只能顯示抽單;其餘應用功能皆隱藏
                CALL cl_set_act_visible("withdraw",TRUE)  
                CALL cl_set_act_visible("unconfirmed,invalid,confirmed,hold",FALSE)
            
            WHEN "A"     #只能顯示確認; 其餘應用功能皆隱藏
                CALL cl_set_act_visible("confirmed ",TRUE)  
                CALL cl_set_act_visible("unconfirmed,invalid,hold",FALSE)
         
         END CASE
]]>
</point>
  <point name="statechange.define" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_imae120 LIKE imae_t.imae120]]>
</point>
  <point name="ui_dialog.before_dialog2" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[            LET g_lot_ins_flag = 'N']]>
</point>
  <point name="ui_dialog.body2.before_row" order="" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #CALL aqct300_b_fill2('6') #160607-00004#1 mark
               CALL aqct300_b_fill2('99') #160607-00004#1 add
               LET g_lot_ins_flag = 'N']]>
</point>
  <point name="ui_dialog.body4.before_row" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               LET g_lot_ins_flag = 'N']]>
</point>
  <point name="ui_dialog.body5.before_row" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               LET g_lot_ins_flag = 'Y']]>
</point>
  <point name="ui_dialog.body7.before_row" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               LET g_lot_ins_flag = 'N']]>
</point>
  <point name="ui_dialog.define" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   DEFINE l_qcan015 LIKE qcan_t.qcan015
   DEFINE l_slip     LIKE oobal_t.oobal002
   DEFINE l_prog     LIKE oobx_t.oobx004]]>
</point>
  <point name="ui_dialog.more_action" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[         #161031-00025#16 add(s)
         ON ACTION remarks_page
            LET g_detail_id = "remarks_page"
            NEXT FIELD ooff012
         #161031-00025#16 add(e)]]>
</point>
  <point name="ui_dialog.more_displayarray" order="" ver="38" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[         #DISPLAY ARRAY g_qcbd6_d TO s_detail6.* ATTRIBUTES(COUNT=g_rec_b) #page1  #160607-00004#1 mark
         DISPLAY ARRAY g_qcbd99_d TO s_detail99.* ATTRIBUTES(COUNT=g_rec_b) #page1 #160607-00004#1 add
    
            BEFORE ROW
               CALL aqct300_idx_chk()
               #LET l_ac = DIALOG.getCurrentRow("s_detail6") #160607-00004#1 mark
               LET l_ac = DIALOG.getCurrentRow("s_detail99") #160607-00004#1 add
               LET g_detail_idx = l_ac
               IF g_detail_idx > 0 THEN
                  CALL aqct300_get_qcan015(g_qcbd_d[g_detail_idx].qcbdseq) RETURNING l_qcan015
               END IF
               CALL cl_set_comp_visible("bpage_4",TRUE)
               IF l_qcan015 = '1' OR cl_null(l_qcan015) THEN
                  CALL cl_set_comp_visible("bpage_4",FALSE)
               END IF
               #add-point:page1, before row動作
               CALL aqct300_b_fill2('4')
               CALL aqct300_b_fill2('5')
 
               #add-point:page1, before row動作
               #CALL aqct300_b_fill2('6') #160607-00004#1 mark
               CALL aqct300_b_fill2('99') #160607-00004#1 add
               #end add-point
               
            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               #160607-00004#1 --s mark 
               #LET l_ac = DIALOG.getCurrentRow("s_detail6") 
               #CALL aqct300_detail6_idx_chk() 
               #LET g_current_page = 6 
               #160607-00004#1 --e mark 
               #160607-00004#1 --s add
               LET l_ac = DIALOG.getCurrentRow("s_detail99") 
               CALL aqct300_detail99_idx_chk()
               LET g_current_page = 99 
               #160607-00004#1 --e add
               
               
               
            #自訂ACTION(detail_show,page_6)
            
               
            #add-point:page6自定義行為

            #end add-point
               
         END DISPLAY
         
         DISPLAY ARRAY g_qcbd3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               CALL aqct300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_detail_idx3 = l_ac
               
               #add-point:page2, before row動作

               #end add-point
               
            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_current_page = 5
               CALL aqct300_idx_chk()
               #add-point:page2自定義行為

               #end add-point
      
            #自訂ACTION(detail_show,page_2)
            
         
            #add-point:page2自定義行為

            #end add-point
         
         END DISPLAY
         SUBDIALOG sub_s_lot.s_lot_display
         SUBDIALOG aoo_aooi360_01.aooi360_01_display #161031-00025#16 add]]>
</point>
  <point name="ui_dialog.page1.before_row" order="" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[               #CALL aqct300_b_fill2('6') #160607-00004#1 mark
               CALL aqct300_b_fill2('99') #160607-00004#1 add
               IF g_detail_idx > 0 THEN
                  CALL aqct300_get_qcan015(g_qcbd_d[g_detail_idx].qcbdseq) RETURNING l_qcan015
               END IF
               CALL cl_set_comp_visible("bpage_4",TRUE)
               IF l_qcan015 = '1' OR cl_null(l_qcan015) THEN
                  CALL cl_set_comp_visible("bpage_4",FALSE)
               END IF
               LET g_lot_ins_flag = 'N']]>
</point>
  <point name="unlock_b.other" order="" ver="37" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #LET ls_group = "'6'," #160607-00004#1 mark
   LET ls_group = "'99'," #160607-00004#1 add
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      #CLOSE aqct300_bcl6 #160607-00004#1 mark
      CLOSE aqct300_bcl99 #160607-00004#1 add
   END IF
   
   #170105-00062#1 add(s)
   LET ls_group = "'6',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE aqct300_bcl6
   END IF
   #170105-00062#1 add(e)]]>
</point>
  <point name="update_b.after_update4" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[
      UPDATE qcbf_t 
         SET (qcbfdocno,qcbfseq,qcbf001) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]) 
         WHERE qcbfent = g_enterprise AND qcbfdocno = ps_keys_bak[1] AND qcbfseq = ps_keys_bak[2] AND qcbf001 = ps_keys_bak[3]
      #add-point:update_b段修改中

      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = "std-00009"
            LET g_errparam.extend = "qcbf_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()

            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "qcbf_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()
  
            CALL s_transaction_end('N','0')
         OTHERWISE
            
      END CASE]]>
</point>
  <point name="update_b.key.after_update4" order="" ver="4" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[

      UPDATE qcbf_t 
         SET (qcbfdocno,qcbfseq) 
              = 
             (ps_keys[1],ps_keys[2]) 
         WHERE qcbfent = g_enterprise AND qcbfdocno = ps_keys_bak[1] AND qcbfseq = ps_keys_bak[2] 
      #add-point:update_b段修改中

      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = "std-00009"
            LET g_errparam.extend = "qcbf_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()

            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "qcbf_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()
  
            CALL s_transaction_end('N','0')
         OTHERWISE
            
      END CASE]]>
</point>
  <point name="update_b.other" order="" ver="15" cite_std="N" new="Y" ind_extra="N" ch="" status=" " src="s" readonly="" mark_hard="N">
<![CDATA[   #LET ls_group = "'6'," #160607-00004#1 mark
   LET ls_group = "'99'," #160607-00004#1 add
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "qcbf_t" THEN
      #add-point:update_b段修改前

      #end add-point     
      UPDATE qcbf_t 
         SET (qcbfdocno,qcbfseq,qcbf001,
              qcbf002,qcbf003
              ,qcbf004,qcbfsite) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4],ps_keys[5]
              ,g_qcbd3_d[g_detail_idx2].qcbf004,g_qcbd3_d[g_detail_idx2].qcbfsite) 
         WHERE qcbfent = g_enterprise AND qcbfdocno = ps_keys_bak[1] AND qcbfseq = ps_keys_bak[2] AND qcbf001 = ps_keys_bak[3] AND qcbf002 = ps_keys_bak[4] AND qcbf003 = ps_keys_bak[5]
      #add-point:update_b段修改中

      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = "std-00009"
            LET g_errparam.extend = "qcbf_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()

            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "qcbf_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()
  
            CALL s_transaction_end('N','0')
         OTHERWISE
            
      END CASE
      #add-point:update_b段修改後

      #end add-point  
   END IF]]>
</point>
  <section id="aqct300.description" ver="52" ch="" status="" src="s" readonly="">
<![CDATA[#應用 a00 樣板自動產生(Version:3)
#+ Standard Version.....: SD版次:0042(2017-02-13 10:21:13), PR版次:
#+ Customerized Version.: SD版次:0000(1900-01-01 00:00:00), PR版次:
#+ Build......: 000599
#+ Filename...: aqct300
#+ Description: 品質檢驗記錄維護作業
#+ Creator....: 01996(2013-11-25 15:39:15)
#+ Modifier...: 01996 -SD/PR-
]]>
</section>
  <section id="aqct300.global" ver="88" ch="" status="" src="s" readonly="">
<![CDATA[#應用 t01 樣板自動產生(Version:79)
#add-point:填寫註解說明 name="global.memo" 
{<point name="global.memo" edit="s"/>}
#end add-point
#add-point:填寫註解說明(客製用) name="global.memo_customerization"
{<point name="global.memo_customerization" edit="c"/>}
#end add-point
 
IMPORT os
IMPORT util
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目 name="global.import"
{<point name="global.import"/>}
#end add-point 
 
SCHEMA ds 
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔 name="global.inc"
{<point name="global.inc" mark="Y"/>}
#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_qcba_m        RECORD
       qcbadocno LIKE qcba_t.qcbadocno, 
   qcbadocdt LIKE qcba_t.qcbadocdt, 
   qcba900 LIKE qcba_t.qcba900, 
   qcba900_desc LIKE type_t.chr80, 
   qcbadocno_desc LIKE type_t.chr80, 
   qcba000 LIKE qcba_t.qcba000, 
   qcba031 LIKE qcba_t.qcba031, 
   qcba901 LIKE qcba_t.qcba901, 
   qcba901_desc LIKE type_t.chr80, 
   qcbasite LIKE qcba_t.qcbasite, 
   qcba032 LIKE qcba_t.qcba032, 
   qcbastus LIKE qcba_t.qcbastus, 
   qcba001 LIKE qcba_t.qcba001, 
   qcba002 LIKE qcba_t.qcba002, 
   qcba029 LIKE qcba_t.qcba029, 
   qcba003 LIKE qcba_t.qcba003, 
   qcba004 LIKE qcba_t.qcba004, 
   qcba005 LIKE qcba_t.qcba005, 
   qcba005_desc LIKE type_t.chr80, 
   qcba006 LIKE qcba_t.qcba006, 
   qcba007 LIKE qcba_t.qcba007, 
   qcba008 LIKE qcba_t.qcba008, 
   qcba009 LIKE qcba_t.qcba009, 
   qcba009_desc LIKE type_t.chr80, 
   qcba017 LIKE qcba_t.qcba017, 
   qcba010 LIKE qcba_t.qcba010, 
   qcba012 LIKE qcba_t.qcba012, 
   qcba012_desc LIKE type_t.chr80, 
   imaal003 LIKE type_t.chr500, 
   imaal004 LIKE type_t.chr500, 
   qcba013 LIKE qcba_t.qcba013, 
   qcba013_desc LIKE type_t.chr80, 
   qcba020 LIKE qcba_t.qcba020, 
   qcba021 LIKE qcba_t.qcba021, 
   qcba030 LIKE qcba_t.qcba030, 
   qcba024 LIKE qcba_t.qcba024, 
   qcba024_desc LIKE type_t.chr80, 
   qcba016 LIKE qcba_t.qcba016, 
   qcba016_desc LIKE type_t.chr80, 
   qcba022 LIKE qcba_t.qcba022, 
   qcba023 LIKE qcba_t.qcba023, 
   qcba027 LIKE qcba_t.qcba027, 
   imae116 LIKE type_t.chr500, 
   qcba018 LIKE qcba_t.qcba018, 
   qcba019 LIKE qcba_t.qcba019, 
   qcba014 LIKE qcba_t.qcba014, 
   qcba015 LIKE qcba_t.qcba015, 
   qcba028 LIKE qcba_t.qcba028, 
   qcba025 LIKE qcba_t.qcba025, 
   qcba026 LIKE qcba_t.qcba026, 
   qcba033 LIKE qcba_t.qcba033, 
   qcbaownid LIKE qcba_t.qcbaownid, 
   qcbaownid_desc LIKE type_t.chr80, 
   qcbaowndp LIKE qcba_t.qcbaowndp, 
   qcbaowndp_desc LIKE type_t.chr80, 
   qcbacrtid LIKE qcba_t.qcbacrtid, 
   qcbacrtid_desc LIKE type_t.chr80, 
   qcbacrtdp LIKE qcba_t.qcbacrtdp, 
   qcbacrtdp_desc LIKE type_t.chr80, 
   qcbacrtdt LIKE qcba_t.qcbacrtdt, 
   qcbamodid LIKE qcba_t.qcbamodid, 
   qcbamodid_desc LIKE type_t.chr80, 
   qcbamoddt LIKE qcba_t.qcbamoddt, 
   qcbacnfid LIKE qcba_t.qcbacnfid, 
   qcbacnfid_desc LIKE type_t.chr80, 
   qcbacnfdt LIKE qcba_t.qcbacnfdt
       END RECORD
 
#單身 type 宣告
PRIVATE TYPE type_g_qcbd_d        RECORD
       qcbdseq LIKE qcbd_t.qcbdseq, 
   qcbd001 LIKE qcbd_t.qcbd001, 
   qcbd001_desc LIKE type_t.chr500, 
   qcbd002 LIKE qcbd_t.qcbd002, 
   qcbd003 LIKE qcbd_t.qcbd003, 
   qcbd020 LIKE qcbd_t.qcbd020, 
   qcbd004 LIKE qcbd_t.qcbd004, 
   qcbd005 LIKE qcbd_t.qcbd005, 
   qcbd006 LIKE qcbd_t.qcbd006, 
   qcbd007 LIKE qcbd_t.qcbd007, 
   qcbd008 LIKE qcbd_t.qcbd008, 
   qcbd009 LIKE qcbd_t.qcbd009, 
   qcbd010 LIKE qcbd_t.qcbd010, 
   qcbd021 LIKE qcbd_t.qcbd021, 
   qcbd011 LIKE qcbd_t.qcbd011, 
   qcbdsite LIKE qcbd_t.qcbdsite, 
   ooff013 LIKE type_t.chr500
       END RECORD
PRIVATE TYPE type_g_qcbd2_d RECORD
       qcbe001 LIKE qcbe_t.qcbe001, 
   qcbe001_desc LIKE type_t.chr500, 
   qcbe002 LIKE qcbe_t.qcbe002, 
   qcbe004 LIKE qcbe_t.qcbe004, 
   qcbe003 LIKE qcbe_t.qcbe003, 
   qcbesite LIKE qcbe_t.qcbesite
       END RECORD
PRIVATE TYPE type_g_qcbd4_d RECORD
       qcbb001 LIKE qcbb_t.qcbb001, 
   qcbb002 LIKE qcbb_t.qcbb002, 
   qcbb003 LIKE qcbb_t.qcbb003, 
   qcbb004 LIKE qcbb_t.qcbb004, 
   qcbb005 LIKE qcbb_t.qcbb005, 
   qcbb006 LIKE qcbb_t.qcbb006, 
   qcbbsite LIKE qcbb_t.qcbbsite
       END RECORD
PRIVATE TYPE type_g_qcbd5_d RECORD
       qcbcseq LIKE qcbc_t.qcbcseq, 
   qcbc001 LIKE qcbc_t.qcbc001, 
   qcbc002 LIKE qcbc_t.qcbc002, 
   qcbc002_desc LIKE type_t.chr500, 
   qcbc012 LIKE qcbc_t.qcbc012, 
   qcbc013 LIKE qcbc_t.qcbc013, 
   qcbc003 LIKE qcbc_t.qcbc003, 
   qcbc003_desc LIKE type_t.chr500, 
   qcbc003_desc_desc LIKE type_t.chr500, 
   qcbc004 LIKE qcbc_t.qcbc004, 
   qcbc004_desc LIKE type_t.chr500, 
   qcbc005 LIKE qcbc_t.qcbc005, 
   qcbc005_desc LIKE type_t.chr500, 
   qcbc006 LIKE qcbc_t.qcbc006, 
   qcbc006_desc LIKE type_t.chr500, 
   qcbc007 LIKE qcbc_t.qcbc007, 
   qcbc008 LIKE qcbc_t.qcbc008, 
   qcbc008_desc LIKE type_t.chr500, 
   qcbc009 LIKE qcbc_t.qcbc009, 
   qcbc010 LIKE qcbc_t.qcbc010, 
   qcbc011 LIKE qcbc_t.qcbc011, 
   qcbcsite LIKE qcbc_t.qcbcsite
       END RECORD
PRIVATE TYPE type_g_qcbd7_d RECORD
       qcbg001 LIKE type_t.num10, 
   qcbg002 LIKE type_t.num20_6, 
   qcbg003 LIKE type_t.chr1, 
   qcbgsite LIKE qcbg_t.qcbgsite
       END RECORD
 
 
PRIVATE TYPE type_browser RECORD
         b_statepic     LIKE type_t.chr50,
            b_qcbadocno LIKE qcba_t.qcbadocno,
   b_qcbadocno_desc LIKE type_t.chr80,
      b_qcbadocdt LIKE qcba_t.qcbadocdt,
      b_qcbasite LIKE qcba_t.qcbasite,
      b_qcba000 LIKE qcba_t.qcba000,
      b_qcba900 LIKE qcba_t.qcba900,
   b_qcba900_desc LIKE type_t.chr80,
      b_qcba901 LIKE qcba_t.qcba901,
   b_qcba901_desc LIKE type_t.chr80
       END RECORD
       
#add-point:自定義模組變數(Module Variable) (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="global.variable"
{<point name="global.variable"/>} 
#end add-point
       
#模組變數(Module Variables)
DEFINE g_qcba_m          type_g_qcba_m
DEFINE g_qcba_m_t        type_g_qcba_m
DEFINE g_qcba_m_o        type_g_qcba_m
DEFINE g_qcba_m_mask_o   type_g_qcba_m #轉換遮罩前資料
DEFINE g_qcba_m_mask_n   type_g_qcba_m #轉換遮罩後資料
 
   DEFINE g_qcbadocno_t LIKE qcba_t.qcbadocno
 
 
DEFINE g_qcbd_d          DYNAMIC ARRAY OF type_g_qcbd_d
DEFINE g_qcbd_d_t        type_g_qcbd_d
DEFINE g_qcbd_d_o        type_g_qcbd_d
DEFINE g_qcbd_d_mask_o   DYNAMIC ARRAY OF type_g_qcbd_d #轉換遮罩前資料
DEFINE g_qcbd_d_mask_n   DYNAMIC ARRAY OF type_g_qcbd_d #轉換遮罩後資料
DEFINE g_qcbd2_d          DYNAMIC ARRAY OF type_g_qcbd2_d
DEFINE g_qcbd2_d_t        type_g_qcbd2_d
DEFINE g_qcbd2_d_o        type_g_qcbd2_d
DEFINE g_qcbd2_d_mask_o   DYNAMIC ARRAY OF type_g_qcbd2_d #轉換遮罩前資料
DEFINE g_qcbd2_d_mask_n   DYNAMIC ARRAY OF type_g_qcbd2_d #轉換遮罩後資料
DEFINE g_qcbd4_d          DYNAMIC ARRAY OF type_g_qcbd4_d
DEFINE g_qcbd4_d_t        type_g_qcbd4_d
DEFINE g_qcbd4_d_o        type_g_qcbd4_d
DEFINE g_qcbd4_d_mask_o   DYNAMIC ARRAY OF type_g_qcbd4_d #轉換遮罩前資料
DEFINE g_qcbd4_d_mask_n   DYNAMIC ARRAY OF type_g_qcbd4_d #轉換遮罩後資料
DEFINE g_qcbd5_d          DYNAMIC ARRAY OF type_g_qcbd5_d
DEFINE g_qcbd5_d_t        type_g_qcbd5_d
DEFINE g_qcbd5_d_o        type_g_qcbd5_d
DEFINE g_qcbd5_d_mask_o   DYNAMIC ARRAY OF type_g_qcbd5_d #轉換遮罩前資料
DEFINE g_qcbd5_d_mask_n   DYNAMIC ARRAY OF type_g_qcbd5_d #轉換遮罩後資料
DEFINE g_qcbd7_d          DYNAMIC ARRAY OF type_g_qcbd7_d
DEFINE g_qcbd7_d_t        type_g_qcbd7_d
DEFINE g_qcbd7_d_o        type_g_qcbd7_d
DEFINE g_qcbd7_d_mask_o   DYNAMIC ARRAY OF type_g_qcbd7_d #轉換遮罩前資料
DEFINE g_qcbd7_d_mask_n   DYNAMIC ARRAY OF type_g_qcbd7_d #轉換遮罩後資料
 
 
DEFINE g_browser         DYNAMIC ARRAY OF type_browser
DEFINE g_browser_f       DYNAMIC ARRAY OF type_browser
 
 
DEFINE g_wc                  STRING
DEFINE g_wc_t                STRING
DEFINE g_wc2                 STRING                          #單身CONSTRUCT結果
DEFINE g_wc2_table1          STRING
DEFINE g_wc2_table2   STRING
 
DEFINE g_wc2_table3   STRING
 
 
DEFINE g_wc2_table4   STRING
 
DEFINE g_wc2_table5   STRING
 
 
DEFINE g_wc2_extend          STRING
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING
 
DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10     
DEFINE g_jump                LIKE type_t.num10        
DEFINE g_no_ask              LIKE type_t.num5        
DEFINE g_rec_b               LIKE type_t.num10           
DEFINE l_ac                  LIKE type_t.num10    
DEFINE g_curr_diag           ui.Dialog                         #Current Dialog
                                                               
DEFINE g_pagestart           LIKE type_t.num10                 
DEFINE gwin_curr             ui.Window                         #Current Window
DEFINE gfrm_curr             ui.Form                           #Current Form
DEFINE g_page_action         STRING                            #page action
DEFINE g_header_hidden       LIKE type_t.num5                  #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5                  #隱藏工作Panel
DEFINE g_page                STRING                            #第幾頁
DEFINE g_state               STRING       
DEFINE g_header_cnt          LIKE type_t.num10
DEFINE g_detail_cnt          LIKE type_t.num10                  #單身總筆數
DEFINE g_detail_idx          LIKE type_t.num10                  #單身目前所在筆數
DEFINE g_detail_idx_tmp      LIKE type_t.num10                  #單身目前所在筆數
DEFINE g_detail_idx2         LIKE type_t.num10                  #單身2目前所在筆數
DEFINE g_detail_idx_list     DYNAMIC ARRAY OF LIKE type_t.num10 #單身2目前所在筆數
DEFINE g_browser_cnt         LIKE type_t.num10                  #Browser總筆數
DEFINE g_browser_idx         LIKE type_t.num10                  #Browser目前所在筆數
DEFINE g_temp_idx            LIKE type_t.num10                  #Browser目前所在筆數(暫存用)
DEFINE g_order               STRING                             #查詢排序欄位
                                                        
DEFINE g_current_row         LIKE type_t.num10                  #Browser所在筆數
DEFINE g_current_sw          BOOLEAN                            #Browser所在筆數用開關
DEFINE g_current_page        LIKE type_t.num10                  #目前所在頁數
DEFINE g_insert              LIKE type_t.chr5                   #是否導到其他page
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys               DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak           DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_bfill               LIKE type_t.chr5              #是否刷新單身
DEFINE g_error_show          LIKE type_t.num5              #是否顯示筆數提示訊息
DEFINE g_master_insert       BOOLEAN                       #確認單頭資料是否寫入
 
DEFINE g_wc_frozen           STRING                        #凍結欄位使用
DEFINE g_chk                 BOOLEAN                       #助記碼判斷用
DEFINE g_aw                  STRING                        #確定當下點擊的單身
DEFINE g_default             BOOLEAN                       #是否有外部參數查詢
DEFINE g_log1                STRING                        #log用
DEFINE g_log2                STRING                        #log用
DEFINE g_loc                 LIKE type_t.chr5              #判斷游標所在位置
DEFINE g_add_browse          STRING                        #新增填充用WC
DEFINE g_update              BOOLEAN                       #確定單頭/身是否異動過
DEFINE g_idx_group           om.SaxAttributes              #頁籤群組
DEFINE g_master_commit       LIKE type_t.chr1              #確認單頭是否修改過
 
#add-point:自定義客戶專用模組變數(Module Variable) name="global.variable_customerization"
{<point name="global.variable_customerization" edit="c"/>}
#end add-point
 
#add-point:傳入參數說明(global.argv) name="global.argv"
{<point name="global.argv"/>}
#end add-point
]]>
</section>
  <section id="aqct300.main" ver="35" ch="" status="" src="s" readonly="">
<![CDATA[#應用 a26 樣板自動產生(Version:7)
#+ 作業開始(主程式類型)
MAIN
   #add-point:main段define(客製用) name="main.define_customerization"
   {<point name="main.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   #add-point:main段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="main.define"
   {<point name="main.define"/>}
   #end add-point   
   
   OPTIONS
   INPUT NO WRAP
   DEFER INTERRUPT
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
       
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("aqc","")
 
   #add-point:作業初始化 name="main.init"
   {<point name="main.init" />}
   #end add-point
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define name="main.define_sql"
   {<point name="main.define_sql" />}
   #end add-point
   LET g_forupd_sql = " SELECT qcbadocno,qcbadocdt,qcba900,'','',qcba000,qcba031,qcba901,'',qcbasite, 
       qcba032,qcbastus,qcba001,qcba002,qcba029,qcba003,qcba004,qcba005,'',qcba006,qcba007,qcba008,qcba009, 
       '',qcba017,qcba010,qcba012,'','','',qcba013,'',qcba020,qcba021,qcba030,qcba024,'',qcba016,'', 
       qcba022,qcba023,qcba027,'',qcba018,qcba019,qcba014,qcba015,qcba028,qcba025,qcba026,qcba033,qcbaownid, 
       '',qcbaowndp,'',qcbacrtid,'',qcbacrtdp,'',qcbacrtdt,qcbamodid,'',qcbamoddt,qcbacnfid,'',qcbacnfdt", 
        
                      " FROM qcba_t",
                      " WHERE qcbaent= ? AND qcbadocno=? FOR UPDATE"
   #add-point:SQL_define name="main.after_define_sql"
   {<point name="main.after_define_sql"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)                #轉換不同資料庫語法
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_cl CURSOR FROM g_forupd_sql                 # LOCK CURSOR
 
   LET g_sql = " SELECT DISTINCT t0.qcbadocno,t0.qcbadocdt,t0.qcba900,t0.qcba000,t0.qcba031,t0.qcba901, 
       t0.qcbasite,t0.qcba032,t0.qcbastus,t0.qcba001,t0.qcba002,t0.qcba029,t0.qcba003,t0.qcba004,t0.qcba005, 
       t0.qcba006,t0.qcba007,t0.qcba008,t0.qcba009,t0.qcba017,t0.qcba010,t0.qcba012,t0.qcba013,t0.qcba020, 
       t0.qcba021,t0.qcba030,t0.qcba024,t0.qcba016,t0.qcba022,t0.qcba023,t0.qcba027,t0.qcba018,t0.qcba019, 
       t0.qcba014,t0.qcba015,t0.qcba028,t0.qcba025,t0.qcba026,t0.qcba033,t0.qcbaownid,t0.qcbaowndp,t0.qcbacrtid, 
       t0.qcbacrtdp,t0.qcbacrtdt,t0.qcbamodid,t0.qcbamoddt,t0.qcbacnfid,t0.qcbacnfdt,t1.ooag011 ,t2.ooefl003 , 
       t3.pmaal004 ,t4.oocal003 ,t5.oocql004 ,t6.ooag011 ,t7.oocal003 ,t8.ooag011 ,t9.ooefl003 ,t10.ooag011 , 
       t11.ooefl003 ,t12.ooag011 ,t13.ooag011",
               " FROM qcba_t t0",
                              " LEFT JOIN ooag_t t1 ON t1.ooagent="||g_enterprise||" AND t1.ooag001=t0.qcba900  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.qcba901 AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t3 ON t3.pmaalent="||g_enterprise||" AND t3.pmaal001=t0.qcba005 AND t3.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t4 ON t4.oocalent="||g_enterprise||" AND t4.oocal001=t0.qcba009 AND t4.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t5 ON t5.oocqlent="||g_enterprise||" AND t5.oocql001='205' AND t5.oocql002=t0.qcba013 AND t5.oocql003='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t6 ON t6.ooagent="||g_enterprise||" AND t6.ooag001=t0.qcba024  ",
               " LEFT JOIN oocal_t t7 ON t7.oocalent="||g_enterprise||" AND t7.oocal001=t0.qcba016 AND t7.oocal002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t8 ON t8.ooagent="||g_enterprise||" AND t8.ooag001=t0.qcbaownid  ",
               " LEFT JOIN ooefl_t t9 ON t9.ooeflent="||g_enterprise||" AND t9.ooefl001=t0.qcbaowndp AND t9.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t10 ON t10.ooagent="||g_enterprise||" AND t10.ooag001=t0.qcbacrtid  ",
               " LEFT JOIN ooefl_t t11 ON t11.ooeflent="||g_enterprise||" AND t11.ooefl001=t0.qcbacrtdp AND t11.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t12 ON t12.ooagent="||g_enterprise||" AND t12.ooag001=t0.qcbamodid  ",
               " LEFT JOIN ooag_t t13 ON t13.ooagent="||g_enterprise||" AND t13.ooag001=t0.qcbacnfid  ",
 
               " WHERE t0.qcbaent = " ||g_enterprise|| " AND t0.qcbadocno = ?"
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   #add-point:SQL_define name="main.after_refresh_sql"
   {<point name="main.after_refresh_sql"/>}
   #end add-point
   PREPARE aqct300_master_referesh FROM g_sql
 
    
 
   
   IF g_bgjob = "Y" THEN
      #add-point:Service Call name="main.servicecall"
      {<point name="main.servicecall" />}
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_aqct300 WITH FORM cl_ap_formpath("aqc",g_code)
   
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
   
      #程式初始化
      CALL aqct300_init()   
 
      #進入選單 Menu (="N")
      CALL aqct300_ui_dialog() 
      
      #add-point:畫面關閉前 name="main.before_close"
      {<point name="main.before_close" />}
      #end add-point
 
      #畫面關閉
      CLOSE WINDOW w_aqct300
      
   END IF 
   
   CLOSE aqct300_cl
   
   
 
   #add-point:作業離開前 name="main.exit"
   {<point name="main.exit" />}
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
END MAIN
 
 
 
]]>
</section>
  <section id="aqct300.init" ver="17" ch="" status="" src="s" readonly="">
<![CDATA[#+ 瀏覽頁簽資料初始化
PRIVATE FUNCTION aqct300_init()
   #add-point:init段define(客製用) name="init.define_customerization"
   {<point name="init.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   #add-point:init段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="init.define"
   {<point name="init.define"/>} 
   #end add-point   
   
   #add-point:Function前置處理  name="init.pre_function"
   {<point name="init.pre_function"/>}
   #end add-point
   
   LET g_bfill       = "Y"
   LET g_detail_idx  = 1 #第一層單身指標
   LET g_detail_idx2 = 1 #第二層單身指標
   
   #各個page指標
   LET g_detail_idx_list[1] = 1 
   LET g_detail_idx_list[2] = 1
   LET g_detail_idx_list[3] = 1
   LET g_detail_idx_list[4] = 1
   LET g_detail_idx_list[5] = 1
 
   LET g_error_show  = 1
   LET l_ac = 1 #單身指標
      CALL cl_set_combo_scc_part('qcbastus','13','N,Y,A,D,R,W,X')
 
      CALL cl_set_combo_scc('qcba000','5056') 
   CALL cl_set_combo_scc('qcba031','5060') 
   CALL cl_set_combo_scc('qcba021','5074') 
   CALL cl_set_combo_scc('qcba022','5072') 
   CALL cl_set_combo_scc('qcba018','5051') 
   CALL cl_set_combo_scc('qcba019','5053') 
   CALL cl_set_combo_scc('qcbd003','5057') 
   CALL cl_set_combo_scc('qcbd020','5058') 
   CALL cl_set_combo_scc('qcbd011','5073') 
   CALL cl_set_combo_scc('qcbb006','5073') 
   CALL cl_set_combo_scc('qcbc001','1002') 
   CALL cl_set_combo_scc('qcbc012','5070') 
   CALL cl_set_combo_scc('qcbc013','5071') 
 
   LET gwin_curr = ui.Window.getCurrent()  #取得現行畫面
   LET gfrm_curr = gwin_curr.getForm()     #取出物件化後的畫面物件
   
   #page群組
   LET g_idx_group = om.SaxAttributes.create()
   CALL g_idx_group.addAttribute("'1',","1")
   CALL g_idx_group.addAttribute("'3',","1")
   CALL g_idx_group.addAttribute("'4',","1")
   CALL g_idx_group.addAttribute("'2',","1")
   CALL g_idx_group.addAttribute("'5',","1")
 
 
   #add-point:畫面資料初始化 name="init.init"
   {<point name="init.init"/>}
   #end add-point
   
   #初始化搜尋條件
   CALL aqct300_default_search()
    
END FUNCTION
]]>
</section>
  <section id="aqct300.ui_dialog" ver="76" ch="" status="" src="s" readonly="">
<![CDATA[#+ 功能選單
PRIVATE FUNCTION aqct300_ui_dialog()
   #add-point:ui_dialog段define(客製用) name="ui_dialog.define_customerization"
   {<point name="ui_dialog.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   DEFINE li_idx     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE lb_first   BOOLEAN
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE la_param   RECORD
          prog       STRING,
          actionid   STRING,
          background LIKE type_t.chr1,
          param      DYNAMIC ARRAY OF STRING
          END RECORD
   DEFINE ls_js      STRING
   DEFINE la_output  DYNAMIC ARRAY OF STRING   #報表元件鬆耦合使用
   DEFINE  l_cmd_token           base.StringTokenizer   #報表作業cmdrun使用 
   DEFINE  l_cmd_next            STRING                 #報表作業cmdrun使用
   DEFINE  l_cmd_cnt             LIKE type_t.num5       #報表作業cmdrun使用
   DEFINE  l_cmd_prog_arg        STRING                 #報表作業cmdrun使用
   DEFINE  l_cmd_arg             STRING                 #報表作業cmdrun使用
   #add-point:ui_dialog段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_dialog.define"
   {<point name="ui_dialog.define"/>} 
   #end add-point
   
   #add-point:Function前置處理  name="ui_dialog.pre_function"
   {<point name="ui_dialog.pre_function"/>}
   #end add-point
   
   CALL cl_set_act_visible("accept,cancel", FALSE)
 
   #因應查詢方案進行處理
   IF g_default THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   ELSE
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF
   
   #action default動作
   #應用 a42 樣板自動產生(Version:3)
   #進入程式時預設執行的動作
   CASE g_actdefault
      WHEN "insert"
         LET g_action_choice="insert"
         LET g_actdefault = ""
         IF cl_auth_chk_act("insert") THEN
            CALL aqct300_insert()
            #add-point:ON ACTION insert name="menu.default.insert"
            {<point name="menu.default.insert" />}
            #END add-point
         END IF
 
      #add-point:action default自訂 name="ui_dialog.action_default"
      {<point name="ui_dialog.action_default"/>}
      #end add-point
      OTHERWISE
   END CASE
 
 
 
   
   LET lb_first = TRUE
   
   #add-point:ui_dialog段before dialog  name="ui_dialog.before_dialog"
   {<point name="ui_dialog.before_dialog"/>}
   #end add-point
   
   WHILE TRUE 
   
      IF g_action_choice = "logistics" THEN
         #清除畫面及相關資料
         CLEAR FORM
         CALL g_browser.clear()       
         INITIALIZE g_qcba_m.* TO NULL
         CALL g_qcbd_d.clear()
         CALL g_qcbd2_d.clear()
         CALL g_qcbd4_d.clear()
         CALL g_qcbd5_d.clear()
         CALL g_qcbd7_d.clear()
 
         LET g_wc  = ' 1=2'
         LET g_wc2 = ' 1=1'
         LET g_action_choice = ""
         CALL aqct300_init()
      END IF
   
      CALL lib_cl_dlg.cl_dlg_before_display()
            
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
         #左側瀏覽頁簽
         DISPLAY ARRAY g_browser TO s_browse.* ATTRIBUTES(COUNT=g_header_cnt)
            BEFORE ROW
               #回歸舊筆數位置 (回到當時異動的筆數)
               LET g_current_idx = DIALOG.getCurrentRow("s_browse")
               IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                  LET g_current_idx = g_current_row
               END IF
               LET g_current_row = g_current_idx #目前指標
               LET g_current_sw = TRUE
         
               IF g_current_idx > g_browser.getLength() THEN
                  LET g_current_idx = g_browser.getLength()
               END IF 
               
               CALL aqct300_fetch('') # reload data
               LET l_ac = 1
               CALL aqct300_ui_detailshow() #Setting the current row 
         
               CALL aqct300_idx_chk()
               #NEXT FIELD qcbdseq
         
               ON ACTION qbefield_user   #欄位隱藏設定 
                  LET g_action_choice="qbefield_user"
                  CALL cl_ui_qbefield_user()
         END DISPLAY
    
         DISPLAY ARRAY g_qcbd_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) #page1  
    
            BEFORE ROW
               #顯示單身筆數
               CALL aqct300_idx_chk()
               #確定當下選擇的筆數
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[1] = l_ac
               CALL g_idx_group.addAttribute("'1',",l_ac)
               CALL aqct300_b_fill2('4')
CALL aqct300_b_fill2('5')
 
               #add-point:page1, before row動作 name="ui_dialog.page1.before_row"
               {<point name="ui_dialog.page1.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'1',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_current_page = 1
               #顯示單身筆數
               CALL aqct300_idx_chk()
               #add-point:page1自定義行為 name="ui_dialog.page1.before_display"
               {<point name="ui_dialog.page1.before_display"/>}
               #end add-point
               
            #自訂ACTION(detail_show,page_1)
            
               
            #add-point:page1自定義行為 name="ui_dialog.page1.action"
            {<point name="ui_dialog.page1.action"/>}
            #end add-point
               
         END DISPLAY
        
         #第一階單身段落
         DISPLAY ARRAY g_qcbd4_d TO s_detail4.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL aqct300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[3] = l_ac
               CALL g_idx_group.addAttribute("'4',",l_ac)
               
               #add-point:page3, before row動作 name="ui_dialog.body4.before_row"
               {<point name="ui_dialog.body4.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'4',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_current_page = 3
               #顯示單身筆數
               CALL aqct300_idx_chk()
               #add-point:page3自定義行為 name="ui_dialog.body4.before_display"
               {<point name="ui_dialog.body4.before_display"/>}
               #end add-point
      
            #自訂ACTION(detail_show,page_3)
            
         
            #add-point:page3自定義行為 name="ui_dialog.body4.action"
            {<point name="ui_dialog.body4.action"/>}
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_qcbd5_d TO s_detail5.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL aqct300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail5")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[4] = l_ac
               CALL g_idx_group.addAttribute("'2',",l_ac)
               
               #add-point:page4, before row動作 name="ui_dialog.body5.before_row"
               {<point name="ui_dialog.body5.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'2',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail5")
               LET g_current_page = 4
               #顯示單身筆數
               CALL aqct300_idx_chk()
               #add-point:page4自定義行為 name="ui_dialog.body5.before_display"
               {<point name="ui_dialog.body5.before_display"/>}
               #end add-point
      
            #自訂ACTION(detail_show,page_4)
            
         
            #add-point:page4自定義行為 name="ui_dialog.body5.action"
            {<point name="ui_dialog.body5.action"/>}
            #end add-point
         
         END DISPLAY
 
         
         #第二階單身段落
         DISPLAY ARRAY g_qcbd2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL aqct300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_detail_idx2 = l_ac
               LET g_detail_idx_list[2] = l_ac
               CALL g_idx_group.addAttribute("'3',",l_ac)
               
               #add-point:page2, before row動作 name="ui_dialog.body2.before_row"
               {<point name="ui_dialog.body2.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在下階單身則控制筆數位置
               IF g_loc = 'd' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'3',"))
               END IF
               LET g_loc = 'd'
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_current_page = 2
               #顯示單身筆數
               CALL aqct300_idx_chk()
               #add-point:page2自定義行為 name="ui_dialog.body2.before_display"
               {<point name="ui_dialog.body2.before_display"/>}
               #end add-point
      
            #自訂ACTION(detail_show,page_2)
            
         
            #add-point:page2自定義行為 name="ui_dialog.body2.action"
            {<point name="ui_dialog.body2.action"/>}
            #end add-point
         
         END DISPLAY
         #第二階單身段落
         DISPLAY ARRAY g_qcbd7_d TO s_detail7.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL aqct300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail7")
               LET g_detail_idx2 = l_ac
               LET g_detail_idx_list[5] = l_ac
               CALL g_idx_group.addAttribute("'5',",l_ac)
               
               #add-point:page5, before row動作 name="ui_dialog.body7.before_row"
               {<point name="ui_dialog.body7.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在下階單身則控制筆數位置
               IF g_loc = 'd' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'5',"))
               END IF
               LET g_loc = 'd'
               LET l_ac = DIALOG.getCurrentRow("s_detail7")
               LET g_current_page = 5
               #顯示單身筆數
               CALL aqct300_idx_chk()
               #add-point:page5自定義行為 name="ui_dialog.body7.before_display"
               {<point name="ui_dialog.body7.before_display"/>}
               #end add-point
      
            #自訂ACTION(detail_show,page_5)
            
         
            #add-point:page5自定義行為 name="ui_dialog.body7.action"
            {<point name="ui_dialog.body7.action"/>}
            #end add-point
         
         END DISPLAY
 
         
         #add-point:ui_dialog段自定義display array name="ui_dialog.more_displayarray"
         {<point name="ui_dialog.more_displayarray"/>}
         #end add-point
         
         SUBDIALOG lib_cl_dlg.cl_dlg_qryplan
         SUBDIALOG lib_cl_dlg.cl_dlg_relateapps
      
         BEFORE DIALOG
            #先填充browser資料
            CALL aqct300_browser_fill("")
            CALL cl_notice()
            CALL cl_navigator_setting(g_current_idx, g_detail_cnt)
            LET g_curr_diag = ui.DIALOG.getCurrent()
            LET g_current_sw = FALSE
            #回歸舊筆數位置 (回到當時異動的筆數)
            LET g_current_idx = DIALOG.getCurrentRow("s_browse")
            IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
               CALL DIALOG.setCurrentRow("s_browse",g_current_row)
               LET g_current_idx = g_current_row
            END IF
            
            #確保g_current_idx位於正常區間內
            #小於,等於0則指到第1筆
            IF g_current_idx <= 0 THEN
               LET g_current_idx = 1
            END IF
            #超過最大筆數則指到最後1筆
            IF g_current_idx > g_browser.getLength() THEN
               LEt g_current_idx = g_browser.getLength()
            END IF 
            
            LET g_current_sw = TRUE
            LET g_current_row = g_current_idx #目前指標
            
            #有資料才進行fetch
            IF g_current_idx <> 0 THEN
               CALL aqct300_fetch('') # reload data
            END IF
            #LET g_detail_idx = 1
            CALL aqct300_ui_detailshow() #Setting the current row 
            
            #筆數顯示
            LET g_current_page = 1
            CALL aqct300_idx_chk()
            CALL cl_ap_performance_cal()
            #add-point:ui_dialog段before_dialog2 name="ui_dialog.before_dialog2"
            {<point name="ui_dialog.before_dialog2"/>}
            #end add-point
 
         #add-point:ui_dialog段more_action name="ui_dialog.more_action"
         {<point name="ui_dialog.more_action"/>}
         #end add-point
 
         #狀態碼切換
         ON ACTION statechange
            LET g_action_choice = "statechange"
            CALL aqct300_statechange()
            #根據資料狀態切換action狀態
            CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
            CALL aqct300_set_act_visible()   
            CALL aqct300_set_act_no_visible()
            IF NOT (g_qcba_m.qcbadocno IS NULL
 
              ) THEN
               #組合條件
               LET g_add_browse = " qcbaent = " ||g_enterprise|| " AND",
                                  " qcbadocno = '", g_qcba_m.qcbadocno, "' "
 
               #填到對應位置
               CALL aqct300_browser_fill("")
            END IF
         #應用 a32 樣板自動產生(Version:3)
         #簽核狀況
         ON ACTION bpm_status
            #查詢簽核狀況, 統一建立HyperLink
            CALL cl_bpm_status()
            #add-point:ON ACTION bpm_status name="menu.bpm_status"
            {<point name="menu.bpm_status" />}
            #END add-point
 
 
 
          
         #查詢方案選擇 
         ON ACTION queryplansel
            CALL cl_dlg_qryplan_select() RETURNING ls_wc
            #不是空條件才寫入g_wc跟重新找資料
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
               INITIALIZE g_wc2_table3 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "qcba_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "qcbd_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "qcbb_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "qcbc_t" 
                        LET g_wc2_table3 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
                  OR NOT cl_null(g_wc2_table2)
 
                  OR NOT cl_null(g_wc2_table3)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  #組合g_wc2
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
                  IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
 
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
               END IF
               CALL aqct300_browser_fill("F")   #browser_fill()會將notice區塊清空
               CALL cl_notice()   #重新顯示,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            END IF
         
         #查詢方案選擇
         ON ACTION qbe_select
            CALL cl_qbe_list("m") RETURNING ls_wc
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
               INITIALIZE g_wc2_table3 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "qcba_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "qcbd_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "qcbb_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "qcbc_t" 
                        LET g_wc2_table3 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1)
                  OR NOT cl_null(g_wc2_table2)
 
                  OR NOT cl_null(g_wc2_table3)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
                  IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
                  #取得條件後需要重查、跳到結果第一筆資料的功能程式段
                  CALL aqct300_browser_fill("F")
                  IF g_browser_cnt = 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code = "-100" 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     CLEAR FORM
                  ELSE
                     CALL aqct300_fetch("F")
                  END IF
               END IF
            END IF
            #重新搜尋會將notice區塊清空,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            CALL cl_notice()
          
         #應用 a49 樣板自動產生(Version:4)
            #過濾瀏覽頁資料
            ON ACTION filter
               LET g_action_choice = "fetch"
               #add-point:filter action name="ui_dialog.action.filter"
               {<point name="ui_dialog.action.filter"/>}
               #end add-point
               CALL aqct300_filter()
               EXIT DIALOG
 
 
 
         
         ON ACTION first
            LET g_action_choice = "fetch"
            CALL aqct300_fetch('F')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aqct300_idx_chk()
            
         ON ACTION previous
            LET g_action_choice = "fetch"
            CALL aqct300_fetch('P')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aqct300_idx_chk()
            
         ON ACTION jump
            LET g_action_choice = "fetch"
            CALL aqct300_fetch('/')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aqct300_idx_chk()
            
         ON ACTION next
            LET g_action_choice = "fetch"
            CALL aqct300_fetch('N')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aqct300_idx_chk()
            
         ON ACTION last
            LET g_action_choice = "fetch"
            CALL aqct300_fetch('L')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aqct300_idx_chk()
          
         #excel匯出功能          
         ON ACTION exporttoexcel
            LET g_action_choice="exporttoexcel"
            IF cl_auth_chk_act("exporttoexcel") THEN
               #browser
               CALL g_export_node.clear()
               IF g_main_hidden = 1 THEN
                  LET g_export_node[1] = base.typeInfo.create(g_browser)
                  LET g_export_id[1]   = "s_browse"
                  CALL cl_export_to_excel()
               #非browser
               ELSE
                  LET g_export_node[1] = base.typeInfo.create(g_qcbd_d)
                  LET g_export_id[1]   = "s_detail1"
                  LET g_export_node[2] = base.typeInfo.create(g_qcbd2_d)
                  LET g_export_id[2]   = "s_detail2"
                  LET g_export_node[3] = base.typeInfo.create(g_qcbd4_d)
                  LET g_export_id[3]   = "s_detail4"
                  LET g_export_node[4] = base.typeInfo.create(g_qcbd5_d)
                  LET g_export_id[4]   = "s_detail5"
                  LET g_export_node[5] = base.typeInfo.create(g_qcbd7_d)
                  LET g_export_id[5]   = "s_detail7"
 
                  #add-point:ON ACTION exporttoexcel name="menu.exporttoexcel"
                  {<point name="menu.exporttoexcel" />}
                  #END add-point
                  CALL cl_export_to_excel_getpage()
                  CALL cl_export_to_excel()
               END IF
            END IF
        
         ON ACTION close
            LET INT_FLAG = FALSE
            LET g_action_choice = "exit"
            EXIT DIALOG
          
         ON ACTION exit
            LET g_action_choice = "exit"
            EXIT DIALOG
    
         #主頁摺疊
         ON ACTION mainhidden       
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
               CALL cl_notice()
            END IF
            
         #瀏覽頁折疊
         ON ACTION worksheethidden   
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF
            IF lb_first THEN
               LET lb_first = FALSE
               NEXT FIELD qcbdseq
            END IF
       
         #單頭摺疊，可利用hot key "Alt-s"開啟/關閉單頭
         ON ACTION controls     
            IF g_header_hidden THEN
               CALL gfrm_curr.setElementHidden("vb_master",0)
               CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
               LET g_header_hidden = 0     #visible
            ELSE
               CALL gfrm_curr.setElementHidden("vb_master",1)
               CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
               LET g_header_hidden = 1     #hidden     
            END IF
    
         
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL aqct300_modify()
               #add-point:ON ACTION modify name="menu.modify"
               {<point name="menu.modify" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify_detail
            LET g_action_choice="modify_detail"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = g_curr_diag.getCurrentItem()
               CALL aqct300_modify()
               #add-point:ON ACTION modify_detail name="menu.modify_detail"
               {<point name="menu.modify_detail" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL aqct300_delete()
               #add-point:ON ACTION delete name="menu.delete"
               {<point name="menu.delete" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL aqct300_insert()
               #add-point:ON ACTION insert name="menu.insert"
               {<point name="menu.insert" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output name="menu.output"
               {<point name="menu.output" mark="Y"/>}
               #END add-point
               &include "erp/aqc/aqct300_rep.4gl"
               #add-point:ON ACTION output.after name="menu.after_output"
               {<point name="menu.after_output" />}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION quickprint
            LET g_action_choice="quickprint"
            IF cl_auth_chk_act("quickprint") THEN
               
               #add-point:ON ACTION quickprint name="menu.quickprint"
               {<point name="menu.quickprint" mark="Y"/>}
               #END add-point
               &include "erp/aqc/aqct300_rep.4gl"
               #add-point:ON ACTION quickprint.after name="menu.after_quickprint"
               {<point name="menu.after_quickprint" />}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION special_purchase
            LET g_action_choice="special_purchase"
            IF cl_auth_chk_act("special_purchase") THEN
               
               #add-point:ON ACTION special_purchase name="menu.special_purchase"
               {<point name="menu.special_purchase" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL aqct300_query()
               #add-point:ON ACTION query name="menu.query"
               {<point name="menu.query" mark="Y"/>}
               #END add-point
               #應用 a59 樣板自動產生(Version:3)  
               CALL g_curr_diag.setCurrentRow("s_detail1",1)
               CALL g_curr_diag.setCurrentRow("s_detail2",1)
               CALL g_curr_diag.setCurrentRow("s_detail4",1)
               CALL g_curr_diag.setCurrentRow("s_detail5",1)
               CALL g_curr_diag.setCurrentRow("s_detail7",1)
 
 
 
 
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION un_special_purchase
            LET g_action_choice="un_special_purchase"
            IF cl_auth_chk_act("un_special_purchase") THEN
               
               #add-point:ON ACTION un_special_purchase name="menu.un_special_purchase"
               {<point name="menu.un_special_purchase" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION memo
            LET g_action_choice="memo"
            IF cl_auth_chk_act("memo") THEN
               
               #add-point:ON ACTION memo name="menu.memo"
               {<point name="menu.memo" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION s_lot_ins
            LET g_action_choice="s_lot_ins"
            IF cl_auth_chk_act("s_lot_ins") THEN
               
               #add-point:ON ACTION s_lot_ins name="menu.s_lot_ins"
               {<point name="menu.s_lot_ins" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION prog_qcba001
            LET g_action_choice="prog_qcba001"
            IF cl_auth_chk_act("prog_qcba001") THEN
               
               #add-point:ON ACTION prog_qcba001 name="menu.prog_qcba001"
               {<point name="menu.prog_qcba001" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION prog_qcba003
            LET g_action_choice="prog_qcba003"
            IF cl_auth_chk_act("prog_qcba003") THEN
               
               #add-point:ON ACTION prog_qcba003 name="menu.prog_qcba003"
               {<point name="menu.prog_qcba003" mark="Y"/>}
               #END add-point
               
            END IF
 
 
 
 
         
         #應用 a46 樣板自動產生(Version:3)
         #新增相關文件
         ON ACTION related_document
            CALL aqct300_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document name="ui_dialog.dialog.related_document"
               {<point name="ui_dialog.dialog.related_document"/>}
               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL aqct300_set_pk_array()
            #add-point:ON ACTION agendum name="ui_dialog.dialog.agendum"
            {<point name="ui_dialog.dialog.agendum"/>}
            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL aqct300_set_pk_array()
            #add-point:ON ACTION followup name="ui_dialog.dialog.followup"
            {<point name="ui_dialog.dialog.followup"/>}
            #END add-point
            CALL cl_user_overview_follow(g_qcba_m.qcbadocdt)
 
 
 
         
         #主選單用ACTION
         &include "main_menu_exit_dialog.4gl"
         &include "relating_action.4gl"
    
         #交談指令共用ACTION
         &include "common_action.4gl" 
            CONTINUE DIALOG
      END DIALOG
 
      #(ver:79) ---add start---
      #add-point:ui_dialog段 after dialog name="ui_dialog.exit_dialog"
      {<point name="ui_dialog.exit_dialog"/>}
      #end add-point
      #(ver:79) --- add end ---
    
      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         #add-point:ui_dialog段離開dialog前 name="ui_dialog.b_exit"
         {<point name="ui_dialog.b_exit"/>}
         #end add-point
         EXIT WHILE
      END IF
    
   END WHILE    
      
   CALL cl_set_act_visible("accept,cancel", TRUE)
    
END FUNCTION
]]>
</section>
  <section id="aqct300.browser_fill" ver="47" ch="" status="" src="s" readonly="">
<![CDATA[#+ 瀏覽頁簽資料填充
PRIVATE FUNCTION aqct300_browser_fill(ps_page_action)
   #add-point:browser_fill段define(客製用) name="browser_fill.define_customerization"
   {<point name="browser_fill.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   DEFINE ps_page_action    STRING
   DEFINE l_wc              STRING
   DEFINE l_wc2             STRING
   DEFINE l_sql             STRING
   DEFINE l_sub_sql         STRING
   DEFINE l_sql_rank        STRING
   #add-point:browser_fill段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="browser_fill.define"
   {<point name="browser_fill.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理 name="browser_fill.before_browser_fill"
   {<point name="browser_fill.before_browser_fill"/>}
   #end add-point
   
   IF cl_null(g_wc) THEN
      LET g_wc = " 1=1"
   END IF
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   LET l_wc  = g_wc.trim() 
   LET l_wc2 = g_wc2.trim()
 
   #add-point:browser_fill,foreach前 name="browser_fill.before_foreach"
   {<point name="browser_fill.before_foreach"/>}
   #end add-point
   
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件                      
      LET l_sub_sql = " SELECT DISTINCT qcbadocno ",
                      " FROM qcba_t ",
                      " ",
                      " LEFT JOIN qcbd_t ON qcbdent = qcbaent AND qcbadocno = qcbddocno ", "  ",
                      #add-point:browser_fill段sql(qcbd_t1) name="browser_fill.cnt.join.}"
                      {<point name="browser_fill.cnt.join.}"/>}
                      #end add-point
                      " LEFT JOIN qcbb_t ON qcbbent = qcbaent AND qcbadocno = qcbbdocno", "  ",
                      #add-point:browser_fill段sql(qcbb_t1) name="browser_fill.cnt.join.qcbb_t1"
                      {<point name="browser_fill.cnt.join.qcbb_t1"/>}
                      #end add-point
 
                      " LEFT JOIN qcbc_t ON qcbcent = qcbaent AND qcbadocno = qcbcdocno", "  ",
                      #add-point:browser_fill段sql(qcbc_t1) name="browser_fill.cnt.join.qcbc_t1"
                      {<point name="browser_fill.cnt.join.qcbc_t1"/>}
                      #end add-point
 
 
                      " LEFT JOIN qcbe_t ON qcbeent = qcbaent AND qcbddocno = qcbedocno AND qcbdseq = qcbeseq", "  ",
                      #add-point:browser_fill段sql(qcbe_t1) name="browser_fill.cnt.join.qcbe_t1"
                      {<point name="browser_fill.cnt.join.qcbe_t1"/>}
                      #end add-point
 
                      " LEFT JOIN qcbg_t ON qcbgent = qcbaent AND qcbddocno = qcbgdocno AND qcbdseq = qcbgseq", "  ",
                      #add-point:browser_fill段sql(qcbg_t1) name="browser_fill.cnt.join.qcbg_t1"
                      {<point name="browser_fill.cnt.join.qcbg_t1"/>}
                      #end add-point
 
 
                      " ", 
                      " ", 
                      " ",                      
 
                      " ",                      
 
 
                      " ",
 
                      " ",
 
 
                      " WHERE qcbaent = " ||g_enterprise|| " AND qcbdent = " ||g_enterprise|| " AND ",l_wc, " AND ", l_wc2, cl_sql_add_filter("qcba_t")
   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT DISTINCT qcbadocno ",
                      " FROM qcba_t ", 
                      "  ",
                      "  ",
                      " WHERE qcbaent = " ||g_enterprise|| " AND ",l_wc CLIPPED, cl_sql_add_filter("qcba_t")
   END IF
   
   #add-point:browser_fill,cnt wc name="browser_fill.cnt_sqlwc"
   {<point name="browser_fill.cnt_sqlwc"/>}
   #end add-point
   
   LET g_sql = " SELECT COUNT(1) FROM (",l_sub_sql,")"
   
   #add-point:browser_fill,count前 name="browser_fill.before_count"
   {<point name="browser_fill.before_count"/>}
   #end add-point
   
   IF g_sql.getIndexOf(" 1=2",1) THEN
      DISPLAY "INFO: 1=2 jumped!"
   ELSE
      PREPARE header_cnt_pre FROM g_sql
      EXECUTE header_cnt_pre INTO g_browser_cnt   #總筆數
      FREE header_cnt_pre
   END IF
    
   IF g_browser_cnt > g_max_browse THEN
      IF g_error_show = 1 THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_browser_cnt
         LET g_errparam.code = 9035 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
      END IF
      LET g_browser_cnt = g_max_browse
   END IF
   
   DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
   DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
 
   #根據行為確定資料填充位置及WC
   IF cl_null(g_add_browse) THEN
      #清除畫面
      CLEAR FORM                
      INITIALIZE g_qcba_m.* TO NULL
      CALL g_qcbd_d.clear()        
      CALL g_qcbd2_d.clear() 
      CALL g_qcbd4_d.clear() 
      CALL g_qcbd5_d.clear() 
      CALL g_qcbd7_d.clear() 
 
      #add-point:browser_fill g_add_browse段額外處理 name="browser_fill.add_browse.other"
      {<point name="browser_fill.add_browse.other"/>}
      #end add-point   
      CALL g_browser.clear()
      LET g_cnt = 1
   ELSE
      LET l_wc  = g_add_browse
      LET l_wc2 = " 1=1" 
      LET g_cnt = g_current_idx
   END IF
 
   #依照t0.qcbadocno,t0.qcbadocdt,t0.qcbasite,t0.qcba000,t0.qcba900,t0.qcba901 Browser欄位定義(取代原本bs_sql功能)
   #考量到單身可能下條件, 所以此處需join單身所有table
   #DISTINCT是為了避免在join時出現重複的資料(如果不加DISTINCT則須在程式中過濾)
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件   
      LET g_sql = " SELECT DISTINCT t0.qcbastus,t0.qcbadocno,t0.qcbadocdt,t0.qcbasite,t0.qcba000,t0.qcba900, 
          t0.qcba901,t1.ooag011 ,t2.ooefl003 ",
                  " FROM qcba_t t0",
                  "  ",
                  "  LEFT JOIN qcbd_t ON qcbdent = qcbaent AND qcbadocno = qcbddocno ", "  ", 
                  #add-point:browser_fill段sql(qcbd_t1) name="browser_fill.join.qcbd_t1"
                  {<point name="browser_fill.join.qcbd_t1"/>}
                  #end add-point
                  "  LEFT JOIN qcbb_t ON qcbbent = qcbaent AND qcbadocno = qcbbdocno", "  ", 
                  #add-point:browser_fill段sql(qcbb_t1) name="browser_fill.join.qcbb_t1"
                  {<point name="browser_fill.join.qcbb_t1"/>}
                  #end add-point
 
                  "  LEFT JOIN qcbc_t ON qcbcent = qcbaent AND qcbadocno = qcbcdocno", "  ", 
                  #add-point:browser_fill段sql(qcbc_t1) name="browser_fill.join.qcbc_t1"
                  {<point name="browser_fill.join.qcbc_t1"/>}
                  #end add-point
 
 
                  "  LEFT JOIN qcbe_t ON qcbeent = qcbaent AND qcbddocno = qcbedocno AND qcbdseq = qcbeseq", "  ", 
                  #add-point:browser_fill段sql(qcbe_t1) name="browser_fill.join.qcbe_t1"
                  {<point name="browser_fill.join.qcbe_t1"/>}
                  #end add-point
 
                  "  LEFT JOIN qcbg_t ON qcbgent = qcbaent AND qcbddocno = qcbgdocno AND qcbdseq = qcbgseq", "  ", 
                  #add-point:browser_fill段sql(qcbg_t1) name="browser_fill.join.qcbg_t1"
                  {<point name="browser_fill.join.qcbg_t1"/>}
                  #end add-point
 
 
                  " ", 
                  " ",                      
 
                  " ",                      
 
 
                  " ",
 
                  " ",
 
 
                                 " LEFT JOIN ooag_t t1 ON t1.ooagent="||g_enterprise||" AND t1.ooag001=t0.qcba900  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.qcba901 AND t2.ooefl002='"||g_dlang||"' ",
 
                  " WHERE t0.qcbaent = " ||g_enterprise|| " AND ",l_wc," AND ",l_wc2, cl_sql_add_filter("qcba_t")
   ELSE
      #單身無輸入搜尋條件   
      LET g_sql = " SELECT DISTINCT t0.qcbastus,t0.qcbadocno,t0.qcbadocdt,t0.qcbasite,t0.qcba000,t0.qcba900, 
          t0.qcba901,t1.ooag011 ,t2.ooefl003 ",
                  " FROM qcba_t t0",
                  "  ",
                                 " LEFT JOIN ooag_t t1 ON t1.ooagent="||g_enterprise||" AND t1.ooag001=t0.qcba900  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.qcba901 AND t2.ooefl002='"||g_dlang||"' ",
 
                  " WHERE t0.qcbaent = " ||g_enterprise|| " AND ",l_wc, cl_sql_add_filter("qcba_t")
   END IF
   #add-point:browser_fill,sql wc name="browser_fill.fill_sqlwc"
   {<point name="browser_fill.fill_sqlwc"/>}
   #end add-point
   LET g_sql = g_sql, " ORDER BY qcbadocno ",g_order
 
   #add-point:browser_fill,before_prepare name="browser_fill.before_prepare"
   {<point name="browser_fill.before_prepare"/>}
   #end add-point
        
   #LET g_sql = cl_sql_add_tabid(g_sql,"qcba_t") #WC重組
   LET g_sql = cl_sql_add_mask(g_sql) #遮蔽特定資料
   
   IF g_sql.getIndexOf(" 1=2",1) THEN
      DISPLAY "INFO: 1=2 jumped!"
   ELSE
      PREPARE browse_pre FROM g_sql
      DECLARE browse_cur CURSOR FOR browse_pre
      
      #add-point:browser_fill段open cursor name="browser_fill.open"
      {<point name="browser_fill.open"/>}
      #end add-point
      
      FOREACH browse_cur INTO g_browser[g_cnt].b_statepic,g_browser[g_cnt].b_qcbadocno,g_browser[g_cnt].b_qcbadocdt, 
          g_browser[g_cnt].b_qcbasite,g_browser[g_cnt].b_qcba000,g_browser[g_cnt].b_qcba900,g_browser[g_cnt].b_qcba901, 
          g_browser[g_cnt].b_qcba900_desc,g_browser[g_cnt].b_qcba901_desc
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "Foreach:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
      
         #add-point:browser_fill段reference name="browser_fill.reference"
         {<point name="browser_fill.reference"/>}
         #end add-point
      
         #遮罩相關處理
         CALL aqct300_browser_mask()
      
               #應用 a24 樣板自動產生(Version:3)
      #browser顯示圖片
      CASE g_browser[g_cnt].b_statepic
         WHEN "N"
            LET g_browser[g_cnt].b_statepic = "stus/16/unconfirmed.png"
         WHEN "Y"
            LET g_browser[g_cnt].b_statepic = "stus/16/confirmed.png"
         WHEN "A"
            LET g_browser[g_cnt].b_statepic = "stus/16/approved.png"
         WHEN "D"
            LET g_browser[g_cnt].b_statepic = "stus/16/withdraw.png"
         WHEN "R"
            LET g_browser[g_cnt].b_statepic = "stus/16/rejection.png"
         WHEN "W"
            LET g_browser[g_cnt].b_statepic = "stus/16/signing.png"
         WHEN "X"
            LET g_browser[g_cnt].b_statepic = "stus/16/invalid.png"
         
      END CASE
 
 
 
         LET g_cnt = g_cnt + 1
         IF g_cnt > g_max_browse THEN
            EXIT FOREACH
         END IF
         
      END FOREACH
      FREE browse_pre
   END IF
   
   #清空g_add_browse, 並指定指標位置
   IF NOT cl_null(g_add_browse) THEN
      LET g_add_browse = ""
      CALL g_curr_diag.setCurrentRow("s_browse",g_current_idx)
   END IF
   
   IF cl_null(g_browser[g_cnt].b_qcbadocno) THEN
      CALL g_browser.deleteElement(g_cnt)
   END IF
   
   LET g_header_cnt  = g_browser.getLength()
   LET g_browser_cnt = g_browser.getLength()
   
   #筆數顯示
   IF g_browser_cnt > 0 THEN
      DISPLAY g_browser_idx TO FORMONLY.b_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.b_count #總筆數
      DISPLAY g_browser_idx TO FORMONLY.h_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.h_count #總筆數
      DISPLAY g_detail_idx  TO FORMONLY.idx     #單身當下筆數
      DISPLAY g_detail_cnt  TO FORMONLY.cnt     #單身總筆數
   ELSE
      DISPLAY '' TO FORMONLY.b_index #當下筆數
      DISPLAY '' TO FORMONLY.b_count #總筆數
      DISPLAY '' TO FORMONLY.h_index #當下筆數
      DISPLAY '' TO FORMONLY.h_count #總筆數
      DISPLAY '' TO FORMONLY.idx     #單身當下筆數
      DISPLAY '' TO FORMONLY.cnt     #單身總筆數
   END IF
 
   LET g_rec_b = g_cnt - 1
   LET g_detail_cnt = g_rec_b
   LET g_cnt = 0
 
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
                  
   
   #add-point:browser_fill段結束前 name="browser_fill.after"
   {<point name="browser_fill.after"/>}
   #end add-point   
 
END FUNCTION
]]>
</section>
  <section id="aqct300.ui_headershow" ver="23" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單頭資料重新顯示
PRIVATE FUNCTION aqct300_ui_headershow()
   #add-point:ui_headershow段define(客製用) name="ui_headershow.define_customerization"
   {<point name="ui_headershow.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   #add-point:ui_headershow段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_headershow.define"
   {<point name="ui_headershow.define"/>} 
   #end add-point      
   
   #add-point:Function前置處理  name="ui_headershow.pre_function"
   {<point name="ui_headershow.pre_function"/>}
   #end add-point
   
   LET g_qcba_m.qcbadocno = g_browser[g_current_idx].b_qcbadocno   
 
   EXECUTE aqct300_master_referesh USING g_qcba_m.qcbadocno INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt, 
       g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017, 
       g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
       g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018, 
       g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026, 
       g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp, 
       g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt, 
       g_qcba_m.qcba900_desc,g_qcba_m.qcba901_desc,g_qcba_m.qcba005_desc,g_qcba_m.qcba009_desc,g_qcba_m.qcba013_desc, 
       g_qcba_m.qcba024_desc,g_qcba_m.qcba016_desc,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid_desc, 
       g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbacnfid_desc
   
   CALL aqct300_qcba_t_mask()
   CALL aqct300_show()
      
END FUNCTION
]]>
</section>
  <section id="aqct300.ui_detailshow" ver="9" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身資料重新顯示
PRIVATE FUNCTION aqct300_ui_detailshow()
   #add-point:ui_detailshow段define(客製用) name="ui_detailshow.define_customerization"
   {<point name="ui_detailshow.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   #add-point:ui_detailshow段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_detailshow.define"
   {<point name="ui_detailshow.define"/>} 
   #end add-point    
 
   #add-point:Function前置處理 name="ui_detailshow.before"
   {<point name="ui_detailshow.before"/>}
   #end add-point    
   
   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail1",g_detail_idx)      
      CALL g_curr_diag.setCurrentRow("s_detail2",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail4",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail5",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail7",g_detail_idx)
 
   END IF
   
   #add-point:ui_detailshow段after name="ui_detailshow.after"
   {<point name="ui_detailshow.after"/>}
   #end add-point    
   
END FUNCTION
]]>
</section>
  <section id="aqct300.ui_browser_refresh" ver="15" ch="" status="" src="s" readonly="">
<![CDATA[#+ 瀏覽頁簽資料重新顯示
PRIVATE FUNCTION aqct300_ui_browser_refresh()
   #add-point:ui_browser_refresh段define(客製用) name="ui_browser_refresh.define_customerization"
   {<point name="ui_browser_refresh.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   DEFINE l_i  LIKE type_t.num10
   #add-point:ui_browser_refresh段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_browser_refresh.define"
   {<point name="ui_browser_refresh.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理  name="ui_browser_refresh.pre_function"
   {<point name="ui_browser_refresh.pre_function"/>}
   #end add-point
   
   LET g_browser_cnt = g_browser.getLength()
   LET g_header_cnt  = g_browser.getLength()
   FOR l_i =1 TO g_browser.getLength()
      IF g_browser[l_i].b_qcbadocno = g_qcba_m.qcbadocno 
 
         THEN
         CALL g_browser.deleteElement(l_i)
         EXIT FOR
      END IF
   END FOR
   LET g_browser_cnt = g_browser_cnt - 1
   LET g_header_cnt = g_header_cnt - 1
    
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
      CLEAR FORM
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
   
   #add-point:ui_browser_refresh段after name="ui_browser_refresh.after"
   {<point name="ui_browser_refresh.after"/>}
   #end add-point    
   
END FUNCTION
]]>
</section>
  <section id="aqct300.construct" ver="37" ch="" status="" src="s" readonly="">
<![CDATA[#+ QBE資料查詢
PRIVATE FUNCTION aqct300_construct()
   #add-point:cs段define(客製用) name="cs.define_customerization"
   {<point name="cs.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING 
   DEFINE ls_wc       STRING 
   DEFINE la_wc       DYNAMIC ARRAY OF RECORD
          tableid     STRING,
          wc          STRING
          END RECORD
   DEFINE li_idx      LIKE type_t.num10
   #add-point:cs段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="cs.define"
   {<point name="cs.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理  name="cs.pre_function"
   {<point name="cs.pre_function"/>}
   #end add-point
    
   #清除畫面
   CLEAR FORM                
   INITIALIZE g_qcba_m.* TO NULL
   CALL g_qcbd_d.clear()        
   CALL g_qcbd2_d.clear() 
   CALL g_qcbd4_d.clear() 
   CALL g_qcbd5_d.clear() 
   CALL g_qcbd7_d.clear() 
 
   
   LET g_action_choice = ""
    
   INITIALIZE g_wc TO NULL
   INITIALIZE g_wc2 TO NULL
   
   INITIALIZE g_wc2_table1 TO NULL
   INITIALIZE g_wc2_table2 TO NULL
 
   INITIALIZE g_wc2_table3 TO NULL
 
 
    
   LET g_qryparam.state = 'c'
   
   #add-point:cs段開始前 name="cs.before_construct"
   {<point name="cs.before_construct"/>}
   #end add-point 
   
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      
      #單頭
      CONSTRUCT BY NAME g_wc ON qcbadocno,qcbadocdt,qcba900,qcbadocno_desc,qcba000,qcba031,qcba901,qcba032, 
          qcbastus,qcba001,qcba002,qcba029,qcba003,qcba004,qcba005,qcba006,qcba007,qcba008,qcba009,qcba017, 
          qcba010,qcba012,qcba012_desc,qcba013,qcba020,qcba021,qcba030,qcba024,qcba016,qcba022,qcba023, 
          qcba027,imae116,qcba018,qcba019,qcba014,qcba028,qcba026,qcba033,qcbaownid,qcbaowndp,qcbacrtid, 
          qcbacrtdp,qcbacrtdt,qcbamodid,qcbamoddt,qcbacnfid,qcbacnfdt
 
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.head.before_construct"
            {<point name="cs.head.before_construct"/>}
            #end add-point 
            
         #公用欄位開窗相關處理
         #應用 a11 樣板自動產生(Version:3)
         #共用欄位查詢處理  
         ##----<<qcbacrtdt>>----
         AFTER FIELD qcbacrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
 
         #----<<qcbamoddt>>----
         AFTER FIELD qcbamoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<qcbacnfdt>>----
         AFTER FIELD qcbacnfdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<qcbapstdt>>----
 
 
 
            
         #一般欄位開窗相關處理    
                  #Ctrlp:construct.c.qcbadocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbadocno
            #add-point:ON ACTION controlp INFIELD qcbadocno name="construct.c.qcbadocno"
            {<point name="construct.c.qcbadocno" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbadocno
            #add-point:BEFORE FIELD qcbadocno name="construct.b.qcbadocno"
            {<point name="construct.b.qcbadocno" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbadocno
            
            #add-point:AFTER FIELD qcbadocno name="construct.a.qcbadocno"
            {<point name="construct.a.qcbadocno" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbadocdt
            #add-point:BEFORE FIELD qcbadocdt name="construct.b.qcbadocdt"
            {<point name="construct.b.qcbadocdt" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbadocdt
            
            #add-point:AFTER FIELD qcbadocdt name="construct.a.qcbadocdt"
            {<point name="construct.a.qcbadocdt" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcbadocdt
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbadocdt
            #add-point:ON ACTION controlp INFIELD qcbadocdt name="construct.c.qcbadocdt"
            {<point name="construct.c.qcbadocdt" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcba900
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba900
            #add-point:ON ACTION controlp INFIELD qcba900 name="construct.c.qcba900"
            {<point name="construct.c.qcba900" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba900
            #add-point:BEFORE FIELD qcba900 name="construct.b.qcba900"
            {<point name="construct.b.qcba900" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba900
            
            #add-point:AFTER FIELD qcba900 name="construct.a.qcba900"
            {<point name="construct.a.qcba900" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbadocno_desc
            #add-point:BEFORE FIELD qcbadocno_desc name="construct.b.qcbadocno_desc"
            {<point name="construct.b.qcbadocno_desc" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbadocno_desc
            
            #add-point:AFTER FIELD qcbadocno_desc name="construct.a.qcbadocno_desc"
            {<point name="construct.a.qcbadocno_desc" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcbadocno_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbadocno_desc
            #add-point:ON ACTION controlp INFIELD qcbadocno_desc name="construct.c.qcbadocno_desc"
            {<point name="construct.c.qcbadocno_desc" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba000
            #add-point:BEFORE FIELD qcba000 name="construct.b.qcba000"
            {<point name="construct.b.qcba000" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba000
            
            #add-point:AFTER FIELD qcba000 name="construct.a.qcba000"
            {<point name="construct.a.qcba000" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba000
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba000
            #add-point:ON ACTION controlp INFIELD qcba000 name="construct.c.qcba000"
            {<point name="construct.c.qcba000" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba031
            #add-point:BEFORE FIELD qcba031 name="construct.b.qcba031"
            {<point name="construct.b.qcba031" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba031
            
            #add-point:AFTER FIELD qcba031 name="construct.a.qcba031"
            {<point name="construct.a.qcba031" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba031
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba031
            #add-point:ON ACTION controlp INFIELD qcba031 name="construct.c.qcba031"
            {<point name="construct.c.qcba031" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcba901
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba901
            #add-point:ON ACTION controlp INFIELD qcba901 name="construct.c.qcba901"
            {<point name="construct.c.qcba901" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba901
            #add-point:BEFORE FIELD qcba901 name="construct.b.qcba901"
            {<point name="construct.b.qcba901" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba901
            
            #add-point:AFTER FIELD qcba901 name="construct.a.qcba901"
            {<point name="construct.a.qcba901" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba032
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba032
            #add-point:ON ACTION controlp INFIELD qcba032 name="construct.c.qcba032"
            {<point name="construct.c.qcba032" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba032
            #add-point:BEFORE FIELD qcba032 name="construct.b.qcba032"
            {<point name="construct.b.qcba032" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba032
            
            #add-point:AFTER FIELD qcba032 name="construct.a.qcba032"
            {<point name="construct.a.qcba032" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbastus
            #add-point:BEFORE FIELD qcbastus name="construct.b.qcbastus"
            {<point name="construct.b.qcbastus" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbastus
            
            #add-point:AFTER FIELD qcbastus name="construct.a.qcbastus"
            {<point name="construct.a.qcbastus" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcbastus
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbastus
            #add-point:ON ACTION controlp INFIELD qcbastus name="construct.c.qcbastus"
            {<point name="construct.c.qcbastus" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba001
            #add-point:BEFORE FIELD qcba001 name="construct.b.qcba001"
            {<point name="construct.b.qcba001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba001
            
            #add-point:AFTER FIELD qcba001 name="construct.a.qcba001"
            {<point name="construct.a.qcba001" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba001
            #add-point:ON ACTION controlp INFIELD qcba001 name="construct.c.qcba001"
            {<point name="construct.c.qcba001" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba002
            #add-point:BEFORE FIELD qcba002 name="construct.b.qcba002"
            {<point name="construct.b.qcba002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba002
            
            #add-point:AFTER FIELD qcba002 name="construct.a.qcba002"
            {<point name="construct.a.qcba002" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba002
            #add-point:ON ACTION controlp INFIELD qcba002 name="construct.c.qcba002"
            {<point name="construct.c.qcba002" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba029
            #add-point:BEFORE FIELD qcba029 name="construct.b.qcba029"
            {<point name="construct.b.qcba029" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba029
            
            #add-point:AFTER FIELD qcba029 name="construct.a.qcba029"
            {<point name="construct.a.qcba029" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba029
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba029
            #add-point:ON ACTION controlp INFIELD qcba029 name="construct.c.qcba029"
            {<point name="construct.c.qcba029" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba003
            #add-point:BEFORE FIELD qcba003 name="construct.b.qcba003"
            {<point name="construct.b.qcba003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba003
            
            #add-point:AFTER FIELD qcba003 name="construct.a.qcba003"
            {<point name="construct.a.qcba003" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba003
            #add-point:ON ACTION controlp INFIELD qcba003 name="construct.c.qcba003"
            {<point name="construct.c.qcba003" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba004
            #add-point:BEFORE FIELD qcba004 name="construct.b.qcba004"
            {<point name="construct.b.qcba004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba004
            
            #add-point:AFTER FIELD qcba004 name="construct.a.qcba004"
            {<point name="construct.a.qcba004" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba004
            #add-point:ON ACTION controlp INFIELD qcba004 name="construct.c.qcba004"
            {<point name="construct.c.qcba004" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcba005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba005
            #add-point:ON ACTION controlp INFIELD qcba005 name="construct.c.qcba005"
            {<point name="construct.c.qcba005" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba005
            #add-point:BEFORE FIELD qcba005 name="construct.b.qcba005"
            {<point name="construct.b.qcba005" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba005
            
            #add-point:AFTER FIELD qcba005 name="construct.a.qcba005"
            {<point name="construct.a.qcba005" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba006
            #add-point:ON ACTION controlp INFIELD qcba006 name="construct.c.qcba006"
            {<point name="construct.c.qcba006" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba006
            #add-point:BEFORE FIELD qcba006 name="construct.b.qcba006"
            {<point name="construct.b.qcba006" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba006
            
            #add-point:AFTER FIELD qcba006 name="construct.a.qcba006"
            {<point name="construct.a.qcba006" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba007
            #add-point:BEFORE FIELD qcba007 name="construct.b.qcba007"
            {<point name="construct.b.qcba007" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba007
            
            #add-point:AFTER FIELD qcba007 name="construct.a.qcba007"
            {<point name="construct.a.qcba007" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba007
            #add-point:ON ACTION controlp INFIELD qcba007 name="construct.c.qcba007"
            {<point name="construct.c.qcba007" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba008
            #add-point:BEFORE FIELD qcba008 name="construct.b.qcba008"
            {<point name="construct.b.qcba008" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba008
            
            #add-point:AFTER FIELD qcba008 name="construct.a.qcba008"
            {<point name="construct.a.qcba008" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba008
            #add-point:ON ACTION controlp INFIELD qcba008 name="construct.c.qcba008"
            {<point name="construct.c.qcba008" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba009
            #add-point:BEFORE FIELD qcba009 name="construct.b.qcba009"
            {<point name="construct.b.qcba009" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba009
            
            #add-point:AFTER FIELD qcba009 name="construct.a.qcba009"
            {<point name="construct.a.qcba009" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba009
            #add-point:ON ACTION controlp INFIELD qcba009 name="construct.c.qcba009"
            {<point name="construct.c.qcba009" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba017
            #add-point:BEFORE FIELD qcba017 name="construct.b.qcba017"
            {<point name="construct.b.qcba017" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba017
            
            #add-point:AFTER FIELD qcba017 name="construct.a.qcba017"
            {<point name="construct.a.qcba017" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba017
            #add-point:ON ACTION controlp INFIELD qcba017 name="construct.c.qcba017"
            {<point name="construct.c.qcba017" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcba010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba010
            #add-point:ON ACTION controlp INFIELD qcba010 name="construct.c.qcba010"
            {<point name="construct.c.qcba010" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba010
            #add-point:BEFORE FIELD qcba010 name="construct.b.qcba010"
            {<point name="construct.b.qcba010" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba010
            
            #add-point:AFTER FIELD qcba010 name="construct.a.qcba010"
            {<point name="construct.a.qcba010" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba012
            #add-point:BEFORE FIELD qcba012 name="construct.b.qcba012"
            {<point name="construct.b.qcba012" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba012
            
            #add-point:AFTER FIELD qcba012 name="construct.a.qcba012"
            {<point name="construct.a.qcba012" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba012
            #add-point:ON ACTION controlp INFIELD qcba012 name="construct.c.qcba012"
            {<point name="construct.c.qcba012" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba012_desc
            #add-point:BEFORE FIELD qcba012_desc name="construct.b.qcba012_desc"
            {<point name="construct.b.qcba012_desc" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba012_desc
            
            #add-point:AFTER FIELD qcba012_desc name="construct.a.qcba012_desc"
            {<point name="construct.a.qcba012_desc" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba012_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba012_desc
            #add-point:ON ACTION controlp INFIELD qcba012_desc name="construct.c.qcba012_desc"
            {<point name="construct.c.qcba012_desc" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcba013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba013
            #add-point:ON ACTION controlp INFIELD qcba013 name="construct.c.qcba013"
            {<point name="construct.c.qcba013" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba013
            #add-point:BEFORE FIELD qcba013 name="construct.b.qcba013"
            {<point name="construct.b.qcba013" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba013
            
            #add-point:AFTER FIELD qcba013 name="construct.a.qcba013"
            {<point name="construct.a.qcba013" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba020
            #add-point:BEFORE FIELD qcba020 name="construct.b.qcba020"
            {<point name="construct.b.qcba020" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba020
            
            #add-point:AFTER FIELD qcba020 name="construct.a.qcba020"
            {<point name="construct.a.qcba020" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba020
            #add-point:ON ACTION controlp INFIELD qcba020 name="construct.c.qcba020"
            {<point name="construct.c.qcba020" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba021
            #add-point:BEFORE FIELD qcba021 name="construct.b.qcba021"
            {<point name="construct.b.qcba021" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba021
            
            #add-point:AFTER FIELD qcba021 name="construct.a.qcba021"
            {<point name="construct.a.qcba021" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba021
            #add-point:ON ACTION controlp INFIELD qcba021 name="construct.c.qcba021"
            {<point name="construct.c.qcba021" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba030
            #add-point:BEFORE FIELD qcba030 name="construct.b.qcba030"
            {<point name="construct.b.qcba030" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba030
            
            #add-point:AFTER FIELD qcba030 name="construct.a.qcba030"
            {<point name="construct.a.qcba030" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba030
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba030
            #add-point:ON ACTION controlp INFIELD qcba030 name="construct.c.qcba030"
            {<point name="construct.c.qcba030" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcba024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba024
            #add-point:ON ACTION controlp INFIELD qcba024 name="construct.c.qcba024"
            {<point name="construct.c.qcba024" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba024
            #add-point:BEFORE FIELD qcba024 name="construct.b.qcba024"
            {<point name="construct.b.qcba024" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba024
            
            #add-point:AFTER FIELD qcba024 name="construct.a.qcba024"
            {<point name="construct.a.qcba024" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba016
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba016
            #add-point:ON ACTION controlp INFIELD qcba016 name="construct.c.qcba016"
            {<point name="construct.c.qcba016" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba016
            #add-point:BEFORE FIELD qcba016 name="construct.b.qcba016"
            {<point name="construct.b.qcba016" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba016
            
            #add-point:AFTER FIELD qcba016 name="construct.a.qcba016"
            {<point name="construct.a.qcba016" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba022
            #add-point:BEFORE FIELD qcba022 name="construct.b.qcba022"
            {<point name="construct.b.qcba022" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba022
            
            #add-point:AFTER FIELD qcba022 name="construct.a.qcba022"
            {<point name="construct.a.qcba022" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba022
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba022
            #add-point:ON ACTION controlp INFIELD qcba022 name="construct.c.qcba022"
            {<point name="construct.c.qcba022" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba023
            #add-point:BEFORE FIELD qcba023 name="construct.b.qcba023"
            {<point name="construct.b.qcba023" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba023
            
            #add-point:AFTER FIELD qcba023 name="construct.a.qcba023"
            {<point name="construct.a.qcba023" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba023
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba023
            #add-point:ON ACTION controlp INFIELD qcba023 name="construct.c.qcba023"
            {<point name="construct.c.qcba023" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba027
            #add-point:BEFORE FIELD qcba027 name="construct.b.qcba027"
            {<point name="construct.b.qcba027" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba027
            
            #add-point:AFTER FIELD qcba027 name="construct.a.qcba027"
            {<point name="construct.a.qcba027" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba027
            #add-point:ON ACTION controlp INFIELD qcba027 name="construct.c.qcba027"
            {<point name="construct.c.qcba027" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD imae116
            #add-point:BEFORE FIELD imae116 name="construct.b.imae116"
            {<point name="construct.b.imae116" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD imae116
            
            #add-point:AFTER FIELD imae116 name="construct.a.imae116"
            {<point name="construct.a.imae116" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.imae116
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD imae116
            #add-point:ON ACTION controlp INFIELD imae116 name="construct.c.imae116"
            {<point name="construct.c.imae116" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba018
            #add-point:BEFORE FIELD qcba018 name="construct.b.qcba018"
            {<point name="construct.b.qcba018" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba018
            
            #add-point:AFTER FIELD qcba018 name="construct.a.qcba018"
            {<point name="construct.a.qcba018" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba018
            #add-point:ON ACTION controlp INFIELD qcba018 name="construct.c.qcba018"
            {<point name="construct.c.qcba018" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba019
            #add-point:BEFORE FIELD qcba019 name="construct.b.qcba019"
            {<point name="construct.b.qcba019" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba019
            
            #add-point:AFTER FIELD qcba019 name="construct.a.qcba019"
            {<point name="construct.a.qcba019" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba019
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba019
            #add-point:ON ACTION controlp INFIELD qcba019 name="construct.c.qcba019"
            {<point name="construct.c.qcba019" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba014
            #add-point:BEFORE FIELD qcba014 name="construct.b.qcba014"
            {<point name="construct.b.qcba014" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba014
            
            #add-point:AFTER FIELD qcba014 name="construct.a.qcba014"
            {<point name="construct.a.qcba014" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba014
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba014
            #add-point:ON ACTION controlp INFIELD qcba014 name="construct.c.qcba014"
            {<point name="construct.c.qcba014" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba028
            #add-point:BEFORE FIELD qcba028 name="construct.b.qcba028"
            {<point name="construct.b.qcba028" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba028
            
            #add-point:AFTER FIELD qcba028 name="construct.a.qcba028"
            {<point name="construct.a.qcba028" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba028
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba028
            #add-point:ON ACTION controlp INFIELD qcba028 name="construct.c.qcba028"
            {<point name="construct.c.qcba028" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba026
            #add-point:BEFORE FIELD qcba026 name="construct.b.qcba026"
            {<point name="construct.b.qcba026" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba026
            
            #add-point:AFTER FIELD qcba026 name="construct.a.qcba026"
            {<point name="construct.a.qcba026" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcba026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba026
            #add-point:ON ACTION controlp INFIELD qcba026 name="construct.c.qcba026"
            {<point name="construct.c.qcba026" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcba033
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba033
            #add-point:ON ACTION controlp INFIELD qcba033 name="construct.c.qcba033"
            {<point name="construct.c.qcba033" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba033
            #add-point:BEFORE FIELD qcba033 name="construct.b.qcba033"
            {<point name="construct.b.qcba033" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba033
            
            #add-point:AFTER FIELD qcba033 name="construct.a.qcba033"
            {<point name="construct.a.qcba033" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcbaownid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbaownid
            #add-point:ON ACTION controlp INFIELD qcbaownid name="construct.c.qcbaownid"
            {<point name="construct.c.qcbaownid" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbaownid
            #add-point:BEFORE FIELD qcbaownid name="construct.b.qcbaownid"
            {<point name="construct.b.qcbaownid" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbaownid
            
            #add-point:AFTER FIELD qcbaownid name="construct.a.qcbaownid"
            {<point name="construct.a.qcbaownid" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcbaowndp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbaowndp
            #add-point:ON ACTION controlp INFIELD qcbaowndp name="construct.c.qcbaowndp"
            {<point name="construct.c.qcbaowndp" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbaowndp
            #add-point:BEFORE FIELD qcbaowndp name="construct.b.qcbaowndp"
            {<point name="construct.b.qcbaowndp" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbaowndp
            
            #add-point:AFTER FIELD qcbaowndp name="construct.a.qcbaowndp"
            {<point name="construct.a.qcbaowndp" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcbacrtid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbacrtid
            #add-point:ON ACTION controlp INFIELD qcbacrtid name="construct.c.qcbacrtid"
            {<point name="construct.c.qcbacrtid" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbacrtid
            #add-point:BEFORE FIELD qcbacrtid name="construct.b.qcbacrtid"
            {<point name="construct.b.qcbacrtid" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbacrtid
            
            #add-point:AFTER FIELD qcbacrtid name="construct.a.qcbacrtid"
            {<point name="construct.a.qcbacrtid" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.qcbacrtdp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbacrtdp
            #add-point:ON ACTION controlp INFIELD qcbacrtdp name="construct.c.qcbacrtdp"
            {<point name="construct.c.qcbacrtdp" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbacrtdp
            #add-point:BEFORE FIELD qcbacrtdp name="construct.b.qcbacrtdp"
            {<point name="construct.b.qcbacrtdp" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbacrtdp
            
            #add-point:AFTER FIELD qcbacrtdp name="construct.a.qcbacrtdp"
            {<point name="construct.a.qcbacrtdp" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbacrtdt
            #add-point:BEFORE FIELD qcbacrtdt name="construct.b.qcbacrtdt"
            {<point name="construct.b.qcbacrtdt" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcbamodid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbamodid
            #add-point:ON ACTION controlp INFIELD qcbamodid name="construct.c.qcbamodid"
            {<point name="construct.c.qcbamodid" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbamodid
            #add-point:BEFORE FIELD qcbamodid name="construct.b.qcbamodid"
            {<point name="construct.b.qcbamodid" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbamodid
            
            #add-point:AFTER FIELD qcbamodid name="construct.a.qcbamodid"
            {<point name="construct.a.qcbamodid" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbamoddt
            #add-point:BEFORE FIELD qcbamoddt name="construct.b.qcbamoddt"
            {<point name="construct.b.qcbamoddt" />}
            #END add-point
 
 
         #Ctrlp:construct.c.qcbacnfid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbacnfid
            #add-point:ON ACTION controlp INFIELD qcbacnfid name="construct.c.qcbacnfid"
            {<point name="construct.c.qcbacnfid" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbacnfid
            #add-point:BEFORE FIELD qcbacnfid name="construct.b.qcbacnfid"
            {<point name="construct.b.qcbacnfid" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbacnfid
            
            #add-point:AFTER FIELD qcbacnfid name="construct.a.qcbacnfid"
            {<point name="construct.a.qcbacnfid" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbacnfdt
            #add-point:BEFORE FIELD qcbacnfdt name="construct.b.qcbacnfdt"
            {<point name="construct.b.qcbacnfdt" />}
            #END add-point
 
 
 
         
      END CONSTRUCT
 
      #單身根據table分拆construct
      CONSTRUCT g_wc2_table1 ON qcbdseq,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004,qcbd005,qcbd006,qcbd007, 
          qcbd008,qcbd009,qcbd010,qcbd021,qcbd011,ooff013
           FROM s_detail1[1].qcbdseq,s_detail1[1].qcbd001,s_detail1[1].qcbd002,s_detail1[1].qcbd003, 
               s_detail1[1].qcbd020,s_detail1[1].qcbd004,s_detail1[1].qcbd005,s_detail1[1].qcbd006,s_detail1[1].qcbd007, 
               s_detail1[1].qcbd008,s_detail1[1].qcbd009,s_detail1[1].qcbd010,s_detail1[1].qcbd021,s_detail1[1].qcbd011, 
               s_detail1[1].ooff013
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body.before_construct"
            {<point name="cs.body.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbdseq
            #add-point:BEFORE FIELD qcbdseq name="construct.b.page1.qcbdseq"
            {<point name="construct.b.page1.qcbdseq" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbdseq
            
            #add-point:AFTER FIELD qcbdseq name="construct.a.page1.qcbdseq"
            {<point name="construct.a.page1.qcbdseq" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbdseq
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbdseq
            #add-point:ON ACTION controlp INFIELD qcbdseq name="construct.c.page1.qcbdseq"
            {<point name="construct.c.page1.qcbdseq" />}
            #END add-point
 
 
         #Ctrlp:construct.c.page1.qcbd001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd001
            #add-point:ON ACTION controlp INFIELD qcbd001 name="construct.c.page1.qcbd001"
            {<point name="construct.c.page1.qcbd001" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd001
            #add-point:BEFORE FIELD qcbd001 name="construct.b.page1.qcbd001"
            {<point name="construct.b.page1.qcbd001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd001
            
            #add-point:AFTER FIELD qcbd001 name="construct.a.page1.qcbd001"
            {<point name="construct.a.page1.qcbd001" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd002
            #add-point:BEFORE FIELD qcbd002 name="construct.b.page1.qcbd002"
            {<point name="construct.b.page1.qcbd002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd002
            
            #add-point:AFTER FIELD qcbd002 name="construct.a.page1.qcbd002"
            {<point name="construct.a.page1.qcbd002" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd002
            #add-point:ON ACTION controlp INFIELD qcbd002 name="construct.c.page1.qcbd002"
            {<point name="construct.c.page1.qcbd002" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd003
            #add-point:BEFORE FIELD qcbd003 name="construct.b.page1.qcbd003"
            {<point name="construct.b.page1.qcbd003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd003
            
            #add-point:AFTER FIELD qcbd003 name="construct.a.page1.qcbd003"
            {<point name="construct.a.page1.qcbd003" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd003
            #add-point:ON ACTION controlp INFIELD qcbd003 name="construct.c.page1.qcbd003"
            {<point name="construct.c.page1.qcbd003" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd020
            #add-point:BEFORE FIELD qcbd020 name="construct.b.page1.qcbd020"
            {<point name="construct.b.page1.qcbd020" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd020
            
            #add-point:AFTER FIELD qcbd020 name="construct.a.page1.qcbd020"
            {<point name="construct.a.page1.qcbd020" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd020
            #add-point:ON ACTION controlp INFIELD qcbd020 name="construct.c.page1.qcbd020"
            {<point name="construct.c.page1.qcbd020" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd004
            #add-point:BEFORE FIELD qcbd004 name="construct.b.page1.qcbd004"
            {<point name="construct.b.page1.qcbd004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd004
            
            #add-point:AFTER FIELD qcbd004 name="construct.a.page1.qcbd004"
            {<point name="construct.a.page1.qcbd004" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd004
            #add-point:ON ACTION controlp INFIELD qcbd004 name="construct.c.page1.qcbd004"
            {<point name="construct.c.page1.qcbd004" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd005
            #add-point:BEFORE FIELD qcbd005 name="construct.b.page1.qcbd005"
            {<point name="construct.b.page1.qcbd005" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd005
            
            #add-point:AFTER FIELD qcbd005 name="construct.a.page1.qcbd005"
            {<point name="construct.a.page1.qcbd005" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd005
            #add-point:ON ACTION controlp INFIELD qcbd005 name="construct.c.page1.qcbd005"
            {<point name="construct.c.page1.qcbd005" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd006
            #add-point:BEFORE FIELD qcbd006 name="construct.b.page1.qcbd006"
            {<point name="construct.b.page1.qcbd006" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd006
            
            #add-point:AFTER FIELD qcbd006 name="construct.a.page1.qcbd006"
            {<point name="construct.a.page1.qcbd006" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd006
            #add-point:ON ACTION controlp INFIELD qcbd006 name="construct.c.page1.qcbd006"
            {<point name="construct.c.page1.qcbd006" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd007
            #add-point:BEFORE FIELD qcbd007 name="construct.b.page1.qcbd007"
            {<point name="construct.b.page1.qcbd007" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd007
            
            #add-point:AFTER FIELD qcbd007 name="construct.a.page1.qcbd007"
            {<point name="construct.a.page1.qcbd007" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd007
            #add-point:ON ACTION controlp INFIELD qcbd007 name="construct.c.page1.qcbd007"
            {<point name="construct.c.page1.qcbd007" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd008
            #add-point:BEFORE FIELD qcbd008 name="construct.b.page1.qcbd008"
            {<point name="construct.b.page1.qcbd008" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd008
            
            #add-point:AFTER FIELD qcbd008 name="construct.a.page1.qcbd008"
            {<point name="construct.a.page1.qcbd008" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd008
            #add-point:ON ACTION controlp INFIELD qcbd008 name="construct.c.page1.qcbd008"
            {<point name="construct.c.page1.qcbd008" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd009
            #add-point:BEFORE FIELD qcbd009 name="construct.b.page1.qcbd009"
            {<point name="construct.b.page1.qcbd009" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd009
            
            #add-point:AFTER FIELD qcbd009 name="construct.a.page1.qcbd009"
            {<point name="construct.a.page1.qcbd009" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd009
            #add-point:ON ACTION controlp INFIELD qcbd009 name="construct.c.page1.qcbd009"
            {<point name="construct.c.page1.qcbd009" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd010
            #add-point:BEFORE FIELD qcbd010 name="construct.b.page1.qcbd010"
            {<point name="construct.b.page1.qcbd010" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd010
            
            #add-point:AFTER FIELD qcbd010 name="construct.a.page1.qcbd010"
            {<point name="construct.a.page1.qcbd010" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd010
            #add-point:ON ACTION controlp INFIELD qcbd010 name="construct.c.page1.qcbd010"
            {<point name="construct.c.page1.qcbd010" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd021
            #add-point:BEFORE FIELD qcbd021 name="construct.b.page1.qcbd021"
            {<point name="construct.b.page1.qcbd021" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd021
            
            #add-point:AFTER FIELD qcbd021 name="construct.a.page1.qcbd021"
            {<point name="construct.a.page1.qcbd021" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd021
            #add-point:ON ACTION controlp INFIELD qcbd021 name="construct.c.page1.qcbd021"
            {<point name="construct.c.page1.qcbd021" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd011
            #add-point:BEFORE FIELD qcbd011 name="construct.b.page1.qcbd011"
            {<point name="construct.b.page1.qcbd011" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd011
            
            #add-point:AFTER FIELD qcbd011 name="construct.a.page1.qcbd011"
            {<point name="construct.a.page1.qcbd011" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.qcbd011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd011
            #add-point:ON ACTION controlp INFIELD qcbd011 name="construct.c.page1.qcbd011"
            {<point name="construct.c.page1.qcbd011" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD ooff013
            #add-point:BEFORE FIELD ooff013 name="construct.b.page1.ooff013"
            {<point name="construct.b.page1.ooff013" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD ooff013
            
            #add-point:AFTER FIELD ooff013 name="construct.a.page1.ooff013"
            {<point name="construct.a.page1.ooff013" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.ooff013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD ooff013
            #add-point:ON ACTION controlp INFIELD ooff013 name="construct.c.page1.ooff013"
            {<point name="construct.c.page1.ooff013" />}
            #END add-point
 
 
   
       
      END CONSTRUCT
      
      CONSTRUCT g_wc2_table2 ON qcbb001,qcbb002,qcbb003,qcbb004,qcbb005,qcbb006
           FROM s_detail4[1].qcbb001,s_detail4[1].qcbb002,s_detail4[1].qcbb003,s_detail4[1].qcbb004, 
               s_detail4[1].qcbb005,s_detail4[1].qcbb006
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body2.before_construct"
            {<point name="cs.body2.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 2)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb001
            #add-point:BEFORE FIELD qcbb001 name="construct.b.page4.qcbb001"
            {<point name="construct.b.page4.qcbb001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb001
            
            #add-point:AFTER FIELD qcbb001 name="construct.a.page4.qcbb001"
            {<point name="construct.a.page4.qcbb001" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.qcbb001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb001
            #add-point:ON ACTION controlp INFIELD qcbb001 name="construct.c.page4.qcbb001"
            {<point name="construct.c.page4.qcbb001" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb002
            #add-point:BEFORE FIELD qcbb002 name="construct.b.page4.qcbb002"
            {<point name="construct.b.page4.qcbb002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb002
            
            #add-point:AFTER FIELD qcbb002 name="construct.a.page4.qcbb002"
            {<point name="construct.a.page4.qcbb002" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.qcbb002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb002
            #add-point:ON ACTION controlp INFIELD qcbb002 name="construct.c.page4.qcbb002"
            {<point name="construct.c.page4.qcbb002" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb003
            #add-point:BEFORE FIELD qcbb003 name="construct.b.page4.qcbb003"
            {<point name="construct.b.page4.qcbb003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb003
            
            #add-point:AFTER FIELD qcbb003 name="construct.a.page4.qcbb003"
            {<point name="construct.a.page4.qcbb003" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.qcbb003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb003
            #add-point:ON ACTION controlp INFIELD qcbb003 name="construct.c.page4.qcbb003"
            {<point name="construct.c.page4.qcbb003" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb004
            #add-point:BEFORE FIELD qcbb004 name="construct.b.page4.qcbb004"
            {<point name="construct.b.page4.qcbb004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb004
            
            #add-point:AFTER FIELD qcbb004 name="construct.a.page4.qcbb004"
            {<point name="construct.a.page4.qcbb004" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.qcbb004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb004
            #add-point:ON ACTION controlp INFIELD qcbb004 name="construct.c.page4.qcbb004"
            {<point name="construct.c.page4.qcbb004" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb005
            #add-point:BEFORE FIELD qcbb005 name="construct.b.page4.qcbb005"
            {<point name="construct.b.page4.qcbb005" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb005
            
            #add-point:AFTER FIELD qcbb005 name="construct.a.page4.qcbb005"
            {<point name="construct.a.page4.qcbb005" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.qcbb005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb005
            #add-point:ON ACTION controlp INFIELD qcbb005 name="construct.c.page4.qcbb005"
            {<point name="construct.c.page4.qcbb005" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb006
            #add-point:BEFORE FIELD qcbb006 name="construct.b.page4.qcbb006"
            {<point name="construct.b.page4.qcbb006" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb006
            
            #add-point:AFTER FIELD qcbb006 name="construct.a.page4.qcbb006"
            {<point name="construct.a.page4.qcbb006" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.qcbb006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb006
            #add-point:ON ACTION controlp INFIELD qcbb006 name="construct.c.page4.qcbb006"
            {<point name="construct.c.page4.qcbb006" />}
            #END add-point
 
 
   
       
      END CONSTRUCT
 
      CONSTRUCT g_wc2_table3 ON qcbcseq,qcbc001,qcbc002,qcbc002_desc,qcbc012,qcbc013,qcbc003,qcbc004, 
          qcbc004_desc,qcbc005,qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011
           FROM s_detail5[1].qcbcseq,s_detail5[1].qcbc001,s_detail5[1].qcbc002,s_detail5[1].qcbc002_desc, 
               s_detail5[1].qcbc012,s_detail5[1].qcbc013,s_detail5[1].qcbc003,s_detail5[1].qcbc004,s_detail5[1].qcbc004_desc, 
               s_detail5[1].qcbc005,s_detail5[1].qcbc006,s_detail5[1].qcbc007,s_detail5[1].qcbc008,s_detail5[1].qcbc009, 
               s_detail5[1].qcbc010,s_detail5[1].qcbc011
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body3.before_construct"
            {<point name="cs.body3.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 3)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbcseq
            #add-point:BEFORE FIELD qcbcseq name="construct.b.page5.qcbcseq"
            {<point name="construct.b.page5.qcbcseq" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbcseq
            
            #add-point:AFTER FIELD qcbcseq name="construct.a.page5.qcbcseq"
            {<point name="construct.a.page5.qcbcseq" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbcseq
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbcseq
            #add-point:ON ACTION controlp INFIELD qcbcseq name="construct.c.page5.qcbcseq"
            {<point name="construct.c.page5.qcbcseq" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc001
            #add-point:BEFORE FIELD qcbc001 name="construct.b.page5.qcbc001"
            {<point name="construct.b.page5.qcbc001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc001
            
            #add-point:AFTER FIELD qcbc001 name="construct.a.page5.qcbc001"
            {<point name="construct.a.page5.qcbc001" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc001
            #add-point:ON ACTION controlp INFIELD qcbc001 name="construct.c.page5.qcbc001"
            {<point name="construct.c.page5.qcbc001" />}
            #END add-point
 
 
         #Ctrlp:construct.c.page5.qcbc002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc002
            #add-point:ON ACTION controlp INFIELD qcbc002 name="construct.c.page5.qcbc002"
            {<point name="construct.c.page5.qcbc002" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc002
            #add-point:BEFORE FIELD qcbc002 name="construct.b.page5.qcbc002"
            {<point name="construct.b.page5.qcbc002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc002
            
            #add-point:AFTER FIELD qcbc002 name="construct.a.page5.qcbc002"
            {<point name="construct.a.page5.qcbc002" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc002_desc
            #add-point:BEFORE FIELD qcbc002_desc name="construct.b.page5.qcbc002_desc"
            {<point name="construct.b.page5.qcbc002_desc" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc002_desc
            
            #add-point:AFTER FIELD qcbc002_desc name="construct.a.page5.qcbc002_desc"
            {<point name="construct.a.page5.qcbc002_desc" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc002_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc002_desc
            #add-point:ON ACTION controlp INFIELD qcbc002_desc name="construct.c.page5.qcbc002_desc"
            {<point name="construct.c.page5.qcbc002_desc" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc012
            #add-point:BEFORE FIELD qcbc012 name="construct.b.page5.qcbc012"
            {<point name="construct.b.page5.qcbc012" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc012
            
            #add-point:AFTER FIELD qcbc012 name="construct.a.page5.qcbc012"
            {<point name="construct.a.page5.qcbc012" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc012
            #add-point:ON ACTION controlp INFIELD qcbc012 name="construct.c.page5.qcbc012"
            {<point name="construct.c.page5.qcbc012" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc013
            #add-point:BEFORE FIELD qcbc013 name="construct.b.page5.qcbc013"
            {<point name="construct.b.page5.qcbc013" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc013
            
            #add-point:AFTER FIELD qcbc013 name="construct.a.page5.qcbc013"
            {<point name="construct.a.page5.qcbc013" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc013
            #add-point:ON ACTION controlp INFIELD qcbc013 name="construct.c.page5.qcbc013"
            {<point name="construct.c.page5.qcbc013" />}
            #END add-point
 
 
         #Ctrlp:construct.c.page5.qcbc003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc003
            #add-point:ON ACTION controlp INFIELD qcbc003 name="construct.c.page5.qcbc003"
            {<point name="construct.c.page5.qcbc003" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc003
            #add-point:BEFORE FIELD qcbc003 name="construct.b.page5.qcbc003"
            {<point name="construct.b.page5.qcbc003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc003
            
            #add-point:AFTER FIELD qcbc003 name="construct.a.page5.qcbc003"
            {<point name="construct.a.page5.qcbc003" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc004
            #add-point:BEFORE FIELD qcbc004 name="construct.b.page5.qcbc004"
            {<point name="construct.b.page5.qcbc004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc004
            
            #add-point:AFTER FIELD qcbc004 name="construct.a.page5.qcbc004"
            {<point name="construct.a.page5.qcbc004" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc004
            #add-point:ON ACTION controlp INFIELD qcbc004 name="construct.c.page5.qcbc004"
            {<point name="construct.c.page5.qcbc004" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc004_desc
            #add-point:BEFORE FIELD qcbc004_desc name="construct.b.page5.qcbc004_desc"
            {<point name="construct.b.page5.qcbc004_desc" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc004_desc
            
            #add-point:AFTER FIELD qcbc004_desc name="construct.a.page5.qcbc004_desc"
            {<point name="construct.a.page5.qcbc004_desc" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc004_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc004_desc
            #add-point:ON ACTION controlp INFIELD qcbc004_desc name="construct.c.page5.qcbc004_desc"
            {<point name="construct.c.page5.qcbc004_desc" />}
            #END add-point
 
 
         #Ctrlp:construct.c.page5.qcbc005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc005
            #add-point:ON ACTION controlp INFIELD qcbc005 name="construct.c.page5.qcbc005"
            {<point name="construct.c.page5.qcbc005" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc005
            #add-point:BEFORE FIELD qcbc005 name="construct.b.page5.qcbc005"
            {<point name="construct.b.page5.qcbc005" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc005
            
            #add-point:AFTER FIELD qcbc005 name="construct.a.page5.qcbc005"
            {<point name="construct.a.page5.qcbc005" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc006
            #add-point:ON ACTION controlp INFIELD qcbc006 name="construct.c.page5.qcbc006"
            {<point name="construct.c.page5.qcbc006" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc006
            #add-point:BEFORE FIELD qcbc006 name="construct.b.page5.qcbc006"
            {<point name="construct.b.page5.qcbc006" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc006
            
            #add-point:AFTER FIELD qcbc006 name="construct.a.page5.qcbc006"
            {<point name="construct.a.page5.qcbc006" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc007
            #add-point:BEFORE FIELD qcbc007 name="construct.b.page5.qcbc007"
            {<point name="construct.b.page5.qcbc007" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc007
            
            #add-point:AFTER FIELD qcbc007 name="construct.a.page5.qcbc007"
            {<point name="construct.a.page5.qcbc007" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc007
            #add-point:ON ACTION controlp INFIELD qcbc007 name="construct.c.page5.qcbc007"
            {<point name="construct.c.page5.qcbc007" />}
            #END add-point
 
 
         #Ctrlp:construct.c.page5.qcbc008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc008
            #add-point:ON ACTION controlp INFIELD qcbc008 name="construct.c.page5.qcbc008"
            {<point name="construct.c.page5.qcbc008" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc008
            #add-point:BEFORE FIELD qcbc008 name="construct.b.page5.qcbc008"
            {<point name="construct.b.page5.qcbc008" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc008
            
            #add-point:AFTER FIELD qcbc008 name="construct.a.page5.qcbc008"
            {<point name="construct.a.page5.qcbc008" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc009
            #add-point:BEFORE FIELD qcbc009 name="construct.b.page5.qcbc009"
            {<point name="construct.b.page5.qcbc009" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc009
            
            #add-point:AFTER FIELD qcbc009 name="construct.a.page5.qcbc009"
            {<point name="construct.a.page5.qcbc009" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc009
            #add-point:ON ACTION controlp INFIELD qcbc009 name="construct.c.page5.qcbc009"
            {<point name="construct.c.page5.qcbc009" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc010
            #add-point:BEFORE FIELD qcbc010 name="construct.b.page5.qcbc010"
            {<point name="construct.b.page5.qcbc010" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc010
            
            #add-point:AFTER FIELD qcbc010 name="construct.a.page5.qcbc010"
            {<point name="construct.a.page5.qcbc010" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc010
            #add-point:ON ACTION controlp INFIELD qcbc010 name="construct.c.page5.qcbc010"
            {<point name="construct.c.page5.qcbc010" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc011
            #add-point:BEFORE FIELD qcbc011 name="construct.b.page5.qcbc011"
            {<point name="construct.b.page5.qcbc011" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc011
            
            #add-point:AFTER FIELD qcbc011 name="construct.a.page5.qcbc011"
            {<point name="construct.a.page5.qcbc011" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.qcbc011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc011
            #add-point:ON ACTION controlp INFIELD qcbc011 name="construct.c.page5.qcbc011"
            {<point name="construct.c.page5.qcbc011" />}
            #END add-point
 
 
   
       
      END CONSTRUCT
 
 
      
      CONSTRUCT g_wc2_table4 ON qcbe001,qcbe002,qcbe004,qcbe003
           FROM s_detail2[1].qcbe001,s_detail2[1].qcbe002,s_detail2[1].qcbe004,s_detail2[1].qcbe003
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body4.before_construct"
            {<point name="cs.body4.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 4)
       
       
       #單身一般欄位開窗相關處理       
                #Ctrlp:construct.c.page2.qcbe001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe001
            #add-point:ON ACTION controlp INFIELD qcbe001 name="construct.c.page2.qcbe001"
            {<point name="construct.c.page2.qcbe001" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe001
            #add-point:BEFORE FIELD qcbe001 name="construct.b.page2.qcbe001"
            {<point name="construct.b.page2.qcbe001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe001
            
            #add-point:AFTER FIELD qcbe001 name="construct.a.page2.qcbe001"
            {<point name="construct.a.page2.qcbe001" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe002
            #add-point:BEFORE FIELD qcbe002 name="construct.b.page2.qcbe002"
            {<point name="construct.b.page2.qcbe002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe002
            
            #add-point:AFTER FIELD qcbe002 name="construct.a.page2.qcbe002"
            {<point name="construct.a.page2.qcbe002" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.qcbe002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe002
            #add-point:ON ACTION controlp INFIELD qcbe002 name="construct.c.page2.qcbe002"
            {<point name="construct.c.page2.qcbe002" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe004
            #add-point:BEFORE FIELD qcbe004 name="construct.b.page2.qcbe004"
            {<point name="construct.b.page2.qcbe004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe004
            
            #add-point:AFTER FIELD qcbe004 name="construct.a.page2.qcbe004"
            {<point name="construct.a.page2.qcbe004" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.qcbe004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe004
            #add-point:ON ACTION controlp INFIELD qcbe004 name="construct.c.page2.qcbe004"
            {<point name="construct.c.page2.qcbe004" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe003
            #add-point:BEFORE FIELD qcbe003 name="construct.b.page2.qcbe003"
            {<point name="construct.b.page2.qcbe003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe003
            
            #add-point:AFTER FIELD qcbe003 name="construct.a.page2.qcbe003"
            {<point name="construct.a.page2.qcbe003" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.qcbe003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe003
            #add-point:ON ACTION controlp INFIELD qcbe003 name="construct.c.page2.qcbe003"
            {<point name="construct.c.page2.qcbe003" />}
            #END add-point
 
 
   
       
      END CONSTRUCT
 
      CONSTRUCT g_wc2_table5 ON qcbg001,qcbg002,qcbg003,qcbgsite
           FROM s_detail7[1].qcbg001,s_detail7[1].qcbg002,s_detail7[1].qcbg003,s_detail7[1].qcbgsite
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body5.before_construct"
            {<point name="cs.body5.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 5)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbg001
            #add-point:BEFORE FIELD qcbg001 name="construct.b.page7.qcbg001"
            {<point name="construct.b.page7.qcbg001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbg001
            
            #add-point:AFTER FIELD qcbg001 name="construct.a.page7.qcbg001"
            {<point name="construct.a.page7.qcbg001" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page7.qcbg001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbg001
            #add-point:ON ACTION controlp INFIELD qcbg001 name="construct.c.page7.qcbg001"
            {<point name="construct.c.page7.qcbg001" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbg002
            #add-point:BEFORE FIELD qcbg002 name="construct.b.page7.qcbg002"
            {<point name="construct.b.page7.qcbg002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbg002
            
            #add-point:AFTER FIELD qcbg002 name="construct.a.page7.qcbg002"
            {<point name="construct.a.page7.qcbg002" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page7.qcbg002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbg002
            #add-point:ON ACTION controlp INFIELD qcbg002 name="construct.c.page7.qcbg002"
            {<point name="construct.c.page7.qcbg002" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbg003
            #add-point:BEFORE FIELD qcbg003 name="construct.b.page7.qcbg003"
            {<point name="construct.b.page7.qcbg003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbg003
            
            #add-point:AFTER FIELD qcbg003 name="construct.a.page7.qcbg003"
            {<point name="construct.a.page7.qcbg003" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page7.qcbg003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbg003
            #add-point:ON ACTION controlp INFIELD qcbg003 name="construct.c.page7.qcbg003"
            {<point name="construct.c.page7.qcbg003" />}
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbgsite
            #add-point:BEFORE FIELD qcbgsite name="construct.b.page7.qcbgsite"
            {<point name="construct.b.page7.qcbgsite" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbgsite
            
            #add-point:AFTER FIELD qcbgsite name="construct.a.page7.qcbgsite"
            {<point name="construct.a.page7.qcbgsite" />}
            #END add-point
            
 
 
         #Ctrlp:construct.c.page7.qcbgsite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbgsite
            #add-point:ON ACTION controlp INFIELD qcbgsite name="construct.c.page7.qcbgsite"
            {<point name="construct.c.page7.qcbgsite" />}
            #END add-point
 
 
   
       
      END CONSTRUCT
 
 
      
      #add-point:cs段add_cs(本段內只能出現新的CONSTRUCT指令) name="cs.add_cs"
      {<point name="cs.add_cs"/>}
      #end add-point
 
      BEFORE DIALOG
         CALL cl_qbe_init()
         #add-point:cs段b_dialog name="cs.b_dialog"
         {<point name="cs.b_dialog"/>}
         #end add-point  
 
      #查詢方案列表
      ON ACTION qbe_select
         LET ls_wc = ""
         CALL cl_qbe_list("c") RETURNING ls_wc
         IF NOT cl_null(ls_wc) THEN
            CALL util.JSON.parse(ls_wc, la_wc)
            INITIALIZE g_wc, g_wc2, g_wc2_table1, g_wc2_extend TO NULL
            INITIALIZE g_wc2_table2 TO NULL
 
            INITIALIZE g_wc2_table3 TO NULL
 
 
            FOR li_idx = 1 TO la_wc.getLength()
               CASE
                  WHEN la_wc[li_idx].tableid = "qcba_t" 
                     LET g_wc = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "qcbd_t" 
                     LET g_wc2_table1 = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "qcbb_t" 
                     LET g_wc2_table2 = la_wc[li_idx].wc
 
                  WHEN la_wc[li_idx].tableid = "qcbc_t" 
                     LET g_wc2_table3 = la_wc[li_idx].wc
 
 
               END CASE
            END FOR
         END IF
    
      #條件儲存為方案
      ON ACTION qbe_save
         CALL cl_qbe_save()
 
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   END DIALOG
   
   #組合g_wc2
   LET g_wc2 = g_wc2_table1
   IF g_wc2_table2 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
   END IF
 
   IF g_wc2_table3 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
   END IF
 
 
 
   IF g_wc2_table4 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table4
   END IF
 
   IF g_wc2_table5 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table5
   END IF
 
 
   
   #add-point:cs段結束前 name="cs.after_construct"
   {<point name="cs.after_construct"/>}
   #end add-point    
 
   IF INT_FLAG THEN
      RETURN
   END IF
 
END FUNCTION
]]>
</section>
  <section id="aqct300.filter" ver="14" ch="" status="" src="s" readonly="">
<![CDATA[#應用 a50 樣板自動產生(Version:8)
#+ filter過濾功能
PRIVATE FUNCTION aqct300_filter()
   #add-point:filter段define name="filter.define_customerization"
   {<point name="filter.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   #add-point:filter段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="filter.define"
   {<point name="filter.define"/>}
   #end add-point   
   
   #add-point:Function前置處理  name="filter.pre_function"
   {<point name="filter.pre_function"/>}
   #end add-point
   
   #切換畫面
   IF NOT g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF   
 
   LET INT_FLAG = 0
 
   LET g_qryparam.state = 'c'
 
   LET g_wc_filter_t = g_wc_filter.trim()
   LET g_wc_t = g_wc
 
   LET g_wc = cl_replace_str(g_wc, g_wc_filter_t, '')
 
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
      #單頭
      CONSTRUCT g_wc_filter ON qcbadocno,qcbadocdt,qcbasite,qcba000,qcba900,qcba901
                          FROM s_browse[1].b_qcbadocno,s_browse[1].b_qcbadocdt,s_browse[1].b_qcbasite, 
                              s_browse[1].b_qcba000,s_browse[1].b_qcba900,s_browse[1].b_qcba901
 
         BEFORE CONSTRUCT
               DISPLAY aqct300_filter_parser('qcbadocno') TO s_browse[1].b_qcbadocno
            DISPLAY aqct300_filter_parser('qcbadocdt') TO s_browse[1].b_qcbadocdt
            DISPLAY aqct300_filter_parser('qcbasite') TO s_browse[1].b_qcbasite
            DISPLAY aqct300_filter_parser('qcba000') TO s_browse[1].b_qcba000
            DISPLAY aqct300_filter_parser('qcba900') TO s_browse[1].b_qcba900
            DISPLAY aqct300_filter_parser('qcba901') TO s_browse[1].b_qcba901
      
         #add-point:filter段cs_ctrl name="filter.cs_ctrl"
         {<point name="filter.cs_ctrl"/>}
         #end add-point
      
      END CONSTRUCT
 
      #add-point:filter段add_cs name="filter.add_cs"
      {<point name="filter.add_cs"/>}
      #end add-point
 
      BEFORE DIALOG
         #add-point:filter段b_dialog name="filter.b_dialog"
         {<point name="filter.b_dialog"/>}
         #end add-point  
      
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   
   END DIALOG
 
   IF NOT INT_FLAG THEN
      LET g_wc_filter = "   AND   ", g_wc_filter, "   "
      LET g_wc = g_wc , g_wc_filter
   ELSE
      LET g_wc_filter = g_wc_filter_t
      LET g_wc = g_wc_t
   END IF
 
      CALL aqct300_filter_show('qcbadocno')
   CALL aqct300_filter_show('qcbadocdt')
   CALL aqct300_filter_show('qcbasite')
   CALL aqct300_filter_show('qcba000')
   CALL aqct300_filter_show('qcba900')
   CALL aqct300_filter_show('qcba901')
 
END FUNCTION
]]>
</section>
  <section id="aqct300.filter_parser" ver="6" ch="" status="" src="s" readonly="">
<![CDATA[#+ filter過濾功能
PRIVATE FUNCTION aqct300_filter_parser(ps_field)
   #add-point:filter段define name="filter_parser.define_customerization"
   {<point name="filter_parser.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num10
   DEFINE li_tmp2    LIKE type_t.num10
   DEFINE ls_var     STRING
   #add-point:filter段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="filter_parser.define"
   {<point name="filter_parser.define"/>}
   #end add-point    
   
   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF
 
   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF
 
   RETURN ls_var
 
END FUNCTION
]]>
</section>
  <section id="aqct300.filter_show" ver="2" ch="" status="" src="s" readonly="">
<![CDATA[#+ 顯示過濾條件
PRIVATE FUNCTION aqct300_filter_show(ps_field)
   DEFINE ps_field         STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING
 
   LET ls_name = "formonly.b_", ps_field
   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LEt ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF
 
   #顯示資料組合
   LET ls_condition = aqct300_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF
 
   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)
 
END FUNCTION
]]>
</section>
  <section id="aqct300.query" ver="19" ch="" status="" src="s" readonly="">
<![CDATA[#+ 資料查詢QBE功能準備
PRIVATE FUNCTION aqct300_query()
   #add-point:query段define(客製用) name="query.define_customerization"
   {<point name="query.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   DEFINE ls_wc STRING
   #add-point:query段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="query.define"
   {<point name="query.define"/>} 
   #end add-point   
   
   #add-point:Function前置處理  name="query.pre_function"
   {<point name="query.pre_function"/>}
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF   
   
   LET ls_wc = g_wc
   
   LET INT_FLAG = 0
   CALL cl_navigator_setting( g_current_idx, g_detail_cnt )
   ERROR ""
   
   #清除畫面及相關資料
   CLEAR FORM
   CALL g_browser.clear()       
   CALL g_qcbd_d.clear()
   CALL g_qcbd2_d.clear()
   CALL g_qcbd4_d.clear()
   CALL g_qcbd5_d.clear()
   CALL g_qcbd7_d.clear()
 
   
   #add-point:query段other name="query.other"
   {<point name="query.other"/>}
   #end add-point   
   
   DISPLAY '' TO FORMONLY.idx
   DISPLAY '' TO FORMONLY.cnt
   DISPLAY '' TO FORMONLY.b_index
   DISPLAY '' TO FORMONLY.b_count
   DISPLAY '' TO FORMONLY.h_index
   DISPLAY '' TO FORMONLY.h_count
   
   CALL aqct300_construct()
 
   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      #LET g_wc = ls_wc
      LET g_wc = " 1=2"
      CALL aqct300_browser_fill("")
      CALL aqct300_fetch("")
      RETURN
   END IF
   
   #儲存WC資訊
   CALL cl_dlg_save_user_latestqry("("||g_wc||") AND ("||g_wc2||")")
   
   #搜尋後資料初始化 
   LET g_detail_cnt  = 0
   LET g_current_idx = 1
   LET g_current_row = 0
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   LET g_detail_idx_list[1] = 1
   LET g_detail_idx_list[2] = 1
   LET g_detail_idx_list[3] = 1
   LET g_detail_idx_list[4] = 1
   LET g_detail_idx_list[5] = 1
 
   LET g_error_show  = 1
   LET g_wc_filter   = ""
   LET l_ac = 1
   CALL FGL_SET_ARR_CURR(1)
      CALL aqct300_filter_show('qcbadocno')
   CALL aqct300_filter_show('qcbadocdt')
   CALL aqct300_filter_show('qcbasite')
   CALL aqct300_filter_show('qcba000')
   CALL aqct300_filter_show('qcba900')
   CALL aqct300_filter_show('qcba901')
   CALL aqct300_browser_fill("F")
         
   IF g_browser_cnt = 0 THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "-100" 
      LET g_errparam.popup = TRUE 
      CALL cl_err()
   ELSE
      CALL aqct300_fetch("F") 
      #顯示單身筆數
      CALL aqct300_idx_chk()
   END IF
 
END FUNCTION
]]>
</section>
  <section id="aqct300.fetch" ver="35" ch="" status="" src="s" readonly="">
<![CDATA[#+ 指定PK後抓取單頭其他資料
PRIVATE FUNCTION aqct300_fetch(p_flag)
   #add-point:fetch段define(客製用) name="fetch.define_customerization"
   {<point name="fetch.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   #add-point:fetch段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="fetch.define"
   {<point name="fetch.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理  name="fetch.pre_function"
   {<point name="fetch.pre_function"/>}
   #end add-point
   
   IF g_browser_cnt = 0 THEN
      RETURN
   END IF
 
   #清空第二階單身
   CALL g_qcbd2_d.clear()
   CALL g_qcbd7_d.clear()
 
   
   CALL cl_ap_performance_next_start()
   CASE p_flag
      WHEN 'F' 
         LET g_current_idx = 1
      WHEN 'L'  
         LET g_current_idx = g_browser.getLength()              
      WHEN 'P'
         IF g_current_idx > 1 THEN               
            LET g_current_idx = g_current_idx - 1
         END IF 
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF        
      WHEN '/'
         IF (NOT g_no_ask) THEN    
            CALL cl_set_act_visible("accept,cancel", TRUE)    
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0
 
            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl" 
            END PROMPT
 
            CALL cl_set_act_visible("accept,cancel", FALSE)    
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE  
            END IF           
         END IF
         
         IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
             LET g_current_idx = g_jump
         END IF
         LET g_no_ask = FALSE  
   END CASE 
 
   CALL g_curr_diag.setCurrentRow("s_browse", g_current_idx) #設定browse 索引
   
   LET g_current_row = g_current_idx
   LET g_detail_cnt = g_header_cnt                  
   
   #單身總筆數顯示
   IF g_detail_cnt > 0 THEN
      #若單身有資料時, idx至少為1
      IF g_detail_idx <= 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx  
   ELSE
      LET g_detail_idx = 0
      DISPLAY '' TO FORMONLY.idx    
   END IF
   
   #瀏覽頁筆數顯示
   LET g_browser_idx = g_pagestart+g_current_idx-1
   DISPLAY g_browser_idx TO FORMONLY.b_index   #當下筆數
   DISPLAY g_browser_idx TO FORMONLY.h_index   #當下筆數
   
   CALL cl_navigator_setting( g_current_idx, g_browser_cnt )
 
   #代表沒有資料
   IF g_current_idx = 0 OR g_browser.getLength() = 0 THEN
      RETURN
   END IF
   
   #避免超出browser資料筆數上限
   IF g_current_idx > g_browser.getLength() THEN
      LET g_browser_idx = g_browser.getLength()
      LET g_current_idx = g_browser.getLength()
   END IF
   
   LET g_qcba_m.qcbadocno = g_browser[g_current_idx].b_qcbadocno
 
   
   #重讀DB,因TEMP有不被更新特性
   EXECUTE aqct300_master_referesh USING g_qcba_m.qcbadocno INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt, 
       g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017, 
       g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
       g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018, 
       g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026, 
       g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp, 
       g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt, 
       g_qcba_m.qcba900_desc,g_qcba_m.qcba901_desc,g_qcba_m.qcba005_desc,g_qcba_m.qcba009_desc,g_qcba_m.qcba013_desc, 
       g_qcba_m.qcba024_desc,g_qcba_m.qcba016_desc,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid_desc, 
       g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbacnfid_desc
   
   #遮罩相關處理
   LET g_qcba_m_mask_o.* =  g_qcba_m.*
   CALL aqct300_qcba_t_mask()
   LET g_qcba_m_mask_n.* =  g_qcba_m.*
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL aqct300_set_act_visible()   
   CALL aqct300_set_act_no_visible()
   
   #add-point:fetch段action控制 name="fetch.action_control"
   {<point name="fetch.action_control"/>}
   #end add-point  
   
   
   
   #add-point:fetch結束前 name="fetch.after"
   {<point name="fetch.after" />}
   #end add-point
   
   #保存單頭舊值
   LET g_qcba_m_t.* = g_qcba_m.*
   LET g_qcba_m_o.* = g_qcba_m.*
   
   LET g_data_owner = g_qcba_m.qcbaownid      
   LET g_data_dept  = g_qcba_m.qcbaowndp
   
   #重新顯示   
   CALL aqct300_show()
 
   #應用 a56 樣板自動產生(Version:3)
   #檢查此單據是否需顯示BPM簽核狀況按鈕 
   IF cl_bpm_chk() THEN
      CALL cl_set_act_visible("bpm_status",TRUE)
   ELSE
      CALL cl_set_act_visible("bpm_status",FALSE)
   END IF
 
 
 
 
 
END FUNCTION
]]>
</section>
  <section id="aqct300.insert" ver="51" ch="" status="" src="s" readonly="">
<![CDATA[#+ 資料新增
PRIVATE FUNCTION aqct300_insert()
   #add-point:insert段define(客製用) name="insert.define_customerization"
   {<point name="insert.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   #add-point:insert段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="insert.define"
   {<point name="insert.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理  name="insert.pre_function"
   {<point name="insert.pre_function"/>}
   #end add-point
   
   #清畫面欄位內容
   CLEAR FORM                    
   CALL g_qcbd_d.clear()   
   CALL g_qcbd2_d.clear()  
   CALL g_qcbd4_d.clear()  
   CALL g_qcbd5_d.clear()  
   CALL g_qcbd7_d.clear()  
 
 
   INITIALIZE g_qcba_m.* TO NULL             #DEFAULT 設定
   
   LET g_qcbadocno_t = NULL
 
   
   LET g_master_insert = FALSE
   
   #add-point:insert段before name="insert.before"
   {<point name="insert.before"/>}
   #end add-point    
   
   CALL s_transaction_begin()
   WHILE TRUE
      #公用欄位給值(單頭)
      #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_qcba_m.qcbaownid = g_user
      LET g_qcba_m.qcbaowndp = g_dept
      LET g_qcba_m.qcbacrtid = g_user
      LET g_qcba_m.qcbacrtdp = g_dept 
      LET g_qcba_m.qcbacrtdt = cl_get_current()
      LET g_qcba_m.qcbamodid = g_user
      LET g_qcba_m.qcbamoddt = cl_get_current()
      LET g_qcba_m.qcbastus = 'N'
 
 
 
 
      #append欄位給值
      
     
      #一般欄位給值
            LET g_qcba_m.qcba000 = "1"
      LET g_qcba_m.qcba029 = "0"
      LET g_qcba_m.qcba008 = "0"
      LET g_qcba_m.qcba017 = "0"
      LET g_qcba_m.qcba021 = "C"
      LET g_qcba_m.qcba022 = "0"
      LET g_qcba_m.qcba023 = "0"
      LET g_qcba_m.qcba027 = "0"
 
  
      #add-point:單頭預設值 name="insert.default"
      {<point name="insert.default"/>}
      #end add-point 
      
      #保存單頭舊值(用於資料輸入錯誤還原預設值時使用)
      LET g_qcba_m_t.* = g_qcba_m.*
      LET g_qcba_m_o.* = g_qcba_m.*
      
      #顯示狀態(stus)圖片
            #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_qcba_m.qcbastus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
    
      CALL aqct300_input("a")
      
      #add-point:單頭輸入後 name="insert.after_insert"
      {<point name="insert.after_insert"/>}
      #end add-point
      
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code = 9001 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
      END IF
      
      IF NOT g_master_insert THEN
         DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
         DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
         INITIALIZE g_qcba_m.* TO NULL
         INITIALIZE g_qcbd_d TO NULL
         INITIALIZE g_qcbd2_d TO NULL
         INITIALIZE g_qcbd4_d TO NULL
         INITIALIZE g_qcbd5_d TO NULL
         INITIALIZE g_qcbd7_d TO NULL
 
         #add-point:取消新增後 name="insert.cancel"
         {<point name="insert.cancel"/>}
         #end add-point 
         CALL aqct300_show()
         RETURN
      END IF
      
      LET INT_FLAG = 0
      #CALL g_qcbd_d.clear()
      #CALL g_qcbd2_d.clear()
      #CALL g_qcbd4_d.clear()
      #CALL g_qcbd5_d.clear()
      #CALL g_qcbd7_d.clear()
 
 
      LET g_rec_b = 0
      CALL s_transaction_end('Y','0')
      EXIT WHILE
        
   END WHILE
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL aqct300_set_act_visible()   
   CALL aqct300_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
   
   #組合新增資料的條件
   LET g_add_browse = " qcbaent = " ||g_enterprise|| " AND",
                      " qcbadocno = '", g_qcba_m.qcbadocno, "' "
 
                      
   #add-point:組合新增資料的條件後 name="insert.after.add_browse"
   {<point name="insert.after.add_browse"/>}
   #end add-point
      
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL aqct300_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   CLOSE aqct300_cl
   
   CALL aqct300_idx_chk()
   
   #撈取異動後的資料(主要是帶出reference)
   EXECUTE aqct300_master_referesh USING g_qcba_m.qcbadocno INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt, 
       g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017, 
       g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
       g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018, 
       g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026, 
       g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp, 
       g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt, 
       g_qcba_m.qcba900_desc,g_qcba_m.qcba901_desc,g_qcba_m.qcba005_desc,g_qcba_m.qcba009_desc,g_qcba_m.qcba013_desc, 
       g_qcba_m.qcba024_desc,g_qcba_m.qcba016_desc,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid_desc, 
       g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbacnfid_desc
   
   
   #遮罩相關處理
   LET g_qcba_m_mask_o.* =  g_qcba_m.*
   CALL aqct300_qcba_t_mask()
   LET g_qcba_m_mask_n.* =  g_qcba_m.*
   
   #將資料顯示到畫面上
   DISPLAY BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba900_desc,g_qcba_m.qcbadocno_desc, 
       g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcba901_desc,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba005_desc,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009, 
       g_qcba_m.qcba009_desc,g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba012_desc, 
       g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.qcba013,g_qcba_m.qcba013_desc,g_qcba_m.qcba020,g_qcba_m.qcba021, 
       g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba024_desc,g_qcba_m.qcba016,g_qcba_m.qcba016_desc, 
       g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.imae116,g_qcba_m.qcba018,g_qcba_m.qcba019, 
       g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033, 
       g_qcba_m.qcbaownid,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid, 
       g_qcba_m.qcbacrtid_desc,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid, 
       g_qcba_m.qcbamodid_desc,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfid_desc,g_qcba_m.qcbacnfdt 

   
   #add-point:新增結束後 name="insert.after"
   {<point name="insert.after"/>}
   #end add-point 
   
   LET g_data_owner = g_qcba_m.qcbaownid      
   LET g_data_dept  = g_qcba_m.qcbaowndp
   
   #功能已完成,通報訊息中心
   CALL aqct300_msgcentre_notify('insert')
   
END FUNCTION
]]>
</section>
  <section id="aqct300.modify" ver="53" ch="" status="" src="s" readonly="">
<![CDATA[#+ 資料修改
PRIVATE FUNCTION aqct300_modify()
   #add-point:modify段define(客製用) name="modify.define_customerization"
   {<point name="modify.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   DEFINE l_new_key    DYNAMIC ARRAY OF STRING
   DEFINE l_old_key    DYNAMIC ARRAY OF STRING
   DEFINE l_field_key  DYNAMIC ARRAY OF STRING
   DEFINE l_wc2_table1          STRING
   DEFINE l_wc2_table2   STRING
 
   DEFINE l_wc2_table3   STRING
 
 
   DEFINE l_wc2_table4   STRING
 
   DEFINE l_wc2_table5   STRING
 
 
   #add-point:modify段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="modify.define"
   {<point name="modify.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理  name="modify.pre_function"
   {<point name="modify.pre_function"/>}
   #end add-point
   
   #保存單頭舊值
   LET g_qcba_m_t.* = g_qcba_m.*
   LET g_qcba_m_o.* = g_qcba_m.*
   
   IF g_qcba_m.qcbadocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   ERROR ""
  
   LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
   CALL s_transaction_begin()
   
   OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
   IF SQLCA.SQLCODE THEN   #(ver:78)
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
      LET g_errparam.popup = TRUE 
      CLOSE aqct300_cl
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE aqct300_master_referesh USING g_qcba_m.qcbadocno INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt, 
       g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017, 
       g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
       g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018, 
       g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026, 
       g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp, 
       g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt, 
       g_qcba_m.qcba900_desc,g_qcba_m.qcba901_desc,g_qcba_m.qcba005_desc,g_qcba_m.qcba009_desc,g_qcba_m.qcba013_desc, 
       g_qcba_m.qcba024_desc,g_qcba_m.qcba016_desc,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid_desc, 
       g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbacnfid_desc
   
   #檢查是否允許此動作
   IF NOT aqct300_action_chk() THEN
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_qcba_m_mask_o.* =  g_qcba_m.*
   CALL aqct300_qcba_t_mask()
   LET g_qcba_m_mask_n.* =  g_qcba_m.*
   
   
   
   #add-point:modify段show之前 name="modify.before_show"
   {<point name="modify.before_show"/>}
   #end add-point  
   
   #LET l_wc2_table1 = g_wc2_table1
   #LET g_wc2_table1 = " 1=1"
   #LET l_wc2_table2 = g_wc2_table2
   #LET l_wc2_table2 = " 1=1"
 
   #LET l_wc2_table3 = g_wc2_table3
   #LET l_wc2_table3 = " 1=1"
 
 
   #LET l_wc2_table4 = g_wc2_table4
   #LET l_wc2_table4 = " 1=1"
 
   #LET l_wc2_table5 = g_wc2_table5
   #LET l_wc2_table5 = " 1=1"
 
 
   
   CALL aqct300_show()
   #add-point:modify段show之後 name="modify.after_show"
   {<point name="modify.after_show"/>}
   #end add-point
   
   #LET g_wc2_table1 = l_wc2_table1
   #LET  g_wc2_table2 = l_wc2_table2 
 
   #LET  g_wc2_table3 = l_wc2_table3 
 
 
   #LET  g_wc2_table4 = l_wc2_table4 
 
   #LET  g_wc2_table5 = l_wc2_table5 
 
 
    
   WHILE TRUE
      LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
      
      #寫入修改者/修改日期資訊(單頭)
      LET g_qcba_m.qcbamodid = g_user 
LET g_qcba_m.qcbamoddt = cl_get_current()
LET g_qcba_m.qcbamodid_desc = cl_get_username(g_qcba_m.qcbamodid)
      
      #add-point:modify段修改前 name="modify.before_input"
      {<point name="modify.before_input"/>}
      #end add-point
      
      #欄位更改
      LET g_loc = 'n'
      LET g_update = FALSE
      LET g_master_commit = "N"
      CALL aqct300_input("u")
      LET g_loc = 'n'
 
      #add-point:modify段修改後 name="modify.after_input"
      {<point name="modify.after_input"/>}
      #end add-point
      
      IF g_update OR NOT INT_FLAG THEN
         #若有modid跟moddt則進行update
         UPDATE qcba_t SET (qcbamodid,qcbamoddt) = (g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt)
          WHERE qcbaent = g_enterprise AND qcbadocno = g_qcbadocno_t
 
      END IF
    
      IF INT_FLAG THEN
         CALL s_transaction_end('N','0')
         LET INT_FLAG = 0
         #若單頭無commit則還原
         IF g_master_commit = "N" THEN
            LET g_qcba_m.* = g_qcba_m_t.*
            CALL aqct300_show()
         END IF
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code = 9001 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN
      END IF 
                  
      #若單頭key欄位有變更
      IF g_qcba_m.qcbadocno != g_qcba_m_t.qcbadocno
 
      THEN
         CALL s_transaction_begin()
         
         #add-point:單身fk修改前 name="modify.body.b_fk_update"
         {<point name="modify.body.b_fk_update" mark="Y"/>}
         #end add-point
         
         #更新單身key值
         UPDATE qcbd_t SET qcbddocno = g_qcba_m.qcbadocno
 
          WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m_t.qcbadocno
 
            
         #add-point:單身fk修改中 name="modify.body.m_fk_update"
         {<point name="modify.body.m_fk_update"/>}
         #end add-point
 
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "qcbd_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbd_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         
         #add-point:單身fk修改後 name="modify.body.a_fk_update"
         {<point name="modify.body.a_fk_update"/>}
         #end add-point
         
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update2"
         {<point name="modify.body.b_fk_update2" mark="Y"/>}
         #end add-point
         
         UPDATE qcbb_t
            SET qcbbdocno = g_qcba_m.qcbadocno
 
          WHERE qcbbent = g_enterprise AND
                qcbbdocno = g_qcbadocno_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update2"
         {<point name="modify.body.m_fk_update2"/>}
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "qcbb_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbb_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update2"
         {<point name="modify.body.a_fk_update2"/>}
         #end add-point
 
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update3"
         {<point name="modify.body.b_fk_update3" mark="Y"/>}
         #end add-point
         
         UPDATE qcbc_t
            SET qcbcdocno = g_qcba_m.qcbadocno
 
          WHERE qcbcent = g_enterprise AND
                qcbcdocno = g_qcbadocno_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update3"
         {<point name="modify.body.m_fk_update3"/>}
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "qcbc_t" 
            #   LET g_errparam.code = "std-00009" 
            #   LET g_errparam.popup = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbc_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update3"
         {<point name="modify.body.a_fk_update3"/>}
         #end add-point
 
 
         
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update4"
         {<point name="modify.body.b_fk_update4" mark="Y"/>}
         #end add-point
         UPDATE qcbe_t
            SET qcbedocno = g_qcba_m.qcbadocno
 
          WHERE qcbeent = g_enterprise AND
                qcbedocno = g_qcbadocno_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update4"
         {<point name="modify.body.m_fk_update4"/>}
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbe_t" 
               LET g_errparam.code = "std-00009" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update4"
         {<point name="modify.body.a_fk_update4"/>}
         #end add-point
 
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update5"
         {<point name="modify.body.b_fk_update5" mark="Y"/>}
         #end add-point
         UPDATE qcbg_t
            SET qcbgdocno = g_qcba_m.qcbadocno
 
          WHERE qcbgent = g_enterprise AND
                qcbgdocno = g_qcbadocno_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update5"
         {<point name="modify.body.m_fk_update5"/>}
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbg_t" 
               LET g_errparam.code = "std-00009" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
            WHEN SQLCA.SQLCODE #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update5"
         {<point name="modify.body.a_fk_update5"/>}
         #end add-point
 
 
         
         #UPDATE 多語言table key值
         
         
         
         
         
 
         CALL s_transaction_end('Y','0')
      END IF
    
      EXIT WHILE
   END WHILE
 
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL aqct300_set_act_visible()   
   CALL aqct300_set_act_no_visible()
 
   #組合新增資料的條件
   LET g_add_browse = " qcbaent = " ||g_enterprise|| " AND",
                      " qcbadocno = '", g_qcba_m.qcbadocno, "' "
 
   #填到對應位置
   CALL aqct300_browser_fill("")
 
   CLOSE aqct300_cl
   
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL aqct300_msgcentre_notify('modify')
 
END FUNCTION 
]]>
</section>
  <section id="aqct300.input" ver="30" ch="" status="" src="s" readonly="">
<![CDATA[#+ 資料輸入
PRIVATE FUNCTION aqct300_input(p_cmd)
   #add-point:input段define(客製用) name="input.define_customerization"
   {<point name="input.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   DEFINE  p_cmd                 LIKE type_t.chr1
   DEFINE  l_cmd_t               LIKE type_t.chr1
   DEFINE  l_cmd                 LIKE type_t.chr1
   DEFINE  l_n                   LIKE type_t.num10                #檢查重複用  
   DEFINE  l_cnt                 LIKE type_t.num10                #檢查重複用  
   DEFINE  l_lock_sw             LIKE type_t.chr1                #單身鎖住否  
   DEFINE  l_allow_insert        LIKE type_t.num5                #可新增否 
   DEFINE  l_allow_delete        LIKE type_t.num5                #可刪除否  
   DEFINE  l_count               LIKE type_t.num10
   DEFINE  l_i                   LIKE type_t.num10
   DEFINE  l_ac_t                LIKE type_t.num10
   DEFINE  l_insert              BOOLEAN
   DEFINE  ls_return             STRING
   DEFINE  l_var_keys            DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys          DYNAMIC ARRAY OF STRING
   DEFINE  l_vars                DYNAMIC ARRAY OF STRING
   DEFINE  l_fields              DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak        DYNAMIC ARRAY OF STRING
   DEFINE  lb_reproduce          BOOLEAN
   DEFINE  li_reproduce          LIKE type_t.num10
   DEFINE  li_reproduce_target   LIKE type_t.num10
   DEFINE  ls_keys               DYNAMIC ARRAY OF VARCHAR(500)
   #add-point:input段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="input.define"
   {<point name="input.define"/>} 
   #end add-point  
   
   #add-point:Function前置處理  name="input.pre_function"
   {<point name="input.pre_function"/>}
   #end add-point
   
   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r'
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF   
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba900_desc,g_qcba_m.qcbadocno_desc, 
       g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcba901_desc,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba005_desc,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009, 
       g_qcba_m.qcba009_desc,g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba012_desc, 
       g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.qcba013,g_qcba_m.qcba013_desc,g_qcba_m.qcba020,g_qcba_m.qcba021, 
       g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba024_desc,g_qcba_m.qcba016,g_qcba_m.qcba016_desc, 
       g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.imae116,g_qcba_m.qcba018,g_qcba_m.qcba019, 
       g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033, 
       g_qcba_m.qcbaownid,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid, 
       g_qcba_m.qcbacrtid_desc,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid, 
       g_qcba_m.qcbamodid_desc,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfid_desc,g_qcba_m.qcbacnfdt 

   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
 
   CALL cl_set_head_visible("","YES")  
 
   LET l_insert = FALSE
   LET g_action_choice = ""
 
   #add-point:input段define_sql name="input.define_sql"
   {<point name="input.define_sql" mark="Y"/>}
   #end add-point 
   LET g_forupd_sql = "SELECT qcbdseq,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004,qcbd005,qcbd006,qcbd007, 
       qcbd008,qcbd009,qcbd010,qcbd021,qcbd011,qcbdsite FROM qcbd_t WHERE qcbdent=? AND qcbddocno=?  
       AND qcbdseq=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql"
   {<point name="input.after_define_sql"/>}
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_bcl CURSOR FROM g_forupd_sql
   
   #add-point:input段define_sql name="input.define_sql2"
   {<point name="input.define_sql2" mark="Y"/>}
   #end add-point    
   LET g_forupd_sql = "SELECT qcbb001,qcbb002,qcbb003,qcbb004,qcbb005,qcbb006,qcbbsite FROM qcbb_t WHERE  
       qcbbent=? AND qcbbdocno=? AND qcbb001=? AND qcbb002=? AND qcbb003=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql2"
   {<point name="input.after_define_sql2"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_bcl2 CURSOR FROM g_forupd_sql
 
   #add-point:input段define_sql name="input.define_sql3"
   {<point name="input.define_sql3" mark="Y"/>}
   #end add-point    
   LET g_forupd_sql = "SELECT qcbcseq,qcbc001,qcbc002,qcbc012,qcbc013,qcbc003,qcbc004,qcbc005,qcbc006, 
       qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbcsite FROM qcbc_t WHERE qcbcent=? AND qcbcdocno=?  
       AND qcbcseq=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql3"
   {<point name="input.after_define_sql3"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_bcl3 CURSOR FROM g_forupd_sql
 
 
   
   #add-point:input段define_sql name="input.define_sql4"
   {<point name="input.define_sql4" mark="Y"/>}
   #end add-point 
   LET g_forupd_sql = "SELECT qcbe001,qcbe002,qcbe004,qcbe003,qcbesite FROM qcbe_t WHERE qcbeent=? AND  
       qcbedocno=? AND qcbeseq=? AND qcbe001=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql4"
   {<point name="input.after_define_sql4"/>}
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_bcl4 CURSOR FROM g_forupd_sql
 
   #add-point:input段define_sql name="input.define_sql5"
   {<point name="input.define_sql5" mark="Y"/>}
   #end add-point 
   LET g_forupd_sql = "SELECT qcbg001,qcbg002,qcbg003,qcbgsite FROM qcbg_t WHERE qcbgent=? AND qcbgdocno=?  
       AND qcbgseq=? AND qcbg001=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql5"
   {<point name="input.after_define_sql5"/>}
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aqct300_bcl5 CURSOR FROM g_forupd_sql
 
 
 
   #add-point:input段define_sql name="input.other_sql"
   {<point name="input.other_sql"/>}
   #end add-point 
 
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'
   
   #控制key欄位可否輸入
   CALL aqct300_set_entry(p_cmd)
   #add-point:set_entry後 name="input.after_set_entry"
   {<point name="input.after_set_entry"/>}
   #end add-point
   CALL aqct300_set_no_entry(p_cmd)
 
   DISPLAY BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031, 
       g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029, 
       g_qcba_m.qcba003,g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008, 
       g_qcba_m.qcba009,g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020, 
       g_qcba_m.qcba021,g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba027, 
       g_qcba_m.imae116,g_qcba_m.qcba018,g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028, 
       g_qcba_m.qcba025,g_qcba_m.qcba026
   
   LET lb_reproduce = FALSE
   LET l_ac_t = 1
   
   #關閉被遮罩相關欄位輸入, 無法確定USER是否會需要輸入此欄位
   #因此先行關閉, 若有需要可於下方add-point中自行開啟
   CALL cl_mask_set_no_entry()
   
   #add-point:資料輸入前 name="input.before_input"
   {<point name="input.before_input"/>}
   #end add-point
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
]]>
</section>
  <section id="aqct300.input.head" ver="50" ch="" status="" src="s" readonly="">
<![CDATA[      #單頭段
      INPUT BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031, 
          g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029, 
          g_qcba_m.qcba003,g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008, 
          g_qcba_m.qcba009,g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020, 
          g_qcba_m.qcba021,g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba027, 
          g_qcba_m.imae116,g_qcba_m.qcba018,g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028, 
          g_qcba_m.qcba025,g_qcba_m.qcba026 
         ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂ACTION(master_input)
         
     
         BEFORE INPUT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            IF l_cmd_t = 'r' THEN
               
            END IF
            #因應離開單頭後已寫入資料庫, 若重新回到單頭則視為修改
            #因此需於此處開啟/關閉欄位
            CALL aqct300_set_entry(p_cmd)
            #add-point:資料輸入前 name="input.m.before_input"
            {<point name="input.m.before_input"/>}
            #end add-point
            CALL aqct300_set_no_entry(p_cmd)
    
                  #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbadocno
            
            #add-point:AFTER FIELD qcbadocno name="input.a.qcbadocno"
            {<point name="input.a.qcbadocno" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbadocno
            #add-point:BEFORE FIELD qcbadocno name="input.b.qcbadocno"
            {<point name="input.b.qcbadocno" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbadocno
            #add-point:ON CHANGE qcbadocno name="input.g.qcbadocno"
            {<point name="input.g.qcbadocno" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbadocdt
            #add-point:BEFORE FIELD qcbadocdt name="input.b.qcbadocdt"
            {<point name="input.b.qcbadocdt" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbadocdt
            
            #add-point:AFTER FIELD qcbadocdt name="input.a.qcbadocdt"
            {<point name="input.a.qcbadocdt" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbadocdt
            #add-point:ON CHANGE qcbadocdt name="input.g.qcbadocdt"
            {<point name="input.g.qcbadocdt" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba900
            
            #add-point:AFTER FIELD qcba900 name="input.a.qcba900"
            {<point name="input.a.qcba900" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba900
            #add-point:BEFORE FIELD qcba900 name="input.b.qcba900"
            {<point name="input.b.qcba900" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba900
            #add-point:ON CHANGE qcba900 name="input.g.qcba900"
            {<point name="input.g.qcba900" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba000
            #add-point:BEFORE FIELD qcba000 name="input.b.qcba000"
            {<point name="input.b.qcba000" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba000
            
            #add-point:AFTER FIELD qcba000 name="input.a.qcba000"
            {<point name="input.a.qcba000" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba000
            #add-point:ON CHANGE qcba000 name="input.g.qcba000"
            {<point name="input.g.qcba000" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba031
            #add-point:BEFORE FIELD qcba031 name="input.b.qcba031"
            {<point name="input.b.qcba031" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba031
            
            #add-point:AFTER FIELD qcba031 name="input.a.qcba031"
            {<point name="input.a.qcba031" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba031
            #add-point:ON CHANGE qcba031 name="input.g.qcba031"
            {<point name="input.g.qcba031" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba901
            
            #add-point:AFTER FIELD qcba901 name="input.a.qcba901"
            {<point name="input.a.qcba901" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba901
            #add-point:BEFORE FIELD qcba901 name="input.b.qcba901"
            {<point name="input.b.qcba901" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba901
            #add-point:ON CHANGE qcba901 name="input.g.qcba901"
            {<point name="input.g.qcba901" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbasite
            #add-point:BEFORE FIELD qcbasite name="input.b.qcbasite"
            {<point name="input.b.qcbasite" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbasite
            
            #add-point:AFTER FIELD qcbasite name="input.a.qcbasite"
            {<point name="input.a.qcbasite" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbasite
            #add-point:ON CHANGE qcbasite name="input.g.qcbasite"
            {<point name="input.g.qcbasite" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbastus
            #add-point:BEFORE FIELD qcbastus name="input.b.qcbastus"
            {<point name="input.b.qcbastus" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbastus
            
            #add-point:AFTER FIELD qcbastus name="input.a.qcbastus"
            {<point name="input.a.qcbastus" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbastus
            #add-point:ON CHANGE qcbastus name="input.g.qcbastus"
            {<point name="input.g.qcbastus" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba001
            #add-point:BEFORE FIELD qcba001 name="input.b.qcba001"
            {<point name="input.b.qcba001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba001
            
            #add-point:AFTER FIELD qcba001 name="input.a.qcba001"
            {<point name="input.a.qcba001" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba001
            #add-point:ON CHANGE qcba001 name="input.g.qcba001"
            {<point name="input.g.qcba001" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba002
            #add-point:BEFORE FIELD qcba002 name="input.b.qcba002"
            {<point name="input.b.qcba002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba002
            
            #add-point:AFTER FIELD qcba002 name="input.a.qcba002"
            {<point name="input.a.qcba002" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba002
            #add-point:ON CHANGE qcba002 name="input.g.qcba002"
            {<point name="input.g.qcba002" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba029
            #add-point:BEFORE FIELD qcba029 name="input.b.qcba029"
            {<point name="input.b.qcba029" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba029
            
            #add-point:AFTER FIELD qcba029 name="input.a.qcba029"
            {<point name="input.a.qcba029" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba029
            #add-point:ON CHANGE qcba029 name="input.g.qcba029"
            {<point name="input.g.qcba029" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba003
            #add-point:BEFORE FIELD qcba003 name="input.b.qcba003"
            {<point name="input.b.qcba003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba003
            
            #add-point:AFTER FIELD qcba003 name="input.a.qcba003"
            {<point name="input.a.qcba003" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba003
            #add-point:ON CHANGE qcba003 name="input.g.qcba003"
            {<point name="input.g.qcba003" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba004
            #add-point:BEFORE FIELD qcba004 name="input.b.qcba004"
            {<point name="input.b.qcba004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba004
            
            #add-point:AFTER FIELD qcba004 name="input.a.qcba004"
            {<point name="input.a.qcba004" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba004
            #add-point:ON CHANGE qcba004 name="input.g.qcba004"
            {<point name="input.g.qcba004" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba005
            
            #add-point:AFTER FIELD qcba005 name="input.a.qcba005"
            {<point name="input.a.qcba005" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba005
            #add-point:BEFORE FIELD qcba005 name="input.b.qcba005"
            {<point name="input.b.qcba005" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba005
            #add-point:ON CHANGE qcba005 name="input.g.qcba005"
            {<point name="input.g.qcba005" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba006
            
            #add-point:AFTER FIELD qcba006 name="input.a.qcba006"
            {<point name="input.a.qcba006" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba006
            #add-point:BEFORE FIELD qcba006 name="input.b.qcba006"
            {<point name="input.b.qcba006" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba006
            #add-point:ON CHANGE qcba006 name="input.g.qcba006"
            {<point name="input.g.qcba006" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba007
            #add-point:BEFORE FIELD qcba007 name="input.b.qcba007"
            {<point name="input.b.qcba007" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba007
            
            #add-point:AFTER FIELD qcba007 name="input.a.qcba007"
            {<point name="input.a.qcba007" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba007
            #add-point:ON CHANGE qcba007 name="input.g.qcba007"
            {<point name="input.g.qcba007" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba008
            #add-point:BEFORE FIELD qcba008 name="input.b.qcba008"
            {<point name="input.b.qcba008" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba008
            
            #add-point:AFTER FIELD qcba008 name="input.a.qcba008"
            {<point name="input.a.qcba008" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba008
            #add-point:ON CHANGE qcba008 name="input.g.qcba008"
            {<point name="input.g.qcba008" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba009
            
            #add-point:AFTER FIELD qcba009 name="input.a.qcba009"
            {<point name="input.a.qcba009" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba009
            #add-point:BEFORE FIELD qcba009 name="input.b.qcba009"
            {<point name="input.b.qcba009" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba009
            #add-point:ON CHANGE qcba009 name="input.g.qcba009"
            {<point name="input.g.qcba009" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba017
            #add-point:BEFORE FIELD qcba017 name="input.b.qcba017"
            {<point name="input.b.qcba017" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba017
            
            #add-point:AFTER FIELD qcba017 name="input.a.qcba017"
            {<point name="input.a.qcba017" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba017
            #add-point:ON CHANGE qcba017 name="input.g.qcba017"
            {<point name="input.g.qcba017" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba010
            #add-point:BEFORE FIELD qcba010 name="input.b.qcba010"
            {<point name="input.b.qcba010" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba010
            
            #add-point:AFTER FIELD qcba010 name="input.a.qcba010"
            {<point name="input.a.qcba010" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba010
            #add-point:ON CHANGE qcba010 name="input.g.qcba010"
            {<point name="input.g.qcba010" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba012
            
            #add-point:AFTER FIELD qcba012 name="input.a.qcba012"
            {<point name="input.a.qcba012" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba012
            #add-point:BEFORE FIELD qcba012 name="input.b.qcba012"
            {<point name="input.b.qcba012" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba012
            #add-point:ON CHANGE qcba012 name="input.g.qcba012"
            {<point name="input.g.qcba012" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba013
            
            #add-point:AFTER FIELD qcba013 name="input.a.qcba013"
            {<point name="input.a.qcba013" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba013
            #add-point:BEFORE FIELD qcba013 name="input.b.qcba013"
            {<point name="input.b.qcba013" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba013
            #add-point:ON CHANGE qcba013 name="input.g.qcba013"
            {<point name="input.g.qcba013" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba020
            #add-point:BEFORE FIELD qcba020 name="input.b.qcba020"
            {<point name="input.b.qcba020" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba020
            
            #add-point:AFTER FIELD qcba020 name="input.a.qcba020"
            {<point name="input.a.qcba020" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba020
            #add-point:ON CHANGE qcba020 name="input.g.qcba020"
            {<point name="input.g.qcba020" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba021
            #add-point:BEFORE FIELD qcba021 name="input.b.qcba021"
            {<point name="input.b.qcba021" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba021
            
            #add-point:AFTER FIELD qcba021 name="input.a.qcba021"
            {<point name="input.a.qcba021" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba021
            #add-point:ON CHANGE qcba021 name="input.g.qcba021"
            {<point name="input.g.qcba021" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba030
            #add-point:BEFORE FIELD qcba030 name="input.b.qcba030"
            {<point name="input.b.qcba030" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba030
            
            #add-point:AFTER FIELD qcba030 name="input.a.qcba030"
            {<point name="input.a.qcba030" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba030
            #add-point:ON CHANGE qcba030 name="input.g.qcba030"
            {<point name="input.g.qcba030" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba024
            
            #add-point:AFTER FIELD qcba024 name="input.a.qcba024"
            {<point name="input.a.qcba024" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba024
            #add-point:BEFORE FIELD qcba024 name="input.b.qcba024"
            {<point name="input.b.qcba024" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba024
            #add-point:ON CHANGE qcba024 name="input.g.qcba024"
            {<point name="input.g.qcba024" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba016
            
            #add-point:AFTER FIELD qcba016 name="input.a.qcba016"
            {<point name="input.a.qcba016" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba016
            #add-point:BEFORE FIELD qcba016 name="input.b.qcba016"
            {<point name="input.b.qcba016" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba016
            #add-point:ON CHANGE qcba016 name="input.g.qcba016"
            {<point name="input.g.qcba016" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba022
            #add-point:BEFORE FIELD qcba022 name="input.b.qcba022"
            {<point name="input.b.qcba022" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba022
            
            #add-point:AFTER FIELD qcba022 name="input.a.qcba022"
            {<point name="input.a.qcba022" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba022
            #add-point:ON CHANGE qcba022 name="input.g.qcba022"
            {<point name="input.g.qcba022" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba027
            #add-point:BEFORE FIELD qcba027 name="input.b.qcba027"
            {<point name="input.b.qcba027" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba027
            
            #add-point:AFTER FIELD qcba027 name="input.a.qcba027"
            {<point name="input.a.qcba027" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba027
            #add-point:ON CHANGE qcba027 name="input.g.qcba027"
            {<point name="input.g.qcba027" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD imae116
            #add-point:BEFORE FIELD imae116 name="input.b.imae116"
            {<point name="input.b.imae116" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD imae116
            
            #add-point:AFTER FIELD imae116 name="input.a.imae116"
            {<point name="input.a.imae116" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE imae116
            #add-point:ON CHANGE imae116 name="input.g.imae116"
            {<point name="input.g.imae116" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba018
            #add-point:BEFORE FIELD qcba018 name="input.b.qcba018"
            {<point name="input.b.qcba018" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba018
            
            #add-point:AFTER FIELD qcba018 name="input.a.qcba018"
            {<point name="input.a.qcba018" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba018
            #add-point:ON CHANGE qcba018 name="input.g.qcba018"
            {<point name="input.g.qcba018" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba019
            #add-point:BEFORE FIELD qcba019 name="input.b.qcba019"
            {<point name="input.b.qcba019" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba019
            
            #add-point:AFTER FIELD qcba019 name="input.a.qcba019"
            {<point name="input.a.qcba019" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba019
            #add-point:ON CHANGE qcba019 name="input.g.qcba019"
            {<point name="input.g.qcba019" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba014
            #add-point:BEFORE FIELD qcba014 name="input.b.qcba014"
            {<point name="input.b.qcba014" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba014
            
            #add-point:AFTER FIELD qcba014 name="input.a.qcba014"
            {<point name="input.a.qcba014" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba014
            #add-point:ON CHANGE qcba014 name="input.g.qcba014"
            {<point name="input.g.qcba014" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba015
            #add-point:BEFORE FIELD qcba015 name="input.b.qcba015"
            {<point name="input.b.qcba015" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba015
            
            #add-point:AFTER FIELD qcba015 name="input.a.qcba015"
            {<point name="input.a.qcba015" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba015
            #add-point:ON CHANGE qcba015 name="input.g.qcba015"
            {<point name="input.g.qcba015" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba028
            #add-point:BEFORE FIELD qcba028 name="input.b.qcba028"
            {<point name="input.b.qcba028" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba028
            
            #add-point:AFTER FIELD qcba028 name="input.a.qcba028"
            {<point name="input.a.qcba028" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba028
            #add-point:ON CHANGE qcba028 name="input.g.qcba028"
            {<point name="input.g.qcba028" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba025
            #add-point:BEFORE FIELD qcba025 name="input.b.qcba025"
            {<point name="input.b.qcba025" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba025
            
            #add-point:AFTER FIELD qcba025 name="input.a.qcba025"
            {<point name="input.a.qcba025" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba025
            #add-point:ON CHANGE qcba025 name="input.g.qcba025"
            {<point name="input.g.qcba025" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcba026
            #add-point:BEFORE FIELD qcba026 name="input.b.qcba026"
            {<point name="input.b.qcba026" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcba026
            
            #add-point:AFTER FIELD qcba026 name="input.a.qcba026"
            {<point name="input.a.qcba026" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcba026
            #add-point:ON CHANGE qcba026 name="input.g.qcba026"
            {<point name="input.g.qcba026" />}
            #END add-point 
 
 
 #欄位檢查
                  #Ctrlp:input.c.qcbadocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbadocno
            #add-point:ON ACTION controlp INFIELD qcbadocno name="input.c.qcbadocno"
            {<point name="input.c.qcbadocno" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcbadocdt
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbadocdt
            #add-point:ON ACTION controlp INFIELD qcbadocdt name="input.c.qcbadocdt"
            {<point name="input.c.qcbadocdt" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba900
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba900
            #add-point:ON ACTION controlp INFIELD qcba900 name="input.c.qcba900"
            {<point name="input.c.qcba900" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba000
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba000
            #add-point:ON ACTION controlp INFIELD qcba000 name="input.c.qcba000"
            {<point name="input.c.qcba000" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba031
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba031
            #add-point:ON ACTION controlp INFIELD qcba031 name="input.c.qcba031"
            {<point name="input.c.qcba031" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba901
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba901
            #add-point:ON ACTION controlp INFIELD qcba901 name="input.c.qcba901"
            {<point name="input.c.qcba901" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcbasite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbasite
            #add-point:ON ACTION controlp INFIELD qcbasite name="input.c.qcbasite"
            {<point name="input.c.qcbasite" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcbastus
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbastus
            #add-point:ON ACTION controlp INFIELD qcbastus name="input.c.qcbastus"
            {<point name="input.c.qcbastus" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba001
            #add-point:ON ACTION controlp INFIELD qcba001 name="input.c.qcba001"
            {<point name="input.c.qcba001" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba002
            #add-point:ON ACTION controlp INFIELD qcba002 name="input.c.qcba002"
            {<point name="input.c.qcba002" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba029
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba029
            #add-point:ON ACTION controlp INFIELD qcba029 name="input.c.qcba029"
            {<point name="input.c.qcba029" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba003
            #add-point:ON ACTION controlp INFIELD qcba003 name="input.c.qcba003"
            {<point name="input.c.qcba003" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba004
            #add-point:ON ACTION controlp INFIELD qcba004 name="input.c.qcba004"
            {<point name="input.c.qcba004" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba005
            #add-point:ON ACTION controlp INFIELD qcba005 name="input.c.qcba005"
            {<point name="input.c.qcba005" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba006
            #add-point:ON ACTION controlp INFIELD qcba006 name="input.c.qcba006"
            {<point name="input.c.qcba006" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba007
            #add-point:ON ACTION controlp INFIELD qcba007 name="input.c.qcba007"
            {<point name="input.c.qcba007" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba008
            #add-point:ON ACTION controlp INFIELD qcba008 name="input.c.qcba008"
            {<point name="input.c.qcba008" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba009
            #add-point:ON ACTION controlp INFIELD qcba009 name="input.c.qcba009"
            {<point name="input.c.qcba009" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba017
            #add-point:ON ACTION controlp INFIELD qcba017 name="input.c.qcba017"
            {<point name="input.c.qcba017" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba010
            #add-point:ON ACTION controlp INFIELD qcba010 name="input.c.qcba010"
            {<point name="input.c.qcba010" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba012
            #add-point:ON ACTION controlp INFIELD qcba012 name="input.c.qcba012"
            {<point name="input.c.qcba012" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba013
            #add-point:ON ACTION controlp INFIELD qcba013 name="input.c.qcba013"
            {<point name="input.c.qcba013" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba020
            #add-point:ON ACTION controlp INFIELD qcba020 name="input.c.qcba020"
            {<point name="input.c.qcba020" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba021
            #add-point:ON ACTION controlp INFIELD qcba021 name="input.c.qcba021"
            {<point name="input.c.qcba021" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba030
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba030
            #add-point:ON ACTION controlp INFIELD qcba030 name="input.c.qcba030"
            {<point name="input.c.qcba030" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba024
            #add-point:ON ACTION controlp INFIELD qcba024 name="input.c.qcba024"
            {<point name="input.c.qcba024" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba016
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba016
            #add-point:ON ACTION controlp INFIELD qcba016 name="input.c.qcba016"
            {<point name="input.c.qcba016" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba022
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba022
            #add-point:ON ACTION controlp INFIELD qcba022 name="input.c.qcba022"
            {<point name="input.c.qcba022" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba027
            #add-point:ON ACTION controlp INFIELD qcba027 name="input.c.qcba027"
            {<point name="input.c.qcba027" />}
            #END add-point
 
 
         #Ctrlp:input.c.imae116
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD imae116
            #add-point:ON ACTION controlp INFIELD imae116 name="input.c.imae116"
            {<point name="input.c.imae116" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba018
            #add-point:ON ACTION controlp INFIELD qcba018 name="input.c.qcba018"
            {<point name="input.c.qcba018" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba019
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba019
            #add-point:ON ACTION controlp INFIELD qcba019 name="input.c.qcba019"
            {<point name="input.c.qcba019" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba014
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba014
            #add-point:ON ACTION controlp INFIELD qcba014 name="input.c.qcba014"
            {<point name="input.c.qcba014" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba015
            #add-point:ON ACTION controlp INFIELD qcba015 name="input.c.qcba015"
            {<point name="input.c.qcba015" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba028
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba028
            #add-point:ON ACTION controlp INFIELD qcba028 name="input.c.qcba028"
            {<point name="input.c.qcba028" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba025
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba025
            #add-point:ON ACTION controlp INFIELD qcba025 name="input.c.qcba025"
            {<point name="input.c.qcba025" />}
            #END add-point
 
 
         #Ctrlp:input.c.qcba026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcba026
            #add-point:ON ACTION controlp INFIELD qcba026 name="input.c.qcba026"
            {<point name="input.c.qcba026" />}
            #END add-point
 
 
 #欄位開窗
            
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
 
            #CALL cl_err_collect_show()      #錯誤訊息統整顯示
            #CALL cl_showmsg()
            DISPLAY BY NAME g_qcba_m.qcbadocno
                        
            #add-point:單頭INPUT後 name="input.head.after_input"
            {<point name="input.head.after_input"/>}
            #end add-point
                        
            IF p_cmd <> 'u' THEN
    
               CALL s_transaction_begin()
               
               #add-point:單頭新增前 name="input.head.b_insert"
               {<point name="input.head.b_insert" mark="Y"/>}
               #end add-point
               
               INSERT INTO qcba_t (qcbaent,qcbadocno,qcbadocdt,qcba900,qcba000,qcba031,qcba901,qcbasite, 
                   qcba032,qcbastus,qcba001,qcba002,qcba029,qcba003,qcba004,qcba005,qcba006,qcba007, 
                   qcba008,qcba009,qcba017,qcba010,qcba012,qcba013,qcba020,qcba021,qcba030,qcba024,qcba016, 
                   qcba022,qcba023,qcba027,qcba018,qcba019,qcba014,qcba015,qcba028,qcba025,qcba026,qcba033, 
                   qcbaownid,qcbaowndp,qcbacrtid,qcbacrtdp,qcbacrtdt,qcbamodid,qcbamoddt,qcbacnfid,qcbacnfdt) 

               VALUES (g_enterprise,g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba000, 
                   g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032,g_qcba_m.qcbastus, 
                   g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
                   g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009, 
                   g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020, 
                   g_qcba_m.qcba021,g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022, 
                   g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018,g_qcba_m.qcba019,g_qcba_m.qcba014, 
                   g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033, 
                   g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdt, 
                   g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt) 
               IF SQLCA.SQLCODE THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "g_qcba_m:",SQLERRMESSAGE 
                  LET g_errparam.code = SQLCA.SQLCODE 
                  LET g_errparam.popup = TRUE 
                  CALL s_transaction_end('N','0')
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭新增中 name="input.head.m_insert"
               {<point name="input.head.m_insert"/>}
               #end add-point
               
               
               
               
               #add-point:單頭新增後 name="input.head.a_insert"
               {<point name="input.head.a_insert"/>}
               #end add-point
               CALL s_transaction_end('Y','0') 
               
               IF l_cmd_t = 'r' AND p_cmd = 'a' THEN
                  CALL aqct300_detail_reproduce()
                  #因應特定程式需求, 重新刷新單身資料
                  CALL aqct300_b_fill()
                  CALL aqct300_b_fill2('0')
               END IF
               
               #add-point:單頭新增後 name="input.head.a_insert2"
               {<point name="input.head.a_insert2"/>}
               #end add-point
               
               LET g_master_insert = TRUE
               
               LET p_cmd = 'u'
            ELSE
               CALL s_transaction_begin()
            
               #add-point:單頭修改前 name="input.head.b_update"
               {<point name="input.head.b_update" mark="Y"/>}
               #end add-point
               
               #將遮罩欄位還原
               CALL aqct300_qcba_t_mask_restore('restore_mask_o')
               
               UPDATE qcba_t SET (qcbadocno,qcbadocdt,qcba900,qcba000,qcba031,qcba901,qcbasite,qcba032, 
                   qcbastus,qcba001,qcba002,qcba029,qcba003,qcba004,qcba005,qcba006,qcba007,qcba008, 
                   qcba009,qcba017,qcba010,qcba012,qcba013,qcba020,qcba021,qcba030,qcba024,qcba016,qcba022, 
                   qcba023,qcba027,qcba018,qcba019,qcba014,qcba015,qcba028,qcba025,qcba026,qcba033,qcbaownid, 
                   qcbaowndp,qcbacrtid,qcbacrtdp,qcbacrtdt,qcbamodid,qcbamoddt,qcbacnfid,qcbacnfdt) = (g_qcba_m.qcbadocno, 
                   g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901, 
                   g_qcba_m.qcbasite,g_qcba_m.qcba032,g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002, 
                   g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba006, 
                   g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017,g_qcba_m.qcba010, 
                   g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
                   g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027, 
                   g_qcba_m.qcba018,g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028, 
                   g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp, 
                   g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt, 
                   g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt)
                WHERE qcbaent = g_enterprise AND qcbadocno = g_qcbadocno_t
 
               IF SQLCA.SQLCODE THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "qcba_t:",SQLERRMESSAGE 
                  LET g_errparam.code = SQLCA.SQLCODE 
                  LET g_errparam.popup = TRUE 
                  CALL s_transaction_end('N','0')
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭修改中 name="input.head.m_update"
               {<point name="input.head.m_update"/>}
               #end add-point
               
               
               
               
               #將遮罩欄位進行遮蔽
               CALL aqct300_qcba_t_mask_restore('restore_mask_n')
               
               #修改歷程記錄(單頭修改)
               LET g_log1 = util.JSON.stringify(g_qcba_m_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m)
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
               
               #add-point:單頭修改後 name="input.head.a_update"
               {<point name="input.head.a_update"/>}
               #end add-point
            END IF
            
            LET g_master_commit = "Y"
            LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
            
      END INPUT
   
]]>
</section>
  <section id="aqct300.input.body" ver="63" ch="" status="" src="s" readonly="">
<![CDATA[   
      #Page1 預設值產生於此處
      INPUT ARRAY g_qcbd_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         #自訂ACTION(detail_input,page_1)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body.before_input2"
            {<point name="input.body.before_input2"/>}
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL aqct300_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'1',"))
            END IF
            LET g_loc = 'm'
            LET g_rec_b = g_qcbd_d.getLength()
            #add-point:資料輸入前 name="input.d.before_input"
            {<point name="input.d.before_input"/>}
            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2 name="input.body.before_row2"
            {<point name="input.body.before_row2"/>}
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_detail_idx_list[1] = l_ac
            LET g_current_page = 1
            CALL aqct300_b_fill2('4')
CALL aqct300_b_fill2('5')
 
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd_d[l_ac].qcbdseq IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_qcbd_d_t.* = g_qcbd_d[l_ac].*  #BACKUP
               LET g_qcbd_d_o.* = g_qcbd_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body.after_set_entry_b"
               {<point name="input.body.after_set_entry_b"/>}
               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               IF NOT aqct300_lock_b("qcbd_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aqct300_bcl INTO g_qcbd_d[l_ac].qcbdseq,g_qcbd_d[l_ac].qcbd001,g_qcbd_d[l_ac].qcbd002, 
                      g_qcbd_d[l_ac].qcbd003,g_qcbd_d[l_ac].qcbd020,g_qcbd_d[l_ac].qcbd004,g_qcbd_d[l_ac].qcbd005, 
                      g_qcbd_d[l_ac].qcbd006,g_qcbd_d[l_ac].qcbd007,g_qcbd_d[l_ac].qcbd008,g_qcbd_d[l_ac].qcbd009, 
                      g_qcbd_d[l_ac].qcbd010,g_qcbd_d[l_ac].qcbd021,g_qcbd_d[l_ac].qcbd011,g_qcbd_d[l_ac].qcbdsite 

                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_qcbd_d_t.qcbdseq,":",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_qcbd_d_mask_o[l_ac].* =  g_qcbd_d[l_ac].*
                  CALL aqct300_qcbd_t_mask()
                  LET g_qcbd_d_mask_n[l_ac].* =  g_qcbd_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body.before_row"
            {<point name="input.body.before_row"/>}
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
        
         BEFORE INSERT  
            
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_qcbd_d[l_ac].* TO NULL 
            INITIALIZE g_qcbd_d_t.* TO NULL 
            INITIALIZE g_qcbd_d_o.* TO NULL 
            #公用欄位給值(單身)
            
            #自定義預設值
            
            #add-point:modify段before備份 name="input.body.insert.before_bak"
            {<point name="input.body.insert.before_bak"/>}
            #end add-point
            LET g_qcbd_d_t.* = g_qcbd_d[l_ac].*     #新輸入資料
            LET g_qcbd_d_o.* = g_qcbd_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aqct300_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body.insert.after_set_entry_b"
            {<point name="input.body.insert.after_set_entry_b"/>}
            #end add-point
            CALL aqct300_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_qcbd_d[li_reproduce_target].* = g_qcbd_d[li_reproduce].*
 
               LET g_qcbd_d[li_reproduce_target].qcbdseq = NULL
 
            END IF
            
 
            #add-point:modify段before insert name="input.body.before_insert"
            {<point name="input.body.before_insert"/>}
            #end add-point  
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身新增 name="input.body.b_a_insert"
            {<point name="input.body.b_a_insert"/>}
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM qcbd_t 
             WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno
 
               AND qcbdseq = g_qcbd_d[l_ac].qcbdseq
 
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身新增前 name="input.body.b_insert"
               {<point name="input.body.b_insert"/>}
               #end add-point
            
               #同步新增到同層的table
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               CALL aqct300_insert_b('qcbd_t',gs_keys,"'1'")
                           
               #add-point:單身新增後 name="input.body.a_insert"
               {<point name="input.body.a_insert"/>}
               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               INITIALIZE g_qcbd_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbd_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aqct300_b_fill()
               #資料多語言用-增/改
               
               #add-point:input段-after_insert name="input.body.a_insert2"
               {<point name="input.body.a_insert2"/>}
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身刪除後(=d) name="input.body.after_delete_d"
               {<point name="input.body.after_delete_d"/>}
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body.b_delete_ask"
               {<point name="input.body.b_delete_ask" />}
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身刪除前 name="input.body.b_delete"
               {<point name="input.body.b_delete" mark="Y"/>}
               #end add-point 
               
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_qcba_m.qcbadocno
 
               LET gs_keys[gs_keys.getLength()+1] = g_qcbd_d_t.qcbdseq
 
            
               #刪除同層單身
               IF NOT aqct300_delete_b('qcbd_t',gs_keys,"'1'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT aqct300_key_delete_b(gs_keys,'qcbd_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身刪除中 name="input.body.m_delete"
               {<point name="input.body.m_delete"/>}
               #end add-point 
               
               CALL s_transaction_end('Y','0')
               CLOSE aqct300_bcl
            
               LET g_rec_b = g_rec_b-1
               #add-point:單身刪除後 name="input.body.a_delete"
               {<point name="input.body.a_delete"/>}
               #end add-point
               LET l_count = g_qcbd_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body.after_delete"
               {<point name="input.body.after_delete"/>}
               #end add-point
            END IF
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_qcbd_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
                  #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbdseq
            #應用 a15 樣板自動產生(Version:3)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_qcbd_d[l_ac].qcbdseq,"1","1","","","azz-00079",1) THEN
               NEXT FIELD qcbdseq
            END IF 
 
 
 
            #add-point:AFTER FIELD qcbdseq name="input.a.page1.qcbdseq"
            {<point name="input.a.page1.qcbdseq" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbdseq
            #add-point:BEFORE FIELD qcbdseq name="input.b.page1.qcbdseq"
            {<point name="input.b.page1.qcbdseq" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbdseq
            #add-point:ON CHANGE qcbdseq name="input.g.page1.qcbdseq"
            {<point name="input.g.page1.qcbdseq" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd001
            
            #add-point:AFTER FIELD qcbd001 name="input.a.page1.qcbd001"
            {<point name="input.a.page1.qcbd001" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd001
            #add-point:BEFORE FIELD qcbd001 name="input.b.page1.qcbd001"
            {<point name="input.b.page1.qcbd001" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd001
            #add-point:ON CHANGE qcbd001 name="input.g.page1.qcbd001"
            {<point name="input.g.page1.qcbd001" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd002
            #add-point:BEFORE FIELD qcbd002 name="input.b.page1.qcbd002"
            {<point name="input.b.page1.qcbd002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd002
            
            #add-point:AFTER FIELD qcbd002 name="input.a.page1.qcbd002"
            {<point name="input.a.page1.qcbd002" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd002
            #add-point:ON CHANGE qcbd002 name="input.g.page1.qcbd002"
            {<point name="input.g.page1.qcbd002" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd003
            #add-point:BEFORE FIELD qcbd003 name="input.b.page1.qcbd003"
            {<point name="input.b.page1.qcbd003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd003
            
            #add-point:AFTER FIELD qcbd003 name="input.a.page1.qcbd003"
            {<point name="input.a.page1.qcbd003" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd003
            #add-point:ON CHANGE qcbd003 name="input.g.page1.qcbd003"
            {<point name="input.g.page1.qcbd003" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd020
            #add-point:BEFORE FIELD qcbd020 name="input.b.page1.qcbd020"
            {<point name="input.b.page1.qcbd020" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd020
            
            #add-point:AFTER FIELD qcbd020 name="input.a.page1.qcbd020"
            {<point name="input.a.page1.qcbd020" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd020
            #add-point:ON CHANGE qcbd020 name="input.g.page1.qcbd020"
            {<point name="input.g.page1.qcbd020" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd004
            #add-point:BEFORE FIELD qcbd004 name="input.b.page1.qcbd004"
            {<point name="input.b.page1.qcbd004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd004
            
            #add-point:AFTER FIELD qcbd004 name="input.a.page1.qcbd004"
            {<point name="input.a.page1.qcbd004" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd004
            #add-point:ON CHANGE qcbd004 name="input.g.page1.qcbd004"
            {<point name="input.g.page1.qcbd004" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd009
            #應用 a15 樣板自動產生(Version:3)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_qcbd_d[l_ac].qcbd009,"0","1","","","azz-00079",1) THEN
               NEXT FIELD qcbd009
            END IF 
 
 
 
            #add-point:AFTER FIELD qcbd009 name="input.a.page1.qcbd009"
            {<point name="input.a.page1.qcbd009" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd009
            #add-point:BEFORE FIELD qcbd009 name="input.b.page1.qcbd009"
            {<point name="input.b.page1.qcbd009" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd009
            #add-point:ON CHANGE qcbd009 name="input.g.page1.qcbd009"
            {<point name="input.g.page1.qcbd009" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd010
            #應用 a15 樣板自動產生(Version:3)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_qcbd_d[l_ac].qcbd010,"0","1","","","azz-00079",1) THEN
               NEXT FIELD qcbd010
            END IF 
 
 
 
            #add-point:AFTER FIELD qcbd010 name="input.a.page1.qcbd010"
            {<point name="input.a.page1.qcbd010" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd010
            #add-point:BEFORE FIELD qcbd010 name="input.b.page1.qcbd010"
            {<point name="input.b.page1.qcbd010" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd010
            #add-point:ON CHANGE qcbd010 name="input.g.page1.qcbd010"
            {<point name="input.g.page1.qcbd010" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd021
            #add-point:BEFORE FIELD qcbd021 name="input.b.page1.qcbd021"
            {<point name="input.b.page1.qcbd021" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd021
            
            #add-point:AFTER FIELD qcbd021 name="input.a.page1.qcbd021"
            {<point name="input.a.page1.qcbd021" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd021
            #add-point:ON CHANGE qcbd021 name="input.g.page1.qcbd021"
            {<point name="input.g.page1.qcbd021" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbd011
            #add-point:BEFORE FIELD qcbd011 name="input.b.page1.qcbd011"
            {<point name="input.b.page1.qcbd011" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbd011
            
            #add-point:AFTER FIELD qcbd011 name="input.a.page1.qcbd011"
            {<point name="input.a.page1.qcbd011" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbd011
            #add-point:ON CHANGE qcbd011 name="input.g.page1.qcbd011"
            {<point name="input.g.page1.qcbd011" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbdsite
            #add-point:BEFORE FIELD qcbdsite name="input.b.page1.qcbdsite"
            {<point name="input.b.page1.qcbdsite" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbdsite
            
            #add-point:AFTER FIELD qcbdsite name="input.a.page1.qcbdsite"
            {<point name="input.a.page1.qcbdsite" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbdsite
            #add-point:ON CHANGE qcbdsite name="input.g.page1.qcbdsite"
            {<point name="input.g.page1.qcbdsite" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD ooff013
            #add-point:BEFORE FIELD ooff013 name="input.b.page1.ooff013"
            {<point name="input.b.page1.ooff013" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD ooff013
            
            #add-point:AFTER FIELD ooff013 name="input.a.page1.ooff013"
            {<point name="input.a.page1.ooff013" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE ooff013
            #add-point:ON CHANGE ooff013 name="input.g.page1.ooff013"
            {<point name="input.g.page1.ooff013" />}
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page1.qcbdseq
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbdseq
            #add-point:ON ACTION controlp INFIELD qcbdseq name="input.c.page1.qcbdseq"
            {<point name="input.c.page1.qcbdseq" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd001
            #add-point:ON ACTION controlp INFIELD qcbd001 name="input.c.page1.qcbd001"
            {<point name="input.c.page1.qcbd001" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd002
            #add-point:ON ACTION controlp INFIELD qcbd002 name="input.c.page1.qcbd002"
            {<point name="input.c.page1.qcbd002" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd003
            #add-point:ON ACTION controlp INFIELD qcbd003 name="input.c.page1.qcbd003"
            {<point name="input.c.page1.qcbd003" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd020
            #add-point:ON ACTION controlp INFIELD qcbd020 name="input.c.page1.qcbd020"
            {<point name="input.c.page1.qcbd020" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd004
            #add-point:ON ACTION controlp INFIELD qcbd004 name="input.c.page1.qcbd004"
            {<point name="input.c.page1.qcbd004" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd009
            #add-point:ON ACTION controlp INFIELD qcbd009 name="input.c.page1.qcbd009"
            {<point name="input.c.page1.qcbd009" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd010
            #add-point:ON ACTION controlp INFIELD qcbd010 name="input.c.page1.qcbd010"
            {<point name="input.c.page1.qcbd010" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd021
            #add-point:ON ACTION controlp INFIELD qcbd021 name="input.c.page1.qcbd021"
            {<point name="input.c.page1.qcbd021" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbd011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbd011
            #add-point:ON ACTION controlp INFIELD qcbd011 name="input.c.page1.qcbd011"
            {<point name="input.c.page1.qcbd011" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.qcbdsite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbdsite
            #add-point:ON ACTION controlp INFIELD qcbdsite name="input.c.page1.qcbdsite"
            {<point name="input.c.page1.qcbdsite" />}
            #END add-point
 
 
         #Ctrlp:input.c.page1.ooff013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD ooff013
            #add-point:ON ACTION controlp INFIELD ooff013 name="input.c.page1.ooff013"
            {<point name="input.c.page1.ooff013" />}
            #END add-point
 
 
 
 
         ON ROW CHANGE
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_qcbd_d[l_ac].* = g_qcbd_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_qcbd_d[l_ac].qcbdseq 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_qcbd_d[l_ac].* = g_qcbd_d_t.*
            ELSE
            
               #add-point:單身修改前 name="input.body.b_update"
               {<point name="input.body.b_update" mark="Y"/>}
               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
               #將遮罩欄位還原
               CALL aqct300_qcbd_t_mask_restore('restore_mask_o')
      
               UPDATE qcbd_t SET (qcbddocno,qcbdseq,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004,qcbd005, 
                   qcbd006,qcbd007,qcbd008,qcbd009,qcbd010,qcbd021,qcbd011,qcbdsite) = (g_qcba_m.qcbadocno, 
                   g_qcbd_d[l_ac].qcbdseq,g_qcbd_d[l_ac].qcbd001,g_qcbd_d[l_ac].qcbd002,g_qcbd_d[l_ac].qcbd003, 
                   g_qcbd_d[l_ac].qcbd020,g_qcbd_d[l_ac].qcbd004,g_qcbd_d[l_ac].qcbd005,g_qcbd_d[l_ac].qcbd006, 
                   g_qcbd_d[l_ac].qcbd007,g_qcbd_d[l_ac].qcbd008,g_qcbd_d[l_ac].qcbd009,g_qcbd_d[l_ac].qcbd010, 
                   g_qcbd_d[l_ac].qcbd021,g_qcbd_d[l_ac].qcbd011,g_qcbd_d[l_ac].qcbdsite)
                WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno 
 
                  AND qcbdseq = g_qcbd_d_t.qcbdseq #項次   
 
                  
               #add-point:單身修改中 name="input.body.m_update"
               {<point name="input.body.m_update"/>}
               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_qcbd_d[l_ac].* = g_qcbd_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbd_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_qcbd_d[l_ac].* = g_qcbd_d_t.*  
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbd_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()                   
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys_bak[2] = g_qcbd_d_t.qcbdseq
               CALL aqct300_update_b('qcbd_t',gs_keys,gs_keys_bak,"'1'")
               END CASE
 
               #將遮罩欄位進行遮蔽
               CALL aqct300_qcbd_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT(g_qcbd_d[g_detail_idx].qcbdseq = g_qcbd_d_t.qcbdseq 
 
                  ) THEN
                  LET gs_keys[01] = g_qcba_m.qcbadocno
 
                  LET gs_keys[gs_keys.getLength()+1] = g_qcbd_d_t.qcbdseq
 
                  CALL aqct300_key_update_b(gs_keys,'qcbd_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd_d_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身修改後 name="input.body.a_update"
               {<point name="input.body.a_update"/>}
               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row name="input.body.after_row"
            {<point name="input.body.after_row"/>}
            #end add-point
            CALL aqct300_unlock_b("qcbd_t","'1'")
            CALL s_transaction_end('Y','0')
            #其他table進行unlock
            #add-point:單身after_row2 name="input.body.after_row2"
            {<point name="input.body.after_row2"/>}
            #end add-point
              
         AFTER INPUT
            #add-point:input段after input  name="input.body.after_input"
            {<point name="input.body.after_input"/>}
            #end add-point 
    
         ON ACTION controlo    
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_qcbd_d[li_reproduce_target].* = g_qcbd_d[li_reproduce].*
 
               LET g_qcbd_d[li_reproduce_target].qcbdseq = NULL
 
            ELSE
               CALL FGL_SET_ARR_CURR(g_qcbd_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_qcbd_d.getLength()+1
            END IF
            
         #ON ACTION cancel
         #   LET INT_FLAG = 1
         #   LET g_detail_idx = 1
         #   EXIT DIALOG 
 
      END INPUT
      
      INPUT ARRAY g_qcbd4_d FROM s_detail4.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = l_allow_insert, #此頁面insert功能由產生器控制, 手動之設定無效! 

                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 
         #自訂ACTION(detail_input,page_3)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body4.before_input2"
            {<point name="input.body4.before_input2"/>}
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd4_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL aqct300_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'4',"))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_qcbd4_d.getLength()
            #add-point:資料輸入前 name="input.body4.before_input"
            {<point name="input.body4.before_input"/>}
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_qcbd4_d[l_ac].* TO NULL 
            INITIALIZE g_qcbd4_d_t.* TO NULL 
            INITIALIZE g_qcbd4_d_o.* TO NULL 
            #公用欄位給值(單身3)
            
            #自定義預設值(單身3)
                  LET g_qcbd4_d[l_ac].qcbb005 = "N"
      LET g_qcbd4_d[l_ac].qcbb006 = "1"
 
            #add-point:modify段before備份 name="input.body4.insert.before_bak"
            {<point name="input.body4.insert.before_bak"/>}
            #end add-point
            LET g_qcbd4_d_t.* = g_qcbd4_d[l_ac].*     #新輸入資料
            LET g_qcbd4_d_o.* = g_qcbd4_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aqct300_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body4.insert.after_set_entry_b"
            {<point name="input.body4.insert.after_set_entry_b"/>}
            #end add-point
            CALL aqct300_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_qcbd4_d[li_reproduce_target].* = g_qcbd4_d[li_reproduce].*
 
               LET g_qcbd4_d[li_reproduce_target].qcbb001 = NULL
               LET g_qcbd4_d[li_reproduce_target].qcbb002 = NULL
               LET g_qcbd4_d[li_reproduce_target].qcbb003 = NULL
            END IF
            
 
            #add-point:modify段before insert name="input.body4.before_insert"
            {<point name="input.body4.before_insert"/>}
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body4.before_row2"
            {<point name="input.body4.before_row2"/>}
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[3] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 3
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd4_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd4_d[l_ac].qcbb001 IS NOT NULL
               AND g_qcbd4_d[l_ac].qcbb002 IS NOT NULL
               AND g_qcbd4_d[l_ac].qcbb003 IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_qcbd4_d_t.* = g_qcbd4_d[l_ac].*  #BACKUP
               LET g_qcbd4_d_o.* = g_qcbd4_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body4.after_set_entry_b"
               {<point name="input.body4.after_set_entry_b"/>}
               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               IF NOT aqct300_lock_b("qcbb_t","'3'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aqct300_bcl2 INTO g_qcbd4_d[l_ac].qcbb001,g_qcbd4_d[l_ac].qcbb002,g_qcbd4_d[l_ac].qcbb003, 
                      g_qcbd4_d[l_ac].qcbb004,g_qcbd4_d[l_ac].qcbb005,g_qcbd4_d[l_ac].qcbb006,g_qcbd4_d[l_ac].qcbbsite 

                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_qcbd4_d_mask_o[l_ac].* =  g_qcbd4_d[l_ac].*
                  CALL aqct300_qcbb_t_mask()
                  LET g_qcbd4_d_mask_n[l_ac].* =  g_qcbd4_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body4.before_row"
            {<point name="input.body4.before_row"/>}
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body4.after_delete_d"
               {<point name="input.body4.after_delete_d"/>}
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body4.b_delete_ask"
               {<point name="input.body4.b_delete_ask" />}
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身3刪除前 name="input.body4.b_delete"
               {<point name="input.body4.b_delete" mark="Y"/>}
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_qcba_m.qcbadocno
               LET gs_keys[gs_keys.getLength()+1] = g_qcbd4_d_t.qcbb001
               LET gs_keys[gs_keys.getLength()+1] = g_qcbd4_d_t.qcbb002
               LET gs_keys[gs_keys.getLength()+1] = g_qcbd4_d_t.qcbb003
            
               #刪除同層單身
               IF NOT aqct300_delete_b('qcbb_t',gs_keys,"'3'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT aqct300_key_delete_b(gs_keys,'qcbb_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身3刪除中 name="input.body4.m_delete"
               {<point name="input.body4.m_delete"/>}
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE aqct300_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身3刪除後 name="input.body4.a_delete"
               {<point name="input.body4.a_delete"/>}
               #end add-point
               LET l_count = g_qcbd_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body4.after_delete"
               {<point name="input.body4.after_delete"/>}
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_qcbd4_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身3新增前 name="input.body4.b_a_insert"
            {<point name="input.body4.b_a_insert"/>}
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM qcbb_t 
             WHERE qcbbent = g_enterprise AND qcbbdocno = g_qcba_m.qcbadocno
               AND qcbb001 = g_qcbd4_d[l_ac].qcbb001
               AND qcbb002 = g_qcbd4_d[l_ac].qcbb002
               AND qcbb003 = g_qcbd4_d[l_ac].qcbb003
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身3新增前 name="input.body4.b_insert"
               {<point name="input.body4.b_insert"/>}
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd4_d[g_detail_idx].qcbb001
               LET gs_keys[3] = g_qcbd4_d[g_detail_idx].qcbb002
               LET gs_keys[4] = g_qcbd4_d[g_detail_idx].qcbb003
               CALL aqct300_insert_b('qcbb_t',gs_keys,"'3'")
                           
               #add-point:單身新增後3 name="input.body4.a_insert"
               {<point name="input.body4.a_insert"/>}
               #end add-point
            ELSE    
               INITIALIZE g_qcbd_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbb_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aqct300_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body4.after_insert"
               {<point name="input.body4.after_insert"/>}
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_qcbd4_d[l_ac].* = g_qcbd4_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_qcbd4_d[l_ac].* = g_qcbd4_d_t.*
            ELSE
               #add-point:單身page3修改前 name="input.body4.b_update"
               {<point name="input.body4.b_update" mark="Y"/>}
               #end add-point
               
               #寫入修改者/修改日期資訊(單身3)
               
               
               #將遮罩欄位還原
               CALL aqct300_qcbb_t_mask_restore('restore_mask_o')
                              
               UPDATE qcbb_t SET (qcbbdocno,qcbb001,qcbb002,qcbb003,qcbb004,qcbb005,qcbb006,qcbbsite) = (g_qcba_m.qcbadocno, 
                   g_qcbd4_d[l_ac].qcbb001,g_qcbd4_d[l_ac].qcbb002,g_qcbd4_d[l_ac].qcbb003,g_qcbd4_d[l_ac].qcbb004, 
                   g_qcbd4_d[l_ac].qcbb005,g_qcbd4_d[l_ac].qcbb006,g_qcbd4_d[l_ac].qcbbsite) #自訂欄位頁簽 

                WHERE qcbbent = g_enterprise AND qcbbdocno = g_qcba_m.qcbadocno
                  AND qcbb001 = g_qcbd4_d_t.qcbb001 #項次 
                  AND qcbb002 = g_qcbd4_d_t.qcbb002
                  AND qcbb003 = g_qcbd4_d_t.qcbb003
                  
               #add-point:單身page3修改中 name="input.body4.m_update"
               {<point name="input.body4.m_update"/>}
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_qcbd4_d[l_ac].* = g_qcbd4_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbb_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_qcbd4_d[l_ac].* = g_qcbd4_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbb_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd4_d[g_detail_idx].qcbb001
               LET gs_keys_bak[2] = g_qcbd4_d_t.qcbb001
               LET gs_keys[3] = g_qcbd4_d[g_detail_idx].qcbb002
               LET gs_keys_bak[3] = g_qcbd4_d_t.qcbb002
               LET gs_keys[4] = g_qcbd4_d[g_detail_idx].qcbb003
               LET gs_keys_bak[4] = g_qcbd4_d_t.qcbb003
               CALL aqct300_update_b('qcbb_t',gs_keys,gs_keys_bak,"'3'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL aqct300_qcbb_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_qcbd4_d[g_detail_idx].qcbb001 = g_qcbd4_d_t.qcbb001 
                  AND g_qcbd4_d[g_detail_idx].qcbb002 = g_qcbd4_d_t.qcbb002 
                  AND g_qcbd4_d[g_detail_idx].qcbb003 = g_qcbd4_d_t.qcbb003 
                  ) THEN
                  LET gs_keys[01] = g_qcba_m.qcbadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_qcbd4_d_t.qcbb001
                  LET gs_keys[gs_keys.getLength()+1] = g_qcbd4_d_t.qcbb002
                  LET gs_keys[gs_keys.getLength()+1] = g_qcbd4_d_t.qcbb003
                  CALL aqct300_key_update_b(gs_keys,'qcbb_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd4_d_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd4_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page3修改後 name="input.body4.a_update"
               {<point name="input.body4.a_update"/>}
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb001
            #add-point:BEFORE FIELD qcbb001 name="input.b.page4.qcbb001"
            {<point name="input.b.page4.qcbb001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb001
            
            #add-point:AFTER FIELD qcbb001 name="input.a.page4.qcbb001"
            {<point name="input.a.page4.qcbb001" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbb001
            #add-point:ON CHANGE qcbb001 name="input.g.page4.qcbb001"
            {<point name="input.g.page4.qcbb001" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb002
            #add-point:BEFORE FIELD qcbb002 name="input.b.page4.qcbb002"
            {<point name="input.b.page4.qcbb002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb002
            
            #add-point:AFTER FIELD qcbb002 name="input.a.page4.qcbb002"
            {<point name="input.a.page4.qcbb002" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbb002
            #add-point:ON CHANGE qcbb002 name="input.g.page4.qcbb002"
            {<point name="input.g.page4.qcbb002" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb003
            #add-point:BEFORE FIELD qcbb003 name="input.b.page4.qcbb003"
            {<point name="input.b.page4.qcbb003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb003
            
            #add-point:AFTER FIELD qcbb003 name="input.a.page4.qcbb003"
            {<point name="input.a.page4.qcbb003" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbb003
            #add-point:ON CHANGE qcbb003 name="input.g.page4.qcbb003"
            {<point name="input.g.page4.qcbb003" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb004
            #add-point:BEFORE FIELD qcbb004 name="input.b.page4.qcbb004"
            {<point name="input.b.page4.qcbb004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb004
            
            #add-point:AFTER FIELD qcbb004 name="input.a.page4.qcbb004"
            {<point name="input.a.page4.qcbb004" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbb004
            #add-point:ON CHANGE qcbb004 name="input.g.page4.qcbb004"
            {<point name="input.g.page4.qcbb004" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb005
            #add-point:BEFORE FIELD qcbb005 name="input.b.page4.qcbb005"
            {<point name="input.b.page4.qcbb005" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb005
            
            #add-point:AFTER FIELD qcbb005 name="input.a.page4.qcbb005"
            {<point name="input.a.page4.qcbb005" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbb005
            #add-point:ON CHANGE qcbb005 name="input.g.page4.qcbb005"
            {<point name="input.g.page4.qcbb005" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbb006
            #add-point:BEFORE FIELD qcbb006 name="input.b.page4.qcbb006"
            {<point name="input.b.page4.qcbb006" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbb006
            
            #add-point:AFTER FIELD qcbb006 name="input.a.page4.qcbb006"
            {<point name="input.a.page4.qcbb006" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbb006
            #add-point:ON CHANGE qcbb006 name="input.g.page4.qcbb006"
            {<point name="input.g.page4.qcbb006" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbbsite
            #add-point:BEFORE FIELD qcbbsite name="input.b.page4.qcbbsite"
            {<point name="input.b.page4.qcbbsite" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbbsite
            
            #add-point:AFTER FIELD qcbbsite name="input.a.page4.qcbbsite"
            {<point name="input.a.page4.qcbbsite" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbbsite
            #add-point:ON CHANGE qcbbsite name="input.g.page4.qcbbsite"
            {<point name="input.g.page4.qcbbsite" />}
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page4.qcbb001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb001
            #add-point:ON ACTION controlp INFIELD qcbb001 name="input.c.page4.qcbb001"
            {<point name="input.c.page4.qcbb001" />}
            #END add-point
 
 
         #Ctrlp:input.c.page4.qcbb002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb002
            #add-point:ON ACTION controlp INFIELD qcbb002 name="input.c.page4.qcbb002"
            {<point name="input.c.page4.qcbb002" />}
            #END add-point
 
 
         #Ctrlp:input.c.page4.qcbb003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb003
            #add-point:ON ACTION controlp INFIELD qcbb003 name="input.c.page4.qcbb003"
            {<point name="input.c.page4.qcbb003" />}
            #END add-point
 
 
         #Ctrlp:input.c.page4.qcbb004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb004
            #add-point:ON ACTION controlp INFIELD qcbb004 name="input.c.page4.qcbb004"
            {<point name="input.c.page4.qcbb004" />}
            #END add-point
 
 
         #Ctrlp:input.c.page4.qcbb005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb005
            #add-point:ON ACTION controlp INFIELD qcbb005 name="input.c.page4.qcbb005"
            {<point name="input.c.page4.qcbb005" />}
            #END add-point
 
 
         #Ctrlp:input.c.page4.qcbb006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbb006
            #add-point:ON ACTION controlp INFIELD qcbb006 name="input.c.page4.qcbb006"
            {<point name="input.c.page4.qcbb006" />}
            #END add-point
 
 
         #Ctrlp:input.c.page4.qcbbsite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbbsite
            #add-point:ON ACTION controlp INFIELD qcbbsite name="input.c.page4.qcbbsite"
            {<point name="input.c.page4.qcbbsite" />}
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page3 after_row name="input.body4.after_row"
            {<point name="input.body4.after_row"/>}
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_qcbd4_d[l_ac].* = g_qcbd4_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL aqct300_unlock_b("qcbb_t","'3'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page3 after_row2 name="input.body4.after_row2"
            {<point name="input.body4.after_row2"/>}
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body4.after_input"
            {<point name="input.body4.after_input"/>}
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_qcbd4_d[li_reproduce_target].* = g_qcbd4_d[li_reproduce].*
 
               LET g_qcbd4_d[li_reproduce_target].qcbb001 = NULL
               LET g_qcbd4_d[li_reproduce_target].qcbb002 = NULL
               LET g_qcbd4_d[li_reproduce_target].qcbb003 = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_qcbd4_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_qcbd4_d.getLength()+1
            END IF
            
      END INPUT
      INPUT ARRAY g_qcbd5_d FROM s_detail5.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = l_allow_insert, #此頁面insert功能由產生器控制, 手動之設定無效! 

                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 
         #自訂ACTION(detail_input,page_4)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body5.before_input2"
            {<point name="input.body5.before_input2"/>}
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd5_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL aqct300_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'2',"))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_qcbd5_d.getLength()
            #add-point:資料輸入前 name="input.body5.before_input"
            {<point name="input.body5.before_input"/>}
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_qcbd5_d[l_ac].* TO NULL 
            INITIALIZE g_qcbd5_d_t.* TO NULL 
            INITIALIZE g_qcbd5_d_o.* TO NULL 
            #公用欄位給值(單身4)
            
            #自定義預設值(單身4)
                  LET g_qcbd5_d[l_ac].qcbc001 = "0"
 
            #add-point:modify段before備份 name="input.body5.insert.before_bak"
            {<point name="input.body5.insert.before_bak"/>}
            #end add-point
            LET g_qcbd5_d_t.* = g_qcbd5_d[l_ac].*     #新輸入資料
            LET g_qcbd5_d_o.* = g_qcbd5_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aqct300_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body5.insert.after_set_entry_b"
            {<point name="input.body5.insert.after_set_entry_b"/>}
            #end add-point
            CALL aqct300_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_qcbd5_d[li_reproduce_target].* = g_qcbd5_d[li_reproduce].*
 
               LET g_qcbd5_d[li_reproduce_target].qcbcseq = NULL
            END IF
            
 
            #add-point:modify段before insert name="input.body5.before_insert"
            {<point name="input.body5.before_insert"/>}
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body5.before_row2"
            {<point name="input.body5.before_row2"/>}
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[4] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 4
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd5_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd5_d[l_ac].qcbcseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_qcbd5_d_t.* = g_qcbd5_d[l_ac].*  #BACKUP
               LET g_qcbd5_d_o.* = g_qcbd5_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body5.after_set_entry_b"
               {<point name="input.body5.after_set_entry_b"/>}
               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               IF NOT aqct300_lock_b("qcbc_t","'4'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aqct300_bcl3 INTO g_qcbd5_d[l_ac].qcbcseq,g_qcbd5_d[l_ac].qcbc001,g_qcbd5_d[l_ac].qcbc002, 
                      g_qcbd5_d[l_ac].qcbc012,g_qcbd5_d[l_ac].qcbc013,g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004, 
                      g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_qcbd5_d[l_ac].qcbc008, 
                      g_qcbd5_d[l_ac].qcbc009,g_qcbd5_d[l_ac].qcbc010,g_qcbd5_d[l_ac].qcbc011,g_qcbd5_d[l_ac].qcbcsite 

                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_qcbd5_d_mask_o[l_ac].* =  g_qcbd5_d[l_ac].*
                  CALL aqct300_qcbc_t_mask()
                  LET g_qcbd5_d_mask_n[l_ac].* =  g_qcbd5_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body5.before_row"
            {<point name="input.body5.before_row"/>}
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body5.after_delete_d"
               {<point name="input.body5.after_delete_d"/>}
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body5.b_delete_ask"
               {<point name="input.body5.b_delete_ask" />}
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身4刪除前 name="input.body5.b_delete"
               {<point name="input.body5.b_delete" mark="Y"/>}
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_qcba_m.qcbadocno
               LET gs_keys[gs_keys.getLength()+1] = g_qcbd5_d_t.qcbcseq
            
               #刪除同層單身
               IF NOT aqct300_delete_b('qcbc_t',gs_keys,"'4'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT aqct300_key_delete_b(gs_keys,'qcbc_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身4刪除中 name="input.body5.m_delete"
               {<point name="input.body5.m_delete"/>}
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE aqct300_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身4刪除後 name="input.body5.a_delete"
               {<point name="input.body5.a_delete"/>}
               #end add-point
               LET l_count = g_qcbd_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body5.after_delete"
               {<point name="input.body5.after_delete"/>}
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_qcbd5_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身4新增前 name="input.body5.b_a_insert"
            {<point name="input.body5.b_a_insert"/>}
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM qcbc_t 
             WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
               AND qcbcseq = g_qcbd5_d[l_ac].qcbcseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身4新增前 name="input.body5.b_insert"
               {<point name="input.body5.b_insert"/>}
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd5_d[g_detail_idx].qcbcseq
               CALL aqct300_insert_b('qcbc_t',gs_keys,"'4'")
                           
               #add-point:單身新增後4 name="input.body5.a_insert"
               {<point name="input.body5.a_insert"/>}
               #end add-point
            ELSE    
               INITIALIZE g_qcbd_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbc_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aqct300_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body5.after_insert"
               {<point name="input.body5.after_insert"/>}
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl3
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
            ELSE
               #add-point:單身page4修改前 name="input.body5.b_update"
               {<point name="input.body5.b_update" mark="Y"/>}
               #end add-point
               
               #寫入修改者/修改日期資訊(單身4)
               
               
               #將遮罩欄位還原
               CALL aqct300_qcbc_t_mask_restore('restore_mask_o')
                              
               UPDATE qcbc_t SET (qcbcdocno,qcbcseq,qcbc001,qcbc002,qcbc012,qcbc013,qcbc003,qcbc004, 
                   qcbc005,qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbcsite) = (g_qcba_m.qcbadocno, 
                   g_qcbd5_d[l_ac].qcbcseq,g_qcbd5_d[l_ac].qcbc001,g_qcbd5_d[l_ac].qcbc002,g_qcbd5_d[l_ac].qcbc012, 
                   g_qcbd5_d[l_ac].qcbc013,g_qcbd5_d[l_ac].qcbc003,g_qcbd5_d[l_ac].qcbc004,g_qcbd5_d[l_ac].qcbc005, 
                   g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007,g_qcbd5_d[l_ac].qcbc008,g_qcbd5_d[l_ac].qcbc009, 
                   g_qcbd5_d[l_ac].qcbc010,g_qcbd5_d[l_ac].qcbc011,g_qcbd5_d[l_ac].qcbcsite) #自訂欄位頁簽 

                WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcba_m.qcbadocno
                  AND qcbcseq = g_qcbd5_d_t.qcbcseq #項次 
                  
               #add-point:單身page4修改中 name="input.body5.m_update"
               {<point name="input.body5.m_update"/>}
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbc_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbc_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd5_d[g_detail_idx].qcbcseq
               LET gs_keys_bak[2] = g_qcbd5_d_t.qcbcseq
               CALL aqct300_update_b('qcbc_t',gs_keys,gs_keys_bak,"'4'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL aqct300_qcbc_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_qcbd5_d[g_detail_idx].qcbcseq = g_qcbd5_d_t.qcbcseq 
                  ) THEN
                  LET gs_keys[01] = g_qcba_m.qcbadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_qcbd5_d_t.qcbcseq
                  CALL aqct300_key_update_b(gs_keys,'qcbc_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd5_d_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd5_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page4修改後 name="input.body5.a_update"
               {<point name="input.body5.a_update"/>}
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbcseq
            #add-point:BEFORE FIELD qcbcseq name="input.b.page5.qcbcseq"
            {<point name="input.b.page5.qcbcseq" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbcseq
            
            #add-point:AFTER FIELD qcbcseq name="input.a.page5.qcbcseq"
            {<point name="input.a.page5.qcbcseq" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbcseq
            #add-point:ON CHANGE qcbcseq name="input.g.page5.qcbcseq"
            {<point name="input.g.page5.qcbcseq" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc001
            #add-point:BEFORE FIELD qcbc001 name="input.b.page5.qcbc001"
            {<point name="input.b.page5.qcbc001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc001
            
            #add-point:AFTER FIELD qcbc001 name="input.a.page5.qcbc001"
            {<point name="input.a.page5.qcbc001" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc001
            #add-point:ON CHANGE qcbc001 name="input.g.page5.qcbc001"
            {<point name="input.g.page5.qcbc001" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc002
            
            #add-point:AFTER FIELD qcbc002 name="input.a.page5.qcbc002"
            {<point name="input.a.page5.qcbc002" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc002
            #add-point:BEFORE FIELD qcbc002 name="input.b.page5.qcbc002"
            {<point name="input.b.page5.qcbc002" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc002
            #add-point:ON CHANGE qcbc002 name="input.g.page5.qcbc002"
            {<point name="input.g.page5.qcbc002" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc002_desc
            #add-point:BEFORE FIELD qcbc002_desc name="input.b.page5.qcbc002_desc"
            {<point name="input.b.page5.qcbc002_desc" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc002_desc
            
            #add-point:AFTER FIELD qcbc002_desc name="input.a.page5.qcbc002_desc"
            {<point name="input.a.page5.qcbc002_desc" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc002_desc
            #add-point:ON CHANGE qcbc002_desc name="input.g.page5.qcbc002_desc"
            {<point name="input.g.page5.qcbc002_desc" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc012
            #add-point:BEFORE FIELD qcbc012 name="input.b.page5.qcbc012"
            {<point name="input.b.page5.qcbc012" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc012
            
            #add-point:AFTER FIELD qcbc012 name="input.a.page5.qcbc012"
            {<point name="input.a.page5.qcbc012" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc012
            #add-point:ON CHANGE qcbc012 name="input.g.page5.qcbc012"
            {<point name="input.g.page5.qcbc012" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc013
            #add-point:BEFORE FIELD qcbc013 name="input.b.page5.qcbc013"
            {<point name="input.b.page5.qcbc013" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc013
            
            #add-point:AFTER FIELD qcbc013 name="input.a.page5.qcbc013"
            {<point name="input.a.page5.qcbc013" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc013
            #add-point:ON CHANGE qcbc013 name="input.g.page5.qcbc013"
            {<point name="input.g.page5.qcbc013" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc003
            
            #add-point:AFTER FIELD qcbc003 name="input.a.page5.qcbc003"
            {<point name="input.a.page5.qcbc003" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc003
            #add-point:BEFORE FIELD qcbc003 name="input.b.page5.qcbc003"
            {<point name="input.b.page5.qcbc003" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc003
            #add-point:ON CHANGE qcbc003 name="input.g.page5.qcbc003"
            {<point name="input.g.page5.qcbc003" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc004
            
            #add-point:AFTER FIELD qcbc004 name="input.a.page5.qcbc004"
            {<point name="input.a.page5.qcbc004" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc004
            #add-point:BEFORE FIELD qcbc004 name="input.b.page5.qcbc004"
            {<point name="input.b.page5.qcbc004" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc004
            #add-point:ON CHANGE qcbc004 name="input.g.page5.qcbc004"
            {<point name="input.g.page5.qcbc004" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc005
            
            #add-point:AFTER FIELD qcbc005 name="input.a.page5.qcbc005"
            {<point name="input.a.page5.qcbc005" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc005
            #add-point:BEFORE FIELD qcbc005 name="input.b.page5.qcbc005"
            {<point name="input.b.page5.qcbc005" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc005
            #add-point:ON CHANGE qcbc005 name="input.g.page5.qcbc005"
            {<point name="input.g.page5.qcbc005" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc006
            
            #add-point:AFTER FIELD qcbc006 name="input.a.page5.qcbc006"
            {<point name="input.a.page5.qcbc006" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc006
            #add-point:BEFORE FIELD qcbc006 name="input.b.page5.qcbc006"
            {<point name="input.b.page5.qcbc006" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc006
            #add-point:ON CHANGE qcbc006 name="input.g.page5.qcbc006"
            {<point name="input.g.page5.qcbc006" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc007
            #add-point:BEFORE FIELD qcbc007 name="input.b.page5.qcbc007"
            {<point name="input.b.page5.qcbc007" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc007
            
            #add-point:AFTER FIELD qcbc007 name="input.a.page5.qcbc007"
            {<point name="input.a.page5.qcbc007" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc007
            #add-point:ON CHANGE qcbc007 name="input.g.page5.qcbc007"
            {<point name="input.g.page5.qcbc007" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc008
            
            #add-point:AFTER FIELD qcbc008 name="input.a.page5.qcbc008"
            {<point name="input.a.page5.qcbc008" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc008
            #add-point:BEFORE FIELD qcbc008 name="input.b.page5.qcbc008"
            {<point name="input.b.page5.qcbc008" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc008
            #add-point:ON CHANGE qcbc008 name="input.g.page5.qcbc008"
            {<point name="input.g.page5.qcbc008" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc009
            #應用 a15 樣板自動產生(Version:3)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_qcbd5_d[l_ac].qcbc009,"0","0","","","azz-00079",1) THEN
               NEXT FIELD qcbc009
            END IF 
 
 
 
            #add-point:AFTER FIELD qcbc009 name="input.a.page5.qcbc009"
            {<point name="input.a.page5.qcbc009" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc009
            #add-point:BEFORE FIELD qcbc009 name="input.b.page5.qcbc009"
            {<point name="input.b.page5.qcbc009" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc009
            #add-point:ON CHANGE qcbc009 name="input.g.page5.qcbc009"
            {<point name="input.g.page5.qcbc009" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc010
            #add-point:BEFORE FIELD qcbc010 name="input.b.page5.qcbc010"
            {<point name="input.b.page5.qcbc010" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc010
            
            #add-point:AFTER FIELD qcbc010 name="input.a.page5.qcbc010"
            {<point name="input.a.page5.qcbc010" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc010
            #add-point:ON CHANGE qcbc010 name="input.g.page5.qcbc010"
            {<point name="input.g.page5.qcbc010" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbc011
            #add-point:BEFORE FIELD qcbc011 name="input.b.page5.qcbc011"
            {<point name="input.b.page5.qcbc011" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbc011
            
            #add-point:AFTER FIELD qcbc011 name="input.a.page5.qcbc011"
            {<point name="input.a.page5.qcbc011" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbc011
            #add-point:ON CHANGE qcbc011 name="input.g.page5.qcbc011"
            {<point name="input.g.page5.qcbc011" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbcsite
            #add-point:BEFORE FIELD qcbcsite name="input.b.page5.qcbcsite"
            {<point name="input.b.page5.qcbcsite" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbcsite
            
            #add-point:AFTER FIELD qcbcsite name="input.a.page5.qcbcsite"
            {<point name="input.a.page5.qcbcsite" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbcsite
            #add-point:ON CHANGE qcbcsite name="input.g.page5.qcbcsite"
            {<point name="input.g.page5.qcbcsite" />}
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page5.qcbcseq
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbcseq
            #add-point:ON ACTION controlp INFIELD qcbcseq name="input.c.page5.qcbcseq"
            {<point name="input.c.page5.qcbcseq" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc001
            #add-point:ON ACTION controlp INFIELD qcbc001 name="input.c.page5.qcbc001"
            {<point name="input.c.page5.qcbc001" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc002
            #add-point:ON ACTION controlp INFIELD qcbc002 name="input.c.page5.qcbc002"
            {<point name="input.c.page5.qcbc002" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc002_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc002_desc
            #add-point:ON ACTION controlp INFIELD qcbc002_desc name="input.c.page5.qcbc002_desc"
            {<point name="input.c.page5.qcbc002_desc" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc012
            #add-point:ON ACTION controlp INFIELD qcbc012 name="input.c.page5.qcbc012"
            {<point name="input.c.page5.qcbc012" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc013
            #add-point:ON ACTION controlp INFIELD qcbc013 name="input.c.page5.qcbc013"
            {<point name="input.c.page5.qcbc013" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc003
            #add-point:ON ACTION controlp INFIELD qcbc003 name="input.c.page5.qcbc003"
            {<point name="input.c.page5.qcbc003" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc004
            #add-point:ON ACTION controlp INFIELD qcbc004 name="input.c.page5.qcbc004"
            {<point name="input.c.page5.qcbc004" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc005
            #add-point:ON ACTION controlp INFIELD qcbc005 name="input.c.page5.qcbc005"
            {<point name="input.c.page5.qcbc005" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc006
            #add-point:ON ACTION controlp INFIELD qcbc006 name="input.c.page5.qcbc006"
            {<point name="input.c.page5.qcbc006" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc007
            #add-point:ON ACTION controlp INFIELD qcbc007 name="input.c.page5.qcbc007"
            {<point name="input.c.page5.qcbc007" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc008
            #add-point:ON ACTION controlp INFIELD qcbc008 name="input.c.page5.qcbc008"
            {<point name="input.c.page5.qcbc008" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc009
            #add-point:ON ACTION controlp INFIELD qcbc009 name="input.c.page5.qcbc009"
            {<point name="input.c.page5.qcbc009" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc010
            #add-point:ON ACTION controlp INFIELD qcbc010 name="input.c.page5.qcbc010"
            {<point name="input.c.page5.qcbc010" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbc011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbc011
            #add-point:ON ACTION controlp INFIELD qcbc011 name="input.c.page5.qcbc011"
            {<point name="input.c.page5.qcbc011" />}
            #END add-point
 
 
         #Ctrlp:input.c.page5.qcbcsite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbcsite
            #add-point:ON ACTION controlp INFIELD qcbcsite name="input.c.page5.qcbcsite"
            {<point name="input.c.page5.qcbcsite" />}
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page4 after_row name="input.body5.after_row"
            {<point name="input.body5.after_row"/>}
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_qcbd5_d[l_ac].* = g_qcbd5_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl3
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL aqct300_unlock_b("qcbc_t","'4'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page4 after_row2 name="input.body5.after_row2"
            {<point name="input.body5.after_row2"/>}
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body5.after_input"
            {<point name="input.body5.after_input"/>}
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_qcbd5_d[li_reproduce_target].* = g_qcbd5_d[li_reproduce].*
 
               LET g_qcbd5_d[li_reproduce_target].qcbcseq = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_qcbd5_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_qcbd5_d.getLength()+1
            END IF
            
      END INPUT
 
      
      INPUT ARRAY g_qcbd2_d FROM s_detail2.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = l_allow_insert, #此頁面insert功能由產生器控制, 手動之設定無效! 

                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 
         #自訂ACTION(detail_input,page_2)
         
        
         BEFORE INPUT
            #先將上層單身的idx放入g_detail_idx
            LET g_detail_idx_tmp = g_detail_idx
            LET g_detail_idx = g_detail_idx_list[1]
            #檢查上層單身是否為空
            IF g_detail_idx = 0 OR g_qcbd_d.getLength() = 0 THEN
               NEXT FIELD qcbdseq
            END IF
            #檢查上層單身是否有資料
            IF cl_null(g_qcbd_d[g_detail_idx].qcbdseq) THEN
               NEXT FIELD qcbdseq
            END IF
            #add-point:資料輸入前 name="input.body2.before_input2"
            {<point name="input.body2.before_input2"/>}
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd2_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            #如果一直都在單身2則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'3',"))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_qcbd2_d.getLength()
            #add-point:資料輸入前 name="input.body2.before_input"
            {<point name="input.body2.before_input"/>}
            #end add-point
            
         BEFORE INSERT
            
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_qcbd2_d[l_ac].* TO NULL 
            INITIALIZE g_qcbd2_d_t.* TO NULL 
            INITIALIZE g_qcbd2_d_o.* TO NULL 
            #公用欄位給值(單身2)
            
            #自定義預設值(單身2)
            
            #add-point:modify段before備份 name="input.body2.insert.before_bak"
            {<point name="input.body2.insert.before_bak"/>}
            #end add-point
            LET g_qcbd2_d_t.* = g_qcbd2_d[l_ac].*     #新輸入資料
            LET g_qcbd2_d_o.* = g_qcbd2_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aqct300_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body2.insert.after_set_entry_b"
            {<point name="input.body2.insert.after_set_entry_b"/>}
            #end add-point
            CALL aqct300_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_qcbd2_d[li_reproduce_target].* = g_qcbd2_d[li_reproduce].*
 
               LET g_qcbd2_d[li_reproduce_target].qcbe001 = NULL
            END IF
            
 
            #add-point:modify段before insert name="input.body2.before_insert"
            {<point name="input.body2.before_insert"/>}
            #end add-point  
            
         BEFORE ROW
            #add-point:modify段before row2 name="input.body2.before_row2"
            {<point name="input.body2.before_row2"/>}
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET l_ac = ARR_CURR()
            LET g_detail_idx2 = l_ac
            LET g_detail_idx_list[2] = l_ac
            LET g_current_page = 2
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            #(ver:78) ---start---
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            #(ver:78) --- end ---
            OPEN aqct300_bcl USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_bcl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CLOSE aqct300_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd2_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd2_d[l_ac].qcbe001 IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_qcbd2_d_t.* = g_qcbd2_d[l_ac].*  #BACKUP
               LET g_qcbd2_d_o.* = g_qcbd2_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body2.after_set_entry_b"
               {<point name="input.body2.after_set_entry_b"/>}
               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               IF NOT aqct300_lock_b("qcbe_t","'2'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aqct300_bcl4 INTO g_qcbd2_d[l_ac].qcbe001,g_qcbd2_d[l_ac].qcbe002,g_qcbd2_d[l_ac].qcbe004, 
                      g_qcbd2_d[l_ac].qcbe003,g_qcbd2_d[l_ac].qcbesite
                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_qcbd2_d_mask_o[l_ac].* =  g_qcbd2_d[l_ac].*
                  CALL aqct300_qcbe_t_mask()
                  LET g_qcbd2_d_mask_n[l_ac].* =  g_qcbd2_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body2.before_row"
            {<point name="input.body2.before_row"/>}
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body2.after_delete_d"
               {<point name="input.body2.after_delete_d"/>}
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body2.b_delete_ask"
               {<point name="input.body2.b_delete_ask" />}
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身2刪除前 name="input.body2.b_delete"
               {<point name="input.body2.b_delete" mark="Y"/>}
               #end add-point    
 
               #取得該筆資料key值
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd2_d_t.qcbe001
 
 
               #刪除同層單身
               IF NOT aqct300_delete_b('qcbe_t',gs_keys,"'2'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身2刪除中 name="input.body2.m_delete"
               {<point name="input.body2.m_delete"/>}
               #end add-point   
               
               CALL s_transaction_end('Y','0')
               CLOSE aqct300_bcl
                  
               LET g_rec_b = g_rec_b-1
               #add-point:單身2刪除後 name="input.body2.a_delete"
               {<point name="input.body2.a_delete"/>}
               #end add-point
 
               LET l_count = g_qcbd_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body2.after_delete"
               {<point name="input.body2.after_delete"/>}
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_qcbd2_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
         
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身2新增前 name="input.body2.b_a_insert"
            {<point name="input.body2.b_a_insert"/>}
            #end add-point
    
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM qcbe_t 
             WHERE qcbeent = g_enterprise AND qcbedocno = g_qcba_m.qcbadocno AND qcbeseq = g_qcbd_d[g_detail_idx].qcbdseq  
                 AND qcbe001 = g_qcbd2_d[g_detail_idx2].qcbe001
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身2新增前 name="input.body2.b_insert"
               {<point name="input.body2.b_insert"/>}
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd2_d[g_detail_idx2].qcbe001
               CALL aqct300_insert_b('qcbe_t',gs_keys,"'2'")
                           
               #add-point:單身新增後2 name="input.body2.a_insert"
               {<point name="input.body2.a_insert"/>}
               #end add-point
            ELSE    
               INITIALIZE g_qcbd_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aqct300_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body2.after_insert"
               {<point name="input.body2.after_insert"/>}
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
            #還原g_detail_idx
            LET g_detail_idx = g_detail_idx_tmp
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_qcbd2_d[l_ac].* = g_qcbd2_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl4
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_qcbd2_d[l_ac].* = g_qcbd2_d_t.*
            ELSE
               #add-point:單身page2修改前 name="input.body2.b_update"
               {<point name="input.body2.b_update" mark="Y"/>}
               #end add-point
               
               #寫入修改者/修改日期資訊(單身2)
               
               
               #將遮罩欄位還原
               CALL aqct300_qcbe_t_mask_restore('restore_mask_o')
               
               UPDATE qcbe_t SET (qcbedocno,qcbeseq,qcbe001,qcbe002,qcbe004,qcbe003,qcbesite) = (g_qcba_m.qcbadocno, 
                   g_qcbd_d[g_detail_idx].qcbdseq,g_qcbd2_d[l_ac].qcbe001,g_qcbd2_d[l_ac].qcbe002,g_qcbd2_d[l_ac].qcbe004, 
                   g_qcbd2_d[l_ac].qcbe003,g_qcbd2_d[l_ac].qcbesite) #自訂欄位頁簽
                WHERE qcbeent = g_enterprise AND qcbedocno = g_qcbadocno_t AND qcbeseq = g_qcbd_d[g_detail_idx].qcbdseq  
                    AND qcbe001 = g_qcbd2_d_t.qcbe001
                  
               #add-point:單身page2修改中 name="input.body2.m_update"
               {<point name="input.body2.m_update"/>}
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_qcbd2_d[l_ac].* = g_qcbd2_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbe_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_qcbd2_d[l_ac].* = g_qcbd2_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys_bak[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd2_d[g_detail_idx2].qcbe001
               LET gs_keys_bak[3] = g_qcbd2_d_t.qcbe001
               CALL aqct300_update_b('qcbe_t',gs_keys,gs_keys_bak,"'2'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL aqct300_qcbe_t_mask_restore('restore_mask_n')
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd2_d_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd2_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page2修改後 name="input.body2.a_update"
               {<point name="input.body2.a_update"/>}
               #end add-point
            END IF
         
                  #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe001
            
            #add-point:AFTER FIELD qcbe001 name="input.a.page2.qcbe001"
            {<point name="input.a.page2.qcbe001" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe001
            #add-point:BEFORE FIELD qcbe001 name="input.b.page2.qcbe001"
            {<point name="input.b.page2.qcbe001" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbe001
            #add-point:ON CHANGE qcbe001 name="input.g.page2.qcbe001"
            {<point name="input.g.page2.qcbe001" />}
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe002
            #應用 a15 樣板自動產生(Version:3)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_qcbd2_d[l_ac].qcbe002,"0","0","","","azz-00079",1) THEN
               NEXT FIELD qcbe002
            END IF 
 
 
 
            #add-point:AFTER FIELD qcbe002 name="input.a.page2.qcbe002"
            {<point name="input.a.page2.qcbe002" />}
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe002
            #add-point:BEFORE FIELD qcbe002 name="input.b.page2.qcbe002"
            {<point name="input.b.page2.qcbe002" />}
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbe002
            #add-point:ON CHANGE qcbe002 name="input.g.page2.qcbe002"
            {<point name="input.g.page2.qcbe002" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe004
            #add-point:BEFORE FIELD qcbe004 name="input.b.page2.qcbe004"
            {<point name="input.b.page2.qcbe004" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe004
            
            #add-point:AFTER FIELD qcbe004 name="input.a.page2.qcbe004"
            {<point name="input.a.page2.qcbe004" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbe004
            #add-point:ON CHANGE qcbe004 name="input.g.page2.qcbe004"
            {<point name="input.g.page2.qcbe004" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbe003
            #add-point:BEFORE FIELD qcbe003 name="input.b.page2.qcbe003"
            {<point name="input.b.page2.qcbe003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbe003
            
            #add-point:AFTER FIELD qcbe003 name="input.a.page2.qcbe003"
            {<point name="input.a.page2.qcbe003" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbe003
            #add-point:ON CHANGE qcbe003 name="input.g.page2.qcbe003"
            {<point name="input.g.page2.qcbe003" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbesite
            #add-point:BEFORE FIELD qcbesite name="input.b.page2.qcbesite"
            {<point name="input.b.page2.qcbesite" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbesite
            
            #add-point:AFTER FIELD qcbesite name="input.a.page2.qcbesite"
            {<point name="input.a.page2.qcbesite" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbesite
            #add-point:ON CHANGE qcbesite name="input.g.page2.qcbesite"
            {<point name="input.g.page2.qcbesite" />}
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page2.qcbe001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe001
            #add-point:ON ACTION controlp INFIELD qcbe001 name="input.c.page2.qcbe001"
            {<point name="input.c.page2.qcbe001" />}
            #END add-point
 
 
         #Ctrlp:input.c.page2.qcbe002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe002
            #add-point:ON ACTION controlp INFIELD qcbe002 name="input.c.page2.qcbe002"
            {<point name="input.c.page2.qcbe002" />}
            #END add-point
 
 
         #Ctrlp:input.c.page2.qcbe004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe004
            #add-point:ON ACTION controlp INFIELD qcbe004 name="input.c.page2.qcbe004"
            {<point name="input.c.page2.qcbe004" />}
            #END add-point
 
 
         #Ctrlp:input.c.page2.qcbe003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbe003
            #add-point:ON ACTION controlp INFIELD qcbe003 name="input.c.page2.qcbe003"
            {<point name="input.c.page2.qcbe003" />}
            #END add-point
 
 
         #Ctrlp:input.c.page2.qcbesite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbesite
            #add-point:ON ACTION controlp INFIELD qcbesite name="input.c.page2.qcbesite"
            {<point name="input.c.page2.qcbesite" />}
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page2_after_row name="input.body2.after_row"
            {<point name="input.body2.after_row"/>}
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_qcbd2_d[l_ac].* = g_qcbd2_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl4
               CLOSE aqct300_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL aqct300_unlock_b("qcbe_t","'2'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page2_after_row2 name="input.body2.after_row2"
            {<point name="input.body2.after_row2"/>}
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body2.after_input"
            {<point name="input.body2.after_input"/>}
            #end add-point  
 
         ON ACTION controlo    
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_qcbd2_d[li_reproduce_target].* = g_qcbd2_d[li_reproduce].*
 
               LET g_qcbd2_d[li_reproduce_target].qcbe001 = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_qcbd2_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_qcbd2_d.getLength()+1
            END IF
        
      END INPUT
      INPUT ARRAY g_qcbd7_d FROM s_detail7.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = l_allow_insert, #此頁面insert功能由產生器控制, 手動之設定無效! 

                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 
         #自訂ACTION(detail_input,page_5)
         
        
         BEFORE INPUT
            #先將上層單身的idx放入g_detail_idx
            LET g_detail_idx_tmp = g_detail_idx
            LET g_detail_idx = g_detail_idx_list[1]
            #檢查上層單身是否為空
            IF g_detail_idx = 0 OR g_qcbd_d.getLength() = 0 THEN
               NEXT FIELD qcbdseq
            END IF
            #檢查上層單身是否有資料
            IF cl_null(g_qcbd_d[g_detail_idx].qcbdseq) THEN
               NEXT FIELD qcbdseq
            END IF
            #add-point:資料輸入前 name="input.body7.before_input2"
            {<point name="input.body7.before_input2"/>}
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_qcbd7_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            #如果一直都在單身2則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'5',"))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_qcbd7_d.getLength()
            #add-point:資料輸入前 name="input.body7.before_input"
            {<point name="input.body7.before_input"/>}
            #end add-point
            
         BEFORE INSERT
            
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_qcbd7_d[l_ac].* TO NULL 
            INITIALIZE g_qcbd7_d_t.* TO NULL 
            INITIALIZE g_qcbd7_d_o.* TO NULL 
            #公用欄位給值(單身5)
            
            #自定義預設值(單身5)
            
            #add-point:modify段before備份 name="input.body7.insert.before_bak"
            {<point name="input.body7.insert.before_bak"/>}
            #end add-point
            LET g_qcbd7_d_t.* = g_qcbd7_d[l_ac].*     #新輸入資料
            LET g_qcbd7_d_o.* = g_qcbd7_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aqct300_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body7.insert.after_set_entry_b"
            {<point name="input.body7.insert.after_set_entry_b"/>}
            #end add-point
            CALL aqct300_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_qcbd7_d[li_reproduce_target].* = g_qcbd7_d[li_reproduce].*
 
               LET g_qcbd7_d[li_reproduce_target].qcbg001 = NULL
            END IF
            
 
            #add-point:modify段before insert name="input.body7.before_insert"
            {<point name="input.body7.before_insert"/>}
            #end add-point  
            
         BEFORE ROW
            #add-point:modify段before row2 name="input.body7.before_row2"
            {<point name="input.body7.before_row2"/>}
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET l_ac = ARR_CURR()
            LET g_detail_idx2 = l_ac
            LET g_detail_idx_list[5] = l_ac
            LET g_current_page = 5
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
            #(ver:78) ---start---
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            #(ver:78) --- end ---
            OPEN aqct300_bcl USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq
            IF SQLCA.SQLCODE THEN   #(ver:78)
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN aqct300_bcl:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
               LET g_errparam.popup = TRUE 
               CLOSE aqct300_cl
               CLOSE aqct300_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_qcbd7_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_qcbd7_d[l_ac].qcbg001 IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_qcbd7_d_t.* = g_qcbd7_d[l_ac].*  #BACKUP
               LET g_qcbd7_d_o.* = g_qcbd7_d[l_ac].*  #BACKUP
               CALL aqct300_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body7.after_set_entry_b"
               {<point name="input.body7.after_set_entry_b"/>}
               #end add-point  
               CALL aqct300_set_no_entry_b(l_cmd)
               IF NOT aqct300_lock_b("qcbg_t","'5'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aqct300_bcl5 INTO g_qcbd7_d[l_ac].qcbg001,g_qcbd7_d[l_ac].qcbg002,g_qcbd7_d[l_ac].qcbg003, 
                      g_qcbd7_d[l_ac].qcbgsite
                  IF SQLCA.SQLCODE THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_qcbd7_d_mask_o[l_ac].* =  g_qcbd7_d[l_ac].*
                  CALL aqct300_qcbg_t_mask()
                  LET g_qcbd7_d_mask_n[l_ac].* =  g_qcbd7_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL aqct300_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body7.before_row"
            {<point name="input.body7.before_row"/>}
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
            #其他table進行lock
            
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body7.after_delete_d"
               {<point name="input.body7.after_delete_d"/>}
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body7.b_delete_ask"
               {<point name="input.body7.b_delete_ask" />}
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code = -263 
                  LET g_errparam.popup = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身5刪除前 name="input.body7.b_delete"
               {<point name="input.body7.b_delete" mark="Y"/>}
               #end add-point    
 
               #取得該筆資料key值
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd7_d_t.qcbg001
 
 
               #刪除同層單身
               IF NOT aqct300_delete_b('qcbg_t',gs_keys,"'5'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE aqct300_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
               
               #add-point:單身5刪除中 name="input.body7.m_delete"
               {<point name="input.body7.m_delete"/>}
               #end add-point   
               
               CALL s_transaction_end('Y','0')
               CLOSE aqct300_bcl
                  
               LET g_rec_b = g_rec_b-1
               #add-point:單身5刪除後 name="input.body7.a_delete"
               {<point name="input.body7.a_delete"/>}
               #end add-point
 
               LET l_count = g_qcbd_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body7.after_delete"
               {<point name="input.body7.after_delete"/>}
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_qcbd7_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
         
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身5新增前 name="input.body7.b_a_insert"
            {<point name="input.body7.b_a_insert"/>}
            #end add-point
    
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM qcbg_t 
             WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcba_m.qcbadocno AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq  
                 AND qcbg001 = g_qcbd7_d[g_detail_idx2].qcbg001
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身5新增前 name="input.body7.b_insert"
               {<point name="input.body7.b_insert"/>}
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd7_d[g_detail_idx2].qcbg001
               CALL aqct300_insert_b('qcbg_t',gs_keys,"'5'")
                           
               #add-point:單身新增後5 name="input.body7.a_insert"
               {<point name="input.body7.a_insert"/>}
               #end add-point
            ELSE    
               INITIALIZE g_qcbd_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code = "std-00006" 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aqct300_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body7.after_insert"
               {<point name="input.body7.after_insert"/>}
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
            #還原g_detail_idx
            LET g_detail_idx = g_detail_idx_tmp
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_qcbd7_d[l_ac].* = g_qcbd7_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl5
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = -263 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               LET g_qcbd7_d[l_ac].* = g_qcbd7_d_t.*
            ELSE
               #add-point:單身page5修改前 name="input.body7.b_update"
               {<point name="input.body7.b_update" mark="Y"/>}
               #end add-point
               
               #寫入修改者/修改日期資訊(單身5)
               
               
               #將遮罩欄位還原
               CALL aqct300_qcbg_t_mask_restore('restore_mask_o')
               
               UPDATE qcbg_t SET (qcbgdocno,qcbgseq,qcbg001,qcbg002,qcbg003,qcbgsite) = (g_qcba_m.qcbadocno, 
                   g_qcbd_d[g_detail_idx].qcbdseq,g_qcbd7_d[l_ac].qcbg001,g_qcbd7_d[l_ac].qcbg002,g_qcbd7_d[l_ac].qcbg003, 
                   g_qcbd7_d[l_ac].qcbgsite) #自訂欄位頁簽
                WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcbadocno_t AND qcbgseq = g_qcbd_d[g_detail_idx].qcbdseq  
                    AND qcbg001 = g_qcbd7_d_t.qcbg001
                  
               #add-point:單身page5修改中 name="input.body7.m_update"
               {<point name="input.body7.m_update"/>}
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_qcbd7_d[l_ac].* = g_qcbd7_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbg_t" 
                     LET g_errparam.code = "std-00009" 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.SQLCODE #其他錯誤
                     LET g_qcbd7_d[l_ac].* = g_qcbd7_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
                     LET g_errparam.code = SQLCA.SQLCODE 
                     LET g_errparam.popup = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_qcba_m.qcbadocno
               LET gs_keys_bak[1] = g_qcbadocno_t
               LET gs_keys[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys_bak[2] = g_qcbd_d[g_detail_idx].qcbdseq
               LET gs_keys[3] = g_qcbd7_d[g_detail_idx2].qcbg001
               LET gs_keys_bak[3] = g_qcbd7_d_t.qcbg001
               CALL aqct300_update_b('qcbg_t',gs_keys,gs_keys_bak,"'5'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL aqct300_qcbg_t_mask_restore('restore_mask_n')
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd7_d_t)
               LET g_log2 = util.JSON.stringify(g_qcba_m),util.JSON.stringify(g_qcbd7_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page5修改後 name="input.body7.a_update"
               {<point name="input.body7.a_update"/>}
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbg001
            #add-point:BEFORE FIELD qcbg001 name="input.b.page7.qcbg001"
            {<point name="input.b.page7.qcbg001" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbg001
            
            #add-point:AFTER FIELD qcbg001 name="input.a.page7.qcbg001"
            {<point name="input.a.page7.qcbg001" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbg001
            #add-point:ON CHANGE qcbg001 name="input.g.page7.qcbg001"
            {<point name="input.g.page7.qcbg001" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbg002
            #add-point:BEFORE FIELD qcbg002 name="input.b.page7.qcbg002"
            {<point name="input.b.page7.qcbg002" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbg002
            
            #add-point:AFTER FIELD qcbg002 name="input.a.page7.qcbg002"
            {<point name="input.a.page7.qcbg002" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbg002
            #add-point:ON CHANGE qcbg002 name="input.g.page7.qcbg002"
            {<point name="input.g.page7.qcbg002" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbg003
            #add-point:BEFORE FIELD qcbg003 name="input.b.page7.qcbg003"
            {<point name="input.b.page7.qcbg003" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbg003
            
            #add-point:AFTER FIELD qcbg003 name="input.a.page7.qcbg003"
            {<point name="input.a.page7.qcbg003" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbg003
            #add-point:ON CHANGE qcbg003 name="input.g.page7.qcbg003"
            {<point name="input.g.page7.qcbg003" />}
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD qcbgsite
            #add-point:BEFORE FIELD qcbgsite name="input.b.page7.qcbgsite"
            {<point name="input.b.page7.qcbgsite" />}
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD qcbgsite
            
            #add-point:AFTER FIELD qcbgsite name="input.a.page7.qcbgsite"
            {<point name="input.a.page7.qcbgsite" />}
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE qcbgsite
            #add-point:ON CHANGE qcbgsite name="input.g.page7.qcbgsite"
            {<point name="input.g.page7.qcbgsite" />}
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page7.qcbg001
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbg001
            #add-point:ON ACTION controlp INFIELD qcbg001 name="input.c.page7.qcbg001"
            {<point name="input.c.page7.qcbg001" />}
            #END add-point
 
 
         #Ctrlp:input.c.page7.qcbg002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbg002
            #add-point:ON ACTION controlp INFIELD qcbg002 name="input.c.page7.qcbg002"
            {<point name="input.c.page7.qcbg002" />}
            #END add-point
 
 
         #Ctrlp:input.c.page7.qcbg003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbg003
            #add-point:ON ACTION controlp INFIELD qcbg003 name="input.c.page7.qcbg003"
            {<point name="input.c.page7.qcbg003" />}
            #END add-point
 
 
         #Ctrlp:input.c.page7.qcbgsite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD qcbgsite
            #add-point:ON ACTION controlp INFIELD qcbgsite name="input.c.page7.qcbgsite"
            {<point name="input.c.page7.qcbgsite" />}
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page5_after_row name="input.body7.after_row"
            {<point name="input.body7.after_row"/>}
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_qcbd7_d[l_ac].* = g_qcbd7_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code = 9001 
               LET g_errparam.popup = FALSE 
               CLOSE aqct300_bcl5
               CLOSE aqct300_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL aqct300_unlock_b("qcbg_t","'5'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page5_after_row2 name="input.body7.after_row2"
            {<point name="input.body7.after_row2"/>}
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body7.after_input"
            {<point name="input.body7.after_input"/>}
            #end add-point  
 
         ON ACTION controlo    
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_qcbd7_d[li_reproduce_target].* = g_qcbd7_d[li_reproduce].*
 
               LET g_qcbd7_d[li_reproduce_target].qcbg001 = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_qcbd7_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_qcbd7_d.getLength()+1
            END IF
        
      END INPUT
 
 
 
]]>
</section>
  <section id="aqct300.input.other" ver="18" ch="" status="" src="s" readonly="">
<![CDATA[      
      #add-point:自定義input name="input.more_input"
      {<point name="input.more_input"/>}
      #end add-point
    
      BEFORE DIALOG 
         #CALL cl_err_collect_init()    
         #add-point:input段before dialog name="input.before_dialog"
         {<point name="input.before_dialog"/>}
         #end add-point    
         #重新導回資料到正確位置上
         CALL DIALOG.setCurrentRow("s_detail1",g_idx_group.getValue("'1',"))      
         CALL DIALOG.setCurrentRow("s_detail2",g_idx_group.getValue("'3',"))
         CALL DIALOG.setCurrentRow("s_detail4",g_idx_group.getValue("'4',"))
         CALL DIALOG.setCurrentRow("s_detail5",g_idx_group.getValue("'2',"))
         CALL DIALOG.setCurrentRow("s_detail7",g_idx_group.getValue("'5',"))
 
         #新增時強制從單頭開始填
         IF p_cmd = 'a' THEN
            #add-point:input段next_field name="input.next_field"
            {<point name="input.next_field"/>}
            #end add-point  
            NEXT FIELD qcbadocno
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD qcbdseq
               WHEN "s_detail2"
                  NEXT FIELD qcbe001
               WHEN "s_detail4"
                  NEXT FIELD qcbb001
               WHEN "s_detail5"
                  NEXT FIELD qcbcseq
               WHEN "s_detail7"
                  NEXT FIELD qcbg001
 
               #add-point:input段modify_detail  name="input.modify_detail.other"
               {<point name="input.modify_detail.other"/>}
               #end add-point  
            END CASE
         END IF
      
      AFTER DIALOG
         #add-point:input段after_dialog name="input.after_dialog"
         {<point name="input.after_dialog"/>}
         #end add-point    
         
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         IF g_header_hidden THEN
            CALL gfrm_curr.setElementHidden("vb_master",0)
            CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
            LET g_header_hidden = 0     #visible
         ELSE
            CALL gfrm_curr.setElementHidden("vb_master",1)
            CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
            LET g_header_hidden = 1     #hidden     
         END IF
 
      ON ACTION accept
         #add-point:input段accept  name="input.accept"
         {<point name="input.accept"/>}
         #end add-point    
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         #add-point:input段cancel name="input.cancel"
         {<point name="input.cancel"/>}
         #end add-point  
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
         LET g_detail_idx_list[4] = 1
         LET g_detail_idx_list[5] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail4",1)
         CALL g_curr_diag.setCurrentRow("s_detail5",1)
         CALL g_curr_diag.setCurrentRow("s_detail7",1)
 
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         #add-point:input段close name="input.close"
         {<point name="input.close"/>}
         #end add-point  
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         #add-point:input段exit name="input.exit"
         {<point name="input.exit"/>}
         #end add-point
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
         LET g_detail_idx_list[4] = 1
         LET g_detail_idx_list[5] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail4",1)
         CALL g_curr_diag.setCurrentRow("s_detail5",1)
         CALL g_curr_diag.setCurrentRow("s_detail7",1)
 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
    
   #add-point:input段after input  name="input.after_input"
   {<point name="input.after_input"/>}
   #end add-point    
 
END FUNCTION
]]>
</section>
  <section id="aqct300.show" ver="35" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單頭資料重新顯示及單身資料重抓
PRIVATE FUNCTION aqct300_show()
   #add-point:show段define(客製用) name="show.define_customerization"
   {<point name="show.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   DEFINE l_ac_t    LIKE type_t.num10
   #add-point:show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="show.define"
   {<point name="show.define"/>} 
   #end add-point  
   
   #add-point:Function前置處理 name="show.before"
   {<point name="show.before"/>}
   #end add-point
   
   
   
   IF g_bfill = "Y" THEN
      CALL aqct300_b_fill() #單身填充
      CALL aqct300_b_fill2('0') #單身填充
   END IF
     
   #帶出公用欄位reference值
   #應用 a12 樣板自動產生(Version:4)
 
 
 
   
   #顯示followup圖示
   #應用 a48 樣板自動產生(Version:3)
   CALL aqct300_set_pk_array()
   #add-point:ON ACTION agendum name="show.follow_pic"
   {<point name="show.follow_pic"/>}
   #END add-point
   CALL cl_user_overview_set_follow_pic()
  
 
 
 
   
   LET l_ac_t = l_ac
   
   #讀入ref值(單頭)
   #add-point:show段reference name="show.head.reference"
   {<point name="show.head.reference"/>}
   #end add-point
   
   #遮罩相關處理
   LET g_qcba_m_mask_o.* =  g_qcba_m.*
   CALL aqct300_qcba_t_mask()
   LET g_qcba_m_mask_n.* =  g_qcba_m.*
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba900_desc,g_qcba_m.qcbadocno_desc, 
       g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcba901_desc,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba005_desc,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009, 
       g_qcba_m.qcba009_desc,g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba012_desc, 
       g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.qcba013,g_qcba_m.qcba013_desc,g_qcba_m.qcba020,g_qcba_m.qcba021, 
       g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba024_desc,g_qcba_m.qcba016,g_qcba_m.qcba016_desc, 
       g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.imae116,g_qcba_m.qcba018,g_qcba_m.qcba019, 
       g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033, 
       g_qcba_m.qcbaownid,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid, 
       g_qcba_m.qcbacrtid_desc,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid, 
       g_qcba_m.qcbamodid_desc,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfid_desc,g_qcba_m.qcbacnfdt 

   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_qcba_m.qcbastus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
   
   #讀入ref值(單身)
   FOR l_ac = 1 TO g_qcbd_d.getLength()
      #add-point:show段單身reference name="show.body.reference"
      {<point name="show.body.reference"/>}
      #end add-point
   END FOR
   
   FOR l_ac = 1 TO g_qcbd2_d.getLength()
      #add-point:show段單身reference name="show.body2.reference"
      {<point name="show.body2.reference"/>}
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_qcbd4_d.getLength()
      #add-point:show段單身reference name="show.body4.reference"
      {<point name="show.body4.reference"/>}
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_qcbd5_d.getLength()
      #add-point:show段單身reference name="show.body5.reference"
      {<point name="show.body5.reference"/>}
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_qcbd7_d.getLength()
      #add-point:show段單身reference name="show.body7.reference"
      {<point name="show.body7.reference"/>}
      #end add-point
   END FOR
 
   
    
   
   #add-point:show段other name="show.other"
   {<point name="show.other"/>}
   #end add-point  
   
   LET l_ac = l_ac_t
   
   #移動上下筆可以連動切換資料
   CALL cl_show_fld_cont()     
 
   CALL aqct300_detail_show()
 
   #add-point:show段之後 name="show.after"
   {<point name="show.after"/>}
   #end add-point
   
END FUNCTION
]]>
</section>
  <section id="aqct300.detail_show" ver="9" ch="" status="" src="s" readonly="">
<![CDATA[#+ 第二階單身reference
PRIVATE FUNCTION aqct300_detail_show()
   #add-point:detail_show段define(客製用) name="detail_show.define_customerization"
   {<point name="detail_show.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   #add-point:detail_show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="detail_show.define"
   {<point name="detail_show.define"/>} 
   #end add-point  
   
   #add-point:Function前置處理 name="detail_show.before"
   {<point name="detail_show.before"/>}
   #end add-point
   
   #add-point:detail_show段之後 name="detail_show.after"
   {<point name="detail_show.after"/>}
   #end add-point
   
END FUNCTION
]]>
</section>
  <section id="aqct300.reproduce" ver="40" ch="" status="" src="s" readonly="">
<![CDATA[#+ 資料複製
PRIVATE FUNCTION aqct300_reproduce()
   #add-point:reproduce段define(客製用) name="reproduce.define_customerization"
   {<point name="reproduce.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   DEFINE l_newno     LIKE qcba_t.qcbadocno 
   DEFINE l_oldno     LIKE qcba_t.qcbadocno 
 
   DEFINE l_master    RECORD LIKE qcba_t.* #此變數樣板目前無使用
   DEFINE l_detail    RECORD LIKE qcbd_t.* #此變數樣板目前無使用
   DEFINE l_detail2    RECORD LIKE qcbb_t.* #此變數樣板目前無使用
 
   DEFINE l_detail3    RECORD LIKE qcbc_t.* #此變數樣板目前無使用
 
 
   DEFINE l_detail4    RECORD LIKE qcbe_t.* #此變數樣板目前無使用
 
   DEFINE l_detail5    RECORD LIKE qcbg_t.* #此變數樣板目前無使用
 
 
   DEFINE l_cnt       LIKE type_t.num10
   #add-point:reproduce段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="reproduce.define"
   {<point name="reproduce.define"/>} 
   #end add-point   
   
   #add-point:Function前置處理  name="reproduce.pre_function"
   {<point name="reproduce.pre_function"/>}
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
   
   LET g_master_insert = FALSE
   
   IF g_qcba_m.qcbadocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
    
   LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
    
   LET g_qcba_m.qcbadocno = ""
 
 
   CALL cl_set_head_visible("","YES")
 
   #公用欄位給予預設值
   #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_qcba_m.qcbaownid = g_user
      LET g_qcba_m.qcbaowndp = g_dept
      LET g_qcba_m.qcbacrtid = g_user
      LET g_qcba_m.qcbacrtdp = g_dept 
      LET g_qcba_m.qcbacrtdt = cl_get_current()
      LET g_qcba_m.qcbamodid = g_user
      LET g_qcba_m.qcbamoddt = cl_get_current()
      LET g_qcba_m.qcbastus = 'N'
 
 
 
   
   CALL s_transaction_begin()
   
   #add-point:複製輸入前 name="reproduce.head.b_input"
   {<point name="reproduce.head.b_input"/>}
   #end add-point
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_qcba_m.qcbastus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
   
   #清空key欄位的desc
      LET g_qcba_m.qcbadocno_desc = ''
   DISPLAY BY NAME g_qcba_m.qcbadocno_desc
 
   
   CALL aqct300_input("r")
   
   IF INT_FLAG AND NOT g_master_insert THEN
      LET INT_FLAG = 0
      DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
      DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
      LET INT_FLAG = 0
      INITIALIZE g_qcba_m.* TO NULL
      INITIALIZE g_qcbd_d TO NULL
      INITIALIZE g_qcbd2_d TO NULL
      INITIALIZE g_qcbd4_d TO NULL
      INITIALIZE g_qcbd5_d TO NULL
      INITIALIZE g_qcbd7_d TO NULL
 
      #add-point:複製取消後 name="reproduce.cancel"
      {<point name="reproduce.cancel" />}
      #end add-point
      CALL aqct300_show()
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = '' 
      LET g_errparam.code = 9001 
      LET g_errparam.popup = FALSE 
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL aqct300_set_act_visible()   
   CALL aqct300_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
   
   #組合新增資料的條件
   LET g_add_browse = " qcbaent = " ||g_enterprise|| " AND",
                      " qcbadocno = '", g_qcba_m.qcbadocno, "' "
 
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL aqct300_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   #add-point:完成複製段落後 name="reproduce.after_reproduce"
   {<point name="reproduce.after_reproduce" />}
   #end add-point
   
   CALL aqct300_idx_chk()
   
   LET g_data_owner = g_qcba_m.qcbaownid      
   LET g_data_dept  = g_qcba_m.qcbaowndp
   
   #功能已完成,通報訊息中心
   CALL aqct300_msgcentre_notify('reproduce')
 
END FUNCTION
]]>
</section>
  <section id="aqct300.detail_reproduce" ver="27" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身自動複製
PRIVATE FUNCTION aqct300_detail_reproduce()
   #add-point:delete段define(客製用) name="detail_reproduce.define_customerization"
   {<point name="detail_reproduce.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   DEFINE ls_sql      STRING
   DEFINE ld_date     DATETIME YEAR TO SECOND
   DEFINE l_detail    RECORD LIKE qcbd_t.* #此變數樣板目前無使用
   DEFINE l_detail2    RECORD LIKE qcbb_t.* #此變數樣板目前無使用
 
   DEFINE l_detail3    RECORD LIKE qcbc_t.* #此變數樣板目前無使用
 
 
   DEFINE l_detail4    RECORD LIKE qcbe_t.* #此變數樣板目前無使用
 
   DEFINE l_detail5    RECORD LIKE qcbg_t.* #此變數樣板目前無使用
 
 
   #add-point:delete段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="detail_reproduce.define"
   {<point name="detail_reproduce.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理  name="detail_reproduce.pre_function"
   {<point name="detail_reproduce.pre_function"/>}
   #end add-point
   
   CALL s_transaction_begin()
   
   LET ld_date = cl_get_current()
   
   DROP TABLE aqct300_detail
   
   #add-point:單身複製前1 name="detail_reproduce.body.table1.b_insert"
   {<point name="detail_reproduce.body.table1.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM qcbd_t
    WHERE qcbdent = g_enterprise AND qcbddocno = g_qcbadocno_t
 
    INTO TEMP aqct300_detail
 
   #將key修正為調整後   
   UPDATE aqct300_detail 
      #更新key欄位
      SET qcbddocno = g_qcba_m.qcbadocno
 
      #更新共用欄位
      
 
   #add-point:單身修改前 name="detail_reproduce.body.table1.b_update"
   {<point name="detail_reproduce.body.table1.b_update"/>}
   #end add-point                                       
  
   #將資料塞回原table   
   INSERT INTO qcbd_t SELECT * FROM aqct300_detail
   
   IF SQLCA.SQLCODE THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "reproduce:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE 
      LET g_errparam.popup = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #add-point:單身複製中1 name="detail_reproduce.body.table1.m_insert"
   {<point name="detail_reproduce.body.table1.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE aqct300_detail
   
   #add-point:單身複製後1 name="detail_reproduce.body.table1.a_insert"
   {<point name="detail_reproduce.body.table1.a_insert"/>}
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table2.b_insert"
   {<point name="detail_reproduce.body.table2.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM qcbb_t 
    WHERE qcbbent = g_enterprise AND qcbbdocno = g_qcbadocno_t
 
    INTO TEMP aqct300_detail
 
   #將key修正為調整後   
   UPDATE aqct300_detail SET qcbbdocno = g_qcba_m.qcbadocno
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table2.b_update"
   {<point name="detail_reproduce.body.table2.b_update"/>}
   #end add-point    
 
   #將資料塞回原table   
   INSERT INTO qcbb_t SELECT * FROM aqct300_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table2.m_insert"
   {<point name="detail_reproduce.body.table2.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE aqct300_detail
   
   #add-point:單身複製後 name="detail_reproduce.body.table2.a_insert"
   {<point name="detail_reproduce.body.table2.a_insert"/>}
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table3.b_insert"
   {<point name="detail_reproduce.body.table3.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM qcbc_t 
    WHERE qcbcent = g_enterprise AND qcbcdocno = g_qcbadocno_t
 
    INTO TEMP aqct300_detail
 
   #將key修正為調整後   
   UPDATE aqct300_detail SET qcbcdocno = g_qcba_m.qcbadocno
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table3.b_update"
   {<point name="detail_reproduce.body.table3.b_update"/>}
   #end add-point    
 
   #將資料塞回原table   
   INSERT INTO qcbc_t SELECT * FROM aqct300_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table3.m_insert"
   {<point name="detail_reproduce.body.table3.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE aqct300_detail
   
   #add-point:單身複製後 name="detail_reproduce.body.table3.a_insert"
   {<point name="detail_reproduce.body.table3.a_insert"/>}
   #end add-point
 
 
   
   #add-point:單身複製前 name="detail_reproduce.body.table4.b_insert"
   {<point name="detail_reproduce.body.table4.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM qcbe_t 
    WHERE qcbeent = g_enterprise AND qcbedocno = g_qcbadocno_t
 
    INTO TEMP aqct300_detail
 
   #將key修正為調整後   
   UPDATE aqct300_detail SET qcbedocno = g_qcba_m.qcbadocno
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table4.b_update"
   {<point name="detail_reproduce.body.table4.b_update"/>}
   #end add-point    
  
   #將資料塞回原table   
   INSERT INTO qcbe_t SELECT * FROM aqct300_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table4.m_insert"
   {<point name="detail_reproduce.body.table4.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE aqct300_detail
   
   LET g_data_owner = g_qcba_m.qcbaownid      
   LET g_data_dept  = g_qcba_m.qcbaowndp
   
   #add-point:單身複製後 name="detail_reproduce.body.table4.a_insert"
   {<point name="detail_reproduce.body.table4.a_insert"/>}
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table5.b_insert"
   {<point name="detail_reproduce.body.table5.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM qcbg_t 
    WHERE qcbgent = g_enterprise AND qcbgdocno = g_qcbadocno_t
 
    INTO TEMP aqct300_detail
 
   #將key修正為調整後   
   UPDATE aqct300_detail SET qcbgdocno = g_qcba_m.qcbadocno
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table5.b_update"
   {<point name="detail_reproduce.body.table5.b_update"/>}
   #end add-point    
  
   #將資料塞回原table   
   INSERT INTO qcbg_t SELECT * FROM aqct300_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table5.m_insert"
   {<point name="detail_reproduce.body.table5.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE aqct300_detail
   
   LET g_data_owner = g_qcba_m.qcbaownid      
   LET g_data_dept  = g_qcba_m.qcbaowndp
   
   #add-point:單身複製後 name="detail_reproduce.body.table5.a_insert"
   {<point name="detail_reproduce.body.table5.a_insert"/>}
   #end add-point
 
 
   
   #多語言複製段落
   
   
   CALL s_transaction_end('Y','0')
   
   #已新增完, 調整資料內容(修改時使用)
   LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
   
END FUNCTION
]]>
</section>
  <section id="aqct300.delete" ver="55" ch="" status="" src="s" readonly="">
<![CDATA[#+ 資料刪除
PRIVATE FUNCTION aqct300_delete()
   #add-point:delete段define(客製用) name="delete.define_customerization"
   {<point name="delete.define_customerization" edit="c" mark="Y"/>}
   #end add-point     
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   #add-point:delete段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="delete.define"
   {<point name="delete.define"/>} 
   #end add-point     
   
   #add-point:Function前置處理  name="delete.pre_function"
   {<point name="delete.pre_function"/>}
   #end add-point
   
   IF g_qcba_m.qcbadocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
   
   
   
   CALL s_transaction_begin()
 
   OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
   IF SQLCA.SQLCODE THEN   #(ver:78)
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN aqct300_cl:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:78)
      LET g_errparam.popup = TRUE 
      CLOSE aqct300_cl
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE aqct300_master_referesh USING g_qcba_m.qcbadocno INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt, 
       g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017, 
       g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
       g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018, 
       g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026, 
       g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp, 
       g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt, 
       g_qcba_m.qcba900_desc,g_qcba_m.qcba901_desc,g_qcba_m.qcba005_desc,g_qcba_m.qcba009_desc,g_qcba_m.qcba013_desc, 
       g_qcba_m.qcba024_desc,g_qcba_m.qcba016_desc,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid_desc, 
       g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbacnfid_desc
   
   
   #檢查是否允許此動作
   IF NOT aqct300_action_chk() THEN
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_qcba_m_mask_o.* =  g_qcba_m.*
   CALL aqct300_qcba_t_mask()
   LET g_qcba_m_mask_n.* =  g_qcba_m.*
   
   CALL aqct300_show()
   
   #add-point:delete段before ask name="delete.before_ask"
   {<point name="delete.before_ask"/>}
   #end add-point 
 
   IF cl_ask_del_master() THEN              #確認一下
   
      #add-point:單頭刪除前 name="delete.head.b_delete"
      {<point name="delete.head.b_delete" mark="Y"/>}
      #end add-point   
      
      #應用 a47 樣板自動產生(Version:4)
      #刪除相關文件
      CALL aqct300_set_pk_array()
      #add-point:相關文件刪除前 name="delete.befroe.related_document_remove"
      {<point name="delete.befroe.related_document_remove"/>}
      #end add-point   
      CALL cl_doc_remove()  
 
 
 
  
  
      #資料備份
      LET g_qcbadocno_t = g_qcba_m.qcbadocno
 
 
      DELETE FROM qcba_t
       WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
 
       
      #add-point:單頭刪除中 name="delete.head.m_delete"
      {<point name="delete.head.m_delete"/>}
      #end add-point
       
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_qcba_m.qcbadocno,":",SQLERRMESSAGE  
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF
      
      #add-point:單頭刪除後 name="delete.head.a_delete"
      {<point name="delete.head.a_delete"/>}
      #end add-point
  
      #add-point:單身刪除前 name="delete.body.b_delete"
      {<point name="delete.body.b_delete" mark="Y"/>}
      #end add-point
      
      DELETE FROM qcbd_t
       WHERE qcbdent = g_enterprise AND qcbddocno = g_qcba_m.qcbadocno
 
 
      #add-point:單身刪除中 name="delete.body.m_delete"
      {<point name="delete.body.m_delete"/>}
      #end add-point
         
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbd_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF    
 
      #add-point:單身刪除後 name="delete.body.a_delete"
      {<point name="delete.body.a_delete"/>}
      #end add-point
      
            
                                                               
      #add-point:單身刪除前 name="delete.body.b_delete2"
      {<point name="delete.body.b_delete2" mark="Y"/>}
      #end add-point
      DELETE FROM qcbb_t
       WHERE qcbbent = g_enterprise AND
             qcbbdocno = g_qcba_m.qcbadocno
      #add-point:單身刪除中 name="delete.body.m_delete2"
      {<point name="delete.body.m_delete2"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete2"
      {<point name="delete.body.a_delete2"/>}
      #end add-point
 
      #add-point:單身刪除前 name="delete.body.b_delete3"
      {<point name="delete.body.b_delete3" mark="Y"/>}
      #end add-point
      DELETE FROM qcbc_t
       WHERE qcbcent = g_enterprise AND
             qcbcdocno = g_qcba_m.qcbadocno
      #add-point:單身刪除中 name="delete.body.m_delete3"
      {<point name="delete.body.m_delete3"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbb_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete3"
      {<point name="delete.body.a_delete3"/>}
      #end add-point
 
 
 
      #add-point:單身刪除前 name="delete.body.b_delete4"
      {<point name="delete.body.b_delete4" mark="Y"/>}
      #end add-point
      DELETE FROM qcbe_t
       WHERE qcbeent = g_enterprise AND
             qcbedocno = g_qcba_m.qcbadocno
      #add-point:單身刪除中 name="delete.body.m_delete4"
      {<point name="delete.body.m_delete4"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete4"
      {<point name="delete.body.a_delete4"/>}
      #end add-point
 
      #add-point:單身刪除前 name="delete.body.b_delete5"
      {<point name="delete.body.b_delete5" mark="Y"/>}
      #end add-point
      DELETE FROM qcbg_t
       WHERE qcbgent = g_enterprise AND
             qcbgdocno = g_qcba_m.qcbadocno
      #add-point:單身刪除中 name="delete.body.m_delete5"
      {<point name="delete.body.m_delete5"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete5"
      {<point name="delete.body.a_delete5"/>}
      #end add-point
 
 
      
      #修改歷程記錄(刪除)
      LET g_log1 = util.JSON.stringify(g_qcba_m)   #(ver:78)
      IF NOT cl_log_modified_record(g_log1,'') THEN    #(ver:78)
         CLOSE aqct300_cl
         CALL s_transaction_end('N','0')
         RETURN
      END IF
             
      CLEAR FORM
      CALL g_qcbd_d.clear() 
      CALL g_qcbd2_d.clear()       
      CALL g_qcbd4_d.clear()       
      CALL g_qcbd5_d.clear()       
      CALL g_qcbd7_d.clear()       
 
     
      CALL aqct300_ui_browser_refresh()  
      #CALL aqct300_ui_headershow()  
      #CALL aqct300_ui_detailshow()
 
      #add-point:多語言刪除 name="delete.lang.before_delete"
      {<point name="delete.lang.before_delete"/>}
      #end add-point
      
      #單頭多語言刪除
      
      
      #單身多語言刪除
      
      
      
      
      
 
   
      #add-point:多語言刪除 name="delete.lang.delete"
      {<point name="delete.lang.delete"/>}
      #end add-point
      
      IF g_browser_cnt > 0 THEN 
         #CALL aqct300_browser_fill("")
         CALL aqct300_fetch('P')
         DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
         DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
      ELSE
         CLEAR FORM
      END IF
      
      CALL s_transaction_end('Y','0')
   ELSE
      CALL s_transaction_end('N','0')
   END IF
 
   CLOSE aqct300_cl
 
   #功能已完成,通報訊息中心
   CALL aqct300_msgcentre_notify('delete')
    
END FUNCTION
]]>
</section>
  <section id="aqct300.b_fill" ver="40" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身陣列填充
PRIVATE FUNCTION aqct300_b_fill()
   #add-point:b_fill段define(客製用) name="b_fill.define_customerization"
   {<point name="b_fill.define_customerization" edit="c" mark="Y"/>}
   #end add-point     
   DEFINE p_wc2      STRING
   DEFINE li_idx     LIKE type_t.num10
   #add-point:b_fill段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="b_fill.define"
   {<point name="b_fill.define"/>} 
   #end add-point     
   
   #add-point:Function前置處理  name="b_fill.pre_function"
   {<point name="b_fill.pre_function"/>}
   #end add-point
   
   #清空第一階單身
   CALL g_qcbd_d.clear()
   CALL g_qcbd4_d.clear()
   CALL g_qcbd5_d.clear()
 
 
   #add-point:b_fill段sql_before name="b_fill.sql_before"
   {<point name="b_fill.sql_before"/>}
   #end add-point
   
   #判斷是否填充
   IF aqct300_fill_chk(1) THEN
      #切換上下筆時不重組SQL
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
      #add-point:b_fill段long_sql_if name="b_fill.long_sql_if"
      {<point name="b_fill.long_sql_if"/>}
      #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT qcbdseq,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004,qcbd005,qcbd006, 
             qcbd007,qcbd008,qcbd009,qcbd010,qcbd021,qcbd011,qcbdsite  FROM qcbd_t",   
                     " INNER JOIN qcba_t ON qcbaent = " ||g_enterprise|| " AND qcbadocno = qcbddocno ",
 
                     #"",
                     " LEFT JOIN qcbe_t ON qcbdent = qcbeent AND qcbddocno = qcbedocno AND qcbdseq = qcbeseq ",
               " LEFT JOIN qcbg_t ON qcbdent = qcbgent AND qcbddocno = qcbgdocno AND qcbdseq = qcbgseq ",
                     "",
                     #下層單身所需的join條件
                     " ",
 
                     " ",
 
 
                     
                     " WHERE qcbdent=? AND qcbddocno=?"
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段sql_before name="b_fill.body.fill_sql"
         {<point name="b_fill.body.fill_sql"/>}
         #end add-point
         IF NOT cl_null(g_wc2_table1) THEN
            LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
         END IF
         
         #子單身的WC
            IF NOT cl_null(g_wc2_table4) THEN 
      LET g_sql = g_sql CLIPPED," AND ", g_wc2_table4 CLIPPED
   END IF 
   IF NOT cl_null(g_wc2_table5) THEN 
      LET g_sql = g_sql CLIPPED," AND ", g_wc2_table5 CLIPPED
   END IF 
 
         
         LET g_sql = g_sql, " ORDER BY qcbd_t.qcbdseq"
         
         #add-point:單身填充控制 name="b_fill.sql"
         {<point name="b_fill.sql"/>}
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE aqct300_pb FROM g_sql
         DECLARE b_fill_cs CURSOR FOR aqct300_pb
      END IF
      
      LET g_cnt = l_ac
      LET l_ac = 1
      
   #  OPEN b_fill_cs USING g_enterprise,g_qcba_m.qcbadocno   #(ver:78)
                                               
      FOREACH b_fill_cs USING g_enterprise,g_qcba_m.qcbadocno INTO g_qcbd_d[l_ac].qcbdseq,g_qcbd_d[l_ac].qcbd001, 
          g_qcbd_d[l_ac].qcbd002,g_qcbd_d[l_ac].qcbd003,g_qcbd_d[l_ac].qcbd020,g_qcbd_d[l_ac].qcbd004, 
          g_qcbd_d[l_ac].qcbd005,g_qcbd_d[l_ac].qcbd006,g_qcbd_d[l_ac].qcbd007,g_qcbd_d[l_ac].qcbd008, 
          g_qcbd_d[l_ac].qcbd009,g_qcbd_d[l_ac].qcbd010,g_qcbd_d[l_ac].qcbd021,g_qcbd_d[l_ac].qcbd011, 
          g_qcbd_d[l_ac].qcbdsite   #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill.fill"
         {<point name="b_fill.fill"/>}
         #end add-point
      
         IF l_ac > g_max_rec THEN
            IF g_error_show = 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code = 9035 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
            END IF
            EXIT FOREACH
         END IF
         
         LET l_ac = l_ac + 1
      END FOREACH
      LET g_error_show = 0
   
   END IF
    
   #判斷是否填充
   IF aqct300_fill_chk(2) THEN
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
         #add-point:b_fill段long_sql_if name="b_fill.body2.long_sql_if"
         {<point name="b_fill.body2.long_sql_if"/>}
         #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT qcbb001,qcbb002,qcbb003,qcbb004,qcbb005,qcbb006,qcbbsite  FROM qcbb_t", 
                
                     " INNER JOIN  qcba_t ON qcbaent = " ||g_enterprise|| " AND qcbadocno = qcbbdocno ",
 
                     "",
                     
                     
                     " WHERE qcbbent=? AND qcbbdocno=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段fill_sql name="b_fill.body2.fill_sql"
         {<point name="b_fill.body2.fill_sql"/>}
         #end add-point
         IF NOT cl_null(g_wc2_table2) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table2 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY qcbb_t.qcbb001,qcbb_t.qcbb002,qcbb_t.qcbb003"
         
         #add-point:單身填充控制 name="b_fill.sql2"
         {<point name="b_fill.sql2"/>}
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE aqct300_pb2 FROM g_sql
         DECLARE b_fill_cs2 CURSOR FOR aqct300_pb2
      END IF
    
      LET l_ac = 1
      
   #  OPEN b_fill_cs2 USING g_enterprise,g_qcba_m.qcbadocno   #(ver:78)
                                               
      FOREACH b_fill_cs2 USING g_enterprise,g_qcba_m.qcbadocno INTO g_qcbd4_d[l_ac].qcbb001,g_qcbd4_d[l_ac].qcbb002, 
          g_qcbd4_d[l_ac].qcbb003,g_qcbd4_d[l_ac].qcbb004,g_qcbd4_d[l_ac].qcbb005,g_qcbd4_d[l_ac].qcbb006, 
          g_qcbd4_d[l_ac].qcbbsite   #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill2.fill"
         {<point name="b_fill2.fill"/>}
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code = 9035 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
   #判斷是否填充
   IF aqct300_fill_chk(3) THEN
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
         #add-point:b_fill段long_sql_if name="b_fill.body3.long_sql_if"
         {<point name="b_fill.body3.long_sql_if"/>}
         #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT qcbcseq,qcbc001,qcbc002,qcbc012,qcbc013,qcbc003,qcbc004,qcbc005, 
             qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbcsite ,t2.imaal003 ,t3.imaal004 ,t4.inayl003 , 
             t5.inab003 ,t6.oocal003 FROM qcbc_t",   
                     " INNER JOIN  qcba_t ON qcbaent = " ||g_enterprise|| " AND qcbadocno = qcbcdocno ",
 
                     "",
                     
                                    " LEFT JOIN imaal_t t2 ON t2.imaalent="||g_enterprise||" AND t2.imaal001=qcbc003 AND t2.imaal002='"||g_dlang||"' ",
               " LEFT JOIN imaal_t t3 ON t3.imaalent="||g_enterprise||" AND t3.imaal001=qcbc003 AND t3.imaal002='"||g_dlang||"' ",
               " LEFT JOIN inayl_t t4 ON t4.inaylent="||g_enterprise||" AND t4.inayl001=qcbc005 AND t4.inayl002='"||g_dlang||"' ",
               " LEFT JOIN inab_t t5 ON t5.inabent="||g_enterprise||" AND t5.inabsite=qcbcsite AND t5.inab001=qcbc005 AND t5.inab002=qcbc006  ",
               " LEFT JOIN oocal_t t6 ON t6.oocalent="||g_enterprise||" AND t6.oocal001=qcbc008 AND t6.oocal002='"||g_dlang||"' ",
 
                     " WHERE qcbcent=? AND qcbcdocno=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段fill_sql name="b_fill.body3.fill_sql"
         {<point name="b_fill.body3.fill_sql"/>}
         #end add-point
         IF NOT cl_null(g_wc2_table3) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table3 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY qcbc_t.qcbcseq"
         
         #add-point:單身填充控制 name="b_fill.sql3"
         {<point name="b_fill.sql3"/>}
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE aqct300_pb3 FROM g_sql
         DECLARE b_fill_cs3 CURSOR FOR aqct300_pb3
      END IF
    
      LET l_ac = 1
      
   #  OPEN b_fill_cs3 USING g_enterprise,g_qcba_m.qcbadocno   #(ver:78)
                                               
      FOREACH b_fill_cs3 USING g_enterprise,g_qcba_m.qcbadocno INTO g_qcbd5_d[l_ac].qcbcseq,g_qcbd5_d[l_ac].qcbc001, 
          g_qcbd5_d[l_ac].qcbc002,g_qcbd5_d[l_ac].qcbc012,g_qcbd5_d[l_ac].qcbc013,g_qcbd5_d[l_ac].qcbc003, 
          g_qcbd5_d[l_ac].qcbc004,g_qcbd5_d[l_ac].qcbc005,g_qcbd5_d[l_ac].qcbc006,g_qcbd5_d[l_ac].qcbc007, 
          g_qcbd5_d[l_ac].qcbc008,g_qcbd5_d[l_ac].qcbc009,g_qcbd5_d[l_ac].qcbc010,g_qcbd5_d[l_ac].qcbc011, 
          g_qcbd5_d[l_ac].qcbcsite,g_qcbd5_d[l_ac].qcbc003_desc,g_qcbd5_d[l_ac].qcbc003_desc_desc,g_qcbd5_d[l_ac].qcbc005_desc, 
          g_qcbd5_d[l_ac].qcbc006_desc,g_qcbd5_d[l_ac].qcbc008_desc   #(ver:78)
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill3.fill"
         {<point name="b_fill3.fill"/>}
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code = 9035 
            LET g_errparam.popup = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
 
   
   #add-point:browser_fill段其他table處理 name="browser_fill.other_fill"
   {<point name="browser_fill.other_fill"/>}
   #end add-point
   
   CALL g_qcbd_d.deleteElement(g_qcbd_d.getLength())
   CALL g_qcbd4_d.deleteElement(g_qcbd4_d.getLength())
   CALL g_qcbd5_d.deleteElement(g_qcbd5_d.getLength())
 
   
 
   LET l_ac = g_cnt
   LET g_cnt = 0  
   
   FREE aqct300_pb
   FREE aqct300_pb2
 
   FREE aqct300_pb3
 
 
   
   LET li_idx = l_ac
   
   #遮罩相關處理
   FOR l_ac = 1 TO g_qcbd_d.getLength()
      LET g_qcbd_d_mask_o[l_ac].* =  g_qcbd_d[l_ac].*
      CALL aqct300_qcbd_t_mask()
      LET g_qcbd_d_mask_n[l_ac].* =  g_qcbd_d[l_ac].*
   END FOR
   
   LET g_qcbd2_d_mask_o.* =  g_qcbd2_d.*
   FOR l_ac = 1 TO g_qcbd2_d.getLength()
      LET g_qcbd2_d_mask_o[l_ac].* =  g_qcbd2_d[l_ac].*
      CALL aqct300_qcbe_t_mask()
      LET g_qcbd2_d_mask_n[l_ac].* =  g_qcbd2_d[l_ac].*
   END FOR
   LET g_qcbd4_d_mask_o.* =  g_qcbd4_d.*
   FOR l_ac = 1 TO g_qcbd4_d.getLength()
      LET g_qcbd4_d_mask_o[l_ac].* =  g_qcbd4_d[l_ac].*
      CALL aqct300_qcbb_t_mask()
      LET g_qcbd4_d_mask_n[l_ac].* =  g_qcbd4_d[l_ac].*
   END FOR
   LET g_qcbd5_d_mask_o.* =  g_qcbd5_d.*
   FOR l_ac = 1 TO g_qcbd5_d.getLength()
      LET g_qcbd5_d_mask_o[l_ac].* =  g_qcbd5_d[l_ac].*
      CALL aqct300_qcbc_t_mask()
      LET g_qcbd5_d_mask_n[l_ac].* =  g_qcbd5_d[l_ac].*
   END FOR
   LET g_qcbd7_d_mask_o.* =  g_qcbd7_d.*
   FOR l_ac = 1 TO g_qcbd7_d.getLength()
      LET g_qcbd7_d_mask_o[l_ac].* =  g_qcbd7_d[l_ac].*
      CALL aqct300_qcbg_t_mask()
      LET g_qcbd7_d_mask_n[l_ac].* =  g_qcbd7_d[l_ac].*
   END FOR
 
   
   LET l_ac = li_idx
   
   CALL cl_ap_performance_next_end()
 
END FUNCTION
]]>
</section>
  <section id="aqct300.delete_b" ver="23" ch="" status="" src="s" readonly="">
<![CDATA[#+ 刪除單身後其他table連動
PRIVATE FUNCTION aqct300_delete_b(ps_table,ps_keys_bak,ps_page)
   #add-point:delete_b段define(客製用) name="delete_b.define_customerization"
   {<point name="delete_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point     
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:delete_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="delete_b.define"
   {<point name="delete_b.define"/>} 
   #end add-point     
   
   #add-point:Function前置處理  name="delete_b.pre_function"
   {<point name="delete_b.pre_function"/>}
   #end add-point
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete"
      {<point name="delete_b.b_delete" mark="Y"/>}
      #end add-point    
      DELETE FROM qcbd_t
       WHERE qcbdent = g_enterprise AND
         qcbddocno = ps_keys_bak[1] AND qcbdseq = ps_keys_bak[2]
      #add-point:delete_b段刪除中 name="delete_b.m_delete"
      {<point name="delete_b.m_delete"/>}
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = ":",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_qcbd_d.deleteElement(li_idx) 
      END IF 
 
   END IF
   
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete2"
      {<point name="delete_b.b_delete2" mark="Y"/>}
      #end add-point    
      DELETE FROM qcbb_t
       WHERE qcbbent = g_enterprise AND
             qcbbdocno = ps_keys_bak[1] AND qcbb001 = ps_keys_bak[2] AND qcbb002 = ps_keys_bak[3] AND qcbb003 = ps_keys_bak[4]
      #add-point:delete_b段刪除中 name="delete_b.m_delete2"
      {<point name="delete_b.m_delete2"/>}
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbb_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'3'" THEN 
         CALL g_qcbd4_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete2"
      {<point name="delete_b.a_delete2"/>}
      #end add-point    
   END IF
 
   LET ls_group = "'4',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete3"
      {<point name="delete_b.b_delete3" mark="Y"/>}
      #end add-point    
      DELETE FROM qcbc_t
       WHERE qcbcent = g_enterprise AND
             qcbcdocno = ps_keys_bak[1] AND qcbcseq = ps_keys_bak[2]
      #add-point:delete_b段刪除中 name="delete_b.m_delete3"
      {<point name="delete_b.m_delete3"/>}
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbc_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'4'" THEN 
         CALL g_qcbd5_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete3"
      {<point name="delete_b.a_delete3"/>}
      #end add-point    
   END IF
 
 
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table2
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete4"
      {<point name="delete_b.b_delete4" mark="Y"/>}
      #end add-point    
      DELETE FROM qcbe_t
       WHERE qcbeent = g_enterprise AND
             qcbedocno = ps_keys_bak[1] AND qcbeseq = ps_keys_bak[2] AND qcbe001 = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete4"
      {<point name="delete_b.m_delete4"/>}
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
    
      LET li_idx = g_detail_idx2
      IF ps_page <> "'2'" THEN 
         CALL g_qcbd2_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete4"
      {<point name="delete_b.a_delete4"/>}
      #end add-point    
   END IF
 
   LET ls_group = "'5',"
   #判斷是否是同一群組的table2
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete5"
      {<point name="delete_b.b_delete5" mark="Y"/>}
      #end add-point    
      DELETE FROM qcbg_t
       WHERE qcbgent = g_enterprise AND
             qcbgdocno = ps_keys_bak[1] AND qcbgseq = ps_keys_bak[2] AND qcbg001 = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete5"
      {<point name="delete_b.m_delete5"/>}
      #end add-point    
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
    
      LET li_idx = g_detail_idx2
      IF ps_page <> "'5'" THEN 
         CALL g_qcbd7_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete5"
      {<point name="delete_b.a_delete5"/>}
      #end add-point    
   END IF
 
 
   
   #add-point:delete_b段other name="delete_b.other"
   {<point name="delete_b.other"/>}
   #end add-point  
   
   RETURN TRUE
   
END FUNCTION
]]>
</section>
  <section id="aqct300.insert_b" ver="22" ch="" status="" src="s" readonly="">
<![CDATA[#+ 新增單身後其他table連動
PRIVATE FUNCTION aqct300_insert_b(ps_table,ps_keys,ps_page)
   #add-point:insert_b段define(客製用) name="insert_b.define_customerization"
   {<point name="insert_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point     
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys     DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE ls_page     STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:insert_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="insert_b.define"
   {<point name="insert_b.define"/>} 
   #end add-point     
   
   #add-point:Function前置處理  name="insert_b.pre_function"
   {<point name="insert_b.pre_function"/>}
   #end add-point
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert"
      {<point name="insert_b.before_insert" mark="Y"/>}
      #end add-point 
      INSERT INTO qcbd_t
                  (qcbdent,
                   qcbddocno,
                   qcbdseq
                   ,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004,qcbd005,qcbd006,qcbd007,qcbd008,qcbd009,qcbd010,qcbd021,qcbd011,qcbdsite) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2]
                   ,g_qcbd_d[g_detail_idx].qcbd001,g_qcbd_d[g_detail_idx].qcbd002,g_qcbd_d[g_detail_idx].qcbd003, 
                       g_qcbd_d[g_detail_idx].qcbd020,g_qcbd_d[g_detail_idx].qcbd004,g_qcbd_d[g_detail_idx].qcbd005, 
                       g_qcbd_d[g_detail_idx].qcbd006,g_qcbd_d[g_detail_idx].qcbd007,g_qcbd_d[g_detail_idx].qcbd008, 
                       g_qcbd_d[g_detail_idx].qcbd009,g_qcbd_d[g_detail_idx].qcbd010,g_qcbd_d[g_detail_idx].qcbd021, 
                       g_qcbd_d[g_detail_idx].qcbd011,g_qcbd_d[g_detail_idx].qcbdsite)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert"
      {<point name="insert_b.m_insert"/>}
      #end add-point 
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbd_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_qcbd_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert"
      {<point name="insert_b.after_insert"/>}
      #end add-point 
   END IF
   
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert2"
      {<point name="insert_b.before_insert2" mark="Y"/>}
      #end add-point 
      INSERT INTO qcbb_t
                  (qcbbent,
                   qcbbdocno,
                   qcbb001,qcbb002,qcbb003
                   ,qcbb004,qcbb005,qcbb006,qcbbsite) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4]
                   ,g_qcbd4_d[g_detail_idx].qcbb004,g_qcbd4_d[g_detail_idx].qcbb005,g_qcbd4_d[g_detail_idx].qcbb006, 
                       g_qcbd4_d[g_detail_idx].qcbbsite)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert2"
      {<point name="insert_b.m_insert2"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbb_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'3'" THEN 
         CALL g_qcbd4_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert2"
      {<point name="insert_b.after_insert2"/>}
      #end add-point
   END IF
 
   LET ls_group = "'4',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert3"
      {<point name="insert_b.before_insert3" mark="Y"/>}
      #end add-point 
      INSERT INTO qcbc_t
                  (qcbcent,
                   qcbcdocno,
                   qcbcseq
                   ,qcbc001,qcbc002,qcbc012,qcbc013,qcbc003,qcbc004,qcbc005,qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbcsite) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2]
                   ,g_qcbd5_d[g_detail_idx].qcbc001,g_qcbd5_d[g_detail_idx].qcbc002,g_qcbd5_d[g_detail_idx].qcbc012, 
                       g_qcbd5_d[g_detail_idx].qcbc013,g_qcbd5_d[g_detail_idx].qcbc003,g_qcbd5_d[g_detail_idx].qcbc004, 
                       g_qcbd5_d[g_detail_idx].qcbc005,g_qcbd5_d[g_detail_idx].qcbc006,g_qcbd5_d[g_detail_idx].qcbc007, 
                       g_qcbd5_d[g_detail_idx].qcbc008,g_qcbd5_d[g_detail_idx].qcbc009,g_qcbd5_d[g_detail_idx].qcbc010, 
                       g_qcbd5_d[g_detail_idx].qcbc011,g_qcbd5_d[g_detail_idx].qcbcsite)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert3"
      {<point name="insert_b.m_insert3"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbc_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'4'" THEN 
         CALL g_qcbd5_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert3"
      {<point name="insert_b.after_insert3"/>}
      #end add-point
   END IF
 
 
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert4"
      {<point name="insert_b.before_insert4" mark="Y"/>}
      #end add-point 
      INSERT INTO qcbe_t
                  (qcbeent,
                   qcbedocno,qcbeseq,
                   qcbe001
                   ,qcbe002,qcbe004,qcbe003,qcbesite) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_qcbd2_d[g_detail_idx2].qcbe002,g_qcbd2_d[g_detail_idx2].qcbe004,g_qcbd2_d[g_detail_idx2].qcbe003, 
                       g_qcbd2_d[g_detail_idx2].qcbesite)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert4"
      {<point name="insert_b.m_insert4"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx2
      IF ps_page <> "'2'" THEN 
         CALL g_qcbd2_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert4"
      {<point name="insert_b.after_insert4"/>}
      #end add-point
   END IF
 
   LET ls_group = "'5',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert5"
      {<point name="insert_b.before_insert5" mark="Y"/>}
      #end add-point 
      INSERT INTO qcbg_t
                  (qcbgent,
                   qcbgdocno,qcbgseq,
                   qcbg001
                   ,qcbg002,qcbg003,qcbgsite) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_qcbd7_d[g_detail_idx2].qcbg002,g_qcbd7_d[g_detail_idx2].qcbg003,g_qcbd7_d[g_detail_idx2].qcbgsite) 

      #add-point:insert_b段資料新增中 name="insert_b.m_insert5"
      {<point name="insert_b.m_insert5"/>}
      #end add-point
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx2
      IF ps_page <> "'5'" THEN 
         CALL g_qcbd7_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert5"
      {<point name="insert_b.after_insert5"/>}
      #end add-point
   END IF
 
 
   
   #add-point:insert_b段other name="insert_b.other"
   {<point name="insert_b.other"/>}
   #end add-point     
   
END FUNCTION
]]>
</section>
  <section id="aqct300.update_b" ver="25" ch="" status="" src="s" readonly="">
<![CDATA[#+ 修改單身後其他table連動
PRIVATE FUNCTION aqct300_update_b(ps_table,ps_keys,ps_keys_bak,ps_page)
   #add-point:update_b段define(客製用) name="update_b.define_customerization"
   {<point name="update_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   DEFINE ps_table         STRING
   DEFINE ps_page          STRING
   DEFINE ps_keys          DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_keys_bak      DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group         STRING
   DEFINE li_idx           LIKE type_t.num10 
   DEFINE lb_chk           BOOLEAN
   DEFINE l_new_key        DYNAMIC ARRAY OF STRING
   DEFINE l_old_key        DYNAMIC ARRAY OF STRING
   DEFINE l_field_key      DYNAMIC ARRAY OF STRING
   #add-point:update_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="update_b.define"
   {<point name="update_b.define"/>} 
   #end add-point   
   
   #add-point:Function前置處理  name="update_b.pre_function"
   {<point name="update_b.pre_function"/>}
   #end add-point
   
   LET g_update = TRUE   
   
   #判斷key是否有改變
   LET lb_chk = TRUE
   FOR li_idx = 1 TO ps_keys.getLength()
      IF ps_keys[li_idx] <> ps_keys_bak[li_idx] THEN
         LET lb_chk = FALSE
         EXIT FOR
      END IF
   END FOR
   
   #不需要做處理
   IF lb_chk THEN
      RETURN
   END IF
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "qcbd_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update"
      {<point name="update_b.before_update" mark="Y"/>}
      #end add-point 
      
      #將遮罩欄位還原
      CALL aqct300_qcbd_t_mask_restore('restore_mask_o')
               
      UPDATE qcbd_t 
         SET (qcbddocno,
              qcbdseq
              ,qcbd001,qcbd002,qcbd003,qcbd020,qcbd004,qcbd005,qcbd006,qcbd007,qcbd008,qcbd009,qcbd010,qcbd021,qcbd011,qcbdsite) 
              = 
             (ps_keys[1],ps_keys[2]
              ,g_qcbd_d[g_detail_idx].qcbd001,g_qcbd_d[g_detail_idx].qcbd002,g_qcbd_d[g_detail_idx].qcbd003, 
                  g_qcbd_d[g_detail_idx].qcbd020,g_qcbd_d[g_detail_idx].qcbd004,g_qcbd_d[g_detail_idx].qcbd005, 
                  g_qcbd_d[g_detail_idx].qcbd006,g_qcbd_d[g_detail_idx].qcbd007,g_qcbd_d[g_detail_idx].qcbd008, 
                  g_qcbd_d[g_detail_idx].qcbd009,g_qcbd_d[g_detail_idx].qcbd010,g_qcbd_d[g_detail_idx].qcbd021, 
                  g_qcbd_d[g_detail_idx].qcbd011,g_qcbd_d[g_detail_idx].qcbdsite) 
         WHERE qcbdent = g_enterprise AND qcbddocno = ps_keys_bak[1] AND qcbdseq = ps_keys_bak[2]
      #add-point:update_b段修改中 name="update_b.m_update"
      {<point name="update_b.m_update"/>}
      #end add-point   
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbd_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbd_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
 
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL aqct300_qcbd_t_mask_restore('restore_mask_n')
               
      #add-point:update_b段修改後 name="update_b.after_update"
      {<point name="update_b.after_update"/>}
      #end add-point  
   END IF
   
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
   
   
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "qcbb_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update2"
      {<point name="update_b.before_update2" mark="Y"/>}
      #end add-point  
      
      #將遮罩欄位還原
      CALL aqct300_qcbb_t_mask_restore('restore_mask_o')
               
      UPDATE qcbb_t 
         SET (qcbbdocno,
              qcbb001,qcbb002,qcbb003
              ,qcbb004,qcbb005,qcbb006,qcbbsite) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4]
              ,g_qcbd4_d[g_detail_idx].qcbb004,g_qcbd4_d[g_detail_idx].qcbb005,g_qcbd4_d[g_detail_idx].qcbb006, 
                  g_qcbd4_d[g_detail_idx].qcbbsite) 
         WHERE qcbbent = g_enterprise AND qcbbdocno = ps_keys_bak[1] AND qcbb001 = ps_keys_bak[2] AND qcbb002 = ps_keys_bak[3] AND qcbb003 = ps_keys_bak[4]
      #add-point:update_b段修改中 name="update_b.m_update2"
      {<point name="update_b.m_update2"/>}
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbb_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbb_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
          
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL aqct300_qcbb_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後 name="update_b.after_update2"
      {<point name="update_b.after_update2"/>}
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
   LET ls_group = "'4',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "qcbc_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update3"
      {<point name="update_b.before_update3" mark="Y"/>}
      #end add-point  
      
      #將遮罩欄位還原
      CALL aqct300_qcbc_t_mask_restore('restore_mask_o')
               
      UPDATE qcbc_t 
         SET (qcbcdocno,
              qcbcseq
              ,qcbc001,qcbc002,qcbc012,qcbc013,qcbc003,qcbc004,qcbc005,qcbc006,qcbc007,qcbc008,qcbc009,qcbc010,qcbc011,qcbcsite) 
              = 
             (ps_keys[1],ps_keys[2]
              ,g_qcbd5_d[g_detail_idx].qcbc001,g_qcbd5_d[g_detail_idx].qcbc002,g_qcbd5_d[g_detail_idx].qcbc012, 
                  g_qcbd5_d[g_detail_idx].qcbc013,g_qcbd5_d[g_detail_idx].qcbc003,g_qcbd5_d[g_detail_idx].qcbc004, 
                  g_qcbd5_d[g_detail_idx].qcbc005,g_qcbd5_d[g_detail_idx].qcbc006,g_qcbd5_d[g_detail_idx].qcbc007, 
                  g_qcbd5_d[g_detail_idx].qcbc008,g_qcbd5_d[g_detail_idx].qcbc009,g_qcbd5_d[g_detail_idx].qcbc010, 
                  g_qcbd5_d[g_detail_idx].qcbc011,g_qcbd5_d[g_detail_idx].qcbcsite) 
         WHERE qcbcent = g_enterprise AND qcbcdocno = ps_keys_bak[1] AND qcbcseq = ps_keys_bak[2]
      #add-point:update_b段修改中 name="update_b.m_update3"
      {<point name="update_b.m_update3"/>}
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbc_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbc_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
          
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL aqct300_qcbc_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後 name="update_b.after_update3"
      {<point name="update_b.after_update3"/>}
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
 
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "qcbe_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update4"
      {<point name="update_b.before_update4" mark="Y"/>}
      #end add-point
      
      #將遮罩欄位還原
      CALL aqct300_qcbe_t_mask_restore('restore_mask_o')
               
      UPDATE qcbe_t 
         SET (qcbedocno,qcbeseq,
              qcbe001
              ,qcbe002,qcbe004,qcbe003,qcbesite) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_qcbd2_d[g_detail_idx2].qcbe002,g_qcbd2_d[g_detail_idx2].qcbe004,g_qcbd2_d[g_detail_idx2].qcbe003, 
                  g_qcbd2_d[g_detail_idx2].qcbesite) 
         WHERE qcbeent = g_enterprise AND qcbedocno = ps_keys_bak[1] AND qcbeseq = ps_keys_bak[2] AND qcbe001 = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update4"
      {<point name="update_b.m_update4"/>}
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbe_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
 
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL aqct300_qcbe_t_mask_restore('restore_mask_n')
               
      #add-point:update_b段修改後 name="update_b.after_update4"
      {<point name="update_b.after_update4"/>}
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
   LET ls_group = "'5',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "qcbg_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update5"
      {<point name="update_b.before_update5" mark="Y"/>}
      #end add-point
      
      #將遮罩欄位還原
      CALL aqct300_qcbg_t_mask_restore('restore_mask_o')
               
      UPDATE qcbg_t 
         SET (qcbgdocno,qcbgseq,
              qcbg001
              ,qcbg002,qcbg003,qcbgsite) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_qcbd7_d[g_detail_idx2].qcbg002,g_qcbd7_d[g_detail_idx2].qcbg003,g_qcbd7_d[g_detail_idx2].qcbgsite)  

         WHERE qcbgent = g_enterprise AND qcbgdocno = ps_keys_bak[1] AND qcbgseq = ps_keys_bak[2] AND qcbg001 = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update5"
      {<point name="update_b.m_update5"/>}
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbg_t" 
            LET g_errparam.code = "std-00009" 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
 
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL aqct300_qcbg_t_mask_restore('restore_mask_n')
               
      #add-point:update_b段修改後 name="update_b.after_update5"
      {<point name="update_b.after_update5"/>}
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
 
   
   #add-point:update_b段other name="update_b.other"
   {<point name="update_b.other"/>}
   #end add-point  
   
END FUNCTION
]]>
</section>
  <section id="aqct300.key_update_b" ver="10" ch="" status="" src="s" readonly="">
<![CDATA[#+ 上層單身key欄位變動後, 連帶修正下層單身key欄位
PRIVATE FUNCTION aqct300_key_update_b(ps_keys_bak,ps_table)
   #add-point:update_b段define(客製用) name="key_update_b.define_customerization"
   {<point name="key_update_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   DEFINE ps_keys_bak       DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table          STRING
   DEFINE l_field_key       DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak    DYNAMIC ARRAY OF STRING
   DEFINE l_new_key         DYNAMIC ARRAY OF STRING
   DEFINE l_old_key         DYNAMIC ARRAY OF STRING
   #add-point:update_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="key_update_b.define"
   {<point name="key_update_b.define"/>} 
   #end add-point
   
   #add-point:Function前置處理  name="key_update_b.pre_function"
   {<point name="key_update_b.pre_function"/>}
   #end add-point
   
   #如果是上層單身則進行update
   IF ps_table = 'qcbd_t' THEN
      #add-point:update_b段修改前 name="key_update_b.before_update4"
      {<point name="key_update_b.before_update4" mark="Y"/>}
      #end add-point
      
      UPDATE qcbe_t 
         SET (qcbedocno,qcbeseq) 
              = 
             (g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq) 
         WHERE qcbeent = g_enterprise AND
               qcbedocno = ps_keys_bak[1] AND qcbeseq = ps_keys_bak[2]
 
      #add-point:update_b段修改中 name="key_update_b.m_update4"
      {<point name="key_update_b.m_update4"/>}
      #end add-point
              
      CASE
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
            #若有多語言table資料一同更新
            
      END CASE
      
      #add-point:update_b段修改後 name="key_update_b.after_update4"
      {<point name="key_update_b.after_update4"/>}
      #end add-point
   END IF
 
   #如果是上層單身則進行update
   IF ps_table = 'qcbd_t' THEN
      #add-point:update_b段修改前 name="key_update_b.before_update5"
      {<point name="key_update_b.before_update5" mark="Y"/>}
      #end add-point
      
      UPDATE qcbg_t 
         SET (qcbgdocno,qcbgseq) 
              = 
             (g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq) 
         WHERE qcbgent = g_enterprise AND
               qcbgdocno = ps_keys_bak[1] AND qcbgseq = ps_keys_bak[2]
 
      #add-point:update_b段修改中 name="key_update_b.m_update5"
      {<point name="key_update_b.m_update5"/>}
      #end add-point
              
      CASE
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
            #若有多語言table資料一同更新
            
      END CASE
      
      #add-point:update_b段修改後 name="key_update_b.after_update5"
      {<point name="key_update_b.after_update5"/>}
      #end add-point
   END IF
 
 
   
END FUNCTION
]]>
</section>
  <section id="aqct300.key_delete_b" ver="11" ch="" status="" src="s" readonly="">
<![CDATA[#+ 上層單身刪除後, 連帶刪除下層單身key欄位
PRIVATE FUNCTION aqct300_key_delete_b(ps_keys_bak,ps_table)
   #add-point:delete_b段define(客製用) name="key_delete_b.define_customerization"
   {<point name="key_delete_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   DEFINE ps_keys_bak       DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table          STRING
   DEFINE l_field_keys      DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak    DYNAMIC ARRAY OF STRING
   DEFINE l_new_key         DYNAMIC ARRAY OF STRING
   DEFINE l_old_key         DYNAMIC ARRAY OF STRING
   #add-point:delete_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="key_delete_b.define"
   {<point name="key_delete_b.define"/>} 
   #end add-point
   
   #add-point:Function前置處理  name="key_delete_b.pre_function"
   {<point name="key_delete_b.pre_function"/>}
   #end add-point
   
   #如果是上層單身則進行delete
   IF ps_table = 'qcbd_t' THEN
      #add-point:delete_b段修改前 name="key_delete_b.before_delete4"
      {<point name="key_delete_b.before_delete4" mark="Y"/>}
      #end add-point
      
      DELETE FROM qcbe_t 
            WHERE qcbeent = g_enterprise AND
                  qcbedocno = ps_keys_bak[1] AND qcbeseq = ps_keys_bak[2]
 
      #add-point:delete_b段修改中 name="key_delete_b.m_delete4"
      {<point name="key_delete_b.m_delete4"/>}
      #end add-point
              
      CASE
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbe_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            RETURN FALSE
         OTHERWISE
      END CASE
 
       
 
      #add-point:delete_b段修改後 name="key_delete_b.after_delete4"
      {<point name="key_delete_b.after_delete4"/>}
      #end add-point
   END IF
 
   #如果是上層單身則進行delete
   IF ps_table = 'qcbd_t' THEN
      #add-point:delete_b段修改前 name="key_delete_b.before_delete5"
      {<point name="key_delete_b.before_delete5" mark="Y"/>}
      #end add-point
      
      DELETE FROM qcbg_t 
            WHERE qcbgent = g_enterprise AND
                  qcbgdocno = ps_keys_bak[1] AND qcbgseq = ps_keys_bak[2]
 
      #add-point:delete_b段修改中 name="key_delete_b.m_delete5"
      {<point name="key_delete_b.m_delete5"/>}
      #end add-point
              
      CASE
         WHEN SQLCA.SQLCODE #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "qcbg_t:",SQLERRMESSAGE 
            LET g_errparam.code = SQLCA.SQLCODE 
            LET g_errparam.popup = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            RETURN FALSE
         OTHERWISE
      END CASE
 
       
 
      #add-point:delete_b段修改後 name="key_delete_b.after_delete5"
      {<point name="key_delete_b.after_delete5"/>}
      #end add-point
   END IF
 
 
   
   RETURN TRUE
   
END FUNCTION
]]>
</section>
  <section id="aqct300.lock_b" ver="18" ch="" status="" src="s" readonly="">
<![CDATA[#+ 連動lock其他單身table資料
PRIVATE FUNCTION aqct300_lock_b(ps_table,ps_page)
   #add-point:lock_b段define(客製用) name="lock_b.define_customerization"
   {<point name="lock_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:lock_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="lock_b.define"
   {<point name="lock_b.define"/>} 
   #end add-point   
   
   #add-point:Function前置處理  name="lock_b.pre_function"
   {<point name="lock_b.pre_function"/>}
   #end add-point
    
   #先刷新資料
   #CALL aqct300_b_fill()
   
   #鎖定整組table
   #LET ls_group = "'1',"
   #僅鎖定自身table
   LET ls_group = "qcbd_t"
   
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN aqct300_bcl USING g_enterprise,
                                       g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq     
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "aqct300_bcl:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
                                    
   #鎖定整組table
   #LET ls_group = "'3',"
   #僅鎖定自身table
   LET ls_group = "qcbb_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN aqct300_bcl2 USING g_enterprise,
                                             g_qcba_m.qcbadocno,g_qcbd4_d[g_detail_idx].qcbb001,g_qcbd4_d[g_detail_idx].qcbb002, 
                                                 g_qcbd4_d[g_detail_idx].qcbb003
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "aqct300_bcl2:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
   #鎖定整組table
   #LET ls_group = "'4',"
   #僅鎖定自身table
   LET ls_group = "qcbc_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN aqct300_bcl3 USING g_enterprise,
                                             g_qcba_m.qcbadocno,g_qcbd5_d[g_detail_idx].qcbcseq
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "aqct300_bcl3:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
 
   
   #鎖定整組table
   #LET ls_group = "'2',"
   #僅鎖定自身table
   LET ls_group = "qcbe_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN aqct300_bcl4 USING g_enterprise,
                                             g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq,
                                             g_qcbd2_d[g_detail_idx2].qcbe001
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "aqct300_bcl4:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
   #鎖定整組table
   #LET ls_group = "'5',"
   #僅鎖定自身table
   LET ls_group = "qcbg_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN aqct300_bcl5 USING g_enterprise,
                                             g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq,
                                             g_qcbd7_d[g_detail_idx2].qcbg001
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "aqct300_bcl5:",SQLERRMESSAGE 
         LET g_errparam.code = SQLCA.SQLCODE 
         LET g_errparam.popup = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
 
   
   #add-point:lock_b段other name="lock_b.other"
   {<point name="lock_b.other"/>}
   #end add-point  
   
   RETURN TRUE
 
END FUNCTION
]]>
</section>
  <section id="aqct300.unlock_b" ver="10" ch="" status="" src="s" readonly="">
<![CDATA[#+ 連動unlock其他單身table資料
PRIVATE FUNCTION aqct300_unlock_b(ps_table,ps_page)
   #add-point:unlock_b段define(客製用) name="unlock_b.define_customerization"
   {<point name="unlock_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:unlock_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="unlock_b.define"
   {<point name="unlock_b.define"/>} 
   #end add-point  
   
   #add-point:Function前置處理  name="unlock_b.pre_function"
   {<point name="unlock_b.pre_function"/>}
   #end add-point
    
   LET ls_group = "'1',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE aqct300_bcl
   END IF
   
   LET ls_group = "'3',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE aqct300_bcl2
   END IF
 
   LET ls_group = "'4',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE aqct300_bcl3
   END IF
 
 
   
   LET ls_group = "'2',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE aqct300_bcl4
   END IF
 
   LET ls_group = "'5',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE aqct300_bcl5
   END IF
 
 
 
   #add-point:unlock_b段other name="unlock_b.other"
   {<point name="unlock_b.other"/>}
   #end add-point  
 
END FUNCTION
]]>
</section>
  <section id="aqct300.set_entry" ver="13" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單頭欄位開啟設定
PRIVATE FUNCTION aqct300_set_entry(p_cmd)
   #add-point:set_entry段define(客製用) name="set_entry.define_customerization"
   {<point name="set_entry.define_customerization" edit="c" mark="Y"/>}
   #end add-point       
   DEFINE p_cmd   LIKE type_t.chr1  
   #add-point:set_entry段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_entry.define"
   {<point name="set_entry.define"/>} 
   #end add-point       
   
   #add-point:Function前置處理  name="set_entry.pre_function"
   {<point name="set_entry.pre_function"/>}
   #end add-point
   
   CALL cl_set_comp_entry("qcbadocno",TRUE)
   
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("qcbadocno",TRUE)
      CALL cl_set_comp_entry("qcbadocdt",TRUE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,TRUE)
      END IF
      #add-point:set_entry段欄位控制 name="set_entry.field_control"
      {<point name="set_entry.field_control"/>}
      #end add-point  
   END IF
   
   #add-point:set_entry段欄位控制後 name="set_entry.after_control"
   {<point name="set_entry.after_control"/>}
   #end add-point 
 
END FUNCTION
]]>
</section>
  <section id="aqct300.set_no_entry" ver="13" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單頭欄位關閉設定
PRIVATE FUNCTION aqct300_set_no_entry(p_cmd)
   #add-point:set_no_entry段define(客製用) name="set_no_entry.define_customerization"
   {<point name="set_no_entry.define_customerization" edit="c" mark="Y"/>}
   #end add-point     
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_no_entry.define"
   {<point name="set_no_entry.define"/>} 
   #end add-point     
   
   #add-point:Function前置處理  name="set_no_entry.pre_function"
   {<point name="set_no_entry.pre_function"/>}
   #end add-point
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("qcbadocno",FALSE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,FALSE)
      END IF
      #add-point:set_no_entry段欄位控制 name="set_no_entry.field_control"
      {<point name="set_no_entry.field_control"/>}
      #end add-point 
   END IF 
   
   IF p_cmd = 'u' THEN  #docno,ld欄位確認是絕對關閉
      CALL cl_set_comp_entry("qcbadocno",FALSE)
   END IF 
 
#  IF p_cmd = 'u' THEN  #docdt欄位依照設定關閉(FALSE則為設定不同意修正) #(ver:78)
      IF NOT cl_chk_update_docdt() THEN
         CALL cl_set_comp_entry("qcbadocdt",FALSE)
      END IF
#  END IF 
   
   #add-point:set_no_entry段欄位控制後 name="set_no_entry.after_control"
   {<point name="set_no_entry.after_control"/>}
   #end add-point 
 
END FUNCTION
]]>
</section>
  <section id="aqct300.set_entry_b" ver="8" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身欄位開啟設定
PRIVATE FUNCTION aqct300_set_entry_b(p_cmd)
   #add-point:set_entry_b段define(客製用) name="set_entry_b.define_customerization"
   {<point name="set_entry_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point     
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_entry_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_entry_b.define"
   {<point name="set_entry_b.define"/>} 
   #end add-point     
   
   #add-point:Function前置處理  name="set_entry_b.pre_function"
   {<point name="set_entry_b.pre_function"/>}
   #end add-point
    
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("",TRUE)
      #add-point:set_entry段欄位控制 name="set_entry_b.field_control"
      {<point name="set_entry_b.field_control"/>}
      #end add-point  
   END IF
   
   #add-point:set_entry_b段 name="set_entry_b.set_entry_b"
   {<point name="set_entry_b.set_entry_b"/>}
   #end add-point  
END FUNCTION
]]>
</section>
  <section id="aqct300.set_no_entry_b" ver="8" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身欄位關閉設定
PRIVATE FUNCTION aqct300_set_no_entry_b(p_cmd)
   #add-point:set_no_entry_b段define(客製用) name="set_no_entry_b.define_customerization"
   {<point name="set_no_entry_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point    
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_no_entry_b.define"
   {<point name="set_no_entry_b.define"/>} 
   #end add-point    
   
   #add-point:Function前置處理  name="set_no_entry_b.pre_function"
   {<point name="set_no_entry_b.pre_function"/>}
   #end add-point
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("",FALSE)
      #add-point:set_no_entry_b段欄位控制 name="set_no_entry_b.field_control"
      {<point name="set_no_entry_b.field_control"/>}
      #end add-point 
   END IF 
   
   #add-point:set_no_entry_b段 name="set_no_entry_b.set_no_entry_b"
   {<point name="set_no_entry_b.set_no_entry_b"/>}
   #end add-point     
END FUNCTION
]]>
</section>
  <section id="aqct300.set_act_visible" ver="5" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單頭權限開啟
PRIVATE FUNCTION aqct300_set_act_visible()
   #add-point:set_act_visible段define(客製用) name="set_act_visible.define_customerization"
   {<point name="set_act_visible.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   #add-point:set_act_visible段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_visible.define"
   {<point name="set_act_visible.define"/>} 
   #end add-point   
   #add-point:set_act_visible段 name="set_act_visible.set_act_visible"
   {<point name="set_act_visible.set_act_visible"/>}
   #end add-point   
END FUNCTION
]]>
</section>
  <section id="aqct300.set_act_no_visible" ver="5" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單頭權限關閉
PRIVATE FUNCTION aqct300_set_act_no_visible()
   #add-point:set_act_no_visible段define(客製用) name="set_act_no_visible.define_customerization"
   {<point name="set_act_no_visible.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   #add-point:set_act_no_visible段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_no_visible.define"
   {<point name="set_act_no_visible.define"/>} 
   #end add-point   
   #add-point:set_act_no_visible段 name="set_act_no_visible.set_act_no_visible"
   {<point name="set_act_no_visible.set_act_no_visible"/>}
   #end add-point   
END FUNCTION
]]>
</section>
  <section id="aqct300.set_act_visible_b" ver="5" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身權限開啟
PRIVATE FUNCTION aqct300_set_act_visible_b()
   #add-point:set_act_visible_b段define(客製用) name="set_act_visible_b.define_customerization"
   {<point name="set_act_visible_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   #add-point:set_act_visible_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_visible_b.define"
   {<point name="set_act_visible_b.define"/>} 
   #end add-point   
   #add-point:set_act_visible_b段 name="set_act_visible_b.set_act_visible_b"
   {<point name="set_act_visible_b.set_act_visible_b"/>}
   #end add-point   
END FUNCTION
]]>
</section>
  <section id="aqct300.set_act_no_visible_b" ver="5" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身權限關閉
PRIVATE FUNCTION aqct300_set_act_no_visible_b()
   #add-point:set_act_no_visible_b段define(客製用) name="set_act_no_visible_b.define_customerization"
   {<point name="set_act_no_visible_b.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   #add-point:set_act_no_visible_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_no_visible_b.define"
   {<point name="set_act_no_visible_b.define"/>} 
   #end add-point   
   #add-point:set_act_no_visible_b段 name="set_act_no_visible_b.set_act_no_visible_b"
   {<point name="set_act_no_visible_b.set_act_no_visible_b"/>}
   #end add-point   
END FUNCTION
]]>
</section>
  <section id="aqct300.default_search" ver="17" ch="" status="" src="s" readonly="">
<![CDATA[#+ 外部參數搜尋
PRIVATE FUNCTION aqct300_default_search()
   #add-point:default_search段define(客製用) name="default_search.define_customerization"
   {<point name="default_search.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   DEFINE li_idx     LIKE type_t.num10
   DEFINE li_cnt     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE ls_where   STRING
   #add-point:default_search段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="default_search.define"
   {<point name="default_search.define"/>} 
   #end add-point  
   
   #add-point:Function前置處理 name="default_search.before"
   {<point name="default_search.before"/>}
   #end add-point  
   
   LET g_pagestart = 1
   
   IF cl_null(g_order) THEN
      LET g_order = "ASC"
   END IF
   
   IF NOT cl_null(g_argv[01]) THEN
      LET ls_wc = ls_wc, " qcbadocno = '", g_argv[01], "' AND "
   END IF
   
 
   
   #add-point:default_search段after sql name="default_search.after_sql"
   {<point name="default_search.after_sql"/>}
   #end add-point  
   
   IF NOT cl_null(ls_wc) THEN
      LET g_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_default = TRUE
   ELSE
      #若無外部參數則預設為1=2
      LET g_default = FALSE
      
      #預設查詢條件
      CALL cl_qbe_get_default_qryplan() RETURNING ls_where
      IF NOT cl_null(ls_where) THEN
         CALL util.JSON.parse(ls_where, la_wc)
         INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
         INITIALIZE g_wc2_table2 TO NULL
 
         INITIALIZE g_wc2_table3 TO NULL
 
 
         FOR li_idx = 1 TO la_wc.getLength()
            CASE
               WHEN la_wc[li_idx].tableid = "qcba_t" 
                  LET g_wc = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "qcbd_t" 
                  LET g_wc2_table1 = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "qcbb_t" 
                  LET g_wc2_table2 = la_wc[li_idx].wc
 
               WHEN la_wc[li_idx].tableid = "qcbc_t" 
                  LET g_wc2_table3 = la_wc[li_idx].wc
 
 
               WHEN la_wc[li_idx].tableid = "EXTENDWC"
                  LET g_wc2_extend = la_wc[li_idx].wc
            END CASE
         END FOR
         IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
            OR NOT cl_null(g_wc2_table2)
 
            OR NOT cl_null(g_wc2_table3)
 
 
            OR NOT cl_null(g_wc2_extend)
            THEN
            #組合g_wc2
            IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
               LET g_wc2 = g_wc2_table1
            END IF
            IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
            END IF
 
            IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
            END IF
 
 
            IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
            END IF
         
            IF g_wc2.subString(1,5) = " AND " THEN
               LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
            END IF
         END IF
      END IF
    
      IF cl_null(g_wc) AND cl_null(g_wc2) THEN
         LET g_wc = " 1=2"
      END IF
   END IF
   
   #add-point:default_search段結束前 name="default_search.after"
   {<point name="default_search.after"/>}
   #end add-point  
 
   IF g_wc.getIndexOf(" 1=2", 1) THEN
      LET g_default = TRUE
   END IF
 
 
END FUNCTION
]]>
</section>
  <section id="aqct300.state_change" ver="30" ch="" status="" src="s" readonly="">
<![CDATA[   #應用 a09 樣板自動產生(Version:17)
#+ 確認碼變更 
PRIVATE FUNCTION aqct300_statechange()
   #add-point:statechange段define(客製用) name="statechange.define_customerization"
   {<point name="statechange.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   DEFINE lc_state LIKE type_t.chr5
   #add-point:statechange段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="statechange.define"
   {<point name="statechange.define"/>}
   #end add-point  
   
   #add-point:Function前置處理 name="statechange.before"
   {<point name="statechange.before"/>}
   #end add-point  
   
   ERROR ""     #清空畫面右下側ERROR區塊
 
   IF g_qcba_m.qcbadocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   CALL s_transaction_begin()
   
   OPEN aqct300_cl USING g_enterprise,g_qcba_m.qcbadocno
   IF STATUS THEN
      CLOSE aqct300_cl
      CALL s_transaction_end('N','0')
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN aqct300_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #顯示最新的資料
   EXECUTE aqct300_master_referesh USING g_qcba_m.qcbadocno INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt, 
       g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017, 
       g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
       g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018, 
       g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026, 
       g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp, 
       g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt, 
       g_qcba_m.qcba900_desc,g_qcba_m.qcba901_desc,g_qcba_m.qcba005_desc,g_qcba_m.qcba009_desc,g_qcba_m.qcba013_desc, 
       g_qcba_m.qcba024_desc,g_qcba_m.qcba016_desc,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid_desc, 
       g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbacnfid_desc
   
 
   #檢查是否允許此動作
   IF NOT aqct300_action_chk() THEN
      CLOSE aqct300_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #將資料顯示到畫面上
   DISPLAY BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba900_desc,g_qcba_m.qcbadocno_desc, 
       g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcba901_desc,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
       g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
       g_qcba_m.qcba005,g_qcba_m.qcba005_desc,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009, 
       g_qcba_m.qcba009_desc,g_qcba_m.qcba017,g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba012_desc, 
       g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.qcba013,g_qcba_m.qcba013_desc,g_qcba_m.qcba020,g_qcba_m.qcba021, 
       g_qcba_m.qcba030,g_qcba_m.qcba024,g_qcba_m.qcba024_desc,g_qcba_m.qcba016,g_qcba_m.qcba016_desc, 
       g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.imae116,g_qcba_m.qcba018,g_qcba_m.qcba019, 
       g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033, 
       g_qcba_m.qcbaownid,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid, 
       g_qcba_m.qcbacrtid_desc,g_qcba_m.qcbacrtdp,g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid, 
       g_qcba_m.qcbamodid_desc,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfid_desc,g_qcba_m.qcbacnfdt 

 
   CASE g_qcba_m.qcbastus
      WHEN "N"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
      WHEN "Y"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
      WHEN "A"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
      WHEN "D"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
      WHEN "R"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
      WHEN "W"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
      WHEN "X"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
      
   END CASE
 
   #add-point:資料刷新後 name="statechange.after_refresh"
   {<point name="statechange.after_refresh"/>}
   #end add-point
 
   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_qcba_m.qcbastus
            
            WHEN "N"
               HIDE OPTION "unconfirmed"
            WHEN "Y"
               HIDE OPTION "confirmed"
            WHEN "A"
               HIDE OPTION "approved"
            WHEN "D"
               HIDE OPTION "withdraw"
            WHEN "R"
               HIDE OPTION "rejection"
            WHEN "W"
               HIDE OPTION "signing"
            WHEN "X"
               HIDE OPTION "invalid"
         END CASE
     
      #add-point:menu前 name="statechange.before_menu"
      {<point name="statechange.before_menu"/>}
      #end add-point
      
      #應用 a36 樣板自動產生(Version:5)
      #提交
      ON ACTION signing
         IF cl_auth_chk_act("signing") THEN
            IF NOT aqct300_send() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE aqct300_cl
            RETURN
         END IF
    
      #抽單
      ON ACTION withdraw
         IF cl_auth_chk_act("withdraw") THEN
            IF NOT aqct300_draw_out() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE aqct300_cl
            RETURN
         END IF
 
 
 
	  
      ON ACTION unconfirmed
         IF cl_auth_chk_act("unconfirmed") THEN
            LET lc_state = "N"
            #add-point:action控制 name="statechange.unconfirmed"
            {<point name="statechange.unconfirmed"/>}
            #end add-point
         END IF
         EXIT MENU
      ON ACTION confirmed
         IF cl_auth_chk_act("confirmed") THEN
            LET lc_state = "Y"
            #add-point:action控制 name="statechange.confirmed"
            {<point name="statechange.confirmed"/>}
            #end add-point
         END IF
         EXIT MENU
      ON ACTION approved
         IF cl_auth_chk_act("approved") THEN
            LET lc_state = "A"
            #add-point:action控制 name="statechange.approved"
            {<point name="statechange.approved"/>}
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION withdraw
      #   IF cl_auth_chk_act("withdraw") THEN
      #      LET lc_state = "D"
      #      #add-point:action控制 name="statechange.withdraw"
      #      {<point name="statechange.withdraw"/>}
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION rejection
         IF cl_auth_chk_act("rejection") THEN
            LET lc_state = "R"
            #add-point:action控制 name="statechange.rejection"
            {<point name="statechange.rejection"/>}
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION signing
      #   IF cl_auth_chk_act("signing") THEN
      #      LET lc_state = "W"
      #      #add-point:action控制 name="statechange.signing"
      #      {<point name="statechange.signing"/>}
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION invalid
         IF cl_auth_chk_act("invalid") THEN
            LET lc_state = "X"
            #add-point:action控制 name="statechange.invalid"
            {<point name="statechange.invalid"/>}
            #end add-point
         END IF
         EXIT MENU
 
      #add-point:stus控制 name="statechange.more_control"
      {<point name="statechange.more_control"/>}
      #end add-point
      
   END MENU
   
   #確認被選取的狀態碼在清單中
   IF (lc_state <> "N" 
      AND lc_state <> "Y"
      AND lc_state <> "A"
      AND lc_state <> "D"
      AND lc_state <> "R"
      AND lc_state <> "W"
      AND lc_state <> "X"
      ) OR 
      g_qcba_m.qcbastus = lc_state OR cl_null(lc_state) THEN
      CLOSE aqct300_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #add-point:stus修改前 name="statechange.b_update"
   {<point name="statechange.b_update"/>}
   #end add-point
   
   LET g_qcba_m.qcbamodid = g_user
   LET g_qcba_m.qcbamoddt = cl_get_current()
   LET g_qcba_m.qcbastus = lc_state
   
   #異動狀態碼欄位/修改人/修改日期
   UPDATE qcba_t 
      SET (qcbastus,qcbamodid,qcbamoddt) 
        = (g_qcba_m.qcbastus,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt)     
    WHERE qcbaent = g_enterprise AND qcbadocno = g_qcba_m.qcbadocno
 
    
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
   ELSE
      CASE lc_state
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
    
      #撈取異動後的資料
      EXECUTE aqct300_master_referesh USING g_qcba_m.qcbadocno INTO g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt, 
          g_qcba_m.qcba900,g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcbasite,g_qcba_m.qcba032, 
          g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003,g_qcba_m.qcba004, 
          g_qcba_m.qcba005,g_qcba_m.qcba006,g_qcba_m.qcba007,g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba017, 
          g_qcba_m.qcba010,g_qcba_m.qcba012,g_qcba_m.qcba013,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030, 
          g_qcba_m.qcba024,g_qcba_m.qcba016,g_qcba_m.qcba022,g_qcba_m.qcba023,g_qcba_m.qcba027,g_qcba_m.qcba018, 
          g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015,g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026, 
          g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaowndp,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtdp, 
          g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamoddt,g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfdt, 
          g_qcba_m.qcba900_desc,g_qcba_m.qcba901_desc,g_qcba_m.qcba005_desc,g_qcba_m.qcba009_desc,g_qcba_m.qcba013_desc, 
          g_qcba_m.qcba024_desc,g_qcba_m.qcba016_desc,g_qcba_m.qcbaownid_desc,g_qcba_m.qcbaowndp_desc, 
          g_qcba_m.qcbacrtid_desc,g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbacnfid_desc 

      
      #將資料顯示到畫面上
      DISPLAY BY NAME g_qcba_m.qcbadocno,g_qcba_m.qcbadocdt,g_qcba_m.qcba900,g_qcba_m.qcba900_desc,g_qcba_m.qcbadocno_desc, 
          g_qcba_m.qcba000,g_qcba_m.qcba031,g_qcba_m.qcba901,g_qcba_m.qcba901_desc,g_qcba_m.qcbasite, 
          g_qcba_m.qcba032,g_qcba_m.qcbastus,g_qcba_m.qcba001,g_qcba_m.qcba002,g_qcba_m.qcba029,g_qcba_m.qcba003, 
          g_qcba_m.qcba004,g_qcba_m.qcba005,g_qcba_m.qcba005_desc,g_qcba_m.qcba006,g_qcba_m.qcba007, 
          g_qcba_m.qcba008,g_qcba_m.qcba009,g_qcba_m.qcba009_desc,g_qcba_m.qcba017,g_qcba_m.qcba010, 
          g_qcba_m.qcba012,g_qcba_m.qcba012_desc,g_qcba_m.imaal003,g_qcba_m.imaal004,g_qcba_m.qcba013, 
          g_qcba_m.qcba013_desc,g_qcba_m.qcba020,g_qcba_m.qcba021,g_qcba_m.qcba030,g_qcba_m.qcba024, 
          g_qcba_m.qcba024_desc,g_qcba_m.qcba016,g_qcba_m.qcba016_desc,g_qcba_m.qcba022,g_qcba_m.qcba023, 
          g_qcba_m.qcba027,g_qcba_m.imae116,g_qcba_m.qcba018,g_qcba_m.qcba019,g_qcba_m.qcba014,g_qcba_m.qcba015, 
          g_qcba_m.qcba028,g_qcba_m.qcba025,g_qcba_m.qcba026,g_qcba_m.qcba033,g_qcba_m.qcbaownid,g_qcba_m.qcbaownid_desc, 
          g_qcba_m.qcbaowndp,g_qcba_m.qcbaowndp_desc,g_qcba_m.qcbacrtid,g_qcba_m.qcbacrtid_desc,g_qcba_m.qcbacrtdp, 
          g_qcba_m.qcbacrtdp_desc,g_qcba_m.qcbacrtdt,g_qcba_m.qcbamodid,g_qcba_m.qcbamodid_desc,g_qcba_m.qcbamoddt, 
          g_qcba_m.qcbacnfid,g_qcba_m.qcbacnfid_desc,g_qcba_m.qcbacnfdt
   END IF
 
   #add-point:stus修改後 name="statechange.a_update"
   {<point name="statechange.a_update"/>}
   #end add-point
 
   #add-point:statechange段結束前 name="statechange.after"
   {<point name="statechange.after"/>}
   #end add-point  
 
   CLOSE aqct300_cl
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL aqct300_msgcentre_notify('statechange:'||lc_state)
   
END FUNCTION
 
 
 
]]>
</section>
  <section id="aqct300.idx_chk" ver="11" ch="" status="" src="s" readonly="">
<![CDATA[#+ 顯示正確的單身資料筆數
PRIVATE FUNCTION aqct300_idx_chk()
   #add-point:idx_chk段define(客製用) name="idx_chk.define_customerization"
   {<point name="idx_chk.define_customerization" edit="c" mark="Y"/>}
   #end add-point  
   #add-point:idx_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="idx_chk.define"
   {<point name="idx_chk.define"/>} 
   #end add-point  
   
   #add-point:Function前置處理  name="idx_chk.pre_function"
   {<point name="idx_chk.pre_function"/>}
   #end add-point
   
   IF g_current_page = 1 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail1")
      IF g_detail_idx > g_qcbd_d.getLength() THEN
         LET g_detail_idx = g_qcbd_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_qcbd_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_qcbd_d.getLength() TO FORMONLY.cnt
   END IF
   
   IF g_current_page = 2 THEN
      LET g_detail_idx2 = g_curr_diag.getCurrentRow("s_detail2")
      IF g_detail_idx2 > g_qcbd2_d.getLength() THEN
         LET g_detail_idx2 = g_qcbd2_d.getLength()
      END IF
      IF g_detail_idx2 = 0 AND g_qcbd2_d.getLength() <> 0 THEN
         LET g_detail_idx2 = 1
      END IF
      DISPLAY g_detail_idx2 TO FORMONLY.idx
      DISPLAY g_qcbd2_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 3 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail4")
      IF g_detail_idx > g_qcbd4_d.getLength() THEN
         LET g_detail_idx = g_qcbd4_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_qcbd4_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_qcbd4_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 4 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail5")
      IF g_detail_idx > g_qcbd5_d.getLength() THEN
         LET g_detail_idx = g_qcbd5_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_qcbd5_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_qcbd5_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 5 THEN
      LET g_detail_idx2 = g_curr_diag.getCurrentRow("s_detail7")
      IF g_detail_idx2 > g_qcbd7_d.getLength() THEN
         LET g_detail_idx2 = g_qcbd7_d.getLength()
      END IF
      IF g_detail_idx2 = 0 AND g_qcbd7_d.getLength() <> 0 THEN
         LET g_detail_idx2 = 1
      END IF
      DISPLAY g_detail_idx2 TO FORMONLY.idx
      DISPLAY g_qcbd7_d.getLength() TO FORMONLY.cnt
   END IF
 
   
   #add-point:idx_chk段other name="idx_chk.other"
   {<point name="idx_chk.other"/>}
   #end add-point  
   
END FUNCTION
]]>
</section>
  <section id="aqct300.b_fill2" ver="31" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身陣列填充2
PRIVATE FUNCTION aqct300_b_fill2(pi_idx)
   #add-point:b_fill2段define(客製用) name="b_fill2.define_customerization"
   {<point name="b_fill2.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   DEFINE pi_idx                 LIKE type_t.num10
   DEFINE li_ac                  LIKE type_t.num10
   DEFINE li_detail_idx_tmp      LIKE type_t.num10
   DEFINE ls_chk                 LIKE type_t.chr1
   #add-point:b_fill2段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="b_fill2.define"
   {<point name="b_fill2.define"/>} 
   #end add-point
   
   #add-point:Function前置處理  name="b_fill2.pre_function"
   {<point name="b_fill2.pre_function"/>}
   #end add-point
   
   LET li_ac = l_ac 
   
   IF g_detail_idx <= 0 THEN
      RETURN
   END IF
   
   LET li_detail_idx_tmp = g_detail_idx
   
   IF aqct300_fill_chk(4) THEN
      IF (pi_idx = 4 OR pi_idx = 0 ) AND g_qcbd_d.getLength() > 0 THEN
               CALL g_qcbd2_d.clear()
 
         
         #取得該單身上階單身的idx
         LET g_detail_idx = g_detail_idx_list[1]
         
         LET g_sql = "SELECT  DISTINCT qcbe001,qcbe002,qcbe004,qcbe003,qcbesite ,t1.oocql004 FROM qcbe_t", 
                 
                     "",
                                    " LEFT JOIN oocql_t t1 ON t1.oocqlent="||g_enterprise||" AND t1.oocql001='1053' AND t1.oocql002=qcbe001 AND t1.oocql003='"||g_dlang||"' ",
 
                     " WHERE qcbeent=? AND qcbedocno=? AND qcbeseq=?"
         
         IF NOT cl_null(g_wc2_table4) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table4 CLIPPED
         END IF
         
         LET g_sql = g_sql, " ORDER BY  qcbe_t.qcbe001" 
                            
         #add-point:單身填充前 name="b_fill2.before_fill4"
         {<point name="b_fill2.before_fill4" />}
         #end add-point
         
         #先清空資料
               CALL g_qcbd2_d.clear()
 
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE aqct300_pb4 FROM g_sql
         DECLARE b_fill_curs4 CURSOR FOR aqct300_pb4
         
      #  OPEN b_fill_curs4 USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq   #(ver:78) 

         LET l_ac = 1
         FOREACH b_fill_curs4 USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq INTO g_qcbd2_d[l_ac].qcbe001, 
             g_qcbd2_d[l_ac].qcbe002,g_qcbd2_d[l_ac].qcbe004,g_qcbd2_d[l_ac].qcbe003,g_qcbd2_d[l_ac].qcbesite, 
             g_qcbd2_d[l_ac].qcbe001_desc   #(ver:78)
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               EXIT FOREACH
            END IF
            
            #add-point:b_fill段資料填充 name="b_fill2.fill4"
            {<point name="b_fill2.fill4"/>}
            #end add-point
           
            IF l_ac > g_max_rec THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code = 9035 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               EXIT FOREACH
            END IF
            
            LET l_ac = l_ac + 1
            
         END FOREACH
               CALL g_qcbd2_d.deleteElement(g_qcbd2_d.getLength())
 
      END IF
   END IF
 
   IF aqct300_fill_chk(5) THEN
      IF (pi_idx = 5 OR pi_idx = 0 ) AND g_qcbd_d.getLength() > 0 THEN
               CALL g_qcbd7_d.clear()
 
         
         #取得該單身上階單身的idx
         LET g_detail_idx = g_detail_idx_list[1]
         
         LET g_sql = "SELECT  DISTINCT qcbg001,qcbg002,qcbg003,qcbgsite  FROM qcbg_t",    
                     "",
                     
                     " WHERE qcbgent=? AND qcbgdocno=? AND qcbgseq=?"
         
         IF NOT cl_null(g_wc2_table5) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table5 CLIPPED
         END IF
         
         LET g_sql = g_sql, " ORDER BY  qcbg_t.qcbg001" 
                            
         #add-point:單身填充前 name="b_fill2.before_fill5"
         {<point name="b_fill2.before_fill5" />}
         #end add-point
         
         #先清空資料
               CALL g_qcbd7_d.clear()
 
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE aqct300_pb5 FROM g_sql
         DECLARE b_fill_curs5 CURSOR FOR aqct300_pb5
         
      #  OPEN b_fill_curs5 USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq   #(ver:78) 

         LET l_ac = 1
         FOREACH b_fill_curs5 USING g_enterprise,g_qcba_m.qcbadocno,g_qcbd_d[g_detail_idx].qcbdseq INTO g_qcbd7_d[l_ac].qcbg001, 
             g_qcbd7_d[l_ac].qcbg002,g_qcbd7_d[l_ac].qcbg003,g_qcbd7_d[l_ac].qcbgsite   #(ver:78)
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
               LET g_errparam.code = SQLCA.SQLCODE 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               EXIT FOREACH
            END IF
            
            #add-point:b_fill段資料填充 name="b_fill2.fill5"
            {<point name="b_fill2.fill5"/>}
            #end add-point
           
            IF l_ac > g_max_rec THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code = 9035 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               EXIT FOREACH
            END IF
            
            LET l_ac = l_ac + 1
            
         END FOREACH
               CALL g_qcbd7_d.deleteElement(g_qcbd7_d.getLength())
 
      END IF
   END IF
 
 
      
   LET g_qcbd2_d_mask_o.* =  g_qcbd2_d.*
   FOR l_ac = 1 TO g_qcbd2_d.getLength()
      LET g_qcbd2_d_mask_o[l_ac].* =  g_qcbd2_d[l_ac].*
      CALL aqct300_qcbe_t_mask()
      LET g_qcbd2_d_mask_n[l_ac].* =  g_qcbd2_d[l_ac].*
   END FOR
   LET g_qcbd7_d_mask_o.* =  g_qcbd7_d.*
   FOR l_ac = 1 TO g_qcbd7_d.getLength()
      LET g_qcbd7_d_mask_o[l_ac].* =  g_qcbd7_d[l_ac].*
      CALL aqct300_qcbg_t_mask()
      LET g_qcbd7_d_mask_n[l_ac].* =  g_qcbd7_d[l_ac].*
   END FOR
 
      
   #add-point:單身填充後 name="b_fill2.after_fill"
   {<point name="b_fill2.after_fill" />}
   #end add-point
    
   LET l_ac = li_ac
   
   CALL aqct300_detail_show()
   
   LET g_detail_idx = li_detail_idx_tmp
   
END FUNCTION
]]>
</section>
  <section id="aqct300.fill_chk" ver="14" ch="" status="" src="s" readonly="">
<![CDATA[#+ 單身填充確認
PRIVATE FUNCTION aqct300_fill_chk(ps_idx)
   #add-point:fill_chk段define(客製用) name="fill_chk.define_customerization"
   {<point name="fill_chk.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   DEFINE ps_idx        LIKE type_t.chr10
   #add-point:fill_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="fill_chk.define"
   {<point name="fill_chk.define"/>} 
   #end add-point
   
   #add-point:Function前置處理 name="fill_chk.before_chk"
   {<point name="fill_chk.before_chk"/>}
   #end add-point
   
   #此funtion功能暫時停用(2015/1/12)
   #無論傳入值為何皆回傳true(代表要填充該單身)
 
   #全部為1=1 or null時回傳true
   IF (cl_null(g_wc2_table1) OR g_wc2_table1.trim() = '1=1')  AND 
      (cl_null(g_wc2_table2) OR g_wc2_table2.trim() = '1=1')  AND 
      (cl_null(g_wc2_table3) OR g_wc2_table3.trim() = '1=1')  AND 
      (cl_null(g_wc2_table4) OR g_wc2_table4.trim() = '1=1')  AND 
      (cl_null(g_wc2_table5) OR g_wc2_table5.trim() = '1=1') THEN
      #add-point:fill_chk段other_chk name="fill_chk.other_chk"
      {<point name="fill_chk.other_chk"/>}
      #end add-point
      RETURN TRUE
   END IF
   
   #add-point:fill_chk段after_chk name="fill_chk.after_chk"
   {<point name="fill_chk.after_chk"/>}
   #end add-point
   
   RETURN TRUE
 
END FUNCTION
]]>
</section>
  <section id="aqct300.status_show" ver="3" ch="" status="" src="s" readonly="">
<![CDATA[PRIVATE FUNCTION aqct300_status_show()
   #add-point:status_show段define(客製用) name="status_show.define_customerization"
   {<point name="status_show.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   #add-point:status_show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="status_show.define"
   {<point name="status_show.define"/>} 
   #end add-point
   
   #add-point:status_show段status_show name="status_show.status_show"
   {<point name="status_show.status_show"/>}
   #end add-point
END FUNCTION
]]>
</section>
  <section id="aqct300.mask_functions" ver="1" ch="" status="" src="s" readonly="">
<![CDATA[&include "erp/aqc/aqct300_mask.4gl"
]]>
</section>
  <section id="aqct300.signature" ver="13" ch="" status="" src="s" readonly="">
<![CDATA[   #應用 a39 樣板自動產生(Version:10)
#+ BPM提交
PRIVATE FUNCTION aqct300_send()
   #add-point:send段define(客製用) name="send.define_customerization"
   {<point name="send.define_customerization" edit="c" mark="Y"/>}
   #end add-point 
   #add-point:send段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="send.define"
   {<point name="send.define"/>}
   #end add-point 
   
   #add-point:Function前置處理  name="send.pre_function"
   {<point name="send.pre_function"/>}
   #end add-point
   
   #依據單據個數，需要指定所有單身條件為" 1=1"  (單身有幾個就要設幾個)
   LET g_wc2_table1 = " 1=1"
   LET g_wc2_table2 = " 1=1"
   LET g_wc2_table3 = " 1=1"
 
 
   CALL aqct300_show()
   CALL aqct300_set_pk_array()
   
   #add-point: 初始化的ADP name="send.before_send"
   {<point name="send.before_send" />}
   #end add-point
   
   #公用變數初始化
   CALL cl_bpm_data_init()
                  
   #依照主檔/單身個數產生 CALL cl_bpm_set_master_data() / cl_bpm_set_detail_data() 
   #單頭固定為 CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(xxxx)) 傳入參數: (1)單頭陣列  ; 回傳值: 無
   CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(g_qcba_m))
                              
   #單身固定為 CALL cl_bpm_set_detail_data(s_detailX, util.JSONArray.fromFGL(xxxx)) 傳入參數: (1)單身SR名稱  (2)單身陣列  ; 回傳值: 無
   CALL cl_bpm_set_detail_data("s_detail1", util.JSONArray.fromFGL(g_qcbd_d))
   CALL cl_bpm_set_detail_data("s_detail2", util.JSONArray.fromFGL(g_qcbd2_d))
   CALL cl_bpm_set_detail_data("s_detail4", util.JSONArray.fromFGL(g_qcbd4_d))
   CALL cl_bpm_set_detail_data("s_detail5", util.JSONArray.fromFGL(g_qcbd5_d))
   CALL cl_bpm_set_detail_data("s_detail7", util.JSONArray.fromFGL(g_qcbd7_d))
 
 
   # cl_bpm_cli() 裡有包含以前的aws_condition()=>送簽資料檢核和更新單據狀況碼為'W'
   # cl_bpm_cli() 傳入參數:無  ;  回傳值: 0 開單失敗; 1 開單成功
 
   #add-point: 提交前的ADP name="send.before_cli"
   {<point name="send.before_cli" />}
   #end add-point
 
   #開單失敗
   IF NOT cl_bpm_cli() THEN 
      RETURN FALSE
   END IF
 
   #add-point: 提交後的ADP name="send.after_send"
   {<point name="send.after_send" />}
   #end add-point
 
   #此段落不需要刪除資料,但是否需要refresh圖片樣式???
   #CALL aqct300_ui_browser_refresh()
 
   #重新指定此筆單據資料狀態圖片=>送簽中
   LET g_browser[g_current_idx].b_statepic = "stus/16/signing.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL aqct300_ui_headershow()
   CALL aqct300_ui_detailshow()
 
   RETURN TRUE
   
END FUNCTION
 
 
 
#應用 a40 樣板自動產生(Version:9)
#+ BPM抽單
PRIVATE FUNCTION aqct300_draw_out()
   #add-point:draw段define name="draw.define_customerization"
   {<point name="draw.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   #add-point:draw段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="draw.define"
   {<point name="draw.define"/>}
   #end add-point
   
   #add-point:Function前置處理  name="draw.pre_function"
   {<point name="draw.pre_function"/>}
   #end add-point
   
   #抽單失敗
   IF NOT cl_bpm_draw_out() THEN 
      RETURN FALSE
   END IF    
          
   #重新指定此筆單據資料狀態圖片=>抽單
   LET g_browser[g_current_idx].b_statepic = "stus/16/draw_out.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL aqct300_ui_headershow()  
   CALL aqct300_ui_detailshow()
 
   #add-point:Function後置處理  name="draw.after_function"
   {<point name="draw.after_function"/>}
   #end add-point
 
   RETURN TRUE
   
END FUNCTION
 
 
 
 
]]>
</section>
  <section id="aqct300.set_pk_array" ver="9" ch="" status="" src="s" readonly="">
<![CDATA[   #應用 a51 樣板自動產生(Version:8)
#+ 給予pk_array內容
PRIVATE FUNCTION aqct300_set_pk_array()
   #add-point:set_pk_array段define name="set_pk_array.define_customerization"
   {<point name="set_pk_array.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   #add-point:set_pk_array段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_pk_array.define"
   {<point name="set_pk_array.define"/>}
   #end add-point
   
   #add-point:Function前置處理 name="set_pk_array.before"
   {<point name="set_pk_array.before"/>}
   #end add-point  
   
   #若l_ac<=0代表沒有資料
   IF l_ac <= 0 THEN
      RETURN
   END IF
   
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_qcba_m.qcbadocno
   LET g_pk_array[1].column = 'qcbadocno'
 
   
   #add-point:set_pk_array段之後 name="set_pk_array.after"
   {<point name="set_pk_array.after"/>}
   #end add-point  
   
END FUNCTION
 
 
 
]]>
</section>
  <section id="aqct300.other_dialog" ver="2" ch="" status="" src="s" readonly="">
<![CDATA[   
]]>
</section>
  <section id="aqct300.msgcentre_notify" ver="7" ch="" status="" src="s" readonly="">
<![CDATA[#應用 a66 樣板自動產生(Version:6)
PRIVATE FUNCTION aqct300_msgcentre_notify(lc_state)
   #add-point:msgcentre_notify段define name="msgcentre_notify.define_customerization"
   {<point name="msgcentre_notify.define_customerization" edit="c" mark="Y"/>}
   #end add-point   
   DEFINE lc_state LIKE type_t.chr80
   #add-point:msgcentre_notify段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="msgcentre_notify.define"
   {<point name="msgcentre_notify.define"/>}
   #end add-point
   
   #add-point:Function前置處理  name="msgcentre_notify.pre_function"
   {<point name="msgcentre_notify.pre_function"/>}
   #end add-point
   
   INITIALIZE g_msgparam TO NULL
 
   #action-id與狀態填寫
   LET g_msgparam.state = lc_state
 
   #PK資料填寫
   CALL aqct300_set_pk_array()
   #單頭資料填寫
   LET g_msgparam.data[1] = util.JSON.stringify(g_qcba_m)
 
   #add-point:msgcentre其他通知 name="msgcentre_notify.process"
   {<point name="msgcentre_notify.process"/>}
   #end add-point
 
   #呼叫訊息中心傳遞本關完成訊息
   CALL cl_msgcentre_notify()
 
END FUNCTION
 
 
 
]]>
</section>
  <section id="aqct300.action_chk" ver="5" ch="" status="" src="s" readonly="">
<![CDATA[#+ 修改/刪除前行為檢查(是否可允許此動作), 若有其他行為須管控也可透過此段落
PRIVATE FUNCTION aqct300_action_chk()
   #add-point:action_chk段define(客製用) name="action_chk.define_customerization"
   {<point name="action_chk.define_customerization" edit="c" mark="Y"/>}
   #end add-point
   #add-point:action_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="action_chk.define"
   {<point name="action_chk.define"/>} 
   #end add-point
   
   #add-point:action_chk段action_chk name="action_chk.action_chk"
   {<point name="action_chk.action_chk"/>}
   #end add-point
      
   RETURN TRUE
   
END FUNCTION
]]>
</section>
  <section id="aqct300.other_function" ver="2" ch="" status="" src="s" readonly="">
<![CDATA[{<point name="other.function"/>}
]]>
</section>
</add_points>