<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="abmm206" std_prog="abmm206" erpver="1.0" module="ABM" ver="1" env="s" zone="t10dev" normal_style="Y" booking="Y">
  <point name="construct.c.bmea003" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaf001_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO bmea003  #顯示到畫面上

            NEXT FIELD bmea003                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.bmea008" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaf001_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO bmea008  #顯示到畫面上

            NEXT FIELD bmea008                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.bmea013" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO bmea013  #顯示到畫面上

            NEXT FIELD bmea013                     #返回原欄位

]]>
  </point>
  <point name="input.a.bmea001" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_bmea_m.bmea001) AND NOT cl_null(g_bmea_m.bmea002) AND NOT cl_null(g_bmea_m.bmea003) AND NOT cl_null(g_bmea_m.bmea004) AND NOT cl_null(g_bmea_m.bmea005) AND NOT cl_null(g_bmea_m.bmea006) AND NOT cl_null(g_bmea_m.bmea007) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_bmea_m.bmea001 != g_bmea001_t  OR g_bmea_m.bmea002 != g_bmea002_t  OR g_bmea_m.bmea003 != g_bmea003_t  OR g_bmea_m.bmea004 != g_bmea004_t  OR g_bmea_m.bmea005 != g_bmea005_t  OR g_bmea_m.bmea006 != g_bmea006_t  OR g_bmea_m.bmea007 != g_bmea007_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM bmea_t WHERE "||"bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND "||"bmea001 = '"||g_bmea_m.bmea001 ||"' AND "|| "bmea002 = '"||g_bmea_m.bmea002 ||"' AND "|| "bmea003 = '"||g_bmea_m.bmea003 ||"' AND "|| "bmea004 = '"||g_bmea_m.bmea004 ||"' AND "|| "bmea005 = '"||g_bmea_m.bmea005 ||"' AND "|| "bmea006 = '"||g_bmea_m.bmea006 ||"' AND "|| "bmea007 = '"||g_bmea_m.bmea007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.bmea002" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_bmea_m.bmea001) AND NOT cl_null(g_bmea_m.bmea002) AND NOT cl_null(g_bmea_m.bmea003) AND NOT cl_null(g_bmea_m.bmea004) AND NOT cl_null(g_bmea_m.bmea005) AND NOT cl_null(g_bmea_m.bmea006) AND NOT cl_null(g_bmea_m.bmea007) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_bmea_m.bmea001 != g_bmea001_t  OR g_bmea_m.bmea002 != g_bmea002_t  OR g_bmea_m.bmea003 != g_bmea003_t  OR g_bmea_m.bmea004 != g_bmea004_t  OR g_bmea_m.bmea005 != g_bmea005_t  OR g_bmea_m.bmea006 != g_bmea006_t  OR g_bmea_m.bmea007 != g_bmea007_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM bmea_t WHERE "||"bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND "||"bmea001 = '"||g_bmea_m.bmea001 ||"' AND "|| "bmea002 = '"||g_bmea_m.bmea002 ||"' AND "|| "bmea003 = '"||g_bmea_m.bmea003 ||"' AND "|| "bmea004 = '"||g_bmea_m.bmea004 ||"' AND "|| "bmea005 = '"||g_bmea_m.bmea005 ||"' AND "|| "bmea006 = '"||g_bmea_m.bmea006 ||"' AND "|| "bmea007 = '"||g_bmea_m.bmea007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.bmea003" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            CALL abmm206_desc()
            IF NOT cl_null(g_bmea_m.bmea003) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND  g_bmea_m.bmea003 != g_bmea003_t ) THEN 
                  IF NOT ap_chk_notDup(g_bmea_m.bmea003,"SELECT COUNT(*) FROM bmea_t WHERE bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND bmea001 = 'ALL' AND bmea002 = ' ' AND bmea003 = '"||g_bmea_m.bmea003 ||"' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2'",'std-00004',0) THEN 
                     LET g_bmea_m.bmea003 = g_bmea003_t
                     CALL abmm206_desc()
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            IF NOT cl_null(g_bmea_m.bmea003) THEN 
               #此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_bmea_m.bmea003
               #呼叫檢查存在的library
               IF NOT cl_chk_exist("v_imaf001_1") THEN
                  LET g_bmea_m.bmea003 = g_bmea003_t
                  CALL abmm206_desc()
                  NEXT FIELD CURRENT
               END IF
            END IF 
]]>
  </point>
  <point name="input.a.bmea004" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_bmea_m.bmea001) AND NOT cl_null(g_bmea_m.bmea002) AND NOT cl_null(g_bmea_m.bmea003) AND NOT cl_null(g_bmea_m.bmea004) AND NOT cl_null(g_bmea_m.bmea005) AND NOT cl_null(g_bmea_m.bmea006) AND NOT cl_null(g_bmea_m.bmea007) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_bmea_m.bmea001 != g_bmea001_t  OR g_bmea_m.bmea002 != g_bmea002_t  OR g_bmea_m.bmea003 != g_bmea003_t  OR g_bmea_m.bmea004 != g_bmea004_t  OR g_bmea_m.bmea005 != g_bmea005_t  OR g_bmea_m.bmea006 != g_bmea006_t  OR g_bmea_m.bmea007 != g_bmea007_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM bmea_t WHERE "||"bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND "||"bmea001 = '"||g_bmea_m.bmea001 ||"' AND "|| "bmea002 = '"||g_bmea_m.bmea002 ||"' AND "|| "bmea003 = '"||g_bmea_m.bmea003 ||"' AND "|| "bmea004 = '"||g_bmea_m.bmea004 ||"' AND "|| "bmea005 = '"||g_bmea_m.bmea005 ||"' AND "|| "bmea006 = '"||g_bmea_m.bmea006 ||"' AND "|| "bmea007 = '"||g_bmea_m.bmea007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.bmea005" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_bmea_m.bmea001) AND NOT cl_null(g_bmea_m.bmea002) AND NOT cl_null(g_bmea_m.bmea003) AND NOT cl_null(g_bmea_m.bmea004) AND NOT cl_null(g_bmea_m.bmea005) AND NOT cl_null(g_bmea_m.bmea006) AND NOT cl_null(g_bmea_m.bmea007) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_bmea_m.bmea001 != g_bmea001_t  OR g_bmea_m.bmea002 != g_bmea002_t  OR g_bmea_m.bmea003 != g_bmea003_t  OR g_bmea_m.bmea004 != g_bmea004_t  OR g_bmea_m.bmea005 != g_bmea005_t  OR g_bmea_m.bmea006 != g_bmea006_t  OR g_bmea_m.bmea007 != g_bmea007_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM bmea_t WHERE "||"bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND "||"bmea001 = '"||g_bmea_m.bmea001 ||"' AND "|| "bmea002 = '"||g_bmea_m.bmea002 ||"' AND "|| "bmea003 = '"||g_bmea_m.bmea003 ||"' AND "|| "bmea004 = '"||g_bmea_m.bmea004 ||"' AND "|| "bmea005 = '"||g_bmea_m.bmea005 ||"' AND "|| "bmea006 = '"||g_bmea_m.bmea006 ||"' AND "|| "bmea007 = '"||g_bmea_m.bmea007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.bmea006" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_bmea_m.bmea001) AND NOT cl_null(g_bmea_m.bmea002) AND NOT cl_null(g_bmea_m.bmea003) AND NOT cl_null(g_bmea_m.bmea004) AND NOT cl_null(g_bmea_m.bmea005) AND NOT cl_null(g_bmea_m.bmea006) AND NOT cl_null(g_bmea_m.bmea007) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_bmea_m.bmea001 != g_bmea001_t  OR g_bmea_m.bmea002 != g_bmea002_t  OR g_bmea_m.bmea003 != g_bmea003_t  OR g_bmea_m.bmea004 != g_bmea004_t  OR g_bmea_m.bmea005 != g_bmea005_t  OR g_bmea_m.bmea006 != g_bmea006_t  OR g_bmea_m.bmea007 != g_bmea007_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM bmea_t WHERE "||"bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND "||"bmea001 = '"||g_bmea_m.bmea001 ||"' AND "|| "bmea002 = '"||g_bmea_m.bmea002 ||"' AND "|| "bmea003 = '"||g_bmea_m.bmea003 ||"' AND "|| "bmea004 = '"||g_bmea_m.bmea004 ||"' AND "|| "bmea005 = '"||g_bmea_m.bmea005 ||"' AND "|| "bmea006 = '"||g_bmea_m.bmea006 ||"' AND "|| "bmea007 = '"||g_bmea_m.bmea007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.bmea007" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_bmea_m.bmea001) AND NOT cl_null(g_bmea_m.bmea002) AND NOT cl_null(g_bmea_m.bmea003) AND NOT cl_null(g_bmea_m.bmea004) AND NOT cl_null(g_bmea_m.bmea005) AND NOT cl_null(g_bmea_m.bmea006) AND NOT cl_null(g_bmea_m.bmea007) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_bmea_m.bmea001 != g_bmea001_t  OR g_bmea_m.bmea002 != g_bmea002_t  OR g_bmea_m.bmea003 != g_bmea003_t  OR g_bmea_m.bmea004 != g_bmea004_t  OR g_bmea_m.bmea005 != g_bmea005_t  OR g_bmea_m.bmea006 != g_bmea006_t  OR g_bmea_m.bmea007 != g_bmea007_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM bmea_t WHERE "||"bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND "||"bmea001 = '"||g_bmea_m.bmea001 ||"' AND "|| "bmea002 = '"||g_bmea_m.bmea002 ||"' AND "|| "bmea003 = '"||g_bmea_m.bmea003 ||"' AND "|| "bmea004 = '"||g_bmea_m.bmea004 ||"' AND "|| "bmea005 = '"||g_bmea_m.bmea005 ||"' AND "|| "bmea006 = '"||g_bmea_m.bmea006 ||"' AND "|| "bmea007 = '"||g_bmea_m.bmea007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.page1.bmea008" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL abmm206_bmea_desc()
            #此段落由子樣板a05產生
            IF g_bmea_m.bmea003 IS NOT NULL AND g_bmea_d[l_ac].bmea008 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_bmea_m.bmea003 != g_bmea003_t OR g_bmea_d[l_ac].bmea008 != g_bmea_d_t.bmea008)) THEN 
                  IF NOT ap_chk_notDup(g_bmea_d[l_ac].bmea008,"SELECT COUNT(*) FROM bmea_t WHERE bmeaent = '" ||g_enterprise|| "' AND bmeasite = '" ||g_site|| "' AND bmea001 = 'ALL' AND bmea002 = ' ' AND bmea003 = '"||g_bmea_m.bmea003 ||"' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2' AND bmea008 = '"||g_bmea_d[l_ac].bmea008 ||"'",'std-00004',0) THEN 
                     LET g_bmea_d[l_ac].bmea008 = g_bmea_d_t.bmea008
                     CALL abmm206_bmea_desc()
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            IF NOT cl_null(g_bmea_d[l_ac].bmea008) THEN 
               IF g_bmea_d[l_ac].bmea008 = g_bmea_m.bmea003 THEN
                  CALL cl_err(g_bmea_d[l_ac].bmea008,'abm-00051',1)
                  LET g_bmea_d[l_ac].bmea008 = g_bmea_d_t.bmea008
                  CALL abmm206_bmea_desc()
                  NEXT FIELD CURRENT
               END IF
               #此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_bmea_d[l_ac].bmea008

                  
               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_imaf001_1") THEN
                  LET g_bmea_d[l_ac].bmea008 = g_bmea_d_t.bmea008
                  CALL abmm206_bmea_desc()
                  NEXT FIELD CURRENT
               END IF
               IF l_cmd = 'a' THEN
                  SELECT imae081 INTO  g_bmea_d[l_ac].bmea013
                    FROM imae_t
                   WHERE imaeent = g_enterprise
                     AND imaesite = g_site
                     AND imae001 = g_bmea_d[l_ac].bmea008
               END IF
               IF NOT cl_null(g_bmea_d[l_ac].bmea013) THEN
                  LET l_rate = ''
                  LET l_imaa006 = ''
                  SELECT imaa006 INTO l_imaa006
                    FROM imaa_t
                   WHERE imaaent = g_enterprise
                     AND imaa001 = g_bmea_d[l_ac].bmea008
                  IF NOT cl_null(l_imaa006) THEN
                     CALL s_aimi190_get_convert(g_bmea_d[l_ac].bmea008,g_bmea_d[l_ac].bmea013,l_imaa006) RETURNING l_success,l_rate
                     IF NOT l_success THEN
                        LET g_bmea_d[l_ac].bmea008 = g_bmea_d_t.bmea008
                        NEXT FIELD bmea008
                     END IF
                  END IF
                  IF cl_null(l_imaa006) THEN
                     CALL cl_err(l_imaa006,'abm-00021',1)
                     LET g_bmea_d[l_ac].bmea008 = g_bmea_d_t.bmea008
                     NEXT FIELD bmea008
                  END IF
               END IF
            END IF 


]]>
  </point>
  <point name="input.a.page1.bmea011" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_bmea_d[l_ac].bmea011) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.bmea012" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_bmea_d[l_ac].bmea012) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.bmea013" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_bmea_d[l_ac].bmea013) THEN 
               #此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_bmea_d[l_ac].bmea013

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_ooca001") THEN
                  LET g_bmea_d[l_ac].bmea013 = g_bmea_d_t.bmea013
                  NEXT FIELD CURRENT
               END IF
               LET l_rate = ''
               LET l_imaa006 = ''
               SELECT imaa006 INTO l_imaa006
                 FROM imaa_t
                WHERE imaaent = g_enterprise
                  AND imaa001 = g_bmea_d[l_ac].bmea008
               IF NOT cl_null(g_bmea_d[l_ac].bmea013) AND NOT cl_null(l_imaa006) THEN
                  CALL s_aimi190_get_convert(g_bmea_d[l_ac].bmea008,g_bmea_d[l_ac].bmea013,l_imaa006) RETURNING l_success,l_rate
                  IF NOT l_success THEN
                     LET g_bmea_d[l_ac].bmea013 = g_bmea_d_t.bmea013
                     NEXT FIELD bmea013
                  END IF
               END IF
               IF cl_null(l_imaa006) THEN
                  CALL cl_err(l_imaa006,'abm-00021',1)
                  LET g_bmea_d[l_ac].bmea013 = g_bmea_d_t.bmea013
                  NEXT FIELD bmea013
               END IF
            END IF 
]]>
  </point>
  <point name="input.a.page1.bmea015" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_bmea_d[l_ac].bmea015) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.bmea017" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_bmea_d[l_ac].bmea017) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.bmeasite" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  g_bmea_m.bmea001 IS NOT NULL AND g_bmea_m.bmea002 IS NOT NULL AND g_bmea_m.bmea003 IS NOT NULL AND g_bmea_m.bmea004 IS NOT NULL AND g_bmea_m.bmea005 IS NOT NULL AND g_bmea_m.bmea006 IS NOT NULL AND g_bmea_m.bmea007 IS NOT NULL AND g_bmea_d[g_detail_idx].bmeasite IS NOT NULL AND g_bmea_d[g_detail_idx].bmea008 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_bmea_m.bmea001 != g_bmea001_t OR g_bmea_m.bmea002 != g_bmea002_t OR g_bmea_m.bmea003 != g_bmea003_t OR g_bmea_m.bmea004 != g_bmea004_t OR g_bmea_m.bmea005 != g_bmea005_t OR g_bmea_m.bmea006 != g_bmea006_t OR g_bmea_m.bmea007 != g_bmea007_t OR g_bmea_d[g_detail_idx].bmeasite != g_bmea_d_t.bmeasite OR g_bmea_d[g_detail_idx].bmea008 != g_bmea_d_t.bmea008)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM bmea_t WHERE "||"bmeaent = '" ||g_enterprise|| "' AND "||"bmea001 = '"||g_bmea_m.bmea001 ||"' AND "|| "bmea002 = '"||g_bmea_m.bmea002 ||"' AND "|| "bmea003 = '"||g_bmea_m.bmea003 ||"' AND "|| "bmea004 = '"||g_bmea_m.bmea004 ||"' AND "|| "bmea005 = '"||g_bmea_m.bmea005 ||"' AND "|| "bmea006 = '"||g_bmea_m.bmea006 ||"' AND "|| "bmea007 = '"||g_bmea_m.bmea007 ||"' AND "|| "bmeasite = '"||g_bmea_d[g_detail_idx].bmeasite ||"' AND "|| "bmea008 = '"||g_bmea_d[g_detail_idx].bmea008 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.c.bmea003" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_bmea_m.bmea003             #給予default值

            #給予arg

            CALL q_imaf001_6()                                #呼叫開窗

            LET g_bmea_m.bmea003 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_bmea_m.bmea003 TO bmea003              #顯示到畫面上
            CALL abmm206_desc()
            NEXT FIELD bmea003                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.bmea008" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_bmea_d[l_ac].bmea008             #給予default值

            #給予arg

            CALL q_imaf001_6()                                #呼叫開窗

            LET g_bmea_d[l_ac].bmea008 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_bmea_d[l_ac].bmea008 TO bmea008              #顯示到畫面上
            CALL abmm206_bmea_desc()
            NEXT FIELD bmea008                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.bmea013" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_bmea_d[l_ac].bmea013             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_bmea_d[l_ac].bmea013 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_bmea_d[l_ac].bmea013 TO bmea013              #顯示到畫面上

            NEXT FIELD bmea013                          #返回原欄位

]]>
  </point>
  <point name="ref_show.body.reference" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      CALL abmm206_bmea_desc()
   END FOR
   
   FOR l_ac1 = 1 TO g_bmea2_d.getLength()
      CALL abmm206_bmeb_desc()]]>
  </point>
  <point name="function.abmm206_bmea_desc" order="1" ver="1" cite_std="" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 單身替代料號帶值
# Memo...........:
# Usage..........: CALL abmm206_bmea_desc()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2014/01/17 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION abmm206_bmea_desc()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_bmea_d[l_ac].bmea008
   CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_bmea_d[l_ac].bmea008_desc = g_rtn_fields[1]
   LET g_bmea_d[l_ac].bmea008_desc1 = g_rtn_fields[2]   
   DISPLAY BY NAME g_bmea_d[l_ac].bmea008_desc
   DISPLAY BY NAME g_bmea_d[l_ac].bmea008_desc1
END FUNCTION]]>
  </point>
  <point name="function.abmm206_desc" order="2" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 單頭元件料號帶值
# Memo...........:
# Usage..........: CALL abmm206_desc()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2014/01/17 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION abmm206_desc()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_bmea_m.bmea003
   CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_lang||"'", "") RETURNING g_rtn_fields
   LET g_bmea_m.imaal003 = g_rtn_fields[1]
   LET g_bmea_m.imaal004 = g_rtn_fields[2]
   DISPLAY BY NAME g_bmea_m.imaal003
   DISPLAY BY NAME g_bmea_m.imaal004
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_bmea_m.bmea003
   CALL ap_ref_array2(g_ref_fields,"SELECT imae081 FROM imae_t WHERE imaeent='"||g_enterprise||"' AND imaesite='"||g_site||"' AND imae001=? ", "") RETURNING g_rtn_fields
   LET g_bmea_m.imae081 = g_rtn_fields[1]
   DISPLAY BY NAME g_bmea_m.imae081
END FUNCTION]]>
  </point>
  <point name="function.abmm206_b_fill_1" order="3" ver="1" cite_std="" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 单身2显示
# Memo...........:
# Usage..........: CALL abmm206_b_fill_1()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2014/01/17 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION abmm206_b_fill_1()
   CALL g_bmea2_d.clear() 
   IF cl_null(l_ac) OR l_ac = 0 THEN
      LET l_ac =1
   END IF
   IF cl_null(g_bmea_d[l_ac].bmea008) THEN
      CALL g_bmea_d.deleteElement(l_ac)
      RETURN
   END IF 
   LET g_sql = "SELECT  UNIQUE bmeb009,'' FROM bmeb_t",
               " WHERE bmebent=? AND bmebsite=? AND bmeb001=? AND bmeb002=? AND bmeb003=? AND bmeb004=? AND bmeb005=? AND bmeb006=? AND bmeb007=? AND bmeb008 =?"
  
   IF NOT cl_null(g_wc_table2) THEN
      LET g_sql = g_sql CLIPPED, " AND ", g_wc_table2 CLIPPED
   END IF
  
   LET g_sql = g_sql, " ORDER BY bmeb009"
  
   PREPARE abmm206_pb1 FROM g_sql
   DECLARE b_fill_cs1 CURSOR FOR abmm206_pb1
  
   LET l_ac1 = 1
 
   FOREACH b_fill_cs1 USING g_enterprise,g_site,'ALL',' ',g_bmea_m.bmea003,' ',' ',' ','2',g_bmea_d[l_ac].bmea008 INTO g_bmea2_d[l_ac1].bmeb009,g_bmea2_d[l_ac1].bmeb009_desc
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF
      
      CALL abmm206_bmeb_desc()
      
      LET l_ac1 = l_ac1 + 1
      IF l_ac1 > g_max_rec THEN
         CALL cl_err( '', 9035, 0 )
         EXIT FOREACH
      END IF
      
   END FOREACH
   CALL g_bmea2_d.deleteElement(g_bmea2_d.getLength())
   
   FREE abmm206_pb1
END FUNCTION]]>
  </point>
  <point name="function.abmm206_bmeb_desc" order="4" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 客戶編號帶值
# Memo...........:
# Usage..........: CALL abmm206_bmeb_desc()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2014/01/17 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION abmm206_bmeb_desc()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_bmea2_d[l_ac1].bmeb009
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_bmea2_d[l_ac1].bmeb009_desc = g_rtn_fields[1] 
   DISPLAY BY NAME g_bmea2_d[l_ac1].bmeb009_desc         
   
END FUNCTION]]>
  </point>
  <point name="function.abmm206_ins_bmea" order="5" ver="1" cite_std="" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 新增bmea_t到其他营运据点
# Memo...........:
# Usage..........: CALL abmm206_ins_bmea()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2014/01/20 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION abmm206_ins_bmea()
DEFINE l_sql          STRING   
DEFINE l_imaa009      LIKE imaa_t.imaa009 
DEFINE l_imaa003      LIKE imaa_t.imaa003
DEFINE r_success      LIKE type_t.num5
DEFINE l_cnt          LIKE type_t.num5
DEFINE l_site         LIKE ooef_t.ooef001

   LET l_imaa009 = ""
   SELECT imaa009 INTO l_imaa009 
     FROM imaa_t
    WHERE imaaent = g_enterprise
      AND imaa001 = g_bmea_m.bmea003
   LET l_sql = " SELECT UNIQUE ooef001 FROM ooef_t",
               "  WHERE ooefent = '",g_enterprise,"'",
               "    AND (ooef001 IN (SELECT UNIQUE imda001 from imda_t ",
               "                      WHERE imdaent = '",g_enterprise,"'",
               "                        AND imdastus= 'Y' ",    #有效的
               "                        AND imda005 = 'Y' ",    #BOM引入
               "                        AND imda003 = '1' ",    #自动引入
               "                        AND imda002 = '",l_imaa009,"') ",#产品分类
               "         OR ",
               "         ooef001 IN (SELECT UNIQUE imdb001 from imdb_t ",
               "                      WHERE imdbent = ",g_enterprise,
               "                        AND imdbstus= 'Y' ", #有效的
               "                        AND imdb005 = 'Y' ", #BOM引入
               "                        AND imdb003 = '1' ",    #自动引入
               "                        AND imdb002 = '",g_bmea_m.bmea003,"') ",#料件编号
               "         )",
               "    AND ooef001 <> 'ALL' "
   PREPARE s_abmm206_sel_ooef001_p FROM l_sql
   DECLARE s_abmm206_sel_ooef001_c CURSOR FOR  s_abmm206_sel_ooef001_p
   FOREACH s_abmm206_sel_ooef001_c INTO l_site
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH  s_abmm206_sel_ooef001_c:",SQLCA.sqlcode,1)
         EXIT FOREACH
         RETURN FALSE
      END IF
      #检查主件料件是否存在
      LET l_cnt = 0
      SELECT COUNT(*) INTO l_cnt FROM imaf_t
       WHERE imafent = g_enterprise
         AND imafsite= l_site
         AND imaf001 = g_bmea_m.bmea003
      IF l_cnt = 0 THEN
         SELECT imaa003 INTO l_imaa003 FROM imaa_t
          WHERE imaaent = g_enterprise
            AND imaa001 = g_bmea_m.bmea003
         IF cl_null(l_imaa003) THEN
            #缺少主分群碼資料,請檢查aimm200中的“主分群碼”欄位
            CALL cl_err(g_bmea_m.bmea003,'aim-00135',1)
            RETURN FALSE
         END IF
         CALL s_aimm200_ins_imaf(g_bmea_m.bmea003,l_imaa003,l_site) RETURNING r_success,g_errno
         IF NOT r_success THEN
            CALL cl_err(g_bmea_m.bmea003,g_errno,1)
            RETURN FALSE
         END IF
      END IF
      #检查替代料件是否存在
      LET l_cnt = 0
      SELECT COUNT(*) INTO l_cnt FROM imaf_t
       WHERE imafent = g_enterprise
         AND imafsite= l_site
         AND imaf001 = g_bmea_d[l_ac].bmea008
      IF l_cnt = 0 THEN
         SELECT imaa003 INTO l_imaa003 FROM imaa_t
          WHERE imaaent = g_enterprise
            AND imaa001 = g_bmea_d[l_ac].bmea008
         IF cl_null(l_imaa003) THEN
            #缺少主分群碼資料,請檢查aimm200中的“主分群碼”欄位
            CALL cl_err(g_bmea_d[l_ac].bmea008,'aim-00135',1)
            RETURN FALSE
         END IF
         CALL s_aimm200_ins_imaf(g_bmea_d[l_ac].bmea008,l_imaa003,l_site) RETURNING r_success,g_errno
         IF NOT r_success THEN
            CALL cl_err(g_bmea_d[l_ac].bmea008,g_errno,1)
            RETURN FALSE
         END IF
      END IF
      IF NOT cl_null(g_bmea_d[l_ac].bmea010) THEN
         INSERT INTO bmea_t(bmeaent,bmeasite,bmea003,bmea001,bmea002,bmea004,bmea005,bmea006,bmea007,bmea008,
                            bmea009,bmea010,bmea011,bmea012,bmea013,bmea014,bmea015,bmea016,bmea017,bmea018)
                     VALUES(g_enterprise,l_site,g_bmea_m.bmea003,'ALL',' ',' ',' ',' ','2',g_bmea_d[l_ac].bmea008,g_bmea_d[l_ac].bmea009,
                            g_bmea_d[l_ac].bmea010,g_bmea_d[l_ac].bmea011,g_bmea_d[l_ac].bmea012,g_bmea_d[l_ac].bmea013,
                            g_bmea_d[l_ac].bmea014,g_bmea_d[l_ac].bmea015,g_bmea_d[l_ac].bmea016,g_bmea_d[l_ac].bmea017,g_bmea_d[l_ac].bmea018)
      ELSE
         INSERT INTO bmea_t(bmeaent,bmeasite,bmea003,bmea001,bmea002,bmea004,bmea005,bmea006,bmea007,bmea008,
                            bmea009,bmea010,bmea011,bmea012,bmea013,bmea014,bmea015,bmea016,bmea017,bmea018)
                     VALUES(g_enterprise,l_site,g_bmea_m.bmea003,'ALL',' ',' ',' ',' ','2',g_bmea_d[l_ac].bmea008,g_bmea_d[l_ac].bmea009,
                            '',g_bmea_d[l_ac].bmea011,g_bmea_d[l_ac].bmea012,g_bmea_d[l_ac].bmea013,
                            g_bmea_d[l_ac].bmea014,g_bmea_d[l_ac].bmea015,g_bmea_d[l_ac].bmea016,g_bmea_d[l_ac].bmea017,g_bmea_d[l_ac].bmea018)
      END IF
      IF SQLCA.sqlcode THEN
         CALL cl_err('Insert error!',SQLCA.sqlcode,1)
         RETURN FALSE
      END IF
   END FOREACH
   RETURN TRUE
END FUNCTION]]>
  </point>
  <point name="function.abmm206_ins_bmeb" order="6" ver="1" cite_std="" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 新增bmeb_t到其他营运据点
# Memo...........:
# Usage..........: CALL abmm206_ins_bmeb()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2014/01/20 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION abmm206_ins_bmeb()
DEFINE l_sql          STRING 
DEFINE l_imaa009      LIKE imaa_t.imaa009 
DEFINE l_imaa003      LIKE imaa_t.imaa003
DEFINE r_success      LIKE type_t.num5
DEFINE l_cnt          LIKE type_t.num5
DEFINE l_site         LIKE ooef_t.ooef001

   LET l_imaa009 = ""
   SELECT imaa009 INTO l_imaa009 
     FROM imaa_t
    WHERE imaaent = g_enterprise
      AND imaa001 = g_bmea_m.bmea003
   LET l_sql = " SELECT UNIQUE ooef001 FROM ooef_t",
               "  WHERE ooefent = '",g_enterprise,"'",
               "    AND (ooef001 IN (SELECT UNIQUE imda001 from imda_t ",
               "                      WHERE imdaent = '",g_enterprise,"'",
               "                        AND imdastus= 'Y' ",    #有效的
               "                        AND imda005 = 'Y' ",    #BOM引入
               "                        AND imda003 = '1' ",    #自动引入
               "                        AND imda002 = '",l_imaa009,"') ",#产品分类
               "         OR ",
               "         ooef001 IN (SELECT UNIQUE imdb001 from imdb_t ",
               "                      WHERE imdbent = ",g_enterprise,
               "                        AND imdbstus= 'Y' ", #有效的
               "                        AND imdb005 = 'Y' ", #BOM引入
               "                        AND imdb003 = '1' ",    #自动引入
               "                        AND imdb002 = '",g_bmea_m.bmea003,"') ",#料件编号
               "         )",
               "    AND ooef001 <> 'ALL' "
   PREPARE s_abmm206_sel_ooef001_p1 FROM l_sql
   DECLARE s_abmm206_sel_ooef001_c1 CURSOR FOR s_abmm206_sel_ooef001_p1
   FOREACH s_abmm206_sel_ooef001_c1 INTO l_site
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH  s_abmm206_sel_ooef001_c:",SQLCA.sqlcode,1)
         EXIT FOREACH
         RETURN FALSE
      END IF
      #检查主件料件是否存在
      LET l_cnt = 0
      SELECT COUNT(*) INTO l_cnt FROM imaf_t
       WHERE imafent = g_enterprise
         AND imafsite= l_site
         AND imaf001 = g_bmea_m.bmea003
      IF l_cnt = 0 THEN
         SELECT imaa003 INTO l_imaa003 FROM imaa_t
          WHERE imaaent = g_enterprise
            AND imaa001 = g_bmea_m.bmea003
         IF cl_null(l_imaa003) THEN
            #缺少主分群碼資料,請檢查aimm200中的“主分群碼”欄位
            CALL cl_err(g_bmea_m.bmea003,'aim-00135',1)
            RETURN FALSE
         END IF
         CALL s_aimm200_ins_imaf(g_bmea_m.bmea003,l_imaa003,l_site) RETURNING r_success,g_errno
         IF NOT r_success THEN
            CALL cl_err(g_bmea_m.bmea003,g_errno,1)
            RETURN FALSE
         END IF
      END IF
      #检查替代料件是否存在
      LET l_cnt = 0
      SELECT COUNT(*) INTO l_cnt FROM imaf_t
       WHERE imafent = g_enterprise
         AND imafsite= l_site
         AND imaf001 = g_bmea_d[l_ac].bmea008
      IF l_cnt = 0 THEN
         SELECT imaa003 INTO l_imaa003 FROM imaa_t
          WHERE imaaent = g_enterprise
            AND imaa001 = g_bmea_d[l_ac].bmea008
         IF cl_null(l_imaa003) THEN
            #缺少主分群碼資料,請檢查aimm200中的“主分群碼”欄位
            CALL cl_err(g_bmea_d[l_ac].bmea008,'aim-00135',1)
            RETURN FALSE
         END IF
         CALL s_aimm200_ins_imaf(g_bmea_d[l_ac].bmea008,l_imaa003,l_site) RETURNING r_success,g_errno
         IF NOT r_success THEN
            CALL cl_err(g_bmea_d[l_ac].bmea008,g_errno,1)
            RETURN FALSE
         END IF
      END IF
      INSERT INTO bmeb_t (bmebent,bmebsite,bmeb001,bmeb002,bmeb003,bmeb004,bmeb005,bmeb006,bmeb007,bmeb008,bmeb009)
                   VALUES(g_enterprise,l_site,'ALL',' ',g_bmea_m.bmea003,' ',' ',' ','2',g_bmea_d[l_ac].bmea008,g_bmea2_d[l_ac1].bmeb009)
      IF SQLCA.sqlcode THEN
         CALL cl_err('Insert error!',SQLCA.sqlcode,1)
         RETURN FALSE
      END IF
   END FOREACH
   RETURN TRUE
END FUNCTION]]>
  </point>
  <point name="b_fill.fill" order="" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         CALL abmm206_bmea_desc()
#         CALL abmm206_b_fill_1()]]>
  </point>
  <point name="b_fill.sql_before" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL g_bmea2_d.clear()]]>
  </point>
  <point name="b_fill2.after_fill" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL abmm206_b_fill_1()]]>
  </point>
  <point name="browser_fill.before_browser_fill" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_wc = " 1=1" THEN
      LET g_wc = " bmea001 = 'ALL' AND bmea002 = ' ' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2' AND ",g_wc
   END IF
   IF g_wc2 = " 1=1" THEN
      LET g_wc2 = " bmea001 = 'ALL' AND bmea002 = ' ' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2' AND ",g_wc2
   END IF]]>
  </point>
  <point name="browser_fill.reference" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_browser[g_cnt].b_bmea003
      CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_lang||"'", "") RETURNING g_rtn_fields
      LET g_browser[g_cnt].b_bmea003_desc = g_rtn_fields[1]
      LET g_browser[g_cnt].b_bmea003_desc1 = g_rtn_fields[2]
      DISPLAY BY NAME g_browser[g_cnt].b_bmea003_desc
      DISPLAY BY NAME g_browser[g_cnt].b_bmea003_desc1
      
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_browser[g_cnt].b_bmea003
      CALL ap_ref_array2(g_ref_fields,"SELECT imae081 FROM imae_t WHERE imaeent='"||g_enterprise||"' AND imaesite='"||g_site||"' AND imae001=? ", "") RETURNING g_rtn_fields
      LET g_browser[g_cnt].b_bmea003_desc2 = g_rtn_fields[1] 
      DISPLAY BY NAME g_browser[g_cnt].b_bmea003_desc2]]>
  </point>
  <point name="cs.after_construct" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_wc = " bmea001 = 'ALL' AND bmea002 = ' ' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2' AND ",g_wc
   LET g_wc2_table1 = " bmea001 = 'ALL' AND bmea002 = ' ' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2' AND ",g_wc2_table1]]>
  </point>
  <point name="cs.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL g_bmea2_d.clear() ]]>
  </point>
  <point name="default_search.after" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF NOT cl_null(g_argv[1]) THEN
      LET g_wc = " bmeasite = '", g_argv[1], "' AND bmea001 = 'ALL' AND bmea002 = ' ' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2'"
   ELSE
      LET g_wc = " bmeasite = '", g_site, "' AND bmea001 = 'ALL' AND bmea002 = ' ' AND bmea004 = ' ' AND bmea005 = ' ' AND bmea006 = ' ' AND bmea007 = '2'"
   END IF]]>
  </point>
  <point name="delete.body.a_delete" order="" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      DELETE FROM bmea_t
       WHERE bmeaent = g_enterprise
         AND bmea001 = 'ALL'
         AND bmea002 = ' '
         AND bmea003 = g_bmea_m.bmea003
         AND bmea004 = ' '
         AND bmea005 = ' '
         AND bmea006 = ' '
         AND bmeasite = g_site
         AND bmea007 = '2'
      IF SQLCA.sqlcode THEN
         CALL cl_err("del bmea_t",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
      END IF
      IF g_prog = 'abmm206' THEN
         DELETE FROM bmea_t
          WHERE bmeaent = g_enterprise
            AND bmea001 = 'ALL'
            AND bmea002 = ' '
            AND bmea003 = g_bmea_m.bmea003
            AND bmea004 = ' '
            AND bmea005 = ' '
            AND bmea006 = ' '
            AND bmeasite <> 'ALL'
            AND bmea007 = '2'
         IF SQLCA.sqlcode THEN
            CALL cl_err("del bmea_t",SQLCA.sqlcode,1)
            CALL s_transaction_end('N','0')
         END IF
      END IF      
      DELETE FROM bmeb_t
       WHERE bmebent = g_enterprise
         AND bmeb001 = 'ALL'
         AND bmeb002 = ' '
         AND bmeb003 = g_bmea_m.bmea003
         AND bmeb004 = ' '
         AND bmeb005 = ' '
         AND bmeb006 = ' '
         AND bmebsite = g_site
         AND bmeb007 = '2'
      IF SQLCA.sqlcode THEN
         CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
      END IF
      IF g_prog = 'abmm206' THEN
         DELETE FROM bmeb_t
          WHERE bmebent = g_enterprise
            AND bmeb001 = 'ALL'
            AND bmeb002 = ' '
            AND bmeb003 = g_bmea_m.bmea003
            AND bmeb004 = ' '
            AND bmeb005 = ' '
            AND bmeb006 = ' '
            AND bmebsite <> 'ALL'
            AND bmeb007 = '2'
         IF SQLCA.sqlcode THEN
            CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
            CALL s_transaction_end('N','0')
         END IF   
      END IF]]>
  </point>
  <point name="delete.body.a_single_delete" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_prog = 'abmm206' THEN
      DELETE FROM bmea_t
       WHERE bmeaent = g_enterprise 
         AND bmea001 = 'ALL'
         AND bmea002 = ' '
         AND bmea003 = g_bmea_m.bmea003
         AND bmea004 = ' '
         AND bmea005 = ' '
         AND bmea006 = ' '
         AND bmeasite <> 'ALL'
         AND bmea007 = '2'
         AND bmea008 = g_bmea_d_t.bmea008
         AND bmea018 = '1'
      IF SQLCA.sqlcode THEN
         CALL cl_err("del bmea_t",SQLCA.sqlcode,1)
         RETURN FALSE 
      END IF
   END IF
   DELETE FROM bmeb_t
    WHERE bmebent = g_enterprise
      AND bmeb001 = 'ALL'
      AND bmeb002 = ' '
      AND bmeb003 = g_bmea_m.bmea003
      AND bmeb004 = ' '
      AND bmeb005 = ' '
      AND bmeb006 = ' '
      AND bmebsite = g_site
      AND bmeb007 = '2'
      AND bmeb008 = g_bmea_d_t.bmea008
   IF SQLCA.sqlcode THEN
      CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
      CALL s_transaction_end('N','0')
   END IF
   IF g_prog = 'abmm206' AND g_bmea_d[l_ac].bmea018 = '1'THEN
      DELETE FROM bmeb_t
       WHERE bmebent = g_enterprise
         AND bmeb001 = 'ALL'
         AND bmeb002 = ' '
         AND bmeb003 = g_bmea_m.bmea003
         AND bmeb004 = ' '
         AND bmeb005 = ' '
         AND bmeb006 = ' '
         AND bmebsite <> 'ALL'
         AND bmeb007 = '2'
         AND bmeb008 = g_bmea_d_t.bmea008
      IF SQLCA.sqlcode THEN
         CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
      END IF   
   END IF]]>
  </point>
  <point name="detail_reproduce.body.table1.m_insert" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   INSERT INTO bmeb_t(bmebent,bmebsite,bmeb001,bmeb002,bmeb003,bmeb004,bmeb005,bmeb006,bmeb007,bmeb008,bmeb009)
   SELECT g_enterprise,g_site,'ALL',' ',g_bmea_m.bmea003,' ',' ',' ','2',bmeb008,bmeb009
    FROM bmeb_t
   WHERE bmebent = g_enterprise
     AND bmebsite = g_site
     AND bmeb001 = 'ALL'
     AND bmeb002 = ' '
     AND bmeb003 = g_bmea003_t
     AND bmeb004 = ' '
     AND bmeb005 = ' '
     AND bmeb006 = ' '
     AND bmeb007 = '2'
   IF SQLCA.sqlcode THEN
      CALL cl_err("reproduce",SQLCA.sqlcode,1)
      CALL s_transaction_end('N','0')
      RETURN
   END IF  
   IF g_prog = 'abmm206' THEN
      INSERT INTO bmea_t(bmeaent,bmeasite,bmea003,bmea001,bmea002,bmea004,bmea005,bmea006,bmea007,bmea008,bmea009,bmea010,bmea011,bmea012,bmea013,bmea014,bmea015,bmea016,bmea017,bmea018)
      SELECT g_enterprise,ooef001,g_bmea_m.bmea003,'ALL',' ',' ',' ',' ','2',bmea008,bmea009,bmea010,bmea011,bmea012,bmea013,bmea014,bmea015,bmea016,bmea017,bmea018
        FROM bmea_t,ooef_t
       WHERE bmeaent = g_enterprise
         AND bmeasite = 'ALL'
         AND bmea001 = 'ALL'
         AND bmea002 = ' '
         AND bmea003 = g_bmea003_t
         AND bmea004 = ' '
         AND bmea005 = ' '
         AND bmea006 = ' '
         AND bmea007 = '2'
         AND ooefent = g_enterprise
         AND ooef001 <> 'ALL'
      IF SQLCA.sqlcode THEN
         CALL cl_err("reproduce",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      INSERT INTO bmeb_t(bmebent,bmebsite,bmeb001,bmeb002,bmeb003,bmeb004,bmeb005,bmeb006,bmeb007,bmeb008,bmeb009)
      SELECT g_enterprise,ooef001,'ALL',' ',g_bmea_m.bmea003,' ',' ',' ','2',bmeb008,bmeb009
       FROM bmeb_t,ooef_t
      WHERE bmebent = g_enterprise
        AND bmebsite = 'ALL'
        AND bmeb001 = 'ALL'
        AND bmeb002 = ' '
        AND bmeb003 = g_bmea003_t
        AND bmeb004 = ' '
        AND bmeb005 = ' '
        AND bmeb006 = ' '
        AND bmeb007 = '2'
        AND ooefent = g_enterprise
        AND ooef001 <> 'ALL'
      IF SQLCA.sqlcode THEN
         CALL cl_err("reproduce",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
         RETURN
      END IF  
   END IF]]>
  </point>
  <point name="global.variable" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[ TYPE type_g_bmea2_d        RECORD
             bmeb009         LIKE bmeb_t.bmeb009,
             bmeb009_desc    LIKE type_t.chr80
                                   END RECORD
DEFINE g_bmea2_d             DYNAMIC ARRAY OF type_g_bmea2_d
DEFINE g_bmea2_d_t           type_g_bmea2_d

DEFINE g_wc_table2           STRING                        #第2個單身table所使用的g_wc
DEFINE g_rec_b1              LIKE type_t.num5           
DEFINE g_wc3                 STRING
DEFINE l_ac1                 LIKE type_t.num5]]>
  </point>
  <point name="input.a.page1.bmea009" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_bmea_d[l_ac].bmea009) AND NOT cl_null(g_bmea_d[l_ac].bmea010) THEN
               IF g_bmea_d[l_ac].bmea009 > g_bmea_d[l_ac].bmea010 THEN
                  CALL cl_err(g_bmea_d[l_ac].bmea009,'ais-00047',1)
                  LET g_bmea_d[l_ac].bmea009  = g_bmea_d_t.bmea009
                  NEXT FIELD bmea009
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.bmea010" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_bmea_d[l_ac].bmea009) AND NOT cl_null(g_bmea_d[l_ac].bmea010) THEN
               IF g_bmea_d[l_ac].bmea009 > g_bmea_d[l_ac].bmea010 THEN
                  CALL cl_err(g_bmea_d[l_ac].bmea010,'ais-00047',1)
                  LET g_bmea_d[l_ac].bmea010  = g_bmea_d_t.bmea010
                  NEXT FIELD bmea010
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.bmea016" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL abmm206_set_entry_b(l_cmd)
            CALL abmm206_set_no_entry_b(l_cmd)]]>
  </point>
  <point name="input.after_set_entry" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_forupd_sql = "SELECT bmeb009,'' FROM bmeb_t WHERE bmebent=? AND bmebsite=? AND bmeb001=? AND bmeb002=? AND bmeb003=? AND bmeb004=? AND bmeb005=? AND bmeb006=? AND bmeb007=? AND bmeb008=? AND bmeb009 = ? FOR UPDATE"
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE abmm206_bcl2 CURSOR FROM g_forupd_sql
   ]]>
  </point>
  <point name="input.after_set_no_entry" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_errshow = 1 ]]>
  </point>
  <point name="input.before_dialog" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         IF p_cmd = 'a' THEN
            NEXT FIELD bmea003
         END IF]]>
  </point>
  <point name="input.body.a_insert" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[               IF g_prog = 'abmm206' THEN
                  IF NOT abmm206_ins_bmea() THEN
                     CALL s_transaction_end('N','0')
                     CANCEL INSERT
                  END IF
               END IF]]>
  </point>
  <point name="input.body.a_update" order="" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[               IF g_prog = 'abmm206' THEN
                  UPDATE bmea_t SET (bmea008,bmea009,bmea010,bmea011,bmea012,bmea013,bmea014,bmea015,bmea016,bmea017,bmea018) = 
                                    (g_bmea_d[l_ac].bmea008,g_bmea_d[l_ac].bmea009,g_bmea_d[l_ac].bmea010, 
                                     g_bmea_d[l_ac].bmea011,g_bmea_d[l_ac].bmea012,g_bmea_d[l_ac].bmea013,g_bmea_d[l_ac].bmea014, 
                                     g_bmea_d[l_ac].bmea015,g_bmea_d[l_ac].bmea016,g_bmea_d[l_ac].bmea017,g_bmea_d[l_ac].bmea018)
                   WHERE bmeaent = g_enterprise 
                     AND bmea001 = 'ALL'
                     AND bmea002 = ' '
                     AND bmea003 = g_bmea_m.bmea003
                     AND bmea004 = ' '
                     AND bmea005 = ' '
                     AND bmea006 = ' '
                     AND bmeasite <> 'ALL'
                     AND bmea007 = '2'
                     AND bmea008 = g_bmea_d_t.bmea008
                  IF SQLCA.sqlcode THEN
                     CALL cl_err("upd bmea_t",SQLCA.sqlcode,0)
                     CALL s_transaction_end('N','0')
                  ELSE
                     CALL s_transaction_end('Y','0')
                  END IF
               END IF
               IF g_bmea_d[l_ac].bmea014 = 'N' THEN
                  DELETE FROM bmeb_t
                   WHERE bmebent = g_enterprise 
                     AND bmeb001 = 'ALL'
                     AND bmeb002 = ' '
                     AND bmeb003 = g_bmea_m.bmea003
                     AND bmeb004 = ' '
                     AND bmeb005 = ' '
                     AND bmeb006 = ' '
                     AND bmebsite = g_site
                     AND bmeb007 = '2'
                     AND bmeb008 = g_bmea_d[l_ac].bmea008 
                     
                  IF SQLCA.sqlcode THEN
                     CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
                     CALL s_transaction_end('N','0')
                  ELSE
                     IF g_prog = 'abmm206' THEN
                        DELETE FROM bmeb_t
                         WHERE bmebent = g_enterprise 
                           AND bmeb001 = 'ALL'
                           AND bmeb002 = ' '
                           AND bmeb003 = g_bmea_m.bmea003
                           AND bmeb004 = ' '
                           AND bmeb005 = ' '
                           AND bmeb006 = ' '
                           AND bmebsite <> 'ALL'
                           AND bmeb007 = '2'
                           AND bmeb008 = g_bmea_d[l_ac].bmea008
                        IF SQLCA.sqlcode THEN
                           CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
                           CALL s_transaction_end('N','0')
                        END IF
                     END IF
                  END IF
               END IF
               IF g_bmea_d_t.bmea008 <> g_bmea_d[l_ac].bmea008 THEN
                  UPDATE bmeb_t SET bmeb008 = g_bmea_d[l_ac].bmea008
                   WHERE bmebent = g_enterprise
                     AND bmeb001 = 'ALL'
                     AND bmeb002 = ' '
                     AND bmeb003 = g_bmea_m.bmea003
                     AND bmeb004 = ' '
                     AND bmeb005 = ' '
                     AND bmeb006 = ' '
                     AND bmebsite = g_site
                     AND bmeb007 = '2'
                     AND bmeb008 = g_bmea_d_t.bmea008
                  IF g_prog = 'abmm206' THEN
                     UPDATE bmeb_t SET bmeb008 = g_bmea_d[l_ac].bmea008
                      WHERE bmebent = g_enterprise
                        AND bmeb001 = 'ALL'
                        AND bmeb002 = ' '
                        AND bmeb003 = g_bmea_m.bmea003
                        AND bmeb004 = ' '
                        AND bmeb005 = ' '
                        AND bmeb006 = ' '
                        AND bmebsite <> 'ALL'
                        AND bmeb007 = '2'
                        AND bmeb008 = g_bmea_d_t.bmea008
                  END IF
               END IF]]>
  </point>
  <point name="input.body.after_input" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.body.after_insert" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.body.before_input" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.body.before_insert" order="" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF g_prog = 'abmm206' THEN
               LET g_bmea_d[l_ac].bmea018 = '1'
            ELSE
               LET g_bmea_d[l_ac].bmea018 = '3'
            END IF
            LET g_bmea_d[l_ac].bmea009 = g_today
            CALL g_bmea2_d.clear()
#            CALL abmm206_b_fill_1()]]>
  </point>
  <point name="input.body.before_row" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_imaa006              LIKE imaa_t.imaa006
   DEFINE l_success              LIKE type_t.num5
   DEFINE l_rate                 LIKE type_t.num26_10
   DEFINE l_ac1_t                LIKE type_t.num5]]>
  </point>
  <point name="input.more_inputarray" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      INPUT ARRAY g_bmea2_d FROM s_detail2.*
          ATTRIBUTE(COUNT = g_rec_b1,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
         
         
         BEFORE INPUT
            IF g_bmea_d[l_ac].bmea014 != 'Y' THEN
               CALL cl_err('','abm-00091',0)
               NEXT FIELD bmea014
            END IF
            
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_bmea2_d.getLength()+1) 
              LET g_insert = 'N' 
            END IF 
            CALL abmm206_b_fill_1()
            LET g_rec_b1= g_bmea2_d.getLength()
         
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac1 = ARR_CURR()
            LET g_detail_idx = l_ac1
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac1 TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN abmm206_cl USING g_enterprise, g_site,'ALL',' ',g_bmea_m.bmea003,' ',' ',' ','2'
            IF STATUS THEN
               CALL cl_err("OPEN abmm206_cl:", STATUS, 1)
               CLOSE abmm206_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            
            LET g_rec_b1= g_bmea2_d.getLength()
            
            IF g_rec_b1>= l_ac1 AND NOT cl_null(g_bmea2_d[l_ac1].bmeb009) THEN
               LET l_cmd='u'
               LET g_bmea2_d_t.* = g_bmea2_d[l_ac1].*  #BACKUP
               CALL abmm206_set_entry_b(l_cmd)
               CALL abmm206_set_no_entry_b(l_cmd)
               OPEN abmm206_bcl2 USING g_enterprise,g_site,'ALL',' ',g_bmea_m.bmea003,' ',' ',' ','2',g_bmea_d[l_ac].bmea008,g_bmea2_d[l_ac1].bmeb009
               IF SQLCA.sqlcode THEN
                  CALL cl_err("abmm206_bcl2",SQLCA.sqlcode,1)
                  LET l_lock_sw='Y'
               ELSE
                  FETCH abmm206_bcl2 INTO g_bmea2_d[l_ac1].bmeb009,g_bmea2_d[l_ac1].bmeb009_desc
                  IF SQLCA.sqlcode THEN
                     CALL cl_err(g_bmea2_d_t.bmeb009,SQLCA.sqlcode,1)
                     LET l_lock_sw = "Y"
                  END IF
                  CALL abmm206_bmeb_desc()               				  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF 
            IF g_bmea_d[l_ac].bmea014 != 'Y' THEN
               CALL cl_err('','abm-00091',0)
               NEXT FIELD bmea014
            END IF
            
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_bmea2_d[l_ac1].* TO NULL
            LET g_bmea2_d_t.* = g_bmea2_d[l_ac1].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL abmm206_set_entry_b(l_cmd)
            CALL abmm206_set_no_entry_b(l_cmd)

         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF

            LET l_count = 1
            SELECT COUNT(*) INTO l_count FROM bmeb_t
             WHERE bmebent = g_enterprise 
               AND bmeb001 = 'ALL'
               AND bmeb002 = ' '
               AND bmeb003 = g_bmea_m.bmea003
               AND bmeb004 = ' '
               AND bmeb005 = ' '
               AND bmeb006 = ' '
               AND bmebsite = g_site
               AND bmeb007 = '2'
               AND bmeb008 = g_bmea_d[l_ac].bmea008 
               AND bmeb009 = g_bmea2_d[l_ac1].bmeb009 
               
            IF l_count = 0 THEN
               INSERT INTO bmeb_t
                  (bmebent,bmebsite,
                   bmeb001,bmeb002,bmeb003,bmeb004,bmeb005,bmeb006,
                   bmeb007,bmeb008,bmeb009)
            VALUES(g_enterprise, g_site,
                   'ALL',' ',g_bmea_m.bmea003,' ',' ',' ','2',
                   g_bmea_d[l_ac].bmea008,g_bmea2_d[l_ac1].bmeb009)
               IF SQLCA.sqlcode THEN
                  CALL cl_err("bmeb_t",SQLCA.sqlcode,0)
               END IF
            ELSE    
               CALL cl_err('INSERT',"std-00006",1)
               INITIALIZE g_bmea2_d[l_ac1].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               CALL cl_err("bmeb_t",SQLCA.sqlcode,1)  
               CALL s_transaction_end('N','0')                    
               CANCEL INSERT
            ELSE
               IF g_prog = 'abmm206' THEN
                  IF NOT abmm206_ins_bmeb() THEN
                     CALL s_transaction_end('N','0')
                     CANCEL INSERT
                  END IF
               END IF
               CALL s_transaction_end('Y','0')
               ERROR 'INSERT O.K'
               LET g_rec_b1 = g_rec_b1 + 1
            END IF           
            
            
      BEFORE DELETE  
         IF NOT cl_null(g_bmea2_d[l_ac1].bmeb009) THEN
            IF NOT cl_ask_del_detail() THEN
               CANCEL DELETE
            END IF
            IF l_lock_sw = "Y" THEN
               CALL cl_err("", -263, 1)
               CANCEL DELETE
            END IF

            DELETE FROM bmeb_t
             WHERE bmebent = g_enterprise 
               AND bmeb001 = 'ALL'
               AND bmeb002 = ' '
               AND bmeb003 = g_bmea_m.bmea003
               AND bmeb004 = ' '
               AND bmeb005 = ' '
               AND bmeb006 = ' '
               AND bmebsite = g_site
               AND bmeb007 = '2'
               AND bmeb008 = g_bmea_d[l_ac].bmea008 
               AND bmeb009 = g_bmea2_d_t.bmeb009
               
            IF SQLCA.sqlcode THEN
               CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
               CALL s_transaction_end('N','0')
               CANCEL DELETE   
            ELSE
               IF g_prog = 'abmm206' THEN
                  DELETE FROM bmeb_t
                   WHERE bmebent = g_enterprise 
                     AND bmeb001 = 'ALL'
                     AND bmeb002 = ' '
                     AND bmeb003 = g_bmea_m.bmea003
                     AND bmeb004 = ' '
                     AND bmeb005 = ' '
                     AND bmeb006 = ' '
                     AND bmebsite <> 'ALL'
                     AND bmeb007 = '2'
                     AND bmeb008 = g_bmea_d[l_ac].bmea008 
                     AND bmeb009 = g_bmea2_d_t.bmeb009
                  IF SQLCA.sqlcode THEN
                     CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
                     CALL s_transaction_end('N','0')
                     CANCEL DELETE   
                  END IF
               END IF
               LET g_rec_b1 = g_rec_b1-1
               CALL s_transaction_end('Y','0')
            END IF 
            CLOSE abmm206_bcl2
            LET l_count = g_bmea2_d.getLength()
         END IF 
            
              
      AFTER DELETE
         
      AFTER FIELD bmeb009
        CALL abmm206_bmeb_desc()
        IF NOT cl_null(g_bmea2_d[l_ac1].bmeb009) THEN
           IF l_cmd = 'a' OR ( l_cmd = 'u' AND ( l_cmd = 'u' AND (g_bmea2_d[l_ac1].bmeb009 != g_bmea2_d_t.bmeb009))) THEN 
              IF NOT ap_chk_notDup(g_bmea2_d[l_ac1].bmeb009,"SELECT COUNT(*) FROM bmeb_t WHERE bmebent = '" ||g_enterprise|| "' AND bmeb001 = 'ALL' AND "|| "bmeb002 = ' ' AND bmeb003 = '"||g_bmea_m.bmea003 ||"' AND bmeb004 = ' ' AND bmeb005 = ' ' AND bmeb006 = ' ' AND bmeb007 = '2' AND bmeb008 = '"||g_bmea_d[l_ac].bmea008 ||"' AND bmeb009 = '"||g_bmea2_d[l_ac1].bmeb009 ||"'",'std-00004',0) THEN
                 LET g_bmea2_d[l_ac1].bmeb009 = g_bmea2_d_t.bmeb009
                 CALL abmm206_bmeb_desc()               
                 NEXT FIELD bmeb009
              END IF
           END IF
           #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
           INITIALIZE g_chkparam.* TO NULL
           
           #設定g_chkparam.*的參數
           LET g_chkparam.arg1 = g_bmea2_d[l_ac1].bmeb009
           
           #呼叫檢查存在並帶值的library
           IF NOT cl_chk_exist("v_pmaa001_3") THEN
              LET g_bmea2_d[l_ac1].bmeb009 = g_bmea2_d_t.bmeb009
              CALL abmm206_bmeb_desc()               
              NEXT FIELD bmeb009
           END IF
        END IF   
     
      ON ACTION controlp INFIELD bmeb009
         INITIALIZE g_qryparam.* TO NULL
         LET g_qryparam.state = "i"
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = g_bmea2_d[l_ac1].bmeb009
         #給予arg
         LET g_qryparam.arg1 = "('2','3')" #
         CALL q_pmaa001_1()                         #呼叫開窗
         LET g_bmea2_d[l_ac1].bmeb009 = g_qryparam.return1  
         DISPLAY g_bmea2_d[l_ac1].bmeb009 TO bmeb009#顯示到畫面上
         CALL abmm206_bmeb_desc()
         NEXT FIELD bmeb009         
      
         ON ROW CHANGE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               LET g_bmea2_d[l_ac1].* = g_bmea2_d_t.*
               CLOSE abmm206_bcl2
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               CALL cl_err(g_bmea_d[l_ac].bmea008,-263,1)
               LET g_bmea2_d[l_ac1].* = g_bmea2_d_t.*
            ELSE 
              UPDATE bmeb_t SET bmeb009 = g_bmea2_d[l_ac1].bmeb009
               WHERE bmebent = g_enterprise 
                 AND bmeb001 = 'ALL'
                 AND bmeb002 = ' '
                 AND bmeb003 = g_bmea_m.bmea003
                 AND bmeb004 = ' '
                 AND bmeb005 = ' '
                 AND bmeb006 = ' '
                 AND bmebsite = g_site
                 AND bmeb007 = '2'
                 AND bmeb008 = g_bmea_d[l_ac].bmea008 
                 AND bmeb009 = g_bmea2_d_t.bmeb009
               IF SQLCA.sqlcode THEN
                  CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
                  LET g_bmea2_d[l_ac1].* = g_bmea2_d_t.*
                  CALL s_transaction_end('N','0')
               ELSE
                  IF g_prog = 'abmm206' THEN
                     UPDATE bmeb_t SET bmeb009 = g_bmea2_d[l_ac1].bmeb009
                      WHERE bmebent = g_enterprise 
                        AND bmeb001 = 'ALL'
                        AND bmeb002 = ' '
                        AND bmeb003 = g_bmea_m.bmea003
                        AND bmeb004 = ' '
                        AND bmeb005 = ' '
                        AND bmeb006 = ' '
                        AND bmebsite <> 'ALL'
                        AND bmeb007 = '2'
                        AND bmeb008 = g_bmea_d[l_ac].bmea008
                        AND bmeb009 = g_bmea2_d_t.bmeb009
                      IF SQLCA.sqlcode THEN
                         CALL cl_err("bmeb_t",SQLCA.sqlcode,1)
                         LET g_bmea2_d[l_ac1].* = g_bmea2_d_t.*
                         CALL s_transaction_end('N','0')
                      END IF
                  END IF
                 CALL s_transaction_end('Y','0')
               END IF 
            END IF
               
         AFTER ROW
            LET l_ac1 = ARR_CURR()
            LET l_ac1_t = l_ac1
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_bmea2_d[l_ac1].* = g_bmea2_d_t.*
               END IF
               CLOSE abmm206_bcl2
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF

            CLOSE abmm206_bcl2
            CALL s_transaction_end('Y','0')
            
              
         AFTER INPUT 
              
      END INPUT    ]]>
  </point>
  <point name="insert.default" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      LET g_bmea_m.bmea001 = 'ALL'
      LET g_bmea_m.bmea002 = ' '
      LET g_bmea_m.bmea004 = ' '
      LET g_bmea_m.bmea005 = ' '
      LET g_bmea_m.bmea006 = ' '
      LET g_bmea_m.bmea007 = '2']]>
  </point>
  <point name="insert.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL g_bmea2_d.clear() ]]>
  </point>
  <point name="main.init" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF NOT cl_null(g_argv[1]) THEN
      LET g_site = g_argv[1]
   END IF]]>
  </point>
  <point name="ref_show.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="ref_show.head.reference" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL abmm206_b_fill_1()]]>
  </point>
  <point name="reproduce.head.b_input" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_bmea_m.bmea001 = 'ALL'
   LET g_bmea_m.bmea002 = ' '
   LET g_bmea_m.bmea004 = ' '
   LET g_bmea_m.bmea005 = ' '
   LET g_bmea_m.bmea006 = ' '
   LET g_bmea_m.bmea007 = '2' ]]>
  </point>
  <point name="set_entry_b.set_entry_b" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL cl_set_comp_entry("bmea017",TRUE)]]>
  </point>
  <point name="set_no_entry_b.set_no_entry_b段" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_bmea_d[l_ac].bmea016 = '2' THEN
      LET g_bmea_d[l_ac].bmea017 = 100
      DISPLAY BY NAME g_bmea_d[l_ac].bmea017
      CALL cl_set_comp_entry("bmea017",FALSE)
   END IF]]>
  </point>
  <point name="show.after" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL abmm206_desc()
   CALL abmm206_b_fill_1()]]>
  </point>
  <point name="ui_detailshow.after" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail2",g_detail_idx) 
   END IF
   DISPLAY g_bmea_d.getLength() TO FORMONLY.cnt]]>
  </point>
  <point name="ui_dialog.body.before_row" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[               DISPLAY g_bmea_d.getLength() TO FORMONLY.cnt
               CALL abmm206_b_fill_1()
               DISPLAY ARRAY g_bmea2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b1)  
                  BEFORE DISPLAY
                       EXIT DISPLAY
    
               END DISPLAY]]>
  </point>
  <point name="ui_dialog.more_displayarray" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         DISPLAY ARRAY g_bmea2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b1)  
         
            BEFORE ROW
               LET g_detail_idx = DIALOG.getCurrentRow("s_detail2")
               LET l_ac1 = g_detail_idx
               DISPLAY g_detail_idx TO FORMONLY.idx
               CALL abmm206_ui_detailshow()
               DISPLAY g_bmea2_d.getLength() TO FORMONLY.cnt

            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac1 = DIALOG.getCurrentRow("s_detail2")
        
         END DISPLAY]]>
  </point>
  <point name="ui_dialog.page1.action" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            ]]>
  </point>
</add_points>
