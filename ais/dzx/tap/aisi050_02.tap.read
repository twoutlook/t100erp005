<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="aisi050_02" std_prog="aisi050_02" erpver="1.0" module="AIS" ver="2" env="s" zone="t10dev" booking="N" type="S" identity="s">
  <other>
    <code_template value="F" status=""/>
    <free_style value="N" status=""/>
  </other>
  <point name="function.aisi050_02_set_combo_scc" order="1" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 年月下拉
# Memo...........:
# Usage..........: CALL aisi050_02_set_combo_scc(p_field,p_scc)
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aisi050_02_set_combo_scc(p_field,p_scc)
  DEFINE p_field        LIKE type_t.chr80
  DEFINE p_scc          LIKE type_t.num5
  DEFINE l_gzcb002      LIKE gzcb_t.gzcb002
  DEFINE l_gzcbl004     LIKE gzcbl_t.gzcbl004
  DEFINE comb_value     STRING
  DEFINE comb_item      STRING
  DEFINE l_str          STRING 

    DECLARE gzcb_cs CURSOR FOR
     SELECT gzcb002,gzcbl004 FROM gzcb_t LEFT OUTER join gzcbl_t ON gzcbl001 = gzcb001
                                                                AND gzcbl002 = gzcb002
                                                                AND gzcbl003 = g_dlang
      WHERE gzcb001 = p_scc
    FOREACH gzcb_cs INTO l_gzcb002,l_gzcbl004
        LET l_str = l_gzcb002
        LET l_str = l_str.substring(1,1)
        IF l_str = '0' THEN 
           LET l_str = l_gzcb002
           LET l_gzcb002 = l_str.substring(2,2)
        END IF 
        LET comb_value = comb_value CLIPPED,',',l_gzcb002
        LET comb_item  = comb_item  CLIPPED,',',l_gzcb002
        
    END FOREACH
    CALL cl_set_combo_items(p_field,comb_value,comb_item)
END FUNCTION]]>
  </point>
  <point name="function.aisi050_02_isaecomp_ref" order="2" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 使用者所屬法人
# Memo...........:
# Usage..........: CALL aisi050_02_isaecomp_ref()
# Date & Author..: 日期 By 作者
################################################################################
PRIVATE FUNCTION aisi050_02_isaecomp_ref()
   DEFINE l_success  BOOLEAN
   DEFINE l_lsaeld   LIKE glaa_t.glaald 
   DEFINE l_isaecomp LIKE isae_t.isaecomp
   DEFINE l_errno    LIKE type_t.num5
   CALL s_fin_ld_carry('',g_user) RETURNING l_success,l_lsaeld,l_isaecomp,l_errno
   
   RETURN l_isaecomp
END FUNCTION]]>
  </point>
  <point name="function.aisi050_02_isae004_ref" order="3" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 發票類型說明
# Memo...........:
# Usage..........: aisi050_02_isae004_ref()
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aisi050_02_isae004_ref()

DEFINE l_ooef019   LIKE ooef_t.ooef019 #所屬稅區

   LET l_ooef019 = ''
   SELECT DISTINCT ooef019 INTO l_ooef019 
     FROM ooef_t
    WHERE ooef017 = g_isae_m.isaecomp
      AND ooefent = g_enterprise
      AND ooef001 = g_isae_m.isaesite
      
  
  SELECT DISTINCT isacl004 INTO g_isae_m.isae004_desc
     FROM isac_t 
     LEFT OUTER JOIN isacl_t 
       ON isacent = isaclent 
      AND isac001 = isacl001 
      AND isac002 = isacl002 
      AND isacl003 = g_dlang
    WHERE isacent = g_enterprise
      AND isac001 = l_ooef019
      AND isac002 = g_isae_m.isae004
    ORDER BY isac002
      
      DISPLAY g_isae_m.isae004_desc TO isae004_desc

END FUNCTION]]>
  </point>
  <point name="function.aisi050_02_b_fill" order="4" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 單身填充
# Memo...........:
# Usage..........: aisi050_02_b_fill()
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aisi050_02_b_fill()
   
   
   LET g_sql = "SELECT  isae001,isae002,isae003,isae005,isae006, ",
               "        isae007,isae008,isae009,isae010,isae011 ",       
               "  FROM isae_t",   
               " WHERE isaesite = '",g_isae_m.isaesite,"' ", #使用者所屬營運據點  
               " AND isae001 =  '",g_isae_m.isae001,"' "                          
   PREPARE aisi050_sel FROM g_sql
   DECLARE b_fill_curs CURSOR FOR aisi050_sel
   
   FOREACH b_fill_curs INTO 
   g_isae_d[l_ac].isae001     ,g_isae_d[l_ac].isae002 , g_isae_d[l_ac].isae003 , g_isae_d[l_ac].isae005 ,
   g_isae_d[l_ac].isae006     ,g_isae_d[l_ac].isae007 , g_isae_d[l_ac].isae008 , g_isae_d[l_ac].isae009  , 
   g_isae_d[l_ac].isae010     ,g_isae_d[l_ac].isae011    
   LET l_ac = l_ac+1  
   
   END FOREACH
   CALL g_isae_d.deleteElement(g_isae_d.getLength())
END FUNCTION]]>
  </point>
  <point name="global.inc" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="global.variable" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[DEFINE g_type LIKE type_t.num5
DEFINE g_sql           STRING
DEFINE l_ac            LIKE type_t.num5 
DEFINE l_i             LIKE type_t.num5 #終止條件
DEFINE l_flag          LIKE type_t.num5
DEFINE g_isae_d DYNAMIC ARRAY OF RECORD      
   isae001 LIKE isae_t.isae001, 
   isae002 LIKE isae_t.isae002, 
   isae003 LIKE isae_t.isae003, 
   isae005 LIKE isae_t.isae005, 
   isae006 LIKE isae_t.isae006,
   isae007 LIKE isae_t.isae007,    
   isae008 LIKE isae_t.isae008, 
   isae009 LIKE isae_t.isae009, 
   isae010 LIKE isae_t.isae010, 
   isae011 LIKE isae_t.isae011 
       END RECORD
]]>
  </point>
  <point name="input.a.isae001" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
       
           
            SELECT isae004,isae009,isae010,isae011,isaecomp 
              INTO g_isae_m.isae004,g_isae_m.isae009,g_isae_m.isae010,g_isae_m.isae011,g_isae_m.isaecomp
              FROM isae_t
             WHERE isaesite = g_isae_m.isaesite
               AND isae001 = g_isae_m.isae001               
            CALL aisi050_02_isae004_ref()
            DISPLAY g_isae_m.isae004 TO isae004
            DISPLAY g_isae_m.isae009 TO isae009
            DISPLAY g_isae_m.isae010 TO isae010
            DISPLAY g_isae_m.isae011 TO isae011
           ]]>
  </point>
  <point name="input.a.isae002" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.a.isae003" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="input.a.isae011" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[ ]]>
  </point>
  <point name="input.a.isae018" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[        ]]>
  </point>
  <point name="input.a.isaecomp" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[       ]]>
  </point>
  <point name="input.a.isaesite" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[
           IF NOT cl_null(g_isae_m.isaesite) THEN
               IF p_cmd = 'a'  THEN
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_chkparam.arg1 = g_isae_m.isaesite
                  IF NOT cl_chk_exist("v_ooef001") THEN                  
                     LET g_isae_m.isaesite = ''
                     CALL s_desc_get_department_desc(g_isae_m.isaesite) RETURNING g_isae_m.isaesite_desc
                     DISPLAY g_isae_m.isaesite_desc TO isaesite_desc                 
                     NEXT FIELD isaesite
                  END IF
               END IF
            END IF]]>
  </point>
  <point name="input.a.num" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            LET l_num_str = g_isae_m.num
            IF (l_num_str MATCHES '[A-Z]' ) OR (l_num_str MATCHES '[a-z]' ) THEN
               CALL cl_err("","adz-00147",0)
               NEXT FIELD num               
            END IF ]]>
  </point>
  <point name="input.a.sheet" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            
            
            IF g_isae_m.sheet > g_isae_m.isae011 THEN #大於張數
               CALL cl_err("","ais-00141",0)
               NEXT FIELD sheet
            END IF
           
            LET l_mod = g_isae_m.isae011 mod g_isae_m.sheet     #餘數                 
            IF l_mod != 0 THEN     
               IF NOT cl_ask_confirm('ais-00142') THEN
                  LET l_flag = 2
                  NEXT FIELD sheet
               ELSE 
                  LET l_flag = 1
               END IF
            END IF]]>
  </point>
  <point name="input.action" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[        ]]>
  </point>
  <point name="input.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[           ]]>
  </point>
  <point name="input.before_close" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[  
   IF NOT INT_FLAG THEN
      LET l_osae001_1  = g_isae_m.isae001
      LET l_i = 1
      LET l_j = 1
      LET l_ac = 1
      LET l_isae011 = g_isae_m.isae011       #發票張數     
      LET l_sheet   = g_isae_m.sheet         #切分張數
      LET l_isae009 = g_isae_m.isae009       #起始號碼
      LET l_mod = l_isae011 mod l_sheet      #餘數           
      LET l_pc =  l_isae011/l_sheet          #切分次數
      IF l_mod != 0 THEN 
         LET l_pc = l_pc +1
      END IF
      LET l_isae001 = g_isae_m.num      #簿號 流水號
      LET l_isae010_1 = g_isae_m.isae010  
                           
      SELECT isae002         , isae003        ,isae005  ,isae006  ,isae007  , isae008,
             isae016,isae017,isae018
        INTO g_isae_m.isae002,g_isae_m.isae003,l_isae005,l_isae006,l_isae007,l_isae008,
             g_isae_m.isae016,g_isae_m.isae017,g_isae_m.isae018
        FROM isae_t
       WHERE isaeent  = g_enterprise
         AND isaesite = g_isae_m.isaesite
         AND isae001  = g_isae_m.isae001
         
      LET l_num_str = ''
      LET l_format = ''      
      LET g_isae_m.isae001 = g_isae_m.num    #簿號   
      LET l_num_str = g_isae_m.num 
      FOR l_j = 1 TO l_num_str.getLength()
         LET l_format = l_format,'&'
      END FOR
      
      LET l_isae009_str = ''
      LET l_format1 = ''
      LET l_isae009_str = g_isae_m.isae009    #起始號碼    
      FOR l_j = 1 TO l_isae009_str.getLength()
         LET l_format1 = l_format1,'&'
      END FOR
      
      IF l_flag = 1 THEN
         CALL s_transaction_end('Y','0')   
         WHILE TRUE
            IF l_i > l_pc THEN 
               EXIT WHILE
            END IF
            
            IF cl_null(l_isae007) THEN 
               LET l_isae007 = ' ' 
            END IF
                 
            LET g_isae_m.isae001  = l_isae001  USING l_format  #簿號
            LET g_isae_m.isae001  = g_isae_m.chr,g_isae_m.isae001
            LET l_isae001 =l_isae001 +1
                          
            IF l_i != 1 THEN # 起始號碼
               LET l_isae009 = l_isae009 + g_isae_m.sheet
               LET g_isae_m.isae009 = l_isae009 USING l_format1 
            END IF
            
            IF l_i != l_pc THEN         
               LET l_isae010 = l_isae009 + g_isae_m.sheet-1 # 結束號碼
               LET g_isae_m.isae010 = l_isae010 USING l_format1
            ELSE       
               LET g_isae_m.isae010 = l_isae010_1          
            END IF          
            LET l_isae011 = g_isae_m.isae010 - g_isae_m.isae009 +1  #發票張數
           
            INSERT INTO isae_t(isaeent,isaecomp,isaesite,isae001,isae002,
                               isae003, isae004, isae005,isae006,isae007,
                               isae008, isae009, isae010,isae011,isae012, 
                               isae013, isae015,isae016,isae017,
                               isae018, isaestus)
            VALUES (g_enterprise, g_isae_m.isaecomp,g_isae_m.isaesite,g_isae_m.isae001,g_isae_m.isae002,
                    g_isae_m.isae003,g_isae_m.isae004,l_isae005,l_isae006,l_isae007,
                    l_isae008,g_isae_m.isae009,g_isae_m.isae010,l_isae011,g_isae_m.isae009 ,
                    '0','N',g_isae_m.isae016,g_isae_m.isae017,g_isae_m.isae018,'Y')
            CALL aisi050_02_b_fill()
                       
            IF SQLCA.sqlcode THEN
               CALL cl_err('',SQLCA.sqlcode,0)
               CALL s_transaction_end('N','0')
            END IF                   
            LET l_i = l_i+1      
         END WHILE
         LET l_flag = 2         
         DELETE FROM isae_t 
           WHERE isaesite = g_isae_m.isaesite
             AND isae001  = l_osae001_1 
             AND isae002  = g_isae_m.isae002 
             AND isae003  = g_isae_m.isae003              
           IF SQLCA.sqlcode THEN
              CALL cl_err('',SQLCA.sqlcode,0)
              CALL s_transaction_end('N','0')
           END IF                                
         CALL s_transaction_end('Y','0')
                  
         
         DISPLAY ARRAY g_isae_d TO s_detail1.* 
            ON ACTION query
               CLEAR FORM
               LET l_flag =1
               CALL g_isae_d.clear() 
               INITIALIZE g_isae_m.* TO NULL 
            EXIT DISPLAY               
         END DISPLAY 
                   
      END IF      
   END IF  
   IF INT_FLAG THEN
      LET INT_FLAG = FALSE
      EXIT WHILE
   END IF
END WHILE   

   ]]>
  </point>
  <point name="input.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CLEAR FORM]]>
  </point>
  <point name="input.c.isae001" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            
            IF g_type = 1 THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'i'
		         LET g_qryparam.reqry = FALSE
               LET g_qryparam.default1 = g_isae_m.isae001                  #給予default值          
               LET g_qryparam.where =" isaecomp = '",g_isae_m.isaecomp,"' AND isaesite = '",g_isae_m.isaesite,"' " 
               CALL q_isae001()                                            #呼叫開窗
               LET g_isae_m.isae001 = g_qryparam.return1                   #將開窗取得的值回傳到變數
               SELECT isae004,isae009,isae010,isae011,isaecomp 
                 INTO g_isae_m.isae004,g_isae_m.isae009,g_isae_m.isae010,g_isae_m.isae011,g_isae_m.isaecomp
                 FROM isae_t
                WHERE isaesite = g_isae_m.isaesite
                  AND isae001 = g_isae_m.isae001               
               CALL aisi050_02_isae004_ref()
               DISPLAY g_isae_m.isae004 TO isae004
               DISPLAY g_isae_m.isae009 TO isae009
               DISPLAY g_isae_m.isae010 TO isae010
               DISPLAY g_isae_m.isae011 TO isae011                              
               DISPLAY g_isae_m.isae001 TO isae001                          #顯示到畫面上           
               NEXT FIELD isae001
            ELSE
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'i'
		         LET g_qryparam.reqry = FALSE
               LET g_qryparam.default1 = g_isae_m.isae001                  #給予default值          
               LET g_qryparam.where =" isaecomp = '",g_isae_m.isaecomp,"' AND isaesite = '",g_isae_m.isaesite,"' ",
                                     " AND isae016 = '",g_isae_m.isae016,"' ",
                                     " AND isae017 BETWEEN  '",g_isae_m.isae017,"' AND '",g_isae_m.isae018,"' "                                    
               CALL q_isae001()                                            #呼叫開窗
               LET g_isae_m.isae001 = g_qryparam.return1                   #將開窗取得的值回傳到變數
                SELECT isae009,isae010,isae011 INTO g_isae_m.isae009,g_isae_m.isae010,g_isae_m.isae011
                  FROM isae_t
                 WHERE isaesite = g_isae_m.isaesite
                   AND isae001 =  g_isae_m.isae001
                   AND isae016 =  g_isae_m.isae016
                   AND isae017 =  g_isae_m.isae017
                   AND isae018 =  g_isae_m.isae018
               CALL aisi050_02_isae004_ref()
               DISPLAY g_isae_m.isae004 TO isae004
               DISPLAY g_isae_m.isae009 TO isae009
               DISPLAY g_isae_m.isae010 TO isae010
               DISPLAY g_isae_m.isae011 TO isae011
               DISPLAY g_isae_m.isae001 TO isae001                          #顯示到畫面上           
               NEXT FIELD isae001
            END IF
             ]]>
  </point>
  <point name="input.c.isae018" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[          ]]>
  </point>
  <point name="input.c.isaesite" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[             CALL aisi050_02_isaecomp_ref() RETURNING g_isae_m.isaecomp
                                        
             INITIALIZE g_qryparam.* TO NULL
             LET g_qryparam.state = 'i'
		       LET g_qryparam.reqry = FALSE
             LET g_qryparam.default1 = g_isae_m.isaesite                  #給予default值          
             LET g_qryparam.where =" isaecomp = '",g_isae_m.isaecomp,"' " 
             CALL q_isaesite()                                            #呼叫開窗
             LET g_isae_m.isaesite = g_qryparam.return1                   #將開窗取得的值回傳到變數
             DISPLAY g_isae_m.isaesite TO isaesite                        #顯示到畫面上
             CALL s_desc_get_department_desc(g_isae_m.isaesite) RETURNING g_isae_m.isaesite_desc
             DISPLAY g_isae_m.isaesite_desc TO isaesite_desc
             NEXT FIELD isaesite
  ]]>
  </point>
  <point name="input.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[  
   DEFINE p_type          LIKE type_t.num5
   DEFINE l_pc            LIKE type_t.num5 #切分次數
 
   DEFINE l_j             LIKE type_t.num5 #計算字串長度
   DEFINE l_isae001       LIKE type_t.num5 
   DEFINE l_isae005       LIKE isae_t.isae005 #電子發票否
   DEFINE l_isae006       LIKE isae_t.isae006
   DEFINE l_isae007       LIKE isae_t.isae007
   DEFINE l_isae008       LIKE isae_t.isae008
   DEFINE l_isae009       LIKE type_t.num5 #起始號碼
   DEFINE l_isae010       LIKE type_t.num5 #結束號碼
   DEFINE l_isae010_1     LIKE type_t.chr80#最後一筆結束號碼
   DEFINE l_isae011       LIKE type_t.num5 #發票張數
   DEFINE l_num           LIKE type_t.num5 #起始號碼
   DEFINE l_sheet         LIKE type_t.num5  
   DEFINE l_mod           LIKE type_t.num5 #餘數
   DEFINE l_num_str       STRING
   DEFINE l_isae009_str   STRING 
   DEFINE l_format        STRING
   DEFINE l_format1       STRING
   DEFINE l_osae001_1     LIKE isae_t.isae001 #原本簿號 刪除用
   ]]>
  </point>
  <point name="input.get_var" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   p_type ]]>
  </point>
  <point name="input.more_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      ON ACTION query
         CLEAR FORM
         LET l_flag =1
         CALL g_isae_d.clear()
         INITIALIZE g_isae_m.* TO NULL              ]]>
  </point>
  <point name="input.pre_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[    LET g_type = p_type
    LET  l_flag = 1    
    CALL aisi050_02_set_combo_scc('isae016','43')
    CALL aisi050_02_set_combo_scc('isae017','39')
    CALL aisi050_02_set_combo_scc('isae018','39')
    CALL cl_set_combo_scc('b_isae006','9713') 
    IF g_type = 1 THEN
       LET g_isae_m.isae016 = 2014
       LET g_isae_m.isae017 = 11
       LET g_isae_m.isae018 = 11           
       CALL cl_set_comp_visible('isae016',FALSE)
       CALL cl_set_comp_visible('isae017',FALSE) 
       CALL cl_set_comp_visible('isae018',FALSE)
       CALL cl_set_comp_visible('b_isae007',FALSE)
    ELSE
       CALL cl_set_comp_visible('b_isae002',FALSE)
       CALL cl_set_comp_visible('b_isae003',FALSE)
       CALL cl_set_comp_visible('b_isae008',FALSE)         
    END IF
    
   WHILE TRUE
 ]]>
  </point>
  <point name="show.head.reference" order="" ver="1" cite_std="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_isae_m.isaesite
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_isae_m.isaesite_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_isae_m.isaesite_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_isae_m.isae018
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_isae_m.isae018_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_isae_m.isae018_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_isae_m.isae001
            LET g_ref_fields[2] = g_isae_m.isae004
            CALL ap_ref_array2(g_ref_fields,"SELECT isacl004 FROM isacl_t WHERE isaclent='"||g_enterprise||"' AND isacl001=? AND isacl002=? AND isacl003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_isae_m.isae004_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_isae_m.isae004_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_isae_m.isaecomp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_isae_m.isaecomp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_isae_m.isaecomp_desc
]]>
  </point>
  <section id="aisi050_02.description" ver="1" status="" src="s">
    <![CDATA[#+ Version..: T100-ERP-1.00.00(SD版次:2,PR版次:2) Build-000246
#+ 
#+ Filename...: aisi050_02
#+ Description: ...
#+ Creator....: 05016(2014/06/20)
#+ Modifier...: 05016(2014/07/07)
#+ Buildtype..: 應用 c01b 樣板自動產生
#+ 以上段落由子樣板a00產生
]]>
  </section>
  <section id="aisi050_02.global" ver="1" status="" src="s">
    <![CDATA[{<point name="global.memo" />}
 
IMPORT os
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔
{<point name="global.inc" />}
#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_isae_m        RECORD
       isaesite LIKE isae_t.isaesite, 
   isaesite_desc LIKE type_t.chr80, 
   isae016 LIKE isae_t.isae016, 
   isae017 LIKE isae_t.isae017, 
   isae018 LIKE isae_t.isae018, 
   isae001 LIKE isae_t.isae001, 
   isae004 LIKE isae_t.isae004, 
   isae004_desc LIKE type_t.chr80, 
   isae009 LIKE isae_t.isae009, 
   isae010 LIKE isae_t.isae010, 
   isae011 LIKE isae_t.isae011, 
   chr LIKE type_t.chr80, 
   num LIKE type_t.chr80, 
   sheet LIKE type_t.chr80, 
   isae002 LIKE isae_t.isae002, 
   isae003 LIKE isae_t.isae003, 
   isae018_desc LIKE type_t.chr80, 
   isaecomp LIKE isae_t.isaecomp, 
   isaecomp_desc LIKE type_t.chr80
       END RECORD
DEFINE g_isae_m        type_g_isae_m
 
   DEFINE g_isaesite_t LIKE isae_t.isaesite
DEFINE g_isae001_t LIKE isae_t.isae001
DEFINE g_isae004_t LIKE isae_t.isae004
DEFINE g_isae002_t LIKE isae_t.isae002
DEFINE g_isae003_t LIKE isae_t.isae003
DEFINE g_isaecomp_t LIKE isae_t.isaecomp
 
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable"/>}
#end add-point
 
#add-point:傳入參數說明(global.argv)
{<point name="global.argv"/>}
#end add-point
]]>
  </section>
  <section id="aisi050_02.input" ver="2" status="" src="s">
    <![CDATA[#+ 資料輸入
PUBLIC FUNCTION aisi050_02(--)
   #add-point:input段變數傳入
   {<point name="input.get_var"/>}
   #end add-point
   )
   DEFINE l_ac_t          LIKE type_t.num5        #未取消的ARRAY CNT 
   DEFINE l_allow_insert  LIKE type_t.num5        #可新增否 
   DEFINE l_allow_delete  LIKE type_t.num5        #可刪除否  
   DEFINE l_count         LIKE type_t.num5
   DEFINE l_insert        LIKE type_t.num5
   DEFINE p_cmd           LIKE type_t.chr5
   #add-point:input段define
   {<point name="input.define"/>}
   #end add-point
 
   #畫面開啟 (identifier)
   OPEN WINDOW w_aisi050_02 WITH FORM cl_ap_formpath("ais","aisi050_02")
 
   #瀏覽頁簽資料初始化
   CALL cl_ui_init()
   
   LET g_qryparam.state = "i"
   LET p_cmd = 'a'
   
   #輸入前處理
   #add-point:單頭前置處理
   {<point name="input.pre_input"/>}
   #end add-point
  
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
      #輸入開始
      INPUT BY NAME g_isae_m.isaesite,g_isae_m.isae016,g_isae_m.isae017,g_isae_m.isae018,g_isae_m.isae001, 
          g_isae_m.isae010,g_isae_m.isae011,g_isae_m.chr,g_isae_m.num,g_isae_m.sheet,g_isae_m.isae002, 
          g_isae_m.isae003,g_isae_m.isaecomp ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂ACTION
         #add-point:單頭前置處理
         {<point name="input.action"/>}
         #end add-point
         
         #自訂ACTION(master_input)
         
         
         BEFORE INPUT
            #add-point:單頭輸入前處理
            {<point name="input.before_input"/>}
            #end add-point
          
                  #此段落由子樣板a02產生
         AFTER FIELD isaesite
            
            #add-point:AFTER FIELD isaesite
            {<point name="input.a.isaesite" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD isaesite
            #add-point:BEFORE FIELD isaesite
            {<point name="input.b.isaesite" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE isaesite
            #add-point:ON CHANGE isaesite
            {<point name="input.g.isaesite" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae016
            #add-point:BEFORE FIELD isae016
            {<point name="input.b.isae016" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae016
            
            #add-point:AFTER FIELD isae016
            {<point name="input.a.isae016" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE isae016
            #add-point:ON CHANGE isae016
            {<point name="input.g.isae016" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae017
            #add-point:BEFORE FIELD isae017
            {<point name="input.b.isae017" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae017
            
            #add-point:AFTER FIELD isae017
            {<point name="input.a.isae017" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE isae017
            #add-point:ON CHANGE isae017
            {<point name="input.g.isae017" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae018
            
            #add-point:AFTER FIELD isae018
            {<point name="input.a.isae018" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae018
            #add-point:BEFORE FIELD isae018
            {<point name="input.b.isae018" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE isae018
            #add-point:ON CHANGE isae018
            {<point name="input.g.isae018" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae001
            #add-point:BEFORE FIELD isae001
            {<point name="input.b.isae001" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae001
            
            #add-point:AFTER FIELD isae001
            {<point name="input.a.isae001" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE isae001
            #add-point:ON CHANGE isae001
            {<point name="input.g.isae001" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae010
            #add-point:BEFORE FIELD isae010
            {<point name="input.b.isae010" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae010
            
            #add-point:AFTER FIELD isae010
            {<point name="input.a.isae010" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE isae010
            #add-point:ON CHANGE isae010
            {<point name="input.g.isae010" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae011
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_isae_m.isae011,"0.000","0","","","azz-00079",1) THEN
               NEXT FIELD isae011
            END IF
 
 
            #add-point:AFTER FIELD isae011
            {<point name="input.a.isae011" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae011
            #add-point:BEFORE FIELD isae011
            {<point name="input.b.isae011" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE isae011
            #add-point:ON CHANGE isae011
            {<point name="input.g.isae011" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD chr
            #add-point:BEFORE FIELD chr
            {<point name="input.b.chr" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD chr
            
            #add-point:AFTER FIELD chr
            {<point name="input.a.chr" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE chr
            #add-point:ON CHANGE chr
            {<point name="input.g.chr" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD num
            #add-point:BEFORE FIELD num
            {<point name="input.b.num" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD num
            
            #add-point:AFTER FIELD num
            {<point name="input.a.num" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE num
            #add-point:ON CHANGE num
            {<point name="input.g.num" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD sheet
            #add-point:BEFORE FIELD sheet
            {<point name="input.b.sheet" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD sheet
            
            #add-point:AFTER FIELD sheet
            {<point name="input.a.sheet" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE sheet
            #add-point:ON CHANGE sheet
            {<point name="input.g.sheet" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae002
            #add-point:BEFORE FIELD isae002
            {<point name="input.b.isae002" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae002
            
            #add-point:AFTER FIELD isae002
            {<point name="input.a.isae002" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE isae002
            #add-point:ON CHANGE isae002
            {<point name="input.g.isae002" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD isae003
            #add-point:BEFORE FIELD isae003
            {<point name="input.b.isae003" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isae003
            
            #add-point:AFTER FIELD isae003
            {<point name="input.a.isae003" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE isae003
            #add-point:ON CHANGE isae003
            {<point name="input.g.isae003" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD isaecomp
            
            #add-point:AFTER FIELD isaecomp
            {<point name="input.a.isaecomp" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD isaecomp
            #add-point:BEFORE FIELD isaecomp
            {<point name="input.b.isaecomp" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE isaecomp
            #add-point:ON CHANGE isaecomp
            {<point name="input.g.isaecomp" />}
            #END add-point
 
 #欄位檢查
                  #Ctrlp:input.c.isaesite
         ON ACTION controlp INFIELD isaesite
            #add-point:ON ACTION controlp INFIELD isaesite
            {<point name="input.c.isaesite" />}
            #END add-point
 
         #Ctrlp:input.c.isae016
         ON ACTION controlp INFIELD isae016
            #add-point:ON ACTION controlp INFIELD isae016
            {<point name="input.c.isae016" />}
            #END add-point
 
         #Ctrlp:input.c.isae017
         ON ACTION controlp INFIELD isae017
            #add-point:ON ACTION controlp INFIELD isae017
            {<point name="input.c.isae017" />}
            #END add-point
 
         #Ctrlp:input.c.isae018
         ON ACTION controlp INFIELD isae018
            #add-point:ON ACTION controlp INFIELD isae018
            {<point name="input.c.isae018" />}
            #END add-point
 
         #Ctrlp:input.c.isae001
         ON ACTION controlp INFIELD isae001
            #add-point:ON ACTION controlp INFIELD isae001
            {<point name="input.c.isae001" />}
            #END add-point
 
         #Ctrlp:input.c.isae010
         ON ACTION controlp INFIELD isae010
            #add-point:ON ACTION controlp INFIELD isae010
            {<point name="input.c.isae010" />}
            #END add-point
 
         #Ctrlp:input.c.isae011
         ON ACTION controlp INFIELD isae011
            #add-point:ON ACTION controlp INFIELD isae011
            {<point name="input.c.isae011" />}
            #END add-point
 
         #Ctrlp:input.c.chr
         ON ACTION controlp INFIELD chr
            #add-point:ON ACTION controlp INFIELD chr
            {<point name="input.c.chr" />}
            #END add-point
 
         #Ctrlp:input.c.num
         ON ACTION controlp INFIELD num
            #add-point:ON ACTION controlp INFIELD num
            {<point name="input.c.num" />}
            #END add-point
 
         #Ctrlp:input.c.sheet
         ON ACTION controlp INFIELD sheet
            #add-point:ON ACTION controlp INFIELD sheet
            {<point name="input.c.sheet" />}
            #END add-point
 
         #Ctrlp:input.c.isae002
         ON ACTION controlp INFIELD isae002
            #add-point:ON ACTION controlp INFIELD isae002
            {<point name="input.c.isae002" />}
            #END add-point
 
         #Ctrlp:input.c.isae003
         ON ACTION controlp INFIELD isae003
            #add-point:ON ACTION controlp INFIELD isae003
            {<point name="input.c.isae003" />}
            #END add-point
 
         #Ctrlp:input.c.isaecomp
         ON ACTION controlp INFIELD isaecomp
            #add-point:ON ACTION controlp INFIELD isaecomp
            {<point name="input.c.isaecomp" />}
            #END add-point
 
 #欄位開窗
 
         AFTER INPUT
            #add-point:單頭輸入後處理
            {<point name="input.after_input"/>}
            #end add-point
            
      END INPUT
    
      #add-point:自定義input
      {<point name="input.more_input"/>}
      #end add-point
    
      #公用action
      ON ACTION accept
         ACCEPT DIALOG
        
      ON ACTION cancel
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
 
   #add-point:畫面關閉前
   {<point name="input.before_close"/>}
   #end add-point
   
   #畫面關閉
   CLOSE WINDOW w_aisi050_02 
   
   #add-point:input段after input 
   {<point name="input.post_input"/>}
   #end add-point    
   
END FUNCTION
]]>
  </section>
  <section id="aisi050_02.other_dialog" ver="1" status="" src="s">
    <![CDATA[{<point name="other.dialog"/>}
]]>
  </section>
  <section id="aisi050_02.other_function" ver="1" status="" src="s">
    <![CDATA[{<point name="other.function"/>}
]]>
  </section>
</add_points>
