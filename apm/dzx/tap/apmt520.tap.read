<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="apmt520" std_prog="apmt520" erpver="1.0" module="APM" ver="12" env="s" zone="t10prd" booking="N" type="M" identity="s" section_flag="N" designer_ver="1.0">
  <other>
    <code_template value="F" status="u"/>
    <free_style value="N" status="u"/>
    <start_arg value="" status="u"/>
  </other>
  <point name="function.apmt520_pmds006_desc" order="1" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#採購收貨、採購收貨入庫時，根據採購單單號帶值
#驗退、入庫、倉退時，根據收貨單單號帶值
PRIVATE FUNCTION apmt520_pmds006_desc()
DEFINE l_pmdl005  LIKE pmdl_t.pmdl005
DEFINE l_pmdl006  LIKE pmdl_t.pmdl006

DEFINE l_cnt      LIKE type_t.num10  #150611 earl add

        #採購收貨、採購收貨入庫時，根據採購單單號帶值
        IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
           #將採購單頭上的採購供應商、帳款供應商、送貨供應商值預設到收貨單單頭的相關欄位上
           LET g_pmds_m.pmds007 = ''
           LET g_pmds_m.pmds008 = ''
           LET g_pmds_m.pmds009 = ''
           LET g_pmds_m.pmds052 = ''
           LET l_pmdl005 = ''
           LET l_pmdl006 = ''
           
           SELECT pmdl004,pmdl021,pmdl022,pmdl005,pmdl006,
                  pmdl009,pmdl010,pmdl011,pmdl012,pmdl013,pmdl015,pmdl016,pmdl023,pmdl051,pmdl017
              INTO g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds011,g_pmds_m.pmds014,
                   g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,
                   g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds012,g_pmds_m.pmds053,g_pmds_m.pmds039
                   
             FROM pmdl_t WHERE pmdlent = g_enterprise AND pmdldocno = g_pmds_m.pmds006
           CALL apmt520_pmds007_ref(g_pmds_m.pmds007) RETURNING g_pmds_m.pmds007_desc
           DISPLAY BY NAME g_pmds_m.pmds007_desc
           CALL apmt520_pmds007_ref(g_pmds_m.pmds008) RETURNING g_pmds_m.pmds008_desc
           DISPLAY BY NAME g_pmds_m.pmds008_desc
           CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
           DISPLAY BY NAME g_pmds_m.pmds009_desc
           CALL s_desc_get_acc_desc('275',g_pmds_m.pmds012) RETURNING g_pmds_m.pmds012_desc
           DISPLAY BY NAME g_pmds_m.pmds012_desc
           
           CALL s_desc_get_icaa001_desc(g_pmds_m.pmds053) RETURNING g_pmds_m.pmds053_desc
           DISPLAY BY NAME g_pmds_m.pmds053_desc
           
           CALL s_desc_get_price_type_desc(g_pmds_m.pmds039) RETURNING g_pmds_m.pmds039_desc
           DISPLAY BY NAME g_pmds_m.pmds039_desc
           
           
           ##依據輸入的採購單號的採購性質(pmdl005)與多角性質(pmdl006)的值設[C:採購性質]欄位的值，
           ##預設原則如下:
           ##2-1.當pmdl005 = '1' or '4'且pmdl006='1'時，則[C:採購性質] = '1:一般採購'
           ##2-2.當pmdl005 = '1' or '4'且pmdl006='4' or '5'時，則[C:採購性質] = '7:統一採購'
           ##2-3.當pmdl005 = '3'時，則[C:採購性質] = '9:VMI採購'
           #IF g_argv[1] MATCHES '[13]' THEN
           #   IF l_pmdl005 MATCHES '[14]' AND l_pmdl006 = '1' THEN
           #      LET g_pmds_m.pmds011 = '1'
           #   END IF
           #   IF l_pmdl005 MATCHES '[14]' AND l_pmdl006 MATCHES '[45]' THEN
           #      LET g_pmds_m.pmds011 = '7'
           #   END IF
           #   IF l_pmdl005 = '3' THEN
           #      LET g_pmds_m.pmds011 = '9'
           #   END IF
           #   DISPLAY BY NAME g_pmds_m.pmds011
           #END IF
           
           #150611 earl add s
           #若多角流程代碼為中斷續拋
           IF apmt520_break_continue(g_pmds_m.pmds053) THEN
              CALL apmt520_sel_pmds041(g_pmds_m.pmds006,g_pmds_m.pmds041) RETURNING l_cnt,g_pmds_m.pmds041
           ELSE
              LET g_pmds_m.pmds041 = ''
           END IF
           
           DISPLAY BY NAME g_pmds_m.pmds041
           #150611 earl add e
           
        END IF
        
        #驗退、入庫、倉退時，根據收貨單單號帶值
        IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
           SELECT pmds007,pmds008,pmds009,pmds010,pmds011,pmds012,pmds014,pmds021,pmds022,pmds023,pmds024,#pmds028,
                  pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,pmds037,pmds038,pmds039,pmds040,
                  pmds041,pmds042,pmds043,pmds044,pmds046,pmds052,pmds053
             INTO g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds011,g_pmds_m.pmds012,g_pmds_m.pmds014,
                  g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,#g_pmds_m.pmds028,
                  g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,
                  g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,
                  g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,
                  g_pmds_m.pmds052,g_pmds_m.pmds053
             FROM pmds_t WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmds006
             
           DISPLAY BY NAME g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds011,g_pmds_m.pmds014,
                  g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,#g_pmds_m.pmds028,
                  g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,
                  g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,
                  g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,
                  g_pmds_m.pmds052,g_pmds_m.pmds053
                  
           CALL apmt520_pmds007_ref(g_pmds_m.pmds007) RETURNING g_pmds_m.pmds007_desc
           DISPLAY BY NAME g_pmds_m.pmds007_desc
           CALL apmt520_pmds007_ref(g_pmds_m.pmds008) RETURNING g_pmds_m.pmds008_desc
           DISPLAY BY NAME g_pmds_m.pmds008_desc
           CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
           DISPLAY BY NAME g_pmds_m.pmds009_desc  
           
           CALL s_desc_get_currency_desc(g_pmds_m.pmds037) RETURNING g_pmds_m.pmds037_desc
           DISPLAY BY NAME g_pmds_m.pmds037_desc
           
           CALL s_desc_get_icaa001_desc(g_pmds_m.pmds053) RETURNING g_pmds_m.pmds053_desc
           DISPLAY BY NAME g_pmds_m.pmds053_desc
           
           CALL s_desc_get_price_type_desc(g_pmds_m.pmds039) RETURNING g_pmds_m.pmds039_desc
           DISPLAY BY NAME g_pmds_m.pmds039_desc

           #150611 earl add s
           #若多角流程代碼為中斷續拋
           IF apmt520_break_continue(g_pmds_m.pmds053) THEN
              CALL apmt520_sel_pmds041(g_pmds_m.pmds006,g_pmds_m.pmds041) RETURNING l_cnt,g_pmds_m.pmds041
           ELSE
              LET g_pmds_m.pmds041 = ''
           END IF
           
           DISPLAY BY NAME g_pmds_m.pmds041
           #150611 earl add e

        END IF
        
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds006_chk" order="2" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#採購單單號檢查
PRIVATE FUNCTION apmt520_pmds006_chk(p_pmds006)
DEFINE p_pmds006   LIKE pmds_t.pmds006
DEFINE l_pmdl005   LIKE pmdl_t.pmdl005
DEFINE l_pmdl006   LIKE pmdl_t.pmdl006
DEFINE l_pmdl051   LIKE pmdl_t.pmdl051  #150610 earl add
DEFINE l_pmdl030   LIKE pmdl_t.pmdl030  #150610 earl add
DEFINE l_gzze003   LIKE gzze_t.gzze003  #150610 earl add
DEFINE l_success   LIKE type_t.num5
DEFINE l_ooba002   LIKE ooba_t.ooba002
DEFINE l_n         LIKE type_t.num5
DEFINE r_success   LIKE type_t.num5
DEFINE l_pmdldocdt LIKE pmdl_t.pmdldocdt

       LET r_success = TRUE
       
       IF NOT cl_null(p_pmds006) THEN
          
          CALL cl_getmsg('apm-00942',g_dlang) RETURNING l_gzze003   #採購單維護作業apmt500  #150610 earl add
          
          LET l_pmdl005 = ''
          LET l_pmdl006 = ''
          LET l_pmdl030 = '' #150610 earl add
          LET l_pmdl051 = '' #150610 earl add
          SELECT pmdl005,pmdl006,pmdldocdt,
                 pmdl030,pmdl051     #150610 earl add
            INTO l_pmdl005,l_pmdl006,l_pmdldocdt,
                 l_pmdl030,l_pmdl051   #150610 earl add
            FROM pmdl_t
           WHERE pmdlent = g_enterprise AND pmdldocno = p_pmds006

          #採購收貨、採購收貨入庫時採購採購單號
          IF g_argv[1] MATCHES '[13]' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             LET g_chkparam.where = " pmdl005 NOT IN ('2','5','6')"
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdldocno") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #輸入的採購單號的採購性質(pmdl005)值需為'1:一般採購' or '3:VMI採購' or '4:預先採購'
             IF l_pmdl005 NOT MATCHES '[134]' THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00338'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
             
          END IF
          
          #採購收貨、採購收貨入庫時採購採購單號
          IF g_argv[1] = '23' OR g_argv[1] = '24' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             LET g_chkparam.where = " pmdl005 = '6' "
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdldocno_6") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #輸入的採購單號的採購性質(pmdl005)值需為'6:借貨採購'
             IF l_pmdl005 NOT MATCHES '[6]' THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00872'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          IF g_argv[1] MATCHES '[13]' OR g_argv[1] = '23' OR g_argv[1] = '24'THEN  
             #採購日期不可晚於收貨單上的收貨日期！
             IF g_pmds_m.pmdsdocdt < l_pmdldocdt THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00650'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #輸入的採購單號的多角性質(pmdl006)值需為'1:一般交易' or '4:統購統付' or '5:統購自付'
             IF l_pmdl006 NOT MATCHES '[12345]' THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00339'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #輸入採購單號的採購明細必須有一筆以上的送貨據點(pmdnunit)與g_site一樣的資料才可以
             LET l_n = 0
             SELECT COUNT(*) INTO l_n FROM pmdn_t 
                WHERE pmdnent = g_enterprise AND pmdndocno = p_pmds006 AND pmdnunit = g_site
             IF l_n = 0 OR cl_null(l_n) THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00340'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #採購收貨
          IF g_argv[1] MATCHES '[1]' OR g_argv[1] = '23' THEN
             #輸入的採購單單別參數"收貨是否直接入庫(D-BAS-0074)"為N時才可以輸入
             CALL s_aooi200_get_slip(p_pmds006) RETURNING l_success,l_ooba002
             IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-BAS-0074') != 'N' THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00341'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #採購收貨入庫
          IF g_argv[1] MATCHES '[3]' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
             #輸入的採購單單別參數"收貨是否直接入庫(D-BAS-0074)"為Y時才可以輸入
             CALL s_aooi200_get_slip(p_pmds006) RETURNING l_success,l_ooba002
             IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-BAS-0074') != 'Y' THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00447'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #委外採購收貨時 委外採購單號
          IF g_argv[1] MATCHES '[8]' OR g_argv[1] = '20' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdldocno_1") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #採購日期不可晚於收貨單上的收貨日期！
             IF g_pmds_m.pmdsdocdt < l_pmdldocdt THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00650'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #輸入採購單號的採購明細必須有一筆以上的送貨據點(pmdnunit)與g_site一樣的資料才可以
             LET l_n = 0
             SELECT COUNT(*) INTO l_n FROM pmdn_t 
                WHERE pmdnent = g_enterprise AND pmdndocno = p_pmds006 AND pmdnunit = g_site
             IF l_n = 0 OR cl_null(l_n) THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00340'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #重覆性生產採購收貨時 委外採購單號
          IF g_argv[1] MATCHES '[9]' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdldocno_3") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #採購日期不可晚於收貨單上的收貨日期！
             IF g_pmds_m.pmdsdocdt < l_pmdldocdt THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00650'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #輸入採購單號的採購明細必須有一筆以上的送貨據點(pmdnunit)與g_site一樣的資料才可以
             LET l_n = 0
             SELECT COUNT(*) INTO l_n FROM pmdn_t 
                WHERE pmdnent = g_enterprise AND pmdndocno = p_pmds006 AND pmdnunit = g_site
             IF l_n = 0 OR cl_null(l_n) THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00340'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #驗退時檢查收貨單號
          IF g_argv[1] MATCHES '[5]' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdsdocno_2") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #檢查是否已做QC
             LET l_n = 0
             SELECT COUNT(*) INTO l_n FROM pmdt_t
              WHERE pmdtent = g_enterprise
                AND pmdtdocno = p_pmds006
                AND ((EXISTS (SELECT qcba001 FROM qcba_t WHERE qcbaent = g_enterprise AND qcba001 = pmdtdocno AND qcbastus = 'Y') AND pmdt026 = 'Y') OR pmdt026 = 'N')
             IF cl_null(l_n) OR l_n <= 0 THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00680'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             LET l_n = 0
             SELECT COUNT(*) INTO l_n FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = p_pmds006
              AND (((((CASE WHEN pmdt020 IS NULL THEN 0 ELSE pmdt020 END) - (CASE WHEN pmdt053 IS NULL THEN 0 ELSE pmdt053 END) - (CASE WHEN pmdt055 IS NULL THEN 0 ELSE pmdt055 END)) > 0) AND pmdt026 = 'Y')
               OR ((((CASE WHEN pmdt053 IS NULL THEN 0 ELSE pmdt053 END) - (CASE WHEN pmdt054 IS NULL THEN 0 ELSE pmdt054 END) - (CASE WHEN pmdt055 IS NULL THEN 0 ELSE pmdt055 END)) > 0) AND pmdt026 = 'N'))
             IF l_n = 0 OR cl_null(l_n) THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00630'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #入庫時檢查收貨單號
          IF g_argv[1] MATCHES '[6]' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdsdocno_2") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             LET l_n = 0
             SELECT COUNT(*) INTO l_n FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = p_pmds006
              AND ( (CASE WHEN pmdt053 IS NULL THEN 0 ELSE pmdt053 END) - (CASE WHEN pmdt054 IS NULL THEN 0 ELSE pmdt054 END)) > 0
             IF l_n = 0 OR cl_null(l_n) THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00630'
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #倉退時檢查收貨單號
          IF g_argv[1] MATCHES '[7]' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             LET g_chkparam.where = " pmds000 IN ('1','2','3','4') "
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdsdocno_6") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #委外驗退、入庫、倉退時檢查收貨單號
          IF g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdsdocno_9") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          #重覆性生產驗退、入庫、倉退時檢查收貨單號
          IF g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdsdocno_4") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #借貨入庫、倉退時檢查收貨單號
          IF g_argv[1] = '25' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdsdocno_1") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          IF g_argv[1] = '26' THEN
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
		     
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = p_pmds006
             
             #呼叫檢查存在並帶值的library
             #輸入的採購單號狀態需要為已確認且未結案的採購單
             IF NOT cl_chk_exist("v_pmdsdocno_11") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
       
          #150610 earl add s
          #多角check
          #多角性質為：2:代採購,3:代採購指定供應商,4:統購統付,5:統購自付,6:中間交易
          IF l_pmdl006 = '2' OR
             l_pmdl006 = '3' OR
             l_pmdl006 = '4' OR
             l_pmdl006 = '5' OR
             l_pmdl006 = '6' THEN
             
             IF cl_null(l_pmdl051) THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'axm-00496'     #多角性質為多角流程時，"多角流程代碼"不可為空！
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
               
                LET g_errparam.replace[1] = l_gzze003
               
                CALL cl_err()
               
                LET r_success = FALSE
                RETURN r_success
             ELSE
                IF NOT apmt520_pmds014_pmds053_chk(l_pmdl006,l_pmdl051) THEN
                   LET r_success = FALSE
                   RETURN r_success
                END IF
                
                #中斷續拋
                IF apmt520_break_continue(l_pmdl051) THEN
                
                   #多角序號檢查
                   IF NOT apmt520_source_pmds041_chk(p_pmds006,g_pmds_m.pmds041) THEN
                      LET r_success = FALSE
                      RETURN r_success
                   END IF
                   
                END IF
                
             END IF
          
             IF l_pmdl030 <> 'Y' THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'axm-00517'     #來源需為"多角貿易已拋轉"之單據！
                LET g_errparam.extend = p_pmds006
                LET g_errparam.popup = TRUE
               
                LET g_errparam.replace[1] = l_gzze003
               
                CALL cl_err()
               
                LET r_success = FALSE
                RETURN r_success
             END IF

          END IF
          #150610 earl add e

       END IF
       
       RETURN r_success
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds007_ref" order="3" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION apmt520_pmds007_ref(p_pmds007)
DEFINE p_pmds007    LIKE pmds_t.pmds007
DEFINE r_pmaal004   LIKE pmaal_t.pmaal004

        INITIALIZE g_ref_fields TO NULL
        LET g_ref_fields[1] = p_pmds007
        CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
        LET r_pmaal004 = '', g_rtn_fields[1] , ''
        RETURN r_pmaal004
        
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt001_chk" order="4" ver="9" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#單身採購單號檢查
PRIVATE FUNCTION apmt520_pmdt001_chk(p_pmdt001)
DEFINE p_pmdt001   LIKE pmdt_t.pmdt001
DEFINE l_pmdl006   LIKE pmdl_t.pmdl006
DEFINE l_pmdl005   LIKE pmdl_t.pmdl005
DEFINE l_pmdl006_1 LIKE pmdl_t.pmdl006
DEFINE l_pmdl010   LIKE pmdl_t.pmdl010
DEFINE l_pmdl010_1 LIKE pmdl_t.pmdl010
DEFINE r_success   LIKE type_t.num5
DEFINE l_seq       LIKE pmdt_t.pmdtseq
DEFINE l_pmdt001   LIKE pmdt_t.pmdt001
DEFINE l_pmdl051   LIKE pmdl_t.pmdl051
DEFINE l_pmdl011   LIKE pmdl_t.pmdl011
DEFINE l_pmdl015   LIKE pmdl_t.pmdl015
DEFINE l_pmdl011_1 LIKE pmdl_t.pmdl011
DEFINE l_pmdl015_1 LIKE pmdl_t.pmdl015
DEFINE l_pmdl004   LIKE pmdl_t.pmdl004

       LET r_success = TRUE
       
       IF NOT cl_null(p_pmdt001) THEN
          IF NOT apmt520_pmds006_chk(p_pmdt001) THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
          
          #輸入的採購單的採購性質要跟單頭的一致
          LET l_pmdl005 = ''
          LET l_pmdl006 = ''
          LET l_pmdl011 = ''
          LET l_pmdl015 = ''
          LET l_pmdl004 = ''
          SELECT pmdl004,pmdl005,pmdl006,pmdl010,pmdl011,pmdl015 INTO l_pmdl004,l_pmdl005,l_pmdl006,l_pmdl010,l_pmdl011,l_pmdl015 FROM pmdl_t
            WHERE pmdlent = g_enterprise AND pmdldocno = p_pmdt001
          
          #输入的采购单号的供应商与单头采购供应商不一致！
          IF l_pmdl004 <> g_pmds_m.pmds007 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'apm-00730'
             LET g_errparam.extend = p_pmdt001
             LET g_errparam.popup = TRUE
             CALL cl_err()

             LET r_success = FALSE
             RETURN r_success
          END IF
          
          IF l_pmdl005 <> g_pmds_m.pmds011 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'apm-00365'
             LET g_errparam.extend = p_pmdt001
             LET g_errparam.popup = TRUE
             CALL cl_err()

             LET r_success = FALSE
             RETURN r_success
          END IF
          
          IF NOT cl_null(g_pmds_m.pmds053) THEN
             IF l_pmdl051 <> g_pmds_m.pmds053 THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00829'
                LET g_errparam.extend = p_pmdt001
                LET g_errparam.popup = TRUE
                CALL cl_err()
             
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          
          #输入的采购单号的税别与单头税别不一致！
          IF l_pmdl011 <> g_pmds_m.pmds033 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'apm-00838'
             LET g_errparam.extend = p_pmdt001
             LET g_errparam.popup = TRUE
             CALL cl_err()
          
             LET r_success = FALSE
             RETURN r_success
          END IF
          
          #输入的采购单号的币别与单头币别不一致！
          IF l_pmdl015 <> g_pmds_m.pmds037 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'apm-00839'
             LET g_errparam.extend = p_pmdt001
             LET g_errparam.popup = TRUE
             CALL cl_err()
          
             LET r_success = FALSE
             RETURN r_success
          END IF
          
          LET l_pmdl006_1 = ''
          LET l_pmdl010_1 = ''
          LET l_pmdl011_1 = ''
          LET l_pmdl015_1 = ''
          LET l_seq = g_pmdt_d[l_ac].pmdtseq - 1
          IF l_seq > 0 THEN
             SELECT pmdt001 INTO l_pmdt001 FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND pmdtseq = l_seq
             
             SELECT pmdl006,pmdl010,pmdl011,pmdl015 INTO l_pmdl006_1,l_pmdl010_1,l_pmdl011_1,l_pmdl015_1 FROM pmdl_t
               WHERE pmdlent = g_enterprise AND pmdldocno = l_pmdt001
             
             #輸入的採購單的角性質需一致，不可不同收貨項次對應採購單的多角性質不一致
             IF l_pmdl006 <> l_pmdl006_1 THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00366'
                LET g_errparam.extend = p_pmdt001
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #当收貨單身有對到多張採購單時，檢核單身所有的採購單的交易條件都要一樣
             IF l_pmdl010 <> l_pmdl010_1 THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00367'
                LET g_errparam.extend = p_pmdt001
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
       END IF
       
       RETURN r_success
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdo_chk" order="5" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#檢查是否存在對應的交期明細資料
PRIVATE FUNCTION apmt520_pmdo_chk()
DEFINE l_n       LIKE type_t.num5
DEFINE r_success LIKE type_t.num5

       LET r_success = TRUE
       
       #若採購單號、採購項次、採購項序、採購分批序均有值時，需撿核該採購單是否有對應的交期明細資料
       IF (NOT cl_null(g_pmdt_d[l_ac].pmdt001)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt002)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt003)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt004)) THEN
          LET l_n = 0 
          SELECT COUNT(*) INTO l_n FROM pmdo_t 
            WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001
              AND pmdoseq = g_pmdt_d[l_ac].pmdt002
              AND pmdoseq1 = g_pmdt_d[l_ac].pmdt003
              AND pmdoseq2 = g_pmdt_d[l_ac].pmdt004
          IF cl_null(l_n) OR l_n = 0 THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = 'apm-00369'
             LET g_errparam.extend = g_pmdt_d[l_ac].pmdt001
             LET g_errparam.popup = TRUE
             CALL cl_err()

             LET r_success = FALSE
             RETURN r_success
          END IF
       END IF
       
       RETURN r_success
       
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt001_desc" order="6" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#帶出採購單相關資料
PRIVATE FUNCTION apmt520_pmdt001_desc()
DEFINE l_pmdt020   LIKE pmdt_t.pmdt020
DEFINE l_pmdo006   LIKE pmdo_t.pmdo006
DEFINE l_success  LIKE type_t.num5
DEFINE l_rate     LIKE inaj_t.inaj014
DEFINE l_sql       STRING
DEFINE l_pmdp003   LIKE pmdp_t.pmdp003
DEFINE l_pmdp009   LIKE pmdp_t.pmdp009
DEFINE l_pmdp010   LIKE pmdp_t.pmdp010
DEFINE l_sets      LIKE type_t.num26_10

       IF (NOT cl_null(g_pmdt_d[l_ac].pmdt001)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt002)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt003)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt004)) THEN
          LET g_pmdt_d[l_ac].pmdo001 = ''  #採購料號
          LET g_pmdt_d[l_ac].pmdo002 = ''  #產品特徵
          LET g_pmdt_d[l_ac].pmdt005 = ''  #子特性
          LET g_pmdt_d[l_ac].pmdt019 = ''  #單位
          LET g_pmdt_d[l_ac].pmdt020 = 0   #數量
          LET g_pmdt_d[l_ac].pmdt006 = ''  #收貨料號
          LET g_pmdt_d[l_ac].pmdt007 = ''  #收貨產品特徵
          LET g_pmdt_d[l_ac].pmdt036 = 0    #單價
          LET g_pmdt_d[l_ac].pmdt046 = ''   #稅別
          LET g_pmdt_d[l_ac].pmdt037 = 0    #稅率
          
          #其他收貨單上錄入的數量
          LET l_pmdt020 = 0
          SELECT SUM(pmdt020) INTO l_pmdt020 FROM pmdt_t,pmds_t 
             WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
               AND pmdtent = g_enterprise AND pmdt001 = g_pmdt_d[l_ac].pmdt001
               AND pmdt002 = g_pmdt_d[l_ac].pmdt002
               AND pmdt003 = g_pmdt_d[l_ac].pmdt003
               AND pmdt004 = g_pmdt_d[l_ac].pmdt004
               AND pmdsstus = 'N'
               AND pmds000 = g_pmds_m.pmds000
               
          IF cl_null(l_pmdt020) THEN
             LET l_pmdt020 = 0
          END IF
          
          SELECT pmdo001,pmdo002,pmdo003,pmdo004,(pmdo006-pmdo015+pmdo016),pmdo022,pmdo023,pmdo024 
             INTO g_pmdt_d[l_ac].pmdo001,g_pmdt_d[l_ac].pmdo002,g_pmdt_d[l_ac].pmdt005,g_pmdt_d[l_ac].pmdt019,l_pmdo006,
                  g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt037
           FROM pmdo_t 
           WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001
             AND pmdoseq = g_pmdt_d[l_ac].pmdt002
             AND pmdoseq1 = g_pmdt_d[l_ac].pmdt003
             AND pmdoseq2 = g_pmdt_d[l_ac].pmdt004
          LET g_pmdt_d[l_ac].pmdt006 = g_pmdt_d[l_ac].pmdo001  #收貨料號
          LET g_pmdt_d[l_ac].pmdt007 = g_pmdt_d[l_ac].pmdo002  #收貨產品特徵
          
          IF cl_null(l_pmdo006) THEN
             LET l_pmdo006 = 0
          END IF
          
          #委外採購收貨時，收貨數量要判斷本項次收貨量+對應工單已收貨量-驗退量-類型4倉退量+其他單據收貨量不可大於工單齊套套數（s_asft340_full_sets）
          IF g_argv[1] MATCHES '[8]' OR g_argv[1] = '20' THEN
             #獲得收穫對應的採購單號和項次
             #SELECT pmdt001,pmdt002 INTO l_pmdt001,l_pmdt002 FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = p_pmdsdocno AND pmdtseq = p_pmdtseq
             #根據採購單和項次找到來源工單的單號、作業號製程序
             SELECT pmdp003,pmdp009,pmdp010 INTO l_pmdp003,l_pmdp009,l_pmdp010 FROM pmdp_t 
                WHERE pmdpent = g_enterprise AND pmdpdocno = g_pmdt_d[l_ac].pmdt001 AND pmdpseq = g_pmdt_d[l_ac].pmdt002
             
             CALL s_asft340_full_sets(l_pmdp003,l_pmdp009,l_pmdp010,g_pmds_m.pmdsdocdt) RETURNING l_success,l_sets
             IF l_pmdo006 < l_sets THEN
                LET l_sets = l_pmdo006
             END IF
             
             LET g_pmdt_d[l_ac].pmdt020 = l_sets - l_pmdt020
             
             #帶出工單的指定入庫庫位，儲位，批號
             SELECT DISTINCT pmdp003 INTO l_pmdp003 FROM pmdp_t 
                WHERE pmdpent = g_enterprise AND pmdpdocno = g_pmdt_d[l_ac].pmdt001 AND pmdpseq = g_pmdt_d[l_ac].pmdt002
             SELECT sfaa034,sfaa035,sfaa059 INTO g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018 FROM sfaa_t
                WHERE sfaaent = g_enterprise AND sfaadocno = l_pmdp003
             CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
             DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
             
             CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
             DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
             
          ELSE
             #收貨數量 =pmdo006(需求量)-pmdo015(已收貨量)+pmdo016(驗退量)-已登打收貨單位確認量
             LET g_pmdt_d[l_ac].pmdt020 = l_pmdo006 - l_pmdt020
          END IF
          
          CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdo001) RETURNING g_pmdt_d[l_ac].imaal003,g_pmdt_d[l_ac].imaal004
          DISPLAY BY NAME g_pmdt_d[l_ac].imaal003,g_pmdt_d[l_ac].imaal004
          
          CALL s_feature_description(g_pmdt_d[l_ac].pmdo001,g_pmdt_d[l_ac].pmdo002) RETURNING l_success,g_pmdt_d[l_ac].pmdo002_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdo002_desc
          
          CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdt006) RETURNING g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          
          CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
          
          CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt019_desc
          
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdo001,g_pmdt_d[l_ac].pmdo002,g_pmdt_d[l_ac].pmdt005,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020
          
          LET g_pmdt_d[l_ac].pmdt008 = ''   #包裝容器
          LET g_pmdt_d[l_ac].pmdt009 = ''   #作業編號
          LET g_pmdt_d[l_ac].pmdt010 = ''   #製程序
          LET g_pmdt_d[l_ac].pmdt021 = ''   #參考單位
          LET g_pmdt_d[l_ac].pmdt022 = 0    #參考數量
          LET g_pmdt_d[l_ac].pmdt023 = ''   #計價單位
          LET g_pmdt_d[l_ac].pmdt024 = 0    #計價數量
          LET g_pmdt_d[l_ac].pmdt025 = ''   #緊急度
          LET g_pmdt_d[l_ac].pmdt016 = ''   #庫位
          LET g_pmdt_d[l_ac].pmdt017 = ''   #儲位
          LET g_pmdt_d[l_ac].pmdt018 = ''   #批號
          LET g_pmdt_d[l_ac].pmdt040 = ''   #價格類型
          LET g_pmdt_d[l_ac].pmdt041 = ''   #保稅
          LET g_pmdt_d[l_ac].pmdt059 = ''   #備註
          
          SELECT pmdn003,pmdn004,pmdn005,pmdn008,pmdn010,pmdn020,pmdn028,pmdn029,pmdn030,pmdn035,pmdn021,pmdn052,pmdn050,
                 pmdn040,pmdn041,pmdn042,pmdn043,pmdn044,
                 pmdn036,pmdn037,pmdn038
            INTO g_pmdt_d[l_ac].pmdt008,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt021,
                 g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt016,
                 g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt040,g_pmdt_d[l_ac].pmdt041,
                 g_pmdt_d[l_ac].pmdt026,g_pmdt_d[l_ac].pmdt059,
                 g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt048,g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt045,
                 g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073,g_pmdt_d[l_ac].pmdt074
                 
          FROM pmdn_t
          WHERE pmdnent = g_enterprise AND pmdndocno = g_pmdt_d[l_ac].pmdt001
            AND pmdnseq = g_pmdt_d[l_ac].pmdt002
           
          #若委外採購時來源單據沒有倉儲批，帶出預設值
          #IF g_pmdt_d[l_ac].pmdt062 = 'N' AND g_argv[1] MATCHES '[8]' THEN
          #預設料件的庫儲
          IF g_pmdt_d[l_ac].pmdt062 = 'N' THEN
             IF cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                SELECT imaf091,imaf092 INTO g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017
                  FROM imaf_t
                  WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
             END IF
             IF g_pmdt_d[l_ac].pmdt017 IS NULL THEN
                SELECT imaf092 INTO g_pmdt_d[l_ac].pmdt017
                  FROM imaf_t
                  WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
             END IF
          END IF
            
          LET l_rate = 1
          IF NOT cl_null(g_pmdt_d[l_ac].pmdt021) THEN
             #CALL s_aimi190_get_convert(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021) RETURNING l_success,l_rate
             #LET g_pmdt_d[l_ac].pmdt022 = g_pmdt_d[l_ac].pmdt020 * l_rate   #參考數量
             CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                    RETURNING l_success,g_pmdt_d[l_ac].pmdt022
          ELSE
             LET g_pmdt_d[l_ac].pmdt022 = ''
          END IF
          
          LET l_rate = 1
          IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
             #CALL s_aimi190_get_convert(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023) RETURNING l_success,l_rate
             #LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020 * l_rate   #計價數量
             CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                    RETURNING l_success,g_pmdt_d[l_ac].pmdt024
          ELSE
             LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
             LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
          END IF
          
          LET g_pmdt_d[l_ac].pmdt052 = '1'              #狀態碼 '1:一般'
          
          #預設沖銷順序
          LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                      " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                      "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                      "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' "
          IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
             LET l_sql =  l_sql , " AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
          END IF
          IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
             LET l_sql =  l_sql , " AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
          END IF
          IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) OR g_pmdt_d[l_ac].pmdt017 = ' ' THEN
             LET l_sql =  l_sql , " AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
          END IF
          IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN
             LET l_sql =  l_sql , " AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
          END IF
          PREPARE pmdt011_pre7 FROM l_sql
          EXECUTE pmdt011_pre7 INTO g_pmdt_d[l_ac].pmdt011
          
          IF cl_null(g_pmdt_d[l_ac].pmdt011) OR g_pmdt_d[l_ac].pmdt011 = 0 THEN
             LET g_pmdt_d[l_ac].pmdt011 = 1
          END IF
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt011
                  
          
          CALL apmt520_pmdt008_ref(g_pmdt_d[l_ac].pmdt008) RETURNING g_pmdt_d[l_ac].pmdt008_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008_desc
          
          CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt021_desc
          
          CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt023_desc
          
          CALL apmt520_pmds033_ref(g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046_desc
          
          CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
          
          CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
          
          IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt036)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
             CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
               RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
             DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
          END IF
          
          CALL s_desc_get_project_desc(g_pmdt_d[l_ac].pmdt072) RETURNING g_pmdt_d[l_ac].pmdt072_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt072_desc
          
          CALL s_desc_get_wbs_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073) RETURNING g_pmdt_d[l_ac].pmdt073_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt073_desc
          
          CALL s_desc_get_activity_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt074) RETURNING g_pmdt_d[l_ac].pmdt074_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt074_desc
          
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt021,
                          g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,
                          g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt037,g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt016,
                          g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt040,g_pmdt_d[l_ac].pmdt041,
                          g_pmdt_d[l_ac].pmdt052,g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073,g_pmdt_d[l_ac].pmdt074
                          
          #若單頭交易條件、幣別等資料，根據採購單號帶出
          IF cl_null(g_pmds_m.pmds031) OR cl_null(g_pmds_m.pmds032) OR cl_null(g_pmds_m.pmds033) OR cl_null(g_pmds_m.pmds037) OR cl_null(g_pmds_m.pmds012) THEN
             SELECT pmdl009,pmdl010,pmdl011,pmdl012,pmdl013,pmdl015,pmdl016,pmdl023 
                 INTO g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds012
               FROM pmdl_t WHERE pmdlent = g_enterprise AND pmdldocno = g_pmdt_d[l_ac].pmdt001
             UPDATE pmds_t SET pmds031 = g_pmds_m.pmds031,
                               pmds032 = g_pmds_m.pmds032,
                               pmds033 = g_pmds_m.pmds033,
                               pmds034 = g_pmds_m.pmds034,
                               pmds035 = g_pmds_m.pmds035,
                               pmds037 = g_pmds_m.pmds037,
                               pmds038 = g_pmds_m.pmds038,
                               pmds012 = g_pmds_m.pmds012
                WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
          END IF

       END IF
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt008_ref" order="7" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION apmt520_pmdt008_ref(p_pmdt008)
DEFINE p_pmdt008    LIKE pmdt_t.pmdt008
DEFINE r_imaal003   LIKE imaal_t.imaal003

        INITIALIZE g_ref_fields TO NULL
        LET g_ref_fields[1] = p_pmdt008
        CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
        LET r_imaal003 = '', g_rtn_fields[1] , ''
        RETURN r_imaal003
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt002_chk" order="8" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#採購收貨、採購收貨入庫時，檢查對應採購單號的採購項次
#驗退、入庫、倉退時，檢查對應收貨單號的收貨項次
PRIVATE FUNCTION apmt520_pmdt002_chk()
DEFINE l_pmdn045    LIKE pmdn_t.pmdn045
DEFINE l_n          LIKE type_t.num5
DEFINE l_pmdt020    LIKE pmdt_t.pmdt020
DEFINE l_pmdt054    LIKE pmdt_t.pmdt054
DEFINE l_pmdt055    LIKE pmdt_t.pmdt055
DEFINE l_pmdt020_1  LIKE pmdt_t.pmdt020
DEFINE l_qcba017    LIKE qcba_t.qcba017
DEFINE l_qcba023    LIKE qcba_t.qcba023
DEFINE l_pmdt026    LIKE pmdt_t.pmdt026
DEFINE r_success    LIKE type_t.num5
DEFINE l_pmdn023    LIKE pmdn_t.pmdn023

        LET r_success = TRUE
        
        #採購收貨、採購收貨入庫時，檢查對應採購單號的採購項次
        IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
           #輸入的採購單號+採購項次必須存在pmdo_t中
           LET l_n = 0
           SELECT COUNT(*) INTO l_n FROM pmdo_t WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001 AND pmdoseq = g_pmdt_d[l_ac].pmdt002
           IF l_n = 0 OR cl_null(l_n) THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'apm-00372'
              LET g_errparam.extend = g_pmdt_d[l_ac].pmdt002
              LET g_errparam.popup = TRUE
              CALL cl_err()

              LET r_success = FALSE
              RETURN r_success
           END IF
           
           #輸入的採購項次行狀態不可以為結案狀態
           LET l_pmdn045 = ''
           LET l_pmdn023 = ''
           SELECT pmdn023,pmdn045 INTO l_pmdn023,l_pmdn045 FROM pmdn_t WHERE pmdnent = g_enterprise AND pmdndocno = g_pmdt_d[l_ac].pmdt001 AND pmdnseq = g_pmdt_d[l_ac].pmdt002
           CASE WHEN SQLCA.sqlcode = 100
                     INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'apm-00372'
              LET g_errparam.extend = g_pmdt_d[l_ac].pmdt002
              LET g_errparam.popup = TRUE
              CALL cl_err()

                     LET r_success = FALSE
                WHEN l_pmdn045 <> '1'
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'apm-00373'
                     LET g_errparam.extend = g_pmdt_d[l_ac].pmdt002
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET r_success = FALSE
                WHEN SQLCA.SQLCODE != 0
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.SQLCODE
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET r_success = FALSE
           END CASE
           
           #输入的采购单号的供应商与单头送货供应商不一致！
           IF l_pmdn023 <> g_pmds_m.pmds009 THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'apm-00841'
              LET g_errparam.extend = g_pmdt_d[l_ac].pmdt002
              LET g_errparam.popup = TRUE
              CALL cl_err()
           
              LET r_success = FALSE
              RETURN r_success
           END IF
           
        END IF

        RETURN r_success
        
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt006_chk" order="9" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#收貨料號檢查
PRIVATE FUNCTION apmt520_pmdt006_chk(p_pmdt006)
DEFINE p_pmdt006     LIKE pmdt_t.pmdt006
DEFINE l_flag        LIKE type_t.num5
DEFINE l_success     LIKE type_t.num5
DEFINE l_ooba002     LIKE ooba_t.ooba002
DEFINE l_pmdp007     LIKE pmdp_t.pmdp007
DEFINE r_success     LIKE type_t.num5

       LET r_success = TRUE

       IF NOT cl_null(p_pmdt006) THEN
          #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
          INITIALIZE g_chkparam.* TO NULL

          #設定g_chkparam.*的參數
          LET g_chkparam.arg1 = p_pmdt006

          #呼叫檢查存在並帶值的library
          IF cl_chk_exist("v_imaa001") THEN
             IF NOT cl_chk_exist("v_imaf001_14") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             ##倉退时，開有庫存的料號
             #IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
             #   IF NOT cl_chk_exist("v_inag001") THEN
             #      LET r_success = FALSE
             #      RETURN r_success
             #   END IF
             #END IF
          ELSE
             LET r_success = FALSE
             RETURN r_success
          END IF

          ##判斷輸入的料件編號是否在控制組限制的產品範圍內，若不在限制內則不允許請購此料
          #CALL s_control_chk_group('3','4',g_user,g_dept,p_pmdt006,'','','','') RETURNING l_success,l_flag
          #IF NOT l_success THEN      #处理状态
          #   LET r_success = FALSE
          #   RETURN r_success
          #ELSE
          #   IF NOT l_flag THEN      #是否存在
          #      CALL cl_err(p_pmdt006,'apm-00265',1)
          #      LET r_success = FALSE
          #      RETURN r_success
          #   END IF
          #END IF

          #檢核輸入的料件的生命週期是否在單據別限制範圍內，若不在限制內則不允許請購此料
          CALL s_control_chk_doc('4',g_pmds_m.pmdsdocno,p_pmdt006,'','','','') RETURNING l_success,l_flag
          IF NOT l_success THEN      #处理状态
             LET r_success = FALSE
             RETURN r_success
          ELSE
             IF NOT l_flag THEN      #是否存在
                #CALL cl_err(p_pmdt006,'ain-00015',1)
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF

          #檢核輸入的料件的產品分類是否在單據別限制範圍內，若不在限制內則不允許請購此料
          CALL s_control_chk_doc('5',g_pmds_m.pmdsdocno,p_pmdt006,'','','','') RETURNING l_success,l_flag
          IF NOT l_success THEN      #处理状态
             LET r_success = FALSE
             RETURN r_success
          ELSE
             IF NOT l_flag THEN      #是否存在
                LET r_success = FALSE
                #CALL cl_err(p_pmdt006,'apm-00238',1)
                RETURN r_success
             END IF
          END IF
          
          #當收貨料號與採購料號不一樣時，必須檢核是否與採購料號有替代關係，若沒有則不允許修改
          IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
             IF p_pmdt006 <> g_pmdt_d[l_ac].pmdo001 AND NOT cl_null(g_pmdt_d[l_ac].pmdo001) THEN
                IF NOT s_pmaq_chk_replacement(g_pmds_m.pmds007,g_pmdt_d[l_ac].pmdo001,p_pmdt006,'3',g_pmdt_d[l_ac].pmdo002,g_pmdt_d[l_ac].pmdt007) THEN
                   LET r_success = FALSE
                   RETURN r_success
                END IF
             END IF 
          END IF 
          
          #收貨單在維護料號時需檢核料件AVL控管點(imaa044)設置，若是設置'2:可採購，不可收貨'時，則要檢核
          #其他收貨、無採購收貨、收貨入庫單等作業也需考慮
          IF g_argv[1] MATCHES '[123489]' OR g_argv[1] = '20' THEN
             IF NOT s_apmt520_item_avl_chk(g_pmds_m.pmdsdocdt,p_pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmds_m.pmds007) THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF

       END IF
       
       RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_pmdt" order="10" ver="12" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[#根據單頭採購單號，自動產生單身
PRIVATE FUNCTION apmt520_gen_pmdt()
DEFINE l_pmdo           RECORD LIKE pmdo_t.*
DEFINE l_pmdt           RECORD LIKE pmdt_t.*
DEFINE l_pmdn           RECORD LIKE pmdn_t.*
DEFINE l_pmdt020        LIKE pmdt_t.pmdt020
DEFINE l_success        LIKE type_t.num5
DEFINE l_rate           LIKE inaj_t.inaj014
DEFINE l_flag           LIKE type_t.num5
DEFINE l_xrcd104        LIKE xrcd_t.xrcd104
DEFINE l_xrcd113        LIKE xrcd_t.xrcd113
DEFINE l_xrcd114        LIKE xrcd_t.xrcd114
DEFINE l_xrcd115        LIKE xrcd_t.xrcd115
DEFINE l_sql            STRING
DEFINE l_quantity       LIKE pmdt_t.pmdt020
DEFINE l_pmdv019        LIKE pmdv_t.pmdv019
DEFINE l_pmdp003        LIKE pmdp_t.pmdp003
DEFINE l_pmdp004        LIKE pmdp_t.pmdp004
DEFINE l_pmdp009        LIKE pmdp_t.pmdp009
DEFINE l_pmdp010        LIKE pmdp_t.pmdp010
DEFINE l_sets           LIKE type_t.num26_10
DEFINE l_ooba002        LIKE ooba_t.ooba002
 
       CALL s_transaction_begin()
       
       LET l_sql = " SELECT pmdo_t.*,pmdn_t.* FROM pmdo_t,pmdn_t,pmdl_t ",
                   "  WHERE pmdnent = pmdlent AND pmdndocno = pmdldocno AND pmdoent = pmdnent AND pmdodocno = pmdndocno AND pmdoseq = pmdnseq ",
                   "    AND pmdoent = '",g_enterprise,"' AND pmdodocno = '",g_pmds_m.pmds006,"' ",
                   "    AND pmdn045 = '1' ",             #未結案
                   "    AND pmdnunit = '",g_site,"' "   #收貨據點為當前營運據點
       IF g_argv[1] MATCHES '[13]' THEN
          LET l_sql = l_sql , " AND pmdl005 NOT IN ('2','5','6') "
       END IF
       IF g_argv[1] MATCHES '[8]' OR g_argv[1] = '20' THEN
          LET l_sql = l_sql , " AND pmdl005 = '2' "
       END IF
       
       IF g_argv[1] MATCHES '[9]' THEN
          LET l_sql = l_sql , " AND pmdl005 = '5' "
       END IF
       
       IF g_argv[1] = '23' OR g_argv[1] = '24' THEN
          LET l_sql = l_sql , " AND pmdl005 = '6' "
       END IF
       
       IF NOT cl_null(g_pmds_m.pmds053) THEN
          LET l_sql = l_sql , " AND pmdl051 = '",g_pmds_m.pmds053,"' "
       END IF
       IF NOT cl_null(g_pmds_m.pmds033) THEN
          LET l_sql = l_sql , " AND pmdl011 = '",g_pmds_m.pmds033,"' "
       END IF
       IF NOT cl_null(g_pmds_m.pmds037) THEN
          LET l_sql = l_sql , " AND pmdl015 = '",g_pmds_m.pmds037,"' "
       END IF
       
       PREPARE pmdo_pre1 FROM l_sql
       DECLARE pmdo_cur CURSOR FOR pmdo_pre1
       
         #SELECT pmdo_t.*,pmdn_t.* FROM pmdo_t,pmdn_t
         #  WHERE pmdoent = pmdnent AND pmdodocno = pmdndocno AND pmdoseq = pmdnseq
         #    AND pmdoent = g_enterprise AND pmdodocno = g_pmds_m.pmds006
         #    AND pmdn045 = '1'       #未結案
         #    AND pmdnunit = g_site   #收貨據點為當前營運據點
             
       INITIALIZE l_pmdo.* TO NULL
       INITIALIZE l_pmdt.* TO NULL
       INITIALIZE l_pmdn.* TO NULL
       
       LET l_success = TRUE
       
       FOREACH pmdo_cur INTO l_pmdo.*,l_pmdn.*
          
          
          IF cl_null(l_pmdo.pmdo006) THEN
             LET l_pmdo.pmdo006 = 0
          END IF
          IF cl_null(l_pmdo.pmdo015) THEN
             LET l_pmdo.pmdo015 = 0
          END IF
          IF cl_null(l_pmdo.pmdo016) THEN
             LET l_pmdo.pmdo016 = 0
          END IF
          IF cl_null(l_pmdo.pmdo017) THEN
             LET l_pmdo.pmdo017 = 0
          END IF
          
          LET l_pmdt020 = 0
          SELECT SUM(pmdt020) INTO l_pmdt020 FROM pmdt_t,pmds_t
            WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
              AND pmdtent = g_enterprise AND pmdt001 = l_pmdo.pmdodocno
              AND pmdt002 = l_pmdo.pmdoseq AND pmdt003 = l_pmdo.pmdoseq1
              AND pmdt004 = l_pmdo.pmdoseq2 AND pmdsstus = 'N'
              AND pmds000 = g_pmds_m.pmds000
              
          IF cl_null(l_pmdt020) THEN
             LET l_pmdt020 = 0
          END IF
          #輸入的收貨數量不可以大於對應採購的pmdo006(需求量)-pmdo015(已收貨量)+pmdo016(驗退量)-已登打收貨單未確認量
          LET l_pmdt.pmdt020 = l_pmdo.pmdo006 - l_pmdo.pmdo015 + l_pmdo.pmdo016 + l_pmdo.pmdo017 - l_pmdt020  #收貨數量
          #委外時，數量不可大於發料套數
          IF g_argv[1]='8' OR g_argv[1] = '20' THEN 
             SELECT pmdp003,pmdp009,pmdp010 INTO l_pmdp003,l_pmdp009,l_pmdp010 FROM pmdp_t 
                  WHERE pmdpent = g_enterprise AND pmdpdocno = l_pmdo.pmdodocno AND pmdpseq = l_pmdo.pmdoseq AND ROWNUM = 1
                  
             CALL s_asft340_full_sets(l_pmdp003,l_pmdp009,l_pmdp010,g_pmds_m.pmdsdocdt) RETURNING l_success,l_sets
             #其他單據上的維護的已發料數量
             SELECT SUM(pmdv019) INTO l_pmdv019 FROM pmdv_t,pmds_t 
                WHERE pmdvent = pmdsent AND pmdvdocno = pmdsdocno AND pmds000 = '8' AND pmdsstus <> 'X'
                  AND pmdvent = g_enterprise AND pmdv014 = l_pmdp003 AND pmdv015 = l_pmdp004 
             IF cl_null(l_pmdv019) THEN
                LET l_pmdv019 = 0
             END IF
             
             LET l_quantity = l_sets - l_pmdv019
             
             IF l_quantity < l_pmdt.pmdt020 THEN
                LET l_pmdt.pmdt020 = l_quantity
             END IF
             
          END IF
          
          IF cl_null(l_pmdt.pmdt020) OR l_pmdt.pmdt020 = 0 THEN
             CONTINUE FOREACH
          END IF
          
          LET l_pmdt.pmdtent = g_enterprise
          LET l_pmdt.pmdtsite = g_site
          LET l_pmdt.pmdtdocno = g_pmds_m.pmdsdocno
          SELECT MAX(pmdtseq)+1 INTO l_pmdt.pmdtseq FROM pmdt_t
              WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
          IF cl_null(l_pmdt.pmdtseq) OR l_pmdt.pmdtseq = 0 THEN
             LET l_pmdt.pmdtseq = 1
          END IF          
          
          LET l_pmdt.pmdt001 = l_pmdo.pmdodocno    #來源單號
          LET l_pmdt.pmdt002 = l_pmdo.pmdoseq      #來源項次
          LET l_pmdt.pmdt003 = l_pmdo.pmdoseq1     #來源項序
          LET l_pmdt.pmdt004 = l_pmdo.pmdoseq2     #來源分批序
          LET l_pmdt.pmdt005 = l_pmdo.pmdo003      #子特性
          LET l_pmdt.pmdt006 = l_pmdo.pmdo001      #料件編號
          LET l_pmdt.pmdt007 = l_pmdo.pmdo002      #產品特徵
          LET l_pmdt.pmdt008 = l_pmdn.pmdn003      #包裝容器
          LET l_pmdt.pmdt009 = l_pmdn.pmdn004      #作業編號
          LET l_pmdt.pmdt010 = l_pmdn.pmdn005      #製程序
          LET l_pmdt.pmdt059 = l_pmdn.pmdn050      #備註
          
          LET l_pmdt.pmdt016 = l_pmdn.pmdn028   #庫位
          LET l_pmdt.pmdt017 = l_pmdn.pmdn029   #儲位
          IF cl_null(l_pmdt.pmdt017) THEN
             LET l_pmdt.pmdt017 = ' '
          END IF
          LET l_pmdt.pmdt018 = l_pmdn.pmdn030   #批號
          IF cl_null(l_pmdt.pmdt018) THEN
             LET l_pmdt.pmdt018 = ' '
          END IF
          
          #預設料件的庫儲
          IF cl_null(l_pmdt.pmdt016) THEN
             SELECT imaf091,imaf092 INTO l_pmdt.pmdt016,l_pmdt.pmdt017
               FROM imaf_t
             WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = l_pmdt.pmdt006
          END IF
          IF l_pmdt.pmdt017 IS NULL THEN
             SELECT imaf092 INTO l_pmdt.pmdt017
               FROM imaf_t
               WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = l_pmdt.pmdt006
          END IF
          
          LET l_pmdt.pmdt019 = l_pmdo.pmdo004   #收貨單位
          
          #預設沖銷順序
          LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                      " WHERE pmdtent = '",g_enterprise,"' ",
                      "   AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                      "   AND pmdt006 = '",l_pmdt.pmdt006,"' AND pmdt007 = '",l_pmdt.pmdt007,"' ",
                      "   AND pmdt019 = '",l_pmdt.pmdt019,"' "
          IF NOT cl_null(l_pmdt.pmdt016) THEN
             LET l_sql =  l_sql , " AND pmdt016 = '",l_pmdt.pmdt016,"' "
          END IF
          IF NOT cl_null(l_pmdt.pmdt017) OR l_pmdt.pmdt017 = ' ' THEN
             LET l_sql =  l_sql , " AND pmdt017 = '",l_pmdt.pmdt017,"' "
          END IF
          IF NOT cl_null(l_pmdt.pmdt018) THEN
             LET l_sql =  l_sql , " AND pmdt018 = '",l_pmdt.pmdt018,"' "
          END IF
          PREPARE pmdt011_pre6 FROM l_sql
          EXECUTE pmdt011_pre6 INTO l_pmdt.pmdt011
          
          IF cl_null(l_pmdt.pmdt011) OR l_pmdt.pmdt011 = 0 THEN
             LET l_pmdt.pmdt011 = 1
          END IF
          
          LET l_pmdt.pmdt021 = l_pmdn.pmdn008   #參考單位
          LET l_rate = 1
          IF NOT cl_null(l_pmdt.pmdt021) THEN
             #CALL s_aimi190_get_convert(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt021) RETURNING l_flag,l_rate
             #LET l_pmdt.pmdt022 = l_pmdt.pmdt020 * l_rate   #參考數量
             CALL s_aooi250_convert_qty(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt021,l_pmdt.pmdt020)
                    RETURNING l_success,l_pmdt.pmdt022
          ELSE
             LET l_pmdt.pmdt022 = ''
          END IF
          
          IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND apmt520_get_imaf144(l_pmdt.pmdt006) THEN
             LET l_pmdt.pmdt023 = l_pmdn.pmdn010   #計價單位
             LET l_rate = 1
             IF NOT cl_null(l_pmdt.pmdt023) THEN
                #CALL s_aimi190_get_convert(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt023) RETURNING l_flag,l_rate
                #LET l_pmdt.pmdt024 = l_pmdt.pmdt020 * l_rate   #計價數量
                CALL s_aooi250_convert_qty(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt023,l_pmdt.pmdt020)
                    RETURNING l_success,l_pmdt.pmdt024
             ELSE
                LET l_pmdt.pmdt023 = l_pmdt.pmdt019
                LET l_pmdt.pmdt024 = l_pmdt.pmdt020
             END IF
          END IF
          
          LET l_pmdt.pmdt025 = l_pmdn.pmdn020   #緊急度
          
          ##檢驗否
          #IF (NOT cl_null(l_pmdt.pmdt009)) AND (NOT cl_null(l_pmdt.pmdt010)) THEN
          #   SELECT qcap006 INTO l_pmdt.pmdt026 FROM qcap_t
          #     WHERE qcapent = g_enterprise AND qcapsite = g_site
          #       AND qcap001 = l_pmdt.pmdt006 AND qcap002 = g_pmds_m.pmds007
          #       AND qcap003 = l_pmdt.pmdt009 AND qcap004 = l_pmdt.pmdt010
          #       AND qcap005 = l_pmdt.pmdt007
          #ELSE
          #   SELECT qcap006 INTO l_pmdt.pmdt026 FROM qcap_t
          #     WHERE qcapent = g_enterprise AND qcapsite = g_site
          #       AND qcap001 = l_pmdt.pmdt006 AND qcap002 = g_pmds_m.pmds007
          #       AND qcap005 = l_pmdt.pmdt007
          #END IF
          #IF cl_null(l_pmdt.pmdt026) THEN
          #   LET l_pmdt.pmdt026 = 'N'
          #END IF
          #
          ##直接收貨入庫時，無需檢驗
          #IF g_argv[1] MATCHES '[34]' THEN
          #   LET l_pmdt.pmdt026 = 'N'
          #END IF
          
          LET l_pmdt.pmdt036 = l_pmdo.pmdo022   #單價
          LET l_pmdt.pmdt046 = l_pmdo.pmdo023   #稅別
          LET l_pmdt.pmdt037 = l_pmdo.pmdo024   #稅率
          
          #未稅金額、含稅金額
          IF (NOT cl_null(l_pmdt.pmdt020)) AND (NOT cl_null(l_pmdt.pmdt036)) AND (NOT cl_null(l_pmdt.pmdt046)) THEN
             CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,l_pmdt.pmdtseq,l_pmdt.pmdt001,l_pmdt.pmdt024,l_pmdt.pmdt036,l_pmdt.pmdt046)
               RETURNING l_pmdt.pmdt038,l_pmdt.pmdt047,l_pmdt.pmdt039   
          END IF
          
          LET l_pmdt.pmdt040 = l_pmdn.pmdn035   #價格核決
          LET l_pmdt.pmdt041 = l_pmdn.pmdn021   #保稅否
          LET l_pmdt.pmdt042 = l_pmdn.pmdn040
          LET l_pmdt.pmdt043 = l_pmdn.pmdn041
          LET l_pmdt.pmdt044 = l_pmdn.pmdn043
          LET l_pmdt.pmdt048 = l_pmdn.pmdn042
          LET l_pmdt.pmdt045 = l_pmdn.pmdn044
          LET l_pmdt.pmdt052 = '1'              #狀態碼 '1:一般'
          LET l_pmdt.pmdt053 = 0
          LET l_pmdt.pmdt054 = 0
          LET l_pmdt.pmdt055 = 0
          LET l_pmdt.pmdt062 = 'N'              #多庫儲批收貨入庫否
          LET l_pmdt.pmdt063 = l_pmdn.pmdn053
          
          LET l_pmdt.pmdt072 = l_pmdn.pmdn036      #專案編號
          LET l_pmdt.pmdt073 = l_pmdn.pmdn037      #WBS
          LET l_pmdt.pmdt074 = l_pmdn.pmdn038      #活動編號
          
          #整體參數未使用採購計價單位,則賦值當前的採購單位和數量
          IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "N" OR (NOT apmt520_get_imaf144(l_pmdt.pmdt006)) THEN
             LET l_pmdt.pmdt023 = l_pmdt.pmdt019
             LET l_pmdt.pmdt024 = l_pmdt.pmdt020
          END IF
          
          LET l_pmdt.pmdt026 = l_pmdn.pmdn052
          
          #直接收貨入庫時，無需檢驗
          IF g_argv[1] MATCHES '[34]' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
             LET l_pmdt.pmdt026 = 'N'
          END IF
          
          #產品特征為null時，給空格
          IF cl_null(l_pmdt.pmdt007) THEN
             LET l_pmdt.pmdt007 = ' '
          END IF 
          
          #數量欄位賦 0
          LET l_pmdt.pmdt056 = 0  
          LET l_pmdt.pmdt057 = 0 
          LET l_pmdt.pmdt058 = 0 
          LET l_pmdt.pmdt066 = 0 
          LET l_pmdt.pmdt067 = 0 
          LET l_pmdt.pmdt068 = 0 
          LET l_pmdt.pmdt069 = 0 
          #自立應付欄位是判斷多角時是不是要自立帳款，所以在一般的採購入庫/倉退與銷售出貨/銷退流程新增時,此欄位均預設為’Y’
          IF g_argv[1] MATCHES '[3467]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '20' THEN
             LET l_pmdt.pmdt084 = 'Y'
          ELSE
             LET l_pmdt.pmdt084 = 'N'
          END IF
          LET l_pmdt.pmdt088 = ''
          LET l_pmdt.pmdt089 = ''
          
          #若单据别对应的参数“是否依客户/厂商做库存管理”='Y'，则将供应商编号带入到此栏位
          IF g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' THEN
             CALL s_aooi200_get_slip(g_pmds_m.pmdsdocno) RETURNING l_success,l_ooba002
             IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-BAS-0090') = 'Y' THEN
                LET l_pmdt.pmdt063 = g_pmds_m.pmds007
             END IF
          END IF
      
          INSERT INTO pmdt_t
              (pmdtent,pmdtsite,pmdtdocno,pmdtseq,
               pmdt001,pmdt002,pmdt003,pmdt004,pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021,pmdt022,
               pmdt008,pmdt023,pmdt024,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047,pmdt026,pmdt041,pmdt016,pmdt017,pmdt018,pmdt063,pmdt040,pmdt051,
               pmdt052,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061,pmdt062,pmdt056,pmdt057,pmdt058,pmdt066,pmdt067,pmdt068,pmdt069,pmdt084,
               pmdt088,pmdt089,pmdt042,pmdt043,pmdt044,pmdt045,pmdt048,
               pmdt072,pmdt073,pmdt074) 
           VALUES(l_pmdt.pmdtent,l_pmdt.pmdtsite,
                  l_pmdt.pmdtdocno,l_pmdt.pmdtseq,
          	      l_pmdt.pmdt001,l_pmdt.pmdt002, 
                  l_pmdt.pmdt003,l_pmdt.pmdt004,l_pmdt.pmdt005, 
                  l_pmdt.pmdt006,l_pmdt.pmdt007,l_pmdt.pmdt009, 
                  l_pmdt.pmdt010,l_pmdt.pmdt025,l_pmdt.pmdt011, 
                  l_pmdt.pmdt019,l_pmdt.pmdt020,l_pmdt.pmdt021, 
                  l_pmdt.pmdt022,l_pmdt.pmdt008,l_pmdt.pmdt023, 
                  l_pmdt.pmdt024,l_pmdt.pmdt036,l_pmdt.pmdt046, 
                  l_pmdt.pmdt037,l_pmdt.pmdt038,l_pmdt.pmdt039,l_pmdt.pmdt047, 
                  l_pmdt.pmdt026,l_pmdt.pmdt041,l_pmdt.pmdt016, 
                  l_pmdt.pmdt017,l_pmdt.pmdt018,l_pmdt.pmdt063,l_pmdt.pmdt040, 
                  l_pmdt.pmdt051,l_pmdt.pmdt052,l_pmdt.pmdt059,
          	      l_pmdt.pmdt053,l_pmdt.pmdt054,l_pmdt.pmdt055,
          	      l_pmdt.pmdt060,l_pmdt.pmdt061,l_pmdt.pmdt062,l_pmdt.pmdt056,l_pmdt.pmdt057,l_pmdt.pmdt058,
          	      l_pmdt.pmdt066,l_pmdt.pmdt067,l_pmdt.pmdt068,l_pmdt.pmdt069,l_pmdt.pmdt084,l_pmdt.pmdt088,l_pmdt.pmdt089,
          	      l_pmdt.pmdt042,l_pmdt.pmdt043,l_pmdt.pmdt044,l_pmdt.pmdt045,l_pmdt.pmdt048,
          	      l_pmdt.pmdt072,l_pmdt.pmdt073,l_pmdt.pmdt074)
          
          IF SQLCA.sqlcode THEN
             LET l_success = FALSE
             EXIT FOREACH
          END IF
          
          #若單頭交易條件、幣別等資料，根據採購單號帶出
          IF cl_null(g_pmds_m.pmds031) OR cl_null(g_pmds_m.pmds032) OR cl_null(g_pmds_m.pmds033) OR cl_null(g_pmds_m.pmds037) OR cl_null(g_pmds_m.pmds012) THEN
             SELECT pmdl009,pmdl010,pmdl011,pmdl012,pmdl013,pmdl015,pmdl016,pmdl023 
                 INTO g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds012
               FROM pmdl_t WHERE pmdlent = g_enterprise AND pmdldocno = l_pmdt.pmdt001
             UPDATE pmds_t SET pmds031 = g_pmds_m.pmds031,
                               pmds032 = g_pmds_m.pmds032,
                               pmds033 = g_pmds_m.pmds033,
                               pmds034 = g_pmds_m.pmds034,
                               pmds035 = g_pmds_m.pmds035,
                               pmds037 = g_pmds_m.pmds037,
                               pmds038 = g_pmds_m.pmds038,
                               pmds012 = g_pmds_m.pmds012
                WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
          END IF
          
          #產生收貨原始需求分配明細資料
          IF NOT s_apmt520_gen_pmdv(l_pmdt.pmdtdocno,l_pmdt.pmdtseq) THEN
             LET l_success = FALSE
             EXIT FOREACH
          END IF
          
          INITIALIZE l_pmdo.* TO NULL
          INITIALIZE l_pmdt.* TO NULL
          INITIALIZE l_pmdn.* TO NULL
          
       END FOREACH
       
       #重新計算整單的未稅、含稅總金額
       CALL s_tax_recount(g_pmds_m.pmdsdocno)
         RETURNING g_pmds_m.pmds043,g_pmds_m.pmds046,g_pmds_m.pmds044,l_xrcd113,l_xrcd114,l_xrcd115
       UPDATE pmds_t SET pmds043 = g_pmds_m.pmds043,
                         pmds044 = g_pmds_m.pmds044,
                         pmds046 = g_pmds_m.pmds046
           WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
       
       #呼叫產生匯總與檢驗狀況的Function來更新匯總與檢驗狀況明細資料
       #IF NOT s_apmt520_gen_pmdu(g_pmds_m.pmdsdocno) THEN
       #   LET l_success = FALSE
       #END IF
            
       #IF NOT l_success THEN
       #   INITIALIZE g_errparam TO NULL
       #   LET g_errparam.code = SQLCA.sqlcode
       #   LET g_errparam.extend = "pmdt_t"
       #   LET g_errparam.popup = TRUE
       #   CALL cl_err()
       #
       #   CALL s_transaction_end('N','0')
       #ELSE
       #   CALL s_transaction_end('Y','0')
       #END IF
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_b4_fill" order="11" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#價格資訊單身填充
PRIVATE FUNCTION apmt520_b4_fill()
DEFINE l_ac4     LIKE type_t.num5
DEFINE l_pmdt002 LIKE pmdt_t.pmdt002
DEFINE l_success LIKE type_t.num5
DEFINE l_pmdt027 LIKE pmdt_t.pmdt027
DEFINE l_pmdt028 LIKE pmdt_t.pmdt028

    CALL g_pmdt4_d.clear()  
   
    LET g_sql = "SELECT  UNIQUE pmdtseq,pmdt001,pmdt002,pmdt003,pmdt004,pmdt027,pmdt028,pmdt005,pmdt006,'','',",
                "        pmdt007,pmdt009,pmdt010,pmdt019,'',pmdt020,",
                "        pmdt023,'',pmdt024,pmdt040,pmdt036,pmdt046,'',pmdt037,pmdt038,pmdt039,pmdt047 FROM pmdt_t", 
                " INNER JOIN pmds_t ON pmdsdocno = pmdtdocno ",
                " WHERE pmdtent=? AND pmdtdocno=?"

    LET g_sql = g_sql, " ORDER BY pmdtseq,pmdt001,pmdt002,pmdt003,pmdt004"

    PREPARE apmt520_pb4 FROM g_sql
    DECLARE b_fill_cs4 CURSOR FOR apmt520_pb4
    
    LET l_ac4 = 1
    
    OPEN b_fill_cs4 USING g_enterprise,g_pmds_m.pmdsdocno
                                      
    FOREACH b_fill_cs4 INTO g_pmdt4_d[l_ac4].pmdtseq,g_pmdt4_d[l_ac4].pmdt001,g_pmdt4_d[l_ac4].pmdt002,g_pmdt4_d[l_ac4].pmdt003,g_pmdt4_d[l_ac4].pmdt004,
                            l_pmdt027,l_pmdt028,
                            g_pmdt4_d[l_ac4].pmdt005,g_pmdt4_d[l_ac4].pmdt006,g_pmdt4_d[l_ac4].imaal003,g_pmdt4_d[l_ac4].imaal004,
	                         g_pmdt4_d[l_ac4].pmdt007,g_pmdt4_d[l_ac4].pmdt009,g_pmdt4_d[l_ac4].pmdt010,g_pmdt4_d[l_ac4].pmdt019, 
                            g_pmdt4_d[l_ac4].pmdt019_desc,g_pmdt4_d[l_ac4].pmdt020,g_pmdt4_d[l_ac4].pmdt023,g_pmdt4_d[l_ac4].pmdt023_desc,
                            g_pmdt4_d[l_ac4].pmdt024,g_pmdt4_d[l_ac4].pmdt040,g_pmdt4_d[l_ac4].pmdt036,g_pmdt4_d[l_ac4].pmdt046, 
                            g_pmdt4_d[l_ac4].pmdt046_desc,g_pmdt4_d[l_ac4].pmdt037,g_pmdt4_d[l_ac4].pmdt038,g_pmdt4_d[l_ac4].pmdt039,
                            g_pmdt4_d[l_ac4].pmdt047
       
	    IF SQLCA.sqlcode THEN
           INITIALIZE g_errparam TO NULL
           LET g_errparam.code = SQLCA.sqlcode
           LET g_errparam.extend = "FOREACH:"
           LET g_errparam.popup = TRUE
           CALL cl_err()

           EXIT FOREACH
        END IF
        
        #驗退、入庫、倉退時，價格資訊頁簽的採購單號、項次等欄位，
        #需根據驗退、入庫、倉退單上的收貨單號和項次，獲取相關的採購信息
        IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
           #LET l_pmdt002 = g_pmdt4_d[l_ac4].pmdt002
           SELECT pmdt001,pmdt002,pmdt003,pmdt004 INTO g_pmdt4_d[l_ac4].pmdt001,g_pmdt4_d[l_ac4].pmdt002,g_pmdt4_d[l_ac4].pmdt003,g_pmdt4_d[l_ac4].pmdt004
              FROM pmdt_t
            WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmds006 AND pmdtseq = l_pmdt028
        END IF

        CALL s_desc_get_item_desc(g_pmdt4_d[l_ac4].pmdt006) RETURNING g_pmdt4_d[l_ac4].imaal003,g_pmdt4_d[l_ac4].imaal004
        DISPLAY BY NAME g_pmdt4_d[l_ac4].imaal003,g_pmdt4_d[l_ac4].imaal004
        
        CALL s_feature_description(g_pmdt4_d[l_ac4].pmdt006,g_pmdt4_d[l_ac4].pmdt007) RETURNING l_success,g_pmdt4_d[l_ac4].pmdt007_desc
        DISPLAY BY NAME g_pmdt4_d[l_ac4].pmdt007_desc
        
        CALL s_desc_get_unit_desc(g_pmdt4_d[l_ac4].pmdt019) RETURNING g_pmdt4_d[l_ac4].pmdt019_desc
        DISPLAY BY NAME g_pmdt4_d[l_ac4].pmdt019_desc

        CALL s_desc_get_unit_desc(g_pmdt4_d[l_ac4].pmdt023) RETURNING g_pmdt4_d[l_ac4].pmdt023_desc
        DISPLAY BY NAME g_pmdt4_d[l_ac4].pmdt023_desc
        
        CALL apmt520_pmds033_ref(g_pmdt4_d[l_ac4].pmdt046) RETURNING g_pmdt4_d[l_ac4].pmdt046_desc
        DISPLAY BY NAME g_pmdt4_d[l_ac4].pmdt046_desc
    
       LET l_ac4 = l_ac4 + 1
       IF l_ac4 > g_max_rec AND g_error_show = 1 THEN
          INITIALIZE g_errparam TO NULL
          LET g_errparam.code =  9035
          LET g_errparam.extend =  ''
          LET g_errparam.popup = TRUE
          CALL cl_err()

          EXIT FOREACH
       END IF
       
    END FOREACH
    LET g_error_show = 0
    
    CALL g_pmdt4_d.deleteElement(g_pmdt4_d.getLength())
 
    FREE apmt520_pb4
 
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds007_chk" order="12" ver="9" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#採購供應商檢查
PRIVATE FUNCTION apmt520_pmds007_chk(p_pmds007)
DEFINE p_pmds007    LIKE pmds_t.pmds007
DEFINE l_success    LIKE type_t.num5
DEFINE l_flag       LIKE type_t.num5
DEFINE r_success    LIKE type_t.num5
DEFINE l_pmdt006    LIKE pmdt_t.pmdt006
DEFINE l_pmdt007    LIKE pmdt_t.pmdt007
DEFINE l_pmdt009    LIKE pmdt_t.pmdt009
DEFINE l_pmdt010    LIKE pmdt_t.pmdt010

       LET r_success = TRUE
       
       IF NOT cl_null(p_pmds007) THEN 
          #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
          INITIALIZE g_chkparam.* TO NULL
          
          #設定g_chkparam.*的參數
          LET g_chkparam.arg1 = p_pmds007
   
          #呼叫檢查存在並帶值的library
          IF NOT cl_chk_exist("v_pmaa001_1") THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
          
          #檢核輸入的供應商是否在單據別限制範圍內，若不在限制內則不允許跟此供應商採購
          CALL s_control_chk_doc('2',g_pmds_m.pmdsdocno,p_pmds007,'','','','') RETURNING l_success,l_flag
          IF NOT l_success THEN      #处理状态
             LET r_success = FALSE
             RETURN r_success
          ELSE
             IF NOT l_flag THEN      #是否存在
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00239'
                LET g_errparam.extend = p_pmds007
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF 
          END IF
          
          DECLARE pmdt_cs CURSOR FOR
            SELECT pmdt006,pmdt007,pmdt009,pmdt010 FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno =  g_pmds_m.pmdsdocno
          FOREACH pmdt_cs INTO l_pmdt006,l_pmdt007,l_pmdt009,l_pmdt010
             #收貨單在維護料號時需檢核料件AVL控管點(imaa044)設置，若是設置'2:可採購，不可收貨'時，則要檢核
             #其他收貨、無採購收貨、收貨入庫單等作業也需考慮
             IF g_argv[1] MATCHES '[123489]' OR g_argv[1] = '20' THEN
                IF NOT s_apmt520_item_avl_chk(g_pmds_m.pmdsdocdt,l_pmdt006,l_pmdt007,l_pmdt009,l_pmdt010,p_pmds007) THEN
                   LET r_success = FALSE
                   RETURN r_success
                END IF
             END IF
          END FOREACH
       END IF 
       
       RETURN r_success
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds007_desc" order="13" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#根据供应商带值
PRIVATE FUNCTION apmt520_pmds007_desc()
DEFINE l_n         LIKE type_t.num5
DEFINE l_ooef016   LIKE ooef_t.ooef016
DEFINE l_success   LIKE type_t.num5
DEFINE l_controlno LIKE ooha_t.ooha001
DEFINE l_scc40     LIKE type_t.chr2
DEFINE l_oodbl004  LIKE oodbl_t.oodbl004  #稅別名稱
DEFINE l_oodb005   LIKE oodb_t.oodb005    #含稅否
DEFINE l_oodb006   LIKE oodb_t.oodb006    #稅率 
DEFINE l_oodb011   LIKE oodb_t.oodb011    #取得稅別類型1:正常稅率2:依料件設定
DEFINE l_pmaa086   LIKE pmaa_t.pmaa086    #預設採購員   #2015/03/03 by stellar add
DEFINE l_pmaa087   LIKE pmaa_t.pmaa087    #預設採購部門 #2015/03/03 by stellar add
DEFINE l_pmds002_o LIKE pmds_t.pmds002    #2015/03/04 by stellar add
DEFINE l_pmds003_o LIKE pmds_t.pmds003    #2015/03/04 by stellar add


      #抓取交易對象夥伴關係檔且交易類型為"1:收/付款對象"的交易對象顯示在採購單上的
      #[C:帳款供應商]，若有設置多筆收/付款交易對象時，則取有勾選主要的交易對象那一個，
      #若沒有設交易對象夥伴關係檔且交易類型為"1:收/付款對象"的交易對象時，則[C:帳款供應商]預設採購供應商
      LET g_pmds_m.pmds008 = ''
      LET g_pmds_m.pmds008_desc = ''
      SELECT pmac002 INTO g_pmds_m.pmds008 FROM pmac_t WHERE pmacent = g_enterprise AND pmac001 = g_pmds_m.pmds007 AND pmac003 = '1' AND pmacstus = 'Y' AND pmac004 = 'Y'
      IF cl_null(g_pmds_m.pmds008) THEN
         SELECT pmac002 INTO g_pmds_m.pmds008 FROM pmac_t WHERE pmacent = g_enterprise AND pmac001 = g_pmds_m.pmds007 AND pmac003 = '1' AND pmacstus = 'Y' AND rownum = 1
         IF cl_null(g_pmds_m.pmds008) THEN
            LET g_pmds_m.pmds008 = g_pmds_m.pmds007
         END IF
      END IF
      CALL apmt520_pmds007_ref(g_pmds_m.pmds008) RETURNING g_pmds_m.pmds008_desc
      DISPLAY BY NAME g_pmds_m.pmds008,g_pmds_m.pmds008_desc
      
      #抓取交易對象夥伴關係檔且交易類型為"2:出貨對象"的交易對象顯示在採購單上的[C:送貨供應商]，
      #若有設置多筆出貨交易對象時，則取有勾選主要的交易對象那一個，
      #若沒有設交易對象夥伴關係檔且交易類型為"2:出貨對象"的交易對象時，則[C:送貨供應商]預設採購供應商
      LET g_pmds_m.pmds009 = ''
      LET g_pmds_m.pmds009_desc = ''
      SELECT pmac002 INTO g_pmds_m.pmds009 FROM pmac_t WHERE pmacent = g_enterprise AND pmac001 = g_pmds_m.pmds007 AND pmac003 = '2' AND pmacstus = 'Y' AND pmac004 = 'Y'
      IF cl_null(g_pmds_m.pmds009) THEN
         SELECT pmac002 INTO g_pmds_m.pmds009 FROM pmac_t WHERE pmacent = g_enterprise AND pmac001 = g_pmds_m.pmds007 AND pmac003 = '2' AND pmacstus = 'Y' AND rownum = 1
         IF cl_null(g_pmds_m.pmds009) THEN
            LET g_pmds_m.pmds009 = g_pmds_m.pmds007
         END IF
      END IF
      CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
      DISPLAY BY NAME g_pmds_m.pmds009,g_pmds_m.pmds009_desc
      
      #無採購單來源時，根據採購供應商帶出相關財務資訊;倉退時，未錄入來源收貨單號，也要根據供應商帶值
      IF g_argv[1] MATCHES '[24]' OR ((g_argv[1] MATCHES '[137]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') AND cl_null(g_pmds_m.pmds006)) THEN
         LET l_n = 0
         LET g_pmds_m.pmds031 = ''
         LET g_pmds_m.pmds031_desc = ''
         LET g_pmds_m.pmds032 = ''
         LET g_pmds_m.pmds032_desc = ''
         LET g_pmds_m.pmds033 = ''
         LET g_pmds_m.pmds033_desc = ''
         LET g_pmds_m.pmds034 = ''
         LET g_pmds_m.pmds035 = ''
         LET g_pmds_m.pmds037 = ''
         LET g_pmds_m.pmds037_desc = ''
         LET g_pmds_m.pmds038 = ''
         LET g_pmds_m.pmds039 = ''
         LET g_pmds_m.pmds039_desc = ''
         LET g_pmds_m.pmds048 = ''
         LET g_pmds_m.pmds049 = ''
         
         #2015/03/04 by stellar add ----- (S)
         LET l_pmds002_o = g_pmds_m.pmds002
         LET l_pmds003_o = g_pmds_m.pmds003
         LET g_pmds_m.pmds002 = ''
         LET g_pmds_m.pmds002_desc = ''
         LET g_pmds_m.pmds003 = ''
         LET g_pmds_m.pmds003_desc = ''
         #2015/03/04 by stellar add ----- (E)
         
         #先判斷這個供應商是否有設多個當前採購控制組範圍內的供應商預設條件，則開窗，讓user 選擇帶哪一個控制組的資料
         #LET l_controlno = ''
         #CALL s_control_get_group('4',g_user,g_dept) RETURNING l_success,l_controlno
         IF cl_null(g_controlno) THEN
            CALL s_control_get_group('4',g_user,g_dept) RETURNING l_success,g_controlno
         END IF
         #IF NOT cl_null(l_controlno) THEN
         IF NOT cl_null(g_controlno) THEN
            #判斷供應商是否有設置採購控制組供應商預設條件(apmi110)，若有則抓取相關的預設條件default到採購單上
            SELECT COUNT(*) INTO l_n FROM pmal_t 
               WHERE pmalent = g_enterprise AND pmal001 = g_pmds_m.pmds007 
                 #AND pmal002 = l_controlno 
                 AND pmal002 = g_controlno 
                 AND pmalstus = 'Y'
            IF l_n > 0 THEN
               SELECT pmal006,pmal020,pmal004,pmal003,pmal021,pmal023,pmal024,pmal008 
                     ,pmal019,pmal025   #2015/03/04 by stellar add
                 INTO g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds037,g_pmds_m.pmds039,g_pmds_m.pmds048,g_pmds_m.pmds049,g_pmds_m.pmds012
                     ,g_pmds_m.pmds002,g_pmds_m.pmds003   #2015/03/04 by stellar add
               FROM pmal_t WHERE pmalent = g_enterprise AND pmal001 = g_pmds_m.pmds007 
                             #AND pmal002 = l_controlno
                             AND pmal002 = g_controlno
                             AND pmalstus = 'Y'
            END IF
         END IF
         
         #若沒有設置採購控制組供應商預設條件資料則改抓供應商據點預設條件(apmm202)資料  
         #IF cl_null(l_controlno) OR l_n = 0 THEN
         IF cl_null(g_controlno) OR l_n = 0 THEN
            SELECT pmab037,pmab053,pmab034,pmab033,pmab054,pmab057,pmab058,pmab038
                  ,pmab031,pmab059   #2015/03/04 by stellar add
                INTO g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds037,g_pmds_m.pmds039,g_pmds_m.pmds048,g_pmds_m.pmds049,g_pmds_m.pmds012
                    ,g_pmds_m.pmds002,g_pmds_m.pmds003   #2015/03/04 by stellar add
              FROM pmab_t WHERE pmabent = g_enterprise AND pmabsite = g_site AND pmab001 = g_pmds_m.pmds007
              
         END IF
         
         #2015/03/04 by stellar add ----- (S)
         IF cl_null(g_pmds_m.pmds002) OR cl_null(g_pmds_m.pmds003) THEN
            LET l_pmaa086 = ''
            LET l_pmaa087 = ''
            SELECT pmaa086,pmaa087 INTO l_pmaa086,l_pmaa087
              FROM pmaa_t
             WHERE pmaaent = g_enterprise
               AND pmaa001 = g_pmds_m.pmds007
            IF cl_null(g_pmds_m.pmds002) THEN
               LET g_pmds_m.pmds002 = l_pmaa086
            END IF
            
            IF cl_null(g_pmds_m.pmds003) THEN
               LET g_pmds_m.pmds003 = l_pmaa087
            END IF
         END IF
         
         IF NOT cl_null(g_pmds_m.pmds002) AND cl_null(g_pmds_m.pmds003) THEN
            SELECT ooag003 INTO g_pmds_m.pmds003
              FROM ooag_t 
             WHERE ooagent = g_enterprise 
               AND ooag001 = g_pmds_m.pmds002
         END IF
         
         IF cl_null(g_pmds_m.pmds002) THEN
            LET g_pmds_m.pmds002 = l_pmds002_o
         END IF
         
         IF cl_null(g_pmds_m.pmds003) THEN
            LET g_pmds_m.pmds003 = l_pmds003_o
         END IF
            
         CALL s_desc_get_person_desc(g_pmds_m.pmds002) RETURNING g_pmds_m.pmds002_desc
         CALL s_desc_get_department_desc(g_pmds_m.pmds003) RETURNING g_pmds_m.pmds003_desc
         
         DISPLAY BY NAME g_pmds_m.pmds002,g_pmds_m.pmds002_desc,
                         g_pmds_m.pmds003,g_pmds_m.pmds003_desc
         #2015/03/04 by stellar add ----- (E)
         
         #取得採購通路
         LET g_pmab039 = g_pmds_m.pmds012
         #取稅率、單價含稅否
         IF NOT cl_null(g_pmds_m.pmds033) THEN
            LET l_oodb005 = ''
            LET l_oodb006 = ''
            LET l_oodb011 = ''
            CALL s_tax_chk(g_site,g_pmds_m.pmds033)
              RETURNING l_success,l_oodbl004,l_oodb005,l_oodb006,l_oodb011
              
            IF l_success THEN
               LET g_tax_app = l_oodb011
               LET g_pmds_m.pmds034 = l_oodb006
               LET g_pmds_m.pmds035 = l_oodb005
               LET g_pmds_m.pmds033_desc = l_oodbl004
            END IF           
         END IF
    
         
         #取匯率
         IF NOT cl_null(g_pmds_m.pmds037) THEN
            #根據內外購獲取當前營運據點參數設置的汇率类型
            LET l_scc40 = ''
            IF g_pmds_m.pmds048 = '1' THEN   #內購
               LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0014')
            END IF
            IF g_pmds_m.pmds048 = '2' THEN   #外購
               LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0015')
            END IF
            LET l_ooef016 = ''
            SELECT ooef016 INTO l_ooef016 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
            IF (NOT cl_null(l_scc40)) AND (NOT cl_null(l_ooef016)) THEN
               CALL s_aooi160_get_exrate('1',g_site,g_today,g_pmds_m.pmds037,l_ooef016,0,l_scc40) RETURNING g_pmds_m.pmds038
            END IF
         END IF
         
         CALL s_desc_get_ooib002_desc(g_pmds_m.pmds031) RETURNING g_pmds_m.pmds031_desc
         DISPLAY BY NAME g_pmds_m.pmds031_desc
         
         CALL s_desc_get_acc_desc('238',g_pmds_m.pmds032) RETURNING g_pmds_m.pmds032_desc
         DISPLAY BY NAME g_pmds_m.pmds032_desc
         
         CALL apmt520_pmds033_ref(g_pmds_m.pmds033) RETURNING g_pmds_m.pmds033_desc
         DISPLAY BY NAME g_pmds_m.pmds033_desc
         
         CALL s_desc_get_currency_desc(g_pmds_m.pmds037) RETURNING g_pmds_m.pmds037_desc
         DISPLAY BY NAME g_pmds_m.pmds037_desc
         
         CALL s_desc_get_price_type_desc(g_pmds_m.pmds039) RETURNING g_pmds_m.pmds039_desc
         DISPLAY BY NAME g_pmds_m.pmds039_desc
            
         DISPLAY BY NAME g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds037,g_pmds_m.pmds039,
                         g_pmds_m.pmds048,g_pmds_m.pmds049,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds038
                         
      END IF
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds008_chk" order="14" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#帳款供應商檢查
PRIVATE FUNCTION apmt520_pmds008_chk()
DEFINE r_success    LIKE type_t.num5

       LET r_success = TRUE
       
       IF NOT cl_null(g_pmds_m.pmds008) AND (g_pmds_m.pmds008 != g_pmds_m.pmds007) THEN 
          IF NOT apmt520_pmds007_chk(g_pmds_m.pmds008) THEN
              LET r_success = FALSE
              RETURN r_success
          END IF
          
          #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
          INITIALIZE g_chkparam.* TO NULL
          
          #設定g_chkparam.*的參數
          LET g_chkparam.arg1 = g_pmds_m.pmds007
          LET g_chkparam.arg2 = g_pmds_m.pmds008
          LET g_chkparam.arg3 = g_site
             
          #呼叫檢查存在並帶值的library
          IF NOT cl_chk_exist("v_pmac002") THEN
             LET r_success = FALSE
             RETURN r_success
          END IF  
       END IF 
       RETURN r_success
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds009_chk" order="15" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#送貨供應商檢查
PRIVATE FUNCTION apmt520_pmds009_chk()
DEFINE r_success    LIKE type_t.num5
DEFINE l_n          LIKE type_t.num5

       LET r_success = TRUE
       
       IF NOT cl_null(g_pmds_m.pmds009) THEN
          IF (g_pmds_m.pmds009 != g_pmds_m.pmds007) THEN 
             IF NOT apmt520_pmds007_chk(g_pmds_m.pmds009) THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
             
             #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
             INITIALIZE g_chkparam.* TO NULL
             
             #設定g_chkparam.*的參數
             LET g_chkparam.arg1 = g_pmds_m.pmds007
             LET g_chkparam.arg2 = g_pmds_m.pmds009
             LET g_chkparam.arg3 = g_site
             
             #呼叫檢查存在並帶值的library
             IF NOT cl_chk_exist("v_pmac002_2") THEN
                LET r_success = FALSE
                RETURN r_success
             END IF
          END IF
          #當收貨單頭有輸入採購單號時，則輸入的送貨供應商需存在[T:採購明細檔].[C:送貨供應商]，
          #檢核條件如下:pmdndocno = pmds006   pmdn023  = pmds009
          IF (NOT cl_null(g_pmds_m.pmds006)) AND (g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20') THEN
             LET l_n = 0
             SELECT COUNT(*) INTO l_n FROM pmdn_t 
               WHERE pmdnent = g_enterprise AND pmdndocno = g_pmds_m.pmds006 AND pmdn023 = g_pmds_m.pmds009
             IF l_n = 0 OR cl_null(l_n) THEN
                INITIALIZE g_errparam TO NULL
                LET g_errparam.code = 'apm-00406'
                LET g_errparam.extend = g_pmds_m.pmds009
                LET g_errparam.popup = TRUE
                CALL cl_err()

                LET r_success = FALSE
                RETURN r_success
             END IF
             
          END IF
       END IF 
       
       RETURN r_success
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_unit_chk" order="16" ver="2" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#單位檢查
PRIVATE FUNCTION apmt520_unit_chk(p_pmdt019)
DEFINE p_pmdt019    LIKE pmdt_t.pmdt019
DEFINE r_success    LIKE type_t.num5

       LET r_success = TRUE

       IF NOT cl_null(p_pmdt019) THEN
          #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
          INITIALIZE g_chkparam.* TO NULL

          #設定g_chkparam.*的參數
          LET g_chkparam.arg1 = g_pmdt_d[l_ac].pmdt006
          LET g_chkparam.arg2 = p_pmdt019

          #呼叫檢查存在並帶值的library
          IF NOT cl_chk_exist("v_imao002") THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
       END IF
       RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.apmt520_upd_pmds001" order="17" ver="9" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#維護扣帳日期:開放單頭[C:扣帳日期]欄位維護
PRIVATE FUNCTION apmt520_upd_pmds001()
DEFINE r_success    LIKE type_t.num5
DEFINE l_pmdsmoddt  LIKE pmds_t.pmdsmoddt
DEFINE l_gzsz008    LIKE gzsz_t.gzsz008
DEFINE l_forupd_sql STRING

   LET r_success = TRUE
   LET l_gzsz008 = ''

   IF g_pmds_m.pmdsdocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF

   SELECT UNIQUE pmdssite,pmds000,pmdsdocno,pmdsdocdt,pmds002,pmds001,pmds003,pmdsstus,pmds006,pmds007, 
          pmds008,pmds009,pmds010,pmds011,pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033, 
          pmds034,pmds035,pmds036,pmds037,pmds038,pmds039,pmds040,pmds041,pmds042,pmds043,pmds044,pmds046, 
          pmdsownid,pmdsowndp,pmdscrtid,pmdscrtdp,pmdscrtdt,pmdsmodid,pmdsmoddt,pmdscnfid,pmdscnfdt,pmdspstid, 
          pmdspstdt
   INTO g_pmds_m.pmdssite,g_pmds_m.pmds000,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds002,g_pmds_m.pmds001, 
       g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009, 
       g_pmds_m.pmds010,g_pmds_m.pmds011,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023, 
       g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035, 
       g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,g_pmds_m.pmds041, 
       g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt
   FROM pmds_t
   WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
 
   ERROR ""
  
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
   LET l_forupd_sql = "SELECT pmdssite,pmdsdocno,pmdsdocdt,pmds002,'','',pmds001,pmds003, ",
                      " '',pmdsstus,pmds006,pmds007,'',pmds008,'',pmds009,'',pmds010,pmds000,pmds100,pmds011,pmds081, ",
                      " pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,'',pmds032,'',pmds033,'',pmds034,pmds035,pmds036,", 
                      " pmds037,'',pmds038,pmds039,'',pmds040,'',pmds041,pmds042,pmds043,pmds044,pmds046,pmdsownid,'', ",
                      " pmdsowndp,'',pmdscrtid,'',pmdscrtdp,'',pmdscrtdt,pmdsmodid,'',pmdsmoddt,pmdscnfid,'',pmdscnfdt, ",
                      " pmdspstid,'',pmdspstdt FROM pmds_t WHERE pmdsent= ? AND pmdsdocno=? FOR UPDATE"
  
   LET l_forupd_sql = cl_sql_forupd(l_forupd_sql)                #轉換不同資料庫語法
   DECLARE apmt520_cl2 CURSOR FROM l_forupd_sql
   
   OPEN apmt520_cl2 USING g_enterprise,g_pmds_m.pmdsdocno
 
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN apmt520_cl2:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE apmt520_cl2
      RETURN r_success
   END IF
 
   #鎖住將被更改或取消的資料
   FETCH apmt520_cl2 INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,
       g_pmds_m.pmds002,g_pmds_m.pmds002_desc,g_pmds_m.pmdsdocno_desc,g_pmds_m.pmds001,
       g_pmds_m.pmds003,g_pmds_m.pmds003_desc,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,
       g_pmds_m.pmds007_desc,g_pmds_m.pmds008,g_pmds_m.pmds008_desc,g_pmds_m.pmds009,g_pmds_m.pmds009_desc,
       g_pmds_m.pmds010,g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds081,g_pmds_m.pmds045,
       g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds031_desc,
       g_pmds_m.pmds032,g_pmds_m.pmds032_desc,g_pmds_m.pmds033,g_pmds_m.pmds033_desc,g_pmds_m.pmds034,
       g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds037_desc,g_pmds_m.pmds038,g_pmds_m.pmds039,
       g_pmds_m.pmds039_desc,g_pmds_m.pmds040,g_pmds_m.pmds040_desc,g_pmds_m.pmds041,g_pmds_m.pmds042,
       g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmdsownid,g_pmds_m.pmdsownid_desc,
       g_pmds_m.pmdsowndp,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtid_desc,g_pmds_m.pmdscrtdp,
       g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdsmoddt,
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstid_desc,
       g_pmds_m.pmdspstdt
 
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_pmds_m.pmdsdocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE apmt520_cl2
      RETURN r_success
   END IF
   
   LET g_pmds_m_t.pmds001 = g_pmds_m.pmds001
   
   CALL apmt520_show()

   INPUT BY NAME g_pmds_m.pmds001 WITHOUT DEFAULTS

      AFTER INPUT
         #若取消則直接結束
         IF INT_FLAG THEN
            LET INT_FLAG = FALSE
            LET r_success = FALSE
            CLOSE apmt520_cl2
            RETURN r_success
         END IF

      AFTER FIELD pmds001
         #維護的日期不可小於成本關帳日
         LET l_gzsz008 = cl_get_para(g_enterprise,g_site,'S-MFG-0031')
         IF g_pmds_m.pmds001 <= l_gzsz008 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'sub-00306'
            LET g_errparam.extend = g_pmds_m.pmds001
            LET g_errparam.popup = TRUE
            CALL cl_err()
            CLOSE apmt520_cl2
            LET r_success = FALSE
            RETURN r_success
            
         END IF
         #扣賬日期不可小於單據日期
         IF g_pmds_m.pmds001 < g_pmds_m.pmdsdocdt THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'axm-00267'
            LET g_errparam.extend = g_pmds_m.pmds001
            LET g_errparam.popup = TRUE
            CALL cl_err()
            LET g_pmds_m.pmds001 = g_pmds_m_t.pmds001
            NEXT FIELD CURRENT
            
         END IF
      #維護的日期不可大於現行年月，錯誤訊息「扣帳日期大於會計年度期別，請重新輸入]

   END INPUT

   IF INT_FLAG OR g_pmds_m.pmds001 IS NULL THEN
      LET INT_FLAG = 0
      LET r_success = FALSE
      CLOSE apmt520_cl2
      RETURN r_success
   END IF

   LET l_pmdsmoddt = cl_get_current()

   UPDATE pmds_t SET pmds001 = g_pmds_m.pmds001,
                     pmdsmodid = g_user,
                     pmdsmoddt = l_pmdsmoddt
     WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno

   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "pmds_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      CLOSE apmt520_cl2
      RETURN r_success
   END IF

   CLOSE apmt520_cl2
   RETURN r_success
   
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds033_ref" order="18" ver="2" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#稅別說明
PRIVATE FUNCTION apmt520_pmds033_ref(p_pmds033)
DEFINE p_pmds033      LIKE pmds_t.pmds033
DEFINE l_ooef019      LIKE ooef_t.ooef019
DEFINE r_oodbl004     LIKE oodbl_t.oodbl004

       LET r_oodbl004 = ''
       SELECT ooef019 INTO l_ooef019 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site 
       CALL s_desc_get_tax_desc(l_ooef019,p_pmds033) RETURNING r_oodbl004
       RETURN r_oodbl004
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_set_no_required_b" order="19" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION apmt520_set_no_required_b()
    
    CALL cl_set_comp_required("pmdt016,pmdt063",FALSE)
    CALL cl_set_comp_required("pmdt028",FALSE)
    CALL cl_set_comp_required("pmdt081,pmdt082",FALSE)
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_set_required_b" order="20" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION apmt520_set_required_b()
DEFINE l_imaf055  LIKE imaf_t.imaf055

   #驗退、入庫時，收貨單號必須錄入  
    #IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
    IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25'  THEN
       CALL cl_set_comp_required("pmdt028",TRUE)
       IF g_pmdt_d[l_ac].pmdt026 = 'Y' THEN
          CALL cl_set_comp_required("pmdt081,pmdt082",TRUE)
       END IF
    END IF
   
   LET l_imaf055 = ''
   SELECT imaf055 INTO l_imaf055 FROM imaf_t WHERE imafent = g_enterprise AND imaf001 = g_pmdt_d[l_ac].pmdt006 AND imafsite = g_site
   
   #若設定imaf055(庫存管理特徵)等於'1.必須有庫存管理特徵'時，則[C:庫存管理特徵]欄位必須輸入
   IF l_imaf055 = '1' THEN
      CALL cl_set_comp_required("pmdt063",TRUE)
   END IF
     
   #收貨入庫時，庫位不可為空
   IF g_argv[1] MATCHES '[34]' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
      CALL cl_set_comp_required("pmdt016",TRUE)
   END IF
   
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt051_chk" order="21" ver="2" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#理由碼檢查
PRIVATE FUNCTION apmt520_pmdt051_chk(p_pmdt051)
DEFINE p_pmdt051  LIKE pmdt_t.pmdt051
DEFINE l_success  LIKE type_t.num5
DEFINE r_success  LIKE type_t.num5
DEFINE l_flag     LIKE type_t.num5

        LET r_success = TRUE

        IF NOT cl_null(p_pmdt051) THEN
           CALL s_azzi650_chk_exist(g_acc,p_pmdt051) RETURNING l_success
           IF NOT l_success THEN
               LET r_success = FALSE
               RETURN r_success
           END IF

           #s_control_chk_doc('8',pmdsdocno,pmdt051,'','','','')?用元件，
           #檢核輸入的理由碼是否在單據別限制範圍內，若不在限制內則不允許使用此理由碼
           CALL s_control_chk_doc('8',g_pmds_m.pmdsdocno,p_pmdt051,'','','','') RETURNING l_success,l_flag
           IF NOT r_success THEN
              LET r_success = FALSE
              RETURN r_success
           ELSE
              IF NOT l_flag THEN
                 LET r_success = FALSE
                 RETURN r_success
              END IF
           END IF
        END IF
        RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.apmt520_set_no_required" order="22" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION apmt520_set_no_required()
    
    CALL cl_set_comp_required("pmds006",FALSE)
    CALL cl_set_comp_required("pmdt081,pmdt082",FALSE)
    CALL cl_set_comp_required("pmds031,pmds032,pmds033",FALSE)
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_set_required" order="23" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION apmt520_set_required()
    #驗退、入庫時，收貨單號必須錄入  
    #IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
    IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25'  THEN
       CALL cl_set_comp_required("pmds006",TRUE)
    END IF
    
    IF cl_get_para(g_enterprise,g_site,'S-MFG-0001') = "Y" THEN  #是否使用品質判定功能
       CALL cl_set_comp_required("pmdt081,pmdt082",TRUE)
    END IF
    IF g_argv[1] MATCHES '[12345689]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '20' THEN
       CALL cl_set_comp_required("pmds031,pmds032,pmds033",TRUE)
    END IF
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt028_desc" order="24" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#驗退、入庫、倉退時，根據收貨單號和項次帶出相關的資料
PRIVATE FUNCTION apmt520_pmdt028_desc()
DEFINE l_pmdt020   LIKE pmdt_t.pmdt020
DEFINE l_qcba017   LIKE qcba_t.qcba017
DEFINE l_qcba023   LIKE qcba_t.qcba023
DEFINE l_success   LIKE type_t.num5
DEFINE l_rate      LIKE inaj_t.inaj014
DEFINE l_qcbc009   LIKE qcbc_t.qcbc009
DEFINE l_qcbc013   LIKE qcbc_t.qcbc013
DEFINE l_n         LIKE type_t.num5
DEFINE l_pmdt090   LIKE pmdt_t.pmdt090


       IF (NOT cl_null(g_pmds_m.pmds006)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt028)) THEN
          LET g_pmdt_d[l_ac].pmdt081 = ''
          LET g_pmdt_d[l_ac].pmdt082 = ''
          LET g_pmdt_d[l_ac].pmdt083 = ''
          LET g_pmdt_d[l_ac].pmdt005 = ''  #子特性
          LET g_pmdt_d[l_ac].pmdt019 = ''  #單位
          LET g_pmdt_d[l_ac].pmdt020 = 0   #數量
          LET g_pmdt_d[l_ac].pmdt006 = ''  #收貨料號
          LET g_pmdt_d[l_ac].pmdt007 = ''  #收貨產品特徵
          LET g_pmdt_d[l_ac].pmdt036 = 0    #單價
          LET g_pmdt_d[l_ac].pmdt046 = ''   #稅別
          LET g_pmdt_d[l_ac].pmdt037 = 0    #稅率
          LET g_pmdt_d[l_ac].pmdt008 = ''   #包裝容器
          LET g_pmdt_d[l_ac].pmdt009 = ''   #作業編號
          LET g_pmdt_d[l_ac].pmdt010 = ''   #製程序
          LET g_pmdt_d[l_ac].pmdt021 = ''   #參考單位
          LET g_pmdt_d[l_ac].pmdt022 = 0    #參考數量
          LET g_pmdt_d[l_ac].pmdt023 = ''   #計價單位
          LET g_pmdt_d[l_ac].pmdt024 = 0    #計價數量
          LET g_pmdt_d[l_ac].pmdt025 = ''   #緊急度
          LET g_pmdt_d[l_ac].pmdt016 = ''   #庫位
          LET g_pmdt_d[l_ac].pmdt017 = ''   #儲位
          LET g_pmdt_d[l_ac].pmdt018 = ''   #批號
          LET g_pmdt_d[l_ac].pmdt040 = ''   #價格類型
          LET g_pmdt_d[l_ac].pmdt041 = ''   #保稅
          LET g_pmdt_d[l_ac].pmdt059 = ''   #備註
          LET g_pmdt_d[l_ac].pmdt090 = 0
          LET g_pmdt_d[l_ac].pmdt091 = 0
          LET g_pmdt_d[l_ac].pmdt092 = 0
          LET g_pmdt_d[l_ac].pmdt093 = 0
          
          
          SELECT pmdt001,pmdt002,pmdt003,pmdt004,pmdt005,pmdt006,pmdt007,pmdt008,pmdt009,pmdt010,pmdt011,pmdt016,pmdt017,pmdt018,pmdt019,pmdt020,
                 pmdt021,pmdt022,pmdt023,pmdt024,pmdt025,pmdt026,pmdt036,pmdt037,pmdt038,pmdt039,pmdt040,pmdt041,
                 pmdt042,pmdt043,pmdt044,pmdt045,pmdt048,
                 pmdt046,pmdt047,NVL(pmdt053,0),NVL(pmdt054,0),NVL(pmdt055,0),pmdt062,pmdt059,pmdt088,
                 pmdt072,pmdt073,pmdt074
            INTO g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt002,g_pmdt_d[l_ac].pmdt003,g_pmdt_d[l_ac].pmdt004,
                 g_pmdt_d[l_ac].pmdt005,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt008,
                 g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt011,g_pmdt_d[l_ac].pmdt016,
                 g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020,
                 g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024,
                 g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt026,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt037,
                 g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt039,g_pmdt_d[l_ac].pmdt040,g_pmdt_d[l_ac].pmdt041,
                 g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt045,g_pmdt_d[l_ac].pmdt048,
                 g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt053,g_pmdt_d[l_ac].pmdt054,
                 g_pmdt_d[l_ac].pmdt055,g_pmdt_d[l_ac].pmdt062,g_pmdt_d[l_ac].pmdt059,g_pmdt_d[l_ac].pmdt088,
                 g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073,g_pmdt_d[l_ac].pmdt074
             FROM pmdt_t 
             WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmds006 AND pmdtseq = g_pmdt_d[l_ac].pmdt028
          
          #若來源單據沒有倉儲批，帶出預設值
          #預設料件的庫儲
          IF g_pmdt_d[l_ac].pmdt062 = 'N' THEN
             IF cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                SELECT imaf091,imaf092 INTO g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017
                  FROM imaf_t
                  WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
             END IF
             IF g_pmdt_d[l_ac].pmdt017 IS NULL THEN
                SELECT imaf092 INTO g_pmdt_d[l_ac].pmdt017
                  FROM imaf_t
                  WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
             END IF
          END IF
          
          #2.若輸入的收貨項次需要QC檢驗，則送驗QC的量 - QC合格量 -已經登打的驗退量 
          IF g_argv[1] MATCHES '[5]' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN
             
             #其他單據上錄入的數量
             LET l_pmdt020 = 0
             SELECT SUM(pmdt020) INTO l_pmdt020 FROM pmdt_t,pmds_t 
                WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
                  AND pmdtent = g_enterprise AND pmds006 = g_pmds_m.pmds006
                  AND pmdt028 = g_pmdt_d[l_ac].pmdt028
                  AND pmdsstus = 'N'
                  AND pmds000 = g_pmds_m.pmds000
                  
             IF cl_null(l_pmdt020) THEN
                LET l_pmdt020 = 0
             END IF
          
             IF g_pmdt_d[l_ac].pmdt026 = 'Y' THEN
                SELECT COUNT(qcbcseq) INTO l_n FROM qcbc_t,qcba_t 
                   WHERE qcbcent = g_enterprise AND qcbcent  = qcbaent
                     AND qcbcsite  = g_site AND qcbcsite = qcbasite
                     AND qcbcdocno = qcbadocno 
                     AND qcba001   = g_pmds_m.pmds006
                     AND qcba002   = g_pmdt_d[l_ac].pmdt028
                     AND qcbastus  = 'Y' AND qcbc012 = '4'
                IF l_n = 1 THEN
                   SELECT qcbcdocno,qcbcseq,qcbc002 INTO g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082,g_pmdt_d[l_ac].pmdt083
                       FROM qcbc_t,qcba_t 
                      WHERE qcbcent = g_enterprise AND qcbcent  = qcbaent
                        AND qcbcsite  = g_site AND qcbcsite = qcbasite
                        AND qcbcdocno = qcbadocno 
                        AND qcba001   = g_pmds_m.pmds006
                        AND qcba002   = g_pmdt_d[l_ac].pmdt028
                        AND qcbastus  = 'Y' AND qcbc012 = '4'
                        #AND ROWNUM =1
                END IF
               
                IF (NOT cl_null(g_pmdt_d[l_ac].pmdt081)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt082)) THEN
                   SELECT SUM(pmdt020) INTO l_pmdt020 FROM pmdt_t,pmds_t
                     WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
                       AND pmdtent = g_enterprise AND pmdsstus <> 'X'
                       AND pmdt081 = g_pmdt_d[l_ac].pmdt081 AND pmdt082 = g_pmdt_d[l_ac].pmdt082
                       AND (pmdsdocno <> g_pmds_m.pmdsdocno OR pmdtseq <> g_pmdt_d[l_ac].pmdtseq)
                       AND pmds000 = g_pmds_m.pmds000
                       
                   IF cl_null(l_pmdt020) THEN
                      LET l_pmdt020 = 0
                   END IF
                   
                   SELECT qcbc005,qcbc006,qcbc007,qcbc009,qcbc013
                       INTO g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,l_qcbc009,l_qcbc013
                     FROM qcbc_t
                     WHERE qcbcent = g_enterprise AND qcbcsite = g_site
                       AND qcbcdocno = g_pmdt_d[l_ac].pmdt081
                       AND qcbcseq = g_pmdt_d[l_ac].pmdt082
                   IF cl_null(l_qcbc009) THEN
                      LET l_qcbc009 = 0
                   END IF
                   
                   LET g_pmdt_d[l_ac].pmdt020 = l_qcbc009 - l_pmdt020
                   
                   #若QC維護的處理方式為 2.不计价 則計價數量為 0
                   IF l_qcbc013 = '2' THEN
                      LET g_pmdt_d[l_ac].pmdt024 = 0
                   ELSE
                      IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
                         CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                                   RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                         CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                             RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                      ELSE
                         LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                         LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
                      END IF
                   END IF
                END IF
                
                LET g_pmdt_d[l_ac].pmdt062 = 'N'

             END IF
             
             #3.若輸入的收貨項次不需要QC檢驗，則收貨數量-已經登打的驗退量 - 已經登打的入庫量 
             IF g_pmdt_d[l_ac].pmdt026 = 'N' THEN
                LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d[l_ac].pmdt053 - g_pmdt_d[l_ac].pmdt055 - g_pmdt_d[l_ac].pmdt054 - l_pmdt020
                
                IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
                   CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                             RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                   CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                       RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                ELSE
                   LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                   LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
                END IF                
             END IF
          END IF
          
          IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25' THEN
             IF g_pmdt_d[l_ac].pmdt026 = 'Y' THEN
                SELECT COUNT(qcbcseq) INTO l_n FROM qcbc_t,qcba_t 
                   WHERE qcbcent = g_enterprise AND qcbcent  = qcbaent
                     AND qcbcsite  = g_site AND qcbcsite = qcbasite
                     AND qcbcdocno = qcbadocno 
                     AND qcba001   = g_pmds_m.pmds006
                     AND qcba002   = g_pmdt_d[l_ac].pmdt028
                     AND qcbastus  = 'Y' AND qcbc012 <> '4'
                IF l_n = 1 THEN
                   SELECT qcbcdocno,qcbcseq,qcbc002 INTO g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082,g_pmdt_d[l_ac].pmdt083
                       FROM qcbc_t,qcba_t 
                      WHERE qcbcent = g_enterprise AND qcbcent  = qcbaent
                        AND qcbcsite  = g_site AND qcbcsite = qcbasite
                        AND qcbcdocno = qcbadocno 
                        AND qcba001   = g_pmds_m.pmds006
                        AND qcba002   = g_pmdt_d[l_ac].pmdt028
                        AND qcbastus  = 'Y' AND qcbc012 <> '4'
                        #AND ROWNUM =1
                END IF
                
                IF (NOT cl_null(g_pmdt_d[l_ac].pmdt081)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt082)) THEN
                   SELECT SUM(pmdt020) INTO l_pmdt020 FROM pmdt_t,pmds_t
                     WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
                       AND pmdtent = g_enterprise AND pmdsstus <> 'X'
                       AND pmdt081 = g_pmdt_d[l_ac].pmdt081 AND pmdt082 = g_pmdt_d[l_ac].pmdt082
                       AND (pmdsdocno <> g_pmds_m.pmdsdocno OR pmdtseq <> g_pmdt_d[l_ac].pmdtseq)
                       AND pmds000 = g_pmds_m.pmds000
                       
                   IF cl_null(l_pmdt020) THEN
                      LET l_pmdt020 = 0
                   END IF
                   
                    SELECT qcbc005,qcbc006,qcbc007,qcbc009,qcbc013
                       INTO g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,l_qcbc009,l_qcbc013
                     FROM qcbc_t
                     WHERE qcbcent = g_enterprise AND qcbcsite = g_site
                       AND qcbcdocno = g_pmdt_d[l_ac].pmdt081
                       AND qcbcseq = g_pmdt_d[l_ac].pmdt082
                       
                   IF cl_null(l_qcbc009) THEN
                      LET l_qcbc009 = 0
                   END IF
                   
                   LET g_pmdt_d[l_ac].pmdt020 = l_qcbc009 - l_pmdt020
                   
                   #若QC維護的處理方式為 2.不计价 則計價數量為 0
                   IF l_qcbc013 = '2' THEN
                      LET g_pmdt_d[l_ac].pmdt024 = 0
                   ELSE
                      IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
                         CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                                   RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                         CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                             RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                      ELSE
                         LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                         LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
                      END IF
                   END IF
                END IF
                
                LET g_pmdt_d[l_ac].pmdt062 = 'N'
                
             ELSE
                #其他單據上錄入的數量
                LET l_pmdt020 = 0
                SELECT SUM(pmdt020) INTO l_pmdt020 FROM pmdt_t,pmds_t 
                   WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
                     AND pmdtent = g_enterprise AND pmds006 = g_pmds_m.pmds006
                     AND pmdt028 = g_pmdt_d[l_ac].pmdt028
                     AND (pmdsstus = 'N' OR pmdsstus = 'Y')
                     AND pmds000 = g_pmds_m.pmds000
                     
                IF cl_null(l_pmdt020) THEN
                   LET l_pmdt020 = 0
                END IF
                LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d[l_ac].pmdt053 - g_pmdt_d[l_ac].pmdt054 - l_pmdt020 
                IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
                   CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                             RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                   CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                       RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                ELSE
                   LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                   LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
                END IF
             END IF
          END IF
          
          IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26' THEN
             #其他單據上錄入的數量
             LET l_pmdt020 = 0
             LET l_pmdt090 = 0
             SELECT SUM(pmdt020),SUM(pmdt090) INTO l_pmdt020,l_pmdt090 FROM pmdt_t,pmds_t 
                WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
                  AND pmdtent = g_enterprise AND pmds006 = g_pmds_m.pmds006
                  AND pmdt028 = g_pmdt_d[l_ac].pmdt028
                  #AND (pmdsstus = 'N' OR pmdsstus = 'Y')
                  AND pmdsstus <> 'X'  #modify by lixiang 20150604
                  AND pmds000 = g_pmds_m.pmds000
                  
             IF cl_null(l_pmdt020) THEN
                LET l_pmdt020 = 0
             END IF
             LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d[l_ac].pmdt054 - l_pmdt020 
             
             #借貨歸還單時，還需要減去其他單據上的借貨還價數量
             IF g_argv[1] = '26'  THEN
                IF cl_null(l_pmdt090) THEN
                   LET l_pmdt090 = 0
                END IF
                
                LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d[l_ac].pmdt020 - l_pmdt090
                
             END IF
             IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
                CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                          RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                    RETURNING l_success,g_pmdt_d[l_ac].pmdt024
             ELSE
                LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
             END IF
             #倉退單，當倉退方式為'4:'價格折讓'時，數量欄位預設為0
             IF g_pmds_m.pmds100 = '4' THEN
                LET g_pmdt_d[l_ac].pmdt020 = 0
                LET g_pmdt_d[l_ac].pmdt024 = 0
             END IF
          END IF
          
          IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt019)) THEN
             CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020)
                RETURNING l_success,g_pmdt_d[l_ac].pmdt020
                     
             IF (NOT cl_null(g_pmdt_d[l_ac].pmdt021)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) THEN
                CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                          RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022)
                    RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                    
             ELSE
                LET g_pmdt_d[l_ac].pmdt022 = ''
             END IF
             
             #IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
             #   CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
             #             RETURNING l_success,g_pmdt_d[l_ac].pmdt024
             #   CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
             #       RETURNING l_success,g_pmdt_d[l_ac].pmdt024
             #ELSE
             #   LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
             #   LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
             #END IF
          END IF
          
          LET g_pmdt_d[l_ac].pmdt052 = '1'              #狀態碼 '1:一般'
          
          
          CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdt006) RETURNING g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          
          CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
          
          CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt019_desc

          CALL apmt520_pmdt008_ref(g_pmdt_d[l_ac].pmdt008) RETURNING g_pmdt_d[l_ac].pmdt008_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008_desc
          
          CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt021_desc
          
          CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt023_desc
          
          CALL apmt520_pmds033_ref(g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046_desc
          
          CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
          
          CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
          
          IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt036)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
             CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
               RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
             DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
          END IF
          
          CALL s_desc_get_project_desc(g_pmdt_d[l_ac].pmdt072) RETURNING g_pmdt_d[l_ac].pmdt072_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt072_desc
          
          CALL s_desc_get_wbs_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073) RETURNING g_pmdt_d[l_ac].pmdt073_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt073_desc
          
          CALL s_desc_get_activity_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt074) RETURNING g_pmdt_d[l_ac].pmdt074_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt074_desc
          
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt005,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt008,
                 g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt011,g_pmdt_d[l_ac].pmdt016,
                 g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020,
                 g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024,
                 g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt026,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt037,
                 g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt039,g_pmdt_d[l_ac].pmdt040,g_pmdt_d[l_ac].pmdt041,
                 #g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt045,
                 g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt054,g_pmdt_d[l_ac].pmdt055,
                 g_pmdt_d[l_ac].pmdt062,g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073,g_pmdt_d[l_ac].pmdt074
           
       END IF
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt081_chk" order="25" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#QC檢驗單號檢查
PRIVATE FUNCTION apmt520_pmdt081_chk(p_pmdt081)
DEFINE p_pmdt081   LIKE pmdt_t.pmdt081
DEFINE l_n         LIKE type_t.num5 
DEFINE r_success   LIKE type_t.num5

       LET r_success = TRUE
       #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
       INITIALIZE g_chkparam.* TO NULL
       
       #設定g_chkparam.*的參數
       LET g_chkparam.arg1 = p_pmdt081
   
       #呼叫檢查存在並帶值的library
       IF NOT cl_chk_exist("v_qcbadocno") THEN
          LET r_success = FALSE
          RETURN r_success
       END IF
       
       LET l_n = 0
       IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
          SELECT COUNT(*) INTO l_n FROM qcba_t
            WHERE qcbaent = g_enterprise AND qcbasite = g_site AND qcbadocno = p_pmdt081
              AND qcba001 = g_pmds_m.pmds006 AND qcba002 = g_pmdt_d[l_ac].pmdt002
       END IF
       IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
          SELECT COUNT(*) INTO l_n FROM qcba_t
            WHERE qcbaent = g_enterprise AND qcbasite = g_site AND qcbadocno = p_pmdt081
              AND qcba001 = g_pmds_m.pmds006 AND qcba002 = g_pmdt_d[l_ac].pmdt028
       END IF
       IF l_n = 0 OR cl_null(l_n) THEN
          INITIALIZE g_errparam TO NULL
          LET g_errparam.code = 'apm-00453'
          LET g_errparam.extend = p_pmdt081
          LET g_errparam.popup = TRUE
          CALL cl_err()

          LET r_success = FALSE
          RETURN r_success
       END IF
       
       RETURN r_success
       
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt082_chk" order="26" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#QC判定項次檢驗
PRIVATE FUNCTION apmt520_pmdt082_chk(p_pmdt081,p_pmdt082)
DEFINE p_pmdt081   LIKE pmdt_t.pmdt081
DEFINE p_pmdt082   LIKE pmdt_t.pmdt082
DEFINE r_success   LIKE type_t.num5

       LET r_success = TRUE
       #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
       INITIALIZE g_chkparam.* TO NULL
       
       #設定g_chkparam.*的參數
       LET g_chkparam.arg1 = p_pmdt081
       LET g_chkparam.arg2 = p_pmdt082
       
       #驗退
       IF g_argv[1] MATCHES '[5]' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN 
          IF NOT cl_chk_exist("v_qcbcseq_2") THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
       END IF
       
       #入庫
       IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25' THEN 
          IF NOT cl_chk_exist("v_qcbcseq_1") THEN
             LET r_success = FALSE
             RETURN r_success
          END IF
       END IF

       RETURN r_success
       

END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt082_desc" order="27" ver="9" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#帶出判定結果的資料
PRIVATE FUNCTION apmt520_pmdt082_desc()
DEFINE l_qcbc009     LIKE qcbc_t.qcbc009
DEFINE l_pmdt020     LIKE pmdt_t.pmdt020
DEFINE l_qcbc013     LIKE qcbc_t.qcbc013
DEFINE l_success     LIKE type_t.num5

     LET g_pmdt_d[l_ac].pmdt083 = ''
     LET g_pmdt_d[l_ac].pmdt016 = ''
     LET g_pmdt_d[l_ac].pmdt017 = ''
     LET g_pmdt_d[l_ac].pmdt018 = ''
     
     SELECT qcbc002,qcbc005,qcbc006,qcbc007,qcbc009,qcbc013
        INTO g_pmdt_d[l_ac].pmdt083,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,l_qcbc009,l_qcbc013
      FROM qcbc_t
      WHERE qcbcent = g_enterprise AND qcbcsite = g_site
        AND qcbcdocno = g_pmdt_d[l_ac].pmdt081
        AND qcbcseq = g_pmdt_d[l_ac].pmdt082
     
     SELECT SUM(pmdt020) INTO l_pmdt020 FROM pmdt_t,pmds_t
        WHERE pmdtent = pmdsent AND pmdtdocno = pmdsdocno
          AND pmdtent = g_enterprise AND pmdsstus <> 'X'
          AND pmdt081 = g_pmdt_d[l_ac].pmdt081 AND pmdt082 = g_pmdt_d[l_ac].pmdt082
          AND (pmdsdocno <> g_pmds_m.pmdsdocno OR pmdtseq <> g_pmdt_d[l_ac].pmdtseq)
          AND pmds000 = g_pmds_m.pmds000
     
     IF cl_null(l_pmdt020) THEN
        LET l_pmdt020 = 0
     END IF
     
     LET g_pmdt_d[l_ac].pmdt020 = l_qcbc009 - l_pmdt020
     #若QC維護的處理方式為 2.不计价 則計價數量為 0
     IF l_qcbc013 = '2' THEN
        LET g_pmdt_d[l_ac].pmdt024 = 0
     ELSE
        IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
           CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                     RETURNING l_success,g_pmdt_d[l_ac].pmdt024
           CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
               RETURNING l_success,g_pmdt_d[l_ac].pmdt024
        ELSE
           LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
           LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
        END IF
     END IF
     
     IF (NOT cl_null(g_pmdt_d[l_ac].pmdt021)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) THEN
        CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                  RETURNING l_success,g_pmdt_d[l_ac].pmdt022
        CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022)
            RETURNING l_success,g_pmdt_d[l_ac].pmdt022
            
     ELSE
        LET g_pmdt_d[l_ac].pmdt022 = ''
     END IF
     
     LET g_pmdt_d[l_ac].pmdt062 = 'N'         
     
     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt083,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt062
     
     CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
     
     CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
          
     CALL apmt520_pmdt083_ref(g_pmdt_d[l_ac].pmdt083) RETURNING g_pmdt_d[l_ac].pmdt083_desc
     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt083_desc
     
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt083_ref" order="28" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION apmt520_pmdt083_ref(p_pmdt083)
DEFINE p_pmdt083     LIKE pmdt_t.pmdt083
DEFINE r_qcaol004    LIKE qcaol_t.qcaol004

       INITIALIZE g_ref_fields TO NULL
       LET g_ref_fields[1] = p_pmdt083
       CALL ap_ref_array2(g_ref_fields,"SELECT qcaol004 FROM qcaol_t WHERE qcaolent='"||g_enterprise||"' AND qcaol001='"||g_ooef025||"' AND qcaol002=? AND qcaol003='"||g_dlang||"'","") RETURNING g_rtn_fields
       LET r_qcaol004 = '', g_rtn_fields[1] , ''
       RETURN r_qcaol004
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_upd_pmds081" order="29" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#維護取回日期
PRIVATE FUNCTION apmt520_upd_pmds081()
DEFINE l_pmdsmoddt  LIKE pmds_t.pmdsmoddt
DEFINE l_forupd_sql STRING

   IF g_pmds_m.pmdsdocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF

   SELECT UNIQUE pmdssite,pmds000,pmdsdocno,pmdsdocdt,pmds002,pmds001,pmds003,pmdsstus,pmds006,pmds007, 
        pmds008,pmds009,pmds010,pmds011,pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033, 
        pmds034,pmds035,pmds036,pmds037,pmds038,pmds039,pmds040,pmds041,pmds042,pmds043,pmds044,pmds046, 
        pmdsownid,pmdsowndp,pmdscrtid,pmdscrtdp,pmdscrtdt,pmdsmodid,pmdsmoddt,pmdscnfid,pmdscnfdt,pmdspstid, 
        pmdspstdt
 INTO g_pmds_m.pmdssite,g_pmds_m.pmds000,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds002,g_pmds_m.pmds001, 
     g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009, 
     g_pmds_m.pmds010,g_pmds_m.pmds011,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023, 
     g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035, 
     g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,g_pmds_m.pmds041, 
     g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
     g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
     g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt
 FROM pmds_t
 WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
 
   ERROR ""
  
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
   CALL s_transaction_begin()
   
   LET l_forupd_sql = "SELECT pmdssite,pmdsdocno,pmdsdocdt,pmds002,pmds001,pmds003, ",
                      " pmdsstus,pmds006,pmds007,pmds008,pmds009,pmds010,pmds000,pmds100,pmds011,pmds081, ",
                      " pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,", 
                      " pmds037,pmds038,pmds039,pmds040,pmds041,pmds042,pmds043,pmds044,pmds046 ",
                      " FROM pmds_t WHERE pmdsent= ? AND pmdsdocno=? FOR UPDATE"
  
   LET l_forupd_sql = cl_sql_forupd(l_forupd_sql)                #轉換不同資料庫語法
   DECLARE apmt520_cl3 CURSOR FROM l_forupd_sql

   OPEN apmt520_cl3 USING g_enterprise,g_pmds_m.pmdsdocno
 
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN apmt520_cl3:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE apmt520_cl3
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #鎖住將被更改或取消的資料
   FETCH apmt520_cl3 INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,
       g_pmds_m.pmds002,g_pmds_m.pmds001,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,
       g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds081,g_pmds_m.pmds045,
       g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,
       g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,
       g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,
       g_pmds_m.pmds040,g_pmds_m.pmds041,g_pmds_m.pmds042,
       g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046
   
 
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_pmds_m.pmdsdocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE apmt520_cl3
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   CALL apmt520_show()
   
   #LET g_flag3 = FALSE
   CALL apmt520_set_entry('u')
   CALL apmt520_set_no_entry('u')

   INPUT BY NAME g_pmds_m.pmds081 WITHOUT DEFAULTS

      AFTER INPUT
         #若取消則直接結束
         IF INT_FLAG THEN
            LET INT_FLAG = FALSE
            CLOSE apmt520_cl3
            CALL s_transaction_end('N','0')
            RETURN
         END IF

      AFTER FIELD pmds081
        

   END INPUT

   IF INT_FLAG OR g_pmds_m.pmds001 IS NULL THEN
      LET INT_FLAG = 0
      CLOSE apmt520_cl3
      CALL s_transaction_end('N','0')
      RETURN
   END IF

   LET l_pmdsmoddt = cl_get_current()

   UPDATE pmds_t SET pmds081 = g_pmds_m.pmds081,
                     pmdsmodid = g_user,
                     pmdsmoddt = l_pmdsmoddt
     WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno

   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "pmds_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE apmt520_cl3
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #sLET g_flag3 = TRUE
   
   CLOSE apmt520_cl3
   CALL s_transaction_end('Y','0')

END FUNCTION]]>
  </point>
  <point name="function.apmt520_ins_pmdu" order="30" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#多庫儲批不勾選時，則也新增一筆資料到收貨/驗退/入庫/倉退單多庫儲批收貨明細檔
PRIVATE FUNCTION apmt520_ins_pmdu()
DEFINE l_pmduseq1   LIKE pmdu_t.pmduseq1
DEFINE r_success    LIKE type_t.num5
DEFINE l_pmdu       RECORD LIKE pmdu_t.*
DEFINE l_n          LIKE type_t.num5
DEFINE l_rate       LIKE inaj_t.inaj014
DEFINE l_flag       LIKE type_t.num5
DEFINE l_success    LIKE type_t.num5
DEFINE l_pmdt020    LIKE pmdt_t.pmdt020
DEFINE l_pmdt016    LIKE pmdt_t.pmdt016
DEFINE l_pmdt017    LIKE pmdt_t.pmdt017
DEFINE l_pmdt018    LIKE pmdt_t.pmdt018
DEFINE l_pmdt081    LIKE pmdt_t.pmdt081
DEFINE l_pmdt082    LIKE pmdt_t.pmdt082

      LET r_success = TRUE
     
      IF cl_null(g_pmdt_d_t.pmdtseq) THEN
         LET g_pmdt_d_t.pmdtseq = g_pmdt_d[l_ac].pmdtseq  
      END IF
      
      IF g_pmdt_d[l_ac].pmdt062 = 'N' THEN
         DELETE FROM pmdu_t
           WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno 
             AND pmduseq = g_pmdt_d_t.pmdtseq
         
         LET l_pmduseq1 = 0
         
         SELECT MAX(pmduseq1)+1 INTO l_pmduseq1 FROM pmdu_t
           WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND pmduseq = g_pmdt_d[l_ac].pmdtseq
         IF cl_null(l_pmduseq1) OR l_pmduseq1 = 0 THEN
            LET l_pmduseq1 = 1
         END IF
         
         #收貨單時，允收數量賦 零
         IF g_argv[1] MATCHES '[123489]' OR g_argv[1] = '23' OR g_argv[1] = '24' THEN
            LET g_pmdt_d[l_ac].pmdt053 = 0
         ELSE
            LET g_pmdt_d[l_ac].pmdt053 = g_pmdt_d[l_ac].pmdt020
         END IF
         LET g_pmdt_d[l_ac].pmdt054 = 0
         LET g_pmdt_d[l_ac].pmdt055 = 0
               
         INSERT INTO pmdu_t(pmduent,pmdusite,pmdudocno,pmduseq,pmduseq1,pmdu001,pmdu002,pmdu003,pmdu004,pmdu005,
                            pmdu006,pmdu007,pmdu008,pmdu009,pmdu010,pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,pmdu016,pmdu017)
           VALUES (g_enterprise,g_site,g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,l_pmduseq1,g_pmdt_d[l_ac].pmdt006,
                   g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt063,
                   g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt019,
                   g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt053,
                   g_pmdt_d[l_ac].pmdt054,g_pmdt_d[l_ac].pmdt055,g_pmdt_d[l_ac].pmdt088,g_pmdt_d[l_ac].pmdt089)
                   
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "pmdu_t"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET r_success = FALSE
            RETURN r_success
         END IF
      ELSE
         
         LET l_n = 0
         #當前單據是否有維護多庫儲批
         SELECT COUNT(*) INTO l_n FROM pmdu_t WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND pmduseq = g_pmdt_d[l_ac].pmdtseq
         IF l_n = 0 OR cl_null(l_n) THEN
            
            SELECT COUNT(*) INTO l_n FROM pmdu_t WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmds006 AND pmduseq = g_pmdt_d[l_ac].pmdt028
            
            IF l_n > 0 THEN
                DELETE FROM pmdu_t
                 WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno 
                   AND pmduseq = g_pmdt_d[l_ac].pmdtseq
               
               LET l_pmdt020 = g_pmdt_d[l_ac].pmdt020
               #複製來源單號的多庫儲批
               DECLARE pmdu_ins CURSOR FOR
                  SELECT * FROM pmdu_t WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmds006 AND pmduseq = g_pmdt_d[l_ac].pmdt028
               FOREACH pmdu_ins INTO l_pmdu.*
                  LET l_pmdu.pmduent = g_enterprise
                  LET l_pmdu.pmdusite = g_site
            
                  #IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
                  #    LET l_pmdu.pmdu010 = l_pmdu.pmdu014
                  #ELSE
                  #   #驗退
                  #   IF g_argv[1] MATCHES '[5]' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN
                  #      LET l_pmdu.pmdu010 = l_pmdu.pmdu010 - l_pmdu.pmdu014 - l_pmdu.pmdu015
                  #   ELSE
                  #      LET l_pmdu.pmdu010 = l_pmdu.pmdu013 - l_pmdu.pmdu014 - l_pmdu.pmdu015
                  #   END IF
                  #END IF
                  IF l_pmdt020 <= l_pmdu.pmdu010 THEN
                     LET l_pmdu.pmdu010 = l_pmdt020
                     LET l_pmdt020 = 0
                  ELSE
                     LET l_pmdt020 = l_pmdt020 - l_pmdu.pmdu010
                  END IF
                  
                  IF l_pmdu.pmdu010 = 0 THEN
                     CONTINUE FOREACH
                  END IF
              
                  #入庫、驗退單有QC單維護了庫儲批時，從QC單帶入
                  IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25' THEN
                     IF (NOT cl_null(l_pmdt081)) AND (NOT cl_null(l_pmdt082)) AND (NOT cl_null(l_pmdt016)) THEN
                        LET l_pmdu.pmdu006 = g_pmdt_d[l_ac].pmdt016
                        LET l_pmdu.pmdu007 = g_pmdt_d[l_ac].pmdt017
                        LET l_pmdu.pmdu008 = g_pmdt_d[l_ac].pmdt018
                     END IF
                  END IF
              
                  LET l_pmdu.pmdu013 = l_pmdu.pmdu010
                  IF NOT cl_null(l_pmdu.pmdu011) THEN
                     #CALL s_aimi190_get_convert(l_pmdu.pmdu001,l_pmdu.pmdu009,l_pmdu.pmdu011) RETURNING l_flag,l_rate
                     #LET l_pmdu.pmdu012 = l_pmdu.pmdu010 * l_rate   #計價數量
                     CALL s_aooi250_convert_qty(l_pmdu.pmdu001,l_pmdu.pmdu009,l_pmdu.pmdu011,l_pmdu.pmdu010)
                            RETURNING l_success,l_pmdu.pmdu012
                  ELSE
                     LET l_pmdu.pmdu012 = ''
                  END IF
                  LET l_pmdu.pmdu014 = 0
                  LET l_pmdu.pmdu015 = 0
                  
                  INSERT INTO pmdu_t(pmduent,pmdusite,pmdudocno,pmduseq,pmduseq1,pmdu001,pmdu002,pmdu003,pmdu004,
                                   pmdu005,pmdu006,pmdu007,pmdu008,pmdu009,pmdu010,pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,pmdu016,pmdu017)
                   VALUES(l_pmdu.pmduent,l_pmdu.pmdusite,g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,l_pmdu.pmduseq1,l_pmdu.pmdu001,l_pmdu.pmdu002,
                          l_pmdu.pmdu003,l_pmdu.pmdu004,l_pmdu.pmdu005,l_pmdu.pmdu006,l_pmdu.pmdu007,l_pmdu.pmdu008,l_pmdu.pmdu009,
                          l_pmdu.pmdu010,l_pmdu.pmdu011,l_pmdu.pmdu012,l_pmdu.pmdu013,l_pmdu.pmdu014,l_pmdu.pmdu015,l_pmdu.pmdu016,l_pmdu.pmdu017)
                  IF SQLCA.sqlcode THEN
                     LET r_success = FALSE
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "pmdu_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                  
                     RETURN r_success
                  END IF
               END FOREACH
            END IF
         END IF
      END IF
      
      RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.apmt520_receipt_gen_pmdt" order="31" ver="12" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
#單據類型為入庫類型 時，根據收貨單號自動產生 入庫單單身資料
PRIVATE FUNCTION apmt520_receipt_gen_pmdt()
DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
DEFINE l_xrcd115     LIKE xrcd_t.xrcd115
DEFINE l_success     LIKE type_t.num5
   
     CALL s_apmt520_gen_pmdt('1',g_pmds_m.pmdsdocno,0,'1') RETURNING l_success
     
     #重新計算整單的未稅、含稅總金額
     CALL s_tax_recount(g_pmds_m.pmdsdocno)
       RETURNING g_pmds_m.pmds043,g_pmds_m.pmds046,g_pmds_m.pmds044,l_xrcd113,l_xrcd114,l_xrcd115
     UPDATE pmds_t SET pmds043 = g_pmds_m.pmds043,
                       pmds044 = g_pmds_m.pmds044,
                       pmds046 = g_pmds_m.pmds046
        WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
       
        
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt006_desc" order="32" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#根據料號帶初始值
PRIVATE FUNCTION apmt520_pmdt006_desc()
DEFINE l_n         LIKE type_t.num5
DEFINE l_success   LIKE type_t.num5
DEFINE l_controlno LIKE ooha_t.ooha001
DEFINE l_imaf158   LIKE imaf_t.imaf158

      LET l_n = 0
      LET g_pmdt_d[l_ac].pmdt019 = ''
      LET g_pmdt_d[l_ac].pmdt019_desc = ''
      LET g_pmdt_d[l_ac].pmdt023 = ''
      LET g_pmdt_d[l_ac].pmdt023_desc = ''
      #LET g_pmdt_d[l_ac].pmdt016 = ''
      #LET g_pmdt_d[l_ac].pmdt016_desc = ''
      #LET g_pmdt_d[l_ac].pmdt017 = ''
      #LET g_pmdt_d[l_ac].pmdt017_desc = ''
      LET g_pmdt_d[l_ac].pmdt008 = ''
      LET g_pmdt_d[l_ac].pmdt008_desc = ''
      
      #先判斷這個供應商是否有設多個當前採購控制組範圍內的供應商預設條件，則開窗，讓user 選擇帶哪一個控制組的資料
      #LET l_controlno = ''
      #CALL s_control_get_group('4',g_user,g_dept) RETURNING l_success,l_controlno
      IF cl_null(g_controlno) THEN
         CALL s_control_get_group('4',g_user,g_dept) RETURNING l_success,g_controlno
      END IF
      #IF NOT cl_null(l_controlno) THEN
      IF NOT cl_null(g_controlno) THEN
         SELECT COUNT(*) INTO l_n FROM pmap_t 
            WHERE pmapent = g_enterprise AND pmapsite = g_site AND pmap001 = g_pmds_m.pmds007
              #AND pmap002 = l_controlno 
              AND pmap002 = g_controlno 
              AND pmap003 = g_pmdt_d[l_ac].pmdt006 AND pmap004 = g_pmdt_d[l_ac].pmdt007
         #若採購料件有設置'供應商控制組料件預設條件'(apmi121)時，則需將設置的預設條件值預設到採購單對應欄位
         IF l_n > 0 THEN
            SELECT pmap006,pmap008,pmap010
              INTO g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt008
            FROM pmap_t 
            WHERE pmapent = g_enterprise AND pmapsite = g_site AND pmap001 = g_pmds_m.pmds007
              #AND pmap002 = l_controlno 
              AND pmap002 = g_controlno 
              AND pmap003 = g_pmdt_d[l_ac].pmdt006 AND pmap004 = g_pmdt_d[l_ac].pmdt007
  
         END IF
      END IF
      
      #IF cl_null(l_controlno) OR l_n = 0 THEN 
      IF cl_null(g_controlno) OR l_n = 0 THEN       
         #沒有設置'供應商控制組料件預設條件'(apmi121)才改抓料件進銷存檔預設的條件
         SELECT imaf143,imaf144,imaf157
           INTO g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt008
           FROM imaf_t
         WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
         #倉退時，如果庫位等欄位有值，則不帶入預設值
         #IF NOT (g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' AND cl_null(g_pmdt_d[l_ac].pmdt016)) THEN
         IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
             SELECT imaf091,imaf092
               INTO g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017
               FROM imaf_t
             WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
         END IF
         IF g_pmdt_d[l_ac].pmdt017 IS NULL THEN
            SELECT imaf092 INTO g_pmdt_d[l_ac].pmdt017
              FROM imaf_t
              WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
         END IF
         
      END IF
      
      #委外收貨的庫位、儲位，應要帶工單指定入庫倉庫、儲位，如果工單沒指定，那應該帶料件的預設庫位、儲位
      #IF g_argv[1] MATCHES '[8]' THEN
         #預設料件的庫儲 
         IF cl_null(g_pmdt_d[l_ac].pmdt016) THEN
            SELECT imaf091,imaf092
               INTO g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017
              FROM imaf_t
            WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
            CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
            
            CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
         END IF
         IF g_pmdt_d[l_ac].pmdt017 IS NULL THEN
            SELECT imaf092 INTO g_pmdt_d[l_ac].pmdt017
              FROM imaf_t
              WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
         END IF
      #END IF
      
      CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
      CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
      
      #若稅別應用為2.依料件設定，呼叫應用元件帶出稅別、稅率
      IF g_tax_app = '2' AND NOT cl_null(g_pmab039) THEN
         #依料件檢核是否有依交易分類設定稅別
         CALL s_tax_chktype(g_pmds_m.pmdssite,g_pmds_m.pmds007,g_pmdt_d[l_ac].pmdt006,'1',g_pmab039)
           RETURNING l_success,g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt037      
         IF l_success THEN
            CALL s_desc_get_tax_desc1(g_site,g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
         ELSE
            #檢查失敗時後續處理
            LET g_pmdt_d[l_ac].pmdt046 = ''
            LET g_pmdt_d[l_ac].pmdt046_desc = ''
            LET g_pmdt_d[l_ac].pmdt037 = ''
         END IF           
      ELSE
         LET g_pmdt_d[l_ac].pmdt046 = g_pmds_m.pmds033
         LET g_pmdt_d[l_ac].pmdt037 = g_pmds_m.pmds034
      END IF             
      DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt046_desc,g_pmdt_d[l_ac].pmdt037
      
      #[C:備品率] = [T:料件進銷存檔].[C:採購備品率]  imaf165
      #[C:參考單位] = [T:料件進銷存檔][C:參考單位]   imaf015
      #若[T:料件進銷存檔].[C:接單拆解方式(採購)]的值為'1:自動CKD'或是'2:自動SKD'時，imaf158
      #則[C:子件特性]的值預設'2:CKD'或是'3:SKD'
      LET g_pmdt_d[l_ac].pmdt021 = ''
      LET g_pmdt_d[l_ac].pmdt021_desc = ''
      LET g_pmdt_d[l_ac].pmdt005 = '1'
      LET l_imaf158 = ''
      SELECT imaf158,imaf015 INTO l_imaf158,g_pmdt_d[l_ac].pmdt021 FROM imaf_t
        WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
      IF l_imaf158 = '1' THEN
         LET g_pmdt_d[l_ac].pmdt005 = '2'
      END IF
      IF l_imaf158 = '2' THEN
         LET g_pmdt_d[l_ac].pmdt005 = '3'
      END IF
      
      CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
      
      #整體參數使用採購計價單位時:
      #[C:計價單位]=[T:料件據點進銷存檔].[C:採購計價單位] 
      IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" THEN  
         SELECT imaf144 INTO g_pmdt_d[l_ac].pmdt023 FROM imaf_t
            WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_pmdt_d[l_ac].pmdt006
      END IF
      CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
      
      CALL apmt520_get_qcap006()
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_warehouse_voucher" order="33" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#在收貨單上 直接產生入庫單
PRIVATE FUNCTION apmt520_gen_warehouse_voucher()
DEFINE l_pmds_m      RECORD LIKE pmds_t.*
DEFINE l_success     LIKE type_t.num5
DEFINE l_oobn003     LIKE oobn_t.oobn003
DEFINE ls_sql        STRING
DEFINE l_pmdscrtdt   DATETIME YEAR TO SECOND
DEFINE l_pmdtseq     LIKE pmdt_t.pmdtseq
DEFINE l_n           LIKE type_t.num5
DEFINE l_prog        LIKE type_t.chr20     #作業編號 (gzzz001)
DEFINE l_pmdt_s      RECORD LIKE pmdt_t.*   #來源單據 收貨單
DEFINE l_pmdt_p      RECORD LIKE pmdt_t.*   #目的單據 入庫單
DEFINE l_xrcd104     LIKE xrcd_t.xrcd104
DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
DEFINE l_xrcd115     LIKE xrcd_t.xrcd115
DEFINE l_rate        LIKE inaj_t.inaj014
DEFINE l_flag        LIKE type_t.num5
DEFINE l_pmdt020     LIKE pmdt_t.pmdt020
DEFINE r_success     LIKE type_t.num5

    LET r_success = TRUE
    
    IF g_pmds_m.pmdsdocno IS NULL  THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "" 
       LET g_errparam.code   = "std-00003" 
       LET g_errparam.popup  = FALSE 
       CALL cl_err()
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    IF g_pmds_m.pmdsstus <> 'Y' THEN
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    #存在允收數量 > 0的單身
    LET l_n = 0
    SELECT COUNT(*) INTO l_n FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND (pmdt053 - pmdt054) > 0
    IF l_n = 0 OR cl_null(l_n) THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = g_pmds_m.pmdsdocno
       LET g_errparam.code   = 'apm-00630'
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    CALL s_transaction_begin()
   
    OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
    IF STATUS THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "OPEN apmt520_cl:" 
       LET g_errparam.code   = STATUS 
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       CLOSE apmt520_cl
       CALL s_transaction_end('N','0')
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    IF NOT s_apmt520_gen_pmds('1',g_pmds_m.pmdsdocno) THEN
       CALL s_transaction_end('N','0')
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    CALL s_transaction_end('Y','0')
    #INITIALIZE g_errparam TO NULL
    #LET g_errparam.code = 'apm-00596'
    #LET g_errparam.extend = ''
    #LET g_errparam.popup = TRUE
    #LET g_errparam.replace[1] = l_pmds_m.pmdsdocno
    #CALL cl_err()

    RETURN r_success
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_get_price" order="34" ver="9" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 依據取價方式抓取採購單價
# Memo...........:
# Usage..........: CALL apmt520_get_price()
# Date & Author..: 2014/08/13 By lixiang
# Modify.........:
################################################################################
PRIVATE FUNCTION apmt520_get_price()
DEFINE l_pmdn042  LIKE pmdn_t.pmdn042

     IF cl_null(g_pmdt_d[l_ac].pmdt023) OR cl_null(g_pmdt_d[l_ac].pmdt024) THEN 
        LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
        LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
     END IF
     IF (NOT cl_null(g_pmds_m.pmds039)) AND (NOT cl_null(g_pmds_m.pmds007)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND
        (NOT cl_null(g_pmds_m.pmds037)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) AND (NOT cl_null(g_pmds_m.pmds031)) AND 
        (NOT cl_null(g_pmds_m.pmds032)) AND (NOT cl_null(g_pmds_m.pmds012)) AND (NOT cl_null(g_pmds_m.pmdsdocno)) AND
        (NOT cl_null(g_pmds_m.pmdsdocdt)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt024)) THEN
      
        CALL s_purchase_price_get(g_pmds_m.pmds039,g_pmds_m.pmds007,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,
                                  g_pmds_m.pmds037,g_pmdt_d[l_ac].pmdt046,g_pmds_m.pmds031,g_pmds_m.pmds032,
                                  g_pmds_m.pmds012,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmdt_d[l_ac].pmdt023,
                                  g_pmdt_d[l_ac].pmdt024,g_site,g_pmds_m.pmds048,'1',g_pmdt_d[l_ac].pmdt009,
                                  g_pmdt_d[l_ac].pmdt010)          
              RETURNING g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt048
        
        #呼叫幣別取位應用元件對單價作取位(依單頭幣別做取位基準)
        CALL s_curr_round(g_site,g_pmds_m.pmds037,g_pmdt_d[l_ac].pmdt044,'1') RETURNING g_pmdt_d[l_ac].pmdt044
        
        LET g_pmdt_d[l_ac].pmdt036 = g_pmdt_d[l_ac].pmdt044
        LET g_pmdt_d[l_ac].pmdt045 = 0
        
        DISPLAY BY NAME g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt045,g_pmdt_d[l_ac].pmdt048
     END IF                   
                     
END FUNCTION]]>
  </point>
  <point name="function.apmt520_get_qcap006" order="35" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#獲得料件是否檢驗
PRIVATE FUNCTION apmt520_get_qcap006()
DEFINE l_sql   STRING

      LET g_pmdt_d[l_ac].pmdt026 = ''
      LET l_sql = " SELECT qcap006 FROM qcap_t ",
                 " WHERE qcapent = '",g_enterprise,"' ",
                 "  AND qcapsite = '",g_site,"' ",
                 "  AND qcap001 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                 "  AND qcap002 = '",g_pmds_m.pmds007,"' "
                 
      IF g_pmdt_d[l_ac].pmdt007 IS NOT NULL THEN
         LET l_sql = l_sql ," AND ( qcap005 = '",g_pmdt_d[l_ac].pmdt007,"' OR qcap005 = 'ALL') "
      END IF
      IF (NOT cl_null(g_pmdt_d[l_ac].pmdt009)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt010)) THEN
         LET l_sql = l_sql ," AND ( qcap003 = '",g_pmdt_d[l_ac].pmdt009,"' OR qcap003 = 'ALL') AND qcap004 = '",g_pmdt_d[l_ac].pmdt010,"' "
      END IF
      
      PREPARE get_qcap FROM l_sql
      EXECUTE get_qcap INTO g_pmdt_d[l_ac].pmdt026
      FREE get_qcap
      
      IF cl_null(g_pmdt_d[l_ac].pmdt026) THEN
         #若沒有維護aqci050,再從aqci040中帶值
         SELECT imae114 INTO g_pmdt_d[l_ac].pmdt026 FROM imae_t 
             WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_pmdt_d[l_ac].pmdt006
             
      END IF
      
      IF cl_null(g_pmdt_d[l_ac].pmdt026) THEN
         LET g_pmdt_d[l_ac].pmdt026 = 'N'
      END IF
      
      #直接收貨入庫時，無需檢驗
      IF g_argv[1] MATCHES '[34]' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
         LET g_pmdt_d[l_ac].pmdt026 = 'N'
      END IF
         
END FUNCTION]]>
  </point>
  <point name="function.apmt520_upd_price" order="36" ver="12" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
#修改單價
PRIVATE FUNCTION apmt520_upd_price()
DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
DEFINE l_xrcd115     LIKE xrcd_t.xrcd115
DEFINE l_n           LIKE type_t.num5
DEFINE l_cmd         LIKE type_t.chr1
DEFINE l_pmdt039     LIKE pmdt_t.pmdt039
DEFINE l_pmdt090     LIKE pmdt_t.pmdt090

   #當前在查詢方案頁簽時，直接返回，否則程式可能會當出
   IF g_main_hidden THEN
      RETURN
   END IF
   IF g_pmds_m.pmdsdocno IS NULL THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
 
      RETURN
   END IF

   CALL apmt520_show()
   
   #借貨歸還單才顯示借貨還價數量、金額等，其他作業不顯示
   IF g_argv[1] = '26' THEN
       CALL cl_set_comp_visible("pmdt092,pmdt093",TRUE)
   END IF
   
   CALL cl_set_comp_visible("page_7",TRUE)
   
   IF g_upd_price = FALSE THEN
      RETURN
   END IF
   
   CALL cl_set_comp_entry("pmdt036",TRUE)
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      INPUT ARRAY g_pmdt4_d FROM s_detail4.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = FALSE, 
                  DELETE ROW = FALSE,
                  APPEND ROW = FALSE)

         BEFORE INPUT
            CALL apmt520_b4_fill()
            LET g_rec_b4 = g_pmdt4_d.getLength()
            
         BEFORE ROW
            CALL s_transaction_begin()
            LET g_rec_b4 = g_pmdt4_d.getLength()
            LET l_ac4 = ARR_CURR()
            LET g_detail_idx = l_ac4
            
            LET l_n = ARR_COUNT()
            
            OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN apmt520_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
            
               CLOSE apmt520_cl
               RETURN
            END IF
            
            IF g_rec_b4 >= l_ac4 
               AND g_pmdt4_d[l_ac4].pmdtseq IS NOT NULL THEN
               LET l_cmd='u'
               LET g_pmdt4_d_t.* = g_pmdt4_d[l_ac4].*  #BACKUP
               LET g_pmdt4_d_o.* = g_pmdt4_d[l_ac4].*  #BACKUP
            END IF
            

          AFTER FIELD pmdt036
             IF NOT cl_ap_chk_range(g_pmdt4_d[l_ac4].pmdt036,"0.000","1","","","azz-00079",1) THEN
                LET g_pmdt4_d[l_ac4].pmdt036 = g_pmdt4_d_o.pmdt036
                NEXT FIELD pmdt036
             END IF
             IF NOT cl_null(g_pmdt4_d[l_ac4].pmdt036) THEN
                IF g_pmdt4_d[l_ac4].pmdt036 <> g_pmdt4_d_o.pmdt036 OR cl_null(g_pmdt4_d_o.pmdt036) THEN
                   CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt4_d[l_ac4].pmdtseq,'',g_pmdt4_d[l_ac4].pmdt024,g_pmdt4_d[l_ac4].pmdt036,g_pmdt4_d[l_ac4].pmdt046)
                     RETURNING g_pmdt4_d[l_ac4].pmdt038,g_pmdt4_d[l_ac4].pmdt047,g_pmdt4_d[l_ac4].pmdt039
                   IF g_pmdt4_d[l_ac4].pmdt005 = '9' AND g_pmdt4_d[l_ac4].pmdt036 <> 0 THEN  #樣品
                      INITIALIZE g_errparam TO NULL 
                      LET g_errparam.extend = '' 
                      LET g_errparam.code   = 'apm-00621'
                      LET g_errparam.popup  = TRUE 
                      CALL cl_err()
                      LET g_pmdt4_d[l_ac4].pmdt036 = g_pmdt4_d_o.pmdt036
                      NEXT FIELD pmdt036
                   END IF
                   
                   IF g_argv[01] = '26' THEN
                      SELECT pmdt090 INTO l_pmdt090 FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND pmdtseq = g_pmdt4_d[l_ac4].pmdtseq
                      IF cl_null(l_pmdt090) THEN
                         LET l_pmdt090 = 0
                      END IF
                      CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt4_d[l_ac4].pmdtseq,'',g_pmdt_d[l_ac].pmdt090,g_pmdt4_d[l_ac4].pmdt036,g_pmdt4_d[l_ac4].pmdt046)
                          RETURNING g_pmdt4_d[l_ac4].pmdt092,l_pmdt039,g_pmdt4_d[l_ac4].pmdt093
                     END IF
                     DISPLAY BY NAME g_pmdt4_d[l_ac4].pmdt092,g_pmdt4_d[l_ac4].pmdt093
                     
                END IF
             END IF
             LET g_pmdt4_d_o.pmdt036 = g_pmdt4_d[l_ac4].pmdt036
             
          ON ROW CHANGE
             IF INT_FLAG THEN
                INITIALIZE g_errparam TO NULL 
                LET g_errparam.extend = '' 
                LET g_errparam.code   = 9001 
                LET g_errparam.popup  = FALSE 
                CALL cl_err()
             
                LET INT_FLAG = 0
                LET g_pmdt4_d[l_ac4].* = g_pmdt4_d_t.*
                CALL s_transaction_end('N','0')
                EXIT DIALOG 
             END IF
             
             IF cl_null(g_pmdt4_d[l_ac4].pmdt092) THEN
                LET g_pmdt4_d[l_ac4].pmdt092 = 0
             END IF
             IF cl_null(g_pmdt4_d[l_ac4].pmdt093) THEN
                LET g_pmdt4_d[l_ac4].pmdt093 = 0
             END IF
             UPDATE pmdt_t SET pmdt036 = g_pmdt4_d[l_ac4].pmdt036,
                               pmdt038 = g_pmdt4_d[l_ac4].pmdt038,
                               pmdt047 = g_pmdt4_d[l_ac4].pmdt047,
                               pmdt039 = g_pmdt4_d[l_ac4].pmdt039,
                               pmdt092 = g_pmdt4_d[l_ac4].pmdt092,
                               pmdt093 = g_pmdt4_d[l_ac4].pmdt093
                WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND pmdtseq = g_pmdt4_d[l_ac4].pmdtseq
                
             IF SQLCA.sqlcode THEN
                INITIALIZE g_errparam TO NULL 
                LET g_errparam.extend = "pmdt_t" 
                LET g_errparam.code   = SQLCA.sqlcode 
                LET g_errparam.popup  = TRUE 
                CALL cl_err()                   
                CALL s_transaction_end('N','0')
                LET g_pmdt4_d[l_ac4].* = g_pmdt4_d_t.*  
             END IF
            
          AFTER ROW
             CLOSE apmt520_cl
             CALL s_transaction_end('Y','0')
             
      END INPUT
      
      ON ACTION accept    
         ACCEPT DIALOG
         
      ON ACTION cancel      #在dialog button (放棄)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
      
   END DIALOG 

   #重新計算整單的未稅、含稅總金額
   IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
      CALL s_transaction_begin()
      CALL s_tax_recount(g_pmds_m.pmdsdocno)
        RETURNING g_pmds_m.pmds043,g_pmds_m.pmds046,g_pmds_m.pmds044,l_xrcd113,l_xrcd114,l_xrcd115
      UPDATE pmds_t SET pmds043 = g_pmds_m.pmds043,
                        pmds044 = g_pmds_m.pmds044,
                        pmds046 = g_pmds_m.pmds046
          WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
      IF SQLCA.sqlcode THEN
         CALL s_transaction_end('N','0')
      ELSE
         CALL s_transaction_end('Y','0')
      END IF
   END IF   
      
   CALL cl_set_comp_entry("pmdt036",FALSE)
   
   CLOSE apmt520_cl
   LET INT_FLAG = FALSE
   CALL apmt520_b_fill()
   
END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_purchase" order="37" ver="12" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
#根據倉退單 產生新的採購單
PRIVATE FUNCTION apmt520_gen_purchase()
DEFINE l_success     LIKE type_t.num5
DEFINE l_pmdldocno   LIKE pmdl_t.pmdldocno
DEFINE l_n           LIKE type_t.num5
DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
DEFINE l_xrcd115     LIKE xrcd_t.xrcd115
DEFINE l_pmdl040     LIKE pmdl_t.pmdl040
DEFINE l_pmdl041     LIKE pmdl_t.pmdl041
DEFINE l_pmdl042     LIKE pmdl_t.pmdl042

    IF g_pmds_m.pmdsdocno IS NULL  THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "" 
       LET g_errparam.code   = "std-00003" 
       LET g_errparam.popup  = FALSE 
       CALL cl_err()
       RETURN
    END IF
    
    LET l_n = 0
    SELECT COUNT(*) INTO l_n FROM pmdl_t 
       WHERE pmdlent = g_enterprise AND pmdl008 = g_pmds_m.pmdsdocno AND pmdl007 = '7' 
         AND (pmdlstus = 'N' OR pmdlstus = 'D' OR pmdlstus = 'R')
    
    IF l_n > 0 THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = g_pmds_m.pmdsdocno
       LET g_errparam.code   = 'apm-00611'
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       RETURN
    END IF
    
    LET g_pmdldocno = ''
    
    CALL s_transaction_begin()
   
    OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
    IF STATUS THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "OPEN apmt520_cl:" 
       LET g_errparam.code   = STATUS 
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       CLOSE apmt520_cl
       CALL s_transaction_end('N','0')
       RETURN
    END IF
    
    CALL apmt520_gen_purchase_pmds() RETURNING l_success,l_pmdldocno
    IF NOT l_success THEN
       CLOSE apmt520_cl
       CALL s_transaction_end('N','0')
       RETURN
    END IF
    
    IF NOT apmt520_gen_purchase_pmdn(l_pmdldocno) THEN
       CLOSE apmt520_cl
       CALL s_transaction_end('N','0')
       RETURN
    END IF
    
    #重新計算整單的未稅、含稅總金額
    CALL s_tax_recount(l_pmdldocno)
      RETURNING l_pmdl040,l_pmdl042,l_pmdl041,l_xrcd113,l_xrcd114,l_xrcd115
    UPDATE pmdl_t SET pmdl040 = l_pmdl040,
                      pmdl042 = l_pmdl042,
                      pmdl041 = l_pmdl041
      WHERE pmdlent = g_enterprise AND pmdldocno = l_pmdldocno
      
    
    CALL s_transaction_end('Y','0')
    INITIALIZE g_errparam TO NULL
    LET g_errparam.code = 'apm-00613'
    LET g_errparam.extend = ''
    LET g_errparam.popup = TRUE
    LET g_errparam.replace[1] = l_pmdldocno
    CALL cl_err()
    
    LET g_pmdldocno = l_pmdldocno
    
    CLOSE apmt520_cl
    CALL s_transaction_end('Y','0')
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_purchase_pmds" order="38" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#根據倉退單，產生採購單頭資料
PRIVATE FUNCTION apmt520_gen_purchase_pmds()
DEFINE l_pmdl_m      RECORD LIKE pmdl_t.*
DEFINE l_success     LIKE type_t.num5
DEFINE r_success     LIKE type_t.num5
DEFINE l_oobn003     LIKE oobn_t.oobn003
DEFINE ls_sql        STRING
DEFINE l_pmdlcrtdt   DATETIME YEAR TO SECOND
DEFINE l_pmdnseq     LIKE pmdn_t.pmdnseq
DEFINE l_n           LIKE type_t.num5
DEFINE l_prog        LIKE type_t.chr20     #作業編號 (gzzz001)
DEFINE l_ooef016     LIKE ooef_t.ooef016
DEFINE l_scc40       LIKE type_t.chr2
DEFINE l_oodbl004    LIKE oodbl_t.oodbl004  #稅別名稱
DEFINE l_oodb005     LIKE oodb_t.oodb005    #含稅否
DEFINE l_oodb006     LIKE oodb_t.oodb006    #稅率 
DEFINE l_oodb011     LIKE oodb_t.oodb011    #取得稅別類型1:正常稅率2:依料件設定

    LET r_success = TRUE
    
    IF g_argv[1] MATCHES '[7]' THEN
       LET l_prog = "apmt500"
    END IF
    IF g_argv[1] = '14' THEN
       LET l_prog = "apmt501"
    END IF
    IF g_argv[1] = '15' THEN
       LET l_prog = "apmt502"
    END IF
    
    #根據收貨單別 ，獲取後置入庫單別
    CALL s_aooi210_get_doc(g_site,'','4',g_pmds_m.pmdsdocno,l_prog,'') RETURNING l_success,l_oobn003
    IF NOT l_success THEN
       CALL s_transaction_end('N','0')
       RETURN
    END IF
    
    CALL s_aooi200_gen_docno(g_site,l_oobn003,g_today,l_prog) RETURNING l_success,l_pmdl_m.pmdldocno
    IF NOT l_success THEN
       INITIALIZE g_errparam TO NULL
       LET g_errparam.code = 'apm-00003'
       LET g_errparam.extend = l_pmdl_m.pmdldocno
       LET g_errparam.popup = TRUE
       CALL cl_err()
       CALL s_transaction_end('N','0')
       RETURN
    END IF

    LET l_pmdl_m.pmdlownid = g_user
    LET l_pmdl_m.pmdlowndp = g_dept
    LET l_pmdl_m.pmdlcrtid = g_user
    LET l_pmdl_m.pmdlcrtdp = g_dept 
    LET l_pmdlcrtdt = cl_get_current()
    LET l_pmdl_m.pmdlmodid = ""
    LET l_pmdl_m.pmdlmoddt = ""
    LET l_pmdl_m.pmdlstus = "N"
    
    
    LET l_pmdl_m.pmdldocdt = g_today
    LET l_pmdl_m.pmdl001 = 0
    LET l_pmdl_m.pmdl002 = g_user
    LET l_pmdl_m.pmdl003 = g_dept
    LET l_pmdl_m.pmdl004 = g_pmds_m.pmds007
    
    LET l_pmdl_m.pmdl013 = "N"
    LET l_pmdl_m.pmdl019 = "Y"
    LET l_pmdl_m.pmdl054 = "1"
    LET l_pmdl_m.pmdl055 = "1"
    LET l_pmdl_m.pmdl030 = "N"
    LET l_pmdl_m.pmdl042 = "0"
    LET l_pmdl_m.pmdl047 = "N"
    LET l_pmdl_m.pmdl048 = "N"
    LET l_pmdl_m.pmdl049 = "N"
    LET l_pmdl_m.pmdl046 = "1"
    LET l_pmdl_m.pmdl040 = "0"
    LET l_pmdl_m.pmdl041 = "0"
      
    
    #當倉退方式為'2'時產生的採購單的採購性質為'6:換貨採購單'，當倉退方式為'3'時，產生的採購單的採購性質為'1:一般採購'
    #原方式 2：仓退换货（与帐款无关） 選項已取消
    #IF g_pmds_m.pmds100 = '2' THEN
    #   LET l_pmdl_m.pmdl005 = '6'
    #END IF
    IF g_pmds_m.pmds100 = '3' THEN
       LET l_pmdl_m.pmdl005 = '1'
    END IF
    
    LET l_pmdl_m.pmdl006 = '1'
    LET l_pmdl_m.pmdl007 = '7'  #倉退單
    LET l_pmdl_m.pmdl008 = g_pmds_m.pmdsdocno
    
    #抓取交易對象聯絡人明細檔的聯絡對像識別碼顯示在採購單上的[C:供應商連絡人]，
    #若有設置多個聯絡人時，則取有勾選主要聯絡人的那一個
    SELECT pmaj002 INTO l_pmdl_m.pmdl027 FROM pmaj_t WHERE pmajent = g_enterprise AND pmaj001 = l_pmdl_m.pmdl004 AND pmajstus = 'Y' AND pmaj004 = 'Y'
    IF cl_null(l_pmdl_m.pmdl022) THEN
       SELECT pmaj002 INTO l_pmdl_m.pmdl027 FROM pmaj_t WHERE pmajent = g_enterprise AND pmaj001 = l_pmdl_m.pmdl004 AND pmajstus = 'Y' AND pmaj004 = 'Y' AND rownum = 1  
    END IF
      
    LET l_pmdl_m.pmdl009 = g_pmds_m.pmds031
    IF cl_null(l_pmdl_m.pmdl009) THEN
       SELECT pmab037 INTO l_pmdl_m.pmdl009
       FROM pmab_t WHERE pmabent = g_enterprise AND pmabsite = g_site AND pmab001 = l_pmdl_m.pmdl004
    END IF
    
    LET l_pmdl_m.pmdl010 = g_pmds_m.pmds032
    IF cl_null(l_pmdl_m.pmdl010) THEN
       SELECT pmab053 INTO l_pmdl_m.pmdl010
       FROM pmab_t WHERE pmabent = g_enterprise AND pmabsite = g_site AND pmab001 = l_pmdl_m.pmdl004
    END IF
    
    LET l_pmdl_m.pmdl011 = g_pmds_m.pmds033
    IF cl_null(l_pmdl_m.pmdl011) THEN
       SELECT pmab034 INTO l_pmdl_m.pmdl011
       FROM pmab_t WHERE pmabent = g_enterprise AND pmabsite = g_site AND pmab001 = l_pmdl_m.pmdl004
    END IF
    #取稅率、單價含稅否
    IF NOT cl_null(l_pmdl_m.pmdl011) THEN
       LET l_oodb005 = ''
       LET l_oodb006 = ''
       LET l_oodb011 = ''
       CALL s_tax_chk(g_site,l_pmdl_m.pmdl011)
         RETURNING l_success,l_oodbl004,l_oodb005,l_oodb006,l_oodb011
         
       IF l_success THEN
          LET l_pmdl_m.pmdl012 = l_oodb006
          LET l_pmdl_m.pmdl013 = l_oodb005
       END IF           
    END IF
      
    
    LET l_pmdl_m.pmdl015 = g_pmds_m.pmds037
    IF cl_null(l_pmdl_m.pmdl015) THEN
       SELECT pmab033 INTO l_pmdl_m.pmdl015
       FROM pmab_t WHERE pmabent = g_enterprise AND pmabsite = g_site AND pmab001 = l_pmdl_m.pmdl004
    END IF
    
    LET l_pmdl_m.pmdl023 = g_pmds_m.pmds012
    IF cl_null(l_pmdl_m.pmdl023) THEN
       SELECT pmab038 INTO l_pmdl_m.pmdl023
       FROM pmab_t WHERE pmabent = g_enterprise AND pmabsite = g_site AND pmab001 = l_pmdl_m.pmdl004
    END IF
    
    LET l_pmdl_m.pmdl021 = g_pmds_m.pmds008
    LET l_pmdl_m.pmdl022 = g_pmds_m.pmds009
    
    SELECT pmab054,pmab040,pmab039,pmab056,pmab057,pmab058
         INTO l_pmdl_m.pmdl017,l_pmdl_m.pmdl020,l_pmdl_m.pmdl024,l_pmdl_m.pmdl033,
              l_pmdl_m.pmdl054,l_pmdl_m.pmdl055
       FROM pmab_t WHERE pmabent = g_enterprise AND pmabsite = g_site AND pmab001 = l_pmdl_m.pmdl004
    
    #取匯率
    IF NOT cl_null(l_pmdl_m.pmdl015) THEN
       #根據內外購獲取當前營運據點參數設置的汇率类型
       LET l_scc40 = ''
       IF l_pmdl_m.pmdl054 = '1' THEN   #內購
          LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0014')
       END IF
       IF l_pmdl_m.pmdl054 = '2' THEN   #外購
          LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0015')
       END IF
       LET l_ooef016 = ''
       SELECT ooef016 INTO l_ooef016 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
       IF NOT cl_null(l_scc40) THEN
          CALL s_aooi160_get_exrate('1',g_site,g_today,l_pmdl_m.pmdl015,l_ooef016,0,l_scc40) RETURNING l_pmdl_m.pmdl016
       END IF
    END IF
    
    INSERT INTO pmdl_t (pmdlent,pmdlsite,pmdldocno,pmdl001,pmdldocdt,pmdl002,pmdl004,pmdl003, 
        pmdlstus,pmdl005,pmdl006,pmdl007,pmdl008,pmdl027,pmdl052,pmdl053,pmdl009,pmdl010, 
        pmdl011,pmdl012,pmdl013,pmdl033,pmdl015,pmdl016,pmdl017,pmdl018,pmdl019,pmdl023,pmdl043, 
        pmdl044,pmdl051,pmdl020,pmdl025,pmdl026,pmdl029,pmdl021,pmdl022,pmdl032,pmdl024,pmdl054, 
        pmdl055,pmdl030,pmdl031,pmdl028,pmdl042,pmdl047,pmdl048,pmdl049,pmdl046,pmdl040,pmdl041, 
        pmdlownid,pmdlowndp,pmdlcrtid,pmdlcrtdp,pmdlcrtdt,pmdlcnfid,pmdlcnfdt)
    VALUES (g_enterprise,g_site,l_pmdl_m.pmdldocno,l_pmdl_m.pmdl001,l_pmdl_m.pmdldocdt, 
        l_pmdl_m.pmdl002,l_pmdl_m.pmdl004,l_pmdl_m.pmdl003,l_pmdl_m.pmdlstus,l_pmdl_m.pmdl005, 
        l_pmdl_m.pmdl006,l_pmdl_m.pmdl007,l_pmdl_m.pmdl008,l_pmdl_m.pmdl027,l_pmdl_m.pmdl052, 
        l_pmdl_m.pmdl053,l_pmdl_m.pmdl009,l_pmdl_m.pmdl010,l_pmdl_m.pmdl011,l_pmdl_m.pmdl012, 
        l_pmdl_m.pmdl013,l_pmdl_m.pmdl033,l_pmdl_m.pmdl015,l_pmdl_m.pmdl016,l_pmdl_m.pmdl017, 
        l_pmdl_m.pmdl018,l_pmdl_m.pmdl019,l_pmdl_m.pmdl023,l_pmdl_m.pmdl043,l_pmdl_m.pmdl044, 
        l_pmdl_m.pmdl051,l_pmdl_m.pmdl020,l_pmdl_m.pmdl025,l_pmdl_m.pmdl026,l_pmdl_m.pmdl029, 
        l_pmdl_m.pmdl021,l_pmdl_m.pmdl022,l_pmdl_m.pmdl032,l_pmdl_m.pmdl024,l_pmdl_m.pmdl054, 
        l_pmdl_m.pmdl055,l_pmdl_m.pmdl030,l_pmdl_m.pmdl031,l_pmdl_m.pmdl028,l_pmdl_m.pmdl042, 
        l_pmdl_m.pmdl047,l_pmdl_m.pmdl048,l_pmdl_m.pmdl049,l_pmdl_m.pmdl046,l_pmdl_m.pmdl040, 
        l_pmdl_m.pmdl041,l_pmdl_m.pmdlownid,l_pmdl_m.pmdlowndp,l_pmdl_m.pmdlcrtid,l_pmdl_m.pmdlcrtdp, 
        l_pmdlcrtdt,l_pmdl_m.pmdlcnfid,l_pmdl_m.pmdlcnfdt) 
    IF SQLCA.sqlcode THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "l_pmdl_m" 
       LET g_errparam.code   = SQLCA.sqlcode 
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       CALL s_transaction_end('N','0')
       LET r_success = FALSE
       RETURN r_success,''
    END IF
    
    RETURN r_success,l_pmdl_m.pmdldocno
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_purchase_pmdn" order="39" ver="9" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#產生採購單身檔
PRIVATE FUNCTION apmt520_gen_purchase_pmdn(p_pmdldocno)
DEFINE p_pmdldocno    LIKE pmdl_t.pmdldocno
DEFINE l_pmdn         RECORD LIKE pmdn_t.*
DEFINE l_pmdt         RECORD LIKE pmdt_t.*
DEFINE r_success      LIKE type_t.num5
DEFINE l_success      LIKE type_t.num5
DEFINE l_imaf171      LIKE imaf_t.imaf171
DEFINE l_imaf172      LIKE imaf_t.imaf172
DEFINE l_imaf173      LIKE imaf_t.imaf173
DEFINE l_imaf174      LIKE imaf_t.imaf174
DEFINE l_imaf175      LIKE imaf_t.imaf175
DEFINE l_time1        LIKE imaf_t.imaf171
DEFINE l_time2        LIKE imaf_t.imaf171
DEFINE l_pmdl017      LIKE pmdl_t.pmdl017
DEFINE l_pmdl004      LIKE pmdl_t.pmdl004
DEFINE l_pmdl015      LIKE pmdl_t.pmdl015
DEFINE l_pmdl009      LIKE pmdl_t.pmdl009
DEFINE l_pmdl010      LIKE pmdl_t.pmdl010
DEFINE l_pmdl023      LIKE pmdl_t.pmdl023
DEFINE l_pmdl054      LIKE pmdl_t.pmdl054
DEFINE l_pmdl020      LIKE pmdl_t.pmdl020
DEFINE l_sql          STRING
DEFINE l_pmdt001      LIKE pmdt_t.pmdt001
DEFINE l_pmdt002      LIKE pmdt_t.pmdt002
DEFINE l_pmdt003      LIKE pmdt_t.pmdt003
DEFINE l_pmdt004      LIKE pmdt_t.pmdt004
DEFINE l_pmdldocdt    LIKE pmdl_t.pmdldocdt
DEFINE l_pmdn007_t    LIKE pmdn_t.pmdn007
DEFINE l_pmdn007      LIKE pmdn_t.pmdn007

    LET r_success = TRUE
    
    DECLARE pur_pmdn CURSOR FOR
        SELECT * FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno 
    
    INITIALIZE l_pmdn.* TO NULL
    
    FOREACH pur_pmdn INTO l_pmdt.*
       
       LET l_pmdn.pmdndocno = p_pmdldocno
       LET l_pmdn.pmdnsite = g_site
       #項次加1
       SELECT MAX(pmdnseq)+1 INTO l_pmdn.pmdnseq FROM pmdn_t
         WHERE pmdnent = g_enterprise AND pmdndocno = p_pmdldocno
       IF cl_null(l_pmdn.pmdnseq) OR l_pmdn.pmdnseq = 0 THEN
          LET l_pmdn.pmdnseq = 1
       END IF
       
       LET l_pmdn.pmdn001 = l_pmdt.pmdt006
       LET l_pmdn.pmdn002 = l_pmdt.pmdt007
       LET l_pmdn.pmdn003 = l_pmdt.pmdt008
       LET l_pmdn.pmdn004 = l_pmdt.pmdt009
       LET l_pmdn.pmdn005 = l_pmdt.pmdt010
       LET l_pmdn.pmdn006 = l_pmdt.pmdt019
       LET l_pmdn.pmdn007 = l_pmdt.pmdt020
       
       #已轉採購單的數量
       SELECT SUM(pmdn007) INTO l_pmdn007 FROM pmdn_t,pmdl_t 
          WHERE pmdlent = pmdnent AND pmdldocno = pmdndocno AND pmdl008 = g_pmds_m.pmdsdocno
            AND pmdldocno <> p_pmdldocno AND pmdlstus <> 'X'
            
       IF cl_null(l_pmdn007) THEN
          LET l_pmdn007 = 0
       END IF
       LET l_pmdn.pmdn007 = l_pmdn.pmdn007 - l_pmdn007
       IF l_pmdn.pmdn007 = 0 THEN
          CONTINUE FOREACH
       END IF
       
       LET l_pmdn.pmdn008 = l_pmdt.pmdt021
       #LET l_pmdn.pmdn009 = l_pmdt.pmdt022
       LET l_pmdn.pmdn010 = l_pmdt.pmdt023
       #LET l_pmdn.pmdn011 = l_pmdt.pmdt024
       IF NOT cl_null(l_pmdn.pmdn006) THEN
          CALL s_aooi250_take_decimals(l_pmdn.pmdn006,l_pmdn.pmdn007)
             RETURNING l_success,l_pmdn.pmdn007
                  
          IF (NOT cl_null(l_pmdn.pmdn008)) AND (NOT cl_null(l_pmdn.pmdn001)) THEN
             CALL s_aooi250_convert_qty(l_pmdn.pmdn001,l_pmdn.pmdn006,l_pmdn.pmdn008,l_pmdn.pmdn007)
                       RETURNING l_success,l_pmdn.pmdn009
             CALL s_aooi250_take_decimals(l_pmdn.pmdn008,l_pmdn.pmdn009)
                 RETURNING l_success,l_pmdn.pmdn009
          END IF
          
          IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(l_pmdn.pmdn010)) AND (NOT cl_null(l_pmdn.pmdn010)) AND apmt520_get_imaf144(l_pmdn.pmdn001) THEN
             CALL s_aooi250_convert_qty(l_pmdn.pmdn001,l_pmdn.pmdn006,l_pmdn.pmdn010,l_pmdn.pmdn007)
                       RETURNING l_success,l_pmdn.pmdn011
             CALL s_aooi250_take_decimals(l_pmdn.pmdn010,l_pmdn.pmdn011)
                 RETURNING l_success,l_pmdn.pmdn011
          ELSE
             LET l_pmdn.pmdn010 = l_pmdn.pmdn006
             LET l_pmdn.pmdn011 = l_pmdn.pmdn007
          END IF
       END IF
       
       IF cl_null(l_pmdn.pmdn010) OR cl_null(l_pmdn.pmdn011) THEN
          LET l_pmdn.pmdn010 = l_pmdn.pmdn006
          LET l_pmdn.pmdn011 = l_pmdn.pmdn007
       END IF
                     
       #根據收貨單號和項次 找到原採購單的出貨、到廠、到庫日期
       SELECT pmdt001,pmdt002,pmdt003,pmdt004 INTO l_pmdt001,l_pmdt002,l_pmdt003,l_pmdt004
         FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmds006 AND pmdtseq = l_pmdt.pmdt002
       SELECT pmdo011,pmdo012,pmdo013 INTO l_pmdn.pmdn012,l_pmdn.pmdn013,l_pmdn.pmdn014
         FROM pmdo_t WHERE pmdoent = g_enterprise AND pmdodocno = l_pmdt001 
                       AND pmdoseq = l_pmdt002 AND pmdoseq1 = l_pmdt003 AND pmdoseq2 = l_pmdt004
       
       LET l_pmdn.pmdn016 = l_pmdt.pmdt046
       LET l_pmdn.pmdn017 = l_pmdt.pmdt037
       LET l_pmdn.pmdn019 = l_pmdt.pmdt005
       LET l_pmdn.pmdn020 = l_pmdt.pmdt025
       
       IF NOT cl_null(l_pmdn.pmdn014) THEN  
          LET l_imaf171 = 0
          LET l_imaf172 = 0
          LET l_imaf173 = 0
          LET l_imaf174 = 0
          LET l_imaf175 = 0
          LET l_time1 = 0
          LET l_time2 = 0
          
          SELECT imaf171,imaf172,imaf173,imaf174,imaf175 INTO l_imaf171,l_imaf172,l_imaf173,l_imaf174,l_imaf175
            FROM imaf_t 
            WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = l_pmdn.pmdn001

          LET l_time1 = l_pmdn.pmdn014 - g_today         #到庫日期  - g_today
          LET l_time2 = l_imaf171+l_imaf172+l_imaf173+l_imaf174  #[T:料件據點進銷存檔]設置的(文件+交貨+到廠+入庫)前置天數
          
          #1.若輸入的到庫日期 - g_today >[T:料件據點進銷存檔]設置的(文件+交貨+到廠+入庫)前置天數時，則[C:緊急度] = '1'(一般)
          IF l_time1 >= l_time2 THEN
             LET l_pmdn.pmdn020 = '1'
          END IF
          
          #2.若輸入的到庫日期 - g_today <[T:料件據點進銷存檔]設置的(文件+交貨+到廠+入庫)前置天數，
          #   且到庫日期 - g_today >[T:料件據點進銷存檔].[C:嚴守交期前置時間]時，則[C:緊急度] = '2'(緊急)
          IF l_time1 < l_time2 AND l_time1 >= l_imaf175 THEN
             LET l_pmdn.pmdn020 = '2'
          END IF
          
          #3.若輸入的到庫日期 - g_today <[T:料件據點進銷存檔].[C:嚴守交期前置時間]時，則[C:緊急度] = '3'(特急)
          IF l_time1 < l_imaf175 THEN
             LET l_pmdn.pmdn020 = '3'
          END IF
       END IF
       
       LET l_pmdn.pmdn021 = l_pmdt.pmdt041
       LET l_pmdn.pmdn022 = 'N'
       LET l_pmdn.pmdnunit = g_site
       LET l_pmdn.pmdnorga = g_site
       LET l_pmdn.pmdn023 = g_pmds_m.pmds009
       LET l_pmdn.pmdn024 = 'N'
       LET l_pmdn.pmdn028 = l_pmdt.pmdt016
       LET l_pmdn.pmdn029 = l_pmdt.pmdt017
       LET l_pmdn.pmdn030 = l_pmdt.pmdt018
       LET l_pmdn.pmdn050 = l_pmdt.pmdt059
       
       SELECT pmdl020 INTO l_pmdn.pmdn031 FROM pmdl_t WHERE pmdlent = g_enterprise AND pmdldocno = p_pmdldocno
       LET l_pmdn.pmdn032 ='1'
       
       SELECT imaf165 INTO l_pmdn.pmdn033 FROM imaf_t
         WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = l_pmdn.pmdn001
       
       LET l_pmdn.pmdn035 = l_pmdt.pmdt040
       LET l_pmdn.pmdn045 = '1'
       
       
       SELECT pmdl017,pmdl004,pmdl015,pmdl009,pmdl010,pmdl023,pmdl054,pmdldocdt 
          INTO l_pmdl017,l_pmdl004,l_pmdl015,l_pmdl009,l_pmdl010,l_pmdl023,l_pmdl054,l_pmdldocdt
          FROM pmdl_t WHERE pmdlent = g_enterprise AND pmdldocno = p_pmdldocno      
       CALL s_apmt500_get_price(l_pmdl017,l_pmdl004,l_pmdn.pmdn001,l_pmdn.pmdn002,l_pmdl015,
                                l_pmdn.pmdn016,l_pmdl009,l_pmdl010,l_pmdl023,p_pmdldocno,
                                l_pmdldocdt,l_pmdn.pmdn010,l_pmdn.pmdn011,g_site,l_pmdl054,'1',l_pmdn.pmdn004,l_pmdn.pmdn005)
          RETURNING l_pmdn.pmdn040,l_pmdn.pmdn043,l_pmdn.pmdn041,l_pmdn.pmdn042   
       
       LET l_pmdn.pmdn015 = l_pmdn.pmdn043
       LET l_pmdn.pmdn044 = 0
  
       #重新計算[C:未稅金額]、[C:含稅金額]、[稅額]
       CALL s_apmt500_get_amount(p_pmdldocno,l_pmdn.pmdnseq,l_pmdl015,l_pmdn.pmdn011,l_pmdn.pmdn015,l_pmdn.pmdn016)
            RETURNING l_pmdn.pmdn046,l_pmdn.pmdn048,l_pmdn.pmdn047
    
    
       LET l_pmdn.pmdn052 = ''
       LET l_sql = " SELECT qcap006 FROM qcap_t ",
                  " WHERE qcapent = '",g_enterprise,"' ",
                  "  AND qcapsite = '",g_site,"' ",
                  "  AND qcap001 = '",l_pmdn.pmdn001,"' ",
                  "  AND qcap002 = '",l_pmdl004,"' "
                  
       IF l_pmdn.pmdn002 IS NOT NULL THEN
          LET l_sql = l_sql ," AND ( qcap005 = '",l_pmdn.pmdn002,"' OR qcap005 = 'ALL') "
       END IF
       IF (NOT cl_null(l_pmdn.pmdn004)) AND (NOT cl_null(l_pmdn.pmdn005)) THEN
          LET l_sql = l_sql ," AND ( qcap003 = '",l_pmdn.pmdn004,"' OR qcap003 = 'ALL' ) AND qcap004 = '",l_pmdn.pmdn005,"' "
       END IF
       
       PREPARE pur_qcap FROM l_sql
       EXECUTE pur_qcap INTO l_pmdn.pmdn052   #總筆數
       FREE pur_qcap
       
       IF cl_null(l_pmdn.pmdn052) THEN
          #若沒有維護aqci050,再從aqci040中帶值
          SELECT imae114 INTO l_pmdn.pmdn052 FROM imae_t 
              WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = l_pmdn.pmdn001
              
       END IF
       
       IF cl_null(l_pmdn.pmdn052) THEN
          LET l_pmdn.pmdn052 = 'N'
       END IF
       
       LET l_pmdn.pmdn053 = l_pmdt.pmdt063
       
       #新增採購單身明細
       INSERT INTO pmdn_t(pmdnent,pmdnsite,pmdndocno,pmdnseq,pmdn001,pmdn002,pmdn003,pmdn006,pmdn007,
                          pmdn008,pmdn009,pmdn010,pmdn011,pmdn012,pmdn013,pmdn014,pmdn015,pmdn016,
                          pmdn017,pmdn019,pmdn020,pmdn021,pmdn022,pmdn023,pmdn024,pmdn025,pmdn026,
                          pmdn027,pmdn028,pmdn029,pmdn030,pmdn031,pmdn032,pmdn033,pmdn035,pmdn040,pmdn041,pmdn042,pmdn043,pmdn044,pmdn045,
                          pmdn046,pmdn047,pmdn048,pmdnunit,pmdnorga,pmdn052,pmdn053)
         VALUES (g_enterprise,l_pmdn.pmdnsite,p_pmdldocno,l_pmdn.pmdnseq,l_pmdn.pmdn001,l_pmdn.pmdn002,
                 l_pmdn.pmdn003,l_pmdn.pmdn006,l_pmdn.pmdn007,l_pmdn.pmdn008,l_pmdn.pmdn009,
                 l_pmdn.pmdn010,l_pmdn.pmdn011,l_pmdn.pmdn012,l_pmdn.pmdn013,l_pmdn.pmdn014,
                 l_pmdn.pmdn015,l_pmdn.pmdn016,l_pmdn.pmdn017,l_pmdn.pmdn019,l_pmdn.pmdn020,
                 l_pmdn.pmdn021,l_pmdn.pmdn022,l_pmdn.pmdn023,l_pmdn.pmdn024,l_pmdn.pmdn025,
                 l_pmdn.pmdn026,l_pmdn.pmdn027,l_pmdn.pmdn028,l_pmdn.pmdn029,l_pmdn.pmdn030,l_pmdn.pmdn031,
                 l_pmdn.pmdn032,l_pmdn.pmdn033,l_pmdn.pmdn035,l_pmdn.pmdn040,l_pmdn.pmdn041,l_pmdn.pmdn042,
                 l_pmdn.pmdn043,l_pmdn.pmdn044,l_pmdn.pmdn045,
                 l_pmdn.pmdn046,l_pmdn.pmdn047,l_pmdn.pmdn048,l_pmdn.pmdnunit,l_pmdn.pmdnorga,
                 l_pmdn.pmdn052,l_pmdn.pmdn053)
       IF SQLCA.SQLcode  THEN
           INITIALIZE g_errparam TO NULL
           LET g_errparam.code = SQLCA.sqlcode
           LET g_errparam.extend = "pmdn_t"
           LET g_errparam.popup = TRUE
           CALL cl_err()
  
           LET r_success = FALSE                 
           RETURN r_success
       END IF
       
       #新增關聯單身明細
       IF NOT apmt520_gen_purchase_pmdp(l_pmdt.*,l_pmdn.*) THEN
          LET r_success = FALSE                 
          RETURN r_success
       END IF
       
       #新增交期明細資料
       IF NOT s_apmt500_gen_pmdq(p_pmdldocno,l_pmdn.pmdnseq) THEN
          LET r_success = FALSE                 
          RETURN r_success
       END IF
       
       #新增交期明細資料
       IF NOT s_apmt500_gen_pmdo(p_pmdldocno,l_pmdn.pmdnseq) THEN
          LET r_success = FALSE                 
          RETURN r_success
       END IF
      
       INITIALIZE l_pmdn.* TO NULL
       
    END FOREACH
    
    
    RETURN r_success
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_purchase_pmdp" order="40" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#產生關聯單據單身檔
PRIVATE FUNCTION apmt520_gen_purchase_pmdp(p_pmdt,p_pmdn)
DEFINE p_pmdt    RECORD LIKE pmdt_t.*
DEFINE p_pmdn    RECORD LIKE pmdn_t.*
DEFINE l_pmdp    RECORD LIKE pmdp_t.*
DEFINE r_success LIKE type_t.num5
DEFINE p_pmdn007 LIKE pmdn_t.pmdn007

    LET r_success = TRUE
    
    LET l_pmdp.pmdpdocno = p_pmdn.pmdndocno
    LET l_pmdp.pmdpseq = p_pmdn.pmdnseq
    #項序加1
    SELECT MAX(pmdpseq1)+1 INTO l_pmdp.pmdpseq1 FROM pmdp_t
      WHERE pmdpent = g_enterprise AND pmdpdocno = p_pmdn.pmdndocno AND pmdpseq = p_pmdn.pmdnseq
    IF cl_null(l_pmdp.pmdpseq1) OR l_pmdp.pmdpseq1 = 0 THEN
       LET l_pmdp.pmdpseq1 = 1
    END IF
    
    LET l_pmdp.pmdp001 = p_pmdn.pmdn001
    LET l_pmdp.pmdp002 = p_pmdn.pmdn002
    LET l_pmdp.pmdp003 = p_pmdt.pmdtdocno
    LET l_pmdp.pmdp004 = p_pmdt.pmdtseq
    
    LET l_pmdp.pmdp007 = p_pmdt.pmdt006
    LET l_pmdp.pmdp008 = p_pmdt.pmdt007
    LET l_pmdp.pmdp009 = p_pmdt.pmdt009
    LET l_pmdp.pmdp010 = p_pmdt.pmdt010
    
    LET l_pmdp.pmdp022 = p_pmdn.pmdn006
    LET l_pmdp.pmdp023 = p_pmdn.pmdn007
    LET l_pmdp.pmdp024 = p_pmdn.pmdn007
    LET l_pmdp.pmdp025 = 0
    LET l_pmdp.pmdp026 = 0
    
    SELECT MAX(pmdp021)+1 INTO l_pmdp.pmdp021 FROM pmdp_t
       WHERE pmdp001 = l_pmdp.pmdp001 AND pmdp002 = l_pmdp.pmdp002 AND pmdp022 = l_pmdp.pmdp022
         AND pmdpdocno = l_pmdp.pmdpdocno
    IF cl_null(l_pmdp.pmdp021) OR l_pmdp.pmdp021 = 0 THEN
       LET l_pmdp.pmdp021 = 1
    END IF
          
    
    INSERT INTO pmdp_t(pmdpent,pmdpsite,pmdpdocno,pmdpseq,pmdpseq1,pmdp001,pmdp002,pmdp003,pmdp004,
                       pmdp007,pmdp008,pmdp009,pmdp010,pmdp021,pmdp022,pmdp023,pmdp024,pmdp025,pmdp026)
               VALUES (g_enterprise,g_site,l_pmdp.pmdpdocno,l_pmdp.pmdpseq,l_pmdp.pmdpseq1,l_pmdp.pmdp001,
                       l_pmdp.pmdp002,l_pmdp.pmdp003,l_pmdp.pmdp004,l_pmdp.pmdp007,l_pmdp.pmdp008,l_pmdp.pmdp009,l_pmdp.pmdp010,
                       l_pmdp.pmdp021,l_pmdp.pmdp022,l_pmdp.pmdp023,l_pmdp.pmdp024,l_pmdp.pmdp025,l_pmdp.pmdp026)
    IF SQLCA.SQLcode  THEN
       INITIALIZE g_errparam TO NULL
       LET g_errparam.code = SQLCA.sqlcode
       LET g_errparam.extend = "pmdp_t"
       LET g_errparam.popup = TRUE
       CALL cl_err()

       LET r_success = FALSE                 
       RETURN r_success
    END IF
    
    RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.apmt520_upd_pmds052" order="41" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#維護供應商出貨日
PRIVATE FUNCTION apmt520_upd_pmds052()
DEFINE l_pmdsmoddt  LIKE pmds_t.pmdsmoddt
DEFINE l_forupd_sql STRING

   IF g_pmds_m.pmdsdocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF

   SELECT UNIQUE pmdssite,pmds000,pmdsdocno,pmdsdocdt,pmds002,pmds001,pmds003,pmdsstus,pmds006,pmds007, 
          pmds008,pmds009,pmds010,pmds011,pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033, 
          pmds034,pmds035,pmds036,pmds037,pmds038,pmds039,pmds040,pmds041,pmds042,pmds043,pmds044,pmds046, 
          pmdsownid,pmdsowndp,pmdscrtid,pmdscrtdp,pmdscrtdt,pmdsmodid,pmdsmoddt,pmdscnfid,pmdscnfdt,pmdspstid, 
          pmdspstdt
   INTO g_pmds_m.pmdssite,g_pmds_m.pmds000,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds002,g_pmds_m.pmds001, 
       g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009, 
       g_pmds_m.pmds010,g_pmds_m.pmds011,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023, 
       g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035, 
       g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,g_pmds_m.pmds041, 
       g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt
   FROM pmds_t
   WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
 
   ERROR ""
  
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
   CALL s_transaction_begin()
   
   LET l_forupd_sql = "SELECT pmdssite,pmdsdocno,pmdsdocdt,pmds002,pmds001,pmds003, ",
                      " pmdsstus,pmds006,pmds007,pmds008,pmds009,pmds010,pmds000,pmds100,pmds011,pmds081, ",
                      " pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,", 
                      " pmds037,pmds038,pmds039,pmds040,pmds041,pmds042,pmds043,pmds044,pmds046 ",
                      " FROM pmds_t WHERE pmdsent= ? AND pmdsdocno=? FOR UPDATE"
                      
   LET l_forupd_sql = cl_sql_forupd(l_forupd_sql)                #轉換不同資料庫語法
   DECLARE apmt520_cl4 CURSOR FROM l_forupd_sql

   OPEN apmt520_cl4 USING g_enterprise,g_pmds_m.pmdsdocno
 
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN apmt520_cl4:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE apmt520_cl4
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #鎖住將被更改或取消的資料
   FETCH apmt520_cl4 INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,
       g_pmds_m.pmds002,g_pmds_m.pmds001,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,
       g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds081,g_pmds_m.pmds045,
       g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,
       g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,
       g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,
       g_pmds_m.pmds040,g_pmds_m.pmds041,g_pmds_m.pmds042,
       g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046
   
 
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_pmds_m.pmdsdocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE apmt520_cl4
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   CALL apmt520_show()

   INPUT BY NAME g_pmds_m.pmds052 WITHOUT DEFAULTS

      AFTER INPUT
         #若取消則直接結束
         IF INT_FLAG THEN
            LET INT_FLAG = FALSE
            CLOSE apmt520_cl4
            CALL s_transaction_end('N','0')
            RETURN
         END IF

      AFTER FIELD pmds052
        

   END INPUT

   IF INT_FLAG OR g_pmds_m.pmds001 IS NULL THEN
      LET INT_FLAG = 0
      CLOSE apmt520_cl4
      CALL s_transaction_end('N','0')
      RETURN
   END IF

   LET l_pmdsmoddt = cl_get_current()

   UPDATE pmds_t SET pmds052 = g_pmds_m.pmds052,
                     pmdsmodid = g_user,
                     pmdsmoddt = l_pmdsmoddt
     WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno

   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "pmds_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE apmt520_cl4
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   CLOSE apmt520_cl4
   CALL s_transaction_end('Y','0')

END FUNCTION]]>
  </point>
  <point name="function.apmt520_get_imaa005" order="42" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#取得產品特徵類別
PRIVATE FUNCTION apmt520_get_imaa005(p_enterprise,p_imaa001)
   DEFINE p_enterprise   LIKE type_t.num5,
          p_imaa001      LIKE imaa_t.imaa001
   DEFINE r_imaa005      LIKE imaa_t.imaa005

   LET r_imaa005 = ''
   SELECT imaa005 INTO r_imaa005 
     FROM imaa_t 
    WHERE imaaent = p_enterprise 
      AND imaa001 = p_imaa001
      
   RETURN r_imaa005   
   
END FUNCTION]]>
  </point>
  <point name="function.apmt520_act_visible_init" order="43" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#根據不同的參數，toolbar選擇顯示或隱藏
PRIVATE FUNCTION apmt520_act_visible_init()

   CALL cl_set_toolbaritem_visible("gen_pmdt,gen_pmdv,upd_pmds081,upd_pmds052,upd_price,gen_warehouse_voucher,gen_purchase,,gen_check_back,query_check_back,query_warehouse_voucher,gen_pmdw,query_detail_aapt110_01,query_aapt110_01,gen_qc,store_in_by_qc,get_detail_price,query_qc",TRUE)

   IF NOT (g_argv[1] MATCHES '[13]' OR g_argv[1] = '23' OR g_argv[1] = '24') THEN   #採購收貨單
      CALL cl_set_toolbaritem_visible("gen_pmdt,gen_pmdv",FALSE)
   END IF

   #驗退、倉退下顯示取回日期，取回功能
   IF NOT (g_argv[1] MATCHES '[57]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '14' OR g_argv[1] = '15') THEN
      CALL cl_set_toolbaritem_visible("upd_pmds081",FALSE)
   END IF 
   
   #驗退、倉退下隱藏供應商出貨日功能
   IF g_argv[1] MATCHES '[57]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26' THEN
      CALL cl_set_toolbaritem_visible("upd_pmds052",FALSE)
   END IF 
   
   #入庫、倉退下顯示可以修改價格
   #IF NOT (g_argv[1] MATCHES '[1346789]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15') THEN
   #   CALL cl_set_toolbaritem_visible("upd_price",FALSE)
   #END IF 
   
   IF NOT (g_argv[1] MATCHES '[3467]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' ) THEN
      CALL cl_set_toolbaritem_visible("query_detail_aapt110_01,query_aapt110_01",FALSE)
   END IF 
   
   #收貨單 下 可以顯示產生入庫單
   IF NOT (g_argv[1] MATCHES '[1289]' OR g_argv[1] = '23') THEN
      CALL cl_set_toolbaritem_visible("gen_warehouse_voucher,query_warehouse_voucher,gen_qc,query_qc",FALSE)
   END IF
   
   IF NOT (g_argv[1] MATCHES '[1289]' ) THEN
      CALL cl_set_toolbaritem_visible("gen_check_back,query_check_back",FALSE)
   END IF
   
   #當倉退方式為2,3時才可以執行此action產生新的一張採購單
   IF NOT (g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15') THEN
      CALL cl_set_toolbaritem_visible("gen_purchase",FALSE)
   END IF
   
   #當涉及到收貨時，可以執行維護進項發票信息的action
   IF NOT (g_argv[1] MATCHES '[123489]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' ) THEN
      CALL cl_set_toolbaritem_visible("gen_pmdw",FALSE)
   END IF
   
   #入庫 顯示產生IQC 及 根據IQC結果重新產生入庫單身明細
   IF NOT (g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25') THEN
      CALL cl_set_toolbaritem_visible("store_in_by_qc",FALSE)
   END IF
   
   #無採購的收貨單據可以對單身進行重新取價
   IF g_argv[1] NOT MATCHES '[24]' THEN   #採購收貨單
      CALL cl_set_toolbaritem_visible("get_detail_price",FALSE)
   END IF
   
END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_check_back" order="44" ver="10" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#在收貨單上 直接產生驗退單
PRIVATE FUNCTION apmt520_gen_check_back()
DEFINE l_pmds_m      RECORD LIKE pmds_t.*
DEFINE l_success     LIKE type_t.num5
DEFINE l_oobn003     LIKE oobn_t.oobn003
DEFINE ls_sql        STRING
DEFINE l_pmdscrtdt   DATETIME YEAR TO SECOND
DEFINE l_pmdtseq     LIKE pmdt_t.pmdtseq
DEFINE l_n           LIKE type_t.num5
DEFINE l_prog        LIKE type_t.chr20     #作業編號 (gzzz001)
DEFINE l_pmdt_s      RECORD LIKE pmdt_t.*   #來源單據 收貨單
DEFINE l_pmdt_p      RECORD LIKE pmdt_t.*   #目的單據 入庫單
DEFINE l_xrcd104     LIKE xrcd_t.xrcd104
DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
DEFINE l_xrcd115     LIKE xrcd_t.xrcd115
DEFINE l_rate        LIKE inaj_t.inaj014
DEFINE l_flag        LIKE type_t.num5
DEFINE l_pmdt020     LIKE pmdt_t.pmdt020
DEFINE r_success     LIKE type_t.num5
DEFINE l_n1          LIKE type_t.num5
DEFINE l_n2          LIKE type_t.num5

    LET r_success = TRUE
    
    IF g_pmds_m.pmdsdocno IS NULL  THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "" 
       LET g_errparam.code   = "std-00003" 
       LET g_errparam.popup  = FALSE 
       CALL cl_err()
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    IF g_pmds_m.pmdsstus <> 'Y' THEN
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    #存在驗退數量(收貨數量-允收數量) > 0的單身
    LET l_n = 0
    SELECT COUNT(*) INTO l_n FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND (pmdt020 - pmdt053 ) > 0
    IF l_n = 0 OR cl_null(l_n) THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = g_pmds_m.pmdsdocno
       LET g_errparam.code   = 'apm-00643'
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    #如果需要走IQC的判斷是否有維護IQC單
    LET l_n1 = 0
    SELECT COUNT(pmdtseq) INTO l_n1 FROM pmdt_t,qcba_t 
       WHERE pmdtent=qcbaent AND pmdtdocno = qcba001 AND pmdtseq = qcba002 AND pmdt026 = 'Y' AND qcbastus = 'Y' AND pmdtdocno=g_pmds_m.pmdsdocno
    SELECT COUNT(*) INTO l_n2 FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND pmdt026 = 'N'
    IF l_n1 = 0 AND l_n2 = 0 THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = g_pmds_m.pmdsdocno
       LET g_errparam.code   = 'apm-00819'
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    CALL s_transaction_begin()
   
    OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
    IF STATUS THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "OPEN apmt520_cl:" 
       LET g_errparam.code   = STATUS 
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       CLOSE apmt520_cl
       CALL s_transaction_end('N','0')
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    IF NOT s_apmt520_gen_pmds('2',g_pmds_m.pmdsdocno) THEN
       CALL s_transaction_end('N','0')
       LET r_success = FALSE
       RETURN r_success
    END IF
    
    CALL s_transaction_end('Y','0')
    #INITIALIZE g_errparam TO NULL
    #LET g_errparam.code = 'apm-00644'
    #LET g_errparam.extend = ''
    #LET g_errparam.popup = TRUE
    #LET g_errparam.replace[1] = l_pmds_m.pmdsdocno
    #CALL cl_err()
    
    RETURN r_success
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt028_chk" order="45" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#驗退、入庫、倉退時，檢查對應收貨單號的收貨項次
PRIVATE FUNCTION apmt520_pmdt028_chk()
DEFINE l_n          LIKE type_t.num5
DEFINE r_success    LIKE type_t.num5

        LET r_success = TRUE
       
        #驗退、入庫、倉退時，檢查對應收貨單號的收貨項次
        IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
           #1.輸入的收貨項次需存在單頭輸入的收貨單號對應的收貨明細中
           LET l_n = 0
           SELECT COUNT(*) INTO l_n FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmds006 AND pmdtseq = g_pmdt_d[l_ac].pmdt028
           IF l_n = 0 OR cl_null(l_n) THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'apm-00450'
              LET g_errparam.extend = g_pmdt_d[l_ac].pmdt028
              LET g_errparam.popup = TRUE
              CALL cl_err()

              LET r_success = FALSE
              RETURN r_success
           END IF
           
           IF NOT s_apmt520_chk_pmdt020(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,'',g_pmdt_d[l_ac].pmdt028,0,0,'',0,0) THEN
              LET r_success = FALSE
              RETURN r_success
           END IF
        END IF
        RETURN r_success
        
END FUNCTION]]>
  </point>
  <point name="function.apmt520_gen_iqc" order="46" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#在入庫單上，根據來源收貨單號產生IQC單
PRIVATE FUNCTION apmt520_gen_iqc()
DEFINE l_pmdsdocdt    LIKE pmds_t.pmdsdocdt
DEFINE l_pmdtseq      LIKE pmdt_t.pmdtseq
DEFINE l_success      LIKE type_t.num5
DEFINE l_start_no     LIKE pmds_t.pmdsdocno
DEFINE l_end_no       LIKE pmds_t.pmdsdocno
DEFINE l_oobn003      LIKE oobn_t.oobn003
DEFINE l_prog         LIKE type_t.chr20     #作業編號 (gzzz001)

    LET l_success = TRUE
    
    IF g_pmds_m.pmdsdocno IS NULL THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "" 
       LET g_errparam.code   = "std-00003" 
       LET g_errparam.popup  = FALSE 
       CALL cl_err()
       RETURN
    END IF
    #IF g_pmds_m.pmds006 IS NULL  THEN
    #   INITIALIZE g_errparam TO NULL 
    #   LET g_errparam.extend = "" 
    #   LET g_errparam.code   = "std-00003" 
    #   LET g_errparam.popup  = FALSE 
    #   CALL cl_err()
    #   RETURN
    #END IF
    
    IF g_pmds_m.pmdsstus NOT MATCHES '[NY]' THEN
       RETURN
    END IF
    
    CALL s_transaction_begin()
   
    OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
    IF STATUS THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "OPEN apmt520_cl:" 
       LET g_errparam.code   = STATUS 
       LET g_errparam.popup  = TRUE 
       CALL cl_err()
       CLOSE apmt520_cl
       CALL s_transaction_end('N','0')
       RETURN
    END IF
    
    LET l_prog = "aqct300"
    
    #根據收貨單別 ，獲取後置入庫單別
    CALL s_aooi210_get_doc(g_site,'','4',g_pmds_m.pmdsdocno,l_prog,'') RETURNING l_success,l_oobn003
    IF NOT l_success THEN
       CALL s_transaction_end('N','0')
       RETURN
    END IF
    
    SELECT UNIQUE pmdssite,pmdsdocno,pmdsdocdt,pmds002,pmds001,pmds003,pmdsstus,
       pmds006,pmds007,pmds008,pmds009,pmds010,pmds052,pmds000,pmds100, 
       pmds011,pmds014,pmds081,pmds045,pmds021,pmds022,pmds023,pmds024,pmds031, 
       pmds032,pmds033,pmds034,pmds035,pmds036,pmds037,pmds038,pmds039,pmds040, 
       pmds012,pmds101,pmds102,pmds048,pmds047,pmds049,pmds053,pmds041,pmds042, 
       pmds043,pmds044,pmds046,pmdsownid,pmdsowndp,pmdscrtid,pmdscrtdp,pmdscrtdt, 
       pmdsmodid,pmdsmoddt,pmdscnfid,pmdscnfdt,pmdspstid,pmdspstdt 
     INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
       g_pmds_m.pmdsdocdt,g_pmds_m.pmds002,g_pmds_m.pmds001,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
       g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
       g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
       g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
       g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
       g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
       g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
       g_pmds_m.pmds046,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp,g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp, 
       g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt, 
       g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt
    FROM pmds_t WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
    
    DECLARE gen_qc_cs CURSOR FOR
       SELECT pmdtseq FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
    FOREACH gen_qc_cs INTO l_pmdtseq
       CALL s_aqct300_gen('1',g_pmds_m.pmdsdocno,l_pmdtseq,l_oobn003,g_pmds_m.pmdsdocdt)
            RETURNING l_success,l_start_no,l_end_no
       IF NOT l_success THEN
          INITIALIZE g_errparam TO NULL 
          LET g_errparam.extend = "" 
          LET g_errparam.code   = "" 
          LET g_errparam.popup  = TRUE 
          CALL cl_err()
          EXIT FOREACH
       END IF
    END FOREACH
    
    CLOSE apmt520_cl
    
    IF NOT l_success THEN
       CALL s_transaction_end('N','0')
    ELSE
       CALL s_transaction_end('Y','0')
    END IF
      
    
    INITIALIZE g_errparam TO NULL
    LET g_errparam.code = 'ain-00399'
    LET g_errparam.extend = ''
    LET g_errparam.popup = TRUE
    CALL cl_err()
    
END FUNCTION]]>
  </point>
  <point name="function.apmt520_chk_inag004" order="47" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#輸入的料件+產品特徵+庫存管理特徵+庫位必須存在[T:庫存明細檔]中
PRIVATE FUNCTION apmt520_chk_inag004(p_pmdt016)
DEFINE p_pmdt016   LIKE pmdt_t.pmdt016
DEFINE r_success   LIKE type_t.num5
      
      LET r_success = TRUE
      
      IF cl_null(g_pmdt_d[l_ac].pmdt007) THEN
         LET g_pmdt_d[l_ac].pmdt007 = ' '
      END IF
      IF cl_null(g_pmdt_d[l_ac].pmdt063) THEN
         LET g_pmdt_d[l_ac].pmdt063 = ' '
      END IF
      #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
      INITIALIZE g_chkparam.* TO NULL
      
      #設定g_chkparam.*的參數
      LET g_chkparam.arg1 = g_site
      LET g_chkparam.arg2 = g_pmdt_d[l_ac].pmdt006
      LET g_chkparam.arg3 = g_pmdt_d[l_ac].pmdt007
      LET g_chkparam.arg4 = g_pmdt_d[l_ac].pmdt063
      LET g_chkparam.arg5 = p_pmdt016
      
      #呼叫檢查存在並帶值的library
      IF NOT cl_chk_exist("v_inag004") THEN
         LET r_success = FALSE
         RETURN r_success  
      END IF
         
      RETURN r_success
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_chk_inag005" order="48" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#輸入的料件+產品特徵+庫存管理特徵+庫位+儲位必須存在[T:庫存明細檔]中
PRIVATE FUNCTION apmt520_chk_inag005(p_pmdt016,p_pmdt017)
DEFINE p_pmdt016   LIKE pmdt_t.pmdt016
DEFINE p_pmdt017   LIKE pmdt_t.pmdt017
DEFINE r_success   LIKE type_t.num5

      LET r_success = TRUE   
      
      IF cl_null(p_pmdt017) THEN
         LET p_pmdt017 = ' '
      END IF
      IF cl_null(g_pmdt_d[l_ac].pmdt063) THEN
         LET g_pmdt_d[l_ac].pmdt063 = ' '
      END IF

      #若是倉退作業時，輸入的料件+產品特徵+庫存管理特徵+庫位必須存在[T:庫存明細檔]中
      IF cl_null(g_pmdt_d[l_ac].pmdt007) THEN
         LET g_pmdt_d[l_ac].pmdt007 = ' '
      END IF

      #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
      INITIALIZE g_chkparam.* TO NULL
      
      #設定g_chkparam.*的參數
      LET g_chkparam.arg1 = g_site
      LET g_chkparam.arg2 = g_pmdt_d[l_ac].pmdt006
      LET g_chkparam.arg3 = g_pmdt_d[l_ac].pmdt007
      LET g_chkparam.arg4 = g_pmdt_d[l_ac].pmdt063
      LET g_chkparam.arg5 = p_pmdt016
      LET g_chkparam.arg6 = p_pmdt017
      
      #呼叫檢查存在並帶值的library
      IF NOT cl_chk_exist("v_inag005") THEN
         LET r_success = FALSE
         RETURN r_success  
      END IF
      RETURN r_success  
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmdt017_chk" order="49" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#儲位檢查
PRIVATE FUNCTION apmt520_pmdt017_chk()
DEFINE r_success   LIKE type_t.num5

      LET r_success = TRUE  

      INITIALIZE g_chkparam.* TO NULL
               
      #設定g_chkparam.*的參數
      LET g_chkparam.arg1 = g_site
      LET g_chkparam.arg2 = g_pmdt_d[l_ac].pmdt016
      LET g_chkparam.arg3 = g_pmdt_d[l_ac].pmdt017

         
      #呼叫檢查存在並帶值的library
      IF NOT cl_chk_exist("v_inab002_1") THEN
         LET r_success = FALSE
         RETURN r_success  
      END IF
      ##倉退時 輸入的料件+產品特徵+庫存管理特徵+庫位+儲位必須存在[T:庫存明細檔]中
      #IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
      #   IF NOT apmt520_chk_inag005(g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) THEN
      #      LET r_success = FALSE
      #      RETURN r_success  
      #   END IF
      #END IF
      RETURN r_success  
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_get_detail_price" order="50" ver="12" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
#對整個單身重新取價
PRIVATE FUNCTION apmt520_get_detail_price()
DEFINE l_forupd_sql STRING
DEFINE l_success    LIKE type_t.num5
DEFINE l_pmdt       RECORD LIKE pmdt_t.*
DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
DEFINE l_xrcd115     LIKE xrcd_t.xrcd115 
   
   IF g_pmds_m.pmdsdocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF
   
   CALL s_transaction_begin()

   LET l_forupd_sql = "SELECT pmdssite,pmdsdocno,pmdsdocdt,pmds002,pmds001,pmds003, ",
                      " pmdsstus,pmds006,pmds007,pmds008,pmds009,pmds010,pmds000,pmds100,pmds011,pmds081, ",
                      " pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,", 
                      " pmds037,pmds038,pmds039,pmds040,pmds041,pmds042,pmds043,pmds044,pmds046 ",
                      " FROM pmds_t WHERE pmdsent= ? AND pmdsdocno=? FOR UPDATE"
                      
   LET l_forupd_sql = cl_sql_forupd(l_forupd_sql)                #轉換不同資料庫語法
   DECLARE apmt520_cl5 CURSOR FROM l_forupd_sql

   OPEN apmt520_cl5 USING g_enterprise,g_pmds_m.pmdsdocno
 
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN apmt520_cl5:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE apmt520_cl5
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #鎖住將被更改或取消的資料
   FETCH apmt520_cl5 INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,
       g_pmds_m.pmds002,g_pmds_m.pmds001,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,
       g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds081,g_pmds_m.pmds045,
       g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,
       g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,
       g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,
       g_pmds_m.pmds040,g_pmds_m.pmds041,g_pmds_m.pmds042,
       g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046
   
 
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_pmds_m.pmdsdocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE apmt520_cl5
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   CALL apmt520_show()
   
   DECLARE get_price_cs CURSOR FOR
       SELECT * FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno

   CALL cl_err_collect_init()

   FOREACH get_price_cs INTO l_pmdt.*
   
      IF cl_null(l_pmdt.pmdt023) OR cl_null(l_pmdt.pmdt024) THEN 
         LET l_pmdt.pmdt023 = l_pmdt.pmdt019
         LET l_pmdt.pmdt024 = l_pmdt.pmdt020
      END IF
      
      CALL s_apmt520_get_price(g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds039,g_pmds_m.pmds007,l_pmdt.pmdt006,l_pmdt.pmdt007,
                               g_pmds_m.pmds037,l_pmdt.pmdt046,g_pmds_m.pmds031,g_pmds_m.pmds032,
                               g_pmds_m.pmds012,l_pmdt.pmdt023,
                               l_pmdt.pmdt024,g_site,g_pmds_m.pmds048,'1',l_pmdt.pmdt009,
                               l_pmdt.pmdt010)          
          RETURNING l_pmdt.pmdt042,l_pmdt.pmdt044,l_pmdt.pmdt043,l_pmdt.pmdt048

      LET l_pmdt.pmdt036 = l_pmdt.pmdt044
      LET l_pmdt.pmdt045 = 0
      
      #重新計算[C:未稅金額]、[C:含稅金額]、[稅額]
      IF (NOT cl_null(l_pmdt.pmdt024)) AND (NOT cl_null(l_pmdt.pmdt046)) THEN
         CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,l_pmdt.pmdtseq,l_pmdt.pmdt001,l_pmdt.pmdt024,l_pmdt.pmdt036,l_pmdt.pmdt046)
           RETURNING l_pmdt.pmdt038,l_pmdt.pmdt047,l_pmdt.pmdt039            
      END IF
          
      UPDATE pmdt_t SET pmdt042 = l_pmdt.pmdt042,
                        pmdt044 = l_pmdt.pmdt044,
                        pmdt043 = l_pmdt.pmdt043,
                        pmdt036 = l_pmdt.pmdt036,
                        pmdt045 = 0,
                        pmdt038 = l_pmdt.pmdt038,
                        pmdt047 = l_pmdt.pmdt047,
                        pmdt039 = l_pmdt.pmdt039,
                        pmdt048 = l_pmdt.pmdt048
       WHERE pmdtent = g_enterprise 
         AND pmdtdocno = g_pmds_m.pmdsdocno
         AND pmdtseq = l_pmdt.pmdtseq  
         
        #更新交期明細資料
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "pmdt_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
      
      END IF   
   END FOREACH
   
   CALL s_tax_recount(g_pmds_m.pmdsdocno)
     RETURNING g_pmds_m.pmds043,g_pmds_m.pmds046,g_pmds_m.pmds044,l_xrcd113,l_xrcd114,l_xrcd115
   UPDATE pmds_t SET pmds043 = g_pmds_m.pmds043,
                     pmds044 = g_pmds_m.pmds044,
                     pmds046 = g_pmds_m.pmds046
       WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
       
   CALL cl_err_collect_show()
  
   CALL s_transaction_end('Y','0')
   CLOSE apmt520_cl5
   
   CALL apmt520_b_fill() 
   

   
   
END FUNCTION]]>
  </point>
  <point name="function.apmt520_get_imaf144" order="51" ver="9" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#判斷料號是否使用計價單位
PRIVATE FUNCTION apmt520_get_imaf144(p_imaf001)
DEFINE p_imaf001   LIKE imaf_t.imaf001
DEFINE l_imaf144   LIKE imaf_t.imaf144
DEFINE r_success   LIKE type_t.num5

      LET r_success = TRUE
      LET l_imaf144 = ''
      SELECT imaf144 INTO l_imaf144 FROM imaf_t WHERE imafent = g_enterprise AND imaf001 = p_imaf001 AND imafsite = g_site
      IF cl_null(l_imaf144) THEN
         LET r_success = FALSE
      END IF
      RETURN r_success
      
END FUNCTION]]>
  </point>
  <point name="function.apmt520_break_continue" order="52" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 中斷續拋否
# Memo...........:
# Usage..........: CALL apmt520_break_continue(p_pmds053)
#                  RETURNING r_success
# Input parameter: p_pmds053   多角流程代碼
#                : 
# Return code....: r_success   執行結果
#                : 
# Date & Author..: 150610 By earl
# Modify.........:
################################################################################
PRIVATE FUNCTION apmt520_break_continue(p_pmds053)
   DEFINE p_pmds053   LIKE pmds_t.pmds053
   DEFINE r_success   LIKE type_t.num5
   DEFINE l_sel       RECORD
      icaa004            LIKE icaa_t.icaa004,
      icaa005            LIKE icaa_t.icaa005,
      icab003            LIKE icab_t.icab003
                      END RECORD

   LET r_success = FALSE

   IF NOT cl_null(p_pmds053) THEN
      INITIALIZE l_sel.* TO NULL
      SELECT icaa004,icaa005,
             icab003
        INTO l_sel.icaa004,l_sel.icaa005,
             l_sel.icab003
        FROM icaa_t LEFT OUTER JOIN icab_t ON icabent = icaaent AND icab001 = icaa001 AND icab002 = 0
       WHERE icaaent = g_enterprise
         AND icaa001 = p_pmds053

      IF l_sel.icaa004 = '2' AND
         l_sel.icaa005 = 'Y' AND
         l_sel.icab003 = g_site THEN

         LET r_success = TRUE
         RETURN r_success
      END IF
   END IF
   
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.apmt520_source_pmds041_chk" order="53" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 多角序號檢查
# Memo...........:
# Usage..........: CALL apmt520_source_pmds041_chk(p_source,p_pmds041)
#                  RETURNING r_success
# Input parameter: p_source   來源單號
#                : p_pmds041  多角流程序號
# Return code....: r_success  執行結果
#                : 
# Date & Author..: 150610 By earl
# Modify.........:
################################################################################
PRIVATE FUNCTION apmt520_source_pmds041_chk(p_source,p_pmds041)
   DEFINE p_source      LIKE pmds_t.pmds006  #來源單號
   DEFINE p_pmds041     LIKE pmds_t.pmds041

   DEFINE r_success     LIKE type_t.num5
   DEFINE l_cnt         LIKE type_t.num5

   LET r_success = TRUE

   IF NOT cl_null(p_pmds041) THEN
      #檢查初始站是否重複
      LET l_cnt = 0
      SELECT COUNT(pmdsdocno) INTO l_cnt
        FROM pmds_t
       WHERE pmdsent = g_enterprise
         AND pmds000 = g_pmds_m.pmds000
         AND pmds041 = p_pmds041
         AND pmdsdocno <> g_pmds_m.pmdsdocno
         AND pmdsstus <> 'X'
         AND pmdssite = g_site

      IF cl_null(l_cnt) THEN
         LET l_cnt = 0
      END IF
      
      IF l_cnt > 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'apm-00943'   #該"多角流程序號"已存在初始站之"入庫單"，不可重複輸入！
         LET g_errparam.extend = p_pmds041
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF

      #檢查是否有已拋轉之逆拋入庫單
      LET l_cnt = 0
      SELECT COUNT(pmdsdocno) INTO l_cnt
        FROM pmds_t
       WHERE pmdsent = g_enterprise
         AND pmds000 IN ('3','20','6','12')     #3.採購收貨入庫,20.委外收貨入庫,6入庫單,12委外入庫
         AND pmds041 = p_pmds041
         AND pmdsstus <> 'X'
         AND pmds050 = 'Y'
         AND pmdssite = (SELECT icab003 FROM icab_t
                          WHERE icabent = g_enterprise
                            AND icab001 = pmds053
                            AND icab002 = (SELECT MAX(icab002) FROM icab_t
                                            WHERE icabent = g_enterprise
                                              AND icab001 = pmds053)
                        )
      
      #150622
      #代採購最終站無入庫單，改抓出貨單
      IF l_cnt = 0 OR cl_null(l_cnt) THEN
         SELECT COUNT(xmdkdocno) INTO l_cnt
           FROM xmdk_t
          WHERE xmdkent = g_enterprise
            AND xmdk000 = '1'
            AND xmdk035 = p_pmds041
            AND xmdkstus <> 'X'
            AND xmdk083 = 'Y'
            AND xmdksite = (SELECT icab003 FROM icab_t
                             WHERE icabent = g_enterprise
                               AND icab001 = xmdk044
                               AND icab002 = (SELECT MAX(icab002) FROM icab_t
                                               WHERE icabent = g_enterprise
                                                 AND icab001 = xmdk044)
                           )      
      END IF
      
      IF cl_null(l_cnt) THEN
         LET l_cnt = 0
      END IF

      IF l_cnt = 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'apm-00944'   #該"多角流程序號"不存在已拋轉之"入庫單"，不可輸入！
         LET g_errparam.extend = p_pmds041
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF

      IF NOT cl_null(p_source) THEN
         #檢查是否有已拋轉之入庫單，且對應相對來源單號
         LET l_cnt = 0
         
         CASE
            WHEN g_argv[1] = '5' OR 
                 g_argv[1] = '6' OR 
                 g_argv[1] = '7' OR 
                 g_argv[1] = '10' OR 
                 g_argv[1] = '11' OR 
                 g_argv[1] = '12' OR 
                 g_argv[1] = '13' OR
                 g_argv[1] = '14' OR 
                 g_argv[1] = '15' OR 
                 g_argv[1] = '25' OR
                 g_argv[1] = '26'
                           
                 #來源為收貨單
                 CALL apmt520_sel_pmds041(p_source,p_pmds041) RETURNING l_cnt,p_pmds041
             OTHERWISE 
                 #來源為採購單
                 CALL apmt520_sel_pmds041(p_source,p_pmds041) RETURNING l_cnt,p_pmds041
                 
         END CASE
         
         IF cl_null(l_cnt) THEN
            LET l_cnt = 0
         END IF

         IF l_cnt = 0 THEN
            INITIALIZE g_errparam TO NULL

            LET g_errparam.code = 'axm-00654'   #該"多角流程序號"與"來源單號"不存在對應關係，不可輸入！
            LET g_errparam.extend = p_pmds041
            LET g_errparam.popup = TRUE
            CALL cl_err()

            LET r_success = FALSE
            RETURN r_success
         END IF

      END IF
   END IF

   RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.apmt520_sel_pmds041" order="54" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 取得多角流程代碼
# Memo...........:
# Usage..........: CALL apmt520_sel_pmds041(p_source,p_pmds041)
#                  RETURNING r_success
# Input parameter: p_source  #來源單號
#                : p_pmds041 #多角流程序號
# Return code....: r_success #執行結果
#                : 
# Date & Author..: 150611 By earl
# Modify.........:
################################################################################
PRIVATE FUNCTION apmt520_sel_pmds041(p_source,p_pmds041)
   DEFINE p_source  LIKE pmds_t.pmds006 #來源單號
   DEFINE p_pmds041 LIKE pmds_t.pmds041 #多角流程序號(可為Null)
   DEFINE r_cnt     LIKE type_t.num10   #符合之多角流程序號數量
   DEFINE r_pmds041 LIKE pmds_t.pmds041 #多角流程序號

   DEFINE l_sql         STRING
   DEFINE l_sql_count   STRING
   DEFINE l_sql_sel     STRING
   DEFINE l_sql_from    STRING
   DEFINE l_sql_where   STRING

   LET l_sql_count =   "SELECT COUNT( DISTINCT a.pmds041)"
   
   LET l_sql_sel =     "SELECT DISTINCT a.pmds041"
   
   LET l_sql_from =    "  FROM pmds_t a",
                       " WHERE a.pmdsent = ",g_enterprise,
                       "   AND a.pmdsstus <> 'X'",
                       "   AND a.pmds050 = 'Y'",
                       #逆拋最終站
                       "   AND a.pmdssite = (SELECT icab003 FROM icab_t",
                       "                      WHERE icabent = ",g_enterprise,
                       "                        AND icab001 = a.pmds053",
                       "                        AND icab002 = (SELECT MAX(icab002) FROM icab_t",
                       "                                        WHERE icabent = ",g_enterprise,
                       "                                          AND icab001 = a.pmds053))",
                       #排除已續拋之單號
                       "   AND a.pmds041 NOT IN (SELECT b.pmds041 FROM pmds_t b",
                       "                          WHERE b.pmdsent = ",g_enterprise,
                       "                            AND b.pmds000 = '",g_pmds_m.pmds000,"'",
                       "                            AND b.pmdssite = '",g_site,"'",
                       "                            AND b.pmdsdocno <> '",g_pmds_m.pmdsdocno,"'",
                       "                            AND b.pmdsstus <> 'X'",
                       "                            AND b.pmds041 IS NOT NULL)"
                       
   IF NOT cl_null(p_pmds041) THEN
      LET l_sql_from = l_sql_from," AND a.pmds041 = '",p_pmds041,"'"
   END IF
   
   #來源採購單
   LET l_sql_where =   "   AND ((a.pmds000 IN ('1','8','3','20')",   #1.採購收貨8.委外收貨3.採購收貨入庫,20.委外收貨入庫
                       "          AND a.pmds006 = (SELECT pmdldocno FROM pmdl_t",
                       "                            WHERE pmdlent = ",g_enterprise,
                       "                              AND pmdlsite = a.pmdssite",
                       "                              AND pmdlstus <> 'X'",
                       "                              AND pmdl030 = 'Y'",
                       "                              AND pmdl031 = (SELECT pmdl031 FROM pmdl_t",
                       "                                              WHERE pmdlent = ",g_enterprise,
                       "                                                AND pmdldocno = '",p_source,"'",
                       "                                            )",
                       "                          )",
                       "       )",
   #來源收貨單                    
                       "    OR (a.pmds000 IN ('6','12')",   #6入庫單,12委外入庫
                       "          AND a.pmds006 = (SELECT c.pmdsdocno FROM pmds_t c",
                       "                            WHERE c.pmdsent = ",g_enterprise,
                       "                              AND c.pmdssite = a.pmdssite",
                       "                              AND c.pmdsstus <> 'X'",
                       "                              AND c.pmds050 = 'Y'",
                       "                              AND c.pmds041 = (SELECT d.pmds041 FROM pmds_t d",
                       "                                                WHERE d.pmdsent = ",g_enterprise,
                       "                                                  AND d.pmdsdocno = '",p_source,"'",
                       "                                              )",
                       "                           )",
                       "       ))"


   LET r_cnt = 0
   LET r_pmds041 = p_pmds041

   IF NOT cl_null(p_source) THEN
   
      LET l_sql = l_sql_count,l_sql_from,l_sql_where

      PREPARE apmt520_aic_pre FROM l_sql
      EXECUTE apmt520_aic_pre INTO r_cnt
      
      IF cl_null(r_cnt) THEN
         LET r_cnt = 0
      END IF
      
      #若只有唯一一筆，SELECT
      IF r_cnt = 1 AND cl_null(p_pmds041) THEN
         
         LET l_sql = l_sql_sel,l_sql_from,l_sql_where
         
         PREPARE apmt520_aic_sel_pre FROM l_sql
         EXECUTE apmt520_aic_sel_pre INTO r_pmds041
         
      END IF
   END IF
   
   RETURN r_cnt,r_pmds041
END FUNCTION]]>
  </point>
  <point name="function.apmt520_default" order="55" ver="12" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 由多角流程代碼將續拋資料帶出
# Memo...........:
# Usage..........: CALL apmt520_default(p_pmdsdocno,p_pmds006,p_pmds053,p_pmds041)
#                  RETURNING r_success
# Input parameter: p_pmdsdocno   #單據單號
#                : p_pmds006     #來源單號
#                : p_pmds053     #多角代碼
#                : p_pmds041     #多角序號
# Return code....: 
#                : 
# Date & Author..: 150615 By earl
# Modify.........:
################################################################################
PRIVATE FUNCTION apmt520_default(p_pmdsdocno,p_pmds006,p_pmds053,p_pmds041)
   DEFINE p_pmdsdocno   LIKE pmds_t.pmdsdocno
   DEFINE p_pmds006     LIKE pmds_t.pmds006
   DEFINE p_pmds053     LIKE pmds_t.pmds053
   DEFINE p_pmds041     LIKE pmds_t.pmds041
   
   DEFINE r_success     LIKE type_t.num5
   
   DEFINE l_sql         STRING
   DEFINE l_pmdssite    LIKE pmds_t.pmdssite
   DEFINE l_pmds007     LIKE pmds_t.pmds007
   DEFINE l_pmds037     LIKE pmds_t.pmds037
   DEFINE l_pmdt001     LIKE pmdt_t.pmdt001
   DEFINE l_xrcd103     LIKE xrcd_t.xrcd103
   DEFINE l_xrcd104     LIKE xrcd_t.xrcd104
   DEFINE l_xrcd105     LIKE xrcd_t.xrcd105
   DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
   DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
   DEFINE l_xrcd115     LIKE xrcd_t.xrcd115
   
   DEFINE l_pmds        RECORD
             pmds021       LIKE pmds_t.pmds021,
             pmds050       LIKE pmds_t.pmds050
                        END RECORD
   
   DEFINE l_pmdt        RECORD
             pmdtdocno     LIKE pmdt_t.pmdtdocno,
             pmdtseq       LIKE pmdt_t.pmdtseq,
             pmdt001       LIKE pmdt_t.pmdt001,
             pmdt002       LIKE pmdt_t.pmdt002,
             pmdt003       LIKE pmdt_t.pmdt003,
             pmdt004       LIKE pmdt_t.pmdt004,
             pmdt005       LIKE pmdt_t.pmdt005,
             pmdt006       LIKE pmdt_t.pmdt006,
             pmdt007       LIKE pmdt_t.pmdt007,
             pmdt008       LIKE pmdt_t.pmdt008,
             pmdt009       LIKE pmdt_t.pmdt009,
             pmdt010       LIKE pmdt_t.pmdt010,
             pmdt011       LIKE pmdt_t.pmdt011,
             
             pmdt016       LIKE pmdt_t.pmdt016,
             pmdt017       LIKE pmdt_t.pmdt017,
             pmdt018       LIKE pmdt_t.pmdt018,
             pmdt019       LIKE pmdt_t.pmdt019,
             pmdt020       LIKE pmdt_t.pmdt020,
             pmdt021       LIKE pmdt_t.pmdt021,
             pmdt022       LIKE pmdt_t.pmdt022,
             pmdt023       LIKE pmdt_t.pmdt023,
             pmdt024       LIKE pmdt_t.pmdt024,
             pmdt025       LIKE pmdt_t.pmdt025,
             pmdt026       LIKE pmdt_t.pmdt026,
             pmdt027       LIKE pmdt_t.pmdt027,
             pmdt028       LIKE pmdt_t.pmdt028,
             
             pmdt036       LIKE pmdt_t.pmdt036,
             pmdt037       LIKE pmdt_t.pmdt037,
             pmdt038       LIKE pmdt_t.pmdt038,
             pmdt039       LIKE pmdt_t.pmdt039,
             pmdt040       LIKE pmdt_t.pmdt040,
             pmdt041       LIKE pmdt_t.pmdt041,
             pmdt042       LIKE pmdt_t.pmdt042,
             pmdt043       LIKE pmdt_t.pmdt043,
             pmdt044       LIKE pmdt_t.pmdt044,
             pmdt045       LIKE pmdt_t.pmdt045,
             pmdt046       LIKE pmdt_t.pmdt046,
             pmdt047       LIKE pmdt_t.pmdt047,
             
             pmdt051       LIKE pmdt_t.pmdt051,
             pmdt052       LIKE pmdt_t.pmdt052,
             pmdt053       LIKE pmdt_t.pmdt053,
             pmdt054       LIKE pmdt_t.pmdt054,
             pmdt055       LIKE pmdt_t.pmdt055,
             pmdt056       LIKE pmdt_t.pmdt056,
             pmdt057       LIKE pmdt_t.pmdt057,
             pmdt058       LIKE pmdt_t.pmdt058,
             pmdt059       LIKE pmdt_t.pmdt059,
             pmdt060       LIKE pmdt_t.pmdt060,
             pmdt061       LIKE pmdt_t.pmdt061,
             pmdt062       LIKE pmdt_t.pmdt062,
             pmdt063       LIKE pmdt_t.pmdt063,
             pmdt064       LIKE pmdt_t.pmdt064,
             pmdt065       LIKE pmdt_t.pmdt065,
             pmdt066       LIKE pmdt_t.pmdt066,
             pmdt067       LIKE pmdt_t.pmdt067,
             pmdt068       LIKE pmdt_t.pmdt068,
             pmdt069       LIKE pmdt_t.pmdt069,
             
             pmdt081       LIKE pmdt_t.pmdt081,
             pmdt082       LIKE pmdt_t.pmdt082,
             pmdt083       LIKE pmdt_t.pmdt083,
             pmdt084       LIKE pmdt_t.pmdt084,
             pmdt085       LIKE pmdt_t.pmdt085,
             pmdt086       LIKE pmdt_t.pmdt086,
             pmdt087       LIKE pmdt_t.pmdt087,
             pmdt088       LIKE pmdt_t.pmdt088,
             pmdt089       LIKE pmdt_t.pmdt089
                        END RECORD
   
   DEFINE l_pmdu        RECORD
             pmdudocno     LIKE pmdu_t.pmdudocno,
             pmduseq       LIKE pmdu_t.pmduseq,
             pmduseq1      LIKE pmdu_t.pmduseq1,
             pmdu001       LIKE pmdu_t.pmdu001,
             pmdu002       LIKE pmdu_t.pmdu002,
             pmdu003       LIKE pmdu_t.pmdu003,
             pmdu004       LIKE pmdu_t.pmdu004,
             pmdu005       LIKE pmdu_t.pmdu005,
             pmdu006       LIKE pmdu_t.pmdu006,
             pmdu007       LIKE pmdu_t.pmdu007,
             pmdu008       LIKE pmdu_t.pmdu008,
             pmdu009       LIKE pmdu_t.pmdu009,
             pmdu010       LIKE pmdu_t.pmdu010,
             pmdu011       LIKE pmdu_t.pmdu011,
             pmdu012       LIKE pmdu_t.pmdu012,
             pmdu013       LIKE pmdu_t.pmdu013,
             pmdu014       LIKE pmdu_t.pmdu014,
             pmdu015       LIKE pmdu_t.pmdu015,
             pmdu016       LIKE pmdu_t.pmdu016,
             pmdu017       LIKE pmdu_t.pmdu017
                        END RECORD
   
   LET r_success = TRUE
   
   IF cl_null(p_pmdsdocno) OR
      cl_null(p_pmds053) OR
      cl_null(p_pmds041) THEN
      
      RETURN r_success
   END IF
   
   INITIALIZE l_pmds.* TO NULL
   
   #塞pmds_t
   LET l_pmds.pmds021 = 'N'  #LC進口
   LET l_pmds.pmds050 = 'N'  #多角贸易已抛转
   
   UPDATE pmds_t
      SET pmds021 = l_pmds.pmds021,
          pmds050 = l_pmds.pmds050
    WHERE pmdsent = g_enterprise
      AND pmdsdocno = p_pmdsdocno

   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = "UPDATE:pmds_t"
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE
      CALL cl_err()
   
      LET r_success = FALSE
      RETURN r_success
   END IF
   
   #SELECT icaa_t,icab_t,icac_t,icad_t,icae_t
   CALL s_aic_carry_get_ica(p_pmds053,0)
   
   #先清空單身
   DELETE FROM pmdt_t
    WHERE pmdtent = g_enterprise
      AND pmdtdocno = p_pmdsdocno
   
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = "DELETE:pmdt_t"
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF
   
   DELETE FROM pmdu_t
    WHERE pmduent = g_enterprise
      AND pmdudocno = p_pmdsdocno

   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = "DELETE:pmdu_t"
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF

   DELETE FROM pmdv_t
    WHERE pmdvent = g_enterprise
      AND pmdvdocno = p_pmdsdocno
   
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = "DELETE:pmdv_t"
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF
   
   DELETE FROM pmdw_t
    WHERE pmdwent = g_enterprise
      AND pmdwdocno = p_pmdsdocno
   
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = "DELETE:pmdw_t"
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF

   #刪除交易稅明細檔
   DELETE FROM xrcd_t
    WHERE xrcdent = g_enterprise
      AND xrcddocno = p_pmdsdocno
   
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = "DELETE:xrcd_t"
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF

   #塞pmdt_t
   LET l_pmdt001 = ''
   INITIALIZE l_pmdt.* TO NULL
   
   #SELECT單頭資料
   LET l_pmdssite = ''
   LET l_pmds037 = ''
   LET l_pmds007 = ''
   
   SELECT pmdssite,
          pmds007,pmds037
     INTO l_pmdssite,
          l_pmds007,l_pmds037
     FROM pmds_t
    WHERE pmdsent = g_enterprise
      AND pmdsdocno = p_pmdsdocno
   
   LET l_pmdt.pmdtdocno = p_pmdsdocno
   
   IF g_icaa.icaa003 = '2' THEN #代採購
      LET l_sql = "SELECT xmdl003,",
                  "       xmdlseq,",
                  "       xmdl004,xmdl005,",
                  "       xmdl006,xmdl007,xmdl008,xmdl009,xmdl010,",
                  "       xmdl011,xmdl012,xmdl013,xmdl014,xmdl015,",
                  "       xmdl016,xmdl017,xmdl018,xmdl019,xmdl020,",
                  "       xmdl021,xmdl022,",
                  "       xmdl052,",
                  "       xmdl086,xmdl088",
                  "  FROM xmdk_t,xmdl_t",
                  " WHERE xmdkent = xmdlent AND xmdlent = ",g_enterprise,
                  "   AND xmdkdocno = xmdldocno",
                  "   AND xmdkstus = 'S'",
                  "   AND xmdk035 = '",p_pmds041,"'",
                  "   AND xmdksite = (SELECT icab003 FROM icab_t",
                  "                    WHERE icabent = ",g_enterprise,
                  "                      AND icab001 = '",p_pmds053,"'",
                  "                      AND icab002 = (SELECT MAX(icab002) FROM icab_t",
                  "                                      WHERE icabent = ",g_enterprise,
                  "                                        AND icab001 = '",p_pmds053,"'))"
   ELSE  #代採購指定供應商
      LET l_sql = "SELECT pmdt001,",
                  "       pmdtseq,",
                  "       pmdt002,pmdt003,",
                  "       pmdt004,pmdt005,pmdt006,pmdt007,pmdt008,",
                  "       pmdt009,pmdt010,pmdt062,pmdt016,pmdt017,",
                  "       pmdt018,pmdt019,pmdt020,pmdt021,pmdt022,",
                  "       pmdt023,pmdt024,",
                  "       pmdt063,",
                  "       pmdt086,pmdt085",
                  "  FROM pmds_t,pmdt_t",
                  " WHERE pmdsent = pmdtent AND pmdtent = ",g_enterprise,
                  "   AND pmdsdocno = pmdtdocno",
                  "   AND pmdsstus = 'S'",
                  "   AND pmds041 = '",p_pmds041,"'",
                  "   AND pmdssite = (SELECT icab003 FROM icab_t",
                  "                    WHERE icabent = ",g_enterprise,
                  "                      AND icab001 = '",p_pmds053,"'",
                  "                      AND icab002 = (SELECT MAX(icab002) FROM icab_t",
                  "                                      WHERE icabent = ",g_enterprise,
                  "                                        AND icab001 = '",p_pmds053,"'))"
   END IF
   PREPARE apmt520_pmds_pre FROM l_sql
   DECLARE apmt520_pmds_cs CURSOR FOR apmt520_pmds_pre

   IF g_icaa.icaa003 = '2' THEN #代採購
      LET l_sql = "SELECT b.pmdldocno,",
                  "       pmdn015,",
                  "       pmdn016,pmdn017,pmdn020,",
                  "       pmdn021,",
                  "       pmdn035,pmdn040,",
                  "       pmdn041,pmdn043,pmdn044",
                  "  FROM xmda_t,pmdl_t b,pmdn_t",
                  " WHERE xmdaent = b.pmdlent AND b.pmdlent = pmdnent AND pmdnent = ",g_enterprise,
                  "   AND b.pmdldocno = pmdndocno",
                  "   AND xmda031 = b.pmdl031",
                  "   AND b.pmdlsite = ?",
                  "   AND xmdadocno = ?",
                  "   AND pmdnseq = ?"
   ELSE  #代採購指定供應商
      LET l_sql = "SELECT b.pmdldocno,",
                  "       pmdn015,",
                  "       pmdn016,pmdn017,pmdn020,",
                  "       pmdn021,",
                  "       pmdn035,pmdn040,",
                  "       pmdn041,pmdn043,pmdn044",
                  "  FROM pmdl_t a,pmdl_t b,pmdn_t",
                  " WHERE a.pmdlent = b.pmdlent AND b.pmdlent = pmdnent AND pmdnent = ",g_enterprise,
                  "   AND b.pmdldocno = pmdndocno",
                  "   AND a.pmdl031 = b.pmdl031",
                  "   AND b.pmdlsite = ?",
                  "   AND a.pmdldocno = ?",
                  "   AND pmdnseq = ?"
   END IF
   PREPARE apmt520_pmdl_from_pre FROM l_sql
   
   #150622
   LET l_sql = "SELECT pmdsdocno,pmdtseq",
               "  FROM pmds_t,pmdt_t",
               " WHERE pmdsent = pmdtent AND pmdtent = ",g_enterprise,
               "   AND pmdsdocno = pmdtdocno",
               "   AND pmds000 IN ('1','8')",     #1.採購收貨,8.委外收貨
               "   AND pmdssite = ?",
               "   AND pmds041 = ?",
               "   AND pmdt001 = ?",
               "   AND pmdt002 = ?",
               "   AND pmdt003 = ?",
               "   AND pmdt004 = ?"
   PREPARE apmt520_pmds_from_pre FROM l_sql
   
   IF g_icaa.icaa003 = '2' THEN #代採購
      LET l_sql = "SELECT xmdmseq1,",
                  "       xmdm001,xmdm002,xmdm003,xmdm004,xmdm005,",
                  "       xmdm006,xmdm007,xmdm008,xmdm009,xmdm010,",
                  "       xmdm011,xmdm033",
                  "  FROM xmdk_t,xmdm_t",
                  " WHERE xmdkent = xmdment AND xmdment = ",g_enterprise,
                  "   AND xmdkdocno = xmdmdocno",
                  "   AND xmdkstus = 'S'",
                  "   AND xmdk035 = '",p_pmds041,"'",
                  "   AND xmdmseq = ?",
                  "   AND xmdksite = (SELECT icab003 FROM icab_t",
                  "                    WHERE icabent = ",g_enterprise,
                  "                      AND icab001 = '",p_pmds053,"'",
                  "                      AND icab002 = (SELECT MAX(icab002) FROM icab_t",
                  "                                      WHERE icabent = ",g_enterprise,
                  "                                        AND icab001 = '",p_pmds053,"'))",
                  " ORDER BY xmdmseq1"
   ELSE  #代採購指定供應商
      LET l_sql = "SELECT pmduseq1,",
                  "       pmdu001,pmdu002,pmdu003,pmdu004,pmdu006,",
                  "       pmdu007,pmdu008,pmdu009,pmdu010,pmdu011,",
                  "       pmdu012,pmdu005",
                  "  FROM pmds_t,pmdu_t",
                  " WHERE pmdsent = pmduent AND pmduent = ",g_enterprise,
                  "   AND pmdsdocno = pmdudocno",
                  "   AND pmdsstus = 'S'",
                  "   AND pmds041 = '",p_pmds041,"'",
                  "   AND pmduseq = ?",
                  "   AND pmdssite = (SELECT icab003 FROM icab_t",
                  "                    WHERE icabent = ",g_enterprise,
                  "                      AND icab001 = '",p_pmds053,"'",
                  "                      AND icab002 = (SELECT MAX(icab002) FROM icab_t",
                  "                                      WHERE icabent = ",g_enterprise,
                  "                                        AND icab001 = '",p_pmds053,"'))",
                  " ORDER BY pmduseq1"
   END IF
   PREPARE apmt520_pmdu_pre FROM l_sql
   DECLARE apmt520_pmdu_cs CURSOR FOR apmt520_pmdu_pre

   FOREACH apmt520_pmds_cs INTO l_pmdt001,
                                l_pmdt.pmdtseq,
                                l_pmdt.pmdt002,l_pmdt.pmdt003,
                                l_pmdt.pmdt004,l_pmdt.pmdt005,l_pmdt.pmdt006,l_pmdt.pmdt007,l_pmdt.pmdt008,
                                l_pmdt.pmdt009,l_pmdt.pmdt010,l_pmdt.pmdt062,l_pmdt.pmdt016,l_pmdt.pmdt017,
                                l_pmdt.pmdt018,l_pmdt.pmdt019,l_pmdt.pmdt020,l_pmdt.pmdt021,l_pmdt.pmdt022,
                                l_pmdt.pmdt023,l_pmdt.pmdt024,
                                l_pmdt.pmdt063,
                                l_pmdt.pmdt086,l_pmdt.pmdt085
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.extend = "FOREACH:apmt520_pmds_cs"
         LET g_errparam.code   = SQLCA.sqlcode
         LET g_errparam.popup  = TRUE
         CALL cl_err()

         LET r_success = FALSE
         EXIT FOREACH
      END IF
   
      LET l_pmdt.pmdt011 = 1  #冲销顺序
      
      LET l_pmdt.pmdt053 = 0
      LET l_pmdt.pmdt054 = 0
      LET l_pmdt.pmdt055 = 0
      LET l_pmdt.pmdt056 = 0
      LET l_pmdt.pmdt057 = 0
      LET l_pmdt.pmdt058 = 0
      
      LET l_pmdt.pmdt066 = 0
      LET l_pmdt.pmdt067 = 0
      LET l_pmdt.pmdt068 = 0
      LET l_pmdt.pmdt069 = 0
      
      LET l_pmdt.pmdt084 = 'N'
      
      LET l_pmdt.pmdt063 = ' '              #庫存管理特徵
      
      #庫位、儲位
      IF NOT cl_null(l_pmdt.pmdt016) THEN
         IF cl_null(g_icad.icad004) THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend = ""
            LET g_errparam.code   = 'aic-00169'   #流程代碼%1站別%2之庫位為空！
            LET g_errparam.popup  = TRUE
            LET g_errparam.replace[1] = p_pmds053
            LET g_errparam.replace[2] = 0
            
            CALL cl_err()
         
            LET r_success = FALSE
            EXIT FOREACH            
         ELSE
            LET l_pmdt.pmdt016 = g_icad.icad004     #庫位
            
            IF cl_null(g_icad.icad005) THEN
               LET l_pmdt.pmdt017 = ' '             #儲位
            ELSE
               LET l_pmdt.pmdt017 = g_icad.icad005  #儲位
            END IF
         END IF
      ELSE
         LET l_pmdt.pmdt016 = ' '             #庫位
         LET l_pmdt.pmdt017 = ' '             #儲位
      END IF
      
      #來源採購單
      IF NOT cl_null(l_pmdt001) THEN
         EXECUTE apmt520_pmdl_from_pre USING l_pmdssite,l_pmdt001,l_pmdt.pmdt002
         INTO l_pmdt.pmdt001,
              l_pmdt.pmdt036,
              l_pmdt.pmdt046,l_pmdt.pmdt037,l_pmdt.pmdt025,
              l_pmdt.pmdt041,
              l_pmdt.pmdt040,l_pmdt.pmdt042,
              l_pmdt.pmdt043,l_pmdt.pmdt044,l_pmdt.pmdt045

         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend = "EXECUTE:apmt520_pmdl_from_pre"
            LET g_errparam.code   = SQLCA.sqlcode
            LET g_errparam.popup  = TRUE
            CALL cl_err()
       
            LET r_success = FALSE
            EXIT FOREACH
         END IF

      END IF
      
      #150622
      EXECUTE apmt520_pmds_from_pre USING l_pmdssite,p_pmds041,
                                          l_pmdt.pmdt001,l_pmdt.pmdt002,
                                          l_pmdt.pmdt003,l_pmdt.pmdt004
                                     INTO l_pmdt.pmdt027,l_pmdt.pmdt028
      
      IF SQLCA.sqlcode AND SQLCA.sqlcode <> 100 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.extend = "EXECUTE:apmt520_pmds_from_pre"
         LET g_errparam.code   = SQLCA.sqlcode
         LET g_errparam.popup  = TRUE
         CALL cl_err()
      
         LET r_success = FALSE
         EXIT FOREACH
      END IF
    
      #檢驗否
      IF g_icab.icab005 = 'Y' THEN
         IF (NOT cl_null(l_pmdt.pmdt009)) AND (NOT cl_null(l_pmdt.pmdt010)) THEN
            SELECT qcap006 INTO l_pmdt.pmdt026
              FROM qcap_t
             WHERE qcapent = g_enterprise AND qcapsite = l_pmdssite
               AND qcap001 = l_pmdt.pmdt006 AND qcap002 = l_pmds007
               AND qcap003 = l_pmdt.pmdt009 AND qcap004 = l_pmdt.pmdt010
               AND qcap005 = l_pmdt.pmdt007
         ELSE
            SELECT qcap006 INTO l_pmdt.pmdt026
              FROM qcap_t
             WHERE qcapent = g_enterprise AND qcapsite = l_pmdssite
               AND qcap001 = l_pmdt.pmdt006 AND qcap002 = l_pmds007
               AND qcap005 = l_pmdt.pmdt007
         END IF
            
         IF cl_null(l_pmdt.pmdt026) THEN
            LET l_pmdt.pmdt026 = 'N'
         END IF
      ELSE
         LET l_pmdt.pmdt026 = 'N'
      END IF

      #取得未稅金額、稅額、含稅金額
      CALL s_apmt520_get_amount(l_pmdt.pmdtdocno,l_pmdt.pmdtseq,l_pmdt.pmdt001,l_pmdt.pmdt024,l_pmdt.pmdt036,l_pmdt.pmdt046)
      RETURNING l_pmdt.pmdt038,l_pmdt.pmdt047,l_pmdt.pmdt039
   
      INSERT INTO pmdt_t (pmdtent,pmdtsite,pmdtdocno,pmdtseq,
                          pmdt001,pmdt002,pmdt003,pmdt004,pmdt005,
                          pmdt006,pmdt007,pmdt008,pmdt009,pmdt010,
                          pmdt011,
                          pmdt016,pmdt017,pmdt018,pmdt019,pmdt020,
                          pmdt021,pmdt022,pmdt023,pmdt024,pmdt025,
                          pmdt026,pmdt027,pmdt028,
                          pmdt036,pmdt037,pmdt038,pmdt039,pmdt040,
                          pmdt041,pmdt042,pmdt043,pmdt044,pmdt045,
                          pmdt046,pmdt047,
                          pmdt051,pmdt052,pmdt053,pmdt054,pmdt055,
                          pmdt056,pmdt057,pmdt058,pmdt059,pmdt060,
                          pmdt061,pmdt062,pmdt063,pmdt064,pmdt065,
                          pmdt066,pmdt067,pmdt068,pmdt069,
                          pmdt081,pmdt082,pmdt083,pmdt084,pmdt085,
                          pmdt086,pmdt087,pmdt088,pmdt089)
      VALUES (g_enterprise,l_pmdssite,l_pmdt.pmdtdocno,l_pmdt.pmdtseq,
              l_pmdt.pmdt001,l_pmdt.pmdt002,l_pmdt.pmdt003,l_pmdt.pmdt004,l_pmdt.pmdt005,
              l_pmdt.pmdt006,l_pmdt.pmdt007,l_pmdt.pmdt008,l_pmdt.pmdt009,l_pmdt.pmdt010,
              l_pmdt.pmdt011,
              l_pmdt.pmdt016,l_pmdt.pmdt017,l_pmdt.pmdt018,l_pmdt.pmdt019,l_pmdt.pmdt020,
              l_pmdt.pmdt021,l_pmdt.pmdt022,l_pmdt.pmdt023,l_pmdt.pmdt024,l_pmdt.pmdt025,
              l_pmdt.pmdt026,l_pmdt.pmdt027,l_pmdt.pmdt028,
              l_pmdt.pmdt036,l_pmdt.pmdt037,l_pmdt.pmdt038,l_pmdt.pmdt039,l_pmdt.pmdt040,
              l_pmdt.pmdt041,l_pmdt.pmdt042,l_pmdt.pmdt043,l_pmdt.pmdt044,l_pmdt.pmdt045,
              l_pmdt.pmdt046,l_pmdt.pmdt047,
              l_pmdt.pmdt051,l_pmdt.pmdt052,l_pmdt.pmdt053,l_pmdt.pmdt054,l_pmdt.pmdt055,
              l_pmdt.pmdt056,l_pmdt.pmdt057,l_pmdt.pmdt058,l_pmdt.pmdt059,l_pmdt.pmdt060,
              l_pmdt.pmdt061,l_pmdt.pmdt062,l_pmdt.pmdt063,l_pmdt.pmdt064,l_pmdt.pmdt065,
              l_pmdt.pmdt066,l_pmdt.pmdt067,l_pmdt.pmdt068,l_pmdt.pmdt069,
              l_pmdt.pmdt081,l_pmdt.pmdt082,l_pmdt.pmdt083,l_pmdt.pmdt084,l_pmdt.pmdt085,
              l_pmdt.pmdt086,l_pmdt.pmdt087,l_pmdt.pmdt088,l_pmdt.pmdt089)

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.extend = "INSERT:pmdt_t"
         LET g_errparam.code   = SQLCA.sqlcode
         LET g_errparam.popup  = TRUE
         CALL cl_err()
            
         LET r_success = FALSE
         EXIT FOREACH
      END IF
   
      #整批產生收貨原始需求分配明細資料
      CALL s_apmt520_gen_pmdv(l_pmdt.pmdtdocno,l_pmdt.pmdtseq) RETURNING r_success
      IF NOT r_success THEN
         EXIT FOREACH
      END IF
      
      INITIALIZE l_pmdu.* TO NULL
      OPEN apmt520_pmdu_cs USING l_pmdt.pmdtseq
      FOREACH apmt520_pmdu_cs INTO l_pmdu.pmduseq1,
                                   l_pmdu.pmdu001,l_pmdu.pmdu002,l_pmdu.pmdu003,l_pmdu.pmdu004,l_pmdu.pmdu006,
                                   l_pmdu.pmdu007,l_pmdu.pmdu008,l_pmdu.pmdu009,l_pmdu.pmdu010,l_pmdu.pmdu011,
                                   l_pmdu.pmdu012,l_pmdu.pmdu005
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend = "FOREACH:apmt520_pmdu_cs"
            LET g_errparam.code   = SQLCA.sqlcode
            LET g_errparam.popup  = TRUE
            CALL cl_err()
         
            LET r_success = FALSE
            EXIT FOREACH
         END IF
   
         #塞pmdu_t
         LET l_pmdu.pmdudocno = l_pmdt.pmdtdocno
         LET l_pmdu.pmduseq = l_pmdt.pmdtseq
         LET l_pmdu.pmdu013 = 0                 #允收數量
         LET l_pmdu.pmdu014 = 0                 #已入庫量
         LET l_pmdu.pmdu015 = 0                 #已驗退量
         
         LET l_pmdu.pmdu005 = ' '    #庫存管理特徵
         
         #庫位、儲位
         IF NOT cl_null(l_pmdu.pmdu006) THEN
            IF cl_null(g_icad.icad004) THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.extend = ""
               LET g_errparam.code   = 'aic-00169'   #流程代碼%1站別%2之庫位為空！
               LET g_errparam.popup  = TRUE
               LET g_errparam.replace[1] = p_pmds053
               LET g_errparam.replace[2] = 0
               
               CALL cl_err()
            
               LET r_success = FALSE
               EXIT FOREACH            
            ELSE
               LET l_pmdu.pmdu006 = g_icad.icad004     #庫位
               
               IF cl_null(g_icad.icad005) THEN
                  LET l_pmdu.pmdu007 = ' '             #儲位
               ELSE
                  LET l_pmdu.pmdu007 = g_icad.icad005  #儲位
               END IF
            END IF
         ELSE
            LET l_pmdu.pmdu006 = ' '             #庫位
            LET l_pmdu.pmdu007 = ' '             #儲位
         END IF
       
         INSERT INTO pmdu_t (pmduent,pmdusite,pmdudocno,pmduseq,pmduseq1,
                             pmdu001,pmdu002,pmdu003,pmdu004,pmdu005,
                             pmdu006,pmdu007,pmdu008,pmdu009,pmdu010,
                             pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,
                             pmdu016,pmdu017)
         VALUES (g_enterprise,l_pmdssite,l_pmdu.pmdudocno,l_pmdu.pmduseq,l_pmdu.pmduseq1,
                 l_pmdu.pmdu001,l_pmdu.pmdu002,l_pmdu.pmdu003,l_pmdu.pmdu004,l_pmdu.pmdu005,
                 l_pmdu.pmdu006,l_pmdu.pmdu007,l_pmdu.pmdu008,l_pmdu.pmdu009,l_pmdu.pmdu010,
                 l_pmdu.pmdu011,l_pmdu.pmdu012,l_pmdu.pmdu013,l_pmdu.pmdu014,l_pmdu.pmdu015,
                 l_pmdu.pmdu016,l_pmdu.pmdu017)
       
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend = "INSERT:pmdu_t"
            LET g_errparam.code   = SQLCA.sqlcode
            LET g_errparam.popup  = TRUE
            CALL cl_err()         
         
            LET r_success = FALSE
            EXIT FOREACH
         END IF
      END FOREACH
      
      IF NOT r_success THEN
         EXIT FOREACH
      END IF
      
   END FOREACH

   IF NOT r_success THEN
      RETURN r_success
   ELSE
   
      #重新計算整單的未稅、含稅總金額
      CALL s_tax_recount(p_pmdsdocno)
      RETURNING l_xrcd103,l_xrcd104,l_xrcd105,
                l_xrcd113,l_xrcd114,l_xrcd115
      
      UPDATE pmds_t
         SET pmds043 = l_xrcd103,
             pmds044 = l_xrcd105,
             pmds046 = l_xrcd104
       WHERE pmdsent = g_enterprise 
         AND pmdsdocno = p_pmdsdocno
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.extend = "UPDATE:pmds_t"
         LET g_errparam.code   = SQLCA.sqlcode
         LET g_errparam.popup  = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.apmt520_pmds014_pmds053_chk" order="56" ver="11" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#多角流程代碼檢查
PRIVATE FUNCTION apmt520_pmds014_pmds053_chk(p_pmds014,p_pmds053)
   DEFINE p_pmds014    LIKE pmds_t.pmds014
   DEFINE p_pmds053    LIKE pmds_t.pmds053
   DEFINE r_success    LIKE type_t.num5
   
   LET r_success = TRUE
   
   IF NOT cl_null(p_pmds014) AND NOT cl_null(p_pmds053) THEN
      #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
      INITIALIZE g_chkparam.* TO NULL
       
      #設定g_chkparam.*的參數
      LET g_chkparam.arg1 = p_pmds053
      LET g_chkparam.arg2 = g_site
      LET g_chkparam.arg3 = p_pmds014
      
      IF NOT cl_chk_exist("v_icaa001_4") THEN
         LET r_success = FALSE
      END IF
   END IF
   
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="b_fill.body.fill_sql" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         IF NOT cl_null(g_wc2_table2) AND g_wc2_table2 <> " 1=1" THEN
            LET g_wc2_table1 = g_wc2_table1 CLIPPED,
                               " AND (pmdtdocno,pmdtseq) IN (SELECT pmdudocno,pmduseq FROM pmdu_t ",
                                                            " WHERE pmduent = pmdtent ",
                                                            "   AND pmdudocno = pmdtdocno ",
                                                            "   AND pmduseq = pmdtseq ",
                                                            "   AND ",g_wc2_table2 CLIPPED,")"
         END IF
         IF NOT cl_null(g_wc2_table3) AND g_wc2_table3 <> " 1=1" THEN
            LET g_wc2_table1 = g_wc2_table1 CLIPPED,
                               " AND (pmdtdocno,pmdtseq) IN (SELECT pmdvdocno,pmdvseq FROM pmdv_t ",
                                                            " WHERE pmdvent = pmdtent ",
                                                            "   AND pmdvdocno = pmdtdocno ",
                                                            "   AND pmdvseq = pmdtseq ",
                                                            "   AND ",g_wc2_table3 CLIPPED,")"
         END IF                 ]]>
  </point>
  <point name="b_fill.body2.fill_sql" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         IF NOT cl_null(g_wc2_table1) AND g_wc2_table1 <> " 1=1" THEN
            LET g_wc2_table2 = g_wc2_table2 CLIPPED,
                               " AND (pmdudocno,pmduseq) IN (SELECT pmdtdocno,pmduseq FROM pmdt_t ",
                                                            " WHERE pmduent = pmdtent ",
                                                            "   AND pmdudocno = pmdtdocno ",
                                                            "   AND pmduseq = pmdtseq ",
                                                            "   AND ",g_wc2_table1 CLIPPED,")"
         END IF
         IF NOT cl_null(g_wc2_table3) AND g_wc2_table3 <> " 1=1" THEN
            LET g_wc2_table2 = g_wc2_table2 CLIPPED,
                               " AND (pmdudocno,pmduseq) IN (SELECT pmdvdocno,pmdvseq FROM pmdv_t ",
                                                            " WHERE pmdvent = pmduent ",
                                                            "   AND pmdvdocno = pmdudocno ",
                                                            "   AND pmdvseq = pmduseq ",
                                                            "   AND ",g_wc2_table3 CLIPPED,")"
         END IF                    ]]>
  </point>
  <point name="b_fill.body3.fill_sql" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         IF NOT cl_null(g_wc2_table1) AND g_wc2_table1 <> " 1=1" THEN
            LET g_wc2_table3 = g_wc2_table3 CLIPPED,
                               " AND (pmdvdocno,pmdvseq) IN (SELECT pmdtdocno,pmdtseq FROM pmdt_t ",
                                                            " WHERE pmdvent = pmdtent ",
                                                            "   AND pmdvdocno = pmdtdocno ",
                                                            "   AND pmdvseq = pmdtseq ",
                                                            "   AND ",g_wc2_table1 CLIPPED,")"
         END IF
         IF NOT cl_null(g_wc2_table2) AND g_wc2_table2 <> " 1=1" THEN
            LET g_wc2_table3 = g_wc2_table3 CLIPPED,
                               " AND (pmdvdocno,pmdvseq) IN (SELECT pmdudocno,pmduseq FROM pmdu_t ",
                                                            " WHERE pmdvent = pmduent ",
                                                            "   AND pmdvdocno = pmdudocno ",
                                                            "   AND pmdvseq = pmduseq ",
                                                            "   AND ",g_wc2_table3 CLIPPED,")"
         END IF                     ]]>
  </point>
  <point name="b_fill.define" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_success LIKE type_t.num5         ]]>
  </point>
  <point name="b_fill.fill" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[          SELECT pmdo001,pmdo002 INTO g_pmdt_d[l_ac].pmdo001,g_pmdt_d[l_ac].pmdo002
           FROM pmdo_t 
           WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001
             AND pmdoseq = g_pmdt_d[l_ac].pmdt002
             AND pmdoseq1 = g_pmdt_d[l_ac].pmdt003
             AND pmdoseq2 = g_pmdt_d[l_ac].pmdt004
          
          CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdo001) RETURNING g_pmdt_d[l_ac].imaal003,g_pmdt_d[l_ac].imaal004
          DISPLAY BY NAME g_pmdt_d[l_ac].imaal003,g_pmdt_d[l_ac].imaal004
          
          CALL s_feature_description(g_pmdt_d[l_ac].pmdo001,g_pmdt_d[l_ac].pmdo002) RETURNING l_success,g_pmdt_d[l_ac].pmdo002_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdo002_desc
          
          CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdt006) RETURNING g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          
          CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
          
         # CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
         # DISPLAY BY NAME g_pmdt_d[l_ac].pmdt019_desc
         # 
         # CALL apmt520_pmdt008_ref(g_pmdt_d[l_ac].pmdt008) RETURNING g_pmdt_d[l_ac].pmdt008_desc
         # DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008_desc
         # 
         # CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
         # DISPLAY BY NAME g_pmdt_d[l_ac].pmdt021_desc
         # 
         # CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
         # DISPLAY BY NAME g_pmdt_d[l_ac].pmdt023_desc
          
          CALL apmt520_pmds033_ref(g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046_desc
          
          CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
          
          CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
          
          CALL apmt520_pmdt083_ref(g_pmdt_d[l_ac].pmdt083) RETURNING g_pmdt_d[l_ac].pmdt083_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt083_desc
          
          CALL s_desc_get_project_desc(g_pmdt_d[l_ac].pmdt072) RETURNING g_pmdt_d[l_ac].pmdt072_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt072_desc
          
          CALL s_desc_get_wbs_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073) RETURNING g_pmdt_d[l_ac].pmdt073_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt073_desc
          
          CALL s_desc_get_activity_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt074) RETURNING g_pmdt_d[l_ac].pmdt074_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt074_desc
          ]]>
  </point>
  <point name="b_fill.sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="b_fill.sql2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="b_fill.sql3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="b_fill.sql_before" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[ ]]>
  </point>
  <point name="b_fill2.after_fill" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="b_fill2.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="b_fill2.fill" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         CALL s_desc_get_stock_desc(g_site,g_pmdt2_d[l_ac].pmdu006) RETURNING g_pmdt2_d[l_ac].pmdu006_desc
         DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu006_desc
         
         CALL s_desc_get_locator_desc(g_site,g_pmdt2_d[l_ac].pmdu006,g_pmdt2_d[l_ac].pmdu007) RETURNING g_pmdt2_d[l_ac].pmdu007_desc
         DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu007_desc                           ]]>
  </point>
  <point name="b_fill3.fill" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="browser_fill.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="browser_fill.before_count" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="browser_fill.before_foreach" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF cl_null(g_wc) THEN
      LET g_wc = " pmdssite = '",g_site,"' "
   ELSE
      LET g_wc = g_wc," AND pmdssite = '",g_site,"' "
   END IF
   
   IF NOT cl_null(g_argv[1]) THEN
      LET g_wc = g_wc," AND pmds000 = '", g_argv[1], "' "
   END IF
   
   LET l_wc  = g_wc.trim()           ]]>
  </point>
  <point name="browser_fill.before_prepare" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="browser_fill.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="browser_fill.join.pmdu_t1" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               "          AND pmdtseq = pmduseq ",]]>
  </point>
  <point name="browser_fill.join.pmdv_t1" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               "          AND pmdtseq = pmdvseq ",]]>
  </point>
  <point name="browser_fill.open" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="browser_fill.other_fill" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL apmt520_b4_fill()      ]]>
  </point>
  <point name="browser_fill.reference" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="browser_search.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.pmdt001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt053" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt054" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdt061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdtseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page1.pmdtsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdu016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page2.pmdusite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdv019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdvseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdvseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.page3.pmdvsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds000" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmds045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdscnfid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdscrtdp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdscrtid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdsdocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdsdocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdsmodid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdsowndp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdsownid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdspstid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdssite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.a.pmdsstus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt053" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt054" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdt061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdtseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page1.pmdtsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdu016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page2.pmdusite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdv019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdvseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdvseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.page3.pmdvsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds000" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmds045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdscnfdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdscnfid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdscrtdp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdscrtdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdscrtid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdsdocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdsdocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdsmoddt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdsmodid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdsowndp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdsownid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdspstdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdspstid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdssite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.b.pmdsstus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt001" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			
            #採購收貨時開窗開採購單號
			   IF g_argv[1] MATCHES '[13567]' THEN
               LET g_qryparam.where = " pmdl005 NOT IN ('2','5','6') "
               CALL q_pmdldocno_7()                           #呼叫開窗
            END IF
            IF g_argv[1] = '8' OR g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14' OR g_argv[1] = '20' THEN   #委外採購
               LET g_qryparam.where = " pmdl005 ='2' " 
               CALL q_pmdldocno_7() 
            END IF
            IF g_argv[1] = '9' OR g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' THEN   #重覆性生產採購
               LET g_qryparam.where = " pmdl005 ='5' "
               CALL q_pmdldocno_7() 
            END IF
           
            #借貨收貨單
            IF g_argv[1] = '23' OR g_argv[1] = '24' THEN
               LET g_qryparam.where = " pmdl005 ='6' " 
               CALL q_pmdldocno_7() 
            END IF
            
            DISPLAY g_qryparam.return1 TO pmdt001  #顯示到畫面上

            NEXT FIELD pmdt001                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaf001_15()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt006  #顯示到畫面上

            NEXT FIELD pmdt006                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaf001_5()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt008  #顯示到畫面上

            NEXT FIELD pmdt008                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt009" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "221" #

            CALL q_oocq002()                               #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt009  #顯示到畫面上

            NEXT FIELD pmdt009                     #返回原欄位

                                               ]]>
  </point>
  <point name="construct.c.page1.pmdt010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt016" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_inaa001_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt016  #顯示到畫面上

            NEXT FIELD pmdt016                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt017" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_inab002_3()                            #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt017  #顯示到畫面上
            NEXT FIELD pmdt017                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt019  #顯示到畫面上

            NEXT FIELD pmdt019                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt021  #顯示到畫面上

            NEXT FIELD pmdt021                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt023  #顯示到畫面上

            NEXT FIELD pmdt023                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt027" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			
            #驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] MATCHES '[56]' THEN
               LET g_qryparam.arg1 = "('1','2')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            #倉退時開窗開收貨單號
            IF g_argv[1] MATCHES '[7]' THEN
               LET g_qryparam.arg1 = "('1','2','3','4')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            
            #委外驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14'THEN   #委外驗退
               LET g_qryparam.arg1 = "('8')"
               CALL q_pmdsdocno() 
            END IF
            #重覆性生產驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' THEN   #重覆性驗退
               LET g_qryparam.arg1 = "('9')"
               CALL q_pmdsdocno() 
            END IF
            
            DISPLAY g_qryparam.return1 TO pmdt027  #顯示到畫面上

            NEXT FIELD pmdt027                     #返回原欄位
]]>
  </point>
  <point name="construct.c.page1.pmdt036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_oodb002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt046  #顯示到畫面上

            NEXT FIELD pmdt046                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt051" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg1 = g_acc
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt051  #顯示到畫面上

            NEXT FIELD pmdt051                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.pmdt053" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt054" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdt071" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_pmdt070()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt071  #顯示到畫面上
            NEXT FIELD pmdt071                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.pmdt072" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_pjba001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt072  #顯示到畫面上
            NEXT FIELD pmdt072                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.pmdt073" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_pjbb002_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt073  #顯示到畫面上
            NEXT FIELD pmdt073                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.pmdt074" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_pjbm002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt074  #顯示到畫面上
            NEXT FIELD pmdt074                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.pmdt081" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			
            CALL q_qcbadocno()                          
            
            DISPLAY g_qryparam.return1 TO pmdt081  #顯示到畫面上

            NEXT FIELD pmdt081                     #返回原欄位
]]>
  </point>
  <point name="construct.c.page1.pmdt083" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_ooef025
            CALL q_qcao002_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdt083  #顯示到畫面上
            NEXT FIELD pmdt083                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.pmdtseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page1.pmdtsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdu001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_imaf001_15()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdu001  #顯示到畫面上

            NEXT FIELD pmdu001                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page2.pmdu002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdu003" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "221" #

            CALL q_oocq002()                               #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdu003  #顯示到畫面上

            NEXT FIELD pmdu003                     #返回原欄位

                                                               ]]>
  </point>
  <point name="construct.c.page2.pmdu004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdu005" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="construct.c.page2.pmdu006" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_inaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdu006  #顯示到畫面上

            NEXT FIELD pmdu006                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page2.pmdu007" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_inab002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdu007  #顯示到畫面上

            NEXT FIELD pmdu007                     #返回原欄位

                                    ]]>
  </point>
  <point name="construct.c.page2.pmdu008" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page2.pmdu009" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdu009  #顯示到畫面上

            NEXT FIELD pmdu009                     #返回原欄位

                                    ]]>
  </point>
  <point name="construct.c.page2.pmdu010" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="construct.c.page2.pmdu011" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdu011  #顯示到畫面上

            NEXT FIELD pmdu011                     #返回原欄位
                                            ]]>
  </point>
  <point name="construct.c.page2.pmdu012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdu013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdu014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdu015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdu016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page2.pmdusite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_imaf001_15()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdv001  #顯示到畫面上
            NEXT FIELD pmdv001                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page3.pmdv002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv003" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "221" #

            CALL q_oocq002()                               #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdv003  #顯示到畫面上

            NEXT FIELD pmdv003                     #返回原欄位
                                       ]]>
  </point>
  <point name="construct.c.page3.pmdv004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdv018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdv018  #顯示到畫面上
            NEXT FIELD pmdv018                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page3.pmdv019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdvseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdvseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.page3.pmdvsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds000" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds002  #顯示到畫面上

            NEXT FIELD pmds002                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds003  #顯示到畫面上

            NEXT FIELD pmds003                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds006" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   #採購收貨時開窗開採購單號
			   IF g_argv[1] MATCHES '[13]' THEN
			      LET g_qryparam.where = " pmdl005 NOT IN ('2','5','6') " #一般採購單
               CALL q_pmdldocno_7()                           #呼叫開窗
            END IF
            IF g_argv[1] = '8' OR g_argv[1] = '20' THEN   #委外採購
               LET g_qryparam.where = " pmdl005 ='2' " 
               CALL q_pmdldocno_7() 
            END IF
            IF g_argv[1] = '9' THEN   #重覆性生產採購
               LET g_qryparam.where = " pmdl005 ='5' "
               CALL q_pmdldocno_7() 
            END IF
            #驗退、入庫時開窗開收貨單號
            IF g_argv[1] MATCHES '[56]' THEN
               LET g_qryparam.arg1 = "('1','2')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            #倉退時開窗開收貨單號
            IF g_argv[1] MATCHES '[7]' THEN
               LET g_qryparam.arg1 = "('1','2','3','4')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            
            #委外驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14'THEN   #委外驗退
               LET g_qryparam.arg1 = "('8')"
               CALL q_pmdsdocno() 
            END IF

            #重覆性生產驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' THEN   #重覆性驗退
               LET g_qryparam.arg1 = "('9')"
               CALL q_pmdsdocno() 
            END IF
            
            #借貨收貨單
            IF g_argv[1] = '23' OR g_argv[1] = '24' THEN
               LET g_qryparam.where = " pmdl005 ='6' " 
               CALL q_pmdldocno_7() 
            END IF
            
            #借貨入庫時開窗開借貨收貨單號
            IF g_argv[1] = '25' THEN
               LET g_qryparam.arg1 = "('23')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            #借貨倉退時開窗開借貨收貨單號
            IF g_argv[1] = '26' THEN
               LET g_qryparam.arg1 = "('23','24')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            
            DISPLAY g_qryparam.return1 TO pmds006  #顯示到畫面上

            NEXT FIELD pmds006                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pmaa001_3()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds007  #顯示到畫面上

            NEXT FIELD pmds007                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.where = " pmac003 = '1' "  #付款
            CALL q_pmac002_2()                            #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds008  #顯示到畫面上

            NEXT FIELD pmds008                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.where = " pmac003 = '2' "  #
            CALL q_pmac002_2()                            #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds009  #顯示到畫面上

            NEXT FIELD pmds009                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds012" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "275"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds012  #顯示到畫面上
            NEXT FIELD pmds012                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.pmds013" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "275"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds013  #顯示到畫面上
            NEXT FIELD pmds013                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.pmds021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pmad002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds031  #顯示到畫面上

            NEXT FIELD pmds031                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = "238"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds032  #顯示到畫面上

            NEXT FIELD pmds032                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_oodb002_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds033  #顯示到畫面上

            NEXT FIELD pmds033                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.arg1 = g_site
            CALL q_ooaj002_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds037  #顯示到畫面上

            NEXT FIELD pmds037                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pmam001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds039  #顯示到畫面上

            NEXT FIELD pmds039                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooid001_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds040  #顯示到畫面上

            NEXT FIELD pmds040                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmds041" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_argv[1]
            LET g_qryparam.where = " pmdssite = '",g_site,"' AND pmds000 = '",g_argv[01],"'"
            
            CALL q_pmds041_2()
            
            DISPLAY g_qryparam.return1 TO pmds041  #顯示到畫面上

            NEXT FIELD pmds041                     #返回原欄位
            ]]>
  </point>
  <point name="construct.c.pmds042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmds053" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_icaa001_7()                     #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds053  #顯示到畫面上
            NEXT FIELD pmds053                     #返回原欄位
]]>
  </point>
  <point name="construct.c.pmds055" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_pmds055()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmds055  #顯示到畫面上
            NEXT FIELD pmds055                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.pmdscnfid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdscnfid  #顯示到畫面上

            NEXT FIELD pmdscnfid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdscrtdp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdscrtdp  #顯示到畫面上

            NEXT FIELD pmdscrtdp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdscrtid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdscrtid  #顯示到畫面上

            NEXT FIELD pmdscrtid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdsdocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmdsdocno" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg1 = g_argv[1]   #單據類型
            CALL q_pmdsdocno()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdsdocno  #顯示到畫面上

            NEXT FIELD pmdsdocno                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdsmodid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdsmodid  #顯示到畫面上

            NEXT FIELD pmdsmodid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdsowndp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdsowndp  #顯示到畫面上

            NEXT FIELD pmdsowndp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdsownid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdsownid  #顯示到畫面上

            NEXT FIELD pmdsownid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdspstid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO pmdspstid  #顯示到畫面上

            NEXT FIELD pmdspstid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.pmdssite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="construct.c.pmdsstus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="cs.add_cs" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="cs.after_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="cs.b_dialog" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         LET g_pmdt_d[1].pmdtseq = ""
         DISPLAY ARRAY g_pmdt_d TO s_detail1.*
            BEFORE DISPLAY
               EXIT DISPLAY
         END DISPLAY  
         LET g_pmdt2_d[1].pmduseq1 = ""
         DISPLAY ARRAY g_pmdt2_d TO s_detail2.*
            BEFORE DISPLAY
               EXIT DISPLAY
         END DISPLAY  
         LET g_pmdt3_d[1].pmdvseq1 = ""
         DISPLAY ARRAY g_pmdt3_d TO s_detail3.*
            BEFORE DISPLAY
               EXIT DISPLAY
         END DISPLAY    
         ]]>
  </point>
  <point name="cs.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="cs.body.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="cs.body2.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="cs.body3.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="cs.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="cs.head.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="default_search.after" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF NOT cl_null(g_argv[01]) THEN
      LET g_wc = g_wc , " AND pmds000 = '", g_argv[01], "' "
   END IF]]>
  </point>
  <point name="default_search.after_sql" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   LET ls_wc = ''
   IF NOT cl_null(g_argv[02]) THEN
      LET ls_wc = " pmdsdocno = '", g_argv[02], "' AND "
   END IF
   IF NOT cl_null(g_argv[03]) THEN
      IF cl_null(ls_wc) THEN
         LET ls_wc = " pmds006 = '", g_argv[03], "' AND "
      ELSE
         LET ls_wc = ls_wc , " pmds006 = '", g_argv[03], "' AND "
      END IF
   END IF
  
   #其他程式串查用，傳入 site，變更g_site要變更TITLE 用cl_ui_wintitle去變更
   IF NOT cl_null(g_argv[04]) THEN
      LET g_site = g_argv[04]
      CALL cl_ui_wintitle(FALSE)
   END IF 

   #傳單號範圍至apmt520,一次查詢可查詢出多個單號資料
   IF NOT cl_null(g_argv[05]) THEN
      IF cl_null(ls_wc) THEN
         LET ls_wc = g_argv[05], " AND "
      ELSE
         LET ls_wc = ls_wc , g_argv[05], " AND "
      END IF
   END IF
   ]]>
  </point>
  <point name="default_search.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="default_search.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="delete.before_ask" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   #IF g_pmds_m.pmdsstus <> 'N' THEN
   IF g_pmds_m.pmdsstus NOT MATCHES "[NDR]" THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_pmds_m.pmdsdocno
      LET g_errparam.code   = "apm-00034" 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF]]>
  </point>
  <point name="delete.body.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.body.a_delete2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.body.a_delete3" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      CALL g_pmdt4_d.clear()
      
      DELETE FROM pmdw_t
       WHERE pmdwent = g_enterprise AND
             pmdwdocno = g_pmds_m.pmdsdocno

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdw_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')
         RETURN
      END IF

      IF NOT s_aooi360_del('6',g_prog,g_pmds_m.pmdsdocno,'','','','','','','','','4') THEN
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      #刪除交易稅明細檔
      LET l_cnt = 0
      SELECT COUNT(*) INTO l_cnt
        FROM xrcd_t
       WHERE xrcdent = g_enterprise
         AND xrcddocno = g_pmds_m.pmdsdocno
      IF l_cnt > 0 THEN
         DELETE FROM xrcd_t
          WHERE xrcdent = g_enterprise
            AND xrcddocno = g_pmds_m.pmdsdocno
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend = "DELETE xrcd_t"
            LET g_errparam.code   = SQLCA.sqlcode
            LET g_errparam.popup  = FALSE
            CALL cl_err()
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      END IF]]>
  </point>
  <point name="delete.body.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.body.b_delete2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.body.b_delete3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.body.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.body.m_delete2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.body.m_delete3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.define" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE  l_cnt           LIKE type_t.num5         ]]>
  </point>
  <point name="delete.head.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      IF NOT s_aooi200_del_docno(g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt) THEN
         CALL s_transaction_end('N','0')
         RETURN
      END IF                  ]]>
  </point>
  <point name="delete.head.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete.head.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.a_delete2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.a_delete3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.b_delete2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.b_delete3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="delete_b.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="delete_b.m_delete2" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      DELETE FROM pmdu_t
       WHERE pmduent = g_enterprise AND
         pmdudocno = ps_keys_bak[1] AND pmduseq = ps_keys_bak[2]                  ]]>
  </point>
  <point name="delete_b.m_delete3" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      DELETE FROM pmdv_t
       WHERE pmdvent = g_enterprise AND
         pmdvdocno = ps_keys_bak[1] AND pmdvseq = ps_keys_bak[2]                  ]]>
  </point>
  <point name="delete_b.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.body.table1.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.body.table1.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.body.table1.b_update" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   UPDATE apmt520_detail SET pmdt053 = 0 , pmdt054 = 0, pmdt055 = 0, pmdt052 = '1'  #狀態碼 '1:一般'
        ]]>
  </point>
  <point name="detail_reproduce.body.table1.m_insert" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="detail_reproduce.body.table2.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.body.table2.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.body.table2.m_insert" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   UPDATE pmdu_t SET pmdu013 = 0 , pmdu014 = 0, pmdu015 = 0
        WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno
                ]]>
  </point>
  <point name="detail_reproduce.body.table3.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.body.table3.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.body.table3.m_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_reproduce.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_show.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_show.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="detail_show.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="fetch.action_control" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="fetch.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="fetch.define" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="fill_chk.after_chk" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF ((NOT cl_null(g_wc2_table1) AND g_wc2_table1.trim() <> '1=1')) OR
      ((NOT cl_null(g_wc2_table2) AND g_wc2_table2.trim() <> '1=1')) OR
      ((NOT cl_null(g_wc2_table3) AND g_wc2_table3.trim() <> '1=1')) THEN
      RETURN TRUE
   END IF]]>
  </point>
  <point name="fill_chk.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="fill_chk.other_chk" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="filter.add_cs" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="filter.b_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="filter.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="filter_parser.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="global.inc" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[GLOBALS "../../../com/sub/4gl/s_aic_carry.inc"   #150615 earl add]]>
  </point>
  <point name="global.variable" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[ TYPE type_g_pmdt4_d        RECORD
   pmdtseq LIKE pmdt_t.pmdtseq,
   pmdt001 LIKE pmdt_t.pmdt001, 
   pmdt002 LIKE pmdt_t.pmdt002, 
   pmdt003 LIKE pmdt_t.pmdt003, 
   pmdt004 LIKE pmdt_t.pmdt004, 
   pmdt005 LIKE pmdt_t.pmdt005, 
   pmdt006 LIKE pmdt_t.pmdt006, 
   imaal003 LIKE imaal_t.imaal003, 
   imaal004 LIKE imaal_t.imaal004, 
   pmdt007 LIKE pmdt_t.pmdt007,
   pmdt007_desc LIKE type_t.chr500,    
   pmdt009 LIKE pmdt_t.pmdt009, 
   pmdt010 LIKE pmdt_t.pmdt010,
   pmdt019 LIKE pmdt_t.pmdt019, 
   pmdt019_desc LIKE type_t.chr500, 
   pmdt020 LIKE pmdt_t.pmdt020,
   pmdt023 LIKE pmdt_t.pmdt023, 
   pmdt023_desc LIKE type_t.chr500, 
   pmdt024 LIKE pmdt_t.pmdt024, 
   pmdt040 LIKE pmdt_t.pmdt040,
   pmdt036 LIKE pmdt_t.pmdt036,
   pmdt046 LIKE pmdt_t.pmdt046,
   pmdt046_desc LIKE type_t.chr500,     
   pmdt037 LIKE pmdt_t.pmdt037, 
   pmdt038 LIKE pmdt_t.pmdt038, 
   pmdt039 LIKE pmdt_t.pmdt039,
   pmdt047 LIKE pmdt_t.pmdt047,
   pmdt092 LIKE pmdt_t.pmdt092,
   pmdt093 LIKE pmdt_t.pmdt093
       END RECORD
DEFINE g_pmdt4_d   DYNAMIC ARRAY OF type_g_pmdt4_d
DEFINE g_pmdt4_d_t type_g_pmdt4_d
DEFINE g_pmdt4_d_o type_g_pmdt4_d
DEFINE g_rec_b4    LIKE type_t.num5           
DEFINE l_ac4       LIKE type_t.num5 

DEFINE g_flag2        LIKE type_t.num5
DEFINE g_acc          LIKE gzcb_t.gzcb007
DEFINE g_flag3        LIKE type_t.num5
DEFINE g_ooef025      LIKE ooef_t.ooef025
DEFINE g_pmab039      LIKE pmab_t.pmab039  
DEFINE g_tax_app      LIKE oodb_t.oodb011      #取得稅別類型1:正常稅率2:依料件設定
DEFINE g_pmam003      LIKE pmam_t.pmam003      #價格是否允許修改
DEFINE g_pmam006      LIKE pmam_t.pmam006      #允許價格為0
DEFINE g_pmam002      LIKE pmam_t.pmam002      #未取到價格可以人工輸入
DEFINE g_upd_price    LIKE type_t.num5         #是否可以修改單價
DEFINE g_pmdldocno    LIKE pmdl_t.pmdldocno    #倉退單產生新的採購單單號
DEFINE g_controlno    LIKE ooha_t.ooha001      #控制組]]>
  </point>
  <point name="idx_chk.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="idx_chk.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="init.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[DEFINE l_gzze003  LIKE gzze_t.gzze003       ]]>
  </point>
  <point name="init.init" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL cl_set_combo_scc('pmdt005_1','2055')
   CALL cl_set_combo_scc('pmdt040_1','2039')
   CALL cl_set_combo_scc('pmdu013','5073')
   CALL cl_set_combo_scc('pmdv005','2055')
   
   #判斷據點參數若不使用參考單位時，則參考單位、數量需隱藏不可以維護(據點參數:S-BAS-0028)
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0028') = 'N' THEN
      CALL cl_set_comp_visible("pmdt021,pmdt021_desc,pmdt022,pmdu011,pmdu011_desc,pmdu012",FALSE)
   END IF

   #判斷據點參數若不使用產品特徵時，則產品特徵需隱藏不可以維護(據點參數:S-BAS-0036)
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0036') = 'N' THEN
      CALL cl_set_comp_visible("pmdo002,pmdo002_desc,pmdt007,pmdt007_desc,pmdu002,pmdu002_desc,pmdv002,pmdv002_desc,pmdt007_1,pmdt007_1_desc",FALSE)
   END IF

   #整體參數未使用採購計價單位
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "N" THEN
      CALL cl_set_comp_visible("pmdt023,pmdt023_desc,pmdt024,pmdt023_1,pmdt023_desc1,pmdt024_1",FALSE)
   END IF

   CALL cl_set_comp_visible("pmdt008,pmdt008_desc",FALSE)
   
   #g_argv[1] 參數說明
   #1.採購收貨單    apmt520      2.無採購收貨單 apmt522      3.採購收貨入庫單 apmt530  4.無採購收貨入庫單 apmt532
   #5.驗退單        apmt560      6.入庫單 apmt570           7.倉退單 apmt580
   #8.委外採購收貨單 apmt521      9.重覆性生產收貨單 apmt523 
   #10.委外驗退單    apmt561     11.重覆性生產驗退 apmt563
   #12.委外收貨入庫單 apmt571    13.重覆性生產入庫單 apmt573
   #14.委外倉退單    apmt581     15.重覆性生產倉退單 apmt583
   #20.委外採購收貨入庫單 apmt531
   #23.借貨採購收貨單 apmt524    24.借貨採購收貨入庫單 apmt534  25.借貨入庫單 apmt574   26.借貨歸還單  apmt584
   
   CALL cl_set_comp_visible("pmdu013,pmdu014,pmdu015",FALSE)
   
   IF g_argv[1] MATCHES '[1234]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
      #不需要顯示單據性質欄位
      CALL cl_set_comp_visible("lbl_pmds000,pmds000",FALSE)
   END IF
   IF g_argv[1] MATCHES '[1234689]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '20' THEN
      #不需要顯示取回日期欄位
      CALL cl_set_comp_visible("lbl_pmds081,pmds081",FALSE)
   END IF
   IF g_argv[1] MATCHES '[1234789]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
      #不需要顯示 QC單號、QC評定項次、判定結果欄位
      CALL cl_set_comp_visible("pmdt081,pmdt082,pmdt083,pmdt083_desc",FALSE)
   END IF

   IF g_argv[1] MATCHES '[12345689]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '20' THEN
      #不需要顯示倉退類型欄位
      CALL cl_set_comp_visible("lbl_pmds100,pmds100,lbl_pmds101,pmds101,lbl_pmds102,pmds102",FALSE)
   END IF
   
   IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26'  THEN
      #不需要顯示取價、付款信息等欄位
      #CALL cl_set_comp_visible("lbl_pmds039,pmds039,pmds039_desc,lbl_pmds040,pmds040,pmds040_desc",FALSE)
      CALL cl_set_comp_visible("lbl_pmds040,pmds040,pmds040_desc",FALSE)
   END IF

   IF g_argv[1] MATCHES '[12589]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '23' THEN
      #此作業單頭的狀態頁籤不需要呈現扣帳日期,最近過帳人員與過帳日期兩個欄位
      CALL cl_set_comp_visible("lbl_pmds001,pmds001,lbl_pmdspstid,pmdspstid,lbl_pmdspstdt,pmdspstdt",FALSE)
   END IF
   
   #IF g_argv[1] MATCHES '[135689]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' THEN
   #   #此作業單頭不需要呈現財務資訊頁籤
   #   CALL cl_set_comp_visible("page_5",FALSE)
   #END IF
   
   #IF g_argv[1] MATCHES '[1356789]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
   #   CALL cl_set_comp_visible("lbl_pmds012,pmds012,pmds012_desc",FALSE)
   #END IF

   IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
      #此作業單身"收貨明細頁籤"的單價、稅別、稅率、未稅金額、含稅金額、來源收貨單號，來源收貨項次需隱藏不可以維護
      CALL cl_set_comp_visible("pmdt036,pmdt046,pmdt046_desc,pmdt037,pmdt038,pmdt039,pmdt047,pmdt027,pmdt028",FALSE)
   END IF

   IF g_argv[1] MATCHES '[1234567]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
      #作業單身所有頁籤只要有作業編號、製程序的欄位均需隱藏、不可以維護，這兩個欄位只有委外收貨作業才可以維護
      CALL cl_set_comp_visible("pmdt009,pmdt009_desc,pmdt010,pmdu003,pmdu004,pmdv003,pmdv004,pmdt009_1,pmdt010_1",FALSE)
   END IF

   IF g_argv[1] MATCHES '[24]' THEN
      #作業單身採購單號欄位，需要隱藏不可以維護
      #所有頁籤只要有採購單號、採購項次、採購項序、分批序、子件特性、採購料號、採購產品特徵欄位均需隱藏ˋ不可以維      
      CALL cl_set_comp_visible("prog_pmds006,pmds006,pmdt001,pmdt002,pmdt003,pmdt004,pmdo001,imaal003,imaal004,pmdt027,pmdt028",FALSE)
      CALL cl_set_comp_visible("pmdo002,pmdo002_desc,pmdt001_1,pmdt002_1,pmdt003_1,pmdt004_1",FALSE)
      #單身的"原始需求分配明細"頁籤需要隱藏不可以維護
      CALL cl_set_comp_visible("page_4",FALSE)
   END IF
   
   IF NOT (g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26')  THEN
      #不需要顯示合約差異調整的欄位
      CALL cl_set_comp_visible("lbl_pmds054,pmds054,lbl_pmds055,pmds055,pmdt070,pmdt071",FALSE)
   END IF
   
   #借貨歸還單，倉退類型隱藏
   IF g_argv[1] = '26' THEN
      CALL cl_set_comp_visible("lbl_pmds100,pmds100",FALSE)
   END IF
      
   IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26'   THEN
      #不需要顯示來源單號、項序、分批序等欄位
      #CALL cl_set_comp_visible("pmdt001,pmdt002,pmdt003,pmdt004",FALSE)
      CALL cl_set_comp_visible("pmdt027,pmdo001,imaal003,imaal004,pmdo002,pmdo002_desc,pmdt025,pmdt011",FALSE)
      CALL cl_set_comp_visible("pmdt036,pmdt046,pmdt046_desc,pmdt037,pmdt038,pmdt039,pmdt047,pmdt026,pmdt041",FALSE)
      CALL cl_set_comp_visible("pmdt040,pmdt052,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061",FALSE)
      #CALL cl_set_comp_visible("page_3",FALSE)
      CALL cl_set_comp_visible("pmdvseq1",FALSE)
      CALL cl_set_comp_visible("pmdu013,pmdu014,pmdu015",FALSE)
   END IF

   IF g_argv[1] MATCHES '[57]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26' THEN
      #不需要原始需求分配頁簽
      CALL cl_set_comp_visible("page_4",FALSE)
      CALL cl_set_comp_visible("pmds052",FALSE)  #供應商出貨日
   END IF
   
   #借貨歸還單才顯示借貨還價數量、金額等，其他作業不顯示
   IF g_argv[1] <> '26' THEN
       CALL cl_set_comp_visible("pmdt090,pmdt091,pmdt092,pmdt093",FALSE)
   END IF

   IF g_argv[1] MATCHES '[34]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
      #收貨單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00420' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocno',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocno',l_gzze003)

      #收貨日期
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00421' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocdt',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocdt',l_gzze003)

      #收貨人員
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00422' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds002',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds002',l_gzze003)

      #收貨部門
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00423' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmds003',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds003',l_gzze003)
   END IF

   IF g_argv[1] MATCHES '[34567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
      #單身的限定庫位、限定儲位、限定批號名稱更新成庫位、儲位、批號    
      #庫位
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00426' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt016',l_gzze003)

      #儲位
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00427' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt017',l_gzze003)

      #批號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00428' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt018',l_gzze003)
   END IF

   #驗退單 apmt560
   IF g_argv[1] MATCHES '[5]' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN
      #驗退資訊頁簽
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00445' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('master_Folder_page',l_gzze003)

      #驗退明細頁簽
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00446' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('bpage_1',l_gzze003)

      #驗退單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00436' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocno',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocno',l_gzze003)

      #驗退日期
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00437' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocdt',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocdt',l_gzze003)

      #驗退人員
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00438' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds002',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds002',l_gzze003)

      #驗退部門
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00439' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmds003',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds003',l_gzze003)
      
      ##收貨項次
      #LET l_gzze003 = ' '
      #SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00457' AND gzze002 = g_dlang
      #CALL cl_set_comp_att_text('pmdt002',l_gzze003)

      #驗退料號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00440' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt006',l_gzze003)
      CALL cl_set_comp_att_text('pmdt006_1',l_gzze003)
      CALL cl_set_comp_att_text('pmdv001',l_gzze003)

      ##驗退產品特徵
      #LET l_gzze003 = ' '
      #SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00441' AND gzze002 = g_dlang
      #CALL cl_set_comp_att_text('pmdt007',l_gzze003)
      #CALL cl_set_comp_att_text('pmdt007_1',l_gzze003)
      #CALL cl_set_comp_att_text('pmdv002',l_gzze003)

      #驗退單位
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00442' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt019',l_gzze003)
      CALL cl_set_comp_att_text('pmdt019_1',l_gzze003)
      CALL cl_set_comp_att_text('pmdv018',l_gzze003)

      #驗退數量
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00443' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt020',l_gzze003)
      CALL cl_set_comp_att_text('pmdt020_1',l_gzze003)

      #驗退分配數量
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00444' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdv019',l_gzze003)

   END IF

   IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
      #收貨單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00420' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds006',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds006',l_gzze003)
      #CALL cl_set_comp_att_text('pmdt001',l_gzze003)

   END IF
   
   #入庫單 apmt570
   IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25'  THEN
      #入庫資訊頁簽
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00499' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('master_Folder_page',l_gzze003)

      #入庫明細頁簽
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00500' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('bpage_1',l_gzze003)

      #入庫單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00501' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocno',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocno',l_gzze003)

      #入庫日期
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00502' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocdt',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocdt',l_gzze003)

      #入庫人員
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00503' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds002',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds002',l_gzze003)

      #入庫部門
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00504' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmds003',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds003',l_gzze003)
      
      ##收貨項次
      #LET l_gzze003 = ' '
      #SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00457' AND gzze002 = g_dlang
      #CALL cl_set_comp_att_text('pmdt002',l_gzze003)

      #入庫料號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00505' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt006',l_gzze003)
      CALL cl_set_comp_att_text('pmdt006_1',l_gzze003)
      CALL cl_set_comp_att_text('pmdv001',l_gzze003)

      ##入庫產品特徵
      #LET l_gzze003 = ' '
      #SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00506' AND gzze002 = g_dlang
      #CALL cl_set_comp_att_text('pmdt007',l_gzze003)
      #CALL cl_set_comp_att_text('pmdt007_1',l_gzze003)
      #CALL cl_set_comp_att_text('pmdv002',l_gzze003)

      #入庫單位
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00507' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt019',l_gzze003)
      CALL cl_set_comp_att_text('pmdt019_1',l_gzze003)
      CALL cl_set_comp_att_text('pmdv018',l_gzze003)

      #入庫數量
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00508' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt020',l_gzze003)
      CALL cl_set_comp_att_text('pmdt020_1',l_gzze003)

      #入庫分配數量
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00509' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdv019',l_gzze003)

   END IF
   
   #倉退單 apmt580
   IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26'  THEN
      #倉退資訊頁簽
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00510' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('master_Folder_page',l_gzze003)

      #倉退明細頁簽
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00521' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('page_5',l_gzze003)
      
      #折讓資訊頁簽
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00511' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('bpage_1',l_gzze003)

      #倉退單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00512' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocno',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocno',l_gzze003)

      #倉退日期
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00513' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocdt',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocdt',l_gzze003)

      #倉退人員
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00514' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds002',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds002',l_gzze003)

      #倉退部門
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00515' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmds003',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds003',l_gzze003)
      
      ##收貨項次
      #LET l_gzze003 = ' '
      #SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00457' AND gzze002 = g_dlang
      #CALL cl_set_comp_att_text('pmdt002',l_gzze003)

      #倉退料號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00516' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt006',l_gzze003)
      CALL cl_set_comp_att_text('pmdt006_1',l_gzze003)
      CALL cl_set_comp_att_text('pmdv001',l_gzze003)

      ##倉退產品特徵
      #LET l_gzze003 = ' '
      #SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00517' AND gzze002 = g_dlang
      #CALL cl_set_comp_att_text('pmdt007',l_gzze003)
      #CALL cl_set_comp_att_text('pmdt007_1',l_gzze003)
      #CALL cl_set_comp_att_text('pmdv002',l_gzze003)

      #倉退單位
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00518' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt019',l_gzze003)
      CALL cl_set_comp_att_text('pmdt019_1',l_gzze003)
      CALL cl_set_comp_att_text('pmdv018',l_gzze003)

      #倉退數量
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00519' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt020',l_gzze003)
      CALL cl_set_comp_att_text('pmdt020_1',l_gzze003)

   END IF
   
   #23.借貨採購收貨單 apmt524    24.借貨採購收貨入庫單 apmt534  25.借貨入庫單 apmt574   26.借貨歸還單  apmt584
   #借貨採購收貨單 apmt524
   IF g_argv[1] = '23' OR g_argv[1] = '24' THEN
      #借货收貨單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00865' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocno',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocno',l_gzze003)
      
      #借货採購單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00853' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds006',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds006',l_gzze003)
   END IF
   
   IF g_argv[1] = '25' THEN 
      #借货入庫單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00866' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocno',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocno',l_gzze003)
   END IF
   
   IF g_argv[1] = '26' THEN 
      #借货歸還單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00867' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocno',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocno',l_gzze003)

      #歸還日期
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00868' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdsdocdt',l_gzze003)
      CALL cl_set_comp_att_text('b_pmdsdocdt',l_gzze003)

      #歸還人員
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00869' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds002',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds002',l_gzze003)

      #歸還部門
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00870' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmds003',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds003',l_gzze003)
      
      #借貨料號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00891' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt006,pmdu001,pmdv001,pmdt006_1',l_gzze003)
      
      #借貨單位
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00892' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt019,pmdt019_1',l_gzze003)
      
      #借貨還量數量
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'axm-00536' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('pmdt020,pmdt020_1',l_gzze003)

   END IF
   
   
   IF g_argv[1] = '25' OR g_argv[1] = '26' THEN 
      #借货收貨單號
      LET l_gzze003 = ' '
      SELECT gzze003 INTO l_gzze003 FROM gzze_t WHERE gzze001 = 'apm-00865' AND gzze002 = g_dlang
      CALL cl_set_comp_att_text('prog_pmds006',l_gzze003)
      CALL cl_set_comp_att_text('b_pmds006',l_gzze003)
   END IF
   

   #委外、重覆性生產，先隱藏 單據性質
   IF g_argv[1] = '8' OR g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14' OR  g_argv[1] = '9' OR g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
      CALL cl_set_comp_visible("lbl_pmds000,pmds000",FALSE)
   END IF
   
   #收貨、入庫、倉退下顯示先隱藏價格頁簽
   #IF g_argv[1] MATCHES '[1346789]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
      CALL cl_set_comp_visible("page_7",FALSE)
   #END IF
   
   #隱藏toolbar下拉中的ACTION 菜單
   CALL apmt520_act_visible_init()]]>
  </point>
  <point name="input.a.page1.pmdt001" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt001) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmdt_d[l_ac].pmdt001 != g_pmdt_d_o.pmdt001 OR cl_null(g_pmdt_d_o.pmdt001))) THEN 
                  IF NOT apmt520_pmdt001_chk(g_pmdt_d[l_ac].pmdt001) THEN
                     LET g_pmdt_d[l_ac].pmdt001 = g_pmdt_d_o.pmdt001
                     NEXT FIELD pmdt001
                  END IF
          
                  #若採購項次、採購項序、採購分批序均有值時，需撿核該採購單是否有對應的交期明細資料
                  IF NOT apmt520_pmdo_chk() THEN
                     LET g_pmdt_d[l_ac].pmdt001 = g_pmdt_d_o.pmdt001
                     NEXT FIELD pmdt001
                  END IF
                  
                  CALL apmt520_pmdt001_desc()
                  
               END IF
            END IF
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
               
            CALL apmt520_set_no_entry_b(l_cmd)
            
            LET g_pmdt_d_o.pmdt001 = g_pmdt_d[l_ac].pmdt001            ]]>
  </point>
  <point name="input.a.page1.pmdt002" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt002)  THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmdt_d[l_ac].pmdt002 != g_pmdt_d_o.pmdt002 OR cl_null(g_pmdt_d_o.pmdt002))) THEN 
                  IF NOT apmt520_pmdt002_chk() THEN
                     LET g_pmdt_d[l_ac].pmdt002 = g_pmdt_d_o.pmdt002
                     NEXT FIELD pmdt002
                  END IF
                  
                  #有採購單號為來源單據
                  IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
                     #若採購項次、採購項序、採購分批序均有值時，需撿核該採購單是否有對應的交期明細資料
                     IF NOT apmt520_pmdo_chk() THEN
                        LET g_pmdt_d[l_ac].pmdt002 = g_pmdt_d_o.pmdt002
                        NEXT FIELD pmdt002
                     END IF
                     
                     #是否存在送貨據點=g_site的採購資料
                     LET l_n = 0
                     SELECT COUNT(*) INTO l_n FROM pmdn_t 
                        WHERE pmdnent = g_enterprise AND pmdndocno = g_pmdt_d[l_ac].pmdt001 AND pmdnseq = g_pmdt_d[l_ac].pmdt002 AND pmdnunit = g_site
                     IF l_n = 0 OR cl_null(l_n) THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'apm-00375'
                        LET g_errparam.extend = g_pmdt_d[l_ac].pmdt002
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                        LET g_pmdt_d[l_ac].pmdt002 = g_pmdt_d_o.pmdt002
                        NEXT FIELD pmdt002
                     END IF
                     
                     #CALL apmt520_pmdt001_desc()
                     
                     #若輸入的採購單號+採購項次的pmdo_t只有對應一個採購項序時，則自動將採購項序預設到收貨單身[C:採購項次]上
                     #若輸入的採購單號+採購項次的pmdo_t只有對應一個分批序時，則自動將分批序預設到收貨單身[C:分批序]上
                     LET l_n = 0
                     SELECT COUNT(*) INTO l_n FROM pmdo_t WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001 AND pmdoseq = g_pmdt_d[l_ac].pmdt002
                     IF l_n = 1 THEN
                        SELECT pmdoseq1,pmdoseq2 INTO g_pmdt_d[l_ac].pmdt003,g_pmdt_d[l_ac].pmdt004 FROM pmdo_t WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001 AND pmdoseq = g_pmdt_d[l_ac].pmdt002                   
                        DISPLAY BY NAME g_pmdt_d[l_ac].pmdt003,g_pmdt_d[l_ac].pmdt004
                        
                        LET g_pmdt_d_o.pmdt003 = g_pmdt_d[l_ac].pmdt003 
                        LET g_pmdt_d_o.pmdt004 = g_pmdt_d[l_ac].pmdt004 
                     END IF
                     
                     CALL apmt520_pmdt001_desc()
                     
                  END IF

               END IF
            END IF
            
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)
            LET g_pmdt_d_o.pmdt002 = g_pmdt_d[l_ac].pmdt002          ]]>
  </point>
  <point name="input.a.page1.pmdt003" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt003) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmdt_d[l_ac].pmdt003 != g_pmdt_d_o.pmdt003 OR cl_null(g_pmdt_d_o.pmdt003))) THEN 
                  #輸入的採購單號+採購項次+採購項序必須存在pmdo_t中
                  LET l_n = 0
                  SELECT COUNT(*) INTO l_n FROM pmdo_t WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001 AND pmdoseq = g_pmdt_d[l_ac].pmdt002 AND pmdoseq1 = g_pmdt_d[l_ac].pmdt003
                  IF l_n = 0 OR cl_null(l_n) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'apm-00374'
                     LET g_errparam.extend = g_pmdt_d[l_ac].pmdt003
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_pmdt_d[l_ac].pmdt003 = g_pmdt_d_o.pmdt003
                     NEXT FIELD pmdt003
                  END IF
          
                  #若採購項次、採購項序、採購分批序均有值時，需撿核該採購單是否有對應的交期明細資料
                  IF NOT apmt520_pmdo_chk() THEN
                     LET g_pmdt_d[l_ac].pmdt003 = g_pmdt_d_o.pmdt003
                     NEXT FIELD pmdt003
                  END IF
                  
                  CALL apmt520_pmdt001_desc()
                  
                  #若輸入的採購單號+採購項次+採購項序的pmdo_t只有對應一個分批序時，則自動將分批序預設到收貨單身[C:分批序]上
                  LET l_n = 0
                  SELECT COUNT(*) INTO l_n FROM pmdo_t WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001 AND pmdoseq = g_pmdt_d[l_ac].pmdt002 AND pmdoseq1 = g_pmdt_d[l_ac].pmdt003
                  IF l_n = 1 THEN
                     SELECT pmdoseq2 INTO g_pmdt_d[l_ac].pmdt004 FROM pmdo_t WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001 AND pmdoseq = g_pmdt_d[l_ac].pmdt002 AND pmdoseq1 = g_pmdt_d[l_ac].pmdt003                  
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt004
                     
                     LET g_pmdt_d_o.pmdt004 = g_pmdt_d[l_ac].pmdt004 
                  END IF
                  
               END IF
            END IF
            
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)
            LET g_pmdt_d_o.pmdt003 = g_pmdt_d[l_ac].pmdt003                ]]>
  </point>
  <point name="input.a.page1.pmdt004" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt004)  THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmdt_d[l_ac].pmdt004 != g_pmdt_d_o.pmdt004 OR cl_null(g_pmdt_d_o.pmdt004))) THEN 
                 
                  #若採購項次、採購項序、採購分批序均有值時，需撿核該採購單是否有對應的交期明細資料
                  IF NOT apmt520_pmdo_chk() THEN
                     LET g_pmdt_d[l_ac].pmdt004 = g_pmdt_d_o.pmdt004
                     NEXT FIELD pmdt004
                  END IF
                  
                  CALL apmt520_pmdt001_desc()
                  
               END IF
            END IF
            
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)
            LET g_pmdt_d_o.pmdt004 = g_pmdt_d[l_ac].pmdt004                   ]]>
  </point>
  <point name="input.a.page1.pmdt005" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF g_pmdt_d[l_ac].pmdt005 = '9' THEN  #樣品
               LET g_pmdt_d[l_ac].pmdt001 = ''
               LET g_pmdt_d[l_ac].pmdt002 = ''
               LET g_pmdt_d[l_ac].pmdt003 = ''
               LET g_pmdt_d[l_ac].pmdt004 = ''
               LET g_pmdt_d[l_ac].pmdt036 = 0
               LET g_pmdt_d[l_ac].pmdt038 = 0
               LET g_pmdt_d[l_ac].pmdt039 = 0
               LET g_pmdt_d[l_ac].pmdt047 = 0
            END IF
            
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)
            ]]>
  </point>
  <point name="input.a.page1.pmdt006" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdt006) RETURNING g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
            
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt006) THEN
               IF g_pmdt_d[l_ac].pmdt006 != g_pmdt_d_o.pmdt006 OR cl_null(g_pmdt_d_o.pmdt006) THEN 
                 
                  IF NOT apmt520_pmdt006_chk(g_pmdt_d[l_ac].pmdt006) THEN
                     LET g_pmdt_d[l_ac].pmdt006 = g_pmdt_d_t.pmdt006
                     CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdt006) RETURNING g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
                     NEXT FIELD pmdt006
                  END IF
                  
                  IF ((cl_null(g_pmdt_d[l_ac].pmdt001)) AND (cl_null(g_pmdt_d[l_ac].pmdt002)) AND (cl_null(g_pmdt_d[l_ac].pmdt003)) AND (cl_null(g_pmdt_d[l_ac].pmdt004)))
                      OR ((cl_null(g_pmdt_d[l_ac].pmdt027)) AND (cl_null(g_pmdt_d[l_ac].pmdt028)))  THEN
                     CALL apmt520_pmdt006_desc()
                  END IF
                  
                  IF g_argv[1] MATCHES '[24]' OR ((g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') AND cl_null(g_pmds_m.pmds006)) THEN
                  
                     LET l_imaa005 = ''
                     CALL apmt520_get_imaa005(g_enterprise,g_pmdt_d[l_ac].pmdt006) RETURNING l_imaa005
                      
                     #使用產品特徵 
                     CALL l_inam.clear()     
                     IF cl_get_para(g_enterprise,g_site,'S-BAS-0036') = 'Y' THEN 
                        IF NOT cl_null(l_imaa005) THEN
                           IF l_cmd = 'a' THEN            
                              #CALL l_inam.clear()            
                              CALL s_feature(l_cmd,g_pmdt_d[l_ac].pmdt006,'','',g_site,g_pmds_m.pmdsdocno) RETURNING l_success,l_inam
                              LET g_pmdt_d[l_ac].pmdt007 = l_inam[1].inam002
                              LET g_pmdt_d[l_ac].pmdt020 = l_inam[1].inam004
                              DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt020
                              
                              #計算參考數量
                              IF (NOT cl_null(g_pmdt_d[l_ac].pmdt021)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt019)) THEN
                                 #CALL s_aimi190_get_convert(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021) RETURNING l_success,l_rate
                                 #LET g_pmdt_d[l_ac].pmdt022 = g_pmdt_d[l_ac].pmdt020 * l_rate
                                 CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                                         RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                              END IF
                              
                              #若參數有使用計價單位時，則輸入[C:需求數量]時則應自動推算計價數量，
                              #[C:計價數量]=[C:需求數量]*[C:單位]與[C:計價單位]換算率
                              IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt019)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN  #體參數使用採購計價單位
                                 #ALL s_aimi190_get_convert(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023) RETURNING l_success,l_rate
                                 #ET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020 * l_rate
                                 CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                                         RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                              ELSE
                                 LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                                 LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020            
                              END IF
                              DISPLAY BY NAME g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt024
                           END IF
                        END IF
                     END IF
                     
                     CALL apmt520_pmdt006_desc()
                     
                     #修改料號時需要開窗詢問是否重新取價，若選擇要時則需呼叫取價應用元件重新取價，
                     #並重新呼叫'計算金額'應用元件計算[C:含稅金額]、[C:未稅金額]、[C:稅額]
                     IF l_cmd = 'u' THEN 
                        IF cl_ask_confirm('axm-00230') THEN                              
                           #取出價格
                           CALL apmt520_get_price()
                          
                           #未稅金額、含稅金額
                           IF (NOT cl_null(g_pmdt_d[l_ac].pmdt024)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                              CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                                RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039            
                           END IF
                           DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
                           
                        END IF
                     ELSE
                        #取出價格
                        CALL apmt520_get_price()
                        #未稅金額、含稅金額
                        IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                           CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                             RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039            
                        END IF
                        DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
                     END IF   
                  END IF
                 
                  #預設沖銷順序
                  LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                              " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                              "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                              "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' "
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                     LET l_sql =  l_sql , " AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                     LET l_sql =  l_sql , " AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) OR g_pmdt_d[l_ac].pmdt017 = ' ' THEN
                     LET l_sql =  l_sql , " AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN
                     LET l_sql =  l_sql , " AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
                  END IF
                  PREPARE pmdt011_pre FROM l_sql
                  EXECUTE pmdt011_pre INTO g_pmdt_d[l_ac].pmdt011
          
                  IF cl_null(g_pmdt_d[l_ac].pmdt011) OR g_pmdt_d[l_ac].pmdt011 = 0 THEN
                     LET g_pmdt_d[l_ac].pmdt011 = 1
                  END IF
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt011
               END IF
               LET g_pmdt_d_o.pmdt006 = g_pmdt_d[l_ac].pmdt006
            END IF
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)
]]>
  </point>
  <point name="input.a.page1.pmdt007" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
            
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt007) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmdt_d[l_ac].pmdt007 != g_pmdt_d_t.pmdt007 OR cl_null(g_pmdt_d_t.pmdt007))) THEN 
                  
                    
                  IF NOT s_feature_check(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) THEN
                     LET g_pmdt_d[l_ac].pmdt007 = g_pmdt_d_t.pmdt007
                     CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
                     NEXT FIELD CURRENT
                  END IF
                     
                  #收貨單在維護料號時需檢核料件AVL控管點(imaa044)設置，若是設置'2:可採購，不可收貨'時，則要檢核
                  #其他收貨、無採購收貨、收貨入庫單等作業也需考慮
                  IF g_argv[1] MATCHES '[123489]' OR g_argv[1] = '20' THEN
                     IF NOT s_apmt520_item_avl_chk(g_pmds_m.pmdsdocdt,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmds_m.pmds007) THEN
                        LET g_pmdt_d[l_ac].pmdt007 = g_pmdt_d_t.pmdt007
                        CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
                        DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
                        NEXT FIELD CURRENT
                     END IF
                  END IF
                  
                  IF g_argv[1] MATCHES '[24]' OR ((g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') AND cl_null(g_pmds_m.pmds006)) THEN
                     
                     #修改料號時需要開窗詢問是否重新取價，若選擇要時則需呼叫取價應用元件重新取價，
                     #並重新呼叫'計算金額'應用元件計算[C:含稅金額]、[C:未稅金額]、[C:稅額]
                     IF l_cmd = 'u' THEN 
                        IF cl_ask_confirm('axm-00230') THEN                              
                           #取出價格
                           CALL apmt520_get_price()
                          
                           #未稅金額、含稅金額
                           IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                              CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                                RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039            
                           END IF
                           DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
                        END IF
                     ELSE
                        #取出價格
                        CALL apmt520_get_price()
                        #未稅金額、含稅金額
                        IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                           CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                             RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039            
                        END IF
                        DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
                     END IF   
                  END IF
                  #預設沖銷順序
                  LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                              " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                              "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                              "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' "
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                     LET l_sql =  l_sql , " AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                     LET l_sql =  l_sql , " AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) OR g_pmdt_d[l_ac].pmdt017 = ' ' THEN
                     LET l_sql =  l_sql , " AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN
                     LET l_sql =  l_sql , " AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
                  END IF
                  PREPARE pmdt011_pre1 FROM l_sql
                  EXECUTE pmdt011_pre1 INTO g_pmdt_d[l_ac].pmdt011
          
                  IF cl_null(g_pmdt_d[l_ac].pmdt011) OR g_pmdt_d[l_ac].pmdt011 = 0 THEN
                     LET g_pmdt_d[l_ac].pmdt011 = 1
                  END IF
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt011   
               END IF
            END IF               ]]>
  </point>
  <point name="input.a.page1.pmdt008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL apmt520_pmdt008_ref(g_pmdt_d[l_ac].pmdt008) RETURNING g_pmdt_d[l_ac].pmdt008_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008_desc
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt008) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmdt_d[l_ac].pmdt008

               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_imaa001_3") THEN
                  IF cl_chk_exist("v_imaf001_2") THEN
                     
                  ELSE
                     #檢查失敗時後續處理
                     LET g_pmdt_d[l_ac].pmdt008 = g_pmdt_d_t.pmdt008
                     CALL apmt520_pmdt008_ref(g_pmdt_d[l_ac].pmdt008) RETURNING g_pmdt_d[l_ac].pmdt008_desc
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008_desc
                     NEXT FIELD CURRENT
                  END IF
               ELSE
                  LET g_pmdt_d[l_ac].pmdt008 = g_pmdt_d_t.pmdt008
                  CALL apmt520_pmdt008_ref(g_pmdt_d[l_ac].pmdt008) RETURNING g_pmdt_d[l_ac].pmdt008_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008_desc
                  NEXT FIELD CURRENT
               END IF
            END IF ]]>
  </point>
  <point name="input.a.page1.pmdt009" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_acc_desc('221',g_pmdt_d[l_ac].pmdt009) RETURNING g_pmdt_d[l_ac].pmdt009_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt009_desc
               
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt009) THEN
               IF NOT s_azzi650_chk_exist('221',g_pmdt_d[l_ac].pmdt009) THEN
                  LET g_pmdt_d[l_ac].pmdt009 = g_pmdt_d_t.pmdt009
                  CALL s_desc_get_acc_desc('221',g_pmdt_d[l_ac].pmdt009) RETURNING g_pmdt_d[l_ac].pmdt009_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt009_desc
                  NEXT FIELD pmdt009
               END IF
               #收貨單在維護料號時需檢核料件AVL控管點(imaa044)設置，若是設置'2:可採購，不可收貨'時，則要檢核
               #其他收貨、無採購收貨、收貨入庫單等作業也需考慮
               IF g_argv[1] MATCHES '[123489]' OR g_argv[1] = '20' THEN
                  IF NOT s_apmt520_item_avl_chk(g_pmds_m.pmdsdocdt,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmds_m.pmds007) THEN
                     LET g_pmdt_d[l_ac].pmdt009 = g_pmdt_d_t.pmdt009
                     CALL s_desc_get_acc_desc('221',g_pmdt_d[l_ac].pmdt009) RETURNING g_pmdt_d[l_ac].pmdt009_desc
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt009_desc
                     NEXT FIELD pmdt009
                  END IF
               END IF
            END IF               ]]>
  </point>
  <point name="input.a.page1.pmdt010" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt010) THEN
               #收貨單在維護料號時需檢核料件AVL控管點(imaa044)設置，若是設置'2:可採購，不可收貨'時，則要檢核
               #其他收貨、無採購收貨、收貨入庫單等作業也需考慮
               IF g_argv[1] MATCHES '[123489]' OR g_argv[1] = '20' THEN
                  IF NOT s_apmt520_item_avl_chk(g_pmds_m.pmdsdocdt,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmds_m.pmds007) THEN
                     LET g_pmdt_d[l_ac].pmdt010 = g_pmdt_d_t.pmdt010
                     NEXT FIELD pmdt010
                  END IF
               END IF
            END IF                                      ]]>
  </point>
  <point name="input.a.page1.pmdt011" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_ap_chk_range(g_pmdt_d[l_ac].pmdt011,"0","0","","","azz-00079",1) THEN
               LET g_pmdt_d[l_ac].pmdt011 = g_pmdt_d_t.pmdt011
               NEXT FIELD pmdt011
            END IF 
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt011) THEN
               IF g_pmdt_d[l_ac].pmdt011 != g_pmdt_d_t.pmdt011 OR cl_null(g_pmdt_d_t.pmdt011) THEN             
                  LET l_n = 0
                  LET l_sql = " SELECT COUNT(*) FROM pmdt_t ",
                              " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                              "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                              "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' ",
                              "   AND pmdt011 = '",g_pmdt_d[l_ac].pmdt011,"' "
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                     LET l_sql =  l_sql , " AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                     LET l_sql =  l_sql , " AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) OR g_pmdt_d[l_ac].pmdt017 = ' ' THEN
                     LET l_sql =  l_sql , " AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN
                     LET l_sql =  l_sql , " AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
                  END IF
                  PREPARE pmdt011_cn_pre FROM l_sql
                  EXECUTE pmdt011_cn_pre INTO l_n
                  IF l_n > 0 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'apm-00407'
                     LET g_errparam.extend = g_pmdt_d[l_ac].pmdt011
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_pmdt_d[l_ac].pmdt011 = g_pmdt_d_t.pmdt011
                     NEXT FIELD pmdt011
                  END IF
               END IF
            END IF 
]]>
  </point>
  <point name="input.a.page1.pmdt016" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
            
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_site
               LET g_chkparam.arg2 = g_pmdt_d[l_ac].pmdt016

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_inaa001_1") THEN
                  ##倉退時 輸入的料件+產品特徵+庫存管理特徵+庫位必須存在[T:庫存明細檔]中
                  #IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
                  #   IF NOT apmt520_chk_inag004(g_pmdt_d[l_ac].pmdt016) THEN
                  #      LET g_pmdt_d[l_ac].pmdt016 = g_pmdt_d_t.pmdt016
                  #      CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
                  #      DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
                  #      NEXT FIELD pmdt016
                  #   END IF
                  #END IF
                  
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) THEN 
                     IF NOT apmt520_pmdt017_chk() THEN
                         LET g_pmdt_d[l_ac].pmdt017 = ''
                         LET g_pmdt_d[l_ac].pmdt017_desc = ''
                         NEXT FIELD pmdt017
                      END IF
                  END IF
                  
                  #預設沖銷順序
                  LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                              " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                              "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                              "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' ",
                              "   AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                     LET l_sql =  l_sql , " AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) OR g_pmdt_d[l_ac].pmdt017 = ' ' THEN
                     LET l_sql =  l_sql , " AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN
                     LET l_sql =  l_sql , " AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
                  END IF
                  PREPARE pmdt011_pre3 FROM l_sql
                  EXECUTE pmdt011_pre3 INTO g_pmdt_d[l_ac].pmdt011
          
                  IF cl_null(g_pmdt_d[l_ac].pmdt011) OR g_pmdt_d[l_ac].pmdt011 = 0 THEN
                     LET g_pmdt_d[l_ac].pmdt011 = 1
                  END IF
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt011
               ELSE
                  #檢查失敗時後續處理
                  LET g_pmdt_d[l_ac].pmdt016 = g_pmdt_d_t.pmdt016
                  CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)]]>
  </point>
  <point name="input.a.page1.pmdt017" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
            
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) THEN 

               IF apmt520_pmdt017_chk() THEN
                  
                  #預設沖銷順序
                  LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                              " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                              "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                              "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' ",
                              "   AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                     LET l_sql =  l_sql , " AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                     LET l_sql =  l_sql , " AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN
                     LET l_sql =  l_sql , " AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
                  END IF
                  PREPARE pmdt011_pre4 FROM l_sql
                  EXECUTE pmdt011_pre4 INTO g_pmdt_d[l_ac].pmdt011
          
                  IF cl_null(g_pmdt_d[l_ac].pmdt011) OR g_pmdt_d[l_ac].pmdt011 = 0 THEN
                     LET g_pmdt_d[l_ac].pmdt011 = 1
                  END IF
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt011
               ELSE
                  #檢查失敗時後續處理
                  LET g_pmdt_d[l_ac].pmdt017 = g_pmdt_d_t.pmdt017
                  CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
]]>
  </point>
  <point name="input.a.page1.pmdt018" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN 
               
               #倉退時有輸入收貨單來源時，批號僅能輸入該收貨單的入庫批號，不可隨便輸
               LET l_n = 0
               IF g_argv[1] = '7' THEN  #倉退
                  LET l_pmds000 = '6'
               END IF
               IF g_argv[1] = '14' THEN  #委外倉退
                  LET l_pmds000 = '12'
               END IF
               IF g_argv[1] = '15' THEN  #重覆性生產倉退
                 LET l_pmds000 = '13'
               END IF
               
               SELECT COUNT(*) INTO l_n FROM pmds_t,pmdt_t 
                  WHERE pmdsent = pmdtent AND pmdsdocno = pmdtdocno AND pmds006 = g_pmds_m.pmds006 AND pmdt028 = g_pmdt_d[l_ac].pmdt028
                    AND pmds000 = l_pmds000 AND pmdsstus = 'S'
                    
               IF l_n > 0 THEN
                  LET l_n = 0
                  SELECT COUNT(*) INTO l_n FROM pmds_t,pmdt_t,pmdu_t 
                     WHERE pmdsent = pmdtent AND pmdsdocno = pmdtdocno 
                       AND pmdtent = pmduent AND pmdtdocno = pmdudocno AND pmdtseq = pmduseq
                       AND pmds006 = g_pmds_m.pmds006 AND pmdt028 = g_pmdt_d[l_ac].pmdt028
                       AND pmds000 = l_pmds000 AND pmdsstus = 'S' AND pmdu008 = g_pmdt_d[l_ac].pmdt018
                  IF l_n = 0 OR cl_null(l_n) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'apm-00629'
                     LET g_errparam.extend = g_pmdt_d[l_ac].pmdt018
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET g_pmdt_d[l_ac].pmdt018 = g_pmdt_d_t.pmdt018
                     NEXT FIELD pmdt018
                  END IF
               END IF
               
               #若料件要做批號管理且又有做有效期管理時，需要自動計算該批的有效日期
               CALL s_aini010_calculate_effdt(g_site,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt018,g_pmds_m.pmdsdocdt) RETURNING g_pmdt_d[l_ac].pmdt089                  
               DISPLAY BY NAME g_pmdt_d[l_ac].pmdt089
               
               LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                           " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                           "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                           "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' ",
                           "   AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
               IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                  LET l_sql =  l_sql , " AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
               END IF
               IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                  LET l_sql =  l_sql , " AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
               END IF
               IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) THEN
                  LET l_sql =  l_sql , " AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
               END IF
               PREPARE pmdt011_pre5 FROM l_sql
               EXECUTE pmdt011_pre5 INTO g_pmdt_d[l_ac].pmdt011
          
               IF cl_null(g_pmdt_d[l_ac].pmdt011) OR g_pmdt_d[l_ac].pmdt011 = 0 THEN
                  LET g_pmdt_d[l_ac].pmdt011 = 1
               END IF 
               DISPLAY BY NAME g_pmdt_d[l_ac].pmdt011
               
               
            END IF                  ]]>
  </point>
  <point name="input.a.page1.pmdt019" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt019_desc
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
               IF g_pmdt_d[l_ac].pmdt019 <> g_pmdt_d_o.pmdt019 OR cl_null(g_pmdt_d_o.pmdt019) THEN
                  IF NOT apmt520_unit_chk(g_pmdt_d[l_ac].pmdt019) THEN
                     LET g_pmdt_d[l_ac].pmdt019 = g_pmdt_d_t.pmdt019
                     CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt019_desc
                     NEXT FIELD pmdt019
                  END IF
                  
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt020) THEN
                     CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020)
                        RETURNING l_success,g_pmdt_d[l_ac].pmdt020
                             
                     IF (NOT cl_null(g_pmdt_d[l_ac].pmdt021)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) THEN
                        CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                                  RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                        CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022)
                            RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                            
                     ELSE
                        LET g_pmdt_d[l_ac].pmdt022 = ''
                     END IF
                     
                     IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
                        CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                                  RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                        CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                            RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                     ELSE
                        LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                        LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
                     END IF
                  END IF
                  
                  #預設沖銷順序
                  LET l_sql = " SELECT MAX(pmdt011)+1 FROM pmdt_t ",
                              " WHERE pmdtent = '",g_enterprise,"' AND pmdtdocno = '",g_pmds_m.pmdsdocno,"' ",
                              "   AND pmdt006 = '",g_pmdt_d[l_ac].pmdt006,"' ",
                              "   AND pmdt007 = '",g_pmdt_d[l_ac].pmdt007,"' ",
                              "   AND pmdt019 = '",g_pmdt_d[l_ac].pmdt019,"' "
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt016) THEN
                     LET l_sql =  l_sql , " AND pmdt016 = '",g_pmdt_d[l_ac].pmdt016,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt017) OR g_pmdt_d[l_ac].pmdt017 = ' ' THEN
                     LET l_sql =  l_sql , " AND pmdt017 = '",g_pmdt_d[l_ac].pmdt017,"' "
                  END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt018) THEN
                     LET l_sql =  l_sql , " AND pmdt018 = '",g_pmdt_d[l_ac].pmdt018,"' "
                  END IF
                  PREPARE pmdt011_pre2 FROM l_sql
                  EXECUTE pmdt011_pre2 INTO g_pmdt_d[l_ac].pmdt011
                  
                  IF cl_null(g_pmdt_d[l_ac].pmdt011) OR g_pmdt_d[l_ac].pmdt011 = 0 THEN
                     LET g_pmdt_d[l_ac].pmdt011 = 1
                  END IF
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt011
               END IF
               LET g_pmdt_d_o.pmdt019 = g_pmdt_d[l_ac].pmdt019
            END IF
]]>
  </point>
  <point name="input.a.page1.pmdt020" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #倉退單，當倉退方式為'4:'價格折讓'時，數量欄位預設為0
            IF ((g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' ) AND g_pmds_m.pmds100 = '4') OR g_argv[1] = '26' THEN
               IF NOT cl_ap_chk_range(g_pmdt_d[l_ac].pmdt020,"0.000","1","","","azz-00079",1) THEN
                  LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d_t.pmdt020
                  NEXT FIELD pmdt020
               END IF
            ELSE
               IF NOT cl_ap_chk_range(g_pmdt_d[l_ac].pmdt020,"0.000","0","","","azz-00079",1) THEN
                  LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d_t.pmdt020
                  NEXT FIELD pmdt020
               END IF
            END IF
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt020)  THEN 
               IF g_pmdt_d[l_ac].pmdt020 <> g_pmdt_d_o.pmdt020 OR cl_null(g_pmdt_d_o.pmdt020)  THEN
               #採購收貨、採購收貨入庫 時判斷收貨數量
               #IF (NOT cl_null(g_pmdt_d[l_ac].pmdt001)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt002)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt003)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt004)) THEN
                  IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
                     IF NOT s_apmt520_chk_pmdt020(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt002,g_pmdt_d[l_ac].pmdt003,g_pmdt_d[l_ac].pmdt004,'',0,g_pmdt_d[l_ac].pmdt020) THEN
                        LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d_t.pmdt020
                        NEXT FIELD pmdt020
                     END IF
                  END IF
                  IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
                     IF NOT s_apmt520_chk_pmdt020(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt027,g_pmdt_d[l_ac].pmdt028,0,0,'',0,g_pmdt_d[l_ac].pmdt020) THEN
                        LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d_t.pmdt020
                        NEXT FIELD pmdt020
                     END IF
                  END IF 
                  #借貨歸還單時 （借貨還量數量+借貨還價數量）不可大於已入庫量 - （已登打的借貨還量數量+已登打的借貨還價數量）！
                  IF g_argv[1] = '26' THEN
                     IF cl_null(g_pmdt_d[l_ac].pmdt090) THEN
                        LET g_pmdt_d[l_ac].pmdt090 = 0
                     END IF
                     LET l_pmdt020 = g_pmdt_d[l_ac].pmdt020 + g_pmdt_d[l_ac].pmdt090
                     IF NOT s_apmt520_chk_pmdt020(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt027,g_pmdt_d[l_ac].pmdt028,0,0,'',0,l_pmdt020) THEN
                        LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d_t.pmdt020
                        NEXT FIELD pmdt020
                     END IF
                  END IF 
                  IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25' THEN
                     IF NOT s_apmt520_chk_pmdt020(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt027,g_pmdt_d[l_ac].pmdt028,0,0,g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082,g_pmdt_d[l_ac].pmdt020) THEN
                        LET g_pmdt_d[l_ac].pmdt020 = g_pmdt_d_t.pmdt020
                        NEXT FIELD pmdt020
                     END IF
                  END IF                  
                  
               #END IF
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                     CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020)
                        RETURNING l_success,g_pmdt_d[l_ac].pmdt020
                             
                     IF (NOT cl_null(g_pmdt_d[l_ac].pmdt021)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) THEN
                        CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                                  RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                        CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022)
                            RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                            
                     ELSE
                        LET g_pmdt_d[l_ac].pmdt022 = ''
                     END IF
                     
                     IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN
                        CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                                  RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                        CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                            RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                     ELSE
                        LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                        LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
                     END IF
                  END IF
               
                  #未稅金額、含稅金額
                  IF g_argv[1] MATCHES '[24]' OR ((g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') AND cl_null(g_pmds_m.pmds006)) THEN
                     CALL apmt520_get_price()
                  END IF
                  
                  IF (NOT cl_null(g_pmdt_d[l_ac].pmdt036)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                     CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                       RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
                  END IF
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
                  
                  IF g_pmdt_d[l_ac].pmdt062 = 'Y' THEN
                     IF NOT apmt520_03('1',g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt021) THEN
                        LET g_pmdt_d[l_ac].pmdt062 = g_pmdt_d_o.pmdt062
                        NEXT FIELD pmdt062
                     END IF
                  END IF
               END IF   
               LET g_pmdt_d_o.pmdt020 = g_pmdt_d[l_ac].pmdt020   
            END IF 
]]>
  </point>
  <point name="input.a.page1.pmdt021" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt021_desc
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt021) THEN
               IF NOT apmt520_unit_chk(g_pmdt_d[l_ac].pmdt021) THEN
                  LET g_pmdt_d[l_ac].pmdt021 = g_pmdt_d_t.pmdt021
                  CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt021_desc
                  NEXT FIELD pmdt019
               END IF
               IF (NOT cl_null(g_pmdt_d[l_ac].pmdt019)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) THEN
                  CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                            RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                  CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022)
                      RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                      
               ELSE
                  LET g_pmdt_d[l_ac].pmdt022 = ''
               END IF
               
            END IF]]>
  </point>
  <point name="input.a.page1.pmdt022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt023" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt023_desc
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt023) THEN
               IF NOT apmt520_unit_chk(g_pmdt_d[l_ac].pmdt023) THEN
                  LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d_t.pmdt023
                  CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt023_desc
                  NEXT FIELD pmdt023
               END IF
               
               IF (NOT cl_null(g_pmdt_d[l_ac].pmdt019)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) THEN
                  CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                            RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                  CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                      RETURNING l_success,g_pmdt_d[l_ac].pmdt024
               ELSE
                  LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                  LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
               END IF
               
            END IF]]>
  </point>
  <point name="input.a.page1.pmdt024" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt024)) THEN
               IF g_pmdt_d[l_ac].pmdt024 <> g_pmdt_d_t.pmdt024 OR cl_null(g_pmdt_d_t.pmdt024) THEN
                  CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024)
                     RETURNING l_success,g_pmdt_d[l_ac].pmdt024   
                 
                  IF g_argv[1] MATCHES '[24]' OR ((g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') AND cl_null(g_pmds_m.pmds006)) THEN
                     #取出價格
                     CALL apmt520_get_price()
                  END IF
                  
                  #未稅金額、含稅金額
                  IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                     CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                       RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039            
                  END IF
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
               END IF   
            END IF                      ]]>
  </point>
  <point name="input.a.page1.pmdt025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt028" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt028)  THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmdt_d[l_ac].pmdt028 != g_pmdt_d_o.pmdt028 OR cl_null(g_pmdt_d_o.pmdt028))) THEN 
                  IF NOT apmt520_pmdt028_chk() THEN
                     LET g_pmdt_d[l_ac].pmdt028 = g_pmdt_d_o.pmdt028
                     NEXT FIELD pmdt028
                  END IF
                  
                  #入庫、驗退對應的收貨項次存在多筆QC單資料時，自動新增QC資料
                  LET l_n = 0 
                  SELECT COUNT(*) INTO l_n FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
                  IF l_cmd = 'a' AND l_n = 0 THEN
                     IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN 
                        LET l_n = 0 
                        IF g_argv[1] MATCHES '[5]' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN 
                           SELECT COUNT(qcbcseq) INTO l_n FROM qcbc_t,qcba_t 
                              WHERE qcbcent = g_enterprise AND qcbcent  = qcbaent
                                AND qcbcsite  = g_site AND qcbcsite = qcbasite
                                AND qcbcdocno = qcbadocno 
                                AND qcba001   = g_pmds_m.pmds006
                                AND qcba002   = g_pmdt_d[l_ac].pmdt028
                                AND qcbastus  = 'Y' AND qcbc012 = '4'
                        END IF
                        IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' THEN 
                           SELECT COUNT(qcbcseq) INTO l_n FROM qcbc_t,qcba_t 
                              WHERE qcbcent = g_enterprise AND qcbcent  = qcbaent
                                AND qcbcsite  = g_site AND qcbcsite = qcbasite
                                AND qcbcdocno = qcbadocno 
                                AND qcba001   = g_pmds_m.pmds006
                                AND qcba002   = g_pmdt_d[l_ac].pmdt028
                                AND qcbastus  = 'Y' AND qcbc012 <> '4'
                        END IF
                        IF l_n > 1 THEN
                           IF NOT cl_null(g_pmds_m.pmds006) THEN
                              IF g_argv[1] MATCHES '[5]' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN 
                                 CALL s_apmt520_gen_pmdt('2',g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdt028,'1') RETURNING l_success
                              END IF
                              IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' THEN 
                                 CALL s_apmt520_gen_pmdt('1',g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdt028,'1') RETURNING l_success
                              END IF
                              #CALL apmt520_b_fill()
                              #LET g_rec_b = g_pmdt_d.getLength()
                              #IF g_rec_b > 0 THEN
                              IF l_success THEN
                                 CALL s_transaction_end('Y','0')
                                 LET g_flag2 = TRUE
                                 EXIT DIALOG
                              ELSE
                                 CALL s_transaction_end('N','0')
                                 LET g_flag2 = FALSE
                                 NEXT FIELD pmdt028
                              END IF
                           END IF
                        END IF
                     END IF
                  END IF
                  CALL apmt520_pmdt028_desc()
               END IF
            END IF
            
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)
            LET g_pmdt_d_o.pmdt028 = g_pmdt_d[l_ac].pmdt028]]>
  </point>
  <point name="input.a.page1.pmdt036" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt036) THEN
               #未稅金額、含稅金額
               IF (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                  CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                    RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039            
               END IF
            END IF 
            
            #價差比
            IF g_pmdt_d[l_ac].pmdt044 > 0 THEN 
               LET g_pmdt_d[l_ac].pmdt045 = (g_pmdt_d[l_ac].pmdt044 - g_pmdt_d[l_ac].pmdt036) / g_pmdt_d[l_ac].pmdt044
            END IF
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039,g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt045
]]>
  </point>
  <point name="input.a.page1.pmdt037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt046" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL apmt520_pmds033_ref(g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046_desc
            
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt046) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_site
               LET g_chkparam.arg2 = g_pmdt_d[l_ac].pmdt046
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oodb002") THEN
                  #檢查成功時後續處理
                  
               ELSE
                  #檢查失敗時後續處理
                  LET g_pmdt_d[l_ac].pmdt046 = g_pmdt_d_t.pmdt046
                  CALL apmt520_pmds033_ref(g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046_desc
                  NEXT FIELD CURRENT
               END IF
               
               #未稅金額、含稅金額
               IF (NOT cl_null(g_pmdt_d[l_ac].pmdt036)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt020)) THEN
                  CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                    RETURNING g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt039
               END IF
            END IF 
]]>
  </point>
  <point name="input.a.page1.pmdt051" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_acc_desc(g_acc,g_pmdt_d[l_ac].pmdt051) RETURNING g_pmdt_d[l_ac].pmdt051_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt051_desc
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt051) THEN
               IF NOT apmt520_pmdt051_chk(g_pmdt_d[l_ac].pmdt051) THEN
                  LET g_pmdt_d[l_ac].pmdt051 = g_pmdt_d_t.pmdt051               
                  CALL s_desc_get_acc_desc(g_acc,g_pmdt_d[l_ac].pmdt051) RETURNING g_pmdt_d[l_ac].pmdt051_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt051_desc
                  NEXT FIELD pmdt051
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.pmdt053" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt054" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page1.pmdt062" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF g_pmdt_d[l_ac].pmdt062 != g_pmdt_d_o.pmdt062 OR cl_null(g_pmdt_d_o.pmdt062) THEN
               IF g_pmdt_d[l_ac].pmdt062 = 'Y' THEN
                  IF NOT apmt520_03('1',g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt021) THEN
                     LET g_pmdt_d[l_ac].pmdt062 = g_pmdt_d_o.pmdt062
                     NEXT FIELD pmdt062
                  END IF
               END IF
            END IF
            
            CALL apmt520_set_entry_b(l_cmd)
            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
            CALL apmt520_set_no_entry_b(l_cmd)
            
            LET g_pmdt_d_o.pmdt062 = g_pmdt_d[l_ac].pmdt062]]>
  </point>
  <point name="input.a.page1.pmdt072" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_project_desc(g_pmdt_d[l_ac].pmdt072) RETURNING g_pmdt_d[l_ac].pmdt072_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt072_desc
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt072) THEN 
#應用 a17 樣板自動產生(Version:2)
               IF g_pmdt_d[l_ac].pmdt072 != g_pmdt_d_o.pmdt072 OR cl_null(g_pmdt_d_o.pmdt072) THEN
                  #欄位存在檢查
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_pmdt_d[l_ac].pmdt072
                  
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_pjba001") THEN
                     #檢查失敗時後續處理
                     LET g_pmdt_d[l_ac].pmdt072 = g_pmdt_d_o.pmdt072
                     CALL s_desc_get_project_desc(g_pmdt_d[l_ac].pmdt072) RETURNING g_pmdt_d[l_ac].pmdt072_desc
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt072_desc
                     NEXT FIELD CURRENT
                  END IF
                  LET g_pmdt_d[l_ac].pmdt073 = ''
                  LET g_pmdt_d[l_ac].pmdt073_desc = ''
                  LET g_pmdt_d[l_ac].pmdt074 = ''
                  LET g_pmdt_d[l_ac].pmdt074_desc = ''
               END IF

            END IF 

]]>
  </point>
  <point name="input.a.page1.pmdt073" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_wbs_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073) RETURNING g_pmdt_d[l_ac].pmdt073_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt073_desc
            IF NOT cl_null(g_pmdt_d[l_ac].pmdt073) THEN 
#應用 a17 樣板自動產生(Version:2)
               #欄位存在檢查
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmdt_d[l_ac].pmdt072
               LET g_chkparam.arg2 = g_pmdt_d[l_ac].pmdt073
                  
               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_pjbb002") THEN
                  #檢查失敗時後續處理
                  LET g_pmdt_d[l_ac].pmdt073 = g_pmdt_d_t.pmdt073
                  CALL s_desc_get_wbs_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073) RETURNING g_pmdt_d[l_ac].pmdt073_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt073_desc
                  NEXT FIELD CURRENT
               END IF

            END IF 

]]>
  </point>
  <point name="input.a.page1.pmdt074" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_activity_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt074) RETURNING g_pmdt_d[l_ac].pmdt074_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt074_desc

            IF NOT cl_null(g_pmdt_d[l_ac].pmdt074) THEN 
#應用 a17 樣板自動產生(Version:2)
               #欄位存在檢查
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmdt_d[l_ac].pmdt072
               LET g_chkparam.arg2 = g_pmdt_d[l_ac].pmdt074
                  
               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_pjbm002") THEN
                  #檢查失敗時後續處理
                  LET g_pmdt_d[l_ac].pmdt074 = g_pmdt_d_t.pmdt074
                  CALL s_desc_get_activity_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt074) RETURNING g_pmdt_d[l_ac].pmdt074_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt074_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 

]]>
  </point>
  <point name="input.a.page1.pmdt081" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt081) THEN
               IF g_pmdt_d[l_ac].pmdt081 != g_pmdt_d_o.pmdt081 OR cl_null(g_pmdt_d_o.pmdt081) THEN 
                  IF NOT apmt520_pmdt081_chk(g_pmdt_d[l_ac].pmdt081) THEN
                     LET g_pmdt_d[l_ac].pmdt081 = g_pmdt_d_t.pmdt081
                     NEXT FIELD pmdt081
                  END IF
                  
                  IF NOT cl_null(g_pmdt_d[l_ac].pmdt082) THEN
                     IF NOT apmt520_pmdt082_chk(g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082) THEN
                        LET g_pmdt_d[l_ac].pmdt082 = g_pmdt_d_t.pmdt082
                        NEXT FIELD pmdt082
                     END IF
                  END IF
               END IF
            END IF
            
            LET g_pmdt_d_o.pmdt081 = g_pmdt_d[l_ac].pmdt081 
               ]]>
  </point>
  <point name="input.a.page1.pmdt082" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmdt_d[l_ac].pmdt082) THEN
               IF g_pmdt_d[l_ac].pmdt082 != g_pmdt_d_o.pmdt082 OR cl_null(g_pmdt_d_o.pmdt082) THEN 
                  IF NOT apmt520_pmdt082_chk(g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082) THEN
                     LET g_pmdt_d[l_ac].pmdt082 = g_pmdt_d_t.pmdt082
                     NEXT FIELD pmdt082
                  END IF
                  
                  CALL apmt520_pmdt082_desc()
                  
               END IF
            END IF
            LET g_pmdt_d_o.pmdt082 = g_pmdt_d[l_ac].pmdt082]]>
  </point>
  <point name="input.a.page1.pmdt083" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.a.page1.pmdt090" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF g_argv[1] = '26' THEN
               IF NOT cl_ap_chk_range(g_pmdt_d[l_ac].pmdt090,"0.000","1","","","azz-00079",1) THEN
                  LET g_pmdt_d[l_ac].pmdt090 = g_pmdt_d_t.pmdt090
                  NEXT FIELD pmdt090
               END IF
            
               IF NOT cl_null(g_pmdt_d[l_ac].pmdt090)  THEN 
                  IF g_pmdt_d[l_ac].pmdt090 <> g_pmdt_d_o.pmdt090 OR cl_null(g_pmdt_d_o.pmdt090)  THEN
                     #借貨歸還單時 （借貨還量數量+借貨還價數量）不可大於已入庫量 - （已登打的借貨還量數量+已登打的借貨還價數量）！
                     IF g_argv[1] = '26' THEN
                        IF cl_null(g_pmdt_d[l_ac].pmdt020) THEN
                           LET g_pmdt_d[l_ac].pmdt020 = 0
                        END IF
                        LET l_pmdt020 = g_pmdt_d[l_ac].pmdt020 + g_pmdt_d[l_ac].pmdt090
                        IF NOT s_apmt520_chk_pmdt020(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt027,g_pmdt_d[l_ac].pmdt028,0,0,'',0,l_pmdt020) THEN
                           LET g_pmdt_d[l_ac].pmdt090 = g_pmdt_d_t.pmdt090
                           NEXT FIELD pmdt090
                        END IF
                     END IF 
                     
                     IF NOT cl_null(g_pmdt_d[l_ac].pmdt019) THEN
                        CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt090)
                           RETURNING l_success,g_pmdt_d[l_ac].pmdt090
                                
                        IF (NOT cl_null(g_pmdt_d[l_ac].pmdt021)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) THEN
                           CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt090)
                                     RETURNING l_success,g_pmdt_d[l_ac].pmdt091
                           CALL s_aooi250_take_decimals(g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt091)
                               RETURNING l_success,g_pmdt_d[l_ac].pmdt091
                               
                        ELSE
                           LET g_pmdt_d[l_ac].pmdt091 = ''
                        END IF
                     END IF
               
                     IF (NOT cl_null(g_pmdt_d[l_ac].pmdt036)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt046)) THEN
                        CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt090,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046)
                          RETURNING g_pmdt_d[l_ac].pmdt092,l_pmdt039,g_pmdt_d[l_ac].pmdt093
                     END IF
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt092,g_pmdt_d[l_ac].pmdt093
                     
                  END IF   
                  LET g_pmdt_d_o.pmdt090 = g_pmdt_d[l_ac].pmdt090  
               END IF                  
            END IF ]]>
  </point>
  <point name="input.a.page1.pmdtseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a05產生
            IF  g_pmds_m.pmdsdocno IS NOT NULL AND g_pmdt_d[l_ac].pmdtseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmds_m.pmdsdocno != g_pmdsdocno_t OR g_pmdt_d[l_ac].pmdtseq != g_pmdt_d_t.pmdtseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM pmdt_t WHERE "||"pmdtent = '" ||g_enterprise|| "' AND "||"pmdtdocno = '"||g_pmds_m.pmdsdocno ||"' AND "|| "pmdtseq = '"||g_pmdt_d[l_ac].pmdtseq ||"'",'std-00004',0) THEN 
                     LET g_pmdt_d[l_ac].pmdtseq = g_pmdt_d_t.pmdtseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.pmdtsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_pmdt2_d[l_ac].pmdu001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_pmdt2_d[l_ac].pmdu001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu001_desc
]]>
  </point>
  <point name="input.a.page2.pmdu002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page2.pmdu006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_pmdt2_d[l_ac].pmdu005
            LET g_ref_fields[2] = g_pmdt2_d[l_ac].pmdu006
            CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
            LET g_pmdt2_d[l_ac].pmdu006_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu006_desc
]]>
  </point>
  <point name="input.a.page2.pmdu007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_pmdt2_d[l_ac].pmdu008
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_pmdt2_d[l_ac].pmdu008_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu008_desc
]]>
  </point>
  <point name="input.a.page2.pmdu009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_pmdt2_d[l_ac].pmdu010
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_pmdt2_d[l_ac].pmdu010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu010_desc
]]>
  </point>
  <point name="input.a.page2.pmdu011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmdu016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page2.pmduseq" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  g_pmds_m.pmdsdocno IS NOT NULL AND g_pmdt2_d[g_detail_idx].pmduseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmds_m.pmdsdocno != g_pmdsdocno_t OR g_pmdt2_d[g_detail_idx].pmduseq != g_pmdt2_d_t.pmduseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM pmdu_t WHERE "||"pmduent = '" ||g_enterprise|| "' AND "||"pmdudocno = '"||g_pmds_m.pmdsdocno ||"' AND "|| "pmduseq = '"||g_pmdt2_d[g_detail_idx].pmduseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page2.pmduseq1" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  g_pmds_m.pmdsdocno IS NOT NULL AND g_pmdt2_d[g_detail_idx].pmduseq IS NOT NULL AND g_pmdt2_d[g_detail_idx].pmduseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmds_m.pmdsdocno != g_pmdsdocno_t OR g_pmdt2_d[g_detail_idx].pmduseq != g_pmdt2_d_t.pmduseq OR g_pmdt2_d[g_detail_idx].pmduseq1 != g_pmdt2_d_t.pmduseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM pmdu_t WHERE "||"pmduent = '" ||g_enterprise|| "' AND "||"pmdudocno = '"||g_pmds_m.pmdsdocno ||"' AND "|| "pmduseq = '"||g_pmdt2_d[g_detail_idx].pmduseq ||"' AND "|| "pmduseq1 = '"||g_pmdt2_d[g_detail_idx].pmduseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page2.pmdusite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_pmdt3_d[l_ac].pmdv001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_pmdt3_d[l_ac].pmdv001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_pmdt3_d[l_ac].pmdv001_desc
]]>
  </point>
  <point name="input.a.page3.pmdv002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdv018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_pmdt3_d[l_ac].pmdv018
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_pmdt3_d[l_ac].pmdv018_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_pmdt3_d[l_ac].pmdv018_desc
]]>
  </point>
  <point name="input.a.page3.pmdv019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.page3.pmdvseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a05產生
            IF  g_pmds_m.pmdsdocno IS NOT NULL AND g_pmdt3_d[g_detail_idx].pmdvseq IS NOT NULL AND g_pmdt3_d[g_detail_idx].pmdvseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmds_m.pmdsdocno != g_pmdsdocno_t OR g_pmdt3_d[g_detail_idx].pmdvseq != g_pmdt3_d_t.pmdvseq OR g_pmdt3_d[g_detail_idx].pmdvseq1 != g_pmdt3_d_t.pmdvseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM pmdv_t WHERE "||"pmdvent = '" ||g_enterprise|| "' AND "||"pmdvdocno = '"||g_pmds_m.pmdsdocno ||"' AND "|| "pmdvseq = '"||g_pmdt3_d[g_detail_idx].pmdvseq ||"' AND "|| "pmdvseq1 = '"||g_pmdt3_d[g_detail_idx].pmdvseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page3.pmdvseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a05產生
            IF  g_pmds_m.pmdsdocno IS NOT NULL AND g_pmdt3_d[g_detail_idx].pmdvseq IS NOT NULL AND g_pmdt3_d[g_detail_idx].pmdvseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_pmds_m.pmdsdocno != g_pmdsdocno_t OR g_pmdt3_d[g_detail_idx].pmdvseq != g_pmdt3_d_t.pmdvseq OR g_pmdt3_d[g_detail_idx].pmdvseq1 != g_pmdt3_d_t.pmdvseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM pmdv_t WHERE "||"pmdvent = '" ||g_enterprise|| "' AND "||"pmdvdocno = '"||g_pmds_m.pmdsdocno ||"' AND "|| "pmdvseq = '"||g_pmdt3_d[g_detail_idx].pmdvseq ||"' AND "|| "pmdvseq1 = '"||g_pmdt3_d[g_detail_idx].pmdvseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page3.pmdvsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds000" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds002" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_person_desc(g_pmds_m.pmds002) RETURNING g_pmds_m.pmds002_desc
            DISPLAY BY NAME g_pmds_m.pmds002_desc
            
            IF NOT cl_null(g_pmds_m.pmds002) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_pmds_m.pmds002 != g_pmds_m_t.pmds002 OR cl_null(g_pmds_m_t.pmds002))) THEN
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_pmds_m.pmds002
			      
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_ooag001") THEN
                     #檢查成功時後續處理
                     SELECT ooag003 INTO g_pmds_m.pmds003 FROM ooag_t WHERE ooagent = g_enterprise AND ooag001 = g_pmds_m.pmds002
			            CALL s_desc_get_department_desc(g_pmds_m.pmds003) RETURNING g_pmds_m.pmds003_desc
                     DISPLAY BY NAME g_pmds_m.pmds003_desc
                  ELSE
                     #檢查失敗時後續處理
                     LET g_pmds_m.pmds002 = g_pmds_m_t.pmds002
                     CALL s_desc_get_person_desc(g_pmds_m.pmds002) RETURNING g_pmds_m.pmds002_desc
                     DISPLAY BY NAME g_pmds_m.pmds002_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF 
            ]]>
  </point>
  <point name="input.a.pmds003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_department_desc(g_pmds_m.pmds003) RETURNING g_pmds_m.pmds003_desc
            DISPLAY BY NAME g_pmds_m.pmds003_desc
            
            IF NOT cl_null(g_pmds_m.pmds003) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmds_m.pmds003
               LET g_chkparam.arg2 = g_pmds_m.pmdsdocdt

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooeg001") THEN
                  #檢查成功時後續處理
                  
               ELSE
                  #檢查失敗時後續處理
                  LET g_pmds_m.pmds003 = g_pmds_m_t.pmds003
                  CALL s_desc_get_department_desc(g_pmds_m.pmds003) RETURNING g_pmds_m.pmds003_desc
                  DISPLAY BY NAME g_pmds_m.pmds003_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
          ]]>
  </point>
  <point name="input.a.pmds006" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmds_m.pmds006) THEN 
               IF g_pmds_m.pmds006 != g_pmds_m_o.pmds006 OR cl_null(g_pmds_m_o.pmds006) THEN
                  IF NOT apmt520_pmds006_chk(g_pmds_m.pmds006) THEN
                     LET g_pmds_m.pmds006 = g_pmds_m_o.pmds006
                     NEXT FIELD CURRENT
                  END IF
                  #根據採購單單號帶值
                  CALL apmt520_pmds006_desc()
               END IF
            
            #150611 earl add s
            ELSE
               LET g_pmds_m.pmds041 = ''  #多角流程序號清空
               LET g_pmds_m_o.pmds041 = g_pmds_m.pmds041
               DISPLAY BY NAME g_pmds_m.pmds041
            #150611 earl add e
            END IF
            LET g_pmds_m_o.pmds006 = g_pmds_m.pmds006
            CALL apmt520_set_entry(p_cmd)
            CALL apmt520_set_no_required()
            CALL apmt520_set_required()               
            CALL apmt520_set_no_entry(p_cmd)            ]]>
  </point>
  <point name="input.a.pmds007" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL apmt520_pmds007_ref(g_pmds_m.pmds007) RETURNING g_pmds_m.pmds007_desc
            DISPLAY BY NAME g_pmds_m.pmds007_desc
            
            IF NOT cl_null(g_pmds_m.pmds007) THEN
               IF g_pmds_m.pmds007 != g_pmds_m_o.pmds007 OR cl_null(g_pmds_m_o.pmds007) THEN
                  IF NOT apmt520_pmds007_chk(g_pmds_m.pmds007) THEN
                     LET g_pmds_m.pmds007 = g_pmds_m_t.pmds007
                     CALL apmt520_pmds007_ref(g_pmds_m.pmds007) RETURNING g_pmds_m.pmds007_desc
                     DISPLAY BY NAME g_pmds_m.pmds007_desc
                     NEXT FIELD CURRENT
                  END IF
                     
                  #如果供應商有修改，根據供應商帶值
                  CALL apmt520_pmds007_desc()
               END IF
            END IF
            LET g_pmds_m_o.pmds007 = g_pmds_m.pmds007]]>
  </point>
  <point name="input.a.pmds008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL apmt520_pmds007_ref(g_pmds_m.pmds008) RETURNING g_pmds_m.pmds008_desc
            DISPLAY BY NAME g_pmds_m.pmds008_desc 
            
            IF NOT cl_null(g_pmds_m.pmds008) AND (g_pmds_m.pmds008 != g_pmds_m.pmds007) THEN 
               IF NOT apmt520_pmds008_chk() THEN
                  LET g_pmds_m.pmds008 = g_pmds_m_t.pmds008
                  CALL apmt520_pmds007_ref(g_pmds_m.pmds008) RETURNING g_pmds_m.pmds008_desc
                  DISPLAY BY NAME g_pmds_m.pmds008_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
]]>
  </point>
  <point name="input.a.pmds009" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
            DISPLAY BY NAME g_pmds_m.pmds009_desc 
            
            IF NOT cl_null(g_pmds_m.pmds009) AND (g_pmds_m.pmds009 != g_pmds_m.pmds007) THEN 
               IF NOT apmt520_pmds009_chk() THEN
                  LET g_pmds_m.pmds009 = g_pmds_m_t.pmds009
                  CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
                  DISPLAY BY NAME g_pmds_m.pmds009_desc
                  NEXT FIELD CURRENT
               END IF
               
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmds_m.pmds007
               LET g_chkparam.arg2 = g_pmds_m.pmds009
               LET g_chkparam.arg3 = g_site
           
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmac002_2") THEN
                  #檢查成功時後續處理

               ELSE
                  #檢查失敗時後續處理
                  LET g_pmds_m.pmds009 = g_pmds_m_t.pmds009
                  CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
                  DISPLAY BY NAME g_pmds_m.pmds009_desc 
                  NEXT FIELD CURRENT
               END IF
            END IF 
]]>
  </point>
  <point name="input.a.pmds010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds012" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_acc_desc('275',g_pmds_m.pmds012) RETURNING g_pmds_m.pmds012_desc
            DISPLAY BY NAME g_pmds_m.pmds012_desc
            IF NOT cl_null(g_pmds_m.pmds012) THEN
               IF NOT s_azzi650_chk_exist('275',g_pmds_m.pmds012) THEN
                  LET g_pmds_m.pmds012 = g_pmds_m_t.pmds012
                  CALL s_desc_get_acc_desc('275',g_pmds_m.pmds012) RETURNING g_pmds_m.pmds012_desc
                  DISPLAY BY NAME g_pmds_m.pmds012_desc
                  NEXT FIELD pmds012
               END IF
             END IF
             DISPLAY BY NAME g_pmds_m.pmds012_desc
]]>
  </point>
  <point name="input.a.pmds013" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[           CALL s_desc_get_acc_desc('275',g_pmds_m.pmds013) RETURNING g_pmds_m.pmds013_desc
           DISPLAY BY NAME g_pmds_m.pmds013_desc
           IF NOT cl_null(g_pmds_m.pmds013) THEN
              IF NOT s_azzi650_chk_exist('275',g_pmds_m.pmds013) THEN
                 LET g_pmds_m.pmds013 = g_pmds_m_t.pmds013
                 CALL s_desc_get_acc_desc('275',g_pmds_m.pmds013) RETURNING g_pmds_m.pmds013_desc
                 DISPLAY BY NAME g_pmds_m.pmds013_desc
                 NEXT FIELD pmds013
              END IF
            END IF
            DISPLAY BY NAME g_pmds_m.pmds013_desc

]]>
  </point>
  <point name="input.a.pmds014" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmds_m.pmds014) THEN
               IF g_pmds_m.pmds014 <> g_pmds_m_o.pmds014 OR cl_null(g_pmds_m_o.pmds014) THEN
                  IF NOT apmt520_pmds014_pmds053_chk(g_pmds_m.pmds014,g_pmds_m.pmds053) THEN
                     LET g_pmds_m.pmds014 = g_pmds_m_o.pmds014
                  
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            
            LET g_pmds_m_o.pmds014 = g_pmds_m.pmds014
            
            CALL apmt520_set_entry(p_cmd)
            CALL apmt520_set_no_required()
            CALL apmt520_set_required()
            CALL apmt520_set_no_entry(p_cmd)]]>
  </point>
  <point name="input.a.pmds021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds031" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_ooib002_desc(g_pmds_m.pmds031) RETURNING g_pmds_m.pmds031_desc
            DISPLAY BY NAME g_pmds_m.pmds031_desc
            
            IF NOT cl_null(g_pmds_m.pmds031) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmds_m.pmds007
               LET g_chkparam.arg2 = g_pmds_m.pmds031

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmad002_1") THEN
                  #檢查成功時後續處理
                 
               ELSE
                  #檢查失敗時後續處理
                  LET g_pmds_m.pmds031 = g_pmds_m_t.pmds031
                  CALL s_desc_get_ooib002_desc(g_pmds_m.pmds031) RETURNING g_pmds_m.pmds031_desc
                  DISPLAY BY NAME g_pmds_m.pmds031_desc
                  NEXT FIELD CURRENT
               END IF
            END IF ]]>
  </point>
  <point name="input.a.pmds032" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_acc_desc('238',g_pmds_m.pmds032) RETURNING g_pmds_m.pmds032_desc
            DISPLAY BY NAME g_pmds_m.pmds032_desc
            IF NOT cl_null(g_pmds_m.pmds031) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmds_m.pmds032
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_238") THEN
                  #檢查成功時後續處理F
               ELSE
                  #檢查失敗時後續處理
                  LET g_pmds_m.pmds032 = g_pmds_m_t.pmds032
                  CALL s_desc_get_acc_desc('238',g_pmds_m.pmds032) RETURNING g_pmds_m.pmds032_desc
                  DISPLAY BY NAME g_pmds_m.pmds032_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
]]>
  </point>
  <point name="input.a.pmds033" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL apmt520_pmds033_ref(g_pmds_m.pmds033) RETURNING g_pmds_m.pmds033_desc
            DISPLAY BY NAME g_pmds_m.pmds033_desc
            IF NOT cl_null(g_pmds_m.pmds033) THEN
               CALL s_tax_chk(g_site,g_pmds_m.pmds033)
                     RETURNING l_success,g_pmds_m.pmds033_desc,g_pmds_m.pmds035,g_pmds_m.pmds034,l_oodb011
                  
               IF NOT l_success THEN
                  LET g_pmds_m.pmds033 = g_pmds_m_t.pmds033
                  LET g_pmds_m.pmds034 = g_pmds_m_t.pmds034
                  LET g_pmds_m.pmds035 = g_pmds_m_t.pmds035
                  NEXT FIELD CURRENT
               ELSE                    
                  LET g_tax_app = l_oodb011  
               END IF
               DISPLAY BY NAME g_pmds_m.pmds035,g_pmds_m.pmds034
            END IF
]]>
  </point>
  <point name="input.a.pmds034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds037" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_currency_desc(g_pmds_m.pmds037) RETURNING g_pmds_m.pmds037_desc
            DISPLAY BY NAME g_pmds_m.pmds037_desc
            IF NOT cl_null(g_pmds_m.pmds037) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_site
               LET g_chkparam.arg2 = g_pmds_m.pmds037

               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooaj002") THEN
                  #檢查成功時後續處理
                  LET l_ooef016 = ''
                  SELECT ooef016 INTO l_ooef016 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
                  #根據內外購獲取當前營運據點參數設置的汇率类型
                  LET l_scc40 = ''
                  IF g_pmds_m.pmds048 = '1' THEN   #內購
                     LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0014')
                  END IF
                  IF g_pmds_m.pmds048 = '2' THEN   #外購
                     LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0015')
                  END IF
                  IF (NOT cl_null(l_scc40)) AND (NOT cl_null(l_ooef016)) THEN
                     CALL s_aooi160_get_exrate('1',g_site,g_today,g_pmds_m.pmds037,l_ooef016,0,l_scc40) RETURNING g_pmds_m.pmds038
                  END IF
                  DISPLAY BY NAME g_pmds_m.pmds038
               ELSE
                  #檢查失敗時後續處理
                  LET g_pmds_m.pmds037 = g_pmds_m_t.pmds037
                  CALL s_desc_get_currency_desc(g_pmds_m.pmds037) RETURNING g_pmds_m.pmds037_desc
                  DISPLAY BY NAME g_pmds_m.pmds037_desc
                 
                  NEXT FIELD CURRENT
               END IF
            END IF
]]>
  </point>
  <point name="input.a.pmds038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds039" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_price_type_desc(g_pmds_m.pmds039) RETURNING g_pmds_m.pmds039_desc
            DISPLAY BY NAME g_pmds_m.pmds039_desc
            
            IF NOT cl_null(g_pmds_m.pmds039) THEN 
               IF g_pmds_m.pmds039 != g_pmds_m_o.pmds039 OR cl_null(g_pmds_m_o.pmds039) THEN            
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_pmds_m.pmds039
                     
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_pmam001") THEN
                     #檢查成功時後續處理
                     #重新抓取價格是否允許修改,修改容差率,價格超過容差率的處理方式,允許單價為0
                     LET g_pmam003 = ''
                     LET g_pmam006 = ''
                     LET g_pmam002 = ''
                     SELECT pmam003,pmam006,pmam002
                       INTO g_pmam003,g_pmam006,g_pmam002
                       FROM pmam_t       
                      WHERE pmament = g_enterprise
                        AND pmam001 = g_pmds_m.pmds039
                   
                  ELSE
                     #檢查失敗時後續處理
                     LET g_pmds_m.pmds039 = g_pmds_m_t.pmds039
                     CALL s_desc_get_price_type_desc(g_pmds_m.pmds039) RETURNING g_pmds_m.pmds039_desc
                     DISPLAY BY NAME g_pmds_m.pmds039_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF 
            
            LET g_pmds_m_o.pmds039 = g_pmds_m.pmds039
            
            CALL apmt520_set_entry(p_cmd)
            CALL apmt520_set_no_required()
            CALL apmt520_set_required()
            CALL apmt520_set_no_entry(p_cmd)

]]>
  </point>
  <point name="input.a.pmds040" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_ooid001_desc(g_pmds_m.pmds040) RETURNING g_pmds_m.pmds040_desc
            DISPLAY BY NAME g_pmds_m.pmds040_desc
            
            IF NOT cl_null(g_pmds_m.pmds040) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_pmds_m.pmds040
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooid001") THEN
                  #檢查成功時後續處理

               ELSE
                  #檢查失敗時後續處理
                  LET g_pmds_m.pmds040 = g_pmds_m_t.pmds040
                  CALL s_desc_ooid001_desc(g_pmds_m.pmds040) RETURNING g_pmds_m.pmds040_desc
                  DISPLAY BY NAME g_pmds_m.pmds040_desc
                  NEXT FIELD CURRENT
               END IF   
            END IF 
]]>
  </point>
  <point name="input.a.pmds041" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            
            IF NOT cl_null(g_pmds_m.pmds041) THEN 
               IF g_pmds_m.pmds041 <> g_pmds_m_o.pmds041 OR cl_null(g_pmds_m_o.pmds041) THEN

                  #中斷續拋
                  IF apmt520_break_continue(g_pmds_m.pmds053) THEN
                     #多角序號檢查
                     IF NOT cl_null(g_pmds_m.pmds006) THEN
                        IF NOT apmt520_source_pmds041_chk(g_pmds_m.pmds006,g_pmds_m.pmds041) THEN
                           LET g_pmds_m.pmds041 = g_pmds_m_o.pmds041
                           NEXT FIELD CURRENT
                        END IF
                     END IF
                     
                  END IF
                  
               END IF
            END IF 

            LET g_pmds_m_o.pmds041 = g_pmds_m.pmds041
            ]]>
  </point>
  <point name="input.a.pmds042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmds048" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #取匯率
            IF NOT cl_null(g_pmds_m.pmds037) THEN
               #根據內外購獲取當前營運據點參數設置的汇率类型
               LET l_scc40 = ''
               IF g_pmds_m.pmds048 = '1' THEN   #內購
                  LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0014')
               END IF
               IF g_pmds_m.pmds048 = '2' THEN   #外購
                  LET l_scc40 = cl_get_para(g_enterprise,g_site,'S-BAS-0015')
               END IF
               LET l_ooef016 = ''
               SELECT ooef016 INTO l_ooef016 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
               IF (NOT cl_null(l_scc40)) AND (NOT cl_null(l_ooef016)) THEN
                  CALL s_aooi160_get_exrate('1',g_site,g_today,g_pmds_m.pmds037,l_ooef016,0,l_scc40) RETURNING g_pmds_m.pmds038
               END IF
            END IF]]>
  </point>
  <point name="input.a.pmds053" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_desc_get_icaa001_desc(g_pmds_m.pmds053) RETURNING g_pmds_m.pmds053_desc
            DISPLAY BY NAME g_pmds_m.pmds053_desc
            
            IF NOT cl_null(g_pmds_m.pmds053) THEN
            #150610 earl mod s
#               #此段落由子樣板a19產生
#               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
#               INITIALIZE g_chkparam.* TO NULL
#
#               #設定g_chkparam.*的參數
#               LET g_chkparam.arg1 = g_pmds_m.pmds053
#               LET g_chkparam.arg2 = g_site
#               IF g_pmds_m.pmds014 = '2' THEN
#                  IF NOT cl_chk_exist("v_icaa001_4") THEN
#                     LET g_pmds_m.pmds053 = g_pmds_m_t.pmds053
#                     CALL s_desc_get_icaa001_desc(g_pmds_m.pmds053) RETURNING g_pmds_m.pmds053_desc
#                     DISPLAY BY NAME g_pmds_m.pmds053_desc
#                     NEXT FIELD CURRENT
#                  END IF
#               END IF
#               IF g_pmds_m.pmds014 = '3' THEN
#                  IF NOT cl_chk_exist("v_icaa001_5") THEN
#                     LET g_pmds_m.pmds053 = g_pmds_m_t.pmds053
#                     CALL s_desc_get_icaa001_desc(g_pmds_m.pmds053) RETURNING g_pmds_m.pmds053_desc
#                     DISPLAY BY NAME g_pmds_m.pmds053_desc
#                     NEXT FIELD CURRENT
#                  END IF
#               END IF
               IF g_pmds_m.pmds053 <> g_pmds_m_o.pmds053 OR cl_null(g_pmds_m_o.pmds053) THEN
               
                  IF NOT apmt520_pmds014_pmds053_chk(g_pmds_m.pmds014,g_pmds_m.pmds053) THEN
                     LET g_pmds_m.pmds053 = g_pmds_m_o.pmds053
                     CALL s_desc_get_icaa001_desc(g_pmds_m.pmds053) RETURNING g_pmds_m.pmds053_desc
                     DISPLAY BY NAME g_pmds_m.pmds053_desc
                     NEXT FIELD CURRENT
                  END IF
                  
               END IF
            END IF
            
            LET g_pmds_m_o.pmds053 = g_pmds_m.pmds053
            #150610 earl mod e
            ]]>
  </point>
  <point name="input.a.pmdsdocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmdsdocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            #此段落由子樣板a05產生
            CALL s_aooi200_get_slip_desc(g_pmds_m.pmdsdocno) RETURNING g_pmds_m.pmdsdocno_desc
            DISPLAY BY NAME g_pmds_m.pmdsdocno_desc
            
            IF  NOT cl_null(g_pmds_m.pmdsdocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_pmds_m.pmdsdocno != g_pmdsdocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM pmds_t WHERE "||"pmdsent = '" ||g_enterprise|| "' AND "||"pmdsdocno = '"||g_pmds_m.pmdsdocno ||"'",'std-00004',0) THEN 
                     LET g_pmds_m.pmdsdocno = g_pmdsdocno_t
                     CALL s_aooi200_get_slip_desc(g_pmds_m.pmdsdocno) RETURNING g_pmds_m.pmdsdocno_desc
                     DISPLAY BY NAME g_pmds_m.pmdsdocno_desc
                     NEXT FIELD CURRENT
                  END IF
                  
                  IF NOT s_aooi200_chk_slip(g_site,'',g_pmds_m.pmdsdocno,g_prog) THEN
                     LET g_pmds_m.pmdsdocno = g_pmdsdocno_t
                     CALL s_aooi200_get_slip_desc(g_pmds_m.pmdsdocno) RETURNING g_pmds_m.pmdsdocno_desc
                     DISPLAY BY NAME g_pmds_m.pmdsdocno_desc
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.pmdssite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.a.pmdsstus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.after_define_sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.after_define_sql2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.after_define_sql3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.after_input" order="" ver="12" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF g_flag2 THEN
      CALL apmt520_input('u')
   END IF  

   #重新計算整單的未稅、含稅總金額
   IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
      CALL s_transaction_begin()
      CALL s_tax_recount(g_pmds_m.pmdsdocno)
        RETURNING g_pmds_m.pmds043,g_pmds_m.pmds046,g_pmds_m.pmds044,l_xrcd113,l_xrcd114,l_xrcd115
      UPDATE pmds_t SET pmds043 = g_pmds_m.pmds043,
                        pmds044 = g_pmds_m.pmds044,
                        pmds046 = g_pmds_m.pmds046
          WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
      IF SQLCA.sqlcode THEN
         CALL s_transaction_end('N','0')
      ELSE
         CALL s_transaction_end('Y','0')
      END IF
   END IF  

   CALL apmt520_b_fill()]]>
  </point>
  <point name="input.after_set_entry" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   
   LET g_controlno = ''
   
   IF p_cmd = 'u' AND g_argv[1] MATCHES '[24]' THEN   
      #取得採購通路
      LET g_pmab039 = g_pmds_m.pmds012
      #取得稅別類型
      CALL s_tax_chk(g_site,g_pmds_m.pmds033)
        RETURNING l_success,l_oodbl004,l_oodb005,l_oodb006,l_oodb011
      IF l_success THEN
         LET g_tax_app = l_oodb011
      END IF     
      #取得價格是否允許修改,修改容差率,價格超過容差率的處理方式,允許單價為0
       LET g_pmam003 = ''
       LET g_pmam006 = ''
       LET g_pmam002 = ''
       SELECT pmam003,pmam006,pmam002
         INTO g_pmam003,g_pmam006,g_pmam002
         FROM pmam_t       
        WHERE pmament = g_enterprise
          AND pmam001 = g_pmds_m.pmds039            
   END IF   
   
   CALL apmt520_set_no_required()
   CALL apmt520_set_required()   ]]>
  </point>
  <point name="input.b.page1.pmdt001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt053" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt054" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdt062" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            LET g_pmdt_d_o.pmdt062 = g_pmdt_d[l_ac].pmdt062]]>
  </point>
  <point name="input.b.page1.pmdtseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page1.pmdtsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdu016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page2.pmdusite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdv019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdvseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdvseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.page3.pmdvsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds000" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmds045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmdsdocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmdsdocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmdssite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.b.pmdsstus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.before_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         IF g_flag2 THEN
            LET g_flag2 = FALSE
            NEXT FIELD pmdt001
         END IF                            ]]>
  </point>
  <point name="input.before_input" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   LET l_ooef004 = ''
   SELECT ooef004 INTO l_ooef004 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
   
   LET g_errshow = 1
   LET l_flag = TRUE]]>
  </point>
  <point name="input.body.a_delete" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.body.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                         ]]>
  </point>
  <point name="input.body.a_insert2" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF NOT apmt520_ins_pmdu() THEN
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF  
               
               #無採購單來源時
               IF g_argv[1] MATCHES '[24]' THEN
                  LET l_pmdtseq = NULL
               
                  INITIALIZE l_pmdt.* TO NULL               
                  SELECT pmdtent,pmdtsite,pmdtdocno,pmdtseq,pmdt001,pmdt002,pmdt003,pmdt004,pmdt081,pmdt082,pmdt083, 
                         pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021,pmdt022,pmdt008, 
                         pmdt023,pmdt024,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047,pmdt026,pmdt041,pmdt062,pmdt016, 
                         pmdt017,pmdt018,pmdt063,pmdt040,pmdt052,pmdt051,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061, 
                         pmdt042,pmdt043,pmdt044,pmdt045,pmdt084,
                         pmdt072,pmdt073,pmdt074
                    INTO l_pmdt.pmdtent,l_pmdt.pmdtsite,l_pmdt.pmdtdocno,l_pmdt.pmdtseq,l_pmdt.pmdt001,l_pmdt.pmdt002,
                         l_pmdt.pmdt003,l_pmdt.pmdt004,l_pmdt.pmdt081,l_pmdt.pmdt082,l_pmdt.pmdt083, 
                         l_pmdt.pmdt005,l_pmdt.pmdt006,l_pmdt.pmdt007,l_pmdt.pmdt009,l_pmdt.pmdt010,l_pmdt.pmdt025,
                         l_pmdt.pmdt011,l_pmdt.pmdt019,l_pmdt.pmdt020,l_pmdt.pmdt021,l_pmdt.pmdt022,l_pmdt.pmdt008, 
                         l_pmdt.pmdt023,l_pmdt.pmdt024,l_pmdt.pmdt036,l_pmdt.pmdt046,l_pmdt.pmdt037,l_pmdt.pmdt038,
                         l_pmdt.pmdt039,l_pmdt.pmdt047,l_pmdt.pmdt026,l_pmdt.pmdt041,l_pmdt.pmdt062,l_pmdt.pmdt016, 
                         l_pmdt.pmdt017,l_pmdt.pmdt018,l_pmdt.pmdt063,l_pmdt.pmdt040,l_pmdt.pmdt052,l_pmdt.pmdt051,
                         l_pmdt.pmdt059,l_pmdt.pmdt053,l_pmdt.pmdt054,l_pmdt.pmdt055,l_pmdt.pmdt060,l_pmdt.pmdt061, 
                         l_pmdt.pmdt042,l_pmdt.pmdt043,l_pmdt.pmdt044,l_pmdt.pmdt045,l_pmdt.pmdt084,
                         l_pmdt.pmdt072,l_pmdt.pmdt073,l_pmdt.pmdt074
                    FROM pmdt_t 
                   WHERE pmdtent = g_enterprise
                     AND pmdtdocno = g_pmds_m.pmdsdocno
                     AND pmdtseq = g_pmdt_d[l_ac].pmdtseq
                  
                  IF l_inam.getLength() > 1 THEN  #因為第一筆資料已呈現在畫面並寫入DB, 從第二筆開始處理           
                     IF cl_null(l_pmdtseq) THEN   
                        SELECT MAX(pmdtseq) INTO l_pmdtseq
                          FROM pmdt_t
                         WHERE pmdtent   = g_enterprise
                           AND pmdtdocno = g_pmds_m.pmdsdocno                     
                     END IF 
                    
                     LET l_ac_t = l_ac
                     
                     FOR l_i = 2 TO l_inam.getLength() 
                        IF cl_null(l_pmdtseq) OR l_pmdtseq = 0 THEN
                           LET l_pmdtseq = 1
                        ELSE
                           LET l_pmdtseq = l_pmdtseq + 1             
                        END IF 
                        
                        LET l_pmdt.pmdtseq = l_pmdtseq
                        LET l_pmdt.pmdt007 = l_inam[l_i].inam002
                        LET l_pmdt.pmdt020 = l_inam[l_i].inam004
                        
                        #計算參考數量
                        IF (NOT cl_null(l_pmdt.pmdt021)) AND (NOT cl_null(l_pmdt.pmdt006)) AND (NOT cl_null(l_pmdt.pmdt019)) THEN
                           #CALL s_aimi190_get_convert(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt021) RETURNING l_success,l_rate
                           #LET l_pmdt.pmdt022 = l_pmdt.pmdt020 * l_rate
                           CALL s_aooi250_convert_qty(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt021,l_pmdt.pmdt020)
                                         RETURNING l_success,l_pmdt.pmdt022
                        END IF
                        
                        #若參數有使用計價單位時，則輸入[C:需求數量]時則應自動推算計價數量，
                        #[C:計價數量]=[C:需求數量]*[C:單位]與[C:計價單位]換算率
                        IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(l_pmdt.pmdt023)) AND (NOT cl_null(l_pmdt.pmdt006)) AND (NOT cl_null(l_pmdt.pmdt019)) AND apmt520_get_imaf144(l_pmdt.pmdt006) THEN  #體參數使用採購計價單位
                           #CALL s_aimi190_get_convert(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt023) RETURNING l_success,l_rate
                           #LET l_pmdt.pmdt024 = l_pmdt.pmdt020 * l_rate
                           CALL s_aooi250_convert_qty(l_pmdt.pmdt006,l_pmdt.pmdt019,l_pmdt.pmdt023,l_pmdt.pmdt020)
                                         RETURNING l_success,l_pmdt.pmdt024
                        ELSE
                           LET l_pmdt.pmdt023 = l_pmdt.pmdt019
                           LET l_pmdt.pmdt024 = l_pmdt.pmdt020            
                        END IF

                        IF cl_null(l_pmdt.pmdt023) OR cl_null(l_pmdt.pmdt024) THEN
                           LET l_pmdt.pmdt023 = l_pmdt.pmdt019
                           LET l_pmdt.pmdt024 = l_pmdt.pmdt020  
                        END IF
                        
                        
                        IF (NOT cl_null(g_pmds_m.pmds039)) AND (NOT cl_null(g_pmds_m.pmds007)) AND (NOT cl_null(l_pmdt.pmdt006)) AND
                           (NOT cl_null(g_pmds_m.pmds037)) AND (NOT cl_null(l_pmdt.pmdt046)) AND (NOT cl_null(g_pmds_m.pmds031)) AND 
                           (NOT cl_null(g_pmds_m.pmds032)) AND (NOT cl_null(g_pmds_m.pmds012)) AND (NOT cl_null(g_pmds_m.pmdsdocno)) AND
                           (NOT cl_null(g_pmds_m.pmdsdocdt)) AND (NOT cl_null(l_pmdt.pmdt023)) AND (NOT cl_null(l_pmdt.pmdt024)) THEN
                         
                           CALL s_purchase_price_get(g_pmds_m.pmds039,g_pmds_m.pmds007,l_pmdt.pmdt006,l_pmdt.pmdt007,
                                                     g_pmds_m.pmds037,l_pmdt.pmdt046,g_pmds_m.pmds031,g_pmds_m.pmds032,
                                                     g_pmds_m.pmds012,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,l_pmdt.pmdt023,
                                                     l_pmdt.pmdt024,g_site,g_pmds_m.pmds048,'1',l_pmdt.pmdt009,
                                                     l_pmdt.pmdt010)          
                                 RETURNING l_pmdt.pmdt042,l_pmdt.pmdt044,l_pmdt.pmdt043,l_pmdt.pmdt048
                           
                           #呼叫幣別取位應用元件對單價作取位(依單頭幣別做取位基準)
                           CALL s_curr_round(g_site,g_pmds_m.pmds037,l_pmdt.pmdt044,'1') RETURNING l_pmdt.pmdt044
                           
                           LET l_pmdt.pmdt036 = l_pmdt.pmdt044
                           LET l_pmdt.pmdt045 = 0
                           
                        END IF
                 
                        #重新計算[C:未稅金額]、[C:含稅金額]、[稅額]
                        CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,l_pmdt.pmdtseq,l_pmdt.pmdt001,l_pmdt.pmdt024,l_pmdt.pmdt036,l_pmdt.pmdt046)
                                RETURNING l_pmdt.pmdt038,l_pmdt.pmdt047,l_pmdt.pmdt039 
                        
                        
                        INSERT INTO pmdt_t 
                              (pmdtent,pmdtsite,pmdtdocno,pmdtseq,pmdt001,pmdt002,pmdt003,pmdt004,pmdt081,pmdt082,pmdt083, 
                               pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021,pmdt022,pmdt008, 
                               pmdt023,pmdt024,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047,pmdt026,pmdt041,pmdt062,pmdt016, 
                               pmdt017,pmdt018,pmdt063,pmdt040,pmdt052,pmdt051,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061, 
                               pmdt042,pmdt043,pmdt044,pmdt045,pmdt048,pmdt084,pmdt088,pmdt089,
                               pmdt072,pmdt073,pmdt074)
                             VALUES(l_pmdt.pmdtent,l_pmdt.pmdtsite,l_pmdt.pmdtdocno,l_pmdt.pmdtseq,l_pmdt.pmdt001,l_pmdt.pmdt002,
                                    l_pmdt.pmdt003,l_pmdt.pmdt004,l_pmdt.pmdt081,l_pmdt.pmdt082,l_pmdt.pmdt083, 
                                    l_pmdt.pmdt005,l_pmdt.pmdt006,l_pmdt.pmdt007,l_pmdt.pmdt009,l_pmdt.pmdt010,l_pmdt.pmdt025,
                                    l_pmdt.pmdt011,l_pmdt.pmdt019,l_pmdt.pmdt020,l_pmdt.pmdt021,l_pmdt.pmdt022,l_pmdt.pmdt008, 
                                    l_pmdt.pmdt023,l_pmdt.pmdt024,l_pmdt.pmdt036,l_pmdt.pmdt046,l_pmdt.pmdt037,l_pmdt.pmdt038,
                                    l_pmdt.pmdt039,l_pmdt.pmdt047,l_pmdt.pmdt026,l_pmdt.pmdt041,l_pmdt.pmdt062,l_pmdt.pmdt016, 
                                    l_pmdt.pmdt017,l_pmdt.pmdt018,l_pmdt.pmdt063,l_pmdt.pmdt040,l_pmdt.pmdt052,l_pmdt.pmdt051,
                                    l_pmdt.pmdt059,l_pmdt.pmdt053,l_pmdt.pmdt054,l_pmdt.pmdt055,l_pmdt.pmdt060,l_pmdt.pmdt061, 
                                    l_pmdt.pmdt042,l_pmdt.pmdt043,l_pmdt.pmdt044,l_pmdt.pmdt045,l_pmdt.pmdt048,l_pmdt.pmdt084,l_pmdt.pmdt088,l_pmdt.pmdt089,
                                    l_pmdt.pmdt072,l_pmdt.pmdt073,l_pmdt.pmdt074) 
                        IF SQLCA.sqlcode THEN
                           INITIALIZE g_errparam TO NULL
                           LET g_errparam.code = SQLCA.sqlcode
                           LET g_errparam.extend = "pmdt_t"
                           LET g_errparam.popup = FALSE
                           CALL cl_err()
                 
                        ELSE
                           LET l_ac = l_ac + 1
                           
                           SELECT pmdtsite,pmdtseq,pmdt001,pmdt002,pmdt003,pmdt004,pmdt081,pmdt082,pmdt083, 
                                  pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021,pmdt022,pmdt008, 
                                  pmdt023,pmdt024,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047,pmdt026,pmdt041,pmdt062,pmdt016, 
                                  pmdt017,pmdt018,pmdt063,pmdt040,pmdt052,pmdt051,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061, 
                                  pmdt042,pmdt043,pmdt044,pmdt045,pmdt048,
                                  pmdt072,pmdt073,pmdt074
                             INTO g_pmdt_d[l_ac].pmdtsite,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt002, 
                                  g_pmdt_d[l_ac].pmdt003,g_pmdt_d[l_ac].pmdt004,g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082, 
                                  g_pmdt_d[l_ac].pmdt083,g_pmdt_d[l_ac].pmdt005,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007, 
                                  g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt011, 
                                  g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022, 
                                  g_pmdt_d[l_ac].pmdt008,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt036, 
                                  g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt037,g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt039, 
                                  g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt026,g_pmdt_d[l_ac].pmdt041,g_pmdt_d[l_ac].pmdt062, 
                                  g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt063, 
                                  g_pmdt_d[l_ac].pmdt040,g_pmdt_d[l_ac].pmdt052,g_pmdt_d[l_ac].pmdt051,g_pmdt_d[l_ac].pmdt059, 
                                  g_pmdt_d[l_ac].pmdt053,g_pmdt_d[l_ac].pmdt054,g_pmdt_d[l_ac].pmdt055,g_pmdt_d[l_ac].pmdt060, 
                                  g_pmdt_d[l_ac].pmdt061,g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt044, 
                                  g_pmdt_d[l_ac].pmdt045,g_pmdt_d[l_ac].pmdt048,
                                  g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073,g_pmdt_d[l_ac].pmdt074
                             FROM pmdt_t 
                            WHERE pmdtent = g_enterprise
                              AND pmdtdocno = g_pmds_m.pmdsdocno
                              AND pmdtseq = l_pmdt.pmdtseq
                              
                           LET l_pmdtseq = g_pmdt_d_t.pmdtseq
                           LET g_pmdt_d_t.pmdtseq = ''
                           CALL apmt520_ins_pmdu() RETURNING l_success
                           LET g_pmdt_d_t.pmdtseq = l_pmdtseq
                        END IF
                     END FOR
                     
                     LET l_ac = l_ac_t
                     
                     CALL apmt520_b_fill()
                     LET g_rec_b = l_inam.getLength() - 1
                  END IF
               END IF
               
               #產生收貨原始需求分配明細資料
               IF NOT s_apmt520_gen_pmdv(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq) THEN
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF                                             ]]>
  </point>
  <point name="input.body.a_update" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #若有修改到採購單號、項次、或 收貨單號，收貨項次、數量時需檢核採購項次是否有對應的關連單據資料，若有則在修改確認時需乎叫
               #原始需求分配function產生原始需求分配明細資料
               IF g_pmdt_d[l_ac].pmdt001 != g_pmdt_d_t.pmdt001 OR g_pmdt_d[l_ac].pmdt002 != g_pmdt_d_t.pmdt002 OR g_pmdt_d[l_ac].pmdt020 != g_pmdt_d_t.pmdt020
                  OR g_pmdt_d[l_ac].pmdt027 != g_pmdt_d_t.pmdt027 OR g_pmdt_d[l_ac].pmdt028 != g_pmdt_d_t.pmdt028 THEN
                  IF NOT s_apmt520_gen_pmdv(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq) THEN
                     LET g_pmdt_d[l_ac].* = g_pmdt_d_t.*                     
                     CALL s_transaction_end('N','0')
                  END IF
               END IF 
               
               #由'Y'-->改為'N',則需新增一筆資料到多库储批單身
               IF g_pmdt_d[l_ac].pmdt062 != g_pmdt_d_t.pmdt062 AND g_pmdt_d[l_ac].pmdt062 = 'N' THEN
                  IF NOT apmt520_ins_pmdu() THEN
                     LET g_pmdt_d[l_ac].* = g_pmdt_d_t.*                     
                     CALL s_transaction_end('N','0')
                  END IF
               ELSE
                  #多庫儲批為'N'，則更新相關欄位
                  IF g_pmdt_d[l_ac].pmdt062 = 'N' THEN
                     UPDATE pmdu_t SET pmduseq = g_pmdt_d[l_ac].pmdtseq,
                                       pmdu001 = g_pmdt_d[l_ac].pmdt006,
                                       pmdu002 = g_pmdt_d[l_ac].pmdt007,
                                       pmdu003 = g_pmdt_d[l_ac].pmdt009,
                                       pmdu004 = g_pmdt_d[l_ac].pmdt010,
                                       pmdu005 = g_pmdt_d[l_ac].pmdt063,
                                       pmdu006 = g_pmdt_d[l_ac].pmdt016,
                                       pmdu007 = g_pmdt_d[l_ac].pmdt017,
                                       pmdu008 = g_pmdt_d[l_ac].pmdt018,
                                       pmdu009 = g_pmdt_d[l_ac].pmdt019,
                                       pmdu010 = g_pmdt_d[l_ac].pmdt020,
                                       pmdu011 = g_pmdt_d[l_ac].pmdt021,
                                       pmdu012 = g_pmdt_d[l_ac].pmdt022,
                                       pmdu016 = g_pmdt_d[l_ac].pmdt088,
                                       pmdu017 = g_pmdt_d[l_ac].pmdt089
                                 WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND pmduseq = g_pmdt_d_t.pmdtseq
                  ELSE
                     UPDATE pmdu_t SET pmduseq = g_pmdt_d[l_ac].pmdtseq,
                                       pmdu001 = g_pmdt_d[l_ac].pmdt006,
                                       pmdu002 = g_pmdt_d[l_ac].pmdt007,
                                       pmdu003 = g_pmdt_d[l_ac].pmdt009,
                                       pmdu004 = g_pmdt_d[l_ac].pmdt010
                                 WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND pmduseq = g_pmdt_d_t.pmdtseq
                     #3.若有修改到存貨備註時，需開窗詢問是否同步更新[T:多庫儲批明細檔].[C:存貨備註]
                     IF ((g_pmdt_d[l_ac].pmdt088 != g_pmdt_d_t.pmdt088) OR ((NOT cl_null(g_pmdt_d[l_ac].pmdt088)) AND cl_null(g_pmdt_d_t.pmdt088)) OR ((NOT cl_null(g_pmdt_d_t.pmdt088)) AND cl_null(g_pmdt_d[l_ac].pmdt088))) THEN
                        IF cl_ask_confirm('apm-00645') THEN
                           UPDATE pmdu_t SET pmdu016 = g_pmdt_d[l_ac].pmdt088
                             WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND pmduseq = g_pmdt_d_t.pmdtseq #項次
                        END IF
                     END IF
                  END IF
               END IF
               
               CALL apmt520_b_fill()]]>
  </point>
  <point name="input.body.after_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #呼叫產生匯總與檢驗狀況的Function來更新匯總與檢驗狀況明細資料
            #CALL s_transaction_begin()
            #IF NOT s_apmt520_gen_pmdu(g_pmds_m.pmdsdocno) THEN
            #   CALL s_transaction_end('N','0')
            #ELSE
            #   CALL s_transaction_end('Y','0')
            #END IF  ]]>
  </point>
  <point name="input.body.after_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body.after_set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               LET g_pmdt_d_o.* = g_pmdt_d[l_ac].*   
               
               CALL apmt520_set_no_required_b()
               CALL apmt520_set_required_b()
               ]]>
  </point>
  <point name="input.body.b_a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body.b_update" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #儲位、批號 若為空，給一個空格
               IF cl_null(g_pmdt_d[l_ac].pmdt017) THEN
                  LET g_pmdt_d[l_ac].pmdt017 = ' '
               END IF 
	           
               IF cl_null(g_pmdt_d[l_ac].pmdt018) THEN
                  LET g_pmdt_d[l_ac].pmdt018 = ' '
               END IF    

               #整體參數未使用採購計價單位,則賦值當前的採購單位和數量
               IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "N"  OR (NOT apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006)) THEN
                  LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                  LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
               END IF]]>
  </point>
  <point name="input.body.before_input2" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #150617 earl add s
            #中斷續拋，直接由最終站將資料帶出
            IF apmt520_break_continue(g_pmds_m.pmds053) THEN
               NEXT FIELD pmds041
            END IF
            #150617 earl add e
               ]]>
  </point>
  <point name="input.body.before_insert" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            SELECT MAX(pmdtseq)+1 INTO g_pmdt_d[l_ac].pmdtseq FROM pmdt_t
              WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
            IF cl_null(g_pmdt_d[l_ac].pmdtseq) OR g_pmdt_d[l_ac].pmdtseq = 0 THEN
               LET g_pmdt_d[l_ac].pmdtseq = 1
            END IF
            
            LET g_pmdt_d[l_ac].pmdtsite = g_site
            
            #單頭採購單不為空時，單身預設單頭的採購單號
            IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
               IF NOT cl_null(g_pmds_m.pmds006) THEN
                  LET g_pmdt_d[l_ac].pmdt001 = g_pmds_m.pmds006
               END IF
            END IF
            #驗退、入庫、倉退時，收貨來源單號預設單頭的來源單號
            IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
               #單頭收貨單不為空時，單身預設單頭的收貨單號
               IF NOT cl_null(g_pmds_m.pmds006) THEN
                  LET g_pmdt_d[l_ac].pmdt027 = g_pmds_m.pmds006
               END IF
            END IF
            
            LET g_pmdt_d[l_ac].pmdt053 = 0
            LET g_pmdt_d[l_ac].pmdt054 = 0
            LET g_pmdt_d[l_ac].pmdt055 = 0
            LET g_pmdt_d[l_ac].pmdt052 = '1'  #狀態碼 '1:一般'
            
            #倉退單，當倉退方式為'4:'價格折讓'時，數量欄位預設為0且不可以維護
            IF (g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15') AND g_pmds_m.pmds100 = '4' THEN
               LET g_pmdt_d[l_ac].pmdt020 = 0
            END IF
            
            #無採購單來源時
            IF g_argv[1] MATCHES '[24]' THEN
               LET g_pmdt_d[l_ac].pmdt046 = g_pmds_m.pmds033
               LET g_pmdt_d[l_ac].pmdt037 = g_pmds_m.pmds033
               CALL apmt520_pmds033_ref(g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
               DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046_desc
            END IF
            
            #若单据别对应的参数“是否依客户/厂商做库存管理”='Y'，则将供应商编号带入到此栏位
            IF g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' THEN
               CALL s_aooi200_get_slip(g_pmds_m.pmdsdocno) RETURNING l_success,l_ooba002
               IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-BAS-0090') = 'Y' THEN
                  LET g_pmdt_d[l_ac].pmdt063 = g_pmds_m.pmds007
               END IF
            END IF
            
            LET g_pmdt_d_t.* = g_pmdt_d[l_ac].*     #新輸入資料
            LET g_pmdt_d_o.* = g_pmdt_d[l_ac].*     #新輸入資料]]>
  </point>
  <point name="input.body.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                               ]]>
  </point>
  <point name="input.body.insert.after_set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL apmt520_set_no_required_b()
            CALL apmt520_set_required_b()
                                                   ]]>
  </point>
  <point name="input.body.insert.before_bak" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL s_transaction_begin()
            
            #自立應付欄位是判斷多角時是不是要自立帳款，所以在一般的採購入庫/倉退與銷售出貨/銷退流程新增時,此欄位均預設為’Y’
            IF g_argv[1] MATCHES '[3467]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
               LET g_pmdt_d[l_ac].pmdt084 = 'Y'
            ELSE
               LET g_pmdt_d[l_ac].pmdt084 = 'N'
            END IF
            LET g_pmdt_d[l_ac].pmdt089 = '']]>
  </point>
  <point name="input.body.m_delete" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                  DELETE FROM pmdu_t
                    WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND
                          pmduseq = g_pmdt_d_t.pmdtseq
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "pmdu_t" 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                  
                     CALL s_transaction_end('N','0')
                     CANCEL DELETE 
                  END IF
                  DELETE FROM pmdv_t
                    WHERE pmdvent = g_enterprise AND pmdvdocno = g_pmds_m.pmdsdocno AND
                          pmdvseq = g_pmdt_d_t.pmdtseq
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "pmdv_t" 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                  
                     CALL s_transaction_end('N','0')
                     CANCEL DELETE 
                  END IF

                  #刪除交易稅明細檔
                  DELETE FROM xrcd_t
                   WHERE xrcdent = g_enterprise
                     AND xrcddocno = g_pmds_m.pmdsdocno
                     AND xrcdseq =g_pmdt_d_t.pmdtseq
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.extend = "DELETE xrcd_t"
                     LET g_errparam.code   = SQLCA.sqlcode
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()
                     CALL s_transaction_end('N','0')
                     CANCEL DELETE
                  END IF           ]]>
  </point>
  <point name="input.body.m_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                                        ]]>
  </point>
  <point name="input.body2.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.after_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.after_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.after_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.after_set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.b_a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.b_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.before_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.insert.after_set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body2.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body2.m_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                                        ]]>
  </point>
  <point name="input.body3.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.after_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.after_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.after_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.after_set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.b_a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.b_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.before_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.insert.after_set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.body3.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.body3.m_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.c.page1.pmdt001" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt001             #給予default值
            
            #採購收貨時開窗開採購單號
			   IF g_argv[1] MATCHES '[13]' THEN
               LET g_qryparam.where = " pmdl005 NOT IN ('2','5','6') AND pmdl004 = '",g_pmds_m.pmds007,"' "
               CALL q_pmdldocno_7()                           #呼叫開窗
            END IF
            IF g_argv[1] = '8' OR g_argv[1] = '20' THEN   #委外採購
               LET g_qryparam.where = " pmdl005 ='2' AND pmdl004 = '",g_pmds_m.pmds007,"' " 
               CALL q_pmdldocno_7() 
            END IF
            IF g_argv[1] = '9' THEN   #重覆性生產採購
               LET g_qryparam.where = " pmdl005 ='5' AND pmdl004 = '",g_pmds_m.pmds007,"' "
               CALL q_pmdldocno_7() 
            END IF
            IF g_argv[1] = '23' OR g_argv[1] = '24' THEN   #委外採購
               LET g_qryparam.where = " pmdl005 ='6' AND pmdl004 = '",g_pmds_m.pmds007,"' " 
               CALL q_pmdldocno_7() 
            END IF
            
            
            LET g_pmdt_d[l_ac].pmdt001 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt001 TO pmdt001              #顯示到畫面上

            NEXT FIELD pmdt001                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt002" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt002             #給予default值
            
            #採購收貨時開窗開採購單號對應的項次
			   IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
               LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt001
               CALL q_pmdoseq()                           #呼叫開窗
               LET g_pmdt_d[l_ac].pmdt002 = g_qryparam.return1              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt003 = g_qryparam.return2              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt004 = g_qryparam.return3              #將開窗取得的值回傳到變數
               DISPLAY g_pmdt_d[l_ac].pmdt002 TO pmdt002              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt003 TO pmdt003              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt004 TO pmdt004              #顯示到畫面上
            END IF
            
            NEXT FIELD pmdt002                          #返回原欄位
                                         ]]>
  </point>
  <point name="input.c.page1.pmdt003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt006" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
			   
			   #倉退时，開有庫存的庫位
            IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26'THEN
               LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt006
               LET g_qryparam.default2 = g_pmdt_d[l_ac].pmdt007
               LET g_qryparam.default3 = g_pmdt_d[l_ac].pmdt016             #給予default
               LET g_qryparam.default4 = g_pmdt_d[l_ac].pmdt017
               LET g_qryparam.default5 = g_pmdt_d[l_ac].pmdt018
               LET g_qryparam.default6 = g_pmdt_d[l_ac].pmdt063
               
               CALL q_inag001_3() 
            
			      LET g_pmdt_d[l_ac].pmdt006 = g_qryparam.return1
			      LET g_pmdt_d[l_ac].pmdt007 = g_qryparam.return2
			      LET g_pmdt_d[l_ac].pmdt016 = g_qryparam.return3              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt017 = g_qryparam.return4              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt018 = g_qryparam.return5              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt063 = g_qryparam.return6
               
               DISPLAY g_pmdt_d[l_ac].pmdt006 TO pmdt006
               DISPLAY g_pmdt_d[l_ac].pmdt007 TO pmdt007
               DISPLAY g_pmdt_d[l_ac].pmdt016 TO pmdt016              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt017 TO pmdt017              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt018 TO pmdt018              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt063 TO pmdt063 
               
               CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
               DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
           
               CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
               DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
			   ELSE
			   
			      LET g_qryparam.where = " 1=1"
			      LET l_sql = " 1=1"
               #單據別的產品生命週期
               CALL s_control_get_doc_sql("imaf016",g_pmds_m.pmdsdocno,'4') RETURNING l_success,l_sql
               IF l_success THEN
                  IF cl_null(l_sql) THEN
                     LET l_sql = " 1=1"
                  END IF
                  LET g_qryparam.where = g_qryparam.where ," AND ",l_sql
               END IF
               LET l_sql = " 1=1"
               #單據別的產品分類
               CALL s_control_get_doc_sql("imaa009",g_pmds_m.pmdsdocno,'5') RETURNING l_success,l_sql
               IF l_success THEN
                  IF cl_null(l_sql) THEN
                     LET l_sql = " 1=1"
                  END IF
                  LET g_qryparam.where = g_qryparam.where ," AND ",l_sql
               END IF
               
               LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt006             #給予default值
               
               #給予arg
               
               CALL q_imaf001_15()                                #呼叫開窗
               
               LET g_pmdt_d[l_ac].pmdt006 = g_qryparam.return1              #將開窗取得的值回傳到變數
            END IF
            
            DISPLAY g_pmdt_d[l_ac].pmdt006 TO pmdt006              #顯示到畫面上
            CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdt006) RETURNING g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2

            NEXT FIELD pmdt006                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt007" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            LET l_imaa005 = ''
            CALL apmt520_get_imaa005(g_enterprise,g_pmdt_d[l_ac].pmdt006) RETURNING l_imaa005
               
            IF cl_get_para(g_enterprise,g_site,'S-BAS-0036') = 'Y' AND NOT cl_null(l_imaa005) THEN
               IF g_argv[1] MATCHES '[24]' THEN  #無採購(來源)單據時，和正常新增一樣
                  IF l_cmd = 'a' THEN            
                     CALL l_inam.clear()            
                     CALL s_feature(l_cmd,g_pmdt_d[l_ac].pmdt006,'','',g_site,g_pmds_m.pmdsdocno) RETURNING l_success,l_inam
                     LET g_pmdt_d[l_ac].pmdt007 = l_inam[1].inam002
                     LET g_pmdt_d[l_ac].pmdt020 = l_inam[1].inam004
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt020
                     
                     #計算參考數量
                     IF (NOT cl_null(g_pmdt_d[l_ac].pmdt021)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt019)) THEN
                        #CALL s_aimi190_get_convert(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021) RETURNING l_success,l_rate
                        #LET g_pmdt_d[l_ac].pmdt022 = g_pmdt_d[l_ac].pmdt020 * l_rate
                        CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt020)
                                         RETURNING l_success,g_pmdt_d[l_ac].pmdt022
                     END IF
                     
                     #若參數有使用計價單位時，則輸入[C:需求數量]時則應自動推算計價數量，
                     #[C:計價數量]=[C:需求數量]*[C:單位]與[C:計價單位]換算率
                     IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "Y" AND (NOT cl_null(g_pmdt_d[l_ac].pmdt023)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt006)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdt019)) AND apmt520_get_imaf144(g_pmdt_d[l_ac].pmdt006) THEN  #體參數使用採購計價單位
                        #CALL s_aimi190_get_convert(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023) RETURNING l_success,l_rate
                        #LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020 * l_rate
                        CALL s_aooi250_convert_qty(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt020)
                                         RETURNING l_success,g_pmdt_d[l_ac].pmdt024
                     ELSE
                        LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
                        LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020            
                     END IF
                     DISPLAY BY NAME g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt024
                     
                  END IF
               ELSE
                  CALL s_feature_single(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_site,g_pmds_m.pmdsdocno)
                     RETURNING l_success,g_pmdt_d[l_ac].pmdt007
                  CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007
               END IF
               
               IF l_cmd = 'u' THEN
                  CALL s_feature_single(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_site,g_pmds_m.pmdsdocno)
                     RETURNING l_success,g_pmdt_d[l_ac].pmdt007
                  CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
                  DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007
               END IF
            END IF                                       ]]>
  </point>
  <point name="input.c.page1.pmdt008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt008             #給予default值

            #給予arg

            CALL q_imaf001_5()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt008 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt008 TO pmdt008              #顯示到畫面上

            NEXT FIELD pmdt008                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt009" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt009             #給予default值
            LET g_qryparam.default2 = "" #g_pmdn_d[l_ac].oocq010 #參考欄位七

            #給予arg
            LET g_qryparam.arg1 = "221" #

            CALL q_oocq002()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt009 = g_qryparam.return1              #將開窗取得的值回傳到變數
            #LET g_pmdn_d[l_ac].oocq010 = g_qryparam.return2 #參考欄位七

            DISPLAY g_pmdt_d[l_ac].pmdt009 TO pmdt009              #顯示到畫面上
            #DISPLAY g_pmdn_d[l_ac].oocq010 TO oocq010 #參考欄位七

            NEXT FIELD pmdt009                          #返回原欄位
                                                        ]]>
  </point>
  <point name="input.c.page1.pmdt010" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[           ]]>
  </point>
  <point name="input.c.page1.pmdt011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt016" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt016             #給予default值

            #給予arg
            #倉退时，開有庫存的庫位
            IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26' THEN
               LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt006
               IF cl_null(g_pmdt_d[l_ac].pmdt007) THEN
                  LET g_pmdt_d[l_ac].pmdt007 = ' '
               END IF
               LET g_qryparam.arg2 = g_pmdt_d[l_ac].pmdt007
               
               CALL q_inag004_13()  
               LET g_pmdt_d[l_ac].pmdt016 = g_qryparam.return1              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt017 = g_qryparam.return2              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt018 = g_qryparam.return3              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt063 = g_qryparam.return4
               DISPLAY g_pmdt_d[l_ac].pmdt016 TO pmdt016              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt017 TO pmdt017              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt018 TO pmdt018              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt063 TO pmdt063 
               
               CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
               DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
            ELSE
               CALL q_inaa001_2()                                #呼叫開窗
               LET g_pmdt_d[l_ac].pmdt016 = g_qryparam.return1              #將開窗取得的值回傳到變數
               
               DISPLAY g_pmdt_d[l_ac].pmdt016 TO pmdt016              #顯示到畫面上
            END IF
            
            CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
            
            NEXT FIELD pmdt016                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt017" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            #倉退时，開有庫存的庫位
            IF g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26' THEN
               LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt016             #給予default
               LET g_qryparam.default2 = g_pmdt_d[l_ac].pmdt017
               LET g_qryparam.default3 = g_pmdt_d[l_ac].pmdt018
               LET g_qryparam.default4 = g_pmdt_d[l_ac].pmdt063
            
               LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt006
               IF cl_null(g_pmdt_d[l_ac].pmdt007) THEN
                  LET g_pmdt_d[l_ac].pmdt007 = ' '
               END IF
               LET g_qryparam.arg2 = g_pmdt_d[l_ac].pmdt007
               
               CALL q_inag004_13() 
                              
               LET g_pmdt_d[l_ac].pmdt016 = g_qryparam.return1              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt017 = g_qryparam.return2              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt018 = g_qryparam.return3              #將開窗取得的值回傳到變數
               LET g_pmdt_d[l_ac].pmdt063 = g_qryparam.return4
               DISPLAY g_pmdt_d[l_ac].pmdt016 TO pmdt016              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt017 TO pmdt017              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt018 TO pmdt018              #顯示到畫面上
               DISPLAY g_pmdt_d[l_ac].pmdt063 TO pmdt063 
               
               CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
               DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
            ELSE
               
               LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt017
               #給予arg
               LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt016
               
               CALL q_inab002_3()                                #呼叫開窗
               
               LET g_pmdt_d[l_ac].pmdt017 = g_qryparam.return1              #將開窗取得的值回傳到變數
               
               DISPLAY g_pmdt_d[l_ac].pmdt017 TO pmdt017              #顯示到畫面上
               
            END IF
           
            CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc
            

            NEXT FIELD pmdt017                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt019             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt006
            CALL q_imao002()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt019 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt019 TO pmdt019              #顯示到畫面上
            CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt019_desc

            NEXT FIELD pmdt019                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt021             #給予default值

            #給予arg

            LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt006
            CALL q_imao002()                                  #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt021 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt021 TO pmdt021              #顯示到畫面上
            CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt021_desc

            NEXT FIELD pmdt021                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt023             #給予default值

            #給予arg

            LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt006
            CALL q_imao002()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt023 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt023 TO pmdt023              #顯示到畫面上
            CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt023_desc

            NEXT FIELD pmdt023                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt027" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt027             #給予default值
            
            #驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] MATCHES '[56]' THEN
               LET g_qryparam.arg1 = "('1','2')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            #倉退時開窗開收貨單號
            IF g_argv[1] MATCHES '[7]' THEN
               LET g_qryparam.arg1 = "('1','2','3','4')"
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            
           #委外驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '10' THEN   #委外驗退
               LET g_qryparam.arg1 = "('8')"
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '12' THEN   #委外入庫
               LET g_qryparam.arg1 = "('8')"
               LET g_qryparam.where = " (pmdt053 - pmdt054 > 0) "
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '14' THEN   #委外倉退
               LET g_qryparam.arg1 = "('8')"
               LET g_qryparam.where = " pmdt054 > 0 "
               CALL q_pmdsdocno() 
            END IF
            #重覆性生產驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '11' THEN   #重覆性驗退
               LET g_qryparam.arg1 = "('9')"
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '13' THEN   #重覆性入庫
               LET g_qryparam.arg1 = "('9')"
               LET g_qryparam.where = " (pmdt053 - pmdt054 > 0 ) "
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '15' THEN   #重覆性倉退
               LET g_qryparam.arg1 = "('9')"
               LET g_qryparam.where = " pmdt054 > 0 "
               CALL q_pmdsdocno() 
            END IF
            
            LET g_pmdt_d[l_ac].pmdt027 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt027 TO pmdt027              #顯示到畫面上

            NEXT FIELD pmdt027                          #返回原欄位
]]>
  </point>
  <point name="input.c.page1.pmdt028" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt028             #給予default值
            
            #驗退、入庫、倉退時開窗開收貨單號對應的項次
            IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14' OR g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
               LET g_qryparam.arg1 = g_pmds_m.pmds006
               CALL q_pmdtseq()                           #呼叫開窗
               LET g_pmdt_d[l_ac].pmdt028 = g_qryparam.return1              #將開窗取得的值回傳到變數
               DISPLAY g_pmdt_d[l_ac].pmdt028 TO pmdt028              #顯示到畫面上
            END IF
            
            NEXT FIELD pmdt028                          #返回原欄位
                               ]]>
  </point>
  <point name="input.c.page1.pmdt036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt046             #給予default值

            #給予arg

            CALL q_oodb002_2()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt046 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt046 TO pmdt046              #顯示到畫面上

            NEXT FIELD pmdt046                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt051" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt051             #給予default值

            LET g_qryparam.where = "1=1 "
            
            LET l_sql = ''
            CALL s_control_get_doc_sql("oocq002",g_pmds_m.pmdsdocno,'8') RETURNING l_success,l_sql
            IF l_success THEN
               IF cl_null(l_sql) THEN
                  LET l_sql = " 1=1"
               END IF
               LET g_qryparam.where = g_qryparam.where ," AND ",l_sql
            END IF
            
            #給予arg
            LET g_qryparam.arg1 = g_acc #

            CALL q_oocq002()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt051 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt_d[l_ac].pmdt051 TO pmdt051              #顯示到畫面上

            NEXT FIELD pmdt051                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt053" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt054" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdt072" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt072             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_pjba001()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt072 = g_qryparam.return1              

            DISPLAY g_pmdt_d[l_ac].pmdt072 TO pmdt072              #
            CALL s_desc_get_project_desc(g_pmdt_d[l_ac].pmdt072) RETURNING g_pmdt_d[l_ac].pmdt072_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt072_desc

            NEXT FIELD pmdt072                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt073" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt073             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt072 #s


            CALL q_pjbb002_1()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt073 = g_qryparam.return1              

            DISPLAY g_pmdt_d[l_ac].pmdt073 TO pmdt073              #
            CALL s_desc_get_wbs_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073) RETURNING g_pmdt_d[l_ac].pmdt073_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt073_desc

            NEXT FIELD pmdt073                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt074" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt074             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_pmdt_d[l_ac].pmdt072 #s


            CALL q_pjbm002()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt074 = g_qryparam.return1              

            DISPLAY g_pmdt_d[l_ac].pmdt074 TO pmdt074              #
            CALL s_desc_get_activity_desc(g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt074) RETURNING g_pmdt_d[l_ac].pmdt074_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt074_desc

            NEXT FIELD pmdt074                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdt081" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt081             #給予default值
            LET g_qryparam.default2 = g_pmdt_d[l_ac].pmdt082
            LET g_qryparam.arg1 = g_ooef025
            
            LET g_qryparam.where = " qcba001 = '",g_pmds_m.pmds006,"' AND qcba002 = '",g_pmdt_d[l_ac].pmdt028,"' "
           
            IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' THEN
               LET g_qryparam.where = g_qryparam.where , " AND (qcbc009 - qcbc010) > 0  "
            END IF
            
            CALL q_qcbcdocno()                           #呼叫開窗
            
            LET g_pmdt_d[l_ac].pmdt081 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_pmdt_d[l_ac].pmdt082 = g_qryparam.return2

            DISPLAY g_pmdt_d[l_ac].pmdt081 TO pmdt081              #顯示到畫面上
            DISPLAY g_pmdt_d[l_ac].pmdt082 TO pmdt082 
            CALL apmt520_pmdt083_ref(g_pmdt_d[l_ac].pmdt083) RETURNING g_pmdt_d[l_ac].pmdt083_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt083_desc
            NEXT FIELD pmdt081                          #返回原欄位
]]>
  </point>
  <point name="input.c.page1.pmdt082" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt081             #給予default值
            LET g_qryparam.default2 = g_pmdt_d[l_ac].pmdt082
            LET g_qryparam.arg1 = g_ooef025
            LET g_qryparam.where = " qcba001 = '",g_pmds_m.pmds006,"' AND qcba002 = '",g_pmdt_d[l_ac].pmdt028,"' "
            IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' THEN
               LET g_qryparam.where = g_qryparam.where , " AND (qcbc009 - qcbc010) > 0  "
            END IF
            
            CALL q_qcbcdocno()                           #呼叫開窗
            
            LET g_pmdt_d[l_ac].pmdt081 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_pmdt_d[l_ac].pmdt082 = g_qryparam.return2

            DISPLAY g_pmdt_d[l_ac].pmdt081 TO pmdt081              #顯示到畫面上
            DISPLAY g_pmdt_d[l_ac].pmdt082 TO pmdt082 
            CALL apmt520_pmdt083_ref(g_pmdt_d[l_ac].pmdt083) RETURNING g_pmdt_d[l_ac].pmdt083_desc
            DISPLAY BY NAME g_pmdt_d[l_ac].pmdt083_desc

            NEXT FIELD pmdt082                         #返回原欄位
]]>
  </point>
  <point name="input.c.page1.pmdt083" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt_d[l_ac].pmdt083             #給予default值
           
            #給予arg
            LET g_qryparam.arg1 = g_ooef025

            
            CALL q_qcao002_1()                                #呼叫開窗

            LET g_pmdt_d[l_ac].pmdt083 = g_qryparam.return1              
             
            DISPLAY g_pmdt_d[l_ac].pmdt083 TO pmdt083              #
            
            NEXT FIELD pmdt083                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.pmdtseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page1.pmdtsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt2_d[l_ac].pmdu001             #給予default值

            #給予arg

            CALL q_imaf001()                                #呼叫開窗

            LET g_pmdt2_d[l_ac].pmdu001 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt2_d[l_ac].pmdu001 TO pmdu001              #顯示到畫面上

            NEXT FIELD pmdu001                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.pmdu002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt2_d[l_ac].pmdu005             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            CALL q_inaa001_6()                                #呼叫開窗

            LET g_pmdt2_d[l_ac].pmdu005 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt2_d[l_ac].pmdu005 TO pmdu005              #顯示到畫面上

            NEXT FIELD pmdu005                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.pmdu006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt2_d[l_ac].pmdu006             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #
            LET g_qryparam.arg2 = "" #

            CALL q_inab002_6()                                #呼叫開窗

            LET g_pmdt2_d[l_ac].pmdu006 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt2_d[l_ac].pmdu006 TO pmdu006              #顯示到畫面上

            NEXT FIELD pmdu006                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.pmdu007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt2_d[l_ac].pmdu008             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_pmdt2_d[l_ac].pmdu008 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt2_d[l_ac].pmdu008 TO pmdu008              #顯示到畫面上

            NEXT FIELD pmdu008                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.pmdu009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt2_d[l_ac].pmdu010             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_pmdt2_d[l_ac].pmdu010 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt2_d[l_ac].pmdu010 TO pmdu010              #顯示到畫面上

            NEXT FIELD pmdu010                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.pmdu011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdu016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page2.pmdusite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt3_d[l_ac].pmdv001             #給予default值

            #給予arg

            CALL q_imaf001()                                #呼叫開窗

            LET g_pmdt3_d[l_ac].pmdv001 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt3_d[l_ac].pmdv001 TO pmdv001              #顯示到畫面上

            NEXT FIELD pmdv001                          #返回原欄位

]]>
  </point>
  <point name="input.c.page3.pmdv002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdv018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmdt3_d[l_ac].pmdv018             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_pmdt3_d[l_ac].pmdv018 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmdt3_d[l_ac].pmdv018 TO pmdv018              #顯示到畫面上

            NEXT FIELD pmdv018                          #返回原欄位

]]>
  </point>
  <point name="input.c.page3.pmdv019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdvseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdvseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.page3.pmdvsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds000" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds002             #給予default值

            #給予arg

            CALL q_ooag001()                                #呼叫開窗

            LET g_pmds_m.pmds002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds002 TO pmds002              #顯示到畫面上

            NEXT FIELD pmds002                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds003" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds003             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_pmds_m.pmdsdocdt #

            CALL q_ooeg001()                                #呼叫開窗

            LET g_pmds_m.pmds003 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds003 TO pmds003              #顯示到畫面上

            NEXT FIELD pmds003                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds006" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            

            #150610 earl add s
            LET l_where_1 = " (pmdl051 IS NULL ",
                            "  OR (pmdl051 IN (SELECT icaa001 FROM icaa_t LEFT OUTER JOIN icab_t ON icabent = icaaent AND icab001 = icaa001 WHERE icaaent = ",g_enterprise," AND icaastus = 'Y'",
                            "                     AND ((icaa003 = '2' OR icaa003 = '3') AND icaa004 = '1' AND icab002 = 0 AND icab003 = '",g_site,"')",
                            "                          OR (icaa003 = '3' AND icaa004 = '2' AND icab002 = (SELECT MAX(icab002) FROM icab_t WHERE icabent = icaaent AND icab001 = icaa001) AND icab003 = '",g_site,"')",
                            "                          OR (icaa005 = 'Y' AND (icaa003 = '2' OR icaa003 = '3') AND icaa004 = '2'  AND icab002 = 0 AND icab003 = '",g_site,"')",
                            "                 )",
                            "     )",
                            " )"
                              
            LET l_where_2 = " (pmds053 IS NULL ",
                            "  OR (pmds053 IN (SELECT icaa001 FROM icaa_t LEFT OUTER JOIN icab_t ON icabent = icaaent AND icab001 = icaa001 WHERE icaaent = ",g_enterprise," AND icaastus = 'Y'",
                            "                     AND ((icaa003 = '2' OR icaa003 = '3') AND icaa004 = '1' AND icab002 = 0 AND icab003 = '",g_site,"')",
                            "                          OR (icaa003 = '3' AND icaa004 = '2' AND icab002 = (SELECT MAX(icab002) FROM icab_t WHERE icabent = icaaent AND icab001 = icaa001) AND icab003 = '",g_site,"')",
                            "                          OR (icaa005 = 'Y' AND (icaa003 = '2' OR icaa003 = '3') AND icaa004 = '2'  AND icab002 = 0 AND icab003 = '",g_site,"')",
                            "                 )",
                            "     )",
                            " )"
            #150610 earl add e

            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds006             #給予default值
            #採購收貨時開窗開採購單號
			   IF g_argv[1] MATCHES '[13]' THEN
			      LET g_qryparam.where = " pmdl005 NOT IN ('2','5','6') "
                                     # " AND pmdldocno IN (SELECT DISTINCT pmdndocno FROM pmdn_t WHERE pmdnent = '",g_enterprise,"' AND pmdnunit = '",g_site,"') "          
                                     
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_1  #150610 earl add
                                     
               CALL q_pmdldocno_7()                           #呼叫開窗
            END IF
            IF g_argv[1] = '8' OR g_argv[1] = '20' THEN   #委外採購
               LET g_qryparam.where = " pmdl005 ='2' " 
               
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_1  #150610 earl add
               
               CALL q_pmdldocno_7() 
            END IF
            IF g_argv[1] = '9' THEN   #重覆性生產採購
               LET g_qryparam.where = " pmdl005 ='5' "
               
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_1  #150610 earl add
               
               CALL q_pmdldocno_7() 
            END IF
            
            #借貨收貨單
            IF g_argv[1] = '23' OR g_argv[1] = '24' THEN
               LET g_qryparam.where = " pmdl005 ='6' " 
               
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_1  #150610 earl add
               
               CALL q_pmdldocno_7() 
            END IF
            
            #驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] MATCHES '[56]' THEN
               LET g_qryparam.arg1 = "('1','2')"
               
               LET g_qryparam.where = l_where_2  #150610 earl add
               
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            #倉退時開窗開收貨單號
            IF g_argv[1] MATCHES '[7]' THEN
               LET g_qryparam.arg1 = "('1','2','3','4')"
               
               LET g_qryparam.where = l_where_2  #150610 earl add
               
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            
            #委外驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '10' THEN   #委外驗退
               LET g_qryparam.arg1 = "('8')"
               
               LET g_qryparam.where = l_where_2  #150610 earl add
               
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '12' THEN   #委外入庫
               LET g_qryparam.arg1 = "('8')"
               LET g_qryparam.where = " (pmdt053 - pmdt054 > 0) "
               
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_2  #150610 earl add
               
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '14' THEN   #委外倉退
               LET g_qryparam.arg1 = "('8')"
               LET g_qryparam.where = " pmdt054 > 0 "
               
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_2  #150610 earl add
               
               CALL q_pmdsdocno() 
            END IF
            #重覆性生產驗退、入庫、倉退時開窗開收貨單號
            IF g_argv[1] = '11' THEN   #重覆性驗退
               LET g_qryparam.arg1 = "('9')"
               
               LET g_qryparam.where = l_where_2  #150610 earl add
               
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '13' THEN   #重覆性入庫
               LET g_qryparam.arg1 = "('9')"
               LET g_qryparam.where = " (pmdt053 - pmdt054 > 0 ) "
               
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_2  #150610 earl add
               
               CALL q_pmdsdocno() 
            END IF
            IF g_argv[1] = '15' THEN   #重覆性倉退
               LET g_qryparam.arg1 = "('9')"
               LET g_qryparam.where = " pmdt054 > 0 "
               
               LET g_qryparam.where = g_qryparam.where," AND ",l_where_2  #150610 earl add
               
               CALL q_pmdsdocno() 
            END IF
            
            #借貨入庫時開窗開借貨收貨單號
            IF g_argv[1] = '25' THEN
               LET g_qryparam.arg1 = "('23')"
               
               LET g_qryparam.where = l_where_2  #150610 earl add
               
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            #借貨倉退時開窗開借貨收貨單號
            IF g_argv[1] = '26' THEN
               LET g_qryparam.arg1 = "('23','24')"
               
               LET g_qryparam.where = l_where_2  #150610 earl add
               
               CALL q_pmdsdocno()                           #呼叫開窗
            END IF
            
            LET g_pmds_m.pmds006 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds006 TO pmds006              #顯示到畫面上

            NEXT FIELD pmds006                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds007" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds007             #給予default值

            LET g_qryparam.where = "1=1 "
            
            LET l_sql = ''
            CALL s_control_get_doc_sql("pmaa083",g_pmds_m.pmdsdocno,'2') RETURNING l_success,l_sql
            IF l_success THEN
               IF cl_null(l_sql) THEN
                  LET l_sql = " 1=1"
               END IF
               LET g_qryparam.where = g_qryparam.where ," AND ",l_sql
            END IF
            #給予arg

            CALL q_pmaa001_3()                                #呼叫開窗

            LET g_pmds_m.pmds007 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds007 TO pmds007              #顯示到畫面上
            
            CALL apmt520_pmds007_ref(g_pmds_m.pmds007) RETURNING g_pmds_m.pmds007_desc
            DISPLAY BY NAME g_pmds_m.pmds007_desc

            NEXT FIELD pmds007                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds008" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds008             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_pmds_m.pmds007
            LET g_qryparam.where = " pmac003 = '1' "  #付款
            
            LET l_sql = ''
            CALL s_control_get_doc_sql("pmaa083",g_pmds_m.pmdsdocno,'2') RETURNING l_success,l_sql
            IF l_success THEN
               IF cl_null(l_sql) THEN
                  LET l_sql = " 1=1"
               END IF
               LET g_qryparam.where = g_qryparam.where ," AND pmac002 IN ( SELECT pmaa001 FROM pmaa_t WHERE pmaaent = '",g_enterprise,"' AND ",l_sql,")"
            END IF
            CALL q_pmac002_2()                                #呼叫開窗

            LET g_pmds_m.pmds008 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds008 TO pmds008              #顯示到畫面上
            
            CALL apmt520_pmds007_ref(g_pmds_m.pmds008) RETURNING g_pmds_m.pmds008_desc
            DISPLAY BY NAME g_pmds_m.pmds008_desc

            NEXT FIELD pmds008                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds009" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds009             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_pmds_m.pmds007
            LET g_qryparam.where = " pmac003 = '2' "  #
            LET l_sql = ''
            CALL s_control_get_doc_sql("pmaa083",g_pmds_m.pmdsdocno,'2') RETURNING l_success,l_sql
            IF l_success THEN
               IF cl_null(l_sql) THEN
                  LET l_sql = " 1=1"
               END IF
               LET g_qryparam.where = g_qryparam.where ," AND pmac002 IN ( SELECT pmaa001 FROM pmaa_t WHERE pmaaent = '",g_enterprise,"' AND ",l_sql,")"
            END IF
            
            IF NOT cl_null(g_pmds_m.pmds006) THEN
               LET g_qryparam.where = g_qryparam.where ," AND pmac002 IN (SELECT pmdn023 FROM pmdn_t WHERE pmdnent = '",g_enterprise,"' AND pmdndocno = '",g_pmds_m.pmds006,"' )"
            END IF
            CALL q_pmac002_2()                          #呼叫開窗

            LET g_pmds_m.pmds009 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds009 TO pmds009              #顯示到畫面上
            
            CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
            DISPLAY BY NAME g_pmds_m.pmds009_desc

            NEXT FIELD pmds009                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds012" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds012             #給予default值
            LET g_qryparam.default2 = "" #g_pmds_m.oocq002 #應用分類碼
            #給予arg
            LET g_qryparam.arg1 = "275" #

            
            CALL q_oocq002()                                #呼叫開窗

            LET g_pmds_m.pmds012 = g_qryparam.return1              
            #LET g_pmds_m.oocq002 = g_qryparam.return2 
            DISPLAY g_pmds_m.pmds012 TO pmds012              #
            #DISPLAY g_pmds_m.oocq002 TO oocq002 #應用分類碼
            NEXT FIELD pmds012                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds013" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds013             #給予default值
            LET g_qryparam.default2 = "" #g_pmds_m.oocq002 #應用分類碼
            #給予arg
            LET g_qryparam.arg1 = "275" #

            
            CALL q_oocq002()                                #呼叫開窗

            LET g_pmds_m.pmds013 = g_qryparam.return1              
            #LET g_pmds_m.oocq002 = g_qryparam.return2 
            DISPLAY g_pmds_m.pmds013 TO pmds013              #
            CALL s_desc_get_acc_desc('275',g_pmds_m.pmds013) RETURNING g_pmds_m.pmds013_desc
            DISPLAY BY NAME g_pmds_m.pmds013_desc
            #DISPLAY g_pmds_m.oocq002 TO oocq002 #應用分類碼
            NEXT FIELD pmds013                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds031             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_pmds_m.pmds007 #

            CALL q_pmad002_2()                                #呼叫開窗

            LET g_pmds_m.pmds031 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds031 TO pmds031              #顯示到畫面上
            
            CALL s_desc_get_ooib002_desc(g_pmds_m.pmds031) RETURNING g_pmds_m.pmds031_desc
            DISPLAY BY NAME g_pmds_m.pmds031_desc
            NEXT FIELD pmds031                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds032             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "238" #

            CALL q_oocq002()                                #呼叫開窗

            LET g_pmds_m.pmds032 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds032 TO pmds032              #顯示到畫面上
            
            CALL s_desc_get_acc_desc('238',g_pmds_m.pmds032) RETURNING g_pmds_m.pmds032_desc
            DISPLAY BY NAME g_pmds_m.pmds032_desc
            
            NEXT FIELD pmds032                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds033             #給予default值

            #給予arg

            CALL q_oodb002_2()                                #呼叫開窗

            LET g_pmds_m.pmds033 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds033 TO pmds033              #顯示到畫面上
            
            CALL apmt520_pmds033_ref(g_pmds_m.pmds033) RETURNING g_pmds_m.pmds033_desc
            DISPLAY BY NAME g_pmds_m.pmds033_desc
            
            NEXT FIELD pmds033                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds037             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_site #

            CALL q_ooaj002_1()                                #呼叫開窗

            LET g_pmds_m.pmds037 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds037 TO pmds037              #顯示到畫面上
            
            CALL s_desc_get_currency_desc(g_pmds_m.pmds037) RETURNING g_pmds_m.pmds037_desc
            DISPLAY BY NAME g_pmds_m.pmds037_desc
            
            NEXT FIELD pmds037                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds039             #給予default值

            #給予arg

            CALL q_pmam001()                                #呼叫開窗

            LET g_pmds_m.pmds039 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds039 TO pmds039              #顯示到畫面上
            
            CALL s_desc_get_price_type_desc(g_pmds_m.pmds039) RETURNING g_pmds_m.pmds039_desc
            DISPLAY BY NAME g_pmds_m.pmds039_desc
            
            NEXT FIELD pmds039                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds040             #給予default值

            #給予arg

            CALL q_ooid001_2()                                #呼叫開窗

            LET g_pmds_m.pmds040 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmds040 TO pmds040              #顯示到畫面上
            
            CALL s_desc_ooid001_desc(g_pmds_m.pmds040) RETURNING g_pmds_m.pmds040_desc
            DISPLAY BY NAME g_pmds_m.pmds040_desc

            NEXT FIELD pmds040                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmds041" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            #此段落由子樣板a08產生
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds041             #給予default值

            LET l_where_1 = ''
            LET l_where_2 = ''

			   #有來源單號限制
			   IF NOT cl_null(g_pmds_m.pmds006) THEN
			      LET l_where_1 = " pmdsdocno IN (SELECT pmdsdocno FROM pmds_t",
			                      "                WHERE pmdsent = ",g_enterprise,
			                      "                  AND pmds050 = 'Y'",
			                      "                  AND pmdssite = (SELECT icab003 FROM icab_t ",
			                      "                                   WHERE icabent = ",g_enterprise,
			                      "                                     AND icab001 = pmds053",
			                      "                                     AND icab002 = (SELECT MAX(icab002) FROM icab_t",
			                      "                                                     WHERE icabent = ",g_enterprise,
			                      "                                                       AND icab001 = pmds053))",
			                      "                  AND pmds006 IN (SELECT pmdldocno FROM pmdl_t",
			                      "                                   WHERE pmdlent = ",g_enterprise,
                               "                                     AND pmdl031 IN (SELECT pmdl031 FROM pmdl_t",
                               "                                                      WHERE pmdlent = ",g_enterprise,
                               "                                                        AND pmdldocno = '",g_pmds_m.pmds006,"'",
                               "                                                    )",
                               "                                   UNION",
                               "                                  SELECT pmdsdocno FROM pmds_t",
			                      "                                   WHERE pmdsent = ",g_enterprise,
                               "                                     AND pmds041 IN (SELECT pmds041 FROM pmds_t",
                               "                                                      WHERE pmdsent = ",g_enterprise,
                               "                                                        AND pmdsdocno = '",g_pmds_m.pmds006,"'",
                               "                                                    )",
                               "                                 )",
                               
                               "              )"
                               
#			      LET l_where_2 = " pmdsdocno IN (SELECT pmdsdocno FROM pmds_t",
#			                      "                WHERE pmdsent = ",g_enterprise,
#			                      "                  AND pmds050 = 'Y'",
#			                      "                  AND pmdssite = (SELECT icab003 FROM icab_t ",
#			                      "                                   WHERE icabent = ",g_enterprise,
#			                      "                                     AND icab001 = pmds053",
#			                      "                                     AND icab002 = (SELECT MAX(icab002) FROM icab_t",
#			                      "                                                     WHERE icabent = ",g_enterprise,
#			                      "                                                       AND icab001 = pmds053))",
#			                      "                  AND pmds006 IN (SELECT pmdsdocno FROM pmds_t",
#			                      "                                   WHERE pmdsent = ",g_enterprise,
#                               "                                     AND pmds041 IN (SELECT pmds041 FROM pmds_t",
#                               "                                                      WHERE pmdsent = ",g_enterprise,
#                               "                                                        AND pmdsdocno = '",g_pmds_m.pmds006,"')))"
                               
#               CASE
#                  WHEN g_argv[1] = '5' OR 
#                       g_argv[1] = '6' OR 
#                       g_argv[1] = '7' OR 
#                       g_argv[1] = '10' OR 
#                       g_argv[1] = '11' OR 
#                       g_argv[1] = '12' OR 
#                       g_argv[1] = '13' OR
#                       g_argv[1] = '14' OR 
#                       g_argv[1] = '15' OR 
#                       g_argv[1] = '25' OR
#                       g_argv[1] = '26'
#                                 
#                       #來源為收貨單
#                       LET g_qryparam.where = l_where_2
#                  OTHERWISE
#                       #來源為採購單
                       LET g_qryparam.where = l_where_1
#               END CASE
               
            END IF

            LET g_qryparam.arg1 = g_argv[1]
            
            CALL q_pmds041_2()

            LET g_pmds_m.pmds041 = g_qryparam.return1
            
            DISPLAY g_pmds_m.pmds041 TO pmds041  #顯示到畫面上

            NEXT FIELD pmds041                     #返回原欄位
]]>
  </point>
  <point name="input.c.pmds042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmds053" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmds053             #給予default值

            #給予arg
            IF g_pmds_m.pmds014 = '2' THEN
               LET g_qryparam.where = " icaa003 = '2' "
            END IF
            IF g_pmds_m.pmds014 = '3' THEN
               LET g_qryparam.where = " icaa003 = '3' "
            END IF

            CALL q_icaa001_7()                                #呼叫開窗

            LET g_pmds_m.pmds053 = g_qryparam.return1

            DISPLAY g_pmds_m.pmds053 TO pmds053              #
            CALL s_desc_get_icaa001_desc(g_pmds_m.pmds053) RETURNING g_pmds_m.pmds053_desc
            DISPLAY BY NAME g_pmds_m.pmds053_desc

            NEXT FIELD pmds053                          #返回原欄位
]]>
  </point>
  <point name="input.c.pmdsdocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmdsdocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                #此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_pmds_m.pmdsdocno             #給予default值

            #給予arg
            LET g_qryparam.arg1 = l_ooef004 #
            LET g_qryparam.arg2 = g_prog #

            CALL q_ooba002_1()                                #呼叫開窗

            LET g_pmds_m.pmdsdocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_pmds_m.pmdsdocno TO pmdsdocno              #顯示到畫面上
            CALL s_aooi200_get_slip_desc(g_pmds_m.pmdsdocno) RETURNING g_pmds_m.pmdsdocno_desc
            DISPLAY BY NAME g_pmds_m.pmdsdocno_desc

            NEXT FIELD pmdsdocno                          #返回原欄位

]]>
  </point>
  <point name="input.c.pmdssite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.c.pmdsstus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.d.before_input" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #進入單身若單身沒有任何收貨項次且單頭沒有打採購單號時，自動呼叫apmt520_01子作業整批產生收貨單身資料
            #單頭有採購單號開窗詢問是否自動產生單身
            IF g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN #採購收貨單時
               LET l_n = 0 
               SELECT COUNT(*) INTO l_n FROM pmdt_t
                 WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
               IF l_n = 0 OR cl_null(l_n) THEN
                  CALL s_transaction_begin()
                  IF NOT cl_null(g_pmds_m.pmds006) THEN
                     IF l_flag THEN
                        IF cl_ask_confirm('apm-00384') THEN   #詢問是否自動產生單身
                           CALL apmt520_gen_pmdt()  #自動產生單身
                           CALL s_apmt520_gen_pmdu(g_pmds_m.pmdsdocno) RETURNING l_success
                           CALL apmt520_b_fill()
                           LET g_rec_b = g_pmdt_d.getLength()
                           IF g_rec_b > 0 THEN
                              CALL s_transaction_end('Y','0')
                              LET g_flag2 = TRUE
                              EXIT DIALOG
                           ELSE
                              CALL s_transaction_end('N','0')
                              LET g_flag2 = FALSE
                              NEXT FIELD pmdt001
                           END IF
                        END IF
                     END IF
                  ELSE
                     IF g_argv[1] MATCHES '[13]' OR g_argv[1] = '23' OR g_argv[1] = '24' THEN #採購收貨單時
                        IF apmt520_01(g_pmds_m.pmdsdocno) THEN
                           CALL s_apmt520_gen_pmdu(g_pmds_m.pmdsdocno) RETURNING l_success
                           CALL apmt520_b_fill()
                           LET g_rec_b = g_pmdt_d.getLength()
                           IF g_rec_b > 0 THEN
                              CALL s_transaction_end('Y','0')
                              LET g_flag2 = TRUE
                              EXIT DIALOG
                           ELSE
                              CALL s_transaction_end('N','0')
                              LET g_flag2 = FALSE
                              NEXT FIELD pmdt001
                           END IF
                        ELSE
                           CALL s_transaction_end('N','0')
                           LET g_flag2 = FALSE
                           NEXT FIELD pmdt001
                        END IF
                     END IF
                  END IF
               END IF
            END IF
            
            #單頭有採購收貨單號開窗詢問是否自動產生單身
            IF g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25' THEN #採購收貨入庫單時
               LET l_n = 0 
               SELECT COUNT(*) INTO l_n FROM pmdt_t
                 WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
               IF l_n = 0 OR cl_null(l_n) THEN
                  CALL s_transaction_begin()
                  IF NOT cl_null(g_pmds_m.pmds006) THEN
                     IF cl_ask_confirm('apm-00579') THEN   #詢問是否自動產生單身
                        CALL apmt520_receipt_gen_pmdt()  #自動產生單身
                        #CALL s_apmt520_gen_pmdu(g_pmds_m.pmdsdocno) RETURNING l_success
                        CALL apmt520_b_fill()
                        LET g_rec_b = g_pmdt_d.getLength()
                        IF g_rec_b > 0 THEN
                           CALL s_transaction_end('Y','0')
                           LET g_flag2 = TRUE
                           EXIT DIALOG
                        ELSE
                           CALL s_transaction_end('N','0')
                           LET g_flag2 = FALSE
                           NEXT FIELD pmdt028
                        END IF
                     END IF
                  END IF
               END IF
            END IF
            ]]>
  </point>
  <point name="input.define" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE  l_success    LIKE type_t.num5
   DEFINE  l_ooef004    LIKE ooef_t.ooef004
   DEFINE  l_rate       LIKE inaj_t.inaj014
   DEFINE  l_imaa005    LIKE imaa_t.imaa005
   DEFINE l_xrcd104     LIKE xrcd_t.xrcd104
   DEFINE l_xrcd113     LIKE xrcd_t.xrcd113
   DEFINE l_xrcd114     LIKE xrcd_t.xrcd114
   DEFINE l_xrcd115     LIKE xrcd_t.xrcd115
   DEFINE l_sql         STRING
   DEFINE l_ooef016     LIKE ooef_t.ooef016
   DEFINE l_scc40       LIKE type_t.chr2
   DEFINE l_oodbl004    LIKE oodbl_t.oodbl004  #稅別名稱
   DEFINE l_oodb005     LIKE oodb_t.oodb005    #含稅否
   DEFINE l_oodb006     LIKE oodb_t.oodb006    #稅率 
   DEFINE l_oodb011     LIKE oodb_t.oodb011    #取得稅別類型1:正常稅率2:依料件設定
   DEFINE l_pmds000     LIKE pmds_t.pmds000  
   DEFINE l_pmdn042     LIKE pmdn_t.pmdn042
   DEFINE l_pmdtseq     LIKE pmdt_t.pmdtseq
   DEFINE  l_inam          DYNAMIC ARRAY OF RECORD   #記錄產品特徵
              inam001      LIKE inam_t.inam001,
              inam002      LIKE inam_t.inam002,
              inam004      LIKE inam_t.inam004
                        END RECORD
   DEFINE l_pmdt           RECORD LIKE pmdt_t.*
   DEFINE l_ac_t        LIKE type_t.num5
   DEFINE l_flag        LIKE type_t.num5  #用於判斷收貨單進單身時，是否再次詢問是否根據採購單頭自動產生單身
   DEFINE l_gzcbl004    LIKE gzcbl_t.gzcbl004
   DEFINE l_ooba002     LIKE ooba_t.ooba002
   DEFINE l_pmdt020     LIKE pmdt_t.pmdt020
   DEFINE l_pmdt039     LIKE pmdt_t.pmdt039
   DEFINE l_where_1     STRING   #150610 earl add
   DEFINE l_where_2     STRING   #150610 earl add]]>
  </point>
  <point name="input.define_sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.define_sql2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.define_sql3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.pmdt001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt053" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt054" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdt061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdtseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page1.pmdtsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdu016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page2.pmdusite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdv019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdvseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdvseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.page3.pmdvsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds000" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmds045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmdsdocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmdsdocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmdssite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.g.pmdsstus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.head.a_insert" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               
               #150617 earl mod s
               #中斷續拋，直接由最終站將資料帶出
               IF apmt520_break_continue(g_pmds_m.pmds053) THEN
               
                  CALL apmt520_default(g_pmds_m.pmdsdocno,g_pmds_m.pmds006,g_pmds_m.pmds053,g_pmds_m.pmds041)
                  RETURNING l_success
                  
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     CONTINUE DIALOG
                  END IF
                  
                  LET l_flag = FALSE
                   
                  CALL apmt520_b_fill()
               
               ELSE
               
                  CALL s_transaction_end('Y','0') 

                  LET g_master_insert = TRUE
               
                  #LET p_cmd = 'u'
               
                  #單頭有採購單號開窗詢問是否自動產生單身
                  IF (g_argv[1] MATCHES '[1389]' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '20') AND l_cmd_t <> 'r' THEN #採購收貨單時
                     LET l_n = 0 
                     SELECT COUNT(*) INTO l_n FROM pmdt_t
                       WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
                     IF l_n = 0 OR cl_null(l_n) THEN
                        CALL s_transaction_begin()
                        IF NOT cl_null(g_pmds_m.pmds006) THEN
                           IF cl_ask_confirm('apm-00384') THEN   #詢問是否自動產生單身
                              LET l_flag = FALSE
                              CALL apmt520_gen_pmdt()  #自動產生單身
                              CALL s_apmt520_gen_pmdu(g_pmds_m.pmdsdocno) RETURNING l_success
                              CALL apmt520_b_fill()
                              LET p_cmd = 'u'
                              LET g_rec_b = g_pmdt_d.getLength()
                              IF g_rec_b > 0 THEN
                                 CALL s_transaction_end('Y','0')
                                 LET g_flag2 = TRUE
                                 EXIT DIALOG
                              ELSE
                                 CALL s_transaction_end('N','0')
                                 LET g_flag2 = FALSE
                                 NEXT FIELD pmdt001
                              END IF
                           ELSE
                               LET l_flag = FALSE
                           END IF
                        END IF
                     END IF
                  END IF
                  
               END IF
               
               #150617 earl mod e
               ]]>
  </point>
  <point name="input.head.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.head.after_input" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF cl_null(g_pmds_m.pmds006) AND g_pmds_m.pmds100 = '2' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'apm-00656'
               LET g_errparam.extend = g_pmds_m.pmdsdocno
               LET g_errparam.popup = TRUE
               CALL cl_err()
               NEXT FIELD pmds100
            END IF
          ]]>
  </point>
  <point name="input.head.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL s_aooi200_gen_docno(g_site,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_prog) RETURNING l_success,g_pmds_m.pmdsdocno
               IF NOT l_success THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'apm-00003'
                  LET g_errparam.extend = g_pmds_m.pmdsdocno
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD pmdsdocno
               END IF                ]]>
  </point>
  <point name="input.head.b_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.head.m_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="input.head.m_update" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
               #150617 earl add s
               #中斷續拋，直接由最終站將資料帶出
               IF apmt520_break_continue(g_pmds_m.pmds053) THEN
               
                  CALL apmt520_default(g_pmds_m.pmdsdocno,g_pmds_m.pmds006,g_pmds_m.pmds053,g_pmds_m.pmds041)
                  RETURNING l_success
                  
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     CONTINUE DIALOG
                  END IF
                  
                  CALL apmt520_b_fill()
               END IF
               #150617 earl add e
               ]]>
  </point>
  <point name="input.m.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="input.more_input" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ON ACTION open_apmt520_03
         LET g_action_choice="open_apmt520_03"
         IF cl_auth_chk_act("open_apmt520_03") THEN
            IF l_ac > 0 THEN
               CALL s_transaction_begin()
               IF NOT apmt520_03('2',g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt021) THEN
                  CALL s_transaction_end('N','0')
               ELSE
                  #若維護了多筆庫儲批資料，則更新多庫儲批否為'Y'
                  SELECT COUNT(*) INTO l_n FROM pmdu_t WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND pmduseq = g_pmdt_d[l_ac].pmdtseq
                  IF l_n > 1 AND g_pmdt_d[l_ac].pmdt062 = 'N' THEN
                     UPDATE pmdt_t SET pmdt062 = 'Y' WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND pmdtseq = g_pmdt_d[l_ac].pmdtseq
                  END IF
                  CALL s_transaction_end('Y','0')
               END IF
               CALL apmt520_b_fill()
            END IF
         END IF                  ]]>
  </point>
  <point name="input.other_sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="insert.after_insert" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="insert.default" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      CALL g_pmdt4_d.clear()  
      
      IF NOT cl_null(g_argv[1]) THEN
         LET g_pmds_m.pmds000 = g_argv[1]
      END IF
      
      LET g_pmds_m.pmdssite = g_site
      LET g_pmds_m.pmdsstus = "N"
      
      LET g_pmds_m.pmdsdocdt = g_today
      
      LET g_pmds_m.pmds001 = g_today  #扣賬日期
      
      LET g_pmds_m.pmds002 = g_user
      LET g_pmds_m.pmds003 = g_dept
      
      LET g_pmds_m.pmds011 = "1"
      
      IF g_argv[1] = '8' OR g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14' OR g_argv[1] = '20' THEN
         LET g_pmds_m.pmds011 = "2"
      END IF
      IF g_argv[1] = '9' OR g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' THEN
         LET g_pmds_m.pmds011 = "5"
      END IF
      IF g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
         LET g_pmds_m.pmds011 = "6"
      END IF
      
      
      LET g_pmds_m.pmds100 = "3"
      
      #委外倉退的倉退方式只能選4.倉退折讓，其他的都不能選，請在輸入時限制
      IF g_argv[1] = '14' THEN
         LET g_pmds_m.pmds100 = "4"
      END IF
      
      #借貨歸還單，倉退類型預設為1
      IF g_argv[1] = '26' THEN
         LET g_pmds_m.pmds100 = "1"
      END IF
      
      CALL s_desc_get_person_desc(g_pmds_m.pmds002) RETURNING g_pmds_m.pmds002_desc
      CALL s_desc_get_department_desc(g_pmds_m.pmds003) RETURNING g_pmds_m.pmds003_desc
      DISPLAY BY NAME g_pmds_m.pmds002_desc,g_pmds_m.pmds003_desc
      
      INITIALIZE g_pmds_m_t.* TO NULL
      LET g_pmds_m_t.*  = g_pmds_m.* 
      LET g_pmds_m_o.*  = g_pmds_m.* 
      ]]>
  </point>
  <point name="insert.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="insert_b.after_insert" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      #數量欄位賦 0
      UPDATE pmdt_t  
       SET pmdt056 = 0,
           pmdt057 = 0,
           pmdt058 = 0,
           pmdt066 = 0,
           pmdt067 = 0,
           pmdt068 = 0,
           pmdt069 = 0 
        WHERE pmdtent = g_enterprise AND pmdtdocno = ps_keys[1] AND pmdtseq = ps_keys[2]           ]]>
  </point>
  <point name="insert_b.after_insert2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="insert_b.after_insert3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="insert_b.before_insert" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[     
      #產品特征為null時，給空格
      IF cl_null(g_pmdt_d[g_detail_idx].pmdt007) THEN
         LET g_pmdt_d[g_detail_idx].pmdt007 = ' '
      END IF 
      
      #儲位、批號 若為空，給一個空格
      IF cl_null(g_pmdt_d[g_detail_idx].pmdt017) THEN
         LET g_pmdt_d[g_detail_idx].pmdt017 = ' '
      END IF 

      IF cl_null(g_pmdt_d[g_detail_idx].pmdt018) THEN
         LET g_pmdt_d[g_detail_idx].pmdt018 = ' '
      END IF
      
      
      #直接收貨入庫時，無需檢驗
      IF g_argv[1] MATCHES '[34]' OR g_argv[1] = '24' OR g_argv[1] = '20' THEN
         LET g_pmdt_d[g_detail_idx].pmdt026 = 'N'
      END IF
      
      #自立應付欄位是判斷多角時是不是要自立帳款，所以在一般的採購入庫/倉退與銷售出貨/銷退流程新增時,此欄位均預設為’Y’
      IF g_argv[1] MATCHES '[3467]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
         LET g_pmdt_d[g_detail_idx].pmdt084 = 'Y'
      ELSE
         LET g_pmdt_d[g_detail_idx].pmdt084 = 'N'
      END IF
      
      IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '25' THEN 
         IF g_pmdt_d[g_detail_idx].pmdt026 = 'Y' THEN
            LET g_pmdt_d[g_detail_idx].pmdt062 = 'N'         
         END IF
      ELSE
         IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "N"  OR (NOT apmt520_get_imaf144(g_pmdt_d[g_detail_idx].pmdt006)) THEN
            LET g_pmdt_d[g_detail_idx].pmdt023 = g_pmdt_d[g_detail_idx].pmdt019
            LET g_pmdt_d[g_detail_idx].pmdt024 = g_pmdt_d[g_detail_idx].pmdt020
         END IF
      END IF
      
      #未稅金額、含稅金額
      IF (NOT cl_null(g_pmdt_d[g_detail_idx].pmdt024)) AND (NOT cl_null(g_pmdt_d[g_detail_idx].pmdt046)) THEN
         CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[g_detail_idx].pmdtseq,g_pmdt_d[g_detail_idx].pmdt001,g_pmdt_d[g_detail_idx].pmdt024,g_pmdt_d[g_detail_idx].pmdt036,g_pmdt_d[g_detail_idx].pmdt046)
           RETURNING g_pmdt_d[g_detail_idx].pmdt038,g_pmdt_d[g_detail_idx].pmdt047,g_pmdt_d[g_detail_idx].pmdt039            
      END IF
      ]]>
  </point>
  <point name="insert_b.before_insert2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="insert_b.before_insert3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="insert_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="insert_b.m_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="insert_b.m_insert2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="insert_b.m_insert3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="insert_b.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="lock_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="lock_b.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="main.after_define_sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="main.before_close" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="main.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="main.define_sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="main.exit" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="main.init" order="" ver="12" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF NOT cl_null(g_argv[1]) THEN
      LET g_pmds_m.pmds000 = g_argv[1]
   END IF
   
   CALL s_tax_recount_tmp()
   
   LET g_acc = ''
   #抓取[T:系統分類值檔].[C:系統分類碼]=24且[T:系統分類值檔].[C:系統分類碼]=g_prog 的[T:系統分類值檔].[C:參考欄位>
   SELECT gzcb004 INTO g_acc FROM gzcb_t WHERE gzcb001 = '24' AND gzcb002 = g_prog 
   
   #品管參照表編號
   LET g_ooef025 = ''
   SELECT ooef025 INTO g_ooef025 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = g_site
   
   LET g_flag2 = FALSE
   #LET g_flag3 = TRUE
   LET g_upd_price = TRUE]]>
  </point>
  <point name="main.servicecall" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="menu.default.insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="menu.delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="menu.demo" order="" ver="4" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL aooi360_02('6',g_prog,g_pmds_m.pmdsdocno,'','','','','','','','','')]]>
  </point>
  <point name="menu.detail_show.page1_sub.prog_apmt500" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                     #應用 a41 樣板自動產生(Version:2)
                     #使用JSON格式組合參數與作業編號(串查)
                     
                     #抓取單據別
                     LET l_slip = ''
                     LET l_prog = ''
                     IF l_ac > 0 THEN
                        IF NOT cl_null(g_pmdt_d[l_ac].pmdt001) THEN
                           CALL s_aooi200_get_slip(g_pmdt_d[l_ac].pmdt001) RETURNING l_success,l_slip
                           IF NOT cl_null(l_slip) THEN
                              SELECT oobx004 INTO l_prog
                                FROM oobx_t
                               WHERE oobxent = g_enterprise
                                 AND oobx001 = l_slip
                           END IF
                           IF NOT cl_null(l_prog) THEN
                              INITIALIZE la_param.* TO NULL
                              LET la_param.prog     = l_prog
                              LET la_param.param[1] = g_pmdt_d[l_ac].pmdt001
                              
                              LET ls_js = util.JSON.stringify(la_param)
                              CALL cl_cmdrun(ls_js)
                           END IF
                        END IF
                     END IF]]>
  </point>
  <point name="menu.detail_show.page3_sub.prog_apmt400" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                     #應用 a41 樣板自動產生(Version:2)
                     #使用JSON格式組合參數與作業編號(串查)
                     #抓取單據別
                     LET l_slip = ''
                     LET l_prog = ''
                     IF l_ac > 0 THEN
                        IF NOT cl_null(g_pmdt3_d[l_ac].pmdv014) THEN
                           CALL s_aooi200_get_slip(g_pmdt3_d[l_ac].pmdv014) RETURNING l_success,l_slip
                           IF NOT cl_null(l_slip) THEN
                              SELECT oobx004 INTO l_prog
                                FROM oobx_t
                               WHERE oobxent = g_enterprise
                                 AND oobx001 = l_slip
                           END IF
                           IF NOT cl_null(l_prog) THEN
                              INITIALIZE la_param.* TO NULL
                              LET la_param.prog     = l_prog
                              LET la_param.param[1] = g_pmdt3_d[l_ac].pmdv014
                             
                              LET ls_js = util.JSON.stringify(la_param)
                              CALL cl_cmdrun(ls_js)
                           END IF
                        END IF
                     END IF
]]>
  </point>
  <point name="menu.exporttoexcel" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                  LET g_export_node[4] = base.typeInfo.create(g_pmdt4_d)
                  LET g_export_id[4]   = "s_detail4"]]>
  </point>
  <point name="menu.gen_check_back" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF apmt520_gen_check_back() THEN
                  IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                     CASE g_argv[1]
                        WHEN '1' LET la_param.prog = 'apmt560'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                        WHEN '2' LET la_param.prog = 'apmt560'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                        WHEN '8' LET la_param.prog = 'apmt561'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                        WHEN '9' LET la_param.prog = 'apmt563'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                     END CASE
                     #CALL cl_cmdrun_wait(ls_js)
                     CALL cl_cmdrun(ls_js)
                  END IF
               END IF]]>
  </point>
  <point name="menu.gen_iqc" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL apmt520_gen_iqc()]]>
  </point>
  <point name="menu.gen_pmdt" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                  CALL s_transaction_begin()
                  IF NOT apmt520_01(g_pmds_m.pmdsdocno) THEN
                     CALL s_transaction_end('N','0')
                  ELSE
                     CALL s_apmt520_gen_pmdu(g_pmds_m.pmdsdocno) RETURNING l_success
                     CALL s_transaction_end('Y','0')
                  END IF
                  CALL apmt520_b_fill()
               END IF   ]]>
  </point>
  <point name="menu.gen_pmdv" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF (NOT cl_null(g_pmds_m.pmdsdocno)) AND (NOT cl_null(g_pmdt_d[l_ac].pmdtseq)) THEN
                  CALL apmt520_02(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq)
                  CALL apmt520_b_fill()
               END IF]]>
  </point>
  <point name="menu.gen_pmdw" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                  CALL apmt520_05(g_pmds_m.pmdsdocno)
               END IF]]>
  </point>
  <point name="menu.gen_purchase" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL apmt520_gen_purchase()
               #串查到採購單
               IF NOT cl_null(g_pmdldocno) THEN
                  CASE g_argv[1]
                     WHEN '7' LET la_param.prog = 'apmt500'
                              LET la_param.param[1] = g_pmdldocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '14' LET la_param.prog = 'apmt501'
                              LET la_param.param[1] = g_pmdldocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '15' LET la_param.prog = 'apmt503'
                              LET la_param.param[1] = g_pmdldocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '26' LET la_param.prog = 'apmt504'
                              LET la_param.param[1] = g_pmdldocno
                              LET ls_js = util.JSON.stringify( la_param )
                  END CASE
                  #CALL cl_cmdrun_wait(ls_js)
                  CALL cl_cmdrun(ls_js)
                  LET g_pmdldocno = ''
               END IF]]>
  </point>
  <point name="menu.gen_qc" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL apmt520_gen_iqc()]]>
  </point>
  <point name="menu.gen_warehouse_voucher" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF apmt520_gen_warehouse_voucher() THEN
                  #串查到入庫單
                  IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                     CASE g_argv[1]
                        WHEN '1' LET la_param.prog = 'apmt570'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                        WHEN '2' LET la_param.prog = 'apmt570'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                        WHEN '8' LET la_param.prog = 'apmt571'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                        WHEN '9' LET la_param.prog = 'apmt573'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                        WHEN '23' LET la_param.prog = 'apmt574'
                                 LET la_param.param[1] = ''
                                 LET la_param.param[2] = g_pmds_m.pmdsdocno
                                 LET ls_js = util.JSON.stringify( la_param )
                     END CASE
                     #CALL cl_cmdrun_wait(ls_js)
                     CALL cl_cmdrun(ls_js)
                  END IF
               END IF]]>
  </point>
  <point name="menu.get_detail_price" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF cl_ask_promp('apm-00801') THEN
                  CALL apmt520_get_detail_price()
               END IF]]>
  </point>
  <point name="menu.insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="menu.modify" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="menu.modify_detail" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="menu.open_apmt520_03" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               LET l_ac = ARR_CURR()
               IF l_ac > 0 THEN
                  #如果有維護多庫儲批
                  CALL s_transaction_begin()
                  IF NOT apmt520_03('2',g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq,'','','','','','','') THEN
                     CALL s_transaction_end('N','0')
                  ELSE
                     #若維護了多筆庫儲批資料，則更新多庫儲批否為'Y'
                     SELECT COUNT(*) INTO l_n FROM pmdu_t WHERE pmduent = g_enterprise AND pmdudocno = g_pmds_m.pmdsdocno AND pmduseq = g_pmdt_d[l_ac].pmdtseq
                     IF l_n > 1 AND g_pmdt_d[l_ac].pmdt062 = 'N' THEN
                        UPDATE pmdt_t SET pmdt062 = 'Y' WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno AND pmdtseq = g_pmdt_d[l_ac].pmdtseq
                     END IF
                     CALL s_transaction_end('Y','0')
                  END IF
                  CALL apmt520_b_fill()
                  
               END IF]]>
  </point>
  <point name="menu.output" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #CALL apmr520_g01("pmdsent ="|| g_enterprise ||" AND pmdsdocno ='"|| g_pmds_m.pmdsdocno||"'",'Y','Y')
               LET g_rep_wc = "pmdsent ="|| g_enterprise ||" AND pmdsdocno ='"|| g_pmds_m.pmdsdocno||"'"               ]]>
  </point>
  <point name="menu.prog_pmds002" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #+ 此段落由子樣板a45產生
               CALL cl_user_contact("aooi130", "ooag_t", "ooag002", "ooag001",'')

]]>
  </point>
  <point name="menu.prog_pmds006" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #應用 a41 樣板自動產生(Version:2)
               #使用JSON格式組合參數與作業編號(串查)
               #抓取單據別
               LET l_slip = ''
               LET l_prog = ''
               IF NOT cl_null(g_pmds_m.pmds006) THEN
                  CALL s_aooi200_get_slip(g_pmds_m.pmds006) RETURNING l_success,l_slip
                  IF NOT cl_null(l_slip) THEN
                     SELECT oobx004 INTO l_prog
                       FROM oobx_t
                      WHERE oobxent = g_enterprise
                        AND oobx001 = l_slip
                  END IF
                  IF NOT cl_null(l_prog) THEN
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = l_prog
                     LET la_param.param[1] = g_pmds_m.pmds006
                     
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun(ls_js)
                  END IF
               END IF]]>
  </point>
  <point name="menu.query" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="menu.query_aapt110_01" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #發票訊息查詢
               IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                  CALL aapt110_01(g_pmds_m.pmdsdocno,0)
               END IF]]>
  </point>
  <point name="menu.query_check_back" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #串查到驗退單
               IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                  CASE g_argv[1]
                     WHEN '1' LET la_param.prog = 'apmt560'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '2' LET la_param.prog = 'apmt560'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '8' LET la_param.prog = 'apmt561'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '9' LET la_param.prog = 'apmt563'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                  END CASE
                  #CALL cl_cmdrun_wait(ls_js)
                  CALL cl_cmdrun(ls_js)
               END IF]]>
  </point>
  <point name="menu.query_detail_aapt110_01" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #明細發票查詢
               IF (NOT cl_null(g_pmds_m.pmdsdocno)) AND l_ac > 0 THEN
                  CALL aapt110_01(g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtseq)
               END IF]]>
  </point>
  <point name="menu.query_qc" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                  LET la_param.prog = 'aqct300'
                  LET la_param.param[1] = ''
                  LET la_param.param[2] = ''
                  LET la_param.param[3] = g_pmds_m.pmdsdocno
                  LET ls_js = util.JSON.stringify( la_param )
                  CALL cl_cmdrun(ls_js)
               END IF]]>
  </point>
  <point name="menu.query_warehouse_voucher" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               #串查到入庫單
               IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
                  CASE g_argv[1]
                     WHEN '1' LET la_param.prog = 'apmt570'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '2' LET la_param.prog = 'apmt570'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '8' LET la_param.prog = 'apmt571'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '9' LET la_param.prog = 'apmt573'
                              LET la_param.param[1] = ''
                              LET la_param.param[2] = g_pmds_m.pmdsdocno
                              LET ls_js = util.JSON.stringify( la_param )
                     WHEN '23' LET la_param.prog = 'apmt574'
                               LET la_param.param[1] = ''
                               LET la_param.param[2] = g_pmds_m.pmdsdocno
                               LET ls_js = util.JSON.stringify( la_param )
                  END CASE
                  #CALL cl_cmdrun_wait(ls_js)
                  CALL cl_cmdrun(ls_js)
               END IF]]>
  </point>
  <point name="menu.reproduce" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="menu.store_in_by_qc" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL s_transaction_begin()
               IF NOT s_apmt520_gen_store_in_by_iqc(g_pmds_m.pmdsdocno) THEN
                  CALL s_transaction_end('N','0')
               ELSE
                  CALL s_transaction_end('Y','0')
                  CALL apmt520_b_fill()
               END IF]]>
  </point>
  <point name="menu.upd_pmds052" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL apmt520_upd_pmds052()]]>
  </point>
  <point name="menu.upd_pmds081" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               CALL apmt520_upd_pmds081()]]>
  </point>
  <point name="menu.upd_price" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               
               CALL apmt520_upd_price()
              ]]>
  </point>
  <point name="modify.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="modify.after_show" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   #IF g_pmds_m.pmdsstus <> 'N' THEN
   IF g_pmds_m.pmdsstus NOT MATCHES "[NDR]" THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_pmds_m.pmdsdocno
      LET g_errparam.code   = "apm-00035" 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF]]>
  </point>
  <point name="modify.before_input" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      #「D抽單 / R已拒絕」狀況碼更改資料後，需還原為「N未確認」
      IF g_pmds_m.pmdsstus MATCHES "[DR]" THEN 
         LET g_pmds_m.pmdsstus = "N"
      END IF
        ]]>
  </point>
  <point name="modify.body.a_fk_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.a_fk_update2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.a_fk_update3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.b_fk_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.b_fk_update2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.b_fk_update3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.m_fk_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.m_fk_update2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.body.m_fk_update3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="modify.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="query.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="query.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="reproduce.after_reproduce" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="reproduce.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="reproduce.head.b_input" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   
   CALL s_desc_get_person_desc(g_pmds_m.pmdsownid) RETURNING g_pmds_m.pmdsownid_desc
   DISPLAY BY NAME g_pmds_m.pmdsownid_desc
   
   CALL s_desc_get_person_desc(g_pmds_m.pmdscrtid) RETURNING g_pmds_m.pmdscrtid_desc
   DISPLAY BY NAME g_pmds_m.pmdscrtid_desc

   CALL s_desc_get_department_desc(g_pmds_m.pmdsowndp) RETURNING g_pmds_m.pmdsowndp_desc
   DISPLAY BY NAME g_pmds_m.pmdsowndp_desc
   
   CALL s_desc_get_department_desc(g_pmds_m.pmdscrtdp) RETURNING g_pmds_m.pmdscrtdp_desc
   DISPLAY BY NAME g_pmds_m.pmdscrtdp_desc
   
   LET g_pmds_m.pmdsmodid = ''
   LET g_pmds_m.pmdscnfid = ''
   LET g_pmds_m.pmdscnfid_desc = ''
   LET g_pmds_m.pmdscnfdt = ''
   LET g_pmds_m.pmdspstid = ''
   LET g_pmds_m.pmdspstid_desc = ''
   LET g_pmds_m.pmdspstdt = ''
      
   LET g_pmds_m.pmdsdocdt = g_today
   LET g_pmds_m.pmds002 = g_user
   CALL s_desc_get_person_desc(g_pmds_m.pmds002) RETURNING g_pmds_m.pmds002_desc
   DISPLAY BY NAME g_pmds_m.pmds002_desc
   LET g_pmds_m.pmds003 = g_dept
   CALL s_desc_get_department_desc(g_pmds_m.pmds003) RETURNING g_pmds_m.pmds003_desc
   DISPLAY BY NAME g_pmds_m.pmds003_desc
            
   ]]>
  </point>
  <point name="send.before_send" order="" ver="10" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   #確認前檢核段
   IF NOT s_apmt520_conf_chk(g_pmds_m.pmdsdocno) THEN 
      CLOSE apmt520_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF]]>
  </point>
  <point name="set_act_no_visible.define" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_n1       LIKE type_t.num5
   DEFINE l_n2       LIKE type_t.num5
   DEFINE l_cnt      LIKE type_t.num5
   ]]>
  </point>
  <point name="set_act_no_visible.set_act_no_visible" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF g_pmds_m.pmdsstus <> 'N' THEN
      #CALL cl_set_act_visible("modify,delete,modify_detail,get_detail_price",FALSE)
      CALL cl_set_act_visible("get_detail_price",FALSE)
   END IF
   IF g_pmds_m.pmdsstus NOT MATCHES '[NY]' THEN
      CALL cl_set_act_visible("open_apmt520_03",FALSE)
   END IF
   
   IF NOT ((g_argv[1] MATCHES '[13]' OR g_argv[1] = '23' OR g_argv[1] = '24') AND g_pmds_m.pmdsstus = 'N') THEN   #採購收貨單
      CALL cl_set_act_visible("gen_pmdt,gen_pmdv",FALSE)
   END IF

   #只有無採購單時，複製功能才有意義，其他有來源單據，都是根據來源單據帶值
   IF g_argv[1] NOT MATCHES '[24]' THEN
      CALL cl_set_act_visible("reproduce",FALSE)
   END IF
   
   #驗退、倉退下顯示取回日期，取回功能
   IF NOT (g_argv[1] MATCHES '[57]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') THEN
      CALL cl_set_act_visible("upd_pmds081",FALSE)
   END IF 
   
   #驗退、倉退下隱藏供應商出貨日功能
   IF g_argv[1] MATCHES '[57]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26' THEN
      CALL cl_set_act_visible("upd_pmds052",FALSE)
   END IF 
   
   ##入庫、倉退下顯示可以修改價格
   IF g_argv[1] MATCHES '[3467]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
      #未轉應付之前都可以變更價格
      LET l_n1 = 0
      #單頭來源單號
      #SELECT COUNT(*) INTO l_n1 FROM apca_t 
      #   WHERE apcaent = g_enterprise AND (apca016 = "apmt570" OR apca016 = "APMT570") AND apca018 = g_pmds_m.pmdsdocno AND apcastus <> 'X'
      SELECT COUNT(*) INTO l_n1 FROM apca_t 
         WHERE apcaent = g_enterprise AND apca018 = g_pmds_m.pmdsdocno AND apcastus <> 'X'
      LET l_n2 = 0
      ##單身來源單號
      #SELECT COUNT(*) INTO l_n2 FROM apcb_t,apca_t 
      #   WHERE apcaent = apcbent AND apcald = apcbld AND apcadocno = apcbdocno AND apcastus <> 'X'
      #     AND apcbent = g_enterprise AND (apcb001 = "apmt570" OR apca016 = "APMT570") AND apcb002 = g_pmds_m.pmdsdocno
      #單身來源單號
      SELECT COUNT(*) INTO l_n2 FROM apcb_t,apca_t 
         WHERE apcaent = apcbent AND apcald = apcbld AND apcadocno = apcbdocno AND apcastus <> 'X'
           AND apcbent = g_enterprise AND apcb002 = g_pmds_m.pmdsdocno
      IF l_n1 > 0 OR l_n2 > 0 THEN
         #CALL cl_set_act_visible("upd_price",FALSE)
         LET g_upd_price = FALSE
      END IF
   ELSE
      LET g_upd_price = FALSE
   END IF 
   
   #收貨單 下 可以顯示產生入庫單
   IF NOT (g_argv[1] MATCHES '[1289]' OR g_argv[1] = '23')  THEN
      CALL cl_set_act_visible("gen_warehouse_voucher,gen_check_back,gen_qc,query_qc",FALSE)
   ELSE
      #检查入庫單對應的收貨單单身是否有IQC项次
      LET l_cnt = 0 
      SELECT COUNT(*) INTO l_cnt FROM pmdt_t
        WHERE pmdtent   = g_enterprise
          AND pmdtdocno = g_pmds_m.pmdsdocno
          AND pmdt026   = 'Y'  
      IF cl_null(l_cnt) THEN LET l_cnt = 0 END IF
      IF l_cnt = 0 THEN
         CALL cl_set_act_visible("gen_qc,query_qc",FALSE)
      END IF
   END IF
   
   IF g_pmds_m.pmdsstus <> 'Y' THEN
      CALL cl_set_act_visible("gen_qc,query_qc",FALSE)
   END IF
   
   #入庫 顯示根據IQC結果重新產生入庫單身明細
   IF NOT (g_argv[1] MATCHES '[6]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25')  THEN
      CALL cl_set_act_visible("store_in_by_qc",FALSE)
   ELSE
       #检查入庫單對應的收貨單单身是否有IQC项次
      LET l_cnt = 0 
      SELECT COUNT(*) INTO l_cnt FROM pmdt_t
        WHERE pmdtent   = g_enterprise
          AND pmdtdocno = g_pmds_m.pmds006
          AND pmdt026   = 'Y'  
      IF cl_null(l_cnt) THEN LET l_cnt = 0 END IF
      IF l_cnt = 0 THEN
         CALL cl_set_act_visible("store_in_by_qc",FALSE)
      END IF
   END IF
   
   IF g_pmds_m.pmdsstus <> 'N' THEN
      CALL cl_set_act_visible("store_in_by_qc",FALSE)
   END IF
   
   #當倉退方式為2,3時才可以執行此action產生新的一張採購單
   IF NOT (g_argv[1] MATCHES '[7]' AND g_pmds_m.pmdsstus MATCHES '[S]' AND g_pmds_m.pmds100 MATCHES '[3]' ) THEN
      CALL cl_set_act_visible("gen_purchase",FALSE)
   END IF
   
   IF g_pmds_m.pmdsstus = 'X' THEN   #作廢
      CALL cl_set_act_visible("upd_pmds081,upd_pmds052,upd_price",FALSE)
      #CALL cl_set_act_visible("upd_pmds081,upd_pmds052",FALSE)
      #LET g_upd_price = FALSE
   END IF
   
   #單身無資料，不顯示重新取價ACTION
   LET l_cnt = 0
   SELECT COUNT(*) INTO l_cnt FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
   IF l_cnt = 0 THEN
      CALL cl_set_act_visible("get_detail_price,open_apmt520_03",FALSE)
   END IF
   
   IF g_pmds_m.pmdsstus NOT MATCHES "[NDR]" THEN   # N未確認/D抽單/R已拒絕允許修改
      CALL cl_set_act_visible("modify,delete,modify_detail", FALSE)
   END IF
]]>
  </point>
  <point name="set_act_visible.set_act_visible" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL cl_set_act_visible("modify,delete,modify_detail,open_apmt520_03",TRUE)
   
   CALL cl_set_act_visible("gen_pmdt,gen_pmdv",TRUE)   
   
   #只有無採購單時，複製功能才有意義，其他有來源單據，都是根據來源單據帶值
   CALL cl_set_act_visible("reproduce",TRUE)   
   
   #驗退、倉退下顯示取回日期，取回功能
   CALL cl_set_act_visible("upd_pmds081,upd_pmds052",TRUE) 
  
   #入庫、倉退下顯示可以修改價格
   CALL cl_set_act_visible("upd_price",TRUE) 
  
   #收貨單 下 可以顯示產生入庫單
   CALL cl_set_act_visible("gen_warehouse_voucher,gen_check_back,query_check_back,query_warehouse_voucher",TRUE) 
   
   #當倉退方式為2,3時才可以執行此action產生新的一張採購單
   CALL cl_set_act_visible("gen_purchase",TRUE)
   
   CALL cl_set_act_visible("gen_qc,store_in_by_qc,get_detail_price,query_qc",TRUE)
   
   LET g_upd_price = TRUE
   ]]>
  </point>
  <point name="set_entry.after_control" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL cl_set_comp_entry("pmds006,pmds007,pmds008,pmds009,pmds010,pmds011,pmds021,pmds022,pmds023,pmds024,pmds041,pmds042",TRUE)
   
   CALL cl_set_comp_entry("pmds081,pmds100,pmds053",TRUE)
   
   CALL cl_set_comp_entry("pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,pmds037,pmds038,pmds039,pmds040,pmds012",TRUE)
   
   #150615 earl add s
   CALL cl_set_comp_entry("pmds041",TRUE)  #多角序號
   
   CALL cl_set_comp_entry("pmdsdocno,pmdsdocdt,
                           pmds002,pmds003,pmds052,pmds045,
                           pmds048,pmds049",TRUE)
   #150615 earl add e]]>
  </point>
  <point name="set_entry.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="set_entry.field_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      CALL cl_set_comp_entry("pmdsdocdt",TRUE)]]>
  </point>
  <point name="set_entry_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="set_entry_b.set_entry_b" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL cl_set_comp_entry("pmdt007",TRUE)
   
   CALL cl_set_comp_entry("pmdt001,pmdt002,pmdt003,pmdt004,pmdt005,pmdt025,pmdt019,pmdt022,pmdt008,pmdt023,pmdt024,pmdt036,pmdt046",TRUE)
   
   CALL cl_set_comp_entry("pmdt006,pmdt007,pmdt008,pmdt009,pmdt010,pmdt016,pmdt017,pmdt018,pmdt019,pmdt063",TRUE)
   CALL cl_set_comp_entry("pmdt081,pmdt082",TRUE)
   
   CALL cl_set_comp_entry("pmdt062,pmdt028",TRUE)
   
   CALL cl_set_comp_entry("pmdt020,pmdt016,pmdt017,pmdt018,pmdt063,pmdt089",TRUE) 
   
   CALL cl_set_comp_entry("pmdt072,pmdt073,pmdt074",TRUE)]]>
  </point>
  <point name="set_no_entry.after_control" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF NOT cl_null(g_pmds_m.pmds006) THEN
      CALL cl_set_comp_entry("pmds007,pmds008,pmds011,pmds014",FALSE)
   END IF
   
   IF g_argv[1] = '8' OR g_argv[1] = '10' OR g_argv[1] = '12' OR g_argv[1] = '14' OR g_argv[1] = '9' OR g_argv[1] = '11' OR g_argv[1] = '13' OR g_argv[1] = '15' OR g_argv[1] = '20' THEN
      CALL cl_set_comp_entry("pmds011,pmds014",FALSE)
   END IF
   
   #驗退、入庫時，根據收貨單帶出的相關資訊欄位，不可修改
   IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25' THEN
      CALL cl_set_comp_entry("pmds007,pmds008,pmds009,pmds010,pmds011,pmds021,pmds022,pmds023,pmds024,pmds041,pmds042,pmds014",FALSE)
      
   END IF
   IF g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
      CALL cl_set_comp_entry("pmds011",FALSE)
      
   END IF
   
   #如果單身有維護資料，則收貨單號欄位不可以進行修改
   SELECT COUNT(*) INTO l_n FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
   IF l_n > 0 THEN
      CALL cl_set_comp_entry("pmds006",FALSE)
   END IF
   
   #取回日期只有在用取回action時，才可錄入
   #IF g_flag3 THEN
   #   CALL cl_set_comp_entry("pmds081",FALSE)
   #END IF
   
   #委外倉退的倉退方式只能選4.倉退折讓，其他的都不能選，請在輸入時限制
   IF g_argv[1] = '14' THEN
      CALL cl_set_comp_entry("pmds100",FALSE)
   END IF
   
   #收貨單有輸入採購單號將”多角流程代碼”帶入並且no_entry
   IF g_argv[1] MATCHES '[13896]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '20' THEN
      IF NOT cl_null(g_pmds_m.pmds006) THEN
         CALL cl_set_comp_entry("pmds053",FALSE)
      ELSE
         #無輸入採購單號時若多角性質為”2:代採購、3:代採購指定供應商”時”多角流程代碼”才可輸入
         IF g_pmds_m.pmds014 NOT MATCHES '[23]' OR g_argv[1] = '24' THEN
            CALL cl_set_comp_entry("pmds053",FALSE)
         END IF
      END IF
   ELSE
      CALL cl_set_comp_entry("pmds053",FALSE)
   END IF
   
   #財務資訊頁籤不可輸入
   IF g_argv[1] MATCHES '[135689]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '20' THEN
      CALL cl_set_comp_entry("pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,pmds037,pmds038,pmds039,pmds040,pmds012",FALSE)
   END IF
   
   #150615 earl add s
   #有來源且中斷續拋
   IF NOT cl_null(g_pmds_m.pmds006)
      AND apmt520_break_continue(g_pmds_m.pmds053) THEN
      
      #除多角序號pmds041，其餘欄位全鎖
      CALL cl_set_comp_entry("pmdsdocno,pmdsdocdt,
                              pmds002,pmds003,pmds009,pmds010,pmds052,pmds045,
                              pmds021,pmds022,pmds023,pmds024,
                              pmds048,pmds049,pmds042",FALSE)
   
   ELSE
      CALL cl_set_comp_entry("pmds041",FALSE)  #多角序號
   END IF
   #150615 earl add e
   ]]>
  </point>
  <point name="set_no_entry.define" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_n     LIKE type_t.num5        ]]>
  </point>
  <point name="set_no_entry.field_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      CALL cl_set_comp_entry("pmdsdocdt",FALSE)]]>
  </point>
  <point name="set_no_entry_b.define" order="" ver="7" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_imaa005   LIKE imaa_t.imaa005
   DEFINE l_pmdn028   LIKE pmdn_t.pmdn028
   DEFINE l_pmdn029   LIKE pmdn_t.pmdn029
   DEFINE l_pmdn030   LIKE pmdn_t.pmdn030
   DEFINE l_imaf015   LIKE imaf_t.imaf015
   DEFINE l_imaf144   LIKE imaf_t.imaf144
   DEFINE l_pmdt016   LIKE pmdt_t.pmdt016
   DEFINE l_pmdt017   LIKE pmdt_t.pmdt017
   DEFINE l_pmdt018   LIKE pmdt_t.pmdt018
   DEFINE l_inaa007   LIKE inaa_t.inaa007
   DEFINE l_imaf061   LIKE imaf_t.imaf061
   DEFINE l_imaf055   LIKE imaf_t.imaf055
   DEFINE l_pmdn053   LIKE pmdn_t.pmdn053
   DEFINE l_pmdt063   LIKE pmdt_t.pmdt063]]>
  </point>
  <point name="set_no_entry_b.set_no_entry_b" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   #單頭採購單不為空時，單身預設單頭的採購單號
   IF (NOT cl_null(g_pmds_m.pmds006)) OR (NOT cl_null(g_pmdt_d[l_ac].pmdt001)) THEN
      CALL cl_set_comp_entry("pmdt001,pmdt025,pmdt005,pmdt019,pmdt021,pmdt022,pmdt008,pmdt023,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt026",FALSE)
      IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
         CALL cl_set_comp_entry("pmdt006,pmdt007",FALSE)
         CALL cl_set_comp_entry("pmdt001,pmdt002,pmdt003,pmdt004",FALSE)
      END IF
   END IF
   
   #倉退單單頭沒打收貨單號時，倉退方式不能選"2"，且單身收貨項次、採購單號、項次、項序要分批序都不能打
   IF cl_null(g_pmds_m.pmds006) THEN   
      IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '25' OR g_argv[1] = '26' THEN
         CALL cl_set_comp_entry("pmdt028,pmdt001,pmdt002,pmdt003,pmdt004",FALSE)
      END IF
   END IF 
   
   #IF g_argv[1] MATCHES '[24]' THEN
      #當料件有使用產品特徵功能時此欄位才可輸入
      LET l_imaa005  = ''
      SELECT imaa005 INTO l_imaa005 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_pmdt_d[l_ac].pmdt006
      IF cl_null(l_imaa005) THEN
         CALL cl_set_comp_entry("pmdt007",FALSE)
         LET g_pmdt_d[l_ac].pmdt007 = ' '
         LET g_pmdt_d[l_ac].pmdt007_desc = ''
      ELSE
         IF cl_null(g_pmdt_d[l_ac].pmdt007) THEN
            LET g_pmdt_d[l_ac].pmdt007 = ''
            LET g_pmdt_d[l_ac].pmdt007_desc = ''
         END IF
      END IF
      
      #當料件主檔設置要做參考單位管理時，則參考数量允許輸入，不允許空白
      LET l_imaf015 = ''
      LET l_imaf144 = ''
      LET l_imaf061 = ''
      LET l_imaf055 = ''
      SELECT imaf015,imaf144,imaf061,imaf055 INTO l_imaf015,l_imaf144,l_imaf061,l_imaf055 FROM imaf_t WHERE imafent = g_enterprise AND imaf001 = g_pmdt_d[l_ac].pmdt006 AND imafsite = g_site
      IF cl_null(l_imaf015) THEN
         CALL cl_set_comp_entry("pmdt022",FALSE)
         LET g_pmdt_d[l_ac].pmdt021 = ''
         LET g_pmdt_d[l_ac].pmdt021_desc = ''
         LET g_pmdt_d[l_ac].pmdt022 = ''
      END IF

      #料件不使用計價單位是，計價單位、計價數量不可維護
      IF cl_null(l_imaf144) THEN
         CALL cl_set_comp_entry("pmdt023,pmdt024",FALSE)
         LET g_pmdt_d[l_ac].pmdt023 = g_pmdt_d[l_ac].pmdt019
         LET g_pmdt_d[l_ac].pmdt023_desc = g_pmdt_d[l_ac].pmdt019_desc
         LET g_pmdt_d[l_ac].pmdt024 = g_pmdt_d[l_ac].pmdt020
      END IF  

      #[T:料件據點進銷存檔].[C:庫存批號控管]=2時,[C:不可有批號]欄位不可輸入
      IF l_imaf061 = '2' THEN
         CALL cl_set_comp_entry("pmdt018",FALSE)
         LET g_pmdt_d[l_ac].pmdt018 = ' '
      END IF
      
      #若設定imaf055(庫存管理特徵)等於'2.不可有庫存管理特徵'時，則[C:庫存管理特徵]欄位不可輸入
      IF l_imaf055 = '2' THEN
         CALL cl_set_comp_entry("pmdt063",FALSE)
         LET g_pmdt_d[l_ac].pmdt063 = ' '
      END IF
   #END IF
   
   #收貨時，來源單據有維護庫儲批 則，不可再修改
   #入庫、驗退、倉退時，來源採購單據有維護庫儲批 則，不可再修改
   IF g_argv[1] MATCHES '[1389567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
      LET l_pmdn028 = ''
      LET l_pmdn029 = ''
      LET l_pmdn030 = ''
      SELECT pmdn028,pmdn029,pmdn030,pmdn053 INTO l_pmdn028,l_pmdn029,l_pmdn030,l_pmdn053
         FROM pmdn_t WHERE pmdnent = g_enterprise AND pmdndocno = g_pmdt_d[l_ac].pmdt001 AND pmdnseq = g_pmdt_d[l_ac].pmdt002
      IF NOT cl_null(l_pmdn028) THEN
          CALL cl_set_comp_entry("pmdt016",FALSE)
      END IF
      IF NOT cl_null(l_pmdn029) THEN
          CALL cl_set_comp_entry("pmdt017",FALSE)
      END IF
      IF NOT cl_null(l_pmdn030) THEN
          CALL cl_set_comp_entry("pmdt018",FALSE)
      END IF
      IF NOT cl_null(l_pmdn053) THEN
          CALL cl_set_comp_entry("pmdt063",FALSE)
      END IF
      #來源單號中有限定庫儲批，則多庫儲批否不可錄入
      IF (NOT cl_null(l_pmdn028)) OR (NOT cl_null(l_pmdn029)) OR (NOT cl_null(l_pmdn030)) THEN
         CALL cl_set_comp_entry("pmdt062",FALSE) 
      END IF
      
      #入庫、驗退單有QC單維護了庫儲批時，庫儲批也不可以修改
      IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '25' THEN
         SELECT qcbc005,qcbc006,qcbc007 INTO l_pmdn028,l_pmdn029,l_pmdn030
            FROM qcbc_t WHERE qcbcent = g_enterprise AND qcbcdocno = g_pmdt_d[l_ac].pmdt081 AND qcbcseq = g_pmdt_d[l_ac].pmdt082
         IF NOT cl_null(l_pmdn028) THEN
             CALL cl_set_comp_entry("pmdt016",FALSE)
         END IF
         IF NOT cl_null(l_pmdn029) THEN
             CALL cl_set_comp_entry("pmdt017",FALSE)
         END IF
         IF NOT cl_null(l_pmdn030) THEN
             CALL cl_set_comp_entry("pmdt018",FALSE)
         END IF
         IF NOT cl_null(l_pmdn053) THEN
             CALL cl_set_comp_entry("pmdt063",FALSE)
         END IF
         #來源單號中有限定庫儲批，則多庫儲批否不可錄入
         IF (NOT cl_null(l_pmdn028)) OR (NOT cl_null(l_pmdn029)) OR (NOT cl_null(l_pmdn030)) THEN
            CALL cl_set_comp_entry("pmdt062",FALSE) 
         END IF
      END IF
      
   END IF
   
   ##入庫、驗退、倉退時，來源採購單據有維護庫儲批 則，不可再修改
   #IF g_argv[1] MATCHES '[567]' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' THEN
   #   LET l_pmdt016 = ''
   #   LET l_pmdt017 = ''
   #   LET l_pmdt018 = ''
   #   SELECT pmdt016,pmdt017,pmdt018,pmdt063 INTO l_pmdt016,l_pmdt017,l_pmdt018,l_pmdt063
   #      FROM pmdt_t WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmds006 AND pmdtseq = g_pmdt_d[l_ac].pmdt028
   #   IF NOT cl_null(l_pmdt016) THEN
   #       CALL cl_set_comp_entry("pmdt016",FALSE)
   #   END IF
   #   IF NOT cl_null(l_pmdt017) THEN
   #       CALL cl_set_comp_entry("pmdt017",FALSE)
   #   END IF
   #   IF NOT cl_null(l_pmdt018) THEN
   #       CALL cl_set_comp_entry("pmdt018",FALSE)
   #   END IF
   #   IF NOT cl_null(l_pmdt063) THEN
   #       CALL cl_set_comp_entry("pmdt063",FALSE)
   #   END IF
   #   #來源單號中有限定庫儲批，則多庫儲批否不可錄入
   #   IF (NOT cl_null(l_pmdt016)) OR (NOT cl_null(l_pmdt017)) OR (NOT cl_null(l_pmdt018)) THEN
   #      CALL cl_set_comp_entry("pmdt062",FALSE) 
   #   END IF
   #END IF
   
   IF g_argv[1] MATCHES '[5]' OR g_argv[1] = '10' OR g_argv[1] = '11' THEN
      #CALL cl_set_comp_entry("pmdt006,pmdt007,pmdt008,pmdt009,pmdt010,pmdt016,pmdt017,pmdt018,pmdt019",FALSE)
      CALL cl_set_comp_entry("pmdt006,pmdt007,pmdt008,pmdt009,pmdt010,pmdt019",FALSE)
   END IF
   
   #驗退、入庫單時可輸，其他noentry
   IF g_argv[1] MATCHES '[1234789]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN
      CALL cl_set_comp_entry("pmdt081,pmdt082",FALSE)
   END IF
   
   IF g_pmdt_d[l_ac].pmdt062 = 'Y' THEN
      LET g_pmdt_d[l_ac].pmdt016 = ''
      LET g_pmdt_d[l_ac].pmdt016_desc = ''
      LET g_pmdt_d[l_ac].pmdt017 = ''
      LET g_pmdt_d[l_ac].pmdt017_desc = ''
      LET g_pmdt_d[l_ac].pmdt018 = ''
      LET g_pmdt_d[l_ac].pmdt089 = ''
      CALL cl_set_comp_entry("pmdt016,pmdt017,pmdt018,pmdt089",FALSE)
   END IF
   
   #倉退單，當倉退方式為'4:'價格折讓'時，數量欄位預設為0且不可以維護
   #IF (g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') AND g_pmds_m.pmds100 = '4' THEN
   #   CALL cl_set_comp_entry("pmdt020",FALSE) 
   #END IF
   
   #庫位不使用儲位管理時，儲位不可維護
   SELECT inaa007 INTO l_inaa007 FROM inaa_t WHERE inaaent = g_enterprise AND inaasite = g_site AND inaa001 = g_pmdt_d[l_ac].pmdt016
   IF l_inaa007 = '5' THEN
      CALL cl_set_comp_entry("pmdt017",FALSE)
      LET g_pmdt_d[l_ac].pmdt017 = ' '
      LET g_pmdt_d[l_ac].pmdt017_desc = ''
   END IF
   
   IF g_argv[1] MATCHES '[24]' THEN
      #無採購單的收貨/收貨入庫
      #若1.正常稅率，則單身稅別不可輸入
      IF g_tax_app = '1' THEN
         CALL cl_set_comp_entry("pmdt046",FALSE)
      END IF
      #單頭取價方式的基本資料設置不允許修改單價 , 未取到價格不允許人工輸入
      IF (g_pmdt_d[l_ac].pmdt036 > 0 OR g_pmam002 <> 'Y') AND g_pmam003 <> 'Y' THEN
         CALL cl_set_comp_entry("pmdt036",FALSE)
      END IF
   ELSE
      CALL cl_set_comp_entry("pmdt036",FALSE)
      #無採購來源的單據專案編號、WBS、活動編號可輸入，其他均不可輸入
      CALL cl_set_comp_entry("pmdt072,pmdt073,pmdt074",FALSE)
   END IF
   
   IF g_pmdt_d[l_ac].pmdt005 = '9' THEN  #樣品
      CALL cl_set_comp_entry("pmdt036,pmdt001,pmdt002,pmdt003,pmdt004",FALSE)
   END IF

   #借貨管理下，庫存管理特徵欄位不可輸入
   IF g_argv[1] = '23' OR g_argv[1] = '24' OR g_argv[1] = '25' THEN
      CALL cl_set_comp_entry("pmdt063",FALSE)
   END IF]]>
  </point>
  <point name="show.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="show.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="show.body.reference" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[          SELECT pmdo001,pmdo002 INTO g_pmdt_d[l_ac].pmdo001,g_pmdt_d[l_ac].pmdo002
           FROM pmdo_t 
           WHERE pmdoent = g_enterprise AND pmdodocno = g_pmdt_d[l_ac].pmdt001
             AND pmdoseq = g_pmdt_d[l_ac].pmdt002
             AND pmdoseq1 = g_pmdt_d[l_ac].pmdt003
             AND pmdoseq2 = g_pmdt_d[l_ac].pmdt004
             
          CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdo001) RETURNING g_pmdt_d[l_ac].imaal003,g_pmdt_d[l_ac].imaal004
          DISPLAY BY NAME g_pmdt_d[l_ac].imaal003,g_pmdt_d[l_ac].imaal004
          
          CALL s_feature_description(g_pmdt_d[l_ac].pmdo001,g_pmdt_d[l_ac].pmdo002) RETURNING l_success,g_pmdt_d[l_ac].pmdo002_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdo002_desc
          
          CALL s_desc_get_item_desc(g_pmdt_d[l_ac].pmdt006) RETURNING g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt006_desc2
          
          CALL s_feature_description(g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007) RETURNING l_success,g_pmdt_d[l_ac].pmdt007_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt007_desc
          
          #CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt019) RETURNING g_pmdt_d[l_ac].pmdt019_desc
          #DISPLAY BY NAME g_pmdt_d[l_ac].pmdt019_desc
          #
          #CALL apmt520_pmdt008_ref(g_pmdt_d[l_ac].pmdt008) RETURNING g_pmdt_d[l_ac].pmdt008_desc
          #DISPLAY BY NAME g_pmdt_d[l_ac].pmdt008_desc
          #
          #CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt021) RETURNING g_pmdt_d[l_ac].pmdt021_desc
          #DISPLAY BY NAME g_pmdt_d[l_ac].pmdt021_desc
          #
          #CALL s_desc_get_unit_desc(g_pmdt_d[l_ac].pmdt023) RETURNING g_pmdt_d[l_ac].pmdt023_desc
          #DISPLAY BY NAME g_pmdt_d[l_ac].pmdt023_desc
          
          CALL apmt520_pmds033_ref(g_pmdt_d[l_ac].pmdt046) RETURNING g_pmdt_d[l_ac].pmdt046_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt046_desc
          
          CALL s_desc_get_stock_desc(g_site,g_pmdt_d[l_ac].pmdt016) RETURNING g_pmdt_d[l_ac].pmdt016_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt016_desc
          
          CALL s_desc_get_locator_desc(g_site,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017) RETURNING g_pmdt_d[l_ac].pmdt017_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt017_desc

          CALL s_desc_get_acc_desc(g_acc,g_pmdt_d[l_ac].pmdt051) RETURNING g_pmdt_d[l_ac].pmdt051_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt051_desc
            
          CALL apmt520_pmdt083_ref(g_pmdt_d[l_ac].pmdt083) RETURNING g_pmdt_d[l_ac].pmdt083_desc
          DISPLAY BY NAME g_pmdt_d[l_ac].pmdt083_desc
]]>
  </point>
  <point name="show.body2.reference" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[          CALL s_desc_get_item_desc(g_pmdt2_d[l_ac].pmdu001) RETURNING g_pmdt2_d[l_ac].pmdu001_desc,g_pmdt2_d[l_ac].imaal004
          DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu001_desc,g_pmdt2_d[l_ac].imaal004
          
          CALL s_feature_description(g_pmdt2_d[l_ac].pmdu001,g_pmdt2_d[l_ac].pmdu002) RETURNING l_success,g_pmdt2_d[l_ac].pmdu002_desc
          DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu002_desc
          
          CALL s_desc_get_stock_desc(g_site,g_pmdt2_d[l_ac].pmdu006) RETURNING g_pmdt2_d[l_ac].pmdu006_desc
          DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu006_desc
          
          CALL s_desc_get_locator_desc(g_site,g_pmdt2_d[l_ac].pmdu006,g_pmdt2_d[l_ac].pmdu007) RETURNING g_pmdt2_d[l_ac].pmdu007_desc
          DISPLAY BY NAME g_pmdt2_d[l_ac].pmdu007_desc]]>
  </point>
  <point name="show.body3.reference" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[          CALL s_desc_get_item_desc(g_pmdt3_d[l_ac].pmdv001) RETURNING g_pmdt3_d[l_ac].pmdv001_desc,g_pmdt3_d[l_ac].imaal004
          DISPLAY BY NAME g_pmdt3_d[l_ac].pmdv001_desc,g_pmdt3_d[l_ac].imaal004
          
          CALL s_feature_description(g_pmdt3_d[l_ac].pmdv001,g_pmdt3_d[l_ac].pmdv002) RETURNING l_success,g_pmdt3_d[l_ac].pmdv002_desc
          DISPLAY BY NAME g_pmdt3_d[l_ac].pmdv002_desc
          ]]>
  </point>
  <point name="show.define" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_success LIKE type_t.num5
   DEFINE l_ooba002 LIKE ooba_t.ooba002]]>
  </point>
  <point name="show.head.reference" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_pmds_m.pmdsdocno) THEN
               CALL s_aooi200_get_slip(g_pmds_m.pmdsdocno) RETURNING l_success,l_ooba002
               CALL s_aooi200_get_slip_desc(l_ooba002) RETURNING g_pmds_m.pmdsdocno_desc
            END IF
            
            DISPLAY BY NAME g_pmds_m.pmdsdocno_desc
            
            #CALL s_desc_get_person_desc(g_pmds_m.pmds002) RETURNING g_pmds_m.pmds002_desc
            #DISPLAY BY NAME g_pmds_m.pmds002_desc
            #
            #CALL s_desc_get_department_desc(g_pmds_m.pmds003) RETURNING g_pmds_m.pmds003_desc
            #DISPLAY BY NAME g_pmds_m.pmds003_desc
            
            #INITIALIZE g_ref_fields TO NULL
            #LET g_ref_fields[1] = g_pmds_m.pmdsownid
            #CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            #LET g_pmds_m.pmdsownid_desc = '', g_rtn_fields[1] , ''
            #DISPLAY BY NAME g_pmds_m.pmdsownid_desc
            #
            #INITIALIZE g_ref_fields TO NULL
            #LET g_ref_fields[1] = g_pmds_m.pmdsowndp
            #CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            #LET g_pmds_m.pmdsowndp_desc = '', g_rtn_fields[1] , ''
            #DISPLAY BY NAME g_pmds_m.pmdsowndp_desc
            #
            #INITIALIZE g_ref_fields TO NULL
            #LET g_ref_fields[1] = g_pmds_m.pmdscrtid
            #CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            #LET g_pmds_m.pmdscrtid_desc = '', g_rtn_fields[1] , ''
            #DISPLAY BY NAME g_pmds_m.pmdscrtid_desc
            #
            #INITIALIZE g_ref_fields TO NULL
            #LET g_ref_fields[1] = g_pmds_m.pmdscrtdp
            #CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            #LET g_pmds_m.pmdscrtdp_desc = '', g_rtn_fields[1] , ''
            #DISPLAY BY NAME g_pmds_m.pmdscrtdp_desc
            #
            #INITIALIZE g_ref_fields TO NULL
            #LET g_ref_fields[1] = g_pmds_m.pmdsmodid
            #CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            #LET g_pmds_m.pmdsmodid_desc = '', g_rtn_fields[1] , ''
            #DISPLAY BY NAME g_pmds_m.pmdsmodid_desc
            #
            #INITIALIZE g_ref_fields TO NULL
            #LET g_ref_fields[1] = g_pmds_m.pmdscnfid
            #CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            #LET g_pmds_m.pmdscnfid_desc = '', g_rtn_fields[1] , ''
            #DISPLAY BY NAME g_pmds_m.pmdscnfid_desc
            #
            #INITIALIZE g_ref_fields TO NULL
            #LET g_ref_fields[1] = g_pmds_m.pmdspstid
            #CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            #LET g_pmds_m.pmdspstid_desc = '', g_rtn_fields[1] , ''
            #DISPLAY BY NAME g_pmds_m.pmdspstid_desc
            
            #CALL apmt520_pmds007_ref(g_pmds_m.pmds007) RETURNING g_pmds_m.pmds007_desc
            #DISPLAY BY NAME g_pmds_m.pmds007_desc
            #
            #CALL apmt520_pmds007_ref(g_pmds_m.pmds008) RETURNING g_pmds_m.pmds008_desc
            #DISPLAY BY NAME g_pmds_m.pmds008_desc
            #
            #CALL apmt520_pmds007_ref(g_pmds_m.pmds009) RETURNING g_pmds_m.pmds009_desc
            #DISPLAY BY NAME g_pmds_m.pmds009_desc
            #
            #CALL s_desc_get_ooib002_desc(g_pmds_m.pmds031) RETURNING g_pmds_m.pmds031_desc
            #DISPLAY BY NAME g_pmds_m.pmds031_desc
            
            #CALL s_desc_get_acc_desc('238',g_pmds_m.pmds032) RETURNING g_pmds_m.pmds032_desc
            #DISPLAY BY NAME g_pmds_m.pmds032_desc
            
            CALL apmt520_pmds033_ref(g_pmds_m.pmds033) RETURNING g_pmds_m.pmds033_desc
            DISPLAY BY NAME g_pmds_m.pmds033_desc
            
            #CALL s_desc_get_currency_desc(g_pmds_m.pmds037) RETURNING g_pmds_m.pmds037_desc
            #DISPLAY BY NAME g_pmds_m.pmds037_desc
            #
            #CALL s_desc_get_price_type_desc(g_pmds_m.pmds039) RETURNING g_pmds_m.pmds039_desc
            #DISPLAY BY NAME g_pmds_m.pmds039_desc
            #
            #CALL s_desc_ooid001_desc(g_pmds_m.pmds040) RETURNING g_pmds_m.pmds040_desc
            #DISPLAY BY NAME g_pmds_m.pmds040_desc
]]>
  </point>
  <point name="show.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL apmt520_b4_fill()     ]]>
  </point>
  <point name="statechange.a_update" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL apmt520_fetch('')  #重新加載action         ]]>
  </point>
  <point name="statechange.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="statechange.b_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="statechange.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF g_pmds_m.pmdsstus = 'X' THEN
      RETURN
   END IF
   ]]>
  </point>
  <point name="statechange.before_menu" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      CALL cl_set_act_visible("unconfirmed,invalid,confirmed,unconfirmed",TRUE)
      
      IF g_argv[1] MATCHES '[3467]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN   #入庫單才有過賬功能
         CALL cl_set_act_visible("posted,unposted",TRUE)
      ELSE
         CALL cl_set_act_visible("posted,unposted",FALSE)
      END IF
      CALL cl_set_act_visible("signing,withdraw",FALSE)
      CASE g_pmds_m.pmdsstus
         WHEN "N"
            CALL cl_set_act_visible("unconfirmed,posted,unposted,",FALSE)
            #需提交至BPM時，則顯示「提交」功能並隱藏「確認」功能
            IF cl_bpm_chk() THEN
                CALL cl_set_act_visible("signing",TRUE)
                CALL cl_set_act_visible("confirmed",FALSE)
            END IF
         WHEN "R"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
            CALL cl_set_act_visible("confirmed,unconfirmed",FALSE)

         WHEN "D"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
            CALL cl_set_act_visible("confirmed,unconfirmed",FALSE)
         WHEN "W"    #只能顯示抽單;其餘應用功能皆隱藏
             CALL cl_set_act_visible("withdraw",TRUE)  
             CALL cl_set_act_visible("unconfirmed,invalid,confirmed",FALSE)
         
         WHEN "A"     #只能顯示確認; 其餘應用功能皆隱藏
             CALL cl_set_act_visible("confirmed ",TRUE)  
             CALL cl_set_act_visible("unconfirmed,invalid",FALSE)

         WHEN "X"
            CALL cl_set_act_visible("unconfirmed,invalid,confirmed,posted,unposted",FALSE)

         WHEN "Y"
            CALL cl_set_act_visible("invalid,confirmed,unposted",FALSE)
            
         WHEN "S"
             CALL cl_set_act_visible("unconfirmed,invalid,confirmed,posted",FALSE)
      END CASE                  ]]>
  </point>
  <point name="statechange.confirmed" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL cl_err_collect_init() 
            CALL s_apmt520_conf_chk(g_pmds_m.pmdsdocno) RETURNING l_success
            CALL cl_err_collect_show()
            IF NOT l_success THEN
               RETURN
            ELSE
               IF NOT cl_ask_confirm('aim-00108') THEN
                  RETURN
               ELSE
                  CALL s_transaction_begin()
                  
                  CALL cl_err_collect_init() 
                  CALL s_apmt520_conf_upd(g_pmds_m.pmdsdocno) RETURNING l_success
                  CALL cl_err_collect_show()
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     RETURN
                  ELSE
                     CALL s_transaction_end('Y','0')
                  END IF
               END IF
            END IF
            #確認後自動過賬
            IF g_argv[1] MATCHES '[3467]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '24' OR g_argv[1] = '25' OR g_argv[1] = '26' OR g_argv[1] = '20' THEN   #入庫單才有過賬功能
               CALL s_aooi200_get_slip(g_pmds_m.pmdsdocno) RETURNING l_success,l_ooba002
               IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-BAS-0083') = 'Y' THEN
                  CALL s_transaction_begin()
                  IF apmt520_upd_pmds001() THEN
                     CALL cl_err_collect_init() 
                     CALL s_apmt520_posted_chk(g_pmds_m.pmdsdocno) RETURNING l_success
                     CALL cl_err_collect_show()
                     IF NOT l_success THEN
                        CALL s_transaction_end('N','0')
                        RETURN
                     ELSE
                        CALL cl_err_collect_init() 
                        CALL s_apmt520_posted_upd(g_pmds_m.pmdsdocno) RETURNING l_success
                        CALL cl_err_collect_show()
                        IF NOT l_success THEN
                           CALL s_transaction_end('N','0')
                           RETURN
                        ELSE
                           LET lc_state = "S"
                           CALL s_transaction_end('Y','0')
                           
                           #150626---earl---add---s
                           #多角自動拋轉
                           INITIALIZE la_param.* TO NULL

                           IF g_pmds_m.pmds000 = '7' OR g_pmds_m.pmds000 = '14' THEN   #採購倉退維護作業,委外採購倉退作業
                              LET la_param.prog     = 'aicp800'
                              LET la_param.param[1] = g_pmds_m.pmdsdocno
                           ELSE
                              LET la_param.prog     = 'aicp400'
                              LET la_param.param[1] = g_pmds_m.pmdsdocno
                           END IF
                           
                           LET ls_js = util.JSON.stringify(la_param)
                           CALL cl_cmdrun_wait(ls_js)
                           #150626---earl---add---e
                           
                        END IF
                     END IF
                  ELSE
                     CALL s_transaction_end('N','0')
                     RETURN
                  END IF
               END IF
            END IF       ]]>
  </point>
  <point name="statechange.define" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_success LIKE type_t.num5
   DEFINE l_ooba002 LIKE ooba_t.ooba002
   DEFINE l_pmds054 LIKE pmds_t.pmds054
   
   #150626---earl---add---s
   DEFINE la_param   RECORD
          prog          STRING,
          actionid      STRING,
          background    LIKE type_t.chr1,
          param         DYNAMIC ARRAY OF STRING
                     END RECORD

   DEFINE ls_js         STRING
   DEFINE l_pmds050     LIKE pmds_t.pmds050
   #150626---earl---add---e
   ]]>
  </point>
  <point name="statechange.invalid" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         CALL cl_err_collect_init() 
         CALL s_apmt520_invalid_chk(g_pmds_m.pmdsdocno) RETURNING l_success
         CALL cl_err_collect_show()
         IF NOT l_success THEN
            RETURN
         ELSE
            IF NOT cl_ask_confirm('aim-00109') THEN
               RETURN
            ELSE
               CALL s_transaction_begin()
               
               CALL cl_err_collect_init() 
               CALL s_apmt520_invalid_upd(g_pmds_m.pmdsdocno) RETURNING l_success
               CALL cl_err_collect_show()
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
            END IF
         END IF                        ]]>
  </point>
  <point name="statechange.more_control" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ON ACTION unposted
         LET lc_state = "Y"
         LET l_pmds054 = ''
         SELECT pmds054 INTO l_pmds054 FROM pmds_t WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
         #2.倉退單在過帳還原時若pmds054為'2.採購合約差異處理'時，過帳還原時只能將此倉退單更新成作廢狀態
         #2-1.過帳還原時彈窗告知是採購合約差異處理單是否進行過帳還原，若選擇是則只能將倉退單更新成作廢
         #2-2.須將對應的pmeo025的狀態更新成'1.未處理'
         IF (g_argv[1] MATCHES '[7]' OR g_argv[1] = '14' OR g_argv[1] = '15' OR g_argv[1] = '26') AND l_pmds054 = '2' THEN
            IF NOT cl_ask_confirm('apm-00890') THEN 
               RETURN
            ELSE
               CALL s_transaction_begin()
               
               CALL cl_err_collect_init() 
               CALL s_apmt520_unposted_chk(g_pmds_m.pmdsdocno) RETURNING l_success
               CALL cl_err_collect_show()
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  #150626---earl---add---s
                  CALL s_transaction_end('Y','0')

                  #多角自動拋轉還原
                  INITIALIZE la_param.* TO NULL
                  
                  IF g_pmds_m.pmds000 = '7' OR g_pmds_m.pmds000 = '14' THEN   #採購倉退維護作業,委外採購倉退作業
                     LET la_param.prog     = 'aicp810'
                     LET la_param.param[1] = g_pmds_m.pmdsdocno
                  ELSE
                     LET la_param.prog     = 'aicp410'
                     LET la_param.param[1] = g_pmds_m.pmdsdocno
                  END IF
                  
                  LET ls_js = util.JSON.stringify(la_param)
                  CALL cl_cmdrun_wait(ls_js)

                  LET l_pmds050 = ''
                  SELECT pmds050 INTO l_pmds050
                    FROM pmds_t
                   WHERE pmdsent = g_enterprise
                     AND pmdsdocno = g_pmds_m.pmdsdocno
                  
                  IF l_pmds050 = 'Y' THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.extend = ""
                     LET g_errparam.code   = 'aic-00181'   #多角流程已拋轉之單據不可取消過帳！
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()

                     CALL cl_err_collect_show()
                     CLOSE apmt520_cl
                     RETURN
                  END IF

                  CALL s_transaction_begin()

                  OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
                  IF STATUS THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.extend = "OPEN apmt520_cl:"
                     LET g_errparam.code   = STATUS
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()
                     CLOSE apmt520_cl
                     CALL s_transaction_end('N','0')
                     CALL cl_err_collect_show()
                     RETURN
                  END IF
                  #150626---earl---add---e
                  
                  CALL cl_err_collect_init() 
                  CALL s_apmt520_unposted_upd(g_pmds_m.pmdsdocno) RETURNING l_success
                  CALL cl_err_collect_show()
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     RETURN
                  END IF
               END IF
               
               LET lc_state = "N"
               #過賬還原後，再進行取消確認的邏輯
               CALL cl_err_collect_init() 
               CALL s_apmt520_unconf_chk(g_pmds_m.pmdsdocno) RETURNING l_success
               CALL cl_err_collect_show()
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL cl_err_collect_init() 
                  CALL s_apmt520_unconf_upd(g_pmds_m.pmdsdocno) RETURNING l_success
                  CALL cl_err_collect_show()
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     RETURN
                  END IF
               END IF
               
               LET lc_state = "X"
               #取消確認後，再進行作廢
               CALL cl_err_collect_init() 
               CALL s_apmt520_invalid_chk(g_pmds_m.pmdsdocno) RETURNING l_success
               CALL cl_err_collect_show()
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL cl_err_collect_init() 
                  CALL s_apmt520_invalid_upd(g_pmds_m.pmdsdocno) RETURNING l_success
                  CALL cl_err_collect_show()
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     RETURN
                  END IF
               END IF 
               #將對應的pmeo025的狀態更新成'1.未處理'
               UPDATE pmeo_t SET pmeo025 = '1' WHERE pmeoent = g_enterprise AND pmeo000 ='1' AND pmeo027 = g_pmds_m.pmdsdocno               
               CALL s_transaction_end('Y','0')               
            END IF
         ELSE
            IF NOT cl_ask_confirm('sub-00233') THEN
               CALL s_transaction_end('N','0')
               RETURN
            ELSE
               CALL cl_err_collect_init() 
               CALL s_apmt520_unposted_chk(g_pmds_m.pmdsdocno) RETURNING l_success
               CALL cl_err_collect_show()
               IF NOT l_success THEN
                  RETURN
               ELSE
                  #150626---earl---add---s
                  CALL s_transaction_end('Y','0')

                  #多角自動拋轉還原
                  INITIALIZE la_param.* TO NULL
                  
                  IF g_pmds_m.pmds000 = '7' OR g_pmds_m.pmds000 = '14' THEN   #採購倉退維護作業,委外採購倉退作業
                     LET la_param.prog     = 'aicp810'
                     LET la_param.param[1] = g_pmds_m.pmdsdocno
                  ELSE
                     LET la_param.prog     = 'aicp410'
                     LET la_param.param[1] = g_pmds_m.pmdsdocno
                  END IF
                  
                  LET ls_js = util.JSON.stringify(la_param)
                  CALL cl_cmdrun_wait(ls_js)

                  LET l_pmds050 = ''
                  SELECT pmds050 INTO l_pmds050
                    FROM pmds_t
                   WHERE pmdsent = g_enterprise
                     AND pmdsdocno = g_pmds_m.pmdsdocno
                  
                  IF l_pmds050 = 'Y' THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.extend = ""
                     LET g_errparam.code   = 'aic-00181'   #多角流程已拋轉之單據不可取消過帳！
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()

                     CALL cl_err_collect_show()
                     CLOSE apmt520_cl
                     RETURN
                  END IF

                  CALL s_transaction_begin()

                  OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
                  IF STATUS THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.extend = "OPEN apmt520_cl:"
                     LET g_errparam.code   = STATUS
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()
                     CLOSE apmt520_cl
                     CALL s_transaction_end('N','0')
                     CALL cl_err_collect_show()
                     RETURN
                  END IF
                  #150626---earl---add---e

                  CALL s_transaction_begin()
                  CALL cl_err_collect_init() 
                  CALL s_apmt520_unposted_upd(g_pmds_m.pmdsdocno) RETURNING l_success
                  CALL cl_err_collect_show()
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     RETURN
                  ELSE
                     CALL s_transaction_end('Y','0')
                  END IF
               END IF
            END IF
         END IF
         EXIT MENU          ]]>
  </point>
  <point name="statechange.open" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="statechange.posted" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         IF NOT cl_ask_confirm('sub-00232') THEN
            CALL s_transaction_end('N','0')
            RETURN
         ELSE
            CALL s_transaction_begin()
            IF apmt520_upd_pmds001() THEN
               CALL cl_err_collect_init() 
               CALL s_apmt520_posted_chk(g_pmds_m.pmdsdocno) RETURNING l_success
               CALL cl_err_collect_show()
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL cl_err_collect_init() 
                  CALL s_apmt520_posted_upd(g_pmds_m.pmdsdocno) RETURNING l_success
                  CALL cl_err_collect_show()
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     RETURN
                  ELSE
                     CALL s_transaction_end('Y','0')
                     
                     #150626---earl---add---s
                     #多角自動拋轉
                     INITIALIZE la_param.* TO NULL
                     
                     IF g_pmds_m.pmds000 = '7' OR g_pmds_m.pmds000 = '14' THEN   #採購倉退維護作業,委外採購倉退作業
                        LET la_param.prog     = 'aicp800'
                        LET la_param.param[1] = g_pmds_m.pmdsdocno
                     ELSE
                        LET la_param.prog     = 'aicp400'
                        LET la_param.param[1] = g_pmds_m.pmdsdocno
                     END IF
                     
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #150626---earl---add---e
                     
                  END IF
               END IF
            ELSE
               CALL s_transaction_end('N','0')
               RETURN
            END IF
         END IF                            ]]>
  </point>
  <point name="statechange.unconfirmed" order="" ver="8" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         CALL cl_err_collect_init() 
         CALL s_apmt520_unconf_chk(g_pmds_m.pmdsdocno) RETURNING l_success
         CALL cl_err_collect_show()
         IF NOT l_success THEN
            RETURN
         ELSE
            IF NOT cl_ask_confirm('aim-00110') THEN
               RETURN
            ELSE
               CALL s_transaction_begin()
               
               CALL cl_err_collect_init() 
               CALL s_apmt520_unconf_upd(g_pmds_m.pmdsdocno) RETURNING l_success
               CALL cl_err_collect_show()
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
            END IF
         END IF]]>
  </point>
  <point name="statechange.verify" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                    ]]>
  </point>
  <point name="ui_browser_refresh.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="ui_detailshow.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="ui_detailshow.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="ui_detailshow.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="ui_dialog.action_default" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="ui_dialog.before_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="ui_dialog.before_dialog2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="ui_dialog.body2.action" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="ui_dialog.body2.before_display" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="ui_dialog.body2.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="ui_dialog.body3.action" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="ui_dialog.body3.before_display" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="ui_dialog.body3.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="ui_dialog.define" order="" ver="9" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_success  LIKE type_t.num5 
   DEFINE l_n        LIKE type_t.num5 
   DEFINE l_n1       LIKE type_t.num5
   DEFINE l_n2       LIKE type_t.num5   
   DEFINE l_slip     LIKE oobal_t.oobal002
   DEFINE l_prog     LIKE oobx_t.oobx004
   DEFINE l_type     LIKE pmds_t.pmds000
   DEFINE l_pmdl005  LIKE pmdl_t.pmdl005]]>
  </point>
  <point name="ui_dialog.more_displayarray" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[          DISPLAY ARRAY g_pmdt4_d TO s_detail4.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_detail_idx = l_ac
               
            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_current_page = 3
         
         END DISPLAY                          ]]>
  </point>
  <point name="ui_dialog.page1.action" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                ]]>
  </point>
  <point name="ui_dialog.page1.before_display" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="ui_dialog.page1.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                                                            ]]>
  </point>
  <point name="ui_headershow.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="unlock_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="unlock_b.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="update_b.after_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.after_update2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.after_update3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.before_update" order="" ver="11" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      #儲位、批號 若為空，給一個空格
      IF cl_null(g_pmdt_d[g_detail_idx].pmdt017) THEN
         LET g_pmdt_d[g_detail_idx].pmdt017 = ' '
      END IF 

      IF cl_null(g_pmdt_d[g_detail_idx].pmdt018) THEN
         LET g_pmdt_d[g_detail_idx].pmdt018 = ' '
      END IF   

      IF g_argv[1] MATCHES '[56]' OR g_argv[1] = '12' OR g_argv[1] = '13' OR g_argv[1] = '10' OR g_argv[1] = '11' OR g_argv[1] = '25' THEN 
         IF g_pmdt_d[g_detail_idx].pmdt026 = 'Y' THEN
            LET g_pmdt_d[g_detail_idx].pmdt062 = 'N'         
         END IF
      ELSE
         IF cl_get_para(g_enterprise,g_site,'S-BAS-0019') = "N" OR (NOT apmt520_get_imaf144(g_pmdt_d[g_detail_idx].pmdt006)) THEN
            LET g_pmdt_d[g_detail_idx].pmdt023 = g_pmdt_d[g_detail_idx].pmdt019
            LET g_pmdt_d[g_detail_idx].pmdt024 = g_pmdt_d[g_detail_idx].pmdt020
         END IF
      END IF
      
      #未稅金額、含稅金額
      IF (NOT cl_null(g_pmdt_d[g_detail_idx].pmdt024)) AND (NOT cl_null(g_pmdt_d[g_detail_idx].pmdt046)) THEN
         CALL s_apmt520_get_amount(g_pmds_m.pmdsdocno,g_pmdt_d[g_detail_idx].pmdtseq,g_pmdt_d[g_detail_idx].pmdt001,g_pmdt_d[g_detail_idx].pmdt024,g_pmdt_d[g_detail_idx].pmdt036,g_pmdt_d[g_detail_idx].pmdt046)
           RETURNING g_pmdt_d[g_detail_idx].pmdt038,g_pmdt_d[g_detail_idx].pmdt047,g_pmdt_d[g_detail_idx].pmdt039            
      END IF
      ]]>
  </point>
  <point name="update_b.before_update2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.before_update3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="update_b.m_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.m_update2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.m_update3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                        ]]>
  </point>
  <point name="update_b.other" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <section id="apmt520.action_chk" ver="2" status="" src="s" readonly="">
    <![CDATA[#+ 修改/刪除前行為檢查(是否可允許此動作), 若有其他行為須管控也可透過此段落
PRIVATE FUNCTION apmt520_action_chk()
   #add-point:action_chk段define
   {<point name="action_chk.define" edit="s"/>}
   #end add-point
   #add-point:action_chk段define(客製用)
   {<point name="action_chk.define_customerization" edit="c"/>}
   #end add-point
   
   #add-point:action_chk段action_chk
   {<point name="action_chk.action_chk"/>}
   #end add-point
   
   RETURN TRUE
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.b_fill" ver="54" status="" src="s" readonly="">
    <![CDATA[#+ 單身陣列填充
PRIVATE FUNCTION apmt520_b_fill()
   DEFINE p_wc2      STRING
   DEFINE li_idx     LIKE type_t.num10
   #add-point:b_fill段define
   {<point name="b_fill.define" edit="s"/>}
   #end add-point     
   #add-point:b_fill段define(客製用)
   {<point name="b_fill.define_customerization" edit="c"/>}
   #end add-point     
 
   CALL g_pmdt_d.clear()    #g_pmdt_d 單頭及單身 
   CALL g_pmdt2_d.clear()
   CALL g_pmdt3_d.clear()
 
 
   #add-point:b_fill段sql_before
   {<point name="b_fill.sql_before"/>}
   #end add-point
   
   #判斷是否填充
   IF apmt520_fill_chk(1) THEN
      #切換上下筆時不重組SQL
      IF g_action_choice <> 'fetch' OR cl_null(g_action_choice) THEN
         LET g_sql = "SELECT  UNIQUE pmdtsite,pmdtseq,pmdt027,pmdt028,pmdt001,pmdt002,pmdt003,pmdt004, 
             pmdt081,pmdt082,pmdt083,pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019, 
             pmdt020,pmdt021,pmdt022,pmdt008,pmdt023,pmdt024,pmdt090,pmdt091,pmdt036,pmdt046,pmdt037, 
             pmdt038,pmdt039,pmdt047,pmdt092,pmdt093,pmdt026,pmdt041,pmdt062,pmdt016,pmdt017,pmdt018, 
             pmdt063,pmdt072,pmdt073,pmdt074,pmdt040,pmdt052,pmdt051,pmdt070,pmdt071,pmdt059,pmdt053, 
             pmdt054,pmdt055,pmdt060,pmdt061,pmdt042,pmdt043,pmdt048,pmdt044,pmdt045,pmdt084,pmdt089, 
             pmdt088 ,t1.imaal003 ,t2.oocql004 ,t3.oocal003 ,t4.oocal003 ,t5.imaal003 ,t6.oocal003 FROM pmdt_t", 
                
                     " INNER JOIN pmds_t ON pmdsdocno = pmdtdocno ",
 
                     #"",
                     
                     "",
                                    " LEFT JOIN imaal_t t1 ON t1.imaalent='"||g_enterprise||"' AND t1.imaal001=pmdt006 AND t1.imaal002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t2 ON t2.oocqlent='"||g_enterprise||"' AND t2.oocql001='221' AND t2.oocql002=pmdt009 AND t2.oocql003='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t3 ON t3.oocalent='"||g_enterprise||"' AND t3.oocal001=pmdt019 AND t3.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t4 ON t4.oocalent='"||g_enterprise||"' AND t4.oocal001=pmdt021 AND t4.oocal002='"||g_dlang||"' ",
               " LEFT JOIN imaal_t t5 ON t5.imaalent='"||g_enterprise||"' AND t5.imaal001=pmdt008 AND t5.imaal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t6 ON t6.oocalent='"||g_enterprise||"' AND t6.oocal001=pmdt023 AND t6.oocal002='"||g_dlang||"' ",
 
                     " WHERE pmdtent=? AND pmdtdocno=?"
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段sql_before
         {<point name="b_fill.body.fill_sql"/>}
         #end add-point
         IF NOT cl_null(g_wc2_table1) THEN
            LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY pmdt_t.pmdtseq"
         
         #add-point:單身填充控制
         {<point name="b_fill.sql"/>}
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE apmt520_pb FROM g_sql
         DECLARE b_fill_cs CURSOR FOR apmt520_pb
      END IF
      
      LET g_cnt = l_ac
      LET l_ac = 1
      
      OPEN b_fill_cs USING g_enterprise,g_pmds_m.pmdsdocno
                                               
      FOREACH b_fill_cs INTO g_pmdt_d[l_ac].pmdtsite,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt027,g_pmdt_d[l_ac].pmdt028, 
          g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt002,g_pmdt_d[l_ac].pmdt003,g_pmdt_d[l_ac].pmdt004, 
          g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082,g_pmdt_d[l_ac].pmdt083,g_pmdt_d[l_ac].pmdt005, 
          g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010, 
          g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt011,g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020, 
          g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt008,g_pmdt_d[l_ac].pmdt023, 
          g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt090,g_pmdt_d[l_ac].pmdt091,g_pmdt_d[l_ac].pmdt036, 
          g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt037,g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt039, 
          g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt092,g_pmdt_d[l_ac].pmdt093,g_pmdt_d[l_ac].pmdt026, 
          g_pmdt_d[l_ac].pmdt041,g_pmdt_d[l_ac].pmdt062,g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017, 
          g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt063,g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073, 
          g_pmdt_d[l_ac].pmdt074,g_pmdt_d[l_ac].pmdt040,g_pmdt_d[l_ac].pmdt052,g_pmdt_d[l_ac].pmdt051, 
          g_pmdt_d[l_ac].pmdt070,g_pmdt_d[l_ac].pmdt071,g_pmdt_d[l_ac].pmdt059,g_pmdt_d[l_ac].pmdt053, 
          g_pmdt_d[l_ac].pmdt054,g_pmdt_d[l_ac].pmdt055,g_pmdt_d[l_ac].pmdt060,g_pmdt_d[l_ac].pmdt061, 
          g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt048,g_pmdt_d[l_ac].pmdt044, 
          g_pmdt_d[l_ac].pmdt045,g_pmdt_d[l_ac].pmdt084,g_pmdt_d[l_ac].pmdt089,g_pmdt_d[l_ac].pmdt088, 
          g_pmdt_d[l_ac].pmdt006_desc,g_pmdt_d[l_ac].pmdt009_desc,g_pmdt_d[l_ac].pmdt019_desc,g_pmdt_d[l_ac].pmdt021_desc, 
          g_pmdt_d[l_ac].pmdt008_desc,g_pmdt_d[l_ac].pmdt023_desc
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充
         {<point name="b_fill.fill"/>}
         #end add-point
      
         IF l_ac > g_max_rec THEN
            IF g_error_show = 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code   = 9035 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
            END IF
            EXIT FOREACH
         END IF
         
         LET l_ac = l_ac + 1
      END FOREACH
      LET g_error_show = 0
   
   END IF
   
   #判斷是否填充
   IF apmt520_fill_chk(2) THEN
      IF g_action_choice <> 'fetch' OR cl_null(g_action_choice) THEN
         LET g_sql = "SELECT  UNIQUE pmdusite,pmduseq,pmduseq1,pmdu001,pmdu002,pmdu003,pmdu004,pmdu006, 
             pmdu007,pmdu008,pmdu005,pmdu009,pmdu010,pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,pmdu017, 
             pmdu016 ,t7.imaal003 ,t8.oocal003 ,t9.oocal003 FROM pmdu_t",   
                     " INNER JOIN pmds_t ON pmdsdocno = pmdudocno ",
 
                     "",
                     
                                    " LEFT JOIN imaal_t t7 ON t7.imaalent='"||g_enterprise||"' AND t7.imaal001=pmdu001 AND t7.imaal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t8 ON t8.oocalent='"||g_enterprise||"' AND t8.oocal001=pmdu009 AND t8.oocal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t9 ON t9.oocalent='"||g_enterprise||"' AND t9.oocal001=pmdu011 AND t9.oocal002='"||g_dlang||"' ",
 
                     " WHERE pmduent=? AND pmdudocno=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段sql_before
         {<point name="b_fill.body2.fill_sql"/>}
         #end add-point
         IF NOT cl_null(g_wc2_table2) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table2 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY pmdu_t.pmduseq,pmdu_t.pmduseq1"
         
         #add-point:單身填充控制
         {<point name="b_fill.sql2"/>}
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE apmt520_pb2 FROM g_sql
         DECLARE b_fill_cs2 CURSOR FOR apmt520_pb2
      END IF
    
      LET l_ac = 1
      
      OPEN b_fill_cs2 USING g_enterprise,g_pmds_m.pmdsdocno
                                               
      FOREACH b_fill_cs2 INTO g_pmdt2_d[l_ac].pmdusite,g_pmdt2_d[l_ac].pmduseq,g_pmdt2_d[l_ac].pmduseq1, 
          g_pmdt2_d[l_ac].pmdu001,g_pmdt2_d[l_ac].pmdu002,g_pmdt2_d[l_ac].pmdu003,g_pmdt2_d[l_ac].pmdu004, 
          g_pmdt2_d[l_ac].pmdu006,g_pmdt2_d[l_ac].pmdu007,g_pmdt2_d[l_ac].pmdu008,g_pmdt2_d[l_ac].pmdu005, 
          g_pmdt2_d[l_ac].pmdu009,g_pmdt2_d[l_ac].pmdu010,g_pmdt2_d[l_ac].pmdu011,g_pmdt2_d[l_ac].pmdu012, 
          g_pmdt2_d[l_ac].pmdu013,g_pmdt2_d[l_ac].pmdu014,g_pmdt2_d[l_ac].pmdu015,g_pmdt2_d[l_ac].pmdu017, 
          g_pmdt2_d[l_ac].pmdu016,g_pmdt2_d[l_ac].pmdu001_desc,g_pmdt2_d[l_ac].pmdu009_desc,g_pmdt2_d[l_ac].pmdu011_desc 

         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充
         {<point name="b_fill2.fill"/>}
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code   = 9035 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
   #判斷是否填充
   IF apmt520_fill_chk(3) THEN
      IF g_action_choice <> 'fetch' OR cl_null(g_action_choice) THEN
         LET g_sql = "SELECT  UNIQUE pmdvsite,pmdvseq,pmdvseq1,pmdv005,pmdv001,pmdv002,pmdv003,pmdv004, 
             pmdv014,pmdv015,pmdv016,pmdv017,pmdv018,pmdv019 ,t10.imaal003 ,t11.oocal003 FROM pmdv_t", 
                
                     " INNER JOIN pmds_t ON pmdsdocno = pmdvdocno ",
 
                     "",
                     
                                    " LEFT JOIN imaal_t t10 ON t10.imaalent='"||g_enterprise||"' AND t10.imaal001=pmdv001 AND t10.imaal002='"||g_dlang||"' ",
               " LEFT JOIN oocal_t t11 ON t11.oocalent='"||g_enterprise||"' AND t11.oocal001=pmdv018 AND t11.oocal002='"||g_dlang||"' ",
 
                     " WHERE pmdvent=? AND pmdvdocno=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段sql_before
         {<point name="b_fill.body3.fill_sql"/>}
         #end add-point
         IF NOT cl_null(g_wc2_table3) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table3 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY pmdv_t.pmdvseq,pmdv_t.pmdvseq1"
         
         #add-point:單身填充控制
         {<point name="b_fill.sql3"/>}
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE apmt520_pb3 FROM g_sql
         DECLARE b_fill_cs3 CURSOR FOR apmt520_pb3
      END IF
    
      LET l_ac = 1
      
      OPEN b_fill_cs3 USING g_enterprise,g_pmds_m.pmdsdocno
                                               
      FOREACH b_fill_cs3 INTO g_pmdt3_d[l_ac].pmdvsite,g_pmdt3_d[l_ac].pmdvseq,g_pmdt3_d[l_ac].pmdvseq1, 
          g_pmdt3_d[l_ac].pmdv005,g_pmdt3_d[l_ac].pmdv001,g_pmdt3_d[l_ac].pmdv002,g_pmdt3_d[l_ac].pmdv003, 
          g_pmdt3_d[l_ac].pmdv004,g_pmdt3_d[l_ac].pmdv014,g_pmdt3_d[l_ac].pmdv015,g_pmdt3_d[l_ac].pmdv016, 
          g_pmdt3_d[l_ac].pmdv017,g_pmdt3_d[l_ac].pmdv018,g_pmdt3_d[l_ac].pmdv019,g_pmdt3_d[l_ac].pmdv001_desc, 
          g_pmdt3_d[l_ac].pmdv018_desc
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充
         {<point name="b_fill3.fill"/>}
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code   = 9035 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
 
   
   #add-point:browser_fill段其他table處理
   {<point name="browser_fill.other_fill"/>}
   #end add-point
   
   CALL g_pmdt_d.deleteElement(g_pmdt_d.getLength())
   CALL g_pmdt2_d.deleteElement(g_pmdt2_d.getLength())
   CALL g_pmdt3_d.deleteElement(g_pmdt3_d.getLength())
 
   
 
   LET l_ac = g_cnt
   LET g_cnt = 0  
   
   FREE apmt520_pb
   FREE apmt520_pb2
 
   FREE apmt520_pb3
 
 
   
   LET li_idx = l_ac
   
   #遮罩相關處理
   FOR l_ac = 1 TO g_pmdt_d.getLength()
      LET g_pmdt_d_mask_o[l_ac].* =  g_pmdt_d[l_ac].*
      CALL apmt520_pmdt_t_mask()
      LET g_pmdt_d_mask_n[l_ac].* =  g_pmdt_d[l_ac].*
   END FOR
   
   LET g_pmdt2_d_mask_o.* =  g_pmdt2_d.*
   FOR l_ac = 1 TO g_pmdt2_d.getLength()
      LET g_pmdt2_d_mask_o[l_ac].* =  g_pmdt2_d[l_ac].*
      CALL apmt520_pmdu_t_mask()
      LET g_pmdt2_d_mask_n[l_ac].* =  g_pmdt2_d[l_ac].*
   END FOR
   LET g_pmdt3_d_mask_o.* =  g_pmdt3_d.*
   FOR l_ac = 1 TO g_pmdt3_d.getLength()
      LET g_pmdt3_d_mask_o[l_ac].* =  g_pmdt3_d[l_ac].*
      CALL apmt520_pmdv_t_mask()
      LET g_pmdt3_d_mask_n[l_ac].* =  g_pmdt3_d[l_ac].*
   END FOR
 
   
   LET l_ac = li_idx
   
   CALL cl_ap_performance_next_end()
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.b_fill2" ver="6" status="" src="s" readonly="">
    <![CDATA[#+ 單身陣列填充2
PRIVATE FUNCTION apmt520_b_fill2(pi_idx)
   DEFINE pi_idx          LIKE type_t.num10
   DEFINE li_ac           LIKE type_t.num10
   DEFINE ls_chk          LIKE type_t.chr1
   #add-point:b_fill2段define
   {<point name="b_fill2.define" edit="s"/>}
   #end add-point
   #add-point:b_fill2段define(客製用)
   {<point name="b_fill2.define_customerization" edit="c"/>}
   #end add-point
   
   LET li_ac = l_ac 
   
   IF g_detail_idx <= 0 THEN
      RETURN
   END IF
   
 
      
 
      
   #add-point:單身填充後
   {<point name="b_fill2.after_fill" />}
   #end add-point
    
   LET l_ac = li_ac
   
   CALL apmt520_detail_show()
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.browser_fill" ver="42" status="" src="s" readonly="">
    <![CDATA[#+ 瀏覽頁簽資料填充
PRIVATE FUNCTION apmt520_browser_fill(ps_page_action)
   DEFINE ps_page_action    STRING
   DEFINE l_wc              STRING
   DEFINE l_wc2             STRING
   DEFINE l_sql             STRING
   DEFINE l_sub_sql         STRING
   DEFINE l_sql_rank        STRING
   #add-point:browser_fill段define
   {<point name="browser_fill.define" edit="s"/>}
   #end add-point   
   #add-point:browser_fill段define(客製用)
   {<point name="browser_fill.define_customerization" edit="c"/>}
   #end add-point   
   
   #add-point:browser_fill段動作開始前
   {<point name="browser_fill.before_browser_fill"/>}
   #end add-point
   
   IF cl_null(g_wc) THEN
      LET g_wc = " 1=1"
   END IF
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   LET l_wc  = g_wc.trim() 
   LET l_wc2 = g_wc2.trim()
 
   #add-point:browser_fill,foreach前
   {<point name="browser_fill.before_foreach"/>}
   #end add-point
   
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件                      
      LET l_sub_sql = " SELECT UNIQUE pmdsdocno ",
                      " FROM pmds_t ",
                      " ",
                      " LEFT JOIN pmdt_t ON pmdtent = pmdsent AND pmdsdocno = pmdtdocno ", "  ",
                      #add-point:browser_fill段sql(pmdt_t1)
                      {<point name="browser_fill.cnt.join.}"/>}
                      #end add-point
                      " LEFT JOIN pmdu_t ON pmduent = pmdsent AND pmdsdocno = pmdudocno", "  ",
                      #add-point:browser_fill段sql(pmdu_t1)
                      {<point name="browser_fill.cnt.join.pmdu_t1"/>}
                      #end add-point
 
                      " LEFT JOIN pmdv_t ON pmdvent = pmdsent AND pmdsdocno = pmdvdocno", "  ",
                      #add-point:browser_fill段sql(pmdv_t1)
                      {<point name="browser_fill.cnt.join.pmdv_t1"/>}
                      #end add-point
 
 
 
                      " ", 
                      " ", 
                      " WHERE pmdsent = '" ||g_enterprise|| "' AND pmdtent = '" ||g_enterprise|| "' AND ",l_wc, " AND ", l_wc2, cl_sql_add_filter("pmds_t")
   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT UNIQUE pmdsdocno ",
                      " FROM pmds_t ", 
                      "  ",
                      "  ",
                      " WHERE pmdsent = '" ||g_enterprise|| "' AND ",l_wc CLIPPED, cl_sql_add_filter("pmds_t")
   END IF
   
   #add-point:browser_fill,cnt wc
   {<point name="browser_fill.cnt_sqlwc"/>}
   #end add-point
   
   LET g_sql = " SELECT COUNT(*) FROM (",l_sub_sql,")"
   
   #add-point:browser_fill,count前
   {<point name="browser_fill.before_count"/>}
   #end add-point
   
   PREPARE header_cnt_pre FROM g_sql
   EXECUTE header_cnt_pre INTO g_browser_cnt   #總筆數
   FREE header_cnt_pre
    
   IF g_browser_cnt > g_max_browse THEN
      IF g_error_show = 1 THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_browser_cnt
         LET g_errparam.code   = 9035 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
      END IF
      LET g_browser_cnt = g_max_browse
   END IF
   
   DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
   DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
 
   #根據行為確定資料填充位置及WC
   IF cl_null(g_add_browse) THEN
      #清除畫面
      CLEAR FORM                
      INITIALIZE g_pmds_m.* TO NULL
      CALL g_pmdt_d.clear()        
      CALL g_pmdt2_d.clear() 
      CALL g_pmdt3_d.clear() 
 
      #add-point:browser_fill g_add_browse段額外處理
      {<point name="browser_fill.add_browse.other"/>}
      #end add-point   
      CALL g_browser.clear()
      LET g_cnt = 1
   ELSE
      LET l_wc  = g_add_browse
      LET l_wc2 = " 1=1" 
      LET g_cnt = g_current_idx
   END IF
 
   #依照t0.pmdsdocno,t0.pmdsdocdt,t0.pmds002,t0.pmds003,t0.pmds007,t0.pmds008,t0.pmds009 Browser欄位定義(取代原本bs_sql功能)
   #考量到單身可能下條件, 所以此處需join單身所有table
   #DISTINCT是為了避免在join時出現重複的資料(如果不加DISTINCT則須在程式中過濾)
   LET g_sql = " SELECT DISTINCT t0.pmdsstus,t0.pmdsdocno,t0.pmdsdocdt,t0.pmds002,t0.pmds003,t0.pmds007, 
       t0.pmds008,t0.pmds009,t1.ooag011 ,t2.ooefl003 ",
               " FROM pmds_t t0",
               "  ",
               "  LEFT JOIN pmdt_t ON pmdtent = pmdsent AND pmdsdocno = pmdtdocno ", "  ", 
               #add-point:browser_fill段sql(pmdt_t1)
               {<point name="browser_fill.join.pmdt_t1"/>}
               #end add-point
               "  LEFT JOIN pmdu_t ON pmduent = pmdsent AND pmdsdocno = pmdudocno", "  ", 
               #add-point:browser_fill段sql(pmdu_t1)
               {<point name="browser_fill.join.pmdu_t1"/>}
               #end add-point
 
               "  LEFT JOIN pmdv_t ON pmdvent = pmdsent AND pmdsdocno = pmdvdocno", "  ", 
               #add-point:browser_fill段sql(pmdv_t1)
               {<point name="browser_fill.join.pmdv_t1"/>}
               #end add-point
 
 
 
               "  ",
                              " LEFT JOIN ooag_t t1 ON t1.ooagent='"||g_enterprise||"' AND t1.ooag001=t0.pmds002  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent='"||g_enterprise||"' AND t2.ooefl001=t0.pmds003 AND t2.ooefl002='"||g_lang||"' ",
 
               " WHERE t0.pmdsent = '" ||g_enterprise|| "' AND ",l_wc," AND ",l_wc2, cl_sql_add_filter("pmds_t")
   #add-point:browser_fill,sql wc
   {<point name="browser_fill.fill_sqlwc"/>}
   #end add-point
   LET g_sql = g_sql, " ORDER BY pmdsdocno ",g_order
 
   #add-point:browser_fill,before_prepare
   {<point name="browser_fill.before_prepare"/>}
   #end add-point
        
   #LET g_sql = cl_sql_add_tabid(g_sql,"pmds_t") #WC重組
   LET g_sql = cl_sql_add_mask(g_sql) #遮蔽特定資料
   PREPARE browse_pre FROM g_sql
   DECLARE browse_cur CURSOR FOR browse_pre
   
   #add-point:browser_fill段open cursor
   {<point name="browser_fill.open"/>}
   #end add-point
   
   FOREACH browse_cur INTO g_browser[g_cnt].b_statepic,g_browser[g_cnt].b_pmdsdocno,g_browser[g_cnt].b_pmdsdocdt, 
       g_browser[g_cnt].b_pmds002,g_browser[g_cnt].b_pmds003,g_browser[g_cnt].b_pmds007,g_browser[g_cnt].b_pmds008, 
       g_browser[g_cnt].b_pmds009,g_browser[g_cnt].b_pmds002_desc,g_browser[g_cnt].b_pmds003_desc
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = 'foreach:' 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         EXIT FOREACH
      END IF
  
      #add-point:browser_fill段reference
      {<point name="browser_fill.reference"/>}
      #end add-point
  
      #遮罩相關處理
      CALL apmt520_browser_mask()
  
            #應用 a24 樣板自動產生(Version:2)
      #browser顯示圖片
      CASE g_browser[g_cnt].b_statepic
         WHEN "N"
            LET g_browser[g_cnt].b_statepic = "stus/16/unconfirmed.png"
         WHEN "Y"
            LET g_browser[g_cnt].b_statepic = "stus/16/confirmed.png"
         WHEN "S"
            LET g_browser[g_cnt].b_statepic = "stus/16/posted.png"
         WHEN "A"
            LET g_browser[g_cnt].b_statepic = "stus/16/approved.png"
         WHEN "D"
            LET g_browser[g_cnt].b_statepic = "stus/16/withdraw.png"
         WHEN "R"
            LET g_browser[g_cnt].b_statepic = "stus/16/rejection.png"
         WHEN "W"
            LET g_browser[g_cnt].b_statepic = "stus/16/signing.png"
         WHEN "X"
            LET g_browser[g_cnt].b_statepic = "stus/16/invalid.png"
         
      END CASE
 
 
      LET g_cnt = g_cnt + 1
      IF g_cnt > g_max_browse THEN
         EXIT FOREACH
      END IF
      
   END FOREACH
   
   #清空g_add_browse, 並指定指標位置
   IF NOT cl_null(g_add_browse) THEN
      LET g_add_browse = ""
      CALL g_curr_diag.setCurrentRow("s_browse",g_current_idx)
   END IF
   
   IF cl_null(g_browser[g_cnt].b_pmdsdocno) THEN
      CALL g_browser.deleteElement(g_cnt)
   END IF
   
   LET g_header_cnt  = g_browser.getLength()
   LET g_browser_cnt = g_browser.getLength()
   
   #筆數顯示
   IF g_browser_cnt > 0 THEN
      DISPLAY g_browser_idx TO FORMONLY.b_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.b_count #總筆數
      DISPLAY g_browser_idx TO FORMONLY.h_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.h_count #總筆數
      DISPLAY g_detail_idx  TO FORMONLY.idx     #單身當下筆數
      DISPLAY g_detail_cnt  TO FORMONLY.cnt     #單身總筆數
   ELSE
      DISPLAY '' TO FORMONLY.b_index #當下筆數
      DISPLAY '' TO FORMONLY.b_count #總筆數
      DISPLAY '' TO FORMONLY.h_index #當下筆數
      DISPLAY '' TO FORMONLY.h_count #總筆數
      DISPLAY '' TO FORMONLY.idx     #單身當下筆數
      DISPLAY '' TO FORMONLY.cnt     #單身總筆數
   END IF
 
   LET g_rec_b = g_cnt - 1
   LET g_detail_cnt = g_rec_b
   LET g_cnt = 0
   
   FREE browse_pre
   
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
                  
   
   #add-point:browser_fill段結束前
   {<point name="browser_fill.after"/>}
   #end add-point   
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.construct" ver="61" status="" src="s" readonly="">
    <![CDATA[#+ QBE資料查詢
PRIVATE FUNCTION apmt520_construct()
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING 
   DEFINE ls_wc       STRING 
   DEFINE la_wc       DYNAMIC ARRAY OF RECORD
          tableid     STRING,
          wc          STRING
          END RECORD
   DEFINE li_idx      LIKE type_t.num10
   #add-point:cs段define
   {<point name="cs.define" edit="s"/>}
   #end add-point    
   #add-point:cs段define(客製用)
   {<point name="cs.define_customerization" edit="c"/>}
   #end add-point    
    
   #清除畫面
   CLEAR FORM                
   INITIALIZE g_pmds_m.* TO NULL
   CALL g_pmdt_d.clear()        
   CALL g_pmdt2_d.clear() 
   CALL g_pmdt3_d.clear() 
 
   
   LET g_action_choice = ""
    
   INITIALIZE g_wc TO NULL
   INITIALIZE g_wc2 TO NULL
   
   INITIALIZE g_wc2_table1 TO NULL
   INITIALIZE g_wc2_table2 TO NULL
 
   INITIALIZE g_wc2_table3 TO NULL
 
 
    
   LET g_qryparam.state = 'c'
   
   #add-point:cs段開始前
   {<point name="cs.before_construct"/>}
   #end add-point 
   
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      
      #單頭
      CONSTRUCT BY NAME g_wc ON pmdssite,pmdsdocno,pmdsdocno_desc,pmdsdocdt,pmds001,pmds002,pmds003, 
          pmdsstus,pmds006,pmds007,pmds008,pmds009,pmds010,pmds052,pmds000,pmds100,pmds011,pmds014,pmds081, 
          pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,pmds037, 
          pmds038,pmds039,pmds040,pmds012,pmds101,pmds102,pmds048,pmds047,pmds049,pmds053,pmds041,pmds042, 
          pmds043,pmds044,pmds046,pmds054,pmds055,pmds050,pmdsownid,pmdsowndp,pmdscrtid,pmdscrtdp,pmdscrtdt, 
          pmdsmodid,pmdsmoddt,pmdscnfid,pmdscnfdt,pmdspstid,pmdspstdt
 
         BEFORE CONSTRUCT
            #add-point:cs段before_construct
            {<point name="cs.head.before_construct"/>}
            #end add-point 
            
         #公用欄位開窗相關處理
         #應用 a11 樣板自動產生(Version:2)
         #共用欄位查詢處理  
         ##----<<pmdscrtdt>>----
         AFTER FIELD pmdscrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
 
         #----<<pmdsmoddt>>----
         AFTER FIELD pmdsmoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<pmdscnfdt>>----
         AFTER FIELD pmdscnfdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<pmdspstdt>>----
         AFTER FIELD pmdspstdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
 
 
            
         #一般欄位開窗相關處理    
                  #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdssite
            #add-point:BEFORE FIELD pmdssite
            {<point name="construct.b.pmdssite" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdssite
            
            #add-point:AFTER FIELD pmdssite
            {<point name="construct.a.pmdssite" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmdssite
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdssite
            #add-point:ON ACTION controlp INFIELD pmdssite
            {<point name="construct.c.pmdssite" />}
            #END add-point
 
         #Ctrlp:construct.c.pmdsdocno
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsdocno
            #add-point:ON ACTION controlp INFIELD pmdsdocno
            {<point name="construct.c.pmdsdocno" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsdocno
            #add-point:BEFORE FIELD pmdsdocno
            {<point name="construct.b.pmdsdocno" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsdocno
            
            #add-point:AFTER FIELD pmdsdocno
            {<point name="construct.a.pmdsdocno" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsdocno_desc
            #add-point:BEFORE FIELD pmdsdocno_desc
            {<point name="construct.b.pmdsdocno_desc" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsdocno_desc
            
            #add-point:AFTER FIELD pmdsdocno_desc
            {<point name="construct.a.pmdsdocno_desc" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmdsdocno_desc
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsdocno_desc
            #add-point:ON ACTION controlp INFIELD pmdsdocno_desc
            {<point name="construct.c.pmdsdocno_desc" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsdocdt
            #add-point:BEFORE FIELD pmdsdocdt
            {<point name="construct.b.pmdsdocdt" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsdocdt
            
            #add-point:AFTER FIELD pmdsdocdt
            {<point name="construct.a.pmdsdocdt" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmdsdocdt
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsdocdt
            #add-point:ON ACTION controlp INFIELD pmdsdocdt
            {<point name="construct.c.pmdsdocdt" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds001
            #add-point:BEFORE FIELD pmds001
            {<point name="construct.b.pmds001" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds001
            
            #add-point:AFTER FIELD pmds001
            {<point name="construct.a.pmds001" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds001
            #add-point:ON ACTION controlp INFIELD pmds001
            {<point name="construct.c.pmds001" />}
            #END add-point
 
         #Ctrlp:construct.c.pmds002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds002
            #add-point:ON ACTION controlp INFIELD pmds002
            {<point name="construct.c.pmds002" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds002
            #add-point:BEFORE FIELD pmds002
            {<point name="construct.b.pmds002" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds002
            
            #add-point:AFTER FIELD pmds002
            {<point name="construct.a.pmds002" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds003
            #add-point:ON ACTION controlp INFIELD pmds003
            {<point name="construct.c.pmds003" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds003
            #add-point:BEFORE FIELD pmds003
            {<point name="construct.b.pmds003" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds003
            
            #add-point:AFTER FIELD pmds003
            {<point name="construct.a.pmds003" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsstus
            #add-point:BEFORE FIELD pmdsstus
            {<point name="construct.b.pmdsstus" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsstus
            
            #add-point:AFTER FIELD pmdsstus
            {<point name="construct.a.pmdsstus" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmdsstus
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsstus
            #add-point:ON ACTION controlp INFIELD pmdsstus
            {<point name="construct.c.pmdsstus" />}
            #END add-point
 
         #Ctrlp:construct.c.pmds006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds006
            #add-point:ON ACTION controlp INFIELD pmds006
            {<point name="construct.c.pmds006" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds006
            #add-point:BEFORE FIELD pmds006
            {<point name="construct.b.pmds006" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds006
            
            #add-point:AFTER FIELD pmds006
            {<point name="construct.a.pmds006" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds007
            #add-point:ON ACTION controlp INFIELD pmds007
            {<point name="construct.c.pmds007" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds007
            #add-point:BEFORE FIELD pmds007
            {<point name="construct.b.pmds007" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds007
            
            #add-point:AFTER FIELD pmds007
            {<point name="construct.a.pmds007" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds008
            #add-point:ON ACTION controlp INFIELD pmds008
            {<point name="construct.c.pmds008" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds008
            #add-point:BEFORE FIELD pmds008
            {<point name="construct.b.pmds008" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds008
            
            #add-point:AFTER FIELD pmds008
            {<point name="construct.a.pmds008" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds009
            #add-point:ON ACTION controlp INFIELD pmds009
            {<point name="construct.c.pmds009" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds009
            #add-point:BEFORE FIELD pmds009
            {<point name="construct.b.pmds009" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds009
            
            #add-point:AFTER FIELD pmds009
            {<point name="construct.a.pmds009" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds010
            #add-point:BEFORE FIELD pmds010
            {<point name="construct.b.pmds010" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds010
            
            #add-point:AFTER FIELD pmds010
            {<point name="construct.a.pmds010" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds010
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds010
            #add-point:ON ACTION controlp INFIELD pmds010
            {<point name="construct.c.pmds010" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds052
            #add-point:BEFORE FIELD pmds052
            {<point name="construct.b.pmds052" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds052
            
            #add-point:AFTER FIELD pmds052
            {<point name="construct.a.pmds052" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds052
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds052
            #add-point:ON ACTION controlp INFIELD pmds052
            {<point name="construct.c.pmds052" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds000
            #add-point:BEFORE FIELD pmds000
            {<point name="construct.b.pmds000" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds000
            
            #add-point:AFTER FIELD pmds000
            {<point name="construct.a.pmds000" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds000
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds000
            #add-point:ON ACTION controlp INFIELD pmds000
            {<point name="construct.c.pmds000" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds100
            #add-point:BEFORE FIELD pmds100
            {<point name="construct.b.pmds100" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds100
            
            #add-point:AFTER FIELD pmds100
            {<point name="construct.a.pmds100" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds100
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds100
            #add-point:ON ACTION controlp INFIELD pmds100
            {<point name="construct.c.pmds100" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds011
            #add-point:BEFORE FIELD pmds011
            {<point name="construct.b.pmds011" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds011
            
            #add-point:AFTER FIELD pmds011
            {<point name="construct.a.pmds011" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds011
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds011
            #add-point:ON ACTION controlp INFIELD pmds011
            {<point name="construct.c.pmds011" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds014
            #add-point:BEFORE FIELD pmds014
            {<point name="construct.b.pmds014" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds014
            
            #add-point:AFTER FIELD pmds014
            {<point name="construct.a.pmds014" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds014
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds014
            #add-point:ON ACTION controlp INFIELD pmds014
            {<point name="construct.c.pmds014" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds081
            #add-point:BEFORE FIELD pmds081
            {<point name="construct.b.pmds081" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds081
            
            #add-point:AFTER FIELD pmds081
            {<point name="construct.a.pmds081" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds081
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds081
            #add-point:ON ACTION controlp INFIELD pmds081
            {<point name="construct.c.pmds081" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds045
            #add-point:BEFORE FIELD pmds045
            {<point name="construct.b.pmds045" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds045
            
            #add-point:AFTER FIELD pmds045
            {<point name="construct.a.pmds045" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds045
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds045
            #add-point:ON ACTION controlp INFIELD pmds045
            {<point name="construct.c.pmds045" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds021
            #add-point:BEFORE FIELD pmds021
            {<point name="construct.b.pmds021" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds021
            
            #add-point:AFTER FIELD pmds021
            {<point name="construct.a.pmds021" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds021
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds021
            #add-point:ON ACTION controlp INFIELD pmds021
            {<point name="construct.c.pmds021" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds022
            #add-point:BEFORE FIELD pmds022
            {<point name="construct.b.pmds022" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds022
            
            #add-point:AFTER FIELD pmds022
            {<point name="construct.a.pmds022" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds022
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds022
            #add-point:ON ACTION controlp INFIELD pmds022
            {<point name="construct.c.pmds022" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds023
            #add-point:BEFORE FIELD pmds023
            {<point name="construct.b.pmds023" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds023
            
            #add-point:AFTER FIELD pmds023
            {<point name="construct.a.pmds023" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds023
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds023
            #add-point:ON ACTION controlp INFIELD pmds023
            {<point name="construct.c.pmds023" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds024
            #add-point:BEFORE FIELD pmds024
            {<point name="construct.b.pmds024" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds024
            
            #add-point:AFTER FIELD pmds024
            {<point name="construct.a.pmds024" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds024
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds024
            #add-point:ON ACTION controlp INFIELD pmds024
            {<point name="construct.c.pmds024" />}
            #END add-point
 
         #Ctrlp:construct.c.pmds031
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds031
            #add-point:ON ACTION controlp INFIELD pmds031
            {<point name="construct.c.pmds031" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds031
            #add-point:BEFORE FIELD pmds031
            {<point name="construct.b.pmds031" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds031
            
            #add-point:AFTER FIELD pmds031
            {<point name="construct.a.pmds031" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds032
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds032
            #add-point:ON ACTION controlp INFIELD pmds032
            {<point name="construct.c.pmds032" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds032
            #add-point:BEFORE FIELD pmds032
            {<point name="construct.b.pmds032" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds032
            
            #add-point:AFTER FIELD pmds032
            {<point name="construct.a.pmds032" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds033
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds033
            #add-point:ON ACTION controlp INFIELD pmds033
            {<point name="construct.c.pmds033" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds033
            #add-point:BEFORE FIELD pmds033
            {<point name="construct.b.pmds033" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds033
            
            #add-point:AFTER FIELD pmds033
            {<point name="construct.a.pmds033" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds034
            #add-point:BEFORE FIELD pmds034
            {<point name="construct.b.pmds034" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds034
            
            #add-point:AFTER FIELD pmds034
            {<point name="construct.a.pmds034" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds034
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds034
            #add-point:ON ACTION controlp INFIELD pmds034
            {<point name="construct.c.pmds034" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds035
            #add-point:BEFORE FIELD pmds035
            {<point name="construct.b.pmds035" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds035
            
            #add-point:AFTER FIELD pmds035
            {<point name="construct.a.pmds035" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds035
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds035
            #add-point:ON ACTION controlp INFIELD pmds035
            {<point name="construct.c.pmds035" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds036
            #add-point:BEFORE FIELD pmds036
            {<point name="construct.b.pmds036" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds036
            
            #add-point:AFTER FIELD pmds036
            {<point name="construct.a.pmds036" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds036
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds036
            #add-point:ON ACTION controlp INFIELD pmds036
            {<point name="construct.c.pmds036" />}
            #END add-point
 
         #Ctrlp:construct.c.pmds037
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds037
            #add-point:ON ACTION controlp INFIELD pmds037
            {<point name="construct.c.pmds037" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds037
            #add-point:BEFORE FIELD pmds037
            {<point name="construct.b.pmds037" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds037
            
            #add-point:AFTER FIELD pmds037
            {<point name="construct.a.pmds037" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds038
            #add-point:BEFORE FIELD pmds038
            {<point name="construct.b.pmds038" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds038
            
            #add-point:AFTER FIELD pmds038
            {<point name="construct.a.pmds038" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds038
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds038
            #add-point:ON ACTION controlp INFIELD pmds038
            {<point name="construct.c.pmds038" />}
            #END add-point
 
         #Ctrlp:construct.c.pmds039
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds039
            #add-point:ON ACTION controlp INFIELD pmds039
            {<point name="construct.c.pmds039" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds039
            #add-point:BEFORE FIELD pmds039
            {<point name="construct.b.pmds039" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds039
            
            #add-point:AFTER FIELD pmds039
            {<point name="construct.a.pmds039" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds040
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds040
            #add-point:ON ACTION controlp INFIELD pmds040
            {<point name="construct.c.pmds040" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds040
            #add-point:BEFORE FIELD pmds040
            {<point name="construct.b.pmds040" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds040
            
            #add-point:AFTER FIELD pmds040
            {<point name="construct.a.pmds040" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds012
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds012
            #add-point:ON ACTION controlp INFIELD pmds012
            {<point name="construct.c.pmds012" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds012
            #add-point:BEFORE FIELD pmds012
            {<point name="construct.b.pmds012" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds012
            
            #add-point:AFTER FIELD pmds012
            {<point name="construct.a.pmds012" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds101
            #add-point:BEFORE FIELD pmds101
            {<point name="construct.b.pmds101" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds101
            
            #add-point:AFTER FIELD pmds101
            {<point name="construct.a.pmds101" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds101
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds101
            #add-point:ON ACTION controlp INFIELD pmds101
            {<point name="construct.c.pmds101" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds102
            #add-point:BEFORE FIELD pmds102
            {<point name="construct.b.pmds102" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds102
            
            #add-point:AFTER FIELD pmds102
            {<point name="construct.a.pmds102" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds102
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds102
            #add-point:ON ACTION controlp INFIELD pmds102
            {<point name="construct.c.pmds102" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds048
            #add-point:BEFORE FIELD pmds048
            {<point name="construct.b.pmds048" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds048
            
            #add-point:AFTER FIELD pmds048
            {<point name="construct.a.pmds048" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds048
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds048
            #add-point:ON ACTION controlp INFIELD pmds048
            {<point name="construct.c.pmds048" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds047
            #add-point:BEFORE FIELD pmds047
            {<point name="construct.b.pmds047" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds047
            
            #add-point:AFTER FIELD pmds047
            {<point name="construct.a.pmds047" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds047
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds047
            #add-point:ON ACTION controlp INFIELD pmds047
            {<point name="construct.c.pmds047" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds049
            #add-point:BEFORE FIELD pmds049
            {<point name="construct.b.pmds049" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds049
            
            #add-point:AFTER FIELD pmds049
            {<point name="construct.a.pmds049" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds049
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds049
            #add-point:ON ACTION controlp INFIELD pmds049
            {<point name="construct.c.pmds049" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds053
            #add-point:BEFORE FIELD pmds053
            {<point name="construct.b.pmds053" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds053
            
            #add-point:AFTER FIELD pmds053
            {<point name="construct.a.pmds053" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds053
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds053
            #add-point:ON ACTION controlp INFIELD pmds053
            {<point name="construct.c.pmds053" />}
            #END add-point
 
         #Ctrlp:construct.c.pmds041
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds041
            #add-point:ON ACTION controlp INFIELD pmds041
            {<point name="construct.c.pmds041" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds041
            #add-point:BEFORE FIELD pmds041
            {<point name="construct.b.pmds041" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds041
            
            #add-point:AFTER FIELD pmds041
            {<point name="construct.a.pmds041" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds042
            #add-point:BEFORE FIELD pmds042
            {<point name="construct.b.pmds042" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds042
            
            #add-point:AFTER FIELD pmds042
            {<point name="construct.a.pmds042" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds042
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds042
            #add-point:ON ACTION controlp INFIELD pmds042
            {<point name="construct.c.pmds042" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds043
            #add-point:BEFORE FIELD pmds043
            {<point name="construct.b.pmds043" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds043
            
            #add-point:AFTER FIELD pmds043
            {<point name="construct.a.pmds043" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds043
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds043
            #add-point:ON ACTION controlp INFIELD pmds043
            {<point name="construct.c.pmds043" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds044
            #add-point:BEFORE FIELD pmds044
            {<point name="construct.b.pmds044" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds044
            
            #add-point:AFTER FIELD pmds044
            {<point name="construct.a.pmds044" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds044
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds044
            #add-point:ON ACTION controlp INFIELD pmds044
            {<point name="construct.c.pmds044" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds046
            #add-point:BEFORE FIELD pmds046
            {<point name="construct.b.pmds046" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds046
            
            #add-point:AFTER FIELD pmds046
            {<point name="construct.a.pmds046" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds046
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds046
            #add-point:ON ACTION controlp INFIELD pmds046
            {<point name="construct.c.pmds046" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds054
            #add-point:BEFORE FIELD pmds054
            {<point name="construct.b.pmds054" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds054
            
            #add-point:AFTER FIELD pmds054
            {<point name="construct.a.pmds054" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds054
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds054
            #add-point:ON ACTION controlp INFIELD pmds054
            {<point name="construct.c.pmds054" />}
            #END add-point
 
         #Ctrlp:construct.c.pmds055
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds055
            #add-point:ON ACTION controlp INFIELD pmds055
            {<point name="construct.c.pmds055" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds055
            #add-point:BEFORE FIELD pmds055
            {<point name="construct.b.pmds055" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds055
            
            #add-point:AFTER FIELD pmds055
            {<point name="construct.a.pmds055" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds050
            #add-point:BEFORE FIELD pmds050
            {<point name="construct.b.pmds050" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds050
            
            #add-point:AFTER FIELD pmds050
            {<point name="construct.a.pmds050" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmds050
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds050
            #add-point:ON ACTION controlp INFIELD pmds050
            {<point name="construct.c.pmds050" />}
            #END add-point
 
         #Ctrlp:construct.c.pmdsownid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsownid
            #add-point:ON ACTION controlp INFIELD pmdsownid
            {<point name="construct.c.pmdsownid" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsownid
            #add-point:BEFORE FIELD pmdsownid
            {<point name="construct.b.pmdsownid" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsownid
            
            #add-point:AFTER FIELD pmdsownid
            {<point name="construct.a.pmdsownid" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmdsowndp
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsowndp
            #add-point:ON ACTION controlp INFIELD pmdsowndp
            {<point name="construct.c.pmdsowndp" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsowndp
            #add-point:BEFORE FIELD pmdsowndp
            {<point name="construct.b.pmdsowndp" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsowndp
            
            #add-point:AFTER FIELD pmdsowndp
            {<point name="construct.a.pmdsowndp" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmdscrtid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdscrtid
            #add-point:ON ACTION controlp INFIELD pmdscrtid
            {<point name="construct.c.pmdscrtid" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdscrtid
            #add-point:BEFORE FIELD pmdscrtid
            {<point name="construct.b.pmdscrtid" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdscrtid
            
            #add-point:AFTER FIELD pmdscrtid
            {<point name="construct.a.pmdscrtid" />}
            #END add-point
            
 
         #Ctrlp:construct.c.pmdscrtdp
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdscrtdp
            #add-point:ON ACTION controlp INFIELD pmdscrtdp
            {<point name="construct.c.pmdscrtdp" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdscrtdp
            #add-point:BEFORE FIELD pmdscrtdp
            {<point name="construct.b.pmdscrtdp" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdscrtdp
            
            #add-point:AFTER FIELD pmdscrtdp
            {<point name="construct.a.pmdscrtdp" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdscrtdt
            #add-point:BEFORE FIELD pmdscrtdt
            {<point name="construct.b.pmdscrtdt" />}
            #END add-point
 
         #Ctrlp:construct.c.pmdsmodid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsmodid
            #add-point:ON ACTION controlp INFIELD pmdsmodid
            {<point name="construct.c.pmdsmodid" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsmodid
            #add-point:BEFORE FIELD pmdsmodid
            {<point name="construct.b.pmdsmodid" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsmodid
            
            #add-point:AFTER FIELD pmdsmodid
            {<point name="construct.a.pmdsmodid" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsmoddt
            #add-point:BEFORE FIELD pmdsmoddt
            {<point name="construct.b.pmdsmoddt" />}
            #END add-point
 
         #Ctrlp:construct.c.pmdscnfid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdscnfid
            #add-point:ON ACTION controlp INFIELD pmdscnfid
            {<point name="construct.c.pmdscnfid" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdscnfid
            #add-point:BEFORE FIELD pmdscnfid
            {<point name="construct.b.pmdscnfid" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdscnfid
            
            #add-point:AFTER FIELD pmdscnfid
            {<point name="construct.a.pmdscnfid" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdscnfdt
            #add-point:BEFORE FIELD pmdscnfdt
            {<point name="construct.b.pmdscnfdt" />}
            #END add-point
 
         #Ctrlp:construct.c.pmdspstid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdspstid
            #add-point:ON ACTION controlp INFIELD pmdspstid
            {<point name="construct.c.pmdspstid" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdspstid
            #add-point:BEFORE FIELD pmdspstid
            {<point name="construct.b.pmdspstid" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdspstid
            
            #add-point:AFTER FIELD pmdspstid
            {<point name="construct.a.pmdspstid" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdspstdt
            #add-point:BEFORE FIELD pmdspstdt
            {<point name="construct.b.pmdspstdt" />}
            #END add-point
 
 
         
      END CONSTRUCT
 
      #單身根據table分拆construct
      CONSTRUCT g_wc2_table1 ON pmdtsite,pmdtseq,pmdt027,pmdt028,pmdt001,pmdt002,pmdt003,pmdt004,pmdt081, 
          pmdt082,pmdt083,pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021, 
          pmdt022,pmdt008,pmdt023,pmdt024,pmdt090,pmdt091,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047, 
          pmdt092,pmdt093,pmdt026,pmdt041,pmdt062,pmdt016,pmdt017,pmdt018,pmdt063,pmdt072,pmdt073,pmdt074, 
          pmdt051,pmdt070,pmdt071,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061,pmdt042,pmdt043,pmdt048, 
          pmdt044,pmdt045,pmdt084,pmdt089,pmdt088
           FROM s_detail1[1].pmdtsite,s_detail1[1].pmdtseq,s_detail1[1].pmdt027,s_detail1[1].pmdt028, 
               s_detail1[1].pmdt001,s_detail1[1].pmdt002,s_detail1[1].pmdt003,s_detail1[1].pmdt004,s_detail1[1].pmdt081, 
               s_detail1[1].pmdt082,s_detail1[1].pmdt083,s_detail1[1].pmdt005,s_detail1[1].pmdt006,s_detail1[1].pmdt007, 
               s_detail1[1].pmdt009,s_detail1[1].pmdt010,s_detail1[1].pmdt025,s_detail1[1].pmdt011,s_detail1[1].pmdt019, 
               s_detail1[1].pmdt020,s_detail1[1].pmdt021,s_detail1[1].pmdt022,s_detail1[1].pmdt008,s_detail1[1].pmdt023, 
               s_detail1[1].pmdt024,s_detail1[1].pmdt090,s_detail1[1].pmdt091,s_detail1[1].pmdt036,s_detail1[1].pmdt046, 
               s_detail1[1].pmdt037,s_detail1[1].pmdt038,s_detail1[1].pmdt039,s_detail1[1].pmdt047,s_detail1[1].pmdt092, 
               s_detail1[1].pmdt093,s_detail1[1].pmdt026,s_detail1[1].pmdt041,s_detail1[1].pmdt062,s_detail1[1].pmdt016, 
               s_detail1[1].pmdt017,s_detail1[1].pmdt018,s_detail1[1].pmdt063,s_detail1[1].pmdt072,s_detail1[1].pmdt073, 
               s_detail1[1].pmdt074,s_detail1[1].pmdt051,s_detail1[1].pmdt070,s_detail1[1].pmdt071,s_detail1[1].pmdt059, 
               s_detail1[1].pmdt053,s_detail1[1].pmdt054,s_detail1[1].pmdt055,s_detail1[1].pmdt060,s_detail1[1].pmdt061, 
               s_detail1[1].pmdt042,s_detail1[1].pmdt043,s_detail1[1].pmdt048,s_detail1[1].pmdt044,s_detail1[1].pmdt045, 
               s_detail1[1].pmdt084,s_detail1[1].pmdt089,s_detail1[1].pmdt088
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct
            {<point name="cs.body.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
                #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdtsite
            #add-point:BEFORE FIELD pmdtsite
            {<point name="construct.b.page1.pmdtsite" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdtsite
            
            #add-point:AFTER FIELD pmdtsite
            {<point name="construct.a.page1.pmdtsite" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdtsite
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdtsite
            #add-point:ON ACTION controlp INFIELD pmdtsite
            {<point name="construct.c.page1.pmdtsite" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdtseq
            #add-point:BEFORE FIELD pmdtseq
            {<point name="construct.b.page1.pmdtseq" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdtseq
            
            #add-point:AFTER FIELD pmdtseq
            {<point name="construct.a.page1.pmdtseq" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdtseq
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdtseq
            #add-point:ON ACTION controlp INFIELD pmdtseq
            {<point name="construct.c.page1.pmdtseq" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt027
            #add-point:BEFORE FIELD pmdt027
            {<point name="construct.b.page1.pmdt027" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt027
            
            #add-point:AFTER FIELD pmdt027
            {<point name="construct.a.page1.pmdt027" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt027
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt027
            #add-point:ON ACTION controlp INFIELD pmdt027
            {<point name="construct.c.page1.pmdt027" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt028
            #add-point:BEFORE FIELD pmdt028
            {<point name="construct.b.page1.pmdt028" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt028
            
            #add-point:AFTER FIELD pmdt028
            {<point name="construct.a.page1.pmdt028" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt028
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt028
            #add-point:ON ACTION controlp INFIELD pmdt028
            {<point name="construct.c.page1.pmdt028" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt001
            #add-point:ON ACTION controlp INFIELD pmdt001
            {<point name="construct.c.page1.pmdt001" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt001
            #add-point:BEFORE FIELD pmdt001
            {<point name="construct.b.page1.pmdt001" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt001
            
            #add-point:AFTER FIELD pmdt001
            {<point name="construct.a.page1.pmdt001" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt002
            #add-point:BEFORE FIELD pmdt002
            {<point name="construct.b.page1.pmdt002" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt002
            
            #add-point:AFTER FIELD pmdt002
            {<point name="construct.a.page1.pmdt002" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt002
            #add-point:ON ACTION controlp INFIELD pmdt002
            {<point name="construct.c.page1.pmdt002" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt003
            #add-point:BEFORE FIELD pmdt003
            {<point name="construct.b.page1.pmdt003" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt003
            
            #add-point:AFTER FIELD pmdt003
            {<point name="construct.a.page1.pmdt003" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt003
            #add-point:ON ACTION controlp INFIELD pmdt003
            {<point name="construct.c.page1.pmdt003" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt004
            #add-point:BEFORE FIELD pmdt004
            {<point name="construct.b.page1.pmdt004" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt004
            
            #add-point:AFTER FIELD pmdt004
            {<point name="construct.a.page1.pmdt004" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt004
            #add-point:ON ACTION controlp INFIELD pmdt004
            {<point name="construct.c.page1.pmdt004" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt081
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt081
            #add-point:ON ACTION controlp INFIELD pmdt081
            {<point name="construct.c.page1.pmdt081" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt081
            #add-point:BEFORE FIELD pmdt081
            {<point name="construct.b.page1.pmdt081" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt081
            
            #add-point:AFTER FIELD pmdt081
            {<point name="construct.a.page1.pmdt081" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt082
            #add-point:BEFORE FIELD pmdt082
            {<point name="construct.b.page1.pmdt082" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt082
            
            #add-point:AFTER FIELD pmdt082
            {<point name="construct.a.page1.pmdt082" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt082
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt082
            #add-point:ON ACTION controlp INFIELD pmdt082
            {<point name="construct.c.page1.pmdt082" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt083
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt083
            #add-point:ON ACTION controlp INFIELD pmdt083
            {<point name="construct.c.page1.pmdt083" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt083
            #add-point:BEFORE FIELD pmdt083
            {<point name="construct.b.page1.pmdt083" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt083
            
            #add-point:AFTER FIELD pmdt083
            {<point name="construct.a.page1.pmdt083" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt005
            #add-point:BEFORE FIELD pmdt005
            {<point name="construct.b.page1.pmdt005" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt005
            
            #add-point:AFTER FIELD pmdt005
            {<point name="construct.a.page1.pmdt005" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt005
            #add-point:ON ACTION controlp INFIELD pmdt005
            {<point name="construct.c.page1.pmdt005" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt006
            #add-point:ON ACTION controlp INFIELD pmdt006
            {<point name="construct.c.page1.pmdt006" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt006
            #add-point:BEFORE FIELD pmdt006
            {<point name="construct.b.page1.pmdt006" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt006
            
            #add-point:AFTER FIELD pmdt006
            {<point name="construct.a.page1.pmdt006" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt007
            #add-point:BEFORE FIELD pmdt007
            {<point name="construct.b.page1.pmdt007" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt007
            
            #add-point:AFTER FIELD pmdt007
            {<point name="construct.a.page1.pmdt007" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt007
            #add-point:ON ACTION controlp INFIELD pmdt007
            {<point name="construct.c.page1.pmdt007" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt009
            #add-point:ON ACTION controlp INFIELD pmdt009
            {<point name="construct.c.page1.pmdt009" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt009
            #add-point:BEFORE FIELD pmdt009
            {<point name="construct.b.page1.pmdt009" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt009
            
            #add-point:AFTER FIELD pmdt009
            {<point name="construct.a.page1.pmdt009" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt010
            #add-point:BEFORE FIELD pmdt010
            {<point name="construct.b.page1.pmdt010" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt010
            
            #add-point:AFTER FIELD pmdt010
            {<point name="construct.a.page1.pmdt010" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt010
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt010
            #add-point:ON ACTION controlp INFIELD pmdt010
            {<point name="construct.c.page1.pmdt010" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt025
            #add-point:BEFORE FIELD pmdt025
            {<point name="construct.b.page1.pmdt025" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt025
            
            #add-point:AFTER FIELD pmdt025
            {<point name="construct.a.page1.pmdt025" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt025
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt025
            #add-point:ON ACTION controlp INFIELD pmdt025
            {<point name="construct.c.page1.pmdt025" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt011
            #add-point:BEFORE FIELD pmdt011
            {<point name="construct.b.page1.pmdt011" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt011
            
            #add-point:AFTER FIELD pmdt011
            {<point name="construct.a.page1.pmdt011" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt011
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt011
            #add-point:ON ACTION controlp INFIELD pmdt011
            {<point name="construct.c.page1.pmdt011" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt019
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt019
            #add-point:ON ACTION controlp INFIELD pmdt019
            {<point name="construct.c.page1.pmdt019" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt019
            #add-point:BEFORE FIELD pmdt019
            {<point name="construct.b.page1.pmdt019" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt019
            
            #add-point:AFTER FIELD pmdt019
            {<point name="construct.a.page1.pmdt019" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt020
            #add-point:BEFORE FIELD pmdt020
            {<point name="construct.b.page1.pmdt020" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt020
            
            #add-point:AFTER FIELD pmdt020
            {<point name="construct.a.page1.pmdt020" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt020
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt020
            #add-point:ON ACTION controlp INFIELD pmdt020
            {<point name="construct.c.page1.pmdt020" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt021
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt021
            #add-point:ON ACTION controlp INFIELD pmdt021
            {<point name="construct.c.page1.pmdt021" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt021
            #add-point:BEFORE FIELD pmdt021
            {<point name="construct.b.page1.pmdt021" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt021
            
            #add-point:AFTER FIELD pmdt021
            {<point name="construct.a.page1.pmdt021" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt022
            #add-point:BEFORE FIELD pmdt022
            {<point name="construct.b.page1.pmdt022" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt022
            
            #add-point:AFTER FIELD pmdt022
            {<point name="construct.a.page1.pmdt022" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt022
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt022
            #add-point:ON ACTION controlp INFIELD pmdt022
            {<point name="construct.c.page1.pmdt022" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt008
            #add-point:ON ACTION controlp INFIELD pmdt008
            {<point name="construct.c.page1.pmdt008" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt008
            #add-point:BEFORE FIELD pmdt008
            {<point name="construct.b.page1.pmdt008" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt008
            
            #add-point:AFTER FIELD pmdt008
            {<point name="construct.a.page1.pmdt008" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt023
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt023
            #add-point:ON ACTION controlp INFIELD pmdt023
            {<point name="construct.c.page1.pmdt023" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt023
            #add-point:BEFORE FIELD pmdt023
            {<point name="construct.b.page1.pmdt023" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt023
            
            #add-point:AFTER FIELD pmdt023
            {<point name="construct.a.page1.pmdt023" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt024
            #add-point:BEFORE FIELD pmdt024
            {<point name="construct.b.page1.pmdt024" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt024
            
            #add-point:AFTER FIELD pmdt024
            {<point name="construct.a.page1.pmdt024" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt024
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt024
            #add-point:ON ACTION controlp INFIELD pmdt024
            {<point name="construct.c.page1.pmdt024" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt090
            #add-point:BEFORE FIELD pmdt090
            {<point name="construct.b.page1.pmdt090" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt090
            
            #add-point:AFTER FIELD pmdt090
            {<point name="construct.a.page1.pmdt090" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt090
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt090
            #add-point:ON ACTION controlp INFIELD pmdt090
            {<point name="construct.c.page1.pmdt090" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt091
            #add-point:BEFORE FIELD pmdt091
            {<point name="construct.b.page1.pmdt091" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt091
            
            #add-point:AFTER FIELD pmdt091
            {<point name="construct.a.page1.pmdt091" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt091
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt091
            #add-point:ON ACTION controlp INFIELD pmdt091
            {<point name="construct.c.page1.pmdt091" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt036
            #add-point:BEFORE FIELD pmdt036
            {<point name="construct.b.page1.pmdt036" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt036
            
            #add-point:AFTER FIELD pmdt036
            {<point name="construct.a.page1.pmdt036" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt036
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt036
            #add-point:ON ACTION controlp INFIELD pmdt036
            {<point name="construct.c.page1.pmdt036" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt046
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt046
            #add-point:ON ACTION controlp INFIELD pmdt046
            {<point name="construct.c.page1.pmdt046" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt046
            #add-point:BEFORE FIELD pmdt046
            {<point name="construct.b.page1.pmdt046" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt046
            
            #add-point:AFTER FIELD pmdt046
            {<point name="construct.a.page1.pmdt046" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt037
            #add-point:BEFORE FIELD pmdt037
            {<point name="construct.b.page1.pmdt037" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt037
            
            #add-point:AFTER FIELD pmdt037
            {<point name="construct.a.page1.pmdt037" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt037
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt037
            #add-point:ON ACTION controlp INFIELD pmdt037
            {<point name="construct.c.page1.pmdt037" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt038
            #add-point:BEFORE FIELD pmdt038
            {<point name="construct.b.page1.pmdt038" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt038
            
            #add-point:AFTER FIELD pmdt038
            {<point name="construct.a.page1.pmdt038" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt038
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt038
            #add-point:ON ACTION controlp INFIELD pmdt038
            {<point name="construct.c.page1.pmdt038" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt039
            #add-point:BEFORE FIELD pmdt039
            {<point name="construct.b.page1.pmdt039" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt039
            
            #add-point:AFTER FIELD pmdt039
            {<point name="construct.a.page1.pmdt039" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt039
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt039
            #add-point:ON ACTION controlp INFIELD pmdt039
            {<point name="construct.c.page1.pmdt039" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt047
            #add-point:BEFORE FIELD pmdt047
            {<point name="construct.b.page1.pmdt047" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt047
            
            #add-point:AFTER FIELD pmdt047
            {<point name="construct.a.page1.pmdt047" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt047
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt047
            #add-point:ON ACTION controlp INFIELD pmdt047
            {<point name="construct.c.page1.pmdt047" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt092
            #add-point:BEFORE FIELD pmdt092
            {<point name="construct.b.page1.pmdt092" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt092
            
            #add-point:AFTER FIELD pmdt092
            {<point name="construct.a.page1.pmdt092" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt092
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt092
            #add-point:ON ACTION controlp INFIELD pmdt092
            {<point name="construct.c.page1.pmdt092" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt093
            #add-point:BEFORE FIELD pmdt093
            {<point name="construct.b.page1.pmdt093" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt093
            
            #add-point:AFTER FIELD pmdt093
            {<point name="construct.a.page1.pmdt093" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt093
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt093
            #add-point:ON ACTION controlp INFIELD pmdt093
            {<point name="construct.c.page1.pmdt093" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt026
            #add-point:BEFORE FIELD pmdt026
            {<point name="construct.b.page1.pmdt026" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt026
            
            #add-point:AFTER FIELD pmdt026
            {<point name="construct.a.page1.pmdt026" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt026
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt026
            #add-point:ON ACTION controlp INFIELD pmdt026
            {<point name="construct.c.page1.pmdt026" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt041
            #add-point:BEFORE FIELD pmdt041
            {<point name="construct.b.page1.pmdt041" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt041
            
            #add-point:AFTER FIELD pmdt041
            {<point name="construct.a.page1.pmdt041" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt041
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt041
            #add-point:ON ACTION controlp INFIELD pmdt041
            {<point name="construct.c.page1.pmdt041" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt062
            #add-point:BEFORE FIELD pmdt062
            {<point name="construct.b.page1.pmdt062" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt062
            
            #add-point:AFTER FIELD pmdt062
            {<point name="construct.a.page1.pmdt062" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt062
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt062
            #add-point:ON ACTION controlp INFIELD pmdt062
            {<point name="construct.c.page1.pmdt062" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt016
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt016
            #add-point:ON ACTION controlp INFIELD pmdt016
            {<point name="construct.c.page1.pmdt016" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt016
            #add-point:BEFORE FIELD pmdt016
            {<point name="construct.b.page1.pmdt016" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt016
            
            #add-point:AFTER FIELD pmdt016
            {<point name="construct.a.page1.pmdt016" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt017
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt017
            #add-point:ON ACTION controlp INFIELD pmdt017
            {<point name="construct.c.page1.pmdt017" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt017
            #add-point:BEFORE FIELD pmdt017
            {<point name="construct.b.page1.pmdt017" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt017
            
            #add-point:AFTER FIELD pmdt017
            {<point name="construct.a.page1.pmdt017" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt018
            #add-point:BEFORE FIELD pmdt018
            {<point name="construct.b.page1.pmdt018" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt018
            
            #add-point:AFTER FIELD pmdt018
            {<point name="construct.a.page1.pmdt018" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt018
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt018
            #add-point:ON ACTION controlp INFIELD pmdt018
            {<point name="construct.c.page1.pmdt018" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt063
            #add-point:BEFORE FIELD pmdt063
            {<point name="construct.b.page1.pmdt063" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt063
            
            #add-point:AFTER FIELD pmdt063
            {<point name="construct.a.page1.pmdt063" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt063
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt063
            #add-point:ON ACTION controlp INFIELD pmdt063
            {<point name="construct.c.page1.pmdt063" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt072
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt072
            #add-point:ON ACTION controlp INFIELD pmdt072
            {<point name="construct.c.page1.pmdt072" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt072
            #add-point:BEFORE FIELD pmdt072
            {<point name="construct.b.page1.pmdt072" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt072
            
            #add-point:AFTER FIELD pmdt072
            {<point name="construct.a.page1.pmdt072" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt073
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt073
            #add-point:ON ACTION controlp INFIELD pmdt073
            {<point name="construct.c.page1.pmdt073" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt073
            #add-point:BEFORE FIELD pmdt073
            {<point name="construct.b.page1.pmdt073" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt073
            
            #add-point:AFTER FIELD pmdt073
            {<point name="construct.a.page1.pmdt073" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt074
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt074
            #add-point:ON ACTION controlp INFIELD pmdt074
            {<point name="construct.c.page1.pmdt074" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt074
            #add-point:BEFORE FIELD pmdt074
            {<point name="construct.b.page1.pmdt074" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt074
            
            #add-point:AFTER FIELD pmdt074
            {<point name="construct.a.page1.pmdt074" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt051
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt051
            #add-point:ON ACTION controlp INFIELD pmdt051
            {<point name="construct.c.page1.pmdt051" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt051
            #add-point:BEFORE FIELD pmdt051
            {<point name="construct.b.page1.pmdt051" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt051
            
            #add-point:AFTER FIELD pmdt051
            {<point name="construct.a.page1.pmdt051" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt070
            #add-point:BEFORE FIELD pmdt070
            {<point name="construct.b.page1.pmdt070" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt070
            
            #add-point:AFTER FIELD pmdt070
            {<point name="construct.a.page1.pmdt070" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt070
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt070
            #add-point:ON ACTION controlp INFIELD pmdt070
            {<point name="construct.c.page1.pmdt070" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.pmdt071
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt071
            #add-point:ON ACTION controlp INFIELD pmdt071
            {<point name="construct.c.page1.pmdt071" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt071
            #add-point:BEFORE FIELD pmdt071
            {<point name="construct.b.page1.pmdt071" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt071
            
            #add-point:AFTER FIELD pmdt071
            {<point name="construct.a.page1.pmdt071" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt059
            #add-point:BEFORE FIELD pmdt059
            {<point name="construct.b.page1.pmdt059" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt059
            
            #add-point:AFTER FIELD pmdt059
            {<point name="construct.a.page1.pmdt059" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt059
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt059
            #add-point:ON ACTION controlp INFIELD pmdt059
            {<point name="construct.c.page1.pmdt059" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt053
            #add-point:BEFORE FIELD pmdt053
            {<point name="construct.b.page1.pmdt053" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt053
            
            #add-point:AFTER FIELD pmdt053
            {<point name="construct.a.page1.pmdt053" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt053
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt053
            #add-point:ON ACTION controlp INFIELD pmdt053
            {<point name="construct.c.page1.pmdt053" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt054
            #add-point:BEFORE FIELD pmdt054
            {<point name="construct.b.page1.pmdt054" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt054
            
            #add-point:AFTER FIELD pmdt054
            {<point name="construct.a.page1.pmdt054" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt054
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt054
            #add-point:ON ACTION controlp INFIELD pmdt054
            {<point name="construct.c.page1.pmdt054" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt055
            #add-point:BEFORE FIELD pmdt055
            {<point name="construct.b.page1.pmdt055" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt055
            
            #add-point:AFTER FIELD pmdt055
            {<point name="construct.a.page1.pmdt055" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt055
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt055
            #add-point:ON ACTION controlp INFIELD pmdt055
            {<point name="construct.c.page1.pmdt055" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt060
            #add-point:BEFORE FIELD pmdt060
            {<point name="construct.b.page1.pmdt060" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt060
            
            #add-point:AFTER FIELD pmdt060
            {<point name="construct.a.page1.pmdt060" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt060
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt060
            #add-point:ON ACTION controlp INFIELD pmdt060
            {<point name="construct.c.page1.pmdt060" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt061
            #add-point:BEFORE FIELD pmdt061
            {<point name="construct.b.page1.pmdt061" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt061
            
            #add-point:AFTER FIELD pmdt061
            {<point name="construct.a.page1.pmdt061" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt061
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt061
            #add-point:ON ACTION controlp INFIELD pmdt061
            {<point name="construct.c.page1.pmdt061" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt042
            #add-point:BEFORE FIELD pmdt042
            {<point name="construct.b.page1.pmdt042" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt042
            
            #add-point:AFTER FIELD pmdt042
            {<point name="construct.a.page1.pmdt042" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt042
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt042
            #add-point:ON ACTION controlp INFIELD pmdt042
            {<point name="construct.c.page1.pmdt042" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt043
            #add-point:BEFORE FIELD pmdt043
            {<point name="construct.b.page1.pmdt043" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt043
            
            #add-point:AFTER FIELD pmdt043
            {<point name="construct.a.page1.pmdt043" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt043
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt043
            #add-point:ON ACTION controlp INFIELD pmdt043
            {<point name="construct.c.page1.pmdt043" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt048
            #add-point:BEFORE FIELD pmdt048
            {<point name="construct.b.page1.pmdt048" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt048
            
            #add-point:AFTER FIELD pmdt048
            {<point name="construct.a.page1.pmdt048" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt048
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt048
            #add-point:ON ACTION controlp INFIELD pmdt048
            {<point name="construct.c.page1.pmdt048" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt044
            #add-point:BEFORE FIELD pmdt044
            {<point name="construct.b.page1.pmdt044" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt044
            
            #add-point:AFTER FIELD pmdt044
            {<point name="construct.a.page1.pmdt044" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt044
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt044
            #add-point:ON ACTION controlp INFIELD pmdt044
            {<point name="construct.c.page1.pmdt044" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt045
            #add-point:BEFORE FIELD pmdt045
            {<point name="construct.b.page1.pmdt045" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt045
            
            #add-point:AFTER FIELD pmdt045
            {<point name="construct.a.page1.pmdt045" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt045
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt045
            #add-point:ON ACTION controlp INFIELD pmdt045
            {<point name="construct.c.page1.pmdt045" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt084
            #add-point:BEFORE FIELD pmdt084
            {<point name="construct.b.page1.pmdt084" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt084
            
            #add-point:AFTER FIELD pmdt084
            {<point name="construct.a.page1.pmdt084" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt084
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt084
            #add-point:ON ACTION controlp INFIELD pmdt084
            {<point name="construct.c.page1.pmdt084" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt089
            #add-point:BEFORE FIELD pmdt089
            {<point name="construct.b.page1.pmdt089" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt089
            
            #add-point:AFTER FIELD pmdt089
            {<point name="construct.a.page1.pmdt089" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt089
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt089
            #add-point:ON ACTION controlp INFIELD pmdt089
            {<point name="construct.c.page1.pmdt089" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt088
            #add-point:BEFORE FIELD pmdt088
            {<point name="construct.b.page1.pmdt088" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt088
            
            #add-point:AFTER FIELD pmdt088
            {<point name="construct.a.page1.pmdt088" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.pmdt088
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt088
            #add-point:ON ACTION controlp INFIELD pmdt088
            {<point name="construct.c.page1.pmdt088" />}
            #END add-point
 
   
       
      END CONSTRUCT
      
      CONSTRUCT g_wc2_table2 ON pmduseq,pmdu001,pmdu002,pmdu003,pmdu004,pmdu006,pmdu007,pmdu008,pmdu005, 
          pmdu009,pmdu010,pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,pmdu017,pmdu016
           FROM s_detail2[1].pmduseq,s_detail2[1].pmdu001,s_detail2[1].pmdu002,s_detail2[1].pmdu003, 
               s_detail2[1].pmdu004,s_detail2[1].pmdu006,s_detail2[1].pmdu007,s_detail2[1].pmdu008,s_detail2[1].pmdu005, 
               s_detail2[1].pmdu009,s_detail2[1].pmdu010,s_detail2[1].pmdu011,s_detail2[1].pmdu012,s_detail2[1].pmdu013, 
               s_detail2[1].pmdu014,s_detail2[1].pmdu015,s_detail2[1].pmdu017,s_detail2[1].pmdu016
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct
            {<point name="cs.body2.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 2)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmduseq
            #add-point:BEFORE FIELD pmduseq
            {<point name="construct.b.page2.pmduseq" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmduseq
            
            #add-point:AFTER FIELD pmduseq
            {<point name="construct.a.page2.pmduseq" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmduseq
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmduseq
            #add-point:ON ACTION controlp INFIELD pmduseq
            {<point name="construct.c.page2.pmduseq" />}
            #END add-point
 
         #Ctrlp:construct.c.page2.pmdu001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu001
            #add-point:ON ACTION controlp INFIELD pmdu001
            {<point name="construct.c.page2.pmdu001" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu001
            #add-point:BEFORE FIELD pmdu001
            {<point name="construct.b.page2.pmdu001" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu001
            
            #add-point:AFTER FIELD pmdu001
            {<point name="construct.a.page2.pmdu001" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu002
            #add-point:BEFORE FIELD pmdu002
            {<point name="construct.b.page2.pmdu002" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu002
            
            #add-point:AFTER FIELD pmdu002
            {<point name="construct.a.page2.pmdu002" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu002
            #add-point:ON ACTION controlp INFIELD pmdu002
            {<point name="construct.c.page2.pmdu002" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu003
            #add-point:BEFORE FIELD pmdu003
            {<point name="construct.b.page2.pmdu003" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu003
            
            #add-point:AFTER FIELD pmdu003
            {<point name="construct.a.page2.pmdu003" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu003
            #add-point:ON ACTION controlp INFIELD pmdu003
            {<point name="construct.c.page2.pmdu003" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu004
            #add-point:BEFORE FIELD pmdu004
            {<point name="construct.b.page2.pmdu004" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu004
            
            #add-point:AFTER FIELD pmdu004
            {<point name="construct.a.page2.pmdu004" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu004
            #add-point:ON ACTION controlp INFIELD pmdu004
            {<point name="construct.c.page2.pmdu004" />}
            #END add-point
 
         #Ctrlp:construct.c.page2.pmdu006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu006
            #add-point:ON ACTION controlp INFIELD pmdu006
            {<point name="construct.c.page2.pmdu006" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu006
            #add-point:BEFORE FIELD pmdu006
            {<point name="construct.b.page2.pmdu006" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu006
            
            #add-point:AFTER FIELD pmdu006
            {<point name="construct.a.page2.pmdu006" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu007
            #add-point:ON ACTION controlp INFIELD pmdu007
            {<point name="construct.c.page2.pmdu007" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu007
            #add-point:BEFORE FIELD pmdu007
            {<point name="construct.b.page2.pmdu007" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu007
            
            #add-point:AFTER FIELD pmdu007
            {<point name="construct.a.page2.pmdu007" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu008
            #add-point:BEFORE FIELD pmdu008
            {<point name="construct.b.page2.pmdu008" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu008
            
            #add-point:AFTER FIELD pmdu008
            {<point name="construct.a.page2.pmdu008" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu008
            #add-point:ON ACTION controlp INFIELD pmdu008
            {<point name="construct.c.page2.pmdu008" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu005
            #add-point:BEFORE FIELD pmdu005
            {<point name="construct.b.page2.pmdu005" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu005
            
            #add-point:AFTER FIELD pmdu005
            {<point name="construct.a.page2.pmdu005" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu005
            #add-point:ON ACTION controlp INFIELD pmdu005
            {<point name="construct.c.page2.pmdu005" />}
            #END add-point
 
         #Ctrlp:construct.c.page2.pmdu009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu009
            #add-point:ON ACTION controlp INFIELD pmdu009
            {<point name="construct.c.page2.pmdu009" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu009
            #add-point:BEFORE FIELD pmdu009
            {<point name="construct.b.page2.pmdu009" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu009
            
            #add-point:AFTER FIELD pmdu009
            {<point name="construct.a.page2.pmdu009" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu010
            #add-point:BEFORE FIELD pmdu010
            {<point name="construct.b.page2.pmdu010" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu010
            
            #add-point:AFTER FIELD pmdu010
            {<point name="construct.a.page2.pmdu010" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu010
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu010
            #add-point:ON ACTION controlp INFIELD pmdu010
            {<point name="construct.c.page2.pmdu010" />}
            #END add-point
 
         #Ctrlp:construct.c.page2.pmdu011
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu011
            #add-point:ON ACTION controlp INFIELD pmdu011
            {<point name="construct.c.page2.pmdu011" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu011
            #add-point:BEFORE FIELD pmdu011
            {<point name="construct.b.page2.pmdu011" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu011
            
            #add-point:AFTER FIELD pmdu011
            {<point name="construct.a.page2.pmdu011" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu012
            #add-point:BEFORE FIELD pmdu012
            {<point name="construct.b.page2.pmdu012" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu012
            
            #add-point:AFTER FIELD pmdu012
            {<point name="construct.a.page2.pmdu012" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu012
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu012
            #add-point:ON ACTION controlp INFIELD pmdu012
            {<point name="construct.c.page2.pmdu012" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu013
            #add-point:BEFORE FIELD pmdu013
            {<point name="construct.b.page2.pmdu013" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu013
            
            #add-point:AFTER FIELD pmdu013
            {<point name="construct.a.page2.pmdu013" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu013
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu013
            #add-point:ON ACTION controlp INFIELD pmdu013
            {<point name="construct.c.page2.pmdu013" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu014
            #add-point:BEFORE FIELD pmdu014
            {<point name="construct.b.page2.pmdu014" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu014
            
            #add-point:AFTER FIELD pmdu014
            {<point name="construct.a.page2.pmdu014" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu014
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu014
            #add-point:ON ACTION controlp INFIELD pmdu014
            {<point name="construct.c.page2.pmdu014" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu015
            #add-point:BEFORE FIELD pmdu015
            {<point name="construct.b.page2.pmdu015" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu015
            
            #add-point:AFTER FIELD pmdu015
            {<point name="construct.a.page2.pmdu015" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu015
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu015
            #add-point:ON ACTION controlp INFIELD pmdu015
            {<point name="construct.c.page2.pmdu015" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu017
            #add-point:BEFORE FIELD pmdu017
            {<point name="construct.b.page2.pmdu017" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu017
            
            #add-point:AFTER FIELD pmdu017
            {<point name="construct.a.page2.pmdu017" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu017
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu017
            #add-point:ON ACTION controlp INFIELD pmdu017
            {<point name="construct.c.page2.pmdu017" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdu016
            #add-point:BEFORE FIELD pmdu016
            {<point name="construct.b.page2.pmdu016" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdu016
            
            #add-point:AFTER FIELD pmdu016
            {<point name="construct.a.page2.pmdu016" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page2.pmdu016
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdu016
            #add-point:ON ACTION controlp INFIELD pmdu016
            {<point name="construct.c.page2.pmdu016" />}
            #END add-point
 
   
       
      END CONSTRUCT
 
      CONSTRUCT g_wc2_table3 ON pmdvseq,pmdvseq1,pmdv005,pmdv001,pmdv002,pmdv003,pmdv004,pmdv014,pmdv015, 
          pmdv016,pmdv017,pmdv018,pmdv019
           FROM s_detail3[1].pmdvseq,s_detail3[1].pmdvseq1,s_detail3[1].pmdv005,s_detail3[1].pmdv001, 
               s_detail3[1].pmdv002,s_detail3[1].pmdv003,s_detail3[1].pmdv004,s_detail3[1].pmdv014,s_detail3[1].pmdv015, 
               s_detail3[1].pmdv016,s_detail3[1].pmdv017,s_detail3[1].pmdv018,s_detail3[1].pmdv019
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct
            {<point name="cs.body3.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 3)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdvseq
            #add-point:BEFORE FIELD pmdvseq
            {<point name="construct.b.page3.pmdvseq" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdvseq
            
            #add-point:AFTER FIELD pmdvseq
            {<point name="construct.a.page3.pmdvseq" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdvseq
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdvseq
            #add-point:ON ACTION controlp INFIELD pmdvseq
            {<point name="construct.c.page3.pmdvseq" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdvseq1
            #add-point:BEFORE FIELD pmdvseq1
            {<point name="construct.b.page3.pmdvseq1" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdvseq1
            
            #add-point:AFTER FIELD pmdvseq1
            {<point name="construct.a.page3.pmdvseq1" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdvseq1
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdvseq1
            #add-point:ON ACTION controlp INFIELD pmdvseq1
            {<point name="construct.c.page3.pmdvseq1" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv005
            #add-point:BEFORE FIELD pmdv005
            {<point name="construct.b.page3.pmdv005" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv005
            
            #add-point:AFTER FIELD pmdv005
            {<point name="construct.a.page3.pmdv005" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv005
            #add-point:ON ACTION controlp INFIELD pmdv005
            {<point name="construct.c.page3.pmdv005" />}
            #END add-point
 
         #Ctrlp:construct.c.page3.pmdv001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv001
            #add-point:ON ACTION controlp INFIELD pmdv001
            {<point name="construct.c.page3.pmdv001" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv001
            #add-point:BEFORE FIELD pmdv001
            {<point name="construct.b.page3.pmdv001" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv001
            
            #add-point:AFTER FIELD pmdv001
            {<point name="construct.a.page3.pmdv001" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv002
            #add-point:BEFORE FIELD pmdv002
            {<point name="construct.b.page3.pmdv002" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv002
            
            #add-point:AFTER FIELD pmdv002
            {<point name="construct.a.page3.pmdv002" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv002
            #add-point:ON ACTION controlp INFIELD pmdv002
            {<point name="construct.c.page3.pmdv002" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv003
            #add-point:BEFORE FIELD pmdv003
            {<point name="construct.b.page3.pmdv003" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv003
            
            #add-point:AFTER FIELD pmdv003
            {<point name="construct.a.page3.pmdv003" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv003
            #add-point:ON ACTION controlp INFIELD pmdv003
            {<point name="construct.c.page3.pmdv003" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv004
            #add-point:BEFORE FIELD pmdv004
            {<point name="construct.b.page3.pmdv004" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv004
            
            #add-point:AFTER FIELD pmdv004
            {<point name="construct.a.page3.pmdv004" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv004
            #add-point:ON ACTION controlp INFIELD pmdv004
            {<point name="construct.c.page3.pmdv004" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv014
            #add-point:BEFORE FIELD pmdv014
            {<point name="construct.b.page3.pmdv014" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv014
            
            #add-point:AFTER FIELD pmdv014
            {<point name="construct.a.page3.pmdv014" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv014
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv014
            #add-point:ON ACTION controlp INFIELD pmdv014
            {<point name="construct.c.page3.pmdv014" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv015
            #add-point:BEFORE FIELD pmdv015
            {<point name="construct.b.page3.pmdv015" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv015
            
            #add-point:AFTER FIELD pmdv015
            {<point name="construct.a.page3.pmdv015" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv015
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv015
            #add-point:ON ACTION controlp INFIELD pmdv015
            {<point name="construct.c.page3.pmdv015" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv016
            #add-point:BEFORE FIELD pmdv016
            {<point name="construct.b.page3.pmdv016" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv016
            
            #add-point:AFTER FIELD pmdv016
            {<point name="construct.a.page3.pmdv016" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv016
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv016
            #add-point:ON ACTION controlp INFIELD pmdv016
            {<point name="construct.c.page3.pmdv016" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv017
            #add-point:BEFORE FIELD pmdv017
            {<point name="construct.b.page3.pmdv017" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv017
            
            #add-point:AFTER FIELD pmdv017
            {<point name="construct.a.page3.pmdv017" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv017
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv017
            #add-point:ON ACTION controlp INFIELD pmdv017
            {<point name="construct.c.page3.pmdv017" />}
            #END add-point
 
         #Ctrlp:construct.c.page3.pmdv018
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv018
            #add-point:ON ACTION controlp INFIELD pmdv018
            {<point name="construct.c.page3.pmdv018" />}
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv018
            #add-point:BEFORE FIELD pmdv018
            {<point name="construct.b.page3.pmdv018" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv018
            
            #add-point:AFTER FIELD pmdv018
            {<point name="construct.a.page3.pmdv018" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdv019
            #add-point:BEFORE FIELD pmdv019
            {<point name="construct.b.page3.pmdv019" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdv019
            
            #add-point:AFTER FIELD pmdv019
            {<point name="construct.a.page3.pmdv019" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page3.pmdv019
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdv019
            #add-point:ON ACTION controlp INFIELD pmdv019
            {<point name="construct.c.page3.pmdv019" />}
            #END add-point
 
   
       
      END CONSTRUCT
 
 
      
 
      
      #add-point:cs段add_cs(本段內只能出現新的CONSTRUCT指令)
      {<point name="cs.add_cs"/>}
      #end add-point
 
      BEFORE DIALOG
         CALL cl_qbe_init()
         #add-point:cs段b_dialog
         {<point name="cs.b_dialog"/>}
         #end add-point  
 
      #查詢方案列表
      ON ACTION qbe_select
         LET ls_wc = ""
         CALL cl_qbe_list("c") RETURNING ls_wc
         IF NOT cl_null(ls_wc) THEN
            CALL util.JSON.parse(ls_wc, la_wc)
            INITIALIZE g_wc, g_wc2, g_wc2_table1, g_wc2_extend TO NULL
            INITIALIZE g_wc2_table2 TO NULL
 
            INITIALIZE g_wc2_table3 TO NULL
 
 
            FOR li_idx = 1 TO la_wc.getLength()
               CASE
                  WHEN la_wc[li_idx].tableid = "pmds_t" 
                     LET g_wc = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "pmdt_t" 
                     LET g_wc2_table1 = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "pmdu_t" 
                     LET g_wc2_table2 = la_wc[li_idx].wc
 
                  WHEN la_wc[li_idx].tableid = "pmdv_t" 
                     LET g_wc2_table3 = la_wc[li_idx].wc
 
 
               END CASE
            END FOR
         END IF
    
      #條件儲存為方案
      ON ACTION qbe_save
         CALL cl_qbe_save()
 
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   END DIALOG
   
   #組合g_wc2
   LET g_wc2 = g_wc2_table1
   IF g_wc2_table2 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
   END IF
 
   IF g_wc2_table3 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
   END IF
 
 
 
 
   
   #add-point:cs段結束前
   {<point name="cs.after_construct"/>}
   #end add-point    
 
   IF INT_FLAG THEN
      RETURN
   END IF
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.default_search" ver="12" status="" src="s" readonly="">
    <![CDATA[#+ 外部參數搜尋
PRIVATE FUNCTION apmt520_default_search()
   DEFINE li_idx     LIKE type_t.num10
   DEFINE li_cnt     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE ls_where   STRING
   #add-point:default_search段define
   {<point name="default_search.define" edit="s"/>}
   #end add-point  
   #add-point:default_search段define(客製用)
   {<point name="default_search.define_customerization" edit="c"/>}
   #end add-point  
   
   #add-point:default_search段開始前
   {<point name="default_search.before"/>}
   #end add-point  
   
   LET g_pagestart = 1
   
   IF cl_null(g_order) THEN
      LET g_order = "ASC"
   END IF
   
   IF NOT cl_null(g_argv[01]) THEN
      LET ls_wc = ls_wc, " pmdsdocno = '", g_argv[01], "' AND "
   END IF
   
 
   
   #add-point:default_search段after sql
   {<point name="default_search.after_sql"/>}
   #end add-point  
   
   IF NOT cl_null(ls_wc) THEN
      LET g_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_default = TRUE
   ELSE
      #若無外部參數則預設為1=2
      LET g_default = FALSE
      
      #預設查詢條件
      CALL cl_qbe_get_default_qryplan() RETURNING ls_where
      IF NOT cl_null(ls_where) THEN
         CALL util.JSON.parse(ls_where, la_wc)
         INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
         INITIALIZE g_wc2_table2 TO NULL
 
         INITIALIZE g_wc2_table3 TO NULL
 
 
         FOR li_idx = 1 TO la_wc.getLength()
            CASE
               WHEN la_wc[li_idx].tableid = "pmds_t" 
                  LET g_wc = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "pmdt_t" 
                  LET g_wc2_table1 = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "pmdu_t" 
                  LET g_wc2_table2 = la_wc[li_idx].wc
 
               WHEN la_wc[li_idx].tableid = "pmdv_t" 
                  LET g_wc2_table3 = la_wc[li_idx].wc
 
 
               WHEN la_wc[li_idx].tableid = "EXTENDWC"
                  LET g_wc2_extend = la_wc[li_idx].wc
            END CASE
         END FOR
         IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
            OR NOT cl_null(g_wc2_table2)
 
            OR NOT cl_null(g_wc2_table3)
 
 
            OR NOT cl_null(g_wc2_extend)
            THEN
            #組合g_wc2
            IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
               LET g_wc2 = g_wc2_table1
            END IF
            IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
            END IF
 
            IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
            END IF
 
 
            IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
            END IF
         
            IF g_wc2.subString(1,5) = " AND " THEN
               LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
            END IF
         END IF
      END IF
    
      IF cl_null(g_wc) AND cl_null(g_wc2) THEN
         LET g_wc = " 1=2"
      END IF
   END IF
   
   #add-point:default_search段結束前
   {<point name="default_search.after"/>}
   #end add-point  
 
   IF g_wc.getIndexOf(" 1=2", 1) THEN
      LET g_default = TRUE
   END IF
 
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.delete" ver="53" status="" src="s" readonly="">
    <![CDATA[#+ 資料刪除
PRIVATE FUNCTION apmt520_delete()
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   #add-point:delete段define
   {<point name="delete.define" edit="s"/>}
   #end add-point     
   #add-point:delete段define(客製用)
   {<point name="delete.define_customerization" edit="c"/>}
   #end add-point     
   
   IF g_pmds_m.pmdsdocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
   
   
   
   CALL s_transaction_begin()
 
   OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN apmt520_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      CLOSE apmt520_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE apmt520_master_referesh USING g_pmds_m.pmdsdocno INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
       g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
       g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
       g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
       g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
       g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
       g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
       g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
       g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt,g_pmds_m.pmds002_desc, 
       g_pmds_m.pmds003_desc,g_pmds_m.pmds007_desc,g_pmds_m.pmds008_desc,g_pmds_m.pmds009_desc,g_pmds_m.pmds031_desc, 
       g_pmds_m.pmds032_desc,g_pmds_m.pmds037_desc,g_pmds_m.pmds039_desc,g_pmds_m.pmds040_desc,g_pmds_m.pmds012_desc, 
       g_pmds_m.pmds053_desc,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid_desc, 
       g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdspstid_desc 

   
   #檢查是否允許此動作
   IF NOT apmt520_action_chk() THEN
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_pmds_m_mask_o.* =  g_pmds_m.*
   CALL apmt520_pmds_t_mask()
   LET g_pmds_m_mask_n.* =  g_pmds_m.*
   
   CALL apmt520_show()
   
   #add-point:delete段before ask
   {<point name="delete.before_ask"/>}
   #end add-point 
 
   IF cl_ask_del_master() THEN              #確認一下
   
      #add-point:單頭刪除前
      {<point name="delete.head.b_delete" mark="Y"/>}
      #end add-point   
      
      #應用 a47 樣板自動產生(Version:2)
      #刪除相關文件
      CALL apmt520_set_pk_array()
      #add-point:相關文件刪除前
      {<point name="delete.befroe.related_document_remove"/>}
      #end add-point   
      CALL cl_doc_remove()  
 
 
  
  
      #資料備份
      LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
 
      DELETE FROM pmds_t
       WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
 
       
      #add-point:單頭刪除中
      {<point name="delete.head.m_delete"/>}
      #end add-point
       
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_pmds_m.pmdsdocno 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      #add-point:單頭刪除後
      {<point name="delete.head.a_delete"/>}
      #end add-point
  
      #add-point:單身刪除前
      {<point name="delete.body.b_delete" mark="Y"/>}
      #end add-point
      
      DELETE FROM pmdt_t
       WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
 
 
      #add-point:單身刪除中
      {<point name="delete.body.m_delete"/>}
      #end add-point
         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdt_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')
         RETURN
      END IF    
 
      #add-point:單身刪除後
      {<point name="delete.body.a_delete"/>}
      #end add-point
      
            
                                                               
      #add-point:單身刪除前
      {<point name="delete.body.b_delete2" mark="Y"/>}
      #end add-point
      DELETE FROM pmdu_t
       WHERE pmduent = g_enterprise AND
             pmdudocno = g_pmds_m.pmdsdocno
      #add-point:單身刪除中
      {<point name="delete.body.m_delete2"/>}
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdu_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')
         RETURN
      END IF      
 
      #add-point:單身刪除後
      {<point name="delete.body.a_delete2"/>}
      #end add-point
 
      #add-point:單身刪除前
      {<point name="delete.body.b_delete3" mark="Y"/>}
      #end add-point
      DELETE FROM pmdv_t
       WHERE pmdvent = g_enterprise AND
             pmdvdocno = g_pmds_m.pmdsdocno
      #add-point:單身刪除中
      {<point name="delete.body.m_delete3"/>}
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdv_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')
         RETURN
      END IF      
 
      #add-point:單身刪除後
      {<point name="delete.body.a_delete3"/>}
      #end add-point
 
 
 
 
      
      #修改歷程記錄(刪除)
      IF NOT cl_log_modified_record('','') THEN 
         CLOSE apmt520_cl
         CALL s_transaction_end('N','0')
         RETURN
      END IF
             
      CLEAR FORM
      CALL g_pmdt_d.clear() 
      CALL g_pmdt2_d.clear()       
      CALL g_pmdt3_d.clear()       
 
     
      CALL apmt520_ui_browser_refresh()  
      #CALL apmt520_ui_headershow()  
      #CALL apmt520_ui_detailshow()
      
      IF g_browser_cnt > 0 THEN 
         #CALL apmt520_browser_fill("")
         CALL apmt520_fetch('P')
         DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
         DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
      ELSE
         CLEAR FORM
      END IF
 
      #add-point:多語言刪除
      {<point name="delete.lang.before_delete"/>}
      #end add-point
      
      #單頭多語言刪除
      
      
      #單身多語言刪除
      
      
 
      
 
 
 
   
      #add-point:多語言刪除
      {<point name="delete.lang.delete"/>}
      #end add-point
   
   END IF
 
   CALL s_transaction_end('Y','0')
   CLOSE apmt520_cl
 
   #功能已完成,通報訊息中心
   CALL apmt520_msgcentre_notify('delete')
    
END FUNCTION
]]>
  </section>
  <section id="apmt520.delete_b" ver="15" status="" src="s" readonly="">
    <![CDATA[#+ 刪除單身後其他table連動
PRIVATE FUNCTION apmt520_delete_b(ps_table,ps_keys_bak,ps_page)
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:delete_b段define
   {<point name="delete_b.define" edit="s"/>}
   #end add-point     
   #add-point:delete_b段define(客製用)
   {<point name="delete_b.define_customerization" edit="c"/>}
   #end add-point     
 
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前
      {<point name="delete_b.b_delete" mark="Y"/>}
      #end add-point    
      DELETE FROM pmdt_t
       WHERE pmdtent = g_enterprise AND
         pmdtdocno = ps_keys_bak[1] AND pmdtseq = ps_keys_bak[2]
      #add-point:delete_b段刪除中
      {<point name="delete_b.m_delete"/>}
      #end add-point    
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_pmdt_d.deleteElement(li_idx) 
      END IF 
 
   END IF
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前
      {<point name="delete_b.b_delete2" mark="Y"/>}
      #end add-point    
      DELETE FROM pmdu_t
       WHERE pmduent = g_enterprise AND
             pmdudocno = ps_keys_bak[1] AND pmduseq = ps_keys_bak[2] AND pmduseq1 = ps_keys_bak[3]
      #add-point:delete_b段刪除中
      {<point name="delete_b.m_delete2"/>}
      #end add-point    
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdu_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'2'" THEN 
         CALL g_pmdt2_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後
      {<point name="delete_b.a_delete2"/>}
      #end add-point    
   END IF
 
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前
      {<point name="delete_b.b_delete3" mark="Y"/>}
      #end add-point    
      DELETE FROM pmdv_t
       WHERE pmdvent = g_enterprise AND
             pmdvdocno = ps_keys_bak[1] AND pmdvseq = ps_keys_bak[2] AND pmdvseq1 = ps_keys_bak[3]
      #add-point:delete_b段刪除中
      {<point name="delete_b.m_delete3"/>}
      #end add-point    
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdv_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'3'" THEN 
         CALL g_pmdt3_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後
      {<point name="delete_b.a_delete3"/>}
      #end add-point    
   END IF
 
 
   
 
   
   #add-point:delete_b段other
   {<point name="delete_b.other"/>}
   #end add-point  
   
   RETURN TRUE
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.description" ver="226" status="" src="s" readonly="">
    <![CDATA[#應用 a00 樣板自動產生(Version:1)
#+ Version..: T100-ERP-1.00.00(SD版次:12,PR版次:12) Build-000488
#+ 
#+ Filename...: apmt520
#+ Description: 採購收貨單維護作業
#+ Creator....: 02294(2014-02-24 13:56:12)
#+ Modifier...: 02294(2015-06-29 10:24:03) -SD/PR-
]]>
  </section>
  <section id="apmt520.detail_reproduce" ver="10" status="" src="s" readonly="">
    <![CDATA[#+ 單身自動複製
PRIVATE FUNCTION apmt520_detail_reproduce()
   DEFINE ls_sql      STRING
   DEFINE ld_date     DATETIME YEAR TO SECOND
   DEFINE l_detail    RECORD LIKE pmdt_t.*
   DEFINE l_detail2    RECORD LIKE pmdu_t.*
 
   DEFINE l_detail3    RECORD LIKE pmdv_t.*
 
 
 
   #add-point:delete段define
   {<point name="detail_reproduce.define" edit="s"/>}
   #end add-point    
   #add-point:delete段define(客製用)
   {<point name="detail_reproduce.define_customerization" edit="c"/>}
   #end add-point    
   
   CALL s_transaction_begin()
   
   LET ld_date = cl_get_current()
   
   DROP TABLE apmt520_detail
   
   #add-point:單身複製前1
   {<point name="detail_reproduce.body.table1.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE apmt520_detail AS ",
                "SELECT * FROM pmdt_t "
   PREPARE repro_tbl FROM ls_sql
   EXECUTE repro_tbl
   FREE repro_tbl
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO apmt520_detail SELECT * FROM pmdt_t 
                                         WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmdsdocno_t
 
   
   #將key修正為調整後   
   UPDATE apmt520_detail 
      #更新key欄位
      SET pmdtdocno = g_pmds_m.pmdsdocno
 
      #更新共用欄位
      
 
   #add-point:單身修改前
   {<point name="detail_reproduce.body.table1.b_update"/>}
   #end add-point                                       
  
   #將資料塞回原table   
   INSERT INTO pmdt_t SELECT * FROM apmt520_detail
   
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "reproduce" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #add-point:單身複製中1
   {<point name="detail_reproduce.body.table1.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE apmt520_detail
   
   #add-point:單身複製後1
   {<point name="detail_reproduce.body.table1.a_insert"/>}
   #end add-point
 
   #add-point:單身複製前
   {<point name="detail_reproduce.body.table2.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   LET ls_sql = 
      "CREATE GLOBAL TEMPORARY TABLE apmt520_detail AS ",
      "SELECT * FROM pmdu_t "
   PREPARE repro_tbl2 FROM ls_sql
   EXECUTE repro_tbl2
   FREE repro_tbl2
      
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO apmt520_detail SELECT * FROM pmdu_t
                                         WHERE pmduent = g_enterprise AND pmdudocno = g_pmdsdocno_t
 
 
   #將key修正為調整後   
   UPDATE apmt520_detail SET pmdudocno = g_pmds_m.pmdsdocno
 
  
   #將資料塞回原table   
   INSERT INTO pmdu_t SELECT * FROM apmt520_detail
   
   #add-point:單身複製中
   {<point name="detail_reproduce.body.table2.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE apmt520_detail
   
   #add-point:單身複製後
   {<point name="detail_reproduce.body.table2.a_insert"/>}
   #end add-point
 
   #add-point:單身複製前
   {<point name="detail_reproduce.body.table3.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   LET ls_sql = 
      "CREATE GLOBAL TEMPORARY TABLE apmt520_detail AS ",
      "SELECT * FROM pmdv_t "
   PREPARE repro_tbl3 FROM ls_sql
   EXECUTE repro_tbl3
   FREE repro_tbl3
      
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO apmt520_detail SELECT * FROM pmdv_t
                                         WHERE pmdvent = g_enterprise AND pmdvdocno = g_pmdsdocno_t
 
 
   #將key修正為調整後   
   UPDATE apmt520_detail SET pmdvdocno = g_pmds_m.pmdsdocno
 
  
   #將資料塞回原table   
   INSERT INTO pmdv_t SELECT * FROM apmt520_detail
   
   #add-point:單身複製中
   {<point name="detail_reproduce.body.table3.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE apmt520_detail
   
   #add-point:單身複製後
   {<point name="detail_reproduce.body.table3.a_insert"/>}
   #end add-point
 
 
   
 
   
   #多語言複製段落
   
   
   CALL s_transaction_end('Y','0')
   
   #已新增完, 調整資料內容(修改時使用)
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.detail_show" ver="6" status="" src="s" readonly="">
    <![CDATA[#+ 第二階單身reference
PRIVATE FUNCTION apmt520_detail_show()
   #add-point:detail_show段define
   {<point name="detail_show.define" edit="s"/>}
   #end add-point  
   #add-point:detail_show段define(客製用)
   {<point name="detail_show.define_customerization" edit="c"/>}
   #end add-point  
   
   #add-point:detail_show段之前
   {<point name="detail_show.before"/>}
   #end add-point
   
   #add-point:detail_show段之後
   {<point name="detail_show.after"/>}
   #end add-point
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.fetch" ver="42" status="" src="s" readonly="">
    <![CDATA[#+ 指定PK後抓取單頭其他資料
PRIVATE FUNCTION apmt520_fetch(p_flag)
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   #add-point:fetch段define
   {<point name="fetch.define" edit="s"/>}
   #end add-point    
   #add-point:fetch段define(客製用)
   {<point name="fetch.define_customerization" edit="c"/>}
   #end add-point    
   
   IF g_browser_cnt = 0 THEN
      RETURN
   END IF
 
   CALL cl_ap_performance_next_start()
   CASE p_flag
      WHEN 'F' 
         LET g_current_idx = 1
      WHEN 'L'  
         LET g_current_idx = g_browser.getLength()              
      WHEN 'P'
         IF g_current_idx > 1 THEN               
            LET g_current_idx = g_current_idx - 1
         END IF 
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF        
      WHEN '/'
         IF (NOT g_no_ask) THEN    
            CALL cl_set_act_visible("accept,cancel", TRUE)    
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0
 
            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl" 
            END PROMPT
 
            CALL cl_set_act_visible("accept,cancel", FALSE)    
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE  
            END IF           
         END IF
         
         IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
             LET g_current_idx = g_jump
         END IF
         LET g_no_ask = FALSE  
   END CASE 
 
   CALL g_curr_diag.setCurrentRow("s_browse", g_current_idx) #設定browse 索引
   
   LET g_current_row = g_current_idx
   LET g_detail_cnt = g_header_cnt                  
   
   #單身總筆數顯示
   IF g_detail_cnt > 0 THEN
      #若單身有資料時, idx至少為1
      IF g_detail_idx <= 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx  
   ELSE
      LET g_detail_idx = 0
      DISPLAY '' TO FORMONLY.idx    
   END IF
   
   #瀏覽頁筆數顯示
   LET g_browser_idx = g_pagestart+g_current_idx-1
   DISPLAY g_browser_idx TO FORMONLY.b_index   #當下筆數
   DISPLAY g_browser_idx TO FORMONLY.h_index   #當下筆數
   
   CALL cl_navigator_setting( g_current_idx, g_browser_cnt )
 
   #代表沒有資料
   IF g_current_idx = 0 OR g_browser.getLength() = 0 THEN
      RETURN
   END IF
   
   #超出範圍
   IF g_current_idx > g_browser.getLength() THEN
      LET g_current_idx = g_browser.getLength()
   END IF
   
   LET g_pmds_m.pmdsdocno = g_browser[g_current_idx].b_pmdsdocno
 
   
   #重讀DB,因TEMP有不被更新特性
   EXECUTE apmt520_master_referesh USING g_pmds_m.pmdsdocno INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
       g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
       g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
       g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
       g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
       g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
       g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
       g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
       g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt,g_pmds_m.pmds002_desc, 
       g_pmds_m.pmds003_desc,g_pmds_m.pmds007_desc,g_pmds_m.pmds008_desc,g_pmds_m.pmds009_desc,g_pmds_m.pmds031_desc, 
       g_pmds_m.pmds032_desc,g_pmds_m.pmds037_desc,g_pmds_m.pmds039_desc,g_pmds_m.pmds040_desc,g_pmds_m.pmds012_desc, 
       g_pmds_m.pmds053_desc,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid_desc, 
       g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdspstid_desc 

   
   #遮罩相關處理
   LET g_pmds_m_mask_o.* =  g_pmds_m.*
   CALL apmt520_pmds_t_mask()
   LET g_pmds_m_mask_n.* =  g_pmds_m.*
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL apmt520_set_act_visible()   
   CALL apmt520_set_act_no_visible()
   
   #add-point:fetch段action控制
   {<point name="fetch.action_control"/>}
   #end add-point  
   
   
   
   #add-point:fetch結束前
   {<point name="fetch.after" />}
   #end add-point
   
   #保存單頭舊值
   LET g_pmds_m_t.* = g_pmds_m.*
   LET g_pmds_m_o.* = g_pmds_m.*
   
   LET g_data_owner = g_pmds_m.pmdsownid      
   LET g_data_dept  = g_pmds_m.pmdsowndp
   
   #重新顯示   
   CALL apmt520_show()
 
   #應用 a56 樣板自動產生(Version:2)
   #檢查此單據是否需顯示BPM簽核狀況按鈕 
   IF cl_bpm_chk() THEN
      CALL cl_set_act_visible("bpm_status",TRUE)
   ELSE
      CALL cl_set_act_visible("bpm_status",FALSE)
   END IF
 
 
 
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.fill_chk" ver="8" status="" src="s" readonly="">
    <![CDATA[#+ 單身填充確認
PRIVATE FUNCTION apmt520_fill_chk(ps_idx)
   DEFINE ps_idx        LIKE type_t.chr10
   #add-point:fill_chk段define
   {<point name="fill_chk.define" edit="s"/>}
   #end add-point
   #add-point:fill_chk段define(客製用)
   {<point name="fill_chk.define_customerization" edit="c"/>}
   #end add-point
   
   #add-point:fill_chk段before_chk
   {<point name="fill_chk.before_chk"/>}
   #end add-point
   
   #此funtion功能暫時停用(2015/1/12)
   #無論傳入值為何皆回傳true(代表要填充該單身)
 
   #全部為1=1 or null時回傳true
   IF (cl_null(g_wc2_table1) OR g_wc2_table1.trim() = '1=1')  AND 
      (cl_null(g_wc2_table2) OR g_wc2_table2.trim() = '1=1')  AND 
      (cl_null(g_wc2_table3) OR g_wc2_table3.trim() = '1=1') THEN
      #add-point:fill_chk段other_chk
      {<point name="fill_chk.other_chk"/>}
      #end add-point
      RETURN TRUE
   END IF
   
   #add-point:fill_chk段after_chk
   {<point name="fill_chk.after_chk"/>}
   #end add-point
   
   RETURN TRUE
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.filter" ver="11" status="" src="s" readonly="">
    <![CDATA[#應用 a50 樣板自動產生(Version:5)
#+ filter過濾功能
PRIVATE FUNCTION apmt520_filter()
   #add-point:filter段define
   {<point name="filter.define" edit="s"/>}
   #end add-point   
   #add-point:filter段define
   {<point name="filter.define_customerization" edit="c"/>}
   #end add-point   
   
   #切換畫面
   IF NOT g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF   
 
   LET INT_FLAG = 0
 
   LET g_qryparam.state = 'c'
 
   LET g_wc_filter_t = g_wc_filter.trim()
   LET g_wc_t = g_wc
 
   LET g_wc = cl_replace_str(g_wc, g_wc_filter_t, '')
 
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
      #單頭
      CONSTRUCT g_wc_filter ON pmdsdocno,pmdsdocdt,pmds002,pmds003,pmds007,pmds008,pmds009
                          FROM s_browse[1].b_pmdsdocno,s_browse[1].b_pmdsdocdt,s_browse[1].b_pmds002, 
                              s_browse[1].b_pmds003,s_browse[1].b_pmds007,s_browse[1].b_pmds008,s_browse[1].b_pmds009 

 
         BEFORE CONSTRUCT
               DISPLAY apmt520_filter_parser('pmdsdocno') TO s_browse[1].b_pmdsdocno
            DISPLAY apmt520_filter_parser('pmdsdocdt') TO s_browse[1].b_pmdsdocdt
            DISPLAY apmt520_filter_parser('pmds002') TO s_browse[1].b_pmds002
            DISPLAY apmt520_filter_parser('pmds003') TO s_browse[1].b_pmds003
            DISPLAY apmt520_filter_parser('pmds007') TO s_browse[1].b_pmds007
            DISPLAY apmt520_filter_parser('pmds008') TO s_browse[1].b_pmds008
            DISPLAY apmt520_filter_parser('pmds009') TO s_browse[1].b_pmds009
      
         #add-point:filter段cs_ctrl
         {<point name="filter.cs_ctrl"/>}
         #end add-point
      
      END CONSTRUCT
 
      #add-point:filter段add_cs
      {<point name="filter.add_cs"/>}
      #end add-point
 
      BEFORE DIALOG
         #add-point:filter段b_dialog
         {<point name="filter.b_dialog"/>}
         #end add-point  
      
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   
   END DIALOG
 
   IF NOT INT_FLAG THEN
      LET g_wc_filter = "   AND   ", g_wc_filter, "   "
      LET g_wc = g_wc , g_wc_filter
   ELSE
      LET g_wc_filter = g_wc_filter_t
      LET g_wc = g_wc_t
   END IF
 
      CALL apmt520_filter_show('pmdsdocno')
   CALL apmt520_filter_show('pmdsdocdt')
   CALL apmt520_filter_show('pmds002')
   CALL apmt520_filter_show('pmds003')
   CALL apmt520_filter_show('pmds007')
   CALL apmt520_filter_show('pmds008')
   CALL apmt520_filter_show('pmds009')
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.filter_parser" ver="4" status="" src="s" readonly="">
    <![CDATA[#+ filter過濾功能
PRIVATE FUNCTION apmt520_filter_parser(ps_field)
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num10
   DEFINE li_tmp2    LIKE type_t.num10
   DEFINE ls_var     STRING
   #add-point:filter段define
   {<point name="filter_parser.define" edit="s"/>}
   #end add-point    
   #add-point:filter段define
   {<point name="filter_parser.define_customerization" edit="s"/>}
   #end add-point    
 
   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF
 
   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF
 
   RETURN ls_var
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.filter_show" ver="2" status="" src="s" readonly="">
    <![CDATA[#+ 顯示過濾條件
PRIVATE FUNCTION apmt520_filter_show(ps_field)
   DEFINE ps_field         STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING
 
   LET ls_name = "formonly.b_", ps_field
   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LEt ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF
 
   #顯示資料組合
   LET ls_condition = apmt520_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF
 
   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.global" ver="102" status="" src="s" readonly="">
    <![CDATA[#應用 t01 樣板自動產生(Version:39)
{<point name="global.memo" />}
        
IMPORT os
IMPORT util
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds 
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔
{<point name="global.inc" />}
#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_pmds_m        RECORD
       pmdssite LIKE pmds_t.pmdssite, 
   pmdsdocno LIKE pmds_t.pmdsdocno, 
   pmdsdocno_desc LIKE type_t.chr80, 
   pmdsdocdt LIKE pmds_t.pmdsdocdt, 
   pmds001 LIKE pmds_t.pmds001, 
   pmds002 LIKE pmds_t.pmds002, 
   pmds002_desc LIKE type_t.chr80, 
   pmds003 LIKE pmds_t.pmds003, 
   pmds003_desc LIKE type_t.chr80, 
   pmdsstus LIKE pmds_t.pmdsstus, 
   pmds006 LIKE pmds_t.pmds006, 
   pmds007 LIKE pmds_t.pmds007, 
   pmds007_desc LIKE type_t.chr80, 
   pmds008 LIKE pmds_t.pmds008, 
   pmds008_desc LIKE type_t.chr80, 
   pmds009 LIKE pmds_t.pmds009, 
   pmds009_desc LIKE type_t.chr80, 
   pmds010 LIKE pmds_t.pmds010, 
   pmds052 LIKE pmds_t.pmds052, 
   pmds000 LIKE pmds_t.pmds000, 
   pmds100 LIKE pmds_t.pmds100, 
   pmds011 LIKE pmds_t.pmds011, 
   pmds014 LIKE pmds_t.pmds014, 
   pmds081 LIKE pmds_t.pmds081, 
   pmds045 LIKE pmds_t.pmds045, 
   pmds021 LIKE pmds_t.pmds021, 
   pmds022 LIKE pmds_t.pmds022, 
   pmds023 LIKE pmds_t.pmds023, 
   pmds024 LIKE pmds_t.pmds024, 
   pmds031 LIKE pmds_t.pmds031, 
   pmds031_desc LIKE type_t.chr80, 
   pmds032 LIKE pmds_t.pmds032, 
   pmds032_desc LIKE type_t.chr80, 
   pmds033 LIKE pmds_t.pmds033, 
   pmds033_desc LIKE type_t.chr80, 
   pmds034 LIKE pmds_t.pmds034, 
   pmds035 LIKE pmds_t.pmds035, 
   pmds036 LIKE pmds_t.pmds036, 
   pmds037 LIKE pmds_t.pmds037, 
   pmds037_desc LIKE type_t.chr80, 
   pmds038 LIKE pmds_t.pmds038, 
   pmds039 LIKE pmds_t.pmds039, 
   pmds039_desc LIKE type_t.chr80, 
   pmds040 LIKE pmds_t.pmds040, 
   pmds040_desc LIKE type_t.chr80, 
   pmds012 LIKE pmds_t.pmds012, 
   pmds012_desc LIKE type_t.chr80, 
   pmds101 LIKE pmds_t.pmds101, 
   pmds102 LIKE pmds_t.pmds102, 
   pmds048 LIKE pmds_t.pmds048, 
   pmds047 LIKE pmds_t.pmds047, 
   pmds049 LIKE pmds_t.pmds049, 
   pmds053 LIKE pmds_t.pmds053, 
   pmds053_desc LIKE type_t.chr80, 
   pmds041 LIKE pmds_t.pmds041, 
   pmds042 LIKE pmds_t.pmds042, 
   pmds043 LIKE pmds_t.pmds043, 
   pmds044 LIKE pmds_t.pmds044, 
   pmds046 LIKE pmds_t.pmds046, 
   pmds054 LIKE pmds_t.pmds054, 
   pmds055 LIKE pmds_t.pmds055, 
   pmds050 LIKE pmds_t.pmds050, 
   pmdsownid LIKE pmds_t.pmdsownid, 
   pmdsownid_desc LIKE type_t.chr80, 
   pmdsowndp LIKE pmds_t.pmdsowndp, 
   pmdsowndp_desc LIKE type_t.chr80, 
   pmdscrtid LIKE pmds_t.pmdscrtid, 
   pmdscrtid_desc LIKE type_t.chr80, 
   pmdscrtdp LIKE pmds_t.pmdscrtdp, 
   pmdscrtdp_desc LIKE type_t.chr80, 
   pmdscrtdt LIKE pmds_t.pmdscrtdt, 
   pmdsmodid LIKE pmds_t.pmdsmodid, 
   pmdsmodid_desc LIKE type_t.chr80, 
   pmdsmoddt LIKE pmds_t.pmdsmoddt, 
   pmdscnfid LIKE pmds_t.pmdscnfid, 
   pmdscnfid_desc LIKE type_t.chr80, 
   pmdscnfdt LIKE pmds_t.pmdscnfdt, 
   pmdspstid LIKE pmds_t.pmdspstid, 
   pmdspstid_desc LIKE type_t.chr80, 
   pmdspstdt LIKE pmds_t.pmdspstdt
       END RECORD
 
#單身 type 宣告
PRIVATE TYPE type_g_pmdt_d        RECORD
       pmdtsite LIKE pmdt_t.pmdtsite, 
   pmdtseq LIKE pmdt_t.pmdtseq, 
   pmdt027 LIKE pmdt_t.pmdt027, 
   pmdt028 LIKE pmdt_t.pmdt028, 
   pmdt001 LIKE pmdt_t.pmdt001, 
   pmdt002 LIKE pmdt_t.pmdt002, 
   pmdt003 LIKE pmdt_t.pmdt003, 
   pmdt004 LIKE pmdt_t.pmdt004, 
   pmdt081 LIKE pmdt_t.pmdt081, 
   pmdt082 LIKE pmdt_t.pmdt082, 
   pmdt083 LIKE pmdt_t.pmdt083, 
   pmdt083_desc LIKE type_t.chr500, 
   pmdt005 LIKE pmdt_t.pmdt005, 
   pmdo001 LIKE type_t.chr500, 
   imaal003 LIKE type_t.chr500, 
   imaal004 LIKE type_t.chr500, 
   pmdo002 LIKE type_t.chr500, 
   pmdo002_desc LIKE type_t.chr500, 
   pmdt006 LIKE pmdt_t.pmdt006, 
   pmdt006_desc LIKE type_t.chr500, 
   pmdt006_desc2 LIKE type_t.chr500, 
   pmdt007 LIKE pmdt_t.pmdt007, 
   pmdt007_desc LIKE type_t.chr500, 
   pmdt009 LIKE pmdt_t.pmdt009, 
   pmdt009_desc LIKE type_t.chr500, 
   pmdt010 LIKE pmdt_t.pmdt010, 
   pmdt025 LIKE pmdt_t.pmdt025, 
   pmdt011 LIKE pmdt_t.pmdt011, 
   pmdt019 LIKE pmdt_t.pmdt019, 
   pmdt019_desc LIKE type_t.chr500, 
   pmdt020 LIKE pmdt_t.pmdt020, 
   pmdt021 LIKE pmdt_t.pmdt021, 
   pmdt021_desc LIKE type_t.chr500, 
   pmdt022 LIKE pmdt_t.pmdt022, 
   pmdt008 LIKE pmdt_t.pmdt008, 
   pmdt008_desc LIKE type_t.chr500, 
   pmdt023 LIKE pmdt_t.pmdt023, 
   pmdt023_desc LIKE type_t.chr500, 
   pmdt024 LIKE pmdt_t.pmdt024, 
   pmdt090 LIKE pmdt_t.pmdt090, 
   pmdt091 LIKE pmdt_t.pmdt091, 
   pmdt036 LIKE pmdt_t.pmdt036, 
   pmdt046 LIKE pmdt_t.pmdt046, 
   pmdt046_desc LIKE type_t.chr500, 
   pmdt037 LIKE pmdt_t.pmdt037, 
   pmdt038 LIKE pmdt_t.pmdt038, 
   pmdt039 LIKE pmdt_t.pmdt039, 
   pmdt047 LIKE pmdt_t.pmdt047, 
   pmdt092 LIKE pmdt_t.pmdt092, 
   pmdt093 LIKE pmdt_t.pmdt093, 
   pmdt026 LIKE pmdt_t.pmdt026, 
   pmdt041 LIKE pmdt_t.pmdt041, 
   pmdt062 LIKE pmdt_t.pmdt062, 
   pmdt016 LIKE pmdt_t.pmdt016, 
   pmdt016_desc LIKE type_t.chr500, 
   pmdt017 LIKE pmdt_t.pmdt017, 
   pmdt017_desc LIKE type_t.chr500, 
   pmdt018 LIKE pmdt_t.pmdt018, 
   pmdt063 LIKE pmdt_t.pmdt063, 
   pmdt072 LIKE pmdt_t.pmdt072, 
   pmdt072_desc LIKE type_t.chr500, 
   pmdt073 LIKE pmdt_t.pmdt073, 
   pmdt073_desc LIKE type_t.chr500, 
   pmdt074 LIKE pmdt_t.pmdt074, 
   pmdt074_desc LIKE type_t.chr500, 
   pmdt040 LIKE pmdt_t.pmdt040, 
   pmdt052 LIKE pmdt_t.pmdt052, 
   pmdt051 LIKE pmdt_t.pmdt051, 
   pmdt051_desc LIKE type_t.chr500, 
   pmdt070 LIKE pmdt_t.pmdt070, 
   pmdt071 LIKE pmdt_t.pmdt071, 
   pmdt059 LIKE pmdt_t.pmdt059, 
   pmdt053 LIKE pmdt_t.pmdt053, 
   pmdt054 LIKE pmdt_t.pmdt054, 
   pmdt055 LIKE pmdt_t.pmdt055, 
   pmdt060 LIKE pmdt_t.pmdt060, 
   pmdt061 LIKE pmdt_t.pmdt061, 
   pmdt042 LIKE pmdt_t.pmdt042, 
   pmdt043 LIKE pmdt_t.pmdt043, 
   pmdt048 LIKE pmdt_t.pmdt048, 
   pmdt044 LIKE pmdt_t.pmdt044, 
   pmdt045 LIKE pmdt_t.pmdt045, 
   pmdt084 LIKE pmdt_t.pmdt084, 
   pmdt089 LIKE pmdt_t.pmdt089, 
   pmdt088 LIKE pmdt_t.pmdt088
       END RECORD
PRIVATE TYPE type_g_pmdt2_d RECORD
       pmdusite LIKE pmdu_t.pmdusite, 
   pmduseq LIKE pmdu_t.pmduseq, 
   pmduseq1 LIKE pmdu_t.pmduseq1, 
   pmdu001 LIKE pmdu_t.pmdu001, 
   pmdu001_desc LIKE type_t.chr500, 
   imaal004 LIKE imaal_t.imaal004, 
   pmdu002 LIKE pmdu_t.pmdu002, 
   pmdu002_desc LIKE type_t.chr500, 
   pmdu003 LIKE pmdu_t.pmdu003, 
   pmdu004 LIKE pmdu_t.pmdu004, 
   pmdu006 LIKE pmdu_t.pmdu006, 
   pmdu006_desc LIKE type_t.chr500, 
   pmdu007 LIKE pmdu_t.pmdu007, 
   pmdu007_desc LIKE type_t.chr500, 
   pmdu008 LIKE pmdu_t.pmdu008, 
   pmdu005 LIKE pmdu_t.pmdu005, 
   pmdu009 LIKE pmdu_t.pmdu009, 
   pmdu009_desc LIKE type_t.chr500, 
   pmdu010 LIKE pmdu_t.pmdu010, 
   pmdu011 LIKE pmdu_t.pmdu011, 
   pmdu011_desc LIKE type_t.chr500, 
   pmdu012 LIKE pmdu_t.pmdu012, 
   pmdu013 LIKE pmdu_t.pmdu013, 
   pmdu014 LIKE pmdu_t.pmdu014, 
   pmdu015 LIKE pmdu_t.pmdu015, 
   pmdu017 LIKE pmdu_t.pmdu017, 
   pmdu016 LIKE pmdu_t.pmdu016
       END RECORD
PRIVATE TYPE type_g_pmdt3_d RECORD
       pmdvsite LIKE pmdv_t.pmdvsite, 
   pmdvseq LIKE pmdv_t.pmdvseq, 
   pmdvseq1 LIKE pmdv_t.pmdvseq1, 
   pmdv005 LIKE pmdv_t.pmdv005, 
   pmdv001 LIKE pmdv_t.pmdv001, 
   pmdv001_desc LIKE type_t.chr500, 
   imaal004 LIKE imaal_t.imaal004, 
   pmdv002 LIKE pmdv_t.pmdv002, 
   pmdv002_desc LIKE type_t.chr500, 
   pmdv003 LIKE pmdv_t.pmdv003, 
   pmdv004 LIKE pmdv_t.pmdv004, 
   pmdv014 LIKE pmdv_t.pmdv014, 
   pmdv015 LIKE pmdv_t.pmdv015, 
   pmdv016 LIKE pmdv_t.pmdv016, 
   pmdv017 LIKE pmdv_t.pmdv017, 
   pmdv018 LIKE pmdv_t.pmdv018, 
   pmdv018_desc LIKE type_t.chr500, 
   pmdv019 LIKE pmdv_t.pmdv019
       END RECORD
 
 
PRIVATE TYPE type_browser RECORD
         b_statepic     LIKE type_t.chr50,
            b_pmdsdocno LIKE pmds_t.pmdsdocno,
      b_pmdsdocdt LIKE pmds_t.pmdsdocdt,
      b_pmds002 LIKE pmds_t.pmds002,
   b_pmds002_desc LIKE type_t.chr80,
      b_pmds003 LIKE pmds_t.pmds003,
   b_pmds003_desc LIKE type_t.chr80,
      b_pmds007 LIKE pmds_t.pmds007,
      b_pmds008 LIKE pmds_t.pmds008,
      b_pmds009 LIKE pmds_t.pmds009
       END RECORD
       
#模組變數(Module Variables)
DEFINE g_pmds_m          type_g_pmds_m
DEFINE g_pmds_m_t        type_g_pmds_m
DEFINE g_pmds_m_o        type_g_pmds_m
DEFINE g_pmds_m_mask_o   type_g_pmds_m #轉換遮罩前資料
DEFINE g_pmds_m_mask_n   type_g_pmds_m #轉換遮罩後資料
 
   DEFINE g_pmdsdocno_t LIKE pmds_t.pmdsdocno
 
 
DEFINE g_pmdt_d          DYNAMIC ARRAY OF type_g_pmdt_d
DEFINE g_pmdt_d_t        type_g_pmdt_d
DEFINE g_pmdt_d_o        type_g_pmdt_d
DEFINE g_pmdt_d_mask_o   DYNAMIC ARRAY OF type_g_pmdt_d #轉換遮罩前資料
DEFINE g_pmdt_d_mask_n   DYNAMIC ARRAY OF type_g_pmdt_d #轉換遮罩後資料
DEFINE g_pmdt2_d          DYNAMIC ARRAY OF type_g_pmdt2_d
DEFINE g_pmdt2_d_t        type_g_pmdt2_d
DEFINE g_pmdt2_d_o        type_g_pmdt2_d
DEFINE g_pmdt2_d_mask_o   DYNAMIC ARRAY OF type_g_pmdt2_d #轉換遮罩前資料
DEFINE g_pmdt2_d_mask_n   DYNAMIC ARRAY OF type_g_pmdt2_d #轉換遮罩後資料
DEFINE g_pmdt3_d          DYNAMIC ARRAY OF type_g_pmdt3_d
DEFINE g_pmdt3_d_t        type_g_pmdt3_d
DEFINE g_pmdt3_d_o        type_g_pmdt3_d
DEFINE g_pmdt3_d_mask_o   DYNAMIC ARRAY OF type_g_pmdt3_d #轉換遮罩前資料
DEFINE g_pmdt3_d_mask_n   DYNAMIC ARRAY OF type_g_pmdt3_d #轉換遮罩後資料
 
 
DEFINE g_browser         DYNAMIC ARRAY OF type_browser
DEFINE g_browser_f       DYNAMIC ARRAY OF type_browser
 
 
DEFINE g_wc                  STRING
DEFINE g_wc_t                STRING
DEFINE g_wc2                 STRING                          #單身CONSTRUCT結果
DEFINE g_wc2_table1          STRING
DEFINE g_wc2_table2   STRING
 
DEFINE g_wc2_table3   STRING
 
 
 
DEFINE g_wc2_extend          STRING
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING
 
DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10     
DEFINE g_jump                LIKE type_t.num10        
DEFINE g_no_ask              LIKE type_t.num5        
DEFINE g_rec_b               LIKE type_t.num10           
DEFINE l_ac                  LIKE type_t.num10    
DEFINE g_curr_diag           ui.Dialog                     #Current Dialog
    
DEFINE g_pagestart           LIKE type_t.num10           
DEFINE gwin_curr             ui.Window                     #Current Window
DEFINE gfrm_curr             ui.Form                       #Current Form
DEFINE g_page_action         STRING                        #page action
DEFINE g_header_hidden       LIKE type_t.num5              #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5              #隱藏工作Panel
DEFINE g_page                STRING                        #第幾頁
DEFINE g_state               STRING       
DEFINE g_header_cnt          LIKE type_t.num10
DEFINE g_detail_cnt          LIKE type_t.num10              #單身總筆數
DEFINE g_detail_idx          LIKE type_t.num10              #單身目前所在筆數
DEFINE g_detail_idx2         LIKE type_t.num10              #單身2目前所在筆數
DEFINE g_browser_cnt         LIKE type_t.num10              #Browser總筆數
DEFINE g_browser_idx         LIKE type_t.num10              #Browser目前所在筆數
DEFINE g_temp_idx            LIKE type_t.num10              #Browser目前所在筆數(暫存用)
DEFINE g_order               STRING                        #查詢排序欄位
                                                        
DEFINE g_current_row         LIKE type_t.num10              #Browser所在筆數
DEFINE g_current_sw          BOOLEAN                       #Browser所在筆數用開關
DEFINE g_current_page        LIKE type_t.num10              #目前所在頁數
DEFINE g_insert              LIKE type_t.chr5              #是否導到其他page
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys               DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak           DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_bfill               LIKE type_t.chr5              #是否刷新單身
DEFINE g_error_show          LIKE type_t.num5              #是否顯示筆數提示訊息
DEFINE g_master_insert       BOOLEAN                       #確認單頭資料是否寫入
 
DEFINE g_wc_frozen           STRING                        #凍結欄位使用
DEFINE g_chk                 BOOLEAN                       #助記碼判斷用
DEFINE g_aw                  STRING                        #確定當下點擊的單身
DEFINE g_default             BOOLEAN                       #是否有外部參數查詢
DEFINE g_log1                STRING                        #log用
DEFINE g_log2                STRING                        #log用
DEFINE g_loc                 LIKE type_t.chr5              #判斷游標所在位置
DEFINE g_add_browse          STRING                        #新增填充用WC
DEFINE g_update              BOOLEAN                       #確定單頭/身是否異動過
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable" edit="s"/>}
#end add-point
 
#add-point:自定義客戶專用模組變數(Module Variable)
{<point name="global.variable_customerization" edit="c"/>}
#end add-point
 
#add-point:傳入參數說明(global.argv)
{<point name="global.argv"/>}
#end add-point
]]>
  </section>
  <section id="apmt520.idx_chk" ver="5" status="" src="s" readonly="">
    <![CDATA[#+ 顯示正確的單身資料筆數
PRIVATE FUNCTION apmt520_idx_chk()
   #add-point:idx_chk段define
   {<point name="idx_chk.define" edit="s"/>}
   #end add-point  
   #add-point:idx_chk段define(客製用)
   {<point name="idx_chk.define_customerization" edit="c"/>}
   #end add-point  
   
   IF g_current_page = 1 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail1")
      IF g_detail_idx > g_pmdt_d.getLength() THEN
         LET g_detail_idx = g_pmdt_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_pmdt_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_pmdt_d.getLength() TO FORMONLY.cnt
   END IF
   
   IF g_current_page = 2 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail2")
      IF g_detail_idx > g_pmdt2_d.getLength() THEN
         LET g_detail_idx = g_pmdt2_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_pmdt2_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_pmdt2_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 3 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail3")
      IF g_detail_idx > g_pmdt3_d.getLength() THEN
         LET g_detail_idx = g_pmdt3_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_pmdt3_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_pmdt3_d.getLength() TO FORMONLY.cnt
   END IF
 
   
   #add-point:idx_chk段other
   {<point name="idx_chk.other"/>}
   #end add-point  
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.init" ver="18" status="" src="s" readonly="">
    <![CDATA[#+ 瀏覽頁簽資料初始化
PRIVATE FUNCTION apmt520_init()
   #add-point:init段define
   {<point name="init.define" edit="s"/>}
   #end add-point    
   #add-point:init段define(客製用)
   {<point name="init.define_customerization" edit="c"/>}
   #end add-point    
 
   LET g_bfill       = "Y"
   LET g_detail_idx  = 1 #第一層單身指標
   LET g_detail_idx2 = 1 #第二層單身指標
   LET g_error_show  = 1
   LET l_ac = 1 #單身指標
      CALL cl_set_combo_scc_part('pmdsstus','13','N,Y,S,A,D,R,W,X')
 
      CALL cl_set_combo_scc('pmds000','2060') 
   CALL cl_set_combo_scc('pmds100','2062') 
   CALL cl_set_combo_scc('pmds011','2061') 
   CALL cl_set_combo_scc('pmds014','2053') 
   CALL cl_set_combo_scc('pmds036','2026') 
   CALL cl_set_combo_scc('pmds048','2087') 
   CALL cl_set_combo_scc('pmds049','2086') 
   CALL cl_set_combo_scc('pmds054','3086') 
   CALL cl_set_combo_scc('pmdt083','5073') 
   CALL cl_set_combo_scc('pmdt005','2055') 
   CALL cl_set_combo_scc('pmdt025','2036') 
   CALL cl_set_combo_scc('pmdt040','2039') 
   CALL cl_set_combo_scc('pmdt052','2035') 
   CALL cl_set_combo_scc('pmdv005','2055') 
 
   LET gwin_curr = ui.Window.getCurrent()  #取得現行畫面
   LET gfrm_curr = gwin_curr.getForm()     #取出物件化後的畫面物件
 
   #add-point:畫面資料初始化
   {<point name="init.init"/>}
   #end add-point
   
   #初始化搜尋條件
   CALL apmt520_default_search()
    
END FUNCTION
]]>
  </section>
  <section id="apmt520.input" ver="46" status="" src="s" readonly="">
    <![CDATA[#+ 資料輸入
PRIVATE FUNCTION apmt520_input(p_cmd)
   DEFINE  p_cmd                 LIKE type_t.chr1
   DEFINE  l_cmd_t               LIKE type_t.chr1
   DEFINE  l_cmd                 LIKE type_t.chr1
   DEFINE  l_n                   LIKE type_t.num10                #檢查重複用  
   DEFINE  l_cnt                 LIKE type_t.num10                #檢查重複用  
   DEFINE  l_lock_sw             LIKE type_t.chr1                #單身鎖住否  
   DEFINE  l_allow_insert        LIKE type_t.num5                #可新增否 
   DEFINE  l_allow_delete        LIKE type_t.num5                #可刪除否  
   DEFINE  l_count               LIKE type_t.num10
   DEFINE  l_i                   LIKE type_t.num10
   DEFINE  l_insert              BOOLEAN
   DEFINE  ls_return             STRING
   DEFINE  l_var_keys            DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys          DYNAMIC ARRAY OF STRING
   DEFINE  l_vars                DYNAMIC ARRAY OF STRING
   DEFINE  l_fields              DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak        DYNAMIC ARRAY OF STRING
   DEFINE  lb_reproduce          BOOLEAN
   DEFINE  li_reproduce          LIKE type_t.num10
   DEFINE  li_reproduce_target   LIKE type_t.num10
   DEFINE  ls_keys               DYNAMIC ARRAY OF VARCHAR(500)
   #add-point:input段define
   {<point name="input.define" edit="s"/>}
   #end add-point  
   #add-point:input段define(客製用)
   {<point name="input.define_customerization" edit="c"/>}
   #end add-point  
   
   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r'
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF   
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocno_desc,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001, 
       g_pmds_m.pmds002,g_pmds_m.pmds002_desc,g_pmds_m.pmds003,g_pmds_m.pmds003_desc,g_pmds_m.pmdsstus, 
       g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds007_desc,g_pmds_m.pmds008,g_pmds_m.pmds008_desc, 
       g_pmds_m.pmds009,g_pmds_m.pmds009_desc,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000,g_pmds_m.pmds100, 
       g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022, 
       g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds031_desc,g_pmds_m.pmds032,g_pmds_m.pmds032_desc, 
       g_pmds_m.pmds033,g_pmds_m.pmds033_desc,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037, 
       g_pmds_m.pmds037_desc,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds039_desc,g_pmds_m.pmds040, 
       g_pmds_m.pmds040_desc,g_pmds_m.pmds012,g_pmds_m.pmds012_desc,g_pmds_m.pmds101,g_pmds_m.pmds102, 
       g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds053_desc,g_pmds_m.pmds041, 
       g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055, 
       g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp,g_pmds_m.pmdsowndp_desc, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtid_desc,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdscrtdt, 
       g_pmds_m.pmdsmodid,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfid_desc, 
       g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstid_desc,g_pmds_m.pmdspstdt
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
 
   CALL cl_set_head_visible("","YES")  
 
   LET l_insert = FALSE
   LET g_action_choice = ""
 
   #add-point:input段define_sql
   {<point name="input.define_sql" mark="Y"/>}
   #end add-point 
   LET g_forupd_sql = "SELECT pmdtsite,pmdtseq,pmdt027,pmdt028,pmdt001,pmdt002,pmdt003,pmdt004,pmdt081, 
       pmdt082,pmdt083,pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021, 
       pmdt022,pmdt008,pmdt023,pmdt024,pmdt090,pmdt091,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047, 
       pmdt092,pmdt093,pmdt026,pmdt041,pmdt062,pmdt016,pmdt017,pmdt018,pmdt063,pmdt072,pmdt073,pmdt074, 
       pmdt040,pmdt052,pmdt051,pmdt070,pmdt071,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061,pmdt042, 
       pmdt043,pmdt048,pmdt044,pmdt045,pmdt084,pmdt089,pmdt088 FROM pmdt_t WHERE pmdtent=? AND pmdtdocno=?  
       AND pmdtseq=? FOR UPDATE"
   #add-point:input段define_sql
   {<point name="input.after_define_sql"/>}
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE apmt520_bcl CURSOR FROM g_forupd_sql
   
   #add-point:input段define_sql
   {<point name="input.define_sql2" mark="Y"/>}
   #end add-point    
   LET g_forupd_sql = "SELECT pmdusite,pmduseq,pmduseq1,pmdu001,pmdu002,pmdu003,pmdu004,pmdu006,pmdu007, 
       pmdu008,pmdu005,pmdu009,pmdu010,pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,pmdu017,pmdu016 FROM  
       pmdu_t WHERE pmduent=? AND pmdudocno=? AND pmduseq=? AND pmduseq1=? FOR UPDATE"
   #add-point:input段define_sql
   {<point name="input.after_define_sql2"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE apmt520_bcl2 CURSOR FROM g_forupd_sql
 
   #add-point:input段define_sql
   {<point name="input.define_sql3" mark="Y"/>}
   #end add-point    
   LET g_forupd_sql = "SELECT pmdvsite,pmdvseq,pmdvseq1,pmdv005,pmdv001,pmdv002,pmdv003,pmdv004,pmdv014, 
       pmdv015,pmdv016,pmdv017,pmdv018,pmdv019 FROM pmdv_t WHERE pmdvent=? AND pmdvdocno=? AND pmdvseq=?  
       AND pmdvseq1=? FOR UPDATE"
   #add-point:input段define_sql
   {<point name="input.after_define_sql3"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE apmt520_bcl3 CURSOR FROM g_forupd_sql
 
 
   
 
 
   #add-point:input段define_sql
   {<point name="input.other_sql"/>}
   #end add-point 
 
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'
   
   #控制key欄位可否輸入
   CALL apmt520_set_entry(p_cmd)
   #add-point:set_entry後
   {<point name="input.after_set_entry"/>}
   #end add-point
   CALL apmt520_set_no_entry(p_cmd)
 
   DISPLAY BY NAME g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002, 
       g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009, 
       g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014, 
       g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024, 
       g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036, 
       g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101, 
       g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041, 
       g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055, 
       g_pmds_m.pmds050
   
   LET lb_reproduce = FALSE
   
   #關閉被遮罩相關欄位輸入, 無法確定USER是否會需要輸入此欄位
   #因此先行關閉, 若有需要可於下方add-point中自行開啟
   CALL cl_mask_set_no_entry()
   
   #add-point:資料輸入前
   {<point name="input.before_input"/>}
   #end add-point
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
]]>
  </section>
  <section id="apmt520.input.body" ver="63" status="" src="s" readonly="">
    <![CDATA[   
      #Page1 預設值產生於此處
      INPUT ARRAY g_pmdt_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         #自訂ACTION(detail_input,page_1)
         
         
         BEFORE INPUT
            #add-point:資料輸入前
            {<point name="input.body.before_input2"/>}
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_pmdt_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL apmt520_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_detail_idx)
            END IF
            LET g_loc = 'm'
            LET g_rec_b = g_pmdt_d.getLength()
            #add-point:資料輸入前
            {<point name="input.d.before_input"/>}
            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2
            {<point name="input.body.before_row2"/>}
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 1
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN apmt520_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CLOSE apmt520_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            
            LET g_rec_b = g_pmdt_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_pmdt_d[l_ac].pmdtseq IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_pmdt_d_t.* = g_pmdt_d[l_ac].*  #BACKUP
               LET g_pmdt_d_o.* = g_pmdt_d[l_ac].*  #BACKUP
               CALL apmt520_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b
               {<point name="input.body.after_set_entry_b"/>}
               #end add-point  
               CALL apmt520_set_no_entry_b(l_cmd)
               IF NOT apmt520_lock_b("pmdt_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH apmt520_bcl INTO g_pmdt_d[l_ac].pmdtsite,g_pmdt_d[l_ac].pmdtseq,g_pmdt_d[l_ac].pmdt027, 
                      g_pmdt_d[l_ac].pmdt028,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt002,g_pmdt_d[l_ac].pmdt003, 
                      g_pmdt_d[l_ac].pmdt004,g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082,g_pmdt_d[l_ac].pmdt083, 
                      g_pmdt_d[l_ac].pmdt005,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007,g_pmdt_d[l_ac].pmdt009, 
                      g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt011,g_pmdt_d[l_ac].pmdt019, 
                      g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022,g_pmdt_d[l_ac].pmdt008, 
                      g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt090,g_pmdt_d[l_ac].pmdt091, 
                      g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt037,g_pmdt_d[l_ac].pmdt038, 
                      g_pmdt_d[l_ac].pmdt039,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt092,g_pmdt_d[l_ac].pmdt093, 
                      g_pmdt_d[l_ac].pmdt026,g_pmdt_d[l_ac].pmdt041,g_pmdt_d[l_ac].pmdt062,g_pmdt_d[l_ac].pmdt016, 
                      g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt063,g_pmdt_d[l_ac].pmdt072, 
                      g_pmdt_d[l_ac].pmdt073,g_pmdt_d[l_ac].pmdt074,g_pmdt_d[l_ac].pmdt040,g_pmdt_d[l_ac].pmdt052, 
                      g_pmdt_d[l_ac].pmdt051,g_pmdt_d[l_ac].pmdt070,g_pmdt_d[l_ac].pmdt071,g_pmdt_d[l_ac].pmdt059, 
                      g_pmdt_d[l_ac].pmdt053,g_pmdt_d[l_ac].pmdt054,g_pmdt_d[l_ac].pmdt055,g_pmdt_d[l_ac].pmdt060, 
                      g_pmdt_d[l_ac].pmdt061,g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt043,g_pmdt_d[l_ac].pmdt048, 
                      g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt045,g_pmdt_d[l_ac].pmdt084,g_pmdt_d[l_ac].pmdt089, 
                      g_pmdt_d[l_ac].pmdt088
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_pmdt_d_t.pmdtseq 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_pmdt_d_mask_o[l_ac].* =  g_pmdt_d[l_ac].*
                  CALL apmt520_pmdt_t_mask()
                  LET g_pmdt_d_mask_n[l_ac].* =  g_pmdt_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL apmt520_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row
            {<point name="input.body.before_row"/>}
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
            #其他table進行lock
            
        
         BEFORE INSERT
            
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_pmdt_d[l_ac].* TO NULL 
            INITIALIZE g_pmdt_d_t.* TO NULL 
            INITIALIZE g_pmdt_d_o.* TO NULL 
            #公用欄位給值(單身)
            
            #自定義預設值
                  LET g_pmdt_d[l_ac].pmdt005 = "1"
      LET g_pmdt_d[l_ac].pmdt025 = "1"
      LET g_pmdt_d[l_ac].pmdt020 = "0"
      LET g_pmdt_d[l_ac].pmdt022 = "0"
      LET g_pmdt_d[l_ac].pmdt024 = "0"
      LET g_pmdt_d[l_ac].pmdt090 = "0"
      LET g_pmdt_d[l_ac].pmdt091 = "0"
      LET g_pmdt_d[l_ac].pmdt036 = "0"
      LET g_pmdt_d[l_ac].pmdt038 = "0"
      LET g_pmdt_d[l_ac].pmdt039 = "0"
      LET g_pmdt_d[l_ac].pmdt047 = "0"
      LET g_pmdt_d[l_ac].pmdt092 = "0"
      LET g_pmdt_d[l_ac].pmdt093 = "0"
      LET g_pmdt_d[l_ac].pmdt026 = "N"
      LET g_pmdt_d[l_ac].pmdt041 = "N"
      LET g_pmdt_d[l_ac].pmdt062 = "N"
      LET g_pmdt_d[l_ac].pmdt071 = "0"
      LET g_pmdt_d[l_ac].pmdt053 = "0"
      LET g_pmdt_d[l_ac].pmdt054 = "0"
      LET g_pmdt_d[l_ac].pmdt055 = "0"
      LET g_pmdt_d[l_ac].pmdt061 = "0"
      LET g_pmdt_d[l_ac].pmdt048 = "0"
      LET g_pmdt_d[l_ac].pmdt044 = "0"
      LET g_pmdt_d[l_ac].pmdt084 = "N"
 
            #add-point:modify段before備份
            {<point name="input.body.insert.before_bak"/>}
            #end add-point
            LET g_pmdt_d_t.* = g_pmdt_d[l_ac].*     #新輸入資料
            LET g_pmdt_d_o.* = g_pmdt_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL apmt520_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b
            {<point name="input.body.insert.after_set_entry_b"/>}
            #end add-point
            CALL apmt520_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_pmdt_d[li_reproduce_target].* = g_pmdt_d[li_reproduce].*
 
               LET g_pmdt_d[li_reproduce_target].pmdtseq = NULL
 
            END IF
            
            #add-point:modify段before insert
            {<point name="input.body.before_insert"/>}
            #end add-point  
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身新增
            {<point name="input.body.b_a_insert"/>}
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(*) INTO l_count FROM pmdt_t 
             WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno
 
               AND pmdtseq = g_pmdt_d[l_ac].pmdtseq
 
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身新增前
               {<point name="input.body.b_insert"/>}
               #end add-point
            
               #同步新增到同層的table
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_pmds_m.pmdsdocno
               LET gs_keys[2] = g_pmdt_d[g_detail_idx].pmdtseq
               CALL apmt520_insert_b('pmdt_t',gs_keys,"'1'")
                           
               #add-point:單身新增後
               {<point name="input.body.a_insert"/>}
               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               INITIALIZE g_pmdt_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "pmdt_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')                    
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL apmt520_b_fill()
               #資料多語言用-增/改
               
               #add-point:input段-after_insert
               {<point name="input.body.a_insert2"/>}
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身刪除後(=d)
               {<point name="input.body.after_delete_d"/>}
               #end add-point
            ELSE
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身刪除前
               {<point name="input.body.b_delete" mark="Y"/>}
               #end add-point 
               
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_pmds_m.pmdsdocno
 
               LET gs_keys[gs_keys.getLength()+1] = g_pmdt_d_t.pmdtseq
 
            
               #刪除同層單身
               IF NOT apmt520_delete_b('pmdt_t',gs_keys,"'1'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE apmt520_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT apmt520_key_delete_b(gs_keys,'pmdt_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE apmt520_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
               
               #add-point:單身刪除中
               {<point name="input.body.m_delete"/>}
               #end add-point 
               
               CALL s_transaction_end('Y','0')
               CLOSE apmt520_bcl
            
               LET g_rec_b = g_rec_b-1
               #add-point:單身刪除後
               {<point name="input.body.a_delete"/>}
               #end add-point
               LET l_count = g_pmdt_d.getLength()
               
               #add-point:單身刪除後(<>d)
               {<point name="input.body.after_delete"/>}
               #end add-point
            END IF
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_pmdt_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
                  #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdtsite
            #add-point:BEFORE FIELD pmdtsite
            {<point name="input.b.page1.pmdtsite" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdtsite
            
            #add-point:AFTER FIELD pmdtsite
            {<point name="input.a.page1.pmdtsite" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdtsite
            #add-point:ON CHANGE pmdtsite
            {<point name="input.g.page1.pmdtsite" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdtseq
            #add-point:BEFORE FIELD pmdtseq
            {<point name="input.b.page1.pmdtseq" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdtseq
            
            #add-point:AFTER FIELD pmdtseq
            {<point name="input.a.page1.pmdtseq" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdtseq
            #add-point:ON CHANGE pmdtseq
            {<point name="input.g.page1.pmdtseq" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt027
            #add-point:BEFORE FIELD pmdt027
            {<point name="input.b.page1.pmdt027" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt027
            
            #add-point:AFTER FIELD pmdt027
            {<point name="input.a.page1.pmdt027" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt027
            #add-point:ON CHANGE pmdt027
            {<point name="input.g.page1.pmdt027" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt028
            #add-point:BEFORE FIELD pmdt028
            {<point name="input.b.page1.pmdt028" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt028
            
            #add-point:AFTER FIELD pmdt028
            {<point name="input.a.page1.pmdt028" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt028
            #add-point:ON CHANGE pmdt028
            {<point name="input.g.page1.pmdt028" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt001
            #add-point:BEFORE FIELD pmdt001
            {<point name="input.b.page1.pmdt001" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt001
            
            #add-point:AFTER FIELD pmdt001
            {<point name="input.a.page1.pmdt001" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt001
            #add-point:ON CHANGE pmdt001
            {<point name="input.g.page1.pmdt001" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt002
            #add-point:BEFORE FIELD pmdt002
            {<point name="input.b.page1.pmdt002" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt002
            
            #add-point:AFTER FIELD pmdt002
            {<point name="input.a.page1.pmdt002" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt002
            #add-point:ON CHANGE pmdt002
            {<point name="input.g.page1.pmdt002" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt003
            #add-point:BEFORE FIELD pmdt003
            {<point name="input.b.page1.pmdt003" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt003
            
            #add-point:AFTER FIELD pmdt003
            {<point name="input.a.page1.pmdt003" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt003
            #add-point:ON CHANGE pmdt003
            {<point name="input.g.page1.pmdt003" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt004
            #add-point:BEFORE FIELD pmdt004
            {<point name="input.b.page1.pmdt004" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt004
            
            #add-point:AFTER FIELD pmdt004
            {<point name="input.a.page1.pmdt004" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt004
            #add-point:ON CHANGE pmdt004
            {<point name="input.g.page1.pmdt004" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt081
            #add-point:BEFORE FIELD pmdt081
            {<point name="input.b.page1.pmdt081" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt081
            
            #add-point:AFTER FIELD pmdt081
            {<point name="input.a.page1.pmdt081" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt081
            #add-point:ON CHANGE pmdt081
            {<point name="input.g.page1.pmdt081" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt082
            #add-point:BEFORE FIELD pmdt082
            {<point name="input.b.page1.pmdt082" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt082
            
            #add-point:AFTER FIELD pmdt082
            {<point name="input.a.page1.pmdt082" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt082
            #add-point:ON CHANGE pmdt082
            {<point name="input.g.page1.pmdt082" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt083
            
            #add-point:AFTER FIELD pmdt083
            {<point name="input.a.page1.pmdt083" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt083
            #add-point:BEFORE FIELD pmdt083
            {<point name="input.b.page1.pmdt083" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt083
            #add-point:ON CHANGE pmdt083
            {<point name="input.g.page1.pmdt083" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt005
            #add-point:BEFORE FIELD pmdt005
            {<point name="input.b.page1.pmdt005" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt005
            
            #add-point:AFTER FIELD pmdt005
            {<point name="input.a.page1.pmdt005" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt005
            #add-point:ON CHANGE pmdt005
            {<point name="input.g.page1.pmdt005" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt006
            
            #add-point:AFTER FIELD pmdt006
            {<point name="input.a.page1.pmdt006" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt006
            #add-point:BEFORE FIELD pmdt006
            {<point name="input.b.page1.pmdt006" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt006
            #add-point:ON CHANGE pmdt006
            {<point name="input.g.page1.pmdt006" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt007
            
            #add-point:AFTER FIELD pmdt007
            {<point name="input.a.page1.pmdt007" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt007
            #add-point:BEFORE FIELD pmdt007
            {<point name="input.b.page1.pmdt007" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt007
            #add-point:ON CHANGE pmdt007
            {<point name="input.g.page1.pmdt007" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt009
            
            #add-point:AFTER FIELD pmdt009
            {<point name="input.a.page1.pmdt009" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt009
            #add-point:BEFORE FIELD pmdt009
            {<point name="input.b.page1.pmdt009" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt009
            #add-point:ON CHANGE pmdt009
            {<point name="input.g.page1.pmdt009" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt010
            #add-point:BEFORE FIELD pmdt010
            {<point name="input.b.page1.pmdt010" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt010
            
            #add-point:AFTER FIELD pmdt010
            {<point name="input.a.page1.pmdt010" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt010
            #add-point:ON CHANGE pmdt010
            {<point name="input.g.page1.pmdt010" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt025
            #add-point:BEFORE FIELD pmdt025
            {<point name="input.b.page1.pmdt025" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt025
            
            #add-point:AFTER FIELD pmdt025
            {<point name="input.a.page1.pmdt025" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt025
            #add-point:ON CHANGE pmdt025
            {<point name="input.g.page1.pmdt025" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt011
            #add-point:BEFORE FIELD pmdt011
            {<point name="input.b.page1.pmdt011" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt011
            
            #add-point:AFTER FIELD pmdt011
            {<point name="input.a.page1.pmdt011" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt011
            #add-point:ON CHANGE pmdt011
            {<point name="input.g.page1.pmdt011" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt019
            
            #add-point:AFTER FIELD pmdt019
            {<point name="input.a.page1.pmdt019" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt019
            #add-point:BEFORE FIELD pmdt019
            {<point name="input.b.page1.pmdt019" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt019
            #add-point:ON CHANGE pmdt019
            {<point name="input.g.page1.pmdt019" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt020
            #add-point:BEFORE FIELD pmdt020
            {<point name="input.b.page1.pmdt020" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt020
            
            #add-point:AFTER FIELD pmdt020
            {<point name="input.a.page1.pmdt020" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt020
            #add-point:ON CHANGE pmdt020
            {<point name="input.g.page1.pmdt020" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt021
            
            #add-point:AFTER FIELD pmdt021
            {<point name="input.a.page1.pmdt021" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt021
            #add-point:BEFORE FIELD pmdt021
            {<point name="input.b.page1.pmdt021" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt021
            #add-point:ON CHANGE pmdt021
            {<point name="input.g.page1.pmdt021" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt022
            #add-point:BEFORE FIELD pmdt022
            {<point name="input.b.page1.pmdt022" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt022
            
            #add-point:AFTER FIELD pmdt022
            {<point name="input.a.page1.pmdt022" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt022
            #add-point:ON CHANGE pmdt022
            {<point name="input.g.page1.pmdt022" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt008
            
            #add-point:AFTER FIELD pmdt008
            {<point name="input.a.page1.pmdt008" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt008
            #add-point:BEFORE FIELD pmdt008
            {<point name="input.b.page1.pmdt008" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt008
            #add-point:ON CHANGE pmdt008
            {<point name="input.g.page1.pmdt008" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt023
            
            #add-point:AFTER FIELD pmdt023
            {<point name="input.a.page1.pmdt023" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt023
            #add-point:BEFORE FIELD pmdt023
            {<point name="input.b.page1.pmdt023" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt023
            #add-point:ON CHANGE pmdt023
            {<point name="input.g.page1.pmdt023" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt024
            #add-point:BEFORE FIELD pmdt024
            {<point name="input.b.page1.pmdt024" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt024
            
            #add-point:AFTER FIELD pmdt024
            {<point name="input.a.page1.pmdt024" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt024
            #add-point:ON CHANGE pmdt024
            {<point name="input.g.page1.pmdt024" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt090
            #add-point:BEFORE FIELD pmdt090
            {<point name="input.b.page1.pmdt090" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt090
            
            #add-point:AFTER FIELD pmdt090
            {<point name="input.a.page1.pmdt090" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt090
            #add-point:ON CHANGE pmdt090
            {<point name="input.g.page1.pmdt090" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt091
            #add-point:BEFORE FIELD pmdt091
            {<point name="input.b.page1.pmdt091" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt091
            
            #add-point:AFTER FIELD pmdt091
            {<point name="input.a.page1.pmdt091" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt091
            #add-point:ON CHANGE pmdt091
            {<point name="input.g.page1.pmdt091" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt036
            #應用 a15 樣板自動產生(Version:2)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_pmdt_d[l_ac].pmdt036,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD pmdt036
            END IF 
 
 
            #add-point:AFTER FIELD pmdt036
            {<point name="input.a.page1.pmdt036" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt036
            #add-point:BEFORE FIELD pmdt036
            {<point name="input.b.page1.pmdt036" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt036
            #add-point:ON CHANGE pmdt036
            {<point name="input.g.page1.pmdt036" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt046
            
            #add-point:AFTER FIELD pmdt046
            {<point name="input.a.page1.pmdt046" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt046
            #add-point:BEFORE FIELD pmdt046
            {<point name="input.b.page1.pmdt046" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt046
            #add-point:ON CHANGE pmdt046
            {<point name="input.g.page1.pmdt046" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt037
            #add-point:BEFORE FIELD pmdt037
            {<point name="input.b.page1.pmdt037" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt037
            
            #add-point:AFTER FIELD pmdt037
            {<point name="input.a.page1.pmdt037" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt037
            #add-point:ON CHANGE pmdt037
            {<point name="input.g.page1.pmdt037" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt038
            #add-point:BEFORE FIELD pmdt038
            {<point name="input.b.page1.pmdt038" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt038
            
            #add-point:AFTER FIELD pmdt038
            {<point name="input.a.page1.pmdt038" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt038
            #add-point:ON CHANGE pmdt038
            {<point name="input.g.page1.pmdt038" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt039
            #add-point:BEFORE FIELD pmdt039
            {<point name="input.b.page1.pmdt039" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt039
            
            #add-point:AFTER FIELD pmdt039
            {<point name="input.a.page1.pmdt039" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt039
            #add-point:ON CHANGE pmdt039
            {<point name="input.g.page1.pmdt039" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt047
            #add-point:BEFORE FIELD pmdt047
            {<point name="input.b.page1.pmdt047" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt047
            
            #add-point:AFTER FIELD pmdt047
            {<point name="input.a.page1.pmdt047" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt047
            #add-point:ON CHANGE pmdt047
            {<point name="input.g.page1.pmdt047" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt092
            #add-point:BEFORE FIELD pmdt092
            {<point name="input.b.page1.pmdt092" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt092
            
            #add-point:AFTER FIELD pmdt092
            {<point name="input.a.page1.pmdt092" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt092
            #add-point:ON CHANGE pmdt092
            {<point name="input.g.page1.pmdt092" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt093
            #add-point:BEFORE FIELD pmdt093
            {<point name="input.b.page1.pmdt093" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt093
            
            #add-point:AFTER FIELD pmdt093
            {<point name="input.a.page1.pmdt093" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt093
            #add-point:ON CHANGE pmdt093
            {<point name="input.g.page1.pmdt093" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt026
            #add-point:BEFORE FIELD pmdt026
            {<point name="input.b.page1.pmdt026" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt026
            
            #add-point:AFTER FIELD pmdt026
            {<point name="input.a.page1.pmdt026" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt026
            #add-point:ON CHANGE pmdt026
            {<point name="input.g.page1.pmdt026" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt041
            #add-point:BEFORE FIELD pmdt041
            {<point name="input.b.page1.pmdt041" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt041
            
            #add-point:AFTER FIELD pmdt041
            {<point name="input.a.page1.pmdt041" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt041
            #add-point:ON CHANGE pmdt041
            {<point name="input.g.page1.pmdt041" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt062
            #add-point:BEFORE FIELD pmdt062
            {<point name="input.b.page1.pmdt062" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt062
            
            #add-point:AFTER FIELD pmdt062
            {<point name="input.a.page1.pmdt062" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt062
            #add-point:ON CHANGE pmdt062
            {<point name="input.g.page1.pmdt062" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt016
            
            #add-point:AFTER FIELD pmdt016
            {<point name="input.a.page1.pmdt016" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt016
            #add-point:BEFORE FIELD pmdt016
            {<point name="input.b.page1.pmdt016" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt016
            #add-point:ON CHANGE pmdt016
            {<point name="input.g.page1.pmdt016" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt017
            
            #add-point:AFTER FIELD pmdt017
            {<point name="input.a.page1.pmdt017" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt017
            #add-point:BEFORE FIELD pmdt017
            {<point name="input.b.page1.pmdt017" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt017
            #add-point:ON CHANGE pmdt017
            {<point name="input.g.page1.pmdt017" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt018
            #add-point:BEFORE FIELD pmdt018
            {<point name="input.b.page1.pmdt018" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt018
            
            #add-point:AFTER FIELD pmdt018
            {<point name="input.a.page1.pmdt018" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt018
            #add-point:ON CHANGE pmdt018
            {<point name="input.g.page1.pmdt018" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt063
            #add-point:BEFORE FIELD pmdt063
            {<point name="input.b.page1.pmdt063" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt063
            
            #add-point:AFTER FIELD pmdt063
            {<point name="input.a.page1.pmdt063" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt063
            #add-point:ON CHANGE pmdt063
            {<point name="input.g.page1.pmdt063" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt072
            
            #add-point:AFTER FIELD pmdt072
            {<point name="input.a.page1.pmdt072" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt072
            #add-point:BEFORE FIELD pmdt072
            {<point name="input.b.page1.pmdt072" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt072
            #add-point:ON CHANGE pmdt072
            {<point name="input.g.page1.pmdt072" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt073
            
            #add-point:AFTER FIELD pmdt073
            {<point name="input.a.page1.pmdt073" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt073
            #add-point:BEFORE FIELD pmdt073
            {<point name="input.b.page1.pmdt073" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt073
            #add-point:ON CHANGE pmdt073
            {<point name="input.g.page1.pmdt073" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt074
            
            #add-point:AFTER FIELD pmdt074
            {<point name="input.a.page1.pmdt074" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt074
            #add-point:BEFORE FIELD pmdt074
            {<point name="input.b.page1.pmdt074" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt074
            #add-point:ON CHANGE pmdt074
            {<point name="input.g.page1.pmdt074" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt051
            
            #add-point:AFTER FIELD pmdt051
            {<point name="input.a.page1.pmdt051" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt051
            #add-point:BEFORE FIELD pmdt051
            {<point name="input.b.page1.pmdt051" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt051
            #add-point:ON CHANGE pmdt051
            {<point name="input.g.page1.pmdt051" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt070
            #add-point:BEFORE FIELD pmdt070
            {<point name="input.b.page1.pmdt070" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt070
            
            #add-point:AFTER FIELD pmdt070
            {<point name="input.a.page1.pmdt070" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt070
            #add-point:ON CHANGE pmdt070
            {<point name="input.g.page1.pmdt070" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt071
            #add-point:BEFORE FIELD pmdt071
            {<point name="input.b.page1.pmdt071" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt071
            
            #add-point:AFTER FIELD pmdt071
            {<point name="input.a.page1.pmdt071" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt071
            #add-point:ON CHANGE pmdt071
            {<point name="input.g.page1.pmdt071" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt059
            #add-point:BEFORE FIELD pmdt059
            {<point name="input.b.page1.pmdt059" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt059
            
            #add-point:AFTER FIELD pmdt059
            {<point name="input.a.page1.pmdt059" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt059
            #add-point:ON CHANGE pmdt059
            {<point name="input.g.page1.pmdt059" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt053
            #add-point:BEFORE FIELD pmdt053
            {<point name="input.b.page1.pmdt053" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt053
            
            #add-point:AFTER FIELD pmdt053
            {<point name="input.a.page1.pmdt053" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt053
            #add-point:ON CHANGE pmdt053
            {<point name="input.g.page1.pmdt053" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt054
            #add-point:BEFORE FIELD pmdt054
            {<point name="input.b.page1.pmdt054" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt054
            
            #add-point:AFTER FIELD pmdt054
            {<point name="input.a.page1.pmdt054" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt054
            #add-point:ON CHANGE pmdt054
            {<point name="input.g.page1.pmdt054" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt055
            #add-point:BEFORE FIELD pmdt055
            {<point name="input.b.page1.pmdt055" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt055
            
            #add-point:AFTER FIELD pmdt055
            {<point name="input.a.page1.pmdt055" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt055
            #add-point:ON CHANGE pmdt055
            {<point name="input.g.page1.pmdt055" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt060
            #add-point:BEFORE FIELD pmdt060
            {<point name="input.b.page1.pmdt060" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt060
            
            #add-point:AFTER FIELD pmdt060
            {<point name="input.a.page1.pmdt060" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt060
            #add-point:ON CHANGE pmdt060
            {<point name="input.g.page1.pmdt060" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt061
            #add-point:BEFORE FIELD pmdt061
            {<point name="input.b.page1.pmdt061" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt061
            
            #add-point:AFTER FIELD pmdt061
            {<point name="input.a.page1.pmdt061" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt061
            #add-point:ON CHANGE pmdt061
            {<point name="input.g.page1.pmdt061" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt042
            #add-point:BEFORE FIELD pmdt042
            {<point name="input.b.page1.pmdt042" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt042
            
            #add-point:AFTER FIELD pmdt042
            {<point name="input.a.page1.pmdt042" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt042
            #add-point:ON CHANGE pmdt042
            {<point name="input.g.page1.pmdt042" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt043
            #add-point:BEFORE FIELD pmdt043
            {<point name="input.b.page1.pmdt043" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt043
            
            #add-point:AFTER FIELD pmdt043
            {<point name="input.a.page1.pmdt043" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt043
            #add-point:ON CHANGE pmdt043
            {<point name="input.g.page1.pmdt043" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt048
            #add-point:BEFORE FIELD pmdt048
            {<point name="input.b.page1.pmdt048" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt048
            
            #add-point:AFTER FIELD pmdt048
            {<point name="input.a.page1.pmdt048" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt048
            #add-point:ON CHANGE pmdt048
            {<point name="input.g.page1.pmdt048" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt044
            #add-point:BEFORE FIELD pmdt044
            {<point name="input.b.page1.pmdt044" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt044
            
            #add-point:AFTER FIELD pmdt044
            {<point name="input.a.page1.pmdt044" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt044
            #add-point:ON CHANGE pmdt044
            {<point name="input.g.page1.pmdt044" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt045
            #add-point:BEFORE FIELD pmdt045
            {<point name="input.b.page1.pmdt045" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt045
            
            #add-point:AFTER FIELD pmdt045
            {<point name="input.a.page1.pmdt045" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt045
            #add-point:ON CHANGE pmdt045
            {<point name="input.g.page1.pmdt045" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt084
            #add-point:BEFORE FIELD pmdt084
            {<point name="input.b.page1.pmdt084" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt084
            
            #add-point:AFTER FIELD pmdt084
            {<point name="input.a.page1.pmdt084" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt084
            #add-point:ON CHANGE pmdt084
            {<point name="input.g.page1.pmdt084" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt089
            #add-point:BEFORE FIELD pmdt089
            {<point name="input.b.page1.pmdt089" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt089
            
            #add-point:AFTER FIELD pmdt089
            {<point name="input.a.page1.pmdt089" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt089
            #add-point:ON CHANGE pmdt089
            {<point name="input.g.page1.pmdt089" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdt088
            #add-point:BEFORE FIELD pmdt088
            {<point name="input.b.page1.pmdt088" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdt088
            
            #add-point:AFTER FIELD pmdt088
            {<point name="input.a.page1.pmdt088" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdt088
            #add-point:ON CHANGE pmdt088
            {<point name="input.g.page1.pmdt088" />}
            #END add-point 
 
 
                  #Ctrlp:input.c.page1.pmdtsite
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdtsite
            #add-point:ON ACTION controlp INFIELD pmdtsite
            {<point name="input.c.page1.pmdtsite" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdtseq
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdtseq
            #add-point:ON ACTION controlp INFIELD pmdtseq
            {<point name="input.c.page1.pmdtseq" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt027
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt027
            #add-point:ON ACTION controlp INFIELD pmdt027
            {<point name="input.c.page1.pmdt027" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt028
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt028
            #add-point:ON ACTION controlp INFIELD pmdt028
            {<point name="input.c.page1.pmdt028" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt001
            #add-point:ON ACTION controlp INFIELD pmdt001
            {<point name="input.c.page1.pmdt001" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt002
            #add-point:ON ACTION controlp INFIELD pmdt002
            {<point name="input.c.page1.pmdt002" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt003
            #add-point:ON ACTION controlp INFIELD pmdt003
            {<point name="input.c.page1.pmdt003" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt004
            #add-point:ON ACTION controlp INFIELD pmdt004
            {<point name="input.c.page1.pmdt004" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt081
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt081
            #add-point:ON ACTION controlp INFIELD pmdt081
            {<point name="input.c.page1.pmdt081" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt082
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt082
            #add-point:ON ACTION controlp INFIELD pmdt082
            {<point name="input.c.page1.pmdt082" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt083
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt083
            #add-point:ON ACTION controlp INFIELD pmdt083
            {<point name="input.c.page1.pmdt083" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt005
            #add-point:ON ACTION controlp INFIELD pmdt005
            {<point name="input.c.page1.pmdt005" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt006
            #add-point:ON ACTION controlp INFIELD pmdt006
            {<point name="input.c.page1.pmdt006" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt007
            #add-point:ON ACTION controlp INFIELD pmdt007
            {<point name="input.c.page1.pmdt007" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt009
            #add-point:ON ACTION controlp INFIELD pmdt009
            {<point name="input.c.page1.pmdt009" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt010
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt010
            #add-point:ON ACTION controlp INFIELD pmdt010
            {<point name="input.c.page1.pmdt010" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt025
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt025
            #add-point:ON ACTION controlp INFIELD pmdt025
            {<point name="input.c.page1.pmdt025" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt011
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt011
            #add-point:ON ACTION controlp INFIELD pmdt011
            {<point name="input.c.page1.pmdt011" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt019
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt019
            #add-point:ON ACTION controlp INFIELD pmdt019
            {<point name="input.c.page1.pmdt019" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt020
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt020
            #add-point:ON ACTION controlp INFIELD pmdt020
            {<point name="input.c.page1.pmdt020" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt021
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt021
            #add-point:ON ACTION controlp INFIELD pmdt021
            {<point name="input.c.page1.pmdt021" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt022
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt022
            #add-point:ON ACTION controlp INFIELD pmdt022
            {<point name="input.c.page1.pmdt022" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt008
            #add-point:ON ACTION controlp INFIELD pmdt008
            {<point name="input.c.page1.pmdt008" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt023
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt023
            #add-point:ON ACTION controlp INFIELD pmdt023
            {<point name="input.c.page1.pmdt023" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt024
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt024
            #add-point:ON ACTION controlp INFIELD pmdt024
            {<point name="input.c.page1.pmdt024" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt090
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt090
            #add-point:ON ACTION controlp INFIELD pmdt090
            {<point name="input.c.page1.pmdt090" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt091
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt091
            #add-point:ON ACTION controlp INFIELD pmdt091
            {<point name="input.c.page1.pmdt091" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt036
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt036
            #add-point:ON ACTION controlp INFIELD pmdt036
            {<point name="input.c.page1.pmdt036" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt046
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt046
            #add-point:ON ACTION controlp INFIELD pmdt046
            {<point name="input.c.page1.pmdt046" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt037
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt037
            #add-point:ON ACTION controlp INFIELD pmdt037
            {<point name="input.c.page1.pmdt037" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt038
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt038
            #add-point:ON ACTION controlp INFIELD pmdt038
            {<point name="input.c.page1.pmdt038" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt039
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt039
            #add-point:ON ACTION controlp INFIELD pmdt039
            {<point name="input.c.page1.pmdt039" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt047
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt047
            #add-point:ON ACTION controlp INFIELD pmdt047
            {<point name="input.c.page1.pmdt047" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt092
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt092
            #add-point:ON ACTION controlp INFIELD pmdt092
            {<point name="input.c.page1.pmdt092" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt093
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt093
            #add-point:ON ACTION controlp INFIELD pmdt093
            {<point name="input.c.page1.pmdt093" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt026
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt026
            #add-point:ON ACTION controlp INFIELD pmdt026
            {<point name="input.c.page1.pmdt026" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt041
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt041
            #add-point:ON ACTION controlp INFIELD pmdt041
            {<point name="input.c.page1.pmdt041" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt062
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt062
            #add-point:ON ACTION controlp INFIELD pmdt062
            {<point name="input.c.page1.pmdt062" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt016
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt016
            #add-point:ON ACTION controlp INFIELD pmdt016
            {<point name="input.c.page1.pmdt016" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt017
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt017
            #add-point:ON ACTION controlp INFIELD pmdt017
            {<point name="input.c.page1.pmdt017" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt018
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt018
            #add-point:ON ACTION controlp INFIELD pmdt018
            {<point name="input.c.page1.pmdt018" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt063
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt063
            #add-point:ON ACTION controlp INFIELD pmdt063
            {<point name="input.c.page1.pmdt063" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt072
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt072
            #add-point:ON ACTION controlp INFIELD pmdt072
            {<point name="input.c.page1.pmdt072" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt073
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt073
            #add-point:ON ACTION controlp INFIELD pmdt073
            {<point name="input.c.page1.pmdt073" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt074
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt074
            #add-point:ON ACTION controlp INFIELD pmdt074
            {<point name="input.c.page1.pmdt074" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt051
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt051
            #add-point:ON ACTION controlp INFIELD pmdt051
            {<point name="input.c.page1.pmdt051" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt070
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt070
            #add-point:ON ACTION controlp INFIELD pmdt070
            {<point name="input.c.page1.pmdt070" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt071
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt071
            #add-point:ON ACTION controlp INFIELD pmdt071
            {<point name="input.c.page1.pmdt071" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt059
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt059
            #add-point:ON ACTION controlp INFIELD pmdt059
            {<point name="input.c.page1.pmdt059" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt053
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt053
            #add-point:ON ACTION controlp INFIELD pmdt053
            {<point name="input.c.page1.pmdt053" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt054
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt054
            #add-point:ON ACTION controlp INFIELD pmdt054
            {<point name="input.c.page1.pmdt054" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt055
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt055
            #add-point:ON ACTION controlp INFIELD pmdt055
            {<point name="input.c.page1.pmdt055" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt060
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt060
            #add-point:ON ACTION controlp INFIELD pmdt060
            {<point name="input.c.page1.pmdt060" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt061
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt061
            #add-point:ON ACTION controlp INFIELD pmdt061
            {<point name="input.c.page1.pmdt061" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt042
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt042
            #add-point:ON ACTION controlp INFIELD pmdt042
            {<point name="input.c.page1.pmdt042" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt043
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt043
            #add-point:ON ACTION controlp INFIELD pmdt043
            {<point name="input.c.page1.pmdt043" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt048
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt048
            #add-point:ON ACTION controlp INFIELD pmdt048
            {<point name="input.c.page1.pmdt048" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt044
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt044
            #add-point:ON ACTION controlp INFIELD pmdt044
            {<point name="input.c.page1.pmdt044" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt045
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt045
            #add-point:ON ACTION controlp INFIELD pmdt045
            {<point name="input.c.page1.pmdt045" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt084
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt084
            #add-point:ON ACTION controlp INFIELD pmdt084
            {<point name="input.c.page1.pmdt084" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt089
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt089
            #add-point:ON ACTION controlp INFIELD pmdt089
            {<point name="input.c.page1.pmdt089" />}
            #END add-point
 
         #Ctrlp:input.c.page1.pmdt088
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdt088
            #add-point:ON ACTION controlp INFIELD pmdt088
            {<point name="input.c.page1.pmdt088" />}
            #END add-point
 
 
 
         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               LET g_pmdt_d[l_ac].* = g_pmdt_d_t.*
               CLOSE apmt520_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_pmdt_d[l_ac].pmdtseq 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_pmdt_d[l_ac].* = g_pmdt_d_t.*
            ELSE
            
               #add-point:單身修改前
               {<point name="input.body.b_update" mark="Y"/>}
               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
               #將遮罩欄位還原
               CALL apmt520_pmdt_t_mask_restore('restore_mask_o')
      
               UPDATE pmdt_t SET (pmdtdocno,pmdtsite,pmdtseq,pmdt027,pmdt028,pmdt001,pmdt002,pmdt003, 
                   pmdt004,pmdt081,pmdt082,pmdt083,pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011, 
                   pmdt019,pmdt020,pmdt021,pmdt022,pmdt008,pmdt023,pmdt024,pmdt090,pmdt091,pmdt036,pmdt046, 
                   pmdt037,pmdt038,pmdt039,pmdt047,pmdt092,pmdt093,pmdt026,pmdt041,pmdt062,pmdt016,pmdt017, 
                   pmdt018,pmdt063,pmdt072,pmdt073,pmdt074,pmdt040,pmdt052,pmdt051,pmdt070,pmdt071,pmdt059, 
                   pmdt053,pmdt054,pmdt055,pmdt060,pmdt061,pmdt042,pmdt043,pmdt048,pmdt044,pmdt045,pmdt084, 
                   pmdt089,pmdt088) = (g_pmds_m.pmdsdocno,g_pmdt_d[l_ac].pmdtsite,g_pmdt_d[l_ac].pmdtseq, 
                   g_pmdt_d[l_ac].pmdt027,g_pmdt_d[l_ac].pmdt028,g_pmdt_d[l_ac].pmdt001,g_pmdt_d[l_ac].pmdt002, 
                   g_pmdt_d[l_ac].pmdt003,g_pmdt_d[l_ac].pmdt004,g_pmdt_d[l_ac].pmdt081,g_pmdt_d[l_ac].pmdt082, 
                   g_pmdt_d[l_ac].pmdt083,g_pmdt_d[l_ac].pmdt005,g_pmdt_d[l_ac].pmdt006,g_pmdt_d[l_ac].pmdt007, 
                   g_pmdt_d[l_ac].pmdt009,g_pmdt_d[l_ac].pmdt010,g_pmdt_d[l_ac].pmdt025,g_pmdt_d[l_ac].pmdt011, 
                   g_pmdt_d[l_ac].pmdt019,g_pmdt_d[l_ac].pmdt020,g_pmdt_d[l_ac].pmdt021,g_pmdt_d[l_ac].pmdt022, 
                   g_pmdt_d[l_ac].pmdt008,g_pmdt_d[l_ac].pmdt023,g_pmdt_d[l_ac].pmdt024,g_pmdt_d[l_ac].pmdt090, 
                   g_pmdt_d[l_ac].pmdt091,g_pmdt_d[l_ac].pmdt036,g_pmdt_d[l_ac].pmdt046,g_pmdt_d[l_ac].pmdt037, 
                   g_pmdt_d[l_ac].pmdt038,g_pmdt_d[l_ac].pmdt039,g_pmdt_d[l_ac].pmdt047,g_pmdt_d[l_ac].pmdt092, 
                   g_pmdt_d[l_ac].pmdt093,g_pmdt_d[l_ac].pmdt026,g_pmdt_d[l_ac].pmdt041,g_pmdt_d[l_ac].pmdt062, 
                   g_pmdt_d[l_ac].pmdt016,g_pmdt_d[l_ac].pmdt017,g_pmdt_d[l_ac].pmdt018,g_pmdt_d[l_ac].pmdt063, 
                   g_pmdt_d[l_ac].pmdt072,g_pmdt_d[l_ac].pmdt073,g_pmdt_d[l_ac].pmdt074,g_pmdt_d[l_ac].pmdt040, 
                   g_pmdt_d[l_ac].pmdt052,g_pmdt_d[l_ac].pmdt051,g_pmdt_d[l_ac].pmdt070,g_pmdt_d[l_ac].pmdt071, 
                   g_pmdt_d[l_ac].pmdt059,g_pmdt_d[l_ac].pmdt053,g_pmdt_d[l_ac].pmdt054,g_pmdt_d[l_ac].pmdt055, 
                   g_pmdt_d[l_ac].pmdt060,g_pmdt_d[l_ac].pmdt061,g_pmdt_d[l_ac].pmdt042,g_pmdt_d[l_ac].pmdt043, 
                   g_pmdt_d[l_ac].pmdt048,g_pmdt_d[l_ac].pmdt044,g_pmdt_d[l_ac].pmdt045,g_pmdt_d[l_ac].pmdt084, 
                   g_pmdt_d[l_ac].pmdt089,g_pmdt_d[l_ac].pmdt088)
                WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmds_m.pmdsdocno 
 
                  AND pmdtseq = g_pmdt_d_t.pmdtseq #項次   
 
                  
               #add-point:單身修改中
               {<point name="input.body.m_update"/>}
               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "pmdt_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     CALL s_transaction_end('N','0')
                     LET g_pmdt_d[l_ac].* = g_pmdt_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "pmdt_t" 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()                   
                     CALL s_transaction_end('N','0')
                     LET g_pmdt_d[l_ac].* = g_pmdt_d_t.*  
                  OTHERWISE
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_pmds_m.pmdsdocno
               LET gs_keys_bak[1] = g_pmdsdocno_t
               LET gs_keys[2] = g_pmdt_d[g_detail_idx].pmdtseq
               LET gs_keys_bak[2] = g_pmdt_d_t.pmdtseq
               CALL apmt520_update_b('pmdt_t',gs_keys,gs_keys_bak,"'1'")
                     #資料多語言用-增/改
                     
               END CASE
 
               #將遮罩欄位進行遮蔽
               CALL apmt520_pmdt_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT(g_pmdt_d[g_detail_idx].pmdtseq = g_pmdt_d_t.pmdtseq 
 
                  ) THEN
                  LET gs_keys[01] = g_pmds_m.pmdsdocno
 
                  LET gs_keys[gs_keys.getLength()+1] = g_pmdt_d_t.pmdtseq
 
                  CALL apmt520_key_update_b(gs_keys,'pmdt_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_pmds_m),util.JSON.stringify(g_pmdt_d_t)
               LET g_log2 = util.JSON.stringify(g_pmds_m),util.JSON.stringify(g_pmdt_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身修改後
               {<point name="input.body.a_update"/>}
               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row
            {<point name="input.body.after_row"/>}
            #end add-point
            CALL apmt520_unlock_b("pmdt_t","'1'")
            CALL s_transaction_end('Y','0')
            #其他table進行unlock
            #add-point:單身after_row2
            {<point name="input.body.after_row2"/>}
            #end add-point
              
         AFTER INPUT
            #add-point:input段after input 
            {<point name="input.body.after_input"/>}
            #end add-point 
 
         ON ACTION controlo    
            CALL FGL_SET_ARR_CURR(g_pmdt_d.getLength()+1)
            LET lb_reproduce = TRUE
            LET li_reproduce = l_ac
            LET li_reproduce_target = g_pmdt_d.getLength()+1
            
         #ON ACTION cancel
         #   LET INT_FLAG = 1
         #   LET g_detail_idx = 1
         #   EXIT DIALOG 
 
      END INPUT
      
 
      
 
      DISPLAY ARRAY g_pmdt2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
    
         BEFORE ROW
            CALL apmt520_idx_chk()
            LET l_ac = DIALOG.getCurrentRow("s_detail2")
            LET g_detail_idx = l_ac
            
            #add-point:page2, before row動作
            {<point name="input.body2.before_row"/>}
            #end add-point
            
         BEFORE DISPLAY
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' THEN
               CALL FGL_SET_ARR_CURR(g_detail_idx)
            END IF
            LET g_loc = 'm'
            LET l_ac = DIALOG.getCurrentRow("s_detail2")
            CALL apmt520_idx_chk()
            LET g_current_page = 2
      
         #add-point:page2自定義行為
         {<point name="input.body2.action"/>}
         #end add-point
      
      END DISPLAY
      DISPLAY ARRAY g_pmdt3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b)  
    
         BEFORE ROW
            CALL apmt520_idx_chk()
            LET l_ac = DIALOG.getCurrentRow("s_detail3")
            LET g_detail_idx = l_ac
            
            #add-point:page3, before row動作
            {<point name="input.body3.before_row"/>}
            #end add-point
            
         BEFORE DISPLAY
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' THEN
               CALL FGL_SET_ARR_CURR(g_detail_idx)
            END IF
            LET g_loc = 'm'
            LET l_ac = DIALOG.getCurrentRow("s_detail3")
            CALL apmt520_idx_chk()
            LET g_current_page = 3
      
         #add-point:page3自定義行為
         {<point name="input.body3.action"/>}
         #end add-point
      
      END DISPLAY
 
 
]]>
  </section>
  <section id="apmt520.input.head" ver="45" status="" src="s" readonly="">
    <![CDATA[      #單頭段
      INPUT BY NAME g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002, 
          g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009, 
          g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014, 
          g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024, 
          g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036, 
          g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101, 
          g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041, 
          g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055, 
          g_pmds_m.pmds050 
         ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂ACTION(master_input)
         
     
         BEFORE INPUT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN apmt520_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CLOSE apmt520_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            
            IF l_cmd_t = 'r' THEN
               
            END IF
            #因應離開單頭後已寫入資料庫, 若重新回到單頭則視為修改
            #因此需於此處開啟/關閉欄位
            CALL apmt520_set_entry(p_cmd)
            #add-point:資料輸入前
            {<point name="input.m.before_input"/>}
            #end add-point
            CALL apmt520_set_no_entry(p_cmd)
    
                  #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdssite
            #add-point:BEFORE FIELD pmdssite
            {<point name="input.b.pmdssite" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdssite
            
            #add-point:AFTER FIELD pmdssite
            {<point name="input.a.pmdssite" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdssite
            #add-point:ON CHANGE pmdssite
            {<point name="input.g.pmdssite" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsdocno
            
            #add-point:AFTER FIELD pmdsdocno
            {<point name="input.a.pmdsdocno" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsdocno
            #add-point:BEFORE FIELD pmdsdocno
            {<point name="input.b.pmdsdocno" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdsdocno
            #add-point:ON CHANGE pmdsdocno
            {<point name="input.g.pmdsdocno" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsdocdt
            #add-point:BEFORE FIELD pmdsdocdt
            {<point name="input.b.pmdsdocdt" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsdocdt
            
            #add-point:AFTER FIELD pmdsdocdt
            {<point name="input.a.pmdsdocdt" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdsdocdt
            #add-point:ON CHANGE pmdsdocdt
            {<point name="input.g.pmdsdocdt" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds001
            #add-point:BEFORE FIELD pmds001
            {<point name="input.b.pmds001" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds001
            
            #add-point:AFTER FIELD pmds001
            {<point name="input.a.pmds001" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds001
            #add-point:ON CHANGE pmds001
            {<point name="input.g.pmds001" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds002
            
            #add-point:AFTER FIELD pmds002
            {<point name="input.a.pmds002" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds002
            #add-point:BEFORE FIELD pmds002
            {<point name="input.b.pmds002" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds002
            #add-point:ON CHANGE pmds002
            {<point name="input.g.pmds002" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds003
            
            #add-point:AFTER FIELD pmds003
            {<point name="input.a.pmds003" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds003
            #add-point:BEFORE FIELD pmds003
            {<point name="input.b.pmds003" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds003
            #add-point:ON CHANGE pmds003
            {<point name="input.g.pmds003" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmdsstus
            #add-point:BEFORE FIELD pmdsstus
            {<point name="input.b.pmdsstus" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmdsstus
            
            #add-point:AFTER FIELD pmdsstus
            {<point name="input.a.pmdsstus" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmdsstus
            #add-point:ON CHANGE pmdsstus
            {<point name="input.g.pmdsstus" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds006
            #add-point:BEFORE FIELD pmds006
            {<point name="input.b.pmds006" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds006
            
            #add-point:AFTER FIELD pmds006
            {<point name="input.a.pmds006" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds006
            #add-point:ON CHANGE pmds006
            {<point name="input.g.pmds006" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds007
            
            #add-point:AFTER FIELD pmds007
            {<point name="input.a.pmds007" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds007
            #add-point:BEFORE FIELD pmds007
            {<point name="input.b.pmds007" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds007
            #add-point:ON CHANGE pmds007
            {<point name="input.g.pmds007" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds008
            
            #add-point:AFTER FIELD pmds008
            {<point name="input.a.pmds008" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds008
            #add-point:BEFORE FIELD pmds008
            {<point name="input.b.pmds008" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds008
            #add-point:ON CHANGE pmds008
            {<point name="input.g.pmds008" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds009
            
            #add-point:AFTER FIELD pmds009
            {<point name="input.a.pmds009" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds009
            #add-point:BEFORE FIELD pmds009
            {<point name="input.b.pmds009" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds009
            #add-point:ON CHANGE pmds009
            {<point name="input.g.pmds009" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds010
            #add-point:BEFORE FIELD pmds010
            {<point name="input.b.pmds010" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds010
            
            #add-point:AFTER FIELD pmds010
            {<point name="input.a.pmds010" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds010
            #add-point:ON CHANGE pmds010
            {<point name="input.g.pmds010" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds052
            #add-point:BEFORE FIELD pmds052
            {<point name="input.b.pmds052" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds052
            
            #add-point:AFTER FIELD pmds052
            {<point name="input.a.pmds052" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds052
            #add-point:ON CHANGE pmds052
            {<point name="input.g.pmds052" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds000
            #add-point:BEFORE FIELD pmds000
            {<point name="input.b.pmds000" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds000
            
            #add-point:AFTER FIELD pmds000
            {<point name="input.a.pmds000" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds000
            #add-point:ON CHANGE pmds000
            {<point name="input.g.pmds000" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds100
            #add-point:BEFORE FIELD pmds100
            {<point name="input.b.pmds100" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds100
            
            #add-point:AFTER FIELD pmds100
            {<point name="input.a.pmds100" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds100
            #add-point:ON CHANGE pmds100
            {<point name="input.g.pmds100" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds011
            #add-point:BEFORE FIELD pmds011
            {<point name="input.b.pmds011" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds011
            
            #add-point:AFTER FIELD pmds011
            {<point name="input.a.pmds011" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds011
            #add-point:ON CHANGE pmds011
            {<point name="input.g.pmds011" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds014
            #add-point:BEFORE FIELD pmds014
            {<point name="input.b.pmds014" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds014
            
            #add-point:AFTER FIELD pmds014
            {<point name="input.a.pmds014" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds014
            #add-point:ON CHANGE pmds014
            {<point name="input.g.pmds014" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds081
            #add-point:BEFORE FIELD pmds081
            {<point name="input.b.pmds081" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds081
            
            #add-point:AFTER FIELD pmds081
            {<point name="input.a.pmds081" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds081
            #add-point:ON CHANGE pmds081
            {<point name="input.g.pmds081" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds045
            #add-point:BEFORE FIELD pmds045
            {<point name="input.b.pmds045" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds045
            
            #add-point:AFTER FIELD pmds045
            {<point name="input.a.pmds045" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds045
            #add-point:ON CHANGE pmds045
            {<point name="input.g.pmds045" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds021
            #add-point:BEFORE FIELD pmds021
            {<point name="input.b.pmds021" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds021
            
            #add-point:AFTER FIELD pmds021
            {<point name="input.a.pmds021" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds021
            #add-point:ON CHANGE pmds021
            {<point name="input.g.pmds021" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds022
            #add-point:BEFORE FIELD pmds022
            {<point name="input.b.pmds022" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds022
            
            #add-point:AFTER FIELD pmds022
            {<point name="input.a.pmds022" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds022
            #add-point:ON CHANGE pmds022
            {<point name="input.g.pmds022" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds023
            #add-point:BEFORE FIELD pmds023
            {<point name="input.b.pmds023" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds023
            
            #add-point:AFTER FIELD pmds023
            {<point name="input.a.pmds023" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds023
            #add-point:ON CHANGE pmds023
            {<point name="input.g.pmds023" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds024
            #add-point:BEFORE FIELD pmds024
            {<point name="input.b.pmds024" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds024
            
            #add-point:AFTER FIELD pmds024
            {<point name="input.a.pmds024" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds024
            #add-point:ON CHANGE pmds024
            {<point name="input.g.pmds024" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds031
            
            #add-point:AFTER FIELD pmds031
            {<point name="input.a.pmds031" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds031
            #add-point:BEFORE FIELD pmds031
            {<point name="input.b.pmds031" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds031
            #add-point:ON CHANGE pmds031
            {<point name="input.g.pmds031" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds032
            
            #add-point:AFTER FIELD pmds032
            {<point name="input.a.pmds032" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds032
            #add-point:BEFORE FIELD pmds032
            {<point name="input.b.pmds032" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds032
            #add-point:ON CHANGE pmds032
            {<point name="input.g.pmds032" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds033
            
            #add-point:AFTER FIELD pmds033
            {<point name="input.a.pmds033" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds033
            #add-point:BEFORE FIELD pmds033
            {<point name="input.b.pmds033" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds033
            #add-point:ON CHANGE pmds033
            {<point name="input.g.pmds033" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds034
            #add-point:BEFORE FIELD pmds034
            {<point name="input.b.pmds034" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds034
            
            #add-point:AFTER FIELD pmds034
            {<point name="input.a.pmds034" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds034
            #add-point:ON CHANGE pmds034
            {<point name="input.g.pmds034" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds035
            #add-point:BEFORE FIELD pmds035
            {<point name="input.b.pmds035" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds035
            
            #add-point:AFTER FIELD pmds035
            {<point name="input.a.pmds035" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds035
            #add-point:ON CHANGE pmds035
            {<point name="input.g.pmds035" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds036
            #add-point:BEFORE FIELD pmds036
            {<point name="input.b.pmds036" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds036
            
            #add-point:AFTER FIELD pmds036
            {<point name="input.a.pmds036" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds036
            #add-point:ON CHANGE pmds036
            {<point name="input.g.pmds036" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds037
            
            #add-point:AFTER FIELD pmds037
            {<point name="input.a.pmds037" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds037
            #add-point:BEFORE FIELD pmds037
            {<point name="input.b.pmds037" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds037
            #add-point:ON CHANGE pmds037
            {<point name="input.g.pmds037" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds038
            #add-point:BEFORE FIELD pmds038
            {<point name="input.b.pmds038" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds038
            
            #add-point:AFTER FIELD pmds038
            {<point name="input.a.pmds038" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds038
            #add-point:ON CHANGE pmds038
            {<point name="input.g.pmds038" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds039
            
            #add-point:AFTER FIELD pmds039
            {<point name="input.a.pmds039" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds039
            #add-point:BEFORE FIELD pmds039
            {<point name="input.b.pmds039" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds039
            #add-point:ON CHANGE pmds039
            {<point name="input.g.pmds039" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds040
            
            #add-point:AFTER FIELD pmds040
            {<point name="input.a.pmds040" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds040
            #add-point:BEFORE FIELD pmds040
            {<point name="input.b.pmds040" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds040
            #add-point:ON CHANGE pmds040
            {<point name="input.g.pmds040" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds012
            
            #add-point:AFTER FIELD pmds012
            {<point name="input.a.pmds012" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds012
            #add-point:BEFORE FIELD pmds012
            {<point name="input.b.pmds012" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds012
            #add-point:ON CHANGE pmds012
            {<point name="input.g.pmds012" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds101
            #add-point:BEFORE FIELD pmds101
            {<point name="input.b.pmds101" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds101
            
            #add-point:AFTER FIELD pmds101
            {<point name="input.a.pmds101" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds101
            #add-point:ON CHANGE pmds101
            {<point name="input.g.pmds101" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds102
            #add-point:BEFORE FIELD pmds102
            {<point name="input.b.pmds102" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds102
            
            #add-point:AFTER FIELD pmds102
            {<point name="input.a.pmds102" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds102
            #add-point:ON CHANGE pmds102
            {<point name="input.g.pmds102" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds048
            #add-point:BEFORE FIELD pmds048
            {<point name="input.b.pmds048" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds048
            
            #add-point:AFTER FIELD pmds048
            {<point name="input.a.pmds048" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds048
            #add-point:ON CHANGE pmds048
            {<point name="input.g.pmds048" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds047
            #add-point:BEFORE FIELD pmds047
            {<point name="input.b.pmds047" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds047
            
            #add-point:AFTER FIELD pmds047
            {<point name="input.a.pmds047" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds047
            #add-point:ON CHANGE pmds047
            {<point name="input.g.pmds047" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds049
            #add-point:BEFORE FIELD pmds049
            {<point name="input.b.pmds049" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds049
            
            #add-point:AFTER FIELD pmds049
            {<point name="input.a.pmds049" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds049
            #add-point:ON CHANGE pmds049
            {<point name="input.g.pmds049" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds053
            
            #add-point:AFTER FIELD pmds053
            {<point name="input.a.pmds053" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds053
            #add-point:BEFORE FIELD pmds053
            {<point name="input.b.pmds053" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds053
            #add-point:ON CHANGE pmds053
            {<point name="input.g.pmds053" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds041
            #add-point:BEFORE FIELD pmds041
            {<point name="input.b.pmds041" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds041
            
            #add-point:AFTER FIELD pmds041
            {<point name="input.a.pmds041" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds041
            #add-point:ON CHANGE pmds041
            {<point name="input.g.pmds041" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds042
            #add-point:BEFORE FIELD pmds042
            {<point name="input.b.pmds042" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds042
            
            #add-point:AFTER FIELD pmds042
            {<point name="input.a.pmds042" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds042
            #add-point:ON CHANGE pmds042
            {<point name="input.g.pmds042" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds043
            #add-point:BEFORE FIELD pmds043
            {<point name="input.b.pmds043" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds043
            
            #add-point:AFTER FIELD pmds043
            {<point name="input.a.pmds043" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds043
            #add-point:ON CHANGE pmds043
            {<point name="input.g.pmds043" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds044
            #add-point:BEFORE FIELD pmds044
            {<point name="input.b.pmds044" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds044
            
            #add-point:AFTER FIELD pmds044
            {<point name="input.a.pmds044" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds044
            #add-point:ON CHANGE pmds044
            {<point name="input.g.pmds044" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds046
            #add-point:BEFORE FIELD pmds046
            {<point name="input.b.pmds046" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds046
            
            #add-point:AFTER FIELD pmds046
            {<point name="input.a.pmds046" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds046
            #add-point:ON CHANGE pmds046
            {<point name="input.g.pmds046" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds054
            #add-point:BEFORE FIELD pmds054
            {<point name="input.b.pmds054" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds054
            
            #add-point:AFTER FIELD pmds054
            {<point name="input.a.pmds054" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds054
            #add-point:ON CHANGE pmds054
            {<point name="input.g.pmds054" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds055
            #add-point:BEFORE FIELD pmds055
            {<point name="input.b.pmds055" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds055
            
            #add-point:AFTER FIELD pmds055
            {<point name="input.a.pmds055" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds055
            #add-point:ON CHANGE pmds055
            {<point name="input.g.pmds055" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD pmds050
            #add-point:BEFORE FIELD pmds050
            {<point name="input.b.pmds050" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD pmds050
            
            #add-point:AFTER FIELD pmds050
            {<point name="input.a.pmds050" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE pmds050
            #add-point:ON CHANGE pmds050
            {<point name="input.g.pmds050" />}
            #END add-point 
 
 #欄位檢查
                  #Ctrlp:input.c.pmdssite
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdssite
            #add-point:ON ACTION controlp INFIELD pmdssite
            {<point name="input.c.pmdssite" />}
            #END add-point
 
         #Ctrlp:input.c.pmdsdocno
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsdocno
            #add-point:ON ACTION controlp INFIELD pmdsdocno
            {<point name="input.c.pmdsdocno" />}
            #END add-point
 
         #Ctrlp:input.c.pmdsdocdt
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsdocdt
            #add-point:ON ACTION controlp INFIELD pmdsdocdt
            {<point name="input.c.pmdsdocdt" />}
            #END add-point
 
         #Ctrlp:input.c.pmds001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds001
            #add-point:ON ACTION controlp INFIELD pmds001
            {<point name="input.c.pmds001" />}
            #END add-point
 
         #Ctrlp:input.c.pmds002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds002
            #add-point:ON ACTION controlp INFIELD pmds002
            {<point name="input.c.pmds002" />}
            #END add-point
 
         #Ctrlp:input.c.pmds003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds003
            #add-point:ON ACTION controlp INFIELD pmds003
            {<point name="input.c.pmds003" />}
            #END add-point
 
         #Ctrlp:input.c.pmdsstus
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmdsstus
            #add-point:ON ACTION controlp INFIELD pmdsstus
            {<point name="input.c.pmdsstus" />}
            #END add-point
 
         #Ctrlp:input.c.pmds006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds006
            #add-point:ON ACTION controlp INFIELD pmds006
            {<point name="input.c.pmds006" />}
            #END add-point
 
         #Ctrlp:input.c.pmds007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds007
            #add-point:ON ACTION controlp INFIELD pmds007
            {<point name="input.c.pmds007" />}
            #END add-point
 
         #Ctrlp:input.c.pmds008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds008
            #add-point:ON ACTION controlp INFIELD pmds008
            {<point name="input.c.pmds008" />}
            #END add-point
 
         #Ctrlp:input.c.pmds009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds009
            #add-point:ON ACTION controlp INFIELD pmds009
            {<point name="input.c.pmds009" />}
            #END add-point
 
         #Ctrlp:input.c.pmds010
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds010
            #add-point:ON ACTION controlp INFIELD pmds010
            {<point name="input.c.pmds010" />}
            #END add-point
 
         #Ctrlp:input.c.pmds052
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds052
            #add-point:ON ACTION controlp INFIELD pmds052
            {<point name="input.c.pmds052" />}
            #END add-point
 
         #Ctrlp:input.c.pmds000
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds000
            #add-point:ON ACTION controlp INFIELD pmds000
            {<point name="input.c.pmds000" />}
            #END add-point
 
         #Ctrlp:input.c.pmds100
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds100
            #add-point:ON ACTION controlp INFIELD pmds100
            {<point name="input.c.pmds100" />}
            #END add-point
 
         #Ctrlp:input.c.pmds011
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds011
            #add-point:ON ACTION controlp INFIELD pmds011
            {<point name="input.c.pmds011" />}
            #END add-point
 
         #Ctrlp:input.c.pmds014
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds014
            #add-point:ON ACTION controlp INFIELD pmds014
            {<point name="input.c.pmds014" />}
            #END add-point
 
         #Ctrlp:input.c.pmds081
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds081
            #add-point:ON ACTION controlp INFIELD pmds081
            {<point name="input.c.pmds081" />}
            #END add-point
 
         #Ctrlp:input.c.pmds045
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds045
            #add-point:ON ACTION controlp INFIELD pmds045
            {<point name="input.c.pmds045" />}
            #END add-point
 
         #Ctrlp:input.c.pmds021
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds021
            #add-point:ON ACTION controlp INFIELD pmds021
            {<point name="input.c.pmds021" />}
            #END add-point
 
         #Ctrlp:input.c.pmds022
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds022
            #add-point:ON ACTION controlp INFIELD pmds022
            {<point name="input.c.pmds022" />}
            #END add-point
 
         #Ctrlp:input.c.pmds023
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds023
            #add-point:ON ACTION controlp INFIELD pmds023
            {<point name="input.c.pmds023" />}
            #END add-point
 
         #Ctrlp:input.c.pmds024
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds024
            #add-point:ON ACTION controlp INFIELD pmds024
            {<point name="input.c.pmds024" />}
            #END add-point
 
         #Ctrlp:input.c.pmds031
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds031
            #add-point:ON ACTION controlp INFIELD pmds031
            {<point name="input.c.pmds031" />}
            #END add-point
 
         #Ctrlp:input.c.pmds032
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds032
            #add-point:ON ACTION controlp INFIELD pmds032
            {<point name="input.c.pmds032" />}
            #END add-point
 
         #Ctrlp:input.c.pmds033
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds033
            #add-point:ON ACTION controlp INFIELD pmds033
            {<point name="input.c.pmds033" />}
            #END add-point
 
         #Ctrlp:input.c.pmds034
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds034
            #add-point:ON ACTION controlp INFIELD pmds034
            {<point name="input.c.pmds034" />}
            #END add-point
 
         #Ctrlp:input.c.pmds035
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds035
            #add-point:ON ACTION controlp INFIELD pmds035
            {<point name="input.c.pmds035" />}
            #END add-point
 
         #Ctrlp:input.c.pmds036
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds036
            #add-point:ON ACTION controlp INFIELD pmds036
            {<point name="input.c.pmds036" />}
            #END add-point
 
         #Ctrlp:input.c.pmds037
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds037
            #add-point:ON ACTION controlp INFIELD pmds037
            {<point name="input.c.pmds037" />}
            #END add-point
 
         #Ctrlp:input.c.pmds038
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds038
            #add-point:ON ACTION controlp INFIELD pmds038
            {<point name="input.c.pmds038" />}
            #END add-point
 
         #Ctrlp:input.c.pmds039
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds039
            #add-point:ON ACTION controlp INFIELD pmds039
            {<point name="input.c.pmds039" />}
            #END add-point
 
         #Ctrlp:input.c.pmds040
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds040
            #add-point:ON ACTION controlp INFIELD pmds040
            {<point name="input.c.pmds040" />}
            #END add-point
 
         #Ctrlp:input.c.pmds012
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds012
            #add-point:ON ACTION controlp INFIELD pmds012
            {<point name="input.c.pmds012" />}
            #END add-point
 
         #Ctrlp:input.c.pmds101
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds101
            #add-point:ON ACTION controlp INFIELD pmds101
            {<point name="input.c.pmds101" />}
            #END add-point
 
         #Ctrlp:input.c.pmds102
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds102
            #add-point:ON ACTION controlp INFIELD pmds102
            {<point name="input.c.pmds102" />}
            #END add-point
 
         #Ctrlp:input.c.pmds048
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds048
            #add-point:ON ACTION controlp INFIELD pmds048
            {<point name="input.c.pmds048" />}
            #END add-point
 
         #Ctrlp:input.c.pmds047
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds047
            #add-point:ON ACTION controlp INFIELD pmds047
            {<point name="input.c.pmds047" />}
            #END add-point
 
         #Ctrlp:input.c.pmds049
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds049
            #add-point:ON ACTION controlp INFIELD pmds049
            {<point name="input.c.pmds049" />}
            #END add-point
 
         #Ctrlp:input.c.pmds053
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds053
            #add-point:ON ACTION controlp INFIELD pmds053
            {<point name="input.c.pmds053" />}
            #END add-point
 
         #Ctrlp:input.c.pmds041
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds041
            #add-point:ON ACTION controlp INFIELD pmds041
            {<point name="input.c.pmds041" />}
            #END add-point
 
         #Ctrlp:input.c.pmds042
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds042
            #add-point:ON ACTION controlp INFIELD pmds042
            {<point name="input.c.pmds042" />}
            #END add-point
 
         #Ctrlp:input.c.pmds043
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds043
            #add-point:ON ACTION controlp INFIELD pmds043
            {<point name="input.c.pmds043" />}
            #END add-point
 
         #Ctrlp:input.c.pmds044
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds044
            #add-point:ON ACTION controlp INFIELD pmds044
            {<point name="input.c.pmds044" />}
            #END add-point
 
         #Ctrlp:input.c.pmds046
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds046
            #add-point:ON ACTION controlp INFIELD pmds046
            {<point name="input.c.pmds046" />}
            #END add-point
 
         #Ctrlp:input.c.pmds054
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds054
            #add-point:ON ACTION controlp INFIELD pmds054
            {<point name="input.c.pmds054" />}
            #END add-point
 
         #Ctrlp:input.c.pmds055
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds055
            #add-point:ON ACTION controlp INFIELD pmds055
            {<point name="input.c.pmds055" />}
            #END add-point
 
         #Ctrlp:input.c.pmds050
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD pmds050
            #add-point:ON ACTION controlp INFIELD pmds050
            {<point name="input.c.pmds050" />}
            #END add-point
 
 #欄位開窗
            
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
 
            #CALL cl_err_collect_show()      #錯誤訊息統整顯示
            #CALL cl_showmsg()
            DISPLAY BY NAME g_pmds_m.pmdsdocno
                        
            #add-point:單頭INPUT後
            {<point name="input.head.after_input"/>}
            #end add-point
                        
            IF p_cmd <> 'u' THEN
    
               CALL s_transaction_begin()
               
               #add-point:單頭新增前
               {<point name="input.head.b_insert" mark="Y"/>}
               #end add-point
               
               INSERT INTO pmds_t (pmdsent,pmdssite,pmdsdocno,pmdsdocdt,pmds001,pmds002,pmds003,pmdsstus, 
                   pmds006,pmds007,pmds008,pmds009,pmds010,pmds052,pmds000,pmds100,pmds011,pmds014,pmds081, 
                   pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033,pmds034,pmds035,pmds036, 
                   pmds037,pmds038,pmds039,pmds040,pmds012,pmds101,pmds102,pmds048,pmds047,pmds049,pmds053, 
                   pmds041,pmds042,pmds043,pmds044,pmds046,pmds054,pmds055,pmds050,pmdsownid,pmdsowndp, 
                   pmdscrtid,pmdscrtdp,pmdscrtdt,pmdsmodid,pmdsmoddt,pmdscnfid,pmdscnfdt,pmdspstid,pmdspstdt) 

               VALUES (g_enterprise,g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001, 
                   g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007, 
                   g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
                   g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045, 
                   g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031, 
                   g_pmds_m.pmds032,g_pmds_m.pmds033,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036, 
                   g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds040,g_pmds_m.pmds012, 
                   g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049, 
                   g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
                   g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid, 
                   g_pmds_m.pmdsowndp,g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid, 
                   g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt)  

               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "g_pmds_m" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CALL s_transaction_end('N','0')
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭新增中
               {<point name="input.head.m_insert"/>}
               #end add-point
               
               
               
               
               #add-point:單頭新增後
               {<point name="input.head.a_insert"/>}
               #end add-point
               CALL s_transaction_end('Y','0') 
               
               IF l_cmd_t = 'r' AND p_cmd = 'a' THEN
                  CALL apmt520_detail_reproduce()
                  #因應特定程式需求, 重新刷新單身資料
                  CALL apmt520_b_fill()
                  CALL apmt520_b_fill2('0')
               END IF
               
               #add-point:單頭新增後
               {<point name="input.head.a_insert2"/>}
               #end add-point
               
               LET g_master_insert = TRUE
               
               LET p_cmd = 'u'
            ELSE
               CALL s_transaction_begin()
            
               #add-point:單頭修改前
               {<point name="input.head.b_update" mark="Y"/>}
               #end add-point
               
               #將遮罩欄位還原
               CALL apmt520_pmds_t_mask_restore('restore_mask_o')
               
               UPDATE pmds_t SET (pmdssite,pmdsdocno,pmdsdocdt,pmds001,pmds002,pmds003,pmdsstus,pmds006, 
                   pmds007,pmds008,pmds009,pmds010,pmds052,pmds000,pmds100,pmds011,pmds014,pmds081,pmds045, 
                   pmds021,pmds022,pmds023,pmds024,pmds031,pmds032,pmds033,pmds034,pmds035,pmds036,pmds037, 
                   pmds038,pmds039,pmds040,pmds012,pmds101,pmds102,pmds048,pmds047,pmds049,pmds053,pmds041, 
                   pmds042,pmds043,pmds044,pmds046,pmds054,pmds055,pmds050,pmdsownid,pmdsowndp,pmdscrtid, 
                   pmdscrtdp,pmdscrtdt,pmdsmodid,pmdsmoddt,pmdscnfid,pmdscnfdt,pmdspstid,pmdspstdt) = (g_pmds_m.pmdssite, 
                   g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003, 
                   g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009, 
                   g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011, 
                   g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022, 
                   g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
                   g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038, 
                   g_pmds_m.pmds039,g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102, 
                   g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041, 
                   g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054, 
                   g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp,g_pmds_m.pmdscrtid, 
                   g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid, 
                   g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt)
                WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmdsdocno_t
 
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "pmds_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CALL s_transaction_end('N','0')
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭修改中
               {<point name="input.head.m_update"/>}
               #end add-point
               
               
               
               
               #將遮罩欄位進行遮蔽
               CALL apmt520_pmds_t_mask_restore('restore_mask_n')
               
               #修改歷程記錄(單頭修改)
               LET g_log1 = util.JSON.stringify(g_pmds_m_t)
               LET g_log2 = util.JSON.stringify(g_pmds_m)
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
               
               #add-point:單頭修改後
               {<point name="input.head.a_update"/>}
               #end add-point
            END IF
            
            LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
            
      END INPUT
   
]]>
  </section>
  <section id="apmt520.input.other" ver="12" status="" src="s" readonly="">
    <![CDATA[      
      #add-point:自定義input
      {<point name="input.more_input"/>}
      #end add-point
    
      BEFORE DIALOG 
         #CALL cl_err_collect_init()    
         #add-point:input段before dialog
         {<point name="input.before_dialog"/>}
         #end add-point    
         #重新導回資料到正確位置上
         CALL DIALOG.setCurrentRow("s_detail1",g_detail_idx)      
         CALL DIALOG.setCurrentRow("s_detail2",g_detail_idx)
         CALL DIALOG.setCurrentRow("s_detail3",g_detail_idx)
 
         #新增時強制從單頭開始填
         IF p_cmd = 'a' THEN
            #add-point:input段next_field
            {<point name="input.next_field"/>}
            #end add-point  
            NEXT FIELD pmdsdocno
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD pmdtsite
               WHEN "s_detail2"
                  NEXT FIELD pmdusite
               WHEN "s_detail3"
                  NEXT FIELD pmdvsite
 
               #add-point:input段modify_detail 
               {<point name="input.modify_detail.other"/>}
               #end add-point  
            END CASE
         END IF
      
      AFTER DIALOG
         #add-point:input段after_dialog
         {<point name="input.after_dialog"/>}
         #end add-point    
         
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         IF g_header_hidden THEN
            CALL gfrm_curr.setElementHidden("vb_master",0)
            CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
            LET g_header_hidden = 0     #visible
         ELSE
            CALL gfrm_curr.setElementHidden("vb_master",1)
            CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
            LET g_header_hidden = 1     #hidden     
         END IF
 
      ON ACTION accept
         #add-point:input段accept 
         {<point name="input.accept"/>}
         #end add-point    
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         #add-point:input段cancel
         {<point name="input.cancel"/>}
         #end add-point  
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         #add-point:input段close
         {<point name="input.close"/>}
         #end add-point  
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         #add-point:input段exit
         {<point name="input.exit"/>}
         #end add-point
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
    
   #add-point:input段after input 
   {<point name="input.after_input"/>}
   #end add-point    
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.insert" ver="44" status="" src="s" readonly="">
    <![CDATA[#+ 資料新增
PRIVATE FUNCTION apmt520_insert()
   #add-point:insert段define
   {<point name="insert.define" edit="s"/>}
   #end add-point    
   #add-point:insert段define(客製用)
   {<point name="insert.define_customerization" edit="c"/>}
   #end add-point    
   
   #清畫面欄位內容
   CLEAR FORM                    
   CALL g_pmdt_d.clear()   
   CALL g_pmdt2_d.clear()  
   CALL g_pmdt3_d.clear()  
 
 
   INITIALIZE g_pmds_m.* LIKE pmds_t.*             #DEFAULT 設定
   
   LET g_pmdsdocno_t = NULL
 
   
   LET g_master_insert = FALSE
   
   #add-point:insert段before
   {<point name="insert.before"/>}
   #end add-point    
   
   CALL s_transaction_begin()
   WHILE TRUE
      #公用欄位給值(單頭)
      #應用 a14 樣板自動產生(Version:4)    
      #公用欄位新增給值  
      LET g_pmds_m.pmdsownid = g_user
      LET g_pmds_m.pmdsowndp = g_dept
      LET g_pmds_m.pmdscrtid = g_user
      LET g_pmds_m.pmdscrtdp = g_dept 
      LET g_pmds_m.pmdscrtdt = cl_get_current()
      LET g_pmds_m.pmdsmodid = g_user
      LET g_pmds_m.pmdsmoddt = cl_get_current()
      LET g_pmds_m.pmdsstus = 'N'
 
 
 
      #append欄位給值
      
     
      #一般欄位給值
            LET g_pmds_m.pmds100 = "3"
      LET g_pmds_m.pmds011 = "1"
      LET g_pmds_m.pmds014 = "1"
      LET g_pmds_m.pmds021 = "N"
      LET g_pmds_m.pmds036 = "1"
      LET g_pmds_m.pmds048 = "1"
      LET g_pmds_m.pmds047 = "N"
      LET g_pmds_m.pmds049 = "1"
      LET g_pmds_m.pmds043 = "0"
      LET g_pmds_m.pmds044 = "0"
      LET g_pmds_m.pmds046 = "0"
      LET g_pmds_m.pmds054 = "1"
      LET g_pmds_m.pmds050 = "N"
 
  
      #add-point:單頭預設值
      {<point name="insert.default"/>}
      #end add-point 
      
      #保存單頭舊值(用於資料輸入錯誤還原預設值時使用)
      LET g_pmds_m_t.* = g_pmds_m.*
      LET g_pmds_m_o.* = g_pmds_m.*
      
      #顯示狀態(stus)圖片
            #應用 a21 樣板自動產生(Version:2)
	  #根據當下狀態碼顯示圖片
      CASE g_pmds_m.pmdsstus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "S"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/posted.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
    
      CALL apmt520_input("a")
      
      #add-point:單頭輸入後
      {<point name="insert.after_insert"/>}
      #end add-point
      
      IF INT_FLAG THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code   = 9001 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')
         LET INT_FLAG = 0
      END IF
      
      IF NOT g_master_insert THEN
         DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
         DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
         INITIALIZE g_pmds_m.* TO NULL
         INITIALIZE g_pmdt_d TO NULL
         INITIALIZE g_pmdt2_d TO NULL
         INITIALIZE g_pmdt3_d TO NULL
 
         #add-point:取消新增後
         {<point name="insert.cancel"/>}
         #end add-point 
         CALL apmt520_show()
         RETURN
      END IF
      
      LET INT_FLAG = 0
      #CALL g_pmdt_d.clear()
      #CALL g_pmdt2_d.clear()
      #CALL g_pmdt3_d.clear()
 
 
      LET g_rec_b = 0
      CALL s_transaction_end('Y','0')
      EXIT WHILE
        
   END WHILE
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL apmt520_set_act_visible()   
   CALL apmt520_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
   
   #組合新增資料的條件
   LET g_add_browse = " pmdsent = '" ||g_enterprise|| "' AND",
                      " pmdsdocno = '", g_pmds_m.pmdsdocno, "' "
 
                      
   #add-point:組合新增資料的條件後
   {<point name="insert.after.add_browse"/>}
   #end add-point
      
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL apmt520_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   CLOSE apmt520_cl
   
   CALL apmt520_idx_chk()
   
   #撈取異動後的資料(主要是帶出reference)
   EXECUTE apmt520_master_referesh USING g_pmds_m.pmdsdocno INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
       g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
       g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
       g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
       g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
       g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
       g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
       g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
       g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt,g_pmds_m.pmds002_desc, 
       g_pmds_m.pmds003_desc,g_pmds_m.pmds007_desc,g_pmds_m.pmds008_desc,g_pmds_m.pmds009_desc,g_pmds_m.pmds031_desc, 
       g_pmds_m.pmds032_desc,g_pmds_m.pmds037_desc,g_pmds_m.pmds039_desc,g_pmds_m.pmds040_desc,g_pmds_m.pmds012_desc, 
       g_pmds_m.pmds053_desc,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid_desc, 
       g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdspstid_desc 

   
   #遮罩相關處理
   LET g_pmds_m_mask_o.* =  g_pmds_m.*
   CALL apmt520_pmds_t_mask()
   LET g_pmds_m_mask_n.* =  g_pmds_m.*
   
   #將資料顯示到畫面上
   DISPLAY BY NAME g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocno_desc,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001, 
       g_pmds_m.pmds002,g_pmds_m.pmds002_desc,g_pmds_m.pmds003,g_pmds_m.pmds003_desc,g_pmds_m.pmdsstus, 
       g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds007_desc,g_pmds_m.pmds008,g_pmds_m.pmds008_desc, 
       g_pmds_m.pmds009,g_pmds_m.pmds009_desc,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000,g_pmds_m.pmds100, 
       g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022, 
       g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds031_desc,g_pmds_m.pmds032,g_pmds_m.pmds032_desc, 
       g_pmds_m.pmds033,g_pmds_m.pmds033_desc,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037, 
       g_pmds_m.pmds037_desc,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds039_desc,g_pmds_m.pmds040, 
       g_pmds_m.pmds040_desc,g_pmds_m.pmds012,g_pmds_m.pmds012_desc,g_pmds_m.pmds101,g_pmds_m.pmds102, 
       g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds053_desc,g_pmds_m.pmds041, 
       g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055, 
       g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp,g_pmds_m.pmdsowndp_desc, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtid_desc,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdscrtdt, 
       g_pmds_m.pmdsmodid,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfid_desc, 
       g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstid_desc,g_pmds_m.pmdspstdt
   
   #add-point:新增結束後
   {<point name="insert.after"/>}
   #end add-point 
   
   #功能已完成,通報訊息中心
   CALL apmt520_msgcentre_notify('insert')
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.insert_b" ver="34" status="" src="s" readonly="">
    <![CDATA[#+ 新增單身後其他table連動
PRIVATE FUNCTION apmt520_insert_b(ps_table,ps_keys,ps_page)
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys     DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE ls_page     STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:insert_b段define
   {<point name="insert_b.define" edit="s"/>}
   #end add-point     
   #add-point:insert_b段define(客製用)
   {<point name="insert_b.define_customerization" edit="c"/>}
   #end add-point     
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前
      {<point name="insert_b.before_insert" mark="Y"/>}
      #end add-point 
      INSERT INTO pmdt_t
                  (pmdtent,
                   pmdtdocno,
                   pmdtseq
                   ,pmdtsite,pmdt027,pmdt028,pmdt001,pmdt002,pmdt003,pmdt004,pmdt081,pmdt082,pmdt083,pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021,pmdt022,pmdt008,pmdt023,pmdt024,pmdt090,pmdt091,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047,pmdt092,pmdt093,pmdt026,pmdt041,pmdt062,pmdt016,pmdt017,pmdt018,pmdt063,pmdt072,pmdt073,pmdt074,pmdt040,pmdt052,pmdt051,pmdt070,pmdt071,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061,pmdt042,pmdt043,pmdt048,pmdt044,pmdt045,pmdt084,pmdt089,pmdt088) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2]
                   ,g_pmdt_d[g_detail_idx].pmdtsite,g_pmdt_d[g_detail_idx].pmdt027,g_pmdt_d[g_detail_idx].pmdt028, 
                       g_pmdt_d[g_detail_idx].pmdt001,g_pmdt_d[g_detail_idx].pmdt002,g_pmdt_d[g_detail_idx].pmdt003, 
                       g_pmdt_d[g_detail_idx].pmdt004,g_pmdt_d[g_detail_idx].pmdt081,g_pmdt_d[g_detail_idx].pmdt082, 
                       g_pmdt_d[g_detail_idx].pmdt083,g_pmdt_d[g_detail_idx].pmdt005,g_pmdt_d[g_detail_idx].pmdt006, 
                       g_pmdt_d[g_detail_idx].pmdt007,g_pmdt_d[g_detail_idx].pmdt009,g_pmdt_d[g_detail_idx].pmdt010, 
                       g_pmdt_d[g_detail_idx].pmdt025,g_pmdt_d[g_detail_idx].pmdt011,g_pmdt_d[g_detail_idx].pmdt019, 
                       g_pmdt_d[g_detail_idx].pmdt020,g_pmdt_d[g_detail_idx].pmdt021,g_pmdt_d[g_detail_idx].pmdt022, 
                       g_pmdt_d[g_detail_idx].pmdt008,g_pmdt_d[g_detail_idx].pmdt023,g_pmdt_d[g_detail_idx].pmdt024, 
                       g_pmdt_d[g_detail_idx].pmdt090,g_pmdt_d[g_detail_idx].pmdt091,g_pmdt_d[g_detail_idx].pmdt036, 
                       g_pmdt_d[g_detail_idx].pmdt046,g_pmdt_d[g_detail_idx].pmdt037,g_pmdt_d[g_detail_idx].pmdt038, 
                       g_pmdt_d[g_detail_idx].pmdt039,g_pmdt_d[g_detail_idx].pmdt047,g_pmdt_d[g_detail_idx].pmdt092, 
                       g_pmdt_d[g_detail_idx].pmdt093,g_pmdt_d[g_detail_idx].pmdt026,g_pmdt_d[g_detail_idx].pmdt041, 
                       g_pmdt_d[g_detail_idx].pmdt062,g_pmdt_d[g_detail_idx].pmdt016,g_pmdt_d[g_detail_idx].pmdt017, 
                       g_pmdt_d[g_detail_idx].pmdt018,g_pmdt_d[g_detail_idx].pmdt063,g_pmdt_d[g_detail_idx].pmdt072, 
                       g_pmdt_d[g_detail_idx].pmdt073,g_pmdt_d[g_detail_idx].pmdt074,g_pmdt_d[g_detail_idx].pmdt040, 
                       g_pmdt_d[g_detail_idx].pmdt052,g_pmdt_d[g_detail_idx].pmdt051,g_pmdt_d[g_detail_idx].pmdt070, 
                       g_pmdt_d[g_detail_idx].pmdt071,g_pmdt_d[g_detail_idx].pmdt059,g_pmdt_d[g_detail_idx].pmdt053, 
                       g_pmdt_d[g_detail_idx].pmdt054,g_pmdt_d[g_detail_idx].pmdt055,g_pmdt_d[g_detail_idx].pmdt060, 
                       g_pmdt_d[g_detail_idx].pmdt061,g_pmdt_d[g_detail_idx].pmdt042,g_pmdt_d[g_detail_idx].pmdt043, 
                       g_pmdt_d[g_detail_idx].pmdt048,g_pmdt_d[g_detail_idx].pmdt044,g_pmdt_d[g_detail_idx].pmdt045, 
                       g_pmdt_d[g_detail_idx].pmdt084,g_pmdt_d[g_detail_idx].pmdt089,g_pmdt_d[g_detail_idx].pmdt088) 

      #add-point:insert_b段資料新增中
      {<point name="insert_b.m_insert"/>}
      #end add-point 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdt_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_pmdt_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後
      {<point name="insert_b.after_insert"/>}
      #end add-point 
   END IF
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前
      {<point name="insert_b.before_insert2" mark="Y"/>}
      #end add-point 
      INSERT INTO pmdu_t
                  (pmduent,
                   pmdudocno,
                   pmduseq,pmduseq1
                   ,pmdusite,pmdu001,pmdu002,pmdu003,pmdu004,pmdu006,pmdu007,pmdu008,pmdu005,pmdu009,pmdu010,pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,pmdu017,pmdu016) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_pmdt2_d[g_detail_idx].pmdusite,g_pmdt2_d[g_detail_idx].pmdu001,g_pmdt2_d[g_detail_idx].pmdu002, 
                       g_pmdt2_d[g_detail_idx].pmdu003,g_pmdt2_d[g_detail_idx].pmdu004,g_pmdt2_d[g_detail_idx].pmdu006, 
                       g_pmdt2_d[g_detail_idx].pmdu007,g_pmdt2_d[g_detail_idx].pmdu008,g_pmdt2_d[g_detail_idx].pmdu005, 
                       g_pmdt2_d[g_detail_idx].pmdu009,g_pmdt2_d[g_detail_idx].pmdu010,g_pmdt2_d[g_detail_idx].pmdu011, 
                       g_pmdt2_d[g_detail_idx].pmdu012,g_pmdt2_d[g_detail_idx].pmdu013,g_pmdt2_d[g_detail_idx].pmdu014, 
                       g_pmdt2_d[g_detail_idx].pmdu015,g_pmdt2_d[g_detail_idx].pmdu017,g_pmdt2_d[g_detail_idx].pmdu016) 

      #add-point:insert_b段資料新增中
      {<point name="insert_b.m_insert2"/>}
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdu_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'2'" THEN 
         CALL g_pmdt2_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後
      {<point name="insert_b.after_insert2"/>}
      #end add-point
   END IF
 
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前
      {<point name="insert_b.before_insert3" mark="Y"/>}
      #end add-point 
      INSERT INTO pmdv_t
                  (pmdvent,
                   pmdvdocno,
                   pmdvseq,pmdvseq1
                   ,pmdvsite,pmdv005,pmdv001,pmdv002,pmdv003,pmdv004,pmdv014,pmdv015,pmdv016,pmdv017,pmdv018,pmdv019) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_pmdt3_d[g_detail_idx].pmdvsite,g_pmdt3_d[g_detail_idx].pmdv005,g_pmdt3_d[g_detail_idx].pmdv001, 
                       g_pmdt3_d[g_detail_idx].pmdv002,g_pmdt3_d[g_detail_idx].pmdv003,g_pmdt3_d[g_detail_idx].pmdv004, 
                       g_pmdt3_d[g_detail_idx].pmdv014,g_pmdt3_d[g_detail_idx].pmdv015,g_pmdt3_d[g_detail_idx].pmdv016, 
                       g_pmdt3_d[g_detail_idx].pmdv017,g_pmdt3_d[g_detail_idx].pmdv018,g_pmdt3_d[g_detail_idx].pmdv019) 

      #add-point:insert_b段資料新增中
      {<point name="insert_b.m_insert3"/>}
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "pmdv_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'3'" THEN 
         CALL g_pmdt3_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後
      {<point name="insert_b.after_insert3"/>}
      #end add-point
   END IF
 
 
   
 
   
   #add-point:insert_b段other
   {<point name="insert_b.other"/>}
   #end add-point     
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.key_delete_b" ver="4" status="" src="s" readonly="">
    <![CDATA[#+ 上層單身刪除後, 連帶刪除下層單身key欄位
PRIVATE FUNCTION apmt520_key_delete_b(ps_keys_bak,ps_table)
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table    STRING
   #add-point:delete_b段define
   {<point name="key_delete_b.define" edit="s"/>}
   #end add-point
   #add-point:delete_b段define(客製用)
   {<point name="key_delete_b.define_customerization" edit="c"/>}
   #end add-point
   
 
   
   RETURN TRUE
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.key_update_b" ver="3" status="" src="s" readonly="">
    <![CDATA[#+ 上層單身key欄位變動後, 連帶修正下層單身key欄位
PRIVATE FUNCTION apmt520_key_update_b(ps_keys_bak,ps_table)
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table    STRING
   #add-point:update_b段define
   {<point name="key_update_b.define" edit="s"/>}
   #end add-point
   #add-point:update_b段define(客製用)
   {<point name="key_update_b.define_customerization" edit="c"/>}
   #end add-point
   
 
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.lock_b" ver="8" status="" src="s" readonly="">
    <![CDATA[#+ 連動lock其他單身table資料
PRIVATE FUNCTION apmt520_lock_b(ps_table,ps_page)
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:lock_b段define
   {<point name="lock_b.define" edit="s"/>}
   #end add-point   
   #add-point:lock_b段define(客製用)
   {<point name="lock_b.define_customerization" edit="c"/>}
   #end add-point   
    
   #先刷新資料
   #CALL apmt520_b_fill()
   
   #鎖定整組table
   #LET ls_group = "'1',"
   #僅鎖定自身table
   LET ls_group = "pmdt_t"
   
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN apmt520_bcl USING g_enterprise,
                                       g_pmds_m.pmdsdocno,g_pmdt_d[g_detail_idx].pmdtseq     
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "apmt520_bcl" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
                                    
   #鎖定整組table
   #LET ls_group = "'2',"
   #僅鎖定自身table
   LET ls_group = "pmdu_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN apmt520_bcl2 USING g_enterprise,
                                             g_pmds_m.pmdsdocno,g_pmdt2_d[g_detail_idx].pmduseq,g_pmdt2_d[g_detail_idx].pmduseq1 

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "apmt520_bcl2" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
   #鎖定整組table
   #LET ls_group = "'3',"
   #僅鎖定自身table
   LET ls_group = "pmdv_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN apmt520_bcl3 USING g_enterprise,
                                             g_pmds_m.pmdsdocno,g_pmdt3_d[g_detail_idx].pmdvseq,g_pmdt3_d[g_detail_idx].pmdvseq1 

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "apmt520_bcl3" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
 
   
 
   
   #add-point:lock_b段other
   {<point name="lock_b.other"/>}
   #end add-point  
   
   RETURN TRUE
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.main" ver="48" status="" src="s" readonly="">
    <![CDATA[#應用 a26 樣板自動產生(Version:4)
#+ 作業開始(主程式類型)
MAIN
   #add-point:main段define
   {<point name="main.define" edit="s"/>}
   #end add-point   
   #add-point:main段define(客製用)
   {<point name="main.define_customerization" edit="c"/>}
   #end add-point   
 
   OPTIONS
   INPUT NO WRAP
   DEFER INTERRUPT
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
       
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("apm","")
 
   #add-point:作業初始化
   {<point name="main.init" />}
   #end add-point
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define
   {<point name="main.define_sql" />}
   #end add-point
   LET g_forupd_sql = " SELECT pmdssite,pmdsdocno,'',pmdsdocdt,pmds001,pmds002,'',pmds003,'',pmdsstus, 
       pmds006,pmds007,'',pmds008,'',pmds009,'',pmds010,pmds052,pmds000,pmds100,pmds011,pmds014,pmds081, 
       pmds045,pmds021,pmds022,pmds023,pmds024,pmds031,'',pmds032,'',pmds033,'',pmds034,pmds035,pmds036, 
       pmds037,'',pmds038,pmds039,'',pmds040,'',pmds012,'',pmds101,pmds102,pmds048,pmds047,pmds049,pmds053, 
       '',pmds041,pmds042,pmds043,pmds044,pmds046,pmds054,pmds055,pmds050,pmdsownid,'',pmdsowndp,'', 
       pmdscrtid,'',pmdscrtdp,'',pmdscrtdt,pmdsmodid,'',pmdsmoddt,pmdscnfid,'',pmdscnfdt,pmdspstid,'', 
       pmdspstdt", 
                      " FROM pmds_t",
                      " WHERE pmdsent= ? AND pmdsdocno=? FOR UPDATE"
   #add-point:SQL_define
   {<point name="main.after_define_sql"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)                #轉換不同資料庫語法
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE apmt520_cl CURSOR FROM g_forupd_sql                 # LOCK CURSOR
 
   LET g_sql = " SELECT UNIQUE t0.pmdssite,t0.pmdsdocno,t0.pmdsdocdt,t0.pmds001,t0.pmds002,t0.pmds003, 
       t0.pmdsstus,t0.pmds006,t0.pmds007,t0.pmds008,t0.pmds009,t0.pmds010,t0.pmds052,t0.pmds000,t0.pmds100, 
       t0.pmds011,t0.pmds014,t0.pmds081,t0.pmds045,t0.pmds021,t0.pmds022,t0.pmds023,t0.pmds024,t0.pmds031, 
       t0.pmds032,t0.pmds033,t0.pmds034,t0.pmds035,t0.pmds036,t0.pmds037,t0.pmds038,t0.pmds039,t0.pmds040, 
       t0.pmds012,t0.pmds101,t0.pmds102,t0.pmds048,t0.pmds047,t0.pmds049,t0.pmds053,t0.pmds041,t0.pmds042, 
       t0.pmds043,t0.pmds044,t0.pmds046,t0.pmds054,t0.pmds055,t0.pmds050,t0.pmdsownid,t0.pmdsowndp,t0.pmdscrtid, 
       t0.pmdscrtdp,t0.pmdscrtdt,t0.pmdsmodid,t0.pmdsmoddt,t0.pmdscnfid,t0.pmdscnfdt,t0.pmdspstid,t0.pmdspstdt, 
       t1.ooag011 ,t2.ooefl003 ,t3.pmaal004 ,t4.pmaal004 ,t5.pmaal004 ,t6.ooibl004 ,t7.oocql004 ,t8.ooail003 , 
       t9.pmaml003 ,t10.ooidl003 ,t11.oocql004 ,t12.icaal003 ,t13.ooag011 ,t14.ooefl003 ,t15.ooag011 , 
       t16.ooefl003 ,t17.ooag011 ,t18.ooag011 ,t19.ooag011",
               " FROM pmds_t t0",
                              " LEFT JOIN ooag_t t1 ON t1.ooagent='"||g_enterprise||"' AND t1.ooag001=t0.pmds002  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent='"||g_enterprise||"' AND t2.ooefl001=t0.pmds003 AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t3 ON t3.pmaalent='"||g_enterprise||"' AND t3.pmaal001=t0.pmds007 AND t3.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t4 ON t4.pmaalent='"||g_enterprise||"' AND t4.pmaal001=t0.pmds008 AND t4.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t5 ON t5.pmaalent='"||g_enterprise||"' AND t5.pmaal001=t0.pmds009 AND t5.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN ooibl_t t6 ON t6.ooiblent='"||g_enterprise||"' AND t6.ooibl002=t0.pmds031 AND t6.ooibl003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t7 ON t7.oocqlent='"||g_enterprise||"' AND t7.oocql001='238' AND t7.oocql002=t0.pmds032 AND t7.oocql003='"||g_dlang||"' ",
               " LEFT JOIN ooail_t t8 ON t8.ooailent='"||g_enterprise||"' AND t8.ooail001=t0.pmds037 AND t8.ooail002='"||g_dlang||"' ",
               " LEFT JOIN pmaml_t t9 ON t9.pmamlent='"||g_enterprise||"' AND t9.pmaml001=t0.pmds039 AND t9.pmaml002='"||g_dlang||"' ",
               " LEFT JOIN ooidl_t t10 ON t10.ooidlent='"||g_enterprise||"' AND t10.ooidl001=t0.pmds040 AND t10.ooidl002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t11 ON t11.oocqlent='"||g_enterprise||"' AND t11.oocql001='275' AND t11.oocql002=t0.pmds012 AND t11.oocql003='"||g_dlang||"' ",
               " LEFT JOIN icaal_t t12 ON t12.icaalent='"||g_enterprise||"' AND t12.icaal001=t0.pmds053 AND t12.icaal002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t13 ON t13.ooagent='"||g_enterprise||"' AND t13.ooag001=t0.pmdsownid  ",
               " LEFT JOIN ooefl_t t14 ON t14.ooeflent='"||g_enterprise||"' AND t14.ooefl001=t0.pmdsowndp AND t14.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t15 ON t15.ooagent='"||g_enterprise||"' AND t15.ooag001=t0.pmdscrtid  ",
               " LEFT JOIN ooefl_t t16 ON t16.ooeflent='"||g_enterprise||"' AND t16.ooefl001=t0.pmdscrtdp AND t16.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t17 ON t17.ooagent='"||g_enterprise||"' AND t17.ooag001=t0.pmdsmodid  ",
               " LEFT JOIN ooag_t t18 ON t18.ooagent='"||g_enterprise||"' AND t18.ooag001=t0.pmdscnfid  ",
               " LEFT JOIN ooag_t t19 ON t19.ooagent='"||g_enterprise||"' AND t19.ooag001=t0.pmdspstid  ",
 
               " WHERE t0.pmdsent = '" ||g_enterprise|| "' AND t0.pmdsdocno = ?"
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   #add-point:SQL_define
   {<point name="main.after_refresh_sql"/>}
   #end add-point
   PREPARE apmt520_master_referesh FROM g_sql
 
    
 
   
   IF g_bgjob = "Y" THEN
      #add-point:Service Call
      {<point name="main.servicecall" />}
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_apmt520 WITH FORM cl_ap_formpath("apm",g_code)
   
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
   
      #程式初始化
      CALL apmt520_init()   
 
      #進入選單 Menu (="N")
      CALL apmt520_ui_dialog() 
      
      #add-point:畫面關閉前
      {<point name="main.before_close" />}
      #end add-point
 
      #畫面關閉
      CLOSE WINDOW w_apmt520
      
   END IF 
   
   CLOSE apmt520_cl
   
   
 
   #add-point:作業離開前
   {<point name="main.exit" />}
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
END MAIN
 
 
]]>
  </section>
  <section id="apmt520.mask_functions" ver="1" status="" src="s" readonly="">
    <![CDATA[&include "erp/apm/apmt520_mask.4gl"
]]>
  </section>
  <section id="apmt520.modify" ver="50" status="" src="s" readonly="">
    <![CDATA[#+ 資料修改
PRIVATE FUNCTION apmt520_modify()
   DEFINE l_new_key    DYNAMIC ARRAY OF STRING
   DEFINE l_old_key    DYNAMIC ARRAY OF STRING
   DEFINE l_field_key  DYNAMIC ARRAY OF STRING
   DEFINE l_wc2_table1          STRING
   DEFINE l_wc2_table2   STRING
 
   DEFINE l_wc2_table3   STRING
 
 
 
   #add-point:modify段define
   {<point name="modify.define" edit="s"/>}
   #end add-point    
   #add-point:modify段define(客製用)
   {<point name="modify.define_customerization" edit="c"/>}
   #end add-point    
   
   #保存單頭舊值
   LET g_pmds_m_t.* = g_pmds_m.*
   LET g_pmds_m_o.* = g_pmds_m.*
   
   IF g_pmds_m.pmdsdocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   ERROR ""
  
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
   CALL s_transaction_begin()
   
   OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN apmt520_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      CLOSE apmt520_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE apmt520_master_referesh USING g_pmds_m.pmdsdocno INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
       g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
       g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
       g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
       g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
       g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
       g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
       g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
       g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt,g_pmds_m.pmds002_desc, 
       g_pmds_m.pmds003_desc,g_pmds_m.pmds007_desc,g_pmds_m.pmds008_desc,g_pmds_m.pmds009_desc,g_pmds_m.pmds031_desc, 
       g_pmds_m.pmds032_desc,g_pmds_m.pmds037_desc,g_pmds_m.pmds039_desc,g_pmds_m.pmds040_desc,g_pmds_m.pmds012_desc, 
       g_pmds_m.pmds053_desc,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid_desc, 
       g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdspstid_desc 

   
   #檢查是否允許此動作
   IF NOT apmt520_action_chk() THEN
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_pmds_m_mask_o.* =  g_pmds_m.*
   CALL apmt520_pmds_t_mask()
   LET g_pmds_m_mask_n.* =  g_pmds_m.*
   
   
   
   #add-point:modify段show之前
   {<point name="modify.before_show"/>}
   #end add-point  
   
   #LET l_wc2_table1 = g_wc2_table1
   #LET g_wc2_table1 = " 1=1"
   #LET l_wc2_table2 = g_wc2_table2
   #LET l_wc2_table2 = " 1=1"
 
   #LET l_wc2_table3 = g_wc2_table3
   #LET l_wc2_table3 = " 1=1"
 
 
 
   
   CALL apmt520_show()
   #add-point:modify段show之後
   {<point name="modify.after_show"/>}
   #end add-point
   
   #LET g_wc2_table1 = l_wc2_table1
   #LET  g_wc2_table2 = l_wc2_table2 
 
   #LET  g_wc2_table3 = l_wc2_table3 
 
 
 
    
   WHILE TRUE
      LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
      
      #寫入修改者/修改日期資訊(單頭)
      LET g_pmds_m.pmdsmodid = g_user 
LET g_pmds_m.pmdsmoddt = cl_get_current()
LET g_pmds_m.pmdsmodid_desc = cl_get_username(g_pmds_m.pmdsmodid)
      
      #add-point:modify段修改前
      {<point name="modify.before_input"/>}
      #end add-point
      
      #欄位更改
      LET g_loc = 'n'
      LET g_update = FALSE
      CALL apmt520_input("u")
      LET g_loc = 'n'
 
      #add-point:modify段修改後
      {<point name="modify.after_input"/>}
      #end add-point
      
      IF g_update OR NOT INT_FLAG THEN
         #若有modid跟moddt則進行update
         UPDATE pmds_t SET (pmdsmodid,pmdsmoddt) = (g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt)
          WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmdsdocno_t
 
      END IF
    
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_pmds_m.* = g_pmds_m_t.*
         CALL apmt520_show()
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code   = 9001 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')
         RETURN
      END IF 
                  
      #若單頭key欄位有變更
      IF g_pmds_m.pmdsdocno != g_pmdsdocno_t 
 
      THEN
         CALL s_transaction_begin()
         
         #add-point:單身fk修改前
         {<point name="modify.body.b_fk_update" mark="Y"/>}
         #end add-point
         
         #更新單身key值
         UPDATE pmdt_t SET pmdtdocno = g_pmds_m.pmdsdocno
 
          WHERE pmdtent = g_enterprise AND pmdtdocno = g_pmdsdocno_t
 
            
         #add-point:單身fk修改中
         {<point name="modify.body.m_fk_update"/>}
         #end add-point
 
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "pmdt_t" 
               LET g_errparam.code   = "std-00009" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "pmdt_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
         END CASE
         
         #add-point:單身fk修改後
         {<point name="modify.body.a_fk_update"/>}
         #end add-point
         
         #更新單身key值
         #add-point:單身fk修改前
         {<point name="modify.body.b_fk_update2" mark="Y"/>}
         #end add-point
         
         UPDATE pmdu_t
            SET pmdudocno = g_pmds_m.pmdsdocno
 
          WHERE pmduent = g_enterprise AND
                pmdudocno = g_pmdsdocno_t
 
         #add-point:單身fk修改中
         {<point name="modify.body.m_fk_update2"/>}
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "pmdu_t" 
               LET g_errparam.code   = "std-00009" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "pmdu_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後
         {<point name="modify.body.a_fk_update2"/>}
         #end add-point
 
         #更新單身key值
         #add-point:單身fk修改前
         {<point name="modify.body.b_fk_update3" mark="Y"/>}
         #end add-point
         
         UPDATE pmdv_t
            SET pmdvdocno = g_pmds_m.pmdsdocno
 
          WHERE pmdvent = g_enterprise AND
                pmdvdocno = g_pmdsdocno_t
 
         #add-point:單身fk修改中
         {<point name="modify.body.m_fk_update3"/>}
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "pmdv_t" 
               LET g_errparam.code   = "std-00009" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "pmdv_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後
         {<point name="modify.body.a_fk_update3"/>}
         #end add-point
 
 
         
 
         
         #UPDATE 多語言table key值
         
         
         
 
         CALL s_transaction_end('Y','0')
      END IF
    
      EXIT WHILE
   END WHILE
 
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL apmt520_set_act_visible()   
   CALL apmt520_set_act_no_visible()
 
   #組合新增資料的條件
   LET g_add_browse = " pmdsent = '" ||g_enterprise|| "' AND",
                      " pmdsdocno = '", g_pmds_m.pmdsdocno, "' "
 
   #填到對應位置
   CALL apmt520_browser_fill("")
 
   CLOSE apmt520_cl
   
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL apmt520_msgcentre_notify('modify')
 
END FUNCTION   
]]>
  </section>
  <section id="apmt520.msgcentre_notify" ver="5" status="" src="s" readonly="">
    <![CDATA[#應用 a66 樣板自動產生(Version:3)
PRIVATE FUNCTION apmt520_msgcentre_notify(lc_state)
   DEFINE lc_state LIKE type_t.chr80
   #add-point:msgcentre_notify段define
   {<point name="msgcentre_notify.define" edit="s"/>}
   #end add-point
   #add-point:msgcentre_notify段define
   {<point name="msgcentre_notify.define_customerization" edit="c"/>}
   #end add-point   
   
   INITIALIZE g_msgparam TO NULL
 
   #action-id與狀態填寫
   LET g_msgparam.state = lc_state
 
   #PK資料填寫
   CALL apmt520_set_pk_array()
   #單頭資料填寫
   LET g_msgparam.data[1] = util.JSON.stringify(g_pmds_m)
 
   #add-point:msgcentre其他通知
   {<point name="msgcentre_notify.process"/>}
   #end add-point
 
   #呼叫訊息中心傳遞本關完成訊息
   CALL cl_msgcentre_notify()
 
END FUNCTION
 
 
]]>
  </section>
  <section id="apmt520.other_dialog" ver="2" status="" src="s" readonly="">
    <![CDATA[   
]]>
  </section>
  <section id="apmt520.other_function" ver="2" status="" src="s" readonly="">
    <![CDATA[{<point name="other.function"/>}
]]>
  </section>
  <section id="apmt520.query" ver="11" status="" src="s" readonly="">
    <![CDATA[#+ 資料查詢QBE功能準備
PRIVATE FUNCTION apmt520_query()
   DEFINE ls_wc STRING
   #add-point:query段define
   {<point name="query.define" edit="s"/>}
   #end add-point   
   #add-point:query段define(客製用)
   {<point name="query.define_customerization" edit="c"/>}
   #end add-point   
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF   
   
   LET ls_wc = g_wc
   
   LET INT_FLAG = 0
   CALL cl_navigator_setting( g_current_idx, g_detail_cnt )
   ERROR ""
   
   #清除畫面及相關資料
   CLEAR FORM
   CALL g_browser.clear()       
   CALL g_pmdt_d.clear()
   CALL g_pmdt2_d.clear()
   CALL g_pmdt3_d.clear()
 
   
   #add-point:query段other
   {<point name="query.other"/>}
   #end add-point   
   
   DISPLAY '' TO FORMONLY.idx
   DISPLAY '' TO FORMONLY.cnt
   DISPLAY '' TO FORMONLY.b_index
   DISPLAY '' TO FORMONLY.b_count
   DISPLAY '' TO FORMONLY.h_index
   DISPLAY '' TO FORMONLY.h_count
   
   CALL apmt520_construct()
 
   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      LET g_wc = ls_wc
      CALL apmt520_browser_fill("")
      CALL apmt520_fetch("")
      RETURN
   END IF
   
   #儲存WC資訊
   CALL cl_dlg_save_user_latestqry("("||g_wc||") AND ("||g_wc2||")")
   
   #搜尋後資料初始化 
   LET g_detail_cnt  = 0
   LET g_current_idx = 1
   LET g_current_row = 0
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   LET g_error_show  = 1
   LET g_wc_filter   = ""
   LET l_ac = 1
   CALL FGL_SET_ARR_CURR(1)
      CALL apmt520_filter_show('pmdsdocno')
   CALL apmt520_filter_show('pmdsdocdt')
   CALL apmt520_filter_show('pmds002')
   CALL apmt520_filter_show('pmds003')
   CALL apmt520_filter_show('pmds007')
   CALL apmt520_filter_show('pmds008')
   CALL apmt520_filter_show('pmds009')
   CALL apmt520_browser_fill("F")
         
   IF g_browser_cnt = 0 THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "-100" 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
   ELSE
      CALL apmt520_fetch("F") 
      #顯示單身筆數
      CALL apmt520_idx_chk()
   END IF
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.reproduce" ver="31" status="" src="s" readonly="">
    <![CDATA[#+ 資料複製
PRIVATE FUNCTION apmt520_reproduce()
   DEFINE l_newno     LIKE pmds_t.pmdsdocno 
   DEFINE l_oldno     LIKE pmds_t.pmdsdocno 
 
   DEFINE l_master    RECORD LIKE pmds_t.*
   DEFINE l_detail    RECORD LIKE pmdt_t.*
   DEFINE l_detail2    RECORD LIKE pmdu_t.*
 
   DEFINE l_detail3    RECORD LIKE pmdv_t.*
 
 
 
   DEFINE l_cnt       LIKE type_t.num10
   #add-point:reproduce段define
   {<point name="reproduce.define" edit="s"/>}
   #end add-point   
   #add-point:reproduce段define(客製用)
   {<point name="reproduce.define_customerization" edit="c"/>}
   #end add-point   
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
   
   LET g_master_insert = FALSE
   
   IF g_pmds_m.pmdsdocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
    
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
    
   LET g_pmds_m.pmdsdocno = ""
 
 
   CALL cl_set_head_visible("","YES")
 
   #公用欄位給予預設值
   #應用 a14 樣板自動產生(Version:4)    
      #公用欄位新增給值  
      LET g_pmds_m.pmdsownid = g_user
      LET g_pmds_m.pmdsowndp = g_dept
      LET g_pmds_m.pmdscrtid = g_user
      LET g_pmds_m.pmdscrtdp = g_dept 
      LET g_pmds_m.pmdscrtdt = cl_get_current()
      LET g_pmds_m.pmdsmodid = g_user
      LET g_pmds_m.pmdsmoddt = cl_get_current()
      LET g_pmds_m.pmdsstus = 'N'
 
 
   
   CALL s_transaction_begin()
   
   #add-point:複製輸入前
   {<point name="reproduce.head.b_input"/>}
   #end add-point
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:2)
	  #根據當下狀態碼顯示圖片
      CASE g_pmds_m.pmdsstus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "S"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/posted.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
   
   #清空key欄位的desc
      LET g_pmds_m.pmdsdocno_desc = ''
   DISPLAY BY NAME g_pmds_m.pmdsdocno_desc
 
   
   CALL apmt520_input("r")
   
   IF INT_FLAG AND NOT g_master_insert THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = '' 
      LET g_errparam.code   = 9001 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      CALL s_transaction_end('N','0')
      LET INT_FLAG = 0
      DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
      DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
      LET INT_FLAG = 0
      INITIALIZE g_pmds_m.* TO NULL
      INITIALIZE g_pmdt_d TO NULL
      INITIALIZE g_pmdt2_d TO NULL
      INITIALIZE g_pmdt3_d TO NULL
 
      #add-point:複製取消後
      {<point name="reproduce.cancel" />}
      #end add-point
      CALL apmt520_show()
      RETURN
   END IF
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL apmt520_set_act_visible()   
   CALL apmt520_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_pmdsdocno_t = g_pmds_m.pmdsdocno
 
   
   #組合新增資料的條件
   LET g_add_browse = " pmdsent = '" ||g_enterprise|| "' AND",
                      " pmdsdocno = '", g_pmds_m.pmdsdocno, "' "
 
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL apmt520_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   #add-point:完成複製段落後
   {<point name="reproduce.after_reproduce" />}
   #end add-point
   
   CALL apmt520_idx_chk()
   
   #功能已完成,通報訊息中心
   CALL apmt520_msgcentre_notify('reproduce')
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_act_no_visible" ver="3" status="" src="s" readonly="">
    <![CDATA[#+ 單頭權限關閉
PRIVATE FUNCTION apmt520_set_act_no_visible()
   #add-point:set_act_no_visible段define
   {<point name="set_act_no_visible.define" edit="s"/>}
   #end add-point   
   #add-point:set_act_no_visible段define(客製用)
   {<point name="set_act_no_visible.define_customerization" edit="c"/>}
   #end add-point   
   #add-point:set_act_no_visible段
   {<point name="set_act_no_visible.set_act_no_visible"/>}
   #end add-point   
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_act_no_visible_b" ver="3" status="" src="s" readonly="">
    <![CDATA[#+ 單身權限關閉
PRIVATE FUNCTION apmt520_set_act_no_visible_b()
   #add-point:set_act_no_visible_b段define
   {<point name="set_act_no_visible_b.define" edit="s"/>}
   #end add-point   
   #add-point:set_act_no_visible_b段define(客製用)
   {<point name="set_act_no_visible_b.define_customerization" edit="c"/>}
   #end add-point   
   #add-point:set_act_no_visible_b段
   {<point name="set_act_no_visible_b.set_act_no_visible_b"/>}
   #end add-point   
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_act_visible" ver="3" status="" src="s" readonly="">
    <![CDATA[#+ 單頭權限開啟
PRIVATE FUNCTION apmt520_set_act_visible()
   #add-point:set_act_visible段define
   {<point name="set_act_visible.define" edit="s"/>}
   #end add-point   
   #add-point:set_act_visible段define(客製用)
   {<point name="set_act_visible.define_customerization" edit="c"/>}
   #end add-point   
   #add-point:set_act_visible段
   {<point name="set_act_visible.set_act_visible"/>}
   #end add-point   
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_act_visible_b" ver="3" status="" src="s" readonly="">
    <![CDATA[#+ 單身權限開啟
PRIVATE FUNCTION apmt520_set_act_visible_b()
   #add-point:set_act_visible_b段define
   {<point name="set_act_visible_b.define" edit="s"/>}
   #end add-point   
   #add-point:set_act_visible_b段define(客製用)
   {<point name="set_act_visible_b.define_customerization" edit="c"/>}
   #end add-point   
   #add-point:set_act_visible_b段
   {<point name="set_act_visible_b.set_act_visible_b"/>}
   #end add-point   
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_entry" ver="6" status="" src="s" readonly="">
    <![CDATA[#+ 單頭欄位開啟設定
PRIVATE FUNCTION apmt520_set_entry(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1  
   #add-point:set_entry段define
   {<point name="set_entry.define" edit="s"/>}
   #end add-point       
   #add-point:set_entry段define(客製用)
   {<point name="set_entry.define_customerization" edit="c"/>}
   #end add-point       
   
   CALL cl_set_comp_entry("pmdsdocno,pmdsdocdt",TRUE)
   
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("pmdsdocno",TRUE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,TRUE)
      END IF
      #add-point:set_entry段欄位控制
      {<point name="set_entry.field_control"/>}
      #end add-point  
   END IF
   
   #add-point:set_entry段欄位控制後
   {<point name="set_entry.after_control"/>}
   #end add-point 
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_entry_b" ver="5" status="" src="s" readonly="">
    <![CDATA[#+ 單身欄位開啟設定
PRIVATE FUNCTION apmt520_set_entry_b(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_entry_b段define
   {<point name="set_entry_b.define" edit="s"/>}
   #end add-point     
   #add-point:set_entry_b段define(客製用)
   {<point name="set_entry_b.define_customerization" edit="c"/>}
   #end add-point     
    
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("",TRUE)
      #add-point:set_entry段欄位控制
      {<point name="set_entry_b.field_control"/>}
      #end add-point  
   END IF
   
   #add-point:set_entry_b段
   {<point name="set_entry_b.set_entry_b"/>}
   #end add-point  
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_no_entry" ver="7" status="" src="s" readonly="">
    <![CDATA[#+ 單頭欄位關閉設定
PRIVATE FUNCTION apmt520_set_no_entry(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry段define
   {<point name="set_no_entry.define" edit="s"/>}
   #end add-point     
   #add-point:set_no_entry段define(客製用)
   {<point name="set_no_entry.define_customerization" edit="c"/>}
   #end add-point     
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("pmdsdocno",FALSE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,FALSE)
      END IF
      #add-point:set_no_entry段欄位控制
      {<point name="set_no_entry.field_control"/>}
      #end add-point 
   END IF 
   
   IF p_cmd = 'u' THEN
      CALL cl_set_comp_entry("pmdsdocno,pmdsdocdt",FALSE)
   END IF 
   
   #add-point:set_no_entry段欄位控制後
   {<point name="set_no_entry.after_control"/>}
   #end add-point 
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_no_entry_b" ver="5" status="" src="s" readonly="">
    <![CDATA[#+ 單身欄位關閉設定
PRIVATE FUNCTION apmt520_set_no_entry_b(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry_b段define
   {<point name="set_no_entry_b.define" edit="s"/>}
   #end add-point    
   #add-point:set_no_entry_b段define(客製用)
   {<point name="set_no_entry_b.define_customerization" edit="c"/>}
   #end add-point    
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("",FALSE)
      #add-point:set_no_entry_b段欄位控制
      {<point name="set_no_entry_b.field_control"/>}
      #end add-point 
   END IF 
   
   #add-point:set_no_entry_b段
   {<point name="set_no_entry_b.set_no_entry_b"/>}
   #end add-point     
END FUNCTION
]]>
  </section>
  <section id="apmt520.set_pk_array" ver="5" status="" src="s" readonly="">
    <![CDATA[   #應用 a51 樣板自動產生(Version:5)
#+ 給予pk_array內容
PRIVATE FUNCTION apmt520_set_pk_array()
   #add-point:set_pk_array段define
   {<point name="set_pk_array.define" edit="s"/>}
   #end add-point
   #add-point:set_pk_array段define
   {<point name="set_pk_array.define_customerization" edit="c"/>}
   #end add-point
   
   #add-point:set_pk_array段之前
   {<point name="set_pk_array.before"/>}
   #end add-point  
   
   #若l_ac<=0代表沒有資料
   IF l_ac <= 0 THEN
      RETURN
   END IF
   
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_pmds_m.pmdsdocno
   LET g_pk_array[1].column = 'pmdsdocno'
 
   
   #add-point:set_pk_array段之後
   {<point name="set_pk_array.after"/>}
   #end add-point  
   
END FUNCTION
 
 
]]>
  </section>
  <section id="apmt520.show" ver="38" status="" src="s" readonly="">
    <![CDATA[#+ 單頭資料重新顯示及單身資料重抓
PRIVATE FUNCTION apmt520_show()
   DEFINE l_ac_t    LIKE type_t.num10
   #add-point:show段define
   {<point name="show.define" edit="s"/>}
   #end add-point  
   #add-point:show段define(客製用)
   {<point name="show.define_customerization" edit="c"/>}
   #end add-point  
   
   #add-point:show段之前
   {<point name="show.before"/>}
   #end add-point
   
   
   
   IF g_bfill = "Y" THEN
      CALL apmt520_b_fill() #單身填充
      CALL apmt520_b_fill2('0') #單身填充
   END IF
     
   #帶出公用欄位reference值
   #應用 a12 樣板自動產生(Version:3)
 
 
   
   #顯示followup圖示
   #應用 a48 樣板自動產生(Version:2)
   CALL apmt520_set_pk_array()
   #add-point:ON ACTION agendum
   {<point name="show.follow_pic"/>}
   #END add-point
   CALL cl_user_overview_set_follow_pic()
  
 
 
   
   LET l_ac_t = l_ac
   
   #讀入ref值(單頭)
   #add-point:show段reference
   {<point name="show.head.reference"/>}
   #end add-point
   
   #遮罩相關處理
   LET g_pmds_m_mask_o.* =  g_pmds_m.*
   CALL apmt520_pmds_t_mask()
   LET g_pmds_m_mask_n.* =  g_pmds_m.*
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocno_desc,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001, 
       g_pmds_m.pmds002,g_pmds_m.pmds002_desc,g_pmds_m.pmds003,g_pmds_m.pmds003_desc,g_pmds_m.pmdsstus, 
       g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds007_desc,g_pmds_m.pmds008,g_pmds_m.pmds008_desc, 
       g_pmds_m.pmds009,g_pmds_m.pmds009_desc,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000,g_pmds_m.pmds100, 
       g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022, 
       g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds031_desc,g_pmds_m.pmds032,g_pmds_m.pmds032_desc, 
       g_pmds_m.pmds033,g_pmds_m.pmds033_desc,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037, 
       g_pmds_m.pmds037_desc,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds039_desc,g_pmds_m.pmds040, 
       g_pmds_m.pmds040_desc,g_pmds_m.pmds012,g_pmds_m.pmds012_desc,g_pmds_m.pmds101,g_pmds_m.pmds102, 
       g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds053_desc,g_pmds_m.pmds041, 
       g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055, 
       g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp,g_pmds_m.pmdsowndp_desc, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtid_desc,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdscrtdt, 
       g_pmds_m.pmdsmodid,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfid_desc, 
       g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstid_desc,g_pmds_m.pmdspstdt
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:2)
	  #根據當下狀態碼顯示圖片
      CASE g_pmds_m.pmdsstus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "S"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/posted.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
   
   #讀入ref值(單身)
   FOR l_ac = 1 TO g_pmdt_d.getLength()
      #add-point:show段單身reference
      {<point name="show.body.reference"/>}
      #end add-point
   END FOR
   
   FOR l_ac = 1 TO g_pmdt2_d.getLength()
      #add-point:show段單身reference
      {<point name="show.body2.reference"/>}
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_pmdt3_d.getLength()
      #add-point:show段單身reference
      {<point name="show.body3.reference"/>}
      #end add-point
   END FOR
 
   
    
   
   #add-point:show段other
   {<point name="show.other"/>}
   #end add-point  
   
   LET l_ac = l_ac_t
   
   #移動上下筆可以連動切換資料
   CALL cl_show_fld_cont()     
 
   CALL apmt520_detail_show()
 
   #add-point:show段之後
   {<point name="show.after"/>}
   #end add-point
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.signature" ver="4" status="" src="s" readonly="">
    <![CDATA[   #應用 a39 樣板自動產生(Version:7)
#+ BPM提交
PRIVATE FUNCTION apmt520_send()
   #add-point:send段define
   {<point name="send.define" edit="s"/>}
   #end add-point 
   #add-point:send段define(客製用)
   {<point name="send.define_customerization" edit="c"/>}
   #end add-point 
 
   #依據單據個數，需要指定所有單身條件為" 1=1"  (單身有幾個就要設幾個)
   LET g_wc2_table1 = " 1=1"
   LET g_wc2_table2 = " 1=1"
   LET g_wc2_table3 = " 1=1"
 
 
   CALL apmt520_show()
   CALL apmt520_set_pk_array()
   
   #add-point: 初始化的ADP
   {<point name="send.before_send" />}
   #end add-point
   
   #公用變數初始化
   CALL cl_bpm_data_init()
                  
   #依照主檔/單身個數產生 CALL cl_bpm_set_master_data() / cl_bpm_set_detail_data() 
   #單頭固定為 CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(xxxx)) 傳入參數: (1)單頭陣列  ; 回傳值: 無
   CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(g_pmds_m))
                              
   #單身固定為 CALL cl_bpm_set_detail_data(s_detailX, util.JSONArray.fromFGL(xxxx)) 傳入參數: (1)單身SR名稱  (2)單身陣列  ; 回傳值: 無
   CALL cl_bpm_set_detail_data("s_detail1", util.JSONArray.fromFGL(g_pmdt_d))
   CALL cl_bpm_set_detail_data("s_detail2", util.JSONArray.fromFGL(g_pmdt2_d))
   CALL cl_bpm_set_detail_data("s_detail3", util.JSONArray.fromFGL(g_pmdt3_d))
 
 
   # cl_bpm_cli() 裡有包含以前的aws_condition()=>送簽資料檢核和更新單據狀況碼為'W'
   # cl_bpm_cli() 傳入參數:無  ;  回傳值: 0 開單失敗; 1 開單成功
 
   #add-point: 提交前的ADP
   {<point name="send.before_cli" />}
   #end add-point
 
   #開單失敗
   IF NOT cl_bpm_cli() THEN 
      RETURN FALSE
   END IF
 
   #add-point: 提交後的ADP
   {<point name="send.after_send" />}
   #end add-point
 
   #此段落不需要刪除資料,但是否需要refresh圖片樣式???
   #CALL apmt520_ui_browser_refresh()
 
   #重新指定此筆單據資料狀態圖片=>送簽中
   LET g_browser[g_current_idx].b_statepic = "stus/16/signing.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL apmt520_ui_headershow()
   CALL apmt520_ui_detailshow()
 
   RETURN TRUE
   
END FUNCTION
 
 
#應用 a40 樣板自動產生(Version:4)
#+ BPM抽單
PRIVATE FUNCTION apmt520_draw_out()
   #add-point:draw段define
   {<point name="draw.define" edit="s"/>}
   #end add-point
   #add-point:draw段define
   {<point name="draw.define_customerization" edit="c"/>}
   #end add-point
 
   #抽單失敗
   IF NOT cl_bpm_draw_out() THEN 
      RETURN FALSE
   END IF    
          
   #重新指定此筆單據資料狀態圖片=>抽單
   LET g_browser[g_current_row].b_statepic = "stus/16/draw_out.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL apmt520_ui_headershow()  
   CALL apmt520_ui_detailshow()
 
   RETURN TRUE
   
END FUNCTION
 
 
 
]]>
  </section>
  <section id="apmt520.state_change" ver="27" status="" src="s" readonly="">
    <![CDATA[   #應用 a09 樣板自動產生(Version:12)
#+ 確認碼變更 
PRIVATE FUNCTION apmt520_statechange()
   DEFINE lc_state LIKE type_t.chr5
   #add-point:statechange段define
   {<point name="statechange.define" edit="s"/>}
   #end add-point  
   #add-point:statechange段define(客製用)
   {<point name="statechange.define_customerization" edit="c"/>}
   #end add-point  
   
   #add-point:statechange段開始前
   {<point name="statechange.before"/>}
   #end add-point  
   
   ERROR ""     #清空畫面右下側ERROR區塊
 
   IF g_pmds_m.pmdsdocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   CALL s_transaction_begin()
   
   OPEN apmt520_cl USING g_enterprise,g_pmds_m.pmdsdocno
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN apmt520_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      CLOSE apmt520_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #顯示最新的資料
   EXECUTE apmt520_master_referesh USING g_pmds_m.pmdsdocno INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
       g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
       g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
       g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
       g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
       g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
       g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
       g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
       g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt,g_pmds_m.pmds002_desc, 
       g_pmds_m.pmds003_desc,g_pmds_m.pmds007_desc,g_pmds_m.pmds008_desc,g_pmds_m.pmds009_desc,g_pmds_m.pmds031_desc, 
       g_pmds_m.pmds032_desc,g_pmds_m.pmds037_desc,g_pmds_m.pmds039_desc,g_pmds_m.pmds040_desc,g_pmds_m.pmds012_desc, 
       g_pmds_m.pmds053_desc,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid_desc, 
       g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdspstid_desc 

 
   #檢查是否允許此動作
   IF NOT apmt520_action_chk() THEN
      CLOSE apmt520_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #將資料顯示到畫面上
   DISPLAY BY NAME g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocno_desc,g_pmds_m.pmdsdocdt,g_pmds_m.pmds001, 
       g_pmds_m.pmds002,g_pmds_m.pmds002_desc,g_pmds_m.pmds003,g_pmds_m.pmds003_desc,g_pmds_m.pmdsstus, 
       g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds007_desc,g_pmds_m.pmds008,g_pmds_m.pmds008_desc, 
       g_pmds_m.pmds009,g_pmds_m.pmds009_desc,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000,g_pmds_m.pmds100, 
       g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021,g_pmds_m.pmds022, 
       g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds031_desc,g_pmds_m.pmds032,g_pmds_m.pmds032_desc, 
       g_pmds_m.pmds033,g_pmds_m.pmds033_desc,g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037, 
       g_pmds_m.pmds037_desc,g_pmds_m.pmds038,g_pmds_m.pmds039,g_pmds_m.pmds039_desc,g_pmds_m.pmds040, 
       g_pmds_m.pmds040_desc,g_pmds_m.pmds012,g_pmds_m.pmds012_desc,g_pmds_m.pmds101,g_pmds_m.pmds102, 
       g_pmds_m.pmds048,g_pmds_m.pmds047,g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds053_desc,g_pmds_m.pmds041, 
       g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055, 
       g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp,g_pmds_m.pmdsowndp_desc, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtid_desc,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdscrtdt, 
       g_pmds_m.pmdsmodid,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfid_desc, 
       g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstid_desc,g_pmds_m.pmdspstdt
 
   CASE g_pmds_m.pmdsstus
      WHEN "N"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
      WHEN "Y"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
      WHEN "S"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/posted.png")
      WHEN "A"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
      WHEN "D"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
      WHEN "R"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
      WHEN "W"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
      WHEN "X"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
      
   END CASE
 
   #add-point:資料刷新後
   {<point name="statechange.after_refresh"/>}
   #end add-point
 
   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_pmds_m.pmdsstus
            
            WHEN "N"
               HIDE OPTION "unconfirmed"
            WHEN "Y"
               HIDE OPTION "confirmed"
            WHEN "S"
               HIDE OPTION "posted"
            WHEN "A"
               HIDE OPTION "approved"
            WHEN "D"
               HIDE OPTION "withdraw"
            WHEN "R"
               HIDE OPTION "rejection"
            WHEN "W"
               HIDE OPTION "signing"
            WHEN "X"
               HIDE OPTION "invalid"
         END CASE
     
      #add-point:menu前
      {<point name="statechange.before_menu"/>}
      #end add-point
      
      #應用 a36 樣板自動產生(Version:4)
      #提交
      ON ACTION signing
         IF cl_auth_chk_act("signing") THEN
            IF NOT apmt520_send() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE apmt520_cl
            RETURN
         END IF
    
      #抽單
      ON ACTION withdraw
         IF cl_auth_chk_act("withdraw") THEN
            IF NOT apmt520_draw_out() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE apmt520_cl
            RETURN
         END IF
 
 
	  
      ON ACTION unconfirmed
         IF cl_auth_chk_act("unconfirmed") THEN
            LET lc_state = "N"
            #add-point:action控制
            {<point name="statechange.unconfirmed"/>}
            #end add-point
         END IF
         EXIT MENU
      ON ACTION confirmed
         IF cl_auth_chk_act("confirmed") THEN
            LET lc_state = "Y"
            #add-point:action控制
            {<point name="statechange.confirmed"/>}
            #end add-point
         END IF
         EXIT MENU
      ON ACTION posted
         IF cl_auth_chk_act("posted") THEN
            LET lc_state = "S"
            #add-point:action控制
            {<point name="statechange.posted"/>}
            #end add-point
         END IF
         EXIT MENU
      ON ACTION approved
         IF cl_auth_chk_act("approved") THEN
            LET lc_state = "A"
            #add-point:action控制
            {<point name="statechange.approved"/>}
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION withdraw
      #   IF cl_auth_chk_act("withdraw") THEN
      #      LET lc_state = "D"
      #      #add-point:action控制
      #      {<point name="statechange.withdraw"/>}
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION rejection
         IF cl_auth_chk_act("rejection") THEN
            LET lc_state = "R"
            #add-point:action控制
            {<point name="statechange.rejection"/>}
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION signing
      #   IF cl_auth_chk_act("signing") THEN
      #      LET lc_state = "W"
      #      #add-point:action控制
      #      {<point name="statechange.signing"/>}
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION invalid
         IF cl_auth_chk_act("invalid") THEN
            LET lc_state = "X"
            #add-point:action控制
            {<point name="statechange.invalid"/>}
            #end add-point
         END IF
         EXIT MENU
 
      #add-point:stus控制
      {<point name="statechange.more_control"/>}
      #end add-point
      
   END MENU
   
   #確認被選取的狀態碼在清單中
   IF (lc_state <> "N" 
      AND lc_state <> "Y"
      AND lc_state <> "S"
      AND lc_state <> "A"
      AND lc_state <> "D"
      AND lc_state <> "R"
      AND lc_state <> "W"
      AND lc_state <> "X"
      ) OR 
      g_pmds_m.pmdsstus = lc_state OR cl_null(lc_state) THEN
      CLOSE apmt520_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #add-point:stus修改前
   {<point name="statechange.b_update"/>}
   #end add-point
   
   LET g_pmds_m.pmdsmodid = g_user
   LET g_pmds_m.pmdsmoddt = cl_get_current()
   LET g_pmds_m.pmdsstus = lc_state
   
   #異動狀態碼欄位/修改人/修改日期
   UPDATE pmds_t 
      SET (pmdsstus,pmdsmodid,pmdsmoddt) 
        = (g_pmds_m.pmdsstus,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt)     
    WHERE pmdsent = g_enterprise AND pmdsdocno = g_pmds_m.pmdsdocno
 
    
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
   ELSE
      CASE lc_state
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "S"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/posted.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
    
      #撈取異動後的資料
      EXECUTE apmt520_master_referesh USING g_pmds_m.pmdsdocno INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
          g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
          g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
          g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
          g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
          g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
          g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
          g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
          g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
          g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
          g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt,g_pmds_m.pmds002_desc, 
          g_pmds_m.pmds003_desc,g_pmds_m.pmds007_desc,g_pmds_m.pmds008_desc,g_pmds_m.pmds009_desc,g_pmds_m.pmds031_desc, 
          g_pmds_m.pmds032_desc,g_pmds_m.pmds037_desc,g_pmds_m.pmds039_desc,g_pmds_m.pmds040_desc,g_pmds_m.pmds012_desc, 
          g_pmds_m.pmds053_desc,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid_desc, 
          g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdspstid_desc 

      
      #將資料顯示到畫面上
      DISPLAY BY NAME g_pmds_m.pmdssite,g_pmds_m.pmdsdocno,g_pmds_m.pmdsdocno_desc,g_pmds_m.pmdsdocdt, 
          g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds002_desc,g_pmds_m.pmds003,g_pmds_m.pmds003_desc, 
          g_pmds_m.pmdsstus,g_pmds_m.pmds006,g_pmds_m.pmds007,g_pmds_m.pmds007_desc,g_pmds_m.pmds008, 
          g_pmds_m.pmds008_desc,g_pmds_m.pmds009,g_pmds_m.pmds009_desc,g_pmds_m.pmds010,g_pmds_m.pmds052, 
          g_pmds_m.pmds000,g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045, 
          g_pmds_m.pmds021,g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds031_desc, 
          g_pmds_m.pmds032,g_pmds_m.pmds032_desc,g_pmds_m.pmds033,g_pmds_m.pmds033_desc,g_pmds_m.pmds034, 
          g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds037_desc,g_pmds_m.pmds038, 
          g_pmds_m.pmds039,g_pmds_m.pmds039_desc,g_pmds_m.pmds040,g_pmds_m.pmds040_desc,g_pmds_m.pmds012, 
          g_pmds_m.pmds012_desc,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
          g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds053_desc,g_pmds_m.pmds041,g_pmds_m.pmds042, 
          g_pmds_m.pmds043,g_pmds_m.pmds044,g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050, 
          g_pmds_m.pmdsownid,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid, 
          g_pmds_m.pmdscrtid_desc,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid, 
          g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdsmoddt,g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdscnfdt, 
          g_pmds_m.pmdspstid,g_pmds_m.pmdspstid_desc,g_pmds_m.pmdspstdt
   END IF
 
   #add-point:stus修改後
   {<point name="statechange.a_update"/>}
   #end add-point
 
   #add-point:statechange段結束前
   {<point name="statechange.after"/>}
   #end add-point  
 
   CLOSE apmt520_cl
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL apmt520_msgcentre_notify('statechange:'||lc_state)
   
END FUNCTION
 
 
]]>
  </section>
  <section id="apmt520.status_show" ver="1" status="" src="s" readonly="">
    <![CDATA[PRIVATE FUNCTION apmt520_status_show()
   #add-point:status_show段define
   {<point name="status_show.define" edit="s"/>}
   #end add-point
   #add-point:status_show段define(客製用)
   {<point name="status_show.define_customerization" edit="c"/>}
   #end add-point
   
   #add-point:status_show段status_show
   {<point name="status_show.status_show"/>}
   #end add-point
END FUNCTION
]]>
  </section>
  <section id="apmt520.ui_browser_refresh" ver="10" status="" src="s" readonly="">
    <![CDATA[#+ 瀏覽頁簽資料重新顯示
PRIVATE FUNCTION apmt520_ui_browser_refresh()
   DEFINE l_i  LIKE type_t.num10
   #add-point:ui_browser_refresh段define
   {<point name="ui_browser_refresh.define" edit="s"/>}
   #end add-point    
   #add-point:ui_browser_refresh段define(客製用)
   {<point name="ui_browser_refresh.define_customerization" edit="c"/>}
   #end add-point    
   
   LET g_browser_cnt = g_browser.getLength()
   LET g_header_cnt  = g_browser.getLength()
   FOR l_i =1 TO g_browser.getLength()
      IF g_browser[l_i].b_pmdsdocno = g_pmds_m.pmdsdocno 
 
         THEN
         CALL g_browser.deleteElement(l_i)
         EXIT FOR
      END IF
   END FOR
   LET g_browser_cnt = g_browser_cnt - 1
   LET g_header_cnt = g_header_cnt - 1
    
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
      CLEAR FORM
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
   
   #add-point:ui_browser_refresh段after
   {<point name="ui_browser_refresh.after"/>}
   #end add-point    
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.ui_detailshow" ver="4" status="" src="s" readonly="">
    <![CDATA[#+ 單身資料重新顯示
PRIVATE FUNCTION apmt520_ui_detailshow()
   #add-point:ui_detailshow段define
   {<point name="ui_detailshow.define" edit="s"/>}
   #end add-point    
   #add-point:ui_detailshow段define(客製用)
   {<point name="ui_detailshow.define_customerization" edit="c"/>}
   #end add-point    
   
   #add-point:ui_detailshow段before
   {<point name="ui_detailshow.before"/>}
   #end add-point    
   
   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail1",g_detail_idx)      
      CALL g_curr_diag.setCurrentRow("s_detail2",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail3",g_detail_idx)
 
   END IF
   
   #add-point:ui_detailshow段after
   {<point name="ui_detailshow.after"/>}
   #end add-point    
   
END FUNCTION
]]>
  </section>
  <section id="apmt520.ui_dialog" ver="242" status="" src="s" readonly="">
    <![CDATA[#+ 功能選單
PRIVATE FUNCTION apmt520_ui_dialog()
   DEFINE li_idx     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE lb_first   BOOLEAN
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE la_param   RECORD
          prog       STRING,
          actionid   STRING,
          background LIKE type_t.chr1,
          param      DYNAMIC ARRAY OF STRING
          END RECORD
   DEFINE ls_js      STRING
   DEFINE la_output  DYNAMIC ARRAY OF STRING   #報表元件鬆耦合使用
   #add-point:ui_dialog段define
   {<point name="ui_dialog.define" edit="s"/>}
   #end add-point
   #add-point:ui_dialog段define(客製用)
   {<point name="ui_dialog.define_customerization" edit="c"/>}
   #end add-point
   
   CALL cl_set_act_visible("accept,cancel", FALSE)
 
   #因應查詢方案進行處理
   IF g_default THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   ELSE
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF
   
   #action default動作
   #應用 a42 樣板自動產生(Version:2)
   #進入程式時預設執行的動作
   CASE g_actdefault
      WHEN "insert"
         LET g_action_choice="insert"
         LET g_actdefault = ""
         IF cl_auth_chk_act("insert") THEN
            CALL apmt520_insert()
            #add-point:ON ACTION insert
            {<point name="menu.default.insert" />}
            #END add-point
         END IF
 
      #add-point:action default自訂
      {<point name="ui_dialog.action_default"/>}
      #end add-point
      OTHERWISE
   END CASE
 
 
   
   LET lb_first = TRUE
   
   #add-point:ui_dialog段before dialog 
   {<point name="ui_dialog.before_dialog"/>}
   #end add-point
   
   WHILE TRUE 
   
      IF g_action_choice = "logistics" THEN
         #清除畫面及相關資料
         CLEAR FORM
         CALL g_browser.clear()       
         INITIALIZE g_pmds_m.* TO NULL
         CALL g_pmdt_d.clear()
         CALL g_pmdt2_d.clear()
         CALL g_pmdt3_d.clear()
 
         LET g_wc  = ' 1=2'
         LET g_wc2 = ' 1=1'
         LET g_action_choice = ""
         CALL apmt520_init()
      END IF
   
      CALL lib_cl_dlg.cl_dlg_before_display()
            
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
         #左側瀏覽頁簽
         DISPLAY ARRAY g_browser TO s_browse.* ATTRIBUTES(COUNT=g_header_cnt)
            BEFORE ROW
               #回歸舊筆數位置 (回到當時異動的筆數)
               LET g_current_idx = DIALOG.getCurrentRow("s_browse")
               IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                  LET g_current_idx = g_current_row
               END IF
               LET g_current_row = g_current_idx #目前指標
               LET g_current_sw = TRUE
         
               IF g_current_idx > g_browser.getLength() THEN
                  LET g_current_idx = g_browser.getLength()
               END IF 
               
               CALL apmt520_fetch('') # reload data
               LET l_ac = 1
               CALL apmt520_ui_detailshow() #Setting the current row 
         
               CALL apmt520_idx_chk()
               #NEXT FIELD pmdtseq
         
               ON ACTION qbefield_user   #欄位隱藏設定 
                  LET g_action_choice="qbefield_user"
                  CALL cl_ui_qbefield_user()
         END DISPLAY
    
         DISPLAY ARRAY g_pmdt_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) #page1  
    
            BEFORE ROW
               #顯示單身筆數
               CALL apmt520_idx_chk()
               #確定當下選擇的筆數
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_detail_idx = l_ac
               
               #add-point:page1, before row動作
               {<point name="ui_dialog.page1.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_detail_idx)
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_current_page = 1
               #顯示單身筆數
               CALL apmt520_idx_chk()
               #add-point:page1自定義行為
               {<point name="ui_dialog.page1.before_display"/>}
               #end add-point
               
            #自訂ACTION(detail_show,page_1)
            
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION detail_qrystr
               MENU "" ATTRIBUTE(STYLE="popup")
                  #add-point:ON ACTION detail_qrystr相關動作
                  {<point name="menu.detail_show.page1_sub.detail_qrystr" />}
                  #END add-point
                                 #應用 a43 樣板自動產生(Version:2)
               ON ACTION prog_apmt500
                  LET g_action_choice="prog_apmt500"
                  IF cl_auth_chk_act("prog_apmt500") THEN
                     
                     #add-point:ON ACTION prog_apmt500
                     {<point name="menu.detail_show.page1_sub.prog_apmt500" />}
                     #END add-point
                     
                  END IF
 
 
 
               END MENU
 
 
               #add-point:ON ACTION detail_qrystr
               {<point name="menu.detail_show.page1.detail_qrystr" />}
               #END add-point
 
 
 
               
            #add-point:page1自定義行為
            {<point name="ui_dialog.page1.action"/>}
            #end add-point
               
         END DISPLAY
        
         #第一階單身段落
         DISPLAY ARRAY g_pmdt2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL apmt520_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_detail_idx = l_ac
               
               #add-point:page2, before row動作
               {<point name="ui_dialog.body2.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_detail_idx)
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_current_page = 2
               #顯示單身筆數
               CALL apmt520_idx_chk()
               #add-point:page2自定義行為
               {<point name="ui_dialog.body2.before_display"/>}
               #end add-point
      
            #自訂ACTION(detail_show,page_2)
            
         
            #add-point:page2自定義行為
            {<point name="ui_dialog.body2.action"/>}
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_pmdt3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL apmt520_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_detail_idx = l_ac
               
               #add-point:page3, before row動作
               {<point name="ui_dialog.body3.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_detail_idx)
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_current_page = 3
               #顯示單身筆數
               CALL apmt520_idx_chk()
               #add-point:page3自定義行為
               {<point name="ui_dialog.body3.before_display"/>}
               #end add-point
      
            #自訂ACTION(detail_show,page_3)
            
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION detail_qrystr
               MENU "" ATTRIBUTE(STYLE="popup")
                  #add-point:ON ACTION detail_qrystr相關動作
                  {<point name="menu.detail_show.page3_sub.detail_qrystr" />}
                  #END add-point
                                 #應用 a43 樣板自動產生(Version:2)
               ON ACTION prog_apmt400
                  LET g_action_choice="prog_apmt400"
                  IF cl_auth_chk_act("prog_apmt400") THEN
                     
                     #add-point:ON ACTION prog_apmt400
                     {<point name="menu.detail_show.page3_sub.prog_apmt400" />}
                     #END add-point
                     
                  END IF
 
 
 
               END MENU
 
 
               #add-point:ON ACTION detail_qrystr
               {<point name="menu.detail_show.page3.detail_qrystr" />}
               #END add-point
 
 
 
         
            #add-point:page3自定義行為
            {<point name="ui_dialog.body3.action"/>}
            #end add-point
         
         END DISPLAY
 
         
 
         
         #add-point:ui_dialog段自定義display array
         {<point name="ui_dialog.more_displayarray"/>}
         #end add-point
         
         SUBDIALOG lib_cl_dlg.cl_dlg_qryplan
         SUBDIALOG lib_cl_dlg.cl_dlg_relateapps
      
         BEFORE DIALOG
            #先填充browser資料
            CALL apmt520_browser_fill("")
            CALL cl_notice()
            CALL cl_navigator_setting(g_current_idx, g_detail_cnt)
            LET g_curr_diag = ui.DIALOG.getCurrent()
            LET g_current_sw = FALSE
            #回歸舊筆數位置 (回到當時異動的筆數)
            LET g_current_idx = DIALOG.getCurrentRow("s_browse")
            IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
               CALL DIALOG.setCurrentRow("s_browse",g_current_row)
               LET g_current_idx = g_current_row
            END IF
            
            #確保g_current_idx位於正常區間內
            #小於,等於0則指到第1筆
            IF g_current_idx <= 0 THEN
               LET g_current_idx = 1
            END IF
            #超過最大筆數則指到最後1筆
            IF g_current_idx > g_browser.getLength() THEN
               LEt g_current_idx = g_browser.getLength()
            END IF 
            
            LET g_current_sw = TRUE
            LET g_current_row = g_current_idx #目前指標
            
            #有資料才進行fetch
            IF g_current_idx <> 0 THEN
               CALL apmt520_fetch('') # reload data
            END IF
            #LET g_detail_idx = 1
            CALL apmt520_ui_detailshow() #Setting the current row 
            
            #筆數顯示
            LET g_current_page = 1
            CALL apmt520_idx_chk()
            CALL cl_ap_performance_cal()
            #add-point:ui_dialog段before_dialog2
            {<point name="ui_dialog.before_dialog2"/>}
            #end add-point
 
         #狀態碼切換
         ON ACTION statechange
            LET g_action_choice = "statechange"
            CALL apmt520_statechange()
            #根據資料狀態切換action狀態
            CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
            CALL apmt520_set_act_visible()   
            CALL apmt520_set_act_no_visible()
            IF NOT (g_pmds_m.pmdsdocno IS NULL
 
              ) THEN
               #組合條件
               LET g_add_browse = " pmdsent = '" ||g_enterprise|| "' AND",
                                  " pmdsdocno = '", g_pmds_m.pmdsdocno, "' "
 
               #填到對應位置
               CALL apmt520_browser_fill("")
            END IF
         #應用 a32 樣板自動產生(Version:2)
         #簽核狀況
         ON ACTION bpm_status
            #查詢簽核狀況, 統一建立HyperLink
            CALL cl_bpm_status()
            #add-point:ON ACTION bpm_status
            {<point name="menu.bpm_status" />}
            #END add-point
 
 
          
         #查詢方案選擇 
         ON ACTION queryplansel
            CALL cl_dlg_qryplan_select() RETURNING ls_wc
            #不是空條件才寫入g_wc跟重新找資料
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
               INITIALIZE g_wc2_table3 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "pmds_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "pmdt_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "pmdu_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "pmdv_t" 
                        LET g_wc2_table3 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
                  OR NOT cl_null(g_wc2_table2)
 
                  OR NOT cl_null(g_wc2_table3)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  #組合g_wc2
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
                  IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
 
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
               END IF
               CALL apmt520_browser_fill("F")   #browser_fill()會將notice區塊清空
               CALL cl_notice()   #重新顯示,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            END IF
         
         #查詢方案選擇
         ON ACTION qbe_select
            CALL cl_qbe_list("m") RETURNING ls_wc
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
               INITIALIZE g_wc2_table3 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "pmds_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "pmdt_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "pmdu_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "pmdv_t" 
                        LET g_wc2_table3 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1)
                  OR NOT cl_null(g_wc2_table2)
 
                  OR NOT cl_null(g_wc2_table3)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
                  IF g_wc2_table3 <> " 1=1" AND NOT cl_null(g_wc2_table3) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table3
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
                  #取得條件後需要重查、跳到結果第一筆資料的功能程式段
                  CALL apmt520_browser_fill("F")
                  IF g_browser_cnt = 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "-100" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     CLEAR FORM
                  ELSE
                     CALL apmt520_fetch("F")
                  END IF
               END IF
            END IF
            #重新搜尋會將notice區塊清空,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            CALL cl_notice()
          
         #應用 a49 樣板自動產生(Version:2)
            #過濾瀏覽頁資料
            ON ACTION filter
               #add-point:filter action
               {<point name="ui_dialog.action.filter"/>}
               #end add-point
               CALL apmt520_filter()
               EXIT DIALOG
 
 
         
         ON ACTION first
            LET g_action_choice = "fetch"
            CALL apmt520_fetch('F')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL apmt520_idx_chk()
            
         ON ACTION previous
            LET g_action_choice = "fetch"
            CALL apmt520_fetch('P')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL apmt520_idx_chk()
            
         ON ACTION jump
            LET g_action_choice = "fetch"
            CALL apmt520_fetch('/')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL apmt520_idx_chk()
            
         ON ACTION next
            LET g_action_choice = "fetch"
            CALL apmt520_fetch('N')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL apmt520_idx_chk()
            
         ON ACTION last
            LET g_action_choice = "fetch"
            CALL apmt520_fetch('L')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL apmt520_idx_chk()
          
         #excel匯出功能          
         ON ACTION exporttoexcel
            LET g_action_choice="exporttoexcel"
            IF cl_auth_chk_act("exporttoexcel") THEN
               #browser
               CALL g_export_node.clear()
               IF g_main_hidden = 1 THEN
                  LET g_export_node[1] = base.typeInfo.create(g_browser)
                  LET g_export_id[1]   = "s_browse"
                  CALL cl_export_to_excel()
               #非browser
               ELSE
                  LET g_export_node[1] = base.typeInfo.create(g_pmdt_d)
                  LET g_export_id[1]   = "s_detail1"
                  LET g_export_node[2] = base.typeInfo.create(g_pmdt2_d)
                  LET g_export_id[2]   = "s_detail2"
                  LET g_export_node[3] = base.typeInfo.create(g_pmdt3_d)
                  LET g_export_id[3]   = "s_detail3"
 
                  #add-point:ON ACTION exporttoexcel
                  {<point name="menu.exporttoexcel" />}
                  #END add-point
                  CALL cl_export_to_excel_getpage()
                  CALL cl_export_to_excel()
               END IF
            END IF
        
         ON ACTION close
            LET INT_FLAG = FALSE
            LET g_action_choice = "exit"
            EXIT DIALOG
          
         ON ACTION exit
            LET g_action_choice = "exit"
            EXIT DIALOG
    
         #主頁摺疊
         ON ACTION mainhidden       
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
               CALL cl_notice()
            END IF
            
         #瀏覽頁折疊
         ON ACTION worksheethidden   
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF
            IF lb_first THEN
               LET lb_first = FALSE
               NEXT FIELD pmdtseq
            END IF
       
         #單頭摺疊，可利用hot key "Alt-s"開啟/關閉單頭
         ON ACTION controls     
            IF g_header_hidden THEN
               CALL gfrm_curr.setElementHidden("vb_master",0)
               CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
               LET g_header_hidden = 0     #visible
            ELSE
               CALL gfrm_curr.setElementHidden("vb_master",1)
               CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
               LET g_header_hidden = 1     #hidden     
            END IF
    
         
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION gen_pmdv
            LET g_action_choice="gen_pmdv"
            IF cl_auth_chk_act("gen_pmdv") THEN
               
               #add-point:ON ACTION gen_pmdv
               {<point name="menu.gen_pmdv" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION gen_pmdw
            LET g_action_choice="gen_pmdw"
            IF cl_auth_chk_act("gen_pmdw") THEN
               
               #add-point:ON ACTION gen_pmdw
               {<point name="menu.gen_pmdw" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL apmt520_modify()
               #add-point:ON ACTION modify
               {<point name="menu.modify" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION modify_detail
            LET g_action_choice="modify_detail"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = g_curr_diag.getCurrentItem()
               CALL apmt520_modify()
               #add-point:ON ACTION modify_detail
               {<point name="menu.modify_detail" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION query_check_back
            LET g_action_choice="query_check_back"
            IF cl_auth_chk_act("query_check_back") THEN
               
               #add-point:ON ACTION query_check_back
               {<point name="menu.query_check_back" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION query_detail_aapt110_01
            LET g_action_choice="query_detail_aapt110_01"
            IF cl_auth_chk_act("query_detail_aapt110_01") THEN
               
               #add-point:ON ACTION query_detail_aapt110_01
               {<point name="menu.query_detail_aapt110_01" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION demo
            LET g_action_choice="demo"
            IF cl_auth_chk_act("demo") THEN
               
               #add-point:ON ACTION demo
               {<point name="menu.demo" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION gen_purchase
            LET g_action_choice="gen_purchase"
            IF cl_auth_chk_act("gen_purchase") THEN
               
               #add-point:ON ACTION gen_purchase
               {<point name="menu.gen_purchase" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION query_warehouse_voucher
            LET g_action_choice="query_warehouse_voucher"
            IF cl_auth_chk_act("query_warehouse_voucher") THEN
               
               #add-point:ON ACTION query_warehouse_voucher
               {<point name="menu.query_warehouse_voucher" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION upd_pmds052
            LET g_action_choice="upd_pmds052"
            IF cl_auth_chk_act("upd_pmds052") THEN
               
               #add-point:ON ACTION upd_pmds052
               {<point name="menu.upd_pmds052" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION upd_pmds081
            LET g_action_choice="upd_pmds081"
            IF cl_auth_chk_act("upd_pmds081") THEN
               
               #add-point:ON ACTION upd_pmds081
               {<point name="menu.upd_pmds081" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL apmt520_delete()
               #add-point:ON ACTION delete
               {<point name="menu.delete" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION gen_warehouse_voucher
            LET g_action_choice="gen_warehouse_voucher"
            IF cl_auth_chk_act("gen_warehouse_voucher") THEN
               
               #add-point:ON ACTION gen_warehouse_voucher
               {<point name="menu.gen_warehouse_voucher" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL apmt520_insert()
               #add-point:ON ACTION insert
               {<point name="menu.insert" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION query_aapt110_01
            LET g_action_choice="query_aapt110_01"
            IF cl_auth_chk_act("query_aapt110_01") THEN
               
               #add-point:ON ACTION query_aapt110_01
               {<point name="menu.query_aapt110_01" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION store_in_by_qc
            LET g_action_choice="store_in_by_qc"
            IF cl_auth_chk_act("store_in_by_qc") THEN
               
               #add-point:ON ACTION store_in_by_qc
               {<point name="menu.store_in_by_qc" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION open_apmt520_03
            LET g_action_choice="open_apmt520_03"
            IF cl_auth_chk_act("open_apmt520_03") THEN
               
               #add-point:ON ACTION open_apmt520_03
               {<point name="menu.open_apmt520_03" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output
               {<point name="menu.output" />}
               #END add-point
               &include "erp/apm/apmt520_rep.4gl"
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION reproduce
            LET g_action_choice="reproduce"
            IF cl_auth_chk_act("reproduce") THEN
               CALL apmt520_reproduce()
               #add-point:ON ACTION reproduce
               {<point name="menu.reproduce" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION gen_pmdt
            LET g_action_choice="gen_pmdt"
            IF cl_auth_chk_act("gen_pmdt") THEN
               
               #add-point:ON ACTION gen_pmdt
               {<point name="menu.gen_pmdt" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION get_detail_price
            LET g_action_choice="get_detail_price"
            IF cl_auth_chk_act("get_detail_price") THEN
               
               #add-point:ON ACTION get_detail_price
               {<point name="menu.get_detail_price" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL apmt520_query()
               #add-point:ON ACTION query
               {<point name="menu.query" />}
               #END add-point
               #應用 a59 樣板自動產生(Version:2)  
               CALL g_curr_diag.setCurrentRow("s_detail1",1)
               CALL g_curr_diag.setCurrentRow("s_detail2",1)
               CALL g_curr_diag.setCurrentRow("s_detail3",1)
 
 
 
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION gen_check_back
            LET g_action_choice="gen_check_back"
            IF cl_auth_chk_act("gen_check_back") THEN
               
               #add-point:ON ACTION gen_check_back
               {<point name="menu.gen_check_back" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION gen_qc
            LET g_action_choice="gen_qc"
            IF cl_auth_chk_act("gen_qc") THEN
               
               #add-point:ON ACTION gen_qc
               {<point name="menu.gen_qc" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION query_qc
            LET g_action_choice="query_qc"
            IF cl_auth_chk_act("query_qc") THEN
               
               #add-point:ON ACTION query_qc
               {<point name="menu.query_qc" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION upd_price
            LET g_action_choice="upd_price"
            IF cl_auth_chk_act("upd_price") THEN
               
               #add-point:ON ACTION upd_price
               {<point name="menu.upd_price" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION prog_pmds002
            LET g_action_choice="prog_pmds002"
            IF cl_auth_chk_act("prog_pmds002") THEN
               
               #add-point:ON ACTION prog_pmds002
               {<point name="menu.prog_pmds002" />}
               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION prog_pmds006
            LET g_action_choice="prog_pmds006"
            IF cl_auth_chk_act("prog_pmds006") THEN
               
               #add-point:ON ACTION prog_pmds006
               {<point name="menu.prog_pmds006" />}
               #END add-point
               
            END IF
 
 
 
         
         #應用 a46 樣板自動產生(Version:2)
         #新增相關文件
         ON ACTION related_document
            CALL apmt520_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document
               {<point name="ui_dialog.dialog.related_document"/>}
               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL apmt520_set_pk_array()
            #add-point:ON ACTION agendum
            {<point name="ui_dialog.dialog.agendum"/>}
            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL apmt520_set_pk_array()
            #add-point:ON ACTION followup
            {<point name="ui_dialog.dialog.followup"/>}
            #END add-point
            CALL cl_user_overview_follow(g_pmds_m.pmdsdocdt)
 
 
         
         #主選單用ACTION
         &include "main_menu_exit_dialog.4gl"
         &include "relating_action.4gl"
    
         #交談指令共用ACTION
         &include "common_action.4gl" 
            CONTINUE DIALOG
      END DIALOG
    
      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         #add-point:ui_dialog段離開dialog前
         {<point name="ui_dialog.b_exit"/>}
         #end add-point
         EXIT WHILE
      END IF
    
   END WHILE    
      
   CALL cl_set_act_visible("accept,cancel", TRUE)
    
END FUNCTION
]]>
  </section>
  <section id="apmt520.ui_headershow" ver="28" status="" src="s" readonly="">
    <![CDATA[#+ 單頭資料重新顯示
PRIVATE FUNCTION apmt520_ui_headershow()
   #add-point:ui_headershow段define
   {<point name="ui_headershow.define" edit="s"/>}
   #end add-point    
   #add-point:ui_headershow段define(客製用)
   {<point name="ui_headershow.define_customerization" edit="c"/>}
   #end add-point    
   
   LET g_pmds_m.pmdsdocno = g_browser[g_current_idx].b_pmdsdocno   
 
   EXECUTE apmt520_master_referesh USING g_pmds_m.pmdsdocno INTO g_pmds_m.pmdssite,g_pmds_m.pmdsdocno, 
       g_pmds_m.pmdsdocdt,g_pmds_m.pmds001,g_pmds_m.pmds002,g_pmds_m.pmds003,g_pmds_m.pmdsstus,g_pmds_m.pmds006, 
       g_pmds_m.pmds007,g_pmds_m.pmds008,g_pmds_m.pmds009,g_pmds_m.pmds010,g_pmds_m.pmds052,g_pmds_m.pmds000, 
       g_pmds_m.pmds100,g_pmds_m.pmds011,g_pmds_m.pmds014,g_pmds_m.pmds081,g_pmds_m.pmds045,g_pmds_m.pmds021, 
       g_pmds_m.pmds022,g_pmds_m.pmds023,g_pmds_m.pmds024,g_pmds_m.pmds031,g_pmds_m.pmds032,g_pmds_m.pmds033, 
       g_pmds_m.pmds034,g_pmds_m.pmds035,g_pmds_m.pmds036,g_pmds_m.pmds037,g_pmds_m.pmds038,g_pmds_m.pmds039, 
       g_pmds_m.pmds040,g_pmds_m.pmds012,g_pmds_m.pmds101,g_pmds_m.pmds102,g_pmds_m.pmds048,g_pmds_m.pmds047, 
       g_pmds_m.pmds049,g_pmds_m.pmds053,g_pmds_m.pmds041,g_pmds_m.pmds042,g_pmds_m.pmds043,g_pmds_m.pmds044, 
       g_pmds_m.pmds046,g_pmds_m.pmds054,g_pmds_m.pmds055,g_pmds_m.pmds050,g_pmds_m.pmdsownid,g_pmds_m.pmdsowndp, 
       g_pmds_m.pmdscrtid,g_pmds_m.pmdscrtdp,g_pmds_m.pmdscrtdt,g_pmds_m.pmdsmodid,g_pmds_m.pmdsmoddt, 
       g_pmds_m.pmdscnfid,g_pmds_m.pmdscnfdt,g_pmds_m.pmdspstid,g_pmds_m.pmdspstdt,g_pmds_m.pmds002_desc, 
       g_pmds_m.pmds003_desc,g_pmds_m.pmds007_desc,g_pmds_m.pmds008_desc,g_pmds_m.pmds009_desc,g_pmds_m.pmds031_desc, 
       g_pmds_m.pmds032_desc,g_pmds_m.pmds037_desc,g_pmds_m.pmds039_desc,g_pmds_m.pmds040_desc,g_pmds_m.pmds012_desc, 
       g_pmds_m.pmds053_desc,g_pmds_m.pmdsownid_desc,g_pmds_m.pmdsowndp_desc,g_pmds_m.pmdscrtid_desc, 
       g_pmds_m.pmdscrtdp_desc,g_pmds_m.pmdsmodid_desc,g_pmds_m.pmdscnfid_desc,g_pmds_m.pmdspstid_desc 

   CALL apmt520_pmds_t_mask()
   CALL apmt520_show()
      
END FUNCTION
]]>
  </section>
  <section id="apmt520.unlock_b" ver="4" status="" src="s" readonly="">
    <![CDATA[#+ 連動unlock其他單身table資料
PRIVATE FUNCTION apmt520_unlock_b(ps_table,ps_page)
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:unlock_b段define
   {<point name="unlock_b.define" edit="s"/>}
   #end add-point  
   #add-point:unlock_b段define(客製用)
   {<point name="unlock_b.define_customerization" edit="c"/>}
   #end add-point  
    
   LET ls_group = "'1',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE apmt520_bcl
   END IF
   
   LET ls_group = "'2',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE apmt520_bcl2
   END IF
 
   LET ls_group = "'3',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE apmt520_bcl3
   END IF
 
 
   
 
 
   #add-point:unlock_b段other
   {<point name="unlock_b.other"/>}
   #end add-point  
 
END FUNCTION
]]>
  </section>
  <section id="apmt520.update_b" ver="35" status="" src="s" readonly="">
    <![CDATA[#+ 修改單身後其他table連動
PRIVATE FUNCTION apmt520_update_b(ps_table,ps_keys,ps_keys_bak,ps_page)
   DEFINE ps_table         STRING
   DEFINE ps_page          STRING
   DEFINE ps_keys          DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_keys_bak      DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group         STRING
   DEFINE li_idx           LIKE type_t.num10 
   DEFINE lb_chk           BOOLEAN
   DEFINE l_new_key        DYNAMIC ARRAY OF STRING
   DEFINE l_old_key        DYNAMIC ARRAY OF STRING
   DEFINE l_field_key      DYNAMIC ARRAY OF STRING
   #add-point:update_b段define
   {<point name="update_b.define" edit="s"/>}
   #end add-point   
   #add-point:update_b段define(客製用)
   {<point name="update_b.define_customerization" edit="c"/>}
   #end add-point   
   
   LET g_update = TRUE   
   
   #判斷key是否有改變
   LET lb_chk = TRUE
   FOR li_idx = 1 TO ps_keys.getLength()
      IF ps_keys[li_idx] <> ps_keys_bak[li_idx] THEN
         LET lb_chk = FALSE
         EXIT FOR
      END IF
   END FOR
   
   #不需要做處理
   IF lb_chk THEN
      RETURN
   END IF
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "pmdt_t" THEN
      #add-point:update_b段修改前
      {<point name="update_b.before_update" mark="Y"/>}
      #end add-point 
      
      #將遮罩欄位還原
      CALL apmt520_pmdt_t_mask_restore('restore_mask_o')
               
      UPDATE pmdt_t 
         SET (pmdtdocno,
              pmdtseq
              ,pmdtsite,pmdt027,pmdt028,pmdt001,pmdt002,pmdt003,pmdt004,pmdt081,pmdt082,pmdt083,pmdt005,pmdt006,pmdt007,pmdt009,pmdt010,pmdt025,pmdt011,pmdt019,pmdt020,pmdt021,pmdt022,pmdt008,pmdt023,pmdt024,pmdt090,pmdt091,pmdt036,pmdt046,pmdt037,pmdt038,pmdt039,pmdt047,pmdt092,pmdt093,pmdt026,pmdt041,pmdt062,pmdt016,pmdt017,pmdt018,pmdt063,pmdt072,pmdt073,pmdt074,pmdt040,pmdt052,pmdt051,pmdt070,pmdt071,pmdt059,pmdt053,pmdt054,pmdt055,pmdt060,pmdt061,pmdt042,pmdt043,pmdt048,pmdt044,pmdt045,pmdt084,pmdt089,pmdt088) 
              = 
             (ps_keys[1],ps_keys[2]
              ,g_pmdt_d[g_detail_idx].pmdtsite,g_pmdt_d[g_detail_idx].pmdt027,g_pmdt_d[g_detail_idx].pmdt028, 
                  g_pmdt_d[g_detail_idx].pmdt001,g_pmdt_d[g_detail_idx].pmdt002,g_pmdt_d[g_detail_idx].pmdt003, 
                  g_pmdt_d[g_detail_idx].pmdt004,g_pmdt_d[g_detail_idx].pmdt081,g_pmdt_d[g_detail_idx].pmdt082, 
                  g_pmdt_d[g_detail_idx].pmdt083,g_pmdt_d[g_detail_idx].pmdt005,g_pmdt_d[g_detail_idx].pmdt006, 
                  g_pmdt_d[g_detail_idx].pmdt007,g_pmdt_d[g_detail_idx].pmdt009,g_pmdt_d[g_detail_idx].pmdt010, 
                  g_pmdt_d[g_detail_idx].pmdt025,g_pmdt_d[g_detail_idx].pmdt011,g_pmdt_d[g_detail_idx].pmdt019, 
                  g_pmdt_d[g_detail_idx].pmdt020,g_pmdt_d[g_detail_idx].pmdt021,g_pmdt_d[g_detail_idx].pmdt022, 
                  g_pmdt_d[g_detail_idx].pmdt008,g_pmdt_d[g_detail_idx].pmdt023,g_pmdt_d[g_detail_idx].pmdt024, 
                  g_pmdt_d[g_detail_idx].pmdt090,g_pmdt_d[g_detail_idx].pmdt091,g_pmdt_d[g_detail_idx].pmdt036, 
                  g_pmdt_d[g_detail_idx].pmdt046,g_pmdt_d[g_detail_idx].pmdt037,g_pmdt_d[g_detail_idx].pmdt038, 
                  g_pmdt_d[g_detail_idx].pmdt039,g_pmdt_d[g_detail_idx].pmdt047,g_pmdt_d[g_detail_idx].pmdt092, 
                  g_pmdt_d[g_detail_idx].pmdt093,g_pmdt_d[g_detail_idx].pmdt026,g_pmdt_d[g_detail_idx].pmdt041, 
                  g_pmdt_d[g_detail_idx].pmdt062,g_pmdt_d[g_detail_idx].pmdt016,g_pmdt_d[g_detail_idx].pmdt017, 
                  g_pmdt_d[g_detail_idx].pmdt018,g_pmdt_d[g_detail_idx].pmdt063,g_pmdt_d[g_detail_idx].pmdt072, 
                  g_pmdt_d[g_detail_idx].pmdt073,g_pmdt_d[g_detail_idx].pmdt074,g_pmdt_d[g_detail_idx].pmdt040, 
                  g_pmdt_d[g_detail_idx].pmdt052,g_pmdt_d[g_detail_idx].pmdt051,g_pmdt_d[g_detail_idx].pmdt070, 
                  g_pmdt_d[g_detail_idx].pmdt071,g_pmdt_d[g_detail_idx].pmdt059,g_pmdt_d[g_detail_idx].pmdt053, 
                  g_pmdt_d[g_detail_idx].pmdt054,g_pmdt_d[g_detail_idx].pmdt055,g_pmdt_d[g_detail_idx].pmdt060, 
                  g_pmdt_d[g_detail_idx].pmdt061,g_pmdt_d[g_detail_idx].pmdt042,g_pmdt_d[g_detail_idx].pmdt043, 
                  g_pmdt_d[g_detail_idx].pmdt048,g_pmdt_d[g_detail_idx].pmdt044,g_pmdt_d[g_detail_idx].pmdt045, 
                  g_pmdt_d[g_detail_idx].pmdt084,g_pmdt_d[g_detail_idx].pmdt089,g_pmdt_d[g_detail_idx].pmdt088)  

         WHERE pmdtent = g_enterprise AND pmdtdocno = ps_keys_bak[1] AND pmdtseq = ps_keys_bak[2]
      #add-point:update_b段修改中
      {<point name="update_b.m_update"/>}
      #end add-point   
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "pmdt_t" 
            LET g_errparam.code   = "std-00009" 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "pmdt_t" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            CALL s_transaction_end('N','0')
         OTHERWISE
            
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL apmt520_pmdt_t_mask_restore('restore_mask_n')
               
      #add-point:update_b段修改後
      {<point name="update_b.after_update"/>}
      #end add-point  
   END IF
   
   LET ls_group = "'2',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "pmdu_t" THEN
      #add-point:update_b段修改前
      {<point name="update_b.before_update2" mark="Y"/>}
      #end add-point  
      
      #將遮罩欄位還原
      CALL apmt520_pmdu_t_mask_restore('restore_mask_o')
               
      UPDATE pmdu_t 
         SET (pmdudocno,
              pmduseq,pmduseq1
              ,pmdusite,pmdu001,pmdu002,pmdu003,pmdu004,pmdu006,pmdu007,pmdu008,pmdu005,pmdu009,pmdu010,pmdu011,pmdu012,pmdu013,pmdu014,pmdu015,pmdu017,pmdu016) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_pmdt2_d[g_detail_idx].pmdusite,g_pmdt2_d[g_detail_idx].pmdu001,g_pmdt2_d[g_detail_idx].pmdu002, 
                  g_pmdt2_d[g_detail_idx].pmdu003,g_pmdt2_d[g_detail_idx].pmdu004,g_pmdt2_d[g_detail_idx].pmdu006, 
                  g_pmdt2_d[g_detail_idx].pmdu007,g_pmdt2_d[g_detail_idx].pmdu008,g_pmdt2_d[g_detail_idx].pmdu005, 
                  g_pmdt2_d[g_detail_idx].pmdu009,g_pmdt2_d[g_detail_idx].pmdu010,g_pmdt2_d[g_detail_idx].pmdu011, 
                  g_pmdt2_d[g_detail_idx].pmdu012,g_pmdt2_d[g_detail_idx].pmdu013,g_pmdt2_d[g_detail_idx].pmdu014, 
                  g_pmdt2_d[g_detail_idx].pmdu015,g_pmdt2_d[g_detail_idx].pmdu017,g_pmdt2_d[g_detail_idx].pmdu016)  

         WHERE pmduent = g_enterprise AND pmdudocno = ps_keys_bak[1] AND pmduseq = ps_keys_bak[2] AND pmduseq1 = ps_keys_bak[3]
      #add-point:update_b段修改中
      {<point name="update_b.m_update2"/>}
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "pmdu_t" 
            LET g_errparam.code   = "std-00009" 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "pmdu_t" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            CALL s_transaction_end('N','0')
         OTHERWISE
            
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL apmt520_pmdu_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後
      {<point name="update_b.after_update2"/>}
      #end add-point  
   END IF
 
   LET ls_group = "'3',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "pmdv_t" THEN
      #add-point:update_b段修改前
      {<point name="update_b.before_update3" mark="Y"/>}
      #end add-point  
      
      #將遮罩欄位還原
      CALL apmt520_pmdv_t_mask_restore('restore_mask_o')
               
      UPDATE pmdv_t 
         SET (pmdvdocno,
              pmdvseq,pmdvseq1
              ,pmdvsite,pmdv005,pmdv001,pmdv002,pmdv003,pmdv004,pmdv014,pmdv015,pmdv016,pmdv017,pmdv018,pmdv019) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_pmdt3_d[g_detail_idx].pmdvsite,g_pmdt3_d[g_detail_idx].pmdv005,g_pmdt3_d[g_detail_idx].pmdv001, 
                  g_pmdt3_d[g_detail_idx].pmdv002,g_pmdt3_d[g_detail_idx].pmdv003,g_pmdt3_d[g_detail_idx].pmdv004, 
                  g_pmdt3_d[g_detail_idx].pmdv014,g_pmdt3_d[g_detail_idx].pmdv015,g_pmdt3_d[g_detail_idx].pmdv016, 
                  g_pmdt3_d[g_detail_idx].pmdv017,g_pmdt3_d[g_detail_idx].pmdv018,g_pmdt3_d[g_detail_idx].pmdv019)  

         WHERE pmdvent = g_enterprise AND pmdvdocno = ps_keys_bak[1] AND pmdvseq = ps_keys_bak[2] AND pmdvseq1 = ps_keys_bak[3]
      #add-point:update_b段修改中
      {<point name="update_b.m_update3"/>}
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "pmdv_t" 
            LET g_errparam.code   = "std-00009" 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "pmdv_t" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            CALL s_transaction_end('N','0')
         OTHERWISE
            
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL apmt520_pmdv_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後
      {<point name="update_b.after_update3"/>}
      #end add-point  
   END IF
 
 
   
 
   
   #add-point:update_b段other
   {<point name="update_b.other"/>}
   #end add-point  
   
END FUNCTION
]]>
  </section>
</add_points>
