#該程式未解開Section, 採用最新樣板產出!
{<section id="axrt400.description" >}
#應用 a00 樣板自動產生(Version:3)
#+ Standard Version.....: SD版次:0033(2016-09-28 16:30:39), PR版次:0033(2016-10-27 14:57:58)
#+ Customerized Version.: SD版次:0000(1900-01-01 00:00:00), PR版次:0000(1900-01-01 00:00:00)
#+ Build......: 001059
#+ Filename...: axrt400
#+ Description: 收款核銷單維護作業
#+ Creator....: 02114(2014-10-22 11:13:16)
#+ Modifier...: 01727 -SD/PR- 08171
 
{</section>}
 
{<section id="axrt400.global" >}
#應用 t01 樣板自動產生(Version:76)
#add-point:填寫註解說明
#141226-00016#2              By 01727    單據日期欄輸入後檢查關帳日期 -->帳務中心所屬法人據點的aoos020中的應收關帳日期
#150812-00010#2              by 03538    取位改使用帳套使用幣別來取,錯誤訊息彙總起始不成對調整
#150820-00015#3   2015/08/20 by 03538    帳款單加入參數agli010+單別是否產分錄聯合檢定可否沖銷
#150812-00010#3   2015/08/28 by 03538    收款單屬於暫收的部分,科目取anmi152的待沖銷科目;當單列金額全為0時,不新增
#151006                      by albireo  kris,carol:核銷單身開窗限制核銷對象,可沖銷單據檢核限制核銷對象及其交易夥伴
#151105-00007#3   2015/11/05 By 06948    選擇作廢時需填入作廢理由
#150916-00015#1   2015/11/30 By taozf    当有账套时，科目检查改为检查是否存在于glad_t中
#151125-00006#1   2015/12/03 by 06862    新增/修改/複製單據后立即審核，立即拋轉傳票
#151130-00015#2   2015/12/22 BY Xiaozg   根据是否可以更改單據日期 設定開放單據日期修改
#151130-00015#4   2015/12/23 By 02097    配合s_aapt420增加參數
#150901-00004#1   2016/01/04 By yangtt  【核销账款单】页签中，发票号码xrcc009改成xrce054
#160104-00020#3   2016/01/08 By albireo  沖帳單身沖帳本幣金額修改不回推沖帳原幣金額
#160104-00007#7   2016/01/30 By sakura   單據作業傳票還原功能
#151231-00010#2   2016/02/22 By yangtt   增加控制組
#160122-00001#5   2016/03/03 By 07673    当没有权限时，用户不能看到交易账户编号，用“*”显示，当有权限时，才可 看到具体交易账户编号。
#160317-00007#1   2016/03/17 By 01727    單頭法人應該是帳套所屬法人
#160114-00019#2   2016/03/23 By 01727    应收账款单【直接收款】增加【收款日期】 
#                                           1.收款日 提示是否為同一會計期間內日期,不限制只提示.
#                                           2.一併修改產生至銀存記錄檔時,以該收款日日期為異動日.
#160308-00010#6   2016/03/31 By Jessica  1.補上BPM簽核功能鈕控制 2.「已抽單、已拒絕」單據修改時報錯:agl-00313，修正為可修改
#160318-00005#54  2016/04/01 by pengxin  修正azzi920重复定义之错误讯息
#160405-00010#1   2016/04/07 By 07673    nmbb003当来源是30：票据的时候,值是给票据号码,此时栏位说明也一并调整为【票据号码】
#160413-00037#1   2016/04/14 By 01727    修改axr-00051的建议处理方式为可传入参数的方式.根据款别类型传入anmt310或anmt540程序编号
#160413-00027#1   2016/04/14 By taozf    axrt400状态码函数在处理BPM流程时,没有先无条件隐藏BPM状态码
#160413-00023#1   2016/04/14 By taozf    单头法人应该是帐套归属法人
#160318-00025#13  2016/04/15 By 07673    將重複內容的錯誤訊息置換為公用錯誤訊息
#160420-00001#1   2016/04/20 By 01727    修改狀態下:單頭收款客戶及核銷客戶皆不可修改
#160426-00016#1   2016/04/26 By Dido     xrce038 要記錄 apca004
#160308-00010#8   2016/04/27 By Jessica 「已抽單、已拒絕」單據刪除時報錯:agl-00313，修正為可刪除
#160420-00001#13  2016/05/05 By 01727    axrt400 沖待抵單時不可超過原始預收單已收款金額
#160525-00011#1   2016/05/25 By 01727    預收待抵轉應付時, 沒有寫 apcc
#160503-00036#1   2016/05/31 By 01727    1.xrda 增加確認者.確認日.資料過帳者,過帳日等.相關欄位
#160612-00005#1   2016/06/13 By 01727    1,新增时，现金变动码xrde012开窗，未按账套的现金变动参照表glaa005过滤。
#                                        2,审核时报错,确认信息后，单据更改状态码为“已确认”。
#160607-00015#3   2016/06/23 By 01727    手工錄入時,剔除存在於aist340的資料
#160607-00015#1   2016/07/05 By Reanna   處理從aisp450拋轉至axrt400後續處理
#160628-00002#1   2016/07/12 By 02599    账款单身选择待抵单时,限制只能选择应税折抵为’N’(待抵单为不开立发票)
#160125-00005#9   2016/08/02 By 01727    查詢時加上帳套人員權限條件過濾
#160727-00019#37  2016/08/12 By 08734    临时表长度超过15码的减少到15码以下 s_voucher_ar_tmp ——> s_vr_tmp04
#160727-00019#34  2016/08/15 By 08734    临时表长度超过15码的减少到15码以下 s_pre_voucher_tmp ——> s_pre_vr_tmp01
#160727-00019#37  2016/08/15 By 08734    临时表长度超过15码的减少到15码以下 s_voucher_ar_group ——> s_vr_tmp05
#160811-00009#3   2016/08/15 By 01531    账务中心/法人/账套权限控管
#160905-00002#5   2016/09/05 By Brianwu  SQL條件少ENT補上
#160909-00004#1   2016/09/12 By 01727    补上定义产生溢收多帐期时需要使用的临时表逻辑
#160913-00023#1   2016/09/13 By 01727    axrt400类型不为10收款时,收款日期栏位不需要必输
#160802-00007#1   2016/09/26 By 01727    一次性交易對象識別碼(pmaa004=2)功能應用
#161011-00007#1   2016/10/11 By 01727    整批调整axr模组中部门栏位开窗,改用aooi125的资料
#161017-00011#2   2016/10/19 By 02599    【转入客商码】栏位增加控制组权限控管
#161006-00005#39  2016/10/27 By 08171    账务中心开窗需调整为q_ooef001_46,新增时where条件限定ooefstus=Y.查询时不限定;来源组织开窗增加where條件 ooef201 = 'Y'
#end add-point
#add-point:填寫註解說明(客製用)

#end add-point
 
IMPORT os
IMPORT util
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目 name="global.import"

#end add-point 
 
SCHEMA ds 
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔 name="global.inc"

#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_xrda_m        RECORD
       xrdasite LIKE xrda_t.xrdasite, 
   xrdasite_desc LIKE type_t.chr80, 
   xrda003 LIKE xrda_t.xrda003, 
   xrda003_desc LIKE type_t.chr80, 
   xrdald LIKE xrda_t.xrdald, 
   xrdald_desc LIKE type_t.chr80, 
   xrdacomp LIKE xrda_t.xrdacomp, 
   xrdadocno LIKE xrda_t.xrdadocno, 
   xrdadocno_desc LIKE type_t.chr80, 
   xrda001 LIKE xrda_t.xrda001, 
   xrdadocdt LIKE xrda_t.xrdadocdt, 
   xrda005 LIKE xrda_t.xrda005, 
   xrda005_desc LIKE type_t.chr80, 
   xrda004 LIKE xrda_t.xrda004, 
   xrda004_desc LIKE type_t.chr80, 
   xrda014 LIKE xrda_t.xrda014, 
   xrda006 LIKE xrda_t.xrda006, 
   xrdastus LIKE xrda_t.xrdastus, 
   xrda008 LIKE xrda_t.xrda008, 
   xrda010 LIKE xrda_t.xrda010, 
   xrda017 LIKE xrda_t.xrda017, 
   xrda007 LIKE xrda_t.xrda007, 
   xrda009 LIKE xrda_t.xrda009, 
   xrda015 LIKE xrda_t.xrda015, 
   xrda015_desc LIKE type_t.chr80, 
   xrda016 LIKE xrda_t.xrda016, 
   xrdaownid LIKE xrda_t.xrdaownid, 
   xrdaownid_desc LIKE type_t.chr80, 
   xrdaowndp LIKE xrda_t.xrdaowndp, 
   xrdaowndp_desc LIKE type_t.chr80, 
   xrdacrtid LIKE xrda_t.xrdacrtid, 
   xrdacrtid_desc LIKE type_t.chr80, 
   xrdacrtdp LIKE xrda_t.xrdacrtdp, 
   xrdacrtdp_desc LIKE type_t.chr80, 
   xrdacrtdt LIKE xrda_t.xrdacrtdt, 
   xrdamodid LIKE xrda_t.xrdamodid, 
   xrdamodid_desc LIKE type_t.chr80, 
   xrdamoddt LIKE xrda_t.xrdamoddt, 
   xrdacnfid LIKE xrda_t.xrdacnfid, 
   xrdacnfid_desc LIKE type_t.chr80, 
   xrdacnfdt LIKE xrda_t.xrdacnfdt, 
   xrda007_desc LIKE type_t.chr80, 
   l_desc LIKE type_t.chr80, 
   lbl_amt5_desc LIKE type_t.chr80, 
   lbl_amt1_1_desc LIKE type_t.chr80, 
   lbl_amt3_1_desc LIKE type_t.chr80, 
   lbl_amt5_1_desc LIKE type_t.chr80
       END RECORD
 
#單身 type 宣告
PRIVATE TYPE type_g_xrde_d        RECORD
       xrdeseq LIKE xrde_t.xrdeseq, 
   xrde002 LIKE xrde_t.xrde002, 
   xrde006 LIKE xrde_t.xrde006, 
   xrde003 LIKE xrde_t.xrde003, 
   xrde004 LIKE xrde_t.xrde004, 
   xrde008 LIKE xrde_t.xrde008, 
   l_xrde008 LIKE type_t.chr20, 
   xrde032 LIKE xrde_t.xrde032, 
   xrde010 LIKE xrde_t.xrde010, 
   xrde016 LIKE xrde_t.xrde016, 
   xrde016_desc LIKE type_t.chr500, 
   xrde100 LIKE xrde_t.xrde100, 
   xrde101 LIKE xrde_t.xrde101, 
   xrde109 LIKE xrde_t.xrde109, 
   xrde119 LIKE xrde_t.xrde119, 
   xrde014 LIKE xrde_t.xrde014, 
   xrde013 LIKE xrde_t.xrde013, 
   xrde001 LIKE xrde_t.xrde001, 
   xrdecomp LIKE xrde_t.xrdecomp, 
   xrdesite LIKE xrde_t.xrdesite, 
   xrdeorga LIKE xrde_t.xrdeorga, 
   xrde011 LIKE xrde_t.xrde011, 
   xrde015 LIKE xrde_t.xrde015, 
   xrde015_desc LIKE type_t.chr500, 
   xrde012 LIKE xrde_t.xrde012, 
   xrde012_desc LIKE type_t.chr500
       END RECORD
PRIVATE TYPE type_g_xrde2_d RECORD
       xrdeseq LIKE xrde_t.xrdeseq, 
   xrde120 LIKE xrde_t.xrde120, 
   xrde121 LIKE xrde_t.xrde121, 
   xrde129 LIKE xrde_t.xrde129, 
   xrde130 LIKE xrde_t.xrde130, 
   xrde131 LIKE xrde_t.xrde131, 
   xrde139 LIKE xrde_t.xrde139
       END RECORD
PRIVATE TYPE type_g_xrde3_d RECORD
       xrdeseq LIKE xrde_t.xrdeseq, 
   l_xrde016 LIKE type_t.chr500, 
   xrde017 LIKE xrde_t.xrde017, 
   xrde017_desc LIKE type_t.chr500, 
   xrde018 LIKE xrde_t.xrde018, 
   xrde018_desc LIKE type_t.chr500, 
   xrde019 LIKE xrde_t.xrde019, 
   xrde019_desc LIKE type_t.chr500, 
   xrde035 LIKE xrde_t.xrde035, 
   xrde035_desc LIKE type_t.chr500, 
   xrde036 LIKE xrde_t.xrde036, 
   xrde036_desc LIKE type_t.chr500, 
   xrde020 LIKE xrde_t.xrde020, 
   xrde020_desc LIKE type_t.chr500, 
   xrde022 LIKE xrde_t.xrde022, 
   xrde022_desc LIKE type_t.chr500, 
   xrde023 LIKE xrde_t.xrde023, 
   xrde023_desc LIKE type_t.chr500, 
   xrde039 LIKE xrde_t.xrde039, 
   xrde040 LIKE xrde_t.xrde040, 
   xrde040_desc LIKE type_t.chr500, 
   xrde042 LIKE xrde_t.xrde042, 
   xrde042_desc LIKE type_t.chr500, 
   xrde043 LIKE xrde_t.xrde043, 
   xrde043_desc LIKE type_t.chr500, 
   xrde044 LIKE xrde_t.xrde044, 
   xrde044_desc LIKE type_t.chr500, 
   xrde045 LIKE xrde_t.xrde045, 
   xrde045_desc LIKE type_t.chr500, 
   xrde046 LIKE xrde_t.xrde046, 
   xrde046_desc LIKE type_t.chr500, 
   xrde047 LIKE xrde_t.xrde047, 
   xrde047_desc LIKE type_t.chr500, 
   xrde048 LIKE xrde_t.xrde048, 
   xrde048_desc LIKE type_t.chr500, 
   xrde049 LIKE xrde_t.xrde049, 
   xrde049_desc LIKE type_t.chr500, 
   xrde050 LIKE xrde_t.xrde050, 
   xrde050_desc LIKE type_t.chr500, 
   xrde051 LIKE xrde_t.xrde051, 
   xrde051_desc LIKE type_t.chr500
       END RECORD
PRIVATE TYPE type_g_xrde4_d RECORD
       xrceseq LIKE xrce_t.xrceseq, 
   xrce002 LIKE xrce_t.xrce002, 
   xrce003 LIKE xrce_t.xrce003, 
   xrce004 LIKE xrce_t.xrce004, 
   xrce005 LIKE xrce_t.xrce005, 
   xrce054 LIKE xrce_t.xrce054, 
   xrcc003 LIKE xrcc_t.xrcc003, 
   xrca057 LIKE type_t.chr20, 
   xrca057_desc LIKE type_t.chr500, 
   xrce010 LIKE xrce_t.xrce010, 
   xrce016 LIKE xrce_t.xrce016, 
   xrce016_desc LIKE type_t.chr500, 
   xrce100 LIKE xrce_t.xrce100, 
   xrce101 LIKE xrce_t.xrce101, 
   xrcc108 LIKE type_t.num20_6, 
   xrcc118 LIKE type_t.num20_6, 
   xrce109 LIKE xrce_t.xrce109, 
   xrce119 LIKE xrce_t.xrce119, 
   xrce001 LIKE xrce_t.xrce001, 
   xrcecomp LIKE xrce_t.xrcecomp, 
   xrcesite LIKE xrce_t.xrcesite, 
   xrceorga LIKE xrce_t.xrceorga, 
   xrce027 LIKE xrce_t.xrce027, 
   xrce015 LIKE xrce_t.xrce015, 
   xrce015_desc LIKE type_t.chr500
       END RECORD
PRIVATE TYPE type_g_xrde5_d RECORD
       xrceseq LIKE xrce_t.xrceseq, 
   xrce120 LIKE xrce_t.xrce120, 
   xrce121 LIKE xrce_t.xrce121, 
   xrce129 LIKE xrce_t.xrce129, 
   xrce130 LIKE xrce_t.xrce130, 
   xrce131 LIKE xrce_t.xrce131, 
   xrce139 LIKE xrce_t.xrce139
       END RECORD
PRIVATE TYPE type_g_xrde6_d RECORD
       xrceseq LIKE xrce_t.xrceseq, 
   l_xrce016 LIKE type_t.chr500, 
   xrce017 LIKE xrce_t.xrce017, 
   xrce017_desc LIKE type_t.chr500, 
   xrce018 LIKE xrce_t.xrce018, 
   xrce018_desc LIKE type_t.chr500, 
   xrce019 LIKE xrce_t.xrce019, 
   xrce019_desc LIKE type_t.chr500, 
   xrce035 LIKE xrce_t.xrce035, 
   xrce035_desc LIKE type_t.chr500, 
   xrce036 LIKE xrce_t.xrce036, 
   xrce036_desc LIKE type_t.chr500, 
   xrce020 LIKE xrce_t.xrce020, 
   xrce020_desc LIKE type_t.chr500, 
   xrce022 LIKE xrce_t.xrce022, 
   xrce022_desc LIKE type_t.chr500, 
   xrce023 LIKE xrce_t.xrce023, 
   xrce023_desc LIKE type_t.chr500, 
   xrce039 LIKE xrce_t.xrce039, 
   xrce040 LIKE xrce_t.xrce040, 
   xrce040_desc LIKE type_t.chr500, 
   xrce042 LIKE xrce_t.xrce042, 
   xrce042_desc LIKE type_t.chr500, 
   xrce043 LIKE xrce_t.xrce043, 
   xrce043_desc LIKE type_t.chr500, 
   xrce044 LIKE xrce_t.xrce044, 
   xrce044_desc LIKE type_t.chr500, 
   xrce045 LIKE xrce_t.xrce045, 
   xrce045_desc LIKE type_t.chr500, 
   xrce046 LIKE xrce_t.xrce046, 
   xrce046_desc LIKE type_t.chr500, 
   xrce047 LIKE xrce_t.xrce047, 
   xrce047_desc LIKE type_t.chr500, 
   xrce048 LIKE xrce_t.xrce048, 
   xrce048_desc LIKE type_t.chr500, 
   xrce049 LIKE xrce_t.xrce049, 
   xrce049_desc LIKE type_t.chr500, 
   xrce050 LIKE xrce_t.xrce050, 
   xrce050_desc LIKE type_t.chr500, 
   xrce051 LIKE xrce_t.xrce051, 
   xrce051_desc LIKE type_t.chr500
       END RECORD
 
 
PRIVATE TYPE type_browser RECORD
         b_statepic     LIKE type_t.chr50,
            b_xrdadocdt LIKE xrda_t.xrdadocdt,
      b_xrda005 LIKE xrda_t.xrda005,
   b_xrda005_desc LIKE type_t.chr80,
      b_xrdadocno LIKE xrda_t.xrdadocno,
   b_xrdadocno_desc LIKE type_t.chr80,
      b_xrda014 LIKE xrda_t.xrda014,
      b_xrdasite LIKE xrda_t.xrdasite,
   b_xrdasite_desc LIKE type_t.chr80,
      b_xrda003 LIKE xrda_t.xrda003,
   b_xrda003_desc LIKE type_t.chr80,
      b_xrdald LIKE xrda_t.xrdald,
   b_xrdald_desc LIKE type_t.chr80
       END RECORD
       
#add-point:自定義模組變數(Module Variable) (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="global.variable"
DEFINE g_glaa_t              RECORD LIKE glaa_t.*
DEFINE g_xrde_t              RECORD LIKE xrde_t.*
DEFINE g_amt                 LIKE type_t.num20_6

#是否做自由科目核算项管理
DEFINE g_glad017        LIKE glad_t.glad017
DEFINE g_glad0171       LIKE glad_t.glad0171 
DEFINE g_glad0172       LIKE glad_t.glad0172 
DEFINE g_glad018        LIKE glad_t.glad018
DEFINE g_glad0181       LIKE glad_t.glad0181
DEFINE g_glad0182       LIKE glad_t.glad0182
DEFINE g_glad019        LIKE glad_t.glad019
DEFINE g_glad0191       LIKE glad_t.glad0191
DEFINE g_glad0192       LIKE glad_t.glad0192
DEFINE g_glad020        LIKE glad_t.glad020
DEFINE g_glad0201       LIKE glad_t.glad0201
DEFINE g_glad0202       LIKE glad_t.glad0202
DEFINE g_glad021        LIKE glad_t.glad021
DEFINE g_glad0211       LIKE glad_t.glad0211
DEFINE g_glad0212       LIKE glad_t.glad0212
DEFINE g_glad022        LIKE glad_t.glad022
DEFINE g_glad0221       LIKE glad_t.glad0221
DEFINE g_glad0222       LIKE glad_t.glad0222
DEFINE g_glad023        LIKE glad_t.glad023
DEFINE g_glad0231       LIKE glad_t.glad0231
DEFINE g_glad0232       LIKE glad_t.glad0232
DEFINE g_glad024        LIKE glad_t.glad024
DEFINE g_glad0241       LIKE glad_t.glad0241
DEFINE g_glad0242       LIKE glad_t.glad0242
DEFINE g_glad025        LIKE glad_t.glad025
DEFINE g_glad0251       LIKE glad_t.glad0251
DEFINE g_glad0252       LIKE glad_t.glad0252
DEFINE g_glad026        LIKE glad_t.glad026
DEFINE g_glad0261       LIKE glad_t.glad0261
DEFINE g_glad0262       LIKE glad_t.glad0262
DEFINE g_glae009        LIKE glae_t.glae009
DEFINE g_glae002        LIKE glae_t.glae002

DEFINE g_amt1_d         LIKE xrde_t.xrde109
DEFINE g_amt2_d         LIKE xrde_t.xrde109
DEFINE g_amt3_c         LIKE xrde_t.xrde109
DEFINE g_amt4_c         LIKE xrde_t.xrde109
DEFINE g_amt5_diff      LIKE xrde_t.xrde109
DEFINE g_amt6_diff      LIKE xrde_t.xrde109
DEFINE g_amt1_d_1       LIKE xrde_t.xrde109
DEFINE g_amt2_d_1       LIKE xrde_t.xrde109
DEFINE g_amt3_c_1       LIKE xrde_t.xrde109
DEFINE g_amt4_c_1       LIKE xrde_t.xrde109
DEFINE g_amt5_diff_1    LIKE xrde_t.xrde109
DEFINE g_amt6_diff_1    LIKE xrde_t.xrde109
DEFINE g_para_data      LIKE type_t.chr80     #應收模組關賬日期
DEFINE g_wc3            STRING   #150820-00015#3
DEFINE g_sql_ctrl       STRING                #151231-00010#2
DEFINE g_sql_ctr2       STRING                #151231-00010#2
DEFINE g_sql_bank       STRING                #160122-00001#5   
DEFINE g_site_str       STRING                #160125-00005#9 Add
#end add-point
       
#模組變數(Module Variables)
DEFINE g_xrda_m          type_g_xrda_m
DEFINE g_xrda_m_t        type_g_xrda_m
DEFINE g_xrda_m_o        type_g_xrda_m
DEFINE g_xrda_m_mask_o   type_g_xrda_m #轉換遮罩前資料
DEFINE g_xrda_m_mask_n   type_g_xrda_m #轉換遮罩後資料
 
   DEFINE g_xrdald_t LIKE xrda_t.xrdald
DEFINE g_xrdadocno_t LIKE xrda_t.xrdadocno
 
 
DEFINE g_xrde_d          DYNAMIC ARRAY OF type_g_xrde_d
DEFINE g_xrde_d_t        type_g_xrde_d
DEFINE g_xrde_d_o        type_g_xrde_d
DEFINE g_xrde_d_mask_o   DYNAMIC ARRAY OF type_g_xrde_d #轉換遮罩前資料
DEFINE g_xrde_d_mask_n   DYNAMIC ARRAY OF type_g_xrde_d #轉換遮罩後資料
DEFINE g_xrde2_d          DYNAMIC ARRAY OF type_g_xrde2_d
DEFINE g_xrde2_d_t        type_g_xrde2_d
DEFINE g_xrde2_d_o        type_g_xrde2_d
DEFINE g_xrde2_d_mask_o   DYNAMIC ARRAY OF type_g_xrde2_d #轉換遮罩前資料
DEFINE g_xrde2_d_mask_n   DYNAMIC ARRAY OF type_g_xrde2_d #轉換遮罩後資料
DEFINE g_xrde3_d          DYNAMIC ARRAY OF type_g_xrde3_d
DEFINE g_xrde3_d_t        type_g_xrde3_d
DEFINE g_xrde3_d_o        type_g_xrde3_d
DEFINE g_xrde3_d_mask_o   DYNAMIC ARRAY OF type_g_xrde3_d #轉換遮罩前資料
DEFINE g_xrde3_d_mask_n   DYNAMIC ARRAY OF type_g_xrde3_d #轉換遮罩後資料
DEFINE g_xrde4_d          DYNAMIC ARRAY OF type_g_xrde4_d
DEFINE g_xrde4_d_t        type_g_xrde4_d
DEFINE g_xrde4_d_o        type_g_xrde4_d
DEFINE g_xrde4_d_mask_o   DYNAMIC ARRAY OF type_g_xrde4_d #轉換遮罩前資料
DEFINE g_xrde4_d_mask_n   DYNAMIC ARRAY OF type_g_xrde4_d #轉換遮罩後資料
DEFINE g_xrde5_d          DYNAMIC ARRAY OF type_g_xrde5_d
DEFINE g_xrde5_d_t        type_g_xrde5_d
DEFINE g_xrde5_d_o        type_g_xrde5_d
DEFINE g_xrde5_d_mask_o   DYNAMIC ARRAY OF type_g_xrde5_d #轉換遮罩前資料
DEFINE g_xrde5_d_mask_n   DYNAMIC ARRAY OF type_g_xrde5_d #轉換遮罩後資料
DEFINE g_xrde6_d          DYNAMIC ARRAY OF type_g_xrde6_d
DEFINE g_xrde6_d_t        type_g_xrde6_d
DEFINE g_xrde6_d_o        type_g_xrde6_d
DEFINE g_xrde6_d_mask_o   DYNAMIC ARRAY OF type_g_xrde6_d #轉換遮罩前資料
DEFINE g_xrde6_d_mask_n   DYNAMIC ARRAY OF type_g_xrde6_d #轉換遮罩後資料
 
 
DEFINE g_browser         DYNAMIC ARRAY OF type_browser
DEFINE g_browser_f       DYNAMIC ARRAY OF type_browser
 
 
DEFINE g_wc                  STRING
DEFINE g_wc_t                STRING
DEFINE g_wc2                 STRING                          #單身CONSTRUCT結果
DEFINE g_wc2_table1          STRING
DEFINE g_wc2_table2   STRING
 
 
 
DEFINE g_wc2_extend          STRING
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING
 
DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10     
DEFINE g_jump                LIKE type_t.num10        
DEFINE g_no_ask              LIKE type_t.num5        
DEFINE g_rec_b               LIKE type_t.num10           
DEFINE l_ac                  LIKE type_t.num10    
DEFINE g_curr_diag           ui.Dialog                         #Current Dialog
                                                               
DEFINE g_pagestart           LIKE type_t.num10                 
DEFINE gwin_curr             ui.Window                         #Current Window
DEFINE gfrm_curr             ui.Form                           #Current Form
DEFINE g_page_action         STRING                            #page action
DEFINE g_header_hidden       LIKE type_t.num5                  #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5                  #隱藏工作Panel
DEFINE g_page                STRING                            #第幾頁
DEFINE g_state               STRING       
DEFINE g_header_cnt          LIKE type_t.num10
DEFINE g_detail_cnt          LIKE type_t.num10                  #單身總筆數
DEFINE g_detail_idx          LIKE type_t.num10                  #單身目前所在筆數
DEFINE g_detail_idx_tmp      LIKE type_t.num10                  #單身目前所在筆數
DEFINE g_detail_idx2         LIKE type_t.num10                  #單身2目前所在筆數
DEFINE g_detail_idx_list     DYNAMIC ARRAY OF LIKE type_t.num10 #單身2目前所在筆數
DEFINE g_browser_cnt         LIKE type_t.num10                  #Browser總筆數
DEFINE g_browser_idx         LIKE type_t.num10                  #Browser目前所在筆數
DEFINE g_temp_idx            LIKE type_t.num10                  #Browser目前所在筆數(暫存用)
DEFINE g_order               STRING                             #查詢排序欄位
                                                        
DEFINE g_current_row         LIKE type_t.num10                  #Browser所在筆數
DEFINE g_current_sw          BOOLEAN                            #Browser所在筆數用開關
DEFINE g_current_page        LIKE type_t.num10                  #目前所在頁數
DEFINE g_insert              LIKE type_t.chr5                   #是否導到其他page
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys               DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak           DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_bfill               LIKE type_t.chr5              #是否刷新單身
DEFINE g_error_show          LIKE type_t.num5              #是否顯示筆數提示訊息
DEFINE g_master_insert       BOOLEAN                       #確認單頭資料是否寫入
 
DEFINE g_wc_frozen           STRING                        #凍結欄位使用
DEFINE g_chk                 BOOLEAN                       #助記碼判斷用
DEFINE g_aw                  STRING                        #確定當下點擊的單身
DEFINE g_default             BOOLEAN                       #是否有外部參數查詢
DEFINE g_log1                STRING                        #log用
DEFINE g_log2                STRING                        #log用
DEFINE g_loc                 LIKE type_t.chr5              #判斷游標所在位置
DEFINE g_add_browse          STRING                        #新增填充用WC
DEFINE g_update              BOOLEAN                       #確定單頭/身是否異動過
DEFINE g_idx_group           om.SaxAttributes              #頁籤群組
DEFINE g_master_commit       LIKE type_t.chr1              #確認單頭是否修改過
 
#add-point:自定義客戶專用模組變數(Module Variable) name="global.variable_customerization"

#end add-point
 
#add-point:傳入參數說明(global.argv) name="global.argv"

#end add-point
 
{</section>}
 
{<section id="axrt400.main" >}
#應用 a26 樣板自動產生(Version:7)
#+ 作業開始(主程式類型)
MAIN
   #add-point:main段define(客製用) name="main.define_customerization"
   
   #end add-point   
   #add-point:main段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="main.define"
   
   #end add-point   
   
   OPTIONS
   INPUT NO WRAP
   DEFER INTERRUPT
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
       
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("axr","")
 
   #add-point:作業初始化 name="main.init"
   #151231-00010#2(S)
   LET g_sql_ctrl = NULL
   CALL s_control_get_customer_sql('2',g_site,g_user,g_dept,'') RETURNING g_sub_success,g_sql_ctrl
   #151231-00010#2(E)
   #end add-point
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define name="main.define_sql"
   
   #end add-point
   LET g_forupd_sql = " SELECT xrdasite,'',xrda003,'',xrdald,'',xrdacomp,xrdadocno,'',xrda001,xrdadocdt, 
       xrda005,'',xrda004,'',xrda014,xrda006,xrdastus,xrda008,xrda010,xrda017,xrda007,xrda009,xrda015, 
       '',xrda016,xrdaownid,'',xrdaowndp,'',xrdacrtid,'',xrdacrtdp,'',xrdacrtdt,xrdamodid,'',xrdamoddt, 
       xrdacnfid,'',xrdacnfdt,'','','','','',''", 
                      " FROM xrda_t",
                      " WHERE xrdaent= ? AND xrdald=? AND xrdadocno=? FOR UPDATE"
   #add-point:SQL_define name="main.after_define_sql"
   
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)                #轉換不同資料庫語法
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE axrt400_cl CURSOR FROM g_forupd_sql                 # LOCK CURSOR
 
   LET g_sql = " SELECT DISTINCT t0.xrdasite,t0.xrda003,t0.xrdald,t0.xrdacomp,t0.xrdadocno,t0.xrda001, 
       t0.xrdadocdt,t0.xrda005,t0.xrda004,t0.xrda014,t0.xrda006,t0.xrdastus,t0.xrda008,t0.xrda010,t0.xrda017, 
       t0.xrda007,t0.xrda009,t0.xrda015,t0.xrda016,t0.xrdaownid,t0.xrdaowndp,t0.xrdacrtid,t0.xrdacrtdp, 
       t0.xrdacrtdt,t0.xrdamodid,t0.xrdamoddt,t0.xrdacnfid,t0.xrdacnfdt,t1.ooefl003 ,t2.ooag011 ,t3.glaal002 , 
       t4.ooefl003 ,t5.pmaal004 ,t6.pmaal004 ,t7.oocql004 ,t8.ooag011 ,t9.ooefl003 ,t10.ooag011 ,t11.ooefl003 , 
       t12.ooag011 ,t13.ooag011",
               " FROM xrda_t t0",
                              " LEFT JOIN ooefl_t t1 ON t1.ooeflent="||g_enterprise||" AND t1.ooefl001=t0.xrdasite AND t1.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t2 ON t2.ooagent="||g_enterprise||" AND t2.ooag001=t0.xrda003  ",
               " LEFT JOIN glaal_t t3 ON t3.glaalent="||g_enterprise||" AND t3.glaalld=t0.xrdald AND t3.glaal001='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t4 ON t4.ooeflent="||g_enterprise||" AND t4.ooefl001=t0.xrdacomp AND t4.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t5 ON t5.pmaalent="||g_enterprise||" AND t5.pmaal001=t0.xrda005 AND t5.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN pmaal_t t6 ON t6.pmaalent="||g_enterprise||" AND t6.pmaal001=t0.xrda004 AND t6.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t7 ON t7.oocqlent="||g_enterprise||" AND t7.oocql001='3115' AND t7.oocql002=t0.xrda015 AND t7.oocql003='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t8 ON t8.ooagent="||g_enterprise||" AND t8.ooag001=t0.xrdaownid  ",
               " LEFT JOIN ooefl_t t9 ON t9.ooeflent="||g_enterprise||" AND t9.ooefl001=t0.xrdaowndp AND t9.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t10 ON t10.ooagent="||g_enterprise||" AND t10.ooag001=t0.xrdacrtid  ",
               " LEFT JOIN ooefl_t t11 ON t11.ooeflent="||g_enterprise||" AND t11.ooefl001=t0.xrdacrtdp AND t11.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t12 ON t12.ooagent="||g_enterprise||" AND t12.ooag001=t0.xrdamodid  ",
               " LEFT JOIN ooag_t t13 ON t13.ooagent="||g_enterprise||" AND t13.ooag001=t0.xrdacnfid  ",
 
               " WHERE t0.xrdaent = " ||g_enterprise|| " AND t0.xrdald = ? AND t0.xrdadocno = ?"
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   #add-point:SQL_define name="main.after_refresh_sql"
   
   #end add-point
   PREPARE axrt400_master_referesh FROM g_sql
 
    
 
   
   IF g_bgjob = "Y" THEN
      #add-point:Service Call name="main.servicecall"
      
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_axrt400 WITH FORM cl_ap_formpath("axr",g_code)
   
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
   
      #程式初始化
      CALL axrt400_init()   
 
      #進入選單 Menu (="N")
      CALL axrt400_ui_dialog() 
      
      #add-point:畫面關閉前 name="main.before_close"
      
      #end add-point
 
      #畫面關閉
      CLOSE WINDOW w_axrt400
      
   END IF 
   
   CLOSE axrt400_cl
   
   
 
   #add-point:作業離開前 name="main.exit"
   DROP TABLE s_vr_tmp04;    #160727-00019#37   16/08/12 By 08734      临时表长度超过15码的减少到15码以下 s_voucher_ar_tmp ——> s_vr_tmp04
   DROP TABLE s_vr_tmp05;    #160727-00019#37   16/08/15 By 08734      临时表长度超过15码的减少到15码以下 s_voucher_ar_group ——> s_vr_tmp05
   DROP TABLE s_voucher_glbc; 
   DROP TABLE s_pre_vr_tmp01;  #160727-00019#34   16/08/15 By 08734      临时表长度超过15码的减少到15码以下 s_pre_voucher_tmp ——> s_pre_vr_tmp01
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
END MAIN
 
 
 
 
{</section>}
 
{<section id="axrt400.init" >}
#+ 瀏覽頁簽資料初始化
PRIVATE FUNCTION axrt400_init()
   #add-point:init段define(客製用) name="init.define_customerization"
   
   #end add-point    
   #add-point:init段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="init.define"
   DEFINE l_sql      STRING
   DEFINE l_str      STRING
   DEFINE l_gzcb002  LIKE gzcb_t.gzcb002
   DEFINE l_success       LIKE type_t.num5
   #end add-point   
   
   #add-point:Function前置處理  name="init.pre_function"
   
   #end add-point
   
   LET g_bfill       = "Y"
   LET g_detail_idx  = 1 #第一層單身指標
   LET g_detail_idx2 = 1 #第二層單身指標
   
   #各個page指標
   LET g_detail_idx_list[1] = 1 
   LET g_detail_idx_list[2] = 1
   LET g_detail_idx_list[3] = 1
   LET g_detail_idx_list[4] = 1
   LET g_detail_idx_list[5] = 1
   LET g_detail_idx_list[6] = 1
 
   LET g_error_show  = 1
   LET l_ac = 1 #單身指標
      CALL cl_set_combo_scc_part('xrdastus','13','N,Y,A,D,R,W,X')
 
      CALL cl_set_combo_scc('xrda001','8307') 
   CALL cl_set_combo_scc('xrda007','8324') 
 
   LET gwin_curr = ui.Window.getCurrent()  #取得現行畫面
   LET gfrm_curr = gwin_curr.getForm()     #取出物件化後的畫面物件
   
   #page群組
   LET g_idx_group = om.SaxAttributes.create()
   CALL g_idx_group.addAttribute("'1','2','3',","1")
   CALL g_idx_group.addAttribute("'4','5','6',","1")
   CALL g_idx_group.addAttribute("","1")
   CALL g_idx_group.addAttribute("","1")
   CALL g_idx_group.addAttribute("","1")
   CALL g_idx_group.addAttribute("","1")
 
 
   #add-point:畫面資料初始化 name="init.init"
   CALL cl_set_combo_scc_part('xrda001','8307','41')
   #CALL cl_set_combo_scc('xrde006','8310')
   CALL cl_set_combo_scc('xrde039','6013')
   CALL cl_set_combo_scc('xrce039','6013')
   
   #xrde002下拉菜單取值,SCC_8306 AND gzcb004='1'
   LET l_sql = "SELECT gzcb002 FROM gzcb_t WHERE gzcb001 = '8306' AND gzcb004 = '1' AND gzcb006 LIKE '%axrt400%'"   #160509-00004#80 add AND gzcb006 LIKE '%axrt400%' lujh
   PREPARE axrt400_xrde002_prep FROM l_sql
   DECLARE axrt400_xrde002_curs CURSOR FOR axrt400_xrde002_prep
   LET l_str = Null
   LET l_gzcb002 = Null
   FOREACH axrt400_xrde002_curs INTO l_gzcb002
      IF cl_null(l_str) THEN LET l_str = l_gzcb002 CONTINUE FOREACH END IF
      LET l_str = l_str,",",l_gzcb002
   END FOREACH
   CALL cl_set_combo_scc_part('xrde002','8306',l_str)
   
   #xrce002下拉菜單取值,SCC_8306 AND gzcb004='2'
   LET l_str = Null
   LET l_gzcb002 = Null
   LET l_sql = "SELECT gzcb002 FROM gzcb_t WHERE gzcb001 = '8306' AND gzcb004 = '2' AND gzcb006 LIKE '%axrt400%'"   #160509-00004#80 add AND gzcb006 LIKE '%axrt400%' lujh
   PREPARE axrt400_xrce002_prep FROM l_sql
   DECLARE axrt400_xrce002_curs CURSOR FOR axrt400_xrce002_prep
   LET l_str = Null
   LET l_gzcb002 = Null
   FOREACH axrt400_xrce002_curs INTO l_gzcb002
      IF cl_null(l_str) THEN LET l_str = l_gzcb002 CONTINUE FOREACH END IF
      LET l_str = l_str,",",l_gzcb002
   END FOREACH
   CALL cl_set_combo_scc_part('xrce002','8306',l_str)
   CALL s_voucher_cre_ar_tmp_table() RETURNING l_success
   IF l_success = FALSE THEN 
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'axr-00311'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
   END IF
   
   CALL s_fin_create_account_center_tmp()   
   CALL s_axrt300_create_tmp()   #160909-00004#1 Add
   
   #xrce006下拉菜單取值,SCC_8310 AND gzcb002<>'ZZ'
   LET l_str = Null
   LET l_gzcb002 = Null
   LET l_sql = "SELECT gzcb002 FROM gzcb_t WHERE gzcb001 = '8310' AND gzcb002 <> 'ZZ'"
   PREPARE axrt400_xrce006_prep FROM l_sql
   DECLARE axrt400_xrce006_curs CURSOR FOR axrt400_xrce006_prep
   LET l_str = Null
   LET l_gzcb002 = Null
   FOREACH axrt400_xrce006_curs INTO l_gzcb002
      IF cl_null(l_str) THEN LET l_str = l_gzcb002 CONTINUE FOREACH END IF
      LET l_str = l_str,",",l_gzcb002
   END FOREACH
   CALL cl_set_combo_scc_part('xrde006','8310',l_str)
   CALL s_pre_voucher_cre_tmp_table() RETURNING l_success #151125-00006#1--add by aiqq  
   CALL s_aap_create_multi_bill_perod_tmp()   #160525-00011#1
   #160122-00001#5 --add--str--
   LET g_sql_bank=NULL
   CALL s_anmi120_get_bank_account_sql(g_user,g_dept) RETURNING g_sub_success,g_sql_bank
   #160122-00001#5 --add--end
   #end add-point
   
   #初始化搜尋條件
   CALL axrt400_default_search()
    
END FUNCTION
 
{</section>}
 
{<section id="axrt400.ui_dialog" >}
#+ 功能選單
PRIVATE FUNCTION axrt400_ui_dialog()
   #add-point:ui_dialog段define(客製用) name="ui_dialog.define_customerization"
   
   #end add-point
   DEFINE li_idx     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE lb_first   BOOLEAN
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE la_param   RECORD
          prog       STRING,
          actionid   STRING,
          background LIKE type_t.chr1,
          param      DYNAMIC ARRAY OF STRING
          END RECORD
   DEFINE ls_js      STRING
   DEFINE la_output  DYNAMIC ARRAY OF STRING   #報表元件鬆耦合使用
   DEFINE  l_cmd_token           base.StringTokenizer   #報表作業cmdrun使用 
   DEFINE  l_cmd_next            STRING                 #報表作業cmdrun使用
   DEFINE  l_cmd_cnt             LIKE type_t.num5       #報表作業cmdrun使用
   DEFINE  l_cmd_prog_arg        STRING                 #報表作業cmdrun使用
   DEFINE  l_cmd_arg             STRING                 #報表作業cmdrun使用
   #add-point:ui_dialog段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_dialog.define"
   DEFINE l_slip            LIKE xrca_t.xrcadocno
   DEFINE l_success         LIKE type_t.num5
   DEFINE l_glaa024         LIKE glaa_t.glaa024
   DEFINE l_ooac004         LIKE ooac_t.ooac004
  #150416-00004#3 Add  ---(S)---
   DEFINE l_glap001         LIKE glap_t.glap001
   DEFINE l_nmba003         LIKE nmba_t.nmba003
   DEFINE l_gzcb005         LIKE gzcb_t.gzcb005
  #150416-00004#3 Add  ---(E)---
  #151125-00006#1 add ---s 
   DEFINE l_cn              LIKE type_t.num5
  #151125-00006#1 add ---e
   #160104-00007#7(S)
   DEFINE la_param1  RECORD
             glaald  LIKE glaa_t.glaald,
             type	   LIKE type_t.chr10,
             wc      STRING
                 END RECORD
   DEFINE l_glapstus LIKE glap_t.glapstus
   DEFINE l_glapdocdt LIKE glap_t.glapdocdt
   DEFINE l_glaa013 LIKE glaa_t.glaa013
   #160104-00007#7(E)  
   #end add-point
   
   #add-point:Function前置處理  name="ui_dialog.pre_function"
   
   #end add-point
   
   CALL cl_set_act_visible("accept,cancel", FALSE)
 
   #因應查詢方案進行處理
   IF g_default THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   ELSE
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF
   
   #action default動作
   #應用 a42 樣板自動產生(Version:3)
   #進入程式時預設執行的動作
   CASE g_actdefault
      WHEN "insert"
         LET g_action_choice="insert"
         LET g_actdefault = ""
         IF cl_auth_chk_act("insert") THEN
            CALL axrt400_insert()
            #add-point:ON ACTION insert name="menu.default.insert"
            
            #END add-point
         END IF
 
      #add-point:action default自訂 name="ui_dialog.action_default"
      
      #end add-point
      OTHERWISE
   END CASE
 
 
 
   
   LET lb_first = TRUE
   
   #add-point:ui_dialog段before dialog  name="ui_dialog.before_dialog"
   
   #end add-point
   
   WHILE TRUE 
   
      IF g_action_choice = "logistics" THEN
         #清除畫面及相關資料
         CLEAR FORM
         CALL g_browser.clear()       
         INITIALIZE g_xrda_m.* TO NULL
         CALL g_xrde_d.clear()
         CALL g_xrde2_d.clear()
         CALL g_xrde3_d.clear()
         CALL g_xrde4_d.clear()
         CALL g_xrde5_d.clear()
         CALL g_xrde6_d.clear()
 
         LET g_wc  = ' 1=2'
         LET g_wc2 = ' 1=1'
         LET g_action_choice = ""
         CALL axrt400_init()
      END IF
   
      CALL lib_cl_dlg.cl_dlg_before_display()
            
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
         #左側瀏覽頁簽
         DISPLAY ARRAY g_browser TO s_browse.* ATTRIBUTES(COUNT=g_header_cnt)
            BEFORE ROW
               #回歸舊筆數位置 (回到當時異動的筆數)
               LET g_current_idx = DIALOG.getCurrentRow("s_browse")
               IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                  LET g_current_idx = g_current_row
               END IF
               LET g_current_row = g_current_idx #目前指標
               LET g_current_sw = TRUE
         
               IF g_current_idx > g_browser.getLength() THEN
                  LET g_current_idx = g_browser.getLength()
               END IF 
               
               CALL axrt400_fetch('') # reload data
               LET l_ac = 1
               CALL axrt400_ui_detailshow() #Setting the current row 
         
               CALL axrt400_idx_chk()
               #NEXT FIELD xrdeseq
         
               ON ACTION qbefield_user   #欄位隱藏設定 
                  LET g_action_choice="qbefield_user"
                  CALL cl_ui_qbefield_user()
         END DISPLAY
    
         DISPLAY ARRAY g_xrde_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) #page1  
    
            BEFORE ROW
               #顯示單身筆數
               CALL axrt400_idx_chk()
               #確定當下選擇的筆數
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[1] = l_ac
               CALL g_idx_group.addAttribute("'1','2','3',",l_ac)
               
               #add-point:page1, before row動作 name="ui_dialog.page1.before_row"
               
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'1','2','3',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_current_page = 1
               #顯示單身筆數
               CALL axrt400_idx_chk()
               #add-point:page1自定義行為 name="ui_dialog.page1.before_display"
               
               #end add-point
               
            #自訂ACTION(detail_show,page_1)
            
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION detail_qrystr
               MENU "" ATTRIBUTE(STYLE="popup")
                  #add-point:ON ACTION detail_qrystr相關動作 name="menu.detail_show.page1_sub.detail_qrystr"
                  #150416-00004#3 Add  ---(S)---
                  BEFORE MENU
                     IF l_ac < 1 OR cl_null(l_ac) THEN
                        EXIT MENU
                     END IF
                     IF cl_null(g_xrde_d[l_ac].xrde003) THEN
                        EXIT MENU
                     END IF
                     LET l_nmba003 = NULL
                     SELECT nmba003 INTO l_nmba003 FROM nmba_t WHERE nmbaent = g_enterprise
                        AND nmbadocno = g_xrde_d[l_ac].xrde003
                        AND nmbacomp  = g_xrde_d[l_ac].xrdecomp
                     HIDE OPTION l_nmba003
                  #150416-00004#3 Add  ---(E)---
                  #END add-point
                                 #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_anmt540
                  LET g_action_choice="prog_anmt540"
                  IF cl_auth_chk_act("prog_anmt540") THEN
                     
                     #add-point:ON ACTION prog_anmt540 name="menu.detail_show.page1_sub.prog_anmt540"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'anmt540'
                     LET la_param.param[1] = g_xrde_d[l_ac].xrdecomp
                     LET la_param.param[2] = g_xrde_d[l_ac].xrde003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_anmt550
                  LET g_action_choice="prog_anmt550"
                  IF cl_auth_chk_act("prog_anmt550") THEN
                     
                     #add-point:ON ACTION prog_anmt550 name="menu.detail_show.page1_sub.prog_anmt550"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'anmt540'
                     LET la_param.param[1] = g_xrde_d[l_ac].xrdecomp
                     LET la_param.param[2] = g_xrde_d[l_ac].xrde003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
 
               END MENU
 
 
 
               #add-point:ON ACTION detail_qrystr name="menu.detail_show.page1.detail_qrystr"
               
               #END add-point
 
 
 
 
               
            #add-point:page1自定義行為 name="ui_dialog.page1.action"
            
            #end add-point
               
         END DISPLAY
        
         #第一階單身段落
         DISPLAY ARRAY g_xrde2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL axrt400_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[2] = l_ac
               CALL g_idx_group.addAttribute("'4','5','6',",l_ac)
               
               #add-point:page2, before row動作 name="ui_dialog.body2.before_row"
               
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'4','5','6',"))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_current_page = 2
               #顯示單身筆數
               CALL axrt400_idx_chk()
               #add-point:page2自定義行為 name="ui_dialog.body2.before_display"
               
               #end add-point
      
            #自訂ACTION(detail_show,page_2)
            
         
            #add-point:page2自定義行為 name="ui_dialog.body2.action"
            
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_xrde3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL axrt400_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[3] = l_ac
               CALL g_idx_group.addAttribute("",l_ac)
               
               #add-point:page3, before row動作 name="ui_dialog.body3.before_row"
               
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail3")
               LET g_current_page = 3
               #顯示單身筆數
               CALL axrt400_idx_chk()
               #add-point:page3自定義行為 name="ui_dialog.body3.before_display"
               
               #end add-point
      
            #自訂ACTION(detail_show,page_3)
            
         
            #add-point:page3自定義行為 name="ui_dialog.body3.action"
            
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_xrde4_d TO s_detail4.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL axrt400_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[4] = l_ac
               CALL g_idx_group.addAttribute("",l_ac)
               
               #add-point:page4, before row動作 name="ui_dialog.body4.before_row"
               
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail4")
               LET g_current_page = 4
               #顯示單身筆數
               CALL axrt400_idx_chk()
               #add-point:page4自定義行為 name="ui_dialog.body4.before_display"
               
               #end add-point
      
            #自訂ACTION(detail_show,page_4)
            
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION detail_qrystr
               MENU "" ATTRIBUTE(STYLE="popup")
                  #add-point:ON ACTION detail_qrystr相關動作 name="menu.detail_show.page4_sub.detail_qrystr"
                  #150416-00004#3 Add  ---(S)---
                  BEFORE MENU
                     IF l_ac < 1 OR cl_null(l_ac) THEN
                        EXIT MENU
                     END IF
                     IF cl_null(g_xrde4_d[l_ac].xrce003) THEN
                        EXIT MENU
                     END IF
                     LET l_gzcb005 = NULL
                     SELECT gzcb005 INTO l_gzcb005 FROM gzcb_t
                      WHERE gzcb001 = '8302' AND gzcb001 
                            IN (SELECT xrca001 FROM xrca_t WHERE xrcaent = g_enterprise
                                   AND xrcald = g_xrda_m.xrdald AND xrcadocno = g_xrde4_d[l_ac].xrce003)
                     HIDE OPTION ALL
                     SHOW OPTION l_gzcb005
                  #150416-00004#3 Add  ---(E)---
                  #END add-point
                                 #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrt300
                  LET g_action_choice="prog_axrt300"
                  IF cl_auth_chk_act("prog_axrt300") THEN
                     
                     #add-point:ON ACTION prog_axrt300 name="menu.detail_show.page4_sub.prog_axrt300"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrt300'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrt320
                  LET g_action_choice="prog_axrt320"
                  IF cl_auth_chk_act("prog_axrt320") THEN
                     
                     #add-point:ON ACTION prog_axrt320 name="menu.detail_show.page4_sub.prog_axrt320"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrt320'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrt330
                  LET g_action_choice="prog_axrt330"
                  IF cl_auth_chk_act("prog_axrt330") THEN
                     
                     #add-point:ON ACTION prog_axrt330 name="menu.detail_show.page4_sub.prog_axrt330"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrt330'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrt340
                  LET g_action_choice="prog_axrt340"
                  IF cl_auth_chk_act("prog_axrt340") THEN
                     
                     #add-point:ON ACTION prog_axrt340 name="menu.detail_show.page4_sub.prog_axrt340"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrt340'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrt341
                  LET g_action_choice="prog_axrt341"
                  IF cl_auth_chk_act("prog_axrt341") THEN
                     
                     #add-point:ON ACTION prog_axrt341 name="menu.detail_show.page4_sub.prog_axrt341"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrt341'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrq342
                  LET g_action_choice="prog_axrq342"
                  IF cl_auth_chk_act("prog_axrq342") THEN
                     
                     #add-point:ON ACTION prog_axrq342 name="menu.detail_show.page4_sub.prog_axrq342"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrq342'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrq343
                  LET g_action_choice="prog_axrq343"
                  IF cl_auth_chk_act("prog_axrq343") THEN
                     
                     #add-point:ON ACTION prog_axrq343 name="menu.detail_show.page4_sub.prog_axrq343"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrq343'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
               #應用 a43 樣板自動產生(Version:4)
               ON ACTION prog_axrt310
                  LET g_action_choice="prog_axrt310"
                  IF cl_auth_chk_act("prog_axrt310") THEN
                     
                     #add-point:ON ACTION prog_axrt310 name="menu.detail_show.page4_sub.prog_axrt310"
                     INITIALIZE la_param.* TO NULL
                     LET la_param.prog     = 'axrt310'
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[1] = g_xrde4_d[l_ac].xrce003
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js)
                     #END add-point
                     
                  END IF
 
 
 
 
               END MENU
 
 
 
               #add-point:ON ACTION detail_qrystr name="menu.detail_show.page4.detail_qrystr"
               
               #END add-point
 
 
 
 
         
            #add-point:page4自定義行為 name="ui_dialog.body4.action"
            
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_xrde5_d TO s_detail5.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL axrt400_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail5")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[5] = l_ac
               CALL g_idx_group.addAttribute("",l_ac)
               
               #add-point:page5, before row動作 name="ui_dialog.body5.before_row"
               
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail5")
               LET g_current_page = 5
               #顯示單身筆數
               CALL axrt400_idx_chk()
               #add-point:page5自定義行為 name="ui_dialog.body5.before_display"
               
               #end add-point
      
            #自訂ACTION(detail_show,page_5)
            
         
            #add-point:page5自定義行為 name="ui_dialog.body5.action"
            
            #end add-point
         
         END DISPLAY
         #第一階單身段落
         DISPLAY ARRAY g_xrde6_d TO s_detail6.* ATTRIBUTES(COUNT=g_rec_b)  
    
            BEFORE ROW
               #顯示單身筆數
               CALL axrt400_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail6")
               LET g_detail_idx = l_ac
               LET g_detail_idx_list[6] = l_ac
               CALL g_idx_group.addAttribute("",l_ac)
               
               #add-point:page6, before row動作 name="ui_dialog.body6.before_row"
               
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail6")
               LET g_current_page = 6
               #顯示單身筆數
               CALL axrt400_idx_chk()
               #add-point:page6自定義行為 name="ui_dialog.body6.before_display"
               
               #end add-point
      
            #自訂ACTION(detail_show,page_6)
            
         
            #add-point:page6自定義行為 name="ui_dialog.body6.action"
            
            #end add-point
         
         END DISPLAY
 
         
 
         
         #add-point:ui_dialog段自定義display array name="ui_dialog.more_displayarray"
         
         #end add-point
         
         SUBDIALOG lib_cl_dlg.cl_dlg_qryplan
         SUBDIALOG lib_cl_dlg.cl_dlg_relateapps
      
         BEFORE DIALOG
            #先填充browser資料
            CALL axrt400_browser_fill("")
            CALL cl_notice()
            CALL cl_navigator_setting(g_current_idx, g_detail_cnt)
            LET g_curr_diag = ui.DIALOG.getCurrent()
            LET g_current_sw = FALSE
            #回歸舊筆數位置 (回到當時異動的筆數)
            LET g_current_idx = DIALOG.getCurrentRow("s_browse")
            IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
               CALL DIALOG.setCurrentRow("s_browse",g_current_row)
               LET g_current_idx = g_current_row
            END IF
            
            #確保g_current_idx位於正常區間內
            #小於,等於0則指到第1筆
            IF g_current_idx <= 0 THEN
               LET g_current_idx = 1
            END IF
            #超過最大筆數則指到最後1筆
            IF g_current_idx > g_browser.getLength() THEN
               LEt g_current_idx = g_browser.getLength()
            END IF 
            
            LET g_current_sw = TRUE
            LET g_current_row = g_current_idx #目前指標
            
            #有資料才進行fetch
            IF g_current_idx <> 0 THEN
               CALL axrt400_fetch('') # reload data
            END IF
            #LET g_detail_idx = 1
            CALL axrt400_ui_detailshow() #Setting the current row 
            
            #筆數顯示
            LET g_current_page = 1
            CALL axrt400_idx_chk()
            CALL cl_ap_performance_cal()
            #add-point:ui_dialog段before_dialog2 name="ui_dialog.before_dialog2"
            
            #end add-point
 
         #add-point:ui_dialog段more_action name="ui_dialog.more_action"
         
         #end add-point
 
         #狀態碼切換
         ON ACTION statechange
            LET g_action_choice = "statechange"
            CALL axrt400_statechange()
            #根據資料狀態切換action狀態
            CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
            CALL axrt400_set_act_visible()   
            CALL axrt400_set_act_no_visible()
            IF NOT (g_xrda_m.xrdald IS NULL
              OR g_xrda_m.xrdadocno IS NULL
 
              ) THEN
               #組合條件
               LET g_add_browse = " xrdaent = " ||g_enterprise|| " AND",
                                  " xrdald = '", g_xrda_m.xrdald, "' "
                                  ," AND xrdadocno = '", g_xrda_m.xrdadocno, "' "
 
               #填到對應位置
               CALL axrt400_browser_fill("")
            END IF
         #應用 a32 樣板自動產生(Version:3)
         #簽核狀況
         ON ACTION bpm_status
            #查詢簽核狀況, 統一建立HyperLink
            CALL cl_bpm_status()
            #add-point:ON ACTION bpm_status name="menu.bpm_status"
            
            #END add-point
 
 
 
          
         #查詢方案選擇 
         ON ACTION queryplansel
            CALL cl_dlg_qryplan_select() RETURNING ls_wc
            #不是空條件才寫入g_wc跟重新找資料
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "xrda_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "xrde_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "xrce_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
                  OR NOT cl_null(g_wc2_table2)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  #組合g_wc2
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
 
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
               END IF
               CALL axrt400_browser_fill("F")   #browser_fill()會將notice區塊清空
               CALL cl_notice()   #重新顯示,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            END IF
         
         #查詢方案選擇
         ON ACTION qbe_select
            CALL cl_qbe_list("m") RETURNING ls_wc
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
               INITIALIZE g_wc2_table2 TO NULL
 
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "xrda_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "xrde_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "xrce_t" 
                        LET g_wc2_table2 = la_wc[li_idx].wc
 
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1)
                  OR NOT cl_null(g_wc2_table2)
 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
                  IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
                  END IF
 
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
                  #取得條件後需要重查、跳到結果第一筆資料的功能程式段
                  CALL axrt400_browser_fill("F")
                  IF g_browser_cnt = 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "-100" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     CLEAR FORM
                  ELSE
                     CALL axrt400_fetch("F")
                  END IF
               END IF
            END IF
            #重新搜尋會將notice區塊清空,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            CALL cl_notice()
          
         #應用 a49 樣板自動產生(Version:4)
            #過濾瀏覽頁資料
            ON ACTION filter
               LET g_action_choice = "fetch"
               #add-point:filter action name="ui_dialog.action.filter"
               
               #end add-point
               CALL axrt400_filter()
               EXIT DIALOG
 
 
 
         
         ON ACTION first
            LET g_action_choice = "fetch"
            CALL axrt400_fetch('F')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL axrt400_idx_chk()
            
         ON ACTION previous
            LET g_action_choice = "fetch"
            CALL axrt400_fetch('P')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL axrt400_idx_chk()
            
         ON ACTION jump
            LET g_action_choice = "fetch"
            CALL axrt400_fetch('/')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL axrt400_idx_chk()
            
         ON ACTION next
            LET g_action_choice = "fetch"
            CALL axrt400_fetch('N')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL axrt400_idx_chk()
            
         ON ACTION last
            LET g_action_choice = "fetch"
            CALL axrt400_fetch('L')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL axrt400_idx_chk()
          
         #excel匯出功能          
         ON ACTION exporttoexcel
            LET g_action_choice="exporttoexcel"
            IF cl_auth_chk_act("exporttoexcel") THEN
               #browser
               CALL g_export_node.clear()
               IF g_main_hidden = 1 THEN
                  LET g_export_node[1] = base.typeInfo.create(g_browser)
                  LET g_export_id[1]   = "s_browse"
                  CALL cl_export_to_excel()
               #非browser
               ELSE
                  LET g_export_node[1] = base.typeInfo.create(g_xrde_d)
                  LET g_export_id[1]   = "s_detail1"
                  LET g_export_node[2] = base.typeInfo.create(g_xrde2_d)
                  LET g_export_id[2]   = "s_detail2"
                  LET g_export_node[3] = base.typeInfo.create(g_xrde3_d)
                  LET g_export_id[3]   = "s_detail3"
                  LET g_export_node[4] = base.typeInfo.create(g_xrde4_d)
                  LET g_export_id[4]   = "s_detail4"
                  LET g_export_node[5] = base.typeInfo.create(g_xrde5_d)
                  LET g_export_id[5]   = "s_detail5"
                  LET g_export_node[6] = base.typeInfo.create(g_xrde6_d)
                  LET g_export_id[6]   = "s_detail6"
 
                  #add-point:ON ACTION exporttoexcel name="menu.exporttoexcel"
                  
                  #END add-point
                  CALL cl_export_to_excel_getpage()
                  CALL cl_export_to_excel()
               END IF
            END IF
        
         ON ACTION close
            LET INT_FLAG = FALSE
            LET g_action_choice = "exit"
            EXIT DIALOG
          
         ON ACTION exit
            LET g_action_choice = "exit"
            EXIT DIALOG
    
         #主頁摺疊
         ON ACTION mainhidden       
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
               CALL cl_notice()
            END IF
            
         #瀏覽頁折疊
         ON ACTION worksheethidden   
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF
            IF lb_first THEN
               LET lb_first = FALSE
               NEXT FIELD xrdeseq
            END IF
       
         #單頭摺疊，可利用hot key "Alt-s"開啟/關閉單頭
         ON ACTION controls     
            IF g_header_hidden THEN
               CALL gfrm_curr.setElementHidden("vb_master",0)
               CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
               LET g_header_hidden = 0     #visible
            ELSE
               CALL gfrm_curr.setElementHidden("vb_master",1)
               CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
               LET g_header_hidden = 1     #hidden     
            END IF
    
         
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL axrt400_modify()
               #add-point:ON ACTION modify name="menu.modify"
               CALL axrt400_ui_headershow()   #151125-00006#1--add
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify_detail
            LET g_action_choice="modify_detail"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = g_curr_diag.getCurrentItem()
               CALL axrt400_modify()
               #add-point:ON ACTION modify_detail name="menu.modify_detail"
               CALL axrt400_ui_headershow()   #151125-00006#1--add
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_pre
            LET g_action_choice="open_pre"
            IF cl_auth_chk_act("open_pre") THEN
               
               #add-point:ON ACTION open_pre name="menu.open_pre"
               CALL axrt400_ui_headershow()
               IF g_xrda_m.xrdastus <> 'N' THEN 
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'axr-00270'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
                     
                  EXIT DIALOG
               END IF
               
               CALL s_transaction_begin()
               CALL cl_err_collect_init()
               IF NOT cl_null(g_xrda_m.xrdadocno) THEN 
                  CALL s_pre_voucher_ins('AR','R20',g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,'2') RETURNING l_success
                  
                  IF l_success THEN
                     CALL s_transaction_end('Y','1')
                  ELSE
                     CALL s_transaction_end('N','1')     
                  END IF
                  CALL cl_err_collect_show() 
               END IF
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_axrp420
            LET g_action_choice="open_axrp420"
            IF cl_auth_chk_act("open_axrp420") THEN
               
               #add-point:ON ACTION open_axrp420 name="menu.open_axrp420"
               CALL axrt400_ui_headershow()
               IF g_xrda_m.xrdastus <> 'Y' THEN 
                  CONTINUE DIALOG
               END IF
               
               IF NOT cl_null(g_xrda_m.xrdadocno) THEN 
                  IF NOT cl_null(g_xrda_m.xrda014) THEN 
                     LET la_param.prog = "aglt310"
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[2] = g_xrda_m.xrda014
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun(ls_js)
                  ELSE
                     CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno)
                        RETURNING l_success,l_slip
                     
                     SELECT glaa024 INTO l_glaa024
                       FROM glaa_t
                      WHERE glaaent = g_enterprise
                        AND glaald = g_xrda_m.xrdald
                     
                     SELECT ooac004 INTO l_ooac004
                       FROM ooac_t
                      WHERE ooacent = g_enterprise
                        AND ooac001 = l_glaa024
                        AND ooac002 = l_slip
                        AND ooac003 = 'D-FIN-2002'
                      
                     LET la_param.prog = "axrp420"
                     LET la_param.param[1] = g_xrda_m.xrdald
                     LET la_param.param[2] = g_xrda_m.xrdadocno
                     LET la_param.param[3] = g_xrda_m.xrdasite
                     LET la_param.param[4] = l_ooac004
                     LET la_param.param[5] = g_xrda_m.xrdadocdt
                     LET ls_js = util.JSON.stringify(la_param)
                     CALL cl_cmdrun_wait(ls_js) 
                  END IF
                  
                  CALL axrt400_ui_headershow()
               END IF
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION update_abstract
            LET g_action_choice="update_abstract"
            IF cl_auth_chk_act("update_abstract") THEN
               
               #add-point:ON ACTION update_abstract name="menu.update_abstract"
               IF g_xrda_m.xrdastus = 'Y' THEN 
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'axr-00297'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
                     
                  EXIT DIALOG
               END IF 
               
               IF NOT cl_null(g_xrda_m.xrdadocno) THEN 
                  CALL axrt400_update_abstract()
               END IF
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION axrt400_01
            LET g_action_choice="axrt400_01"
            IF cl_auth_chk_act("axrt400_01") THEN
               
               #add-point:ON ACTION axrt400_01 name="menu.axrt400_01"
               IF NOT cl_null(g_xrda_m.xrdadocno) AND g_xrda_m.xrdastus = 'N' THEN 
                  CALL axrt400_01(g_xrda_m.xrdald,g_xrda_m.xrdasite,g_xrda_m.xrda004,g_xrda_m.xrda005,g_xrda_m.xrda003,g_xrda_m.xrdadocdt,g_xrda_m.xrdadocno)
                  CALL axrt400_ref_amt()     #151010-00001#1
                  CALL axrt400_b_fill()
               END IF
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL axrt400_delete()
               #add-point:ON ACTION delete name="menu.delete"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL axrt400_insert()
               #add-point:ON ACTION insert name="menu.insert"
               #add 151125-00006#1 --s
               LET l_cn = 0 
               SELECT COUNT(*) INTO l_cn FROM xrda_t 
                WHERE xrdald  = g_xrda_m.xrdald AND  xrdacomp = g_xrda_m.xrdacomp AND xrdadocno = g_xrda_m.xrdadocno
                  AND xrdaent = g_enterprise #160905-00002#5
               IF l_cn > 0 THEN
                  CALL axrt400_ui_headershow()
               END IF
               #add 151125-00006#1 --e
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output name="menu.output"
               LET g_rep_wc = " xrdaent = '",g_enterprise,"'  AND xrdald = '",g_xrda_m.xrdald,"' AND xrdadocno = '",g_xrda_m.xrdadocno,"' "
               #END add-point
               &include "erp/axr/axrt400_rep.4gl"
               #add-point:ON ACTION output.after
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL axrt400_query()
               #add-point:ON ACTION query name="menu.query"
               
               #END add-point
               #應用 a59 樣板自動產生(Version:3)  
               CALL g_curr_diag.setCurrentRow("s_detail1",1)
               CALL g_curr_diag.setCurrentRow("s_detail2",1)
               CALL g_curr_diag.setCurrentRow("s_detail3",1)
               CALL g_curr_diag.setCurrentRow("s_detail4",1)
               CALL g_curr_diag.setCurrentRow("s_detail5",1)
               CALL g_curr_diag.setCurrentRow("s_detail6",1)
 
 
 
 
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION axrt400_09
            LET g_action_choice="axrt400_09"
            IF cl_auth_chk_act("axrt400_09") THEN
               
               #add-point:ON ACTION axrt400_09 name="menu.axrt400_09"
               IF NOT cl_null(g_xrda_m.xrdadocno) THEN 
                  LET g_amt = 0
                  CALL axrt400_ref_amt()
                  IF g_amt <> 0 THEN
                     IF g_amt > 0 THEN
                        CALL axrt400_09('1',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
                     ELSE
                        LET g_amt = g_amt * -1
                        CALL axrt400_09('2',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
                     END IF
                     
                     CALL axrt400_show()
                  ELSE
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = ''
                     LET g_errparam.code   = 'axr-00175' 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     EXIT DIALOG
                  END IF 
               END IF                  
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_axrt300_13
            LET g_action_choice="open_axrt300_13"
            IF cl_auth_chk_act("open_axrt300_13") THEN
               
               #add-point:ON ACTION open_axrt300_13 name="menu.open_axrt300_13"
               IF NOT cl_null(g_xrda_m.xrdadocno) THEN 
                  IF g_glaa_t.glaa121 = 'Y' THEN 
                     CALL s_pre_voucher('AR','R20',g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt)
                  ELSE
                     CALL axrt300_13('AR',g_xrda_m.xrdald,g_xrda_m.xrdadocno,'2')
                  END IF
               END IF
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION open_axrp342
            LET g_action_choice="open_axrp342"
            IF cl_auth_chk_act("open_axrp342") THEN
               
               #add-point:ON ACTION open_axrp342 name="menu.open_axrp342"
               #160104-00007#7(S)
               SELECT glapstus,glapdocdt INTO l_glapstus,l_glapdocdt
                 FROM glap_t
                WHERE glapent = g_enterprise 
                  AND glapld = g_xrda_m.xrdald 
                  AND glapdocno = g_xrda_m.xrda014    
               SELECT glaa013 INTO l_glaa013
                 FROM glaa_t
                WHERE glaaent = g_enterprise 
                  AND glaald = g_apca_m.apcald
               CASE 
                   WHEN l_glapstus = 'Y' OR l_glapstus = 'S' OR cl_null(g_xrda_m.xrda014)  
                        INITIALIZE g_errparam TO NULL
                        CASE
                           WHEN l_glapstus = 'Y' OR l_glapstus = 'S' 
                               LET g_errparam.code   = 'axr-00076'
                           WHEN cl_null(g_xrda_m.xrda014) 
                               LET g_errparam.code   = 'aap-00093'
                               LET g_errparam.extend = s_fin_get_colname('','xrda014'),"=' '"
                        END CASE
                        LET g_errparam.popup = TRUE
                        CALL cl_err()
                   WHEN l_glapdocdt <= l_glaa013
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'aap-00077'
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        CALL cl_err()
                   OTHERWISE
                        LET la_param.prog = "axrp342" 
                        LET la_param.background = "Y"
                        LET la_param1.glaald = g_xrda_m.xrdald
                        LET la_param1.type   = "axrt400"
                        LET la_param1.wc     = " glapdocno = '",g_xrda_m.xrda014,"'" 
                        LET la_param.param[1] = util.JSON.stringify( la_param1 )
                        LET ls_js = util.JSON.stringify( la_param )
                        CALL cl_cmdrun(ls_js)
                        LET g_xrda_m.xrda014 = ''
                        DISPLAY BY NAME g_xrda_m.xrda014
               END CASE
               #160104-00007#7(E)
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION prog_xrda003
            LET g_action_choice="prog_xrda003"
            IF cl_auth_chk_act("prog_xrda003") THEN
               
               #add-point:ON ACTION prog_xrda003 name="menu.prog_xrda003"
               CALL cl_user_contact("aooi130", "ooag_t", "ooag002", "ooag001",g_xrda_m.xrda003)
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION prog_xrda014
            LET g_action_choice="prog_xrda014"
            IF cl_auth_chk_act("prog_xrda014") THEN
               
               #add-point:ON ACTION prog_xrda014 name="menu.prog_xrda014"
              #150416-00004#3 Add  ---(S)---
               IF NOT cl_null(g_xrda_m.xrda014) THEN
                  SELECT glap001 INTO l_glap001 FROM glap_t WHERE glapent = g_enterprise
                     AND glapdocno = g_xrda_m.xrda014  AND glapld = g_xrda_m.xrdald
                  CASE
                     WHEN l_glap001 = '1'
                        LET la_param.prog = "aglt310"
                     WHEN l_glap001 = '2'
                        LET la_param.prog = "aglt320"
                     WHEN l_glap001 = '3'
                        LET la_param.prog = "aglt330"
                     WHEN l_glap001 = '5'
                        LET la_param.prog = "aglt350"
                  END CASE
                  LET la_param.param[1] = g_xrda_m.xrdald
                  LET la_param.param[2] = g_xrda_m.xrda014
                  LET ls_js = util.JSON.stringify(la_param)
                  CALL cl_cmdrun_wait(ls_js)
               END IF
              #150416-00004#3 Add  ---(E)---
               #END add-point
               
            END IF
 
 
 
 
         
         #應用 a46 樣板自動產生(Version:3)
         #新增相關文件
         ON ACTION related_document
            CALL axrt400_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document name="ui_dialog.dialog.related_document"
               
               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL axrt400_set_pk_array()
            #add-point:ON ACTION agendum name="ui_dialog.dialog.agendum"
            
            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL axrt400_set_pk_array()
            #add-point:ON ACTION followup name="ui_dialog.dialog.followup"
            
            #END add-point
            CALL cl_user_overview_follow(g_xrda_m.xrdadocdt)
 
 
 
         
         #主選單用ACTION
         &include "main_menu_exit_dialog.4gl"
         &include "relating_action.4gl"
    
         #交談指令共用ACTION
         &include "common_action.4gl" 
            CONTINUE DIALOG
      END DIALOG
    
      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         #add-point:ui_dialog段離開dialog前 name="ui_dialog.b_exit"
         
         #end add-point
         EXIT WHILE
      END IF
    
   END WHILE    
      
   CALL cl_set_act_visible("accept,cancel", TRUE)
    
END FUNCTION
 
{</section>}
 
{<section id="axrt400.browser_fill" >}
#+ 瀏覽頁簽資料填充
PRIVATE FUNCTION axrt400_browser_fill(ps_page_action)
   #add-point:browser_fill段define(客製用) name="browser_fill.define_customerization"
   
   #end add-point  
   DEFINE ps_page_action    STRING
   DEFINE l_wc              STRING
   DEFINE l_wc2             STRING
   DEFINE l_sql             STRING
   DEFINE l_sub_sql         STRING
   DEFINE l_sql_rank        STRING
   #add-point:browser_fill段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="browser_fill.define"
   DEFINE l_ld_str          STRING    #160125-00005#9 Add
   #end add-point    
   
   #add-point:Function前置處理 name="browser_fill.before_browser_fill"
   
   #end add-point
   
   IF cl_null(g_wc) THEN
      LET g_wc = " 1=1"
   END IF
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   LET l_wc  = g_wc.trim() 
   LET l_wc2 = g_wc2.trim()
 
   #add-point:browser_fill,foreach前 name="browser_fill.before_foreach"
   LET l_wc = l_wc," AND xrda001 = '41'"      #160509-00004#80 add lujh
  #160125-00005#9 Add  ---(S)---
   #CALL s_axrt300_get_site(g_user,g_site_str,'2') RETURNING l_ld_str #160811-00009#3
   CALL s_axrt300_get_site(g_user,'','2') RETURNING l_ld_str #160811-00009#3
   LET l_ld_str = cl_replace_str(l_ld_str,"glaald","xrdald")
   LET l_wc = l_wc," AND ",l_ld_str
  #160125-00005#9 Add  ---(E)---
   #end add-point
   
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件                      
      LET l_sub_sql = " SELECT DISTINCT xrdald,xrdadocno ",
                      " FROM xrda_t ",
                      " ",
                      " LEFT JOIN xrde_t ON xrdeent = xrdaent AND xrdald = xrdeld AND xrdadocno = xrdedocno ", "  ",
                      #add-point:browser_fill段sql(xrde_t1) name="browser_fill.cnt.join.}"
                      
                      #end add-point
                      " LEFT JOIN xrce_t ON xrceent = xrdaent AND xrdald = xrceld AND xrdadocno = xrcedocno", "  ",
                      #add-point:browser_fill段sql(xrce_t1) name="browser_fill.cnt.join.xrce_t1"
                      
                      #end add-point
 
 
 
                      " ", 
                      " ", 
                      " ",                      
 
 
 
                      " WHERE xrdaent = " ||g_enterprise|| " AND xrdeent = " ||g_enterprise|| " AND ",l_wc, " AND ", l_wc2, cl_sql_add_filter("xrda_t")
   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT DISTINCT xrdald,xrdadocno ",
                      " FROM xrda_t ", 
                      "  ",
                      "  ",
                      " WHERE xrdaent = " ||g_enterprise|| " AND ",l_wc CLIPPED, cl_sql_add_filter("xrda_t")
   END IF
   
   #add-point:browser_fill,cnt wc name="browser_fill.cnt_sqlwc"
   
   #end add-point
   
   LET g_sql = " SELECT COUNT(1) FROM (",l_sub_sql,")"
   
   #add-point:browser_fill,count前 name="browser_fill.before_count"
   
   #end add-point
   
   IF g_sql.getIndexOf(" 1=2",1) THEN
      DISPLAY "INFO: 1=2 jumped!"
   ELSE
      PREPARE header_cnt_pre FROM g_sql
      EXECUTE header_cnt_pre INTO g_browser_cnt   #總筆數
      FREE header_cnt_pre
   END IF
    
   IF g_browser_cnt > g_max_browse THEN
      IF g_error_show = 1 THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_browser_cnt
         LET g_errparam.code   = 9035 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
      END IF
      LET g_browser_cnt = g_max_browse
   END IF
   
   DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
   DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
 
   #根據行為確定資料填充位置及WC
   IF cl_null(g_add_browse) THEN
      #清除畫面
      CLEAR FORM                
      INITIALIZE g_xrda_m.* TO NULL
      CALL g_xrde_d.clear()        
      CALL g_xrde2_d.clear() 
      CALL g_xrde3_d.clear() 
      CALL g_xrde4_d.clear() 
      CALL g_xrde5_d.clear() 
      CALL g_xrde6_d.clear() 
 
      #add-point:browser_fill g_add_browse段額外處理 name="browser_fill.add_browse.other"
      
      #end add-point   
      CALL g_browser.clear()
      LET g_cnt = 1
   ELSE
      LET l_wc  = g_add_browse
      LET l_wc2 = " 1=1" 
      LET g_cnt = g_current_idx
   END IF
 
   #依照t0.xrdadocdt,t0.xrda005,t0.xrdadocno,t0.xrda014,t0.xrdasite,t0.xrda003,t0.xrdald Browser欄位定義(取代原本bs_sql功能)
   #考量到單身可能下條件, 所以此處需join單身所有table
   #DISTINCT是為了避免在join時出現重複的資料(如果不加DISTINCT則須在程式中過濾)
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件   
      LET g_sql = " SELECT DISTINCT t0.xrdastus,t0.xrdadocdt,t0.xrda005,t0.xrdadocno,t0.xrda014,t0.xrdasite, 
          t0.xrda003,t0.xrdald,t1.pmaal004 ,t2.ooefl003 ,t3.ooefl003 ,t4.ooag011 ,t5.glaal002 ",
                  " FROM xrda_t t0",
                  "  ",
                  "  LEFT JOIN xrde_t ON xrdeent = xrdaent AND xrdald = xrdeld AND xrdadocno = xrdedocno ", "  ", 
                  #add-point:browser_fill段sql(xrde_t1) name="browser_fill.join.xrde_t1"
                  
                  #end add-point
                  "  LEFT JOIN xrce_t ON xrceent = xrdaent AND xrdald = xrceld AND xrdadocno = xrcedocno", "  ", 
                  #add-point:browser_fill段sql(xrce_t1) name="browser_fill.join.xrce_t1"
                  
                  #end add-point
 
 
 
                  " ", 
                  " ",                      
 
 
 
                                 " LEFT JOIN pmaal_t t1 ON t1.pmaalent="||g_enterprise||" AND t1.pmaal001=t0.xrda005 AND t1.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.xrdadocno AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t3 ON t3.ooeflent="||g_enterprise||" AND t3.ooefl001=t0.xrdasite AND t3.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t4 ON t4.ooagent="||g_enterprise||" AND t4.ooag001=t0.xrda003  ",
               " LEFT JOIN glaal_t t5 ON t5.glaalent="||g_enterprise||" AND t5.glaalld=t0.xrdald AND t5.glaal001='"||g_dlang||"' ",
 
                  " WHERE t0.xrdaent = " ||g_enterprise|| " AND ",l_wc," AND ",l_wc2, cl_sql_add_filter("xrda_t")
   ELSE
      #單身無輸入搜尋條件   
      LET g_sql = " SELECT DISTINCT t0.xrdastus,t0.xrdadocdt,t0.xrda005,t0.xrdadocno,t0.xrda014,t0.xrdasite, 
          t0.xrda003,t0.xrdald,t1.pmaal004 ,t2.ooefl003 ,t3.ooefl003 ,t4.ooag011 ,t5.glaal002 ",
                  " FROM xrda_t t0",
                  "  ",
                                 " LEFT JOIN pmaal_t t1 ON t1.pmaalent="||g_enterprise||" AND t1.pmaal001=t0.xrda005 AND t1.pmaal002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent="||g_enterprise||" AND t2.ooefl001=t0.xrdadocno AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooefl_t t3 ON t3.ooeflent="||g_enterprise||" AND t3.ooefl001=t0.xrdasite AND t3.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t4 ON t4.ooagent="||g_enterprise||" AND t4.ooag001=t0.xrda003  ",
               " LEFT JOIN glaal_t t5 ON t5.glaalent="||g_enterprise||" AND t5.glaalld=t0.xrdald AND t5.glaal001='"||g_dlang||"' ",
 
                  " WHERE t0.xrdaent = " ||g_enterprise|| " AND ",l_wc, cl_sql_add_filter("xrda_t")
   END IF
   #add-point:browser_fill,sql wc name="browser_fill.fill_sqlwc"
   #151231-00010#2(S)
   IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
      LET g_sql = g_sql," AND EXISTS (SELECT 1 FROM pmaa_t ",
                        "              WHERE pmaaent = ",g_enterprise,
                        "                AND ",g_sql_ctrl,
                        "                AND pmaaent = xrdaent ",
                        "                AND pmaa001 = xrda005 )"
   END IF
   #151231-00010#2(E)
   #end add-point
   LET g_sql = g_sql, " ORDER BY xrdald,xrdadocno ",g_order
 
   #add-point:browser_fill,before_prepare name="browser_fill.before_prepare"
   
   #end add-point
        
   #LET g_sql = cl_sql_add_tabid(g_sql,"xrda_t") #WC重組
   LET g_sql = cl_sql_add_mask(g_sql) #遮蔽特定資料
   
   IF g_sql.getIndexOf(" 1=2",1) THEN
      DISPLAY "INFO: 1=2 jumped!"
   ELSE
      PREPARE browse_pre FROM g_sql
      DECLARE browse_cur CURSOR FOR browse_pre
      
      #add-point:browser_fill段open cursor name="browser_fill.open"
      
      #end add-point
      
      FOREACH browse_cur INTO g_browser[g_cnt].b_statepic,g_browser[g_cnt].b_xrdadocdt,g_browser[g_cnt].b_xrda005, 
          g_browser[g_cnt].b_xrdadocno,g_browser[g_cnt].b_xrda014,g_browser[g_cnt].b_xrdasite,g_browser[g_cnt].b_xrda003, 
          g_browser[g_cnt].b_xrdald,g_browser[g_cnt].b_xrda005_desc,g_browser[g_cnt].b_xrdadocno_desc, 
          g_browser[g_cnt].b_xrdasite_desc,g_browser[g_cnt].b_xrda003_desc,g_browser[g_cnt].b_xrdald_desc 
 
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "Foreach:",SQLERRMESSAGE 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
      
         #add-point:browser_fill段reference name="browser_fill.reference"
         
         #end add-point
      
         #遮罩相關處理
         CALL axrt400_browser_mask()
      
               #應用 a24 樣板自動產生(Version:3)
      #browser顯示圖片
      CASE g_browser[g_cnt].b_statepic
         WHEN "N"
            LET g_browser[g_cnt].b_statepic = "stus/16/unconfirmed.png"
         WHEN "Y"
            LET g_browser[g_cnt].b_statepic = "stus/16/confirmed.png"
         WHEN "A"
            LET g_browser[g_cnt].b_statepic = "stus/16/approved.png"
         WHEN "D"
            LET g_browser[g_cnt].b_statepic = "stus/16/withdraw.png"
         WHEN "R"
            LET g_browser[g_cnt].b_statepic = "stus/16/rejection.png"
         WHEN "W"
            LET g_browser[g_cnt].b_statepic = "stus/16/signing.png"
         WHEN "X"
            LET g_browser[g_cnt].b_statepic = "stus/16/invalid.png"
         
      END CASE
 
 
 
         LET g_cnt = g_cnt + 1
         IF g_cnt > g_max_browse THEN
            EXIT FOREACH
         END IF
         
      END FOREACH
      FREE browse_pre
   END IF
   
   #清空g_add_browse, 並指定指標位置
   IF NOT cl_null(g_add_browse) THEN
      LET g_add_browse = ""
      CALL g_curr_diag.setCurrentRow("s_browse",g_current_idx)
   END IF
   
   IF cl_null(g_browser[g_cnt].b_xrdald) THEN
      CALL g_browser.deleteElement(g_cnt)
   END IF
   
   LET g_header_cnt  = g_browser.getLength()
   LET g_browser_cnt = g_browser.getLength()
   
   #筆數顯示
   IF g_browser_cnt > 0 THEN
      DISPLAY g_browser_idx TO FORMONLY.b_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.b_count #總筆數
      DISPLAY g_browser_idx TO FORMONLY.h_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.h_count #總筆數
      DISPLAY g_detail_idx  TO FORMONLY.idx     #單身當下筆數
      DISPLAY g_detail_cnt  TO FORMONLY.cnt     #單身總筆數
   ELSE
      DISPLAY '' TO FORMONLY.b_index #當下筆數
      DISPLAY '' TO FORMONLY.b_count #總筆數
      DISPLAY '' TO FORMONLY.h_index #當下筆數
      DISPLAY '' TO FORMONLY.h_count #總筆數
      DISPLAY '' TO FORMONLY.idx     #單身當下筆數
      DISPLAY '' TO FORMONLY.cnt     #單身總筆數
   END IF
 
   LET g_rec_b = g_cnt - 1
   LET g_detail_cnt = g_rec_b
   LET g_cnt = 0
 
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
                  
   
   #add-point:browser_fill段結束前 name="browser_fill.after"
   
   #end add-point   
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.ui_headershow" >}
#+ 單頭資料重新顯示
PRIVATE FUNCTION axrt400_ui_headershow()
   #add-point:ui_headershow段define(客製用) name="ui_headershow.define_customerization"
   
   #end add-point  
   #add-point:ui_headershow段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_headershow.define"
   
   #end add-point      
   
   #add-point:Function前置處理  name="ui_headershow.pre_function"
   
   #end add-point
   
   LET g_xrda_m.xrdald = g_browser[g_current_idx].b_xrdald   
   LET g_xrda_m.xrdadocno = g_browser[g_current_idx].b_xrdadocno   
 
   EXECUTE axrt400_master_referesh USING g_xrda_m.xrdald,g_xrda_m.xrdadocno INTO g_xrda_m.xrdasite,g_xrda_m.xrda003, 
       g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005, 
       g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
       g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003_desc, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda005_desc,g_xrda_m.xrda004_desc,g_xrda_m.xrda015_desc, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid_desc,g_xrda_m.xrdacrtdp_desc, 
       g_xrda_m.xrdamodid_desc,g_xrda_m.xrdacnfid_desc
   
   CALL axrt400_xrda_t_mask()
   CALL axrt400_show()
      
END FUNCTION
 
{</section>}
 
{<section id="axrt400.ui_detailshow" >}
#+ 單身資料重新顯示
PRIVATE FUNCTION axrt400_ui_detailshow()
   #add-point:ui_detailshow段define(客製用) name="ui_detailshow.define_customerization"
   
   #end add-point    
   #add-point:ui_detailshow段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_detailshow.define"
   
   #end add-point    
 
   #add-point:Function前置處理 name="ui_detailshow.before"
   
   #end add-point    
   
   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail1",g_detail_idx)      
      CALL g_curr_diag.setCurrentRow("s_detail2",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail3",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail4",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail5",g_detail_idx)
      CALL g_curr_diag.setCurrentRow("s_detail6",g_detail_idx)
 
   END IF
   
   #add-point:ui_detailshow段after name="ui_detailshow.after"
   
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.ui_browser_refresh" >}
#+ 瀏覽頁簽資料重新顯示
PRIVATE FUNCTION axrt400_ui_browser_refresh()
   #add-point:ui_browser_refresh段define(客製用) name="ui_browser_refresh.define_customerization"
   
   #end add-point    
   DEFINE l_i  LIKE type_t.num10
   #add-point:ui_browser_refresh段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_browser_refresh.define"
   
   #end add-point    
   
   #add-point:Function前置處理  name="ui_browser_refresh.pre_function"
   
   #end add-point
   
   LET g_browser_cnt = g_browser.getLength()
   LET g_header_cnt  = g_browser.getLength()
   FOR l_i =1 TO g_browser.getLength()
      IF g_browser[l_i].b_xrdald = g_xrda_m.xrdald 
         AND g_browser[l_i].b_xrdadocno = g_xrda_m.xrdadocno 
 
         THEN
         CALL g_browser.deleteElement(l_i)
         EXIT FOR
      END IF
   END FOR
   LET g_browser_cnt = g_browser_cnt - 1
   LET g_header_cnt = g_header_cnt - 1
    
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
      CLEAR FORM
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
   
   #add-point:ui_browser_refresh段after name="ui_browser_refresh.after"
   
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.construct" >}
#+ QBE資料查詢
PRIVATE FUNCTION axrt400_construct()
   #add-point:cs段define(客製用) name="cs.define_customerization"
   
   #end add-point    
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING 
   DEFINE ls_wc       STRING 
   DEFINE la_wc       DYNAMIC ARRAY OF RECORD
          tableid     STRING,
          wc          STRING
          END RECORD
   DEFINE li_idx      LIKE type_t.num10
   #add-point:cs段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="cs.define"
   DEFINE l_ld_str      STRING                #160125-00005#9 Add
   #end add-point    
   
   #add-point:Function前置處理  name="cs.pre_function"
   
   #end add-point
    
   #清除畫面
   CLEAR FORM                
   INITIALIZE g_xrda_m.* TO NULL
   CALL g_xrde_d.clear()        
   CALL g_xrde2_d.clear() 
   CALL g_xrde3_d.clear() 
   CALL g_xrde4_d.clear() 
   CALL g_xrde5_d.clear() 
   CALL g_xrde6_d.clear() 
 
   
   LET g_action_choice = ""
    
   INITIALIZE g_wc TO NULL
   INITIALIZE g_wc2 TO NULL
   
   INITIALIZE g_wc2_table1 TO NULL
   INITIALIZE g_wc2_table2 TO NULL
 
 
    
   LET g_qryparam.state = 'c'
   
   #add-point:cs段開始前 name="cs.before_construct"
   LET g_site_str = NULL   #160125-00005#9 Add  
   #end add-point 
   
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      
      #單頭
      CONSTRUCT BY NAME g_wc ON xrdasite,xrda003,xrdald,xrdacomp,xrdadocno,xrda001,xrdadocdt,xrda005, 
          xrda004,xrda014,xrda006,xrdastus,xrda008,xrda010,xrda017,xrda007,xrda009,xrda015,xrda016,xrdaownid, 
          xrdaowndp,xrdacrtid,xrdacrtdp,xrdacrtdt,xrdamodid,xrdamoddt,xrdacnfid,xrdacnfdt,xrda007_desc, 
          l_desc,lbl_amt5_desc,lbl_amt1_1_desc,lbl_amt3_1_desc,lbl_amt5_1_desc
 
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.head.before_construct"
            
            #end add-point 
            
         #公用欄位開窗相關處理
         #應用 a11 樣板自動產生(Version:3)
         #共用欄位查詢處理  
         ##----<<xrdacrtdt>>----
         AFTER FIELD xrdacrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
 
         #----<<xrdamoddt>>----
         AFTER FIELD xrdamoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<xrdacnfdt>>----
         AFTER FIELD xrdacnfdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<xrdapstdt>>----
 
 
 
            
         #一般欄位開窗相關處理    
                  #Ctrlp:construct.c.xrdasite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdasite
            #add-point:ON ACTION controlp INFIELD xrdasite name="construct.c.xrdasite"
            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            #CALL q_ooef001()                       #呼叫開窗 #161006-00005#39 mark
            CALL q_ooef001_46()                              #161006-00005#39 add
            DISPLAY g_qryparam.return1 TO xrdasite  #顯示到畫面上
            NEXT FIELD xrdasite                     #返回原欄位
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdasite
            #add-point:BEFORE FIELD xrdasite name="construct.b.xrdasite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdasite
            
            #add-point:AFTER FIELD xrdasite name="construct.a.xrdasite"
            CALL FGL_DIALOG_GETBUFFER() RETURNING g_site_str   #160125-00005#9 Add
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda003
            #add-point:ON ACTION controlp INFIELD xrda003 name="construct.c.xrda003"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrda003  #顯示到畫面上
            NEXT FIELD xrda003                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda003
            #add-point:BEFORE FIELD xrda003 name="construct.b.xrda003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda003
            
            #add-point:AFTER FIELD xrda003 name="construct.a.xrda003"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrdald
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdald
            #add-point:ON ACTION controlp INFIELD xrdald name="construct.c.xrdald"
            #此段落由子樣板a08產生
            CALL s_axrt300_get_site(g_user,g_site_str,'2') RETURNING l_ld_str   #160125-00005#9 Add
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_user              #160125-00005#9 Add
            LET g_qryparam.arg2 = g_dept              #160125-00005#9 Add
			   #LET g_qryparam.where = l_ld_str CLIPPED   #160125-00005#9 Add                     #160811-00009#3 mark
			   LET g_qryparam.where = l_ld_str CLIPPED," AND (glaa008 = 'Y' OR glaa014 = 'Y')"    #160811-00009#3 add 
            CALL q_authorised_ld()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdald  #顯示到畫面上
            NEXT FIELD xrdald                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdald
            #add-point:BEFORE FIELD xrdald name="construct.b.xrdald"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdald
            
            #add-point:AFTER FIELD xrdald name="construct.a.xrdald"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdacomp
            #add-point:BEFORE FIELD xrdacomp name="construct.b.xrdacomp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdacomp
            
            #add-point:AFTER FIELD xrdacomp name="construct.a.xrdacomp"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrdacomp
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdacomp
            #add-point:ON ACTION controlp INFIELD xrdacomp name="construct.c.xrdacomp"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xrdadocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdadocno
            #add-point:ON ACTION controlp INFIELD xrdadocno name="construct.c.xrdadocno"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #151231-00010#2(S)
            IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
               LET g_qryparam.where = " EXISTS (SELECT 1 FROM pmaa_t ",
                                      "              WHERE pmaaent = ",g_enterprise,
                                      "                AND ",g_sql_ctrl,
                                      "                AND pmaaent = xrdaent ",
                                      "                AND pmaa001 = xrda005 )"
            END IF
            #151231-00010#2(E)
            CALL q_xrdadocno()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdadocno  #顯示到畫面上
            NEXT FIELD xrdadocno                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdadocno
            #add-point:BEFORE FIELD xrdadocno name="construct.b.xrdadocno"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdadocno
            
            #add-point:AFTER FIELD xrdadocno name="construct.a.xrdadocno"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda001
            #add-point:BEFORE FIELD xrda001 name="construct.b.xrda001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda001
            
            #add-point:AFTER FIELD xrda001 name="construct.a.xrda001"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda001
            #add-point:ON ACTION controlp INFIELD xrda001 name="construct.c.xrda001"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdadocdt
            #add-point:BEFORE FIELD xrdadocdt name="construct.b.xrdadocdt"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdadocdt
            
            #add-point:AFTER FIELD xrdadocdt name="construct.a.xrdadocdt"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrdadocdt
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdadocdt
            #add-point:ON ACTION controlp INFIELD xrdadocdt name="construct.c.xrdadocdt"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xrda005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda005
            #add-point:ON ACTION controlp INFIELD xrda005 name="construct.c.xrda005"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #151231-00010#2(S)
            IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
               LET g_qryparam.where = g_sql_ctrl
            END IF
            #151231-00010#2(E)
            CALL q_pmaa001_13()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrda005  #顯示到畫面上
            NEXT FIELD xrda005                     #返回原欄位
   
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda005
            #add-point:BEFORE FIELD xrda005 name="construct.b.xrda005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda005
            
            #add-point:AFTER FIELD xrda005 name="construct.a.xrda005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda004
            #add-point:ON ACTION controlp INFIELD xrda004 name="construct.c.xrda004"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #151231-00010#2(S)
            IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
               LET g_qryparam.where = g_sql_ctrl
            END IF
            #151231-00010#2(E)
            CALL q_pmaa001_13()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrda004  #顯示到畫面上
            NEXT FIELD xrda004                     #返回原欄位
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda004
            #add-point:BEFORE FIELD xrda004 name="construct.b.xrda004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda004
            
            #add-point:AFTER FIELD xrda004 name="construct.a.xrda004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda014
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda014
            #add-point:ON ACTION controlp INFIELD xrda014 name="construct.c.xrda014"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_xrda014()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrda014  #顯示到畫面上
            NEXT FIELD xrda014                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda014
            #add-point:BEFORE FIELD xrda014 name="construct.b.xrda014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda014
            
            #add-point:AFTER FIELD xrda014 name="construct.a.xrda014"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda006
            #add-point:BEFORE FIELD xrda006 name="construct.b.xrda006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda006
            
            #add-point:AFTER FIELD xrda006 name="construct.a.xrda006"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda006
            #add-point:ON ACTION controlp INFIELD xrda006 name="construct.c.xrda006"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdastus
            #add-point:BEFORE FIELD xrdastus name="construct.b.xrdastus"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdastus
            
            #add-point:AFTER FIELD xrdastus name="construct.a.xrdastus"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrdastus
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdastus
            #add-point:ON ACTION controlp INFIELD xrdastus name="construct.c.xrdastus"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda008
            #add-point:BEFORE FIELD xrda008 name="construct.b.xrda008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda008
            
            #add-point:AFTER FIELD xrda008 name="construct.a.xrda008"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda008
            #add-point:ON ACTION controlp INFIELD xrda008 name="construct.c.xrda008"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xrda010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda010
            #add-point:ON ACTION controlp INFIELD xrda010 name="construct.c.xrda010"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrda010  #顯示到畫面上
            NEXT FIELD xrda010                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda010
            #add-point:BEFORE FIELD xrda010 name="construct.b.xrda010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda010
            
            #add-point:AFTER FIELD xrda010 name="construct.a.xrda010"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda017
            #add-point:BEFORE FIELD xrda017 name="construct.b.xrda017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda017
            
            #add-point:AFTER FIELD xrda017 name="construct.a.xrda017"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda017
            #add-point:ON ACTION controlp INFIELD xrda017 name="construct.c.xrda017"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda007
            #add-point:BEFORE FIELD xrda007 name="construct.b.xrda007"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda007
            
            #add-point:AFTER FIELD xrda007 name="construct.a.xrda007"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda007
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda007
            #add-point:ON ACTION controlp INFIELD xrda007 name="construct.c.xrda007"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xrda009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda009
            #add-point:ON ACTION controlp INFIELD xrda009 name="construct.c.xrda009"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_xrda009()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrda009  #顯示到畫面上
            NEXT FIELD xrda009                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda009
            #add-point:BEFORE FIELD xrda009 name="construct.b.xrda009"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda009
            
            #add-point:AFTER FIELD xrda009 name="construct.a.xrda009"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda015
            #add-point:ON ACTION controlp INFIELD xrda015 name="construct.c.xrda015"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '3113'
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrda015  #顯示到畫面上
            NEXT FIELD xrda015                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda015
            #add-point:BEFORE FIELD xrda015 name="construct.b.xrda015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda015
            
            #add-point:AFTER FIELD xrda015 name="construct.a.xrda015"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda016
            #add-point:BEFORE FIELD xrda016 name="construct.b.xrda016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda016
            
            #add-point:AFTER FIELD xrda016 name="construct.a.xrda016"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda016
            #add-point:ON ACTION controlp INFIELD xrda016 name="construct.c.xrda016"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xrdaownid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdaownid
            #add-point:ON ACTION controlp INFIELD xrdaownid name="construct.c.xrdaownid"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdaownid  #顯示到畫面上
            NEXT FIELD xrdaownid                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdaownid
            #add-point:BEFORE FIELD xrdaownid name="construct.b.xrdaownid"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdaownid
            
            #add-point:AFTER FIELD xrdaownid name="construct.a.xrdaownid"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrdaowndp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdaowndp
            #add-point:ON ACTION controlp INFIELD xrdaowndp name="construct.c.xrdaowndp"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdaowndp  #顯示到畫面上
            NEXT FIELD xrdaowndp                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdaowndp
            #add-point:BEFORE FIELD xrdaowndp name="construct.b.xrdaowndp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdaowndp
            
            #add-point:AFTER FIELD xrdaowndp name="construct.a.xrdaowndp"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrdacrtid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdacrtid
            #add-point:ON ACTION controlp INFIELD xrdacrtid name="construct.c.xrdacrtid"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdacrtid  #顯示到畫面上
            NEXT FIELD xrdacrtid                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdacrtid
            #add-point:BEFORE FIELD xrdacrtid name="construct.b.xrdacrtid"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdacrtid
            
            #add-point:AFTER FIELD xrdacrtid name="construct.a.xrdacrtid"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrdacrtdp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdacrtdp
            #add-point:ON ACTION controlp INFIELD xrdacrtdp name="construct.c.xrdacrtdp"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdacrtdp  #顯示到畫面上
            NEXT FIELD xrdacrtdp                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdacrtdp
            #add-point:BEFORE FIELD xrdacrtdp name="construct.b.xrdacrtdp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdacrtdp
            
            #add-point:AFTER FIELD xrdacrtdp name="construct.a.xrdacrtdp"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdacrtdt
            #add-point:BEFORE FIELD xrdacrtdt name="construct.b.xrdacrtdt"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xrdamodid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdamodid
            #add-point:ON ACTION controlp INFIELD xrdamodid name="construct.c.xrdamodid"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdamodid  #顯示到畫面上
            NEXT FIELD xrdamodid                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdamodid
            #add-point:BEFORE FIELD xrdamodid name="construct.b.xrdamodid"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdamodid
            
            #add-point:AFTER FIELD xrdamodid name="construct.a.xrdamodid"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdamoddt
            #add-point:BEFORE FIELD xrdamoddt name="construct.b.xrdamoddt"
            
            #END add-point
 
 
         #Ctrlp:construct.c.xrdacnfid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdacnfid
            #add-point:ON ACTION controlp INFIELD xrdacnfid name="construct.c.xrdacnfid"
            #應用 a08 樣板自動產生(Version:3)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrdacnfid  #顯示到畫面上
            NEXT FIELD xrdacnfid                     #返回原欄位
    



            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdacnfid
            #add-point:BEFORE FIELD xrdacnfid name="construct.b.xrdacnfid"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdacnfid
            
            #add-point:AFTER FIELD xrdacnfid name="construct.a.xrdacnfid"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdacnfdt
            #add-point:BEFORE FIELD xrdacnfdt name="construct.b.xrdacnfdt"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda007_desc
            #add-point:BEFORE FIELD xrda007_desc name="construct.b.xrda007_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda007_desc
            
            #add-point:AFTER FIELD xrda007_desc name="construct.a.xrda007_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.xrda007_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda007_desc
            #add-point:ON ACTION controlp INFIELD xrda007_desc name="construct.c.xrda007_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD l_desc
            #add-point:BEFORE FIELD l_desc name="construct.b.l_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD l_desc
            
            #add-point:AFTER FIELD l_desc name="construct.a.l_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.l_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD l_desc
            #add-point:ON ACTION controlp INFIELD l_desc name="construct.c.l_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD lbl_amt5_desc
            #add-point:BEFORE FIELD lbl_amt5_desc name="construct.b.lbl_amt5_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD lbl_amt5_desc
            
            #add-point:AFTER FIELD lbl_amt5_desc name="construct.a.lbl_amt5_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.lbl_amt5_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD lbl_amt5_desc
            #add-point:ON ACTION controlp INFIELD lbl_amt5_desc name="construct.c.lbl_amt5_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD lbl_amt1_1_desc
            #add-point:BEFORE FIELD lbl_amt1_1_desc name="construct.b.lbl_amt1_1_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD lbl_amt1_1_desc
            
            #add-point:AFTER FIELD lbl_amt1_1_desc name="construct.a.lbl_amt1_1_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.lbl_amt1_1_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD lbl_amt1_1_desc
            #add-point:ON ACTION controlp INFIELD lbl_amt1_1_desc name="construct.c.lbl_amt1_1_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD lbl_amt3_1_desc
            #add-point:BEFORE FIELD lbl_amt3_1_desc name="construct.b.lbl_amt3_1_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD lbl_amt3_1_desc
            
            #add-point:AFTER FIELD lbl_amt3_1_desc name="construct.a.lbl_amt3_1_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.lbl_amt3_1_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD lbl_amt3_1_desc
            #add-point:ON ACTION controlp INFIELD lbl_amt3_1_desc name="construct.c.lbl_amt3_1_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD lbl_amt5_1_desc
            #add-point:BEFORE FIELD lbl_amt5_1_desc name="construct.b.lbl_amt5_1_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD lbl_amt5_1_desc
            
            #add-point:AFTER FIELD lbl_amt5_1_desc name="construct.a.lbl_amt5_1_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.lbl_amt5_1_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD lbl_amt5_1_desc
            #add-point:ON ACTION controlp INFIELD lbl_amt5_1_desc name="construct.c.lbl_amt5_1_desc"
            
            #END add-point
 
 
 
         
      END CONSTRUCT
 
      #單身根據table分拆construct
      CONSTRUCT g_wc2_table1 ON xrdeseq,xrde002,xrde006,xrde003,xrde004,xrde008,l_xrde008,xrde032,xrde010, 
          xrde016,xrde016_desc,xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp,xrdesite, 
          xrdeorga,xrde011,xrde015,xrde015_desc,xrde012,xrde012_desc,xrde120,xrde121,xrde129,xrde130, 
          xrde131,xrde139,xrde017,xrde017_desc,xrde018,xrde018_desc,xrde019,xrde019_desc,xrde035,xrde035_desc, 
          xrde036,xrde036_desc,xrde020,xrde020_desc,xrde022,xrde022_desc,xrde023,xrde023_desc,xrde039, 
          xrde040,xrde040_desc,xrde042,xrde042_desc,xrde043,xrde043_desc,xrde044,xrde044_desc,xrde045, 
          xrde045_desc,xrde046,xrde046_desc,xrde047,xrde047_desc,xrde048,xrde048_desc,xrde049,xrde049_desc, 
          xrde050,xrde050_desc,xrde051,xrde051_desc
           FROM s_detail1[1].xrdeseq,s_detail1[1].xrde002,s_detail1[1].xrde006,s_detail1[1].xrde003, 
               s_detail1[1].xrde004,s_detail1[1].xrde008,s_detail1[1].l_xrde008,s_detail1[1].xrde032, 
               s_detail1[1].xrde010,s_detail1[1].xrde016,s_detail1[1].xrde016_desc,s_detail1[1].xrde100, 
               s_detail1[1].xrde101,s_detail1[1].xrde109,s_detail1[1].xrde119,s_detail1[1].xrde014,s_detail1[1].xrde013, 
               s_detail1[1].xrde001,s_detail1[1].xrdecomp,s_detail1[1].xrdesite,s_detail1[1].xrdeorga, 
               s_detail1[1].xrde011,s_detail1[1].xrde015,s_detail1[1].xrde015_desc,s_detail1[1].xrde012, 
               s_detail1[1].xrde012_desc,s_detail2[1].xrde120,s_detail2[1].xrde121,s_detail2[1].xrde129, 
               s_detail2[1].xrde130,s_detail2[1].xrde131,s_detail2[1].xrde139,s_detail3[1].xrde017,s_detail3[1].xrde017_desc, 
               s_detail3[1].xrde018,s_detail3[1].xrde018_desc,s_detail3[1].xrde019,s_detail3[1].xrde019_desc, 
               s_detail3[1].xrde035,s_detail3[1].xrde035_desc,s_detail3[1].xrde036,s_detail3[1].xrde036_desc, 
               s_detail3[1].xrde020,s_detail3[1].xrde020_desc,s_detail3[1].xrde022,s_detail3[1].xrde022_desc, 
               s_detail3[1].xrde023,s_detail3[1].xrde023_desc,s_detail3[1].xrde039,s_detail3[1].xrde040, 
               s_detail3[1].xrde040_desc,s_detail3[1].xrde042,s_detail3[1].xrde042_desc,s_detail3[1].xrde043, 
               s_detail3[1].xrde043_desc,s_detail3[1].xrde044,s_detail3[1].xrde044_desc,s_detail3[1].xrde045, 
               s_detail3[1].xrde045_desc,s_detail3[1].xrde046,s_detail3[1].xrde046_desc,s_detail3[1].xrde047, 
               s_detail3[1].xrde047_desc,s_detail3[1].xrde048,s_detail3[1].xrde048_desc,s_detail3[1].xrde049, 
               s_detail3[1].xrde049_desc,s_detail3[1].xrde050,s_detail3[1].xrde050_desc,s_detail3[1].xrde051, 
               s_detail3[1].xrde051_desc
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body.before_construct"
            
            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdeseq
            #add-point:BEFORE FIELD xrdeseq name="construct.b.page1.xrdeseq"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdeseq
            
            #add-point:AFTER FIELD xrdeseq name="construct.a.page1.xrdeseq"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrdeseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdeseq
            #add-point:ON ACTION controlp INFIELD xrdeseq name="construct.c.page1.xrdeseq"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde002
            #add-point:BEFORE FIELD xrde002 name="construct.b.page1.xrde002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde002
            
            #add-point:AFTER FIELD xrde002 name="construct.a.page1.xrde002"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde002
            #add-point:ON ACTION controlp INFIELD xrde002 name="construct.c.page1.xrde002"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde006
            #add-point:BEFORE FIELD xrde006 name="construct.b.page1.xrde006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde006
            
            #add-point:AFTER FIELD xrde006 name="construct.a.page1.xrde006"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde006
            #add-point:ON ACTION controlp INFIELD xrde006 name="construct.c.page1.xrde006"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde003
            #add-point:BEFORE FIELD xrde003 name="construct.b.page1.xrde003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde003
            
            #add-point:AFTER FIELD xrde003 name="construct.a.page1.xrde003"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde003
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde003
            #add-point:ON ACTION controlp INFIELD xrde003 name="construct.c.page1.xrde003"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde004
            #add-point:BEFORE FIELD xrde004 name="construct.b.page1.xrde004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde004
            
            #add-point:AFTER FIELD xrde004 name="construct.a.page1.xrde004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde004
            #add-point:ON ACTION controlp INFIELD xrde004 name="construct.c.page1.xrde004"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde008
            #add-point:BEFORE FIELD xrde008 name="construct.b.page1.xrde008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde008
            
            #add-point:AFTER FIELD xrde008 name="construct.a.page1.xrde008"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde008
            #add-point:ON ACTION controlp INFIELD xrde008 name="construct.c.page1.xrde008"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD l_xrde008
            #add-point:BEFORE FIELD l_xrde008 name="construct.b.page1.l_xrde008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD l_xrde008
            
            #add-point:AFTER FIELD l_xrde008 name="construct.a.page1.l_xrde008"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.l_xrde008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD l_xrde008
            #add-point:ON ACTION controlp INFIELD l_xrde008 name="construct.c.page1.l_xrde008"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde032
            #add-point:BEFORE FIELD xrde032 name="construct.b.page1.xrde032"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde032
            
            #add-point:AFTER FIELD xrde032 name="construct.a.page1.xrde032"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde032
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde032
            #add-point:ON ACTION controlp INFIELD xrde032 name="construct.c.page1.xrde032"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde010
            #add-point:BEFORE FIELD xrde010 name="construct.b.page1.xrde010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde010
            
            #add-point:AFTER FIELD xrde010 name="construct.a.page1.xrde010"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde010
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde010
            #add-point:ON ACTION controlp INFIELD xrde010 name="construct.c.page1.xrde010"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde016
            #add-point:BEFORE FIELD xrde016 name="construct.b.page1.xrde016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde016
            
            #add-point:AFTER FIELD xrde016 name="construct.a.page1.xrde016"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde016
            #add-point:ON ACTION controlp INFIELD xrde016 name="construct.c.page1.xrde016"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde016_desc
            #add-point:BEFORE FIELD xrde016_desc name="construct.b.page1.xrde016_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde016_desc
            
            #add-point:AFTER FIELD xrde016_desc name="construct.a.page1.xrde016_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde016_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde016_desc
            #add-point:ON ACTION controlp INFIELD xrde016_desc name="construct.c.page1.xrde016_desc"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL aglt310_04()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrde016       #顯示到畫面上
            NEXT FIELD xrde016_desc                     #返回原欄位
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xrde100
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde100
            #add-point:ON ACTION controlp INFIELD xrde100 name="construct.c.page1.xrde100"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_aooi001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrde100  #顯示到畫面上
            NEXT FIELD xrde100                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde100
            #add-point:BEFORE FIELD xrde100 name="construct.b.page1.xrde100"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde100
            
            #add-point:AFTER FIELD xrde100 name="construct.a.page1.xrde100"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde101
            #add-point:BEFORE FIELD xrde101 name="construct.b.page1.xrde101"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde101
            
            #add-point:AFTER FIELD xrde101 name="construct.a.page1.xrde101"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde101
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde101
            #add-point:ON ACTION controlp INFIELD xrde101 name="construct.c.page1.xrde101"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde109
            #add-point:BEFORE FIELD xrde109 name="construct.b.page1.xrde109"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde109
            
            #add-point:AFTER FIELD xrde109 name="construct.a.page1.xrde109"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde109
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde109
            #add-point:ON ACTION controlp INFIELD xrde109 name="construct.c.page1.xrde109"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde119
            #add-point:BEFORE FIELD xrde119 name="construct.b.page1.xrde119"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde119
            
            #add-point:AFTER FIELD xrde119 name="construct.a.page1.xrde119"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde119
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde119
            #add-point:ON ACTION controlp INFIELD xrde119 name="construct.c.page1.xrde119"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xrde014
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde014
            #add-point:ON ACTION controlp INFIELD xrde014 name="construct.c.page1.xrde014"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooba002_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrde014  #顯示到畫面上
            NEXT FIELD xrde014                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde014
            #add-point:BEFORE FIELD xrde014 name="construct.b.page1.xrde014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde014
            
            #add-point:AFTER FIELD xrde014 name="construct.a.page1.xrde014"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde013
            #add-point:BEFORE FIELD xrde013 name="construct.b.page1.xrde013"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde013
            
            #add-point:AFTER FIELD xrde013 name="construct.a.page1.xrde013"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde013
            #add-point:ON ACTION controlp INFIELD xrde013 name="construct.c.page1.xrde013"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            #161017-00011#2--add--str--
            IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
               LET g_qryparam.where = g_sql_ctrl
            END IF
            #161017-00011#2--add--end
            CALL q_pmaa001_13()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrde013  #顯示到畫面上
            NEXT FIELD xrde013                     #返回原欄位
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde001
            #add-point:BEFORE FIELD xrde001 name="construct.b.page1.xrde001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde001
            
            #add-point:AFTER FIELD xrde001 name="construct.a.page1.xrde001"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde001
            #add-point:ON ACTION controlp INFIELD xrde001 name="construct.c.page1.xrde001"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdecomp
            #add-point:BEFORE FIELD xrdecomp name="construct.b.page1.xrdecomp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdecomp
            
            #add-point:AFTER FIELD xrdecomp name="construct.a.page1.xrdecomp"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrdecomp
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdecomp
            #add-point:ON ACTION controlp INFIELD xrdecomp name="construct.c.page1.xrdecomp"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdesite
            #add-point:BEFORE FIELD xrdesite name="construct.b.page1.xrdesite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdesite
            
            #add-point:AFTER FIELD xrdesite name="construct.a.page1.xrdesite"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrdesite
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdesite
            #add-point:ON ACTION controlp INFIELD xrdesite name="construct.c.page1.xrdesite"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdeorga
            #add-point:BEFORE FIELD xrdeorga name="construct.b.page1.xrdeorga"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdeorga
            
            #add-point:AFTER FIELD xrdeorga name="construct.a.page1.xrdeorga"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrdeorga
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdeorga
            #add-point:ON ACTION controlp INFIELD xrdeorga name="construct.c.page1.xrdeorga"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde011
            #add-point:BEFORE FIELD xrde011 name="construct.b.page1.xrde011"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde011
            
            #add-point:AFTER FIELD xrde011 name="construct.a.page1.xrde011"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde011
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde011
            #add-point:ON ACTION controlp INFIELD xrde011 name="construct.c.page1.xrde011"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde015
            #add-point:BEFORE FIELD xrde015 name="construct.b.page1.xrde015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde015
            
            #add-point:AFTER FIELD xrde015 name="construct.a.page1.xrde015"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde015
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde015
            #add-point:ON ACTION controlp INFIELD xrde015 name="construct.c.page1.xrde015"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde015_desc
            #add-point:BEFORE FIELD xrde015_desc name="construct.b.page1.xrde015_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde015_desc
            
            #add-point:AFTER FIELD xrde015_desc name="construct.a.page1.xrde015_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde015_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde015_desc
            #add-point:ON ACTION controlp INFIELD xrde015_desc name="construct.c.page1.xrde015_desc"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page1.xrde012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde012
            #add-point:ON ACTION controlp INFIELD xrde012 name="construct.c.page1.xrde012"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_nmai002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrde012  #顯示到畫面上
            NEXT FIELD xrde012                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde012
            #add-point:BEFORE FIELD xrde012 name="construct.b.page1.xrde012"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde012
            
            #add-point:AFTER FIELD xrde012 name="construct.a.page1.xrde012"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde012_desc
            #add-point:BEFORE FIELD xrde012_desc name="construct.b.page1.xrde012_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde012_desc
            
            #add-point:AFTER FIELD xrde012_desc name="construct.a.page1.xrde012_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page1.xrde012_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde012_desc
            #add-point:ON ACTION controlp INFIELD xrde012_desc name="construct.c.page1.xrde012_desc"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_nmai002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrde012_desc  #顯示到畫面上
            NEXT FIELD xrde012_desc   
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde120
            #add-point:BEFORE FIELD xrde120 name="construct.b.page2.xrde120"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde120
            
            #add-point:AFTER FIELD xrde120 name="construct.a.page2.xrde120"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.xrde120
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde120
            #add-point:ON ACTION controlp INFIELD xrde120 name="construct.c.page2.xrde120"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde121
            #add-point:BEFORE FIELD xrde121 name="construct.b.page2.xrde121"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde121
            
            #add-point:AFTER FIELD xrde121 name="construct.a.page2.xrde121"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.xrde121
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde121
            #add-point:ON ACTION controlp INFIELD xrde121 name="construct.c.page2.xrde121"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde129
            #add-point:BEFORE FIELD xrde129 name="construct.b.page2.xrde129"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde129
            
            #add-point:AFTER FIELD xrde129 name="construct.a.page2.xrde129"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.xrde129
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde129
            #add-point:ON ACTION controlp INFIELD xrde129 name="construct.c.page2.xrde129"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde130
            #add-point:BEFORE FIELD xrde130 name="construct.b.page2.xrde130"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde130
            
            #add-point:AFTER FIELD xrde130 name="construct.a.page2.xrde130"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.xrde130
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde130
            #add-point:ON ACTION controlp INFIELD xrde130 name="construct.c.page2.xrde130"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde131
            #add-point:BEFORE FIELD xrde131 name="construct.b.page2.xrde131"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde131
            
            #add-point:AFTER FIELD xrde131 name="construct.a.page2.xrde131"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.xrde131
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde131
            #add-point:ON ACTION controlp INFIELD xrde131 name="construct.c.page2.xrde131"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde139
            #add-point:BEFORE FIELD xrde139 name="construct.b.page2.xrde139"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde139
            
            #add-point:AFTER FIELD xrde139 name="construct.a.page2.xrde139"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page2.xrde139
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde139
            #add-point:ON ACTION controlp INFIELD xrde139 name="construct.c.page2.xrde139"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde017
            #add-point:BEFORE FIELD xrde017 name="construct.b.page3.xrde017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde017
            
            #add-point:AFTER FIELD xrde017 name="construct.a.page3.xrde017"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde017
            #add-point:ON ACTION controlp INFIELD xrde017 name="construct.c.page3.xrde017"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde017_desc
            #add-point:BEFORE FIELD xrde017_desc name="construct.b.page3.xrde017_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde017_desc
            
            #add-point:AFTER FIELD xrde017_desc name="construct.a.page3.xrde017_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde017_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde017_desc
            #add-point:ON ACTION controlp INFIELD xrde017_desc name="construct.c.page3.xrde017_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde018
            #add-point:BEFORE FIELD xrde018 name="construct.b.page3.xrde018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde018
            
            #add-point:AFTER FIELD xrde018 name="construct.a.page3.xrde018"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde018
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde018
            #add-point:ON ACTION controlp INFIELD xrde018 name="construct.c.page3.xrde018"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde018_desc
            #add-point:BEFORE FIELD xrde018_desc name="construct.b.page3.xrde018_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde018_desc
            
            #add-point:AFTER FIELD xrde018_desc name="construct.a.page3.xrde018_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde018_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde018_desc
            #add-point:ON ACTION controlp INFIELD xrde018_desc name="construct.c.page3.xrde018_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde019
            #add-point:BEFORE FIELD xrde019 name="construct.b.page3.xrde019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde019
            
            #add-point:AFTER FIELD xrde019 name="construct.a.page3.xrde019"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde019
            #add-point:ON ACTION controlp INFIELD xrde019 name="construct.c.page3.xrde019"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde019_desc
            #add-point:BEFORE FIELD xrde019_desc name="construct.b.page3.xrde019_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde019_desc
            
            #add-point:AFTER FIELD xrde019_desc name="construct.a.page3.xrde019_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde019_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde019_desc
            #add-point:ON ACTION controlp INFIELD xrde019_desc name="construct.c.page3.xrde019_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde035
            #add-point:BEFORE FIELD xrde035 name="construct.b.page3.xrde035"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde035
            
            #add-point:AFTER FIELD xrde035 name="construct.a.page3.xrde035"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde035
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde035
            #add-point:ON ACTION controlp INFIELD xrde035 name="construct.c.page3.xrde035"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde035_desc
            #add-point:BEFORE FIELD xrde035_desc name="construct.b.page3.xrde035_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde035_desc
            
            #add-point:AFTER FIELD xrde035_desc name="construct.a.page3.xrde035_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde035_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde035_desc
            #add-point:ON ACTION controlp INFIELD xrde035_desc name="construct.c.page3.xrde035_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde036
            #add-point:BEFORE FIELD xrde036 name="construct.b.page3.xrde036"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde036
            
            #add-point:AFTER FIELD xrde036 name="construct.a.page3.xrde036"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde036
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde036
            #add-point:ON ACTION controlp INFIELD xrde036 name="construct.c.page3.xrde036"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde036_desc
            #add-point:BEFORE FIELD xrde036_desc name="construct.b.page3.xrde036_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde036_desc
            
            #add-point:AFTER FIELD xrde036_desc name="construct.a.page3.xrde036_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde036_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde036_desc
            #add-point:ON ACTION controlp INFIELD xrde036_desc name="construct.c.page3.xrde036_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde020
            #add-point:BEFORE FIELD xrde020 name="construct.b.page3.xrde020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde020
            
            #add-point:AFTER FIELD xrde020 name="construct.a.page3.xrde020"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde020
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde020
            #add-point:ON ACTION controlp INFIELD xrde020 name="construct.c.page3.xrde020"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde020_desc
            #add-point:BEFORE FIELD xrde020_desc name="construct.b.page3.xrde020_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde020_desc
            
            #add-point:AFTER FIELD xrde020_desc name="construct.a.page3.xrde020_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde020_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde020_desc
            #add-point:ON ACTION controlp INFIELD xrde020_desc name="construct.c.page3.xrde020_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde022
            #add-point:BEFORE FIELD xrde022 name="construct.b.page3.xrde022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde022
            
            #add-point:AFTER FIELD xrde022 name="construct.a.page3.xrde022"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde022
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde022
            #add-point:ON ACTION controlp INFIELD xrde022 name="construct.c.page3.xrde022"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde022_desc
            #add-point:BEFORE FIELD xrde022_desc name="construct.b.page3.xrde022_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde022_desc
            
            #add-point:AFTER FIELD xrde022_desc name="construct.a.page3.xrde022_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde022_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde022_desc
            #add-point:ON ACTION controlp INFIELD xrde022_desc name="construct.c.page3.xrde022_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde023
            #add-point:BEFORE FIELD xrde023 name="construct.b.page3.xrde023"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde023
            
            #add-point:AFTER FIELD xrde023 name="construct.a.page3.xrde023"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde023
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde023
            #add-point:ON ACTION controlp INFIELD xrde023 name="construct.c.page3.xrde023"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde023_desc
            #add-point:BEFORE FIELD xrde023_desc name="construct.b.page3.xrde023_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde023_desc
            
            #add-point:AFTER FIELD xrde023_desc name="construct.a.page3.xrde023_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde023_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde023_desc
            #add-point:ON ACTION controlp INFIELD xrde023_desc name="construct.c.page3.xrde023_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde039
            #add-point:BEFORE FIELD xrde039 name="construct.b.page3.xrde039"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde039
            
            #add-point:AFTER FIELD xrde039 name="construct.a.page3.xrde039"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde039
            #add-point:ON ACTION controlp INFIELD xrde039 name="construct.c.page3.xrde039"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde040
            #add-point:BEFORE FIELD xrde040 name="construct.b.page3.xrde040"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde040
            
            #add-point:AFTER FIELD xrde040 name="construct.a.page3.xrde040"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde040
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde040
            #add-point:ON ACTION controlp INFIELD xrde040 name="construct.c.page3.xrde040"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde040_desc
            #add-point:BEFORE FIELD xrde040_desc name="construct.b.page3.xrde040_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde040_desc
            
            #add-point:AFTER FIELD xrde040_desc name="construct.a.page3.xrde040_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde040_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde040_desc
            #add-point:ON ACTION controlp INFIELD xrde040_desc name="construct.c.page3.xrde040_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde042
            #add-point:BEFORE FIELD xrde042 name="construct.b.page3.xrde042"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde042
            
            #add-point:AFTER FIELD xrde042 name="construct.a.page3.xrde042"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde042
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde042
            #add-point:ON ACTION controlp INFIELD xrde042 name="construct.c.page3.xrde042"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde042_desc
            #add-point:BEFORE FIELD xrde042_desc name="construct.b.page3.xrde042_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde042_desc
            
            #add-point:AFTER FIELD xrde042_desc name="construct.a.page3.xrde042_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde042_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde042_desc
            #add-point:ON ACTION controlp INFIELD xrde042_desc name="construct.c.page3.xrde042_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde043
            #add-point:BEFORE FIELD xrde043 name="construct.b.page3.xrde043"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde043
            
            #add-point:AFTER FIELD xrde043 name="construct.a.page3.xrde043"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde043
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde043
            #add-point:ON ACTION controlp INFIELD xrde043 name="construct.c.page3.xrde043"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde043_desc
            #add-point:BEFORE FIELD xrde043_desc name="construct.b.page3.xrde043_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde043_desc
            
            #add-point:AFTER FIELD xrde043_desc name="construct.a.page3.xrde043_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde043_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde043_desc
            #add-point:ON ACTION controlp INFIELD xrde043_desc name="construct.c.page3.xrde043_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde044
            #add-point:BEFORE FIELD xrde044 name="construct.b.page3.xrde044"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde044
            
            #add-point:AFTER FIELD xrde044 name="construct.a.page3.xrde044"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde044
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde044
            #add-point:ON ACTION controlp INFIELD xrde044 name="construct.c.page3.xrde044"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde044_desc
            #add-point:BEFORE FIELD xrde044_desc name="construct.b.page3.xrde044_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde044_desc
            
            #add-point:AFTER FIELD xrde044_desc name="construct.a.page3.xrde044_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde044_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde044_desc
            #add-point:ON ACTION controlp INFIELD xrde044_desc name="construct.c.page3.xrde044_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde045
            #add-point:BEFORE FIELD xrde045 name="construct.b.page3.xrde045"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde045
            
            #add-point:AFTER FIELD xrde045 name="construct.a.page3.xrde045"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde045
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde045
            #add-point:ON ACTION controlp INFIELD xrde045 name="construct.c.page3.xrde045"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde045_desc
            #add-point:BEFORE FIELD xrde045_desc name="construct.b.page3.xrde045_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde045_desc
            
            #add-point:AFTER FIELD xrde045_desc name="construct.a.page3.xrde045_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde045_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde045_desc
            #add-point:ON ACTION controlp INFIELD xrde045_desc name="construct.c.page3.xrde045_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde046
            #add-point:BEFORE FIELD xrde046 name="construct.b.page3.xrde046"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde046
            
            #add-point:AFTER FIELD xrde046 name="construct.a.page3.xrde046"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde046
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde046
            #add-point:ON ACTION controlp INFIELD xrde046 name="construct.c.page3.xrde046"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde046_desc
            #add-point:BEFORE FIELD xrde046_desc name="construct.b.page3.xrde046_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde046_desc
            
            #add-point:AFTER FIELD xrde046_desc name="construct.a.page3.xrde046_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde046_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde046_desc
            #add-point:ON ACTION controlp INFIELD xrde046_desc name="construct.c.page3.xrde046_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde047
            #add-point:BEFORE FIELD xrde047 name="construct.b.page3.xrde047"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde047
            
            #add-point:AFTER FIELD xrde047 name="construct.a.page3.xrde047"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde047
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde047
            #add-point:ON ACTION controlp INFIELD xrde047 name="construct.c.page3.xrde047"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde047_desc
            #add-point:BEFORE FIELD xrde047_desc name="construct.b.page3.xrde047_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde047_desc
            
            #add-point:AFTER FIELD xrde047_desc name="construct.a.page3.xrde047_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde047_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde047_desc
            #add-point:ON ACTION controlp INFIELD xrde047_desc name="construct.c.page3.xrde047_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde048
            #add-point:BEFORE FIELD xrde048 name="construct.b.page3.xrde048"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde048
            
            #add-point:AFTER FIELD xrde048 name="construct.a.page3.xrde048"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde048
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde048
            #add-point:ON ACTION controlp INFIELD xrde048 name="construct.c.page3.xrde048"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde048_desc
            #add-point:BEFORE FIELD xrde048_desc name="construct.b.page3.xrde048_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde048_desc
            
            #add-point:AFTER FIELD xrde048_desc name="construct.a.page3.xrde048_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde048_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde048_desc
            #add-point:ON ACTION controlp INFIELD xrde048_desc name="construct.c.page3.xrde048_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde049
            #add-point:BEFORE FIELD xrde049 name="construct.b.page3.xrde049"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde049
            
            #add-point:AFTER FIELD xrde049 name="construct.a.page3.xrde049"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde049
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde049
            #add-point:ON ACTION controlp INFIELD xrde049 name="construct.c.page3.xrde049"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde049_desc
            #add-point:BEFORE FIELD xrde049_desc name="construct.b.page3.xrde049_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde049_desc
            
            #add-point:AFTER FIELD xrde049_desc name="construct.a.page3.xrde049_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde049_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde049_desc
            #add-point:ON ACTION controlp INFIELD xrde049_desc name="construct.c.page3.xrde049_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde050
            #add-point:BEFORE FIELD xrde050 name="construct.b.page3.xrde050"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde050
            
            #add-point:AFTER FIELD xrde050 name="construct.a.page3.xrde050"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde050
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde050
            #add-point:ON ACTION controlp INFIELD xrde050 name="construct.c.page3.xrde050"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde050_desc
            #add-point:BEFORE FIELD xrde050_desc name="construct.b.page3.xrde050_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde050_desc
            
            #add-point:AFTER FIELD xrde050_desc name="construct.a.page3.xrde050_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde050_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde050_desc
            #add-point:ON ACTION controlp INFIELD xrde050_desc name="construct.c.page3.xrde050_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde051
            #add-point:BEFORE FIELD xrde051 name="construct.b.page3.xrde051"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde051
            
            #add-point:AFTER FIELD xrde051 name="construct.a.page3.xrde051"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde051
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde051
            #add-point:ON ACTION controlp INFIELD xrde051 name="construct.c.page3.xrde051"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde051_desc
            #add-point:BEFORE FIELD xrde051_desc name="construct.b.page3.xrde051_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde051_desc
            
            #add-point:AFTER FIELD xrde051_desc name="construct.a.page3.xrde051_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page3.xrde051_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde051_desc
            #add-point:ON ACTION controlp INFIELD xrde051_desc name="construct.c.page3.xrde051_desc"
            
            #END add-point
 
 
   
       
      END CONSTRUCT
      
      CONSTRUCT g_wc2_table2 ON xrceseq,xrce002,xrce003,xrce004,xrce005,xrce054,xrcc003_1,xrca057,xrce010, 
          xrce016,xrce016_desc,xrce100,xrce101,xrcc108,xrcc118,xrce109,xrce119,xrce001,xrcecomp,xrcesite, 
          xrceorga,xrce027,xrce015,xrce015_desc,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139,xrce017, 
          xrce017_desc,xrce018,xrce018_desc,xrce019,xrce019_desc,xrce035,xrce035_desc,xrce036,xrce036_desc, 
          xrce020,xrce020_desc,xrce022,xrce022_desc,xrce023,xrce023_desc,xrce039,xrce040,xrce040_desc, 
          xrce042,xrce042_desc,xrce043,xrce043_desc,xrce044,xrce044_desc,xrce045,xrce045_desc,xrce046, 
          xrce046_desc,xrce047,xrce047_desc,xrce048,xrce048_desc,xrce049,xrce049_desc,xrce050,xrce050_desc, 
          xrce051,xrce051_desc
           FROM s_detail4[1].xrceseq,s_detail4[1].xrce002,s_detail4[1].xrce003,s_detail4[1].xrce004, 
               s_detail4[1].xrce005,s_detail4[1].xrce054,s_detail4[1].xrcc003_1,s_detail4[1].xrca057, 
               s_detail4[1].xrce010,s_detail4[1].xrce016,s_detail4[1].xrce016_desc,s_detail4[1].xrce100, 
               s_detail4[1].xrce101,s_detail4[1].xrcc108,s_detail4[1].xrcc118,s_detail4[1].xrce109,s_detail4[1].xrce119, 
               s_detail4[1].xrce001,s_detail4[1].xrcecomp,s_detail4[1].xrcesite,s_detail4[1].xrceorga, 
               s_detail4[1].xrce027,s_detail4[1].xrce015,s_detail4[1].xrce015_desc,s_detail5[1].xrce120, 
               s_detail5[1].xrce121,s_detail5[1].xrce129,s_detail5[1].xrce130,s_detail5[1].xrce131,s_detail5[1].xrce139, 
               s_detail6[1].xrce017,s_detail6[1].xrce017_desc,s_detail6[1].xrce018,s_detail6[1].xrce018_desc, 
               s_detail6[1].xrce019,s_detail6[1].xrce019_desc,s_detail6[1].xrce035,s_detail6[1].xrce035_desc, 
               s_detail6[1].xrce036,s_detail6[1].xrce036_desc,s_detail6[1].xrce020,s_detail6[1].xrce020_desc, 
               s_detail6[1].xrce022,s_detail6[1].xrce022_desc,s_detail6[1].xrce023,s_detail6[1].xrce023_desc, 
               s_detail6[1].xrce039,s_detail6[1].xrce040,s_detail6[1].xrce040_desc,s_detail6[1].xrce042, 
               s_detail6[1].xrce042_desc,s_detail6[1].xrce043,s_detail6[1].xrce043_desc,s_detail6[1].xrce044, 
               s_detail6[1].xrce044_desc,s_detail6[1].xrce045,s_detail6[1].xrce045_desc,s_detail6[1].xrce046, 
               s_detail6[1].xrce046_desc,s_detail6[1].xrce047,s_detail6[1].xrce047_desc,s_detail6[1].xrce048, 
               s_detail6[1].xrce048_desc,s_detail6[1].xrce049,s_detail6[1].xrce049_desc,s_detail6[1].xrce050, 
               s_detail6[1].xrce050_desc,s_detail6[1].xrce051,s_detail6[1].xrce051_desc
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct name="cs.body2.before_construct"
            
            #end add-point 
            
       #單身公用欄位開窗相關處理(table 2)
       
       
       #單身一般欄位開窗相關處理       
                #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrceseq
            #add-point:BEFORE FIELD xrceseq name="construct.b.page4.xrceseq"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrceseq
            
            #add-point:AFTER FIELD xrceseq name="construct.a.page4.xrceseq"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrceseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrceseq
            #add-point:ON ACTION controlp INFIELD xrceseq name="construct.c.page4.xrceseq"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce002
            #add-point:BEFORE FIELD xrce002 name="construct.b.page4.xrce002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce002
            
            #add-point:AFTER FIELD xrce002 name="construct.a.page4.xrce002"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce002
            #add-point:ON ACTION controlp INFIELD xrce002 name="construct.c.page4.xrce002"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xrce003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce003
            #add-point:ON ACTION controlp INFIELD xrce003 name="construct.c.page4.xrce003"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_xrce003()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce003  #顯示到畫面上
            NEXT FIELD xrce003                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce003
            #add-point:BEFORE FIELD xrce003 name="construct.b.page4.xrce003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce003
            
            #add-point:AFTER FIELD xrce003 name="construct.a.page4.xrce003"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce004
            #add-point:BEFORE FIELD xrce004 name="construct.b.page4.xrce004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce004
            
            #add-point:AFTER FIELD xrce004 name="construct.a.page4.xrce004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce004
            #add-point:ON ACTION controlp INFIELD xrce004 name="construct.c.page4.xrce004"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce005
            #add-point:BEFORE FIELD xrce005 name="construct.b.page4.xrce005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce005
            
            #add-point:AFTER FIELD xrce005 name="construct.a.page4.xrce005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce005
            #add-point:ON ACTION controlp INFIELD xrce005 name="construct.c.page4.xrce005"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce054
            #add-point:BEFORE FIELD xrce054 name="construct.b.page4.xrce054"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce054
            
            #add-point:AFTER FIELD xrce054 name="construct.a.page4.xrce054"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce054
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce054
            #add-point:ON ACTION controlp INFIELD xrce054 name="construct.c.page4.xrce054"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcc003_1
            #add-point:BEFORE FIELD xrcc003_1 name="construct.b.page4.xrcc003_1"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcc003_1
            
            #add-point:AFTER FIELD xrcc003_1 name="construct.a.page4.xrcc003_1"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrcc003_1
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcc003_1
            #add-point:ON ACTION controlp INFIELD xrcc003_1 name="construct.c.page4.xrcc003_1"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xrca057
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrca057
            #add-point:ON ACTION controlp INFIELD xrca057 name="construct.c.page4.xrca057"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_xrca057()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrca057  #顯示到畫面上
            NEXT FIELD xrca057                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrca057
            #add-point:BEFORE FIELD xrca057 name="construct.b.page4.xrca057"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrca057
            
            #add-point:AFTER FIELD xrca057 name="construct.a.page4.xrca057"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce010
            #add-point:BEFORE FIELD xrce010 name="construct.b.page4.xrce010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce010
            
            #add-point:AFTER FIELD xrce010 name="construct.a.page4.xrce010"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce010
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce010
            #add-point:ON ACTION controlp INFIELD xrce010 name="construct.c.page4.xrce010"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xrce016
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce016
            #add-point:ON ACTION controlp INFIELD xrce016 name="construct.c.page4.xrce016"
            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL aglt310_04()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce016  #顯示到畫面上
            NEXT FIELD xrce016                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce016
            #add-point:BEFORE FIELD xrce016 name="construct.b.page4.xrce016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce016
            
            #add-point:AFTER FIELD xrce016 name="construct.a.page4.xrce016"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce016_desc
            #add-point:BEFORE FIELD xrce016_desc name="construct.b.page4.xrce016_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce016_desc
            
            #add-point:AFTER FIELD xrce016_desc name="construct.a.page4.xrce016_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce016_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce016_desc
            #add-point:ON ACTION controlp INFIELD xrce016_desc name="construct.c.page4.xrce016_desc"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL aglt310_04()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce016       #顯示到畫面上
            NEXT FIELD xrce016_desc                     #返回原欄位
            #END add-point
 
 
         #Ctrlp:construct.c.page4.xrce100
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce100
            #add-point:ON ACTION controlp INFIELD xrce100 name="construct.c.page4.xrce100"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_aooi001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce100  #顯示到畫面上
            NEXT FIELD xrce100                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce100
            #add-point:BEFORE FIELD xrce100 name="construct.b.page4.xrce100"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce100
            
            #add-point:AFTER FIELD xrce100 name="construct.a.page4.xrce100"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce101
            #add-point:BEFORE FIELD xrce101 name="construct.b.page4.xrce101"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce101
            
            #add-point:AFTER FIELD xrce101 name="construct.a.page4.xrce101"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce101
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce101
            #add-point:ON ACTION controlp INFIELD xrce101 name="construct.c.page4.xrce101"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcc108
            #add-point:BEFORE FIELD xrcc108 name="construct.b.page4.xrcc108"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcc108
            
            #add-point:AFTER FIELD xrcc108 name="construct.a.page4.xrcc108"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrcc108
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcc108
            #add-point:ON ACTION controlp INFIELD xrcc108 name="construct.c.page4.xrcc108"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcc118
            #add-point:BEFORE FIELD xrcc118 name="construct.b.page4.xrcc118"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcc118
            
            #add-point:AFTER FIELD xrcc118 name="construct.a.page4.xrcc118"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrcc118
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcc118
            #add-point:ON ACTION controlp INFIELD xrcc118 name="construct.c.page4.xrcc118"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce109
            #add-point:BEFORE FIELD xrce109 name="construct.b.page4.xrce109"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce109
            
            #add-point:AFTER FIELD xrce109 name="construct.a.page4.xrce109"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce109
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce109
            #add-point:ON ACTION controlp INFIELD xrce109 name="construct.c.page4.xrce109"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce119
            #add-point:BEFORE FIELD xrce119 name="construct.b.page4.xrce119"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce119
            
            #add-point:AFTER FIELD xrce119 name="construct.a.page4.xrce119"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce119
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce119
            #add-point:ON ACTION controlp INFIELD xrce119 name="construct.c.page4.xrce119"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce001
            #add-point:BEFORE FIELD xrce001 name="construct.b.page4.xrce001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce001
            
            #add-point:AFTER FIELD xrce001 name="construct.a.page4.xrce001"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce001
            #add-point:ON ACTION controlp INFIELD xrce001 name="construct.c.page4.xrce001"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcecomp
            #add-point:BEFORE FIELD xrcecomp name="construct.b.page4.xrcecomp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcecomp
            
            #add-point:AFTER FIELD xrcecomp name="construct.a.page4.xrcecomp"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrcecomp
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcecomp
            #add-point:ON ACTION controlp INFIELD xrcecomp name="construct.c.page4.xrcecomp"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcesite
            #add-point:BEFORE FIELD xrcesite name="construct.b.page4.xrcesite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcesite
            
            #add-point:AFTER FIELD xrcesite name="construct.a.page4.xrcesite"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrcesite
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcesite
            #add-point:ON ACTION controlp INFIELD xrcesite name="construct.c.page4.xrcesite"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrceorga
            #add-point:BEFORE FIELD xrceorga name="construct.b.page4.xrceorga"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrceorga
            
            #add-point:AFTER FIELD xrceorga name="construct.a.page4.xrceorga"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrceorga
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrceorga
            #add-point:ON ACTION controlp INFIELD xrceorga name="construct.c.page4.xrceorga"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce027
            #add-point:BEFORE FIELD xrce027 name="construct.b.page4.xrce027"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce027
            
            #add-point:AFTER FIELD xrce027 name="construct.a.page4.xrce027"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce027
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce027
            #add-point:ON ACTION controlp INFIELD xrce027 name="construct.c.page4.xrce027"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce015
            #add-point:BEFORE FIELD xrce015 name="construct.b.page4.xrce015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce015
            
            #add-point:AFTER FIELD xrce015 name="construct.a.page4.xrce015"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce015
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce015
            #add-point:ON ACTION controlp INFIELD xrce015 name="construct.c.page4.xrce015"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce015_desc
            #add-point:BEFORE FIELD xrce015_desc name="construct.b.page4.xrce015_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce015_desc
            
            #add-point:AFTER FIELD xrce015_desc name="construct.a.page4.xrce015_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page4.xrce015_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce015_desc
            #add-point:ON ACTION controlp INFIELD xrce015_desc name="construct.c.page4.xrce015_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce120
            #add-point:BEFORE FIELD xrce120 name="construct.b.page5.xrce120"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce120
            
            #add-point:AFTER FIELD xrce120 name="construct.a.page5.xrce120"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xrce120
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce120
            #add-point:ON ACTION controlp INFIELD xrce120 name="construct.c.page5.xrce120"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce121
            #add-point:BEFORE FIELD xrce121 name="construct.b.page5.xrce121"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce121
            
            #add-point:AFTER FIELD xrce121 name="construct.a.page5.xrce121"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xrce121
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce121
            #add-point:ON ACTION controlp INFIELD xrce121 name="construct.c.page5.xrce121"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce129
            #add-point:BEFORE FIELD xrce129 name="construct.b.page5.xrce129"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce129
            
            #add-point:AFTER FIELD xrce129 name="construct.a.page5.xrce129"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xrce129
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce129
            #add-point:ON ACTION controlp INFIELD xrce129 name="construct.c.page5.xrce129"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce130
            #add-point:BEFORE FIELD xrce130 name="construct.b.page5.xrce130"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce130
            
            #add-point:AFTER FIELD xrce130 name="construct.a.page5.xrce130"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xrce130
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce130
            #add-point:ON ACTION controlp INFIELD xrce130 name="construct.c.page5.xrce130"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce131
            #add-point:BEFORE FIELD xrce131 name="construct.b.page5.xrce131"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce131
            
            #add-point:AFTER FIELD xrce131 name="construct.a.page5.xrce131"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xrce131
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce131
            #add-point:ON ACTION controlp INFIELD xrce131 name="construct.c.page5.xrce131"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce139
            #add-point:BEFORE FIELD xrce139 name="construct.b.page5.xrce139"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce139
            
            #add-point:AFTER FIELD xrce139 name="construct.a.page5.xrce139"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page5.xrce139
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce139
            #add-point:ON ACTION controlp INFIELD xrce139 name="construct.c.page5.xrce139"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page6.xrce017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce017
            #add-point:ON ACTION controlp INFIELD xrce017 name="construct.c.page6.xrce017"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce017  #顯示到畫面上
            NEXT FIELD xrce017                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce017
            #add-point:BEFORE FIELD xrce017 name="construct.b.page6.xrce017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce017
            
            #add-point:AFTER FIELD xrce017 name="construct.a.page6.xrce017"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce017_desc
            #add-point:BEFORE FIELD xrce017_desc name="construct.b.page6.xrce017_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce017_desc
            
            #add-point:AFTER FIELD xrce017_desc name="construct.a.page6.xrce017_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce017_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce017_desc
            #add-point:ON ACTION controlp INFIELD xrce017_desc name="construct.c.page6.xrce017_desc"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page6.xrce018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce018
            #add-point:ON ACTION controlp INFIELD xrce018 name="construct.c.page6.xrce018"
            #161011-00007#1 Mark ---(S)---
           ##此段落由子樣板a08產生
           ##開窗c段
           #INITIALIZE g_qryparam.* TO NULL
           #LET g_qryparam.state = 'c'
           #LET g_qryparam.reqry = FALSE
           #CALL q_ooea001_1()                           #呼叫開窗
           #DISPLAY g_qryparam.return1 TO xrce018  #顯示到畫面上
           #NEXT FIELD xrce018                     #返回原欄位
            #161011-00007#1 Mark ---(E)---
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce018
            #add-point:BEFORE FIELD xrce018 name="construct.b.page6.xrce018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce018
            
            #add-point:AFTER FIELD xrce018 name="construct.a.page6.xrce018"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce018_desc
            #add-point:BEFORE FIELD xrce018_desc name="construct.b.page6.xrce018_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce018_desc
            
            #add-point:AFTER FIELD xrce018_desc name="construct.a.page6.xrce018_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce018_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce018_desc
            #add-point:ON ACTION controlp INFIELD xrce018_desc name="construct.c.page6.xrce018_desc"
            #161011-00007#1 Add  ---(S)---
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_today
            CALL q_ooeg001_4()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce018_desc   #顯示到畫面上
            NEXT FIELD xrce018_desc                      #返回原欄位
            #161011-00007#1 Add  ---(E)---
            #END add-point
 
 
         #Ctrlp:construct.c.page6.xrce019
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce019
            #add-point:ON ACTION controlp INFIELD xrce019 name="construct.c.page6.xrce019"
            #161011-00007#1 Mark ---(S)---
           ##此段落由子樣板a08產生
           ##開窗c段
           #INITIALIZE g_qryparam.* TO NULL
           #LET g_qryparam.state = 'c'
           #LET g_qryparam.reqry = FALSE
           #CALL q_ooea001_10()                           #呼叫開窗
           #DISPLAY g_qryparam.return1 TO xrce019  #顯示到畫面上
           #NEXT FIELD xrce019                     #返回原欄位
            #161011-00007#1 Mark ---(E)---
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce019
            #add-point:BEFORE FIELD xrce019 name="construct.b.page6.xrce019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce019
            
            #add-point:AFTER FIELD xrce019 name="construct.a.page6.xrce019"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce019_desc
            #add-point:BEFORE FIELD xrce019_desc name="construct.b.page6.xrce019_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce019_desc
            
            #add-point:AFTER FIELD xrce019_desc name="construct.a.page6.xrce019_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce019_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce019_desc
            #add-point:ON ACTION controlp INFIELD xrce019_desc name="construct.c.page6.xrce019_desc"
            #161011-00007#1 Add  ---(S)---
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_today
            CALL q_ooeg001_4()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce019_desc   #顯示到畫面上
            NEXT FIELD xrce019_desc                      #返回原欄位
            #161011-00007#1 Add  ---(E)---
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce035
            #add-point:BEFORE FIELD xrce035 name="construct.b.page6.xrce035"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce035
            
            #add-point:AFTER FIELD xrce035 name="construct.a.page6.xrce035"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce035
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce035
            #add-point:ON ACTION controlp INFIELD xrce035 name="construct.c.page6.xrce035"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce035_desc
            #add-point:BEFORE FIELD xrce035_desc name="construct.b.page6.xrce035_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce035_desc
            
            #add-point:AFTER FIELD xrce035_desc name="construct.a.page6.xrce035_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce035_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce035_desc
            #add-point:ON ACTION controlp INFIELD xrce035_desc name="construct.c.page6.xrce035_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce036
            #add-point:BEFORE FIELD xrce036 name="construct.b.page6.xrce036"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce036
            
            #add-point:AFTER FIELD xrce036 name="construct.a.page6.xrce036"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce036
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce036
            #add-point:ON ACTION controlp INFIELD xrce036 name="construct.c.page6.xrce036"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce036_desc
            #add-point:BEFORE FIELD xrce036_desc name="construct.b.page6.xrce036_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce036_desc
            
            #add-point:AFTER FIELD xrce036_desc name="construct.a.page6.xrce036_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce036_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce036_desc
            #add-point:ON ACTION controlp INFIELD xrce036_desc name="construct.c.page6.xrce036_desc"
            
            #END add-point
 
 
         #Ctrlp:construct.c.page6.xrce020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce020
            #add-point:ON ACTION controlp INFIELD xrce020 name="construct.c.page6.xrce020"
            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oocq002_5()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO xrce020  #顯示到畫面上
            NEXT FIELD xrce020                     #返回原欄位
    


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce020
            #add-point:BEFORE FIELD xrce020 name="construct.b.page6.xrce020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce020
            
            #add-point:AFTER FIELD xrce020 name="construct.a.page6.xrce020"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce020_desc
            #add-point:BEFORE FIELD xrce020_desc name="construct.b.page6.xrce020_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce020_desc
            
            #add-point:AFTER FIELD xrce020_desc name="construct.a.page6.xrce020_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce020_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce020_desc
            #add-point:ON ACTION controlp INFIELD xrce020_desc name="construct.c.page6.xrce020_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce022
            #add-point:BEFORE FIELD xrce022 name="construct.b.page6.xrce022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce022
            
            #add-point:AFTER FIELD xrce022 name="construct.a.page6.xrce022"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce022
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce022
            #add-point:ON ACTION controlp INFIELD xrce022 name="construct.c.page6.xrce022"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce022_desc
            #add-point:BEFORE FIELD xrce022_desc name="construct.b.page6.xrce022_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce022_desc
            
            #add-point:AFTER FIELD xrce022_desc name="construct.a.page6.xrce022_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce022_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce022_desc
            #add-point:ON ACTION controlp INFIELD xrce022_desc name="construct.c.page6.xrce022_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce023
            #add-point:BEFORE FIELD xrce023 name="construct.b.page6.xrce023"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce023
            
            #add-point:AFTER FIELD xrce023 name="construct.a.page6.xrce023"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce023
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce023
            #add-point:ON ACTION controlp INFIELD xrce023 name="construct.c.page6.xrce023"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce023_desc
            #add-point:BEFORE FIELD xrce023_desc name="construct.b.page6.xrce023_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce023_desc
            
            #add-point:AFTER FIELD xrce023_desc name="construct.a.page6.xrce023_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce023_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce023_desc
            #add-point:ON ACTION controlp INFIELD xrce023_desc name="construct.c.page6.xrce023_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce039
            #add-point:BEFORE FIELD xrce039 name="construct.b.page6.xrce039"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce039
            
            #add-point:AFTER FIELD xrce039 name="construct.a.page6.xrce039"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce039
            #add-point:ON ACTION controlp INFIELD xrce039 name="construct.c.page6.xrce039"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce040
            #add-point:BEFORE FIELD xrce040 name="construct.b.page6.xrce040"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce040
            
            #add-point:AFTER FIELD xrce040 name="construct.a.page6.xrce040"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce040
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce040
            #add-point:ON ACTION controlp INFIELD xrce040 name="construct.c.page6.xrce040"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce040_desc
            #add-point:BEFORE FIELD xrce040_desc name="construct.b.page6.xrce040_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce040_desc
            
            #add-point:AFTER FIELD xrce040_desc name="construct.a.page6.xrce040_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce040_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce040_desc
            #add-point:ON ACTION controlp INFIELD xrce040_desc name="construct.c.page6.xrce040_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce042
            #add-point:BEFORE FIELD xrce042 name="construct.b.page6.xrce042"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce042
            
            #add-point:AFTER FIELD xrce042 name="construct.a.page6.xrce042"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce042
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce042
            #add-point:ON ACTION controlp INFIELD xrce042 name="construct.c.page6.xrce042"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce042_desc
            #add-point:BEFORE FIELD xrce042_desc name="construct.b.page6.xrce042_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce042_desc
            
            #add-point:AFTER FIELD xrce042_desc name="construct.a.page6.xrce042_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce042_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce042_desc
            #add-point:ON ACTION controlp INFIELD xrce042_desc name="construct.c.page6.xrce042_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce043
            #add-point:BEFORE FIELD xrce043 name="construct.b.page6.xrce043"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce043
            
            #add-point:AFTER FIELD xrce043 name="construct.a.page6.xrce043"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce043
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce043
            #add-point:ON ACTION controlp INFIELD xrce043 name="construct.c.page6.xrce043"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce043_desc
            #add-point:BEFORE FIELD xrce043_desc name="construct.b.page6.xrce043_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce043_desc
            
            #add-point:AFTER FIELD xrce043_desc name="construct.a.page6.xrce043_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce043_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce043_desc
            #add-point:ON ACTION controlp INFIELD xrce043_desc name="construct.c.page6.xrce043_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce044
            #add-point:BEFORE FIELD xrce044 name="construct.b.page6.xrce044"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce044
            
            #add-point:AFTER FIELD xrce044 name="construct.a.page6.xrce044"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce044
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce044
            #add-point:ON ACTION controlp INFIELD xrce044 name="construct.c.page6.xrce044"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce044_desc
            #add-point:BEFORE FIELD xrce044_desc name="construct.b.page6.xrce044_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce044_desc
            
            #add-point:AFTER FIELD xrce044_desc name="construct.a.page6.xrce044_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce044_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce044_desc
            #add-point:ON ACTION controlp INFIELD xrce044_desc name="construct.c.page6.xrce044_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce045
            #add-point:BEFORE FIELD xrce045 name="construct.b.page6.xrce045"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce045
            
            #add-point:AFTER FIELD xrce045 name="construct.a.page6.xrce045"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce045
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce045
            #add-point:ON ACTION controlp INFIELD xrce045 name="construct.c.page6.xrce045"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce045_desc
            #add-point:BEFORE FIELD xrce045_desc name="construct.b.page6.xrce045_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce045_desc
            
            #add-point:AFTER FIELD xrce045_desc name="construct.a.page6.xrce045_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce045_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce045_desc
            #add-point:ON ACTION controlp INFIELD xrce045_desc name="construct.c.page6.xrce045_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce046
            #add-point:BEFORE FIELD xrce046 name="construct.b.page6.xrce046"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce046
            
            #add-point:AFTER FIELD xrce046 name="construct.a.page6.xrce046"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce046
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce046
            #add-point:ON ACTION controlp INFIELD xrce046 name="construct.c.page6.xrce046"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce046_desc
            #add-point:BEFORE FIELD xrce046_desc name="construct.b.page6.xrce046_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce046_desc
            
            #add-point:AFTER FIELD xrce046_desc name="construct.a.page6.xrce046_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce046_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce046_desc
            #add-point:ON ACTION controlp INFIELD xrce046_desc name="construct.c.page6.xrce046_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce047
            #add-point:BEFORE FIELD xrce047 name="construct.b.page6.xrce047"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce047
            
            #add-point:AFTER FIELD xrce047 name="construct.a.page6.xrce047"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce047
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce047
            #add-point:ON ACTION controlp INFIELD xrce047 name="construct.c.page6.xrce047"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce047_desc
            #add-point:BEFORE FIELD xrce047_desc name="construct.b.page6.xrce047_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce047_desc
            
            #add-point:AFTER FIELD xrce047_desc name="construct.a.page6.xrce047_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce047_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce047_desc
            #add-point:ON ACTION controlp INFIELD xrce047_desc name="construct.c.page6.xrce047_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce048
            #add-point:BEFORE FIELD xrce048 name="construct.b.page6.xrce048"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce048
            
            #add-point:AFTER FIELD xrce048 name="construct.a.page6.xrce048"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce048
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce048
            #add-point:ON ACTION controlp INFIELD xrce048 name="construct.c.page6.xrce048"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce048_desc
            #add-point:BEFORE FIELD xrce048_desc name="construct.b.page6.xrce048_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce048_desc
            
            #add-point:AFTER FIELD xrce048_desc name="construct.a.page6.xrce048_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce048_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce048_desc
            #add-point:ON ACTION controlp INFIELD xrce048_desc name="construct.c.page6.xrce048_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce049
            #add-point:BEFORE FIELD xrce049 name="construct.b.page6.xrce049"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce049
            
            #add-point:AFTER FIELD xrce049 name="construct.a.page6.xrce049"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce049
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce049
            #add-point:ON ACTION controlp INFIELD xrce049 name="construct.c.page6.xrce049"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce049_desc
            #add-point:BEFORE FIELD xrce049_desc name="construct.b.page6.xrce049_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce049_desc
            
            #add-point:AFTER FIELD xrce049_desc name="construct.a.page6.xrce049_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce049_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce049_desc
            #add-point:ON ACTION controlp INFIELD xrce049_desc name="construct.c.page6.xrce049_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce050
            #add-point:BEFORE FIELD xrce050 name="construct.b.page6.xrce050"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce050
            
            #add-point:AFTER FIELD xrce050 name="construct.a.page6.xrce050"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce050
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce050
            #add-point:ON ACTION controlp INFIELD xrce050 name="construct.c.page6.xrce050"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce050_desc
            #add-point:BEFORE FIELD xrce050_desc name="construct.b.page6.xrce050_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce050_desc
            
            #add-point:AFTER FIELD xrce050_desc name="construct.a.page6.xrce050_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce050_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce050_desc
            #add-point:ON ACTION controlp INFIELD xrce050_desc name="construct.c.page6.xrce050_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce051
            #add-point:BEFORE FIELD xrce051 name="construct.b.page6.xrce051"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce051
            
            #add-point:AFTER FIELD xrce051 name="construct.a.page6.xrce051"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce051
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce051
            #add-point:ON ACTION controlp INFIELD xrce051 name="construct.c.page6.xrce051"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce051_desc
            #add-point:BEFORE FIELD xrce051_desc name="construct.b.page6.xrce051_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce051_desc
            
            #add-point:AFTER FIELD xrce051_desc name="construct.a.page6.xrce051_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.page6.xrce051_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce051_desc
            #add-point:ON ACTION controlp INFIELD xrce051_desc name="construct.c.page6.xrce051_desc"
            
            #END add-point
 
 
   
       
      END CONSTRUCT
 
 
      
 
      
      #add-point:cs段add_cs(本段內只能出現新的CONSTRUCT指令) name="cs.add_cs"
      
      #end add-point
 
      BEFORE DIALOG
         CALL cl_qbe_init()
         #add-point:cs段b_dialog name="cs.b_dialog"
         
         #end add-point  
 
      #查詢方案列表
      ON ACTION qbe_select
         LET ls_wc = ""
         CALL cl_qbe_list("c") RETURNING ls_wc
         IF NOT cl_null(ls_wc) THEN
            CALL util.JSON.parse(ls_wc, la_wc)
            INITIALIZE g_wc, g_wc2, g_wc2_table1, g_wc2_extend TO NULL
            INITIALIZE g_wc2_table2 TO NULL
 
 
            FOR li_idx = 1 TO la_wc.getLength()
               CASE
                  WHEN la_wc[li_idx].tableid = "xrda_t" 
                     LET g_wc = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "xrde_t" 
                     LET g_wc2_table1 = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "xrce_t" 
                     LET g_wc2_table2 = la_wc[li_idx].wc
 
 
               END CASE
            END FOR
         END IF
    
      #條件儲存為方案
      ON ACTION qbe_save
         CALL cl_qbe_save()
 
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   END DIALOG
   
   #組合g_wc2
   LET g_wc2 = g_wc2_table1
   IF g_wc2_table2 <> " 1=1" THEN
      LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
   END IF
 
 
 
 
   
   #add-point:cs段結束前 name="cs.after_construct"
   #160122-00001#5 --add--str--
   IF NOT cl_null(g_wc2) THEN 
      LET g_wc2 = cl_replace_str(g_wc2,"l_xrde008","xrde008")
      LET g_wc2_table1 = cl_replace_str(g_wc2_table1,"l_xrde008","xrde008")
   END IF
   #160122-00001#5 --add--end
   #end add-point    
 
   IF INT_FLAG THEN
      RETURN
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.filter" >}
#應用 a50 樣板自動產生(Version:8)
#+ filter過濾功能
PRIVATE FUNCTION axrt400_filter()
   #add-point:filter段define name="filter.define_customerization"
   
   #end add-point   
   #add-point:filter段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="filter.define"
   
   #end add-point   
   
   #add-point:Function前置處理  name="filter.pre_function"
   
   #end add-point
   
   #切換畫面
   IF NOT g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF   
 
   LET INT_FLAG = 0
 
   LET g_qryparam.state = 'c'
 
   LET g_wc_filter_t = g_wc_filter.trim()
   LET g_wc_t = g_wc
 
   LET g_wc = cl_replace_str(g_wc, g_wc_filter_t, '')
 
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
      #單頭
      CONSTRUCT g_wc_filter ON xrdadocdt,xrda005,xrdadocno,xrda014,xrdasite,xrda003,xrdald
                          FROM s_browse[1].b_xrdadocdt,s_browse[1].b_xrda005,s_browse[1].b_xrdadocno, 
                              s_browse[1].b_xrda014,s_browse[1].b_xrdasite,s_browse[1].b_xrda003,s_browse[1].b_xrdald 
 
 
         BEFORE CONSTRUCT
               DISPLAY axrt400_filter_parser('xrdadocdt') TO s_browse[1].b_xrdadocdt
            DISPLAY axrt400_filter_parser('xrda005') TO s_browse[1].b_xrda005
            DISPLAY axrt400_filter_parser('xrdadocno') TO s_browse[1].b_xrdadocno
            DISPLAY axrt400_filter_parser('xrda014') TO s_browse[1].b_xrda014
            DISPLAY axrt400_filter_parser('xrdasite') TO s_browse[1].b_xrdasite
            DISPLAY axrt400_filter_parser('xrda003') TO s_browse[1].b_xrda003
            DISPLAY axrt400_filter_parser('xrdald') TO s_browse[1].b_xrdald
      
         #add-point:filter段cs_ctrl name="filter.cs_ctrl"
         
         #end add-point
      
      END CONSTRUCT
 
      #add-point:filter段add_cs name="filter.add_cs"
      
      #end add-point
 
      BEFORE DIALOG
         #add-point:filter段b_dialog name="filter.b_dialog"
         
         #end add-point  
      
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   
   END DIALOG
 
   IF NOT INT_FLAG THEN
      LET g_wc_filter = "   AND   ", g_wc_filter, "   "
      LET g_wc = g_wc , g_wc_filter
   ELSE
      LET g_wc_filter = g_wc_filter_t
      LET g_wc = g_wc_t
   END IF
 
      CALL axrt400_filter_show('xrdadocdt')
   CALL axrt400_filter_show('xrda005')
   CALL axrt400_filter_show('xrdadocno')
   CALL axrt400_filter_show('xrda014')
   CALL axrt400_filter_show('xrdasite')
   CALL axrt400_filter_show('xrda003')
   CALL axrt400_filter_show('xrdald')
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.filter_parser" >}
#+ filter過濾功能
PRIVATE FUNCTION axrt400_filter_parser(ps_field)
   #add-point:filter段define name="filter_parser.define_customerization"
   
   #end add-point    
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num10
   DEFINE li_tmp2    LIKE type_t.num10
   DEFINE ls_var     STRING
   #add-point:filter段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="filter_parser.define"
   
   #end add-point    
   
   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF
 
   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF
 
   RETURN ls_var
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.filter_show" >}
#+ 顯示過濾條件
PRIVATE FUNCTION axrt400_filter_show(ps_field)
   DEFINE ps_field         STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING
 
   LET ls_name = "formonly.b_", ps_field
   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LEt ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF
 
   #顯示資料組合
   LET ls_condition = axrt400_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF
 
   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.query" >}
#+ 資料查詢QBE功能準備
PRIVATE FUNCTION axrt400_query()
   #add-point:query段define(客製用) name="query.define_customerization"
   
   #end add-point   
   DEFINE ls_wc STRING
   #add-point:query段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="query.define"
   
   #end add-point   
   
   #add-point:Function前置處理  name="query.pre_function"
   
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF   
   
   LET ls_wc = g_wc
   
   LET INT_FLAG = 0
   CALL cl_navigator_setting( g_current_idx, g_detail_cnt )
   ERROR ""
   
   #清除畫面及相關資料
   CLEAR FORM
   CALL g_browser.clear()       
   CALL g_xrde_d.clear()
   CALL g_xrde2_d.clear()
   CALL g_xrde3_d.clear()
   CALL g_xrde4_d.clear()
   CALL g_xrde5_d.clear()
   CALL g_xrde6_d.clear()
 
   
   #add-point:query段other name="query.other"
   
   #end add-point   
   
   DISPLAY '' TO FORMONLY.idx
   DISPLAY '' TO FORMONLY.cnt
   DISPLAY '' TO FORMONLY.b_index
   DISPLAY '' TO FORMONLY.b_count
   DISPLAY '' TO FORMONLY.h_index
   DISPLAY '' TO FORMONLY.h_count
   
   CALL axrt400_construct()
 
   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      #LET g_wc = ls_wc
      LET g_wc = " 1=2"
      CALL axrt400_browser_fill("")
      CALL axrt400_fetch("")
      RETURN
   END IF
   
   #儲存WC資訊
   CALL cl_dlg_save_user_latestqry("("||g_wc||") AND ("||g_wc2||")")
   
   #搜尋後資料初始化 
   LET g_detail_cnt  = 0
   LET g_current_idx = 1
   LET g_current_row = 0
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   LET g_detail_idx_list[1] = 1
   LET g_detail_idx_list[2] = 1
   LET g_detail_idx_list[3] = 1
   LET g_detail_idx_list[4] = 1
   LET g_detail_idx_list[5] = 1
   LET g_detail_idx_list[6] = 1
 
   LET g_error_show  = 1
   LET g_wc_filter   = ""
   LET l_ac = 1
   CALL FGL_SET_ARR_CURR(1)
      CALL axrt400_filter_show('xrdadocdt')
   CALL axrt400_filter_show('xrda005')
   CALL axrt400_filter_show('xrdadocno')
   CALL axrt400_filter_show('xrda014')
   CALL axrt400_filter_show('xrdasite')
   CALL axrt400_filter_show('xrda003')
   CALL axrt400_filter_show('xrdald')
   CALL axrt400_browser_fill("F")
         
   IF g_browser_cnt = 0 THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "-100" 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
   ELSE
      CALL axrt400_fetch("F") 
      #顯示單身筆數
      CALL axrt400_idx_chk()
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.fetch" >}
#+ 指定PK後抓取單頭其他資料
PRIVATE FUNCTION axrt400_fetch(p_flag)
   #add-point:fetch段define(客製用) name="fetch.define_customerization"
   
   #end add-point    
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   #add-point:fetch段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="fetch.define"
   
   #end add-point    
   
   #add-point:Function前置處理  name="fetch.pre_function"
   
   #end add-point
   
   IF g_browser_cnt = 0 THEN
      RETURN
   END IF
 
   #清空第二階單身
 
   
   CALL cl_ap_performance_next_start()
   CASE p_flag
      WHEN 'F' 
         LET g_current_idx = 1
      WHEN 'L'  
         LET g_current_idx = g_browser.getLength()              
      WHEN 'P'
         IF g_current_idx > 1 THEN               
            LET g_current_idx = g_current_idx - 1
         END IF 
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF        
      WHEN '/'
         IF (NOT g_no_ask) THEN    
            CALL cl_set_act_visible("accept,cancel", TRUE)    
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0
 
            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl" 
            END PROMPT
 
            CALL cl_set_act_visible("accept,cancel", FALSE)    
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE  
            END IF           
         END IF
         
         IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
             LET g_current_idx = g_jump
         END IF
         LET g_no_ask = FALSE  
   END CASE 
 
   CALL g_curr_diag.setCurrentRow("s_browse", g_current_idx) #設定browse 索引
   
   LET g_current_row = g_current_idx
   LET g_detail_cnt = g_header_cnt                  
   
   #單身總筆數顯示
   IF g_detail_cnt > 0 THEN
      #若單身有資料時, idx至少為1
      IF g_detail_idx <= 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx  
   ELSE
      LET g_detail_idx = 0
      DISPLAY '' TO FORMONLY.idx    
   END IF
   
   #瀏覽頁筆數顯示
   LET g_browser_idx = g_pagestart+g_current_idx-1
   DISPLAY g_browser_idx TO FORMONLY.b_index   #當下筆數
   DISPLAY g_browser_idx TO FORMONLY.h_index   #當下筆數
   
   CALL cl_navigator_setting( g_current_idx, g_browser_cnt )
 
   #代表沒有資料
   IF g_current_idx = 0 OR g_browser.getLength() = 0 THEN
      RETURN
   END IF
   
   #避免超出browser資料筆數上限
   IF g_current_idx > g_browser.getLength() THEN
      LET g_browser_idx = g_browser.getLength()
      LET g_current_idx = g_browser.getLength()
   END IF
   
   LET g_xrda_m.xrdald = g_browser[g_current_idx].b_xrdald
   LET g_xrda_m.xrdadocno = g_browser[g_current_idx].b_xrdadocno
 
   
   #重讀DB,因TEMP有不被更新特性
   EXECUTE axrt400_master_referesh USING g_xrda_m.xrdald,g_xrda_m.xrdadocno INTO g_xrda_m.xrdasite,g_xrda_m.xrda003, 
       g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005, 
       g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
       g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003_desc, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda005_desc,g_xrda_m.xrda004_desc,g_xrda_m.xrda015_desc, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid_desc,g_xrda_m.xrdacrtdp_desc, 
       g_xrda_m.xrdamodid_desc,g_xrda_m.xrdacnfid_desc
   
   #遮罩相關處理
   LET g_xrda_m_mask_o.* =  g_xrda_m.*
   CALL axrt400_xrda_t_mask()
   LET g_xrda_m_mask_n.* =  g_xrda_m.*
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL axrt400_set_act_visible()   
   CALL axrt400_set_act_no_visible()
   
   #add-point:fetch段action控制 name="fetch.action_control"
   
   #end add-point  
   
   
   
   #add-point:fetch結束前 name="fetch.after"
   
   #160308-00010#6 add ---(S)---
   IF g_xrda_m.xrdastus NOT MATCHES '[NDR]' THEN   # N未確認/D抽單/R已拒絕允許修改
      CALL cl_set_act_visible("modify,delete,modify_detail", FALSE)
   END IF
   #160308-00010#6 add ---(E)--- 
   
   #end add-point
   
   #保存單頭舊值
   LET g_xrda_m_t.* = g_xrda_m.*
   LET g_xrda_m_o.* = g_xrda_m.*
   
   LET g_data_owner = g_xrda_m.xrdaownid      
   LET g_data_dept  = g_xrda_m.xrdaowndp
   
   #重新顯示   
   CALL axrt400_show()
 
   #應用 a56 樣板自動產生(Version:3)
   #檢查此單據是否需顯示BPM簽核狀況按鈕 
   IF cl_bpm_chk() THEN
      CALL cl_set_act_visible("bpm_status",TRUE)
   ELSE
      CALL cl_set_act_visible("bpm_status",FALSE)
   END IF
 
 
 
 
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.insert" >}
#+ 資料新增
PRIVATE FUNCTION axrt400_insert()
   #add-point:insert段define(客製用) name="insert.define_customerization"
   
   #end add-point    
   #add-point:insert段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="insert.define"
   
   #end add-point    
   
   #add-point:Function前置處理  name="insert.pre_function"
   
   #end add-point
   
   #清畫面欄位內容
   CLEAR FORM                    
   CALL g_xrde_d.clear()   
   CALL g_xrde2_d.clear()  
   CALL g_xrde3_d.clear()  
   CALL g_xrde4_d.clear()  
   CALL g_xrde5_d.clear()  
   CALL g_xrde6_d.clear()  
 
 
   INITIALIZE g_xrda_m.* TO NULL             #DEFAULT 設定
   
   LET g_xrdald_t = NULL
   LET g_xrdadocno_t = NULL
 
   
   LET g_master_insert = FALSE
   
   #add-point:insert段before name="insert.before"
   
   #end add-point    
   
   CALL s_transaction_begin()
   WHILE TRUE
      #公用欄位給值(單頭)
      #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_xrda_m.xrdaownid = g_user
      LET g_xrda_m.xrdaowndp = g_dept
      LET g_xrda_m.xrdacrtid = g_user
      LET g_xrda_m.xrdacrtdp = g_dept 
      LET g_xrda_m.xrdacrtdt = cl_get_current()
      LET g_xrda_m.xrdamodid = g_user
      LET g_xrda_m.xrdamoddt = cl_get_current()
      LET g_xrda_m.xrdastus = 'N'
 
 
 
 
      #append欄位給值
      
     
      #一般欄位給值
            LET g_xrda_m.xrdastus = "N"
 
  
      #add-point:單頭預設值 name="insert.default"
      CALL axrt400_default()
      #end add-point 
      
      #保存單頭舊值(用於資料輸入錯誤還原預設值時使用)
      LET g_xrda_m_t.* = g_xrda_m.*
      LET g_xrda_m_o.* = g_xrda_m.*
      
      #顯示狀態(stus)圖片
            #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_xrda_m.xrdastus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
    
      CALL axrt400_input("a")
      
      #add-point:單頭輸入後 name="insert.after_insert"
      
      #end add-point
      
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code   = 9001 
         LET g_errparam.popup  = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
      END IF
      
      IF NOT g_master_insert THEN
         DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
         DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
         INITIALIZE g_xrda_m.* TO NULL
         INITIALIZE g_xrde_d TO NULL
         INITIALIZE g_xrde2_d TO NULL
         INITIALIZE g_xrde3_d TO NULL
         INITIALIZE g_xrde4_d TO NULL
         INITIALIZE g_xrde5_d TO NULL
         INITIALIZE g_xrde6_d TO NULL
 
         #add-point:取消新增後 name="insert.cancel"
         
         #end add-point 
         CALL axrt400_show()
         RETURN
      END IF
      
      LET INT_FLAG = 0
      #CALL g_xrde_d.clear()
      #CALL g_xrde2_d.clear()
      #CALL g_xrde3_d.clear()
      #CALL g_xrde4_d.clear()
      #CALL g_xrde5_d.clear()
      #CALL g_xrde6_d.clear()
 
 
      LET g_rec_b = 0
      CALL s_transaction_end('Y','0')
      EXIT WHILE
        
   END WHILE
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL axrt400_set_act_visible()   
   CALL axrt400_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_xrdald_t = g_xrda_m.xrdald
   LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
   
   #組合新增資料的條件
   LET g_add_browse = " xrdaent = " ||g_enterprise|| " AND",
                      " xrdald = '", g_xrda_m.xrdald, "' "
                      ," AND xrdadocno = '", g_xrda_m.xrdadocno, "' "
 
                      
   #add-point:組合新增資料的條件後 name="insert.after.add_browse"
   
   #end add-point
      
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL axrt400_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   CLOSE axrt400_cl
   
   CALL axrt400_idx_chk()
   
   #撈取異動後的資料(主要是帶出reference)
   EXECUTE axrt400_master_referesh USING g_xrda_m.xrdald,g_xrda_m.xrdadocno INTO g_xrda_m.xrdasite,g_xrda_m.xrda003, 
       g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005, 
       g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
       g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003_desc, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda005_desc,g_xrda_m.xrda004_desc,g_xrda_m.xrda015_desc, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid_desc,g_xrda_m.xrdacrtdp_desc, 
       g_xrda_m.xrdamodid_desc,g_xrda_m.xrdacnfid_desc
   
   
   #遮罩相關處理
   LET g_xrda_m_mask_o.* =  g_xrda_m.*
   CALL axrt400_xrda_t_mask()
   LET g_xrda_m_mask_n.* =  g_xrda_m.*
   
   #將資料顯示到畫面上
   DISPLAY BY NAME g_xrda_m.xrdasite,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003,g_xrda_m.xrda003_desc,g_xrda_m.xrdald, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda001, 
       g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda005_desc,g_xrda_m.xrda004,g_xrda_m.xrda004_desc, 
       g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010,g_xrda_m.xrda017, 
       g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda015_desc,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtid_desc, 
       g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdp_desc,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid,g_xrda_m.xrdamodid_desc, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfid_desc,g_xrda_m.xrdacnfdt,g_xrda_m.xrda007_desc, 
       g_xrda_m.l_desc,g_xrda_m.lbl_amt5_desc,g_xrda_m.lbl_amt1_1_desc,g_xrda_m.lbl_amt3_1_desc,g_xrda_m.lbl_amt5_1_desc 
 
   
   #add-point:新增結束後 name="insert.after"
   
   #end add-point 
   
   LET g_data_owner = g_xrda_m.xrdaownid      
   LET g_data_dept  = g_xrda_m.xrdaowndp
   
   #功能已完成,通報訊息中心
   CALL axrt400_msgcentre_notify('insert')
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.modify" >}
#+ 資料修改
PRIVATE FUNCTION axrt400_modify()
   #add-point:modify段define(客製用) name="modify.define_customerization"
   
   #end add-point    
   DEFINE l_new_key    DYNAMIC ARRAY OF STRING
   DEFINE l_old_key    DYNAMIC ARRAY OF STRING
   DEFINE l_field_key  DYNAMIC ARRAY OF STRING
   DEFINE l_wc2_table1          STRING
   DEFINE l_wc2_table2   STRING
 
 
 
   #add-point:modify段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="modify.define"
   DEFINE l_success    LIKE type_t.num5
   #end add-point    
   
   #add-point:Function前置處理  name="modify.pre_function"
   
   #end add-point
   
   #保存單頭舊值
   LET g_xrda_m_t.* = g_xrda_m.*
   LET g_xrda_m_o.* = g_xrda_m.*
   
   IF g_xrda_m.xrdald IS NULL
   OR g_xrda_m.xrdadocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   ERROR ""
  
   LET g_xrdald_t = g_xrda_m.xrdald
   LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
   CALL s_transaction_begin()
   
   OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN axrt400_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CLOSE axrt400_cl
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE axrt400_master_referesh USING g_xrda_m.xrdald,g_xrda_m.xrdadocno INTO g_xrda_m.xrdasite,g_xrda_m.xrda003, 
       g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005, 
       g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
       g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003_desc, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda005_desc,g_xrda_m.xrda004_desc,g_xrda_m.xrda015_desc, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid_desc,g_xrda_m.xrdacrtdp_desc, 
       g_xrda_m.xrdamodid_desc,g_xrda_m.xrdacnfid_desc
   
   #檢查是否允許此動作
   IF NOT axrt400_action_chk() THEN
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_xrda_m_mask_o.* =  g_xrda_m.*
   CALL axrt400_xrda_t_mask()
   LET g_xrda_m_mask_n.* =  g_xrda_m.*
   
   
   
   #add-point:modify段show之前 name="modify.before_show"
   #141226-00016#2 By 01727 Add ---(S)---
   CALL s_axrt300_date_chk(g_xrda_m.xrdasite,g_xrda_m.xrdadocdt) RETURNING l_success
   IF NOT l_success THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "axr-00300"
      LET g_errparam.popup  = TRUE 
      CALL cl_err() 
      RETURN
   END IF
   #141226-00016#2 By 01727 Add ---(E)---
   #end add-point  
   
   #LET l_wc2_table1 = g_wc2_table1
   #LET g_wc2_table1 = " 1=1"
   #LET l_wc2_table2 = g_wc2_table2
   #LET l_wc2_table2 = " 1=1"
 
 
 
   
   CALL axrt400_show()
   #add-point:modify段show之後 name="modify.after_show"
   #20150309--add--str--
   #IF g_xrda_m.xrdastus <> 'N' THEN              #160308-00010#6 mark
   IF g_xrda_m.xrdastus NOT MATCHES '[NDR]' THEN  #160308-00010#6 add
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'agl-00313'
      LET g_errparam.extend = g_xrda_m.xrdadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      RETURN
   END IF
   #20150309--add--end--
   #end add-point
   
   #LET g_wc2_table1 = l_wc2_table1
   #LET  g_wc2_table2 = l_wc2_table2 
 
 
 
    
   WHILE TRUE
      LET g_xrdald_t = g_xrda_m.xrdald
      LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
      
      #寫入修改者/修改日期資訊(單頭)
      LET g_xrda_m.xrdamodid = g_user 
LET g_xrda_m.xrdamoddt = cl_get_current()
LET g_xrda_m.xrdamodid_desc = cl_get_username(g_xrda_m.xrdamodid)
      
      #add-point:modify段修改前 name="modify.before_input"
      
      #160308-00010#6 add ---(S)---
      IF g_xrda_m.xrdastus MATCHES '[DR]' THEN 
         LET g_xrda_m.xrdastus = "N"
      END IF
      #160308-00010#6 add ---(E)---  
      
      #end add-point
      
      #欄位更改
      LET g_loc = 'n'
      LET g_update = FALSE
      LET g_master_commit = "N"
      CALL axrt400_input("u")
      LET g_loc = 'n'
 
      #add-point:modify段修改後 name="modify.after_input"
     
      #end add-point
      
      IF g_update OR NOT INT_FLAG THEN
         #若有modid跟moddt則進行update
         UPDATE xrda_t SET (xrdamodid,xrdamoddt) = (g_xrda_m.xrdamodid,g_xrda_m.xrdamoddt)
          WHERE xrdaent = g_enterprise AND xrdald = g_xrdald_t
            AND xrdadocno = g_xrdadocno_t
 
      END IF
    
      IF INT_FLAG THEN
         CALL s_transaction_end('N','0')
         LET INT_FLAG = 0
         #若單頭無commit則還原
         IF g_master_commit = "N" THEN
            LET g_xrda_m.* = g_xrda_m_t.*
            CALL axrt400_show()
         END IF
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code   = 9001 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN
      END IF 
                  
      #若單頭key欄位有變更
      IF g_xrda_m.xrdald != g_xrda_m_t.xrdald
      OR g_xrda_m.xrdadocno != g_xrda_m_t.xrdadocno
 
      THEN
         CALL s_transaction_begin()
         
         #add-point:單身fk修改前 name="modify.body.b_fk_update"
         
         #end add-point
         
         #更新單身key值
         UPDATE xrde_t SET xrdeld = g_xrda_m.xrdald
                                       ,xrdedocno = g_xrda_m.xrdadocno
 
          WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m_t.xrdald
            AND xrdedocno = g_xrda_m_t.xrdadocno
 
            
         #add-point:單身fk修改中 name="modify.body.m_fk_update"
         
         #end add-point
 
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "xrde_t" 
            #   LET g_errparam.code   = "std-00009" 
            #   LET g_errparam.popup  = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         
         #add-point:單身fk修改後 name="modify.body.a_fk_update"
         
         #end add-point
         
         #更新單身key值
         #add-point:單身fk修改前 name="modify.body.b_fk_update2"
         
         #end add-point
         
         UPDATE xrce_t
            SET xrceld = g_xrda_m.xrdald
               ,xrcedocno = g_xrda_m.xrdadocno
 
          WHERE xrceent = g_enterprise AND
                xrceld = g_xrdald_t
            AND xrcedocno = g_xrdadocno_t
 
         #add-point:單身fk修改中 name="modify.body.m_fk_update2"
         
         #end add-point
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            #   INITIALIZE g_errparam TO NULL 
            #   LET g_errparam.extend = "xrce_t" 
            #   LET g_errparam.code   = "std-00009" 
            #   LET g_errparam.popup  = TRUE 
            #   CALL cl_err()
            #   CALL s_transaction_end('N','0')
            #   CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CONTINUE WHILE
         END CASE
         #add-point:單身fk修改後 name="modify.body.a_fk_update2"
         
         #end add-point
 
 
         
 
         
         #UPDATE 多語言table key值
         
         
         
         
         
         
 
         CALL s_transaction_end('Y','0')
      END IF
    
      EXIT WHILE
   END WHILE
 
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL axrt400_set_act_visible()   
   CALL axrt400_set_act_no_visible()
 
   #組合新增資料的條件
   LET g_add_browse = " xrdaent = " ||g_enterprise|| " AND",
                      " xrdald = '", g_xrda_m.xrdald, "' "
                      ," AND xrdadocno = '", g_xrda_m.xrdadocno, "' "
 
   #填到對應位置
   CALL axrt400_browser_fill("")
 
   CLOSE axrt400_cl
   
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL axrt400_msgcentre_notify('modify')
 
END FUNCTION 
 
{</section>}
 
{<section id="axrt400.input" >}
#+ 資料輸入
PRIVATE FUNCTION axrt400_input(p_cmd)
   #add-point:input段define(客製用) name="input.define_customerization"
   
   #end add-point  
   DEFINE  p_cmd                 LIKE type_t.chr1
   DEFINE  l_cmd_t               LIKE type_t.chr1
   DEFINE  l_cmd                 LIKE type_t.chr1
   DEFINE  l_n                   LIKE type_t.num10                #檢查重複用  
   DEFINE  l_cnt                 LIKE type_t.num10                #檢查重複用  
   DEFINE  l_lock_sw             LIKE type_t.chr1                #單身鎖住否  
   DEFINE  l_allow_insert        LIKE type_t.num5                #可新增否 
   DEFINE  l_allow_delete        LIKE type_t.num5                #可刪除否  
   DEFINE  l_count               LIKE type_t.num10
   DEFINE  l_i                   LIKE type_t.num10
   DEFINE  l_ac_t                LIKE type_t.num10
   DEFINE  l_insert              BOOLEAN
   DEFINE  ls_return             STRING
   DEFINE  l_var_keys            DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys          DYNAMIC ARRAY OF STRING
   DEFINE  l_vars                DYNAMIC ARRAY OF STRING
   DEFINE  l_fields              DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak        DYNAMIC ARRAY OF STRING
   DEFINE  lb_reproduce          BOOLEAN
   DEFINE  li_reproduce          LIKE type_t.num10
   DEFINE  li_reproduce_target   LIKE type_t.num10
   DEFINE  ls_keys               DYNAMIC ARRAY OF VARCHAR(500)
   #add-point:input段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="input.define"
   DEFINE  l_success             LIKE type_t.num5
   DEFINE  l_origin_str          STRING   #組織範圍
   DEFINE  l_glaa024             LIKE glaa_t.glaa024
   DEFINE  l_xrda005             LIKE xrda_t.xrda005
   DEFINE  l_xrda005_t           LIKE xrda_t.xrda005
   DEFINE  l_flag                LIKE type_t.chr1
   DEFINE  l_ooab002             LIKE ooab_t.ooab002
   DEFINE  l_ooac004             LIKE ooac_t.ooac004
   DEFINE  l_xrde109             LIKE xrde_t.xrde109
   DEFINE  l_xrde119             LIKE xrde_t.xrde119
   DEFINE  l_xrce109             LIKE xrce_t.xrce109
   DEFINE  l_xrce119             LIKE xrce_t.xrce119
   DEFINE  l_xrde003             LIKE xrde_t.xrde003
   DEFINE  l_xrde004             LIKE xrde_t.xrde004
   DEFINE  l_xrce003             LIKE xrce_t.xrce003
   DEFINE  l_xrce004             LIKE xrce_t.xrce004
   DEFINE  l_xrce005             LIKE xrce_t.xrce005
   DEFINE  l_xrcastus            LIKE xrca_t.xrcastus
   DEFINE  l_errno               LIKE type_t.chr10
   DEFINE  l_xrde_flag           LIKE type_t.chr1
   DEFINE  l_xrce_flag           LIKE type_t.chr1
   DEFINE  l_cnt1                LIKE type_t.num5
   DEFINE  l_apcastus            LIKE apca_t.apcastus
   DEFINE  l_xrdeseq             LIKE xrde_t.xrdeseq
   DEFINE  l_xrde010             LIKE xrde_t.xrde010
   DEFINE  l_slip                LIKE xrda_t.xrdadocno
   DEFINE  l_xrcc108             LIKE xrcc_t.xrcc108          #150817-00031#1 add lujh
   DEFINE  l_xrcc118             LIKE xrcc_t.xrcc118          #150817-00031#1 add lujh   
   #150518-00044#6--
   DEFINE ls_js                  STRING
   DEFINE lc_param               RECORD
            type                 LIKE type_t.chr1,
            apca004              LIKE apca_t.apca004
                             END RECORD
   #150518-00044#6--  
   
   #151125-00006#1-add-s
   DEFINE  l_ooba002             LIKE ooba_t.ooba002
   DEFINE  l_dfin0031            LIKE type_t.chr1
   DEFINE  l_dfin0032            LIKE type_t.chr1
   #151125-00006#1-add-e
   DEFINE  l_glaa004             LIKE glaa_t.glaa004  #150916-00015#1 -add   
   DEFINE  l_glaa005             LIKE glaa_t.glaa005  #160612-00005#1  Add
   DEFINE l_isbbdocno            LIKE isbb_t.isbbdocno   #160607-00015#3 Add
   DEFINE l_xrca060              LIKE xrca_t.xrca060  #160628-00002#1 add
   DEFINE l_apca060              LIKE apca_t.apca060  #160628-00002#1 add
   DEFINE l_pmaa004              LIKE pmaa_t.pmaa004   #160802-00007#1 Add
   #end add-point  
   
   #add-point:Function前置處理  name="input.pre_function"
   
   #end add-point
   
   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r'
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF   
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_xrda_m.xrdasite,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003,g_xrda_m.xrda003_desc,g_xrda_m.xrdald, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda001, 
       g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda005_desc,g_xrda_m.xrda004,g_xrda_m.xrda004_desc, 
       g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010,g_xrda_m.xrda017, 
       g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda015_desc,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtid_desc, 
       g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdp_desc,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid,g_xrda_m.xrdamodid_desc, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfid_desc,g_xrda_m.xrdacnfdt,g_xrda_m.xrda007_desc, 
       g_xrda_m.l_desc,g_xrda_m.lbl_amt5_desc,g_xrda_m.lbl_amt1_1_desc,g_xrda_m.lbl_amt3_1_desc,g_xrda_m.lbl_amt5_1_desc 
 
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
 
   CALL cl_set_head_visible("","YES")  
 
   LET l_insert = FALSE
   LET g_action_choice = ""
 
   #add-point:input段define_sql name="input.define_sql"
   
   #end add-point 
   LET g_forupd_sql = "SELECT xrdeseq,xrde002,xrde006,xrde003,xrde004,xrde008,xrde032,xrde010,xrde016, 
       xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp,xrdesite,xrdeorga,xrde011,xrde015, 
       xrde012,xrdeseq,xrde120,xrde121,xrde129,xrde130,xrde131,xrde139,xrdeseq,xrde017,xrde018,xrde019, 
       xrde035,xrde036,xrde020,xrde022,xrde023,xrde039,xrde040,xrde042,xrde043,xrde044,xrde045,xrde046, 
       xrde047,xrde048,xrde049,xrde050,xrde051 FROM xrde_t WHERE xrdeent=? AND xrdeld=? AND xrdedocno=?  
       AND xrdeseq=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql"
   
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE axrt400_bcl CURSOR FROM g_forupd_sql
   
   #add-point:input段define_sql name="input.define_sql2"
   
   #end add-point    
   LET g_forupd_sql = "SELECT xrceseq,xrce002,xrce003,xrce004,xrce005,xrce054,xrce010,xrce016,xrce100, 
       xrce101,xrce109,xrce119,xrce001,xrcecomp,xrcesite,xrceorga,xrce027,xrce015,xrceseq,xrce120,xrce121, 
       xrce129,xrce130,xrce131,xrce139,xrceseq,xrce017,xrce018,xrce019,xrce035,xrce036,xrce020,xrce022, 
       xrce023,xrce039,xrce040,xrce042,xrce043,xrce044,xrce045,xrce046,xrce047,xrce048,xrce049,xrce050, 
       xrce051 FROM xrce_t WHERE xrceent=? AND xrceld=? AND xrcedocno=? AND xrceseq=? FOR UPDATE"
   #add-point:input段define_sql name="input.after_define_sql2"
   
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE axrt400_bcl2 CURSOR FROM g_forupd_sql
 
 
   
 
 
   #add-point:input段define_sql name="input.other_sql"
   
   #end add-point 
 
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'
   
   #控制key欄位可否輸入
   CALL axrt400_set_entry(p_cmd)
   #add-point:set_entry後 name="input.after_set_entry"
   
   #end add-point
   CALL axrt400_set_no_entry(p_cmd)
 
   DISPLAY BY NAME g_xrda_m.xrdasite,g_xrda_m.xrda003,g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno, 
       g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006, 
       g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010,g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009, 
       g_xrda_m.xrda015,g_xrda_m.xrda016
   
   LET lb_reproduce = FALSE
   LET l_ac_t = 1
   
   #關閉被遮罩相關欄位輸入, 無法確定USER是否會需要輸入此欄位
   #因此先行關閉, 若有需要可於下方add-point中自行開啟
   CALL cl_mask_set_no_entry()
   
   #add-point:資料輸入前 name="input.before_input"
   LET l_xrde_flag = 'N'
   LET l_xrce_flag = 'N'
   LET g_errshow = 1
   WHILE TRUE
      LET l_flag = 'N'
      IF l_xrde_flag = 'Y' THEN 
         CALL s_transaction_begin()
      END IF
      IF l_xrce_flag = 'Y' THEN 
         CALL s_transaction_begin()
      END IF
   #end add-point
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
{</section>}
 
{<section id="axrt400.input.head" >}
      #單頭段
      INPUT BY NAME g_xrda_m.xrdasite,g_xrda_m.xrda003,g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno, 
          g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006, 
          g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010,g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009, 
          g_xrda_m.xrda015,g_xrda_m.xrda016 
         ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂ACTION(master_input)
         
     
         BEFORE INPUT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN axrt400_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CLOSE axrt400_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            IF l_cmd_t = 'r' THEN
               
            END IF
            #因應離開單頭後已寫入資料庫, 若重新回到單頭則視為修改
            #因此需於此處開啟/關閉欄位
            CALL axrt400_set_entry(p_cmd)
            #add-point:資料輸入前 name="input.m.before_input"
            IF l_xrde_flag = 'Y' THEN 
               LET l_xrde_flag = 'N'
               NEXT FIELD xrdeseq
            END IF
            IF l_xrce_flag = 'Y' THEN 
               LET l_xrce_flag = 'N'
               NEXT FIELD xrceseq
            END IF
            #end add-point
            CALL axrt400_set_no_entry(p_cmd)
    
                  #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdasite
            
            #add-point:AFTER FIELD xrdasite name="input.a.xrdasite"
            IF NOT cl_null(g_xrda_m.xrdasite) THEN
               IF p_cmd = 'a' OR (p_cmd = 'u' AND (g_xrda_m.xrdasite != g_xrda_m_t.xrdasite OR g_xrda_m_t.xrdasite IS NULL )) THEN
                  CALL s_fin_account_center_sons_query('3',g_xrda_m.xrdasite,g_today,'1')
                  IF g_xrda_m.xrdasite != g_xrda_m_t.xrdasite OR cl_null(g_xrda_m_t.xrdasite) THEN
                    CALL s_fin_orga_get_comp_ld(g_xrda_m.xrdasite) RETURNING l_success,g_errno,g_xrda_m.xrdacomp,g_xrda_m.xrdald
                  END IF
                  CALL s_fin_account_center_with_ld_chk(g_xrda_m.xrdasite,g_xrda_m.xrdald,g_user,'3','N','',g_xrda_m.xrdadocdt) RETURNING l_success,g_errno
                  IF NOT cl_null(g_errno) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = g_errno
                     LET g_errparam.extend = g_xrda_m.xrdasite
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_xrda_m.xrdasite = g_xrda_m_t.xrdasite
                     LET g_xrda_m.xrdald = g_xrda_m_t.xrdald
                     CALL axrt400_ref_show()
                     NEXT FIELD CURRENT
                  END IF
                  #141226-00016#2 By 01727 Add ---(S)---
                  CALL s_axrt300_date_chk(g_xrda_m.xrdasite,g_xrda_m.xrdadocdt) RETURNING l_success
                  IF NOT l_success THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "axr-00299"
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err() 
                     LET g_xrda_m.xrdasite = g_xrda_m_t.xrdasite
                     LET g_xrda_m.xrdald = g_xrda_m_t.xrdald
                     NEXT FIELD CURRENT
                  END IF
                  #141226-00016#2 By 01727 Add ---(E)---
                 #160317-00007#1 Mark ---(S)---
                 #SELECT ooef017 INTO g_xrda_m.xrdacomp
                 #  FROM ooef_t
                 # WHERE ooefent = g_enterprise
                 #   AND ooef001 = g_xrda_m.xrdasite
                 #160317-00007#1 Mark ---(E)---
               END IF
            END IF
            CALL axrt400_ref_show()
            CALL s_fin_account_center_sons_query('3',g_xrda_m.xrdasite,g_today,'1')
           #160317-00007#1 Add  ---(S)---
            SELECT glaacomp INTO g_xrda_m.xrdacomp FROM glaa_t WHERE glaaent = g_enterprise
               AND glaald = g_g_xrda_m.xrdald
           #160317-00007#1 Add  ---(E)---
            LET g_xrda_m_t.xrdasite = g_xrda_m.xrdasite
            LET g_xrda_m_t.xrdald = g_xrda_m.xrdald
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdasite
            #add-point:BEFORE FIELD xrdasite name="input.b.xrdasite"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdasite
            #add-point:ON CHANGE xrdasite name="input.g.xrdasite"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda003
            
            #add-point:AFTER FIELD xrda003 name="input.a.xrda003"
            IF NOT cl_null(g_xrda_m.xrda003) THEN 
#此段落由子樣板a19產生
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrda_m.xrda003

               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "aim-00070:sub-01302|aooi130|",cl_get_progname("aooi130",g_lang,"2"),"|:EXEPROGaooi130"    #160318-00025#13      
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooag001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrda_m.xrda003 = g_xrda_m_t.xrda003
                  CALL axrt400_ref_show()
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda003
            #add-point:BEFORE FIELD xrda003 name="input.b.xrda003"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda003
            #add-point:ON CHANGE xrda003 name="input.g.xrda003"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdald
            
            #add-point:AFTER FIELD xrdald name="input.a.xrdald"
            IF NOT cl_null(g_xrda_m.xrdald) THEN
               IF p_cmd = 'a' OR (p_cmd = 'u' AND (g_xrda_m.xrdald != g_xrda_m_t.xrdald OR g_xrda_m_t.xrdald IS NULL )) THEN
                  CALL s_fin_account_center_with_ld_chk(g_xrda_m.xrdasite,g_xrda_m.xrdald,g_user,'3','N','',g_xrda_m.xrdadocdt) RETURNING l_success,g_errno
                  IF NOT cl_null(g_errno) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = g_errno
                     LET g_errparam.extend = g_xrda_m.xrdald
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_xrda_m.xrdald = g_xrda_m_t.xrdald
                     CALL axrt400_ref_show()
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            CALL axrt400_ref_show()
            CALL axrt400_glaa_get()
            CALL axrt400_ref_amt()
            LET g_xrda_m_t.xrdald = g_xrda_m.xrdald
           #160317-00007#1 Add  ---(S)---
            SELECT glaacomp INTO g_xrda_m.xrdacomp FROM glaa_t WHERE glaaent = g_enterprise
               AND glaald = g_g_xrda_m.xrdald
           #160317-00007#1 Add  ---(E)---
            CALL cl_get_para(g_enterprise,g_xrda_m.xrdacomp,'S-FIN-2007') RETURNING g_para_data
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdald
            #add-point:BEFORE FIELD xrdald name="input.b.xrdald"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdald
            #add-point:ON CHANGE xrdald name="input.g.xrdald"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdacomp
            #add-point:BEFORE FIELD xrdacomp name="input.b.xrdacomp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdacomp
            
            #add-point:AFTER FIELD xrdacomp name="input.a.xrdacomp"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdacomp
            #add-point:ON CHANGE xrdacomp name="input.g.xrdacomp"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdadocno
            
            #add-point:AFTER FIELD xrdadocno name="input.a.xrdadocno"
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  NOT cl_null(g_xrda_m.xrdald) AND NOT cl_null(g_xrda_m.xrdadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xrda_m.xrdald != g_xrdald_t  OR g_xrda_m.xrdadocno != g_xrdadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xrda_t WHERE "||"xrdaent = '" ||g_enterprise|| "' AND "||"xrdald = '"||g_xrda_m.xrdald ||"' AND "|| "xrdadocno = '"||g_xrda_m.xrdadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
 
            LET l_glaa024 = ''
            SELECT glaa024 INTO l_glaa024 FROM glaa_t WHERE glaaent = g_enterprise AND glaald = g_xrda_m.xrdald
            IF NOT cl_null(g_xrda_m.xrdadocno) THEN 
               CALL s_aooi200_fin_chk_slip(g_xrda_m.xrdald,l_glaa024,g_xrda_m.xrdadocno,'axrt400') RETURNING l_success
               IF l_success = FALSE THEN 
                  LET g_xrda_m.xrdadocno = ''
                  NEXT FIELD xrdadocno
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdadocno
            #add-point:BEFORE FIELD xrdadocno name="input.b.xrdadocno"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdadocno
            #add-point:ON CHANGE xrdadocno name="input.g.xrdadocno"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda001
            #add-point:BEFORE FIELD xrda001 name="input.b.xrda001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda001
            
            #add-point:AFTER FIELD xrda001 name="input.a.xrda001"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda001
            #add-point:ON CHANGE xrda001 name="input.g.xrda001"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdadocdt
            #add-point:BEFORE FIELD xrdadocdt name="input.b.xrdadocdt"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdadocdt
            
            #add-point:AFTER FIELD xrdadocdt name="input.a.xrdadocdt"
            #141226-00016#2 By 01727 Mark ---(S)---
           #IF g_xrda_m.xrdadocdt < g_para_data THEN 
           #   INITIALIZE g_errparam TO NULL
           #   LET g_errparam.code = 'axr-00269'
           #   LET g_errparam.extend = g_xrda_m.xrdadocdt
           #   LET g_errparam.popup = FALSE
           #   CALL cl_err()
           #
           #   LET g_xrda_m.xrdadocdt = g_xrda_m_t.xrdadocdt
           #   NEXT FIELD xrdadocdt
           #END IF
            #141226-00016#2 By 01727 Mark ---(E)---
            #141226-00016#2 By 01727 Add  ---(S)---
            IF NOT cl_null(g_xrda_m.xrdadocdt) THEN
               CALL s_axrt300_date_chk(g_xrda_m.xrdasite,g_xrda_m.xrdadocdt) RETURNING l_success
               IF NOT l_success THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "axr-00299"
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  LET g_xrda_m.xrdadocdt = g_xrda_m_t.xrdadocdt
                  NEXT FIELD CURRENT
               END IF
            END IF
            #141226-00016#2 By 01727 Add  ---(S)---
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdadocdt
            #add-point:ON CHANGE xrdadocdt name="input.g.xrdadocdt"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda005
            
            #add-point:AFTER FIELD xrda005 name="input.a.xrda005"
            IF NOT cl_null(g_xrda_m.xrda005) THEN 
#此段落由子樣板a19產生
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrda_m.xrda005

               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "apm-00201:sub-01302|axmm200|",cl_get_progname("axmm200",g_lang,"2"),"|:EXEPROGaxmm200"    #160318-00025#13      
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmaa001_7") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
                  #151231-00010#2(S)
                  IF NOT s_control_check_customer(g_xrda_m.xrda005,'2',g_site,g_user,g_dept,'') THEN
                     LET g_xrda_m.xrda005 = g_xrda_m_t.xrda005
                     CALL axrt400_ref_show()
		    	         NEXT FIELD CURRENT
		    	      END IF
		    	      #151231-00010#2(S)
                  IF cl_null(g_xrda_m.xrda004) THEN 
                     LET g_xrda_m.xrda004 = g_xrda_m.xrda005
                  END IF
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrda_m.xrda005 = g_xrda_m_t.xrda005
                  CALL axrt400_ref_show()
                  NEXT FIELD CURRENT
               END IF
               #160802-00007#1  ---(S)---
               SELECT pmaa004 INTO l_pmaa004 FROM pmaa_t WHERE pmaaent = g_enterprise AND pmaa001 = g_xrda_m.xrda005
               CASE
                  WHEN l_pmaa004 = '2'   #一次性交易對象
                     INITIALIZE g_qryparam.* TO NULL
                     LET g_qryparam.state = 'i'
		        	      LET g_qryparam.reqry = FALSE
		        	      LET g_qryparam.default1 = g_xrda_m.xrda006
		        	      LET g_qryparam.arg1 = g_xrda_m.xrda005
		               CALL q_pmak002() 
		        	      LET g_xrda_m.xrda006 = g_qryparam.return1
		        	      SELECT pmak003 INTO g_xrda_m.xrda005_desc FROM pmak_t
		        	       WHERE pmakent = g_enterprise
		        	         AND pmak001 = g_xrda_m.xrda006
                  WHEN l_pmaa004 = '4'   #員工
                     INITIALIZE g_qryparam.* TO NULL
                     LET g_qryparam.state = 'i'
		        	      LET g_qryparam.reqry = FALSE
		        	      LET g_qryparam.default1 = g_xrda_m.xrda006
		               CALL q_ooag001() 
		        	      LET g_xrda_m.xrda006 = g_qryparam.return1
		        	      CALL s_axrt300_xrca_ref('xrca003',g_xrda_m.xrda006,'','') RETURNING l_success,g_xrda_m.xrda005_desc
		        	   OTHERWISE
		        	      LET g_xrda_m.xrda006 = g_xrda_m.xrda005
               END CASE
               #160802-00007#1  ---(E)---
            END IF
            #160802-00007#1 Add ---(S)---
            IF cl_null(g_xrda_m.xrda005) THEN
               LET g_xrda_m.xrda006 = ''
            END IF
            CALL axrt400_ref_show()
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda005
            #add-point:BEFORE FIELD xrda005 name="input.b.xrda005"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda005
            #add-point:ON CHANGE xrda005 name="input.g.xrda005"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda004
            
            #add-point:AFTER FIELD xrda004 name="input.a.xrda004"
            IF NOT cl_null(g_xrda_m.xrda004) THEN 
#此段落由子樣板a19產生
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrda_m.xrda004

               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "apm-00201:sub-01302|axmm200|",cl_get_progname("axmm200",g_lang,"2"),"|:EXEPROGaxmm200"    #160318-00025#13      
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmaa001_7") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
                  #151231-00010#2(S)
                  IF NOT s_control_check_customer(g_xrda_m.xrda004,'2',g_site,g_user,g_dept,'') THEN
                     LET g_xrda_m.xrda004 = g_xrda_m_t.xrda004
                     CALL axrt400_ref_show()
		    	         NEXT FIELD CURRENT
		    	      END IF
		    	      #151231-00010#2(S)
                  CALL axrt400_set_act_no_visible_b()           #160111-00020#5 add lujh
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrda_m.xrda004 = g_xrda_m_t.xrda004
                  CALL axrt400_ref_show()
                  NEXT FIELD CURRENT
               END IF
            END IF 
            CALL axrt400_ref_show()
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda004
            #add-point:BEFORE FIELD xrda004 name="input.b.xrda004"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda004
            #add-point:ON CHANGE xrda004 name="input.g.xrda004"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda014
            #add-point:BEFORE FIELD xrda014 name="input.b.xrda014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda014
            
            #add-point:AFTER FIELD xrda014 name="input.a.xrda014"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda014
            #add-point:ON CHANGE xrda014 name="input.g.xrda014"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda006
            #add-point:BEFORE FIELD xrda006 name="input.b.xrda006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda006
            
            #add-point:AFTER FIELD xrda006 name="input.a.xrda006"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda006
            #add-point:ON CHANGE xrda006 name="input.g.xrda006"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdastus
            #add-point:BEFORE FIELD xrdastus name="input.b.xrdastus"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdastus
            
            #add-point:AFTER FIELD xrdastus name="input.a.xrdastus"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdastus
            #add-point:ON CHANGE xrdastus name="input.g.xrdastus"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda008
            #add-point:BEFORE FIELD xrda008 name="input.b.xrda008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda008
            
            #add-point:AFTER FIELD xrda008 name="input.a.xrda008"
 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda008
            #add-point:ON CHANGE xrda008 name="input.g.xrda008"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda010
            #add-point:BEFORE FIELD xrda010 name="input.b.xrda010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda010
            
            #add-point:AFTER FIELD xrda010 name="input.a.xrda010"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda010
            #add-point:ON CHANGE xrda010 name="input.g.xrda010"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda017
            #add-point:BEFORE FIELD xrda017 name="input.b.xrda017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda017
            
            #add-point:AFTER FIELD xrda017 name="input.a.xrda017"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda017
            #add-point:ON CHANGE xrda017 name="input.g.xrda017"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda007
            
            #add-point:AFTER FIELD xrda007 name="input.a.xrda007"


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda007
            #add-point:BEFORE FIELD xrda007 name="input.b.xrda007"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda007
            #add-point:ON CHANGE xrda007 name="input.g.xrda007"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda009
            #add-point:BEFORE FIELD xrda009 name="input.b.xrda009"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda009
            
            #add-point:AFTER FIELD xrda009 name="input.a.xrda009"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda009
            #add-point:ON CHANGE xrda009 name="input.g.xrda009"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda015
            
            #add-point:AFTER FIELD xrda015 name="input.a.xrda015"
            IF NOT cl_null(g_xrda_m.xrda015) THEN 
#此段落由子樣板a19產生
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrda_m.xrda015

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_3113") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrda_m.xrda015 = g_xrda_m_t.xrda015
                  CALL axrt400_ref_show()
                  NEXT FIELD CURRENT
               END IF
            END IF 
            CALL axrt400_ref_show()
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda015
            #add-point:BEFORE FIELD xrda015 name="input.b.xrda015"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda015
            #add-point:ON CHANGE xrda015 name="input.g.xrda015"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrda016
            #add-point:BEFORE FIELD xrda016 name="input.b.xrda016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrda016
            
            #add-point:AFTER FIELD xrda016 name="input.a.xrda016"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrda016
            #add-point:ON CHANGE xrda016 name="input.g.xrda016"
            
            #END add-point 
 
 
 #欄位檢查
                  #Ctrlp:input.c.xrdasite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdasite
            #add-point:ON ACTION controlp INFIELD xrdasite name="input.c.xrdasite"
            #此段落由子樣板a07產生            
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrdasite             #給予default值
            LET g_qryparam.where = " ooefstus = 'Y' "   #161006-00005#3
            #給予arg
 
            #CALL q_ooef001()                                #呼叫開窗 #161006-00005#39 mark
            CALL q_ooef001_46()                              #161006-00005#39 add

            LET g_xrda_m.xrdasite = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_xrda_m.xrdasite,g_xrda_m.xrda003,g_xrda_m.xrdald TO xrdasite,xrda003,xrdald              #顯示到畫面上
            INITIALIZE g_ref_fields TO NULL
            CALL axrt400_ref_show()
            NEXT FIELD xrdasite                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xrda003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda003
            #add-point:ON ACTION controlp INFIELD xrda003 name="input.c.xrda003"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrda003             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_ooag001()                                #呼叫開窗

            LET g_xrda_m.xrda003 = g_qryparam.return1              

            DISPLAY g_xrda_m.xrda003 TO xrda003              #

            NEXT FIELD xrda003                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xrdald
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdald
            #add-point:ON ACTION controlp INFIELD xrdald name="input.c.xrdald"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrdald             #給予default值
            
            #取得帳務組織下所屬成員
            CALL s_fin_account_center_sons_query('3',g_xrda_m.xrdasite,g_xrda_m.xrdadocdt,'1')
            #取得帳務組織下所屬成員之帳別   
            CALL s_fin_account_center_comp_str() RETURNING l_origin_str
            #將取回的字串轉換為SQL條件
            CALL axrt400_change_to_sql(l_origin_str) RETURNING l_origin_str  
            
            LET g_qryparam.where = " (glaa008 = 'Y' OR glaa014 = 'Y') AND glaacomp IN (",l_origin_str," )"

            #給予arg

            LET g_qryparam.arg1 = g_user
            LET g_qryparam.arg2 = g_dept

            CALL q_authorised_ld()                                #呼叫開窗

            LET g_xrda_m.xrdald = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xrda_m.xrdald TO xrdald              #顯示到畫面上

            NEXT FIELD xrdald                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xrdacomp
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdacomp
            #add-point:ON ACTION controlp INFIELD xrdacomp name="input.c.xrdacomp"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrdadocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdadocno
            #add-point:ON ACTION controlp INFIELD xrdadocno name="input.c.xrdadocno"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrdadocno             #給予default值
            LET l_glaa024 = ''
            SELECT glaa024 INTO l_glaa024 FROM glaa_t WHERE glaaent = g_enterprise AND glaald = g_xrda_m.xrdald
            #給予arg
            LET g_qryparam.arg1 = l_glaa024
            LET g_qryparam.arg2 = "axrt400"
            
            CALL q_ooba002_1()                                #呼叫開窗

            LET g_xrda_m.xrdadocno = g_qryparam.return1              

            DISPLAY g_xrda_m.xrdadocno TO xrdadocno              #

            NEXT FIELD xrdadocno                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xrda001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda001
            #add-point:ON ACTION controlp INFIELD xrda001 name="input.c.xrda001"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrdadocdt
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdadocdt
            #add-point:ON ACTION controlp INFIELD xrdadocdt name="input.c.xrdadocdt"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrda005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda005
            #add-point:ON ACTION controlp INFIELD xrda005 name="input.c.xrda005"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrda005             #給予default值

            #151231-00010#2(S)
            IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
               LET g_qryparam.where = g_qryparam.where,g_sql_ctrl
            END IF
            #151231-00010#2(E)
            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_pmaa001_13()                                #呼叫開窗

            LET g_xrda_m.xrda005 = g_qryparam.return1              

            DISPLAY g_xrda_m.xrda005 TO xrda005              #
            CALL axrt400_ref_show()
            NEXT FIELD xrda005                          #返回原欄位

            #END add-point
 
 
         #Ctrlp:input.c.xrda004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda004
            #add-point:ON ACTION controlp INFIELD xrda004 name="input.c.xrda004"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrda004             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #
            
            #151231-00010#2(S)
            IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
               LET g_qryparam.where = g_qryparam.where,g_sql_ctrl
            END IF
            #151231-00010#2(E)

            
            CALL q_pmaa001_13()                                #呼叫開窗

            LET g_xrda_m.xrda004 = g_qryparam.return1              

            DISPLAY g_xrda_m.xrda004 TO xrda004              #
            CALL axrt400_ref_show()
            NEXT FIELD xrda004                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.xrda014
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda014
            #add-point:ON ACTION controlp INFIELD xrda014 name="input.c.xrda014"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrda006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda006
            #add-point:ON ACTION controlp INFIELD xrda006 name="input.c.xrda006"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrdastus
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdastus
            #add-point:ON ACTION controlp INFIELD xrdastus name="input.c.xrdastus"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrda008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda008
            #add-point:ON ACTION controlp INFIELD xrda008 name="input.c.xrda008"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrda010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda010
            #add-point:ON ACTION controlp INFIELD xrda010 name="input.c.xrda010"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrda010             #給予default值
            LET g_qryparam.default2 = "" #g_xrda_m.oocq002 #應用分類碼
            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_oocq002()                                #呼叫開窗

            LET g_xrda_m.xrda010 = g_qryparam.return1              
            #LET g_xrda_m.oocq002 = g_qryparam.return2 
            DISPLAY g_xrda_m.xrda010 TO xrda010              #
            #DISPLAY g_xrda_m.oocq002 TO oocq002 #應用分類碼
            NEXT FIELD xrda010                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xrda017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda017
            #add-point:ON ACTION controlp INFIELD xrda017 name="input.c.xrda017"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrda007
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda007
            #add-point:ON ACTION controlp INFIELD xrda007 name="input.c.xrda007"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrda009
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda009
            #add-point:ON ACTION controlp INFIELD xrda009 name="input.c.xrda009"
            
            #END add-point
 
 
         #Ctrlp:input.c.xrda015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda015
            #add-point:ON ACTION controlp INFIELD xrda015 name="input.c.xrda015"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrda_m.xrda015             #給予default值

            #給予arg
            LET g_qryparam.arg1 = '3113'

            CALL q_oocq002()                                #呼叫開窗

            LET g_xrda_m.xrda015 = g_qryparam.return1              

            DISPLAY g_xrda_m.xrda015 TO xrda015              #
            CALL axrt400_ref_show()
            NEXT FIELD xrda015                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xrda016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrda016
            #add-point:ON ACTION controlp INFIELD xrda016 name="input.c.xrda016"
            
            #END add-point
 
 
 #欄位開窗
            
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
 
            #CALL cl_err_collect_show()      #錯誤訊息統整顯示
            #CALL cl_showmsg()
            DISPLAY BY NAME g_xrda_m.xrdald,g_xrda_m.xrdadocno
                        
            #add-point:單頭INPUT後 name="input.head.after_input"
            
            #end add-point
                        
            IF p_cmd <> 'u' THEN
    
               CALL s_transaction_begin()
               
               #add-point:單頭新增前 name="input.head.b_insert"
               CALL s_aooi200_fin_gen_docno(g_xrda_m.xrdald,'','',g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_prog)
               RETURNING l_success,g_xrda_m.xrdadocno
               IF l_success  = 0  THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'apm-00003'
                  LET g_errparam.extend = g_xrda_m.xrdadocno
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrdadocno
               END IF
               DISPLAY BY NAME g_xrda_m.xrdadocno
               #end add-point
               
               INSERT INTO xrda_t (xrdaent,xrdasite,xrda003,xrdald,xrdacomp,xrdadocno,xrda001,xrdadocdt, 
                   xrda005,xrda004,xrda014,xrda006,xrdastus,xrda008,xrda010,xrda017,xrda007,xrda009, 
                   xrda015,xrda016,xrdaownid,xrdaowndp,xrdacrtid,xrdacrtdp,xrdacrtdt,xrdamodid,xrdamoddt, 
                   xrdacnfid,xrdacnfdt)
               VALUES (g_enterprise,g_xrda_m.xrdasite,g_xrda_m.xrda003,g_xrda_m.xrdald,g_xrda_m.xrdacomp, 
                   g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda004, 
                   g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
                   g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016, 
                   g_xrda_m.xrdaownid,g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt, 
                   g_xrda_m.xrdamodid,g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt) 
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "g_xrda_m:",SQLERRMESSAGE 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL s_transaction_end('N','0')
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭新增中 name="input.head.m_insert"
               
               #end add-point
               
               
               
               
               #add-point:單頭新增後 name="input.head.a_insert"
               CALL axrt400_set_no_entry('u')
               #CALL axrt400_01(g_xrda_m.xrdald,g_xrda_m.xrdasite,g_xrda_m.xrda004,g_xrda_m.xrda005,g_xrda_m.xrda003,g_xrda_m.xrdadocdt,g_xrda_m.xrdadocno)
               #end add-point
               CALL s_transaction_end('Y','0') 
               
               IF l_cmd_t = 'r' AND p_cmd = 'a' THEN
                  CALL axrt400_detail_reproduce()
                  #因應特定程式需求, 重新刷新單身資料
                  CALL axrt400_b_fill()
                  CALL axrt400_b_fill2('0')
               END IF
               
               #add-point:單頭新增後 name="input.head.a_insert2"
               
               #end add-point
               
               LET g_master_insert = TRUE
               
               LET p_cmd = 'u'
            ELSE
               CALL s_transaction_begin()
            
               #add-point:單頭修改前 name="input.head.b_update"
               
               #end add-point
               
               #將遮罩欄位還原
               CALL axrt400_xrda_t_mask_restore('restore_mask_o')
               
               UPDATE xrda_t SET (xrdasite,xrda003,xrdald,xrdacomp,xrdadocno,xrda001,xrdadocdt,xrda005, 
                   xrda004,xrda014,xrda006,xrdastus,xrda008,xrda010,xrda017,xrda007,xrda009,xrda015, 
                   xrda016,xrdaownid,xrdaowndp,xrdacrtid,xrdacrtdp,xrdacrtdt,xrdamodid,xrdamoddt,xrdacnfid, 
                   xrdacnfdt) = (g_xrda_m.xrdasite,g_xrda_m.xrda003,g_xrda_m.xrdald,g_xrda_m.xrdacomp, 
                   g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda004, 
                   g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
                   g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016, 
                   g_xrda_m.xrdaownid,g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt, 
                   g_xrda_m.xrdamodid,g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt)
                WHERE xrdaent = g_enterprise AND xrdald = g_xrdald_t
                  AND xrdadocno = g_xrdadocno_t
 
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "xrda_t:",SQLERRMESSAGE 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL s_transaction_end('N','0')
                  CALL cl_err()
                  NEXT FIELD CURRENT
               END IF
               
               #add-point:單頭修改中 name="input.head.m_update"
               
               #end add-point
               
               
               
               
               #將遮罩欄位進行遮蔽
               CALL axrt400_xrda_t_mask_restore('restore_mask_n')
               
               #修改歷程記錄(單頭修改)
               LET g_log1 = util.JSON.stringify(g_xrda_m_t)
               LET g_log2 = util.JSON.stringify(g_xrda_m)
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
               
               #add-point:單頭修改後 name="input.head.a_update"
               SELECT COUNT(*) INTO l_cnt FROM xrde_t
                WHERE xrdeent = g_enterprise
                  AND xrdedocno = g_xrda_m.xrdadocno
                  AND xrdeld  = g_xrda_m.xrdald
                  
               SELECT COUNT(*) INTO l_cnt1 FROM xrce_t
                WHERE xrceent = g_enterprise
                  AND xrcedocno = g_xrda_m.xrdadocno
                  AND xrceld  = g_xrda_m.xrdald
               #IF l_cnt < 1 AND l_cnt1 < 1 THEN
               #   CALL axrt400_01(g_xrda_m.xrdald,g_xrda_m.xrdasite,g_xrda_m.xrda004,g_xrda_m.xrda005,g_xrda_m.xrda003,g_xrda_m.xrdadocdt,g_xrda_m.xrdadocno)
               #   CALL axrt400_b_fill()
               #END IF
               #end add-point
            END IF
            
            LET g_master_commit = "Y"
            LET g_xrdald_t = g_xrda_m.xrdald
            LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
            
      END INPUT
   
 
{</section>}
 
{<section id="axrt400.input.body" >}
   
      #Page1 預設值產生於此處
      INPUT ARRAY g_xrde_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         #自訂ACTION(detail_input,page_1)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body.before_input2"
            
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_xrde_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL axrt400_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'1','2','3',"))
            END IF
            LET g_loc = 'm'
            LET g_rec_b = g_xrde_d.getLength()
            #add-point:資料輸入前 name="input.d.before_input"
            
            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2 name="input.body.before_row2"
            LET g_aw = 's_detail1'
            LET l_xrce_flag = 'N' 
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_detail_idx_list[1] = l_ac
            LET g_current_page = 1
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN axrt400_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CLOSE axrt400_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xrde_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xrde_d[l_ac].xrdeseq IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_xrde_d_t.* = g_xrde_d[l_ac].*  #BACKUP
               LET g_xrde_d_o.* = g_xrde_d[l_ac].*  #BACKUP
               CALL axrt400_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body.after_set_entry_b"
 
               #end add-point  
               CALL axrt400_set_no_entry_b(l_cmd)
               IF NOT axrt400_lock_b("xrde_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH axrt400_bcl INTO g_xrde_d[l_ac].xrdeseq,g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006, 
                      g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde032, 
                      g_xrde_d[l_ac].xrde010,g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101, 
                      g_xrde_d[l_ac].xrde109,g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013, 
                      g_xrde_d[l_ac].xrde001,g_xrde_d[l_ac].xrdecomp,g_xrde_d[l_ac].xrdesite,g_xrde_d[l_ac].xrdeorga, 
                      g_xrde_d[l_ac].xrde011,g_xrde_d[l_ac].xrde015,g_xrde_d[l_ac].xrde012,g_xrde2_d[l_ac].xrdeseq, 
                      g_xrde2_d[l_ac].xrde120,g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde129,g_xrde2_d[l_ac].xrde130, 
                      g_xrde2_d[l_ac].xrde131,g_xrde2_d[l_ac].xrde139,g_xrde3_d[l_ac].xrdeseq,g_xrde3_d[l_ac].xrde017, 
                      g_xrde3_d[l_ac].xrde018,g_xrde3_d[l_ac].xrde019,g_xrde3_d[l_ac].xrde035,g_xrde3_d[l_ac].xrde036, 
                      g_xrde3_d[l_ac].xrde020,g_xrde3_d[l_ac].xrde022,g_xrde3_d[l_ac].xrde023,g_xrde3_d[l_ac].xrde039, 
                      g_xrde3_d[l_ac].xrde040,g_xrde3_d[l_ac].xrde042,g_xrde3_d[l_ac].xrde043,g_xrde3_d[l_ac].xrde044, 
                      g_xrde3_d[l_ac].xrde045,g_xrde3_d[l_ac].xrde046,g_xrde3_d[l_ac].xrde047,g_xrde3_d[l_ac].xrde048, 
                      g_xrde3_d[l_ac].xrde049,g_xrde3_d[l_ac].xrde050,g_xrde3_d[l_ac].xrde051
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_xrde_d_t.xrdeseq,":",SQLERRMESSAGE 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xrde_d_mask_o[l_ac].* =  g_xrde_d[l_ac].*
                  CALL axrt400_xrde_t_mask()
                  LET g_xrde_d_mask_n[l_ac].* =  g_xrde_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL axrt400_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body.before_row"
            LET g_xrde_t.xrdeent   = g_enterprise
            LET g_xrde_t.xrdecomp  = g_xrde_d[l_ac].xrdecomp
            LET g_xrde_t.xrdedocno = g_xrda_m.xrdadocno
            LET g_xrde_t.xrdeld    = g_xrda_m.xrdald
            LET g_xrde_t.xrdesite  = g_xrde_d[l_ac].xrdesite
            LET g_xrde_t.xrde001   = 'axrt400'
            LET g_xrde_t.xrdeseq   = g_xrde_d[l_ac].xrdeseq
            LET g_xrde_t.xrde002   = g_xrde_d[l_ac].xrde002
            LET g_xrde_t.xrde006   = g_xrde_d[l_ac].xrde006
            LET g_xrde_t.xrde003   = g_xrde_d[l_ac].xrde003
            LET g_xrde_t.xrde004   = g_xrde_d[l_ac].xrde004
            LET g_xrde_t.xrde008   = g_xrde_d[l_ac].xrde008
            LET g_xrde_t.xrde100   = g_xrde_d[l_ac].xrde100
            LET g_xrde_t.xrde101   = g_xrde_d[l_ac].xrde101
            LET g_xrde_t.xrde109   = g_xrde_d[l_ac].xrde109
            LET g_xrde_t.xrde119   = g_xrde_d[l_ac].xrde119
            LET g_xrde_t.xrde014   = g_xrde_d[l_ac].xrde014
            LET g_xrde_t.xrde013   = g_xrde_d[l_ac].xrde013
            
            LET g_xrde_t.xrde010   = g_xrde_d[l_ac].xrde010
            LET g_xrde_t.xrde016   = g_xrde_d[l_ac].xrde016
            LET g_xrde_t.xrde018   = g_xrde3_d[l_ac].xrde018
            LET g_xrde_t.xrde019   = g_xrde3_d[l_ac].xrde019
            LET g_xrde_t.xrde035   = g_xrde3_d[l_ac].xrde035
            LET g_xrde_t.xrde036   = g_xrde3_d[l_ac].xrde036
            LET g_xrde_t.xrde020   = g_xrde3_d[l_ac].xrde020
            LET g_xrde_t.xrde022   = g_xrde3_d[l_ac].xrde022
            LET g_xrde_t.xrde023   = g_xrde3_d[l_ac].xrde023
            LET g_xrde_t.xrde039   = g_xrde3_d[l_ac].xrde039
            LET g_xrde_t.xrde040   = g_xrde3_d[l_ac].xrde040
            LET g_xrde_t.xrde042   = g_xrde3_d[l_ac].xrde042
            LET g_xrde_t.xrde043   = g_xrde3_d[l_ac].xrde043
            LET g_xrde_t.xrde044   = g_xrde3_d[l_ac].xrde044
            LET g_xrde_t.xrde045   = g_xrde3_d[l_ac].xrde045
            LET g_xrde_t.xrde046   = g_xrde3_d[l_ac].xrde046
            LET g_xrde_t.xrde047   = g_xrde3_d[l_ac].xrde047
            LET g_xrde_t.xrde048   = g_xrde3_d[l_ac].xrde048
            LET g_xrde_t.xrde049   = g_xrde3_d[l_ac].xrde049
            LET g_xrde_t.xrde050   = g_xrde3_d[l_ac].xrde050
            LET g_xrde_t.xrde051   = g_xrde3_d[l_ac].xrde051
            
            LET g_xrde_t.xrde120   = g_xrde2_d[l_ac].xrde120
            LET g_xrde_t.xrde121   = g_xrde2_d[l_ac].xrde121
            LET g_xrde_t.xrde129   = g_xrde2_d[l_ac].xrde129
            LET g_xrde_t.xrde130   = g_xrde2_d[l_ac].xrde130
            LET g_xrde_t.xrde131   = g_xrde2_d[l_ac].xrde131
            LET g_xrde_t.xrde139   = g_xrde2_d[l_ac].xrde139
            
            IF l_ac > 1 AND cl_null(g_xrde_d[l_ac].xrde010) THEN 
               LET g_xrde_d[l_ac].xrde010 = g_xrde_d[l_ac-1].xrde010
            END IF
            #160122-00001#5 --add --str
            #判断当前用户是否有权限查看该交易账户，如果没有权限不可看到交易账户编号，用“*”显示
            CALL axrt400_get_l_xrde008(g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde006) RETURNING g_xrde_d[l_ac].l_xrde008 
            DISPLAY g_xrde_d[l_ac].xrde008 TO s_detail1[l_ac].l_xrde008
            #160122-00001#5 --add --end
            IF g_xrde_d[l_ac].xrde006 = '90' THEN 
               CALL cl_set_comp_required('xrde003',FALSE)
            ELSE
               CALL cl_set_comp_required('xrde003',TRUE)
            END IF

            #160607-00015#3 Add  ---(S)---
            IF l_cmd = 'u' THEN
               LET l_isbbdocno = ''
               CALL axrt400_source_chk('1',g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004) RETURNING l_isbbdocno
               IF NOT cl_null(l_isbbdocno) THEN
                  CALL cl_set_comp_entry('xrde109,xrde119',FALSE)
               ELSE
                  CALL cl_set_comp_entry('xrde109,xrde119',TRUE)
               END IF
            END IF
            #160607-00015#3 Add  ---(S)---
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
 
 
            #其他table進行lock
            
 
 
 
        
         BEFORE INSERT  
            
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xrde_d[l_ac].* TO NULL 
            INITIALIZE g_xrde_d_t.* TO NULL 
            INITIALIZE g_xrde_d_o.* TO NULL 
            #公用欄位給值(單身)
            
            #自定義預設值
                  LET g_xrde_d[l_ac].xrde002 = "10"
      LET g_xrde_d[l_ac].xrde006 = "90"
      LET g_xrde_d[l_ac].xrde109 = "0"
      LET g_xrde_d[l_ac].xrde119 = "0"
 
            #add-point:modify段before備份 name="input.body.insert.before_bak"
            
            #end add-point
            LET g_xrde_d_t.* = g_xrde_d[l_ac].*     #新輸入資料
            LET g_xrde_d_o.* = g_xrde_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL axrt400_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body.insert.after_set_entry_b"
            
            #end add-point
            CALL axrt400_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xrde_d[li_reproduce_target].* = g_xrde_d[li_reproduce].*
               LET g_xrde2_d[li_reproduce_target].* = g_xrde2_d[li_reproduce].*
               LET g_xrde3_d[li_reproduce_target].* = g_xrde3_d[li_reproduce].*
 
               LET g_xrde_d[li_reproduce_target].xrdeseq = NULL
 
            END IF
            
 
 
 
            #add-point:modify段before insert name="input.body.before_insert"
            LET g_xrde_d[l_ac].xrde006 = "90"
            LET g_xrde_d[l_ac].xrde100 = g_glaa_t.glaa001
            LET g_xrde_d[l_ac].xrde101 = 1
            LET g_xrde_d[l_ac].xrde119 = g_xrde_d[l_ac].xrde109
            CALL cl_set_comp_required('xrde003',FALSE)
            IF cl_null(g_xrde_d[l_ac].xrdeseq) THEN
               SELECT MAX(xrdeseq) INTO g_xrde_d[g_detail_idx].xrdeseq
                 FROM xrde_t
                WHERE xrdeent = g_enterprise 
                  AND xrdeld = g_xrda_m.xrdald
                  AND xrdedocno = g_xrda_m.xrdadocno
               IF cl_null(g_xrde_d[g_detail_idx].xrdeseq) THEN
                  LET g_xrde_d[g_detail_idx].xrdeseq = 1
               ELSE
                  LET g_xrde_d[g_detail_idx].xrdeseq = g_xrde_d[g_detail_idx].xrdeseq +1
               END IF
            END IF
            LET g_xrde_d[l_ac].xrde015 = 'D'
            CALL axrt400_xrde015_desc(g_xrde_d[l_ac].xrde015) RETURNING g_xrde_d[l_ac].xrde015_desc
            DISPLAY g_xrde_d[l_ac].xrde015_desc TO s_detail1[l_ac].xrde015_desc
            LET g_xrde_d[l_ac].xrde001 = 'axrt400'
            LET g_xrde_d[l_ac].xrdecomp = g_xrda_m.xrdacomp
            LET g_xrde_d[l_ac].xrdesite = g_xrda_m.xrdasite
            LET g_xrde_d[l_ac].xrde032  = g_xrda_m.xrdadocdt   #160114-00019#2 Add
            IF cl_null(g_xrde_d[l_ac].xrdeorga) THEN 
               LET g_xrde_d[l_ac].xrdeorga = g_xrda_m.xrdacomp
            END IF
            
            IF l_ac > 1 THEN 
               LET g_xrde_d[l_ac].xrde010 = g_xrde_d[l_ac-1].xrde010
            END IF
            #end add-point  
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身新增 name="input.body.b_a_insert"
            #150812-00010#3 --s
            IF cl_null(g_xrde2_d[l_ac].xrde129) THEN LET g_xrde2_d[l_ac].xrde129 = 0 END IF
            IF cl_null(g_xrde2_d[l_ac].xrde139) THEN LET g_xrde2_d[l_ac].xrde139 = 0 END IF
            IF g_xrde_d[l_ac].xrde109 = 0 AND g_xrde_d[l_ac].xrde119 = 0 AND
               g_xrde2_d[l_ac].xrde129 = 0 AND g_xrde2_d[l_ac].xrde139 = 0 THEN
               CANCEL INSERT
            END IF
            #150812-00010#3 --e
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xrde_t 
             WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m.xrdald
               AND xrdedocno = g_xrda_m.xrdadocno
 
               AND xrdeseq = g_xrde_d[l_ac].xrdeseq
 
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身新增前 name="input.body.b_insert"
               
               #end add-point
            
               #同步新增到同層的table
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys[3] = g_xrde_d[g_detail_idx].xrdeseq
               CALL axrt400_insert_b('xrde_t',gs_keys,"'1'")
                           
               #add-point:單身新增後 name="input.body.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               INITIALIZE g_xrde_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL axrt400_b_fill()
               #資料多語言用-增/改
               
               #add-point:input段-after_insert name="input.body.a_insert2"
               
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身刪除後(=d) name="input.body.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身刪除前 name="input.body.b_delete"
               
               #end add-point 
               
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xrda_m.xrdald
               LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
 
               LET gs_keys[gs_keys.getLength()+1] = g_xrde_d_t.xrdeseq
 
            
               #刪除同層單身
               IF NOT axrt400_delete_b('xrde_t',gs_keys,"'1'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT axrt400_key_delete_b(gs_keys,'xrde_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
 
 
               
               #add-point:單身刪除中 name="input.body.m_delete"
               #160607-00015#3 Add  ---(S)---
               LET l_isbbdocno = ''
               CALL axrt400_source_chk('1',g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004) RETURNING l_isbbdocno
               IF NOT cl_null(l_isbbdocno) THEN
                  CALL axrt400_del_all('1',l_isbbdocno) RETURNING l_success
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     CLOSE axrt400_bcl
                     CANCEL DELETE
                  ELSE
                     LET g_aw = "s_detail1"
                     LET l_flag = 'Y'
                     CALL s_transaction_end('Y','0')
                     CLOSE axrt400_bcl
                     EXIT DIALOG
                  END IF
               END IF
               #160607-00015#3 Add  ---(S)---
               #end add-point 
               
               CALL s_transaction_end('Y','0')
               CLOSE axrt400_bcl
            
               LET g_rec_b = g_rec_b-1
               #add-point:單身刪除後 name="input.body.a_delete"
               
               #end add-point
               LET l_count = g_xrde_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body.after_delete"
               
               #end add-point
            END IF
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xrde_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdeseq
            #add-point:BEFORE FIELD xrdeseq name="input.b.page1.xrdeseq"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdeseq
            
            #add-point:AFTER FIELD xrdeseq name="input.a.page1.xrdeseq"
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_xrda_m.xrdald IS NOT NULL AND g_xrda_m.xrdadocno IS NOT NULL AND g_xrde_d[g_detail_idx].xrdeseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xrda_m.xrdald != g_xrdald_t OR g_xrda_m.xrdadocno != g_xrdadocno_t OR g_xrde_d[g_detail_idx].xrdeseq != g_xrde_d_t.xrdeseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xrde_t WHERE "||"xrdeent = '" ||g_enterprise|| "' AND "||"xrdeld = '"||g_xrda_m.xrdald ||"' AND "|| "xrdedocno = '"||g_xrda_m.xrdadocno ||"' AND "|| "xrdeseq = '"||g_xrde_d[g_detail_idx].xrdeseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdeseq
            #add-point:ON CHANGE xrdeseq name="input.g.page1.xrdeseq"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde002
            #add-point:BEFORE FIELD xrde002 name="input.b.page1.xrde002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde002
            
            #add-point:AFTER FIELD xrde002 name="input.a.page1.xrde002"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde002
            #add-point:ON CHANGE xrde002 name="input.g.page1.xrde002"
            IF NOT cl_null(g_xrde_d[l_ac].xrde002) THEN
               CALL axrt400_set_entry_b(p_cmd)
               CALL axrt400_set_no_entry_b(p_cmd)
               IF p_cmd = 'a' OR (p_cmd = 'u' AND g_xrde_d[l_ac].xrde002 != g_xrde_d_t.xrde002) THEN
                  LET g_xrde_d[l_ac].xrde003 = ''
                  LET g_xrde_d[l_ac].xrde004 = ''
                  LET g_xrde_d[l_ac].xrde008 = ''
                  LET g_xrde_d[l_ac].l_xrde008 = ''  #160122-00001#5  add
                  LET g_xrde_d[l_ac].xrde100 = ''
                  LET g_xrde_d[l_ac].xrde109 = 0
                  LET g_xrde_d[l_ac].xrde101 = ''
                  LET g_xrde_d[l_ac].xrde119 = 0
                  LET g_xrde_d[l_ac].xrde014 = ''
                  LET g_xrde_d[l_ac].xrde013 = ''
                  CASE
                     WHEN g_xrde_d[l_ac].xrde002 = '10'
                        LET g_xrde_d[l_ac].xrde006 = '90'
                     OTHERWISE
                        LET g_xrde_d[l_ac].xrde006 = ''
                  END CASE

                  IF g_xrde_d[l_ac].xrde006 = '90' THEN 
                     CALL cl_set_comp_required('xrde003',FALSE)
                  ELSE
                     CALL cl_set_comp_required('xrde003',TRUE)
                  END IF

                  IF g_xrde_d[l_ac].xrde002 <> '10' THEN 
                     LET g_xrde_d[l_ac].xrde100 = g_glaa_t.glaa001
                     LET g_xrde_d[l_ac].xrde101 = 1
                  ELSE
                     LET g_xrde_d[l_ac].xrde100 = ''
                     LET g_xrde_d[l_ac].xrde101 = ''
                  END IF
                  
                  SELECT gzcb003 INTO g_xrde_d[l_ac].xrde015
                    FROM gzcb_t
                   WHERE gzcb001 = '8306'
                     AND gzcb002 = g_xrde_d[l_ac].xrde002
                     
                  CALL axrt400_xrde015_desc(g_xrde_d[l_ac].xrde015) RETURNING g_xrde_d[l_ac].xrde015_desc
                  DISPLAY g_xrde_d[l_ac].xrde015_desc TO s_detail1[l_ac].xrde015_desc   
                     
                  CALL s_subject_get(g_xrde_d[l_ac].xrde002,g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrda004) RETURNING l_success,g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde011   
                    
                  IF g_xrde_d[l_ac].xrde002 = '20' OR g_xrde_d[l_ac].xrde002 = '21' OR g_xrde_d[l_ac].xrde002 = '22' THEN 
                     LET g_xrde_d[l_ac].xrde013 = g_xrda_m.xrda004
                     #業務人員/业务部门
                     SELECT pmab081,pmab109 INTO g_xrde3_d[l_ac].xrde017,g_xrde3_d[l_ac].xrde018
                       FROM pmab_t 
                      WHERE pmabent = g_enterprise
                        AND pmabsite = g_xrda_m.xrdacomp
                        AND pmab001 = g_xrde_d[l_ac].xrde013
                     DISPLAY g_xrde3_d[l_ac].xrde017 TO s_detail3[l_ac].xrde017
                     DISPLAY g_xrde3_d[l_ac].xrde018 TO s_detail3[l_ac].xrde018
                  END IF
                  
                  IF g_xrde_d[l_ac].xrde002 = '20' OR g_xrde_d[l_ac].xrde002 = '21' OR g_xrde_d[l_ac].xrde002 = '22' THEN 
                     CALL cl_set_comp_required('xrde013,xrde014',TRUE)
                  ELSE
                     CALL cl_set_comp_required('xrde013,xrde014',FALSE)
                  END IF
                  
                  DISPLAY g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde100,
                          g_xrde_d[l_ac].xrde109,g_xrde_d[l_ac].xrde101,g_xrde_d[l_ac].xrde119,
                          g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013,g_xrde_d[l_ac].xrde006,
                          g_xrde_d[l_ac].xrde016 
                       TO s_detail1[l_ac].xrde003,s_detail1[l_ac].xrde004,s_detail1[l_ac].xrde008,s_detail1[l_ac].xrde100,
                          s_detail1[l_ac].xrde109,s_detail1[l_ac].xrde101,s_detail1[l_ac].xrde119,
                          s_detail1[l_ac].xrde014,s_detail1[l_ac].xrde013,s_detail1[l_ac].xrde006,
                          s_detail1[l_ac].xrde016
                  #160122-00001#5 --add --str
                  #判断当前用户是否有权限查看该交易账户，如果没有权限不可看到交易账户编号，用“*”显示
                  CALL axrt400_get_l_xrde008(g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde006) RETURNING g_xrde_d[l_ac].l_xrde008 
                  DISPLAY g_xrde_d[l_ac].xrde008 TO s_detail1[l_ac].l_xrde008
                  #160122-00001#5 --add --end    
               END IF
            END IF 
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde006
            #add-point:BEFORE FIELD xrde006 name="input.b.page1.xrde006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde006
            
            #add-point:AFTER FIELD xrde006 name="input.a.page1.xrde006"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde006
            #add-point:ON CHANGE xrde006 name="input.g.page1.xrde006"
            IF g_xrde_d[l_ac].xrde006 = '90' THEN 
               LET g_xrde_d[l_ac].xrde100 = g_glaa_t.glaa001
               LET g_xrde_d[l_ac].xrde101 = 1
               LET g_xrde_d[l_ac].xrde119 = g_xrde_d[l_ac].xrde109
               CALL cl_set_comp_required('xrde003',FALSE)
            ELSE
               LET g_xrde_d[l_ac].xrde100 = ''
               LET g_xrde_d[l_ac].xrde101 = ''
               CALL cl_set_comp_required('xrde003',TRUE)
            END IF
           #160114-00019#2 Add  ---(S)---
            IF NOT cl_null(g_xrde_d[l_ac].xrde006) THEN
               CALL axrt400_set_entry_b(p_cmd)
               CALL axrt400_set_no_entry_b(p_cmd)
            END IF
           #160114-00019#2 Add  ---(E)---
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde003
            #add-point:BEFORE FIELD xrde003 name="input.b.page1.xrde003"
 
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde003
            
            #add-point:AFTER FIELD xrde003 name="input.a.page1.xrde003"
            IF NOT cl_null(g_xrde_d[l_ac].xrde003) THEN
               IF l_cmd = 'a' OR(p_cmd = 'u' AND (g_xrde_d[l_ac].xrde003 != g_xrde_d_t.xrde003 OR g_xrde_d_t.xrde003 IS NULL )) THEN   #160607-00015#3 Add
                  CALL axrt400_chk_xrde003()
                  IF NOT cl_null(g_errno) AND g_errno != 'agl-00154' THEN
                     LET l_xrde003 = g_xrde_d[l_ac].xrde003
                     IF p_cmd = 'a' THEN
                        LET g_xrde_d[l_ac].xrde003 = ''
                        LET g_xrde_d[l_ac].xrde004 = ''
                     ELSE
                        LET g_xrde_d[l_ac].xrde003 = g_xrde_d_t.xrde003
                        LET g_xrde_d[l_ac].xrde004 = g_xrde_d_t.xrde004
                     END IF
                     DISPLAY g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004 TO s_detail1[l_ac].xrde003,s_detail1[l_ac].xrde004
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = g_errno
                     LET g_errparam.extend = l_xrde003
                     #160318-00005#54 --s add
                     CASE g_errno
                        WHEN 'sub-01302'
                        #160413-00037#1 Mark ---(S)---
                          #LET g_errparam.replace[1] = 'anmt310'
                          #LET g_errparam.replace[2] = cl_get_progname('anmt310',g_lang,"2")
                          #LET g_errparam.exeprog = 'anmt310'
                        #160413-00037#1 Mark ---(E)---
                        #160413-00037#1 Add  ---(S)---
                           IF g_xrde_d[l_ac].xrde006 = '30' THEN
                              LET g_errparam.replace[1] = 'anmt540'
                              LET g_errparam.replace[2] = cl_get_progname('anmt540',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt540'
                           ELSE
                              LET g_errparam.replace[1] = 'anmt310'
                              LET g_errparam.replace[2] = cl_get_progname('anmt310',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt310'
                           END IF
                        #160413-00037#1 Add  ---(E)---
                        #160413-00037#1 Add  ---(S)---
                        WHEN 'sub-01310'
                           IF g_xrde_d[l_ac].xrde006 = '30' THEN
                              LET g_errparam.replace[1] = 'anmt540'
                              LET g_errparam.replace[2] = cl_get_progname('anmt540',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt540'
                           ELSE
                              LET g_errparam.replace[1] = 'anmt310'
                              LET g_errparam.replace[2] = cl_get_progname('anmt310',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt310'
                           END IF
                        #160413-00037#1 Add  ---(E)---
                        #160607-00015#3 Add  ---(S)---
                        WHEN 'axr-00366'
                           LET g_errparam.replace[1] = cl_get_progname('aist340',g_lang,"2")
                           LET g_errparam.replace[2] = cl_get_progname('aisp450',g_lang,"2")
                           LET g_errparam.exeprog = 'aisp450'
                        #160607-00015#3 Add  ---(E)---
                     END CASE
                     #160318-00005#54 --e add
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                  
                     NEXT FIELD xrde003
                  ELSE
                     IF g_errno = 'agl-00154' THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = g_errno
                        LET g_errparam.extend = g_xrde_d[l_ac].xrde003
                        LET g_errparam.popup = FALSE
                        CALL cl_err()
                  
                     END IF
                     IF (l_cmd = 'a' OR (l_cmd = 'u' AND g_xrde_d[l_ac].xrde003 != g_xrde_d_t.xrde003 AND NOT cl_null(g_xrde_d_t.xrde003))) AND NOT cl_null(g_xrde_d[l_ac].xrde004) THEN
                        CALL axrt400_def_nmbb(g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004)
                     END IF
                  END IF
                  CALL cl_set_comp_entry('xrde100',FALSE)
               END IF   #160607-00015#3 Add
            ELSE
               CALL cl_set_comp_entry('xrde100',TRUE)
            END IF
           #160114-00019#2 Add  ---(S)---
            IF NOT cl_null(g_xrde_d[l_ac].xrde003) THEN
               CALL axrt400_set_entry_b(p_cmd)
               CALL axrt400_set_no_entry_b(p_cmd)
               #160607-00015#3 Add  ---(S)---
               IF l_cmd = 'u' THEN
                  LET l_isbbdocno = ''
                  CALL axrt400_source_chk('1',g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004) RETURNING l_isbbdocno
                  IF NOT cl_null(l_isbbdocno) THEN
                     CALL cl_set_comp_entry('xrde109,xrde119',FALSE)
                  ELSE
                     CALL cl_set_comp_entry('xrde109,xrde119',TRUE)
                  END IF
               END IF
               #160607-00015#3 Add  ---(S)---
            END IF
           #160114-00019#2 Add  ---(E)---
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde003
            #add-point:ON CHANGE xrde003 name="input.g.page1.xrde003"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde004
            #add-point:BEFORE FIELD xrde004 name="input.b.page1.xrde004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde004
            
            #add-point:AFTER FIELD xrde004 name="input.a.page1.xrde004"
            IF NOT cl_null(g_xrde_d[l_ac].xrde003) AND NOT cl_null(g_xrde_d[l_ac].xrde004) AND g_xrde_d[l_ac].xrde002 = '10' THEN
               IF l_cmd = 'a' OR (p_cmd = 'u' AND (g_xrde_d[l_ac].xrde004 != g_xrde_d_t.xrde004 OR g_xrde_d_t.xrde004 IS NULL )) THEN   #160607-00015#3 Add
                  CALL axrt400_chk_xrde003()
                  IF NOT cl_null(g_errno) AND g_errno != 'agl-00154' THEN
                     LET l_xrde004 = g_xrde_d[l_ac].xrde004
                     IF p_cmd = 'a' THEN
                        LET g_xrde_d[l_ac].xrde003 = ''
                        LET g_xrde_d[l_ac].xrde004 = ''
                     ELSE
                        LET g_xrde_d[l_ac].xrde003 = g_xrde_d_t.xrde003
                        LET g_xrde_d[l_ac].xrde004 = g_xrde_d_t.xrde004
                     END IF
                     DISPLAY g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004 TO s_detail1[l_ac].xrde003,s_detail1[l_ac].xrde004
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = g_errno
                     LET g_errparam.extend = l_xrde004
                     #160318-00005#54 --s add
                     CASE g_errno
                        WHEN 'sub-01302'
                        #160413-00037#1 Mark ---(S)---
                          #LET g_errparam.replace[1] = 'anmt310'
                          #LET g_errparam.replace[2] = cl_get_progname('anmt310',g_lang,"2")
                          #LET g_errparam.exeprog = 'anmt310'
                        #160413-00037#1 Mark ---(E)---
                        #160413-00037#1 Add  ---(S)---
                           IF g_xrde_d[l_ac].xrde006 = '30' THEN
                              LET g_errparam.replace[1] = 'anmt540'
                              LET g_errparam.replace[2] = cl_get_progname('anmt540',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt540'
                           ELSE
                              LET g_errparam.replace[1] = 'anmt310'
                              LET g_errparam.replace[2] = cl_get_progname('anmt310',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt310'
                           END IF
                        #160413-00037#1 Add  ---(E)---
                        #160413-00037#1 Add  ---(S)---
                        WHEN 'sub-01310'
                           IF g_xrde_d[l_ac].xrde006 = '30' THEN
                              LET g_errparam.replace[1] = 'anmt540'
                              LET g_errparam.replace[2] = cl_get_progname('anmt540',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt540'
                           ELSE
                              LET g_errparam.replace[1] = 'anmt310'
                              LET g_errparam.replace[2] = cl_get_progname('anmt310',g_lang,"2")
                              LET g_errparam.exeprog = 'anmt310'
                           END IF
                        #160413-00037#1 Add  ---(E)---
                        #160607-00015#3 Add  ---(S)---
                        WHEN 'axr-00366'
                           LET g_errparam.replace[1] = cl_get_progname('aist340',g_lang,"2")
                           LET g_errparam.replace[2] = cl_get_progname('aisp450',g_lang,"2")
                           LET g_errparam.exeprog = 'aisp450'
                        #160607-00015#3 Add  ---(E)---
                     END CASE
                     #160318-00005#54 --e add
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                  
                     NEXT FIELD xrde004
                  ELSE
                     IF g_errno = 'agl-00154' THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = g_errno
                        LET g_errparam.extend = g_xrde_d[l_ac].xrde003
                        LET g_errparam.popup = FALSE
                        CALL cl_err()
                  
                     END IF
                     IF (l_cmd = 'a' OR (l_cmd = 'u' AND g_xrde_d[l_ac].xrde004 != g_xrde_d_t.xrde004 AND NOT cl_null(g_xrde_d_t.xrde004))) AND NOT cl_null(g_xrde_d[l_ac].xrde003) THEN
                        CALL axrt400_def_nmbb(g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004)
                     END IF
                  END IF
               END IF   #160607-00015#3 Add
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde004
            #add-point:ON CHANGE xrde004 name="input.g.page1.xrde004"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde008
            #add-point:BEFORE FIELD xrde008 name="input.b.page1.xrde008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde008
            
            #add-point:AFTER FIELD xrde008 name="input.a.page1.xrde008"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde008
            #add-point:ON CHANGE xrde008 name="input.g.page1.xrde008"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD l_xrde008
            #add-point:BEFORE FIELD l_xrde008 name="input.b.page1.l_xrde008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD l_xrde008
            
            #add-point:AFTER FIELD l_xrde008 name="input.a.page1.l_xrde008"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE l_xrde008
            #add-point:ON CHANGE l_xrde008 name="input.g.page1.l_xrde008"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde032
            #add-point:BEFORE FIELD xrde032 name="input.b.page1.xrde032"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde032
            
            #add-point:AFTER FIELD xrde032 name="input.a.page1.xrde032"
           #160114-00019#2 Add  ---(S)---
            IF NOT cl_null(g_xrde_d[l_ac].xrde032) THEN
               IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_xrde_d[l_ac].xrde032 != g_xrde_d_t.xrde032 OR g_xrde_d_t.xrde032 IS NULL )) THEN
                  CALL axrt400_chk_xrde032(g_xrda_m.xrdald,g_xrda_m.xrdadocdt,g_xrde_d[l_ac].xrde032) RETURNING l_success
                  IF NOT l_success THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_xrde_d[l_ac].xrde032
                     LET g_errparam.code   = 'axr-00364' 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                  END IF
               END IF
            END IF
           #160114-00019#2 Add  ---(E)---
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde032
            #add-point:ON CHANGE xrde032 name="input.g.page1.xrde032"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde010
            #add-point:BEFORE FIELD xrde010 name="input.b.page1.xrde010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde010
            
            #add-point:AFTER FIELD xrde010 name="input.a.page1.xrde010"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde010
            #add-point:ON CHANGE xrde010 name="input.g.page1.xrde010"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde016
            #add-point:BEFORE FIELD xrde016 name="input.b.page1.xrde016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde016
            
            #add-point:AFTER FIELD xrde016 name="input.a.page1.xrde016"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde016
            #add-point:ON CHANGE xrde016 name="input.g.page1.xrde016"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde016_desc
            #add-point:BEFORE FIELD xrde016_desc name="input.b.page1.xrde016_desc"
            LET g_xrde_d[l_ac].xrde016_desc = g_xrde_d[l_ac].xrde016
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde016_desc
            
            #add-point:AFTER FIELD xrde016_desc name="input.a.page1.xrde016_desc"
            LET g_xrde_d[l_ac].xrde016 = g_xrde_d[l_ac].xrde016_desc
            CALL axrt400_xrde016_desc(g_xrde_d[l_ac].xrde016) RETURNING g_xrde_d[l_ac].xrde016_desc
            LET g_xrde_d[l_ac].xrde016_desc = g_xrde_d[l_ac].xrde016 CLIPPED,g_xrde_d[l_ac].xrde016_desc
            IF NOT cl_null(g_xrde_d[l_ac].xrde016) THEN 
               # 开窗模糊查询 150916-00015#1 --add                      
               IF s_aglt310_getlike_lc_subject(g_xrda_m.xrdald,g_xrde_d[l_ac].xrde016,"")  THEN            
                  
                  SELECT glaa004 INTO l_glaa004
                    FROM glaa_t
                   WHERE glaaent = g_enterprise
                     AND glaald  = g_xrda_m.xrdald
                  
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
                  LET g_qryparam.reqry = 'FALSE'
                  LET g_qryparam.default1 = g_xrde_d[l_ac].xrde016
                                
                  LET g_qryparam.arg1 = l_glaa004
                  LET g_qryparam.arg2 = g_xrde_d[l_ac].xrde016
                  LET g_qryparam.arg3 = g_xrda_m.xrdald
                  LET g_qryparam.arg4 = " 1"
                  CALL q_glac002_6()
                  LET g_xrde_d[l_ac].xrde016 = g_qryparam.return1              
                  CALL axrt400_xrde016_desc(g_xrde_d[l_ac].xrde016) RETURNING g_xrde_d[l_ac].xrde016_desc
                  LET g_xrde_d[l_ac].xrde016_desc = g_xrde_d[l_ac].xrde016 CLIPPED,g_xrde_d[l_ac].xrde016_desc
                  DISPLAY g_xrde_d[l_ac].xrde016_desc TO xrde016_desc                   
               END IF
               #科目存在性，有效性，非统治科目，非子系统科目，账户科目属性检查
               IF NOT  s_aglt310_lc_subject(g_xrda_m.xrdald, g_xrde_d[l_ac].xrde016,'N') THEN
                  LET g_xrde_d[l_ac].xrde016 = g_xrde_d_t.xrde016
                  LET g_xrde_d[l_ac].xrde016_desc = g_xrde_d_t.xrde016_desc
                  NEXT FIELD CURRENT
               ELSE
                  
                  SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
                         glad019,glad0191,glad0192,glad020,glad0201,glad0202,
                         glad021,glad0211,glad0212,glad022,glad0221,glad0222,
                         glad023,glad0231,glad0232,glad024,glad0221,glad0242,
                         glad025,glad0251,glad0252,glad026,glad0261,glad0262
                   INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
                         g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
                         g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
                         g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
                         g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
                   FROM  glad_t
                   WHERE gladent = g_enterprise
                     AND gladld = g_xrda_m.xrdald
                     AND glad001 = g_xrde_d[l_ac].xrde016 
               END IF
               # 150916-00015#1 --end               
#               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
#               INITIALIZE g_chkparam.* TO NULL    
#               #設定g_chkparam.*的參數
#               LET g_chkparam.arg1 = g_glaa_t.glaa004
#               LET g_chkparam.arg2 = g_xrde_d[l_ac].xrde016     
#               #呼叫檢查存在並帶值的library
#               IF cl_chk_exist("v_glac002_4") THEN
#                  #檢查成功時後續處理
#                  #LET  = g_chkparam.return1
#                  #DISPLAY BY NAME 
#                  SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
#                         glad019,glad0191,glad0192,glad020,glad0201,glad0202,
#                         glad021,glad0211,glad0212,glad022,glad0221,glad0222,
#                         glad023,glad0231,glad0232,glad024,glad0221,glad0242,
#                         glad025,glad0251,glad0252,glad026,glad0261,glad0262
#                   INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
#                         g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
#                         g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
#                         g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
#                         g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
#                   FROM  glad_t
#                   WHERE gladent = g_enterprise
#                     AND gladld = g_xrda_m.xrdald
#                     AND glad001 = g_xrde_d[l_ac].xrde016  
#               ELSE
#                  #檢查失敗時後續處理
#                  LET g_xrde_d[l_ac].xrde016 = g_xrde_d_t.xrde016
#                  LET g_xrde_d[l_ac].xrde016_desc = g_xrde_d_t.xrde016_desc
#                  NEXT FIELD CURRENT
#               END IF
            END IF    
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde016_desc
            #add-point:ON CHANGE xrde016_desc name="input.g.page1.xrde016_desc"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde100
            
            #add-point:AFTER FIELD xrde100 name="input.a.page1.xrde100"
            IF NOT cl_null(g_xrde_d[l_ac].xrde100) THEN 
#應用 a19 樣板自動產生(Version:2)
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde_d[l_ac].xrde100

               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "aoo-00011:sub-01302|aooi140|",cl_get_progname("aooi140",g_lang,"2"),"|:EXEPROGaooi140"    #160318-00025#13   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooai001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
                 #150518-00044#6--MARK--(S)
                 #                        #匯率參照表;帳套;           日期;          來源幣別
                 #CALL s_aooi160_get_exrate('2',g_glaa_t.glaald,g_xrda_m.xrdadocdt,g_xrde_d[l_ac].xrde100,
                 #                         #目的幣別;   交易金額;              匯類類型
                 #                          g_glaa_t.glaa001,0,g_glaa_t.glaa025)
                 #RETURNING g_xrde_d[l_ac].xrde101
                 #150518-00044#6--MARK--(E)
                  #150518-00044#6--
                  LET lc_param.type    = '1'
                  LET lc_param.apca004 = g_xrda_m.xrda005
                  LET ls_js = util.JSON.stringify(lc_param)
                  CALL s_fin_get_curr_rate(g_xrda_m.xrdacomp,g_glaa_t.glaald,g_xrda_m.xrdadocdt,g_xrde_d[l_ac].xrde100,ls_js)
                       RETURNING g_xrde_d[l_ac].xrde101,g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde131
                  #150518-00044#6--
                  DISPLAY g_xrde_d[l_ac].xrde101 TO s_detail1[l_ac].xrde101
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde_d[l_ac].xrde100 = g_xrde_d_t.xrde100
                  LET g_xrde_d[l_ac].xrde101 = g_xrde_d_t.xrde101
                  NEXT FIELD CURRENT
               END IF
            

            END IF 


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde100
            #add-point:BEFORE FIELD xrde100 name="input.b.page1.xrde100"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde100
            #add-point:ON CHANGE xrde100 name="input.g.page1.xrde100"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde101
            #add-point:BEFORE FIELD xrde101 name="input.b.page1.xrde101"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde101
            
            #add-point:AFTER FIELD xrde101 name="input.a.page1.xrde101"
            IF NOT cl_null(g_xrde_d[l_ac].xrde101) THEN 
               LET g_xrde_d[l_ac].xrde119 = g_xrde_d[l_ac].xrde109 * g_xrde_d[l_ac].xrde101
              #LET g_xrde_d[l_ac].xrde119 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde_d[l_ac].xrde119,2)                                       #150812-00010#2 mark
               CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde_d[l_ac].xrde119,2) RETURNING g_sub_success,g_errno,g_xrde_d[l_ac].xrde119   #150812-00010#2                 
               DISPLAY g_xrde_d[l_ac].xrde119 TO s_detail1[l_ac].xrde119
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde101
            #add-point:ON CHANGE xrde101 name="input.g.page1.xrde101"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde109
            #add-point:BEFORE FIELD xrde109 name="input.b.page1.xrde109"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde109
            
            #add-point:AFTER FIELD xrde109 name="input.a.page1.xrde109"
            #150812-00010#2--s
            IF NOT cl_null(g_xrde_d[l_ac].xrde109) THEN
               CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde109,2) RETURNING g_sub_success,g_errno,g_xrde_d[l_ac].xrde109
            END IF
            #150812-00010#2--e
            IF NOT cl_null(g_xrde_d[l_ac].xrde109) AND NOT cl_null(g_xrde_d[l_ac].xrde003) THEN
               CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde109,2) RETURNING g_sub_success,g_errno,g_xrde_d[l_ac].xrde109    #150812-00010#2     
               CALL axrt400_chk_xrde109()
               IF NOT cl_null(g_errno) THEN
                  LET l_xrde109 = g_xrde_d[l_ac].xrde109
                  IF p_cmd = 'a' THEN
                     LET g_xrde_d[l_ac].xrde109 = 0
                  ELSE
                     LET g_xrde_d[l_ac].xrde109 = g_xrde_d_t.xrde109
                  END IF
                  DISPLAY g_xrde_d[l_ac].xrde109 TO s_detail1[l_ac].xrde109
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrde109
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrde109
               END IF
            END IF
            IF NOT cl_null(g_xrde_d[l_ac].xrde101) AND NOT cl_null(g_xrde_d[l_ac].xrde109) THEN
               LET g_xrde_d[l_ac].xrde119 = g_xrde_d[l_ac].xrde109 * g_xrde_d[l_ac].xrde101
              #LET g_xrde_d[l_ac].xrde119 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde_d[l_ac].xrde119,2)                                       #150812-00010#2 mark
               CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde_d[l_ac].xrde119,2) RETURNING g_sub_success,g_errno,g_xrde_d[l_ac].xrde119   #150812-00010#2                 
               DISPLAY g_xrde_d[l_ac].xrde119 TO s_detail1[l_ac].xrde119
               LET g_xrde2_d[l_ac].xrde129 = g_xrde_d[l_ac].xrde109 * g_xrde2_d[l_ac].xrde121
               IF NOT cl_null(g_xrde2_d[l_ac].xrde120) THEN 
                 #LET g_xrde2_d[l_ac].xrde129 = s_curr_round(g_xrda_m.xrdasite,g_xrde2_d[l_ac].xrde120,g_xrde2_d[l_ac].xrde121,2)                                       #150812-00010#2 mark
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde2_d[l_ac].xrde120,g_xrde2_d[l_ac].xrde129,2) RETURNING g_sub_success,g_errno,g_xrde2_d[l_ac].xrde129   #150812-00010#2                  
               END IF
               LET g_xrde2_d[l_ac].xrde139 = g_xrde_d[l_ac].xrde109 * g_xrde2_d[l_ac].xrde131
               IF NOT cl_null(g_xrde2_d[l_ac].xrde130) THEN 
                 #LET g_xrde2_d[l_ac].xrde139 = s_curr_round(g_xrda_m.xrdasite,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde131,2)                                       #150812-00010#2 mark
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde139,2) RETURNING g_sub_success,g_errno,g_xrde2_d[l_ac].xrde139   #150812-00010#2                  
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde109
            #add-point:ON CHANGE xrde109 name="input.g.page1.xrde109"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde119
            #add-point:BEFORE FIELD xrde119 name="input.b.page1.xrde119"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde119
            
            #add-point:AFTER FIELD xrde119 name="input.a.page1.xrde119"
            IF NOT cl_null(g_xrde_d[l_ac].xrde101) AND NOT cl_null(g_xrde_d[l_ac].xrde119) THEN
              #LET g_xrde_d[l_ac].xrde109 = g_xrde_d[l_ac].xrde119 / g_xrde_d[l_ac].xrde101   #150812-00010#3 mark
              #LET g_xrde_d[l_ac].xrde109 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde_d[l_ac].xrde109,2)                                              #150812-00010#2 mark
               CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde109,2) RETURNING g_sub_success,g_errno,g_xrde_d[l_ac].xrde109    #150812-00010#2                
               DISPLAY g_xrde_d[l_ac].xrde109 TO s_detail1[l_ac].xrde109
               LET g_xrde2_d[l_ac].xrde129 = g_xrde_d[l_ac].xrde109 * g_xrde2_d[l_ac].xrde121
               IF NOT cl_null(g_xrde2_d[l_ac].xrde120) THEN 
                 #LET g_xrde2_d[l_ac].xrde129 = s_curr_round(g_xrda_m.xrdasite,g_xrde2_d[l_ac].xrde120,g_xrde2_d[l_ac].xrde121,2)                                       #150812-00010#2 mark
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde2_d[l_ac].xrde120,g_xrde2_d[l_ac].xrde129,2) RETURNING g_sub_success,g_errno,g_xrde2_d[l_ac].xrde129   #150812-00010#2                  
               END IF
               LET g_xrde2_d[l_ac].xrde139 = g_xrde_d[l_ac].xrde109 * g_xrde2_d[l_ac].xrde131
               IF NOT cl_null(g_xrde2_d[l_ac].xrde130) THEN 
                 #LET g_xrde2_d[l_ac].xrde139 = s_curr_round(g_xrda_m.xrdasite,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde131,2)                                       #150812-00010#2 mark
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde139,2) RETURNING g_sub_success,g_errno,g_xrde2_d[l_ac].xrde139   #150812-00010#2                  
               END IF
            END IF
            IF NOT cl_null(g_xrde_d[l_ac].xrde109) AND NOT cl_null(g_xrde_d[l_ac].xrde003) THEN
               CALL axrt400_chk_xrde109()
               IF NOT cl_null(g_errno) THEN
                  LET l_xrde119 = g_xrde_d[l_ac].xrde119
                  LET g_xrde_d[l_ac].xrde119 = g_xrde_d_t.xrde119
                  LET g_xrde_d[l_ac].xrde109 = g_xrde_d_t.xrde109
                  DISPLAY g_xrde_d[l_ac].xrde119 TO s_detail1[l_ac].xrde119
                  DISPLAY g_xrde_d[l_ac].xrde109 TO s_detail1[l_ac].xrde109
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrde119
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrde119
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde119
            #add-point:ON CHANGE xrde119 name="input.g.page1.xrde119"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde014
            #add-point:BEFORE FIELD xrde014 name="input.b.page1.xrde014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde014
            
            #add-point:AFTER FIELD xrde014 name="input.a.page1.xrde014"
            LET l_glaa024 = ''
            SELECT glaa024 INTO l_glaa024 FROM glaa_t WHERE glaaent = g_enterprise AND glaald = g_xrda_m.xrdald

            IF NOT cl_null(g_xrde_d[l_ac].xrde014) THEN 
               IF g_xrde_d[l_ac].xrde002 = '20' THEN 
                  CALL s_aooi200_fin_chk_slip(g_xrda_m.xrdald,l_glaa024,g_xrde_d[l_ac].xrde014,'axrq343') RETURNING l_success
               END IF   
               
               IF g_xrde_d[l_ac].xrde002 = '21' THEN 
                  CALL s_aooi200_fin_chk_slip(g_xrda_m.xrdald,l_glaa024,g_xrde_d[l_ac].xrde014,'aapt301') RETURNING l_success
               END IF 
               
               IF g_xrde_d[l_ac].xrde002 = '22' THEN 
                  CALL s_aooi200_fin_chk_slip(g_xrda_m.xrdald,l_glaa024,g_xrde_d[l_ac].xrde014,'axrt330') RETURNING l_success
               END IF 
                 
               IF l_success = FALSE THEN 
                  LET g_xrde_d[l_ac].xrde014 = g_xrde_d_t.xrde014
                  NEXT FIELD xrde014
               END IF
               
               SELECT ooac004 INTO l_ooac004
                 FROM ooac_t
                WHERE ooacent = g_enterprise
                  AND ooac001 = l_glaa024
                  AND ooac002 = g_xrde_d[l_ac].xrde014
                  AND ooac003 = 'D-FIN-0030'
                  
               IF l_ooac004 = 'Y' THEN 
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = g_xrde_d[l_ac].xrde014
                  LET g_errparam.code   = "axr-00232" 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  
                  LET g_xrde_d[l_ac].xrde014 = g_xrde_d_t.xrde014
                  NEXT FIELD xrde014
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde014
            #add-point:ON CHANGE xrde014 name="input.g.page1.xrde014"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde013
            #add-point:BEFORE FIELD xrde013 name="input.b.page1.xrde013"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde013
            
            #add-point:AFTER FIELD xrde013 name="input.a.page1.xrde013"
            IF NOT cl_null(g_xrde_d[l_ac].xrde013) THEN 
#此段落由子樣板a19產生
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde_d[l_ac].xrde013

               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "apm-00201:sub-01302|axmm200|",cl_get_progname("axmm200",g_lang,"2"),"|:EXEPROGaxmm200"    #160318-00025#13   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmaa001_7") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
                  
                  #IF g_xrde_d[l_ac].xrde002 = '22' AND g_xrde_d[l_ac].xrde013 = g_xrda_m.xrda004 THEN 
                  #   INITIALIZE g_errparam TO NULL 
                  #   LET g_errparam.extend = ''
                  #   LET g_errparam.code   = 'axr-00252' 
                  #   LET g_errparam.popup  = TRUE 
                  #   CALL cl_err()
                  #   
                  #   LET g_xrde_d[l_ac].xrde013 = g_xrde_d_t.xrde013
                  #   NEXT FIELD CURRENT
                  #END IF
                  #業務人員/业务部门
                  SELECT pmab081,pmab109 INTO g_xrde3_d[l_ac].xrde017,g_xrde3_d[l_ac].xrde018
                    FROM pmab_t 
                   WHERE pmabent = g_enterprise
                     AND pmabsite = g_xrda_m.xrdacomp
                     AND pmab001 = g_xrde_d[l_ac].xrde013
                  DISPLAY g_xrde3_d[l_ac].xrde017 TO s_detail3[l_ac].xrde017
                  DISPLAY g_xrde3_d[l_ac].xrde018 TO s_detail3[l_ac].xrde018
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde_d[l_ac].xrde013 = g_xrde_d_t.xrde013
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde013
            #add-point:ON CHANGE xrde013 name="input.g.page1.xrde013"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde001
            #add-point:BEFORE FIELD xrde001 name="input.b.page1.xrde001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde001
            
            #add-point:AFTER FIELD xrde001 name="input.a.page1.xrde001"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde001
            #add-point:ON CHANGE xrde001 name="input.g.page1.xrde001"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdecomp
            #add-point:BEFORE FIELD xrdecomp name="input.b.page1.xrdecomp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdecomp
            
            #add-point:AFTER FIELD xrdecomp name="input.a.page1.xrdecomp"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdecomp
            #add-point:ON CHANGE xrdecomp name="input.g.page1.xrdecomp"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdesite
            #add-point:BEFORE FIELD xrdesite name="input.b.page1.xrdesite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdesite
            
            #add-point:AFTER FIELD xrdesite name="input.a.page1.xrdesite"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdesite
            #add-point:ON CHANGE xrdesite name="input.g.page1.xrdesite"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrdeorga
            #add-point:BEFORE FIELD xrdeorga name="input.b.page1.xrdeorga"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrdeorga
            
            #add-point:AFTER FIELD xrdeorga name="input.a.page1.xrdeorga"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrdeorga
            #add-point:ON CHANGE xrdeorga name="input.g.page1.xrdeorga"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde011
            #add-point:BEFORE FIELD xrde011 name="input.b.page1.xrde011"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde011
            
            #add-point:AFTER FIELD xrde011 name="input.a.page1.xrde011"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde011
            #add-point:ON CHANGE xrde011 name="input.g.page1.xrde011"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde015
            
            #add-point:AFTER FIELD xrde015 name="input.a.page1.xrde015"


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde015
            #add-point:BEFORE FIELD xrde015 name="input.b.page1.xrde015"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde015
            #add-point:ON CHANGE xrde015 name="input.g.page1.xrde015"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde015_desc
            #add-point:BEFORE FIELD xrde015_desc name="input.b.page1.xrde015_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde015_desc
            
            #add-point:AFTER FIELD xrde015_desc name="input.a.page1.xrde015_desc"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde015_desc
            #add-point:ON CHANGE xrde015_desc name="input.g.page1.xrde015_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde012
            #add-point:BEFORE FIELD xrde012 name="input.b.page1.xrde012"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde012
            
            #add-point:AFTER FIELD xrde012 name="input.a.page1.xrde012"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde012
            #add-point:ON CHANGE xrde012 name="input.g.page1.xrde012"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde012_desc
            #add-point:BEFORE FIELD xrde012_desc name="input.b.page1.xrde012_desc"
            LET g_xrde_d[l_ac].xrde012_desc = g_xrde_d[l_ac].xrde012
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde012_desc
            
            #add-point:AFTER FIELD xrde012_desc name="input.a.page1.xrde012_desc"
            LET g_xrde_d[l_ac].xrde012 = g_xrde_d[l_ac].xrde012_desc
            CALL axrt400_xrde012_desc(g_xrde_d[l_ac].xrde012) RETURNING g_xrde_d[l_ac].xrde012_desc
            LET g_xrde_d[l_ac].xrde012_desc = g_xrde_d[l_ac].xrde012 CLIPPED,'  ',g_xrde_d[l_ac].xrde012_desc
            IF NOT cl_null(g_xrde_d[l_ac].xrde012) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde_d[l_ac].xrde012
               LET g_chkparam.arg2 = g_glaa_t.glaa005 
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_nmai002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1

               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde_d[l_ac].xrde012 = g_xrde_d_t.xrde012
                  LET g_xrde_d[l_ac].xrde012_desc = g_xrde_d_t.xrde012_desc
                  NEXT FIELD CURRENT
               END IF
            END IF  
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde012_desc
            #add-point:ON CHANGE xrde012_desc name="input.g.page1.xrde012_desc"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page1.xrdeseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdeseq
            #add-point:ON ACTION controlp INFIELD xrdeseq name="input.c.page1.xrdeseq"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde002
            #add-point:ON ACTION controlp INFIELD xrde002 name="input.c.page1.xrde002"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde006
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde006
            #add-point:ON ACTION controlp INFIELD xrde006 name="input.c.page1.xrde006"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde003
            #add-point:ON ACTION controlp INFIELD xrde003 name="input.c.page1.xrde003"
            SELECT pmaa004 INTO l_pmaa004 FROM pmaa_t WHERE pmaaent = g_enterprise AND pmaa001 = g_xrda_m.xrda005   #160802-00007#1 Add
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xrde_d[l_ac].xrde003   #給予default值
            LET g_qryparam.default2 = g_xrde_d[l_ac].xrde004   #給予default值
            #呼叫開窗
            IF g_xrde_d[l_ac].xrde002 = '10' THEN
               #給予arg
               LET g_qryparam.arg1 = g_xrda_m.xrdasite   #帳務中心
               LET g_qryparam.arg2 = g_xrda_m.xrda004    #核銷客戶
               LET g_qryparam.arg3 = g_xrda_m.xrda005    #收款客戶
               LET g_qryparam.arg4 = g_xrda_m.xrdacomp   #來源組織
               LET g_qryparam.arg5 = g_xrda_m.xrdald     #帳套
               #LET g_qryparam.arg6 = '10'                #款別分類
               
               LET g_qryparam.arg6 = g_xrde_d[l_ac].xrde006    #160405-00010#1
            
               LET g_qryparam.where= "     nmbadocdt <= '",g_xrda_m.xrdadocdt,"'",
                                     " AND nmbb029 = '",g_xrde_d[l_ac].xrde006,"'"
              #160607-00015#3  Add  ---(S)---
              ," AND NOT EXISTS (SELECT 1 FROM isba_t,isbb_t WHERE isbaent = isbbent AND isbadocno = isbbdocno ",
               " AND isbacomp = isbbcomp AND isbbent = nmbbent AND isbastus <> 'X' ",
               " AND isbb002 = nmbbdocno AND isbb003 = nmbbseq)"
              #160607-00015#3  Add  ---(E)---
               
               IF g_xrde_d[l_ac].xrde006 = '30' THEN   #票據類型
                  LET g_qryparam.where = g_qryparam.where, " AND nmbb042 <> '5' ",
                                                           " AND nmbb042 <> '6' ",
                                                           " AND nmbb042 <> '7' ",
                                                           " AND nmbb042 <> '9' "
               END IF
            
               #160802-00007#1 Add  ---(S)---
               IF l_pmaa004 = '2' THEN
                  LET g_qryparam.where = g_qryparam.where," AND nmba005 = '",g_xrda_m.xrda006,"'"
               END IF
               #160802-00007#1 Add  ---(E)---
               CALL axrt400_07()                         #銀存收支資料沖帳挑選(子作業)
               
               IF NOT cl_null(g_qryparam.return1) THEN    #151105-00008#2 add lujh
                  CALL axrt400_ins_xrde(g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006)
                  LET l_xrde_flag = 'Y' 
                  LET l_flag = 'Y'
                  EXIT DIALOG
               #151105-00008#2--add--str--lujh
               ELSE
                  NEXT FIELD xrde003
               END IF
               #151105-00008#2--add--end--lujh
            
#               CASE
#                  WHEN g_xrde_d[l_ac].xrde006 = '10'           #現金類型
#                     #給予arg
#                     LET g_qryparam.arg1 = g_xrda_m.xrdasite   #帳務中心(接收,暫不處理)
#                     LET g_qryparam.arg2 = g_xrda_m.xrda004    #核銷客戶
#                     LET g_qryparam.arg3 = g_xrda_m.xrda005    #收款客戶
#                     LET g_qryparam.arg4 = g_xrda_m.xrdacomp   #來源組織(接收,暫不處理)
#                     LET g_qryparam.arg5 = g_xrda_m.xrdald     #帳套
#                     #LET g_qryparam.arg6 = '10'                #款別分類
#                     
#                     LET g_qryparam.where= "     nmbadocdt <= '",g_xrda_m.xrdadocdt,"'",
#                                           #" AND nmbastus = 'V'",
#                                           " AND nmbb029 = '10'"
#                     
#                     CALL axrt400_07()                         #銀存收支資料沖帳挑選(子作業)
#                     CALL axrt400_ins_xrde(g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006)
#                     LET l_xrde_flag = 'Y' 
#                     LET l_flag = 'Y'
#                     EXIT DIALOG
#            
#                  WHEN g_xrde_d[l_ac].xrde006 = '20'           #銀行電匯款
#                     #給予arg
#                     LET g_qryparam.arg1 = g_xrda_m.xrdasite   #帳務中心(接收,暫不處理)
#                     LET g_qryparam.arg2 = g_xrda_m.xrda004    #核銷客戶
#                     LET g_qryparam.arg3 = g_xrda_m.xrda005    #收款客戶
#                     LET g_qryparam.arg4 = g_xrda_m.xrdacomp   #來源組織(接收,暫不處理)
#                     LET g_qryparam.arg5 = g_xrda_m.xrdald     #帳套
#                     #LET g_qryparam.arg6 = '20'                #款別分類
#                     
#                     LET g_qryparam.where= "     nmbadocdt <= '",g_xrda_m.xrdadocdt,"'",
#                                           #" AND nmbastus = 'V'",
#                                           " AND nmbb029 = '20'"
#                     
#                     CALL axrt400_07()                         #銀存收支資料沖帳挑選(子作業)
#                     CALL axrt400_ins_xrde(g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006)
#                     LET l_xrde_flag = 'Y' 
#                     LET l_flag = 'Y'
#                     EXIT DIALOG
#            
#                  WHEN g_xrde_d[l_ac].xrde006 = '30'           #票據類型
#                     #給予arg
#                     LET g_qryparam.arg1 = g_xrda_m.xrdasite   #帳務中心(接收,暫不處理)
#                     LET g_qryparam.arg2 = g_xrda_m.xrda004    #核銷客戶
#                     LET g_qryparam.arg3 = g_xrda_m.xrda005    #收款客戶
#                     LET g_qryparam.arg4 = g_xrda_m.xrdacomp   #來源組織(接收,暫不處理)
#                     LET g_qryparam.arg5 = g_xrda_m.xrdald     #帳套
#                     #LET g_qryparam.arg6 = '30'                #款別分類
#                     
#                     LET g_qryparam.where= "     nmbadocdt <= '",g_xrda_m.xrdadocdt,"'",
#                                           #" AND nmbastus = 'Y'",
#                                           " AND nmbb042 <> '5' ",
#                                           " AND nmbb042 <> '6' ",
#                                           " AND nmbb042 <> '7' ",
#                                           " AND nmbb042 <> '9' ",
#                                           " AND nmbb029 = '30'"
#                     
#                     CALL axrt400_07()                         #銀存收支資料沖帳挑選(子作業)
#
#                     CALL axrt400_ins_xrde(g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006)
#                     LET l_xrde_flag = 'Y' 
#                     LET l_flag = 'Y'
#                     EXIT DIALOG
#            
#                  WHEN g_xrde_d[l_ac].xrde006 = '40'           #暫無規格
#                  WHEN g_xrde_d[l_ac].xrde006 = '50'           #暫無規格
#                  WHEN g_xrde_d[l_ac].xrde006 = '60'           #暫無規格
#                  WHEN g_xrde_d[l_ac].xrde006 = '70'           #暫無規格
#                  WHEN g_xrde_d[l_ac].xrde006 = '90'           #暫無規格
#               END CASE
            END IF
            

            NEXT FIELD xrde003                                 #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde004
            #add-point:ON ACTION controlp INFIELD xrde004 name="input.c.page1.xrde004"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde008
            #add-point:ON ACTION controlp INFIELD xrde008 name="input.c.page1.xrde008"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.l_xrde008
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD l_xrde008
            #add-point:ON ACTION controlp INFIELD l_xrde008 name="input.c.page1.l_xrde008"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde032
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde032
            #add-point:ON ACTION controlp INFIELD xrde032 name="input.c.page1.xrde032"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde010
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde010
            #add-point:ON ACTION controlp INFIELD xrde010 name="input.c.page1.xrde010"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde016
            #add-point:ON ACTION controlp INFIELD xrde016 name="input.c.page1.xrde016"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde016_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde016_desc
            #add-point:ON ACTION controlp INFIELD xrde016_desc name="input.c.page1.xrde016_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde_d[l_ac].xrde016             #給予default值
            LET g_qryparam.where = " glac001 = '",g_glaa_t.glaa004,"'",
                                   " AND glac002 IN (SELECT glad001 FROM glad_t,glac_t WHERE glad001= glac002 AND gladld='",g_xrda_m.xrdald,"' AND gladent=",g_enterprise,
                                   " AND gladstus = 'Y' )" #150916-00015#1 add
            #給予arg
      
            CALL aglt310_04()                                #呼叫開窗

            LET g_xrde_d[l_ac].xrde016 = g_qryparam.return1              
            CALL axrt400_xrde016_desc(g_xrde_d[l_ac].xrde016) RETURNING g_xrde_d[l_ac].xrde016_desc
            LET g_xrde_d[l_ac].xrde016_desc = g_xrde_d[l_ac].xrde016 CLIPPED,g_xrde_d[l_ac].xrde016_desc
            DISPLAY g_xrde_d[l_ac].xrde016_desc TO xrde016_desc              #

            NEXT FIELD xrde016_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde100
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde100
            #add-point:ON ACTION controlp INFIELD xrde100 name="input.c.page1.xrde100"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde_d[l_ac].xrde100             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_aooi001_1()                                #呼叫開窗

            LET g_xrde_d[l_ac].xrde100 = g_qryparam.return1              

            DISPLAY g_xrde_d[l_ac].xrde100 TO xrde100              #

            NEXT FIELD xrde100                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde101
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde101
            #add-point:ON ACTION controlp INFIELD xrde101 name="input.c.page1.xrde101"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde109
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde109
            #add-point:ON ACTION controlp INFIELD xrde109 name="input.c.page1.xrde109"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde119
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde119
            #add-point:ON ACTION controlp INFIELD xrde119 name="input.c.page1.xrde119"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde014
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde014
            #add-point:ON ACTION controlp INFIELD xrde014 name="input.c.page1.xrde014"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde_d[l_ac].xrde014             #給予default值
            SELECT glaa024 INTO l_glaa024 FROM glaa_t WHERE glaaent = g_enterprise AND glaald = g_xrda_m.xrdald
            #給予arg
            LET g_qryparam.arg1 = l_glaa024
            
            IF g_xrde_d[l_ac].xrde002 = '20' THEN 
               #LET g_qryparam.arg2 = "axrt340"
               LET g_qryparam.arg2 = "axrq343"
            END IF
            
            IF g_xrde_d[l_ac].xrde002 = '21' THEN 
               LET g_qryparam.arg2 = "aapt301"
            END IF
            
            IF g_xrde_d[l_ac].xrde002 = '22' THEN 
               LET g_qryparam.arg2 = "axrt330"
            END IF
            LET g_qryparam.arg3 = 'D-FIN-0030'
            LET g_qryparam.arg4 = "'N'"
            
            CALL q_ooba002_11()               #呼叫開窗

            LET g_xrde_d[l_ac].xrde014 = g_qryparam.return1              

            DISPLAY g_xrde_d[l_ac].xrde014 TO xrde014              #

            NEXT FIELD xrde014                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde013
            #add-point:ON ACTION controlp INFIELD xrde013 name="input.c.page1.xrde013"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde_d[l_ac].xrde013             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            #161017-00011#2--add--str--
            IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
               LET g_qryparam.where = g_sql_ctrl
            END IF
            #161017-00011#2--add--end
            CALL q_pmaa001_13()                                #呼叫開窗

            LET g_xrde_d[l_ac].xrde013 = g_qryparam.return1              

            DISPLAY g_xrde_d[l_ac].xrde013 TO xrde013              #
            NEXT FIELD xrde013                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde001
            #add-point:ON ACTION controlp INFIELD xrde001 name="input.c.page1.xrde001"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrdecomp
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdecomp
            #add-point:ON ACTION controlp INFIELD xrdecomp name="input.c.page1.xrdecomp"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrdesite
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdesite
            #add-point:ON ACTION controlp INFIELD xrdesite name="input.c.page1.xrdesite"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrdeorga
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrdeorga
            #add-point:ON ACTION controlp INFIELD xrdeorga name="input.c.page1.xrdeorga"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde011
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde011
            #add-point:ON ACTION controlp INFIELD xrde011 name="input.c.page1.xrde011"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde015
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde015
            #add-point:ON ACTION controlp INFIELD xrde015 name="input.c.page1.xrde015"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde015_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde015_desc
            #add-point:ON ACTION controlp INFIELD xrde015_desc name="input.c.page1.xrde015_desc"
            
            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde012
            #add-point:ON ACTION controlp INFIELD xrde012 name="input.c.page1.xrde012"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde_d[l_ac].xrde012             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_nmai002()                                #呼叫開窗

            LET g_xrde_d[l_ac].xrde012 = g_qryparam.return1              

            DISPLAY g_xrde_d[l_ac].xrde012 TO xrde012              #

            NEXT FIELD xrde012                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page1.xrde012_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde012_desc
            #add-point:ON ACTION controlp INFIELD xrde012_desc name="input.c.page1.xrde012_desc"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde_d[l_ac].xrde012             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s
           #160612-00005#1 Add  ---(S)---
            SELECT glaa005 INTO l_glaa005 FROM glaa_t WHERE glaaent = g_enterprise
               AND glaald = g_xrda_m.xrdald
            LET g_qryparam.where = " nmai001 = '",l_glaa005,"'"
           #160612-00005#1 Add  ---(E)--- 


            CALL q_nmai002()                                #呼叫開窗

            LET g_xrde_d[l_ac].xrde012 = g_qryparam.return1      
            CALL axrt400_xrde012_desc(g_xrde_d[l_ac].xrde012) RETURNING g_xrde_d[l_ac].xrde012_desc
            LET g_xrde_d[l_ac].xrde012_desc = g_xrde_d[l_ac].xrde012 CLIPPED,'  ',g_xrde_d[l_ac].xrde012_desc
            DISPLAY g_xrde_d[l_ac].xrde012_desc TO xrde012_desc            

            NEXT FIELD xrde012_desc
            #END add-point
 
 
 
 
         ON ROW CHANGE
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xrde_d[l_ac].* = g_xrde_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_xrde_d[l_ac].xrdeseq 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_xrde_d[l_ac].* = g_xrde_d_t.*
            ELSE
            
               #add-point:單身修改前 name="input.body.b_update"
               
               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
               #將遮罩欄位還原
               CALL axrt400_xrde_t_mask_restore('restore_mask_o')
      
               UPDATE xrde_t SET (xrdeld,xrdedocno,xrdeseq,xrde002,xrde006,xrde003,xrde004,xrde008,xrde032, 
                   xrde010,xrde016,xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp, 
                   xrdesite,xrdeorga,xrde011,xrde015,xrde012,xrde120,xrde121,xrde129,xrde130,xrde131, 
                   xrde139,xrde017,xrde018,xrde019,xrde035,xrde036,xrde020,xrde022,xrde023,xrde039,xrde040, 
                   xrde042,xrde043,xrde044,xrde045,xrde046,xrde047,xrde048,xrde049,xrde050,xrde051) = (g_xrda_m.xrdald, 
                   g_xrda_m.xrdadocno,g_xrde_d[l_ac].xrdeseq,g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006, 
                   g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde032, 
                   g_xrde_d[l_ac].xrde010,g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101, 
                   g_xrde_d[l_ac].xrde109,g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013, 
                   g_xrde_d[l_ac].xrde001,g_xrde_d[l_ac].xrdecomp,g_xrde_d[l_ac].xrdesite,g_xrde_d[l_ac].xrdeorga, 
                   g_xrde_d[l_ac].xrde011,g_xrde_d[l_ac].xrde015,g_xrde_d[l_ac].xrde012,g_xrde2_d[l_ac].xrde120, 
                   g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde129,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde131, 
                   g_xrde2_d[l_ac].xrde139,g_xrde3_d[l_ac].xrde017,g_xrde3_d[l_ac].xrde018,g_xrde3_d[l_ac].xrde019, 
                   g_xrde3_d[l_ac].xrde035,g_xrde3_d[l_ac].xrde036,g_xrde3_d[l_ac].xrde020,g_xrde3_d[l_ac].xrde022, 
                   g_xrde3_d[l_ac].xrde023,g_xrde3_d[l_ac].xrde039,g_xrde3_d[l_ac].xrde040,g_xrde3_d[l_ac].xrde042, 
                   g_xrde3_d[l_ac].xrde043,g_xrde3_d[l_ac].xrde044,g_xrde3_d[l_ac].xrde045,g_xrde3_d[l_ac].xrde046, 
                   g_xrde3_d[l_ac].xrde047,g_xrde3_d[l_ac].xrde048,g_xrde3_d[l_ac].xrde049,g_xrde3_d[l_ac].xrde050, 
                   g_xrde3_d[l_ac].xrde051)
                WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m.xrdald 
                  AND xrdedocno = g_xrda_m.xrdadocno 
 
                  AND xrdeseq = g_xrde_d_t.xrdeseq #項次   
 
                  
               #add-point:單身修改中 name="input.body.m_update"
               
               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xrde_d[l_ac].* = g_xrde_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrde_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.sqlcode #其他錯誤
                     LET g_xrde_d[l_ac].* = g_xrde_d_t.*  
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()                   
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys_bak[1] = g_xrdald_t
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys_bak[2] = g_xrdadocno_t
               LET gs_keys[3] = g_xrde_d[g_detail_idx].xrdeseq
               LET gs_keys_bak[3] = g_xrde_d_t.xrdeseq
               CALL axrt400_update_b('xrde_t',gs_keys,gs_keys_bak,"'1'")
               END CASE
 
               #將遮罩欄位進行遮蔽
               CALL axrt400_xrde_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT(g_xrde_d[g_detail_idx].xrdeseq = g_xrde_d_t.xrdeseq 
 
                  ) THEN
                  LET gs_keys[01] = g_xrda_m.xrdald
                  LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
 
                  LET gs_keys[gs_keys.getLength()+1] = g_xrde_d_t.xrdeseq
 
                  CALL axrt400_key_update_b(gs_keys,'xrde_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde_d_t)
               LET g_log2 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身修改後 name="input.body.a_update"
               
               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row name="input.body.after_row"
            
            #end add-point
            CALL axrt400_unlock_b("xrde_t","'1'")
            CALL s_transaction_end('Y','0')
            #其他table進行unlock
            #add-point:單身after_row2 name="input.body.after_row2"
            
            #end add-point
              
         AFTER INPUT
            #add-point:input段after input  name="input.body.after_input"
            
            #end add-point 
    
         ON ACTION controlo    
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xrde_d[li_reproduce_target].* = g_xrde_d[li_reproduce].*
               LET g_xrde2_d[li_reproduce_target].* = g_xrde2_d[li_reproduce].*
               LET g_xrde3_d[li_reproduce_target].* = g_xrde3_d[li_reproduce].*
 
               LET g_xrde_d[li_reproduce_target].xrdeseq = NULL
 
            ELSE
               CALL FGL_SET_ARR_CURR(g_xrde_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xrde_d.getLength()+1
            END IF
            
         #ON ACTION cancel
         #   LET INT_FLAG = 1
         #   LET g_detail_idx = 1
         #   EXIT DIALOG 
 
      END INPUT
      
      INPUT ARRAY g_xrde2_d FROM s_detail2.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = FALSE, #此頁面insert功能由產生器控制, 手動之設定無效! 
 
                 DELETE ROW = FALSE,
                 APPEND ROW = FALSE)
                 
         #自訂ACTION(detail_input,page_2)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body2.before_input2"
            
            #end add-point
            
            CALL axrt400_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue("'4','5','6',"))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_xrde2_d.getLength()
            #add-point:資料輸入前 name="input.body2.before_input"
            
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xrde2_d[l_ac].* TO NULL 
            INITIALIZE g_xrde2_d_t.* TO NULL 
            INITIALIZE g_xrde2_d_o.* TO NULL 
            #公用欄位給值(單身2)
            
            #自定義預設值(單身2)
                  LET g_xrde2_d[l_ac].xrde129 = "0"
      LET g_xrde2_d[l_ac].xrde139 = "0"
 
            #add-point:modify段before備份 name="input.body2.insert.before_bak"
            
            #end add-point
            LET g_xrde2_d_t.* = g_xrde2_d[l_ac].*     #新輸入資料
            LET g_xrde2_d_o.* = g_xrde2_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL axrt400_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body2.insert.after_set_entry_b"
            
            #end add-point
            CALL axrt400_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xrde_d[li_reproduce_target].* = g_xrde_d[li_reproduce].*
               LET g_xrde2_d[li_reproduce_target].* = g_xrde2_d[li_reproduce].*
               LET g_xrde3_d[li_reproduce_target].* = g_xrde3_d[li_reproduce].*
 
               LET g_xrde2_d[li_reproduce_target].xrdeseq = NULL
            END IF
            
 
 
 
            #add-point:modify段before insert name="input.body2.before_insert"
            
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body2.before_row2"
            EXIT DIALOG
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[2] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 2
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN axrt400_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CLOSE axrt400_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xrde2_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xrde2_d[l_ac].xrdeseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_xrde2_d_t.* = g_xrde2_d[l_ac].*  #BACKUP
               LET g_xrde2_d_o.* = g_xrde2_d[l_ac].*  #BACKUP
               CALL axrt400_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body2.after_set_entry_b"
               
               #end add-point  
               CALL axrt400_set_no_entry_b(l_cmd)
               IF NOT axrt400_lock_b("xrde_t","'2'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH axrt400_bcl INTO g_xrde_d[l_ac].xrdeseq,g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006, 
                      g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde032, 
                      g_xrde_d[l_ac].xrde010,g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101, 
                      g_xrde_d[l_ac].xrde109,g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013, 
                      g_xrde_d[l_ac].xrde001,g_xrde_d[l_ac].xrdecomp,g_xrde_d[l_ac].xrdesite,g_xrde_d[l_ac].xrdeorga, 
                      g_xrde_d[l_ac].xrde011,g_xrde_d[l_ac].xrde015,g_xrde_d[l_ac].xrde012,g_xrde2_d[l_ac].xrdeseq, 
                      g_xrde2_d[l_ac].xrde120,g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde129,g_xrde2_d[l_ac].xrde130, 
                      g_xrde2_d[l_ac].xrde131,g_xrde2_d[l_ac].xrde139,g_xrde3_d[l_ac].xrdeseq,g_xrde3_d[l_ac].xrde017, 
                      g_xrde3_d[l_ac].xrde018,g_xrde3_d[l_ac].xrde019,g_xrde3_d[l_ac].xrde035,g_xrde3_d[l_ac].xrde036, 
                      g_xrde3_d[l_ac].xrde020,g_xrde3_d[l_ac].xrde022,g_xrde3_d[l_ac].xrde023,g_xrde3_d[l_ac].xrde039, 
                      g_xrde3_d[l_ac].xrde040,g_xrde3_d[l_ac].xrde042,g_xrde3_d[l_ac].xrde043,g_xrde3_d[l_ac].xrde044, 
                      g_xrde3_d[l_ac].xrde045,g_xrde3_d[l_ac].xrde046,g_xrde3_d[l_ac].xrde047,g_xrde3_d[l_ac].xrde048, 
                      g_xrde3_d[l_ac].xrde049,g_xrde3_d[l_ac].xrde050,g_xrde3_d[l_ac].xrde051
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xrde2_d_mask_o[l_ac].* =  g_xrde2_d[l_ac].*
                  CALL axrt400_xrde_t_mask()
                  LET g_xrde2_d_mask_n[l_ac].* =  g_xrde2_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL axrt400_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body2.before_row"
            
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
 
 
            #其他table進行lock
            
 
 
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body2.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body2.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身2刪除前 name="input.body2.b_delete"
               
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xrda_m.xrdald
               LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
               LET gs_keys[gs_keys.getLength()+1] = g_xrde2_d_t.xrdeseq
            
               #刪除同層單身
               IF NOT axrt400_delete_b('xrde_t',gs_keys,"'2'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT axrt400_key_delete_b(gs_keys,'xrde_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
 
 
               
               #add-point:單身2刪除中 name="input.body2.m_delete"
               
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE axrt400_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身2刪除後 name="input.body2.a_delete"
               
               #end add-point
               LET l_count = g_xrde_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body2.after_delete"
               
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xrde2_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身2新增前 name="input.body2.b_a_insert"
            
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xrde_t 
             WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m.xrdald
               AND xrdedocno = g_xrda_m.xrdadocno
               AND xrdeseq = g_xrde2_d[l_ac].xrdeseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身2新增前 name="input.body2.b_insert"
               
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys[3] = g_xrde2_d[g_detail_idx].xrdeseq
               CALL axrt400_insert_b('xrde_t',gs_keys,"'2'")
                           
               #add-point:單身新增後2 name="input.body2.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_xrde_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL axrt400_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body2.after_insert"
               
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xrde2_d[l_ac].* = g_xrde2_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_xrde2_d[l_ac].* = g_xrde2_d_t.*
            ELSE
               #add-point:單身page2修改前 name="input.body2.b_update"
               
               #end add-point
               
               #寫入修改者/修改日期資訊(單身2)
               
               
               #將遮罩欄位還原
               CALL axrt400_xrde_t_mask_restore('restore_mask_o')
                              
               UPDATE xrde_t SET (xrdeld,xrdedocno,xrdeseq,xrde002,xrde006,xrde003,xrde004,xrde008,xrde032, 
                   xrde010,xrde016,xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp, 
                   xrdesite,xrdeorga,xrde011,xrde015,xrde012,xrde120,xrde121,xrde129,xrde130,xrde131, 
                   xrde139,xrde017,xrde018,xrde019,xrde035,xrde036,xrde020,xrde022,xrde023,xrde039,xrde040, 
                   xrde042,xrde043,xrde044,xrde045,xrde046,xrde047,xrde048,xrde049,xrde050,xrde051) = (g_xrda_m.xrdald, 
                   g_xrda_m.xrdadocno,g_xrde_d[l_ac].xrdeseq,g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006, 
                   g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde032, 
                   g_xrde_d[l_ac].xrde010,g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101, 
                   g_xrde_d[l_ac].xrde109,g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013, 
                   g_xrde_d[l_ac].xrde001,g_xrde_d[l_ac].xrdecomp,g_xrde_d[l_ac].xrdesite,g_xrde_d[l_ac].xrdeorga, 
                   g_xrde_d[l_ac].xrde011,g_xrde_d[l_ac].xrde015,g_xrde_d[l_ac].xrde012,g_xrde2_d[l_ac].xrde120, 
                   g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde129,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde131, 
                   g_xrde2_d[l_ac].xrde139,g_xrde3_d[l_ac].xrde017,g_xrde3_d[l_ac].xrde018,g_xrde3_d[l_ac].xrde019, 
                   g_xrde3_d[l_ac].xrde035,g_xrde3_d[l_ac].xrde036,g_xrde3_d[l_ac].xrde020,g_xrde3_d[l_ac].xrde022, 
                   g_xrde3_d[l_ac].xrde023,g_xrde3_d[l_ac].xrde039,g_xrde3_d[l_ac].xrde040,g_xrde3_d[l_ac].xrde042, 
                   g_xrde3_d[l_ac].xrde043,g_xrde3_d[l_ac].xrde044,g_xrde3_d[l_ac].xrde045,g_xrde3_d[l_ac].xrde046, 
                   g_xrde3_d[l_ac].xrde047,g_xrde3_d[l_ac].xrde048,g_xrde3_d[l_ac].xrde049,g_xrde3_d[l_ac].xrde050, 
                   g_xrde3_d[l_ac].xrde051) #自訂欄位頁簽
                WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m.xrdald
                  AND xrdedocno = g_xrda_m.xrdadocno
                  AND xrdeseq = g_xrde2_d_t.xrdeseq #項次 
                  
               #add-point:單身page2修改中 name="input.body2.m_update"
               
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xrde2_d[l_ac].* = g_xrde2_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrde_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.sqlcode #其他錯誤
                     LET g_xrde2_d[l_ac].* = g_xrde2_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys_bak[1] = g_xrdald_t
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys_bak[2] = g_xrdadocno_t
               LET gs_keys[3] = g_xrde2_d[g_detail_idx].xrdeseq
               LET gs_keys_bak[3] = g_xrde2_d_t.xrdeseq
               CALL axrt400_update_b('xrde_t',gs_keys,gs_keys_bak,"'2'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL axrt400_xrde_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_xrde2_d[g_detail_idx].xrdeseq = g_xrde2_d_t.xrdeseq 
                  ) THEN
                  LET gs_keys[01] = g_xrda_m.xrdald
                  LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xrde2_d_t.xrdeseq
                  CALL axrt400_key_update_b(gs_keys,'xrde_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde2_d_t)
               LET g_log2 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde2_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page2修改後 name="input.body2.a_update"
               
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde120
            #add-point:BEFORE FIELD xrde120 name="input.b.page2.xrde120"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde120
            
            #add-point:AFTER FIELD xrde120 name="input.a.page2.xrde120"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde120
            #add-point:ON CHANGE xrde120 name="input.g.page2.xrde120"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde121
            #add-point:BEFORE FIELD xrde121 name="input.b.page2.xrde121"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde121
            
            #add-point:AFTER FIELD xrde121 name="input.a.page2.xrde121"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde121
            #add-point:ON CHANGE xrde121 name="input.g.page2.xrde121"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde129
            #add-point:BEFORE FIELD xrde129 name="input.b.page2.xrde129"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde129
            
            #add-point:AFTER FIELD xrde129 name="input.a.page2.xrde129"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde129
            #add-point:ON CHANGE xrde129 name="input.g.page2.xrde129"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde130
            #add-point:BEFORE FIELD xrde130 name="input.b.page2.xrde130"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde130
            
            #add-point:AFTER FIELD xrde130 name="input.a.page2.xrde130"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde130
            #add-point:ON CHANGE xrde130 name="input.g.page2.xrde130"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde131
            #add-point:BEFORE FIELD xrde131 name="input.b.page2.xrde131"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde131
            
            #add-point:AFTER FIELD xrde131 name="input.a.page2.xrde131"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde131
            #add-point:ON CHANGE xrde131 name="input.g.page2.xrde131"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde139
            #add-point:BEFORE FIELD xrde139 name="input.b.page2.xrde139"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde139
            
            #add-point:AFTER FIELD xrde139 name="input.a.page2.xrde139"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde139
            #add-point:ON CHANGE xrde139 name="input.g.page2.xrde139"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page2.xrde120
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde120
            #add-point:ON ACTION controlp INFIELD xrde120 name="input.c.page2.xrde120"
            
            #END add-point
 
 
         #Ctrlp:input.c.page2.xrde121
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde121
            #add-point:ON ACTION controlp INFIELD xrde121 name="input.c.page2.xrde121"
            
            #END add-point
 
 
         #Ctrlp:input.c.page2.xrde129
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde129
            #add-point:ON ACTION controlp INFIELD xrde129 name="input.c.page2.xrde129"
            
            #END add-point
 
 
         #Ctrlp:input.c.page2.xrde130
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde130
            #add-point:ON ACTION controlp INFIELD xrde130 name="input.c.page2.xrde130"
            
            #END add-point
 
 
         #Ctrlp:input.c.page2.xrde131
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde131
            #add-point:ON ACTION controlp INFIELD xrde131 name="input.c.page2.xrde131"
            
            #END add-point
 
 
         #Ctrlp:input.c.page2.xrde139
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde139
            #add-point:ON ACTION controlp INFIELD xrde139 name="input.c.page2.xrde139"
            
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page2 after_row name="input.body2.after_row"
            
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xrde2_d[l_ac].* = g_xrde2_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL axrt400_unlock_b("xrde_t","'2'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page2 after_row2 name="input.body2.after_row2"
            
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body2.after_input"
            
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xrde_d[li_reproduce_target].* = g_xrde_d[li_reproduce].*
               LET g_xrde2_d[li_reproduce_target].* = g_xrde2_d[li_reproduce].*
               LET g_xrde3_d[li_reproduce_target].* = g_xrde3_d[li_reproduce].*
 
               LET g_xrde2_d[li_reproduce_target].xrdeseq = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_xrde2_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xrde2_d.getLength()+1
            END IF
            
      END INPUT
      INPUT ARRAY g_xrde3_d FROM s_detail3.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = FALSE, #此頁面insert功能由產生器控制, 手動之設定無效! 
 
                 DELETE ROW = FALSE,
                 APPEND ROW = FALSE)
                 
         #自訂ACTION(detail_input,page_3)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body3.before_input2"
            
            #end add-point
            
            CALL axrt400_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_xrde3_d.getLength()
            #add-point:資料輸入前 name="input.body3.before_input"
            
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xrde3_d[l_ac].* TO NULL 
            INITIALIZE g_xrde3_d_t.* TO NULL 
            INITIALIZE g_xrde3_d_o.* TO NULL 
            #公用欄位給值(單身3)
            
            #自定義預設值(單身3)
            
            #add-point:modify段before備份 name="input.body3.insert.before_bak"
            
            #end add-point
            LET g_xrde3_d_t.* = g_xrde3_d[l_ac].*     #新輸入資料
            LET g_xrde3_d_o.* = g_xrde3_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL axrt400_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body3.insert.after_set_entry_b"
            
            #end add-point
            CALL axrt400_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xrde_d[li_reproduce_target].* = g_xrde_d[li_reproduce].*
               LET g_xrde2_d[li_reproduce_target].* = g_xrde2_d[li_reproduce].*
               LET g_xrde3_d[li_reproduce_target].* = g_xrde3_d[li_reproduce].*
 
               LET g_xrde3_d[li_reproduce_target].xrdeseq = NULL
            END IF
            
 
 
 
            #add-point:modify段before insert name="input.body3.before_insert"
            
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body3.before_row2"
            
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[3] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 3
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN axrt400_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CLOSE axrt400_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xrde3_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xrde3_d[l_ac].xrdeseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_xrde3_d_t.* = g_xrde3_d[l_ac].*  #BACKUP
               LET g_xrde3_d_o.* = g_xrde3_d[l_ac].*  #BACKUP
               CALL axrt400_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body3.after_set_entry_b"
               
               #end add-point  
               CALL axrt400_set_no_entry_b(l_cmd)
               IF NOT axrt400_lock_b("xrde_t","'3'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH axrt400_bcl INTO g_xrde_d[l_ac].xrdeseq,g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006, 
                      g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde032, 
                      g_xrde_d[l_ac].xrde010,g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101, 
                      g_xrde_d[l_ac].xrde109,g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013, 
                      g_xrde_d[l_ac].xrde001,g_xrde_d[l_ac].xrdecomp,g_xrde_d[l_ac].xrdesite,g_xrde_d[l_ac].xrdeorga, 
                      g_xrde_d[l_ac].xrde011,g_xrde_d[l_ac].xrde015,g_xrde_d[l_ac].xrde012,g_xrde2_d[l_ac].xrdeseq, 
                      g_xrde2_d[l_ac].xrde120,g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde129,g_xrde2_d[l_ac].xrde130, 
                      g_xrde2_d[l_ac].xrde131,g_xrde2_d[l_ac].xrde139,g_xrde3_d[l_ac].xrdeseq,g_xrde3_d[l_ac].xrde017, 
                      g_xrde3_d[l_ac].xrde018,g_xrde3_d[l_ac].xrde019,g_xrde3_d[l_ac].xrde035,g_xrde3_d[l_ac].xrde036, 
                      g_xrde3_d[l_ac].xrde020,g_xrde3_d[l_ac].xrde022,g_xrde3_d[l_ac].xrde023,g_xrde3_d[l_ac].xrde039, 
                      g_xrde3_d[l_ac].xrde040,g_xrde3_d[l_ac].xrde042,g_xrde3_d[l_ac].xrde043,g_xrde3_d[l_ac].xrde044, 
                      g_xrde3_d[l_ac].xrde045,g_xrde3_d[l_ac].xrde046,g_xrde3_d[l_ac].xrde047,g_xrde3_d[l_ac].xrde048, 
                      g_xrde3_d[l_ac].xrde049,g_xrde3_d[l_ac].xrde050,g_xrde3_d[l_ac].xrde051
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xrde3_d_mask_o[l_ac].* =  g_xrde3_d[l_ac].*
                  CALL axrt400_xrde_t_mask()
                  LET g_xrde3_d_mask_n[l_ac].* =  g_xrde3_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL axrt400_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body3.before_row"
            SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
                   glad019,glad0191,glad0192,glad020,glad0201,glad0202,
                   glad021,glad0211,glad0212,glad022,glad0221,glad0222,
                   glad023,glad0231,glad0232,glad024,glad0221,glad0242,
                   glad025,glad0251,glad0252,glad026,glad0261,glad0262
             INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
                   g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
                   g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
                   g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
                   g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
             FROM  glad_t
             WHERE gladent = g_enterprise
               AND gladld = g_xrda_m.xrdald
               AND glad001 = g_xrde_d[l_ac].xrde016  
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
 
 
            #其他table進行lock
            
 
 
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body3.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body3.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身3刪除前 name="input.body3.b_delete"
               
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xrda_m.xrdald
               LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
               LET gs_keys[gs_keys.getLength()+1] = g_xrde3_d_t.xrdeseq
            
               #刪除同層單身
               IF NOT axrt400_delete_b('xrde_t',gs_keys,"'3'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT axrt400_key_delete_b(gs_keys,'xrde_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
 
 
               
               #add-point:單身3刪除中 name="input.body3.m_delete"
               
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE axrt400_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身3刪除後 name="input.body3.a_delete"
               
               #end add-point
               LET l_count = g_xrde_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body3.after_delete"
               
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xrde3_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身3新增前 name="input.body3.b_a_insert"
            
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xrde_t 
             WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m.xrdald
               AND xrdedocno = g_xrda_m.xrdadocno
               AND xrdeseq = g_xrde3_d[l_ac].xrdeseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身3新增前 name="input.body3.b_insert"
               
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys[3] = g_xrde3_d[g_detail_idx].xrdeseq
               CALL axrt400_insert_b('xrde_t',gs_keys,"'3'")
                           
               #add-point:單身新增後3 name="input.body3.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_xrde_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL axrt400_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body3.after_insert"
               
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xrde3_d[l_ac].* = g_xrde3_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_xrde3_d[l_ac].* = g_xrde3_d_t.*
            ELSE
               #add-point:單身page3修改前 name="input.body3.b_update"
               
               #end add-point
               
               #寫入修改者/修改日期資訊(單身3)
               
               
               #將遮罩欄位還原
               CALL axrt400_xrde_t_mask_restore('restore_mask_o')
                              
               UPDATE xrde_t SET (xrdeld,xrdedocno,xrdeseq,xrde002,xrde006,xrde003,xrde004,xrde008,xrde032, 
                   xrde010,xrde016,xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp, 
                   xrdesite,xrdeorga,xrde011,xrde015,xrde012,xrde120,xrde121,xrde129,xrde130,xrde131, 
                   xrde139,xrde017,xrde018,xrde019,xrde035,xrde036,xrde020,xrde022,xrde023,xrde039,xrde040, 
                   xrde042,xrde043,xrde044,xrde045,xrde046,xrde047,xrde048,xrde049,xrde050,xrde051) = (g_xrda_m.xrdald, 
                   g_xrda_m.xrdadocno,g_xrde_d[l_ac].xrdeseq,g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006, 
                   g_xrde_d[l_ac].xrde003,g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde032, 
                   g_xrde_d[l_ac].xrde010,g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101, 
                   g_xrde_d[l_ac].xrde109,g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013, 
                   g_xrde_d[l_ac].xrde001,g_xrde_d[l_ac].xrdecomp,g_xrde_d[l_ac].xrdesite,g_xrde_d[l_ac].xrdeorga, 
                   g_xrde_d[l_ac].xrde011,g_xrde_d[l_ac].xrde015,g_xrde_d[l_ac].xrde012,g_xrde2_d[l_ac].xrde120, 
                   g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde129,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde131, 
                   g_xrde2_d[l_ac].xrde139,g_xrde3_d[l_ac].xrde017,g_xrde3_d[l_ac].xrde018,g_xrde3_d[l_ac].xrde019, 
                   g_xrde3_d[l_ac].xrde035,g_xrde3_d[l_ac].xrde036,g_xrde3_d[l_ac].xrde020,g_xrde3_d[l_ac].xrde022, 
                   g_xrde3_d[l_ac].xrde023,g_xrde3_d[l_ac].xrde039,g_xrde3_d[l_ac].xrde040,g_xrde3_d[l_ac].xrde042, 
                   g_xrde3_d[l_ac].xrde043,g_xrde3_d[l_ac].xrde044,g_xrde3_d[l_ac].xrde045,g_xrde3_d[l_ac].xrde046, 
                   g_xrde3_d[l_ac].xrde047,g_xrde3_d[l_ac].xrde048,g_xrde3_d[l_ac].xrde049,g_xrde3_d[l_ac].xrde050, 
                   g_xrde3_d[l_ac].xrde051) #自訂欄位頁簽
                WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m.xrdald
                  AND xrdedocno = g_xrda_m.xrdadocno
                  AND xrdeseq = g_xrde3_d_t.xrdeseq #項次 
                  
               #add-point:單身page3修改中 name="input.body3.m_update"
               
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xrde3_d[l_ac].* = g_xrde3_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrde_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.sqlcode #其他錯誤
                     LET g_xrde3_d[l_ac].* = g_xrde3_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys_bak[1] = g_xrdald_t
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys_bak[2] = g_xrdadocno_t
               LET gs_keys[3] = g_xrde3_d[g_detail_idx].xrdeseq
               LET gs_keys_bak[3] = g_xrde3_d_t.xrdeseq
               CALL axrt400_update_b('xrde_t',gs_keys,gs_keys_bak,"'3'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL axrt400_xrde_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_xrde3_d[g_detail_idx].xrdeseq = g_xrde3_d_t.xrdeseq 
                  ) THEN
                  LET gs_keys[01] = g_xrda_m.xrdald
                  LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xrde3_d_t.xrdeseq
                  CALL axrt400_key_update_b(gs_keys,'xrde_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde3_d_t)
               LET g_log2 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde3_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page3修改後 name="input.body3.a_update"
               
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde017
            #add-point:BEFORE FIELD xrde017 name="input.b.page3.xrde017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde017
            
            #add-point:AFTER FIELD xrde017 name="input.a.page3.xrde017"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde017
            #add-point:ON CHANGE xrde017 name="input.g.page3.xrde017"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde017_desc
            #add-point:BEFORE FIELD xrde017_desc name="input.b.page3.xrde017_desc"
            LET g_xrde3_d[l_ac].xrde017_desc = g_xrde3_d[l_ac].xrde017
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde017_desc
            
            #add-point:AFTER FIELD xrde017_desc name="input.a.page3.xrde017_desc"
            LET g_xrde3_d[l_ac].xrde017 = g_xrde3_d[l_ac].xrde017_desc
            CALL axrt400_xrde017_desc(g_xrde3_d[l_ac].xrde017) RETURNING g_xrde3_d[l_ac].xrde017_desc
            LET g_xrde3_d[l_ac].xrde017_desc = g_xrde3_d[l_ac].xrde017 CLIPPED,g_xrde3_d[l_ac].xrde017_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde017) THEN 
               ##設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               #INITIALIZE g_chkparam.* TO NULL    
               ##設定g_chkparam.*的參數
               #LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde017
               ##呼叫檢查存在並帶值的library
               #IF cl_chk_exist("v_ooag001") THEN
               #   #檢查成功時後續處理
               #   #LET  = g_chkparam.return1
               #   #DISPLAY BY NAME 
               #ELSE
               #   #檢查失敗時後續處理
               #   LET g_xrde3_d[l_ac].xrde017 = g_xrde3_d_t.xrde017
               #   LET g_xrde3_d[l_ac].xrde017_desc = g_xrde3_d_t.xrde017_desc
               #   NEXT FIELD CURRENT
               #END IF
               CALL s_employee_chk(g_xrde3_d[l_ac].xrde017) RETURNING l_success
               
               IF l_success = FALSE THEN 
                  LET g_xrde3_d[l_ac].xrde017 = g_xrde3_d_t.xrde017
                  LET g_xrde3_d[l_ac].xrde017_desc = g_xrde3_d_t.xrde017_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde017_desc
            #add-point:ON CHANGE xrde017_desc name="input.g.page3.xrde017_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde018
            #add-point:BEFORE FIELD xrde018 name="input.b.page3.xrde018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde018
            
            #add-point:AFTER FIELD xrde018 name="input.a.page3.xrde018"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde018
            #add-point:ON CHANGE xrde018 name="input.g.page3.xrde018"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde018_desc
            #add-point:BEFORE FIELD xrde018_desc name="input.b.page3.xrde018_desc"
            LET g_xrde3_d[l_ac].xrde018_desc = g_xrde3_d[l_ac].xrde018
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde018_desc
            
            #add-point:AFTER FIELD xrde018_desc name="input.a.page3.xrde018_desc"
            LET g_xrde3_d[l_ac].xrde018 = g_xrde3_d[l_ac].xrde018_desc
            CALL axrt400_xrde018_desc(g_xrde3_d[l_ac].xrde018) RETURNING g_xrde3_d[l_ac].xrde018_desc
            LET g_xrde3_d[l_ac].xrde018_desc = g_xrde3_d[l_ac].xrde018 CLIPPED,g_xrde3_d[l_ac].xrde018_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde018) THEN 
               ##設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               #INITIALIZE g_chkparam.* TO NULL    
               ##設定g_chkparam.*的參數
               #LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde018
               #LET g_chkparam.arg2 = g_today 
               ##呼叫檢查存在並帶值的library
               #IF cl_chk_exist("v_ooeg001") THEN
               #   #檢查成功時後續處理
               #   #LET  = g_chkparam.return1
               #   #DISPLAY BY NAME 
               #ELSE
               #   #檢查失敗時後續處理
               #   LET g_xrde3_d[l_ac].xrde018 = g_xrde3_d_t.xrde018
               #   LET g_xrde3_d[l_ac].xrde018_desc = g_xrde3_d_t.xrde018_desc
               #   NEXT FIELD CURRENT
               #END IF
               CALL s_department_chk(g_xrde3_d[l_ac].xrde018,g_xrda_m.xrdadocdt) RETURNING l_success
               
               IF l_success = FALSE THEN 
                  LET g_xrde3_d[l_ac].xrde018 = g_xrde3_d_t.xrde018
                  LET g_xrde3_d[l_ac].xrde018_desc = g_xrde3_d_t.xrde018_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde018_desc
            #add-point:ON CHANGE xrde018_desc name="input.g.page3.xrde018_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde019
            #add-point:BEFORE FIELD xrde019 name="input.b.page3.xrde019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde019
            
            #add-point:AFTER FIELD xrde019 name="input.a.page3.xrde019"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde019
            #add-point:ON CHANGE xrde019 name="input.g.page3.xrde019"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde019_desc
            #add-point:BEFORE FIELD xrde019_desc name="input.b.page3.xrde019_desc"
            LET g_xrde3_d[l_ac].xrde019_desc = g_xrde3_d[l_ac].xrde019
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde019_desc
            
            #add-point:AFTER FIELD xrde019_desc name="input.a.page3.xrde019_desc"
            LET g_xrde3_d[l_ac].xrde019 = g_xrde3_d[l_ac].xrde019_desc
            CALL axrt400_xrde018_desc(g_xrde3_d[l_ac].xrde019) RETURNING g_xrde3_d[l_ac].xrde019_desc
            LET g_xrde3_d[l_ac].xrde019_desc = g_xrde3_d[l_ac].xrde019 CLIPPED,g_xrde3_d[l_ac].xrde019_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde019) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde019
               LET g_chkparam.arg2 = g_today 
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "aoo-00095:sub-01302|aooi125|",cl_get_progname("aooi125",g_lang,"2"),"|:EXEPROGaooi125"    #160318-00025#13 
               LET g_chkparam.err_str[2] = "aoo-00029:sub-01302|aooi125|",cl_get_progname("aooi125",g_lang,"2"),"|:EXEPROGaooi125"    #160318-00025#13               
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooeg001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde3_d[l_ac].xrde019 = g_xrde3_d_t.xrde019
                  LET g_xrde3_d[l_ac].xrde019_desc = g_xrde3_d_t.xrde019_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde019_desc
            #add-point:ON CHANGE xrde019_desc name="input.g.page3.xrde019_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde035
            #add-point:BEFORE FIELD xrde035 name="input.b.page3.xrde035"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde035
            
            #add-point:AFTER FIELD xrde035 name="input.a.page3.xrde035"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde035
            #add-point:ON CHANGE xrde035 name="input.g.page3.xrde035"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde035_desc
            #add-point:BEFORE FIELD xrde035_desc name="input.b.page3.xrde035_desc"
            LET g_xrde3_d[l_ac].xrde035_desc = g_xrde3_d[l_ac].xrde035
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde035_desc
            
            #add-point:AFTER FIELD xrde035_desc name="input.a.page3.xrde035_desc"
            LET g_xrde3_d[l_ac].xrde035 = g_xrde3_d[l_ac].xrde035_desc
            CALL axrt400_xrde035_desc('287',g_xrde3_d[l_ac].xrde035) RETURNING g_xrde3_d[l_ac].xrde035_desc
            LET g_xrde3_d[l_ac].xrde035_desc = g_xrde3_d[l_ac].xrde035 CLIPPED,g_xrde3_d[l_ac].xrde035_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde035) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde035
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "axm-00004:sub-01302|axmi027|",cl_get_progname("axmi027",g_lang,"2"),"|:EXEPROGaxmi027"    #160318-00025#13     
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_287") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde3_d[l_ac].xrde035 = g_xrde3_d_t.xrde035
                  LET g_xrde3_d[l_ac].xrde035_desc = g_xrde3_d_t.xrde035_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde035_desc
            #add-point:ON CHANGE xrde035_desc name="input.g.page3.xrde035_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde036
            #add-point:BEFORE FIELD xrde036 name="input.b.page3.xrde036"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde036
            
            #add-point:AFTER FIELD xrde036 name="input.a.page3.xrde036"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde036
            #add-point:ON CHANGE xrde036 name="input.g.page3.xrde036"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde036_desc
            #add-point:BEFORE FIELD xrde036_desc name="input.b.page3.xrde036_desc"
            LET g_xrde3_d[l_ac].xrde036_desc = g_xrde3_d[l_ac].xrde036
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde036_desc
            
            #add-point:AFTER FIELD xrde036_desc name="input.a.page3.xrde036_desc"
            LET g_xrde3_d[l_ac].xrde036 = g_xrde3_d[l_ac].xrde036_desc
            CALL axrt400_xrde035_desc('281',g_xrde3_d[l_ac].xrde036) RETURNING g_xrde3_d[l_ac].xrde036_desc
            LET g_xrde3_d[l_ac].xrde036_desc = g_xrde3_d[l_ac].xrde036 CLIPPED,g_xrde3_d[l_ac].xrde036_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde036) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde036
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "apm-00093:sub-01302|axmi021|",cl_get_progname("axmi021",g_lang,"2"),"|:EXEPROGaxmi021"    #160318-00025#13
               LET g_chkparam.err_str[2] = "apm-00092:sub-01303|axmi021|",cl_get_progname("axmi021",g_lang,"2"),"|:EXEPROGaxmi021"    #160318-00025#13     
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_281") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde3_d[l_ac].xrde036 = g_xrde3_d_t.xrde036
                  LET g_xrde3_d[l_ac].xrde036_desc = g_xrde3_d_t.xrde036_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde036_desc
            #add-point:ON CHANGE xrde036_desc name="input.g.page3.xrde036_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde020
            #add-point:BEFORE FIELD xrde020 name="input.b.page3.xrde020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde020
            
            #add-point:AFTER FIELD xrde020 name="input.a.page3.xrde020"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde020
            #add-point:ON CHANGE xrde020 name="input.g.page3.xrde020"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde020_desc
            #add-point:BEFORE FIELD xrde020_desc name="input.b.page3.xrde020_desc"
            LET g_xrde3_d[l_ac].xrde020_desc = g_xrde3_d[l_ac].xrde020
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde020_desc
            
            #add-point:AFTER FIELD xrde020_desc name="input.a.page3.xrde020_desc"
            LET g_xrde3_d[l_ac].xrde020 = g_xrde3_d[l_ac].xrde020_desc
            CALL axrt400_xrde020_desc(g_xrde3_d[l_ac].xrde020) RETURNING g_xrde3_d[l_ac].xrde020_desc
            LET g_xrde3_d[l_ac].xrde020_desc = g_xrde3_d[l_ac].xrde020 CLIPPED,g_xrde3_d[l_ac].xrde020_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde020) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde020
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "anm-00081:sub-01302|aimi010|",cl_get_progname("aimi010",g_lang,"2"),"|:EXEPROGaimi010"    #160318-00025#13
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_rtax001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde3_d[l_ac].xrde020 = g_xrde3_d_t.xrde020
                  LET g_xrde3_d[l_ac].xrde020_desc = g_xrde3_d_t.xrde020_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde020_desc
            #add-point:ON CHANGE xrde020_desc name="input.g.page3.xrde020_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde022
            #add-point:BEFORE FIELD xrde022 name="input.b.page3.xrde022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde022
            
            #add-point:AFTER FIELD xrde022 name="input.a.page3.xrde022"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde022
            #add-point:ON CHANGE xrde022 name="input.g.page3.xrde022"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde022_desc
            #add-point:BEFORE FIELD xrde022_desc name="input.b.page3.xrde022_desc"
            LET g_xrde3_d[l_ac].xrde022_desc = g_xrde3_d[l_ac].xrde022
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde022_desc
            
            #add-point:AFTER FIELD xrde022_desc name="input.a.page3.xrde022_desc"
            LET g_xrde3_d[l_ac].xrde022 = g_xrde3_d[l_ac].xrde022_desc
            CALL axrt400_xrde022_desc(g_xrde3_d[l_ac].xrde022) RETURNING g_xrde3_d[l_ac].xrde022_desc
            LET g_xrde3_d[l_ac].xrde022_desc = g_xrde3_d[l_ac].xrde022 CLIPPED,g_xrde3_d[l_ac].xrde022_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde022) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde022
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "apj-00012:sub-01302|apjm200|",cl_get_progname("apjm200",g_lang,"2"),"|:EXEPROGapjm200"    #160318-00025#13      
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pjba001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde3_d[l_ac].xrde022 = g_xrde3_d_t.xrde022
                  LET g_xrde3_d[l_ac].xrde022_desc = g_xrde3_d_t.xrde022_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde022_desc
            #add-point:ON CHANGE xrde022_desc name="input.g.page3.xrde022_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde023
            #add-point:BEFORE FIELD xrde023 name="input.b.page3.xrde023"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde023
            
            #add-point:AFTER FIELD xrde023 name="input.a.page3.xrde023"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde023
            #add-point:ON CHANGE xrde023 name="input.g.page3.xrde023"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde023_desc
            #add-point:BEFORE FIELD xrde023_desc name="input.b.page3.xrde023_desc"
            LET g_xrde3_d[l_ac].xrde023_desc = g_xrde3_d[l_ac].xrde023
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde023_desc
            
            #add-point:AFTER FIELD xrde023_desc name="input.a.page3.xrde023_desc"
            LET g_xrde3_d[l_ac].xrde023 = g_xrde3_d[l_ac].xrde023_desc
            CALL axrt400_xrde023_desc(g_xrde3_d[l_ac].xrde022,g_xrde3_d[l_ac].xrde023) RETURNING g_xrde3_d[l_ac].xrde023_desc
            LET g_xrde3_d[l_ac].xrde023_desc = g_xrde3_d[l_ac].xrde023 CLIPPED,g_xrde3_d[l_ac].xrde023_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde023) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde022
               LET g_chkparam.arg2 = g_xrde3_d[l_ac].xrde023
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pjbb002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde3_d[l_ac].xrde023 = g_xrde3_d_t.xrde023
                  LET g_xrde3_d[l_ac].xrde023_desc = g_xrde3_d_t.xrde023_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde023_desc
            #add-point:ON CHANGE xrde023_desc name="input.g.page3.xrde023_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde039
            #add-point:BEFORE FIELD xrde039 name="input.b.page3.xrde039"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde039
            
            #add-point:AFTER FIELD xrde039 name="input.a.page3.xrde039"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde039
            #add-point:ON CHANGE xrde039 name="input.g.page3.xrde039"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde040
            #add-point:BEFORE FIELD xrde040 name="input.b.page3.xrde040"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde040
            
            #add-point:AFTER FIELD xrde040 name="input.a.page3.xrde040"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde040
            #add-point:ON CHANGE xrde040 name="input.g.page3.xrde040"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde040_desc
            #add-point:BEFORE FIELD xrde040_desc name="input.b.page3.xrde040_desc"
            LET g_xrde3_d[l_ac].xrde040_desc = g_xrde3_d[l_ac].xrde040
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde040_desc
            
            #add-point:AFTER FIELD xrde040_desc name="input.a.page3.xrde040_desc"
            LET g_xrde3_d[l_ac].xrde040 = g_xrde3_d[l_ac].xrde040_desc
            CALL axrt400_xrde040_desc(g_xrde3_d[l_ac].xrde040) RETURNING g_xrde3_d[l_ac].xrde040_desc
            LET g_xrde3_d[l_ac].xrde040_desc = g_xrde3_d[l_ac].xrde040 CLIPPED,g_xrde3_d[l_ac].xrde040_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde040) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde3_d[l_ac].xrde040
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oojd001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde3_d[l_ac].xrde040 = g_xrde3_d_t.xrde040
                  LET g_xrde3_d[l_ac].xrde040_desc = g_xrde3_d_t.xrde040_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde040_desc
            #add-point:ON CHANGE xrde040_desc name="input.g.page3.xrde040_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde042
            #add-point:BEFORE FIELD xrde042 name="input.b.page3.xrde042"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde042
            
            #add-point:AFTER FIELD xrde042 name="input.a.page3.xrde042"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde042
            #add-point:ON CHANGE xrde042 name="input.g.page3.xrde042"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde042_desc
            #add-point:BEFORE FIELD xrde042_desc name="input.b.page3.xrde042_desc"
            LET g_xrde3_d[l_ac].xrde042_desc = g_xrde3_d[l_ac].xrde042
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0171
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0171
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde042_desc
            
            #add-point:AFTER FIELD xrde042_desc name="input.a.page3.xrde042_desc"
            LET g_xrde3_d[l_ac].xrde042 = g_xrde3_d[l_ac].xrde042_desc
            DISPLAY '' TO xrde042_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde042) THEN
               CALL axrt400_free_account_chk(g_glad0171,g_xrde3_d[l_ac].xrde042,g_glad0172) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde042
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde042 = g_xrde3_d_t.xrde042
                  LET g_xrde3_d[l_ac].xrde042_desc = g_xrde3_d_t.xrde042_desc
                  DISPLAY g_xrde3_d[l_ac].xrde042_desc TO s_detail3[l_ac].xrde042_desc
                  NEXT FIELD xrde042_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0171,g_xrde3_d[l_ac].xrde042) RETURNING g_xrde3_d[l_ac].xrde042_desc
            LET g_xrde3_d[l_ac].xrde042_desc = g_xrde3_d[l_ac].xrde042 CLIPPED ,g_xrde3_d[l_ac].xrde042_desc
            DISPLAY g_xrde3_d[l_ac].xrde042_desc TO s_detail3[l_ac].xrde042_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde042_desc
            #add-point:ON CHANGE xrde042_desc name="input.g.page3.xrde042_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde043
            #add-point:BEFORE FIELD xrde043 name="input.b.page3.xrde043"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde043
            
            #add-point:AFTER FIELD xrde043 name="input.a.page3.xrde043"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde043
            #add-point:ON CHANGE xrde043 name="input.g.page3.xrde043"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde043_desc
            #add-point:BEFORE FIELD xrde043_desc name="input.b.page3.xrde043_desc"
            LET g_xrde3_d[l_ac].xrde043_desc = g_xrde3_d[l_ac].xrde043
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0181
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0181
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde043_desc
            
            #add-point:AFTER FIELD xrde043_desc name="input.a.page3.xrde043_desc"
            LET g_xrde3_d[l_ac].xrde043 = g_xrde3_d[l_ac].xrde043_desc
            DISPLAY '' TO xrde043_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde043) THEN
               CALL axrt400_free_account_chk(g_glad0181,g_xrde3_d[l_ac].xrde043,g_glad0182) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde043
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde043 = g_xrde3_d_t.xrde043
                  LET g_xrde3_d[l_ac].xrde043_desc = g_xrde3_d_t.xrde043_desc
                  DISPLAY g_xrde3_d[l_ac].xrde043_desc TO s_detail3[l_ac].xrde043_desc
                  NEXT FIELD xrde043_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0181,g_xrde3_d[l_ac].xrde043) RETURNING g_xrde3_d[l_ac].xrde043_desc
            LET g_xrde3_d[l_ac].xrde043_desc = g_xrde3_d[l_ac].xrde043 CLIPPED ,g_xrde3_d[l_ac].xrde043_desc
            DISPLAY g_xrde3_d[l_ac].xrde043_desc TO s_detail3[l_ac].xrde043_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde043_desc
            #add-point:ON CHANGE xrde043_desc name="input.g.page3.xrde043_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde044
            #add-point:BEFORE FIELD xrde044 name="input.b.page3.xrde044"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde044
            
            #add-point:AFTER FIELD xrde044 name="input.a.page3.xrde044"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde044
            #add-point:ON CHANGE xrde044 name="input.g.page3.xrde044"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde044_desc
            #add-point:BEFORE FIELD xrde044_desc name="input.b.page3.xrde044_desc"
            LET g_xrde3_d[l_ac].xrde044_desc = g_xrde3_d[l_ac].xrde044
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0191
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0191
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde044_desc
            
            #add-point:AFTER FIELD xrde044_desc name="input.a.page3.xrde044_desc"
            LET g_xrde3_d[l_ac].xrde044 = g_xrde3_d[l_ac].xrde044_desc
            DISPLAY '' TO xrde044_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde044) THEN
               CALL axrt400_free_account_chk(g_glad0191,g_xrde3_d[l_ac].xrde044,g_glad0192) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde044
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde044 = g_xrde3_d_t.xrde044
                  LET g_xrde3_d[l_ac].xrde044_desc = g_xrde3_d_t.xrde044_desc
                  DISPLAY g_xrde3_d[l_ac].xrde044_desc TO s_detail3[l_ac].xrde044_desc
                  NEXT FIELD xrde044_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0191,g_xrde3_d[l_ac].xrde044) RETURNING g_xrde3_d[l_ac].xrde044_desc
            LET g_xrde3_d[l_ac].xrde044_desc = g_xrde3_d[l_ac].xrde044 CLIPPED ,g_xrde3_d[l_ac].xrde044_desc
            DISPLAY g_xrde3_d[l_ac].xrde044_desc TO s_detail3[l_ac].xrde044_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde044_desc
            #add-point:ON CHANGE xrde044_desc name="input.g.page3.xrde044_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde045
            #add-point:BEFORE FIELD xrde045 name="input.b.page3.xrde045"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde045
            
            #add-point:AFTER FIELD xrde045 name="input.a.page3.xrde045"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde045
            #add-point:ON CHANGE xrde045 name="input.g.page3.xrde045"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde045_desc
            #add-point:BEFORE FIELD xrde045_desc name="input.b.page3.xrde045_desc"
            LET g_xrde3_d[l_ac].xrde045_desc = g_xrde3_d[l_ac].xrde045
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0201
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0201
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde045_desc
            
            #add-point:AFTER FIELD xrde045_desc name="input.a.page3.xrde045_desc"
            LET g_xrde3_d[l_ac].xrde045 = g_xrde3_d[l_ac].xrde045_desc
            DISPLAY '' TO xrde045_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde045) THEN
               CALL axrt400_free_account_chk(g_glad0201,g_xrde3_d[l_ac].xrde045,g_glad0202) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde045
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde045 = g_xrde3_d_t.xrde045
                  LET g_xrde3_d[l_ac].xrde045_desc = g_xrde3_d_t.xrde045_desc
                  DISPLAY g_xrde3_d[l_ac].xrde045_desc TO s_detail3[l_ac].xrde045_desc
                  NEXT FIELD xrde045_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0201,g_xrde3_d[l_ac].xrde045) RETURNING g_xrde3_d[l_ac].xrde045_desc
            LET g_xrde3_d[l_ac].xrde045_desc = g_xrde3_d[l_ac].xrde045 CLIPPED ,g_xrde3_d[l_ac].xrde045_desc
            DISPLAY g_xrde3_d[l_ac].xrde045_desc TO s_detail3[l_ac].xrde045_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde045_desc
            #add-point:ON CHANGE xrde045_desc name="input.g.page3.xrde045_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde046
            #add-point:BEFORE FIELD xrde046 name="input.b.page3.xrde046"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde046
            
            #add-point:AFTER FIELD xrde046 name="input.a.page3.xrde046"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde046
            #add-point:ON CHANGE xrde046 name="input.g.page3.xrde046"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde046_desc
            #add-point:BEFORE FIELD xrde046_desc name="input.b.page3.xrde046_desc"
            LET g_xrde3_d[l_ac].xrde046_desc = g_xrde3_d[l_ac].xrde046
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0211
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0211
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde046_desc
            
            #add-point:AFTER FIELD xrde046_desc name="input.a.page3.xrde046_desc"
            LET g_xrde3_d[l_ac].xrde046 = g_xrde3_d[l_ac].xrde046_desc
            DISPLAY '' TO xrde046_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde046) THEN
               CALL axrt400_free_account_chk(g_glad0211,g_xrde3_d[l_ac].xrde046,g_glad0212) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde046
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde046 = g_xrde3_d_t.xrde046
                  LET g_xrde3_d[l_ac].xrde046_desc = g_xrde3_d_t.xrde046_desc
                  DISPLAY g_xrde3_d[l_ac].xrde046_desc TO s_detail3[l_ac].xrde046_desc
                  NEXT FIELD xrde046_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0211,g_xrde3_d[l_ac].xrde046) RETURNING g_xrde3_d[l_ac].xrde046_desc
            LET g_xrde3_d[l_ac].xrde046_desc = g_xrde3_d[l_ac].xrde046 CLIPPED ,g_xrde3_d[l_ac].xrde046_desc
            DISPLAY g_xrde3_d[l_ac].xrde046_desc TO s_detail3[l_ac].xrde046_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde046_desc
            #add-point:ON CHANGE xrde046_desc name="input.g.page3.xrde046_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde047
            #add-point:BEFORE FIELD xrde047 name="input.b.page3.xrde047"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde047
            
            #add-point:AFTER FIELD xrde047 name="input.a.page3.xrde047"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde047
            #add-point:ON CHANGE xrde047 name="input.g.page3.xrde047"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde047_desc
            #add-point:BEFORE FIELD xrde047_desc name="input.b.page3.xrde047_desc"
            LET g_xrde3_d[l_ac].xrde047_desc = g_xrde3_d[l_ac].xrde047
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0221
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0221
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde047_desc
            
            #add-point:AFTER FIELD xrde047_desc name="input.a.page3.xrde047_desc"
            LET g_xrde3_d[l_ac].xrde047 = g_xrde3_d[l_ac].xrde047_desc
            DISPLAY '' TO xrde047_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde047) THEN
               CALL axrt400_free_account_chk(g_glad0221,g_xrde3_d[l_ac].xrde047,g_glad0222) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde047
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde047 = g_xrde3_d_t.xrde047
                  LET g_xrde3_d[l_ac].xrde047_desc = g_xrde3_d_t.xrde047_desc
                  DISPLAY g_xrde3_d[l_ac].xrde047_desc TO s_detail3[l_ac].xrde047_desc
                  NEXT FIELD xrde047_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0221,g_xrde3_d[l_ac].xrde047) RETURNING g_xrde3_d[l_ac].xrde047_desc
            LET g_xrde3_d[l_ac].xrde047_desc = g_xrde3_d[l_ac].xrde047 CLIPPED ,g_xrde3_d[l_ac].xrde047_desc
            DISPLAY g_xrde3_d[l_ac].xrde047_desc TO s_detail3[l_ac].xrde047_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde047_desc
            #add-point:ON CHANGE xrde047_desc name="input.g.page3.xrde047_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde048
            #add-point:BEFORE FIELD xrde048 name="input.b.page3.xrde048"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde048
            
            #add-point:AFTER FIELD xrde048 name="input.a.page3.xrde048"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde048
            #add-point:ON CHANGE xrde048 name="input.g.page3.xrde048"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde048_desc
            #add-point:BEFORE FIELD xrde048_desc name="input.b.page3.xrde048_desc"
            LET g_xrde3_d[l_ac].xrde048_desc = g_xrde3_d[l_ac].xrde048
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0231
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0231
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde048_desc
            
            #add-point:AFTER FIELD xrde048_desc name="input.a.page3.xrde048_desc"
            LET g_xrde3_d[l_ac].xrde048 = g_xrde3_d[l_ac].xrde048_desc
            DISPLAY '' TO xrde048_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde048) THEN
               CALL axrt400_free_account_chk(g_glad0231,g_xrde3_d[l_ac].xrde048,g_glad0232) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde048
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde048 = g_xrde3_d_t.xrde048
                  LET g_xrde3_d[l_ac].xrde048_desc = g_xrde3_d_t.xrde048_desc
                  DISPLAY g_xrde3_d[l_ac].xrde048_desc TO s_detail3[l_ac].xrde048_desc
                  NEXT FIELD xrde048_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0231,g_xrde3_d[l_ac].xrde048) RETURNING g_xrde3_d[l_ac].xrde048_desc
            LET g_xrde3_d[l_ac].xrde048_desc = g_xrde3_d[l_ac].xrde048 CLIPPED ,g_xrde3_d[l_ac].xrde048_desc
            DISPLAY g_xrde3_d[l_ac].xrde048_desc TO s_detail3[l_ac].xrde048_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde048_desc
            #add-point:ON CHANGE xrde048_desc name="input.g.page3.xrde048_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde049
            #add-point:BEFORE FIELD xrde049 name="input.b.page3.xrde049"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde049
            
            #add-point:AFTER FIELD xrde049 name="input.a.page3.xrde049"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde049
            #add-point:ON CHANGE xrde049 name="input.g.page3.xrde049"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde049_desc
            #add-point:BEFORE FIELD xrde049_desc name="input.b.page3.xrde049_desc"
            LET g_xrde3_d[l_ac].xrde049_desc = g_xrde3_d[l_ac].xrde049
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0241
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0241
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde049_desc
            
            #add-point:AFTER FIELD xrde049_desc name="input.a.page3.xrde049_desc"
            LET g_xrde3_d[l_ac].xrde049 = g_xrde3_d[l_ac].xrde049_desc
            DISPLAY '' TO xrde049_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde049) THEN
               CALL axrt400_free_account_chk(g_glad0241,g_xrde3_d[l_ac].xrde049,g_glad0242) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde049
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde049 = g_xrde3_d_t.xrde049
                  LET g_xrde3_d[l_ac].xrde049_desc = g_xrde3_d_t.xrde049_desc
                  DISPLAY g_xrde3_d[l_ac].xrde049_desc TO s_detail3[l_ac].xrde049_desc
                  NEXT FIELD xrde049_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0241,g_xrde3_d[l_ac].xrde049) RETURNING g_xrde3_d[l_ac].xrde049_desc
            LET g_xrde3_d[l_ac].xrde049_desc = g_xrde3_d[l_ac].xrde049 CLIPPED ,g_xrde3_d[l_ac].xrde049_desc
            DISPLAY g_xrde3_d[l_ac].xrde049_desc TO s_detail3[l_ac].xrde049_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde049_desc
            #add-point:ON CHANGE xrde049_desc name="input.g.page3.xrde049_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde050
            #add-point:BEFORE FIELD xrde050 name="input.b.page3.xrde050"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde050
            
            #add-point:AFTER FIELD xrde050 name="input.a.page3.xrde050"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde050
            #add-point:ON CHANGE xrde050 name="input.g.page3.xrde050"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde050_desc
            #add-point:BEFORE FIELD xrde050_desc name="input.b.page3.xrde050_desc"
            LET g_xrde3_d[l_ac].xrde050_desc = g_xrde3_d[l_ac].xrde050
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0251
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0251
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde050_desc
            
            #add-point:AFTER FIELD xrde050_desc name="input.a.page3.xrde050_desc"
            LET g_xrde3_d[l_ac].xrde050 = g_xrde3_d[l_ac].xrde050_desc
            DISPLAY '' TO xrde050_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde050) THEN
               CALL axrt400_free_account_chk(g_glad0251,g_xrde3_d[l_ac].xrde050,g_glad0252) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde050
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde050 = g_xrde3_d_t.xrde050
                  LET g_xrde3_d[l_ac].xrde050_desc = g_xrde3_d_t.xrde050_desc
                  DISPLAY g_xrde3_d[l_ac].xrde050_desc TO s_detail3[l_ac].xrde050_desc
                  NEXT FIELD xrde050_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0251,g_xrde3_d[l_ac].xrde050) RETURNING g_xrde3_d[l_ac].xrde050_desc
            LET g_xrde3_d[l_ac].xrde050_desc = g_xrde3_d[l_ac].xrde050 CLIPPED ,g_xrde3_d[l_ac].xrde050_desc
            DISPLAY g_xrde3_d[l_ac].xrde050_desc TO s_detail3[l_ac].xrde050_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde050_desc
            #add-point:ON CHANGE xrde050_desc name="input.g.page3.xrde050_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde051
            #add-point:BEFORE FIELD xrde051 name="input.b.page3.xrde051"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde051
            
            #add-point:AFTER FIELD xrde051 name="input.a.page3.xrde051"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde051
            #add-point:ON CHANGE xrde051 name="input.g.page3.xrde051"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrde051_desc
            #add-point:BEFORE FIELD xrde051_desc name="input.b.page3.xrde051_desc"
            LET g_xrde3_d[l_ac].xrde051_desc = g_xrde3_d[l_ac].xrde051
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0261
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0261
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrde051_desc
            
            #add-point:AFTER FIELD xrde051_desc name="input.a.page3.xrde051_desc"
            LET g_xrde3_d[l_ac].xrde051 = g_xrde3_d[l_ac].xrde051_desc
            DISPLAY '' TO xrde051_desc
            IF NOT cl_null(g_xrde3_d[l_ac].xrde051) THEN
               CALL axrt400_free_account_chk(g_glad0261,g_xrde3_d[l_ac].xrde051,g_glad0262) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde3_d[l_ac].xrde051
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde3_d[l_ac].xrde051 = g_xrde3_d_t.xrde051
                  LET g_xrde3_d[l_ac].xrde051_desc = g_xrde3_d_t.xrde051_desc
                  DISPLAY g_xrde3_d[l_ac].xrde051_desc TO s_detail3[l_ac].xrde051_desc
                  NEXT FIELD xrde051_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0261,g_xrde3_d[l_ac].xrde051) RETURNING g_xrde3_d[l_ac].xrde051_desc
            LET g_xrde3_d[l_ac].xrde051_desc = g_xrde3_d[l_ac].xrde051 CLIPPED ,g_xrde3_d[l_ac].xrde051_desc
            DISPLAY g_xrde3_d[l_ac].xrde051_desc TO s_detail3[l_ac].xrde051_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrde051_desc
            #add-point:ON CHANGE xrde051_desc name="input.g.page3.xrde051_desc"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page3.xrde017
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde017
            #add-point:ON ACTION controlp INFIELD xrde017 name="input.c.page3.xrde017"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde017_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde017_desc
            #add-point:ON ACTION controlp INFIELD xrde017_desc name="input.c.page3.xrde017_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde017             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_ooag001_8()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde017 = g_qryparam.return1              
            CALL axrt400_xrde017_desc(g_xrde3_d[l_ac].xrde017) RETURNING g_xrde3_d[l_ac].xrde017_desc
            LET g_xrde3_d[l_ac].xrde017_desc = g_xrde3_d[l_ac].xrde017 CLIPPED,g_xrde3_d[l_ac].xrde017_desc
            DISPLAY g_xrde3_d[l_ac].xrde017_desc TO xrde017_desc              #

            NEXT FIELD xrde017_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde018
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde018
            #add-point:ON ACTION controlp INFIELD xrde018 name="input.c.page3.xrde018"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde018_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde018_desc
            #add-point:ON ACTION controlp INFIELD xrde018_desc name="input.c.page3.xrde018_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde018             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_xrda_m.xrdadocdt

            
            CALL q_ooeg001_4()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde018 = g_qryparam.return1              
            CALL axrt400_xrde018_desc(g_xrde3_d[l_ac].xrde018) RETURNING g_xrde3_d[l_ac].xrde018_desc
            LET g_xrde3_d[l_ac].xrde018_desc = g_xrde3_d[l_ac].xrde018 CLIPPED,g_xrde3_d[l_ac].xrde018_desc
            DISPLAY g_xrde3_d[l_ac].xrde018_desc TO xrde018_desc              #

            NEXT FIELD xrde018_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde019
            #add-point:ON ACTION controlp INFIELD xrde019 name="input.c.page3.xrde019"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde019_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde019_desc
            #add-point:ON ACTION controlp INFIELD xrde019_desc name="input.c.page3.xrde019_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde019             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_today

            
            CALL q_ooeg001_10()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde019 = g_qryparam.return1              
            CALL axrt400_xrde018_desc(g_xrde3_d[l_ac].xrde019) RETURNING g_xrde3_d[l_ac].xrde019_desc
            LET g_xrde3_d[l_ac].xrde019_desc = g_xrde3_d[l_ac].xrde019 CLIPPED,g_xrde3_d[l_ac].xrde019_desc
            DISPLAY g_xrde3_d[l_ac].xrde019_desc TO xrde019_desc              #

            NEXT FIELD xrde019_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde035
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde035
            #add-point:ON ACTION controlp INFIELD xrde035 name="input.c.page3.xrde035"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde035_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde035_desc
            #add-point:ON ACTION controlp INFIELD xrde035_desc name="input.c.page3.xrde035_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde035             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_oocq002_287()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde035 = g_qryparam.return1              
            CALL axrt400_xrde035_desc('287',g_xrde3_d[l_ac].xrde035) RETURNING g_xrde3_d[l_ac].xrde035_desc
            LET g_xrde3_d[l_ac].xrde035_desc = g_xrde3_d[l_ac].xrde035 CLIPPED,g_xrde3_d[l_ac].xrde035_desc
            DISPLAY g_xrde3_d[l_ac].xrde035_desc TO xrde035_desc              #

            NEXT FIELD xrde035_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde036
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde036
            #add-point:ON ACTION controlp INFIELD xrde036 name="input.c.page3.xrde036"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde036_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde036_desc
            #add-point:ON ACTION controlp INFIELD xrde036_desc name="input.c.page3.xrde036_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde036             #給予default值

            #給予arg
            LET g_qryparam.arg1 = '281'

            
            CALL q_oocq002_281()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde036 = g_qryparam.return1              
            CALL axrt400_xrde035_desc('281',g_xrde3_d[l_ac].xrde036) RETURNING g_xrde3_d[l_ac].xrde036_desc
            LET g_xrde3_d[l_ac].xrde036_desc = g_xrde3_d[l_ac].xrde036 CLIPPED,g_xrde3_d[l_ac].xrde036_desc
            DISPLAY g_xrde3_d[l_ac].xrde036_desc TO xrde036_desc              #

            NEXT FIELD xrde036_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde020
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde020
            #add-point:ON ACTION controlp INFIELD xrde020 name="input.c.page3.xrde020"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde020_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde020_desc
            #add-point:ON ACTION controlp INFIELD xrde020_desc name="input.c.page3.xrde020_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde020             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_rtax001()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde020 = g_qryparam.return1              
            CALL axrt400_xrde020_desc(g_xrde3_d[l_ac].xrde020) RETURNING g_xrde3_d[l_ac].xrde020_desc
            LET g_xrde3_d[l_ac].xrde020_desc = g_xrde3_d[l_ac].xrde020 CLIPPED,g_xrde3_d[l_ac].xrde020_desc
            DISPLAY g_xrde3_d[l_ac].xrde020_desc TO xrde020_desc              #

            NEXT FIELD xrde020_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde022
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde022
            #add-point:ON ACTION controlp INFIELD xrde022 name="input.c.page3.xrde022"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde022_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde022_desc
            #add-point:ON ACTION controlp INFIELD xrde022_desc name="input.c.page3.xrde022_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde022             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_pjba001()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde022 = g_qryparam.return1              
            CALL axrt400_xrde022_desc(g_xrde3_d[l_ac].xrde022) RETURNING g_xrde3_d[l_ac].xrde022_desc
            LET g_xrde3_d[l_ac].xrde022_desc = g_xrde3_d[l_ac].xrde022 CLIPPED,g_xrde3_d[l_ac].xrde022_desc
            DISPLAY g_xrde3_d[l_ac].xrde022_desc TO xrde022_desc              #

            NEXT FIELD xrde022_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde023
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde023
            #add-point:ON ACTION controlp INFIELD xrde023 name="input.c.page3.xrde023"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde023_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde023_desc
            #add-point:ON ACTION controlp INFIELD xrde023_desc name="input.c.page3.xrde023_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde023             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_xrde3_d[l_ac].xrde022

            
            CALL q_pjbb002_2()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde023 = g_qryparam.return1              
            CALL axrt400_xrde023_desc(g_xrde3_d[l_ac].xrde022,g_xrde3_d[l_ac].xrde023) RETURNING g_xrde3_d[l_ac].xrde023_desc
            LET g_xrde3_d[l_ac].xrde023_desc = g_xrde3_d[l_ac].xrde023 CLIPPED,g_xrde3_d[l_ac].xrde023_desc
            DISPLAY g_xrde3_d[l_ac].xrde023_desc TO xrde023_desc              #

            NEXT FIELD xrde023_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde039
            #add-point:ON ACTION controlp INFIELD xrde039 name="input.c.page3.xrde039"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde040
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde040
            #add-point:ON ACTION controlp INFIELD xrde040 name="input.c.page3.xrde040"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde040_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde040_desc
            #add-point:ON ACTION controlp INFIELD xrde040_desc name="input.c.page3.xrde040_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde040             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_oojd001_2()                                #呼叫開窗

            LET g_xrde3_d[l_ac].xrde040 = g_qryparam.return1              
            CALL axrt400_xrde040_desc(g_xrde3_d[l_ac].xrde040) RETURNING g_xrde3_d[l_ac].xrde040_desc
            LET g_xrde3_d[l_ac].xrde040_desc = g_xrde3_d[l_ac].xrde040 CLIPPED,g_xrde3_d[l_ac].xrde040_desc
            DISPLAY g_xrde3_d[l_ac].xrde040_desc TO xrde040_desc              #

            NEXT FIELD xrde040_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde042
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde042
            #add-point:ON ACTION controlp INFIELD xrde042 name="input.c.page3.xrde042"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde042_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde042_desc
            #add-point:ON ACTION controlp INFIELD xrde042_desc name="input.c.page3.xrde042_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde042             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0171,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde042 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0171,g_xrde3_d[l_ac].xrde042) RETURNING g_xrde3_d[l_ac].xrde042_desc
               LET g_xrde3_d[l_ac].xrde042_desc = g_xrde3_d[l_ac].xrde042 CLIPPED ,g_xrde3_d[l_ac].xrde042_desc
               DISPLAY g_xrde3_d[l_ac].xrde042_desc TO s_detail3[l_ac].xrde042_desc    #說明
               NEXT FIELD xrde042_desc                          #返回原欄位
            END IF 
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde043
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde043
            #add-point:ON ACTION controlp INFIELD xrde043 name="input.c.page3.xrde043"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde043_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde043_desc
            #add-point:ON ACTION controlp INFIELD xrde043_desc name="input.c.page3.xrde043_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde043             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0181,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde043 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0181,g_xrde3_d[l_ac].xrde043) RETURNING g_xrde3_d[l_ac].xrde043_desc
               LET g_xrde3_d[l_ac].xrde043_desc = g_xrde3_d[l_ac].xrde043 CLIPPED ,g_xrde3_d[l_ac].xrde043_desc
               DISPLAY g_xrde3_d[l_ac].xrde043_desc TO s_detail3[l_ac].xrde043_desc    #說明
               NEXT FIELD xrde043_desc                          #返回原欄位
            END IF 
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde044
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde044
            #add-point:ON ACTION controlp INFIELD xrde044 name="input.c.page3.xrde044"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde044_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde044_desc
            #add-point:ON ACTION controlp INFIELD xrde044_desc name="input.c.page3.xrde044_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde044             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0191,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde044 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0191,g_xrde3_d[l_ac].xrde044) RETURNING g_xrde3_d[l_ac].xrde044_desc
               LET g_xrde3_d[l_ac].xrde044_desc = g_xrde3_d[l_ac].xrde044 CLIPPED ,g_xrde3_d[l_ac].xrde044_desc
               DISPLAY g_xrde3_d[l_ac].xrde044_desc TO s_detail3[l_ac].xrde044_desc    #說明
               NEXT FIELD xrde044_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde045
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde045
            #add-point:ON ACTION controlp INFIELD xrde045 name="input.c.page3.xrde045"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde045_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde045_desc
            #add-point:ON ACTION controlp INFIELD xrde045_desc name="input.c.page3.xrde045_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde045             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0201,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde045 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0201,g_xrde3_d[l_ac].xrde045) RETURNING g_xrde3_d[l_ac].xrde045_desc
               LET g_xrde3_d[l_ac].xrde045_desc = g_xrde3_d[l_ac].xrde045 CLIPPED ,g_xrde3_d[l_ac].xrde045_desc
               DISPLAY g_xrde3_d[l_ac].xrde045_desc TO s_detail3[l_ac].xrde045_desc    #說明
               NEXT FIELD xrde045_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde046
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde046
            #add-point:ON ACTION controlp INFIELD xrde046 name="input.c.page3.xrde046"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde046_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde046_desc
            #add-point:ON ACTION controlp INFIELD xrde046_desc name="input.c.page3.xrde046_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde046             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0211,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde046 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0211,g_xrde3_d[l_ac].xrde046) RETURNING g_xrde3_d[l_ac].xrde046_desc
               LET g_xrde3_d[l_ac].xrde046_desc = g_xrde3_d[l_ac].xrde046 CLIPPED ,g_xrde3_d[l_ac].xrde046_desc
               DISPLAY g_xrde3_d[l_ac].xrde046_desc TO s_detail3[l_ac].xrde046_desc    #說明
               NEXT FIELD xrde046_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde047
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde047
            #add-point:ON ACTION controlp INFIELD xrde047 name="input.c.page3.xrde047"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde047_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde047_desc
            #add-point:ON ACTION controlp INFIELD xrde047_desc name="input.c.page3.xrde047_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde047             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0221,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde047 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0221,g_xrde3_d[l_ac].xrde047) RETURNING g_xrde3_d[l_ac].xrde047_desc
               LET g_xrde3_d[l_ac].xrde047_desc = g_xrde3_d[l_ac].xrde047 CLIPPED ,g_xrde3_d[l_ac].xrde047_desc
               DISPLAY g_xrde3_d[l_ac].xrde047_desc TO s_detail3[l_ac].xrde047_desc    #說明
               NEXT FIELD xrde047_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde048
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde048
            #add-point:ON ACTION controlp INFIELD xrde048 name="input.c.page3.xrde048"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde048_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde048_desc
            #add-point:ON ACTION controlp INFIELD xrde048_desc name="input.c.page3.xrde048_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde048             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0231,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde048 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0231,g_xrde3_d[l_ac].xrde048) RETURNING g_xrde3_d[l_ac].xrde048_desc
               LET g_xrde3_d[l_ac].xrde048_desc = g_xrde3_d[l_ac].xrde048 CLIPPED ,g_xrde3_d[l_ac].xrde048_desc
               DISPLAY g_xrde3_d[l_ac].xrde048_desc TO s_detail3[l_ac].xrde048_desc    #說明
               NEXT FIELD xrde048_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde049
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde049
            #add-point:ON ACTION controlp INFIELD xrde049 name="input.c.page3.xrde049"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde049_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde049_desc
            #add-point:ON ACTION controlp INFIELD xrde049_desc name="input.c.page3.xrde049_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde049             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0241,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde049 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0241,g_xrde3_d[l_ac].xrde049) RETURNING g_xrde3_d[l_ac].xrde049_desc
               LET g_xrde3_d[l_ac].xrde049_desc = g_xrde3_d[l_ac].xrde049 CLIPPED ,g_xrde3_d[l_ac].xrde049_desc
               DISPLAY g_xrde3_d[l_ac].xrde049_desc TO s_detail3[l_ac].xrde049_desc    #說明
               NEXT FIELD xrde049_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde050
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde050
            #add-point:ON ACTION controlp INFIELD xrde050 name="input.c.page3.xrde050"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde050_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde050_desc
            #add-point:ON ACTION controlp INFIELD xrde050_desc name="input.c.page3.xrde050_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde050             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0251,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde050 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0251,g_xrde3_d[l_ac].xrde050) RETURNING g_xrde3_d[l_ac].xrde050_desc
               LET g_xrde3_d[l_ac].xrde050_desc = g_xrde3_d[l_ac].xrde050 CLIPPED ,g_xrde3_d[l_ac].xrde050_desc
               DISPLAY g_xrde3_d[l_ac].xrde050_desc TO s_detail3[l_ac].xrde050_desc    #說明
               NEXT FIELD xrde050_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde051
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde051
            #add-point:ON ACTION controlp INFIELD xrde051 name="input.c.page3.xrde051"
            
            #END add-point
 
 
         #Ctrlp:input.c.page3.xrde051_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrde051_desc
            #add-point:ON ACTION controlp INFIELD xrde051_desc name="input.c.page3.xrde051_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde3_d[l_ac].xrde051             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0261,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde3_d[l_ac].xrde051 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0261,g_xrde3_d[l_ac].xrde051) RETURNING g_xrde3_d[l_ac].xrde051_desc
               LET g_xrde3_d[l_ac].xrde051_desc = g_xrde3_d[l_ac].xrde051 CLIPPED ,g_xrde3_d[l_ac].xrde051_desc
               DISPLAY g_xrde3_d[l_ac].xrde051_desc TO s_detail3[l_ac].xrde051_desc    #說明
               NEXT FIELD xrde051_desc                          #返回原欄位
            END IF
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page3 after_row name="input.body3.after_row"
            
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xrde3_d[l_ac].* = g_xrde3_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL axrt400_unlock_b("xrde_t","'3'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page3 after_row2 name="input.body3.after_row2"
            
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body3.after_input"
            
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xrde_d[li_reproduce_target].* = g_xrde_d[li_reproduce].*
               LET g_xrde2_d[li_reproduce_target].* = g_xrde2_d[li_reproduce].*
               LET g_xrde3_d[li_reproduce_target].* = g_xrde3_d[li_reproduce].*
 
               LET g_xrde3_d[li_reproduce_target].xrdeseq = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_xrde3_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xrde3_d.getLength()+1
            END IF
            
      END INPUT
      INPUT ARRAY g_xrde4_d FROM s_detail4.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = l_allow_insert, #此頁面insert功能由產生器控制, 手動之設定無效! 
 
                 DELETE ROW = l_allow_delete,
                 APPEND ROW = l_allow_insert)
                 
         #自訂ACTION(detail_input,page_4)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body4.before_input2"
            
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_xrde4_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL axrt400_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_xrde4_d.getLength()
            #add-point:資料輸入前 name="input.body4.before_input"
            
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xrde4_d[l_ac].* TO NULL 
            INITIALIZE g_xrde4_d_t.* TO NULL 
            INITIALIZE g_xrde4_d_o.* TO NULL 
            #公用欄位給值(單身4)
            
            #自定義預設值(單身4)
                  LET g_xrde4_d[l_ac].xrcc108 = "0"
      LET g_xrde4_d[l_ac].xrcc118 = "0"
 
            #add-point:modify段before備份 name="input.body4.insert.before_bak"
            
            #end add-point
            LET g_xrde4_d_t.* = g_xrde4_d[l_ac].*     #新輸入資料
            LET g_xrde4_d_o.* = g_xrde4_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL axrt400_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body4.insert.after_set_entry_b"
            
            #end add-point
            CALL axrt400_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xrde4_d[li_reproduce_target].* = g_xrde4_d[li_reproduce].*
               LET g_xrde5_d[li_reproduce_target].* = g_xrde5_d[li_reproduce].*
               LET g_xrde6_d[li_reproduce_target].* = g_xrde6_d[li_reproduce].*
 
               LET g_xrde4_d[li_reproduce_target].xrceseq = NULL
            END IF
            
 
 
 
            #add-point:modify段before insert name="input.body4.before_insert"
            IF cl_null(g_xrde4_d[l_ac].xrceseq) THEN
               SELECT MAX(xrceseq) INTO g_xrde4_d[g_detail_idx].xrceseq
                 FROM xrce_t
                WHERE xrceent = g_enterprise 
                  AND xrceld = g_xrda_m.xrdald
                  AND xrcedocno = g_xrda_m.xrdadocno
               IF cl_null(g_xrde4_d[g_detail_idx].xrceseq) THEN
                  LET g_xrde4_d[g_detail_idx].xrceseq = 1
               ELSE
                  LET g_xrde4_d[g_detail_idx].xrceseq = g_xrde4_d[g_detail_idx].xrceseq +1
               END IF
            END IF
            LET g_xrde4_d[l_ac].xrce015 = 'D'
            CALL axrt400_xrce015_desc(g_xrde4_d[l_ac].xrce015) RETURNING g_xrde4_d[l_ac].xrce015_desc
            DISPLAY g_xrde4_d[l_ac].xrce015_desc TO s_detail4[l_ac].xrce015_desc
            LET g_xrde4_d[l_ac].xrce001 = 'axrt400'
            LET g_xrde4_d[l_ac].xrce002 = '30'
            CALL axrt400_set_no_entry_b(l_cmd)   #150812-00010#2
            LET g_xrde4_d[l_ac].xrcecomp = g_xrda_m.xrdacomp
            LET g_xrde4_d[l_ac].xrcesite = g_xrda_m.xrdasite
            IF cl_null(g_xrde4_d[l_ac].xrceorga) THEN 
               LET g_xrde4_d[l_ac].xrceorga = g_xrda_m.xrdacomp
            END IF
            
            IF l_ac = 1 THEN 
               SELECT MAX(xrdeseq) INTO l_xrdeseq
                 FROM xrde_t
                WHERE xrdeent = g_enterprise
                  AND xrdeld = g_xrda_m.xrdald
                  AND xrdedocno = g_xrda_m.xrdadocno
                  AND xrde010 IS NOT NULL
                  
               SELECT xrde010 INTO l_xrde010
                 FROM xrde_t
                WHERE xrdeent = g_enterprise
                  AND xrdeld = g_xrda_m.xrdald
                  AND xrdedocno = g_xrda_m.xrdadocno
                  AND xrdeseq = l_xrdeseq
                  
               LET g_xrde4_d[l_ac].xrce010 = l_xrde010
            END IF
            
            IF l_ac > 1 THEN 
               LET g_xrde4_d[l_ac].xrce010 = g_xrde4_d[l_ac-1].xrce010
            END IF
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body4.before_row2"
            LET g_aw = 's_detail4'
            LET l_xrde_flag = 'N' 
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[4] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 4
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN axrt400_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CLOSE axrt400_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xrde4_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xrde4_d[l_ac].xrceseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_xrde4_d_t.* = g_xrde4_d[l_ac].*  #BACKUP
               LET g_xrde4_d_o.* = g_xrde4_d[l_ac].*  #BACKUP
               CALL axrt400_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body4.after_set_entry_b"
               
               #end add-point  
               CALL axrt400_set_no_entry_b(l_cmd)
               IF NOT axrt400_lock_b("xrce_t","'4'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH axrt400_bcl2 INTO g_xrde4_d[l_ac].xrceseq,g_xrde4_d[l_ac].xrce002,g_xrde4_d[l_ac].xrce003, 
                      g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005,g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrce010, 
                      g_xrde4_d[l_ac].xrce016,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce101,g_xrde4_d[l_ac].xrce109, 
                      g_xrde4_d[l_ac].xrce119,g_xrde4_d[l_ac].xrce001,g_xrde4_d[l_ac].xrcecomp,g_xrde4_d[l_ac].xrcesite, 
                      g_xrde4_d[l_ac].xrceorga,g_xrde4_d[l_ac].xrce027,g_xrde4_d[l_ac].xrce015,g_xrde5_d[l_ac].xrceseq, 
                      g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce129,g_xrde5_d[l_ac].xrce130, 
                      g_xrde5_d[l_ac].xrce131,g_xrde5_d[l_ac].xrce139,g_xrde6_d[l_ac].xrceseq,g_xrde6_d[l_ac].xrce017, 
                      g_xrde6_d[l_ac].xrce018,g_xrde6_d[l_ac].xrce019,g_xrde6_d[l_ac].xrce035,g_xrde6_d[l_ac].xrce036, 
                      g_xrde6_d[l_ac].xrce020,g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023,g_xrde6_d[l_ac].xrce039, 
                      g_xrde6_d[l_ac].xrce040,g_xrde6_d[l_ac].xrce042,g_xrde6_d[l_ac].xrce043,g_xrde6_d[l_ac].xrce044, 
                      g_xrde6_d[l_ac].xrce045,g_xrde6_d[l_ac].xrce046,g_xrde6_d[l_ac].xrce047,g_xrde6_d[l_ac].xrce048, 
                      g_xrde6_d[l_ac].xrce049,g_xrde6_d[l_ac].xrce050,g_xrde6_d[l_ac].xrce051
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xrde4_d_mask_o[l_ac].* =  g_xrde4_d[l_ac].*
                  CALL axrt400_xrce_t_mask()
                  LET g_xrde4_d_mask_n[l_ac].* =  g_xrde4_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL axrt400_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body4.before_row"
            IF l_ac > 1 AND cl_null(g_xrde4_d[l_ac].xrce010) THEN 
               LET g_xrde4_d[l_ac].xrce010 = g_xrde4_d[l_ac-1].xrce010
            END IF

            #160607-00015#3 Add  ---(S)---
            IF l_cmd = 'u' THEN
               LET l_isbbdocno = ''
               CALL axrt400_source_chk('2',g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce005) RETURNING l_isbbdocno
               IF NOT cl_null(l_isbbdocno) THEN
                  CALL cl_set_comp_entry('xrce109,xrce119',FALSE)
               ELSE
                  CALL cl_set_comp_entry('xrce109,xrce119',TRUE)
               END IF
            END IF
            #160607-00015#3 Add  ---(S)---
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
 
 
            #其他table進行lock
            
 
 
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body4.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body4.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身4刪除前 name="input.body4.b_delete"
               
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xrda_m.xrdald
               LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
               LET gs_keys[gs_keys.getLength()+1] = g_xrde4_d_t.xrceseq
            
               #刪除同層單身
               IF NOT axrt400_delete_b('xrce_t',gs_keys,"'4'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT axrt400_key_delete_b(gs_keys,'xrce_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
 
 
               
               #add-point:單身4刪除中 name="input.body4.m_delete"
               #160607-00015#3 Add  ---(S)---
               LET l_isbbdocno = ''
               CALL axrt400_source_chk('2',g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce005) RETURNING l_isbbdocno
               IF NOT cl_null(l_isbbdocno) THEN
                  CALL axrt400_del_all('2',l_isbbdocno) RETURNING l_success
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                     CLOSE axrt400_bcl
                     CANCEL DELETE
                  ELSE
                     LET g_aw = "s_detail4"
                     LET l_flag = 'Y'
                     CALL s_transaction_end('Y','0')
                     CLOSE axrt400_bcl
                     EXIT DIALOG
                  END IF
               END IF
               #160607-00015#3 Add  ---(S)---
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE axrt400_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身4刪除後 name="input.body4.a_delete"
               
               #end add-point
               LET l_count = g_xrde_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body4.after_delete"
               
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xrde4_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身4新增前 name="input.body4.b_a_insert"
            #150812-00010#3 --s
            IF cl_null(g_xrde5_d[l_ac].xrce129) THEN LET g_xrde5_d[l_ac].xrce129 = 0 END IF
            IF cl_null(g_xrde5_d[l_ac].xrce139) THEN LET g_xrde5_d[l_ac].xrce139 = 0 END IF
            IF g_xrde4_d[l_ac].xrce109 = 0 AND g_xrde4_d[l_ac].xrce119 = 0 AND
               g_xrde5_d[l_ac].xrce129 = 0 AND g_xrde5_d[l_ac].xrce139 = 0 THEN
               CANCEL INSERT
            END IF
            #150812-00010#3 --e
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xrce_t 
             WHERE xrceent = g_enterprise AND xrceld = g_xrda_m.xrdald
               AND xrcedocno = g_xrda_m.xrdadocno
               AND xrceseq = g_xrde4_d[l_ac].xrceseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身4新增前 name="input.body4.b_insert"
               
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys[3] = g_xrde4_d[g_detail_idx].xrceseq
               CALL axrt400_insert_b('xrce_t',gs_keys,"'4'")
                           
               #add-point:單身新增後4 name="input.body4.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_xrde_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL axrt400_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body4.after_insert"
               
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xrde4_d[l_ac].* = g_xrde4_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_xrde4_d[l_ac].* = g_xrde4_d_t.*
            ELSE
               #add-point:單身page4修改前 name="input.body4.b_update"
               
               #end add-point
               
               #寫入修改者/修改日期資訊(單身4)
               
               
               #將遮罩欄位還原
               CALL axrt400_xrce_t_mask_restore('restore_mask_o')
                              
               UPDATE xrce_t SET (xrceld,xrcedocno,xrceseq,xrce002,xrce003,xrce004,xrce005,xrce054,xrce010, 
                   xrce016,xrce100,xrce101,xrce109,xrce119,xrce001,xrcecomp,xrcesite,xrceorga,xrce027, 
                   xrce015,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139,xrce017,xrce018,xrce019,xrce035, 
                   xrce036,xrce020,xrce022,xrce023,xrce039,xrce040,xrce042,xrce043,xrce044,xrce045,xrce046, 
                   xrce047,xrce048,xrce049,xrce050,xrce051) = (g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrde4_d[l_ac].xrceseq, 
                   g_xrde4_d[l_ac].xrce002,g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005, 
                   g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrce010,g_xrde4_d[l_ac].xrce016,g_xrde4_d[l_ac].xrce100, 
                   g_xrde4_d[l_ac].xrce101,g_xrde4_d[l_ac].xrce109,g_xrde4_d[l_ac].xrce119,g_xrde4_d[l_ac].xrce001, 
                   g_xrde4_d[l_ac].xrcecomp,g_xrde4_d[l_ac].xrcesite,g_xrde4_d[l_ac].xrceorga,g_xrde4_d[l_ac].xrce027, 
                   g_xrde4_d[l_ac].xrce015,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce129, 
                   g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce131,g_xrde5_d[l_ac].xrce139,g_xrde6_d[l_ac].xrce017, 
                   g_xrde6_d[l_ac].xrce018,g_xrde6_d[l_ac].xrce019,g_xrde6_d[l_ac].xrce035,g_xrde6_d[l_ac].xrce036, 
                   g_xrde6_d[l_ac].xrce020,g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023,g_xrde6_d[l_ac].xrce039, 
                   g_xrde6_d[l_ac].xrce040,g_xrde6_d[l_ac].xrce042,g_xrde6_d[l_ac].xrce043,g_xrde6_d[l_ac].xrce044, 
                   g_xrde6_d[l_ac].xrce045,g_xrde6_d[l_ac].xrce046,g_xrde6_d[l_ac].xrce047,g_xrde6_d[l_ac].xrce048, 
                   g_xrde6_d[l_ac].xrce049,g_xrde6_d[l_ac].xrce050,g_xrde6_d[l_ac].xrce051) #自訂欄位頁簽 
 
                WHERE xrceent = g_enterprise AND xrceld = g_xrda_m.xrdald
                  AND xrcedocno = g_xrda_m.xrdadocno
                  AND xrceseq = g_xrde4_d_t.xrceseq #項次 
                  
               #add-point:單身page4修改中 name="input.body4.m_update"
               
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xrde4_d[l_ac].* = g_xrde4_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrce_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.sqlcode #其他錯誤
                     LET g_xrde4_d[l_ac].* = g_xrde4_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys_bak[1] = g_xrdald_t
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys_bak[2] = g_xrdadocno_t
               LET gs_keys[3] = g_xrde4_d[g_detail_idx].xrceseq
               LET gs_keys_bak[3] = g_xrde4_d_t.xrceseq
               CALL axrt400_update_b('xrce_t',gs_keys,gs_keys_bak,"'4'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL axrt400_xrce_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_xrde4_d[g_detail_idx].xrceseq = g_xrde4_d_t.xrceseq 
                  ) THEN
                  LET gs_keys[01] = g_xrda_m.xrdald
                  LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xrde4_d_t.xrceseq
                  CALL axrt400_key_update_b(gs_keys,'xrce_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde4_d_t)
               LET g_log2 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde4_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page4修改後 name="input.body4.a_update"
               
               #end add-point
            END IF
         
                  #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrceseq
            #應用 a15 樣板自動產生(Version:3)
            #確認欄位值在特定區間內
            IF NOT cl_ap_chk_range(g_xrde4_d[l_ac].xrceseq,"1.000","1","","","azz-00079",1) THEN
               NEXT FIELD xrceseq
            END IF 
 
 
 
            #add-point:AFTER FIELD xrceseq name="input.a.page4.xrceseq"
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_xrda_m.xrdald IS NOT NULL AND g_xrda_m.xrdadocno IS NOT NULL AND g_xrde4_d[g_detail_idx].xrceseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xrda_m.xrdald != g_xrdald_t OR g_xrda_m.xrdadocno != g_xrdadocno_t OR g_xrde4_d[g_detail_idx].xrceseq != g_xrde4_d_t.xrceseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xrce_t WHERE "||"xrceent = '" ||g_enterprise|| "' AND "||"xrceld = '"||g_xrda_m.xrdald ||"' AND "|| "xrcedocno = '"||g_xrda_m.xrdadocno ||"' AND "|| "xrceseq = '"||g_xrde4_d[g_detail_idx].xrceseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            IF NOT cl_null(g_xrde4_d[l_ac].xrceseq) THEN 
            END IF 


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrceseq
            #add-point:BEFORE FIELD xrceseq name="input.b.page4.xrceseq"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrceseq
            #add-point:ON CHANGE xrceseq name="input.g.page4.xrceseq"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce002
            #add-point:BEFORE FIELD xrce002 name="input.b.page4.xrce002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce002
            
            #add-point:AFTER FIELD xrce002 name="input.a.page4.xrce002"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce002
            #add-point:ON CHANGE xrce002 name="input.g.page4.xrce002"
            SELECT gzcb003 INTO g_xrde4_d[l_ac].xrce015
              FROM gzcb_t
             WHERE gzcb001 = '8306'
               AND gzcb002 = g_xrde4_d[l_ac].xrce002
               
            CALL axrt400_xrce015_desc(g_xrde4_d[l_ac].xrce015) RETURNING g_xrde4_d[l_ac].xrce015_desc
            DISPLAY g_xrde4_d[l_ac].xrce015_desc TO s_detail4[l_ac].xrce015_desc
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce003
            #add-point:BEFORE FIELD xrce003 name="input.b.page4.xrce003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce003
            
            #add-point:AFTER FIELD xrce003 name="input.a.page4.xrce003"
           #IF NOT cl_null(g_xrde4_d[l_ac].xrce003) THEN   #160607-00015#3 Mark
            IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce003 != g_xrde4_d_t.xrce003 OR g_xrde4_d_t.xrce003 IS NULL)) THEN   #160607-00015#3 Add
               IF g_xrde4_d[l_ac].xrce002 = '30' OR g_xrde4_d[l_ac].xrce002 = '31' OR g_xrde4_d[l_ac].xrce002 = '32' THEN
                  SELECT xrcastus,xrca060 INTO l_xrcastus,l_xrca060 FROM xrca_t #160628-00002#1 add xrca060
                   WHERE xrcaent = g_enterprise
                     AND xrcald = g_xrda_m.xrdald
                     AND xrcadocno = g_xrde4_d[l_ac].xrce003
                  LET g_errno = " "
                  CASE
                     WHEN SQLCA.SQLCODE = 100
                        LET g_errno = 'axr-00064'
                     WHEN l_xrcastus != 'Y'
                        LET g_errno = 'axr-00065'
                     #160628-00002#1--add--str--
                     WHEN (g_xrde4_d[l_ac].xrce002 = '31' OR g_xrde4_d[l_ac].xrce002 = '32') AND l_xrca060 = '2' 
                        LET g_errno = 'axr-00369'
                     #160628-00002#1--add--end
                  END CASE
               END IF
               
               IF g_xrde4_d[l_ac].xrce002 = '40' OR g_xrde4_d[l_ac].xrce002 = '41' OR g_xrde4_d[l_ac].xrce002 = '42' THEN 
                  SELECT apcastus,apca060 INTO l_apcastus,l_apca060 FROM apca_t #160628-00002#1 add apca060
                   WHERE apcaent = g_enterprise
                     AND apcald = g_xrda_m.xrdald
                     AND apcadocno = g_xrde4_d[l_ac].xrce003
                  LET g_errno = " "
                  CASE
                     WHEN SQLCA.SQLCODE = 100
                        LET g_errno = 'axr-00249'
                     WHEN l_apcastus != 'Y'
                        LET g_errno = 'axr-00250'
                     #160628-00002#1--add--str--
                     WHEN (g_xrde4_d[l_ac].xrce002 = '41' OR g_xrde4_d[l_ac].xrce002 = '42' ) AND l_apca060 = '2'
                        LET g_errno = 'axr-00369'
                     #160628-00002#1--add--end
                  END CASE
               END IF
               
               IF NOT cl_null(g_errno) THEN
                  LET l_xrce003 = g_xrde4_d[l_ac].xrce003
                  IF l_cmd = 'a' THEN
                     LET g_xrde4_d[l_ac].xrce003 = ''
                  ELSE
                     LET g_xrde4_d[l_ac].xrce003 = g_xrde4_d_t.xrce003
                  END IF
                  DISPLAY g_xrde4_d[l_ac].xrce003 TO s_detail3[l_ac].xrce003
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrce003
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrce003
               END IF
               CALL axrt400_chk_xrce003()
               IF NOT cl_null(g_errno) THEN
                  LET l_xrce003 = g_xrde4_d[l_ac].xrce003
                  IF l_cmd = 'a' THEN
                     LET g_xrde4_d[l_ac].xrce003 = ''
                  ELSE
                     LET g_xrde4_d[l_ac].xrce003 = g_xrde4_d_t.xrce003
                  END IF
                  DISPLAY g_xrde4_d[l_ac].xrce003 TO s_detail3[l_ac].xrce003
                  INITIALIZE g_errparam TO NULL
                  #160607-00015#3 Add  ---(S)---
                  IF g_errno = 'axr-00366' THEN
                     LET g_errparam.replace[1] = cl_get_progname('aist340',g_lang,"2")
                     LET g_errparam.replace[2] = cl_get_progname('aisp450',g_lang,"2")
                     LET g_errparam.exeprog = 'aisp450'
                  END IF
                  #160607-00015#3 Add  ---(E)---
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrce003
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrce003
               END IF
               
               IF (l_cmd = 'a' OR (l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce003 != g_xrde4_d_t.xrce003 OR cl_null(g_xrde4_d_t.xrce003)))) 
                   AND NOT cl_null(g_xrde4_d[l_ac].xrce002)
                   AND NOT cl_null(g_xrde4_d[l_ac].xrce004) 
                   AND NOT cl_null(g_xrde4_d[l_ac].xrce005) THEN
                  CALL axrt400_def_xrcc(g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005)
                  CALL axrt400_xrcc_get()
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce003
            #add-point:ON CHANGE xrce003 name="input.g.page4.xrce003"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce004
            #add-point:BEFORE FIELD xrce004 name="input.b.page4.xrce004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce004
            
            #add-point:AFTER FIELD xrce004 name="input.a.page4.xrce004"
           #IF NOT cl_null(g_xrde4_d[l_ac].xrce004) THEN   #160607-00015#3 Mark
            IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce004 != g_xrde4_d_t.xrce004 OR g_xrde4_d_t.xrce004 IS NULL)) THEN   #160607-00015#3 Add
               CALL axrt400_chk_xrce003()
               IF NOT cl_null(g_errno) THEN
                  LET l_xrce004 = g_xrde4_d[l_ac].xrce004
                  IF l_cmd = 'a' THEN
                     LET g_xrde4_d[l_ac].xrce004 = ''
                  ELSE
                     LET g_xrde4_d[l_ac].xrce004 = g_xrde4_d_t.xrce004
                  END IF
                  DISPLAY g_xrde4_d[l_ac].xrce004 TO s_detail3[l_ac].xrce004
                  INITIALIZE g_errparam TO NULL
                  #160607-00015#3 Add  ---(S)---
                  IF g_errno = 'axr-00366' THEN
                     LET g_errparam.replace[1] = cl_get_progname('aist340',g_lang,"2")
                     LET g_errparam.replace[2] = cl_get_progname('aisp450',g_lang,"2")
                     LET g_errparam.exeprog = 'aisp450'
                  END IF
                  #160607-00015#3 Add  ---(E)---
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrce004
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrce004
               END IF
               
               IF (l_cmd = 'a' OR (l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce004 != g_xrde4_d_t.xrce004 OR cl_null(g_xrde4_d_t.xrce004)))) 
                  AND NOT cl_null(g_xrde4_d[l_ac].xrce002) 
                  AND NOT cl_null(g_xrde4_d[l_ac].xrce004) 
                  AND NOT cl_null(g_xrde4_d[l_ac].xrce005) THEN
                  CALL axrt400_def_xrcc(g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005)
                  CALL axrt400_xrcc_get()
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce004
            #add-point:ON CHANGE xrce004 name="input.g.page4.xrce004"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce005
            #add-point:BEFORE FIELD xrce005 name="input.b.page4.xrce005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce005
            
            #add-point:AFTER FIELD xrce005 name="input.a.page4.xrce005"
           #IF NOT cl_null(g_xrde4_d[l_ac].xrce005) THEN   #160607-00015#3 Mark
            IF l_cmd = 'a' OR (l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce005 != g_xrde4_d_t.xrce005 OR g_xrde4_d_t.xrce005 IS NULL)) THEN   #160607-00015#3 Add
               CALL axrt400_chk_xrce003()
               IF NOT cl_null(g_errno) THEN
                  LET l_xrce005 = g_xrde4_d[l_ac].xrce005
                  IF l_cmd = 'a' THEN
                     LET g_xrde4_d[l_ac].xrce005 = ''
                  ELSE
                     LET g_xrde4_d[l_ac].xrce005 = g_xrde4_d_t.xrce005
                  END IF
                  DISPLAY g_xrde4_d[l_ac].xrce005 TO s_detail3[l_ac].xrce005
                  INITIALIZE g_errparam TO NULL
                  #160607-00015#3 Add  ---(S)---
                  IF g_errno = 'axr-00366' THEN
                     LET g_errparam.replace[1] = cl_get_progname('aist340',g_lang,"2")
                     LET g_errparam.replace[2] = cl_get_progname('aisp450',g_lang,"2")
                     LET g_errparam.exeprog = 'aisp450'
                  END IF
                  #160607-00015#3 Add  ---(E)---
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrce005
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrce005
               END IF
               
               IF (l_cmd = 'a' OR (l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce005 != g_xrde4_d_t.xrce005 OR cl_null(g_xrde4_d_t.xrce005)))) 
                  AND NOT cl_null(g_xrde4_d[l_ac].xrce002) 
                  AND NOT cl_null(g_xrde4_d[l_ac].xrce004) 
                  AND NOT cl_null(g_xrde4_d[l_ac].xrce005) THEN
                  CALL axrt400_def_xrcc(g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005)
                  CALL axrt400_xrcc_get()
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce005
            #add-point:ON CHANGE xrce005 name="input.g.page4.xrce005"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce054
            #add-point:BEFORE FIELD xrce054 name="input.b.page4.xrce054"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce054
            
            #add-point:AFTER FIELD xrce054 name="input.a.page4.xrce054"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce054
            #add-point:ON CHANGE xrce054 name="input.g.page4.xrce054"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcc003_1
            #add-point:BEFORE FIELD xrcc003_1 name="input.b.page4.xrcc003_1"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcc003_1
            
            #add-point:AFTER FIELD xrcc003_1 name="input.a.page4.xrcc003_1"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrcc003_1
            #add-point:ON CHANGE xrcc003_1 name="input.g.page4.xrcc003_1"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrca057
            
            #add-point:AFTER FIELD xrca057 name="input.a.page4.xrca057"
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xrde4_d[l_ac].xrca057
            CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa001=? ","") RETURNING g_rtn_fields
            LET g_xrde4_d[l_ac].xrca057_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xrde4_d[l_ac].xrca057_desc


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrca057
            #add-point:BEFORE FIELD xrca057 name="input.b.page4.xrca057"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrca057
            #add-point:ON CHANGE xrca057 name="input.g.page4.xrca057"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce010
            #add-point:BEFORE FIELD xrce010 name="input.b.page4.xrce010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce010
            
            #add-point:AFTER FIELD xrce010 name="input.a.page4.xrce010"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce010
            #add-point:ON CHANGE xrce010 name="input.g.page4.xrce010"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce016
            #add-point:BEFORE FIELD xrce016 name="input.b.page4.xrce016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce016
            
            #add-point:AFTER FIELD xrce016 name="input.a.page4.xrce016"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce016
            #add-point:ON CHANGE xrce016 name="input.g.page4.xrce016"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce016_desc
            #add-point:BEFORE FIELD xrce016_desc name="input.b.page4.xrce016_desc"
            LET g_xrde4_d[l_ac].xrce016_desc = g_xrde4_d[l_ac].xrce016
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce016_desc
            
            #add-point:AFTER FIELD xrce016_desc name="input.a.page4.xrce016_desc"
            LET g_xrde4_d[l_ac].xrce016 = g_xrde4_d[l_ac].xrce016_desc
            CALL axrt400_xrde016_desc(g_xrde4_d[l_ac].xrce016) RETURNING g_xrde4_d[l_ac].xrce016_desc
            LET g_xrde4_d[l_ac].xrce016_desc = g_xrde4_d[l_ac].xrce016 CLIPPED,g_xrde4_d[l_ac].xrce016_desc
            IF NOT cl_null(g_xrde4_d[l_ac].xrce016) THEN 
               # 开窗模糊查询 150916-00015#1 --add                      
               IF s_aglt310_getlike_lc_subject(g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce016,"")  THEN            
                  
                  SELECT glaa004 INTO l_glaa004
                    FROM glaa_t
                   WHERE glaaent = g_enterprise
                     AND glaald  = g_xrda_m.xrdald
                  
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
                  LET g_qryparam.reqry = 'FALSE'
                  LET g_qryparam.default1 = g_xrde4_d[l_ac].xrce016
                                
                  LET g_qryparam.arg1 = l_glaa004
                  LET g_qryparam.arg2 = g_xrde4_d[l_ac].xrce016
                  LET g_qryparam.arg3 = g_xrda_m.xrdald
                  LET g_qryparam.arg4 = " 1"
                  CALL q_glac002_6()
                  LET g_xrde4_d[l_ac].xrce016 = g_qryparam.return1              
                  CALL axrt400_xrde016_desc(g_xrde4_d[l_ac].xrce016) RETURNING g_xrde4_d[l_ac].xrce016_desc
                  LET g_xrde4_d[l_ac].xrce016_desc = g_xrde4_d[l_ac].xrce016 CLIPPED,g_xrde4_d[l_ac].xrce016_desc
                  DISPLAY g_xrde4_d[l_ac].xrce016_desc TO xrce016_desc               
               END IF
               #科目存在性，有效性，非统治科目，非子系统科目，账户科目属性检查
               IF NOT  s_aglt310_lc_subject(g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce016,'N') THEN
                  LET g_xrde4_d[l_ac].xrce016 = g_xrde4_d_t.xrce016
                  LET g_xrde4_d[l_ac].xrce016_desc = g_xrde4_d_t.xrce016_desc
                  NEXT FIELD CURRENT
               ELSE 
                   SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
                         glad019,glad0191,glad0192,glad020,glad0201,glad0202,
                         glad021,glad0211,glad0212,glad022,glad0221,glad0222,
                         glad023,glad0231,glad0232,glad024,glad0221,glad0242,
                         glad025,glad0251,glad0252,glad026,glad0261,glad0262
                   INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
                         g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
                         g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
                         g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
                         g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
                   FROM  glad_t
                   WHERE gladent = g_enterprise
                     AND gladld = g_xrda_m.xrdald
                     AND glad001 = g_xrde4_d[l_ac].xrce016  
               END IF
               # 150916-00015#1 --end                
#               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
#               INITIALIZE g_chkparam.* TO NULL    
#               #設定g_chkparam.*的參數
#               LET g_chkparam.arg1 = g_glaa_t.glaa004
#               LET g_chkparam.arg2 = g_xrde4_d[l_ac].xrce016     
#               #呼叫檢查存在並帶值的library
#               IF cl_chk_exist("v_glac002_4") THEN
#                  #檢查成功時後續處理
#                  #LET  = g_chkparam.return1
#                  #DISPLAY BY NAME 
#                  SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
#                         glad019,glad0191,glad0192,glad020,glad0201,glad0202,
#                         glad021,glad0211,glad0212,glad022,glad0221,glad0222,
#                         glad023,glad0231,glad0232,glad024,glad0221,glad0242,
#                         glad025,glad0251,glad0252,glad026,glad0261,glad0262
#                   INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
#                         g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
#                         g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
#                         g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
#                         g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
#                   FROM  glad_t
#                   WHERE gladent = g_enterprise
#                     AND gladld = g_xrda_m.xrdald
#                     AND glad001 = g_xrde4_d[l_ac].xrce016  
#               ELSE
#                  #檢查失敗時後續處理
#                  LET g_xrde4_d[l_ac].xrce016 = g_xrde4_d_t.xrce016
#                  LET g_xrde4_d[l_ac].xrce016_desc = g_xrde4_d_t.xrce016_desc
#                  NEXT FIELD CURRENT
#               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce016_desc
            #add-point:ON CHANGE xrce016_desc name="input.g.page4.xrce016_desc"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce100
            
            #add-point:AFTER FIELD xrce100 name="input.a.page4.xrce100"
            IF NOT cl_null(g_xrde4_d[l_ac].xrce100) THEN 
#應用 a19 樣板自動產生(Version:2)
               #校驗代值
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde4_d[l_ac].xrce100

               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "aoo-00011:sub-01302|aooi140|",cl_get_progname("aooi140",g_lang,"2"),"|:EXEPROGaooi140"    #160318-00025#13   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooai001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
                 #150518-00044#6--MARK--(S)
                 #                        #匯率參照表;帳套;           日期;          來源幣別
                 #CALL s_aooi160_get_exrate('2',g_glaa_t.glaald,g_xrda_m.xrdadocdt,g_xrde4_d[l_ac].xrce100,
                 #                         #目的幣別;   交易金額;              匯類類型
                 #                          g_glaa_t.glaa001,0,g_glaa_t.glaa025)
                 #RETURNING g_xrde4_d[l_ac].xrce101
                 #150518-00044#6--MARK--(E)
                 #150518-00044#6--
                  LET lc_param.type    = '1'
                  LET lc_param.apca004 = g_xrda_m.xrda005
                  LET ls_js = util.JSON.stringify(lc_param)
                  CALL s_fin_get_curr_rate(g_xrda_m.xrdacomp,g_glaa_t.glaald,g_xrda_m.xrdadocdt,g_xrde4_d[l_ac].xrce100,ls_js)
                       RETURNING g_xrde4_d[l_ac].xrce101,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce131
                  #150518-00044#6--
                  DISPLAY g_xrde4_d[l_ac].xrce101 TO s_detail4[l_ac].xrce101
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde4_d[l_ac].xrce100 = g_xrde4_d_t.xrce100
                  LET g_xrde4_d[l_ac].xrce101 = g_xrde4_d_t.xrce101
                  NEXT FIELD CURRENT
               END IF
            END IF 


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce100
            #add-point:BEFORE FIELD xrce100 name="input.b.page4.xrce100"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce100
            #add-point:ON CHANGE xrce100 name="input.g.page4.xrce100"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce101
            #add-point:BEFORE FIELD xrce101 name="input.b.page4.xrce101"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce101
            
            #add-point:AFTER FIELD xrce101 name="input.a.page4.xrce101"
            IF NOT cl_null(g_xrde4_d[l_ac].xrce101) THEN 
               LET g_xrde4_d[l_ac].xrce119 = g_xrde4_d[l_ac].xrce109 * g_xrde4_d[l_ac].xrce101
              #LET g_xrde4_d[l_ac].xrce119 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2)                                       #150812-00010#2 mark
               CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce119   #150812-00010#2                
               DISPLAY g_xrde4_d[l_ac].xrce119 TO s_detail4[l_ac].xrce119
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce101
            #add-point:ON CHANGE xrce101 name="input.g.page4.xrce101"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcc108
            #add-point:BEFORE FIELD xrcc108 name="input.b.page4.xrcc108"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcc108
            
            #add-point:AFTER FIELD xrcc108 name="input.a.page4.xrcc108"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrcc108
            #add-point:ON CHANGE xrcc108 name="input.g.page4.xrcc108"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcc118
            #add-point:BEFORE FIELD xrcc118 name="input.b.page4.xrcc118"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcc118
            
            #add-point:AFTER FIELD xrcc118 name="input.a.page4.xrcc118"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrcc118
            #add-point:ON CHANGE xrcc118 name="input.g.page4.xrcc118"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce109
            #add-point:BEFORE FIELD xrce109 name="input.b.page4.xrce109"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce109
            
            #add-point:AFTER FIELD xrce109 name="input.a.page4.xrce109"
            #150812-00010#2--s
            IF NOT cl_null(g_xrde4_d[l_ac].xrce109) THEN
               CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce109,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce109
            END IF
            #150812-00010#2--e  
            IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce109 != g_xrde4_d_t.xrce109 )) THEN    #150817-00031#1 add lujh
               IF NOT cl_null(g_xrde4_d[l_ac].xrce101) AND NOT cl_null(g_xrde4_d[l_ac].xrce109) THEN
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce109,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce109    #150812-00010#2                   
                  #150817-00031#1--add--str--lujh
                  LET l_xrce109 = 0
                  LET l_xrce119 = 0
                  SELECT SUM(xrce109),SUM(xrce119) INTO l_xrce109,l_xrce119 FROM xrce_t,xrda_t
                   WHERE xrceent = g_enterprise
                     AND xrceent = xrdaent
                     AND xrceld = xrdald
                     AND xrcedocno = xrdadocno
                     AND xrceld = g_xrda_m.xrdald
                     AND xrce003 = g_xrde4_d[l_ac].xrce003
                     AND xrce004 = g_xrde4_d[l_ac].xrce004
                     AND xrce005 = g_xrde4_d[l_ac].xrce005
                     AND ((xrcedocno = g_xrda_m.xrdadocno
                     AND xrceseq <> g_xrde4_d[l_ac].xrceseq)
                     OR xrcedocno <> g_xrda_m.xrdadocno)
                     AND xrdastus = 'N'
                     
                  IF cl_null(l_xrce109) THEN LET l_xrce109 = 0 END IF
                  IF cl_null(l_xrce119) THEN LET l_xrce119 = 0 END IF
                     
                  LET l_xrcc108 = 0
                  LET l_xrcc118 = 0
                  SELECT xrcc108,xrcc118 INTO l_xrcc108,l_xrcc118 
                    FROM xrcc_t
                   WHERE xrccent = g_enterprise
                     AND xrccld = g_xrda_m.xrdald
                     AND xrccdocno = g_xrde4_d[l_ac].xrce003
                     AND xrccseq = g_xrde4_d[l_ac].xrce004
                     AND xrcc001 = g_xrde4_d[l_ac].xrce005
                     
                  IF cl_null(l_xrcc108) THEN LET l_xrcc108 = 0 END IF
                  IF cl_null(l_xrcc118) THEN LET l_xrcc118 = 0 END IF
                  
                  #如果原币已经冲完,则本币用总的应收金额-已冲账金额来算,不再用原币*汇率来算
                  IF l_xrce109 + g_xrde4_d[l_ac].xrce109 = l_xrcc108 THEN 
                     LET g_xrde4_d[l_ac].xrce119 = l_xrcc118 - l_xrce119
                  ELSE
                  #150817-00031#1--add--end--lujh
                     LET g_xrde4_d[l_ac].xrce119 = g_xrde4_d[l_ac].xrce109 * g_xrde4_d[l_ac].xrce101
                  END IF         #150817-00031#1 add lujh
                 #LET g_xrde4_d[l_ac].xrce119 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2)                                       #150812-00010#2 mark
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce119   #150812-00010#2                   
                  DISPLAY g_xrde4_d[l_ac].xrce119 TO s_detail4[l_ac].xrce119
                  LET g_xrde5_d[l_ac].xrce129 = g_xrde4_d[l_ac].xrce109 * g_xrde5_d[l_ac].xrce121
                  IF NOT cl_null(g_xrde5_d[l_ac].xrce120) THEN 
                    #LET g_xrde5_d[l_ac].xrce129 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,2)                                       #150812-00010#2 mark
                     CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce129,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce129   #150812-00010#2                     
                  END IF
                  LET g_xrde5_d[l_ac].xrce139 = g_xrde4_d[l_ac].xrce109 * g_xrde5_d[l_ac].xrce131
                  IF NOT cl_null(g_xrde5_d[l_ac].xrce130) THEN 
                    #LET g_xrde5_d[l_ac].xrce139 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce131,2)                                       #150812-00010#2 mark
                     CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce139,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce139   #150812-00010#2                     
                  END IF
               END IF
            END IF   #150817-00031#1 add lujh
            
            IF NOT cl_null(g_xrde4_d[l_ac].xrce109) AND NOT cl_null(g_xrde4_d[l_ac].xrce003) THEN
               CALL axrt400_chk_xrce109()
               IF NOT cl_null(g_errno) THEN
                  LET l_xrce109 = g_xrde4_d[l_ac].xrce109
                  IF l_cmd = 'a' THEN
                     LET g_xrde4_d[l_ac].xrce109 = 0
                     LET g_xrde4_d[l_ac].xrce119 = 0     #20150924 add lujh
                  ELSE
                     LET g_xrde4_d[l_ac].xrce109 = g_xrde4_d_t.xrce109
                     LET g_xrde4_d[l_ac].xrce119 = g_xrde4_d_t.xrce119   #20150924 add lujh
                  END IF
                  DISPLAY g_xrde4_d[l_ac].xrce109 TO s_detail4[l_ac].xrce109
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrce109
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD xrce109
               END IF
            END IF
            CALL DIALOG.setFieldTouched("xrce109", TRUE)
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce109
            #add-point:ON CHANGE xrce109 name="input.g.page4.xrce109"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce119
            #add-point:BEFORE FIELD xrce119 name="input.b.page4.xrce119"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce119
            
            #add-point:AFTER FIELD xrce119 name="input.a.page4.xrce119"
            IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xrde4_d[l_ac].xrce119 != g_xrde4_d_t.xrce119 )) THEN    #150817-00031#1 add lujh
               IF NOT cl_null(g_xrde4_d[l_ac].xrce101) AND NOT cl_null(g_xrde4_d[l_ac].xrce119) THEN
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce119   #150812-00010#2                
                  #150817-00031#1--add--str--lujh
                  LET l_xrce109 = 0
                  LET l_xrce119 = 0
                  SELECT SUM(xrce109),SUM(xrce119) INTO l_xrce109,l_xrce119 FROM xrce_t,xrda_t
                   WHERE xrceent = g_enterprise
                     AND xrceent = xrdaent
                     AND xrceld = xrdald
                     AND xrcedocno = xrdadocno
                     AND xrceld = g_xrda_m.xrdald
                     AND xrce003 = g_xrde4_d[l_ac].xrce003
                     AND xrce004 = g_xrde4_d[l_ac].xrce004
                     AND xrce005 = g_xrde4_d[l_ac].xrce005
                     AND ((xrcedocno = g_xrda_m.xrdadocno
                     AND xrceseq <> g_xrde4_d[l_ac].xrceseq)
                     OR xrcedocno <> g_xrda_m.xrdadocno)
                     AND xrdastus = 'N'
                     
                  IF cl_null(l_xrce109) THEN LET l_xrce109 = 0 END IF
                  IF cl_null(l_xrce119) THEN LET l_xrce119 = 0 END IF
                     
                  LET l_xrcc108 = 0
                  LET l_xrcc118 = 0
                  SELECT xrcc108,xrcc118 INTO l_xrcc108,l_xrcc118 
                    FROM xrcc_t
                   WHERE xrccent = g_enterprise
                     AND xrccld = g_xrda_m.xrdald
                     AND xrccdocno = g_xrde4_d[l_ac].xrce003
                     AND xrccseq = g_xrde4_d[l_ac].xrce004
                     AND xrcc001 = g_xrde4_d[l_ac].xrce005
                     
                  IF cl_null(l_xrcc108) THEN LET l_xrcc108 = 0 END IF
                  IF cl_null(l_xrcc118) THEN LET l_xrcc118 = 0 END IF
                  
                  #如果本币已经冲完,则原币用总的应收金额-已冲账金额来算,不再用本币/汇率来算
                  IF l_xrce119 + g_xrde4_d[l_ac].xrce119 = l_xrcc118 THEN 
                     LET g_xrde4_d[l_ac].xrce109 = l_xrcc108 - l_xrce109
                  ELSE
                  #150817-00031#1--add--end--lujh
                     #LET g_xrde4_d[l_ac].xrce109 = g_xrde4_d[l_ac].xrce119 / g_xrde4_d[l_ac].xrce101   #160104-00020#3 mark
                  END IF         #150817-00031#1 add lujh
                 #LET g_xrde4_d[l_ac].xrce119 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2)                                       #150812-00010#2 mark 
                  CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce119   #150812-00010#2                   
                  DISPLAY g_xrde4_d[l_ac].xrce109 TO s_detail4[l_ac].xrce109
                  LET g_xrde5_d[l_ac].xrce129 = g_xrde4_d[l_ac].xrce109 * g_xrde5_d[l_ac].xrce121
                  IF NOT cl_null(g_xrde5_d[l_ac].xrce120) THEN 
                    #LET g_xrde5_d[l_ac].xrce129 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,2)                                       #150812-00010#2 mark
                     CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce129,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce129   #150812-00010#2                     
                  END IF
                  LET g_xrde5_d[l_ac].xrce139 = g_xrde4_d[l_ac].xrce109 * g_xrde5_d[l_ac].xrce131
                  IF NOT cl_null(g_xrde5_d[l_ac].xrce130) THEN 
                     #LET g_xrde5_d[l_ac].xrce139 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce131,2)                                      #150812-00010#2 mark
                     CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce139,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce139   #150812-00010#2                     
                  END IF
               END IF
            END IF        #150817-00031#1 add lujh
            
            IF NOT cl_null(g_xrde4_d[l_ac].xrce109) AND NOT cl_null(g_xrde4_d[l_ac].xrce003) THEN
               CALL axrt400_chk_xrce109()
               IF NOT cl_null(g_errno) THEN
                  LET l_xrce119 = g_xrde4_d[l_ac].xrce119
                  LET g_xrde4_d[l_ac].xrce119 = g_xrde4_d_t.xrce119
                  LET g_xrde4_d[l_ac].xrce109 = g_xrde4_d_t.xrce109
                  DISPLAY g_xrde4_d[l_ac].xrce119 TO s_detail4[l_ac].xrce119
                  DISPLAY g_xrde4_d[l_ac].xrce109 TO s_detail4[l_ac].xrce109
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = l_xrce119
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
            
                  NEXT FIELD xrce119
               END IF
            END IF
            CALL DIALOG.setFieldTouched("xrce119", TRUE)
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce119
            #add-point:ON CHANGE xrce119 name="input.g.page4.xrce119"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce001
            #add-point:BEFORE FIELD xrce001 name="input.b.page4.xrce001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce001
            
            #add-point:AFTER FIELD xrce001 name="input.a.page4.xrce001"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce001
            #add-point:ON CHANGE xrce001 name="input.g.page4.xrce001"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcecomp
            #add-point:BEFORE FIELD xrcecomp name="input.b.page4.xrcecomp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcecomp
            
            #add-point:AFTER FIELD xrcecomp name="input.a.page4.xrcecomp"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrcecomp
            #add-point:ON CHANGE xrcecomp name="input.g.page4.xrcecomp"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrcesite
            #add-point:BEFORE FIELD xrcesite name="input.b.page4.xrcesite"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrcesite
            
            #add-point:AFTER FIELD xrcesite name="input.a.page4.xrcesite"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrcesite
            #add-point:ON CHANGE xrcesite name="input.g.page4.xrcesite"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrceorga
            #add-point:BEFORE FIELD xrceorga name="input.b.page4.xrceorga"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrceorga
            
            #add-point:AFTER FIELD xrceorga name="input.a.page4.xrceorga"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrceorga
            #add-point:ON CHANGE xrceorga name="input.g.page4.xrceorga"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce027
            #add-point:BEFORE FIELD xrce027 name="input.b.page4.xrce027"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce027
            
            #add-point:AFTER FIELD xrce027 name="input.a.page4.xrce027"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce027
            #add-point:ON CHANGE xrce027 name="input.g.page4.xrce027"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce015
            
            #add-point:AFTER FIELD xrce015 name="input.a.page4.xrce015"


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce015
            #add-point:BEFORE FIELD xrce015 name="input.b.page4.xrce015"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce015
            #add-point:ON CHANGE xrce015 name="input.g.page4.xrce015"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce015_desc
            #add-point:BEFORE FIELD xrce015_desc name="input.b.page4.xrce015_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce015_desc
            
            #add-point:AFTER FIELD xrce015_desc name="input.a.page4.xrce015_desc"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce015_desc
            #add-point:ON CHANGE xrce015_desc name="input.g.page4.xrce015_desc"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page4.xrceseq
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrceseq
            #add-point:ON ACTION controlp INFIELD xrceseq name="input.c.page4.xrceseq"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce002
            #add-point:ON ACTION controlp INFIELD xrce002 name="input.c.page4.xrce002"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce003
            #add-point:ON ACTION controlp INFIELD xrce003 name="input.c.page4.xrce003"
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xrde4_d[l_ac].xrce003   #給予default值
            LET l_ooab002 = ''
            SELECT ooab002 INTO l_ooab002 FROM ooab_t
             WHERE ooabent = g_enterprise
               AND ooab001 = 'S-FIN-1002'
               AND ooabsite= g_xrda_m.xrdasite
            SELECT pmaa004 INTO l_pmaa004 FROM pmaa_t WHERE pmaaent = g_enterprise AND pmaa001 = g_xrda_m.xrda005   #160802-00007#1 Add
            #150820-00015#3--s
            CASE g_xrde4_d[l_ac].xrce002[1,1] 
               WHEN '3'
                  LET g_wc3 = cl_replace_str(g_wc3,'apca','xrca')
               WHEN '4'
                  LET g_wc3 = cl_replace_str(g_wc3,'xrca','apca')
            END CASE
            #150820-00015#3--e            
        
            #呼叫開窗
            CASE
               WHEN g_xrde4_d[l_ac].xrce002 = '30'           #現金類型
                  #給予arg
                  #LET g_qryparam.arg1 = g_xrda_m.xrdasite   #帳務中心
                  #LET g_qryparam.arg2 = g_xrda_m.xrda004    #核銷客戶
                  #LET g_qryparam.arg3 = g_xrda_m.xrda005    #收款客戶
                  #LET g_qryparam.arg4 = g_xrda_m.xrdacomp   #來源組織
                  #LET g_qryparam.arg5 = g_xrda_m.xrdald     #帳套
                  ##LET g_qryparam.arg6 =                     #來源類型
                  #LET g_qryparam.arg7 = "'11','12','13','14','15','16','17','19'"         #表單性質
                  #LET g_qryparam.arg8 = l_ooab002           #沖帳至項次否   -Y 是   -N 否
                  
                  #LET g_qryparam.arg1 = g_xrda_m.xrda005   #albireo mark 151006
                  LET g_qryparam.arg1 = g_xrda_m.xrda004    #albireo add 151006
                  LET g_qryparam.arg2 = g_xrda_m.xrdald
                  LET g_qryparam.arg3 = g_xrda_m.xrdasite

                  LET g_qryparam.where= "xrcadocdt <= '",g_xrda_m.xrdadocdt,"'",
                                        "  AND SUBSTR(xrca001,1,1) = '1' "
                                       ,g_wc3   #150820-00015#3
                 #160607-00015#3  Add  ---(S)---
                 ,"  AND NOT EXISTS (SELECT 1 FROM isba_t,isbc_t WHERE isbaent = isbcent AND isbadocno = isbcdocno ",
                  "  AND isbacomp = isbccomp AND isbcent = xrccent AND isbastus <> 'X' ",
                  "  AND isbc007 = xrccdocno AND isbc008 = xrcc001)"
                 #160607-00015#3  Add  ---(E)---       
                  
                  #160802-00007#1 Add  ---(S)---
                  IF l_pmaa004 = '2' THEN
                     LET g_qryparam.where = g_qryparam.where," AND xrca057 = '",g_xrda_m.xrda006,"'"
                  END IF
                  #160802-00007#1 Add  ---(E)---
                  CALL axrt400_04()                         #銀存收支資料沖帳挑選(子作業)
                  #CALL q_xrcc()
                  IF NOT cl_null(g_qryparam.return1) THEN    #151105-00008#2 add lujh
                     CALL axrt400_ins_xrde(g_xrde4_d[l_ac].xrce002,0)
                     LET l_xrce_flag = 'Y' 
                     LET l_flag = 'Y'
                     CALL axrt400_b_fill()
                     EXIT DIALOG
                  #151105-00008#2--add--str--lujh
                  ELSE
                     NEXT FIELD xrce003
                  END IF
                  #151105-00008#2--add--end--lujh
            
               WHEN g_xrde4_d[l_ac].xrce002 = '31'           #銀行電匯款
                  #給予arg
                  #LET g_qryparam.arg1 = g_xrda_m.xrdasite   #帳務中心
                  #LET g_qryparam.arg2 = g_xrda_m.xrda004    #核銷客戶
                  #LET g_qryparam.arg3 = g_xrda_m.xrda005    #收款客戶
                  #LET g_qryparam.arg4 = g_xrda_m.xrdacomp   #來源組織
                  #LET g_qryparam.arg5 = g_xrda_m.xrdald     #帳套
                  ##LET g_qryparam.arg6 =                     #來源類型
                  #LET g_qryparam.arg7 = "'22','29'"         #表單性質
                  #LET g_qryparam.arg8 = l_ooab002           #沖帳至項次否   -Y 是   -N 否

                  #LET g_qryparam.arg1 = g_xrda_m.xrda005   #albireo mark 151006
                  LET g_qryparam.arg1 = g_xrda_m.xrda004    #albireo add 151006
                  LET g_qryparam.arg2 = g_xrda_m.xrdald
                  LET g_qryparam.arg3 = g_xrda_m.xrdasite
                  
                  LET g_qryparam.where= "xrcadocdt <= '",g_xrda_m.xrdadocdt,"'",
                                        "  AND SUBSTR(xrca001,1,1) = '2' ",
                                        "  AND xrca001 <> '25'"
                                       ,"  AND xrca060 <> '2' " #160628-00002#1 add
                                       ,g_wc3   #150820-00015#3
                 #160607-00015#3  Add  ---(S)---
                 ,"  AND NOT EXISTS (SELECT 1 FROM isba_t,isbc_t WHERE isbaent = isbcent AND isbadocno = isbcdocno ",
                  "  AND isbacomp = isbccomp AND isbcent = xrccent AND isbastus <> 'X' ",
                  "  AND isbc007 = xrccdocno AND isbc008 = xrcc001)"
                 #160607-00015#3  Add  ---(E)---   
                  
                  #160802-00007#1 Add  ---(S)---
                  IF l_pmaa004 = '2' THEN
                     LET g_qryparam.where = g_qryparam.where," AND xrca057 = '",g_xrda_m.xrda006,"'"
                  END IF
                  #160802-00007#1 Add  ---(E)---
                  CALL axrt400_04()                         #銀存收支資料沖帳挑選(子作業)
                  #CALL q_xrcc()
                  IF NOT cl_null(g_qryparam.return1) THEN    #151105-00008#2 add lujh
                     CALL axrt400_ins_xrde(g_xrde4_d[l_ac].xrce002,0)
                     LET l_xrce_flag = 'Y' 
                     LET l_flag = 'Y'
                     CALL axrt400_b_fill()
                     EXIT DIALOG
                  #151105-00008#2--add--str--lujh
                  ELSE
                     NEXT FIELD xrce003
                  END IF
                  #151105-00008#2--add--end--lujh
            
               WHEN g_xrde4_d[l_ac].xrce002 = '32'           #已收押金沖銷
                  #給予arg
                  #LET g_qryparam.arg1 = g_xrda_m.xrda005   #albireo mark 151006
                  LET g_qryparam.arg1 = g_xrda_m.xrda004    #albireo add 151006
                  LET g_qryparam.arg2 = g_xrda_m.xrdald
                  LET g_qryparam.arg3 = g_xrda_m.xrdasite
                  
                  LET g_qryparam.where= "xrcadocdt <= '",g_xrda_m.xrdadocdt,"'",
                                        "  AND xrca001 = '25'"
                                       ,"  AND xrca060 <> '2' " #160628-00002#1 add
                                       ,g_wc3   #150820-00015#3
                 #160607-00015#3  Add  ---(S)---
                 ,"  AND NOT EXISTS (SELECT 1 FROM isba_t,isbc_t WHERE isbaent = isbcent AND isbadocno = isbcdocno ",
                  "  AND isbacomp = isbccomp AND isbcent = xrccent AND isbastus <> 'X' ",
                  "  AND isbc007 = xrccdocno AND isbc008 = xrcc001)"
                 #160607-00015#3  Add  ---(E)---   
                  
                  #160802-00007#1 Add  ---(S)---
                  IF l_pmaa004 = '2' THEN
                     LET g_qryparam.where = g_qryparam.where," AND xrca057 = '",g_xrda_m.xrda006,"'"
                  END IF
                  #160802-00007#1 Add  ---(E)---
                  CALL axrt400_04()                         #銀存收支資料沖帳挑選(子作業)
                  #CALL q_xrcc()
                  IF NOT cl_null(g_qryparam.return1) THEN    #151105-00008#2 add lujh
                     CALL axrt400_ins_xrde(g_xrde4_d[l_ac].xrce002,0)
                     LET l_xrce_flag = 'Y' 
                     LET l_flag = 'Y'
                     CALL axrt400_b_fill()
                     EXIT DIALOG
                  #151105-00008#2--add--str--lujh
                  ELSE
                     NEXT FIELD xrce003
                  END IF
                  #151105-00008#2--add--end--lujh
                  
               WHEN g_xrde4_d[l_ac].xrce002 = '40'           #應付單沖銷
                  #給予arg
                  #LET g_qryparam.arg1 = g_xrda_m.xrda005   #albireo mark 151006
                  LET g_qryparam.arg1 = g_xrda_m.xrda004    #albireo add 151006
                  LET g_qryparam.arg2 = g_xrda_m.xrdald
                  LET g_qryparam.arg3 = g_xrda_m.xrdasite
                  
                  LET g_qryparam.where= "     apcadocdt <= '",g_xrda_m.xrdadocdt,"'",
                                        " AND SUBSTR(apca001,1,1) = '1' "
                                       ,g_wc3   #150820-00015#3                                        
                  
                  #160802-00007#1 Add  ---(S)---
                  IF l_pmaa004 = '2' THEN
                     LET g_qryparam.where = g_qryparam.where," AND apca057 = '",g_xrda_m.xrda006,"'"
                  END IF
                  #160802-00007#1 Add  ---(E)---
                  CALL axrt400_12()                         #銀存收支資料沖帳挑選(子作業)
                  IF NOT cl_null(g_qryparam.return1) THEN    #151105-00008#2 add lujh
                     CALL axrt400_ins_xrde(g_xrde4_d[l_ac].xrce002,0)
                     LET l_xrce_flag = 'Y' 
                     LET l_flag = 'Y'
                     CALL axrt400_b_fill()
                     EXIT DIALOG
                  #151105-00008#2--add--str--lujh
                  ELSE
                     NEXT FIELD xrce003
                  END IF
                  #151105-00008#2--add--end--lujh
                  
               WHEN g_xrde4_d[l_ac].xrce002 = '41'           #應付待抵單沖銷
                  #給予arg
                   #LET g_qryparam.arg1 = g_xrda_m.xrda005   #albireo mark 151006
                  LET g_qryparam.arg1 = g_xrda_m.xrda004    #albireo add 151006
                  LET g_qryparam.arg2 = g_xrda_m.xrdald
                  LET g_qryparam.arg3 = g_xrda_m.xrdasite
                  
                  LET g_qryparam.where= "     apcadocdt <= '",g_xrda_m.xrdadocdt,"'",
                                        " AND SUBSTR(apca001,1,1) = '2' ",
                                        " AND apca001 <> '25'"   
                                       ," AND apca060 <> '2' " #160628-00002#1 add 
                                       ,g_wc3   #150820-00015#3                                        
                  
                  #160802-00007#1 Add  ---(S)---
                  IF l_pmaa004 = '2' THEN
                     LET g_qryparam.where = g_qryparam.where," AND apca057 = '",g_xrda_m.xrda006,"'"
                  END IF
                  #160802-00007#1 Add  ---(E)---
                  CALL axrt400_12()                         #銀存收支資料沖帳挑選(子作業)
                  IF NOT cl_null(g_qryparam.return1) THEN    #151105-00008#2 add lujh
                     CALL axrt400_ins_xrde(g_xrde4_d[l_ac].xrce002,0)
                     LET l_xrce_flag = 'Y' 
                     LET l_flag = 'Y'
                     CALL axrt400_b_fill()
                     EXIT DIALOG
                  #151105-00008#2--add--str--lujh
                  ELSE
                     NEXT FIELD xrce003
                  END IF
                  #151105-00008#2--add--end--lujh
                  
               WHEN g_xrde4_d[l_ac].xrce002 = '42'           #已付押金沖銷
                  #給予arg
                  #LET g_qryparam.arg1 = g_xrda_m.xrda005   #albireo mark 151006
                  LET g_qryparam.arg1 = g_xrda_m.xrda004    #albireo add 151006
                  LET g_qryparam.arg2 = g_xrda_m.xrdald
                  LET g_qryparam.arg3 = g_xrda_m.xrdasite
                  
                  LET g_qryparam.where= "     apcadocdt <= '",g_xrda_m.xrdadocdt,"'",
                                        " AND apca001 = '25'" 
                                       ," AND apca060 <> '2' " #160628-00002#1 add  
                                       ,g_wc3   #150820-00015#3                                        
                  
                  #160802-00007#1 Add  ---(S)---
                  IF l_pmaa004 = '2' THEN
                     LET g_qryparam.where = g_qryparam.where," AND apca057 = '",g_xrda_m.xrda006,"'"
                  END IF
                  #160802-00007#1 Add  ---(E)---
                  CALL axrt400_12()                         #銀存收支資料沖帳挑選(子作業)
                  IF NOT cl_null(g_qryparam.return1) THEN    #151105-00008#2 add lujh
                     CALL axrt400_ins_xrde(g_xrde4_d[l_ac].xrce002,0)
                     LET l_xrce_flag = 'Y' 
                     LET l_flag = 'Y'
                     CALL axrt400_b_fill()
                     EXIT DIALOG
                  #151105-00008#2--add--str--lujh
                  ELSE
                     NEXT FIELD xrce003
                  END IF
                  #151105-00008#2--add--end--lujh
               
            END CASE
           
            NEXT FIELD xrce003                                 #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce004
            #add-point:ON ACTION controlp INFIELD xrce004 name="input.c.page4.xrce004"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce005
            #add-point:ON ACTION controlp INFIELD xrce005 name="input.c.page4.xrce005"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce054
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce054
            #add-point:ON ACTION controlp INFIELD xrce054 name="input.c.page4.xrce054"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrcc003_1
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcc003_1
            #add-point:ON ACTION controlp INFIELD xrcc003_1 name="input.c.page4.xrcc003_1"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrca057
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrca057
            #add-point:ON ACTION controlp INFIELD xrca057 name="input.c.page4.xrca057"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde4_d[l_ac].xrca057             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL q_pmak002()                                #呼叫開窗

            LET g_xrde4_d[l_ac].xrca057 = g_qryparam.return1              

            DISPLAY g_xrde4_d[l_ac].xrca057 TO xrca057              #

            NEXT FIELD xrca057                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce010
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce010
            #add-point:ON ACTION controlp INFIELD xrce010 name="input.c.page4.xrce010"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce016
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce016
            #add-point:ON ACTION controlp INFIELD xrce016 name="input.c.page4.xrce016"
            #應用 a07 樣板自動產生(Version:2)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde4_d[l_ac].xrce016             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s


            CALL aglt310_04()                                #呼叫開窗

            LET g_xrde4_d[l_ac].xrce016 = g_qryparam.return1              

            DISPLAY g_xrde4_d[l_ac].xrce016 TO xrce016              #

            NEXT FIELD xrce016                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce016_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce016_desc
            #add-point:ON ACTION controlp INFIELD xrce016_desc name="input.c.page4.xrce016_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde4_d[l_ac].xrce016             #給予default值
            LET g_qryparam.where = " glac001 = '",g_glaa_t.glaa004,"'",
                                   " AND glac002 IN (SELECT glad001 FROM glad_t,glac_t WHERE glad001= glac002 AND gladld='",g_xrda_m.xrdald,"' AND gladent=",g_enterprise,
                                   " AND gladstus = 'Y' )" #150916-00015#1 add
            #給予arg
      
            CALL aglt310_04()                                #呼叫開窗

            LET g_xrde4_d[l_ac].xrce016 = g_qryparam.return1              
            CALL axrt400_xrde016_desc(g_xrde4_d[l_ac].xrce016) RETURNING g_xrde4_d[l_ac].xrce016_desc
            LET g_xrde4_d[l_ac].xrce016_desc = g_xrde4_d[l_ac].xrce016 CLIPPED,g_xrde4_d[l_ac].xrce016_desc
            DISPLAY g_xrde4_d[l_ac].xrce016_desc TO xrce016_desc              #

            NEXT FIELD xrce016_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce100
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce100
            #add-point:ON ACTION controlp INFIELD xrce100 name="input.c.page4.xrce100"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde4_d[l_ac].xrce100             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_aooi001_1()                                #呼叫開窗

            LET g_xrde4_d[l_ac].xrce100 = g_qryparam.return1              

            DISPLAY g_xrde4_d[l_ac].xrce100 TO xrce100              #

            NEXT FIELD xrce100                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce101
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce101
            #add-point:ON ACTION controlp INFIELD xrce101 name="input.c.page4.xrce101"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrcc108
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcc108
            #add-point:ON ACTION controlp INFIELD xrcc108 name="input.c.page4.xrcc108"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrcc118
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcc118
            #add-point:ON ACTION controlp INFIELD xrcc118 name="input.c.page4.xrcc118"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce109
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce109
            #add-point:ON ACTION controlp INFIELD xrce109 name="input.c.page4.xrce109"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce119
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce119
            #add-point:ON ACTION controlp INFIELD xrce119 name="input.c.page4.xrce119"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce001
            #add-point:ON ACTION controlp INFIELD xrce001 name="input.c.page4.xrce001"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrcecomp
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcecomp
            #add-point:ON ACTION controlp INFIELD xrcecomp name="input.c.page4.xrcecomp"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrcesite
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrcesite
            #add-point:ON ACTION controlp INFIELD xrcesite name="input.c.page4.xrcesite"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrceorga
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrceorga
            #add-point:ON ACTION controlp INFIELD xrceorga name="input.c.page4.xrceorga"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce027
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce027
            #add-point:ON ACTION controlp INFIELD xrce027 name="input.c.page4.xrce027"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce015
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce015
            #add-point:ON ACTION controlp INFIELD xrce015 name="input.c.page4.xrce015"
            
            #END add-point
 
 
         #Ctrlp:input.c.page4.xrce015_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce015_desc
            #add-point:ON ACTION controlp INFIELD xrce015_desc name="input.c.page4.xrce015_desc"
            
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page4 after_row name="input.body4.after_row"
            
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xrde4_d[l_ac].* = g_xrde4_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL axrt400_unlock_b("xrce_t","'4'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page4 after_row2 name="input.body4.after_row2"
            
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body4.after_input"
            
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xrde4_d[li_reproduce_target].* = g_xrde4_d[li_reproduce].*
               LET g_xrde5_d[li_reproduce_target].* = g_xrde5_d[li_reproduce].*
               LET g_xrde6_d[li_reproduce_target].* = g_xrde6_d[li_reproduce].*
 
               LET g_xrde4_d[li_reproduce_target].xrceseq = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_xrde4_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xrde4_d.getLength()+1
            END IF
            
      END INPUT
      INPUT ARRAY g_xrde5_d FROM s_detail5.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = FALSE, #此頁面insert功能由產生器控制, 手動之設定無效! 
 
                 DELETE ROW = FALSE,
                 APPEND ROW = FALSE)
                 
         #自訂ACTION(detail_input,page_5)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body5.before_input2"
            
            #end add-point
            
            CALL axrt400_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_xrde5_d.getLength()
            #add-point:資料輸入前 name="input.body5.before_input"
            
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xrde5_d[l_ac].* TO NULL 
            INITIALIZE g_xrde5_d_t.* TO NULL 
            INITIALIZE g_xrde5_d_o.* TO NULL 
            #公用欄位給值(單身5)
            
            #自定義預設值(單身5)
            
            #add-point:modify段before備份 name="input.body5.insert.before_bak"
            
            #end add-point
            LET g_xrde5_d_t.* = g_xrde5_d[l_ac].*     #新輸入資料
            LET g_xrde5_d_o.* = g_xrde5_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL axrt400_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body5.insert.after_set_entry_b"
            
            #end add-point
            CALL axrt400_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xrde4_d[li_reproduce_target].* = g_xrde4_d[li_reproduce].*
               LET g_xrde5_d[li_reproduce_target].* = g_xrde5_d[li_reproduce].*
               LET g_xrde6_d[li_reproduce_target].* = g_xrde6_d[li_reproduce].*
 
               LET g_xrde5_d[li_reproduce_target].xrceseq = NULL
            END IF
            
 
 
 
            #add-point:modify段before insert name="input.body5.before_insert"
            
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body5.before_row2"
            EXIT DIALOG
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[5] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 5
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN axrt400_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CLOSE axrt400_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xrde5_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xrde5_d[l_ac].xrceseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_xrde5_d_t.* = g_xrde5_d[l_ac].*  #BACKUP
               LET g_xrde5_d_o.* = g_xrde5_d[l_ac].*  #BACKUP
               CALL axrt400_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body5.after_set_entry_b"
               
               #end add-point  
               CALL axrt400_set_no_entry_b(l_cmd)
               IF NOT axrt400_lock_b("xrce_t","'5'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH axrt400_bcl2 INTO g_xrde4_d[l_ac].xrceseq,g_xrde4_d[l_ac].xrce002,g_xrde4_d[l_ac].xrce003, 
                      g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005,g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrce010, 
                      g_xrde4_d[l_ac].xrce016,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce101,g_xrde4_d[l_ac].xrce109, 
                      g_xrde4_d[l_ac].xrce119,g_xrde4_d[l_ac].xrce001,g_xrde4_d[l_ac].xrcecomp,g_xrde4_d[l_ac].xrcesite, 
                      g_xrde4_d[l_ac].xrceorga,g_xrde4_d[l_ac].xrce027,g_xrde4_d[l_ac].xrce015,g_xrde5_d[l_ac].xrceseq, 
                      g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce129,g_xrde5_d[l_ac].xrce130, 
                      g_xrde5_d[l_ac].xrce131,g_xrde5_d[l_ac].xrce139,g_xrde6_d[l_ac].xrceseq,g_xrde6_d[l_ac].xrce017, 
                      g_xrde6_d[l_ac].xrce018,g_xrde6_d[l_ac].xrce019,g_xrde6_d[l_ac].xrce035,g_xrde6_d[l_ac].xrce036, 
                      g_xrde6_d[l_ac].xrce020,g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023,g_xrde6_d[l_ac].xrce039, 
                      g_xrde6_d[l_ac].xrce040,g_xrde6_d[l_ac].xrce042,g_xrde6_d[l_ac].xrce043,g_xrde6_d[l_ac].xrce044, 
                      g_xrde6_d[l_ac].xrce045,g_xrde6_d[l_ac].xrce046,g_xrde6_d[l_ac].xrce047,g_xrde6_d[l_ac].xrce048, 
                      g_xrde6_d[l_ac].xrce049,g_xrde6_d[l_ac].xrce050,g_xrde6_d[l_ac].xrce051
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xrde5_d_mask_o[l_ac].* =  g_xrde5_d[l_ac].*
                  CALL axrt400_xrce_t_mask()
                  LET g_xrde5_d_mask_n[l_ac].* =  g_xrde5_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL axrt400_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body5.before_row"
            
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
 
 
            #其他table進行lock
            
 
 
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body5.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body5.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身5刪除前 name="input.body5.b_delete"
               
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xrda_m.xrdald
               LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
               LET gs_keys[gs_keys.getLength()+1] = g_xrde5_d_t.xrceseq
            
               #刪除同層單身
               IF NOT axrt400_delete_b('xrce_t',gs_keys,"'5'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT axrt400_key_delete_b(gs_keys,'xrce_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
 
 
               
               #add-point:單身5刪除中 name="input.body5.m_delete"
               
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE axrt400_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身5刪除後 name="input.body5.a_delete"
               
               #end add-point
               LET l_count = g_xrde_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body5.after_delete"
               
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xrde5_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身5新增前 name="input.body5.b_a_insert"
            
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xrce_t 
             WHERE xrceent = g_enterprise AND xrceld = g_xrda_m.xrdald
               AND xrcedocno = g_xrda_m.xrdadocno
               AND xrceseq = g_xrde5_d[l_ac].xrceseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身5新增前 name="input.body5.b_insert"
               
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys[3] = g_xrde5_d[g_detail_idx].xrceseq
               CALL axrt400_insert_b('xrce_t',gs_keys,"'5'")
                           
               #add-point:單身新增後5 name="input.body5.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_xrde_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL axrt400_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body5.after_insert"
               
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xrde5_d[l_ac].* = g_xrde5_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_xrde5_d[l_ac].* = g_xrde5_d_t.*
            ELSE
               #add-point:單身page5修改前 name="input.body5.b_update"
               
               #end add-point
               
               #寫入修改者/修改日期資訊(單身5)
               
               
               #將遮罩欄位還原
               CALL axrt400_xrce_t_mask_restore('restore_mask_o')
                              
               UPDATE xrce_t SET (xrceld,xrcedocno,xrceseq,xrce002,xrce003,xrce004,xrce005,xrce054,xrce010, 
                   xrce016,xrce100,xrce101,xrce109,xrce119,xrce001,xrcecomp,xrcesite,xrceorga,xrce027, 
                   xrce015,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139,xrce017,xrce018,xrce019,xrce035, 
                   xrce036,xrce020,xrce022,xrce023,xrce039,xrce040,xrce042,xrce043,xrce044,xrce045,xrce046, 
                   xrce047,xrce048,xrce049,xrce050,xrce051) = (g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrde4_d[l_ac].xrceseq, 
                   g_xrde4_d[l_ac].xrce002,g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005, 
                   g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrce010,g_xrde4_d[l_ac].xrce016,g_xrde4_d[l_ac].xrce100, 
                   g_xrde4_d[l_ac].xrce101,g_xrde4_d[l_ac].xrce109,g_xrde4_d[l_ac].xrce119,g_xrde4_d[l_ac].xrce001, 
                   g_xrde4_d[l_ac].xrcecomp,g_xrde4_d[l_ac].xrcesite,g_xrde4_d[l_ac].xrceorga,g_xrde4_d[l_ac].xrce027, 
                   g_xrde4_d[l_ac].xrce015,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce129, 
                   g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce131,g_xrde5_d[l_ac].xrce139,g_xrde6_d[l_ac].xrce017, 
                   g_xrde6_d[l_ac].xrce018,g_xrde6_d[l_ac].xrce019,g_xrde6_d[l_ac].xrce035,g_xrde6_d[l_ac].xrce036, 
                   g_xrde6_d[l_ac].xrce020,g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023,g_xrde6_d[l_ac].xrce039, 
                   g_xrde6_d[l_ac].xrce040,g_xrde6_d[l_ac].xrce042,g_xrde6_d[l_ac].xrce043,g_xrde6_d[l_ac].xrce044, 
                   g_xrde6_d[l_ac].xrce045,g_xrde6_d[l_ac].xrce046,g_xrde6_d[l_ac].xrce047,g_xrde6_d[l_ac].xrce048, 
                   g_xrde6_d[l_ac].xrce049,g_xrde6_d[l_ac].xrce050,g_xrde6_d[l_ac].xrce051) #自訂欄位頁簽 
 
                WHERE xrceent = g_enterprise AND xrceld = g_xrda_m.xrdald
                  AND xrcedocno = g_xrda_m.xrdadocno
                  AND xrceseq = g_xrde5_d_t.xrceseq #項次 
                  
               #add-point:單身page5修改中 name="input.body5.m_update"
               
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xrde5_d[l_ac].* = g_xrde5_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrce_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.sqlcode #其他錯誤
                     LET g_xrde5_d[l_ac].* = g_xrde5_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys_bak[1] = g_xrdald_t
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys_bak[2] = g_xrdadocno_t
               LET gs_keys[3] = g_xrde5_d[g_detail_idx].xrceseq
               LET gs_keys_bak[3] = g_xrde5_d_t.xrceseq
               CALL axrt400_update_b('xrce_t',gs_keys,gs_keys_bak,"'5'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL axrt400_xrce_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_xrde5_d[g_detail_idx].xrceseq = g_xrde5_d_t.xrceseq 
                  ) THEN
                  LET gs_keys[01] = g_xrda_m.xrdald
                  LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xrde5_d_t.xrceseq
                  CALL axrt400_key_update_b(gs_keys,'xrce_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde5_d_t)
               LET g_log2 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde5_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page5修改後 name="input.body5.a_update"
               
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce120
            #add-point:BEFORE FIELD xrce120 name="input.b.page5.xrce120"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce120
            
            #add-point:AFTER FIELD xrce120 name="input.a.page5.xrce120"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce120
            #add-point:ON CHANGE xrce120 name="input.g.page5.xrce120"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce121
            #add-point:BEFORE FIELD xrce121 name="input.b.page5.xrce121"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce121
            
            #add-point:AFTER FIELD xrce121 name="input.a.page5.xrce121"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce121
            #add-point:ON CHANGE xrce121 name="input.g.page5.xrce121"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce129
            #add-point:BEFORE FIELD xrce129 name="input.b.page5.xrce129"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce129
            
            #add-point:AFTER FIELD xrce129 name="input.a.page5.xrce129"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce129
            #add-point:ON CHANGE xrce129 name="input.g.page5.xrce129"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce130
            #add-point:BEFORE FIELD xrce130 name="input.b.page5.xrce130"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce130
            
            #add-point:AFTER FIELD xrce130 name="input.a.page5.xrce130"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce130
            #add-point:ON CHANGE xrce130 name="input.g.page5.xrce130"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce131
            #add-point:BEFORE FIELD xrce131 name="input.b.page5.xrce131"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce131
            
            #add-point:AFTER FIELD xrce131 name="input.a.page5.xrce131"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce131
            #add-point:ON CHANGE xrce131 name="input.g.page5.xrce131"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce139
            #add-point:BEFORE FIELD xrce139 name="input.b.page5.xrce139"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce139
            
            #add-point:AFTER FIELD xrce139 name="input.a.page5.xrce139"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce139
            #add-point:ON CHANGE xrce139 name="input.g.page5.xrce139"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page5.xrce120
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce120
            #add-point:ON ACTION controlp INFIELD xrce120 name="input.c.page5.xrce120"
            
            #END add-point
 
 
         #Ctrlp:input.c.page5.xrce121
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce121
            #add-point:ON ACTION controlp INFIELD xrce121 name="input.c.page5.xrce121"
            
            #END add-point
 
 
         #Ctrlp:input.c.page5.xrce129
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce129
            #add-point:ON ACTION controlp INFIELD xrce129 name="input.c.page5.xrce129"
            
            #END add-point
 
 
         #Ctrlp:input.c.page5.xrce130
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce130
            #add-point:ON ACTION controlp INFIELD xrce130 name="input.c.page5.xrce130"
            
            #END add-point
 
 
         #Ctrlp:input.c.page5.xrce131
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce131
            #add-point:ON ACTION controlp INFIELD xrce131 name="input.c.page5.xrce131"
            
            #END add-point
 
 
         #Ctrlp:input.c.page5.xrce139
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce139
            #add-point:ON ACTION controlp INFIELD xrce139 name="input.c.page5.xrce139"
            
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page5 after_row name="input.body5.after_row"
            
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xrde5_d[l_ac].* = g_xrde5_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL axrt400_unlock_b("xrce_t","'5'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page5 after_row2 name="input.body5.after_row2"
            
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body5.after_input"
            
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xrde4_d[li_reproduce_target].* = g_xrde4_d[li_reproduce].*
               LET g_xrde5_d[li_reproduce_target].* = g_xrde5_d[li_reproduce].*
               LET g_xrde6_d[li_reproduce_target].* = g_xrde6_d[li_reproduce].*
 
               LET g_xrde5_d[li_reproduce_target].xrceseq = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_xrde5_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xrde5_d.getLength()+1
            END IF
            
      END INPUT
      INPUT ARRAY g_xrde6_d FROM s_detail6.*
         ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                 INSERT ROW = FALSE, #此頁面insert功能由產生器控制, 手動之設定無效! 
 
                 DELETE ROW = FALSE,
                 APPEND ROW = FALSE)
                 
         #自訂ACTION(detail_input,page_6)
         
         
         BEFORE INPUT
            #add-point:資料輸入前 name="input.body6.before_input2"
            
            #end add-point
            
            CALL axrt400_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'd' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_idx_group.getValue(""))
            END IF
            LET g_loc = 'd'
            LET g_rec_b = g_xrde6_d.getLength()
            #add-point:資料輸入前 name="input.body6.before_input"
            
            #end add-point
            
         BEFORE INSERT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_xrde6_d[l_ac].* TO NULL 
            INITIALIZE g_xrde6_d_t.* TO NULL 
            INITIALIZE g_xrde6_d_o.* TO NULL 
            #公用欄位給值(單身6)
            
            #自定義預設值(單身6)
            
            #add-point:modify段before備份 name="input.body6.insert.before_bak"
            
            #end add-point
            LET g_xrde6_d_t.* = g_xrde6_d[l_ac].*     #新輸入資料
            LET g_xrde6_d_o.* = g_xrde6_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL axrt400_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b name="input.body6.insert.after_set_entry_b"
            
            #end add-point
            CALL axrt400_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_xrde4_d[li_reproduce_target].* = g_xrde4_d[li_reproduce].*
               LET g_xrde5_d[li_reproduce_target].* = g_xrde5_d[li_reproduce].*
               LET g_xrde6_d[li_reproduce_target].* = g_xrde6_d[li_reproduce].*
 
               LET g_xrde6_d[li_reproduce_target].xrceseq = NULL
            END IF
            
 
 
 
            #add-point:modify段before insert name="input.body6.before_insert"
            
            #end add-point  
 
         BEFORE ROW     
            #add-point:modify段before row2 name="input.body6.before_row2"
            
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac_t = l_ac 
            LET g_detail_idx_list[6] = l_ac
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 6
              
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN axrt400_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CLOSE axrt400_cl
               CALL s_transaction_end('N','0')
               CALL cl_err()
               RETURN
            END IF
            
            LET g_rec_b = g_xrde6_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_xrde6_d[l_ac].xrceseq IS NOT NULL
            THEN 
               LET l_cmd='u'
               LET g_xrde6_d_t.* = g_xrde6_d[l_ac].*  #BACKUP
               LET g_xrde6_d_o.* = g_xrde6_d[l_ac].*  #BACKUP
               CALL axrt400_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b name="input.body6.after_set_entry_b"
               
               #end add-point  
               CALL axrt400_set_no_entry_b(l_cmd)
               IF NOT axrt400_lock_b("xrce_t","'6'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH axrt400_bcl2 INTO g_xrde4_d[l_ac].xrceseq,g_xrde4_d[l_ac].xrce002,g_xrde4_d[l_ac].xrce003, 
                      g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005,g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrce010, 
                      g_xrde4_d[l_ac].xrce016,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce101,g_xrde4_d[l_ac].xrce109, 
                      g_xrde4_d[l_ac].xrce119,g_xrde4_d[l_ac].xrce001,g_xrde4_d[l_ac].xrcecomp,g_xrde4_d[l_ac].xrcesite, 
                      g_xrde4_d[l_ac].xrceorga,g_xrde4_d[l_ac].xrce027,g_xrde4_d[l_ac].xrce015,g_xrde5_d[l_ac].xrceseq, 
                      g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce129,g_xrde5_d[l_ac].xrce130, 
                      g_xrde5_d[l_ac].xrce131,g_xrde5_d[l_ac].xrce139,g_xrde6_d[l_ac].xrceseq,g_xrde6_d[l_ac].xrce017, 
                      g_xrde6_d[l_ac].xrce018,g_xrde6_d[l_ac].xrce019,g_xrde6_d[l_ac].xrce035,g_xrde6_d[l_ac].xrce036, 
                      g_xrde6_d[l_ac].xrce020,g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023,g_xrde6_d[l_ac].xrce039, 
                      g_xrde6_d[l_ac].xrce040,g_xrde6_d[l_ac].xrce042,g_xrde6_d[l_ac].xrce043,g_xrde6_d[l_ac].xrce044, 
                      g_xrde6_d[l_ac].xrce045,g_xrde6_d[l_ac].xrce046,g_xrde6_d[l_ac].xrce047,g_xrde6_d[l_ac].xrce048, 
                      g_xrde6_d[l_ac].xrce049,g_xrde6_d[l_ac].xrce050,g_xrde6_d[l_ac].xrce051
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = SQLERRMESSAGE  
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_xrde6_d_mask_o[l_ac].* =  g_xrde6_d[l_ac].*
                  CALL axrt400_xrce_t_mask()
                  LET g_xrde6_d_mask_n[l_ac].* =  g_xrde6_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL axrt400_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row name="input.body6.before_row"
            SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
                   glad019,glad0191,glad0192,glad020,glad0201,glad0202,
                   glad021,glad0211,glad0212,glad022,glad0221,glad0222,
                   glad023,glad0231,glad0232,glad024,glad0221,glad0242,
                   glad025,glad0251,glad0252,glad026,glad0261,glad0262
             INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
                   g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
                   g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
                   g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
                   g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
             FROM  glad_t
             WHERE gladent = g_enterprise
               AND gladld = g_xrda_m.xrdald
               AND glad001 = g_xrde4_d[l_ac].xrce016  
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
 
 
 
            #其他table進行lock
            
 
 
 
            
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身AFTER DELETE (=d) name="input.body6.after_delete_d"
               
               #end add-point
            ELSE
               #add-point:單身刪除前 name="input.body6.b_delete_ask"
               
               #end add-point 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身6刪除前 name="input.body6.b_delete"
               
               #end add-point    
                  
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_xrda_m.xrdald
               LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
               LET gs_keys[gs_keys.getLength()+1] = g_xrde6_d_t.xrceseq
            
               #刪除同層單身
               IF NOT axrt400_delete_b('xrce_t',gs_keys,"'6'") THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT axrt400_key_delete_b(gs_keys,'xrce_t') THEN
                  CALL s_transaction_end('N','0')
                  CLOSE axrt400_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
 
 
 
               
               #add-point:單身6刪除中 name="input.body6.m_delete"
               
               #end add-point    
               
               CALL s_transaction_end('Y','0')
               CLOSE axrt400_bcl
 
               LET g_rec_b = g_rec_b-1
               #add-point:單身6刪除後 name="input.body6.a_delete"
               
               #end add-point
               LET l_count = g_xrde_d.getLength()
               
               #add-point:單身刪除後(<>d) name="input.body6.after_delete"
               
               #end add-point
            END IF 
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_xrde6_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
         AFTER INSERT    
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身6新增前 name="input.body6.b_a_insert"
            
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(1) INTO l_count FROM xrce_t 
             WHERE xrceent = g_enterprise AND xrceld = g_xrda_m.xrdald
               AND xrcedocno = g_xrda_m.xrdadocno
               AND xrceseq = g_xrde6_d[l_ac].xrceseq
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身6新增前 name="input.body6.b_insert"
               
               #end add-point
            
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys[3] = g_xrde6_d[g_detail_idx].xrceseq
               CALL axrt400_insert_b('xrce_t',gs_keys,"'6'")
                           
               #add-point:單身新增後6 name="input.body6.a_insert"
               
               #end add-point
            ELSE    
               INITIALIZE g_xrde_d[l_ac].* TO NULL
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')
               CALL cl_err()
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL s_transaction_end('N','0')                    
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL axrt400_b_fill()
               #資料多語言用-增/改
               
               #add-point:單身新增後 name="input.body6.after_insert"
               
               #end add-point
               CALL s_transaction_end('Y','0')
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
            
         ON ROW CHANGE 
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               LET g_xrde6_d[l_ac].* = g_xrde6_d_t.*
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_xrde6_d[l_ac].* = g_xrde6_d_t.*
            ELSE
               #add-point:單身page6修改前 name="input.body6.b_update"
               
               #end add-point
               
               #寫入修改者/修改日期資訊(單身6)
               
               
               #將遮罩欄位還原
               CALL axrt400_xrce_t_mask_restore('restore_mask_o')
                              
               UPDATE xrce_t SET (xrceld,xrcedocno,xrceseq,xrce002,xrce003,xrce004,xrce005,xrce054,xrce010, 
                   xrce016,xrce100,xrce101,xrce109,xrce119,xrce001,xrcecomp,xrcesite,xrceorga,xrce027, 
                   xrce015,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139,xrce017,xrce018,xrce019,xrce035, 
                   xrce036,xrce020,xrce022,xrce023,xrce039,xrce040,xrce042,xrce043,xrce044,xrce045,xrce046, 
                   xrce047,xrce048,xrce049,xrce050,xrce051) = (g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrde4_d[l_ac].xrceseq, 
                   g_xrde4_d[l_ac].xrce002,g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005, 
                   g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrce010,g_xrde4_d[l_ac].xrce016,g_xrde4_d[l_ac].xrce100, 
                   g_xrde4_d[l_ac].xrce101,g_xrde4_d[l_ac].xrce109,g_xrde4_d[l_ac].xrce119,g_xrde4_d[l_ac].xrce001, 
                   g_xrde4_d[l_ac].xrcecomp,g_xrde4_d[l_ac].xrcesite,g_xrde4_d[l_ac].xrceorga,g_xrde4_d[l_ac].xrce027, 
                   g_xrde4_d[l_ac].xrce015,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce129, 
                   g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce131,g_xrde5_d[l_ac].xrce139,g_xrde6_d[l_ac].xrce017, 
                   g_xrde6_d[l_ac].xrce018,g_xrde6_d[l_ac].xrce019,g_xrde6_d[l_ac].xrce035,g_xrde6_d[l_ac].xrce036, 
                   g_xrde6_d[l_ac].xrce020,g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023,g_xrde6_d[l_ac].xrce039, 
                   g_xrde6_d[l_ac].xrce040,g_xrde6_d[l_ac].xrce042,g_xrde6_d[l_ac].xrce043,g_xrde6_d[l_ac].xrce044, 
                   g_xrde6_d[l_ac].xrce045,g_xrde6_d[l_ac].xrce046,g_xrde6_d[l_ac].xrce047,g_xrde6_d[l_ac].xrce048, 
                   g_xrde6_d[l_ac].xrce049,g_xrde6_d[l_ac].xrce050,g_xrde6_d[l_ac].xrce051) #自訂欄位頁簽 
 
                WHERE xrceent = g_enterprise AND xrceld = g_xrda_m.xrdald
                  AND xrcedocno = g_xrda_m.xrdadocno
                  AND xrceseq = g_xrde6_d_t.xrceseq #項次 
                  
               #add-point:單身page6修改中 name="input.body6.m_update"
               
               #end add-point
                  
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     LET g_xrde6_d[l_ac].* = g_xrde6_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrce_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  WHEN SQLCA.sqlcode #其他錯誤
                     LET g_xrde6_d[l_ac].* = g_xrde6_d_t.*
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL s_transaction_end('N','0')
                     CALL cl_err()
                     
                  OTHERWISE
                     #資料多語言用-增/改
                     
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_xrda_m.xrdald
               LET gs_keys_bak[1] = g_xrdald_t
               LET gs_keys[2] = g_xrda_m.xrdadocno
               LET gs_keys_bak[2] = g_xrdadocno_t
               LET gs_keys[3] = g_xrde6_d[g_detail_idx].xrceseq
               LET gs_keys_bak[3] = g_xrde6_d_t.xrceseq
               CALL axrt400_update_b('xrce_t',gs_keys,gs_keys_bak,"'6'")
               END CASE
               
               #將遮罩欄位進行遮蔽
               CALL axrt400_xrce_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT (g_xrde6_d[g_detail_idx].xrceseq = g_xrde6_d_t.xrceseq 
                  ) THEN
                  LET gs_keys[01] = g_xrda_m.xrdald
                  LET gs_keys[gs_keys.getLength()+1] = g_xrda_m.xrdadocno
                  LET gs_keys[gs_keys.getLength()+1] = g_xrde6_d_t.xrceseq
                  CALL axrt400_key_update_b(gs_keys,'xrce_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde6_d_t)
               LET g_log2 = util.JSON.stringify(g_xrda_m),util.JSON.stringify(g_xrde6_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身page6修改後 name="input.body6.a_update"
               
               #end add-point
            END IF
         
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce017
            #add-point:BEFORE FIELD xrce017 name="input.b.page6.xrce017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce017
            
            #add-point:AFTER FIELD xrce017 name="input.a.page6.xrce017"


            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce017
            #add-point:ON CHANGE xrce017 name="input.g.page6.xrce017"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce017_desc
            #add-point:BEFORE FIELD xrce017_desc name="input.b.page6.xrce017_desc"
            LET g_xrde6_d[l_ac].xrce017_desc = g_xrde6_d[l_ac].xrce017
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce017_desc
            
            #add-point:AFTER FIELD xrce017_desc name="input.a.page6.xrce017_desc"
            LET g_xrde6_d[l_ac].xrce017 = g_xrde6_d[l_ac].xrce017_desc
            CALL axrt400_xrde017_desc(g_xrde6_d[l_ac].xrce017) RETURNING g_xrde6_d[l_ac].xrce017_desc
            LET g_xrde6_d[l_ac].xrce017_desc = g_xrde6_d[l_ac].xrce017 CLIPPED,g_xrde6_d[l_ac].xrce017_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce017) THEN 
               ##設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               #INITIALIZE g_chkparam.* TO NULL    
               ##設定g_chkparam.*的參數
               #LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce017
               #LET g_chkparam.arg2 = g_today 
               ##呼叫檢查存在並帶值的library
               #IF cl_chk_exist("v_ooag001") THEN
               #   #檢查成功時後續處理
               #   #LET  = g_chkparam.return1
               #   #DISPLAY BY NAME 
               #ELSE
               #   #檢查失敗時後續處理
               #   LET g_xrde6_d[l_ac].xrce017 = g_xrde6_d_t.xrce017
               #   LET g_xrde6_d[l_ac].xrce017_desc = g_xrde6_d_t.xrce017_desc
               #   NEXT FIELD CURRENT
               #END IF
               CALL s_employee_chk(g_xrde6_d[l_ac].xrce017) RETURNING l_success
               
               IF l_success = FALSE THEN 
                  LET g_xrde6_d[l_ac].xrce017 = g_xrde6_d_t.xrce017
                  LET g_xrde6_d[l_ac].xrce017_desc = g_xrde6_d_t.xrce017_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce017_desc
            #add-point:ON CHANGE xrce017_desc name="input.g.page6.xrce017_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce018
            #add-point:BEFORE FIELD xrce018 name="input.b.page6.xrce018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce018
            
            #add-point:AFTER FIELD xrce018 name="input.a.page6.xrce018"
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xrde6_d[l_ac].xrce018
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xrde6_d[l_ac].xrce018_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xrde6_d[l_ac].xrce018_desc


            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce018
            #add-point:ON CHANGE xrce018 name="input.g.page6.xrce018"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce018_desc
            #add-point:BEFORE FIELD xrce018_desc name="input.b.page6.xrce018_desc"
            LET g_xrde6_d[l_ac].xrce018_desc = g_xrde6_d[l_ac].xrce018
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce018_desc
            
            #add-point:AFTER FIELD xrce018_desc name="input.a.page6.xrce018_desc"
            LET g_xrde6_d[l_ac].xrce018 = g_xrde6_d[l_ac].xrce018_desc
            CALL axrt400_xrde018_desc(g_xrde6_d[l_ac].xrce018) RETURNING g_xrde6_d[l_ac].xrce018_desc
            LET g_xrde6_d[l_ac].xrce018_desc = g_xrde6_d[l_ac].xrce018 CLIPPED,g_xrde6_d[l_ac].xrce018_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce018) THEN 
               ##設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               #INITIALIZE g_chkparam.* TO NULL    
               ##設定g_chkparam.*的參數
               #LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce018
               #LET g_chkparam.arg2 = g_today 
               ##呼叫檢查存在並帶值的library
               #IF cl_chk_exist("v_ooeg001") THEN
               #   #檢查成功時後續處理
               #   #LET  = g_chkparam.return1
               #   #DISPLAY BY NAME 
               #ELSE
               #   #檢查失敗時後續處理
               #   LET g_xrde6_d[l_ac].xrce018 = g_xrde6_d_t.xrce018
               #   LET g_xrde6_d[l_ac].xrce018_desc = g_xrde6_d_t.xrce018_desc
               #   NEXT FIELD CURRENT
               #END IF
               CALL s_department_chk(g_xrde6_d[l_ac].xrce018,g_xrda_m.xrdadocdt) RETURNING l_success
               
               IF l_success = FALSE THEN 
                  LET g_xrde6_d[l_ac].xrce018 = g_xrde6_d_t.xrce018
                  LET g_xrde6_d[l_ac].xrce018_desc = g_xrde6_d_t.xrce018_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce018_desc
            #add-point:ON CHANGE xrce018_desc name="input.g.page6.xrce018_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce019
            #add-point:BEFORE FIELD xrce019 name="input.b.page6.xrce019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce019
            
            #add-point:AFTER FIELD xrce019 name="input.a.page6.xrce019"
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xrde6_d[l_ac].xrce019
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xrde6_d[l_ac].xrce019_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xrde6_d[l_ac].xrce019_desc


            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce019
            #add-point:ON CHANGE xrce019 name="input.g.page6.xrce019"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce019_desc
            #add-point:BEFORE FIELD xrce019_desc name="input.b.page6.xrce019_desc"
            LET g_xrde6_d[l_ac].xrce019_desc = g_xrde6_d[l_ac].xrce019
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce019_desc
            
            #add-point:AFTER FIELD xrce019_desc name="input.a.page6.xrce019_desc"
            LET g_xrde6_d[l_ac].xrce019 = g_xrde6_d[l_ac].xrce019_desc
            CALL axrt400_xrde018_desc(g_xrde6_d[l_ac].xrce019) RETURNING g_xrde6_d[l_ac].xrce019_desc
            LET g_xrde6_d[l_ac].xrce019_desc = g_xrde6_d[l_ac].xrce019 CLIPPED,g_xrde6_d[l_ac].xrce019_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce019) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce019
               LET g_chkparam.arg2 = g_today 
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "aoo-00095:sub-01302|aooi125|",cl_get_progname("aooi125",g_lang,"2"),"|:EXEPROGaooi125"    #160318-00025#13 
               LET g_chkparam.err_str[2] = "aoo-00029:sub-01302|aooi125|",cl_get_progname("aooi125",g_lang,"2"),"|:EXEPROGaooi125"    #160318-00025#13               
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooeg001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde6_d[l_ac].xrce019 = g_xrde6_d_t.xrce019
                  LET g_xrde6_d[l_ac].xrce019_desc = g_xrde6_d_t.xrce019_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce019_desc
            #add-point:ON CHANGE xrce019_desc name="input.g.page6.xrce019_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce035
            #add-point:BEFORE FIELD xrce035 name="input.b.page6.xrce035"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce035
            
            #add-point:AFTER FIELD xrce035 name="input.a.page6.xrce035"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce035
            #add-point:ON CHANGE xrce035 name="input.g.page6.xrce035"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce035_desc
            #add-point:BEFORE FIELD xrce035_desc name="input.b.page6.xrce035_desc"
            LET g_xrde6_d[l_ac].xrce035_desc = g_xrde6_d[l_ac].xrce035
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce035_desc
            
            #add-point:AFTER FIELD xrce035_desc name="input.a.page6.xrce035_desc"
            LET g_xrde6_d[l_ac].xrce035 = g_xrde6_d[l_ac].xrce035_desc
            CALL axrt400_xrde035_desc('287',g_xrde6_d[l_ac].xrce035) RETURNING g_xrde6_d[l_ac].xrce035_desc
            LET g_xrde6_d[l_ac].xrce035_desc = g_xrde6_d[l_ac].xrce035 CLIPPED,g_xrde6_d[l_ac].xrce035_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce035) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce035
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "axm-00004:sub-01302|axmi027|",cl_get_progname("axmi027",g_lang,"2"),"|:EXEPROGaxmi027"    #160318-00025#13     
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_287") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde6_d[l_ac].xrce035 = g_xrde6_d_t.xrce035
                  LET g_xrde6_d[l_ac].xrce035_desc = g_xrde6_d_t.xrce035_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce035_desc
            #add-point:ON CHANGE xrce035_desc name="input.g.page6.xrce035_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce036
            #add-point:BEFORE FIELD xrce036 name="input.b.page6.xrce036"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce036
            
            #add-point:AFTER FIELD xrce036 name="input.a.page6.xrce036"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce036
            #add-point:ON CHANGE xrce036 name="input.g.page6.xrce036"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce036_desc
            #add-point:BEFORE FIELD xrce036_desc name="input.b.page6.xrce036_desc"
            LET g_xrde6_d[l_ac].xrce036_desc = g_xrde6_d[l_ac].xrce036
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce036_desc
            
            #add-point:AFTER FIELD xrce036_desc name="input.a.page6.xrce036_desc"
            LET g_xrde6_d[l_ac].xrce036 = g_xrde6_d[l_ac].xrce036_desc
            CALL axrt400_xrde035_desc('281',g_xrde6_d[l_ac].xrce036) RETURNING g_xrde6_d[l_ac].xrce036_desc
            LET g_xrde6_d[l_ac].xrce036_desc = g_xrde6_d[l_ac].xrce036 CLIPPED,g_xrde6_d[l_ac].xrce036_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce036) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce036
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "apm-00093:sub-01302|axmi021|",cl_get_progname("axmi021",g_lang,"2"),"|:EXEPROGaxmi021"    #160318-00025#13
               LET g_chkparam.err_str[2] = "apm-00092:sub-01303|axmi021|",cl_get_progname("axmi021",g_lang,"2"),"|:EXEPROGaxmi021"    #160318-00025#13     
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oocq002_281") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde6_d[l_ac].xrce036 = g_xrde6_d_t.xrce036
                  LET g_xrde6_d[l_ac].xrce036_desc = g_xrde6_d_t.xrce036_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce036_desc
            #add-point:ON CHANGE xrce036_desc name="input.g.page6.xrce036_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce020
            #add-point:BEFORE FIELD xrce020 name="input.b.page6.xrce020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce020
            
            #add-point:AFTER FIELD xrce020 name="input.a.page6.xrce020"
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xrde6_d[l_ac].xrce020
            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='200' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xrde6_d[l_ac].xrce020_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xrde6_d[l_ac].xrce020_desc


            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce020
            #add-point:ON CHANGE xrce020 name="input.g.page6.xrce020"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce020_desc
            #add-point:BEFORE FIELD xrce020_desc name="input.b.page6.xrce020_desc"
            LET g_xrde6_d[l_ac].xrce020_desc = g_xrde6_d[l_ac].xrce020
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce020_desc
            
            #add-point:AFTER FIELD xrce020_desc name="input.a.page6.xrce020_desc"
            LET g_xrde6_d[l_ac].xrce020 = g_xrde6_d[l_ac].xrce020_desc
            CALL axrt400_xrde020_desc(g_xrde6_d[l_ac].xrce020) RETURNING g_xrde6_d[l_ac].xrce020_desc
            LET g_xrde6_d[l_ac].xrce020_desc = g_xrde6_d[l_ac].xrce020 CLIPPED,g_xrde6_d[l_ac].xrce020_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce020) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce020
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "anm-00081:sub-01302|aimi010|",cl_get_progname("aimi010",g_lang,"2"),"|:EXEPROGaimi010"    #160318-00025#13
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_rtax001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde6_d[l_ac].xrce020 = g_xrde6_d_t.xrce020
                  LET g_xrde6_d[l_ac].xrce020_desc = g_xrde6_d_t.xrce020_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce020_desc
            #add-point:ON CHANGE xrce020_desc name="input.g.page6.xrce020_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce022
            #add-point:BEFORE FIELD xrce022 name="input.b.page6.xrce022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce022
            
            #add-point:AFTER FIELD xrce022 name="input.a.page6.xrce022"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce022
            #add-point:ON CHANGE xrce022 name="input.g.page6.xrce022"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce022_desc
            #add-point:BEFORE FIELD xrce022_desc name="input.b.page6.xrce022_desc"
            LET g_xrde6_d[l_ac].xrce022_desc = g_xrde6_d[l_ac].xrce022
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce022_desc
            
            #add-point:AFTER FIELD xrce022_desc name="input.a.page6.xrce022_desc"
            LET g_xrde6_d[l_ac].xrce022 = g_xrde6_d[l_ac].xrce022_desc
            CALL axrt400_xrde022_desc(g_xrde6_d[l_ac].xrce022) RETURNING g_xrde6_d[l_ac].xrce022_desc
            LET g_xrde6_d[l_ac].xrce022_desc = g_xrde6_d[l_ac].xrce022 CLIPPED,g_xrde6_d[l_ac].xrce022_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce022) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce022
               LET g_errshow = TRUE   #160318-00025#13
               LET g_chkparam.err_str[1] = "apj-00012:sub-01302|apjm200|",cl_get_progname("apjm200",g_lang,"2"),"|:EXEPROGapjm200"    #160318-00025#13      
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pjba001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde6_d[l_ac].xrce022 = g_xrde6_d_t.xrce022
                  LET g_xrde6_d[l_ac].xrce022_desc = g_xrde6_d_t.xrce022_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce022_desc
            #add-point:ON CHANGE xrce022_desc name="input.g.page6.xrce022_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce023
            #add-point:BEFORE FIELD xrce023 name="input.b.page6.xrce023"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce023
            
            #add-point:AFTER FIELD xrce023 name="input.a.page6.xrce023"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce023
            #add-point:ON CHANGE xrce023 name="input.g.page6.xrce023"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce023_desc
            #add-point:BEFORE FIELD xrce023_desc name="input.b.page6.xrce023_desc"
            LET g_xrde6_d[l_ac].xrce023_desc = g_xrde6_d[l_ac].xrce023
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce023_desc
            
            #add-point:AFTER FIELD xrce023_desc name="input.a.page6.xrce023_desc"
            LET g_xrde6_d[l_ac].xrce023 = g_xrde6_d[l_ac].xrce023_desc
            CALL axrt400_xrde023_desc(g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023) RETURNING g_xrde6_d[l_ac].xrce023_desc
            LET g_xrde6_d[l_ac].xrce023_desc = g_xrde6_d[l_ac].xrce023 CLIPPED,g_xrde6_d[l_ac].xrce023_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce023) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce022
               LET g_chkparam.arg2 = g_xrde6_d[l_ac].xrce023
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pjbb002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde6_d[l_ac].xrce023 = g_xrde6_d_t.xrce023
                  LET g_xrde6_d[l_ac].xrce023_desc = g_xrde6_d_t.xrce023_desc
                  NEXT FIELD CURRENT
               END IF
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce023_desc
            #add-point:ON CHANGE xrce023_desc name="input.g.page6.xrce023_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce039
            #add-point:BEFORE FIELD xrce039 name="input.b.page6.xrce039"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce039
            
            #add-point:AFTER FIELD xrce039 name="input.a.page6.xrce039"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce039
            #add-point:ON CHANGE xrce039 name="input.g.page6.xrce039"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce040
            #add-point:BEFORE FIELD xrce040 name="input.b.page6.xrce040"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce040
            
            #add-point:AFTER FIELD xrce040 name="input.a.page6.xrce040"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce040
            #add-point:ON CHANGE xrce040 name="input.g.page6.xrce040"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce040_desc
            #add-point:BEFORE FIELD xrce040_desc name="input.b.page6.xrce040_desc"
            LET g_xrde6_d[l_ac].xrce040_desc = g_xrde6_d[l_ac].xrce040
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce040_desc
            
            #add-point:AFTER FIELD xrce040_desc name="input.a.page6.xrce040_desc"
            LET g_xrde6_d[l_ac].xrce040 = g_xrde6_d[l_ac].xrce040_desc
            CALL axrt400_xrde040_desc(g_xrde6_d[l_ac].xrce040) RETURNING g_xrde6_d[l_ac].xrce040_desc
            LET g_xrde6_d[l_ac].xrce040_desc = g_xrde6_d[l_ac].xrce040 CLIPPED,g_xrde6_d[l_ac].xrce040_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce040) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL    
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_xrde6_d[l_ac].xrce040
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_oojd001_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  LET g_xrde6_d[l_ac].xrce040 = g_xrde6_d_t.xrce040
                  LET g_xrde6_d[l_ac].xrce040_desc = g_xrde6_d_t.xrce040_desc
                  NEXT FIELD CURRENT
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce040_desc
            #add-point:ON CHANGE xrce040_desc name="input.g.page6.xrce040_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce042
            #add-point:BEFORE FIELD xrce042 name="input.b.page6.xrce042"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce042
            
            #add-point:AFTER FIELD xrce042 name="input.a.page6.xrce042"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce042
            #add-point:ON CHANGE xrce042 name="input.g.page6.xrce042"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce042_desc
            #add-point:BEFORE FIELD xrce042_desc name="input.b.page6.xrce042_desc"
            LET g_xrde6_d[l_ac].xrce042_desc = g_xrde6_d[l_ac].xrce042
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0171
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0171
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce042_desc
            
            #add-point:AFTER FIELD xrce042_desc name="input.a.page6.xrce042_desc"
            LET g_xrde6_d[l_ac].xrce042 = g_xrde6_d[l_ac].xrce042_desc
            DISPLAY '' TO xrce042_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce042) THEN
               CALL axrt400_free_account_chk(g_glad0171,g_xrde6_d[l_ac].xrce042,g_glad0172) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce042
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce042 = g_xrde6_d_t.xrce042
                  LET g_xrde6_d[l_ac].xrce042_desc = g_xrde6_d_t.xrce042_desc
                  DISPLAY g_xrde6_d[l_ac].xrce042_desc TO s_detail6[l_ac].xrce042_desc
                  NEXT FIELD xrce042_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0171,g_xrde6_d[l_ac].xrce042) RETURNING g_xrde6_d[l_ac].xrce042_desc
            LET g_xrde6_d[l_ac].xrce042_desc = g_xrde6_d[l_ac].xrce042 CLIPPED ,g_xrde6_d[l_ac].xrce042_desc
            DISPLAY g_xrde6_d[l_ac].xrce042_desc TO s_detail6[l_ac].xrce042_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce042_desc
            #add-point:ON CHANGE xrce042_desc name="input.g.page6.xrce042_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce043
            #add-point:BEFORE FIELD xrce043 name="input.b.page6.xrce043"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce043
            
            #add-point:AFTER FIELD xrce043 name="input.a.page6.xrce043"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce043
            #add-point:ON CHANGE xrce043 name="input.g.page6.xrce043"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce043_desc
            #add-point:BEFORE FIELD xrce043_desc name="input.b.page6.xrce043_desc"
            LET g_xrde6_d[l_ac].xrce043_desc = g_xrde6_d[l_ac].xrce043
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0181
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0181
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce043_desc
            
            #add-point:AFTER FIELD xrce043_desc name="input.a.page6.xrce043_desc"
            LET g_xrde6_d[l_ac].xrce043 = g_xrde6_d[l_ac].xrce043_desc
            DISPLAY '' TO xrce043_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce043) THEN
               CALL axrt400_free_account_chk(g_glad0181,g_xrde6_d[l_ac].xrce043,g_glad0182) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce043
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce043 = g_xrde6_d_t.xrce043
                  LET g_xrde6_d[l_ac].xrce043_desc = g_xrde6_d_t.xrce043_desc
                  DISPLAY g_xrde6_d[l_ac].xrce043_desc TO s_detail6[l_ac].xrce043_desc
                  NEXT FIELD xrce043_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0181,g_xrde6_d[l_ac].xrce043) RETURNING g_xrde6_d[l_ac].xrce043_desc
            LET g_xrde6_d[l_ac].xrce043_desc = g_xrde6_d[l_ac].xrce043 CLIPPED ,g_xrde6_d[l_ac].xrce043_desc
            DISPLAY g_xrde6_d[l_ac].xrce043_desc TO s_detail6[l_ac].xrce043_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce043_desc
            #add-point:ON CHANGE xrce043_desc name="input.g.page6.xrce043_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce044
            #add-point:BEFORE FIELD xrce044 name="input.b.page6.xrce044"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce044
            
            #add-point:AFTER FIELD xrce044 name="input.a.page6.xrce044"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce044
            #add-point:ON CHANGE xrce044 name="input.g.page6.xrce044"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce044_desc
            #add-point:BEFORE FIELD xrce044_desc name="input.b.page6.xrce044_desc"
            LET g_xrde6_d[l_ac].xrce044_desc = g_xrde6_d[l_ac].xrce044
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0191
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0191
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce044_desc
            
            #add-point:AFTER FIELD xrce044_desc name="input.a.page6.xrce044_desc"
            LET g_xrde6_d[l_ac].xrce044 = g_xrde6_d[l_ac].xrce044_desc
            DISPLAY '' TO xrce044_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce044) THEN
               CALL axrt400_free_account_chk(g_glad0191,g_xrde6_d[l_ac].xrce044,g_glad0192) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce044
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce044 = g_xrde6_d_t.xrce044
                  LET g_xrde6_d[l_ac].xrce044_desc = g_xrde6_d_t.xrce044_desc
                  DISPLAY g_xrde6_d[l_ac].xrce044_desc TO s_detail6[l_ac].xrce044_desc
                  NEXT FIELD xrce044_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0191,g_xrde6_d[l_ac].xrce044) RETURNING g_xrde6_d[l_ac].xrce044_desc
            LET g_xrde6_d[l_ac].xrce044_desc = g_xrde6_d[l_ac].xrce044 CLIPPED ,g_xrde6_d[l_ac].xrce044_desc
            DISPLAY g_xrde6_d[l_ac].xrce044_desc TO s_detail6[l_ac].xrce044_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce044_desc
            #add-point:ON CHANGE xrce044_desc name="input.g.page6.xrce044_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce045
            #add-point:BEFORE FIELD xrce045 name="input.b.page6.xrce045"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce045
            
            #add-point:AFTER FIELD xrce045 name="input.a.page6.xrce045"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce045
            #add-point:ON CHANGE xrce045 name="input.g.page6.xrce045"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce045_desc
            #add-point:BEFORE FIELD xrce045_desc name="input.b.page6.xrce045_desc"
            LET g_xrde6_d[l_ac].xrce045_desc = g_xrde6_d[l_ac].xrce045
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0201
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0201
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce045_desc
            
            #add-point:AFTER FIELD xrce045_desc name="input.a.page6.xrce045_desc"
            LET g_xrde6_d[l_ac].xrce045 = g_xrde6_d[l_ac].xrce045_desc
            DISPLAY '' TO xrce045_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce045) THEN
               CALL axrt400_free_account_chk(g_glad0201,g_xrde6_d[l_ac].xrce045,g_glad0202) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce045
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce045 = g_xrde6_d_t.xrce045
                  LET g_xrde6_d[l_ac].xrce045_desc = g_xrde6_d_t.xrce045_desc
                  DISPLAY g_xrde6_d[l_ac].xrce045_desc TO s_detail6[l_ac].xrce045_desc
                  NEXT FIELD xrce045_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0201,g_xrde6_d[l_ac].xrce045) RETURNING g_xrde6_d[l_ac].xrce045_desc
            LET g_xrde6_d[l_ac].xrce045_desc = g_xrde6_d[l_ac].xrce045 CLIPPED ,g_xrde6_d[l_ac].xrce045_desc
            DISPLAY g_xrde6_d[l_ac].xrce045_desc TO s_detail6[l_ac].xrce045_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce045_desc
            #add-point:ON CHANGE xrce045_desc name="input.g.page6.xrce045_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce046
            #add-point:BEFORE FIELD xrce046 name="input.b.page6.xrce046"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce046
            
            #add-point:AFTER FIELD xrce046 name="input.a.page6.xrce046"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce046
            #add-point:ON CHANGE xrce046 name="input.g.page6.xrce046"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce046_desc
            #add-point:BEFORE FIELD xrce046_desc name="input.b.page6.xrce046_desc"
            LET g_xrde6_d[l_ac].xrce046_desc = g_xrde6_d[l_ac].xrce046
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0211
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0211
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce046_desc
            
            #add-point:AFTER FIELD xrce046_desc name="input.a.page6.xrce046_desc"
            LET g_xrde6_d[l_ac].xrce046 = g_xrde6_d[l_ac].xrce046_desc
            DISPLAY '' TO xrce046_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce046) THEN
               CALL axrt400_free_account_chk(g_glad0211,g_xrde6_d[l_ac].xrce046,g_glad0212) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce046
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce046 = g_xrde6_d_t.xrce046
                  LET g_xrde6_d[l_ac].xrce046_desc = g_xrde6_d_t.xrce046_desc
                  DISPLAY g_xrde6_d[l_ac].xrce046_desc TO s_detail6[l_ac].xrce046_desc
                  NEXT FIELD xrce046_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0211,g_xrde6_d[l_ac].xrce046) RETURNING g_xrde6_d[l_ac].xrce046_desc
            LET g_xrde6_d[l_ac].xrce046_desc = g_xrde6_d[l_ac].xrce046 CLIPPED ,g_xrde6_d[l_ac].xrce046_desc
            DISPLAY g_xrde6_d[l_ac].xrce046_desc TO s_detail6[l_ac].xrce046_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce046_desc
            #add-point:ON CHANGE xrce046_desc name="input.g.page6.xrce046_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce047
            #add-point:BEFORE FIELD xrce047 name="input.b.page6.xrce047"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce047
            
            #add-point:AFTER FIELD xrce047 name="input.a.page6.xrce047"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce047
            #add-point:ON CHANGE xrce047 name="input.g.page6.xrce047"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce047_desc
            #add-point:BEFORE FIELD xrce047_desc name="input.b.page6.xrce047_desc"
            LET g_xrde6_d[l_ac].xrce047_desc = g_xrde6_d[l_ac].xrce047
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0221
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0221
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce047_desc
            
            #add-point:AFTER FIELD xrce047_desc name="input.a.page6.xrce047_desc"
            LET g_xrde6_d[l_ac].xrce047 = g_xrde6_d[l_ac].xrce047_desc
            DISPLAY '' TO xrce047_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce047) THEN
               CALL axrt400_free_account_chk(g_glad0221,g_xrde6_d[l_ac].xrce047,g_glad0222) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce047
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce047 = g_xrde6_d_t.xrce047
                  LET g_xrde6_d[l_ac].xrce047_desc = g_xrde6_d_t.xrce047_desc
                  DISPLAY g_xrde6_d[l_ac].xrce047_desc TO s_detail6[l_ac].xrce047_desc
                  NEXT FIELD xrce047_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0221,g_xrde6_d[l_ac].xrce047) RETURNING g_xrde6_d[l_ac].xrce047_desc
            LET g_xrde6_d[l_ac].xrce047_desc = g_xrde6_d[l_ac].xrce047 CLIPPED ,g_xrde6_d[l_ac].xrce047_desc
            DISPLAY g_xrde6_d[l_ac].xrce047_desc TO s_detail6[l_ac].xrce047_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce047_desc
            #add-point:ON CHANGE xrce047_desc name="input.g.page6.xrce047_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce048
            #add-point:BEFORE FIELD xrce048 name="input.b.page6.xrce048"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce048
            
            #add-point:AFTER FIELD xrce048 name="input.a.page6.xrce048"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce048
            #add-point:ON CHANGE xrce048 name="input.g.page6.xrce048"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce048_desc
            #add-point:BEFORE FIELD xrce048_desc name="input.b.page6.xrce048_desc"
            LET g_xrde6_d[l_ac].xrce048_desc = g_xrde6_d[l_ac].xrce048
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0231
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0231
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce048_desc
            
            #add-point:AFTER FIELD xrce048_desc name="input.a.page6.xrce048_desc"
            LET g_xrde6_d[l_ac].xrce048 = g_xrde6_d[l_ac].xrce048_desc
            DISPLAY '' TO xrce048_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce048) THEN
               CALL axrt400_free_account_chk(g_glad0231,g_xrde6_d[l_ac].xrce048,g_glad0232) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce048
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce048 = g_xrde6_d_t.xrce048
                  LET g_xrde6_d[l_ac].xrce048_desc = g_xrde6_d_t.xrce048_desc
                  DISPLAY g_xrde6_d[l_ac].xrce048_desc TO s_detail6[l_ac].xrce048_desc
                  NEXT FIELD xrce048_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0231,g_xrde6_d[l_ac].xrce048) RETURNING g_xrde6_d[l_ac].xrce048_desc
            LET g_xrde6_d[l_ac].xrce048_desc = g_xrde6_d[l_ac].xrce048 CLIPPED ,g_xrde6_d[l_ac].xrce048_desc
            DISPLAY g_xrde6_d[l_ac].xrce048_desc TO s_detail6[l_ac].xrce048_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce048_desc
            #add-point:ON CHANGE xrce048_desc name="input.g.page6.xrce048_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce049
            #add-point:BEFORE FIELD xrce049 name="input.b.page6.xrce049"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce049
            
            #add-point:AFTER FIELD xrce049 name="input.a.page6.xrce049"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce049
            #add-point:ON CHANGE xrce049 name="input.g.page6.xrce049"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce049_desc
            #add-point:BEFORE FIELD xrce049_desc name="input.b.page6.xrce049_desc"
            LET g_xrde6_d[l_ac].xrce049_desc = g_xrde6_d[l_ac].xrce049
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0241
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0241
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce049_desc
            
            #add-point:AFTER FIELD xrce049_desc name="input.a.page6.xrce049_desc"
            LET g_xrde6_d[l_ac].xrce049 = g_xrde6_d[l_ac].xrce049_desc
            DISPLAY '' TO xrce049_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce049) THEN
               CALL axrt400_free_account_chk(g_glad0241,g_xrde6_d[l_ac].xrce049,g_glad0242) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce049
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce049 = g_xrde6_d_t.xrce049
                  LET g_xrde6_d[l_ac].xrce049_desc = g_xrde6_d_t.xrce049_desc
                  DISPLAY g_xrde6_d[l_ac].xrce049_desc TO s_detail6[l_ac].xrce049_desc
                  NEXT FIELD xrce049_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0241,g_xrde6_d[l_ac].xrce049) RETURNING g_xrde6_d[l_ac].xrce049_desc
            LET g_xrde6_d[l_ac].xrce049_desc = g_xrde6_d[l_ac].xrce049 CLIPPED ,g_xrde6_d[l_ac].xrce049_desc
            DISPLAY g_xrde6_d[l_ac].xrce049_desc TO s_detail6[l_ac].xrce049_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce049_desc
            #add-point:ON CHANGE xrce049_desc name="input.g.page6.xrce049_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce050
            #add-point:BEFORE FIELD xrce050 name="input.b.page6.xrce050"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce050
            
            #add-point:AFTER FIELD xrce050 name="input.a.page6.xrce050"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce050
            #add-point:ON CHANGE xrce050 name="input.g.page6.xrce050"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce050_desc
            #add-point:BEFORE FIELD xrce050_desc name="input.b.page6.xrce050_desc"
            LET g_xrde6_d[l_ac].xrce050_desc = g_xrde6_d[l_ac].xrce050
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0251
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0251
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce050_desc
            
            #add-point:AFTER FIELD xrce050_desc name="input.a.page6.xrce050_desc"
            LET g_xrde6_d[l_ac].xrce050 = g_xrde6_d[l_ac].xrce050_desc
            DISPLAY '' TO xrce050_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce050) THEN
               CALL axrt400_free_account_chk(g_glad0251,g_xrde6_d[l_ac].xrce050,g_glad0252) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce050
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce050 = g_xrde6_d_t.xrce050
                  LET g_xrde6_d[l_ac].xrce050_desc = g_xrde6_d_t.xrce050_desc
                  DISPLAY g_xrde6_d[l_ac].xrce050_desc TO s_detail6[l_ac].xrce050_desc
                  NEXT FIELD xrce050_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0251,g_xrde6_d[l_ac].xrce050) RETURNING g_xrde6_d[l_ac].xrce050_desc
            LET g_xrde6_d[l_ac].xrce050_desc = g_xrde6_d[l_ac].xrce050 CLIPPED ,g_xrde6_d[l_ac].xrce050_desc
            DISPLAY g_xrde6_d[l_ac].xrce050_desc TO s_detail6[l_ac].xrce050_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce050_desc
            #add-point:ON CHANGE xrce050_desc name="input.g.page6.xrce050_desc"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce051
            #add-point:BEFORE FIELD xrce051 name="input.b.page6.xrce051"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce051
            
            #add-point:AFTER FIELD xrce051 name="input.a.page6.xrce051"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce051
            #add-point:ON CHANGE xrce051 name="input.g.page6.xrce051"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xrce051_desc
            #add-point:BEFORE FIELD xrce051_desc name="input.b.page6.xrce051_desc"
            LET g_xrde6_d[l_ac].xrce051_desc = g_xrde6_d[l_ac].xrce051
            #当来源类型为1时，开窗为agli041的开窗查询代码值，为2时，开q_glaf002,为3时不给开窗
            LET g_glae002 = ''
            LET g_glae009 = ''
            SELECT glae002 INTO g_glae002 FROM glae_t
             WHERE glaeent = g_enterprise
               AND glae001 = g_glad0261
             IF g_glae002 = '1' THEN
                SELECT glae009 INTO g_glae009 FROM glae_t
                 WHERE glaeent = g_enterprise
                   AND glae001 = g_glad0261
             END IF 
             IF g_glae002 = '2' THEN
                LET g_glae009 = 'q_glaf002'
             END IF 
             
             IF g_glae002 = '3' THEN
                LET g_glae009 = ''
             END IF
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xrce051_desc
            
            #add-point:AFTER FIELD xrce051_desc name="input.a.page6.xrce051_desc"
            LET g_xrde6_d[l_ac].xrce051 = g_xrde6_d[l_ac].xrce051_desc
            DISPLAY '' TO xrce051_desc
            IF NOT cl_null(g_xrde6_d[l_ac].xrce051) THEN
               CALL axrt400_free_account_chk(g_glad0261,g_xrde6_d[l_ac].xrce051,g_glad0262) RETURNING l_errno
               IF NOT cl_null(l_errno) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = l_errno
                  LET g_errparam.extend = g_xrde6_d[l_ac].xrce051
                  #160318-00005#54 --s add
                  CASE l_errno
                     WHEN 'sub-01302'
                        LET g_errparam.replace[1] = 'agli041'
                        LET g_errparam.replace[2] = cl_get_progname('agli041',g_lang,"2")
                        LET g_errparam.exeprog = 'agli041'
                  END CASE
                  #160318-00005#54 --e add
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xrde6_d[l_ac].xrce051 = g_xrde6_d_t.xrce051
                  LET g_xrde6_d[l_ac].xrce051_desc = g_xrde6_d_t.xrce051_desc
                  DISPLAY g_xrde6_d[l_ac].xrce051_desc TO s_detail6[l_ac].xrce051_desc
                  NEXT FIELD xrce051_desc
               END IF
            END IF
            CALL axrt400_free_account_desc(g_glad0261,g_xrde6_d[l_ac].xrce051) RETURNING g_xrde6_d[l_ac].xrce051_desc
            LET g_xrde6_d[l_ac].xrce051_desc = g_xrde6_d[l_ac].xrce051 CLIPPED ,g_xrde6_d[l_ac].xrce051_desc
            DISPLAY g_xrde6_d[l_ac].xrce051_desc TO s_detail6[l_ac].xrce051_desc
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xrce051_desc
            #add-point:ON CHANGE xrce051_desc name="input.g.page6.xrce051_desc"
            
            #END add-point 
 
 
 
                  #Ctrlp:input.c.page6.xrce017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce017
            #add-point:ON ACTION controlp INFIELD xrce017 name="input.c.page6.xrce017"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce017             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s

            
            CALL q_ooag001()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce017 = g_qryparam.return1              

            DISPLAY g_xrde6_d[l_ac].xrce017 TO xrce017              #

            NEXT FIELD xrce017                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce017_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce017_desc
            #add-point:ON ACTION controlp INFIELD xrce017_desc name="input.c.page6.xrce017_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce017             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_ooag001_8()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce017 = g_qryparam.return1              
            CALL axrt400_xrde017_desc(g_xrde6_d[l_ac].xrce017) RETURNING g_xrde6_d[l_ac].xrce017_desc
            LET g_xrde6_d[l_ac].xrce017_desc = g_xrde6_d[l_ac].xrce017 CLIPPED,g_xrde6_d[l_ac].xrce017_desc
            DISPLAY g_xrde6_d[l_ac].xrce017_desc TO xrce017_desc              #

            NEXT FIELD xrce017_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce018
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce018
            #add-point:ON ACTION controlp INFIELD xrce018 name="input.c.page6.xrce018"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce018_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce018_desc
            #add-point:ON ACTION controlp INFIELD xrce018_desc name="input.c.page6.xrce018_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce018             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_xrda_m.xrdadocdt

            
            CALL q_ooeg001_4()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce018 = g_qryparam.return1              
            CALL axrt400_xrde018_desc(g_xrde6_d[l_ac].xrce018) RETURNING g_xrde6_d[l_ac].xrce018_desc
            LET g_xrde6_d[l_ac].xrce018_desc = g_xrde6_d[l_ac].xrce018 CLIPPED,g_xrde6_d[l_ac].xrce018_desc
            DISPLAY g_xrde6_d[l_ac].xrce018_desc TO xrce018_desc              #

            NEXT FIELD xrce018_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce019
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce019
            #add-point:ON ACTION controlp INFIELD xrce019 name="input.c.page6.xrce019"
 
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce019_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce019_desc
            #add-point:ON ACTION controlp INFIELD xrce019_desc name="input.c.page6.xrce019_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce019             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_today

            
            CALL q_ooeg001_10()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce019 = g_qryparam.return1              
            CALL axrt400_xrde018_desc(g_xrde6_d[l_ac].xrce019) RETURNING g_xrde6_d[l_ac].xrce019_desc
            LET g_xrde6_d[l_ac].xrce019_desc = g_xrde6_d[l_ac].xrce019 CLIPPED,g_xrde6_d[l_ac].xrce019_desc
            DISPLAY g_xrde6_d[l_ac].xrce019_desc TO xrce019_desc              #

            NEXT FIELD xrce019_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce035
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce035
            #add-point:ON ACTION controlp INFIELD xrce035 name="input.c.page6.xrce035"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce035_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce035_desc
            #add-point:ON ACTION controlp INFIELD xrce035_desc name="input.c.page6.xrce035_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce035             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_oocq002_287()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce035 = g_qryparam.return1              
            CALL axrt400_xrde035_desc('287',g_xrde6_d[l_ac].xrce035) RETURNING g_xrde6_d[l_ac].xrce035_desc
            LET g_xrde6_d[l_ac].xrce035_desc = g_xrde6_d[l_ac].xrce035 CLIPPED,g_xrde6_d[l_ac].xrce035_desc
            DISPLAY g_xrde6_d[l_ac].xrce035_desc TO xrce035_desc              #

            NEXT FIELD xrce035_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce036
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce036
            #add-point:ON ACTION controlp INFIELD xrce036 name="input.c.page6.xrce036"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce036_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce036_desc
            #add-point:ON ACTION controlp INFIELD xrce036_desc name="input.c.page6.xrce036_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce036             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_oocq002_281()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce036 = g_qryparam.return1              
            CALL axrt400_xrde035_desc('281',g_xrde6_d[l_ac].xrce036) RETURNING g_xrde6_d[l_ac].xrce036_desc
            LET g_xrde6_d[l_ac].xrce036_desc = g_xrde6_d[l_ac].xrce036 CLIPPED,g_xrde6_d[l_ac].xrce036_desc
            DISPLAY g_xrde6_d[l_ac].xrce036_desc TO xrce036_desc              #

            NEXT FIELD xrce036_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce020
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce020
            #add-point:ON ACTION controlp INFIELD xrce020 name="input.c.page6.xrce020"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce020_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce020_desc
            #add-point:ON ACTION controlp INFIELD xrce020_desc name="input.c.page6.xrce020_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce020             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_rtax001()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce020 = g_qryparam.return1              
            CALL axrt400_xrde020_desc(g_xrde6_d[l_ac].xrce020) RETURNING g_xrde6_d[l_ac].xrce020_desc
            LET g_xrde6_d[l_ac].xrce020_desc = g_xrde6_d[l_ac].xrce020 CLIPPED,g_xrde6_d[l_ac].xrce020_desc
            DISPLAY g_xrde6_d[l_ac].xrce020_desc TO xrce020_desc              #

            NEXT FIELD xrce020_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce022
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce022
            #add-point:ON ACTION controlp INFIELD xrce022 name="input.c.page6.xrce022"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce022_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce022_desc
            #add-point:ON ACTION controlp INFIELD xrce022_desc name="input.c.page6.xrce022_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce022             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_pjba001()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce022 = g_qryparam.return1              
            CALL axrt400_xrde022_desc(g_xrde6_d[l_ac].xrce022) RETURNING g_xrde6_d[l_ac].xrce022_desc
            LET g_xrde6_d[l_ac].xrce022_desc = g_xrde6_d[l_ac].xrce022 CLIPPED,g_xrde6_d[l_ac].xrce022_desc
            DISPLAY g_xrde6_d[l_ac].xrce022_desc TO xrce022_desc              #

            NEXT FIELD xrce022_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce023
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce023
            #add-point:ON ACTION controlp INFIELD xrce023 name="input.c.page6.xrce023"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce023_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce023_desc
            #add-point:ON ACTION controlp INFIELD xrce023_desc name="input.c.page6.xrce023_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce023             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_xrde6_d[l_ac].xrce022

            
            CALL q_pjbb002_2()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce023 = g_qryparam.return1              
            CALL axrt400_xrde023_desc(g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023) RETURNING g_xrde6_d[l_ac].xrce023_desc
            LET g_xrde6_d[l_ac].xrce023_desc = g_xrde6_d[l_ac].xrce023 CLIPPED,g_xrde6_d[l_ac].xrce023_desc
            DISPLAY g_xrde6_d[l_ac].xrce023_desc TO xrce023_desc              #

            NEXT FIELD xrce023_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce039
            #add-point:ON ACTION controlp INFIELD xrce039 name="input.c.page6.xrce039"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce040
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce040
            #add-point:ON ACTION controlp INFIELD xrce040 name="input.c.page6.xrce040"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce040_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce040_desc
            #add-point:ON ACTION controlp INFIELD xrce040_desc name="input.c.page6.xrce040_desc"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce040             #給予default值

            #給予arg
            LET g_qryparam.arg1 = ''

            
            CALL q_oojd001_2()                                #呼叫開窗

            LET g_xrde6_d[l_ac].xrce040 = g_qryparam.return1              
            CALL axrt400_xrde040_desc(g_xrde6_d[l_ac].xrce040) RETURNING g_xrde6_d[l_ac].xrce040_desc
            LET g_xrde6_d[l_ac].xrce040_desc = g_xrde6_d[l_ac].xrce040 CLIPPED,g_xrde6_d[l_ac].xrce040_desc
            DISPLAY g_xrde6_d[l_ac].xrce040_desc TO xrce040_desc              #

            NEXT FIELD xrce040_desc                          #返回原欄位
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce042
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce042
            #add-point:ON ACTION controlp INFIELD xrce042 name="input.c.page6.xrce042"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce042_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce042_desc
            #add-point:ON ACTION controlp INFIELD xrce042_desc name="input.c.page6.xrce042_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce042             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0171,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce042 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0171,g_xrde6_d[l_ac].xrce042) RETURNING g_xrde6_d[l_ac].xrce042_desc
               LET g_xrde6_d[l_ac].xrce042_desc = g_xrde6_d[l_ac].xrce042 CLIPPED ,g_xrde6_d[l_ac].xrce042_desc
               DISPLAY g_xrde6_d[l_ac].xrce042_desc TO s_detail6[l_ac].xrce042_desc    #說明
               NEXT FIELD xrce042_desc                          #返回原欄位
            END IF 
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce043
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce043
            #add-point:ON ACTION controlp INFIELD xrce043 name="input.c.page6.xrce043"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce043_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce043_desc
            #add-point:ON ACTION controlp INFIELD xrce043_desc name="input.c.page6.xrce043_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce043             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0181,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce043 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0181,g_xrde6_d[l_ac].xrce043) RETURNING g_xrde6_d[l_ac].xrce043_desc
               LET g_xrde6_d[l_ac].xrce043_desc = g_xrde6_d[l_ac].xrce043 CLIPPED ,g_xrde6_d[l_ac].xrce043_desc
               DISPLAY g_xrde6_d[l_ac].xrce043_desc TO s_detail6[l_ac].xrce043_desc    #說明
               NEXT FIELD xrce043_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce044
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce044
            #add-point:ON ACTION controlp INFIELD xrce044 name="input.c.page6.xrce044"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce044_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce044_desc
            #add-point:ON ACTION controlp INFIELD xrce044_desc name="input.c.page6.xrce044_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce044             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0191,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce044 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0191,g_xrde6_d[l_ac].xrce044) RETURNING g_xrde6_d[l_ac].xrce044_desc
               LET g_xrde6_d[l_ac].xrce044_desc = g_xrde6_d[l_ac].xrce044 CLIPPED ,g_xrde6_d[l_ac].xrce044_desc
               DISPLAY g_xrde6_d[l_ac].xrce044_desc TO s_detail6[l_ac].xrce044_desc    #說明
               NEXT FIELD xrce044_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce045
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce045
            #add-point:ON ACTION controlp INFIELD xrce045 name="input.c.page6.xrce045"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce045_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce045_desc
            #add-point:ON ACTION controlp INFIELD xrce045_desc name="input.c.page6.xrce045_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce045             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0201,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce045 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0201,g_xrde6_d[l_ac].xrce045) RETURNING g_xrde6_d[l_ac].xrce045_desc
               LET g_xrde6_d[l_ac].xrce045_desc = g_xrde6_d[l_ac].xrce045 CLIPPED ,g_xrde6_d[l_ac].xrce045_desc
               DISPLAY g_xrde6_d[l_ac].xrce045_desc TO s_detail6[l_ac].xrce045_desc    #說明
               NEXT FIELD xrce045_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce046
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce046
            #add-point:ON ACTION controlp INFIELD xrce046 name="input.c.page6.xrce046"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce046_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce046_desc
            #add-point:ON ACTION controlp INFIELD xrce046_desc name="input.c.page6.xrce046_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce046             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0211,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce046 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0211,g_xrde6_d[l_ac].xrce046) RETURNING g_xrde6_d[l_ac].xrce046_desc
               LET g_xrde6_d[l_ac].xrce046_desc = g_xrde6_d[l_ac].xrce046 CLIPPED ,g_xrde6_d[l_ac].xrce046_desc
               DISPLAY g_xrde6_d[l_ac].xrce046_desc TO s_detail6[l_ac].xrce046_desc    #說明
               NEXT FIELD xrce046_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce047
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce047
            #add-point:ON ACTION controlp INFIELD xrce047 name="input.c.page6.xrce047"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce047_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce047_desc
            #add-point:ON ACTION controlp INFIELD xrce047_desc name="input.c.page6.xrce047_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce047             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0221,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce047 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0221,g_xrde6_d[l_ac].xrce047) RETURNING g_xrde6_d[l_ac].xrce047_desc
               LET g_xrde6_d[l_ac].xrce047_desc = g_xrde6_d[l_ac].xrce047 CLIPPED ,g_xrde6_d[l_ac].xrce047_desc
               DISPLAY g_xrde6_d[l_ac].xrce047_desc TO s_detail6[l_ac].xrce047_desc    #說明
               NEXT FIELD xrce047_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce048
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce048
            #add-point:ON ACTION controlp INFIELD xrce048 name="input.c.page6.xrce048"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce048_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce048_desc
            #add-point:ON ACTION controlp INFIELD xrce048_desc name="input.c.page6.xrce048_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce048             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0231,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce048 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0231,g_xrde6_d[l_ac].xrce048) RETURNING g_xrde6_d[l_ac].xrce048_desc
               LET g_xrde6_d[l_ac].xrce048_desc = g_xrde6_d[l_ac].xrce048 CLIPPED ,g_xrde6_d[l_ac].xrce048_desc
               DISPLAY g_xrde6_d[l_ac].xrce048_desc TO s_detail6[l_ac].xrce048_desc    #說明
               NEXT FIELD xrce048_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce049
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce049
            #add-point:ON ACTION controlp INFIELD xrce049 name="input.c.page6.xrce049"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce049_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce049_desc
            #add-point:ON ACTION controlp INFIELD xrce049_desc name="input.c.page6.xrce049_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce049             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0241,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce049 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0241,g_xrde6_d[l_ac].xrce049) RETURNING g_xrde6_d[l_ac].xrce049_desc
               LET g_xrde6_d[l_ac].xrce049_desc = g_xrde6_d[l_ac].xrce049 CLIPPED ,g_xrde6_d[l_ac].xrce049_desc
               DISPLAY g_xrde6_d[l_ac].xrce049_desc TO s_detail6[l_ac].xrce049_desc    #說明
               NEXT FIELD xrce049_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce050
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce050
            #add-point:ON ACTION controlp INFIELD xrce050 name="input.c.page6.xrce050"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce050_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce050_desc
            #add-point:ON ACTION controlp INFIELD xrce050_desc name="input.c.page6.xrce050_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce050             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0251,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce050 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0251,g_xrde6_d[l_ac].xrce050) RETURNING g_xrde6_d[l_ac].xrce050_desc
               LET g_xrde6_d[l_ac].xrce050_desc = g_xrde6_d[l_ac].xrce050 CLIPPED ,g_xrde6_d[l_ac].xrce050_desc
               DISPLAY g_xrde6_d[l_ac].xrce050_desc TO s_detail6[l_ac].xrce050_desc    #說明
               NEXT FIELD xrce050_desc                          #返回原欄位
            END IF
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce051
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce051
            #add-point:ON ACTION controlp INFIELD xrce051 name="input.c.page6.xrce051"
            
            #END add-point
 
 
         #Ctrlp:input.c.page6.xrce051_desc
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xrce051_desc
            #add-point:ON ACTION controlp INFIELD xrce051_desc name="input.c.page6.xrce051_desc"
            IF NOT cl_null(g_glae009) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.state = "i"
               LET g_qryparam.default1 = g_xrde6_d[l_ac].xrce051             #給予default值
               
               #給予arg
               IF g_glae009 = 'q_glaf002' THEN    
                  LET g_qryparam.where = "glaf001 = '",g_glad0261,"'" #自由核算項類型
               END IF 
               CALL q_agli041(g_glae009)                                #呼叫開窗
            
               LET g_xrde6_d[l_ac].xrce051 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL axrt400_free_account_desc(g_glad0261,g_xrde6_d[l_ac].xrce051) RETURNING g_xrde6_d[l_ac].xrce051_desc
               LET g_xrde6_d[l_ac].xrce051_desc = g_xrde6_d[l_ac].xrce051 CLIPPED ,g_xrde6_d[l_ac].xrce051_desc
               DISPLAY g_xrde6_d[l_ac].xrce051_desc TO s_detail6[l_ac].xrce051_desc    #說明
               NEXT FIELD xrce051_desc                          #返回原欄位
            END IF
            #END add-point
 
 
 
 
         AFTER ROW
            #add-point:單身page6 after_row name="input.body6.after_row"
            
            #end add-point
            LET l_ac = ARR_CURR()
            IF INT_FLAG THEN
               LET INT_FLAG = 0
               IF l_cmd = 'u' THEN
                  LET g_xrde6_d[l_ac].* = g_xrde6_d_t.*
               END IF
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CLOSE axrt400_bcl2
               CALL s_transaction_end('N','0')
               CALL cl_err()
               EXIT DIALOG 
            END IF
            
            #其他table進行unlock
            
            CALL axrt400_unlock_b("xrce_t","'6'")
            CALL s_transaction_end('Y','0')
            #add-point:單身page6 after_row2 name="input.body6.after_row2"
            
            #end add-point
 
         AFTER INPUT
            #add-point:input段after input  name="input.body6.after_input"
            
            #end add-point   
    
         ON ACTION controlo
            IF l_insert THEN
               LET li_reproduce = l_ac_t
               LET li_reproduce_target = l_ac
               LET g_xrde4_d[li_reproduce_target].* = g_xrde4_d[li_reproduce].*
               LET g_xrde5_d[li_reproduce_target].* = g_xrde5_d[li_reproduce].*
               LET g_xrde6_d[li_reproduce_target].* = g_xrde6_d[li_reproduce].*
 
               LET g_xrde6_d[li_reproduce_target].xrceseq = NULL
            ELSE
               CALL FGL_SET_ARR_CURR(g_xrde6_d.getLength()+1)
               LET lb_reproduce = TRUE
               LET li_reproduce = l_ac
               LET li_reproduce_target = g_xrde6_d.getLength()+1
            END IF
            
      END INPUT
 
      
 
 
 
 
{</section>}
 
{<section id="axrt400.input.other" >}
      
      #add-point:自定義input name="input.more_input"
      
      #end add-point
    
      BEFORE DIALOG 
         #CALL cl_err_collect_init()    
         #add-point:input段before dialog name="input.before_dialog"
         IF p_cmd = 'a' THEN
            NEXT FIELD xrdasite
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD xrdeseq
               WHEN "s_detail2"
                  NEXT FIELD xrdeseq_2
               WHEN "s_detail3"
                  NEXT FIELD xrdeseq_3
               WHEN "s_detail4"
                  NEXT FIELD xrceseq
               WHEN "s_detail5"
                  NEXT FIELD xrceseq_5
               WHEN "s_detail6"
                  NEXT FIELD xrceseq_6
 
               #add-point:input段modify_detail 

               #end add-point  
            END CASE
         END IF
         #end add-point    
         #重新導回資料到正確位置上
         CALL DIALOG.setCurrentRow("s_detail1",g_idx_group.getValue("'1','2','3',"))      
         CALL DIALOG.setCurrentRow("s_detail2",g_idx_group.getValue("'4','5','6',"))
         CALL DIALOG.setCurrentRow("s_detail3",g_idx_group.getValue(""))
         CALL DIALOG.setCurrentRow("s_detail4",g_idx_group.getValue(""))
         CALL DIALOG.setCurrentRow("s_detail5",g_idx_group.getValue(""))
         CALL DIALOG.setCurrentRow("s_detail6",g_idx_group.getValue(""))
 
         #新增時強制從單頭開始填
         IF p_cmd = 'a' THEN
            #add-point:input段next_field name="input.next_field"
            
            #end add-point  
            NEXT FIELD xrdald
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD xrdeseq
               WHEN "s_detail2"
                  NEXT FIELD xrdeseq_2
               WHEN "s_detail3"
                  NEXT FIELD xrdeseq_3
               WHEN "s_detail4"
                  NEXT FIELD xrceseq
               WHEN "s_detail5"
                  NEXT FIELD xrceseq_5
               WHEN "s_detail6"
                  NEXT FIELD xrceseq_6
 
               #add-point:input段modify_detail  name="input.modify_detail.other"
               
               #end add-point  
            END CASE
         END IF
      
      AFTER DIALOG
         #add-point:input段after_dialog name="input.after_dialog"
         
         #end add-point    
         
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         IF g_header_hidden THEN
            CALL gfrm_curr.setElementHidden("vb_master",0)
            CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
            LET g_header_hidden = 0     #visible
         ELSE
            CALL gfrm_curr.setElementHidden("vb_master",1)
            CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
            LET g_header_hidden = 1     #hidden     
         END IF
 
      ON ACTION accept
         #add-point:input段accept  name="input.accept"
         
         #end add-point    
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         #add-point:input段cancel name="input.cancel"
         
         #end add-point  
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
         LET g_detail_idx_list[4] = 1
         LET g_detail_idx_list[5] = 1
         LET g_detail_idx_list[6] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail3",1)
         CALL g_curr_diag.setCurrentRow("s_detail4",1)
         CALL g_curr_diag.setCurrentRow("s_detail5",1)
         CALL g_curr_diag.setCurrentRow("s_detail6",1)
 
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         #add-point:input段close name="input.close"
         
         #end add-point  
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         #add-point:input段exit name="input.exit"
         
         #end add-point
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         #各個page指標
         LET g_detail_idx_list[1] = 1 
         LET g_detail_idx_list[2] = 1
         LET g_detail_idx_list[3] = 1
         LET g_detail_idx_list[4] = 1
         LET g_detail_idx_list[5] = 1
         LET g_detail_idx_list[6] = 1
 
         CALL g_curr_diag.setCurrentRow("s_detail1",1)    
         CALL g_curr_diag.setCurrentRow("s_detail2",1)
         CALL g_curr_diag.setCurrentRow("s_detail3",1)
         CALL g_curr_diag.setCurrentRow("s_detail4",1)
         CALL g_curr_diag.setCurrentRow("s_detail5",1)
         CALL g_curr_diag.setCurrentRow("s_detail6",1)
 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
    
   #add-point:input段after input  name="input.after_input"
   IF l_flag = 'Y' THEN
      CONTINUE WHILE
   ELSE
      IF NOT INT_FLAG THEN
         LET g_amt = 0
         CALL axrt400_ref_amt()
         IF g_amt <> 0 THEN
            IF g_amt > 0 THEN
               CALL axrt400_09('1',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
            ELSE
               LET g_amt = g_amt * -1
               CALL axrt400_09('2',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
            END IF
            CALL axrt400_show()
         END IF
         
         CALL axrt400_update_xrda()
         
         CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno )
         RETURNING l_success,l_slip            
            
         #是否抛傳票    
         SELECT ooac004 INTO l_ooac004
           FROM ooac_t
          WHERE ooacent = g_enterprise
            AND ooac001 = g_glaa_t.glaa024
            AND ooac002 = l_slip
            AND ooac003 = 'D-FIN-0030'  
         
         IF g_glaa_t.glaa121 = 'Y' AND l_ooac004 = 'Y' THEN 
            CALL s_transaction_begin()
            CALL cl_err_collect_init()
            
            CALL s_pre_voucher_ins('AR','R20',g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,'2') RETURNING l_success
            
            IF l_success THEN
               CALL s_transaction_end('Y','0')
               CALL cl_err_collect_show()    #150812-00010#2
            ELSE
               CALL s_transaction_end('N','0') 
               CALL cl_err_collect_show()      
            END IF
         END IF
         
         #151125-00006#1--add--s
         CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno) RETURNING l_success,l_ooba002
         CALL s_fin_get_doc_para(g_xrda_m.xrdald,g_xrda_m.xrdacomp,l_ooba002,'D-FIN-0031') RETURNING l_dfin0031
         CALL s_fin_get_doc_para(g_xrda_m.xrdald,g_xrda_m.xrdacomp,l_ooba002,'D-FIN-0032') RETURNING l_dfin0032
         IF NOT cl_null(l_dfin0031) AND l_dfin0031 MATCHES '[Yy]' THEN 
            IF cl_ask_confirm('aap-00403') THEN
               CALL axrt400_immediately_conf() RETURNING l_success
               IF l_success THEN
                  IF NOT cl_null(l_dfin0032) AND l_dfin0032 MATCHES '[Yy]' THEN 
                     IF cl_ask_confirm('axr-00888') THEN              
                        CALL axrt400_immediately_gen()
                     END IF 
                   END IF 
               END IF 
            END IF 
         END IF
         #151125-00006#1--add--e
      END IF
      
      EXIT WHILE
   END IF
   
END WHILE
   #end add-point    
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.show" >}
#+ 單頭資料重新顯示及單身資料重抓
PRIVATE FUNCTION axrt400_show()
   #add-point:show段define(客製用) name="show.define_customerization"
   
   #end add-point  
   DEFINE l_ac_t    LIKE type_t.num10
   #add-point:show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="show.define"
   
   #end add-point  
   
   #add-point:Function前置處理 name="show.before"
   #IF g_xrda_m.xrdastus <> 'N' THEN              #160308-00010#6 mark
   IF g_xrda_m.xrdastus NOT MATCHES '[NDR]' THEN  #160308-00010#6 add
      CALL cl_set_act_visible('modify,modify_detail,delete',FALSE)
   ELSE
      CALL cl_set_act_visible('modify,modify_detail,delete',TRUE)
   END IF
   CALL axrt400_glaa_get()
   
   CALL axrt400_set_act_no_visible_b()           #160111-00020#5 add lujh
   #end add-point
   
   
   
   IF g_bfill = "Y" THEN
      CALL axrt400_b_fill() #單身填充
      CALL axrt400_b_fill2('0') #單身填充
   END IF
     
   #帶出公用欄位reference值
   #應用 a12 樣板自動產生(Version:4)
 
 
 
   
   #顯示followup圖示
   #應用 a48 樣板自動產生(Version:3)
   CALL axrt400_set_pk_array()
   #add-point:ON ACTION agendum name="show.follow_pic"
   
   #END add-point
   CALL cl_user_overview_set_follow_pic()
  
 
 
 
   
   LET l_ac_t = l_ac
   
   #讀入ref值(單頭)
   #add-point:show段reference name="show.head.reference"
   
   #end add-point
   
   #遮罩相關處理
   LET g_xrda_m_mask_o.* =  g_xrda_m.*
   CALL axrt400_xrda_t_mask()
   LET g_xrda_m_mask_n.* =  g_xrda_m.*
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_xrda_m.xrdasite,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003,g_xrda_m.xrda003_desc,g_xrda_m.xrdald, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda001, 
       g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda005_desc,g_xrda_m.xrda004,g_xrda_m.xrda004_desc, 
       g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010,g_xrda_m.xrda017, 
       g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda015_desc,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtid_desc, 
       g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdp_desc,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid,g_xrda_m.xrdamodid_desc, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfid_desc,g_xrda_m.xrdacnfdt,g_xrda_m.xrda007_desc, 
       g_xrda_m.l_desc,g_xrda_m.lbl_amt5_desc,g_xrda_m.lbl_amt1_1_desc,g_xrda_m.lbl_amt3_1_desc,g_xrda_m.lbl_amt5_1_desc 
 
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_xrda_m.xrdastus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
   
   #讀入ref值(單身)
   FOR l_ac = 1 TO g_xrde_d.getLength()
      #add-point:show段單身reference name="show.body.reference"
      
      #end add-point
   END FOR
   
   FOR l_ac = 1 TO g_xrde2_d.getLength()
      #add-point:show段單身reference name="show.body2.reference"
      
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_xrde3_d.getLength()
      #add-point:show段單身reference name="show.body3.reference"
      
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_xrde4_d.getLength()
      #add-point:show段單身reference name="show.body4.reference"
      
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_xrde5_d.getLength()
      #add-point:show段單身reference name="show.body5.reference"
      
      #end add-point
   END FOR
   FOR l_ac = 1 TO g_xrde6_d.getLength()
      #add-point:show段單身reference name="show.body6.reference"
      
      #end add-point
   END FOR
 
   
    
   
   #add-point:show段other name="show.other"
   
   #end add-point  
   
   LET l_ac = l_ac_t
   
   #移動上下筆可以連動切換資料
   CALL cl_show_fld_cont()     
 
   CALL axrt400_detail_show()
 
   #add-point:show段之後 name="show.after"
   SELECT * INTO g_glaa_t.* FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = g_xrda_m.xrdald
      
   DISPLAY g_glaa_t.glaa001 TO lbl_glaa001
   IF g_glaa_t.glaa015 = 'N' AND g_glaa_t.glaa019 = 'N' THEN
      CALL cl_set_comp_visible('bpage_2,bpage_6,bpage_8',FALSE)
   ELSE
      DISPLAY g_glaa_t.glaa016,g_glaa_t.glaa020 TO lbl_glaa001_2,lbl_glaa001_3
      DISPLAY g_glaa_t.glaa016,g_glaa_t.glaa020 TO glaa001_2,glaa001_3
      CALL cl_set_comp_visible('bpage_2,bpage_6,bpage_8',TRUE)
   END IF
   CALL axrt400_ref_amt()
   IF g_glaa_t.glaa121 = 'Y' THEN
      CALL cl_set_toolbaritem_visible("open_pre",TRUE)
   ELSE
      CALL cl_set_toolbaritem_visible("open_pre",FALSE)
   END IF
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.detail_show" >}
#+ 第二階單身reference
PRIVATE FUNCTION axrt400_detail_show()
   #add-point:detail_show段define(客製用) name="detail_show.define_customerization"
   
   #end add-point  
   #add-point:detail_show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="detail_show.define"
   
   #end add-point  
   
   #add-point:Function前置處理 name="detail_show.before"
   
   #end add-point
   
   #add-point:detail_show段之後 name="detail_show.after"
   
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.reproduce" >}
#+ 資料複製
PRIVATE FUNCTION axrt400_reproduce()
   #add-point:reproduce段define(客製用) name="reproduce.define_customerization"
   
   #end add-point   
   DEFINE l_newno     LIKE xrda_t.xrdald 
   DEFINE l_oldno     LIKE xrda_t.xrdald 
   DEFINE l_newno02     LIKE xrda_t.xrdadocno 
   DEFINE l_oldno02     LIKE xrda_t.xrdadocno 
 
   DEFINE l_master    RECORD LIKE xrda_t.* #此變數樣板目前無使用
   DEFINE l_detail    RECORD LIKE xrde_t.* #此變數樣板目前無使用
   DEFINE l_detail2    RECORD LIKE xrce_t.* #此變數樣板目前無使用
 
 
 
   DEFINE l_cnt       LIKE type_t.num10
   #add-point:reproduce段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="reproduce.define"
   
   #end add-point   
   
   #add-point:Function前置處理  name="reproduce.pre_function"
   
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
   
   LET g_master_insert = FALSE
   
   IF g_xrda_m.xrdald IS NULL
   OR g_xrda_m.xrdadocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
    
   LET g_xrdald_t = g_xrda_m.xrdald
   LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
    
   LET g_xrda_m.xrdald = ""
   LET g_xrda_m.xrdadocno = ""
 
 
   CALL cl_set_head_visible("","YES")
 
   #公用欄位給予預設值
   #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_xrda_m.xrdaownid = g_user
      LET g_xrda_m.xrdaowndp = g_dept
      LET g_xrda_m.xrdacrtid = g_user
      LET g_xrda_m.xrdacrtdp = g_dept 
      LET g_xrda_m.xrdacrtdt = cl_get_current()
      LET g_xrda_m.xrdamodid = g_user
      LET g_xrda_m.xrdamoddt = cl_get_current()
      LET g_xrda_m.xrdastus = 'N'
 
 
 
   
   CALL s_transaction_begin()
   
   #add-point:複製輸入前 name="reproduce.head.b_input"
   
   #end add-point
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_xrda_m.xrdastus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
 
 
 
   
   #清空key欄位的desc
      LET g_xrda_m.xrdald_desc = ''
   DISPLAY BY NAME g_xrda_m.xrdald_desc
   LET g_xrda_m.xrdadocno_desc = ''
   DISPLAY BY NAME g_xrda_m.xrdadocno_desc
   LET g_xrda_m.l_desc = ''
   DISPLAY BY NAME g_xrda_m.l_desc
 
   
   CALL axrt400_input("r")
   
   IF INT_FLAG AND NOT g_master_insert THEN
      LET INT_FLAG = 0
      DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
      DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
      LET INT_FLAG = 0
      INITIALIZE g_xrda_m.* TO NULL
      INITIALIZE g_xrde_d TO NULL
      INITIALIZE g_xrde2_d TO NULL
      INITIALIZE g_xrde3_d TO NULL
      INITIALIZE g_xrde4_d TO NULL
      INITIALIZE g_xrde5_d TO NULL
      INITIALIZE g_xrde6_d TO NULL
 
      #add-point:複製取消後 name="reproduce.cancel"
      
      #end add-point
      CALL axrt400_show()
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = '' 
      LET g_errparam.code   = 9001 
      LET g_errparam.popup  = FALSE 
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL axrt400_set_act_visible()   
   CALL axrt400_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_xrdald_t = g_xrda_m.xrdald
   LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
   
   #組合新增資料的條件
   LET g_add_browse = " xrdaent = " ||g_enterprise|| " AND",
                      " xrdald = '", g_xrda_m.xrdald, "' "
                      ," AND xrdadocno = '", g_xrda_m.xrdadocno, "' "
 
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL axrt400_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   #add-point:完成複製段落後 name="reproduce.after_reproduce"
   
   #end add-point
   
   CALL axrt400_idx_chk()
   
   LET g_data_owner = g_xrda_m.xrdaownid      
   LET g_data_dept  = g_xrda_m.xrdaowndp
   
   #功能已完成,通報訊息中心
   CALL axrt400_msgcentre_notify('reproduce')
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.detail_reproduce" >}
#+ 單身自動複製
PRIVATE FUNCTION axrt400_detail_reproduce()
   #add-point:delete段define(客製用) name="detail_reproduce.define_customerization"
   
   #end add-point    
   DEFINE ls_sql      STRING
   DEFINE ld_date     DATETIME YEAR TO SECOND
   DEFINE l_detail    RECORD LIKE xrde_t.* #此變數樣板目前無使用
   DEFINE l_detail2    RECORD LIKE xrce_t.* #此變數樣板目前無使用
 
 
 
   #add-point:delete段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="detail_reproduce.define"
   
   #end add-point    
   
   #add-point:Function前置處理  name="detail_reproduce.pre_function"
   
   #end add-point
   
   CALL s_transaction_begin()
   
   LET ld_date = cl_get_current()
   
   DROP TABLE axrt400_detail
   
   #add-point:單身複製前1 name="detail_reproduce.body.table1.b_insert"
   
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM xrde_t
    WHERE xrdeent = g_enterprise AND xrdeld = g_xrdald_t
     AND xrdedocno = g_xrdadocno_t
 
    INTO TEMP axrt400_detail
 
   #將key修正為調整後   
   UPDATE axrt400_detail 
      #更新key欄位
      SET xrdeld = g_xrda_m.xrdald
          , xrdedocno = g_xrda_m.xrdadocno
 
      #更新共用欄位
      
 
   #add-point:單身修改前 name="detail_reproduce.body.table1.b_update"
   
   #end add-point                                       
  
   #將資料塞回原table   
   INSERT INTO xrde_t SELECT * FROM axrt400_detail
   
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "reproduce:",SQLERRMESSAGE 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #add-point:單身複製中1 name="detail_reproduce.body.table1.m_insert"
   
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE axrt400_detail
   
   #add-point:單身複製後1 name="detail_reproduce.body.table1.a_insert"
   
   #end add-point
 
   #add-point:單身複製前 name="detail_reproduce.body.table2.b_insert"
   
   #end add-point
   
   #CREATE TEMP TABLE
   SELECT * FROM xrce_t 
    WHERE xrceent = g_enterprise AND xrceld = g_xrdald_t
      AND xrcedocno = g_xrdadocno_t   
 
    INTO TEMP axrt400_detail
 
   #將key修正為調整後   
   UPDATE axrt400_detail SET xrceld = g_xrda_m.xrdald
                                       , xrcedocno = g_xrda_m.xrdadocno
 
  
   #add-point:單身修改前 name="detail_reproduce.body.table2.b_update"
   
   #end add-point    
 
   #將資料塞回原table   
   INSERT INTO xrce_t SELECT * FROM axrt400_detail
   
   #add-point:單身複製中 name="detail_reproduce.body.table2.m_insert"
   
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE axrt400_detail
   
   #add-point:單身複製後 name="detail_reproduce.body.table2.a_insert"
   
   #end add-point
 
 
   
 
   
   #多語言複製段落
   
   
   CALL s_transaction_end('Y','0')
   
   #已新增完, 調整資料內容(修改時使用)
   LET g_xrdald_t = g_xrda_m.xrdald
   LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.delete" >}
#+ 資料刪除
PRIVATE FUNCTION axrt400_delete()
   #add-point:delete段define(客製用) name="delete.define_customerization"
   
   #end add-point     
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   #add-point:delete段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="delete.define"
   DEFINE  l_success       LIKE type_t.num5
   #end add-point     
   
   #add-point:Function前置處理  name="delete.pre_function"
   
   #end add-point
   
   IF g_xrda_m.xrdald IS NULL
   OR g_xrda_m.xrdadocno IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
   
   
   
   CALL s_transaction_begin()
 
   OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN axrt400_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CLOSE axrt400_cl
      CALL s_transaction_end('N','0')
      CALL cl_err()
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE axrt400_master_referesh USING g_xrda_m.xrdald,g_xrda_m.xrdadocno INTO g_xrda_m.xrdasite,g_xrda_m.xrda003, 
       g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005, 
       g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
       g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003_desc, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda005_desc,g_xrda_m.xrda004_desc,g_xrda_m.xrda015_desc, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid_desc,g_xrda_m.xrdacrtdp_desc, 
       g_xrda_m.xrdamodid_desc,g_xrda_m.xrdacnfid_desc
   
   
   #檢查是否允許此動作
   IF NOT axrt400_action_chk() THEN
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_xrda_m_mask_o.* =  g_xrda_m.*
   CALL axrt400_xrda_t_mask()
   LET g_xrda_m_mask_n.* =  g_xrda_m.*
   
   CALL axrt400_show()
   
   #add-point:delete段before ask name="delete.before_ask"
   #141226-00016#2 By 01727 Add ---(S)---
   CALL s_axrt300_date_chk(g_xrda_m.xrdasite,g_xrda_m.xrdadocdt) RETURNING l_success
   IF NOT l_success THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "axr-00300"
      LET g_errparam.popup  = TRUE 
      CALL cl_err() 
      RETURN
   END IF
   #141226-00016#2 By 01727 Add ---(S)---
   #20150309--add--str--
   #IF g_xrda_m.xrdastus <> 'N' THEN              #160308-00010#8 mark
   IF g_xrda_m.xrdastus NOT MATCHES '[NDR]' THEN  #160308-00010#8 add
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'agl-00313'
      LET g_errparam.extend = g_xrda_m.xrdadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      RETURN
   END IF
   #20150309--add--end--
   #end add-point 
 
   IF cl_ask_del_master() THEN              #確認一下
   
      #add-point:單頭刪除前 name="delete.head.b_delete"
      
      #end add-point   
      
      #應用 a47 樣板自動產生(Version:4)
      #刪除相關文件
      CALL axrt400_set_pk_array()
      #add-point:相關文件刪除前 name="delete.befroe.related_document_remove"
      
      #end add-point   
      CALL cl_doc_remove()  
 
 
 
  
  
      #資料備份
      LET g_xrdald_t = g_xrda_m.xrdald
      LET g_xrdadocno_t = g_xrda_m.xrdadocno
 
 
      DELETE FROM xrda_t
       WHERE xrdaent = g_enterprise AND xrdald = g_xrda_m.xrdald
         AND xrdadocno = g_xrda_m.xrdadocno
 
       
      #add-point:單頭刪除中 name="delete.head.m_delete"
      
      #end add-point
       
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_xrda_m.xrdald,":",SQLERRMESSAGE  
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF
      
      #add-point:單頭刪除後 name="delete.head.a_delete"
      
      #end add-point
  
      #add-point:單身刪除前 name="delete.body.b_delete"
     #160607-00015#3 Add  ---(S)---
      UPDATE isbc_t SET isbc005 = '',isbc006 = ''
       WHERE isbcent = g_enterprise
         AND isbc005 = g_xrda_m.xrdadocno
     #160607-00015#3 Add  ---(E)---
      #end add-point
      
      DELETE FROM xrde_t
       WHERE xrdeent = g_enterprise AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
 
 
      #add-point:單身刪除中 name="delete.body.m_delete"
      
      #end add-point
         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF    
 
      #add-point:單身刪除後 name="delete.body.a_delete"
      
      #end add-point
      
            
                                                               
      #add-point:單身刪除前 name="delete.body.b_delete2"
      
      #end add-point
      DELETE FROM xrce_t
       WHERE xrceent = g_enterprise AND
             xrceld = g_xrda_m.xrdald AND xrcedocno = g_xrda_m.xrdadocno
      #add-point:單身刪除中 name="delete.body.m_delete2"
      
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL s_transaction_end('N','0')
         CALL cl_err()
         RETURN
      END IF      
 
      #add-point:單身刪除後 name="delete.body.a_delete2"
      IF g_glaa_t.glaa121 = 'Y' THEN
         CALL s_pre_voucher_del('AR','R20',g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING l_success
         
         IF l_success = FALSE THEN 
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      END IF
      #刪除單號
      IF NOT s_aooi200_fin_del_docno(g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt) THEN
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      #end add-point
 
 
 
 
      
      #修改歷程記錄(刪除)
      IF NOT cl_log_modified_record('','') THEN 
         CLOSE axrt400_cl
         CALL s_transaction_end('N','0')
         RETURN
      END IF
             
      CLEAR FORM
      CALL g_xrde_d.clear() 
      CALL g_xrde2_d.clear()       
      CALL g_xrde3_d.clear()       
      CALL g_xrde4_d.clear()       
      CALL g_xrde5_d.clear()       
      CALL g_xrde6_d.clear()       
 
     
      CALL axrt400_ui_browser_refresh()  
      #CALL axrt400_ui_headershow()  
      #CALL axrt400_ui_detailshow()
 
      #add-point:多語言刪除 name="delete.lang.before_delete"
      
      #end add-point
      
      #單頭多語言刪除
      
      
      #單身多語言刪除
      
      
      
      
      
      
 
   
      #add-point:多語言刪除 name="delete.lang.delete"
      
      #end add-point
      
      IF g_browser_cnt > 0 THEN 
         #CALL axrt400_browser_fill("")
         CALL axrt400_fetch('P')
         DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
         DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
      ELSE
         CLEAR FORM
      END IF
      
      CALL s_transaction_end('Y','0')
   ELSE
      CALL s_transaction_end('N','0')
   END IF
 
   CLOSE axrt400_cl
 
   #功能已完成,通報訊息中心
   CALL axrt400_msgcentre_notify('delete')
    
END FUNCTION
 
{</section>}
 
{<section id="axrt400.b_fill" >}
#+ 單身陣列填充
PRIVATE FUNCTION axrt400_b_fill()
   #add-point:b_fill段define(客製用) name="b_fill.define_customerization"
   
   #end add-point     
   DEFINE p_wc2      STRING
   DEFINE li_idx     LIKE type_t.num10
   #add-point:b_fill段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="b_fill.define"
   
   #end add-point     
   
   #add-point:Function前置處理  name="b_fill.pre_function"
   
   #end add-point
   
   #清空第一階單身
   CALL g_xrde_d.clear()
   CALL g_xrde2_d.clear()
   CALL g_xrde3_d.clear()
   CALL g_xrde4_d.clear()
   CALL g_xrde5_d.clear()
   CALL g_xrde6_d.clear()
 
 
   #add-point:b_fill段sql_before name="b_fill.sql_before"
   
   #end add-point
   
   #判斷是否填充
   IF axrt400_fill_chk(1) THEN
      #切換上下筆時不重組SQL
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
      #add-point:b_fill段long_sql_if name="b_fill.long_sql_if"
      
      #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT xrdeseq,xrde002,xrde006,xrde003,xrde004,xrde008,xrde032,xrde010, 
             xrde016,xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp,xrdesite,xrdeorga, 
             xrde011,xrde015,xrde012,xrdeseq,xrde120,xrde121,xrde129,xrde130,xrde131,xrde139,xrdeseq, 
             xrde017,xrde018,xrde019,xrde035,xrde036,xrde020,xrde022,xrde023,xrde039,xrde040,xrde042, 
             xrde043,xrde044,xrde045,xrde046,xrde047,xrde048,xrde049,xrde050,xrde051  FROM xrde_t",  
               
                     " INNER JOIN xrda_t ON xrdaent = " ||g_enterprise|| " AND xrdald = xrdeld ",
                     " AND xrdadocno = xrdedocno ",
 
                     #"",
                     
                     "",
                     #下層單身所需的join條件
 
                     
                     " WHERE xrdeent=? AND xrdeld=? AND xrdedocno=?"
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段sql_before name="b_fill.body.fill_sql"
         #161017-00011#2--add--str--
         IF NOT cl_null(g_sql_ctrl) AND NOT g_sql_ctrl = ' 1=1'  THEN
            LET g_sql = g_sql,"   AND (trim(xrde013) IS NULL ",
                              "        OR EXISTS (SELECT 1 FROM pmaa_t ",
                              "                WHERE pmaaent = ",g_enterprise,
                              "                  AND ",g_sql_ctrl,
                              "                  AND pmaaent = xrdeent ",
                              "                  AND pmaa001 = xrde013 )",
                              "       )"
         END IF 
         #161017-00011#2--add--end
         #end add-point
         IF NOT cl_null(g_wc2_table1) THEN
            LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY xrde_t.xrdeseq"
         
         #add-point:單身填充控制 name="b_fill.sql"
         
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE axrt400_pb FROM g_sql
         DECLARE b_fill_cs CURSOR FOR axrt400_pb
      END IF
      
      LET g_cnt = l_ac
      LET l_ac = 1
      
      OPEN b_fill_cs USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
                                               
      FOREACH b_fill_cs INTO g_xrde_d[l_ac].xrdeseq,g_xrde_d[l_ac].xrde002,g_xrde_d[l_ac].xrde006,g_xrde_d[l_ac].xrde003, 
          g_xrde_d[l_ac].xrde004,g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde032,g_xrde_d[l_ac].xrde010, 
          g_xrde_d[l_ac].xrde016,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101,g_xrde_d[l_ac].xrde109, 
          g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde014,g_xrde_d[l_ac].xrde013,g_xrde_d[l_ac].xrde001, 
          g_xrde_d[l_ac].xrdecomp,g_xrde_d[l_ac].xrdesite,g_xrde_d[l_ac].xrdeorga,g_xrde_d[l_ac].xrde011, 
          g_xrde_d[l_ac].xrde015,g_xrde_d[l_ac].xrde012,g_xrde2_d[l_ac].xrdeseq,g_xrde2_d[l_ac].xrde120, 
          g_xrde2_d[l_ac].xrde121,g_xrde2_d[l_ac].xrde129,g_xrde2_d[l_ac].xrde130,g_xrde2_d[l_ac].xrde131, 
          g_xrde2_d[l_ac].xrde139,g_xrde3_d[l_ac].xrdeseq,g_xrde3_d[l_ac].xrde017,g_xrde3_d[l_ac].xrde018, 
          g_xrde3_d[l_ac].xrde019,g_xrde3_d[l_ac].xrde035,g_xrde3_d[l_ac].xrde036,g_xrde3_d[l_ac].xrde020, 
          g_xrde3_d[l_ac].xrde022,g_xrde3_d[l_ac].xrde023,g_xrde3_d[l_ac].xrde039,g_xrde3_d[l_ac].xrde040, 
          g_xrde3_d[l_ac].xrde042,g_xrde3_d[l_ac].xrde043,g_xrde3_d[l_ac].xrde044,g_xrde3_d[l_ac].xrde045, 
          g_xrde3_d[l_ac].xrde046,g_xrde3_d[l_ac].xrde047,g_xrde3_d[l_ac].xrde048,g_xrde3_d[l_ac].xrde049, 
          g_xrde3_d[l_ac].xrde050,g_xrde3_d[l_ac].xrde051
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill.fill"
         #160122-00001#5 --add --str
         #判断当前用户是否有权限查看该交易账户，如果没有权限不可看到交易账户编号，用“*”显示
         CALL axrt400_get_l_xrde008(g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde006) RETURNING g_xrde_d[l_ac].l_xrde008 
         #160122-00001#5 --add --end 
         
         CALL axrt400_xrde012_desc(g_xrde_d[l_ac].xrde012) RETURNING g_xrde_d[l_ac].xrde012_desc
         LET g_xrde_d[l_ac].xrde012_desc = g_xrde_d[l_ac].xrde012 CLIPPED,'  ',g_xrde_d[l_ac].xrde012_desc
         CALL axrt400_xrde016_desc(g_xrde_d[l_ac].xrde016) RETURNING g_xrde_d[l_ac].xrde016_desc
         LET g_xrde_d[l_ac].xrde016_desc = g_xrde_d[l_ac].xrde016 CLIPPED,g_xrde_d[l_ac].xrde016_desc
         CALL axrt400_xrde017_desc(g_xrde3_d[l_ac].xrde017) RETURNING g_xrde3_d[l_ac].xrde017_desc
         LET g_xrde3_d[l_ac].xrde017_desc = g_xrde3_d[l_ac].xrde017 CLIPPED,g_xrde3_d[l_ac].xrde017_desc
         CALL axrt400_xrde018_desc(g_xrde3_d[l_ac].xrde018) RETURNING g_xrde3_d[l_ac].xrde018_desc
         LET g_xrde3_d[l_ac].xrde018_desc = g_xrde3_d[l_ac].xrde018 CLIPPED,g_xrde3_d[l_ac].xrde018_desc
         CALL axrt400_xrde018_desc(g_xrde3_d[l_ac].xrde019) RETURNING g_xrde3_d[l_ac].xrde019_desc
         LET g_xrde3_d[l_ac].xrde019_desc = g_xrde3_d[l_ac].xrde019 CLIPPED,g_xrde3_d[l_ac].xrde019_desc
         CALL axrt400_xrde035_desc('287',g_xrde3_d[l_ac].xrde035) RETURNING g_xrde3_d[l_ac].xrde035_desc
         LET g_xrde3_d[l_ac].xrde035_desc = g_xrde3_d[l_ac].xrde035 CLIPPED,g_xrde3_d[l_ac].xrde035_desc
         CALL axrt400_xrde035_desc('281',g_xrde3_d[l_ac].xrde036) RETURNING g_xrde3_d[l_ac].xrde036_desc
         LET g_xrde3_d[l_ac].xrde036_desc = g_xrde3_d[l_ac].xrde036 CLIPPED,g_xrde3_d[l_ac].xrde036_desc
         CALL axrt400_xrde020_desc(g_xrde3_d[l_ac].xrde020) RETURNING g_xrde3_d[l_ac].xrde020_desc
         LET g_xrde3_d[l_ac].xrde020_desc = g_xrde3_d[l_ac].xrde020 CLIPPED,g_xrde3_d[l_ac].xrde020_desc
         CALL axrt400_xrde022_desc(g_xrde3_d[l_ac].xrde022) RETURNING g_xrde3_d[l_ac].xrde022_desc
         LET g_xrde3_d[l_ac].xrde022_desc = g_xrde3_d[l_ac].xrde022 CLIPPED,g_xrde3_d[l_ac].xrde022_desc
         CALL axrt400_xrde023_desc(g_xrde3_d[l_ac].xrde022,g_xrde3_d[l_ac].xrde023) RETURNING g_xrde3_d[l_ac].xrde023_desc
         LET g_xrde3_d[l_ac].xrde023_desc = g_xrde3_d[l_ac].xrde023 CLIPPED,g_xrde3_d[l_ac].xrde023_desc
         CALL axrt400_xrde040_desc(g_xrde3_d[l_ac].xrde040) RETURNING g_xrde3_d[l_ac].xrde040_desc
         LET g_xrde3_d[l_ac].xrde040_desc = g_xrde3_d[l_ac].xrde040 CLIPPED,g_xrde3_d[l_ac].xrde040_desc
         
         LET g_xrde3_d[l_ac].l_xrde016 = g_xrde_d[l_ac].xrde016_desc
         
         SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
                glad019,glad0191,glad0192,glad020,glad0201,glad0202,
                glad021,glad0211,glad0212,glad022,glad0221,glad0222,
                glad023,glad0231,glad0232,glad024,glad0221,glad0242,
                glad025,glad0251,glad0252,glad026,glad0261,glad0262
          INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
                g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
                g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
                g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
                g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
          FROM  glad_t
          WHERE gladent = g_enterprise
            AND gladld = g_xrda_m.xrdald
            AND glad001 = g_xrde_d[l_ac].xrde016 
         
         CALL axrt400_free_account_desc(g_glad0171,g_xrde3_d[l_ac].xrde042) RETURNING g_xrde3_d[l_ac].xrde042_desc
         LET g_xrde3_d[l_ac].xrde042_desc = g_xrde3_d[l_ac].xrde042 CLIPPED ,g_xrde3_d[l_ac].xrde042_desc
         CALL axrt400_free_account_desc(g_glad0181,g_xrde3_d[l_ac].xrde043) RETURNING g_xrde3_d[l_ac].xrde043_desc
         LET g_xrde3_d[l_ac].xrde043_desc = g_xrde3_d[l_ac].xrde043 CLIPPED ,g_xrde3_d[l_ac].xrde043_desc
         CALL axrt400_free_account_desc(g_glad0191,g_xrde3_d[l_ac].xrde044) RETURNING g_xrde3_d[l_ac].xrde044_desc
         LET g_xrde3_d[l_ac].xrde044_desc = g_xrde3_d[l_ac].xrde044 CLIPPED ,g_xrde3_d[l_ac].xrde044_desc
         CALL axrt400_free_account_desc(g_glad0201,g_xrde3_d[l_ac].xrde045) RETURNING g_xrde3_d[l_ac].xrde045_desc
         LET g_xrde3_d[l_ac].xrde045_desc = g_xrde3_d[l_ac].xrde045 CLIPPED ,g_xrde3_d[l_ac].xrde045_desc
         CALL axrt400_free_account_desc(g_glad0211,g_xrde3_d[l_ac].xrde046) RETURNING g_xrde3_d[l_ac].xrde046_desc
         LET g_xrde3_d[l_ac].xrde046_desc = g_xrde3_d[l_ac].xrde046 CLIPPED ,g_xrde3_d[l_ac].xrde046_desc
         CALL axrt400_free_account_desc(g_glad0221,g_xrde3_d[l_ac].xrde047) RETURNING g_xrde3_d[l_ac].xrde047_desc
         LET g_xrde3_d[l_ac].xrde047_desc = g_xrde3_d[l_ac].xrde047 CLIPPED ,g_xrde3_d[l_ac].xrde047_desc
         CALL axrt400_free_account_desc(g_glad0231,g_xrde3_d[l_ac].xrde048) RETURNING g_xrde3_d[l_ac].xrde048_desc
         LET g_xrde3_d[l_ac].xrde048_desc = g_xrde3_d[l_ac].xrde048 CLIPPED ,g_xrde3_d[l_ac].xrde048_desc
         CALL axrt400_free_account_desc(g_glad0241,g_xrde3_d[l_ac].xrde049) RETURNING g_xrde3_d[l_ac].xrde049_desc
         LET g_xrde3_d[l_ac].xrde049_desc = g_xrde3_d[l_ac].xrde049 CLIPPED ,g_xrde3_d[l_ac].xrde049_desc
         CALL axrt400_free_account_desc(g_glad0251,g_xrde3_d[l_ac].xrde050) RETURNING g_xrde3_d[l_ac].xrde050_desc
         LET g_xrde3_d[l_ac].xrde050_desc = g_xrde3_d[l_ac].xrde050 CLIPPED ,g_xrde3_d[l_ac].xrde050_desc
         CALL axrt400_free_account_desc(g_glad0261,g_xrde3_d[l_ac].xrde051) RETURNING g_xrde3_d[l_ac].xrde051_desc
         LET g_xrde3_d[l_ac].xrde051_desc = g_xrde3_d[l_ac].xrde051 CLIPPED ,g_xrde3_d[l_ac].xrde051_desc
         
         CALL axrt400_xrde015_desc(g_xrde_d[l_ac].xrde015) RETURNING g_xrde_d[l_ac].xrde015_desc
         #end add-point
      
         IF l_ac > g_max_rec THEN
            IF g_error_show = 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code   = 9035 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
            END IF
            EXIT FOREACH
         END IF
         
         LET l_ac = l_ac + 1
      END FOREACH
      LET g_error_show = 0
   
   END IF
    
   #判斷是否填充
   IF axrt400_fill_chk(2) THEN
      IF (g_action_choice = "query" OR cl_null(g_action_choice))
         #add-point:b_fill段long_sql_if name="b_fill.body2.long_sql_if"
         
         #end add-point
      THEN
         LET g_sql = "SELECT  DISTINCT xrceseq,xrce002,xrce003,xrce004,xrce005,xrce054,xrce010,xrce016, 
             xrce100,xrce101,xrce109,xrce119,xrce001,xrcecomp,xrcesite,xrceorga,xrce027,xrce015,xrceseq, 
             xrce120,xrce121,xrce129,xrce130,xrce131,xrce139,xrceseq,xrce017,xrce018,xrce019,xrce035, 
             xrce036,xrce020,xrce022,xrce023,xrce039,xrce040,xrce042,xrce043,xrce044,xrce045,xrce046, 
             xrce047,xrce048,xrce049,xrce050,xrce051  FROM xrce_t",   
                     " INNER JOIN  xrda_t ON xrdaent = " ||g_enterprise|| " AND xrdald = xrceld ",
                     " AND xrdadocno = xrcedocno ",
 
                     "",
                     
                     
                     " WHERE xrceent=? AND xrceld=? AND xrcedocno=?"   
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段fill_sql name="b_fill.body2.fill_sql"
         
         #end add-point
         IF NOT cl_null(g_wc2_table2) THEN
            LET g_sql = g_sql CLIPPED," AND ",g_wc2_table2 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY xrce_t.xrceseq"
         
         #add-point:單身填充控制 name="b_fill.sql2"
         
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE axrt400_pb2 FROM g_sql
         DECLARE b_fill_cs2 CURSOR FOR axrt400_pb2
      END IF
    
      LET l_ac = 1
      
      OPEN b_fill_cs2 USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
                                               
      FOREACH b_fill_cs2 INTO g_xrde4_d[l_ac].xrceseq,g_xrde4_d[l_ac].xrce002,g_xrde4_d[l_ac].xrce003, 
          g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005,g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrce010, 
          g_xrde4_d[l_ac].xrce016,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce101,g_xrde4_d[l_ac].xrce109, 
          g_xrde4_d[l_ac].xrce119,g_xrde4_d[l_ac].xrce001,g_xrde4_d[l_ac].xrcecomp,g_xrde4_d[l_ac].xrcesite, 
          g_xrde4_d[l_ac].xrceorga,g_xrde4_d[l_ac].xrce027,g_xrde4_d[l_ac].xrce015,g_xrde5_d[l_ac].xrceseq, 
          g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,g_xrde5_d[l_ac].xrce129,g_xrde5_d[l_ac].xrce130, 
          g_xrde5_d[l_ac].xrce131,g_xrde5_d[l_ac].xrce139,g_xrde6_d[l_ac].xrceseq,g_xrde6_d[l_ac].xrce017, 
          g_xrde6_d[l_ac].xrce018,g_xrde6_d[l_ac].xrce019,g_xrde6_d[l_ac].xrce035,g_xrde6_d[l_ac].xrce036, 
          g_xrde6_d[l_ac].xrce020,g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023,g_xrde6_d[l_ac].xrce039, 
          g_xrde6_d[l_ac].xrce040,g_xrde6_d[l_ac].xrce042,g_xrde6_d[l_ac].xrce043,g_xrde6_d[l_ac].xrce044, 
          g_xrde6_d[l_ac].xrce045,g_xrde6_d[l_ac].xrce046,g_xrde6_d[l_ac].xrce047,g_xrde6_d[l_ac].xrce048, 
          g_xrde6_d[l_ac].xrce049,g_xrde6_d[l_ac].xrce050,g_xrde6_d[l_ac].xrce051
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:",SQLERRMESSAGE 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充 name="b_fill2.fill"
         CALL axrt400_xrcc_get()
         
         CALL axrt400_xrde016_desc(g_xrde4_d[l_ac].xrce016) RETURNING g_xrde4_d[l_ac].xrce016_desc
         LET g_xrde4_d[l_ac].xrce016_desc = g_xrde4_d[l_ac].xrce016 CLIPPED,g_xrde4_d[l_ac].xrce016_desc
         CALL axrt400_xrde017_desc(g_xrde6_d[l_ac].xrce017) RETURNING g_xrde6_d[l_ac].xrce017_desc
         LET g_xrde6_d[l_ac].xrce017_desc = g_xrde6_d[l_ac].xrce017 CLIPPED,g_xrde6_d[l_ac].xrce017_desc
         CALL axrt400_xrde018_desc(g_xrde6_d[l_ac].xrce018) RETURNING g_xrde6_d[l_ac].xrce018_desc
         LET g_xrde6_d[l_ac].xrce018_desc = g_xrde6_d[l_ac].xrce018 CLIPPED,g_xrde6_d[l_ac].xrce018_desc
         CALL axrt400_xrde018_desc(g_xrde6_d[l_ac].xrce019) RETURNING g_xrde6_d[l_ac].xrce019_desc
         LET g_xrde6_d[l_ac].xrce019_desc = g_xrde6_d[l_ac].xrce019 CLIPPED,g_xrde6_d[l_ac].xrce019_desc
         CALL axrt400_xrde035_desc('287',g_xrde6_d[l_ac].xrce035) RETURNING g_xrde6_d[l_ac].xrce035_desc
         LET g_xrde6_d[l_ac].xrce035_desc = g_xrde6_d[l_ac].xrce035 CLIPPED,g_xrde6_d[l_ac].xrce035_desc
         CALL axrt400_xrde035_desc('281',g_xrde6_d[l_ac].xrce036) RETURNING g_xrde6_d[l_ac].xrce036_desc
         LET g_xrde6_d[l_ac].xrce036_desc = g_xrde6_d[l_ac].xrce036 CLIPPED,g_xrde6_d[l_ac].xrce036_desc
         CALL axrt400_xrde020_desc(g_xrde6_d[l_ac].xrce020) RETURNING g_xrde6_d[l_ac].xrce020_desc
         LET g_xrde6_d[l_ac].xrce020_desc = g_xrde6_d[l_ac].xrce020 CLIPPED,g_xrde6_d[l_ac].xrce020_desc
         CALL axrt400_xrde022_desc(g_xrde6_d[l_ac].xrce022) RETURNING g_xrde6_d[l_ac].xrce022_desc
         LET g_xrde6_d[l_ac].xrce022_desc = g_xrde6_d[l_ac].xrce022 CLIPPED,g_xrde6_d[l_ac].xrce022_desc
         CALL axrt400_xrde023_desc(g_xrde6_d[l_ac].xrce022,g_xrde6_d[l_ac].xrce023) RETURNING g_xrde6_d[l_ac].xrce023_desc
         LET g_xrde6_d[l_ac].xrce023_desc = g_xrde6_d[l_ac].xrce023 CLIPPED,g_xrde6_d[l_ac].xrce023_desc
         CALL axrt400_xrde040_desc(g_xrde6_d[l_ac].xrce040) RETURNING g_xrde6_d[l_ac].xrce040_desc
         LET g_xrde6_d[l_ac].xrce040_desc = g_xrde6_d[l_ac].xrce040 CLIPPED,g_xrde6_d[l_ac].xrce040_desc
         
         LET g_xrde6_d[l_ac].l_xrce016 = g_xrde4_d[l_ac].xrce016_desc
         
         SELECT glad017,glad0171,glad0172,glad018,glad0181,glad0182,
                glad019,glad0191,glad0192,glad020,glad0201,glad0202,
                glad021,glad0211,glad0212,glad022,glad0221,glad0222,
                glad023,glad0231,glad0232,glad024,glad0221,glad0242,
                glad025,glad0251,glad0252,glad026,glad0261,glad0262
          INTO  g_glad017,g_glad0171,g_glad0172,g_glad018,g_glad0181,g_glad0182,
                g_glad019,g_glad0191,g_glad0192,g_glad020,g_glad0201,g_glad0202,
                g_glad021,g_glad0211,g_glad0212,g_glad022,g_glad0221,g_glad0222,
                g_glad023,g_glad0231,g_glad0232,g_glad024,g_glad0241,g_glad0242,
                g_glad025,g_glad0251,g_glad0252,g_glad026,g_glad0261,g_glad0262
          FROM  glad_t
          WHERE gladent = g_enterprise
            AND gladld = g_xrda_m.xrdald
            AND glad001 = g_xrde4_d[l_ac].xrce016  
         
         CALL axrt400_free_account_desc(g_glad0171,g_xrde6_d[l_ac].xrce042) RETURNING g_xrde6_d[l_ac].xrce042_desc
         LET g_xrde6_d[l_ac].xrce042_desc = g_xrde6_d[l_ac].xrce042 CLIPPED ,g_xrde6_d[l_ac].xrce042_desc
         CALL axrt400_free_account_desc(g_glad0181,g_xrde6_d[l_ac].xrce043) RETURNING g_xrde6_d[l_ac].xrce043_desc
         LET g_xrde6_d[l_ac].xrce043_desc = g_xrde6_d[l_ac].xrce043 CLIPPED ,g_xrde6_d[l_ac].xrce043_desc
         CALL axrt400_free_account_desc(g_glad0191,g_xrde6_d[l_ac].xrce044) RETURNING g_xrde6_d[l_ac].xrce044_desc
         LET g_xrde6_d[l_ac].xrce044_desc = g_xrde6_d[l_ac].xrce044 CLIPPED ,g_xrde6_d[l_ac].xrce044_desc
         CALL axrt400_free_account_desc(g_glad0201,g_xrde6_d[l_ac].xrce045) RETURNING g_xrde6_d[l_ac].xrce045_desc
         LET g_xrde6_d[l_ac].xrce045_desc = g_xrde6_d[l_ac].xrce045 CLIPPED ,g_xrde6_d[l_ac].xrce045_desc
         CALL axrt400_free_account_desc(g_glad0211,g_xrde6_d[l_ac].xrce046) RETURNING g_xrde6_d[l_ac].xrce046_desc
         LET g_xrde6_d[l_ac].xrce046_desc = g_xrde6_d[l_ac].xrce046 CLIPPED ,g_xrde6_d[l_ac].xrce046_desc
         CALL axrt400_free_account_desc(g_glad0221,g_xrde6_d[l_ac].xrce047) RETURNING g_xrde6_d[l_ac].xrce047_desc
         LET g_xrde6_d[l_ac].xrce047_desc = g_xrde6_d[l_ac].xrce047 CLIPPED ,g_xrde6_d[l_ac].xrce047_desc
         CALL axrt400_free_account_desc(g_glad0231,g_xrde6_d[l_ac].xrce048) RETURNING g_xrde6_d[l_ac].xrce048_desc
         LET g_xrde6_d[l_ac].xrce048_desc = g_xrde6_d[l_ac].xrce048 CLIPPED ,g_xrde6_d[l_ac].xrce048_desc
         CALL axrt400_free_account_desc(g_glad0241,g_xrde6_d[l_ac].xrce049) RETURNING g_xrde6_d[l_ac].xrce049_desc
         LET g_xrde6_d[l_ac].xrce049_desc = g_xrde6_d[l_ac].xrce049 CLIPPED ,g_xrde6_d[l_ac].xrce049_desc
         CALL axrt400_free_account_desc(g_glad0251,g_xrde6_d[l_ac].xrce050) RETURNING g_xrde6_d[l_ac].xrce050_desc
         LET g_xrde6_d[l_ac].xrce050_desc = g_xrde6_d[l_ac].xrce050 CLIPPED ,g_xrde6_d[l_ac].xrce050_desc
         CALL axrt400_free_account_desc(g_glad0261,g_xrde6_d[l_ac].xrce051) RETURNING g_xrde6_d[l_ac].xrce051_desc
         LET g_xrde6_d[l_ac].xrce051_desc = g_xrde6_d[l_ac].xrce051 CLIPPED ,g_xrde6_d[l_ac].xrce051_desc
         
         CALL axrt400_xrce015_desc(g_xrde4_d[l_ac].xrce015) RETURNING g_xrde4_d[l_ac].xrce015_desc
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = l_ac
            LET g_errparam.code   = 9035 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
         
      END FOREACH
   END IF
 
 
   
   #add-point:browser_fill段其他table處理 name="browser_fill.other_fill"
   
   #end add-point
   
   CALL g_xrde_d.deleteElement(g_xrde_d.getLength())
   CALL g_xrde2_d.deleteElement(g_xrde2_d.getLength())
   CALL g_xrde3_d.deleteElement(g_xrde3_d.getLength())
   CALL g_xrde4_d.deleteElement(g_xrde4_d.getLength())
   CALL g_xrde5_d.deleteElement(g_xrde5_d.getLength())
   CALL g_xrde6_d.deleteElement(g_xrde6_d.getLength())
 
   
 
   LET l_ac = g_cnt
   LET g_cnt = 0  
   
   FREE axrt400_pb
   FREE axrt400_pb2
 
 
   
   LET li_idx = l_ac
   
   #遮罩相關處理
   FOR l_ac = 1 TO g_xrde_d.getLength()
      LET g_xrde_d_mask_o[l_ac].* =  g_xrde_d[l_ac].*
      CALL axrt400_xrde_t_mask()
      LET g_xrde_d_mask_n[l_ac].* =  g_xrde_d[l_ac].*
   END FOR
   
   LET g_xrde2_d_mask_o.* =  g_xrde2_d.*
   FOR l_ac = 1 TO g_xrde2_d.getLength()
      LET g_xrde2_d_mask_o[l_ac].* =  g_xrde2_d[l_ac].*
      CALL axrt400_xrde_t_mask()
      LET g_xrde2_d_mask_n[l_ac].* =  g_xrde2_d[l_ac].*
   END FOR
   LET g_xrde3_d_mask_o.* =  g_xrde3_d.*
   FOR l_ac = 1 TO g_xrde3_d.getLength()
      LET g_xrde3_d_mask_o[l_ac].* =  g_xrde3_d[l_ac].*
      CALL axrt400_xrde_t_mask()
      LET g_xrde3_d_mask_n[l_ac].* =  g_xrde3_d[l_ac].*
   END FOR
   LET g_xrde4_d_mask_o.* =  g_xrde4_d.*
   FOR l_ac = 1 TO g_xrde4_d.getLength()
      LET g_xrde4_d_mask_o[l_ac].* =  g_xrde4_d[l_ac].*
      CALL axrt400_xrce_t_mask()
      LET g_xrde4_d_mask_n[l_ac].* =  g_xrde4_d[l_ac].*
   END FOR
   LET g_xrde5_d_mask_o.* =  g_xrde5_d.*
   FOR l_ac = 1 TO g_xrde5_d.getLength()
      LET g_xrde5_d_mask_o[l_ac].* =  g_xrde5_d[l_ac].*
      CALL axrt400_xrce_t_mask()
      LET g_xrde5_d_mask_n[l_ac].* =  g_xrde5_d[l_ac].*
   END FOR
   LET g_xrde6_d_mask_o.* =  g_xrde6_d.*
   FOR l_ac = 1 TO g_xrde6_d.getLength()
      LET g_xrde6_d_mask_o[l_ac].* =  g_xrde6_d[l_ac].*
      CALL axrt400_xrce_t_mask()
      LET g_xrde6_d_mask_n[l_ac].* =  g_xrde6_d[l_ac].*
   END FOR
 
   
   LET l_ac = li_idx
   
   CALL cl_ap_performance_next_end()
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.delete_b" >}
#+ 刪除單身後其他table連動
PRIVATE FUNCTION axrt400_delete_b(ps_table,ps_keys_bak,ps_page)
   #add-point:delete_b段define(客製用) name="delete_b.define_customerization"
   
   #end add-point     
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:delete_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="delete_b.define"
   
   #end add-point     
   
   #add-point:Function前置處理  name="delete_b.pre_function"
   
   #end add-point
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1','2','3',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete"
      
      #end add-point    
      DELETE FROM xrde_t
       WHERE xrdeent = g_enterprise AND
         xrdeld = ps_keys_bak[1] AND xrdedocno = ps_keys_bak[2] AND xrdeseq = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete"
      
      #end add-point    
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = ":",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_xrde_d.deleteElement(li_idx) 
      END IF 
      IF ps_page <> "'2'" THEN 
         CALL g_xrde2_d.deleteElement(li_idx) 
      END IF 
      IF ps_page <> "'3'" THEN 
         CALL g_xrde3_d.deleteElement(li_idx) 
      END IF 
 
   END IF
   
   LET ls_group = "'4','5','6',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前 name="delete_b.b_delete2"
      
      #end add-point    
      DELETE FROM xrce_t
       WHERE xrceent = g_enterprise AND
             xrceld = ps_keys_bak[1] AND xrcedocno = ps_keys_bak[2] AND xrceseq = ps_keys_bak[3]
      #add-point:delete_b段刪除中 name="delete_b.m_delete2"
      
      #end add-point    
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'4'" THEN 
         CALL g_xrde4_d.deleteElement(li_idx) 
      END IF 
      IF ps_page <> "'5'" THEN 
         CALL g_xrde5_d.deleteElement(li_idx) 
      END IF 
      IF ps_page <> "'6'" THEN 
         CALL g_xrde6_d.deleteElement(li_idx) 
      END IF 
 
      #add-point:delete_b段刪除後 name="delete_b.a_delete2"
      
      #end add-point    
   END IF
 
 
   
 
   
   #add-point:delete_b段other name="delete_b.other"
   
   #end add-point  
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.insert_b" >}
#+ 新增單身後其他table連動
PRIVATE FUNCTION axrt400_insert_b(ps_table,ps_keys,ps_page)
   #add-point:insert_b段define(客製用) name="insert_b.define_customerization"
   
   #end add-point     
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys     DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE ls_page     STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:insert_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="insert_b.define"
   
   #end add-point     
   
   #add-point:Function前置處理  name="insert_b.pre_function"
   
   #end add-point
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1','2','3',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert"
      
      #end add-point 
      INSERT INTO xrde_t
                  (xrdeent,
                   xrdeld,xrdedocno,
                   xrdeseq
                   ,xrde002,xrde006,xrde003,xrde004,xrde008,xrde032,xrde010,xrde016,xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp,xrdesite,xrdeorga,xrde011,xrde015,xrde012,xrde120,xrde121,xrde129,xrde130,xrde131,xrde139,xrde017,xrde018,xrde019,xrde035,xrde036,xrde020,xrde022,xrde023,xrde039,xrde040,xrde042,xrde043,xrde044,xrde045,xrde046,xrde047,xrde048,xrde049,xrde050,xrde051) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_xrde_d[g_detail_idx].xrde002,g_xrde_d[g_detail_idx].xrde006,g_xrde_d[g_detail_idx].xrde003, 
                       g_xrde_d[g_detail_idx].xrde004,g_xrde_d[g_detail_idx].xrde008,g_xrde_d[g_detail_idx].xrde032, 
                       g_xrde_d[g_detail_idx].xrde010,g_xrde_d[g_detail_idx].xrde016,g_xrde_d[g_detail_idx].xrde100, 
                       g_xrde_d[g_detail_idx].xrde101,g_xrde_d[g_detail_idx].xrde109,g_xrde_d[g_detail_idx].xrde119, 
                       g_xrde_d[g_detail_idx].xrde014,g_xrde_d[g_detail_idx].xrde013,g_xrde_d[g_detail_idx].xrde001, 
                       g_xrde_d[g_detail_idx].xrdecomp,g_xrde_d[g_detail_idx].xrdesite,g_xrde_d[g_detail_idx].xrdeorga, 
                       g_xrde_d[g_detail_idx].xrde011,g_xrde_d[g_detail_idx].xrde015,g_xrde_d[g_detail_idx].xrde012, 
                       g_xrde2_d[g_detail_idx].xrde120,g_xrde2_d[g_detail_idx].xrde121,g_xrde2_d[g_detail_idx].xrde129, 
                       g_xrde2_d[g_detail_idx].xrde130,g_xrde2_d[g_detail_idx].xrde131,g_xrde2_d[g_detail_idx].xrde139, 
                       g_xrde3_d[g_detail_idx].xrde017,g_xrde3_d[g_detail_idx].xrde018,g_xrde3_d[g_detail_idx].xrde019, 
                       g_xrde3_d[g_detail_idx].xrde035,g_xrde3_d[g_detail_idx].xrde036,g_xrde3_d[g_detail_idx].xrde020, 
                       g_xrde3_d[g_detail_idx].xrde022,g_xrde3_d[g_detail_idx].xrde023,g_xrde3_d[g_detail_idx].xrde039, 
                       g_xrde3_d[g_detail_idx].xrde040,g_xrde3_d[g_detail_idx].xrde042,g_xrde3_d[g_detail_idx].xrde043, 
                       g_xrde3_d[g_detail_idx].xrde044,g_xrde3_d[g_detail_idx].xrde045,g_xrde3_d[g_detail_idx].xrde046, 
                       g_xrde3_d[g_detail_idx].xrde047,g_xrde3_d[g_detail_idx].xrde048,g_xrde3_d[g_detail_idx].xrde049, 
                       g_xrde3_d[g_detail_idx].xrde050,g_xrde3_d[g_detail_idx].xrde051)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert"
      
      #end add-point 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_xrde_d.insertElement(li_idx) 
      END IF 
      IF ps_page <> "'2'" THEN 
         CALL g_xrde2_d.insertElement(li_idx) 
      END IF 
      IF ps_page <> "'3'" THEN 
         CALL g_xrde3_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert"
      
      #end add-point 
   END IF
   
   LET ls_group = "'4','5','6',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前 name="insert_b.before_insert2"
      
      #end add-point 
      INSERT INTO xrce_t
                  (xrceent,
                   xrceld,xrcedocno,
                   xrceseq
                   ,xrce002,xrce003,xrce004,xrce005,xrce054,xrce010,xrce016,xrce100,xrce101,xrce109,xrce119,xrce001,xrcecomp,xrcesite,xrceorga,xrce027,xrce015,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139,xrce017,xrce018,xrce019,xrce035,xrce036,xrce020,xrce022,xrce023,xrce039,xrce040,xrce042,xrce043,xrce044,xrce045,xrce046,xrce047,xrce048,xrce049,xrce050,xrce051) 
            VALUES(g_enterprise,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_xrde4_d[g_detail_idx].xrce002,g_xrde4_d[g_detail_idx].xrce003,g_xrde4_d[g_detail_idx].xrce004, 
                       g_xrde4_d[g_detail_idx].xrce005,g_xrde4_d[g_detail_idx].xrce054,g_xrde4_d[g_detail_idx].xrce010, 
                       g_xrde4_d[g_detail_idx].xrce016,g_xrde4_d[g_detail_idx].xrce100,g_xrde4_d[g_detail_idx].xrce101, 
                       g_xrde4_d[g_detail_idx].xrce109,g_xrde4_d[g_detail_idx].xrce119,g_xrde4_d[g_detail_idx].xrce001, 
                       g_xrde4_d[g_detail_idx].xrcecomp,g_xrde4_d[g_detail_idx].xrcesite,g_xrde4_d[g_detail_idx].xrceorga, 
                       g_xrde4_d[g_detail_idx].xrce027,g_xrde4_d[g_detail_idx].xrce015,g_xrde5_d[g_detail_idx].xrce120, 
                       g_xrde5_d[g_detail_idx].xrce121,g_xrde5_d[g_detail_idx].xrce129,g_xrde5_d[g_detail_idx].xrce130, 
                       g_xrde5_d[g_detail_idx].xrce131,g_xrde5_d[g_detail_idx].xrce139,g_xrde6_d[g_detail_idx].xrce017, 
                       g_xrde6_d[g_detail_idx].xrce018,g_xrde6_d[g_detail_idx].xrce019,g_xrde6_d[g_detail_idx].xrce035, 
                       g_xrde6_d[g_detail_idx].xrce036,g_xrde6_d[g_detail_idx].xrce020,g_xrde6_d[g_detail_idx].xrce022, 
                       g_xrde6_d[g_detail_idx].xrce023,g_xrde6_d[g_detail_idx].xrce039,g_xrde6_d[g_detail_idx].xrce040, 
                       g_xrde6_d[g_detail_idx].xrce042,g_xrde6_d[g_detail_idx].xrce043,g_xrde6_d[g_detail_idx].xrce044, 
                       g_xrde6_d[g_detail_idx].xrce045,g_xrde6_d[g_detail_idx].xrce046,g_xrde6_d[g_detail_idx].xrce047, 
                       g_xrde6_d[g_detail_idx].xrce048,g_xrde6_d[g_detail_idx].xrce049,g_xrde6_d[g_detail_idx].xrce050, 
                       g_xrde6_d[g_detail_idx].xrce051)
      #add-point:insert_b段資料新增中 name="insert_b.m_insert2"
      
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'4'" THEN 
         CALL g_xrde4_d.insertElement(li_idx) 
      END IF 
      IF ps_page <> "'5'" THEN 
         CALL g_xrde5_d.insertElement(li_idx) 
      END IF 
      IF ps_page <> "'6'" THEN 
         CALL g_xrde6_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後 name="insert_b.after_insert2"
      
      #end add-point
   END IF
 
 
   
 
   
   #add-point:insert_b段other name="insert_b.other"
   
   #end add-point     
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.update_b" >}
#+ 修改單身後其他table連動
PRIVATE FUNCTION axrt400_update_b(ps_table,ps_keys,ps_keys_bak,ps_page)
   #add-point:update_b段define(客製用) name="update_b.define_customerization"
   
   #end add-point   
   DEFINE ps_table         STRING
   DEFINE ps_page          STRING
   DEFINE ps_keys          DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_keys_bak      DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group         STRING
   DEFINE li_idx           LIKE type_t.num10 
   DEFINE lb_chk           BOOLEAN
   DEFINE l_new_key        DYNAMIC ARRAY OF STRING
   DEFINE l_old_key        DYNAMIC ARRAY OF STRING
   DEFINE l_field_key      DYNAMIC ARRAY OF STRING
   #add-point:update_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="update_b.define"
   
   #end add-point   
   
   #add-point:Function前置處理  name="update_b.pre_function"
   
   #end add-point
   
   LET g_update = TRUE   
   
   #判斷key是否有改變
   LET lb_chk = TRUE
   FOR li_idx = 1 TO ps_keys.getLength()
      IF ps_keys[li_idx] <> ps_keys_bak[li_idx] THEN
         LET lb_chk = FALSE
         EXIT FOR
      END IF
   END FOR
   
   #不需要做處理
   IF lb_chk THEN
      RETURN
   END IF
   
   #判斷是否是同一群組的table
   LET ls_group = "'1','2','3',"
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "xrde_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update"
      
      #end add-point 
      
      #將遮罩欄位還原
      CALL axrt400_xrde_t_mask_restore('restore_mask_o')
               
      UPDATE xrde_t 
         SET (xrdeld,xrdedocno,
              xrdeseq
              ,xrde002,xrde006,xrde003,xrde004,xrde008,xrde032,xrde010,xrde016,xrde100,xrde101,xrde109,xrde119,xrde014,xrde013,xrde001,xrdecomp,xrdesite,xrdeorga,xrde011,xrde015,xrde012,xrde120,xrde121,xrde129,xrde130,xrde131,xrde139,xrde017,xrde018,xrde019,xrde035,xrde036,xrde020,xrde022,xrde023,xrde039,xrde040,xrde042,xrde043,xrde044,xrde045,xrde046,xrde047,xrde048,xrde049,xrde050,xrde051) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_xrde_d[g_detail_idx].xrde002,g_xrde_d[g_detail_idx].xrde006,g_xrde_d[g_detail_idx].xrde003, 
                  g_xrde_d[g_detail_idx].xrde004,g_xrde_d[g_detail_idx].xrde008,g_xrde_d[g_detail_idx].xrde032, 
                  g_xrde_d[g_detail_idx].xrde010,g_xrde_d[g_detail_idx].xrde016,g_xrde_d[g_detail_idx].xrde100, 
                  g_xrde_d[g_detail_idx].xrde101,g_xrde_d[g_detail_idx].xrde109,g_xrde_d[g_detail_idx].xrde119, 
                  g_xrde_d[g_detail_idx].xrde014,g_xrde_d[g_detail_idx].xrde013,g_xrde_d[g_detail_idx].xrde001, 
                  g_xrde_d[g_detail_idx].xrdecomp,g_xrde_d[g_detail_idx].xrdesite,g_xrde_d[g_detail_idx].xrdeorga, 
                  g_xrde_d[g_detail_idx].xrde011,g_xrde_d[g_detail_idx].xrde015,g_xrde_d[g_detail_idx].xrde012, 
                  g_xrde2_d[g_detail_idx].xrde120,g_xrde2_d[g_detail_idx].xrde121,g_xrde2_d[g_detail_idx].xrde129, 
                  g_xrde2_d[g_detail_idx].xrde130,g_xrde2_d[g_detail_idx].xrde131,g_xrde2_d[g_detail_idx].xrde139, 
                  g_xrde3_d[g_detail_idx].xrde017,g_xrde3_d[g_detail_idx].xrde018,g_xrde3_d[g_detail_idx].xrde019, 
                  g_xrde3_d[g_detail_idx].xrde035,g_xrde3_d[g_detail_idx].xrde036,g_xrde3_d[g_detail_idx].xrde020, 
                  g_xrde3_d[g_detail_idx].xrde022,g_xrde3_d[g_detail_idx].xrde023,g_xrde3_d[g_detail_idx].xrde039, 
                  g_xrde3_d[g_detail_idx].xrde040,g_xrde3_d[g_detail_idx].xrde042,g_xrde3_d[g_detail_idx].xrde043, 
                  g_xrde3_d[g_detail_idx].xrde044,g_xrde3_d[g_detail_idx].xrde045,g_xrde3_d[g_detail_idx].xrde046, 
                  g_xrde3_d[g_detail_idx].xrde047,g_xrde3_d[g_detail_idx].xrde048,g_xrde3_d[g_detail_idx].xrde049, 
                  g_xrde3_d[g_detail_idx].xrde050,g_xrde3_d[g_detail_idx].xrde051) 
         WHERE xrdeent = g_enterprise AND xrdeld = ps_keys_bak[1] AND xrdedocno = ps_keys_bak[2] AND xrdeseq = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update"
      
      #end add-point   
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xrde_t" 
            LET g_errparam.code   = "std-00009" 
            LET g_errparam.popup  = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xrde_t:",SQLERRMESSAGE 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
 
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL axrt400_xrde_t_mask_restore('restore_mask_n')
               
      #add-point:update_b段修改後 name="update_b.after_update"
      
      #end add-point  
   END IF
   
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
   
   
   LET ls_group = "'4','5','6',"
   #判斷是否是同一群組的table
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "xrce_t" THEN
      #add-point:update_b段修改前 name="update_b.before_update2"
      
      #end add-point  
      
      #將遮罩欄位還原
      CALL axrt400_xrce_t_mask_restore('restore_mask_o')
               
      UPDATE xrce_t 
         SET (xrceld,xrcedocno,
              xrceseq
              ,xrce002,xrce003,xrce004,xrce005,xrce054,xrce010,xrce016,xrce100,xrce101,xrce109,xrce119,xrce001,xrcecomp,xrcesite,xrceorga,xrce027,xrce015,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139,xrce017,xrce018,xrce019,xrce035,xrce036,xrce020,xrce022,xrce023,xrce039,xrce040,xrce042,xrce043,xrce044,xrce045,xrce046,xrce047,xrce048,xrce049,xrce050,xrce051) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_xrde4_d[g_detail_idx].xrce002,g_xrde4_d[g_detail_idx].xrce003,g_xrde4_d[g_detail_idx].xrce004, 
                  g_xrde4_d[g_detail_idx].xrce005,g_xrde4_d[g_detail_idx].xrce054,g_xrde4_d[g_detail_idx].xrce010, 
                  g_xrde4_d[g_detail_idx].xrce016,g_xrde4_d[g_detail_idx].xrce100,g_xrde4_d[g_detail_idx].xrce101, 
                  g_xrde4_d[g_detail_idx].xrce109,g_xrde4_d[g_detail_idx].xrce119,g_xrde4_d[g_detail_idx].xrce001, 
                  g_xrde4_d[g_detail_idx].xrcecomp,g_xrde4_d[g_detail_idx].xrcesite,g_xrde4_d[g_detail_idx].xrceorga, 
                  g_xrde4_d[g_detail_idx].xrce027,g_xrde4_d[g_detail_idx].xrce015,g_xrde5_d[g_detail_idx].xrce120, 
                  g_xrde5_d[g_detail_idx].xrce121,g_xrde5_d[g_detail_idx].xrce129,g_xrde5_d[g_detail_idx].xrce130, 
                  g_xrde5_d[g_detail_idx].xrce131,g_xrde5_d[g_detail_idx].xrce139,g_xrde6_d[g_detail_idx].xrce017, 
                  g_xrde6_d[g_detail_idx].xrce018,g_xrde6_d[g_detail_idx].xrce019,g_xrde6_d[g_detail_idx].xrce035, 
                  g_xrde6_d[g_detail_idx].xrce036,g_xrde6_d[g_detail_idx].xrce020,g_xrde6_d[g_detail_idx].xrce022, 
                  g_xrde6_d[g_detail_idx].xrce023,g_xrde6_d[g_detail_idx].xrce039,g_xrde6_d[g_detail_idx].xrce040, 
                  g_xrde6_d[g_detail_idx].xrce042,g_xrde6_d[g_detail_idx].xrce043,g_xrde6_d[g_detail_idx].xrce044, 
                  g_xrde6_d[g_detail_idx].xrce045,g_xrde6_d[g_detail_idx].xrce046,g_xrde6_d[g_detail_idx].xrce047, 
                  g_xrde6_d[g_detail_idx].xrce048,g_xrde6_d[g_detail_idx].xrce049,g_xrde6_d[g_detail_idx].xrce050, 
                  g_xrde6_d[g_detail_idx].xrce051) 
         WHERE xrceent = g_enterprise AND xrceld = ps_keys_bak[1] AND xrcedocno = ps_keys_bak[2] AND xrceseq = ps_keys_bak[3]
      #add-point:update_b段修改中 name="update_b.m_update2"
      
      #end add-point  
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xrce_t" 
            LET g_errparam.code   = "std-00009" 
            LET g_errparam.popup  = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "xrce_t:",SQLERRMESSAGE 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL s_transaction_end('N','0')
            CALL cl_err()
            
         OTHERWISE
          
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL axrt400_xrce_t_mask_restore('restore_mask_n')
 
      #add-point:update_b段修改後 name="update_b.after_update2"
      
      #end add-point  
   END IF
 
   #子表處理
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      
   END IF
 
 
   
 
   
   #add-point:update_b段other name="update_b.other"
   
   #end add-point  
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.key_update_b" >}
#+ 上層單身key欄位變動後, 連帶修正下層單身key欄位
PRIVATE FUNCTION axrt400_key_update_b(ps_keys_bak,ps_table)
   #add-point:update_b段define(客製用) name="key_update_b.define_customerization"
   
   #end add-point
   DEFINE ps_keys_bak       DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table          STRING
   DEFINE l_field_key       DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak    DYNAMIC ARRAY OF STRING
   DEFINE l_new_key         DYNAMIC ARRAY OF STRING
   DEFINE l_old_key         DYNAMIC ARRAY OF STRING
   #add-point:update_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="key_update_b.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="key_update_b.pre_function"
   
   #end add-point
   
 
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.key_delete_b" >}
#+ 上層單身刪除後, 連帶刪除下層單身key欄位
PRIVATE FUNCTION axrt400_key_delete_b(ps_keys_bak,ps_table)
   #add-point:delete_b段define(客製用) name="key_delete_b.define_customerization"
   
   #end add-point
   DEFINE ps_keys_bak       DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table          STRING
   DEFINE l_field_keys      DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak    DYNAMIC ARRAY OF STRING
   DEFINE l_new_key         DYNAMIC ARRAY OF STRING
   DEFINE l_old_key         DYNAMIC ARRAY OF STRING
   #add-point:delete_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="key_delete_b.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="key_delete_b.pre_function"
   
   #end add-point
   
 
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.lock_b" >}
#+ 連動lock其他單身table資料
PRIVATE FUNCTION axrt400_lock_b(ps_table,ps_page)
   #add-point:lock_b段define(客製用) name="lock_b.define_customerization"
   
   #end add-point   
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:lock_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="lock_b.define"
   
   #end add-point   
   
   #add-point:Function前置處理  name="lock_b.pre_function"
   
   #end add-point
    
   #先刷新資料
   #CALL axrt400_b_fill()
   
   #鎖定整組table
   #LET ls_group = "'1','2','3',"
   #僅鎖定自身table
   LET ls_group = "xrde_t"
   
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN axrt400_bcl USING g_enterprise,
                                       g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrde_d[g_detail_idx].xrdeseq  
                                               
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "axrt400_bcl:",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
                                    
   #鎖定整組table
   #LET ls_group = "'4','5','6',"
   #僅鎖定自身table
   LET ls_group = "xrce_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
   
      OPEN axrt400_bcl2 USING g_enterprise,
                                             g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrde4_d[g_detail_idx].xrceseq 
 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "axrt400_bcl2:",SQLERRMESSAGE 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
 
 
   
 
   
   #add-point:lock_b段other name="lock_b.other"
   
   #end add-point  
   
   RETURN TRUE
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.unlock_b" >}
#+ 連動unlock其他單身table資料
PRIVATE FUNCTION axrt400_unlock_b(ps_table,ps_page)
   #add-point:unlock_b段define(客製用) name="unlock_b.define_customerization"
   
   #end add-point  
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:unlock_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="unlock_b.define"
   
   #end add-point  
   
   #add-point:Function前置處理  name="unlock_b.pre_function"
   
   #end add-point
    
   LET ls_group = "'1','2','3',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE axrt400_bcl
   END IF
   
   LET ls_group = "'4','5','6',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE axrt400_bcl2
   END IF
 
 
   
 
 
   #add-point:unlock_b段other name="unlock_b.other"
   
   #end add-point  
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_entry" >}
#+ 單頭欄位開啟設定
PRIVATE FUNCTION axrt400_set_entry(p_cmd)
   #add-point:set_entry段define(客製用) name="set_entry.define_customerization"
   
   #end add-point       
   DEFINE p_cmd   LIKE type_t.chr1  
   #add-point:set_entry段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_entry.define"
   
   #end add-point       
   
   #add-point:Function前置處理  name="set_entry.pre_function"
   
   #end add-point
   
   CALL cl_set_comp_entry("xrdadocno,xrdald",TRUE)
   
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("xrdald,xrdadocno",TRUE)
      CALL cl_set_comp_entry("xrdadocdt",TRUE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,TRUE)
      END IF
      #add-point:set_entry段欄位控制 name="set_entry.field_control"
      CALL cl_set_comp_entry("xrdasite,xrda003,xrdadocdt",TRUE)
      #end add-point  
   END IF
   
   #add-point:set_entry段欄位控制後 name="set_entry.after_control"
   CALL cl_set_comp_entry("xrda004,xrda005",TRUE)   #160420-00001#1 Add
   #end add-point 
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_no_entry" >}
#+ 單頭欄位關閉設定
PRIVATE FUNCTION axrt400_set_no_entry(p_cmd)
   #add-point:set_no_entry段define(客製用) name="set_no_entry.define_customerization"
   
   #end add-point     
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_no_entry.define"
   DEFINE l_success  LIKE type_t.num5     #151130-00015#2 
   DEFINE l_slip     LIKE type_t.chr10  #151130-00015#2
   DEFINE l_dfin0033  LIKE type_t.chr80 #151130-00015#2
   #end add-point     
   
   #add-point:Function前置處理  name="set_no_entry.pre_function"
   CALL cl_set_comp_entry("xrda015",FALSE) #151105-00007#3 06948 add
   #end add-point
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("xrdald,xrdadocno",FALSE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,FALSE)
      END IF
      #add-point:set_no_entry段欄位控制 name="set_no_entry.field_control"
      CALL cl_set_comp_entry("xrdasite,xrda003,xrdadocdt",FALSE)
      #end add-point 
   END IF 
   
   IF p_cmd = 'u' THEN  #docno,ld欄位確認是絕對關閉
      CALL cl_set_comp_entry("xrdadocno,xrdald",FALSE)
   END IF 
 
   IF p_cmd = 'u' THEN  #docdt欄位依照設定關閉(FALSE則為設定不同意修正)
      IF NOT cl_chk_update_docdt() THEN
         CALL cl_set_comp_entry("xrdadocdt",FALSE)
      END IF
   END IF 
   
   #add-point:set_no_entry段欄位控制後 name="set_no_entry.after_control"
   #151130-00015#2 -begin -add by XZG 20151222
      IF NOT cl_null(g_xrda_m.xrdadocno) THEN  
            #获取单别
            CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno) RETURNING l_success,l_slip
            #是否可改日期
            CALL s_fin_get_doc_para(g_xrda_m.xrdald,g_xrda_m.xrdacomp,l_slip,'D-FIN-0033') RETURNING l_dfin0033
            IF l_dfin0033 = "N"  THEN 
               CALL cl_set_comp_entry("xrdadocdt",FALSE)
            ELSE 
               CALL cl_set_comp_entry("xrdadocdt",TRUE)
            END IF          
         END IF 
      #151130-00015#2  -end
   #160420-00001#1 Add  ---(S)---
   IF p_cmd = 'u' THEN
      CALL cl_set_comp_entry("xrda004,xrda005",FALSE)
   END IF
   #160420-00001#1 Add  ---(E)---
   #end add-point 
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_entry_b" >}
#+ 單身欄位開啟設定
PRIVATE FUNCTION axrt400_set_entry_b(p_cmd)
   #add-point:set_entry_b段define(客製用) name="set_entry_b.define_customerization"
   
   #end add-point     
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_entry_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_entry_b.define"
   
   #end add-point     
   
   #add-point:Function前置處理  name="set_entry_b.pre_function"
   
   #end add-point
    
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("",TRUE)
      #add-point:set_entry段欄位控制 name="set_entry_b.field_control"
      
      #end add-point  
   END IF
   
   #add-point:set_entry_b段 name="set_entry_b.set_entry_b"
   CALL cl_set_comp_entry('xrde100,xrde101',TRUE)
   CALL cl_set_comp_entry('xrce100,xrce101',TRUE)
   CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde100,xrde109',TRUE)
   CALL cl_set_comp_entry('xrde101,xrde119,xrde010,xrde014,xrde013,xrde019',TRUE)
   CALL cl_set_comp_entry('xrde032',TRUE)#160114-00019#2 Add
   CALL cl_set_comp_required('xrde032',FALSE)#160913-00023#1 Add
   #end add-point  
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_no_entry_b" >}
#+ 單身欄位關閉設定
PRIVATE FUNCTION axrt400_set_no_entry_b(p_cmd)
   #add-point:set_no_entry_b段define(客製用) name="set_no_entry_b.define_customerization"
   
   #end add-point    
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_no_entry_b.define"
   
   #end add-point    
   
   #add-point:Function前置處理  name="set_no_entry_b.pre_function"
   
   #end add-point
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("",FALSE)
      #add-point:set_no_entry_b段欄位控制 name="set_no_entry_b.field_control"
      
      #end add-point 
   END IF 
   
   #add-point:set_no_entry_b段 name="set_no_entry_b.set_no_entry_b"
   CASE
      WHEN g_xrde_d[l_ac].xrde002 = '10' AND g_xrde_d[l_ac].xrde006 <> '90'
         CALL cl_set_comp_entry('xrde100,xrde101,xrde013,xrde014',FALSE)     
      WHEN g_xrde_d[l_ac].xrde002 = '10' AND g_xrde_d[l_ac].xrde006 = '90'         
         CALL cl_set_comp_entry('xrde013,xrde014',FALSE)  
      WHEN g_xrde_d[l_ac].xrde002 = '11'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '12'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '13'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '14'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '15'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '20'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '21'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '22'  
         CALL cl_set_comp_entry("xrde006,xrde003,xrde004",FALSE)  
      WHEN g_xrde_d[l_ac].xrde002 = '91'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '92'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '98'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
      WHEN g_xrde_d[l_ac].xrde002 = '99'
         CALL cl_set_comp_entry('xrde006,xrde003,xrde004,xrde013,xrde014',FALSE)
   END CASE   #150812-00010#2
   CASE       #150812-00010#2         
      WHEN g_xrde4_d[l_ac].xrce002 = '30'
         CALL cl_set_comp_entry('xrce100,xrce101',FALSE)
         #CALL cl_set_comp_visible('xrce025,xrce004',FALSE)
      WHEN g_xrde4_d[l_ac].xrce002 = '31'
         CALL cl_set_comp_entry('xrce100,xrce101',FALSE)
         #CALL cl_set_comp_visible('xrce025,xrce004',FALSE)
   END CASE
   #160913-00023#1 Add  ---(S)---
   #1.类型为10.收款的时候为必输,其他类型不限制
   #2.类型为10.收款,款别不为90.其他类型,有输入栏位单号时,带来源单号日期.且收款日期栏位不可录入
   IF g_xrde_d[l_ac].xrde002 = '10' THEN
      CALL cl_set_comp_required('xrde032',TRUE)
   ELSE
      CALL cl_set_comp_required('xrde032',FALSE)
   END IF
   #160913-00023#1 Add  ---(E)---
  #160114-00019#2 Add  ---(S)---
   IF g_xrde_d[l_ac].xrde002 = '10' AND g_xrde_d[l_ac].xrde006 <> '90' AND NOT cl_null(g_xrde_d[l_ac].xrde003) THEN
      CALL cl_set_comp_entry('xrde032',FALSE)
   END IF
  #160114-00019#2 Add  ---(E)---
   #end add-point     
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_act_visible" >}
#+ 單頭權限開啟
PRIVATE FUNCTION axrt400_set_act_visible()
   #add-point:set_act_visible段define(客製用) name="set_act_visible.define_customerization"
   
   #end add-point   
   #add-point:set_act_visible段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_visible.define"
   
   #end add-point   
   #add-point:set_act_visible段 name="set_act_visible.set_act_visible"
 
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_act_no_visible" >}
#+ 單頭權限關閉
PRIVATE FUNCTION axrt400_set_act_no_visible()
   #add-point:set_act_no_visible段define(客製用) name="set_act_no_visible.define_customerization"
   
   #end add-point   
   #add-point:set_act_no_visible段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_no_visible.define"
   
   #end add-point   
   #add-point:set_act_no_visible段 name="set_act_no_visible.set_act_no_visible"
#   IF g_xrda_m.xrdastus <> 'N' THEN
   IF g_xrda_m.xrdastus NOT MATCHES '[NDR]' THEN   #2015-5-29 zhujing mod
      CALL cl_set_act_visible('modify,modify_detail,delete',FALSE)
   ELSE
      CALL cl_set_act_visible('modify,modify_detail,delete',TRUE)
   END IF
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_act_visible_b" >}
#+ 單身權限開啟
PRIVATE FUNCTION axrt400_set_act_visible_b()
   #add-point:set_act_visible_b段define(客製用) name="set_act_visible_b.define_customerization"
   
   #end add-point   
   #add-point:set_act_visible_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_visible_b.define"
   
   #end add-point   
   #add-point:set_act_visible_b段 name="set_act_visible_b.set_act_visible_b"
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.set_act_no_visible_b" >}
#+ 單身權限關閉
PRIVATE FUNCTION axrt400_set_act_no_visible_b()
   #add-point:set_act_no_visible_b段define(客製用) name="set_act_no_visible_b.define_customerization"
   
   #end add-point   
   #add-point:set_act_no_visible_b段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_act_no_visible_b.define"
   #160111-00020#5--add--str--lujh
   IF g_xrda_m.xrda004 = 'EMPL' THEN 
      CALL cl_set_comp_visible('xrca057,xrca057_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('xrca057,xrca057_desc',FALSE)
   END IF
   #160111-00020#5--add--str--lujh
   #end add-point   
   #add-point:set_act_no_visible_b段 name="set_act_no_visible_b.set_act_no_visible_b"
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.default_search" >}
#+ 外部參數搜尋
PRIVATE FUNCTION axrt400_default_search()
   #add-point:default_search段define(客製用) name="default_search.define_customerization"
   
   #end add-point  
   DEFINE li_idx     LIKE type_t.num10
   DEFINE li_cnt     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE ls_where   STRING
   #add-point:default_search段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="default_search.define"
   
   #end add-point  
   
   #add-point:Function前置處理 name="default_search.before"
   
   #end add-point  
   
   LET g_pagestart = 1
   
   IF cl_null(g_order) THEN
      LET g_order = "ASC"
   END IF
   
   IF NOT cl_null(g_argv[01]) THEN
      LET ls_wc = ls_wc, " xrdald = '", g_argv[01], "' AND "
   END IF
   
   IF NOT cl_null(g_argv[02]) THEN
      LET ls_wc = ls_wc, " xrdadocno = '", g_argv[02], "' AND "
   END IF
 
   
   #add-point:default_search段after sql name="default_search.after_sql"
   
   #end add-point  
   
   IF NOT cl_null(ls_wc) THEN
      LET g_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_default = TRUE
   ELSE
      #若無外部參數則預設為1=2
      LET g_default = FALSE
      
      #預設查詢條件
      CALL cl_qbe_get_default_qryplan() RETURNING ls_where
      IF NOT cl_null(ls_where) THEN
         CALL util.JSON.parse(ls_where, la_wc)
         INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
         INITIALIZE g_wc2_table2 TO NULL
 
 
         FOR li_idx = 1 TO la_wc.getLength()
            CASE
               WHEN la_wc[li_idx].tableid = "xrda_t" 
                  LET g_wc = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "xrde_t" 
                  LET g_wc2_table1 = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "xrce_t" 
                  LET g_wc2_table2 = la_wc[li_idx].wc
 
 
               WHEN la_wc[li_idx].tableid = "EXTENDWC"
                  LET g_wc2_extend = la_wc[li_idx].wc
            END CASE
         END FOR
         IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
            OR NOT cl_null(g_wc2_table2)
 
 
            OR NOT cl_null(g_wc2_extend)
            THEN
            #組合g_wc2
            IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
               LET g_wc2 = g_wc2_table1
            END IF
            IF g_wc2_table2 <> " 1=1" AND NOT cl_null(g_wc2_table2) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_table2
            END IF
 
 
            IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
            END IF
         
            IF g_wc2.subString(1,5) = " AND " THEN
               LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
            END IF
         END IF
      END IF
    
      IF cl_null(g_wc) AND cl_null(g_wc2) THEN
         LET g_wc = " 1=2"
      END IF
   END IF
   
   #add-point:default_search段結束前 name="default_search.after"
   
   #end add-point  
 
   IF g_wc.getIndexOf(" 1=2", 1) THEN
      LET g_default = TRUE
   END IF
 
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.state_change" >}
   #應用 a09 樣板自動產生(Version:17)
#+ 確認碼變更 
PRIVATE FUNCTION axrt400_statechange()
   #add-point:statechange段define(客製用) name="statechange.define_customerization"
   
   #end add-point  
   DEFINE lc_state LIKE type_t.chr5
   #add-point:statechange段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="statechange.define"
   DEFINE l_success     LIKE type_t.num5
   DEFINE l_wc          STRING
   DEFINE l_n           LIKE type_t.num5
   DEFINE l_slip        LIKE xrda_t.xrdadocno
   DEFINE l_ooac004     LIKE ooac_t.ooac004
   DEFINE l_efin5001    LIKE type_t.chr1
   DEFINE l_ooba002     LIKE ooba_t.ooba002
   DEFINE t_success     LIKE type_t.chr1
   DEFINE l_dfin0032    LIKE type_t.chr1    #151125-00006#1-add
   #end add-point  
   
   #add-point:Function前置處理 name="statechange.before"
   #141226-00016#2 By 01727 Add ---(S)---
   CALL s_axrt300_date_chk(g_xrda_m.xrdasite,g_xrda_m.xrdadocdt) RETURNING l_success
   IF NOT l_success THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "axr-00300"
      LET g_errparam.popup  = TRUE 
      CALL cl_err() 
      RETURN
   END IF
   #141226-00016#2 By 01727 Add ---(S)---
   CALL axrt400_ui_headershow()
   #end add-point  
   
   ERROR ""     #清空畫面右下側ERROR區塊
 
   IF g_xrda_m.xrdald IS NULL
      OR g_xrda_m.xrdadocno IS NULL
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   CALL s_transaction_begin()
   
   OPEN axrt400_cl USING g_enterprise,g_xrda_m.xrdald,g_xrda_m.xrdadocno
   IF STATUS THEN
      CLOSE axrt400_cl
      CALL s_transaction_end('N','0')
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN axrt400_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #顯示最新的資料
   EXECUTE axrt400_master_referesh USING g_xrda_m.xrdald,g_xrda_m.xrdadocno INTO g_xrda_m.xrdasite,g_xrda_m.xrda003, 
       g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005, 
       g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010, 
       g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003_desc, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda005_desc,g_xrda_m.xrda004_desc,g_xrda_m.xrda015_desc, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid_desc,g_xrda_m.xrdacrtdp_desc, 
       g_xrda_m.xrdamodid_desc,g_xrda_m.xrdacnfid_desc
   
 
   #檢查是否允許此動作
   IF NOT axrt400_action_chk() THEN
      CLOSE axrt400_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #將資料顯示到畫面上
   DISPLAY BY NAME g_xrda_m.xrdasite,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003,g_xrda_m.xrda003_desc,g_xrda_m.xrdald, 
       g_xrda_m.xrdald_desc,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda001, 
       g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda005_desc,g_xrda_m.xrda004,g_xrda_m.xrda004_desc, 
       g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008,g_xrda_m.xrda010,g_xrda_m.xrda017, 
       g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda015_desc,g_xrda_m.xrda016,g_xrda_m.xrdaownid, 
       g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtid_desc, 
       g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdp_desc,g_xrda_m.xrdacrtdt,g_xrda_m.xrdamodid,g_xrda_m.xrdamodid_desc, 
       g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfid_desc,g_xrda_m.xrdacnfdt,g_xrda_m.xrda007_desc, 
       g_xrda_m.l_desc,g_xrda_m.lbl_amt5_desc,g_xrda_m.lbl_amt1_1_desc,g_xrda_m.lbl_amt3_1_desc,g_xrda_m.lbl_amt5_1_desc 
 
 
   CASE g_xrda_m.xrdastus
      WHEN "N"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
      WHEN "Y"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
      WHEN "A"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
      WHEN "D"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
      WHEN "R"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
      WHEN "W"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
      WHEN "X"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
      
   END CASE
 
   #add-point:資料刷新後 name="statechange.after_refresh"
   
   #end add-point
 
   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_xrda_m.xrdastus
            
            WHEN "N"
               HIDE OPTION "unconfirmed"
            WHEN "Y"
               HIDE OPTION "confirmed"
            WHEN "A"
               HIDE OPTION "approved"
            WHEN "D"
               HIDE OPTION "withdraw"
            WHEN "R"
               HIDE OPTION "rejection"
            WHEN "W"
               HIDE OPTION "signing"
            WHEN "X"
               HIDE OPTION "invalid"
         END CASE
     
      #add-point:menu前 name="statechange.before_menu"
#20150710--by--02599--mod--str--
#         CASE g_xrda_m.xrdastus
#            WHEN "Y"
#               HIDE OPTION "confirmed"
#               HIDE OPTION "invalid"
#         END CASE
      #160308-00010#6 add ---(S)---
      CALL cl_set_act_visible("unconfirmed,invalid,confirmed",TRUE)
      CALL cl_set_act_visible("signing,withdraw",FALSE)   #160413-00027#1   Add
      #160308-00010#6 add ---(E)---
      
      #CALL cl_set_act_visible("confirmed,unconfirmed,invalid",FALSE) #160308-00010#6 mark
      CASE g_xrda_m.xrdastus
         WHEN "N"
            #CALL cl_set_act_visible("confirmed,invalid",TRUE)        #160308-00010#6 mark              
            #160308-00010#6 add ---(S)---
            CALL cl_set_act_visible("unconfirmed,",FALSE)
            #需提交至BPM時，則顯示「提交」功能並隱藏「確認」功能
            IF cl_bpm_chk() THEN
                CALL cl_set_act_visible("signing",TRUE)
                CALL cl_set_act_visible("confirmed",FALSE)
            END IF
            #160308-00010#6 add ---(E)---
            
         WHEN "Y"
            #CALL cl_set_act_visible("unconfirmed",TRUE)              #160308-00010#6 mark 
            CALL cl_set_act_visible("invalid,confirmed",FALSE)        #160308-00010#6 add 
         WHEN "X"
            CALL cl_set_act_visible("unconfirmed,invalid,confirmed",FALSE) #160308-00010#6 add 
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'anm-00044'
            LET g_errparam.extend = g_xrda_m.xrdadocno
            LET g_errparam.popup = FALSE
            CALL cl_err()
            CLOSE axrt400_cl
            CALL s_transaction_end('N','0')
            RETURN
            
         #160308-00010#6 add ---(S)---
         WHEN "R"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
            CALL cl_set_act_visible("confirmed,unconfirmed",FALSE)

         WHEN "D"   #保留修改的功能(如作廢)，隱藏其他應用功能(如: 確認、未確認、留置、過帳…)
            CALL cl_set_act_visible("confirmed,unconfirmed",FALSE)
            
         WHEN "W"    #只能顯示抽單;其餘應用功能皆隱藏
             CALL cl_set_act_visible("withdraw",TRUE)  
             CALL cl_set_act_visible("unconfirmed,invalid,confirmed",FALSE)
         
         WHEN "A"     #只能顯示確認; 其餘應用功能皆隱藏
             CALL cl_set_act_visible("confirmed ",TRUE)  
             CALL cl_set_act_visible("unconfirmed,invalid",FALSE)
         #160308-00010#6 add ---(E)---
         
      END CASE
#20150710--by--02599--mod--end
      #end add-point
      
      #應用 a36 樣板自動產生(Version:5)
      #提交
      ON ACTION signing
         IF cl_auth_chk_act("signing") THEN
            IF NOT axrt400_send() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE axrt400_cl
            RETURN
         END IF
    
      #抽單
      ON ACTION withdraw
         IF cl_auth_chk_act("withdraw") THEN
            IF NOT axrt400_draw_out() THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
            #因應簽核行為, 該動作完成後不再進行後續處理
            #於此處直接返回
            CLOSE axrt400_cl
            RETURN
         END IF
 
 
 
	  
      ON ACTION unconfirmed
         IF cl_auth_chk_act("unconfirmed") THEN
            LET lc_state = "N"
            #add-point:action控制 name="statechange.unconfirmed"
            
            #end add-point
         END IF
         EXIT MENU
      ON ACTION confirmed
         IF cl_auth_chk_act("confirmed") THEN
            LET lc_state = "Y"
            #add-point:action控制 name="statechange.confirmed"
           ##150602-00057#2 by 02291 add
           #CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno) RETURNING l_success,l_ooba002
           #CALL s_fin_chk_E5001(g_xrda_m.xrdald,g_xrda_m.xrdacomp,l_ooba002) RETURNING l_efin5001
           #IF l_efin5001 = 'N' THEN
           #   IF g_xrda_m.xrdacrtid = g_user THEN
           #      INITIALIZE g_errparam TO NULL
           #      LET g_errparam.code = 'axr-00346'
           #      LET g_errparam.extend = ''
           #      LET g_errparam.popup = TRUE
           #      CALL cl_err()
           #      CALL s_transaction_end('N','0')
           #      CLOSE axrt400_cl
           #      RETURN
           #   END IF
           #END IF
           #
           ##150602-00057#2 by 02291 add
            #end add-point
         END IF
         EXIT MENU
      ON ACTION approved
         IF cl_auth_chk_act("approved") THEN
            LET lc_state = "A"
            #add-point:action控制 name="statechange.approved"
            
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION withdraw
      #   IF cl_auth_chk_act("withdraw") THEN
      #      LET lc_state = "D"
      #      #add-point:action控制 name="statechange.withdraw"
      #      
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION rejection
         IF cl_auth_chk_act("rejection") THEN
            LET lc_state = "R"
            #add-point:action控制 name="statechange.rejection"
            
            #end add-point
         END IF
         EXIT MENU
      #ON ACTION signing
      #   IF cl_auth_chk_act("signing") THEN
      #      LET lc_state = "W"
      #      #add-point:action控制 name="statechange.signing"
      #      
      #      #end add-point
      #   END IF
      #   EXIT MENU
      ON ACTION invalid
         IF cl_auth_chk_act("invalid") THEN
            LET lc_state = "X"
            #add-point:action控制 name="statechange.invalid"
            
            #end add-point
         END IF
         EXIT MENU
 
      #add-point:stus控制 name="statechange.more_control"
      
      #end add-point
      
   END MENU
   
   #確認被選取的狀態碼在清單中
   IF (lc_state <> "N" 
      AND lc_state <> "Y"
      AND lc_state <> "A"
      AND lc_state <> "D"
      AND lc_state <> "R"
      AND lc_state <> "W"
      AND lc_state <> "X"
      ) OR 
      g_xrda_m.xrdastus = lc_state OR cl_null(lc_state) THEN
      CLOSE axrt400_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #add-point:stus修改前 name="statechange.b_update"
   CALL s_transaction_begin()
   CALL cl_err_collect_init()
   CASE
      WHEN lc_state = 'Y'
        #IF g_glaa_t.glaa121 = 'Y' THEN  
        #   SELECT COUNT(*) INTO l_n 
        #     FROM glga_t
        #    WHERE glgaent   = g_enterprise 
        #      AND glgald    = g_xrda_m.xrdald
        #      AND glgadocno = g_xrda_m.xrdadocno 
        #      AND glga100   = 'AR'
        #      AND glga101   = 'R20'
        #      
        #   CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno )
        #   RETURNING l_success,l_slip            
        #      
        #   #是否抛傳票    
        #   SELECT ooac004 INTO l_ooac004
        #     FROM ooac_t
        #    WHERE ooacent = g_enterprise
        #      AND ooac001 = g_glaa_t.glaa024
        #      AND ooac002 = l_slip
        #      AND ooac003 = 'D-FIN-0030'   
        #      
        #   IF l_n = 0 AND l_ooac004 = 'Y' THEN 
        #      CALL s_pre_voucher_ins('AR','R20',g_xrda_m.xrdald,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,'2') RETURNING l_success
        #      
        #      IF l_success = FALSE THEN
        #         CALL s_transaction_end('N','1') 
        #         CALL cl_err_collect_show()      
        #         RETURN
        #      ELSE
        #         CALL s_transaction_end('Y','0')
        #         CALL s_transaction_begin()
        #      END IF
        #   END IF
        #END IF
         
        #CALL s_axrt400_confirm(g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING g_errno
         LET t_success = 'Y'
         CALL s_axrt400_conf_chk(g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING l_success,g_errno
         IF NOT l_success THEN
            LET t_success = 'N'
         END IF
         IF NOT cl_ask_confirm('aim-00108') THEN
            LET t_success = 'N'
         END IF
         IF NOT s_axrt400_conf_upd(g_xrda_m.xrdald,g_xrda_m.xrdadocno) THEN
            LET t_success = 'N'
         END IF
        #160503-00036#1 Add  ---(S)---
         IF t_success = 'Y' THEN
            LET g_xrda_m.xrdacnfdt = cl_get_current()
            LET g_xrda_m.xrdacnfid = g_user
            UPDATE xrda_t 
               SET (xrdacnfid,xrdacnfdt) 
                 = (g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt)     
             WHERE xrdaent = g_enterprise AND xrdald = g_xrda_m.xrdald
               AND xrdadocno = g_xrda_m.xrdadocno
         END IF
        #160503-00036#1 Add  ---(E)---
         IF g_errno = 'S' THEN
            CALL s_transaction_end('N',0)
                            #p_type,p_comp,p_xrda003,p_xrda004,p_docno,p_docdt,p_ld,p_amt
            LET g_amt = 0
            CALL axrt400_ref_amt()
            IF g_amt > 0 THEN
               CALL axrt400_09('1',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
            ELSE
               LET g_amt = g_amt * -1
               CALL axrt400_09('2',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
            END IF
            CALL axrt400_show()
            RETURN
                   
         END IF
         
         LET g_errno = t_success

      WHEN lc_state = 'N'
         CALL s_axrt400_unconfirm(g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING g_errno
        #160503-00036#1 Add  ---(S)---
         IF g_errno = 'Y' THEN
            LET g_xrda_m.xrdacnfdt = ''
            LET g_xrda_m.xrdacnfid = ''
            UPDATE xrda_t 
               SET (xrdacnfid,xrdacnfdt) 
                 = (g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt)     
             WHERE xrdaent = g_enterprise AND xrdald = g_xrda_m.xrdald
               AND xrdadocno = g_xrda_m.xrdadocno
         END IF
        #160503-00036#1 Add  ---(E)---
      WHEN lc_state = 'X'
         LET g_errno = 'Y'   
         # 151105-00007#3 --- add start --- by 06948
         IF NOT cl_ask_confirm('aim-00109') THEN
            CALL s_transaction_end('N','0') 
            CALL cl_err_collect_show()   
            RETURN
         ELSE
            CALL cl_set_comp_entry("xrda015",TRUE) 
            INPUT BY NAME g_xrda_m.xrda015 WITHOUT DEFAULTS
               BEFORE INPUT
                  LET INT_FLAG = 0
               
               ON ACTION controlp INFIELD xrda015
                  #作廢
         		   INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
         		   LET g_qryparam.reqry = FALSE
                  LET g_qryparam.default1 = g_xrda_m.xrda015       
                  LET g_qryparam.arg1 = "3115"
                  CALL q_oocq002()                           
                  LET g_xrda_m.xrda015 = g_qryparam.return1     
                  CALL s_desc_get_acc_desc('3115',g_xrda_m.xrda015) RETURNING g_xrda_m.xrda015_desc
                  DISPLAY BY NAME g_xrda_m.xrda015,g_xrda_m.xrda015_desc            
                  NEXT FIELD xrda015   
               
               AFTER FIELD xrda015
                  LET g_xrda_m.xrda015_desc = ' '
                  IF NOT cl_null(g_xrda_m.xrda015) THEN
                     IF NOT s_azzi650_chk_exist('3115',g_xrda_m.xrda015) THEN
                        LET g_xrda_m.xrda015 = g_xrda_m_t.xrda015
                        CALL s_desc_get_acc_desc('3115',g_xrda_m.xrda015) RETURNING g_xrda_m.xrda015_desc
                        DISPLAY BY NAME g_xrda_m.xrda015_desc
                        NEXT FIELD CURRENT
                     END IF
                  ELSE
                     NEXT FIELD CURRENT 
                  END IF
                  CALL s_desc_get_acc_desc('3115',g_xrda_m.xrda015) RETURNING g_xrda_m.xrda015_desc
                  DISPLAY BY NAME g_xrda_m.xrda015_desc 
               
               AFTER INPUT
                  IF NOT cl_null(g_xrda_m.xrdald) THEN
                     UPDATE xrda_t SET xrda015 = g_xrda_m.xrda015
                      WHERE xrdaent   = g_enterprise
                        AND xrdald    = g_xrda_m.xrdald
                        AND xrdadocno = g_xrda_m.xrdadocno
                  END IF
               ON ACTION accept
                  ACCEPT INPUT
              
               ON ACTION cancel
                  LET INT_FLAG = 1
                  LET g_xrda_m.xrda015 = ''
                  LET g_xrda_m.xrda015_desc = ''
                  EXIT INPUT 
                  
               IF INT_FLAG THEN
                  CALL cl_err_collect_show()   
                  CALL s_transaction_end('N','0') 
                  RETURN
               END IF
            END INPUT
            IF cl_null(g_xrda_m.xrda015) THEN
               LET lc_state = 'N'
               LET g_xrda_m.xrdastus = lc_state
               CALL s_transaction_end('N','0') 
               CALL cl_err_collect_show()   
               DISPLAY BY NAME g_xrda_m.xrda015,g_xrda_m.xrda015_desc,g_xrda_m.xrdastus
               RETURN
            END IF
            
            #160607-00015#1 add ------
            #作廢時需清空aist340的單身收款明細之收款核銷單號(isbc005)、收款核銷單項次(isbc006)要清空
            UPDATE isbc_t SET isbc005 = '',isbc006 = ''
             WHERE isbcent = g_enterprise
               AND isbc005 = g_xrda_m.xrdadocno
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.extend = ""
               LET g_errparam.code   = SQLCA.sqlcode
               LET g_errparam.popup  = FALSE
               CALL cl_err()
               LET g_errno = 'N'
            END IF
            #160607-00015#1 add end---
            
            CALL cl_err_collect_show()
         END IF 
         # 151105-00007#3 --- add end   --- by 06948       
   END CASE
   
   IF g_glaa_t.glaa121 = 'Y' THEN 
      LET l_wc = "glgadocno = '",g_xrda_m.xrdadocno,"'"
      CALL s_pre_voucher_upd('AR','R20',g_xrda_m.xrdald,lc_state,'','',l_wc) RETURNING l_success
      
      IF l_success = FALSE THEN 
         LET g_errno = 'N'
      END IF
      
   END IF
   
   CALL cl_err_collect_show()
   IF g_errno = 'Y' THEN
      CALL s_transaction_end('Y',0)
   ELSE
      CALL s_transaction_end('N',0)
      LET g_xrda_m.xrda015 = ''           #151105-00007#3  06948 add
      DISPLAY BY NAME g_xrda_m.xrda015    #151105-00007#3  06948 add
      RETURN
   END IF
   #end add-point
   
   LET g_xrda_m.xrdamodid = g_user
   LET g_xrda_m.xrdamoddt = cl_get_current()
   LET g_xrda_m.xrdastus = lc_state
   
   #異動狀態碼欄位/修改人/修改日期
   UPDATE xrda_t 
      SET (xrdastus,xrdamodid,xrdamoddt) 
        = (g_xrda_m.xrdastus,g_xrda_m.xrdamodid,g_xrda_m.xrdamoddt)     
    WHERE xrdaent = g_enterprise AND xrdald = g_xrda_m.xrdald
      AND xrdadocno = g_xrda_m.xrdadocno
    
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
   ELSE
      CASE lc_state
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/unconfirmed.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")
         
      END CASE
    
      #撈取異動後的資料
      EXECUTE axrt400_master_referesh USING g_xrda_m.xrdald,g_xrda_m.xrdadocno INTO g_xrda_m.xrdasite, 
          g_xrda_m.xrda003,g_xrda_m.xrdald,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrda001,g_xrda_m.xrdadocdt, 
          g_xrda_m.xrda005,g_xrda_m.xrda004,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008, 
          g_xrda_m.xrda010,g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda016, 
          g_xrda_m.xrdaownid,g_xrda_m.xrdaowndp,g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdt, 
          g_xrda_m.xrdamodid,g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfdt,g_xrda_m.xrdasite_desc, 
          g_xrda_m.xrda003_desc,g_xrda_m.xrdald_desc,g_xrda_m.xrdadocno_desc,g_xrda_m.xrda005_desc,g_xrda_m.xrda004_desc, 
          g_xrda_m.xrda015_desc,g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp_desc,g_xrda_m.xrdacrtid_desc, 
          g_xrda_m.xrdacrtdp_desc,g_xrda_m.xrdamodid_desc,g_xrda_m.xrdacnfid_desc
      
      #將資料顯示到畫面上
      DISPLAY BY NAME g_xrda_m.xrdasite,g_xrda_m.xrdasite_desc,g_xrda_m.xrda003,g_xrda_m.xrda003_desc, 
          g_xrda_m.xrdald,g_xrda_m.xrdald_desc,g_xrda_m.xrdacomp,g_xrda_m.xrdadocno,g_xrda_m.xrdadocno_desc, 
          g_xrda_m.xrda001,g_xrda_m.xrdadocdt,g_xrda_m.xrda005,g_xrda_m.xrda005_desc,g_xrda_m.xrda004, 
          g_xrda_m.xrda004_desc,g_xrda_m.xrda014,g_xrda_m.xrda006,g_xrda_m.xrdastus,g_xrda_m.xrda008, 
          g_xrda_m.xrda010,g_xrda_m.xrda017,g_xrda_m.xrda007,g_xrda_m.xrda009,g_xrda_m.xrda015,g_xrda_m.xrda015_desc, 
          g_xrda_m.xrda016,g_xrda_m.xrdaownid,g_xrda_m.xrdaownid_desc,g_xrda_m.xrdaowndp,g_xrda_m.xrdaowndp_desc, 
          g_xrda_m.xrdacrtid,g_xrda_m.xrdacrtid_desc,g_xrda_m.xrdacrtdp,g_xrda_m.xrdacrtdp_desc,g_xrda_m.xrdacrtdt, 
          g_xrda_m.xrdamodid,g_xrda_m.xrdamodid_desc,g_xrda_m.xrdamoddt,g_xrda_m.xrdacnfid,g_xrda_m.xrdacnfid_desc, 
          g_xrda_m.xrdacnfdt,g_xrda_m.xrda007_desc,g_xrda_m.l_desc,g_xrda_m.lbl_amt5_desc,g_xrda_m.lbl_amt1_1_desc, 
          g_xrda_m.lbl_amt3_1_desc,g_xrda_m.lbl_amt5_1_desc
   END IF
 
   #add-point:stus修改後 name="statechange.a_update"
 
   #end add-point
 
   #add-point:statechange段結束前 name="statechange.after"
   #151125-00006#1-add-s
   IF g_xrda_m.xrdastus = 'Y' THEN 
      #xrda立即抛转传票
      CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno) RETURNING l_success,l_ooba002
      CALL s_fin_get_doc_para(g_xrda_m.xrdald,g_xrda_m.xrdacomp,l_ooba002,'D-FIN-0032') RETURNING l_dfin0032
      IF NOT cl_null(l_dfin0032) AND l_dfin0032 MATCHES '[Yy]' THEN 
         IF cl_ask_confirm('axr-00888') THEN              
            CALL axrt400_immediately_gen()
         END IF 
      END IF 
      CALL axrt400_ui_headershow()
   END IF 
   #151125-00006#1-add-e
   CALL axrt400_show() 
   
   #end add-point  
 
   CLOSE axrt400_cl
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL axrt400_msgcentre_notify('statechange:'||lc_state)
   
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="axrt400.idx_chk" >}
#+ 顯示正確的單身資料筆數
PRIVATE FUNCTION axrt400_idx_chk()
   #add-point:idx_chk段define(客製用) name="idx_chk.define_customerization"
   
   #end add-point  
   #add-point:idx_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="idx_chk.define"
   
   #end add-point  
   
   #add-point:Function前置處理  name="idx_chk.pre_function"
   
   #end add-point
   
   IF g_current_page = 1 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail1")
      IF g_detail_idx > g_xrde_d.getLength() THEN
         LET g_detail_idx = g_xrde_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xrde_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xrde_d.getLength() TO FORMONLY.cnt
   END IF
   
   IF g_current_page = 2 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail2")
      IF g_detail_idx > g_xrde2_d.getLength() THEN
         LET g_detail_idx = g_xrde2_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xrde2_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xrde2_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 3 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail3")
      IF g_detail_idx > g_xrde3_d.getLength() THEN
         LET g_detail_idx = g_xrde3_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xrde3_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xrde3_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 4 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail4")
      IF g_detail_idx > g_xrde4_d.getLength() THEN
         LET g_detail_idx = g_xrde4_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xrde4_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xrde4_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 5 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail5")
      IF g_detail_idx > g_xrde5_d.getLength() THEN
         LET g_detail_idx = g_xrde5_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xrde5_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xrde5_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 6 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail6")
      IF g_detail_idx > g_xrde6_d.getLength() THEN
         LET g_detail_idx = g_xrde6_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_xrde6_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_xrde6_d.getLength() TO FORMONLY.cnt
   END IF
 
   
   #add-point:idx_chk段other name="idx_chk.other"
   
   #end add-point  
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.b_fill2" >}
#+ 單身陣列填充2
PRIVATE FUNCTION axrt400_b_fill2(pi_idx)
   #add-point:b_fill2段define(客製用) name="b_fill2.define_customerization"
   
   #end add-point
   DEFINE pi_idx                 LIKE type_t.num10
   DEFINE li_ac                  LIKE type_t.num10
   DEFINE li_detail_idx_tmp      LIKE type_t.num10
   DEFINE ls_chk                 LIKE type_t.chr1
   #add-point:b_fill2段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="b_fill2.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="b_fill2.pre_function"
   
   #end add-point
   
   LET li_ac = l_ac 
   
   IF g_detail_idx <= 0 THEN
      RETURN
   END IF
   
   LET li_detail_idx_tmp = g_detail_idx
   
 
      
 
      
   #add-point:單身填充後 name="b_fill2.after_fill"
   
   #end add-point
    
   LET l_ac = li_ac
   
   CALL axrt400_detail_show()
   
   LET g_detail_idx = li_detail_idx_tmp
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.fill_chk" >}
#+ 單身填充確認
PRIVATE FUNCTION axrt400_fill_chk(ps_idx)
   #add-point:fill_chk段define(客製用) name="fill_chk.define_customerization"
   
   #end add-point
   DEFINE ps_idx        LIKE type_t.chr10
   #add-point:fill_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="fill_chk.define"
   
   #end add-point
   
   #add-point:Function前置處理 name="fill_chk.before_chk"
   
   #end add-point
   
   #此funtion功能暫時停用(2015/1/12)
   #無論傳入值為何皆回傳true(代表要填充該單身)
 
   #全部為1=1 or null時回傳true
   IF (cl_null(g_wc2_table1) OR g_wc2_table1.trim() = '1=1')  AND 
      (cl_null(g_wc2_table2) OR g_wc2_table2.trim() = '1=1') THEN
      #add-point:fill_chk段other_chk name="fill_chk.other_chk"
      
      #end add-point
      RETURN TRUE
   END IF
   
   #add-point:fill_chk段after_chk name="fill_chk.after_chk"
   
   #end add-point
   
   RETURN TRUE
 
END FUNCTION
 
{</section>}
 
{<section id="axrt400.status_show" >}
PRIVATE FUNCTION axrt400_status_show()
   #add-point:status_show段define(客製用) name="status_show.define_customerization"
   
   #end add-point
   #add-point:status_show段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="status_show.define"
   
   #end add-point
   
   #add-point:status_show段status_show name="status_show.status_show"
   
   #end add-point
END FUNCTION
 
{</section>}
 
{<section id="axrt400.mask_functions" >}
&include "erp/axr/axrt400_mask.4gl"
 
{</section>}
 
{<section id="axrt400.signature" >}
   #應用 a39 樣板自動產生(Version:10)
#+ BPM提交
PRIVATE FUNCTION axrt400_send()
   #add-point:send段define(客製用) name="send.define_customerization"
   
   #end add-point 
   #add-point:send段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="send.define"
   DEFINE r_success_chk    LIKE type_t.chr5
   DEFINE r_success        LIKE type_t.chr5
   DEFINE l_success        LIKE type_t.num5
   DEFINE l_slip           LIKE xrca_t.xrcadocno
   DEFINE l_glaa024        LIKE glaa_t.glaa024
   DEFINE l_ooac004        LIKE ooac_t.ooac004
   #end add-point 
   
   #add-point:Function前置處理  name="send.pre_function"
   
   #end add-point
   
   #依據單據個數，需要指定所有單身條件為" 1=1"  (單身有幾個就要設幾個)
   LET g_wc2_table1 = " 1=1"
   LET g_wc2_table2 = " 1=1"
 
 
   CALL axrt400_show()
   CALL axrt400_set_pk_array()
   
   #add-point: 初始化的ADP name="send.before_send"
  
   #160308-00010#6 add ---(S)---  
   CALL s_axrt400_conf_chk(g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING l_success,g_errno
   IF NOT l_success THEN
      CLOSE axrt400_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF
   #160308-00010#6 add ---(E)---  
   
   #end add-point
   
   #公用變數初始化
   CALL cl_bpm_data_init()
                  
   #依照主檔/單身個數產生 CALL cl_bpm_set_master_data() / cl_bpm_set_detail_data() 
   #單頭固定為 CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(xxxx)) 傳入參數: (1)單頭陣列  ; 回傳值: 無
   CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(g_xrda_m))
                              
   #單身固定為 CALL cl_bpm_set_detail_data(s_detailX, util.JSONArray.fromFGL(xxxx)) 傳入參數: (1)單身SR名稱  (2)單身陣列  ; 回傳值: 無
   CALL cl_bpm_set_detail_data("s_detail1", util.JSONArray.fromFGL(g_xrde_d))
   CALL cl_bpm_set_detail_data("s_detail2", util.JSONArray.fromFGL(g_xrde2_d))
   CALL cl_bpm_set_detail_data("s_detail3", util.JSONArray.fromFGL(g_xrde3_d))
   CALL cl_bpm_set_detail_data("s_detail4", util.JSONArray.fromFGL(g_xrde4_d))
   CALL cl_bpm_set_detail_data("s_detail5", util.JSONArray.fromFGL(g_xrde5_d))
   CALL cl_bpm_set_detail_data("s_detail6", util.JSONArray.fromFGL(g_xrde6_d))
 
 
   # cl_bpm_cli() 裡有包含以前的aws_condition()=>送簽資料檢核和更新單據狀況碼為'W'
   # cl_bpm_cli() 傳入參數:無  ;  回傳值: 0 開單失敗; 1 開單成功
 
   #add-point: 提交前的ADP name="send.before_cli"
   #2015-5-29 zhujing add --(S)
   CALL s_axrt400_confirm_chk(g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING r_success_chk

   IF r_success_chk <> 'Y' THEN
      RETURN FALSE
   END IF 
   CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno)
   RETURNING l_success,l_slip
   
   SELECT glaa024 INTO l_glaa024
     FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = g_xrda_m.xrdald
   
   #是否抛傳票    
   SELECT ooac004 INTO l_ooac004
     FROM ooac_t
    WHERE ooacent = g_enterprise
      AND ooac001 = l_glaa024
      AND ooac002 = l_slip
      AND ooac003 = 'D-FIN-0030'
   
   #檢查產生的傳票是否正確
   IF l_ooac004 = 'Y' THEN 
      IF g_glaa_t.glaa121 = 'Y' THEN 
         CALL s_chk_voucher('AR','R20',g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING l_success
         IF l_success = FALSE THEN 
            LET r_success = 'N'
         END IF
      ELSE
         CALL s_axrt400_confirm_subject_chk(g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING r_success
      END IF
      IF r_success = 'N' THEN
         RETURN FALSE
      END IF
   END IF 
   IF r_success = 'N' THEN
      RETURN FALSE
   END IF
   #2015-5-29 zhujing add --(E)
   #end add-point
 
   #開單失敗
   IF NOT cl_bpm_cli() THEN 
      RETURN FALSE
   END IF
 
   #add-point: 提交後的ADP name="send.after_send"
   
   #end add-point
 
   #此段落不需要刪除資料,但是否需要refresh圖片樣式???
   #CALL axrt400_ui_browser_refresh()
 
   #重新指定此筆單據資料狀態圖片=>送簽中
   LET g_browser[g_current_idx].b_statepic = "stus/16/signing.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL axrt400_ui_headershow()
   CALL axrt400_ui_detailshow()
 
   RETURN TRUE
   
END FUNCTION
 
 
 
#應用 a40 樣板自動產生(Version:9)
#+ BPM抽單
PRIVATE FUNCTION axrt400_draw_out()
   #add-point:draw段define name="draw.define_customerization"
   
   #end add-point
   #add-point:draw段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="draw.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="draw.pre_function"
   
   #end add-point
   
   #抽單失敗
   IF NOT cl_bpm_draw_out() THEN 
      RETURN FALSE
   END IF    
          
   #重新指定此筆單據資料狀態圖片=>抽單
   LET g_browser[g_current_idx].b_statepic = "stus/16/draw_out.png"
 
   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL axrt400_ui_headershow()  
   CALL axrt400_ui_detailshow()
 
   #add-point:Function後置處理  name="draw.after_function"
   
   #end add-point
 
   RETURN TRUE
   
END FUNCTION
 
 
 
 
 
{</section>}
 
{<section id="axrt400.set_pk_array" >}
   #應用 a51 樣板自動產生(Version:8)
#+ 給予pk_array內容
PRIVATE FUNCTION axrt400_set_pk_array()
   #add-point:set_pk_array段define name="set_pk_array.define_customerization"
   
   #end add-point
   #add-point:set_pk_array段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_pk_array.define"
   
   #end add-point
   
   #add-point:Function前置處理 name="set_pk_array.before"
   
   #end add-point  
   
   #若l_ac<=0代表沒有資料
   IF l_ac <= 0 THEN
      RETURN
   END IF
   
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_xrda_m.xrdald
   LET g_pk_array[1].column = 'xrdald'
   LET g_pk_array[2].values = g_xrda_m.xrdadocno
   LET g_pk_array[2].column = 'xrdadocno'
   
   #add-point:set_pk_array段之後 name="set_pk_array.after"
   
   #end add-point  
   
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="axrt400.other_dialog" readonly="Y" >}
   
 
{</section>}
 
{<section id="axrt400.msgcentre_notify" >}
#應用 a66 樣板自動產生(Version:6)
PRIVATE FUNCTION axrt400_msgcentre_notify(lc_state)
   #add-point:msgcentre_notify段define name="msgcentre_notify.define_customerization"
   
   #end add-point   
   DEFINE lc_state LIKE type_t.chr80
   #add-point:msgcentre_notify段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="msgcentre_notify.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="msgcentre_notify.pre_function"
   
   #end add-point
   
   INITIALIZE g_msgparam TO NULL
 
   #action-id與狀態填寫
   LET g_msgparam.state = lc_state
 
   #PK資料填寫
   CALL axrt400_set_pk_array()
   #單頭資料填寫
   LET g_msgparam.data[1] = util.JSON.stringify(g_xrda_m)
 
   #add-point:msgcentre其他通知 name="msgcentre_notify.process"
   
   #end add-point
 
   #呼叫訊息中心傳遞本關完成訊息
   CALL cl_msgcentre_notify()
 
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="axrt400.action_chk" >}
#+ 修改/刪除前行為檢查(是否可允許此動作), 若有其他行為須管控也可透過此段落
PRIVATE FUNCTION axrt400_action_chk()
   #add-point:action_chk段define(客製用) name="action_chk.define_customerization"
   
   #end add-point
   #add-point:action_chk段define (請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="action_chk.define"
   
   #end add-point
   
   #add-point:action_chk段action_chk name="action_chk.action_chk"
   
   #end add-point
      
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="axrt400.other_function" readonly="Y" >}
# 参考栏位带值
PRIVATE FUNCTION axrt400_ref_show()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrda_m.xrdasite
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent = '"||g_enterprise||"' AND ooefl001 = ? AND ooefl002 = '"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_xrda_m.xrdasite_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_xrda_m.xrdasite,g_xrda_m.xrdasite_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrda_m.xrda003
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET g_xrda_m.xrda003_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_xrda_m.xrda003,g_xrda_m.xrda003_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrda_m.xrdald
   CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent = '"||g_enterprise||"' AND glaalld  = ? AND glaal001 = '"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_xrda_m.xrdald_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_xrda_m.xrdald,g_xrda_m.xrdald_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrda_m.xrda004
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_xrda_m.xrda004_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_xrda_m.xrda004_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrda_m.xrda005
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_xrda_m.xrda005_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_xrda_m.xrda005_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrda_m.xrda015
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='3113' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_xrda_m.xrda015_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_xrda_m.xrda015_desc
END FUNCTION
# 赋默认值
PRIVATE FUNCTION axrt400_default()
   DEFINE l_sql      STRING
   DEFINE l_cnt      LIKE type_t.num5
   DEFINE l_success  LIKE type_t.chr1
   
   ##取得預設的帳務中心,因新增階段的時候,並不會知道site,所以以登入人員做為依據
   #CALL s_fin_get_account_center('',g_user,'3',g_today) RETURNING g_sub_success,g_xrda_m.xrdasite,g_errno
   
   LET g_xrda_m.xrdasite = g_site
   
   LET g_xrda_m.xrda003 = g_user         #帳務人員
   
   SELECT ooef017 INTO g_xrda_m.xrdacomp
     FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = g_xrda_m.xrdasite
      
   SELECT glaald INTO g_xrda_m.xrdald
    FROM glaa_t
   WHERE glaacomp = g_xrda_m.xrdacomp
     AND glaaent = g_enterprise
     AND glaa014 = 'Y'
     
   LET g_xrda_m_t.xrdasite = g_xrda_m.xrdasite
   LET g_xrda_m_t.xrdald = g_xrda_m.xrdald

   IF cl_null(g_xrda_m.xrdasite) THEN
      LET g_xrda_m.xrda003 = NULL
   END IF

   CALL axrt400_glaa_get()
   IF NOT cl_null(g_xrda_m.xrdasite) AND NOT cl_null(g_xrda_m.xrdald) THEN
      CALL axrt400_ref_show()
   END IF
   
  #160413-00023#1 Mark ---(S)---
  #SELECT DISTINCT glaacomp INTO g_xrda_m.xrdacomp FROM glaa_t,ooef_t,ooag_t
  # WHERE ooag004 = ooef001 AND ooagent = ooefent AND glaacomp = ooef017 AND ooefent = glaaent AND glaa014 = 'Y'
  #   AND ooag001 = g_user AND glaaent = g_enterprise
  #DISPLAY BY NAME g_xrda_m.xrdacomp
  #160413-00023#1 Mark ---(E)---
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrda_m.xrda003
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET g_xrda_m.xrda003_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_xrda_m.xrda003_desc
   
   LET g_xrda_m.xrda001 = '41'
   LET g_xrda_m.xrda007  = '0'
   LET g_xrda_m.xrda016  = 0
   LET g_xrda_m.xrdadocdt = g_today
   LET g_xrda_m.xrdastus  = 'N'
   
   LET g_xrda_m_t.xrdadocdt = g_today
   CALL cl_get_para(g_enterprise,g_xrda_m.xrdacomp,'S-FIN-2007') RETURNING g_para_data
   
   CALL axrt400_ref_amt()
      
   DISPLAY BY NAME g_xrda_m.xrdacomp,g_xrda_m.xrdadocdt,g_xrda_m.xrda001,g_xrda_m.xrda003,g_xrda_m.xrda003_desc,g_xrda_m.xrda007,g_xrda_m.xrda016
END FUNCTION
# 將取回的字串轉換為SQL條件
PRIVATE FUNCTION axrt400_change_to_sql(p_wc)
   DEFINE p_wc       STRING
   DEFINE r_wc       STRING
   DEFINE tok        base.StringTokenizer
   DEFINE l_str      STRING

   LET tok = base.StringTokenizer.create(p_wc,",")
   WHILE tok.hasMoreTokens()
      IF cl_null(l_str) THEN
         LET l_str = tok.nextToken()
      ELSE
         LET l_str = l_str,"','",tok.nextToken()
      END IF
   END WHILE
   LET r_wc = "'",l_str,"'"

   RETURN r_wc
END FUNCTION
# 根據回傳值,批次新增單身資料
PRIVATE FUNCTION axrt400_ins_xrde(p_xrde002,p_xrde006)
   DEFINE p_xrde002      LIKE xrde_t.xrde002
   DEFINE p_xrde006      LIKE xrde_t.xrde006

   CALL s_transaction_end('N',0)

   CALL s_transaction_begin()
   LET g_success = 'Y'

   IF p_xrde002 = '10' THEN
      CALL axrt400_ins_xrde_07(p_xrde006)
   END IF

   IF p_xrde002 = '30' OR p_xrde002 = '31' OR p_xrde002 = '32' THEN
      CALL axrt400_ins_xrde_04(p_xrde002)
   END IF
   
   IF p_xrde002 = '40' OR p_xrde002 = '41' OR p_xrde002 = '42' THEN
      CALL axrt400_ins_xrde_12(p_xrde002)
   END IF

   IF g_success = 'Y' THEN
      CALL s_transaction_end('Y',0)
   ELSE
      CALL s_transaction_end('N',0)
   END IF

   CALL axrt400_b_fill()
END FUNCTION
# 多帳期明細新增进xrcc_t
PRIVATE FUNCTION axrt400_ins_xrde_04(p_xrce002)
   DEFINE p_xrce002      LIKE xrce_t.xrce002
   DEFINE l_xrce109      LIKE xrce_t.xrce109
   DEFINE l_xrce119      LIKE xrce_t.xrce119
   DEFINE l_xrce129      LIKE xrce_t.xrce129
   DEFINE l_xrce139      LIKE xrce_t.xrce139
   DEFINE l_gzcb003      LIKE gzcb_t.gzcb003
   DEFINE l_count        LIKE type_t.num5
   DEFINE l_ls_s         LIKE type_t.num5
   DEFINE l_sql          STRING
   DEFINE l_xrca_t       RECORD LIKE xrca_t.*
   DEFINE l_xrcc_t       RECORD LIKE xrcc_t.*
   DEFINE l_xrce_t       RECORD LIKE xrce_t.*
   DEFINE l_ooab002      LIKE ooab_t.ooab002
   DEFINE l_xrdeseq      LIKE xrde_t.xrdeseq
   DEFINE l_xrde010      LIKE xrde_t.xrde010
   #20150924--add--str--lujh
   DEFINE l_xrce109_1    LIKE xrce_t.xrce109
   DEFINE l_xrce119_1    LIKE xrce_t.xrce119
   DEFINE l_xrce129_1    LIKE xrce_t.xrce129
   DEFINE l_xrce139_1    LIKE xrce_t.xrce139
   #20150924--add--end--lujh
   #151105-00008#6--add--str--lujh
   DEFINE l_xrfc103      LIKE xrfc_t.xrfc103     
   DEFINE l_xrfc104      LIKE xrfc_t.xrfc104
   #151105-00008#6--add--end--lujh
   DEFINE l_gzcb005      LIKE gzcb_t.gzcb005   #160420-00001#13 Add

   DELETE FROM xrce_t 
    WHERE xrceent = g_enterprise
      AND xrceld = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND xrceseq = g_xrde4_d[l_ac].xrceseq
      AND xrce003 = g_xrde4_d[l_ac].xrce003

   LET l_ooab002 = ''
   SELECT ooab002 INTO l_ooab002 FROM ooab_t
    WHERE ooabent = g_enterprise
      AND ooabsite= g_xrda_m.xrdasite
      AND ooab001 = 'S-FIN-1002'

   IF cl_null(g_xrde4_d_t.xrce003) THEN 
      SELECT MAX(xrceseq) INTO l_xrce_t.xrceseq
        FROM xrce_t
       WHERE xrceent = g_enterprise 
         AND xrceld = g_xrda_m.xrdald
         AND xrcedocno = g_xrda_m.xrdadocno
      IF cl_null(l_xrce_t.xrceseq) THEN
         LET l_xrce_t.xrceseq = 1
      ELSE
         LET l_xrce_t.xrceseq = l_xrce_t.xrceseq + 1
      END IF
   ELSE
      LET l_xrce_t.xrceseq = g_xrde4_d_t.xrceseq
   END IF
   
   IF l_xrce_t.xrceseq = 1 THEN 
      SELECT MAX(xrdeseq) INTO l_xrdeseq
        FROM xrde_t
       WHERE xrdeent = g_enterprise
         AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
         AND xrde010 IS NOT NULL
         
      SELECT xrde010 INTO l_xrde010
        FROM xrde_t
       WHERE xrdeent = g_enterprise
         AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
         AND xrdeseq = l_xrdeseq
         
      LET l_xrce_t.xrce010 = l_xrde010
   ELSE
      SELECT xrce010 INTO l_xrce_t.xrce010
        FROM xrce_t
       WHERE xrceent = g_enterprise
         AND xrceld = g_xrda_m.xrdald
         AND xrcedocno = g_xrda_m.xrdadocno
         AND xrceseq = l_xrce_t.xrceseq - 1 
   END IF

   #計算帳款部分
   LET l_sql ="SELECT * FROM xrcc_t,xrca_t,gzcb_t",
              " WHERE xrccent = '",g_enterprise,"'",
              "   AND xrccld = xrcald",
              "   AND xrccdocno = xrcadocno",
              "   AND xrccent = xrcaent ",
              "   AND xrcastus = 'Y'",
              "   AND xrca001 = gzcb002",
              "   AND gzcb003 = '1'",
              "   AND gzcb001 = '8302'",
              "   AND xrcc108 - xrcc109 > 0",
              #"   AND xrca005 = '",g_xrda_m.xrda005,"'",   #albireo 151006 mark
              "   AND xrca004 = '",g_xrda_m.xrda004,"'",    #albireo 151006 add
              "   AND (",g_qryparam.return1,")"
   
   PREPARE axrt400_sel_xrcc_prep FROM l_sql
   DECLARE axrt400_sel_xrcc_curs CURSOR FOR axrt400_sel_xrcc_prep

    
   SELECT gzcb003 INTO l_gzcb003 FROM gzcb_t
    WHERE gzcb002 = p_xrce002
      AND gzcb001 = '8306'
   LET l_xrce_t.xrceent = g_enterprise
   LET l_xrce_t.xrceld = g_xrda_m.xrdald
   LET l_xrce_t.xrcedocno = g_xrda_m.xrdadocno
   LET l_xrce_t.xrcesite  = g_xrda_m.xrdasite
   LET l_xrce_t.xrce002   = p_xrce002
   IF l_gzcb003 = 'D' THEN
      LET l_xrce_t.xrce015   =  'D'
   ELSE
      LET l_xrce_t.xrce015   =  'C'
   END IF
   

   FOREACH axrt400_sel_xrcc_curs INTO l_xrcc_t.*,l_xrca_t.*

     #160420-00001#13 Add  ---(S)---
     #重新计算訂金待抵單可沖總金額.待抵單可沖總金額應為原始單據已收款金額
     LET l_gzcb005 = ''
     SELECT gzcb005 INTO l_gzcb005 FROM gzcb_t WHERE gzcb001 = '8302' AND gzcb002 = l_xrca_t.xrca001
     IF l_gzcb005 = 'axrq342' THEN
        SELECT SUM(xrcc109),SUM(xrcc119),SUM(xrcc129),SUM(xrcc139)
          INTO l_xrcc_t.xrcc108,l_xrcc_t.xrcc118,l_xrcc_t.xrcc128,l_xrcc_t.xrcc138
          FROM xrcc_t WHERE xrccent = g_enterprise
           AND xrccld = l_xrcc_t.xrccld
           AND xrccdocno IN (
         SELECT xrca018 FROM xrca_t WHERE xrcaent = g_enterprise
            AND xrcald = l_xrca_t.xrcald
            AND xrcadocno = l_xrca_t.xrcadocno)
     END IF
     #160420-00001#13 Add  ---(E)---

      #計算預沖金額
      LET l_xrce109 = 0   LET l_xrce119 = 0
      LET l_xrce129 = 0   LET l_xrce139 = 0
      SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139) INTO l_xrce109,l_xrce119,l_xrce129,l_xrce139   #20150312 Mod By 01727 l_xrce109,l_xrce129 --> l_xrce109,l_xrce119 
        FROM xrce_t,xrda_t
       WHERE xrdaent   = xrceent
         AND xrdald    = xrceld
         AND xrdadocno = xrcedocno
         AND xrdald = g_xrda_m.xrdald
         AND xrce003   = l_xrcc_t.xrccdocno
         AND xrce004   = l_xrcc_t.xrccseq
         AND xrce005   = l_xrcc_t.xrcc001
         AND xrdastus  = 'N'
      IF cl_null(l_xrce109) THEN LET l_xrce109 = 0 END IF
      IF cl_null(l_xrce119) THEN LET l_xrce119 = 0 END IF
      IF cl_null(l_xrce129) THEN LET l_xrce129 = 0 END IF
      IF cl_null(l_xrce139) THEN LET l_xrce139 = 0 END IF
      
      #20150924--add--str--lujh
      #直接冲账
      SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139) INTO l_xrce109_1,l_xrce119_1,l_xrce129_1,l_xrce139_1 
        FROM xrce_t,xrca_t
       WHERE xrcaent   = g_enterprise
         AND xrcald    = xrceld
         AND xrcadocno = xrcedocno
         AND xrcald = g_xrda_m.xrdald
         AND xrce003   = l_xrcc_t.xrccdocno
         AND xrce004   = l_xrcc_t.xrccseq
         AND xrce005   = l_xrcc_t.xrcc001
         AND xrcastus  = 'N'
         
      IF cl_null(l_xrce109_1) THEN LET l_xrce109_1 = 0 END IF
      IF cl_null(l_xrce119_1) THEN LET l_xrce119_1 = 0 END IF
      IF cl_null(l_xrce129_1) THEN LET l_xrce129_1 = 0 END IF
      IF cl_null(l_xrce139_1) THEN LET l_xrce139_1 = 0 END IF
      #20150924--add--end--lujh
      
      #151105-00008#6--add--str--lujh
      #抓取axrt460已存在未审核的单子
      LET l_xrfc103 = 0   LET l_xrfc104 = 0
      SELECT SUM(xrfc103),SUM(xrfc104) INTO l_xrfc103,l_xrfc104 FROM xrfa_t,xrfc_t
       WHERE xrfaent   = g_enterprise
         AND xrfadocno = xrfcdocno
         AND xrfald    = g_xrda_m.xrdald
         AND xrfc003   = l_xrcc_t.xrccdocno
         AND xrfc004   = l_xrcc_t.xrccseq
         AND xrfc005   = l_xrcc_t.xrcc001
         AND xrfastus  = 'N'
      IF cl_null(l_xrfc103) THEN LET l_xrfc103 = 0 END IF
      IF cl_null(l_xrfc104) THEN LET l_xrfc104 = 0 END IF
      #151105-00008#6--add--end--lujh
      
      LET l_xrce_t.xrcecomp = l_xrcc_t.xrcccomp
      LET l_xrce_t.xrceorga = g_xrda_m.xrdacomp
      LET l_xrce_t.xrce001  = 'axrt400'
      LET l_xrce_t.xrce003  = l_xrcc_t.xrccdocno
      LET l_xrce_t.xrce004  = l_xrcc_t.xrccseq
      LET l_xrce_t.xrce005  = l_xrcc_t.xrcc001
      #20150416--mark--str--
      #IF p_xrce002 = '31' THEN 
      #   LET l_xrce_t.xrce016  = l_xrca_t.xrca036
      #ELSE
      #   LET l_xrce_t.xrce016  = l_xrca_t.xrca035
      #END IF
      #20150416--mark--end--
      LET l_xrce_t.xrce016  = l_xrca_t.xrca035  #20150416 add
      LET l_xrce_t.xrce017  = l_xrca_t.xrca014
      LET l_xrce_t.xrce018  = l_xrca_t.xrca015
      LET l_xrce_t.xrce027	 = 'N'
      LET l_xrce_t.xrce028	 = 0
      LET l_xrce_t.xrce036	 = l_xrca_t.xrca006
      LET l_xrce_t.xrce053  = l_xrcc_t.xrcc008
      LET l_xrce_t.xrce054  = l_xrcc_t.xrcc009
      LET l_xrce_t.xrce100  = l_xrcc_t.xrcc100
      LET l_xrce_t.xrce101  = l_xrcc_t.xrcc102     #20150313  xrcc101 ---->xrcc102
      LET l_xrce_t.xrce104	 = 0
      LET l_xrce_t.xrce114	 = 0
      LET l_xrce_t.xrce120  = l_xrcc_t.xrcc120
      LET l_xrce_t.xrce121  = l_xrcc_t.xrcc122
      LET l_xrce_t.xrce130  = l_xrcc_t.xrcc130
      LET l_xrce_t.xrce131  = l_xrcc_t.xrcc132
      
      LET l_xrce_t.xrce109  = l_xrcc_t.xrcc108 - l_xrcc_t.xrcc109 - l_xrce109 - l_xrce109_1 - l_xrfc103  #20150924 add l_xrce109_1 lujh   #151105-00008#6 add l_xrfc103 lujh
      LET l_xrce_t.xrce119  = l_xrcc_t.xrcc118 - l_xrcc_t.xrcc119 + l_xrcc_t.xrcc113 - l_xrce119 - l_xrce119_1 - l_xrfc104  #20150924 add l_xrce119_1 lujh  #151105-00008#6 add l_xrfc104 lujh
      IF l_xrce_t.xrce109 <= 0 THEN CONTINUE FOREACH END IF
      LET l_xrce_t.xrce129  = l_xrcc_t.xrcc128 - l_xrcc_t.xrcc129 + l_xrcc_t.xrcc123 - l_xrce129 - l_xrce129_1   #20150924 add l_xrce129_1 lujh
      LET l_xrce_t.xrce139  = l_xrcc_t.xrcc138 - l_xrcc_t.xrcc139 + l_xrcc_t.xrcc133 - l_xrce139 - l_xrce139_1   #20150924 add l_xrce139_1 lujh

      IF g_glaa_t.glaa015 = 'N' THEN
         LET l_xrce_t.xrce120 = ''
         LET l_xrce_t.xrce121 = 0
         LET l_xrce_t.xrce129 = 0
      END IF
      
      IF g_glaa_t.glaa019 = 'N' THEN
         LET l_xrce_t.xrce130 = ''
         LET l_xrce_t.xrce131 = 0
         LET l_xrce_t.xrce139 = 0
      END IF


      #INSERT INTO xrce_t VALUES(l_xrce_t.*)
      INSERT INTO xrce_t(xrceent,xrcecomp,xrceorga,xrcesite,xrceld,xrcedocno,xrceseq,xrce001,xrce002,xrce003,
                         xrce004,xrce005,xrce010,xrce015,xrce016,xrce017,xrce018,xrce027,xrce028,xrce036,
                         xrce053,xrce054,xrce100,xrce101,xrce104,xrce114,xrce109,
                         xrce119,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139)
                  VALUES(l_xrce_t.xrceent,l_xrce_t.xrcecomp ,l_xrce_t.xrceorga,l_xrce_t.xrcesite,
                         l_xrce_t.xrceld ,l_xrce_t.xrcedocno,l_xrce_t.xrceseq ,l_xrce_t.xrce001 ,
                         l_xrce_t.xrce002,l_xrce_t.xrce003  ,l_xrce_t.xrce004 ,l_xrce_t.xrce005 ,
                         l_xrce_t.xrce010,l_xrce_t.xrce015  ,l_xrce_t.xrce016 ,l_xrce_t.xrce017 ,
                         l_xrce_t.xrce018,l_xrce_t.xrce027  ,l_xrce_t.xrce028 ,l_xrce_t.xrce036 ,
                         l_xrce_t.xrce053,l_xrce_t.xrce054  ,l_xrce_t.xrce100 ,l_xrce_t.xrce101 ,
                         l_xrce_t.xrce104,l_xrce_t.xrce114  ,l_xrce_t.xrce109 ,l_xrce_t.xrce119 ,
                         l_xrce_t.xrce120,l_xrce_t.xrce121  ,l_xrce_t.xrce129 ,l_xrce_t.xrce130 ,
                         l_xrce_t.xrce131,l_xrce_t.xrce139
                        )
      IF SQLCA.sqlcode THEN
         LET g_success = 'N' RETURN
      END IF

      #LET l_xrce_t.xrceseq = l_xrce_t.xrceseq + 1     #151105-00008#2 mark lujh
      
      #151105-00008#2--add-str--lujh
      SELECT MAX(xrceseq) INTO l_xrce_t.xrceseq
        FROM xrce_t
       WHERE xrceent = g_enterprise 
         AND xrceld = g_xrda_m.xrdald
         AND xrcedocno = g_xrda_m.xrdadocno
      IF cl_null(l_xrce_t.xrceseq) THEN
         LET l_xrce_t.xrceseq = 1
      ELSE
         LET l_xrce_t.xrceseq = l_xrce_t.xrceseq + 1
      END IF
      #151105-00008#2--add-end--lujh

   END FOREACH
END FUNCTION
# 銀存收支新增进xrde_t
PRIVATE FUNCTION axrt400_ins_xrde_07(p_xrde006)
   DEFINE p_xrde006    LIKE xrde_t.xrde006
   DEFINE l_sql        STRING
   DEFINE l_nmbb_t     RECORD LIKE nmbb_t.*
   DEFINE l_xrde_t     RECORD LIKE xrde_t.*
   DEFINE l_count      LIKE type_t.num5
   DEFINE l_xrde109    LIKE xrde_t.xrde109
   DEFINE l_xrde119    LIKE xrde_t.xrde119
   DEFINE l_xrde129    LIKE xrde_t.xrde129
   DEFINE l_xrde139    LIKE xrde_t.xrde139
   DEFINE l_gzcb003    LIKE gzcb_t.gzcb003
   DEFINE l_ld_s       LIKE type_t.num5      #帳套   1:主帳套;2:次帳套一;3:次帳套二
   DEFINE l_nmba006    LIKE nmba_t.nmba006   #150812-00010#3
   #151105-00008#6--add--str--lujh
   DEFINE l_xrfb103    LIKE xrfb_t.xrfb103
   DEFINE l_xrfb104    LIKE xrfb_t.xrfb104
   #151105-00008#6--add--end--lujh
   
   DELETE FROM xrde_t 
    WHERE xrdeent = g_enterprise
      AND xrdeld = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrdeseq = g_xrde_d[l_ac].xrdeseq
      AND xrde003 = g_xrde_d[l_ac].xrde003
   
   IF cl_null(g_xrde_d_t.xrde003) THEN 
      SELECT MAX(xrdeseq) INTO l_xrde_t.xrdeseq
        FROM xrde_t
       WHERE xrdeent = g_enterprise 
         AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
      IF cl_null(l_xrde_t.xrdeseq) THEN
         LET l_xrde_t.xrdeseq = 1
      ELSE
         LET l_xrde_t.xrdeseq = l_xrde_t.xrdeseq + 1 
      END IF
   ELSE
      LET l_xrde_t.xrdeseq = g_xrde_d_t.xrdeseq
   END IF
   
   IF l_xrde_t.xrdeseq > 1 THEN 
      SELECT xrde010 INTO l_xrde_t.xrde010
        FROM xrde_t
       WHERE xrdeent = g_enterprise
         AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
         AND xrdeseq = l_xrde_t.xrdeseq - 1 
   END IF
   
   LET l_count = 0
   SELECT COUNT(*) INTO l_count FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald  = g_xrda_m.xrdald
      AND glaa014 = 'Y'
   IF l_count > 0 THEN
     LET l_ld_s = 1
   ELSE
      #次帳套一
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
       WHERE ooab001 = 'S-FIN-0001' AND ooab002 = g_xrda_m.xrdald
         AND ooabsite= g_xrda_m.xrdasite
         AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 2
      END IF
      #次帳套二
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
        WHERE ooab001 = 'S-FIN-0002' AND ooab002 = g_xrda_m.xrdald
          AND ooabsite= g_xrda_m.xrdasite
          AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 3
      END IF
   END IF
   

   LET l_sql = "SELECT * FROM nmbb_t WHERE ",g_qryparam.return1,     #160905-00002#5 add ,
               "                       AND nmbbent = ",g_enterprise  #160905-00002#5
   PREPARE axrt400_sel_nmbb_prep FROM l_sql
   DECLARE axrt400_sel_nmbb_curs CURSOR FOR axrt400_sel_nmbb_prep
   
   INITIALIZE l_nmbb_t.* TO Null
   
   SELECT gzcb003 INTO l_gzcb003 FROM gzcb_t
    WHERE gzcb001 = '8306'
      AND gzcb002 = g_xrde_d[l_ac].xrde002
   
   FOREACH axrt400_sel_nmbb_curs INTO l_nmbb_t.*
      #計算預沖金額
      LET l_xrde109 = 0   LET l_xrde119 = 0
      LET l_xrde129 = 0   LET l_xrde139 = 0
      SELECT SUM(xrde109),SUM(xrde119),SUM(xrde129),SUM(xrde139) INTO l_xrde109,l_xrde119,l_xrde129,l_xrde139 FROM xrde_t,xrda_t    
       WHERE xrdaent   = xrdeent
         AND xrdald    = xrdeld
         AND xrdadocno = xrdedocno
         AND xrde003   = l_nmbb_t.nmbbdocno
         AND xrde004   = l_nmbb_t.nmbbseq
         AND xrdastus  = 'N'
      IF cl_null(l_xrde109) THEN LET l_xrde109 = 0 END IF
      IF cl_null(l_xrde119) THEN LET l_xrde119 = 0 END IF
      IF cl_null(l_xrde129) THEN LET l_xrde129 = 0 END IF
      IF cl_null(l_xrde139) THEN LET l_xrde139 = 0 END IF
      
      #151105-00008#6--add--str--lujh
      LET l_xrfb103 = 0 LET l_xrfb104 = 0
      SELECT SUM(xrfb103),SUM(xrfb104)
        INTO l_xrfb103,l_xrfb104
        FROM xrfb_t,xrfa_t
       WHERE xrfaent = g_enterprise
         AND xrfaent = xrfbent
         AND xrfadocno = xrfbdocno
         AND xrfald = xrfbld
         AND xrfastus = 'N'
         AND xrfb002 = l_nmbb_t.nmbbdocno
         AND xrfb003 = l_nmbb_t.nmbbseq
      IF cl_null(l_xrfb103) THEN LET l_xrfb103 = 0 END IF
      IF cl_null(l_xrfb104) THEN LET l_xrfb104 = 0 END IF
      #151105-00008#6--add--end--lujh
      
      LET l_xrde_t.xrdeent  = l_nmbb_t.nmbbent   
      LET l_xrde_t.xrdecomp = l_nmbb_t.nmbbcomp
      LET l_xrde_t.xrdeld   = g_xrda_m.xrdald
      LET l_xrde_t.xrdedocno= g_xrda_m.xrdadocno
      LET l_xrde_t.xrdesite = g_xrda_m.xrdasite
      LET l_xrde_t.xrdeorga = g_xrda_m.xrdacomp
      LET l_xrde_t.xrde001  = 'axrt400'
      LET l_xrde_t.xrde002  = g_xrde_d[l_ac].xrde002
      LET l_xrde_t.xrde003  = l_nmbb_t.nmbbdocno
      LET l_xrde_t.xrde004  = l_nmbb_t.nmbbseq
      LET l_xrde_t.xrde006  = g_xrde_d[l_ac].xrde006
      IF g_xrde_d[l_ac].xrde006 = '30' THEN 
         LET l_xrde_t.xrde008  = l_nmbb_t.nmbb030

      ELSE
         LET l_xrde_t.xrde008  = l_nmbb_t.nmbb003

      END IF
      LET l_xrde_t.xrde011  = l_nmbb_t.nmbb002
      LET l_xrde_t.xrde012  = l_nmbb_t.nmbb010
      LET l_xrde_t.xrde013  = ''
      LET l_xrde_t.xrde014  = ''
      IF l_gzcb003 = 'D'THEN
         LET l_xrde_t.xrde015   = 'D'
      ELSE
         LET l_xrde_t.xrde015   = 'C'
      END IF
      LET l_xrde_t.xrde017  = ''     
      #160111-00020#5--add--str--lujh
      IF g_xrda_m.xrda004 = 'EMPL' THEN 
         SELECT nmbb027 INTO l_xrde_t.xrde017
           FROM nmbb_t
          WHERE nmbbent = g_enterprise
            AND nmbbcomp = g_xrda_m.xrdacomp
            AND nmbbdocno = l_xrde_t.xrde003
            AND nmbbseq = l_xrde_t.xrde004
      END IF
      #160111-00020#5--add--end--lujh
      LET l_xrde_t.xrde018  = ''
      LET l_xrde_t.xrde019  = ''
      LET l_xrde_t.xrde020  = ''
      LET l_xrde_t.xrde022  = ''
      LET l_xrde_t.xrde023  = ''
      LET l_xrde_t.xrde100  = l_nmbb_t.nmbb004
      LET l_xrde_t.xrde101  = l_nmbb_t.nmbb005
      LET l_xrde_t.xrde120  = l_nmbb_t.nmbb011
      LET l_xrde_t.xrde121  = l_nmbb_t.nmbb012
      LET l_xrde_t.xrde130  = l_nmbb_t.nmbb015
      LET l_xrde_t.xrde131  = l_nmbb_t.nmbb016
      
      #抓取科目
      IF p_xrde006 = '10' OR p_xrde006 = '20' THEN 
         #借方科目: 依 anmi121  設定 
         SELECT DISTINCT glab005 INTO l_xrde_t.xrde016
           FROM glab_t
          WHERE glabent = g_enterprise 
            AND glabld  = g_xrda_m.xrdald
            AND glab001 = '40'
            AND glab002 = '40'     
            AND glab003 = l_nmbb_t.nmbb003  #交易帳戶編號
      END IF
    
      #20150515--mark-str--lujh
      #IF p_xrde006 = '30' THEN 
      #   #借方科目: 依 agli191 設定 
      #   SELECT DISTINCT glab005 INTO l_xrde_t.xrde016
      #     FROM glab_t
      #    WHERE glabent = g_enterprise 
      #      AND glabld  = g_xrda_m.xrdald
      #      AND glab001 = '42'
      #      AND glab002 = l_nmbb_t.nmbb029   
      #      AND glab003 = l_nmbb_t.nmbb028
      #END IF
      #20150515--mark-end--lujh
      
      #20150515--add-str--lujh
      #依agli190设定
      IF p_xrde006 MATCHES '[3456]0' THEN 
         SELECT DISTINCT glab005 INTO l_xrde_t.xrde016
           FROM glab_t
          WHERE glabent = g_enterprise 
            AND glabld  = g_xrda_m.xrdald
            AND glab001 = '21'
            AND glab002 = p_xrde006     
            AND glab003 = l_nmbb_t.nmbb028 
      END IF
      #20150515--add-end--lujh
      #150812-00010#3 --s
      LET l_nmba006 = ''
      SELECT nmba006 INTO l_nmba006
        FROM nmba_t
       WHERE nmbaent = g_enterprise 
         AND nmbacomp = l_nmbb_t.nmbbcomp
         AND nmbadocno = l_nmbb_t.nmbbdocno
      IF l_nmba006 = 'Y' THEN
        #anmi152待沖銷科目
        CALL s_fin_get_account(g_xrda_m.xrdald,'41','8714','F')
         RETURNING g_sub_success,l_xrde_t.xrde016,g_errno
      END IF
      #150812-00010#3 --e          
      CASE
         WHEN l_ld_s = 1
            LET l_xrde_t.xrde109  = l_nmbb_t.nmbb006 - l_nmbb_t.nmbb008 - l_xrde109 - l_xrfb103     #151105-00008#6 add l_xrfb103 lujh
            LET l_xrde_t.xrde119  = l_nmbb_t.nmbb007 - l_nmbb_t.nmbb009 - l_xrde119 - l_xrfb104     #151105-00008#6 add l_xrfb104 lujh
         WHEN l_ld_s = 2
            LET l_xrde_t.xrde109  = l_nmbb_t.nmbb006 - l_nmbb_t.nmbb020 - l_xrde109 - l_xrfb103     #151105-00008#6 add l_xrfb103 lujh
            LET l_xrde_t.xrde119  = l_nmbb_t.nmbb007 - l_nmbb_t.nmbb021 - l_xrde119 - l_xrfb104     #151105-00008#6 add l_xrfb104 lujh
         WHEN l_ld_s = 3
            LET l_xrde_t.xrde109  = l_nmbb_t.nmbb006 - l_nmbb_t.nmbb023 - l_xrde109 - l_xrfb103     #151105-00008#6 add l_xrfb103 lujh
            LET l_xrde_t.xrde119  = l_nmbb_t.nmbb007 - l_nmbb_t.nmbb024 - l_xrde119 - l_xrfb104     #151105-00008#6 add l_xrfb104 lujh
      END CASE
      LET l_xrde_t.xrde129  = l_nmbb_t.nmbb013 - l_nmbb_t.nmbb014 - l_xrde129
      LET l_xrde_t.xrde139  = l_nmbb_t.nmbb017 - l_nmbb_t.nmbb018 - l_xrde139

     #160114-00019#2 Add  ---(S)---
      SELECT nmbadocdt INTO l_xrde_t.xrde032 FROM nmba_t WHERE nmbaent = g_enterprise 
         AND nmbacomp = l_nmbb_t.nmbbcomp
         AND nmbadocno = l_nmbb_t.nmbbdocno
     #160114-00019#2 Add  ---(E)---

      #INSERT INTO xrde_t VALUES(l_xrde_t.*)
      INSERT INTO xrde_t(xrdeent,xrdecomp,xrdeld,xrdesite,xrdeorga,xrdedocno,xrdeseq,xrde001,
                         xrde002,xrde003,xrde004,xrde006,xrde008,xrde010,xrde011,xrde012,xrde013,
                         xrde014,xrde015,xrde016,xrde017,xrde018,xrde019,xrde020,xrde022,xrde023,
                         xrde100,xrde101,xrde109,xrde119,xrde120,xrde121,xrde129,xrde130,xrde131,xrde139,
                         xrde032            #160114-00019#2 Add
                         )
                  VALUES(l_xrde_t.xrdeent ,l_xrde_t.xrdecomp ,l_xrde_t.xrdeld ,l_xrde_t.xrdesite,
                         l_xrde_t.xrdeorga,l_xrde_t.xrdedocno,l_xrde_t.xrdeseq,l_xrde_t.xrde001,
                         l_xrde_t.xrde002 ,l_xrde_t.xrde003  ,l_xrde_t.xrde004,l_xrde_t.xrde006,
                         l_xrde_t.xrde008 ,l_xrde_t.xrde010  ,l_xrde_t.xrde011,l_xrde_t.xrde012,
                         l_xrde_t.xrde013 ,l_xrde_t.xrde014  ,l_xrde_t.xrde015,l_xrde_t.xrde016,
                         l_xrde_t.xrde017 ,l_xrde_t.xrde018  ,l_xrde_t.xrde019,l_xrde_t.xrde020,
                         l_xrde_t.xrde022 ,l_xrde_t.xrde023  ,l_xrde_t.xrde100,l_xrde_t.xrde101,
                         l_xrde_t.xrde109 ,l_xrde_t.xrde119  ,l_xrde_t.xrde120,l_xrde_t.xrde121,
                         l_xrde_t.xrde129 ,l_xrde_t.xrde130  ,l_xrde_t.xrde131,l_xrde_t.xrde139,
                         l_xrde_t.xrde032   #160114-00019#2 Add
                         )
      IF SQLCA.sqlcode THEN
         LET g_success = 'N'
      END IF
      
      #LET l_xrde_t.xrdeseq = l_xrde_t.xrdeseq + 1    #151105-00008#2 mark lujh

      #151105-00008#2--add--str--lujh
      SELECT MAX(xrdeseq) INTO l_xrde_t.xrdeseq
        FROM xrde_t
       WHERE xrdeent = g_enterprise 
         AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
      IF cl_null(l_xrde_t.xrdeseq) THEN
         LET l_xrde_t.xrdeseq = 1
      ELSE
         LET l_xrde_t.xrdeseq = l_xrde_t.xrdeseq + 1 
      END IF
      #151105-00008#2--add--end--lujh

   END FOREACH
END FUNCTION
# 刷新合計金額顯示
PRIVATE FUNCTION axrt400_ref_amt()
   DEFINE l_amt1,l_amt2      LIKE xrde_t.xrde109     #收款金額
   DEFINE l_amt3,l_amt4      LIKE xrce_t.xrce109     #帳款金額
   DEFINE l_amt5,l_amt6      LIKE xrce_t.xrce109     #匯差及調整金額
   DEFINE l_amt7,l_amt8      LIKE xrce_t.xrce109     #差異金額
   DEFINE l_amt1_1,l_amt2_1  LIKE xrde_t.xrde109     #收款金額         本位幣二/三
   DEFINE l_amt3_1,l_amt4_1  LIKE xrce_t.xrce109     #帳款金額         本位幣二/三
   DEFINE l_amt5_1,l_amt6_1  LIKE xrce_t.xrce109     #匯差及調整金額    本位幣二/三
   DEFINE l_amt7_1,l_amt8_1  LIKE xrce_t.xrce109     #差異金額         本位幣二/三
   DEFINE l_xrde109_d        LIKE xrde_t.xrde109
   DEFINE l_xrde119_d        LIKE xrde_t.xrde109
   DEFINE l_xrde129_d        LIKE xrde_t.xrde109
   DEFINE l_xrde139_d        LIKE xrde_t.xrde109
   DEFINE l_xrce109_d        LIKE xrce_t.xrce109
   DEFINE l_xrce119_d        LIKE xrce_t.xrce109
   DEFINE l_xrce129_d        LIKE xrce_t.xrce109
   DEFINE l_xrce139_d        LIKE xrce_t.xrce109
   DEFINE l_xrde109_c        LIKE xrde_t.xrde109
   DEFINE l_xrde119_c        LIKE xrde_t.xrde109
   DEFINE l_xrde129_c        LIKE xrde_t.xrde109
   DEFINE l_xrde139_c        LIKE xrde_t.xrde109
   DEFINE l_xrce109_c        LIKE xrce_t.xrce109
   DEFINE l_xrce119_c        LIKE xrce_t.xrce109
   DEFINE l_xrce129_c        LIKE xrce_t.xrce109
   DEFINE l_xrce139_c        LIKE xrce_t.xrce109
   
   #計算收款
   SELECT SUM(xrde109),SUM(xrde119) INTO l_amt1,l_amt2 FROM xrde_t,gzcb_t
    WHERE xrdeent = g_enterprise
      AND xrdeld  = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde002 = gzcb002
      AND gzcb001 = '8306'
      AND gzcb004 = '1'
      AND xrde002 = '10'
   IF cl_null(l_amt1) THEN LET l_amt1 = 0 END IF
   IF cl_null(l_amt2) THEN LET l_amt2 = 0 END IF
   
   #計算帳款
   SELECT SUM(xrce109 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END),SUM(xrce119 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END)
     INTO l_amt3,l_amt4
     FROM xrce_t,gzcb_t
    WHERE xrceent = g_enterprise
      AND xrceld  = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND gzcb001 = '8306'
      AND gzcb004 = '2'
      AND gzcb002 = xrce002
   IF cl_null(l_amt3) THEN LET l_amt3 = 0 END IF
   IF cl_null(l_amt4) THEN LET l_amt4 = 0 END IF
   
   #計算匯差及調整帳款
   SELECT SUM(xrde109 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END),SUM(xrde119 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END)
     INTO l_amt5,l_amt6
     FROM xrde_t,gzcb_t
    WHERE xrdeent = g_enterprise
      AND xrdeld  = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde002 = gzcb002
      AND gzcb001 = '8306'
      AND xrde002 <> 10
      AND gzcb004 = '1'
   IF cl_null(l_amt5) THEN LET l_amt5 = 0 END IF
   IF cl_null(l_amt6) THEN LET l_amt6 = 0 END IF
   
   LET l_amt7 = 0
   LET l_amt8 = l_amt2 + l_amt4 + l_amt6
   
   #計算收款---本位幣二/三
   SELECT SUM(xrde129),SUM(xrde139) INTO l_amt1_1,l_amt2_1 FROM xrde_t,gzcb_t
    WHERE xrdeent = g_enterprise
      AND xrdeld  = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde002 = gzcb002
      AND gzcb001 = '8306'
      AND gzcb004 = '1'
      AND xrde002 = '10'
   IF cl_null(l_amt1_1) THEN LET l_amt1_1 = 0 END IF
   IF cl_null(l_amt2_1) THEN LET l_amt2_1 = 0 END IF
   
   #計算帳款---本位幣二/三
   SELECT SUM(xrce129 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END),SUM(xrce139 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END)
     INTO l_amt3_1,l_amt4_1
     FROM xrce_t,gzcb_t
    WHERE xrceent = g_enterprise
      AND xrceld  = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND gzcb001 = '8306'
      AND gzcb004 = '2'
      AND gzcb002 = xrce002
   IF cl_null(l_amt3_1) THEN LET l_amt3_1 = 0 END IF
   IF cl_null(l_amt4_1) THEN LET l_amt4_1 = 0 END IF
   
   #計算匯差及調整帳款---本位幣二/三
   SELECT SUM(xrde129 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END),SUM(xrde139 * CASE WHEN gzcb003 = 'D' THEN 1 ELSE -1 END)
     INTO l_amt5_1,l_amt6_1
     FROM xrde_t,gzcb_t
    WHERE xrdeent = g_enterprise
      AND xrdeld  = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde002 = gzcb002
      AND gzcb001 = '8306'
      AND gzcb004 = '1'
      AND xrde002 <> 10
   IF cl_null(l_amt5_1) THEN LET l_amt5_1 = 0 END IF
   IF cl_null(l_amt6_1) THEN LET l_amt6_1 = 0 END IF
   
   LET l_amt7_1 = l_amt1_1 + l_amt3_1 + l_amt5_1
   LET l_amt8_1 = l_amt2_1 + l_amt4_1 + l_amt6_1
   
   
   #借
   SELECT SUM(xrde109),SUM(xrde119),SUM(xrde129),SUM(xrde139)
     INTO l_xrde109_d,l_xrde119_d,l_xrde129_d,l_xrde139_d
     FROM xrde_t
    WHERE xrdeent = g_enterprise
      AND xrdeld = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde015 = 'D'
      
   IF cl_null(l_xrde109_d) THEN LET l_xrde109_d = 0 END IF
   IF cl_null(l_xrde119_d) THEN LET l_xrde119_d = 0 END IF
   IF cl_null(l_xrde129_d) THEN LET l_xrde129_d = 0 END IF
   IF cl_null(l_xrde139_d) THEN LET l_xrde139_d = 0 END IF
   
   SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139)
     INTO l_xrce109_d,l_xrce119_d,l_xrce129_d,l_xrce139_d
     FROM xrce_t
    WHERE xrceent = g_enterprise
      AND xrceld = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND xrce015 = 'D'
      
   IF cl_null(l_xrce109_d) THEN LET l_xrce109_d = 0 END IF
   IF cl_null(l_xrce119_d) THEN LET l_xrce119_d = 0 END IF
   IF cl_null(l_xrce129_d) THEN LET l_xrce129_d = 0 END IF
   IF cl_null(l_xrce139_d) THEN LET l_xrce139_d = 0 END IF
   
   #贷   
   SELECT SUM(xrde109),SUM(xrde119),SUM(xrde129),SUM(xrde139)
     INTO l_xrde109_c,l_xrde119_c,l_xrde129_c,l_xrde139_c
     FROM xrde_t
    WHERE xrdeent = g_enterprise
      AND xrdeld = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde015 = 'C'
      
   IF cl_null(l_xrde109_c) THEN LET l_xrde109_c = 0 END IF
   IF cl_null(l_xrde119_c) THEN LET l_xrde119_c = 0 END IF
   IF cl_null(l_xrde129_c) THEN LET l_xrde129_c = 0 END IF
   IF cl_null(l_xrde139_c) THEN LET l_xrde139_c = 0 END IF
      
   SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139)
     INTO l_xrce109_c,l_xrce119_c,l_xrce129_c,l_xrce139_c
     FROM xrce_t
    WHERE xrceent = g_enterprise
      AND xrceld = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND xrce015 = 'C'
      
   IF cl_null(l_xrce109_c) THEN LET l_xrce109_c = 0 END IF
   IF cl_null(l_xrce119_c) THEN LET l_xrce119_c = 0 END IF
   IF cl_null(l_xrce129_c) THEN LET l_xrce129_c = 0 END IF
   IF cl_null(l_xrce139_c) THEN LET l_xrce139_c = 0 END IF
   
   #借方合计   
   LET g_amt1_d = l_xrde109_d + l_xrce109_d      #原币
   LET g_amt2_d = l_xrde119_d + l_xrce119_d      #本币
                                                 
   #贷方合计                                      
   LET g_amt3_c = l_xrde109_c + l_xrce109_c      #原币
   LET g_amt4_c = l_xrde119_c + l_xrce119_c      #本币

   #差异
   LET g_amt5_diff = g_amt1_d - g_amt3_c         #原币
   LET g_amt6_diff = g_amt2_d - g_amt4_c         #本币
   
   #本位币二
   #借方
   LET g_amt1_d_1 = l_xrde129_d + l_xrce129_d
   #贷方
   LET g_amt3_c_1 = l_xrde129_c + l_xrce129_c
   #差异
   LET g_amt5_diff_1 = g_amt1_d_1 - g_amt3_c_1
   
   #本位币三
   #借方
   LET g_amt2_d_1 = l_xrde139_d + l_xrce139_d
   #贷方
   LET g_amt4_c_1 = l_xrde139_c + l_xrce139_c
   #差异
   LET g_amt6_diff_1 = g_amt2_d_1 - g_amt4_c_1
   
   
   IF g_glaa_t.glaa015 = 'N' AND g_glaa_t.glaa019 = 'N' THEN
      CALL cl_set_comp_visible('page_4,page_7,page_10,grid_9',FALSE)
   ELSE
      CALL cl_set_comp_visible('page_4,page_7,page_10',TRUE)
      IF g_glaa_t.glaa015 = 'N' THEN
         CALL cl_set_comp_visible('xrde120,xrde121,xrde129',FALSE)
         CALL cl_set_comp_visible('xrce120,xrce121,xrce129',FALSE)
         CALL cl_set_comp_visible('lbl_curr3,lbl_glaa001_2,lbl_amt1_1,lbl_amt3_1,lbl_amt5_1,lbl_amt7_1',FALSE)
         CALL cl_set_comp_visible('glaa001_2,amt1_d_1,amt3_c_1,amt5_diff_1',FALSE)
         LET l_amt1_1 = 0   LET l_amt5_1 = 0
         LET l_amt3_1 = 0   LET l_amt7_1 = 0
         LET g_amt1_d_1 = 0
         LET g_amt3_c_1 = 0
         LET g_amt5_diff_1 = 0
      ELSE
         CALL cl_set_comp_visible('xrde120,xrde121,xrde129',TRUE)
         CALL cl_set_comp_visible('xrce120,xrce121,xrce129',TRUE)
         CALL cl_set_comp_visible('lbl_curr3,lbl_glaa001_2,lbl_amt1_1,lbl_amt3_1,lbl_amt5_1,lbl_amt7_1',TRUE)
         CALL cl_set_comp_visible('glaa001_2,amt1_d_1,amt3_c_1,amt5_diff_1',TRUE)
      END IF
      IF g_glaa_t.glaa019 = 'N' THEN
         CALL cl_set_comp_visible('xrde130,xrde131,xrde139',FALSE)
         CALL cl_set_comp_visible('xrce130,xrce131,xrce139',FALSE)
         CALL cl_set_comp_visible('lbl_curr4,lbl_glaa001_3,lbl_amt2_1,lbl_amt4_1,lbl_amt6_1,lbl_amt8_1',FALSE)
         CALL cl_set_comp_visible('glaa001_3,amt2_d_1,amt4_c_1,amt6_diff_1',FALSE)
         LET l_amt2_1 = 0   LET l_amt4_1 = 0
         LET l_amt6_1 = 0   LET l_amt8_1 = 0
         LET g_amt2_d_1 = 0
         LET g_amt4_c_1 = 0
         LET g_amt6_diff_1 = 0
      ELSE
         CALL cl_set_comp_visible('xrde130,xrde131,xrde139',TRUE)
         CALL cl_set_comp_visible('xrce130,xrce131,xrce139',TRUE)
         CALL cl_set_comp_visible('lbl_curr4,lbl_glaa001_3,lbl_amt2_1,lbl_amt4_1,lbl_amt6_1,lbl_amt8_1',TRUE)
         CALL cl_set_comp_visible('glaa001_3,amt2_d_1,amt4_c_1,amt6_diff_1',TRUE)
      END IF
   END IF
      
   DISPLAY l_amt1,  l_amt3,  l_amt5,  l_amt7   TO lbl_amt1,  lbl_amt3,  lbl_amt5,lbl_amt7
   DISPLAY l_amt2,  l_amt4,  l_amt6,  l_amt8   TO lbl_amt2,  lbl_amt4,  lbl_amt6,lbl_amt8
   DISPLAY l_amt1_1,l_amt3_1,l_amt5_1,l_amt7_1 TO lbl_amt1_1,lbl_amt3_1,lbl_amt5_1,lbl_amt7_1
   DISPLAY l_amt2_1,l_amt4_1,l_amt6_1,l_amt8_1 TO lbl_amt2_1,lbl_amt4_1,lbl_amt6_1,lbl_amt8_1
   
   DISPLAY g_amt1_d,  g_amt3_c,  g_amt5_diff   TO amt1_d,  amt3_c,  amt5_diff
   DISPLAY g_amt2_d,  g_amt4_c,  g_amt6_diff   TO amt2_d,  amt4_c,  amt6_diff
   DISPLAY g_amt1_d_1,g_amt3_c_1,g_amt5_diff_1 TO amt1_d_1,amt3_c_1,amt5_diff_1
   DISPLAY g_amt2_d_1,g_amt4_c_1,g_amt6_diff_1 TO amt2_d_1,amt4_c_1,amt6_diff_1
   
   LET g_amt = l_amt8
END FUNCTION
# 科目名稱
PRIVATE FUNCTION axrt400_xrde016_desc(p_xrde016)
   DEFINE p_xrde016       LIKE xrde_t.xrde016
   DEFINE r_xrde016_desc  LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glaa_t.glaa004
   LET g_ref_fields[2] = p_xrde016
   CALL ap_ref_array2(g_ref_fields,"SELECT glacl004 FROM glacl_t WHERE glaclent='"||g_enterprise||"' AND glacl001=? AND glacl002=? AND glacl003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_xrde016_desc = '', g_rtn_fields[1] , ''
   
   RETURN r_xrde016_desc
END FUNCTION
# 人员名称
PRIVATE FUNCTION axrt400_xrde017_desc(p_xrde017)
   DEFINE p_xrde017       LIKE xrde_t.xrde017
   DEFINE r_xrde017_desc  LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_xrde017
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET r_xrde017_desc = '', g_rtn_fields[1] , ''
   
   RETURN r_xrde017_desc
END FUNCTION
# 部門、責任中心名稱
PRIVATE FUNCTION axrt400_xrde018_desc(p_ooef001)
   DEFINE p_ooef001       LIKE ooef_t.ooef001
   DEFINE r_xrde018_desc  LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_ooef001
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_xrde018_desc = '', g_rtn_fields[1] , ''

   RETURN r_xrde018_desc
END FUNCTION
# 區域/客群名稱
PRIVATE FUNCTION axrt400_xrde035_desc(p_oocq001,p_oocq002)
   DEFINE p_oocq001  LIKE oocq_t.oocq001
   DEFINE p_oocq002  LIKE oocq_t.oocq002
   DEFINE r_oocql004 LIKE oocql_t.oocql004 
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_oocq001
   LET g_ref_fields[2] = p_oocq002
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_oocql004 = '', g_rtn_fields[1] , ''
   
   RETURN r_oocql004
END FUNCTION
# 產品類別名稱
PRIVATE FUNCTION axrt400_xrde020_desc(p_xrde020)
   DEFINE p_xrde020       LIKE xrde_t.xrde020
   DEFINE r_xrde020_desc  LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_xrde020
   CALL ap_ref_array2(g_ref_fields,"SELECT rtaxl003 FROM rtaxl_t WHERE rtaxlent='"||g_enterprise||"' AND rtaxl001=? AND rtaxl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_xrde020_desc = '', g_rtn_fields[1] , ''

   RETURN r_xrde020_desc
END FUNCTION
# 專案編號名稱
PRIVATE FUNCTION axrt400_xrde022_desc(p_xrde022)
   DEFINE p_xrde022          LIKE xrde_t.xrde022
   DEFINE r_xrde022_desc     LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_xrde022
   CALL ap_ref_array2(g_ref_fields,"SELECT pjbal003 FROM pjbal_t WHERE pjbalent='"||g_enterprise||"' AND pjbal001=? AND pjbal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_xrde022_desc = '', g_rtn_fields[1] , ''

   RETURN r_xrde022_desc
END FUNCTION
# WBS名稱
PRIVATE FUNCTION axrt400_xrde023_desc(p_xrde022,p_xrde023)
   DEFINE p_xrde022          LIKE xrde_t.xrde022
   DEFINE p_xrde023          LIKE xrde_t.xrde023
   DEFINE r_xrde023_desc     LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_xrde022
   LET g_ref_fields[2] = p_xrde023
   CALL ap_ref_array2(g_ref_fields,"SELECT pjbbl004 FROM pjbbl_t WHERE pjbblent='"||g_enterprise||"' AND pjbbl001=? AND pjbbl002=? AND pjbbl003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_xrde023_desc = '', g_rtn_fields[1] , ''
   
   RETURN r_xrde023_desc
END FUNCTION
# 渠道名稱
PRIVATE FUNCTION axrt400_xrde040_desc(p_xrde040)
   DEFINE p_xrde040          LIKE xrde_t.xrde040
   DEFINE r_xrde040_desc     LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_xrde040
   CALL ap_ref_array2(g_ref_fields,"SELECT oojdl003 FROM oojdl_t WHERE oojdlent='"||g_enterprise||"' AND oojdl001=? AND oojdl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_xrde040_desc = '', g_rtn_fields[1] , ''

   RETURN r_xrde040_desc
END FUNCTION
# 抓取账款单身xrcc的值
PRIVATE FUNCTION axrt400_xrcc_get()
   
   IF g_xrde4_d[l_ac].xrce002 = '30' OR g_xrde4_d[l_ac].xrce002 = '31' OR g_xrde4_d[l_ac].xrce002 = '32' THEN
      SELECT xrcc009,xrcc003,xrcc108,xrcc118
#       INTO g_xrde4_d[l_ac].xrcc009,g_xrde4_d[l_ac].xrcc003,    #150901-00004#1
        INTO g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrcc003,    #150901-00004#1
             g_xrde4_d[l_ac].xrcc108,g_xrde4_d[l_ac].xrcc118
        FROM xrcc_t
       WHERE xrccent = g_enterprise
         AND xrccld = g_xrda_m.xrdald
         AND xrccdocno = g_xrde4_d[l_ac].xrce003
         AND xrccseq = g_xrde4_d[l_ac].xrce004
         AND xrcc001 = g_xrde4_d[l_ac].xrce005
      
      #160111-00020#5--add--str--lujh      
      SELECT xrca057 INTO g_xrde4_d[l_ac].xrca057 
        FROM xrca_t
       WHERE xrcaent = g_enterprise
         AND xrcald = g_xrda_m.xrdald
         AND xrcadocno = g_xrde4_d[l_ac].xrce003
      #160111-00020#5--add--end--lujh
   END IF
   
   IF g_xrde4_d[l_ac].xrce002 = '40' OR g_xrde4_d[l_ac].xrce002 = '41' OR g_xrde4_d[l_ac].xrce002 = '42' THEN
      SELECT apcc009,apcc003,apcc108,apcc118
#       INTO g_xrde4_d[l_ac].xrcc009,g_xrde4_d[l_ac].xrcc003,    #150901-00004#1
        INTO g_xrde4_d[l_ac].xrce054,g_xrde4_d[l_ac].xrcc003,    #150901-00004#1
             g_xrde4_d[l_ac].xrcc108,g_xrde4_d[l_ac].xrcc118
        FROM apcc_t
       WHERE apccent = g_enterprise
         AND apccld = g_xrda_m.xrdald
         AND apccdocno = g_xrde4_d[l_ac].xrce003
         AND apccseq = g_xrde4_d[l_ac].xrce004
         AND apcc001 = g_xrde4_d[l_ac].xrce005
         
      #160111-00020#5--add--str--lujh      
      SELECT apca057 INTO g_xrde4_d[l_ac].xrca057 
        FROM apca_t
       WHERE apcaent = g_enterprise
         AND apcald = g_xrda_m.xrdald
         AND apcadocno = g_xrde4_d[l_ac].xrce003
      #160111-00020#5--add--end--lujh
   END IF
      
   #160111-00020#5--add--str--lujh   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_xrde4_d[l_ac].xrca057
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET g_xrde4_d[l_ac].xrca057_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_xrde4_d[l_ac].xrca057_desc
   #160111-00020#5--add--end--lujh   
      
#  DISPLAY g_xrde4_d[l_ac].xrcc009 TO s_detail4[l_ac].xrcc009  #150901-00004#1
   DISPLAY g_xrde4_d[l_ac].xrce054 TO s_detail4[l_ac].xrcc009  #150901-00004#1
   DISPLAY g_xrde4_d[l_ac].xrcc003 TO s_detail4[l_ac].xrcc003
   DISPLAY g_xrde4_d[l_ac].xrcc108 TO s_detail4[l_ac].xrcc108
   DISPLAY g_xrde4_d[l_ac].xrcc118 TO s_detail4[l_ac].xrcc118
END FUNCTION
# 收款原币金额检查
PRIVATE FUNCTION axrt400_chk_xrde109()
   DEFINE l_tot1         LIKE nmbb_t.nmbb006   #原幣金額
   DEFINE l_tot2         LIKE nmbb_t.nmbb007   #本幣金額
   DEFINE l_amt1         LIKE nmbb_t.nmbb008   #已沖原幣金額  主帳套
   DEFINE l_amt2         LIKE nmbb_t.nmbb009   #已沖本幣金額  主帳套
   DEFINE l_amt3         LIKE nmbb_t.nmbb020   #已沖原幣金額  次帳套一
   DEFINE l_amt4         LIKE nmbb_t.nmbb021   #已沖本幣金額  次帳套一
   DEFINE l_amt5         LIKE nmbb_t.nmbb023   #已沖原幣金額  次帳套二
   DEFINE l_amt6         LIKE nmbb_t.nmbb024   #已沖本幣金額  次帳套二
   DEFINE l_errno1       LIKE gzze_t.gzze001
   DEFINE l_count        LIKE type_t.num5
   DEFINE l_ld_s         LIKE type_t.num5
   #20150702--add--str--lujh
   DEFINE l_xrde109      LIKE xrde_t.xrde109
   DEFINE l_xrde119      LIKE xrde_t.xrde119
   DEFINE l_xrde129      LIKE xrde_t.xrde129
   DEFINE l_xrde139      LIKE xrde_t.xrde139
   #20150702--add--end--lujh
   #151105-00008#2--add--str--lujh
   DEFINE l_xrfb103      LIKE xrfb_t.xrfb103
   DEFINE l_xrfb104      LIKE xrfb_t.xrfb104
   #151105-00008#2--add--end--lujh
 
   LET g_errno = ' '
 
   #檢查是否是主帳套
   LET l_count = 0
   SELECT COUNT(*) INTO l_count FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald  = g_xrda_m.xrdald
      AND glaa014 = 'Y'
   IF l_count > 0 THEN
     LET l_ld_s = 1
   ELSE
      #次帳套一
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
       WHERE ooab001 = 'S-FIN-0001' AND ooab002 = g_xrda_m.xrdald
         AND ooabsite= g_xrda_m.xrdasite
         AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 2
      END IF
      #次帳套二
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
       WHERE ooab001 = 'S-FIN-0002' AND ooab002 = g_xrda_m.xrdald
         AND ooabsite= g_xrda_m.xrdasite
         AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 3
      END IF
   END IF
   
   CASE
      WHEN g_xrde_d[l_ac].xrde006 = '10' OR g_xrde_d[l_ac].xrde006 = '20' OR g_xrde_d[l_ac].xrde006 = '30'
         #檢查銀存收支明細檔(nmbb_t)
         SELECT nmbb006,nmbb007,nmbb008,nmbb009,nmbb020,nmbb021,nmbb023,nmbb024
           INTO l_tot1,l_tot2,l_amt1,l_amt2,l_amt3,l_amt4,l_amt5,l_amt6
           FROM nmbb_t
          WHERE nmbbent  = g_enterprise
            AND nmbbdocno= g_xrde_d[l_ac].xrde003
            AND nmbbseq  = g_xrde_d[l_ac].xrde004
         LET l_errno1 = 'axr-00054'
      
      #WHEN g_xrde_d[l_ac].xrde006 = '30'
      #   #檢查應收票據主檔(nmcn_t)
      #   SELECT nmcn011,nmcn013,nmcn028,nmcn029,nmcn039,nmcn040,nmcn042,nmcn043
      #     INTO l_tot1,l_tot2,l_amt1,l_amt2,l_amt3,l_amt4,l_amt5,l_amt6
      #     FROM nmcn_t
      #    WHERE nmcnent  = g_enterprise
      #      AND nmcndocno= g_xrde_d[l_ac].xrde003
      #   LET l_errno1 = 'axr-00058'
      
   END CASE
   
   #20150702--add--str--lujh
   SELECT SUM(xrde109),SUM(xrde119),SUM(xrde129),SUM(xrde139)
     INTO l_xrde109,l_xrde119,l_xrde129,l_xrde139
     FROM xrde_t,xrda_t
    WHERE xrdeent = g_enterprise
      AND xrdeent = xrdaent
      AND xrdedocno = xrdadocno
      AND xrdeld = xrdald
      AND xrdastus = 'N'
      AND xrde003 = g_xrde_d[l_ac].xrde003
      AND xrde004 = g_xrde_d[l_ac].xrde004
      AND ((xrdedocno = g_xrda_m.xrdadocno
      AND   xrdeseq <> g_xrde_d[l_ac].xrdeseq)
       OR   xrdedocno <> g_xrda_m.xrdadocno )   
   
   IF cl_null(l_xrde109) THEN LET l_xrde109 = 0 END IF
   IF cl_null(l_xrde119) THEN LET l_xrde119 = 0 END IF
   IF cl_null(l_xrde129) THEN LET l_xrde129 = 0 END IF
   IF cl_null(l_xrde139) THEN LET l_xrde139 = 0 END IF
   #20150702--add--end--lujh
   
   #151105-00008#2--add--str--lujh
   LET l_xrfb103 = 0 LET l_xrfb104 = 0
   SELECT SUM(xrfb103),SUM(xrfb104)
     INTO l_xrfb103,l_xrfb104
     FROM xrfa_t,xrfb_t
    WHERE xrfaent = g_enterprise
      AND xrfaent = xrfbent
      AND xrfadocno = xrfbdocno
      AND xrfald = xrfbld
      AND xrfastus = 'N'
      AND xrfb002 = g_xrde_d[l_ac].xrde003
      AND xrfb003 = g_xrde_d[l_ac].xrde004
   
   IF cl_null(l_xrfb103) THEN LET l_xrfb103 = 0 END IF
   IF cl_null(l_xrfb104) THEN LET l_xrfb104 = 0 END IF
   #151105-00008#2--add--end--lujh
   
   IF l_ld_s = 1 THEN
      LET l_tot1 = l_tot1 - l_amt1
      LET l_tot2 = l_tot2 - l_amt2
   ELSE
      IF l_ld_s = 2 THEN
        LET l_tot1 = l_tot1 - l_amt3
        LET l_tot2 = l_tot2 - l_amt4
      ELSE
        LET l_tot1 = l_tot1 - l_amt5
        LET l_tot2 = l_tot2 - l_amt6
      END IF
   END IF
   IF l_tot1 < g_xrde_d[l_ac].xrde109 + l_xrde109 + l_xrfb103 OR l_tot2 < g_xrde_d[l_ac].xrde119 + l_xrde119 + l_xrfb104 THEN   #151105-00008#2 add l_xrfb103  l_xrfb104 lujh  
      LET g_errno = l_errno1 RETURN
   END IF
END FUNCTION
# 账款原币金额检查
PRIVATE FUNCTION axrt400_chk_xrce109()
   DEFINE l_tot1         LIKE nmbb_t.nmbb006   #原幣金額
   DEFINE l_tot2         LIKE nmbb_t.nmbb007   #本幣金額
   DEFINE l_errno1       LIKE gzze_t.gzze001
   DEFINE l_count        LIKE type_t.num5
   DEFINE l_ld_s         LIKE type_t.num5
   DEFINE l_ooab002      LIKE ooab_t.ooab002
   DEFINE l_xrcc108      LIKE xrcc_t.xrcc108
   DEFINE l_xrcc118      LIKE xrcc_t.xrcc118
   DEFINE l_xrce109      LIKE xrce_t.xrce109
   DEFINE l_xrce119      LIKE xrce_t.xrce119
   #20150924--add--str--lujh
   DEFINE l_xrce109_1    LIKE xrce_t.xrce109
   DEFINE l_xrce119_1    LIKE xrce_t.xrce119
   #20150924--add--end--lujh
   #151105-00008#6--add--str--lujh
   DEFINE l_xrfc103      LIKE xrfc_t.xrfc103     
   DEFINE l_xrfc104      LIKE xrfc_t.xrfc104
   #151105-00008#6--add--end--lujh
   DEFINE l_xrca001      LIKE xrca_t.xrca001   #160420-00001#13 Add
   DEFINE l_gzcb005      LIKE gzcb_t.gzcb005   #160420-00001#13 Add
   DEFINE l_xrcc108_t    LIKE xrcc_t.xrcc108   #160420-00001#13 Add
   DEFINE l_xrcc118_t    LIKE xrcc_t.xrcc118   #160420-00001#13 Add

   LET g_errno = ''
   LET l_ooab002 = ''
   SELECT ooab002 INTO l_ooab002 FROM ooab_t
    WHERE ooabent = g_enterprise
      AND ooab001 = 'S-FIN-1002'
      AND ooabsite= g_xrda_m.xrdasite
                    
   IF cl_null(g_xrde4_d[l_ac].xrce003) THEN RETURN END IF

   IF g_xrde4_d[l_ac].xrce002 = '30' OR g_xrde4_d[l_ac].xrce002 = '31' OR g_xrde4_d[l_ac].xrce002 = '32' THEN
      SELECT SUM(xrcc108 - xrcc109),SUM(xrcc118 - xrcc119 + xrcc113) INTO l_xrcc108,l_xrcc118 FROM xrcc_t
       WHERE xrccent = g_enterprise
         AND xrccld = g_xrda_m.xrdald
         AND xrccdocno = g_xrde4_d[l_ac].xrce003
         AND xrccseq = g_xrde4_d[l_ac].xrce004
         AND xrcc001 = g_xrde4_d[l_ac].xrce005

     #160420-00001#13 Add  ---(S)---
     #重新计算訂金待抵單可沖總金額.待抵單可沖總金額應為原始單據已收款金額
     LET l_gzcb005 = ''
     LET l_xrcc108_t = 0
     LET l_xrcc118_t = 0
     SELECT xrca001 INTO l_xrca001 FROM xrca_t WHERE xrcaent = g_enterprise
       AND xrcald = g_xrda_m.xrdald
       AND xrcadocno = g_xrde4_d[l_ac].xrce003
     SELECT gzcb005 INTO l_gzcb005 FROM gzcb_t WHERE gzcb001 = '8302' AND gzcb002 = l_xrca001
     IF l_gzcb005 = 'axrq342' THEN
        SELECT SUM(xrcc108 - xrcc109),SUM(xrcc118 - xrcc119 + xrcc113) INTO l_xrcc108_t,l_xrcc118_t FROM xrcc_t
         WHERE xrccent = g_enterprise
           AND xrccld = g_xrda_m.xrdald
           AND xrccdocno IN (
         SELECT xrca018 FROM xrca_t WHERE xrcaent = g_enterprise
         AND xrcald = g_xrda_m.xrdald
         AND xrcadocno = g_xrde4_d[l_ac].xrce003)
     END IF
     LET l_xrcc108 = l_xrcc108 - l_xrcc108_t
     LET l_xrcc118 = l_xrcc118 - l_xrcc118_t
     #160420-00001#13 Add  ---(E)---


   END IF
   
   IF g_xrde4_d[l_ac].xrce002 = '40' OR g_xrde4_d[l_ac].xrce002 = '41' OR g_xrde4_d[l_ac].xrce002 = '42' THEN 
      SELECT SUM(apcc108 - apcc109),SUM(apcc118 - apcc119 + apcc113) INTO l_xrcc108,l_xrcc118 FROM apcc_t
       WHERE apccent = g_enterprise
         AND apccld = g_xrda_m.xrdald
         AND apccdocno = g_xrde4_d[l_ac].xrce003
         AND apccseq = g_xrde4_d[l_ac].xrce004
         AND apcc001 = g_xrde4_d[l_ac].xrce005

     #160420-00001#13 Add  ---(S)---
     #重新计算訂金待抵單可沖總金額.待抵單可沖總金額應為原始單據已收款金額
     LET l_gzcb005 = ''
     LET l_xrcc108_t = 0
     LET l_xrcc118_t = 0
     SELECT apca001 INTO l_xrca001 FROM apca_t WHERE apcaent = g_enterprise
        AND apcald = g_xrda_m.xrdald
        AND apcadocno = g_xrde4_d[l_ac].xrce003
     SELECT gzcb005 INTO l_gzcb005 FROM gzcb_t WHERE gzcb001 = '8502' AND gzcb002 = l_xrca001
     IF l_gzcb005 = 'aapq342' THEN
        SELECT SUM(apcc108 - apcc109),SUM(apcc118 - apcc119 + apcc113) INTO l_xrcc108_t,l_xrcc118_t FROM apcc_t
         WHERE apccent = g_enterprise
           AND apccld = g_xrda_m.xrdald
           AND apccdocno IN (
         SELECT apca018 FROM apca_t WHERE apcaent = g_enterprise
         AND apcald = g_xrda_m.xrdald
         AND apcadocno = g_xrde4_d[l_ac].xrce003)
     END IF
     LET l_xrcc108 = l_xrcc108 - l_xrcc108_t
     LET l_xrcc118 = l_xrcc118 - l_xrcc118_t
     #160420-00001#13 Add  ---(E)---

   END IF
      
  #LET l_xrcc108 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,l_xrcc108,2)                                               #150812-00010#2 mark
   CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce100,l_xrcc108,2) RETURNING g_sub_success,g_errno,l_xrcc108    #150812-00010#2    
  #LET l_xrcc118 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,l_xrcc118,2)                                               #150812-00010#2 mark 
   CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,l_xrcc118,2) RETURNING g_sub_success,g_errno,l_xrcc118           #150812-00010#2 
   
      
   #20150529--mark--str--lujh   
   #SELECT SUM(xrce109),SUM(xrce119) INTO l_xrce109,l_xrce119 FROM xrce_t
   # WHERE xrceent = g_enterprise
   #   AND xrcedocno = g_xrda_m.xrdadocno
   #   AND xrccld = g_xrda_m.xrdald
   #   AND xrceseq <> g_xrde4_d[l_ac].xrceseq
   #   AND xrce003 = g_xrde4_d[l_ac].xrce003
   #   AND xrce004 = g_xrde4_d[l_ac].xrce004
   #   AND xrce005 = g_xrde4_d[l_ac].xrce005
   #20150529--mark--end--lujh
   
   #20150529--add--str--lujh
   SELECT SUM(xrce109),SUM(xrce119) INTO l_xrce109,l_xrce119 FROM xrce_t,xrda_t
    WHERE xrceent = g_enterprise
      AND xrceent = xrdaent
      AND xrceld = xrdald
      AND xrcedocno = xrdadocno
      AND xrceld = g_xrda_m.xrdald
      AND xrce003 = g_xrde4_d[l_ac].xrce003
      AND xrce004 = g_xrde4_d[l_ac].xrce004
      AND xrce005 = g_xrde4_d[l_ac].xrce005
      AND ((xrcedocno = g_xrda_m.xrdadocno
      AND xrceseq <> g_xrde4_d[l_ac].xrceseq)
      OR xrcedocno <> g_xrda_m.xrdadocno)
      AND xrdastus = 'N'
   #20150529--add--end--lujh
   
   #20150924--add--str--lujh
   SELECT SUM(xrce109),SUM(xrce119) INTO l_xrce109_1,l_xrce119_1 FROM xrce_t,xrca_t
    WHERE xrceent = g_enterprise
      AND xrceent = xrcaent
      AND xrceld = xrcald
      AND xrcedocno = xrcadocno
      AND xrceld = g_xrda_m.xrdald
      AND xrce003 = g_xrde4_d[l_ac].xrce003
      AND xrce004 = g_xrde4_d[l_ac].xrce004
      AND xrce005 = g_xrde4_d[l_ac].xrce005
      AND xrcastus = 'N' 
      
   IF cl_null(l_xrce109_1) THEN LET l_xrce109_1 = 0 END IF
   IF cl_null(l_xrce119_1) THEN LET l_xrce119_1 = 0 END IF 
   #20150924--add--end--lujh
   
   #151105-00008#6--add--str--lujh
   #抓取axrt460已存在未审核的单子
   LET l_xrfc103 = 0   LET l_xrfc104 = 0
   SELECT SUM(xrfc103),SUM(xrfc104) INTO l_xrfc103,l_xrfc104 FROM xrfa_t,xrfc_t
    WHERE xrfaent   = g_enterprise
      AND xrfadocno = xrfcdocno
      AND xrfald    = g_xrda_m.xrdald
      AND xrfc003   = g_xrde4_d[l_ac].xrce003
      AND xrfc004   = g_xrde4_d[l_ac].xrce004
      AND xrfc005   = g_xrde4_d[l_ac].xrce005
      AND xrfastus  = 'N'
   IF cl_null(l_xrfc103) THEN LET l_xrfc103 = 0 END IF
   IF cl_null(l_xrfc104) THEN LET l_xrfc104 = 0 END IF
   #151105-00008#6--add--end--lujh

   IF cl_null(l_xrcc108) THEN LET l_xrcc108 = 0 END IF
   IF cl_null(l_xrcc118) THEN LET l_xrcc118 = 0 END IF
   IF cl_null(l_xrce109) THEN LET l_xrce109 = 0 END IF
   IF cl_null(l_xrce119) THEN LET l_xrce119 = 0 END IF
   IF (l_xrcc108 = 0 OR l_xrcc118 = 0) OR (l_xrcc108 - l_xrce109 -  l_xrce109_1 - l_xrfc103 < g_xrde4_d[l_ac].xrce109 OR l_xrcc118 - l_xrce119 - l_xrce119_1 - l_xrfc104 < g_xrde4_d[l_ac].xrce119) THEN  #20150924 add l_xrce109_1,l_xrce119_1 lujh   #151105-00008#6 add l_xrfc103,l_xrfc104 lujh
      LET g_errno = 'axr-00054'
   END IF
END FUNCTION
# 根據類型、款別檢查來源單號+項次
PRIVATE FUNCTION axrt400_chk_xrde003()
   DEFINE l_SQLCODE      LIKE type_t.chr20
   DEFINE l_stus         LIKE nmba_t.nmbastus
   DEFINE l_errno1       LIKE gzze_t.gzze001
   DEFINE l_errno2       LIKE gzze_t.gzze001
   DEFINE l_errno3       LIKE gzze_t.gzze001
   DEFINE l_errno4       LIKE gzze_t.gzze001
   DEFINE l_errno5       LIKE gzze_t.gzze001
   DEFINE l_count        LIKE type_t.num5
   DEFINE l_ld_s         LIKE type_t.num5      #帳套   1:主帳套;2:次帳套一;3:次帳套二
   DEFINE l_tot1         LIKE nmbb_t.nmbb006   #原幣金額
   DEFINE l_tot2         LIKE nmbb_t.nmbb007   #本幣金額
   DEFINE l_amt1         LIKE nmbb_t.nmbb008   #已沖原幣金額  主帳套
   DEFINE l_amt2         LIKE nmbb_t.nmbb009   #已沖本幣金額  主帳套
   DEFINE l_amt3         LIKE nmbb_t.nmbb020   #已沖原幣金額  次帳套一
   DEFINE l_amt4         LIKE nmbb_t.nmbb021   #已沖本幣金額  次帳套一
   DEFINE l_amt5         LIKE nmbb_t.nmbb023   #已沖原幣金額  次帳套二
   DEFINE l_amt6         LIKE nmbb_t.nmbb024   #已沖本幣金額  次帳套二
   DEFINE l_nmcnstus     LIKE nmcn_t.nmcnstus
   DEFINE l_nmba004      LIKE nmba_t.nmba004
   DEFINE l_nmba009      LIKE nmba_t.nmba009
   DEFINE l_pmaa069      LIKE pmaa_t.pmaa069
   DEFINE l_pmaa006      LIKE pmaa_t.pmaa006
   DEFINE l_pmaa006_1    LIKE pmaa_t.pmaa006
   DEFINE l_flag         LIKE type_t.chr2
   DEFINE l_cnt          LIKE type_t.num5
   DEFINE l_nmbb029      LIKE nmbb_t.nmbb029
   DEFINE l_pmaa004      LIKE pmaa_t.pmaa004   #160802-00007#1 Add

   #檢查是否是主帳套
   LET l_count = 0
   SELECT COUNT(*) INTO l_count FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald  = g_xrda_m.xrdald
      AND glaa014 = 'Y'
   IF l_count > 0 THEN
     LET l_ld_s = 1
   ELSE
      #次帳套一
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
       WHERE ooab001 = 'S-FIN-0001' AND ooab002 = g_xrda_m.xrdald 
         AND ooabsite= g_xrda_m.xrdasite
         AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 2
      END IF
      #次帳套二
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
       WHERE ooab001 = 'S-FIN-0002' AND ooab002 = g_xrda_m.xrdald
         AND ooabsite= g_xrda_m.xrdasite
         AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 3
      END IF
   END IF
   
   LET g_errno = ' '
   IF g_xrde_d[l_ac].xrde002 = '10' THEN
     #160607-00015#3 Add  ---(S)---
      IF NOT cl_null(g_xrde_d[l_ac].xrde003) AND NOT cl_null(g_xrde_d[l_ac].xrde004) THEN
         LET l_count = 0
         SELECT COUNT(1) INTO l_count FROM isba_t,isbb_t WHERE isbaent = isbbent AND isbadocno = isbbdocno 
            AND isbacomp = isbbcomp AND isbbent = g_enterprise AND isbastus <> 'X' 
            AND isbb002 = g_xrde_d[l_ac].xrde003
            AND isbb003 = g_xrde_d[l_ac].xrde004
         IF cl_null(l_count) THEN LET l_count = 0 END IF
         IF l_count > 0 THEN
            LET g_errno = 'axr-00366'
            RETURN
         END IF
         #160802-00007#1 Add  ---(S)---
         SELECT pmaa004 INTO l_pmaa004 FROM pmaa_t WHERE pmaaent = g_enterprise AND pmaa001 = g_xrda_m.xrda005
         IF l_pmaa004 = '2' THEN
            LET l_count = 0 
            SELECT COUNT(1) INTO l_count FROM nmba_t WHERE nmbaent = g_enterprise AND nmbadocno = g_xrde_d[l_ac].xrde003
               AND nmba005 = g_xrda_m.xrda006
            IF cl_null(l_count) THEN LET l_count = 0 END IF
            IF l_count = 0 THEN
		       LET g_errno = 'axr-00379'   RETURN
            END IF
         END IF
         #160802-00007#1 Add  ---(E)---
      END IF
     #160607-00015#3 Add  ---(E)---
      CASE
         #WHEN g_xrde_d[l_ac].xrde006 = '10' OR  g_xrde_d[l_ac].xrde006 = '20' OR  g_xrde_d[l_ac].xrde006 = '30'   #現金類型 OR #銀行電匯款  #20150515 mark lujh
         WHEN g_xrde_d[l_ac].xrde006 MATCHES '[123456]0'   #20150515 add lujh
            #檢查資料1:存在性、有效性;2.已確認;3.可沖金額大於0
            SELECT nmbastus,nmba004,nmba009 INTO l_stus,l_nmba004,l_nmba009 FROM nmba_t
             WHERE nmbaent  = g_enterprise
               AND nmbadocno= g_xrde_d[l_ac].xrde003
            LET l_SQLCODE = SQLCA.SQLCODE
            IF NOT SQLCA.SQLCODE AND NOT cl_null(g_xrde_d[l_ac].xrde004) THEN
               SELECT nmbb006,nmbb007,nmbb008,nmbb009,nmbb020,nmbb021,nmbb023,nmbb024
                 INTO l_tot1,l_tot2,l_amt1,l_amt2,l_amt3,l_amt4,l_amt5,l_amt6
                 FROM nmbb_t
                WHERE nmbbent  = g_enterprise
                  AND nmbbdocno= g_xrde_d[l_ac].xrde003
                  AND nmbbseq  = g_xrde_d[l_ac].xrde004
               IF SQLCA.SQLCODE = 100 THEN LET l_SQLCODE = SQLCA.SQLCODE END IF
            END IF
            #對象合理性判斷
            SELECT nmbb026,nmbb029 INTO l_nmba004,l_nmbb029 FROM nmbb_t WHERE nmbbent  = g_enterprise
               AND nmbbdocno= g_xrde_d[l_ac].xrde003
               AND nmbbseq  = g_xrde_d[l_ac].xrde004
                    
            IF l_nmba004 <> g_xrda_m.xrda005 THEN
               SELECT pmaa069 INTO l_pmaa069 FROM pmaa_t
                WHERE pmaaent = g_enterprise
                  AND pmaa001 = l_nmba004
               IF l_pmaa069 = 'N' OR cl_null(l_pmaa069) THEN
                  LET l_errno5 = 'axr-00070'   #該交易單據非帳款核銷客戶!
               ELSE
                  #收款客戶、核銷客戶是否屬於同一集團
                  SELECT pmaa006 INTO l_pmaa006   FROM pmaa_t WHERE pmaaent = g_enterprise
                     AND pmaa001 = g_xrda_m.xrda005
                  SELECT pmaa006 INTO l_pmaa006_1 FROM pmaa_t WHERE pmaaent = g_enterprise
                     AND pmaa001 = g_xrda_m.xrda004
                  IF NOT cl_null(l_pmaa006_1) AND NOT cl_null(l_pmaa006) AND l_pmaa006_1 != l_pmaa006 THEN LET l_flag = 'N' END IF
                  IF (cl_null(l_pmaa006_1) AND NOT cl_null(l_pmaa006)) OR (NOT cl_null(l_pmaa006_1) AND cl_null(l_pmaa006)) THEN LET l_flag = 'N' END IF
            
                  #檢核夥伙關係(pmac_t)中,有無設定
                  LET l_cnt = 0
                  SELECT COUNT(*) INTO l_cnt FROM pmac_t WHERE pmacent = g_enterprise AND pmac001 = g_xrda_m.xrda005
                     AND pmacstus = 'Y' AND pmac003 = '1' AND pmac002 = g_xrda_m.xrda004
                  IF l_cnt < 1 THEN LET l_flag = l_flag,'N' END IF
            
                  IF l_flag = 'NN' THEN
                     LET l_errno5 = 'agl-00153'
                  ELSE
                     LET l_errno5 = 'agl-00154'
                  END IF
               END IF
            END IF
           #LET l_errno1 = 'axr-00051'     #160413-00037#1 Mark
            LET l_errno1 = 'sub-01310'     #160413-00037#1 Mark
#            LET l_errno2 = 'axr-00052'    #160318-00005#54  mark
            LET l_errno2 = 'sub-01302'    #160318-00005#54  add
#            LET l_errno3 = 'axr-00053'   #160318-00005#54  mark
            LET l_errno3 = 'ain-00265'    #160318-00005#54  add
            LET l_errno4 = 'axr-00054'

         #WHEN g_xrde_d[l_ac].xrde006 = '30'    #票據類型
         #   #檢查資料1:存在性、有效性;2.已確認;3.可沖金額大於0
         #   SELECT nmcnstus INTO l_nmcnstus FROM nmcn_t
         #    WHERE nmcnent  = g_enterprise
         #      AND nmcndocno= g_xrde_d[l_ac].xrde003
         #   LET l_SQLCODE = SQLCA.SQLCODE
         #   IF NOT SQLCA.SQLCODE THEN
         #      SELECT nmcn011,nmcn013,nmcn028,nmcn029,nmcn039,nmcn040,nmcn042,nmcn043
         #        INTO l_tot1,l_tot2,l_amt1,l_amt2,l_amt3,l_amt4,l_amt5,l_amt6
         #        FROM nmcn_t
         #       WHERE nmcnent  = g_enterprise
         #         AND nmcndocno= g_xrde_d[l_ac].xrde003
         #   END IF
         #   LET l_errno1 = 'axr-00055'
         #   LET l_errno2 = 'axr-00056'
         #   LET l_errno3 = 'axr-00057'
         #   LET l_errno4 = 'axr-00058'
      END CASE
      IF l_ld_s = 1 THEN
         LET l_tot1 = l_tot1 - l_amt1
         LET l_tot2 = l_tot2 - l_amt2
      ELSE
         IF l_ld_s = 2 THEN
           LET l_tot1 = l_tot1 - l_amt3
           LET l_tot2 = l_tot2 - l_amt4
         ELSE
           LET l_tot1 = l_tot1 - l_amt5
           LET l_tot2 = l_tot2 - l_amt6
         END IF
      END IF
      CASE
         WHEN l_SQLCODE = '100'
            LET g_errno = l_errno1 RETURN
         WHEN l_stus = 'X'
            LET g_errno = l_errno2 RETURN
         #WHEN l_stus = 'N'
         #   LET g_errno = l_errno3 RETURN
         WHEN l_nmba009 = ''
             LET g_errno = l_errno3 RETURN
         WHEN l_tot1 = 0 OR l_tot2 = 0
            LET g_errno = l_errno4 RETURN
      END CASE
      IF g_xrde_d[l_ac].xrde002 = '10' THEN
         CASE
            #WHEN g_xrde_d[l_ac].xrde006 = '10' OR  g_xrde_d[l_ac].xrde006 = '20' OR  g_xrde_d[l_ac].xrde006 = '30'   #現金類型 OR #銀行電匯款   #20150515 mark lujh
            WHEN g_xrde_d[l_ac].xrde006 MATCHES '[123456]0'   #20150515 add lujh
               IF NOT cl_null(g_xrde_d[l_ac].xrde003) AND NOT cl_null(g_xrde_d[l_ac].xrde004) THEN 
                  IF l_nmbb029 <> g_xrde_d[l_ac].xrde006 OR cl_null(l_nmbb029) THEN   
                     LET g_errno = 'axr-00274'
                  END IF
               END IF
          END CASE
      END IF
      IF cl_null(g_errno) AND NOT cl_null(l_errno5) THEN
         LET g_errno = l_errno5
      END IF
   END IF
END FUNCTION
# 根據單號、項次抓取銀存收支明細檔默認資料
PRIVATE FUNCTION axrt400_def_nmbb(p_xrde003,p_xrde004)
   DEFINE p_xrde003      LIKE xrde_t.xrde003
   DEFINE p_xrde004      LIKE xrde_t.xrde004
   DEFINE l_nmbb_t       RECORD LIKE nmbb_t.*
   DEFINE l_gzcb003      LIKE gzcb_t.gzcb003
   DEFINE l_ld_s         LIKE type_t.num5
   DEFINE l_count        LIKE type_t.num5
   DEFINE l_xrde109      LIKE xrde_t.xrde109
   DEFINE l_xrde119      LIKE xrde_t.xrde119
   DEFINE l_xrde129      LIKE xrde_t.xrde129
   DEFINE l_xrde139      LIKE xrde_t.xrde139
   #151105-00008#6--add--str--lujh
   DEFINE l_xrfb103      LIKE xrfb_t.xrfb103
   DEFINE l_xrfb104      LIKE xrfb_t.xrfb104
   #151105-00008#6--add--end--lujh
   
   #檢查是否是主帳套
   LET l_count = 0
   SELECT COUNT(*) INTO l_count FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald  = g_xrda_m.xrdald
      AND glaa014 = 'Y'
   IF l_count > 0 THEN
     LET l_ld_s = 1
   ELSE
      #次帳套一
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
       WHERE ooab001 = 'S-FIN-0001' AND ooab002 = g_xrda_m.xrdald 
         AND ooabsite= g_xrda_m.xrdasite
         AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 2
      END IF
      #次帳套二
      LET l_count = 0
      SELECT COUNT(*) INTO l_count FROM ooab_t
       WHERE ooab001 = 'S-FIN-0002' AND ooab002 = g_xrda_m.xrdald
         AND ooabsite= g_xrda_m.xrdasite
         AND ooabent = g_enterprise #160905-00002#5
      IF l_count > 0 THEN
         LET l_ld_s = 3
      END IF
   END IF
   
   SELECT SUM(xrde109),SUM(xrde119),SUM(xrde129),SUM(xrde139)
     INTO l_xrde109,l_xrde119,l_xrde129,l_xrde139
     FROM xrde_t,xrda_t
    WHERE xrdeent = g_enterprise
      AND xrdeent = xrdaent
      AND xrdedocno = xrdadocno
      AND xrdeld = xrdald
      AND xrdastus = 'N'
      AND xrde003 = p_xrde003
      AND xrde004 = p_xrde004
      #AND xrdedocno <> g_xrda_m.xrdadocno   #20150702 mark lujh
   IF cl_null(l_xrde109) THEN LET l_xrde109 = 0 END IF
   IF cl_null(l_xrde119) THEN LET l_xrde119 = 0 END IF
   IF cl_null(l_xrde129) THEN LET l_xrde129 = 0 END IF
   IF cl_null(l_xrde139) THEN LET l_xrde139 = 0 END IF
   
   #151105-00008#6--add--str--lujh
   LET l_xrfb103 = 0 LET l_xrfb104 = 0
   SELECT SUM(xrfb103),SUM(xrfb104)
     INTO l_xrfb103,l_xrfb104
     FROM xrfb_t,xrfa_t
    WHERE xrfaent = g_enterprise
      AND xrfaent = xrfbent
      AND xrfadocno = xrfbdocno
      AND xrfald = xrfbld
      AND xrfastus = 'N'
      AND xrfb002 = p_xrde003
      AND xrfb003 = p_xrde004
   IF cl_null(l_xrfb103) THEN LET l_xrfb103 = 0 END IF
   IF cl_null(l_xrfb104) THEN LET l_xrfb104 = 0 END IF
   #151105-00008#6--add--end--lujh
   
   SELECT * INTO l_nmbb_t.* FROM nmbb_t
    WHERE nmbbent = g_enterprise
      AND nmbbdocno = p_xrde003
      AND nmbbseq = p_xrde004

   SELECT gzcb003 INTO l_gzcb003 FROM gzcb_t
    WHERE gzcb001 = '8306'
      AND gzcb002 = '10'

   LET g_xrde_d[l_ac].xrdecomp  = g_xrda_m.xrdacomp
   LET g_xrde_d[l_ac].xrdeseq   = g_xrde_d[l_ac].xrdeseq
   LET g_xrde_d[l_ac].xrdesite  = g_xrda_m.xrdasite
   LET g_xrde_d[l_ac].xrdeorga  = g_xrda_m.xrdacomp
   LET g_xrde_d[l_ac].xrde001   = 'axrt400'
   LET g_xrde_d[l_ac].xrde002   = '10'
   LET g_xrde_d[l_ac].xrde003   = l_nmbb_t.nmbbdocno
   LET g_xrde_d[l_ac].xrde004   = l_nmbb_t.nmbbseq
   LET g_xrde_d[l_ac].xrde006   = g_xrde_d[l_ac].xrde006
   LET g_xrde_d[l_ac].xrde008   = l_nmbb_t.nmbb003
   LET g_xrde_d[l_ac].xrde011   = l_nmbb_t.nmbb002
   LET g_xrde_d[l_ac].xrde012   = l_nmbb_t.nmbb010
   LET g_xrde_d[l_ac].xrde013   = ''
   LET g_xrde_d[l_ac].xrde014   = ''
   IF l_gzcb003 = 'D'THEN
      LET g_xrde_d[l_ac].xrde015   = 'D'
   ELSE
      LET g_xrde_d[l_ac].xrde015   = 'C'
   END IF
   
   #抓取科目
   IF g_xrde_d[l_ac].xrde006 = '10' OR g_xrde_d[l_ac].xrde006 = '20' THEN 
      #借方科目: 依 anmi121  設定 
      SELECT DISTINCT glab005 INTO g_xrde_d[l_ac].xrde016
        FROM glab_t
       WHERE glabent = g_enterprise 
         AND glabld  = g_xrda_m.xrdald
         AND glab001 = '40'
         AND glab002 = '40'     
         AND glab003 = l_nmbb_t.nmbb003  #交易帳戶編號
   END IF
   
   #20150515--mark-str--lujh
   #IF g_xrde_d[l_ac].xrde006 = '30' THEN 
   #   #借方科目: 依 agli191 設定 
   #   SELECT DISTINCT glab005 INTO g_xrde_d[l_ac].xrde016
   #     FROM glab_t
   #    WHERE glabent = g_enterprise 
   #      AND glabld  = g_xrda_m.xrdald
   #      AND glab001 = '42'
   #      AND glab002 = l_nmbb_t.nmbb029   
   #      AND glab003 = l_nmbb_t.nmbb028
   #END IF
   #20150515--mark-end--lujh
   
   #20150515--add-str--lujh
   #依agli190设定
   IF g_xrde_d[l_ac].xrde006 MATCHES '[3456]0' THEN 
      SELECT DISTINCT glab005 INTO g_xrde_d[l_ac].xrde016
        FROM glab_t
       WHERE glabent = g_enterprise 
         AND glabld  = g_xrda_m.xrdald
         AND glab001 = '21'
         AND glab002 = g_xrde_d[l_ac].xrde006     
         AND glab003 = l_nmbb_t.nmbb028 
   END IF
   #20150515--add-end--lujh

   LET g_xrde_d[l_ac].xrde100   = l_nmbb_t.nmbb004
   LET g_xrde_d[l_ac].xrde101   = l_nmbb_t.nmbb005
   LET g_xrde2_d[l_ac].xrde120   = l_nmbb_t.nmbb011
   LET g_xrde2_d[l_ac].xrde121   = l_nmbb_t.nmbb012
   LET g_xrde2_d[l_ac].xrde129   = l_nmbb_t.nmbb013 - l_nmbb_t.nmbb014
   LET g_xrde2_d[l_ac].xrde130   = l_nmbb_t.nmbb015
   LET g_xrde2_d[l_ac].xrde131   = l_nmbb_t.nmbb016
   LET g_xrde2_d[l_ac].xrde139   = l_nmbb_t.nmbb017 - l_nmbb_t.nmbb018

   CASE
      WHEN l_ld_s = 1
         LET g_xrde_d[l_ac].xrde109 = l_nmbb_t.nmbb006 - l_nmbb_t.nmbb008
         LET g_xrde_d[l_ac].xrde119 = l_nmbb_t.nmbb007 - l_nmbb_t.nmbb009
      WHEN l_ld_s = 2
         LET g_xrde_d[l_ac].xrde109 = l_nmbb_t.nmbb006 - l_nmbb_t.nmbb020
         LET g_xrde_d[l_ac].xrde119 = l_nmbb_t.nmbb007 - l_nmbb_t.nmbb021
      WHEN l_ld_s = 3
         LET g_xrde_d[l_ac].xrde109 = l_nmbb_t.nmbb006 - l_nmbb_t.nmbb023
         LET g_xrde_d[l_ac].xrde119 = l_nmbb_t.nmbb007 - l_nmbb_t.nmbb024
   END CASE
 
   LET g_xrde_d[l_ac].xrde109 = g_xrde_d[l_ac].xrde109 - l_xrde109 - l_xrfb103   #151105-00008#6 add l_xrfb103 lujh
   LET g_xrde_d[l_ac].xrde119 = g_xrde_d[l_ac].xrde119 - l_xrde119 - l_xrfb104   #151105-00008#6 add l_xrfb104 lujh
   LET g_xrde2_d[l_ac].xrde129 = g_xrde2_d[l_ac].xrde129 - l_xrde129
   LET g_xrde2_d[l_ac].xrde139 = g_xrde2_d[l_ac].xrde139 - l_xrde139
   
   #160111-00020#5--add--str--lujh
   IF g_xrda_m.xrda004 = 'EMPL' THEN 
      SELECT nmbb027 INTO g_xrde3_d[l_ac].xrde017
        FROM nmbb_t
       WHERE nmbbent = g_enterprise
         AND nmbbcomp = g_xrda_m.xrdacomp
         AND nmbbdocno = g_xrde_d[l_ac].xrde003
         AND nmbbseq = g_xrde_d[l_ac].xrde004
   END IF
   #160111-00020#5--add--end--lujh

   #160114-00019#2 Add  ---(S)---
    SELECT nmbadocdt INTO g_xrde_d[l_ac].xrde032 FROM nmba_t WHERE nmbaent = g_enterprise 
       AND nmbacomp = g_xrda_m.xrdacomp
       AND nmbadocno = g_xrde_d[l_ac].xrde003

    DISPLAY g_xrde_d[l_ac].xrde032 TO s_detail1[l_ac].xrde032

   #160114-00019#2 Add  ---(E)---

   DISPLAY g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde100,g_xrde_d[l_ac].xrde101,g_xrde_d[l_ac].xrde109,
           g_xrde_d[l_ac].xrde119,g_xrde_d[l_ac].xrde013,g_xrde_d[l_ac].xrde014,g_xrde3_d[l_ac].xrde017       #160111-00020#5 add xrde017 lujh
        TO s_detail1[l_ac].xrde008,s_detail1[l_ac].xrde100,s_detail1[l_ac].xrde101,s_detail1[l_ac].xrde109,
           s_detail1[l_ac].xrde119,s_detail1[l_ac].xrde013,s_detail1[l_ac].xrde014,s_detail3[l_ac].xrde017   #160111-00020#5 add xrde017 lujh
   #160122-00001#5 --add --str
   #判断当前用户是否有权限查看该交易账户，如果没有权限不可看到交易账户编号，用“*”显示
   CALL axrt400_get_l_xrde008(g_xrde_d[l_ac].xrde008,g_xrde_d[l_ac].xrde006) RETURNING g_xrde_d[l_ac].l_xrde008 
   DISPLAY g_xrde_d[l_ac].xrde008 TO s_detail1[l_ac].l_xrde008
   #160122-00001#5 --add --end        

   LET g_xrde_t.xrdeent = g_enterprise
   LET g_xrde_t.xrdecomp = g_xrde_d[l_ac].xrdecomp
   LET g_xrde_t.xrdedocno = g_xrda_m.xrdadocno
   LET g_xrde_t.xrdeseq = g_xrde_d[l_ac].xrdeseq
   LET g_xrde_t.xrdeld = g_xrda_m.xrdald
   LET g_xrde_t.xrdesite = g_xrde_d[l_ac].xrdesite
   LET g_xrde_t.xrdeorga = g_xrde_d[l_ac].xrdeorga
   LET g_xrde_t.xrde001 = 'axrt400'
   LET g_xrde_t.xrde002 = g_xrde_d[l_ac].xrde002
   LET g_xrde_t.xrde003 = g_xrde_d[l_ac].xrde003
   LET g_xrde_t.xrde004 = g_xrde_d[l_ac].xrde004
   LET g_xrde_t.xrde006 = g_xrde_d[l_ac].xrde006
   LET g_xrde_t.xrde008 = g_xrde_d[l_ac].xrde008

   LET g_xrde_t.xrde010 = g_xrde_d[l_ac].xrde010
   LET g_xrde_t.xrde011 = g_xrde_d[l_ac].xrde011
   LET g_xrde_t.xrde012 = g_xrde_d[l_ac].xrde012
   LET g_xrde_t.xrde013 = g_xrde_d[l_ac].xrde013
   LET g_xrde_t.xrde014 = g_xrde_d[l_ac].xrde014
   LET g_xrde_t.xrde015 = g_xrde_d[l_ac].xrde015
   LET g_xrde_t.xrde016 = g_xrde_d[l_ac].xrde016
   LET g_xrde_t.xrde100 = g_xrde_d[l_ac].xrde100
   LET g_xrde_t.xrde101 = g_xrde_d[l_ac].xrde101
   LET g_xrde_t.xrde109 = g_xrde_d[l_ac].xrde109
   LET g_xrde_t.xrde119 = g_xrde_d[l_ac].xrde119
   LET g_xrde_t.xrde120 = g_xrde2_d[l_ac].xrde120
   LET g_xrde_t.xrde121 = g_xrde2_d[l_ac].xrde121
   LET g_xrde_t.xrde129 = g_xrde2_d[l_ac].xrde129
   LET g_xrde_t.xrde130 = g_xrde2_d[l_ac].xrde130
   LET g_xrde_t.xrde131 = g_xrde2_d[l_ac].xrde131
   LET g_xrde_t.xrde139 = g_xrde2_d[l_ac].xrde139
END FUNCTION
# 账款单身单号检查
PRIVATE FUNCTION axrt400_chk_xrce003()
   DEFINE l_ooab002      LIKE ooab_t.ooab002
   DEFINE l_count        LIKE type_t.num5
   DEFINE l_xrcc108      LIKE xrcc_t.xrcc108
   DEFINE l_xrcc118      LIKE xrcc_t.xrcc118
   DEFINE l_xrcc128      LIKE xrcc_t.xrcc128
   DEFINE l_xrcc138      LIKE xrcc_t.xrcc138
   DEFINE l_apcc108      LIKE apcc_t.apcc108
   DEFINE l_apcc118      LIKE apcc_t.apcc118
   DEFINE l_apcc128      LIKE apcc_t.apcc128
   DEFINE l_apcc138      LIKE apcc_t.apcc138
   DEFINE l_pmaa004      LIKE pmaa_t.pmaa004   #160802-00007#1 Add

   LET l_ooab002 = ''
   LET g_errno = ''
   SELECT ooab002 INTO l_ooab002 FROM ooab_t
    WHERE ooabent = g_enterprise
      AND ooab001 = 'S-FIN-1002'
      AND ooabsite= g_xrda_m.xrdasite
      
   IF cl_null(g_xrde4_d[l_ac].xrce004) THEN RETURN END IF
   
   IF cl_null(g_xrde4_d[l_ac].xrce005) THEN RETURN END IF

   IF g_xrde4_d[l_ac].xrce002 = '30' OR g_xrde4_d[l_ac].xrce002 = '31' OR g_xrde4_d[l_ac].xrce002 = '32' THEN
     #160607-00015#3 Add  ---(S)---
      IF NOT cl_null(g_xrde4_d[l_ac].xrce003) AND NOT cl_null(g_xrde4_d[l_ac].xrce005) THEN
         LET l_count = 0
         SELECT COUNT(1) INTO l_count FROM isba_t,isbc_t WHERE isbaent = isbcent AND isbadocno = isbcdocno 
            AND isbacomp = isbccomp AND isbcent = g_enterprise AND isbastus <> 'X'
            AND isbc007 = g_xrde4_d[l_ac].xrce003
            AND isbc008 = g_xrde4_d[l_ac].xrce005
         IF cl_null(l_count) THEN LET l_count = 0 END IF
         IF l_count > 0 THEN
            LET g_errno = 'axr-00366'
            RETURN
         END IF
      END IF
      LET l_count = 0
     #160607-00015#3 Add  ---(E)---
      #檢查資料1:存在性;2.可沖金額大於0
      SELECT COUNT(*) INTO l_count FROM xrca_t,xrcc_t
       WHERE xrcaent = g_enterprise
         AND xrcaent = xrccent
         AND xrcadocno = xrccdocno
         AND xrcald = xrccld
         AND xrccld = g_xrda_m.xrdald
         AND xrccdocno = g_xrde4_d[l_ac].xrce003
         AND xrccseq = g_xrde4_d[l_ac].xrce004
         AND xrcc001 = g_xrde4_d[l_ac].xrce005
      SELECT SUM(xrcc108 - xrcc109),SUM(xrcc118 - xrcc119 + xrcc113),SUM(xrcc128 - xrcc129 + xrcc123),SUM(xrcc138 - xrcc139 + xrcc133) 
        INTO l_xrcc108,l_xrcc118,l_xrcc128,l_xrcc138
        FROM xrcc_t
       WHERE xrccent = g_enterprise
         AND xrccld = g_xrda_m.xrdald
         AND xrccdocno = g_xrde4_d[l_ac].xrce003
         AND xrccseq = g_xrde4_d[l_ac].xrce004
         AND xrcc001 = g_xrde4_d[l_ac].xrce005

      IF cl_null(l_xrcc108) THEN LET l_xrcc108 = 0 END IF
      IF cl_null(l_xrcc118) THEN LET l_xrcc118 = 0 END IF
      IF cl_null(l_xrcc128) THEN LET l_xrcc128 = 0 END IF
      IF cl_null(l_xrcc138) THEN LET l_xrcc138 = 0 END IF
      CASE
         WHEN l_count = 0
         LET g_errno = 'axr-00067'   RETURN
         WHEN l_xrcc108 = 0 OR l_xrcc118 = 0
         LET g_errno = 'axr-00058'   RETURN
      END CASE
      #160802-00007#1 Add  ---(S)---
      SELECT pmaa004 INTO l_pmaa004 FROM pmaa_t WHERE pmaaent = g_enterprise AND pmaa001 = g_xrda_m.xrda005
      IF l_pmaa004 = '2' THEN
         LET l_count = 0 
         SELECT COUNT(1) INTO l_count FROM xrca_t WHERE xrcaent = g_enterprise AND xrcadocno = g_xrde4_d[l_ac].xrce003
            AND xrca057 = g_xrda_m.xrda006
         IF cl_null(l_count) THEN LET l_count = 0 END IF
         IF l_count = 0 THEN
		    LET g_errno = 'axr-00379'   RETURN
         END IF
      END IF
      #160802-00007#1 Add  ---(E)---
   END IF

   IF g_xrde4_d[l_ac].xrce002 = '40' OR g_xrde4_d[l_ac].xrce002 = '41' OR g_xrde4_d[l_ac].xrce002 = '42' THEN       
      #檢查資料1:存在性;2.可沖金額大於0
      SELECT COUNT(*) INTO l_count FROM apca_t,apcc_t
       WHERE apcaent = g_enterprise
         AND apcaent = apccent
         AND apcadocno = apccdocno
         AND apcald = apccld
         AND apccld = g_xrda_m.xrdald
         AND apccdocno = g_xrde4_d[l_ac].xrce003
         AND apccseq = g_xrde4_d[l_ac].xrce004
         AND apcc001 = g_xrde4_d[l_ac].xrce005
      SELECT SUM(apcc108 - apcc109),SUM(apcc118 - apcc119 + apcc113),SUM(apcc128 - apcc129 + apcc123),SUM(apcc138 - apcc139 + apcc133) 
        INTO l_apcc108,l_apcc118,l_apcc128,l_apcc138
        FROM apcc_t
       WHERE apccent = g_enterprise
         AND apccld = g_xrda_m.xrdald
         AND apccdocno = g_xrde4_d[l_ac].xrce003
         AND apccseq = g_xrde4_d[l_ac].xrce004
         AND apcc001 = g_xrde4_d[l_ac].xrce005

      IF cl_null(l_apcc108) THEN LET l_apcc108 = 0 END IF
      IF cl_null(l_apcc118) THEN LET l_apcc118 = 0 END IF
      IF cl_null(l_apcc128) THEN LET l_apcc128 = 0 END IF
      IF cl_null(l_apcc138) THEN LET l_apcc138 = 0 END IF
      CASE
         WHEN l_count = 0
         LET g_errno = 'axr-00333'   RETURN
         WHEN l_apcc108 = 0 OR l_apcc118 = 0
         LET g_errno = 'axr-00058'   RETURN
      END CASE
      #160802-00007#1 Add  ---(S)---
      SELECT pmaa004 INTO l_pmaa004 FROM pmaa_t WHERE pmaaent = g_enterprise AND pmaa001 = g_apca_m.apca004
      IF l_pmaa004 = '2' THEN
         LET l_count = 0 
         SELECT COUNT(1) INTO l_count FROM apca_t WHERE apcaent = g_enterprise AND apcadocno = g_xrde4_d[l_ac].xrce003
            AND apca057 = g_xrda_m.xrda006
         IF cl_null(l_count) THEN LET l_count = 0 END IF
         IF l_count = 0 THEN
		    LET g_errno = 'axr-00379'   RETURN
         END IF
      END IF
      #160802-00007#1 Add  ---(E)---
   END IF
   #150820-00015#3--s
   CALL s_aapt420_exist_chk(g_xrde4_d[l_ac].xrce002,g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce003,g_xrde4_d[l_ac].xrce004,g_xrde4_d[l_ac].xrce005,g_xrda_m.xrda004,'')   #151130-00015#4 #albireo 151006 modify
    RETURNING g_sub_success,g_errno RETURN
   #150820-00015#3--e
END FUNCTION
# 根據單號、項次、帳期抓取多帳期明細默認資料
PRIVATE FUNCTION axrt400_def_xrcc(p_xrce003,p_xrce004,p_xrce005)
   DEFINE l_xrcc_t       RECORD LIKE xrcc_t.* 
   DEFINE l_xrca_t       RECORD LIKE xrca_t.*
   DEFINE l_apcc_t       RECORD LIKE apcc_t.* 
   DEFINE l_apca_t       RECORD LIKE apca_t.*
   DEFINE p_xrce003      LIKE xrce_t.xrce003
   DEFINE p_xrce004      LIKE xrce_t.xrce004
   DEFINE p_xrce005      LIKE xrce_t.xrce005
   DEFINE l_xrce109      LIKE xrce_t.xrce109
   DEFINE l_xrce119      LIKE xrce_t.xrce119
   DEFINE l_xrce129      LIKE xrce_t.xrce129
   DEFINE l_xrce139      LIKE xrce_t.xrce139
   DEFINE l_gzcb003      LIKE gzcb_t.gzcb003
   #20150924--add--str--lujh
   DEFINE l_xrce109_1    LIKE xrce_t.xrce109
   DEFINE l_xrce119_1    LIKE xrce_t.xrce119
   DEFINE l_xrce129_1    LIKE xrce_t.xrce129
   DEFINE l_xrce139_1    LIKE xrce_t.xrce139
   #20150924--add--end--lujh
   #151105-00008#6--add--str--lujh
   DEFINE l_xrfc103      LIKE xrfc_t.xrfc103     
   DEFINE l_xrfc104      LIKE xrfc_t.xrfc104
   #151105-00008#6--add--end--lujh
   
   SELECT gzcb003 INTO l_gzcb003 FROM gzcb_t
    WHERE gzcb001 = '8306'
      AND gzcb002 = g_xrde4_d[l_ac].xrce002
   
   
   IF g_xrde4_d[l_ac].xrce002 = '30' OR g_xrde4_d[l_ac].xrce002 = '31' OR g_xrde4_d[l_ac].xrce002 = '32' THEN
      SELECT * INTO l_xrcc_t.*,l_xrca_t.*
        FROM xrcc_t,xrca_t
       WHERE xrcaent = g_enterprise
         AND xrcaent = xrccent
         AND xrcadocno = xrccdocno
         AND xrcald = xrccld
         AND xrccld = g_xrda_m.xrdald
         AND xrccdocno = p_xrce003
         AND xrccseq = p_xrce004
         AND xrcc001 = p_xrce005
         
      LET g_xrde4_d[l_ac].xrcecomp  = l_xrcc_t.xrcccomp
      LET g_xrde4_d[l_ac].xrcesite  = l_xrcc_t.xrccsite
      LET g_xrde4_d[l_ac].xrceorga  = g_xrda_m.xrdacomp
      LET g_xrde4_d[l_ac].xrce001   = 'axrt400'
      LET g_xrde4_d[l_ac].xrce003   = l_xrcc_t.xrccdocno
      LET g_xrde4_d[l_ac].xrce004   = l_xrcc_t.xrccseq
      LET g_xrde4_d[l_ac].xrce005   = l_xrcc_t.xrcc001
      LET g_xrde4_d[l_ac].xrce015   = l_gzcb003
      #20150416--mark--str--
      #IF g_xrde4_d[l_ac].xrce002 = '31' THEN
      #   LET g_xrde4_d[l_ac].xrce016   = l_xrca_t.xrca036
      #ELSE
      #   LET g_xrde4_d[l_ac].xrce016   = l_xrca_t.xrca035
      #END IF
      #20150416--mark--end--
      LET g_xrde4_d[l_ac].xrce016   = l_xrca_t.xrca035  #20150416 add
      LET g_xrde4_d[l_ac].xrce016_desc   = g_xrde4_d[l_ac].xrce016   #151201-00013#1 add lujh
      LET g_xrde6_d[l_ac].xrce017   = l_xrca_t.xrca014
      LET g_xrde4_d[l_ac].xrce027   = 'N'
      LET g_xrde4_d[l_ac].xrce100   = l_xrcc_t.xrcc100
      LET g_xrde4_d[l_ac].xrce101   = l_xrcc_t.xrcc102    #20150313  xrcc101 ---->xrcc102
      LET g_xrde4_d[l_ac].xrce109   = l_xrcc_t.xrcc108 - l_xrcc_t.xrcc109
      LET g_xrde4_d[l_ac].xrce119   = l_xrcc_t.xrcc118 - l_xrcc_t.xrcc119
      LET g_xrde5_d[l_ac].xrce120   = l_xrcc_t.xrcc120
      LET g_xrde5_d[l_ac].xrce121   = l_xrcc_t.xrcc122
      LET g_xrde5_d[l_ac].xrce129   = l_xrcc_t.xrcc128 - l_xrcc_t.xrcc129
      LET g_xrde5_d[l_ac].xrce130   = l_xrcc_t.xrcc130
      LET g_xrde5_d[l_ac].xrce131   = l_xrcc_t.xrcc132
      LET g_xrde5_d[l_ac].xrce139   = l_xrcc_t.xrcc138 - l_xrcc_t.xrcc139
      
     #LET g_xrde4_d[l_ac].xrce109 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce109,2)                                               #150812-00010#2 mark 
      CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce109,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce109    #150812-00010#2       
     #LET g_xrde4_d[l_ac].xrce119 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2)                                       #150812-00010#2 mark
      CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce119   #150812-00010#2       
      IF g_glaa_t.glaa015 = 'Y' THEN  #20150702 add lujh
        #LET g_xrde5_d[l_ac].xrce129 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,2)                                       #150812-00010#2 mark
         CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce129,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce129   #150812-00010#2         
      END IF                          #20150702 add lujh
      
      IF g_glaa_t.glaa019 = 'Y' THEN  #20150702 add lujh
        #LET g_xrde5_d[l_ac].xrce139 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce131,2)                                       #150812-00010#2 mark
         CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce139,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce139   #150812-00010#2         
      END IF                          #20150702 add lujh
      
      SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139)
        INTO l_xrce109,l_xrce119,l_xrce129,l_xrce139
        FROM xrce_t,xrda_t
       WHERE xrceent = g_enterprise
         AND xrdald = xrceld
         AND xrdadocno = xrcedocno
         AND xrdaent = xrceent
         AND xrceld = g_xrda_m.xrdald
         AND xrce003 = g_xrde4_d[l_ac].xrce003
         AND xrce004 = g_xrde4_d[l_ac].xrce004
         AND xrce005 = g_xrde4_d[l_ac].xrce005
         #AND xrcedocno <> g_xrda_m.xrdadocno      #20150702 mark lujh
         AND xrdastus = 'N'                        #20150702 add lujh
         
      IF cl_null(l_xrce109) THEN LET l_xrce109 = 0 END IF
      IF cl_null(l_xrce119) THEN LET l_xrce119 = 0 END IF
      IF cl_null(l_xrce129) THEN LET l_xrce129 = 0 END IF
      IF cl_null(l_xrce139) THEN LET l_xrce139 = 0 END IF
         
      #20150924--add--str--lujh
      #直接冲账
      SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139) 
        INTO l_xrce109_1,l_xrce119_1,l_xrce129_1,l_xrce139_1 
        FROM xrce_t,xrca_t
       WHERE xrcaent   = g_enterprise
         AND xrcald    = xrceld
         AND xrcadocno = xrcedocno
         AND xrcald = g_xrda_m.xrdald
         AND xrce003 = g_xrde4_d[l_ac].xrce003
         AND xrce004 = g_xrde4_d[l_ac].xrce004
         AND xrce005 = g_xrde4_d[l_ac].xrce005
         AND xrcastus  = 'N'
         
      IF cl_null(l_xrce109_1) THEN LET l_xrce109_1 = 0 END IF
      IF cl_null(l_xrce119_1) THEN LET l_xrce119_1 = 0 END IF
      IF cl_null(l_xrce129_1) THEN LET l_xrce129_1 = 0 END IF
      IF cl_null(l_xrce139_1) THEN LET l_xrce139_1 = 0 END IF
      #20150924--add--end--lujh
      
      #151105-00008#6--add--str--lujh
      #抓取axrt460已存在未审核的单子
      LET l_xrfc103 = 0   LET l_xrfc104 = 0
      SELECT SUM(xrfc103),SUM(xrfc104) INTO l_xrfc103,l_xrfc104 FROM xrfa_t,xrfc_t
       WHERE xrfaent   = g_enterprise
         AND xrfadocno = xrfcdocno
         AND xrfald    = g_xrda_m.xrdald
         AND xrfc003   = g_xrde4_d[l_ac].xrce003
         AND xrfc004   = g_xrde4_d[l_ac].xrce004
         AND xrfc005   = g_xrde4_d[l_ac].xrce005
         AND xrfastus  = 'N'
      IF cl_null(l_xrfc103) THEN LET l_xrfc103 = 0 END IF
      IF cl_null(l_xrfc104) THEN LET l_xrfc104 = 0 END IF
      #151105-00008#6--add--end--lujh
         
      LET g_xrde4_d[l_ac].xrce109 = g_xrde4_d[l_ac].xrce109 - l_xrce109 - l_xrce109_1 - l_xrfc103    #20150924 add l_xrce109_1 lujh      #151105-00008#6 add l_xrfc103 lujh                                     
      LET g_xrde4_d[l_ac].xrce119 = g_xrde4_d[l_ac].xrce119 - l_xrce119 - l_xrce119_1 - l_xrfc104    #20150924 add l_xrce119_1 lujh      #151105-00008#6 add l_xrfc104 lujh 
      LET g_xrde5_d[l_ac].xrce129 = g_xrde5_d[l_ac].xrce129 - l_xrce129 - l_xrce129_1                #20150924 add l_xrce129_1 lujh
      LET g_xrde5_d[l_ac].xrce139 = g_xrde5_d[l_ac].xrce139 - l_xrce139 - l_xrce139_1                #20150924 add l_xrce139_1 lujh
   END IF
   
   IF g_xrde4_d[l_ac].xrce002 = '40' OR g_xrde4_d[l_ac].xrce002 = '41' OR g_xrde4_d[l_ac].xrce002 = '42' THEN
      SELECT * INTO l_apcc_t.*,l_apca_t.*
        FROM apcc_t,apca_t
       WHERE apcaent = g_enterprise
         AND apcaent = apccent
         AND apcadocno = apccdocno
         AND apcald = apccld
         AND apccld = g_xrda_m.xrdald
         AND apccdocno = p_xrce003
         AND apccseq = p_xrce004
         AND apcc001 = p_xrce005
         
      LET g_xrde4_d[l_ac].xrcecomp  = l_apcc_t.apcccomp
      LET g_xrde4_d[l_ac].xrcesite  = l_apcc_t.apccsite
      LET g_xrde4_d[l_ac].xrceorga  = g_xrda_m.xrdacomp
      LET g_xrde4_d[l_ac].xrce001   = 'axrt400'
      LET g_xrde4_d[l_ac].xrce003   = l_apcc_t.apccdocno
      LET g_xrde4_d[l_ac].xrce004   = l_apcc_t.apccseq
      LET g_xrde4_d[l_ac].xrce005   = l_apcc_t.apcc001
      LET g_xrde4_d[l_ac].xrce015   = l_gzcb003
      LET g_xrde4_d[l_ac].xrce016   = l_apca_t.apca035
      LET g_xrde4_d[l_ac].xrce016_desc   = g_xrde4_d[l_ac].xrce016   #151201-00013#1 add lujh
      LET g_xrde6_d[l_ac].xrce017   = l_apca_t.apca014
      LET g_xrde4_d[l_ac].xrce027   = 'N'
      LET g_xrde4_d[l_ac].xrce100   = l_apcc_t.apcc100
      LET g_xrde4_d[l_ac].xrce101   = l_apcc_t.apcc102   #20150313  apcc101 ---->apcc102
      LET g_xrde4_d[l_ac].xrce109   = l_apcc_t.apcc108 - l_apcc_t.apcc109
      LET g_xrde4_d[l_ac].xrce119   = l_apcc_t.apcc118 - l_apcc_t.apcc119
      LET g_xrde5_d[l_ac].xrce120   = l_apcc_t.apcc120
      LET g_xrde5_d[l_ac].xrce121   = l_apcc_t.apcc122
      LET g_xrde5_d[l_ac].xrce129   = l_apcc_t.apcc128 - l_apcc_t.apcc129
      LET g_xrde5_d[l_ac].xrce130   = l_apcc_t.apcc130
      LET g_xrde5_d[l_ac].xrce131   = l_apcc_t.apcc132
      LET g_xrde5_d[l_ac].xrce139   = l_apcc_t.apcc138 - l_apcc_t.apcc139
      
     #LET g_xrde4_d[l_ac].xrce109 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce109,2) #150812-00010#2 mark  #150819
      CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce109,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce109    #150812-00010#2       
     #LET g_xrde4_d[l_ac].xrce119 = s_curr_round(g_xrda_m.xrdasite,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2)                                       #150812-00010#2 mark
      CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_glaa_t.glaa001,g_xrde4_d[l_ac].xrce119,2) RETURNING g_sub_success,g_errno,g_xrde4_d[l_ac].xrce119   #150812-00010#2       
      IF g_glaa_t.glaa015 = 'Y' THEN  #20150702 add lujh
        #LET g_xrde5_d[l_ac].xrce129 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce121,2)                                      #150812-00010#2 mark
         CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce120,g_xrde5_d[l_ac].xrce129,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce129   #150812-00010#2         
      END IF                          #20150702 add lujh
      
      IF g_glaa_t.glaa019 = 'Y' THEN  #20150702 add lujh
        #LET g_xrde5_d[l_ac].xrce139 = s_curr_round(g_xrda_m.xrdasite,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce131,2)                                       #150812-00010#2 mark 
         CALL s_curr_round_ld('1',g_xrda_m.xrdald,g_xrde5_d[l_ac].xrce130,g_xrde5_d[l_ac].xrce139,2) RETURNING g_sub_success,g_errno,g_xrde5_d[l_ac].xrce139   #150812-00010#2         
      END IF                          #20150702 add lujh
      
      
      SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139)
        INTO l_xrce109,l_xrce119,l_xrce129,l_xrce139
        FROM xrce_t,xrda_t
       WHERE xrceent = g_enterprise
         AND xrdald = xrceld
         AND xrdadocno = xrcedocno
         AND xrdaent = xrceent
         AND xrceld = g_xrda_m.xrdald
         AND xrce003 = g_xrde4_d[l_ac].xrce003
         AND xrce004 = g_xrde4_d[l_ac].xrce004
         AND xrce005 = g_xrde4_d[l_ac].xrce005
         #AND xrcedocno <> g_xrda_m.xrdadocno    #20150702 mark lujh
         AND xrdastus = 'N'                      #20150702 add lujh
         
      IF cl_null(l_xrce109) THEN LET l_xrce109 = 0 END IF
      IF cl_null(l_xrce119) THEN LET l_xrce119 = 0 END IF
      IF cl_null(l_xrce129) THEN LET l_xrce129 = 0 END IF
      IF cl_null(l_xrce139) THEN LET l_xrce139 = 0 END IF
      
      #151105-00008#6--add--str--lujh
      #抓取axrt460已存在未审核的单子
      LET l_xrfc103 = 0   LET l_xrfc104 = 0
      SELECT SUM(xrfc103),SUM(xrfc104) INTO l_xrfc103,l_xrfc104 FROM xrfa_t,xrfc_t
       WHERE xrfaent   = g_enterprise
         AND xrfadocno = xrfcdocno
         AND xrfald    = g_xrda_m.xrdald
         AND xrfc003   = g_xrde4_d[l_ac].xrce003
         AND xrfc004   = g_xrde4_d[l_ac].xrce004
         AND xrfc005   = g_xrde4_d[l_ac].xrce005
         AND xrfastus  = 'N'
      IF cl_null(l_xrfc103) THEN LET l_xrfc103 = 0 END IF
      IF cl_null(l_xrfc104) THEN LET l_xrfc104 = 0 END IF
      #151105-00008#6--add--end--lujh
      
      LET g_xrde4_d[l_ac].xrce109 = g_xrde4_d[l_ac].xrce109 - l_xrce109 - l_xrfc103       #151105-00008#6 add l_xrfc103 lujh    
      LET g_xrde4_d[l_ac].xrce119 = g_xrde4_d[l_ac].xrce119 - l_xrce119 - l_xrfc104       #151105-00008#6 add l_xrfc104 lujh    
      LET g_xrde5_d[l_ac].xrce129 = g_xrde5_d[l_ac].xrce129 - l_xrce129
      LET g_xrde5_d[l_ac].xrce139 = g_xrde5_d[l_ac].xrce139 - l_xrce139
   END IF
   
   DISPLAY g_xrde4_d[l_ac].xrce100,g_xrde4_d[l_ac].xrce101,
           g_xrde4_d[l_ac].xrce109,g_xrde4_d[l_ac].xrce119
        TO s_detail4[l_ac].xrce100,s_detail4[l_ac].xrce101,
           s_detail4[l_ac].xrce109,s_detail4[l_ac].xrce119
END FUNCTION
# 自由核算項檢查
PRIVATE FUNCTION axrt400_free_account_chk(p_glaf001,p_glaf002,p_ctrl)
   DEFINE p_glaf001      LIKE glaf_t.glaf001
   DEFINE p_glaf002      LIKE glaf_t.glaf002
   DEFINE p_ctrl         LIKE type_t.chr5       #控制方式1.1.允许空白，2：必输不需检查或，3：必输需要检查
   DEFINE r_errno        LIKE type_t.chr10      #错误编号
   DEFINE l_glafstus     LIKE glaf_t.glafstus
   DEFINE l_glae002      LIKE glae_t.glae002
   DEFINE l_glae003      LIKE glae_t.glae003
   DEFINE l_glae004      LIKE glae_t.glae004
   DEFINE l_cnt          LIKE type_t.num5
   DEFINE l_sql          STRING
   
      LET r_errno = ''
      LET l_glae002 = ''
      LET l_glae003 = ''
      LET l_glae004 = ''
      #.抓出該类型对应的资料来源，来源档案，来源编号栏位
      SELECT glae002,glae003,glae004 INTO l_glae002,l_glae003,l_glae004 FROM glae_t
       WHERE glaeent = g_enterprise
         AND glae001 = p_glaf001
      #来源类型为1.‘基本资料’，則檢核來源編號欄位是否存在,並依核算项类型对应的控制方式，檢核核算项值的合理性
      IF l_glae002 = '1' THEN
         SELECT count(*) INTO l_cnt FROM dzeb_t
          WHERE dzeb001 = l_glae003
            AND dzeb002 = l_glae004
         IF l_cnt = 0  THEN
            LET r_errno = 'agl-00073'
            RETURN r_errno
         END IF
         #控制方式3：必输必检查
         IF p_ctrl = '3'  THEN
            #1.检查资料的有效存在
             LET l_cnt = 0
             CALL axrt400_make_sql(l_glae003,l_glae004,p_glaf002) RETURNING l_sql
             PREPARE axrt400_03_chk  FROM l_sql
             EXECUTE axrt400_03_chk INTO l_cnt             
             IF  l_cnt = 0  THEN
                 LET r_errno = 'agl-00099'
                 RETURN r_errno
             END IF
             #IF  l_glafstus = 'N'  THEN
             #    LET g_errno = 'agl-00063'
             #    RETURN r_errno
             #END IF
         END IF
      END IF
      #来源类型为2.预设值，則輸入值應檢核是否存在自由核算項資料檔,並依核算项类型对应的控制方式，檢核核算项值的合理性
      IF l_glae002 = '2' THEN
         SELECT glafstus INTO l_glafstus FROM glaf_t
             WHERE glafent = g_enterprise
               AND glaf001 = p_glaf001
               AND glaf002 = p_glaf002
         IF SQLCA.SQLCODE = 100  THEN
            LET r_errno = 'agl-00062'
            RETURN r_errno
          END IF
          IF p_ctrl = '3'  THEN
             IF l_glafstus = 'N'  THEN
#                LET g_errno = 'agl-00063'      #160318-00005#54  mark
                LET g_errno = 'sub-01302'       #160318-00005#54  add
                RETURN r_errno
             END IF
          END IF
      END IF
      #若来源类型为3.'自行輸入'則user可任意輸入且不需檢核
      RETURN r_errno
END FUNCTION
# 核算项说明
# 如果栏位对应的核算项类型对应的资料来源为‘1’，则自组sql来抓取说明
PRIVATE FUNCTION axrt400_free_account_desc(p_glad,p_field)
   DEFINE p_glad        LIKE glad_t.glad0171
   DEFINE p_field       LIKE xrde_t.xrde042
   DEFINE l_glae002     LIKE glae_t.glae002     #资料来源
   DEFINE l_sql         STRING                  #组的抓取资料的sql
   DEFINE r_field_desc  LIKE type_t.chr80
   
   #核算项一
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = p_glad
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = p_glad
      LET g_ref_fields[2] = p_field
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET r_field_desc = g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = p_field
      CALL axrt400_make_sql_desc(p_glad) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET r_field_desc = g_rtn_fields[1]
   END IF 
   
   RETURN r_field_desc
END FUNCTION
#
PRIVATE FUNCTION axrt400_make_sql_desc(p_glae001)
   DEFINE p_glae001   LIKE glae_t.glae001   #核算项类型
   #DEFINE p_field_value   LIKE glaf_t.glaf002   #核算项值
   DEFINE r_sql       STRING
   DEFINE l_glae003   LIKE glae_t.glae003   #来源档案
   DEFINE l_glae004   LIKE glae_t.glae004   #来源编号栏位
   DEFINE l_glae005   LIKE glae_t.glae005   #来源说明档案
   DEFINE l_glae006   LIKE glae_t.glae006   #来源说明栏位  
   DEFINE l_dzeb002   LIKE dzeb_t.dzeb002   #栏位代号
   DEFINE l_dzeb006   LIKE dzeb_t.dzeb002   #栏位属性    
   DEFINE l_sql     STRING
   DEFINE li_sql1   STRING    #抓主档表的key
   DEFINE li_sql2   STRING    #抓对应多语言表的key 
   #抓取主表的key放入数组
   DEFINE li_main    DYNAMIC ARRAY OF RECORD
          dzeb002    LIKE dzeb_t.dzeb002       
   END RECORD 
   #抓取多语言表的key放入数组
   DEFINE li_dlang    DYNAMIC ARRAY OF RECORD
          dzeb002    LIKE dzeb_t.dzeb002       
   END RECORD 
   DEFINE l_where   STRING    #组出的对应的抓取说明的where条件    
   DEFINE l_i,l_i2,l_i3       LIKE type_t.num5
    
    #初始化
    CALL li_main.clear()
    CALL li_dlang.clear()
    
   #抓取来源档案，来源说明档案，来源说明栏位
   SELECT glae003,glae004,glae005,glae006 INTO l_glae003,l_glae004,l_glae005,l_glae006 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = p_glae001
      
   #抓取主档key
   LET l_i = 1
   LET li_sql1 = " SELECT dzeb002 FROM dzeb_t ",
                 "  WHERE dzeb001 = '",l_glae003,"'",
                 "    AND dzeb004 = 'Y'", 
                 "  ORDER BY dzeb021 " 
   PREPARE axrt400_pr FROM li_sql1
   DECLARE axrt400_cs1 CURSOR FOR axrt400_pr
   FOREACH axrt400_cs1 INTO li_main[l_i].dzeb002
       LET l_i = l_i +1
   END FOREACH
   #真实数组长度
   LET l_i = l_i -1  
   
   #抓取多语言档key
   LET l_i2 = 1
   LET li_sql2 = " SELECT dzeb002 FROM dzeb_t ",
                 " WHERE dzeb001 = '",l_glae005,"'" ,
                  "  AND dzeb004 = 'Y'",
                 " ORDER BY dzeb021 "
   PREPARE axrt400_pr2 FROM li_sql2
   DECLARE axrt400_cs2 CURSOR FOR axrt400_pr2
   FOREACH axrt400_cs2 INTO li_dlang[l_i2].dzeb002
       LET l_i2 = l_i2 +1
   END FOREACH
   #真实数组长度
   LET l_i2 = l_i2 -1  

   
   #组合where条件 
   LET l_where = '1=1'
   FOR  l_i3 = 1 TO  l_i 
       LET l_where = l_where," AND ", li_main[l_i3].dzeb002, " = " ,li_dlang[l_i3].dzeb002
   END FOR    
   
   #组出的基础sql   
   LET r_sql = " SELECT ", l_glae006 ," FROM ",l_glae005 ,',',l_glae003,
               " WHERE " , l_glae004," = ?",
               "   AND " ,l_where
   #组sql               
   LET l_sql = "SELECT dzeb002,dzeb006 FROM dzeb_t ",
               " WHERE dzeb001 = '",l_glae005,"'",
               "   AND dzeb004 = 'Y'"
   PREPARE axrt400_make_sql_pre1 FROM l_sql
   DECLARE axrt400_make_sql_cs1 CURSOR FOR axrt400_make_sql_pre1
   FOREACH axrt400_make_sql_cs1 INTO l_dzeb002,l_dzeb006
      #判断是否有ent栏位
      IF l_dzeb006 = 'N802' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_enterprise,"' "
      END IF 
      
      IF l_dzeb006 = 'C800' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_dlang,"' "
      END IF

   END FOREACH
   RETURN r_sql
END FUNCTION
# 组检查资料存在有效的sql
PRIVATE FUNCTION axrt400_make_sql(p_glae003,p_glae004,p_glaf002)
   DEFINE p_glae003 LIKE glae_t.glae003    #来源档案
   DEFINE p_glae004 LIKE glae_t.glae004    #来源编号栏位
   DEFINE p_glaf002 LIKE glaf_t.glaf002    #核算项值
   DEFINE l_dzeb002 LIKE dzeb_t.dzeb002
   DEFINE l_dzeb006 LIKE dzeb_t.dzeb006
   DEFINE l_sql     STRING
   DEFINE r_sql     STRING

   LET r_sql = " SELECT count(*) FROM ",p_glae003 ,
               "  WHERE ", p_glae004," = '",p_glaf002,"'"
               
   LET l_sql = "SELECT dzeb002,dzeb006 FROM dzeb_t ",
               " WHERE dzeb001 = '", p_glae003,"'"
   PREPARE axrt400_make_sql_pre FROM l_sql
   DECLARE axrt400_make_sql_cs CURSOR FOR axrt400_make_sql_pre
   FOREACH axrt400_make_sql_cs INTO l_dzeb002,l_dzeb006
      #判断是否有ent栏位
      IF l_dzeb006 = 'N802' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_enterprise,"' "
      END IF
      #判断是否有stus栏位
      IF l_dzeb002 LIKE '%stus'  THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='Y'"
      END IF
   END FOREACH
   RETURN r_sql
END FUNCTION
# 多帳期明細新增进apcc_t
PRIVATE FUNCTION axrt400_ins_xrde_12(p_xrce002)
 
   DEFINE p_xrce002      LIKE xrce_t.xrce002
   DEFINE l_xrce109      LIKE xrce_t.xrce109
   DEFINE l_xrce119      LIKE xrce_t.xrce119
   DEFINE l_xrce129      LIKE xrce_t.xrce129
   DEFINE l_xrce139      LIKE xrce_t.xrce139
   DEFINE l_gzcb003      LIKE gzcb_t.gzcb003
   DEFINE l_count        LIKE type_t.num5
   DEFINE l_ls_s         LIKE type_t.num5
   DEFINE l_sql          STRING
   DEFINE l_apca_t       RECORD LIKE apca_t.*
   DEFINE l_apcc_t       RECORD LIKE apcc_t.*
   DEFINE l_xrce_t       RECORD LIKE xrce_t.*
   DEFINE l_ooab002      LIKE ooab_t.ooab002
   DEFINE l_xrdeseq      LIKE xrde_t.xrdeseq
   DEFINE l_xrde010      LIKE xrde_t.xrde010
   #151105-00008#6--add--str--lujh
   DEFINE l_xrfc103      LIKE xrfc_t.xrfc103     
   DEFINE l_xrfc104      LIKE xrfc_t.xrfc104
   #151105-00008#6--add--end--lujh
   DEFINE l_gzcb005      LIKE gzcb_t.gzcb005   #160420-00001#13 Add


   DELETE FROM xrce_t 
    WHERE xrceent = g_enterprise
      AND xrceld = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND xrceseq = g_xrde4_d[l_ac].xrceseq
      AND xrce003 = g_xrde4_d[l_ac].xrce003

   LET l_ooab002 = ''
   SELECT ooab002 INTO l_ooab002 FROM ooab_t
    WHERE ooabent = g_enterprise
      AND ooabsite= g_xrda_m.xrdasite
      AND ooab001 = 'S-FIN-1002'

   IF cl_null(g_xrde4_d_t.xrce003) THEN 
      SELECT MAX(xrceseq) INTO l_xrce_t.xrceseq
        FROM xrce_t
       WHERE xrceent = g_enterprise 
         AND xrceld = g_xrda_m.xrdald
         AND xrcedocno = g_xrda_m.xrdadocno
      IF cl_null(l_xrce_t.xrceseq) THEN
         LET l_xrce_t.xrceseq = 1
      ELSE
         LET l_xrce_t.xrceseq = l_xrce_t.xrceseq + 1
      END IF
   ELSE
      LET l_xrce_t.xrceseq = g_xrde4_d_t.xrce003
   END IF
   
   IF l_xrce_t.xrceseq = 1 THEN 
      SELECT MAX(xrdeseq) INTO l_xrdeseq
        FROM xrde_t
       WHERE xrdeent = g_enterprise
         AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
         AND xrde010 IS NOT NULL
         
      SELECT xrde010 INTO l_xrde010
        FROM xrde_t
       WHERE xrdeent = g_enterprise
         AND xrdeld = g_xrda_m.xrdald
         AND xrdedocno = g_xrda_m.xrdadocno
         AND xrdeseq = l_xrdeseq
         
      LET l_xrce_t.xrce010 = l_xrde010
   ELSE
      SELECT xrce010 INTO l_xrce_t.xrce010
        FROM xrce_t
       WHERE xrceent = g_enterprise
         AND xrceld = g_xrda_m.xrdald
         AND xrcedocno = g_xrda_m.xrdadocno
         AND xrceseq = l_xrce_t.xrceseq - 1 
   END IF

   #計算帳款部分
   LET l_sql ="SELECT * FROM apcc_t,apca_t,gzcb_t",
              " WHERE apccent = '",g_enterprise,"'",
              "   AND apccld = apcald",
              "   AND apccdocno = apcadocno",
              "   AND apccent = apcaent ",
              "   AND apcastus = 'Y'",
              "   AND apca001 = gzcb002",
              "   AND gzcb003 = '1'",
              "   AND gzcb001 = '8502'",
              "   AND apcc108 - apcc109 > 0",
              #"   AND apca005 = '",g_xrda_m.xrda005,"'",   #albireo 151023 mark   開窗已篩過條件   交易對象及交易對象的合作夥伴
              "   AND (",g_qryparam.return1,")"
   
   PREPARE axrt400_sel_apcc_prep FROM l_sql
   DECLARE axrt400_sel_apcc_curs CURSOR FOR axrt400_sel_apcc_prep

    
   SELECT gzcb003 INTO l_gzcb003 FROM gzcb_t
    WHERE gzcb002 = p_xrce002
      AND gzcb001 = '8306'
   LET l_xrce_t.xrceent = g_enterprise
   LET l_xrce_t.xrceld = g_xrda_m.xrdald
   LET l_xrce_t.xrcedocno = g_xrda_m.xrdadocno
   LET l_xrce_t.xrcesite  = g_xrda_m.xrdasite
   LET l_xrce_t.xrce002   = p_xrce002
   IF l_gzcb003 = 'D' THEN
      LET l_xrce_t.xrce015   =  'D'
   ELSE
      LET l_xrce_t.xrce015   =  'C'
   END IF
   

   FOREACH axrt400_sel_apcc_curs INTO l_apcc_t.*,l_apca_t.*
   
     #160420-00001#13 Add  ---(S)---
     #重新计算訂金待抵單可沖總金額.待抵單可沖總金額應為原始單據已收款金額
     LET l_gzcb005 = ''
     SELECT gzcb005 INTO l_gzcb005 FROM gzcb_t WHERE gzcb001 = '8502' AND gzcb002 = l_apca_t.apca001
     IF l_gzcb005 = 'aapq342' THEN
        IF p_xrce002 <> '30' THEN
           SELECT SUM(apcc109),SUM(apcc119),SUM(apcc129),SUM(apcc139)
             INTO l_apcc_t.apcc108,l_apcc_t.apcc118,l_apcc_t.apcc128,l_apcc_t.apcc138
             FROM apcc_t WHERE apccent = g_enterprise
              AND apccld = l_apcc_t.apccld
              AND apccdocno IN (
            SELECT apca018 FROM apca_t WHERE apcaent = g_enterprise
               AND apcald = l_apca_t.apcald
               AND apcadocno = l_apca_t.apcadocno)
        END IF
     END IF
     #160420-00001#13 Add  ---(E)---

      #計算預沖金額
      LET l_xrce109 = 0   LET l_xrce119 = 0
      LET l_xrce129 = 0   LET l_xrce139 = 0
      SELECT SUM(xrce109),SUM(xrce119),SUM(xrce129),SUM(xrce139) INTO l_xrce109,l_xrce119,l_xrce129,l_xrce139   #151105-00008#2 change l_xrce129 to l_xrce119  lujh
        FROM xrce_t,xrda_t
       WHERE xrdaent   = xrceent
         AND xrdald    = xrceld
         AND xrdadocno = xrcedocno
         AND xrce003   = l_apcc_t.apccdocno
         AND xrce004   = l_apcc_t.apccseq
         AND xrce005   = l_apcc_t.apcc001
         AND xrdastus  = 'N'
      IF cl_null(l_xrce109) THEN LET l_xrce109 = 0 END IF
      IF cl_null(l_xrce119) THEN LET l_xrce119 = 0 END IF
      IF cl_null(l_xrce129) THEN LET l_xrce129 = 0 END IF
      IF cl_null(l_xrce139) THEN LET l_xrce139 = 0 END IF
      
      #151105-00008#6--add--str--lujh
      #抓取axrt460已存在未审核的单子
      LET l_xrfc103 = 0   LET l_xrfc104 = 0
      SELECT SUM(xrfc103),SUM(xrfc104) INTO l_xrfc103,l_xrfc104 FROM xrfa_t,xrfc_t
       WHERE xrfaent   = g_enterprise
         AND xrfadocno = xrfcdocno
         AND xrfald    = g_xrda_m.xrdald
         AND xrfc003   = l_apcc_t.apccdocno
         AND xrfc004   = l_apcc_t.apccseq
         AND xrfc005   = l_apcc_t.apcc001
         AND xrfastus  = 'N'
      IF cl_null(l_xrfc103) THEN LET l_xrfc103 = 0 END IF
      IF cl_null(l_xrfc104) THEN LET l_xrfc104 = 0 END IF
      #151105-00008#6--add--end--lujh
      
      LET l_xrce_t.xrcecomp = l_apcc_t.apcccomp
      LET l_xrce_t.xrceorga = g_xrda_m.xrdacomp
      LET l_xrce_t.xrce001  = 'axrt400'
      LET l_xrce_t.xrce003  = l_apcc_t.apccdocno
      LET l_xrce_t.xrce004  = l_apcc_t.apccseq
      LET l_xrce_t.xrce005  = l_apcc_t.apcc001
      LET l_xrce_t.xrce016  = l_apca_t.apca035
      LET l_xrce_t.xrce017  = l_apca_t.apca014
      LET l_xrce_t.xrce018  = l_apca_t.apca015
      LET l_xrce_t.xrce027  = 'N'
      LET l_xrce_t.xrce028  = 0
      LET l_xrce_t.xrce036  = l_apca_t.apca006
      LET l_xrce_t.xrce038  = l_apca_t.apca004     #160426-00016      
      LET l_xrce_t.xrce053  = l_apcc_t.apcc008
      LET l_xrce_t.xrce054  = l_apcc_t.apcc009
      LET l_xrce_t.xrce100  = l_apcc_t.apcc100
      LET l_xrce_t.xrce101  = l_apcc_t.apcc102     #20150313  apcc101 ---->apcc102
      LET l_xrce_t.xrce104   = 0
      LET l_xrce_t.xrce114   = 0
      LET l_xrce_t.xrce120  = l_apcc_t.apcc120
      LET l_xrce_t.xrce121  = l_apcc_t.apcc122
      LET l_xrce_t.xrce130  = l_apcc_t.apcc130
      LET l_xrce_t.xrce131  = l_apcc_t.apcc132
      
      LET l_xrce_t.xrce109  = l_apcc_t.apcc108 - l_apcc_t.apcc109 - l_xrce109 - l_xrfc103     #151105-00008#6 add l_xrfc103 lujh
      LET l_xrce_t.xrce119  = l_apcc_t.apcc118 - l_apcc_t.apcc119 + l_apcc_t.apcc113 - l_xrce119 - l_xrfc104  #151105-00008#6 add l_xrfc104 lujh
      IF l_xrce_t.xrce109 <= 0 THEN CONTINUE FOREACH END IF
      LET l_xrce_t.xrce129  = l_apcc_t.apcc128 - l_apcc_t.apcc129 + l_apcc_t.apcc123 - l_xrce129
      LET l_xrce_t.xrce139  = l_apcc_t.apcc138 - l_apcc_t.apcc139 + l_apcc_t.apcc133 - l_xrce139

      IF g_glaa_t.glaa015 = 'N' THEN
         LET l_xrce_t.xrce120 = ''
         LET l_xrce_t.xrce121 = 0
         LET l_xrce_t.xrce129 = 0
      END IF
      
      IF g_glaa_t.glaa019 = 'N' THEN
         LET l_xrce_t.xrce130 = ''
         LET l_xrce_t.xrce131 = 0
         LET l_xrce_t.xrce139 = 0
      END IF


      #INSERT INTO xrce_t VALUES(l_xrce_t.*)
      INSERT INTO xrce_t(xrceent,xrcecomp,xrceorga,xrcesite,xrceld,xrcedocno,xrceseq,xrce001,xrce002,xrce003,
                         xrce004,xrce005,xrce010,xrce015,xrce016,xrce017,xrce018,xrce027,xrce028,xrce036,
                         xrce053,xrce054,xrce100,xrce101,xrce104,xrce114,xrce109,
                         xrce119,xrce120,xrce121,xrce129,xrce130,xrce131,xrce139)
                  VALUES(l_xrce_t.xrceent,l_xrce_t.xrcecomp ,l_xrce_t.xrceorga,l_xrce_t.xrcesite,
                         l_xrce_t.xrceld ,l_xrce_t.xrcedocno,l_xrce_t.xrceseq ,l_xrce_t.xrce001 ,
                         l_xrce_t.xrce002,l_xrce_t.xrce003  ,l_xrce_t.xrce004 ,l_xrce_t.xrce005 ,
                         l_xrce_t.xrce010,l_xrce_t.xrce015  ,l_xrce_t.xrce016 ,l_xrce_t.xrce017 ,
                         l_xrce_t.xrce018,l_xrce_t.xrce027  ,l_xrce_t.xrce028 ,l_xrce_t.xrce036 ,
                         l_xrce_t.xrce053,l_xrce_t.xrce054  ,l_xrce_t.xrce100 ,l_xrce_t.xrce101 ,
                         l_xrce_t.xrce104,l_xrce_t.xrce114  ,l_xrce_t.xrce109 ,l_xrce_t.xrce119 ,
                         l_xrce_t.xrce120,l_xrce_t.xrce121  ,l_xrce_t.xrce129 ,l_xrce_t.xrce130 ,
                         l_xrce_t.xrce131,l_xrce_t.xrce139
                        )
      IF SQLCA.sqlcode THEN
         LET g_success = 'N' RETURN
      END IF

      #LET l_xrce_t.xrceseq = l_xrce_t.xrceseq + 1    #151105-00008#2 mark lujh
      
      #151105-00008#2--add--str--lujh
      SELECT MAX(xrceseq) INTO l_xrce_t.xrceseq
        FROM xrce_t
       WHERE xrceent = g_enterprise 
         AND xrceld = g_xrda_m.xrdald
         AND xrcedocno = g_xrda_m.xrdadocno
      IF cl_null(l_xrce_t.xrceseq) THEN
         LET l_xrce_t.xrceseq = 1
      ELSE
         LET l_xrce_t.xrceseq = l_xrce_t.xrceseq + 1
      END IF
      #151105-00008#2--add--end--lujh

   END FOREACH
END FUNCTION
# 抓取账套资料
PRIVATE FUNCTION axrt400_glaa_get()
#150820-00015#3--(s)
DEFINE l_str       LIKE type_t.num5
DEFINE l_end       LIKE type_t.num5      
#150820-00015#3--(e)  
   SELECT * INTO g_glaa_t.* FROM glaa_t WHERE glaaent = g_enterprise AND glaald = g_xrda_m.xrdald
   #150820-00015#3--(s)
   #帳套設定:核銷限定立帳己產生傳票
   IF g_glaa_t.glaa136 = 'Y' THEN
      CALL s_aapt420_get_slip_pos('') RETURNING l_str,l_end
      LET g_wc3 =
      #排除所屬單別參數"產生分錄傳票否"為Y,但尚未產生傳票者
      " AND NOT (",
      "      EXISTS (SELECT 1 FROM ooac_t ",
      "               WHERE ooacent = apcaent ",
      "                 AND ooac001 = '",g_glaa_t.glaa024,"' ",
      "                 AND ooac002 = SUBSTR(apcadocno,",l_str,",",l_end,") ",
      "                 AND ooac003 = 'D-FIN-0030' ",
      "                 AND ooac004 ='Y') ",
      "         AND apca038 IS NULL",
      "     )  "
   ELSE
      LET g_wc3 = ''
   END IF
   #150820-00015#3--(e)          
END FUNCTION
# 回写单头借贷方合计
PRIVATE FUNCTION axrt400_update_xrda()
   
   CALL s_transaction_begin()
   CALL cl_err_collect_init()
   
   UPDATE xrda_t SET xrda103 = g_amt1_d,
                     xrda104 = g_amt3_c,
                     xrda113 = g_amt2_d,
                     xrda114 = g_amt4_c,
                     xrda123 = g_amt1_d_1,
                     xrda124 = g_amt3_c_1,
                     xrda133 = g_amt2_d_1,
                     xrda134 = g_amt4_c_1
    WHERE xrdaent = g_enterprise
      AND xrdald = g_xrda_m.xrdald
      AND xrdadocno = g_xrda_m.xrdadocno
      
   IF SQLCA.SQLcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = 'upd xrda_t'
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      CALL s_transaction_end('N','0')
   ELSE
      CALL s_transaction_end('Y','0')   
   END IF 
   CALL cl_err_collect_show()   #150812-00010#2                
END FUNCTION
# 單據備註帶入明細摘要
PRIVATE FUNCTION axrt400_update_abstract()
   DEFINE l_success     LIKE type_t.num5
   
   LET l_success = TRUE
   
   CALL s_transaction_begin()
   
   UPDATE xrde_t SET xrde010 = g_xrda_m.xrda017
    WHERE xrdeent = g_enterprise
      AND xrdeld = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde010 IS NULL
      
   IF SQLCA.SQLcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = 'upd xrde_t'
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      
      LET l_success = FALSE 
   END IF

   UPDATE xrce_t SET xrce010 = g_xrda_m.xrda017
    WHERE xrceent = g_enterprise
      AND xrceld = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND xrce010 IS NULL
      
   IF SQLCA.SQLcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = 'upd xrce_t'
      LET g_errparam.code   = SQLCA.sqlcode
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      
      LET l_success = FALSE 
   END IF 
   
   IF l_success = TRUE THEN 
      CALL s_transaction_end('Y','1')
   ELSE
      CALL s_transaction_end('N','1')
   END IF
   CALL cl_err_collect_show()
   CALL axrt400_show()
END FUNCTION
# 現金變動碼說明
PRIVATE FUNCTION axrt400_xrde012_desc(p_xrde012)
   DEFINE p_xrde012       LIKE xrde_t.xrde012
   DEFINE r_xrde012_desc  LIKE type_t.chr80
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_xrde012
   LET g_ref_fields[2] = g_glaa_t.glaa005
   CALL ap_ref_array2(g_ref_fields,"SELECT nmail004 FROM nmail_t WHERE nmailent='"||g_enterprise||"' AND nmail002=? AND nmail001 = ? AND nmail003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET r_xrde012_desc = '', g_rtn_fields[1] , ''

   RETURN r_xrde012_desc
END FUNCTION
# 借贷说明
PRIVATE FUNCTION axrt400_xrde015_desc(p_xrde015)
   DEFINE p_xrde015             LIKE xrde_t.xrde015
   DEFINE r_xrde015_desc        LIKE type_t.chr10

   LET r_xrde015_desc = ''
   CASE 
      WHEN p_xrde015 = 'D' 
           LET r_xrde015_desc = cl_getmsg('axr-00302',g_dlang)
      WHEN p_xrde015 = 'C'
           LET r_xrde015_desc = cl_getmsg('axr-00303',g_dlang)
   END CASE

   RETURN r_xrde015_desc
END FUNCTION
# 借贷说明
PRIVATE FUNCTION axrt400_xrce015_desc(p_xrce015)
DEFINE p_xrce015             LIKE xrce_t.xrce015
   DEFINE r_xrce015_desc        LIKE type_t.chr10

   LET r_xrce015_desc = ''
   CASE 
      WHEN p_xrce015 = 'D' 
           LET r_xrce015_desc = cl_getmsg('axr-00302',g_dlang)
      WHEN p_xrce015 = 'C'
           LET r_xrce015_desc = cl_getmsg('axr-00303',g_dlang)
   END CASE

   RETURN r_xrce015_desc
END FUNCTION

################################################################################
# Descriptions...: 直接审核功能
# Memo...........:
# Usage..........: CALL axrt400_immediately_conf()
#                  RETURNING r_success
# Date & Author..: 2015/12/02 By aiqq
# Modify.........:
################################################################################
PRIVATE FUNCTION axrt400_immediately_conf()
   DEFINE l_xrdacomp        LIKE xrda_t.xrdacomp
   DEFINE l_success         LIKE type_t.num5
   DEFINE l_doc_success     LIKE type_t.num5
   DEFINE l_slip            LIKE ooba_t.ooba002
   DEFINE l_dfin0031        LIKE type_t.chr1
   DEFINE l_count           LIKE type_t.num5
   DEFINE r_success         LIKE type_t.num5
   DEFINE l_efin5001        LIKE type_t.chr1
   DEFINE l_ooba002         LIKE ooba_t.ooba002
   DEFINE l_flag            LIKE type_t.chr1
   DEFINE l_wc              STRING

   LET r_success = TRUE 
   
   #無資料直接返回不做處理      
   IF cl_null(g_xrda_m.xrdald) THEN 
      LET r_success = FALSE
      RETURN r_success
   END IF  
   #無資料直接返回不做處理   
   IF cl_null(g_xrda_m.xrdacomp)  THEN 
      LET r_success = FALSE
      RETURN r_success
   END IF
   #無資料直接返回不做處理   
   IF cl_null(g_xrda_m.xrdadocno) THEN 
      LET r_success = FALSE
      RETURN r_success
   END IF   
   
   CALL cl_err_collect_init()
   CALL s_transaction_begin()
   
   LET l_doc_success = TRUE
   
   CALL s_axrt400_conf_chk(g_xrda_m.xrdald,g_xrda_m.xrdadocno) RETURNING l_doc_success,l_flag
   
   IF NOT l_doc_success THEN 
      LET r_success = FALSE
   ELSE 
      IF NOT s_axrt400_conf_upd(g_xrda_m.xrdald,g_xrda_m.xrdadocno) THEN
         LET r_success = FALSE
      END IF
   END IF
   
   #異動狀態碼欄位/修改人/修改日期
   UPDATE xrda_t SET xrdastus = 'Y',
                     xrdamodid= g_user,
                     xrdamoddt= g_xrda_m.xrdamoddt
    WHERE xrdaent = g_enterprise AND xrdald = g_xrda_m.xrdald
      AND xrdadocno = g_xrda_m.xrdadocno
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      LET r_success = FALSE
   END IF

   IF l_flag = 'S' THEN
      CALL s_transaction_end('N',0)
      LET g_amt = 0
      CALL axrt400_ref_amt()
      IF g_amt > 0 THEN
         CALL axrt400_09('1',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
      ELSE
         LET g_amt = g_amt * -1
         CALL axrt400_09('2',g_xrda_m.xrdasite,g_xrda_m.xrdacomp,g_xrda_m.xrda003,g_xrda_m.xrda004,g_xrda_m.xrdadocno,g_xrda_m.xrdadocdt,g_xrda_m.xrdald,g_amt)
      END IF
      CALL axrt400_show()
      LET r_success = FALSE 
      RETURN r_success
   END IF 
   
   IF g_glaa_t.glaa121 = 'Y' THEN 
      LET l_wc = "glgadocno = '",g_xrda_m.xrdadocno,"'"
      CALL s_pre_voucher_upd('AR','R20',g_xrda_m.xrdald,'Y','','',l_wc) RETURNING l_success
      
      IF l_success = FALSE THEN 
         LET r_success = FALSE 
      END IF
   END IF 
   
   IF r_success THEN 
      CALL s_transaction_end('Y',0)
   ELSE
      CALL s_transaction_end('N',0)
      CALL cl_err_collect_show()
   END IF 
   
   RETURN r_success
   
END FUNCTION

################################################################################
# Descriptions...: 直接抛转传票功能
# Memo...........:
# Usage..........: CALL axrt400_immediately_gen()
# Date & Author..: 2015/12/02 By aiqq
# Modify.........:
################################################################################
PRIVATE FUNCTION axrt400_immediately_gen()
   DEFINE l_success         LIKE type_t.num5
   DEFINE l_doc_success     LIKE type_t.num5
   DEFINE l_slip            LIKE ooba_t.ooba002
   DEFINE l_dfin0032        LIKE type_t.chr1
   DEFINE l_count           LIKE type_t.num5
   DEFINE l_glap001         LIKE glap_t.glap001
   DEFINE la_param          RECORD
          prog              STRING,
          param             DYNAMIC ARRAY OF STRING
                            END RECORD
   DEFINE ls_js             STRING
   DEFINE l_glaa024         LIKE glaa_t.glaa024
   DEFINE l_ooac004         LIKE ooac_t.ooac004
   DEFINE l_xrdastus        LIKE xrda_t.xrdastus
  
   
   IF cl_null(g_xrda_m.xrdald)    THEN RETURN END IF   #無資料直接返回不做處理
   IF cl_null(g_xrda_m.xrdacomp)  THEN RETURN END IF   #無資料直接返回不做處理
   IF cl_null(g_xrda_m.xrdadocno) THEN RETURN END IF   #無資料直接返回不做處理
   IF NOT cl_null(g_xrda_m.xrda014)   THEN RETURN END IF   #無傳票單號不做處理

    #取得單別
    CALL s_aooi200_fin_get_slip(g_xrda_m.xrdadocno) RETURNING l_success,l_slip
    SELECT glaa024 INTO l_glaa024 FROM glaa_t WHERE glaaent = g_enterprise AND glaald = g_xrda_m.xrdald
   
    SELECT ooac004 INTO l_ooac004
      FROM ooac_t
     WHERE ooacent = g_enterprise
       AND ooac001 = l_glaa024
       AND ooac002 = l_slip
       AND ooac003 = 'D-FIN-2002'
   
    LET la_param.prog = "axrp420"
    LET la_param.param[1] = g_xrda_m.xrdald
    LET la_param.param[2] = g_xrda_m.xrdadocno
    LET la_param.param[3] = g_xrda_m.xrdasite
    LET la_param.param[4] = l_ooac004
    LET la_param.param[5] = g_xrda_m.xrdadocdt
    IF NOT cl_null(l_ooac004) THEN 
       LET la_param.param[6] = 'Y'
    ELSE 
       LET la_param.param[6] = 'N'
    END IF 
    LET ls_js = util.JSON.stringify(la_param)
    CALL cl_cmdrun_wait(ls_js)
END FUNCTION

################################################################################
# Descriptions...: 获取显示给用户看到的交易账户形态
# Memo...........:#160122-00001#5
# Usage..........:CALL axrt400_get_l_xrde008(p_xrde008,p_xrde006)
#                  RETURNING l_xrde008
# Input parameter: p_xrde008   交易账户编号
#                : p_xrde006   款别
# Return code....: l_xrde008   返回现在画面中的交易账户编号
#                : 
# Date & Author..: 2016/03/03 By 07673
# Modify.........:
################################################################################
PRIVATE FUNCTION axrt400_get_l_xrde008(p_xrde008,p_xrde006)
   DEFINE p_xrde008   LIKE xrde_t.xrde008
   DEFINE p_xrde006   LIKE xrde_t.xrde006
   DEFINE l_cnt       LIKE type_t.num5
   DEFINE l_cnt2           LIKE type_t.num5    
   DEFINE l_xrde008   LIKE xrde_t.xrde008
   #判断当前用户是否有权限查看该交易账户，如果没有权限不可看到交易账户编号，用“*”显示
   LET  l_xrde008 = p_xrde008
   IF p_xrde006 != 30 THEN 
      IF NOT cl_null(p_xrde008) THEN 
         LET l_cnt = 0 
         SELECT COUNT(*) INTO l_cnt FROM nmll_t
          WHERE nmllent = g_enterprise AND nmll002 = g_user AND nmllstus='Y'
            AND nmll001 = p_xrde008
         LET l_cnt2 = 0    
         SELECT COUNT(*) INTO l_cnt2 FROM nmlm_t 
          WHERE nmlment = g_enterprise AND nmlm002 = g_dept AND nmlmstus='Y'
            AND nmlm001 = p_xrde008  
         IF l_cnt = 0 AND l_cnt2 = 0 THEN 
             LET l_xrde008 = "********"
          END IF 
      END IF
   END IF 

   RETURN l_xrde008
  
END FUNCTION
################################################################################
# Descriptions...: 檢查兩個日期是否在同一會計期間內
# Memo...........:
# Usage..........: CALL axrt400_chk_xrde032(p_date1,p_date2)
#                  RETURNING r_success
# Input parameter: p_glaald       帳套
#                : p_date1        日期一
#                : p_date2        日期二
# Return code....: r_success      是否同一年期
# Date & Author..: 2016/03/23 By 01727
# Modify.........: #160114-00019#2 Add
################################################################################
PRIVATE FUNCTION axrt400_chk_xrde032(p_glaald,p_date1,p_date2)
   DEFINE p_glaald        LIKE glaa_t.glaald
   DEFINE p_date1         LIKE xrde_t.xrde032
   DEFINE p_date2         LIKE xrde_t.xrde032
   DEFINE r_success       LIKE type_t.num5
   DEFINE l_sql           STRING
   DEFINE l_count         LIKE type_t.num5
   DEFINE l_glaa003       LIKE glaa_t.glaa003

   SELECT glaa003 INTO l_glaa003 FROM glaa_t WHERE glaaent = g_enterprise
      AND glaald = p_glaald

   LET r_success = TRUE

   LET l_sql = " SELECT SUM(date1) - SUM(date2) FROM(                                                      " CLIPPED,
               "    SELECT glav002 * 12 + glav006 date1,0 date2 FROM glav_t WHERE glav001 = '",l_glaa003,"'" CLIPPED,
               "       AND glav004 = '",p_date1,"' AND glavent = '",g_enterprise,"' AND glavstus = 'Y'     " CLIPPED,
               "    UNION                                                                                  " CLIPPED,
               "    SELECT 0 date1,glav002 * 12 + glav006 date2 FROM glav_t WHERE glav001 = '",l_glaa003,"'" CLIPPED,
               "       AND glav004 = '",p_date2,"' AND glavent = '",g_enterprise,"' AND glavstus = 'Y')    " CLIPPED
   PREPARE axrt300_05_prep FROM l_sql

   LET l_count = 0
   EXECUTE axrt300_05_prep INTO l_count
   IF cl_null(l_count) THEN LET l_count = 1 END IF

   IF l_count <> 0 THEN
      LET r_success = FALSE
   END IF

   RETURN r_success

END FUNCTION

################################################################################
# Descriptions...: 來源於aist340的單據,刪除時整批刪除
# Memo...........:
# Usage..........: CALL axrt400_del_all()
#                  RETURNING r_success
# Input parameter: p_type         1:收款 2:帳款
#                : p_isbbdocno    發票交款單號
# Return code....: r_success      執行成功否
# Date & Author..: 2016/06/23 By 01727
# Modify.........: #160607-00015#3
################################################################################
PRIVATE FUNCTION axrt400_del_all(p_type,p_isbbdocno)
   DEFINE p_type          LIKE type_t.chr1
   DEFINE p_isbbdocno     LIKE isbb_t.isbbdocno
   DEFINE r_success       LIKE type_t.num5
   DEFINE l_count         LIKE type_t.num5
   DEFINE l_del_count     LIKE type_t.num5
   DEFINE l_sql           STRING

   LET r_success = TRUE

   IF NOT cl_ask_confirm('axr-00367') THEN
      LET r_success = FALSE
      RETURN r_success
   END IF 

   #刪除同一發票繳款單作業下存在於當前核銷作業內的所有收款資料 ---(S)---
   LET l_count     = 0
   LET l_del_count = 0
   SELECT COUNT(1) INTO l_count FROM isbb_t WHERE isbbent = g_enterprise
      AND isbbcomp  = g_xrda_m.xrdacomp
      AND isbbdocno = p_isbbdocno
   IF cl_null(l_count) THEN LET l_count = 0 END IF
   #如果是刪除收款資料時調用該函數,則標示取得的發票交款單據的收款資料已經在核銷作業中刪除一筆了
   IF p_type = '1' THEN LET l_count = l_count - 1 END IF

   DELETE FROM xrde_t WHERE xrdeent = g_enterprise
      AND xrdeld    = g_xrda_m.xrdald
      AND xrdedocno = g_xrda_m.xrdadocno
      AND xrde003||xrde004 IN (SELECT isbb002||isbb003 FROM isbb_t WHERE isbbent = g_enterprise
                                  AND isbbcomp  = g_xrda_m.xrdacomp
                                  AND isbbdocno = p_isbbdocno)
   LET l_del_count = SQLCA.SQLERRD[3]

   IF l_del_count <> l_count THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "del xrde:",SQLERRMESSAGE 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      LET r_success = FALSE
      RETURN r_success
   END IF
   #刪除同一發票繳款單作業下存在於當前核銷作業內的所有收款資料 ---(E)---

   #刪除同一發票繳款單作業下存在於當前核銷作業內的所有帳款資料 ---(S)---
   LET l_count     = 0
   LET l_del_count = 0
   SELECT COUNT(1) INTO l_count FROM isbc_t WHERE isbcent = g_enterprise
      AND isbccomp  = g_xrda_m.xrdacomp
      AND isbcdocno = p_isbbdocno
   IF cl_null(l_count) THEN LET l_count = 0 END IF
   #如果是刪除帳款資料時調用該函數,則標示取得的發票交款單據的帳款資料已經在核銷作業中刪除一筆了
   IF p_type = '2' THEN LET l_count = l_count - 1 END IF

   DELETE FROM xrce_t WHERE xrceent = g_enterprise
      AND xrceld    = g_xrda_m.xrdald
      AND xrcedocno = g_xrda_m.xrdadocno
      AND xrce003||xrce005 IN (SELECT isbc007||isbc008 FROM isbc_t WHERE isbcent = g_enterprise
                                  AND isbccomp  = g_xrda_m.xrdacomp
                                  AND isbcdocno = p_isbbdocno)
   LET l_del_count = SQLCA.SQLERRD[3]

   IF l_del_count <> l_count THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "del xrce:",SQLERRMESSAGE 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      LET r_success = FALSE
      RETURN r_success
   END IF
   #刪除同一發票繳款單作業下存在於當前核銷作業內的所有帳款資料 ---(E)---

   #清空發票繳款單第二單身核銷單號 ---(S)---
   UPDATE isbc_t SET isbc005 = '',
                     isbc006 = ''
    WHERE isbcent = g_enterprise
      AND isbccomp  = g_xrda_m.xrdacomp
      AND isbcdocno = p_isbbdocno
   #清空發票繳款單第二單身核銷單號 ---(E)---

   RETURN r_success

END FUNCTION

################################################################################
# Descriptions...: 檢查當前來源單據是否來源於aist340
# Memo...........:
# Usage..........: CALL axrt400_source_chk(p_type,p_docno,p_seq)
#                  RETURNING r_flag
# Input parameter: p_type         來源類型  1:收款資料 2:帳款資料
#                : p_docno        來源單號
#                : p_seq          來源項次
# Return code....: r_isbbdocno    發票交款單號
# Date & Author..: 2016/06/24 By 01727
# Modify.........: #160607-00015#3
################################################################################
PRIVATE FUNCTION axrt400_source_chk(p_type,p_docno,p_seq)
   DEFINE p_type          LIKE type_t.chr1
   DEFINE p_docno         LIKE xrde_t.xrdedocno
   DEFINE p_seq           LIKE xrde_t.xrdeseq
   DEFINE r_isbbdocno     LIKE isbb_t.isbbdocno

   LET r_isbbdocno = ''

   #因為aist340的資料只能通過aisp450批次產生,且不可以手工在axrt400錄入,因此一張核銷單只會對應一張發票繳款單
   IF p_type = '2' THEN
      SELECT DISTINCT isbcdocno INTO r_isbbdocno FROM isbc_t WHERE isbcent = g_enterprise
         AND isbccomp = g_xrda_m.xrdacomp
         AND isbc007  = p_docno
         AND isbc008  = p_seq
         AND isbc005  = g_xrda_m.xrdadocno
   ELSE
      SELECT DISTINCT isbbdocno INTO r_isbbdocno FROM isbb_t WHERE isbbent = g_enterprise
         AND isbb002  = p_docno
         AND isbb003  = p_seq
         AND isbbcomp = g_xrda_m.xrdacomp
         AND isbbdocno IN (SELECT DISTINCT isbcdocno FROM isbc_t WHERE isbcent = g_enterprise
                              AND isbccomp = g_xrda_m.xrdacomp
                              AND isbc005 = g_xrda_m.xrdadocno)
   END IF

   RETURN r_isbbdocno

END FUNCTION

 
{</section>}
 
