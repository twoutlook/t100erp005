#該程式未解開Section, 採用最新樣板產出!
{<section id="axct901_01.description" >}
#應用 a00 樣板自動產生(Version:3)
#+ Standard Version.....: SD版次:0011(2016-01-26 17:16:52), PR版次:0011(2017-01-03 09:21:17)
#+ Customerized Version.: SD版次:0000(1900-01-01 00:00:00), PR版次:0000(1900-01-01 00:00:00)
#+ Build......: 000034
#+ Filename...: axct901_01
#+ Description: 資料批次產生
#+ Creator....: 02114(2016-01-26 14:18:47)
#+ Modifier...: 02114 -SD/PR- 02749
 
{</section>}
 
{<section id="axct901_01.global" >}
#應用 c01b 樣板自動產生(Version:10)
#add-point:填寫註解說明 name="global.memo"
#150812-00010#3     2015/08/28 By apo       屬於調整時,改取axci201調整科目
#150824-00001#4     2015/10/09 By zhangllc  增加发出商品的两支作业axct711,axct712
#151013-00019#7     2015/10/28 By Reanna    axct707帳款對象改抓aooi100的"據點對應客戶/廠商編號"
#151208-00020#2     2015/12/15 By Sarah     增加給值xceb109=axct201的xcbl024,xceb107=axct201的xcbl025
#160318-00005#48    2016/03/31 By  pengxin  修正azzi902重复定义之错误讯息
#160318-00025#48    2016/04/29 By 07959     將重複內容的錯誤訊息置換為公用錯誤訊息(r.v)
#160519-00021#1     2016/05/19 By xianghui   程式只会产生一笔凭证单，不需要用数组记录产生的凭证单号
#160518-00013#1     2016/05/19 By xianghui  子作业调用时一开始单据别需清空
#160524-00009#1     2016/05/27 By lixiang   修正 axct907相应逻辑用g_prog判断时，写错作业代码的问题
#160527-00019#1     2016/05/27 By lixiang   新增xceb131,xceb132 栏位，axct907写入xceb时，对这两个栏位赋值(axct907执行删除时，会用到)
#160524-00015#1     2016/05/30 By lixiang   axct910产生资料时，若xccc002为空格，则匹配法人条件，若不为空，则用xccc002匹配据点
#160512-00011#1     2016/06/07 By xianghui  销货成本凭证产生维护作业(零售）整批数据产生错误
#160518-00022#1     2016/06/08 By xianghui  单身的“存货科目”应取agli161作业(glcc_t)的存货科目，“异动科目”应取axci201作业（glab_t）对应的glab005
#160705-00042#11    2016/07/15 By sakura    查詢程式段q_ooba002_1開窗，呼叫開窗前的g_qryparam.arg若是要傳入程式代號，要改傳入g_prog
#160813-00002#1     2016/09/10 By 02040     工單號一張會由多個成本域領料，因此拿掉工單單頭的成本域對單身的成本域的條件
#161019-00017#3     2016/10/20 By lixh      据点组织开窗资料整批调整
#160824-00007#224   2016/12/05 By lori      修正舊值備份寫法
#161124-00048#21  2016/12/13  By xujing     整批调整系统RECORD LIKE xxxx_t.* 星号写法
#end add-point
#add-point:填寫註解說明(客製用) name="global.memo_customerization"

#end add-point
 
IMPORT os
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目 name="global.import"

#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔 name="global.inc" name="global.inc"

#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_xcea_m        RECORD
       xceald LIKE xcea_t.xceald, 
   xceald_desc LIKE type_t.chr80, 
   xceacomp LIKE xcea_t.xceacomp, 
   xceacomp_desc LIKE type_t.chr80, 
   xcea003 LIKE xcea_t.xcea003, 
   xcea003_desc LIKE type_t.chr80, 
   xceasite LIKE xcea_t.xceasite, 
   xceasite_desc LIKE type_t.chr80, 
   l_sdate LIKE type_t.dat, 
   l_edate LIKE type_t.dat, 
   xceadocno LIKE xcea_t.xceadocno, 
   xcea001 LIKE xcea_t.xcea001, 
   xcea006 LIKE xcea_t.xcea006, 
   xcea006_desc LIKE type_t.chr80, 
   xcea007 LIKE xcea_t.xcea007, 
   xcea007_desc LIKE type_t.chr80
       END RECORD
	   
#add-point:自定義模組變數(Module Variable)(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="global.variable"
DEFINE g_bdate      LIKE glav_t.glav004 #起始年度+期別對應的起始截止日期
DEFINE g_edate      LIKE glav_t.glav004
DEFINE g_glaa001    LIKE glaa_t.glaa001
DEFINE g_glaa003    LIKE glaa_t.glaa003
DEFINE g_glaa004    LIKE glaa_t.glaa004
DEFINE g_glaa015    LIKE glaa_t.glaa015
DEFINE g_glaa016    LIKE glaa_t.glaa016
DEFINE g_glaa018    LIKE glaa_t.glaa018
DEFINE g_glaa019    LIKE glaa_t.glaa019
DEFINE g_glaa020    LIKE glaa_t.glaa020
DEFINE g_glaa022    LIKE glaa_t.glaa022
DEFINE g_glaa024    LIKE glaa_t.glaa024
DEFINE g_prog_name1 LIKE type_t.chr20
DEFINE g_xcea002    LIKE xcea_t.xcea002
DEFINE g_sql,g_sql1,g_sql2   STRING
DEFINE g_wc_xcck026 STRING            #20150731 add lujh
DEFINE g_wc_xcck021 STRING            #add by zhanghr 151228--construct 原因码
DEFINE g_wc_xcck028 STRING            #add by zhanghr 151228--construct 品类
DEFINE g_xcea004    LIKE xcea_t.xcea004
DEFINE g_xcea005    LIKE xcea_t.xcea005
#动态数组，回传新生成的单据账套+编号
#add by zhanghr 151120 str
 TYPE type_rec_d RECORD
     xceald  LIKE xcea_t.xceald,
  xceadocno  LIKE xcea_t.xceadocno
  END RECORD
  
DEFINE g_rec_d DYNAMIC ARRAY OF type_rec_d
DEFINE g_rec_d1 DYNAMIC ARRAY OF type_rec_d  #add by zhr 151231


DEFINE g_xcea_m_o        type_g_xcea_m   #160824-00007#224 161205 by lori add
#end add-point
 
DEFINE g_xcea_m        type_g_xcea_m
 
   DEFINE g_xceald_t LIKE xcea_t.xceald
DEFINE g_xceadocno_t LIKE xcea_t.xceadocno
 
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
 
#add-point:自定義客戶專用模組變數(Module Variable) name="global.variable_customerization"

#end add-point
 
#add-point:傳入參數說明(global.argv) name="global.argv"
 
#end add-point
 
{</section>}
 
{<section id="axct901_01.input" >}
#+ 資料輸入
PUBLIC FUNCTION axct901_01(--)
   #add-point:input段變數傳入 name="input.get_var"
   p_xcea002	
   #end add-point
   )
   #add-point:input段define name="input.define_customerization"
   
   #end add-point
   DEFINE l_ac_t          LIKE type_t.num10       #未取消的ARRAY CNT 
   DEFINE l_allow_insert  LIKE type_t.num5        #可新增否 
   DEFINE l_allow_delete  LIKE type_t.num5        #可刪除否  
   DEFINE l_count         LIKE type_t.num10
   DEFINE l_insert        LIKE type_t.num5
   DEFINE p_cmd           LIKE type_t.chr5
   #add-point:input段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="input.define"
   DEFINE l_success       LIKE type_t.chr1
   DEFINE l_n             LIKE type_t.chr5
   DEFINE p_xcea002       LIKE xcea_t.xcea002
   #end add-point
   
   #畫面開啟 (identifier)
   OPEN WINDOW w_axct901_01 WITH FORM cl_ap_formpath("axc","axct901_01")
 
   #瀏覽頁簽資料初始化
   CALL cl_ui_init()
   
   LET g_qryparam.state = "i"
   LET p_cmd = 'a'
   
   #輸入前處理
   #add-point:單頭前置處理 name="input.pre_input"
   WHENEVER ERROR CALL cl_err_msg_log
   
   LET g_xcea002=p_xcea002
   LET g_xcea_m.xceadocno = ''   #160518-00013#1
   #end add-point
  
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
      #輸入開始
      INPUT BY NAME g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea003,g_xcea_m.xceasite,g_xcea_m.l_sdate, 
          g_xcea_m.l_edate,g_xcea_m.xceadocno,g_xcea_m.xcea001,g_xcea_m.xcea006,g_xcea_m.xcea007 ATTRIBUTE(WITHOUT  
          DEFAULTS)
         
         #自訂ACTION
         #add-point:單頭前置處理 name="input.action"
  
         #end add-point
         
         #自訂ACTION(master_input)
         
         
         BEFORE INPUT
            #add-point:單頭輸入前處理 name="input.before_input"
            IF cl_null(g_xcea_m.xceadocno) THEN
               LET g_xcea_m.xceald = ''
               LET g_xcea_m.xceacomp = ''
               LET g_xcea_m.xcea003 = ''
               LET g_xcea_m.l_sdate = NULL
               LET g_xcea_m.l_edate = NULL
               LET g_xcea_m.xceadocno = ''
               LET g_xcea_m.xcea001 = ''
               LET g_xcea_m.xcea006 = g_user
               LET g_xcea_m.xcea007 = g_dept
               LET g_xcea_m.xcea001 = g_today
               CALL s_axc_set_site_default() RETURNING g_xcea_m.xceacomp,g_xcea_m.xceald,g_xcea004,g_xcea005,g_xcea_m.xcea003
               DISPLAY BY NAME g_xcea_m.xcea001
               LET g_xcea_m.l_sdate = MDY(g_xcea005,1,g_xcea004)
               LET g_xcea_m.l_edate = MDY(g_xcea005,1,g_xcea004)
               DISPLAY BY NAME g_xcea_m.l_sdate,g_xcea_m.l_edate
            END IF
            
            LET g_xcea_m.xcea006_desc = s_desc_get_person_desc(g_xcea_m.xcea006)
            LET g_xcea_m.xcea007_desc = s_desc_get_department_desc(g_xcea_m.xcea007)
            DISPLAY BY NAME g_xcea_m.xcea006_desc,g_xcea_m.xcea007_desc
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceacomp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceacomp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceacomp_desc 
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceald
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceald_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceald_desc 
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xcea003
            CALL ap_ref_array2(g_ref_fields,"SELECT xcatl003 FROM xcatl_t WHERE xcatlent='"||g_enterprise||"' AND xcatl001=? AND xcatl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xcea003_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xcea003_desc
   
   
            CASE g_xcea002
               WHEN '1' LET g_prog_name1 = 'axct901' 
               WHEN '2' LET g_prog_name1 = 'axct902'
               WHEN '3' LET g_prog_name1 = 'axct903'
               WHEN '4' LET g_prog_name1 = 'axct904' 
               WHEN '5' LET g_prog_name1 = 'axct905' 
               WHEN '6' LET g_prog_name1 = 'axct906' 
               WHEN '7' LET g_prog_name1 = 'axct907' 
               WHEN '8' LET g_prog_name1 = 'axct908'
               WHEN '9' LET g_prog_name1 = 'axct909'
               WHEN '10' LET g_prog_name1 = 'axct910' 
               WHEN '11' LET g_prog_name1 = 'axct911'  #add zhangllc 151009
               WHEN '12' LET g_prog_name1 = 'axct912'  #add zhangllc 151009
            END CASE
            CALL cl_set_comp_entry("xcea003",FALSE)
            
            LET g_xcea_m_o.* = g_xcea_m.*   #160824-00007#224 161205 by lori add
            #end add-point
          
                  #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xceald
            
            #add-point:AFTER FIELD xceald name="input.a.xceald"
            #此段落由子樣板a05產生
            IF  NOT cl_null(g_xcea_m.xceald) AND NOT cl_null(g_xcea_m.xceadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xcea_m.xceald != g_xceald_t  OR g_xcea_m.xceadocno != g_xceadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xcea_t WHERE "||"xceaent = '" ||g_enterprise|| "' AND "||"xceald = '"||g_xcea_m.xceald ||"' AND "|| "xceadocno = '"||g_xcea_m.xceadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            
            IF NOT cl_null(g_xcea_m.xceald) THEN
               #檢查是否存在 帳別資料檔 中
               IF NOT ap_chk_isExist(g_xcea_m.xceald,"SELECT COUNT(*) FROM glaa_t WHERE "||"glaaent = '" ||g_enterprise|| "' AND "||"glaald = ? ",'agl-00016',1) THEN
                  LET g_xcea_m.xceald = g_xceald_t
                  CALL axct901_01_get_xceald_desc()
                  CALL axct901_01_get_xceacomp_desc()                  
                  NEXT FIELD CURRENT
               END IF   
               
               #檢查是否 有效
#               IF NOT ap_chk_isExist(g_xcea_m.xceald,"SELECT COUNT(*) FROM glaa_t WHERE "||"glaaent = '" ||g_enterprise|| "' AND "||"glaald = ? AND glaastus = 'Y'",'agl-00051',1) THEN   #160318-00005#48   mark
               IF NOT ap_chk_isExist(g_xcea_m.xceald,"SELECT COUNT(*) FROM glaa_t WHERE "||"glaaent = '" ||g_enterprise|| "' AND "||"glaald = ? AND glaastus = 'Y'",'sub-01302','agli010') THEN   #160318-00005#48   add
                  LET g_xcea_m.xceald = g_xceald_t
                  CALL axct901_01_get_xceald_desc()
                  CALL axct901_01_get_xceacomp_desc()                  
                  NEXT FIELD CURRENT
               END IF     
            END IF   
            
            IF NOT cl_null(g_xcea_m.xceald) THEN 
               IF g_xcea_m.xceald <> g_xcea_m_o.xceald OR cl_null(g_xcea_m_o.xceald) OR cl_null(g_xceald_t) THEN   #160824-00007#224 161205 by lori add
                  CALL axct901_01_get_glaa()
                  #160824-00007#224 161205 by lori add---(S)
                  #默認帶出帳套歸屬法人
                  IF NOT cl_null(g_xcea_m.xceald) THEN 
                     CALL axct901_01_get_xceacomp()
                  END IF
                  #默認年度月份為當前成本計算年度期別
                  IF NOT cl_null(g_xcea_m.xceacomp) THEN
                     CALL cl_get_para(g_enterprise,g_xcea_m.xceacomp,'S-FIN-6010') RETURNING g_xcea004
                     CALL cl_get_para(g_enterprise,g_xcea_m.xceacomp,'S-FIN-6011') RETURNING g_xcea005             
                  END IF
                  
                  CALL axct901_01_get_xceacomp_desc()
                  #160824-00007#224 161205 by lori add---(E)   
               END IF   #160824-00007#224 161205 by lori add   
            END IF 
            
            #160824-00007#224 161205 by lori mark---(S)
            ##默認帶出帳套歸屬法人
            #IF NOT cl_null(g_xcea_m.xceald) THEN 
            #   CALL axct901_01_get_xceacomp()
            #END IF
            ##默認年度月份為當前成本計算年度期別
            #IF NOT cl_null(g_xcea_m.xceacomp) THEN
            #   CALL cl_get_para(g_enterprise,g_xcea_m.xceacomp,'S-FIN-6010') RETURNING g_xcea004
            #   CALL cl_get_para(g_enterprise,g_xcea_m.xceacomp,'S-FIN-6011') RETURNING g_xcea005             
            #END IF
            #CALL axct901_01_get_xceald_desc()
            #CALL axct901_01_get_xceacomp_desc()
            #160824-00007#224 161205 by lori mark---(E)
            
            CALL axct901_01_get_xceald_desc()         #160824-00007#224 161205 by lori add
            LET g_xcea_m_o.xceald = g_xcea_m.xceald   #160824-00007#224 161205 by lori add
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xceald
            #add-point:BEFORE FIELD xceald name="input.b.xceald"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xceald
            #add-point:ON CHANGE xceald name="input.g.xceald"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xceacomp
            
            #add-point:AFTER FIELD xceacomp name="input.a.xceacomp"
            #CALL axct901_01_get_xceacomp_desc()


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xceacomp
            #add-point:BEFORE FIELD xceacomp name="input.b.xceacomp"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xceacomp
            #add-point:ON CHANGE xceacomp name="input.g.xceacomp"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xcea003
            
            #add-point:AFTER FIELD xcea003 name="input.a.xcea003"
            IF NOT cl_null(g_xcea_m.xcea003) THEN 
               #檢查是否存在于 成本類型設置檔 中
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? ",'agl-00194',1) THEN
                  LET g_xcea_m.xcea003 = ''
                  CALL axct901_01_get_xcea003_desc()                  
                  NEXT FIELD CURRENT
               END IF
               
               #檢查是否 有效
#               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? AND xcatstus = 'Y' ",'agl-00195',1) THEN   #160318-00005#48   mark
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? AND xcatstus = 'Y' ",'sub-01302','axci100') THEN    #160318-00005#48   add
                  LET g_xcea_m.xcea003 = ''
                  CALL axct901_01_get_xcea003_desc()                  
                  NEXT FIELD CURRENT
               END IF                   
            END IF
            
            CALL axct901_01_get_xcea003_desc() 


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xcea003
            #add-point:BEFORE FIELD xcea003 name="input.b.xcea003"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xcea003
            #add-point:ON CHANGE xcea003 name="input.g.xcea003"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xceasite
            
            #add-point:AFTER FIELD xceasite name="input.a.xceasite"
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceasite
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceasite_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceasite_desc


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xceasite
            #add-point:BEFORE FIELD xceasite name="input.b.xceasite"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xceasite
            #add-point:ON CHANGE xceasite name="input.g.xceasite"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD l_sdate
            #add-point:BEFORE FIELD l_sdate name="input.b.l_sdate"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD l_sdate
            
            #add-point:AFTER FIELD l_sdate name="input.a.l_sdate"
            IF NOT cl_null(g_xcea_m.l_sdate) AND NOT cl_null(g_xcea_m.l_edate) THEN
               #截止日期不能小于起始日期
               IF g_xcea_m.l_edate<g_xcea_m.l_sdate THEN
                  LET g_xcea_m.l_edate = g_xcea_m.l_sdate
                  DISPLAY BY NAME g_xcea_m.l_edate
               END IF
               
               #起始日期和截止日期要在同一个月里面
               IF YEAR(g_xcea_m.l_edate)*100+MONTH(g_xcea_m.l_edate)<>YEAR(g_xcea_m.l_sdate)*100+MONTH(g_xcea_m.l_sdate) THEN
                  LET g_xcea_m.l_edate = g_xcea_m.l_sdate
                  DISPLAY BY NAME g_xcea_m.l_edate
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE l_sdate
            #add-point:ON CHANGE l_sdate name="input.g.l_sdate"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD l_edate
            #add-point:BEFORE FIELD l_edate name="input.b.l_edate"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD l_edate
            
            #add-point:AFTER FIELD l_edate name="input.a.l_edate"
            IF NOT cl_null(g_xcea_m.l_sdate) AND NOT cl_null(g_xcea_m.l_edate) THEN
               #截止日期不能小于起始日期
               IF g_xcea_m.l_edate<g_xcea_m.l_sdate THEN
                  LET g_xcea_m.l_sdate = g_xcea_m.l_edate
                  DISPLAY BY NAME g_xcea_m.l_sdate
               END IF
               
               #起始日期和截止日期要在同一个月里面
               IF YEAR(g_xcea_m.l_edate)*100+MONTH(g_xcea_m.l_edate)<>YEAR(g_xcea_m.l_sdate)*100+MONTH(g_xcea_m.l_sdate) THEN
                  LET g_xcea_m.l_sdate = g_xcea_m.l_edate
                  DISPLAY BY NAME g_xcea_m.l_sdate
               END IF
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE l_edate
            #add-point:ON CHANGE l_edate name="input.g.l_edate"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xceadocno
            #add-point:BEFORE FIELD xceadocno name="input.b.xceadocno"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xceadocno
            
            #add-point:AFTER FIELD xceadocno name="input.a.xceadocno"
            #此段落由子樣板a05產生
            IF  NOT cl_null(g_xcea_m.xceald) AND NOT cl_null(g_xcea_m.xceadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xcea_m.xceald != g_xceald_t  OR g_xcea_m.xceadocno != g_xceadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xcea_t WHERE "||"xceaent = '" ||g_enterprise|| "' AND "||"xceald = '"||g_xcea_m.xceald ||"' AND "|| "xceadocno = '"||g_xcea_m.xceadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
                  IF NOT s_aooi200_fin_chk_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1) THEN
                     LET g_xcea_m.xceadocno = g_xceadocno_t
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            



            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xceadocno
            #add-point:ON CHANGE xceadocno name="input.g.xceadocno"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xcea001
            #add-point:BEFORE FIELD xcea001 name="input.b.xcea001"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xcea001
            
            #add-point:AFTER FIELD xcea001 name="input.a.xcea001"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xcea001
            #add-point:ON CHANGE xcea001 name="input.g.xcea001"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xcea006
            
            #add-point:AFTER FIELD xcea006 name="input.a.xcea006"

            IF NOT cl_null(g_xcea_m.xcea006) THEN
               SELECT DISTINCT ooag003 INTO g_xcea_m.xcea007
                 FROM ooag_t
                 WHERE ooagent = g_enterprise
                   AND ooag001 = g_xcea_m.xcea006
                 ORDER BY ooag003
                 
               CALL s_desc_get_department_desc(g_xcea_m.xcea007) RETURNING g_xcea_m.xcea007_desc
               DISPLAY BY NAME g_xcea_m.xcea007
               DISPLAY g_xcea_m.xcea007_desc TO xcea007_desc
            END IF

            CALL s_desc_get_person_desc(g_xcea_m.xcea006) RETURNING g_xcea_m.xcea006_desc
            DISPLAY g_xcea_m.xcea006_desc TO xcea006_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xcea006
            #add-point:BEFORE FIELD xcea006 name="input.b.xcea006"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xcea006
            #add-point:ON CHANGE xcea006 name="input.g.xcea006"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD xcea007
            
            #add-point:AFTER FIELD xcea007 name="input.a.xcea007"

#            IF NOT cl_null(g_xcea_m.xcea007) THEN
#              #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
#              INITIALIZE g_chkparam.* TO NULL
#              #設定g_chkparam.*的參數
#              LET g_chkparam.arg1 = g_xcea_m.xcea007
#              LET g_chkparam.arg2 = g_xcea_m.xcea001
#              
#              #呼叫檢查存在並帶值的library
#              IF NOT cl_chk_exist('v_ooeg001') THEN
#                 #檢查失敗時後續處理
#                 LET g_xcea_m.xcea007 = ''
#                 NEXT FIELD xcea007
#              END IF
#            END IF
            CALL s_desc_get_department_desc(g_xcea_m.xcea007) RETURNING g_xcea_m.xcea007_desc
            DISPLAY g_xcea_m.xcea007_desc TO xcea007_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD xcea007
            #add-point:BEFORE FIELD xcea007 name="input.b.xcea007"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE xcea007
            #add-point:ON CHANGE xcea007 name="input.g.xcea007"
            
            #END add-point 
 
 
 #欄位檢查
                  #Ctrlp:input.c.xceald
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xceald
            #add-point:ON ACTION controlp INFIELD xceald name="input.c.xceald"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xceald             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_user
            LET g_qryparam.arg2 = g_dept
            
            CALL q_authorised_ld()                                #呼叫開窗

            LET g_xcea_m.xceald = g_qryparam.return1              

            CALL axct901_01_get_xceald_desc()
            
            DISPLAY g_xcea_m.xceald TO xceald              #
            DISPLAY g_xcea_m.xceald_desc TO xceald_desc

            NEXT FIELD xceald                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xceacomp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xceacomp
            #add-point:ON ACTION controlp INFIELD xceacomp name="input.c.xceacomp"
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xcea_m.xceacomp   
            #CALL q_ooef001()   #161019-00017#3
            CALL q_ooef001_2()  #161019-00017#3 
            LET g_xcea_m.xceacomp = g_qryparam.return1        
            CALL s_desc_get_department_desc(g_xcea_m.xceacomp) RETURNING g_xcea_m.xceacomp_desc
            DISPLAY BY NAME g_xcea_m.xceacomp,g_xcea_m.xceacomp_desc 
            NEXT FIELD xceacomp

            #END add-point
 
 
         #Ctrlp:input.c.xcea003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xcea003
            #add-point:ON ACTION controlp INFIELD xcea003 name="input.c.xcea003"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xcea003             #給予default值
            
            CALL q_xcat001()                                #呼叫開窗

            LET g_xcea_m.xcea003 = g_qryparam.return1              

            CALL axct901_01_get_xcea003_desc() 

            DISPLAY g_xcea_m.xcea003 TO xcea003              #
            DISPLAY g_xcea_m.xcea003_desc TO xcea003_desc

            NEXT FIELD xcea003                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xceasite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xceasite
            #add-point:ON ACTION controlp INFIELD xceasite name="input.c.xceasite"
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_xcea_m.xceasite   
            LET g_qryparam.where = " ooef201 = 'Y'"
            #CALL q_ooef001()   #161019-00017#3
            CALL q_ooef001_2()  #161019-00017#3             
            LET g_xcea_m.xceasite = g_qryparam.return1        
            CALL s_desc_get_department_desc(g_xcea_m.xceasite) RETURNING g_xcea_m.xceasite_desc
            DISPLAY BY NAME g_xcea_m.xceasite,g_xcea_m.xceasite_desc 
            NEXT FIELD xceasite
            #END add-point
 
 
         #Ctrlp:input.c.l_sdate
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD l_sdate
            #add-point:ON ACTION controlp INFIELD l_sdate name="input.c.l_sdate"
            
            #END add-point
 
 
         #Ctrlp:input.c.l_edate
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD l_edate
            #add-point:ON ACTION controlp INFIELD l_edate name="input.c.l_edate"
            
            #END add-point
 
 
         #Ctrlp:input.c.xceadocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xceadocno
            #add-point:ON ACTION controlp INFIELD xceadocno name="input.c.xceadocno"
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xceadocno             #給予default值

            #給予arg
               
            LET g_qryparam.arg1 = g_glaa024
            #LET g_qryparam.arg2 = g_prog_name1   #160705-00042#11 160715 by sakura mark
            LET g_qryparam.arg2 = g_prog          #160705-00042#11 160715 by sakura add
            CALL q_ooba002_1()                                #呼叫開窗

            LET g_xcea_m.xceadocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xcea_m.xceadocno TO xceadocno              #顯示到畫面上
            
            NEXT FIELD xceadocno 
            #END add-point
 
 
         #Ctrlp:input.c.xcea001
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xcea001
            #add-point:ON ACTION controlp INFIELD xcea001 name="input.c.xcea001"
            
            #END add-point
 
 
         #Ctrlp:input.c.xcea006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xcea006
            #add-point:ON ACTION controlp INFIELD xcea006 name="input.c.xcea006"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xcea006             #給予default值

            IF NOT cl_null(g_xcea_m.xcea007) THEN
               LET g_qryparam.where = " ooag003 = '",g_xcea_m.xcea007,"'"
            END IF

            CALL q_ooag001()                                #呼叫開窗

            LET g_xcea_m.xcea006 = g_qryparam.return1              

            CALL s_desc_get_person_desc(g_xcea_m.xcea006) RETURNING g_xcea_m.xcea006_desc
            
            DISPLAY g_xcea_m.xcea006 TO xcea006              #
            DISPLAY g_xcea_m.xcea006_desc TO xcea006_desc 

            LET g_qryparam.where = '' 

            NEXT FIELD xcea006                          #返回原欄位


            #END add-point
 
 
         #Ctrlp:input.c.xcea007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD xcea007
            #add-point:ON ACTION controlp INFIELD xcea007 name="input.c.xcea007"
            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xcea007             #給予default值
 
            IF NOT cl_null(g_xcea_m.xcea006) THEN
               LET g_qryparam.where = " ooag001 = '",g_xcea_m.xcea006,"'"
               CALL q_ooag003_1()
            ELSE
               LET g_qryparam.arg1 = g_today  
               CALL q_ooeg001() 
            END IF  

            LET g_xcea_m.xcea007 = g_qryparam.return1              
 
            CALL s_desc_get_department_desc(g_xcea_m.xcea007) RETURNING g_xcea_m.xcea007_desc
            DISPLAY g_xcea_m.xcea007 TO xcea007              #
            DISPLAY g_xcea_m.xcea007_desc TO xcea007_desc  
            
            NEXT FIELD xcea007                          #返回原欄位


            #END add-point
 
 
 #欄位開窗
 
         AFTER INPUT
            #add-point:單頭輸入後處理 name="input.after_input"
            IF INT_FLAG THEN
               #160519-00021#1---mark-s 
               #IF g_xcea002 = '7' OR g_xcea002 = '6'  THEN   #modify by zhr 151231
               #   RETURN g_rec_d
               #ELSE
               #160519-00021#1---mark-e
                  RETURN g_xcea_m.xceald,g_xcea_m.xceadocno
               #END IF   #160519-00021#1---mark
            END IF
#检查成本计算类型，取消，关闭时不用检查，只有按确定才会检查
            IF NOT cl_null(g_xcea_m.xcea003) THEN 
               #檢查是否存在于 成本類型設置檔 中
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? ",'agl-00194',1) THEN
                  LET g_xcea_m.xcea003 = ''
                  CALL axct901_01_get_xcea003_desc()                  
                  NEXT FIELD xceald
               END IF
               
               #檢查是否 有效
#               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? AND xcatstus = 'Y' ",'agl-00195',1) THEN   #160318-00005#48   mark
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? AND xcatstus = 'Y' ",'sub-01302','axci100') THEN   #160318-00005#48   add
                  LET g_xcea_m.xcea003 = ''
                  CALL axct901_01_get_xcea003_desc()                  
                  NEXT FIELD xceald
               END IF  
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'axc-00706'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()
               NEXT FIELD xceald            
            END IF
            
            LET g_xcea004 = YEAR(g_xcea_m.l_sdate)
            LET g_xcea005 = MONTH(g_xcea_m.l_edate)
            #end add-point
            
      END INPUT
    
      #add-point:自定義input name="input.more_input"
      #add by zhr 151228 str---
      #经营类别xcck026   
      CONSTRUCT BY NAME g_wc_xcck026 ON xcck026                         
          BEFORE CONSTRUCT         
          ON ACTION controlp INFIELD xcck026
             INITIALIZE g_qryparam.* TO NULL
             LET g_qryparam.state = 'c'
             LET g_qryparam.reqry = FALSE
             LET g_qryparam.arg1 = '6013'
             CALL q_gzcb001()#q_gzcb001
             DISPLAY g_qryparam.return1 TO xcck026      #顯示到畫面上
             NEXT FIELD xcck026  
      END CONSTRUCT 
    
      CONSTRUCT BY NAME g_wc_xcck021 ON xcck021                         
          BEFORE CONSTRUCT       
          ON ACTION controlp INFIELD xcck021
             INITIALIZE g_qryparam.* TO NULL
             LET g_qryparam.state = 'c'
             LET g_qryparam.reqry = FALSE
             LET g_qryparam.arg1 = '216'
             CALL q_oocq002()
             DISPLAY g_qryparam.return1 TO xcck021  
             NEXT FIELD xcck021 
      END CONSTRUCT 
     
      CONSTRUCT BY NAME g_wc_xcck028 ON xcck028                           
          BEFORE CONSTRUCT
          ON ACTION controlp INFIELD xcck028
             INITIALIZE g_qryparam.* TO NULL
             LET g_qryparam.state = 'c'
             LET g_qryparam.reqry = FALSE
             LET g_qryparam.where = " rtax004 = '3' "
             CALL q_rtax001()
             DISPLAY g_qryparam.return1 TO xcck028      #顯示到畫面上
             NEXT FIELD xcck028
      END CONSTRUCT 
      #add by zhr 151228 end
      #end add-point
    
      #公用action
      ON ACTION accept
         ACCEPT DIALOG
        
      ON ACTION cancel
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
 
   #add-point:畫面關閉前 name="input.before_close"
   
   #end add-point
   
   #畫面關閉
   CLOSE WINDOW w_axct901_01 
   
   #add-point:input段after input name="input.post_input"
   IF INT_FLAG THEN
      #160519-00021#1---mark-s
      #IF g_xcea002 = '7'  OR g_xcea002 = '6'  THEN  
      #   RETURN g_rec_d
      #ELSE 
      #160519-00021#1---mark-e
         RETURN g_xcea_m.xceald,g_xcea_m.xceadocno
      #END IF  #160519-00021#1---mark
   END IF

   #20150731--add--str--lujh
   IF cl_null(g_wc_xcck026) THEN     
      LET g_wc_xcck026 = " 1=1 "
   END IF
   #20150731--add--end--lujh
   #add by zhr 151228 str
   IF cl_null(g_wc_xcck021) THEN     
      LET g_wc_xcck021= " 1=1 "
   END IF
   IF cl_null(g_wc_xcck028) THEN     
      LET g_wc_xcck028 = " 1=1 "
   END IF
   #add by zhr 151228 end

   CALL s_transaction_begin()
   CALL cl_err_collect_init() #汇总错误讯息初始化
   CASE g_xcea002 
      WHEN '1'   #axct701
         CALL axct901_01_check('1') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins() RETURNING l_success
         END IF
      WHEN '2'   #axct702
         CALL axct901_01_check('2') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_2() RETURNING l_success
         END IF
      WHEN '3'   #axct703
         CALL axct901_01_check('3') RETURNING l_success
         IF l_success = TRUE THEN
            CALL axct901_01_ins_3() RETURNING l_success
         END IF
      WHEN '4'   #axct704
         CALL axct901_01_check('4') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_4() RETURNING l_success
         END IF
      WHEN '5'   #axct705
         CALL axct901_01_check('5') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_5() RETURNING l_success 
         END IF
      WHEN '6'   #axct706
         CALL axct901_01_check('6') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_6() RETURNING l_success             
         END IF
      WHEN '7'   #axct707
         CALL axct901_01_check('7') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_7() RETURNING l_success             
         END IF
      WHEN '8'   #axct708
         CALL axct901_01_check('8') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_8() RETURNING l_success             
         END IF
      WHEN '9'   #axct709
         CALL axct901_01_check('9') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_9() RETURNING l_success             
         END IF
      WHEN '10'  #axct710
         CALL axct901_01_check('10') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_10() RETURNING l_success             
         END IF
      #add zhangllc 151009 --begin
      WHEN '11'  #axct711
         CALL axct901_01_check('11') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_11() RETURNING l_success             
         END IF
      WHEN '12'  #axct712
         CALL axct901_01_check('12') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct901_01_ins_11() RETURNING l_success             
         END IF
      #add zhangllc 151009 --end
   END CASE

   CALL axct901_01_del_all() RETURNING l_success   #没有单身，则删除单头，同时提示无资料产生
   IF l_success = 'Y' THEN      
      CALL s_transaction_end('Y','0')
   ELSE
      CALL s_transaction_end('N','0')
   END IF
   CALL cl_err_collect_show()
   IF l_success = 'Y' THEN
      #160519-00021#1---mark-s
      #IF g_xcea002 = '7'  OR g_xcea002 = '6'  THEN  
      #   RETURN g_rec_d
      #ELSE 
      #160519-00021#1---mark-e
         RETURN g_xcea_m.xceald,g_xcea_m.xceadocno
      #END IF 
   ELSE
      #160519-00021#1---mark-s
      #IF g_xcea002 = '7'  OR g_xcea002 = '6'  THEN  
      #   RETURN g_rec_d
      #ELSE
      #160519-00021#1---mark-e      
         RETURN g_xcea_m.xceald,g_xcea_m.xceadocno
      #END IF   #160519-00021#1---mark
   END IF
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="axct901_01.other_dialog" readonly="Y" >}

 
{</section>}
 
{<section id="axct901_01.other_function" readonly="Y" >}

################################################################################
# Descriptions...: 獲取帳套說明
# Memo...........:
# Usage..........: CALL axct901_01_get_xceald_desc()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_get_xceald_desc()
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceald
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceald_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceald_desc
END FUNCTION

################################################################################
# Descriptions...: 默認帶出帳套的所屬法人
# Memo...........:
# Usage..........: CALL axct901_01_get_xceacomp()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_get_xceacomp()
   SELECT glaacomp INTO g_xcea_m.xceacomp FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = g_xcea_m.xceald
   CALL axct901_01_get_xceacomp_desc()   
   DISPLAY BY NAME g_xcea_m.xceacomp,g_xcea_m.xceacomp_desc   
   
   LET g_xcea_m_o.xceacomp = g_xcea_m.xceacomp   #160824-00007#224 161205 by lori add
END FUNCTION

################################################################################
# Descriptions...: 獲取法人說明
# Memo...........:
# Usage..........: CALL  axct901_01_get_xceacomp_desc()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_get_xceacomp_desc()
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceacomp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceacomp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceacomp_desc
END FUNCTION

################################################################################
# Descriptions...: 獲取成本計算類型說明
# Memo...........:
# Usage..........: CALL axct901_01_get_xcea003_desc()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_get_xcea003_desc()
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xcea003
            CALL ap_ref_array2(g_ref_fields,"SELECT xcatl003 FROM xcatl_t WHERE xcatlent='"||g_enterprise||"' AND xcatl001=? AND xcatl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xcea003_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xcea003_desc
END FUNCTION

################################################################################
# Descriptions...: 根據帳套獲取相關資料
# Memo...........:
# Usage..........: CALL axct901_01_get_glaa()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_get_glaa()
   #會計週期參照表、會計科目參照表、單據別參照表
   SELECT glaa001,glaa003,glaa004,glaa015,glaa016,glaa018,glaa019,glaa020,glaa022,glaa024,glaa120 
     INTO g_glaa001,g_glaa003,g_glaa004,g_glaa015,g_glaa016,g_glaa018,g_glaa019,g_glaa020,g_glaa022,g_glaa024,g_xcea_m.xcea003 
     FROM glaa_t
    WHERE glaaent = g_enterprise 
      AND glaald = g_xcea_m.xceald  


    INITIALIZE g_ref_fields TO NULL
    LET g_ref_fields[1] = g_xcea_m.xcea003
    CALL ap_ref_array2(g_ref_fields,"SELECT xcatl003 FROM xcatl_t WHERE xcatlent='"||g_enterprise||"' AND xcatl001=? AND xcatl002='"||g_dlang||"'","") RETURNING g_rtn_fields
    LET g_xcea_m.xcea003_desc = '', g_rtn_fields[1] , ''
    DISPLAY BY NAME g_xcea_m.xcea003_desc
END FUNCTION

################################################################################
# Descriptions...: 新增xcea,xceb,xcec  1.在製投入憑證 axct701
# Memo...........:
# Usage..........: CALL axct901_01_ins()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins()
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xccd          RECORD LIKE xccd_t.*
#DEFINE l_xcce          RECORD LIKE xcce_t.*
#DEFINE l_xcch          RECORD LIKE xcch_t.*
#DEFINE l_xcci          RECORD LIKE xcci_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xccd RECORD  #在製主件成本期異動統計檔
       xccdent LIKE xccd_t.xccdent, #企业编号
       xccdcomp LIKE xccd_t.xccdcomp, #法人组织
       xccdld LIKE xccd_t.xccdld, #账套
       xccd001 LIKE xccd_t.xccd001, #账套本位币顺序
       xccd002 LIKE xccd_t.xccd002, #成本域
       xccd003 LIKE xccd_t.xccd003, #成本计算类型
       xccd004 LIKE xccd_t.xccd004, #年度
       xccd005 LIKE xccd_t.xccd005, #期别
       xccd006 LIKE xccd_t.xccd006, #工单编号
       xccd007 LIKE xccd_t.xccd007, #主件料号
       xccd008 LIKE xccd_t.xccd008, #产品特征
       xccd009 LIKE xccd_t.xccd009, #批号
       xccd010 LIKE xccd_t.xccd010, #项目号
       xccd011 LIKE xccd_t.xccd011, #核算币种
       xccd012 LIKE xccd_t.xccd012, #重复性成产否
       xccd013 LIKE xccd_t.xccd013, #成产计划号
       xccd014 LIKE xccd_t.xccd014, #BOM特性
       xccd101 LIKE xccd_t.xccd101, #上期结存数量
       xccd102 LIKE xccd_t.xccd102, #上期结存金额
       xccd102a LIKE xccd_t.xccd102a, #上期结存金额-材料
       xccd102b LIKE xccd_t.xccd102b, #上期结存金额-人工
       xccd102c LIKE xccd_t.xccd102c, #上期结存金额-加工
       xccd102d LIKE xccd_t.xccd102d, #上期结存金额-制费一
       xccd102e LIKE xccd_t.xccd102e, #上期结存金额-制费二
       xccd102f LIKE xccd_t.xccd102f, #上期结存金额-制费三
       xccd102g LIKE xccd_t.xccd102g, #上期结存金额-制费四
       xccd102h LIKE xccd_t.xccd102h, #上期结存金额-制费五
       xccd200 LIKE xccd_t.xccd200, #本期投入工时
       xccd201 LIKE xccd_t.xccd201, #本期投入数量
       xccd202 LIKE xccd_t.xccd202, #本期本阶投入金额
       xccd202a LIKE xccd_t.xccd202a, #本期本阶投入金额-材料
       xccd202b LIKE xccd_t.xccd202b, #本期本阶投入金额-人工
       xccd202c LIKE xccd_t.xccd202c, #本期本阶投入金额-加工
       xccd202d LIKE xccd_t.xccd202d, #本期本阶投入金额-制费一
       xccd202e LIKE xccd_t.xccd202e, #本期本阶投入金额-制费二
       xccd202f LIKE xccd_t.xccd202f, #本期本阶投入金额-制费三
       xccd202g LIKE xccd_t.xccd202g, #本期本阶投入金额-制费四
       xccd202h LIKE xccd_t.xccd202h, #本期本阶投入金额-制费五
       xccd204 LIKE xccd_t.xccd204, #本期下阶投入金额
       xccd204a LIKE xccd_t.xccd204a, #本期下阶投入金额-材料
       xccd204b LIKE xccd_t.xccd204b, #本期下阶投入金额-人工
       xccd204c LIKE xccd_t.xccd204c, #本期下阶投入金额-加工
       xccd204d LIKE xccd_t.xccd204d, #本期下阶投入金额-制费一
       xccd204e LIKE xccd_t.xccd204e, #本期下阶投入金额-制费二
       xccd204f LIKE xccd_t.xccd204f, #本期下阶投入金额-制费三
       xccd204g LIKE xccd_t.xccd204g, #本期下阶投入金额-制费四
       xccd204h LIKE xccd_t.xccd204h, #本期下阶投入金额-制费五
       xccd301 LIKE xccd_t.xccd301, #本期转出数量
       xccd302 LIKE xccd_t.xccd302, #本期转出金额
       xccd302a LIKE xccd_t.xccd302a, #本期转出金额-材料
       xccd302b LIKE xccd_t.xccd302b, #本期转出金额-人工
       xccd302c LIKE xccd_t.xccd302c, #本期转出金额-加工
       xccd302d LIKE xccd_t.xccd302d, #本期转出金额-制费一
       xccd302e LIKE xccd_t.xccd302e, #本期转出金额-制费二
       xccd302f LIKE xccd_t.xccd302f, #本期转出金额-制费三
       xccd302g LIKE xccd_t.xccd302g, #本期转出金额-制费四
       xccd302h LIKE xccd_t.xccd302h, #本期转出金额-制费五
       xccd303 LIKE xccd_t.xccd303, #差异转出数量
       xccd304 LIKE xccd_t.xccd304, #差异转出金额
       xccd304a LIKE xccd_t.xccd304a, #差异转出金额-材料
       xccd304b LIKE xccd_t.xccd304b, #差异转出金额-人工
       xccd304c LIKE xccd_t.xccd304c, #差异转出金额-加工
       xccd304d LIKE xccd_t.xccd304d, #差异转出金额-制费一
       xccd304e LIKE xccd_t.xccd304e, #差异转出金额-制费二
       xccd304f LIKE xccd_t.xccd304f, #差异转出金额-制费三
       xccd304g LIKE xccd_t.xccd304g, #差异转出金额-制费四
       xccd304h LIKE xccd_t.xccd304h, #差异转出金额-制费五
       xccd901 LIKE xccd_t.xccd901, #期末结存数量
       xccd902 LIKE xccd_t.xccd902, #期末结存金额
       xccd902a LIKE xccd_t.xccd902a, #期末结存金额-材料
       xccd902b LIKE xccd_t.xccd902b, #期末结存金额-人工
       xccd902c LIKE xccd_t.xccd902c, #期末结存金额-加工
       xccd902d LIKE xccd_t.xccd902d, #期末结存金额-制费一
       xccd902e LIKE xccd_t.xccd902e, #期末结存金额-制费二
       xccd902f LIKE xccd_t.xccd902f, #期末结存金额-制费三
       xccd902g LIKE xccd_t.xccd902g, #期末结存金额-制费四
       xccd902h LIKE xccd_t.xccd902h, #期末结存金额-制费五
       xccdtime LIKE xccd_t.xccdtime  #最近成本计算时间
END RECORD
DEFINE l_xcce RECORD  #在製元件成本期異動統計檔
       xcceent LIKE xcce_t.xcceent, #企业编号
       xccecomp LIKE xcce_t.xccecomp, #法人组织
       xcceld LIKE xcce_t.xcceld, #账套
       xcce001 LIKE xcce_t.xcce001, #账套本位币顺序
       xcce002 LIKE xcce_t.xcce002, #成本域
       xcce003 LIKE xcce_t.xcce003, #成本计算类型
       xcce004 LIKE xcce_t.xcce004, #年度
       xcce005 LIKE xcce_t.xcce005, #期别
       xcce006 LIKE xcce_t.xcce006, #工单编号
       xcce007 LIKE xcce_t.xcce007, #元件编号
       xcce008 LIKE xcce_t.xcce008, #产品特征
       xcce009 LIKE xcce_t.xcce009, #批号
       xcce010 LIKE xcce_t.xcce010, #核算币种
       xcce101 LIKE xcce_t.xcce101, #上期结存数量
       xcce102 LIKE xcce_t.xcce102, #上期结存金额
       xcce102a LIKE xcce_t.xcce102a, #上期结存金额-材料
       xcce102b LIKE xcce_t.xcce102b, #上期结存金额-人工
       xcce102c LIKE xcce_t.xcce102c, #上期结存金额-加工
       xcce102d LIKE xcce_t.xcce102d, #上期结存金额-制费一
       xcce102e LIKE xcce_t.xcce102e, #上期结存金额-制费二
       xcce102f LIKE xcce_t.xcce102f, #上期结存金额-制费三
       xcce102g LIKE xcce_t.xcce102g, #上期结存金额-制费四
       xcce102h LIKE xcce_t.xcce102h, #上期结存金额-制费五
       xcce201 LIKE xcce_t.xcce201, #本期投入数量
       xcce202 LIKE xcce_t.xcce202, #本期本阶投入金额
       xcce202a LIKE xcce_t.xcce202a, #本期本阶投入金额-材料
       xcce202b LIKE xcce_t.xcce202b, #本期本阶投入金额-人工
       xcce202c LIKE xcce_t.xcce202c, #本期本阶投入金额-加工
       xcce202d LIKE xcce_t.xcce202d, #本期本阶投入金额-制费一
       xcce202e LIKE xcce_t.xcce202e, #本期本阶投入金额-制费二
       xcce202f LIKE xcce_t.xcce202f, #本期本阶投入金额-制费三
       xcce202g LIKE xcce_t.xcce202g, #本期本阶投入金额-制费四
       xcce202h LIKE xcce_t.xcce202h, #本期本阶投入金额-制费五
       xcce205 LIKE xcce_t.xcce205, #本期当站下线数量
       xcce206 LIKE xcce_t.xcce206, #本期当站下线成本
       xcce206a LIKE xcce_t.xcce206a, #本期当站下线成本-材料
       xcce206b LIKE xcce_t.xcce206b, #本期当站下线成本-人工
       xcce206c LIKE xcce_t.xcce206c, #本期当站下线成本-加工
       xcce206d LIKE xcce_t.xcce206d, #本期当站下线成本-制费一
       xcce206e LIKE xcce_t.xcce206e, #本期当站下线成本-制费二
       xcce206f LIKE xcce_t.xcce206f, #本期当站下线成本-制费三
       xcce206g LIKE xcce_t.xcce206g, #本期当站下线成本-制费四
       xcce206h LIKE xcce_t.xcce206h, #本期当站下线成本-制费五
       xcce207 LIKE xcce_t.xcce207, #本期一般退料数量
       xcce208 LIKE xcce_t.xcce208, #本期一般退料成本
       xcce208a LIKE xcce_t.xcce208a, #本期一般退料成本-材料
       xcce208b LIKE xcce_t.xcce208b, #本期一般退料成本-人工
       xcce208c LIKE xcce_t.xcce208c, #本期一般退料成本-加工
       xcce208d LIKE xcce_t.xcce208d, #本期一般退料成本-制费一
       xcce208e LIKE xcce_t.xcce208e, #本期一般退料成本-制费二
       xcce208f LIKE xcce_t.xcce208f, #本期一般退料成本-制费三
       xcce208g LIKE xcce_t.xcce208g, #本期一般退料成本-制费四
       xcce208h LIKE xcce_t.xcce208h, #本期一般退料成本-制费五
       xcce209 LIKE xcce_t.xcce209, #本期超领退数量
       xcce210 LIKE xcce_t.xcce210, #本期超领退金额
       xcce210a LIKE xcce_t.xcce210a, #本期超领退金额-材料
       xcce210b LIKE xcce_t.xcce210b, #本期超领退金额-人工
       xcce210c LIKE xcce_t.xcce210c, #本期超领退金额-加工
       xcce210d LIKE xcce_t.xcce210d, #本期超领退金额-制费一
       xcce210e LIKE xcce_t.xcce210e, #本期超领退金额-制费二
       xcce210f LIKE xcce_t.xcce210f, #本期超领退金额-制费三
       xcce210g LIKE xcce_t.xcce210g, #本期超领退金额-制费四
       xcce210h LIKE xcce_t.xcce210h, #本期超领退金额-制费五
       xcce301 LIKE xcce_t.xcce301, #本期转出数量
       xcce302 LIKE xcce_t.xcce302, #本期转出金额
       xcce302a LIKE xcce_t.xcce302a, #本期转出金额-材料
       xcce302b LIKE xcce_t.xcce302b, #本期转出金额-人工
       xcce302c LIKE xcce_t.xcce302c, #本期转出金额-加工
       xcce302d LIKE xcce_t.xcce302d, #本期转出金额-制费一
       xcce302e LIKE xcce_t.xcce302e, #本期转出金额-制费二
       xcce302f LIKE xcce_t.xcce302f, #本期转出金额-制费三
       xcce302g LIKE xcce_t.xcce302g, #本期转出金额-制费四
       xcce302h LIKE xcce_t.xcce302h, #本期转出金额-制费五
       xcce303 LIKE xcce_t.xcce303, #差异转出数量
       xcce304 LIKE xcce_t.xcce304, #差异转出金额
       xcce304a LIKE xcce_t.xcce304a, #差异转出金额-材料
       xcce304b LIKE xcce_t.xcce304b, #差异转出金额-人工
       xcce304c LIKE xcce_t.xcce304c, #差异转出金额-加工
       xcce304d LIKE xcce_t.xcce304d, #差异转出金额-制费一
       xcce304e LIKE xcce_t.xcce304e, #差异转出金额-制费二
       xcce304f LIKE xcce_t.xcce304f, #差异转出金额-制费三
       xcce304g LIKE xcce_t.xcce304g, #差异转出金额-制费四
       xcce304h LIKE xcce_t.xcce304h, #差异转出金额-制费五
       xcce307 LIKE xcce_t.xcce307, #盘差数量
       xcce308 LIKE xcce_t.xcce308, #盘差金额
       xcce308a LIKE xcce_t.xcce308a, #盘差金额-材料
       xcce308b LIKE xcce_t.xcce308b, #盘差金额-人工
       xcce308c LIKE xcce_t.xcce308c, #盘差金额-加工
       xcce308d LIKE xcce_t.xcce308d, #盘差金额-制费一
       xcce308e LIKE xcce_t.xcce308e, #盘差金额-制费二
       xcce308f LIKE xcce_t.xcce308f, #盘差金额-制费三
       xcce308g LIKE xcce_t.xcce308g, #盘差金额-制费四
       xcce308h LIKE xcce_t.xcce308h, #盘差金额-制费五
       xcce901 LIKE xcce_t.xcce901, #期末结存数量
       xcce902 LIKE xcce_t.xcce902, #期末结存金额
       xcce902a LIKE xcce_t.xcce902a, #期末结存金额-材料
       xcce902b LIKE xcce_t.xcce902b, #期末结存金额-人工
       xcce902c LIKE xcce_t.xcce902c, #期末结存金额-加工
       xcce902d LIKE xcce_t.xcce902d, #期末结存金额-制费一
       xcce902e LIKE xcce_t.xcce902e, #期末结存金额-制费二
       xcce902f LIKE xcce_t.xcce902f, #期末结存金额-制费三
       xcce902g LIKE xcce_t.xcce902g, #期末结存金额-制费四
       xcce902h LIKE xcce_t.xcce902h, #期末结存金额-制费五
       xccetime LIKE xcce_t.xccetime  #最近成本计算时间
END RECORD
DEFINE l_xcci RECORD  #拆件在製元件成本期異動統計檔
       xccient LIKE xcci_t.xccient, #企业编号
       xccicomp LIKE xcci_t.xccicomp, #法人组织
       xccild LIKE xcci_t.xccild, #账套
       xcci001 LIKE xcci_t.xcci001, #账套本位币顺序
       xcci002 LIKE xcci_t.xcci002, #成本域
       xcci003 LIKE xcci_t.xcci003, #成本计算类型
       xcci004 LIKE xcci_t.xcci004, #年度
       xcci005 LIKE xcci_t.xcci005, #期别
       xcci006 LIKE xcci_t.xcci006, #拆件工单编号
       xcci007 LIKE xcci_t.xcci007, #元件料号
       xcci008 LIKE xcci_t.xcci008, #特性
       xcci009 LIKE xcci_t.xcci009, #批号
       xcci010 LIKE xcci_t.xcci010, #核算币种
       xcci101 LIKE xcci_t.xcci101, #上期结存数量
       xcci102 LIKE xcci_t.xcci102, #上期结存金额
       xcci102a LIKE xcci_t.xcci102a, #上期结存金额-材料
       xcci102b LIKE xcci_t.xcci102b, #上期结存金额-人工
       xcci102c LIKE xcci_t.xcci102c, #上期结存金额-加工
       xcci102d LIKE xcci_t.xcci102d, #上期结存金额-制费一
       xcci102e LIKE xcci_t.xcci102e, #上期结存金额-制费二
       xcci102f LIKE xcci_t.xcci102f, #上期结存金额-制费三
       xcci102g LIKE xcci_t.xcci102g, #上期结存金额-制费四
       xcci102h LIKE xcci_t.xcci102h, #上期结存金额-制费五
       xcci201 LIKE xcci_t.xcci201, #本期投入数量
       xcci202 LIKE xcci_t.xcci202, #本期本阶投入金额
       xcci202a LIKE xcci_t.xcci202a, #本期本阶投入金额-材料
       xcci202b LIKE xcci_t.xcci202b, #本期本阶投入金额-人工
       xcci202c LIKE xcci_t.xcci202c, #本期本阶投入金额-加工
       xcci202d LIKE xcci_t.xcci202d, #本期本阶投入金额-制费一
       xcci202e LIKE xcci_t.xcci202e, #本期本阶投入金额-制费二
       xcci202f LIKE xcci_t.xcci202f, #本期本阶投入金额-制费三
       xcci202g LIKE xcci_t.xcci202g, #本期本阶投入金额-制费四
       xcci202h LIKE xcci_t.xcci202h, #本期本阶投入金额-制费五
       xcci301 LIKE xcci_t.xcci301, #本期转出数量
       xcci302 LIKE xcci_t.xcci302, #本期转出金额
       xcci302a LIKE xcci_t.xcci302a, #本期转出金额-材料
       xcci302b LIKE xcci_t.xcci302b, #本期转出金额-人工
       xcci302c LIKE xcci_t.xcci302c, #本期转出金额-加工
       xcci302d LIKE xcci_t.xcci302d, #本期转出金额-制费一
       xcci302e LIKE xcci_t.xcci302e, #本期转出金额-制费二
       xcci302f LIKE xcci_t.xcci302f, #本期转出金额-制费三
       xcci302g LIKE xcci_t.xcci302g, #本期转出金额-制费四
       xcci302h LIKE xcci_t.xcci302h, #本期转出金额-制费五
       xcci303 LIKE xcci_t.xcci303, #差异转出数量
       xcci304 LIKE xcci_t.xcci304, #差异转出金额
       xcci304a LIKE xcci_t.xcci304a, #差异转出金额-材料
       xcci304b LIKE xcci_t.xcci304b, #差异转出金额-人工
       xcci304c LIKE xcci_t.xcci304c, #差异转出金额-加工
       xcci304d LIKE xcci_t.xcci304d, #差异转出金额-制费一
       xcci304e LIKE xcci_t.xcci304e, #差异转出金额-制费二
       xcci304f LIKE xcci_t.xcci304f, #差异转出金额-制费三
       xcci304g LIKE xcci_t.xcci304g, #差异转出金额-制费四
       xcci304h LIKE xcci_t.xcci304h, #差异转出金额-制费五
       xcci901 LIKE xcci_t.xcci901, #期末结存数量
       xcci902 LIKE xcci_t.xcci902, #期末结存金额
       xcci902a LIKE xcci_t.xcci902a, #期末结存金额-材料
       xcci902b LIKE xcci_t.xcci902b, #期末结存金额-人工
       xcci902c LIKE xcci_t.xcci902c, #期末结存金额-加工
       xcci902d LIKE xcci_t.xcci902d, #期末结存金额-制费一
       xcci902e LIKE xcci_t.xcci902e, #期末结存金额-制费二
       xcci902f LIKE xcci_t.xcci902f, #期末结存金额-制费三
       xcci902g LIKE xcci_t.xcci902g, #期末结存金额-制费四
       xcci902h LIKE xcci_t.xcci902h, #期末结存金额-制费五
       xccitime LIKE xcci_t.xccitime  #最近成本计算时间
END RECORD
DEFINE l_xcch RECORD  #拆件在製主件成本期異動統計檔
       xcchent LIKE xcch_t.xcchent, #企业编号
       xcchcomp LIKE xcch_t.xcchcomp, #法人组织
       xcchld LIKE xcch_t.xcchld, #账套
       xcch001 LIKE xcch_t.xcch001, #账套本位币顺序
       xcch002 LIKE xcch_t.xcch002, #成本域
       xcch003 LIKE xcch_t.xcch003, #成本计算类型
       xcch004 LIKE xcch_t.xcch004, #年度
       xcch005 LIKE xcch_t.xcch005, #期别
       xcch006 LIKE xcch_t.xcch006, #拆件工单编号
       xcch007 LIKE xcch_t.xcch007, #主件料号
       xcch008 LIKE xcch_t.xcch008, #特性
       xcch009 LIKE xcch_t.xcch009, #批号
       xcch010 LIKE xcch_t.xcch010, #项目号
       xcch011 LIKE xcch_t.xcch011, #核算币种
       xcch101 LIKE xcch_t.xcch101, #上期结存数量
       xcch102 LIKE xcch_t.xcch102, #上期结存金额
       xcch102a LIKE xcch_t.xcch102a, #上期结存金额-材料
       xcch102b LIKE xcch_t.xcch102b, #上期结存金额-人工
       xcch102c LIKE xcch_t.xcch102c, #上期结存金额-加工
       xcch102d LIKE xcch_t.xcch102d, #上期结存金额-制费一
       xcch102e LIKE xcch_t.xcch102e, #上期结存金额-制费二
       xcch102f LIKE xcch_t.xcch102f, #上期结存金额-制费三
       xcch102g LIKE xcch_t.xcch102g, #上期结存金额-制费四
       xcch102h LIKE xcch_t.xcch102h, #上期结存金额-制费五
       xcch200 LIKE xcch_t.xcch200, #本期投入工时
       xcch201 LIKE xcch_t.xcch201, #本期投入数量
       xcch202 LIKE xcch_t.xcch202, #本期本阶投入金额
       xcch202a LIKE xcch_t.xcch202a, #本期本阶投入金额-材料
       xcch202b LIKE xcch_t.xcch202b, #本期本阶投入金额-人工
       xcch202c LIKE xcch_t.xcch202c, #本期本阶投入金额-加工
       xcch202d LIKE xcch_t.xcch202d, #本期本阶投入金额-制费一
       xcch202e LIKE xcch_t.xcch202e, #本期本阶投入金额-制费二
       xcch202f LIKE xcch_t.xcch202f, #本期本阶投入金额-制费三
       xcch202g LIKE xcch_t.xcch202g, #本期本阶投入金额-制费四
       xcch202h LIKE xcch_t.xcch202h, #本期本阶投入金额-制费五
       xcch204 LIKE xcch_t.xcch204, #本期下阶投入金额
       xcch204a LIKE xcch_t.xcch204a, #本期下阶投入金额-材料
       xcch204b LIKE xcch_t.xcch204b, #本期下阶投入金额-人工
       xcch204c LIKE xcch_t.xcch204c, #本期下阶投入金额-加工
       xcch204d LIKE xcch_t.xcch204d, #本期下阶投入金额-制费一
       xcch204e LIKE xcch_t.xcch204e, #本期下阶投入金额-制费二
       xcch204f LIKE xcch_t.xcch204f, #本期下阶投入金额-制费三
       xcch204g LIKE xcch_t.xcch204g, #本期下阶投入金额-制费四
       xcch204h LIKE xcch_t.xcch204h, #本期下阶投入金额-制费五
       xcch301 LIKE xcch_t.xcch301, #本期转出数量
       xcch302 LIKE xcch_t.xcch302, #本期转出金额
       xcch302a LIKE xcch_t.xcch302a, #本期转出金额-材料
       xcch302b LIKE xcch_t.xcch302b, #本期转出金额-人工
       xcch302c LIKE xcch_t.xcch302c, #本期转出金额-加工
       xcch302d LIKE xcch_t.xcch302d, #本期转出金额-制费一
       xcch302e LIKE xcch_t.xcch302e, #本期转出金额-制费二
       xcch302f LIKE xcch_t.xcch302f, #本期转出金额-制费三
       xcch302g LIKE xcch_t.xcch302g, #本期转出金额-制费四
       xcch302h LIKE xcch_t.xcch302h, #本期转出金额-制费五
       xcch303 LIKE xcch_t.xcch303, #差异转出数量
       xcch304 LIKE xcch_t.xcch304, #差异转出金额
       xcch304a LIKE xcch_t.xcch304a, #差异转出金额-材料
       xcch304b LIKE xcch_t.xcch304b, #差异转出金额-人工
       xcch304c LIKE xcch_t.xcch304c, #差异转出金额-加工
       xcch304d LIKE xcch_t.xcch304d, #差异转出金额-制费一
       xcch304e LIKE xcch_t.xcch304e, #差异转出金额-制费二
       xcch304f LIKE xcch_t.xcch304f, #差异转出金额-制费三
       xcch304g LIKE xcch_t.xcch304g, #差异转出金额-制费四
       xcch304h LIKE xcch_t.xcch304h, #差异转出金额-制费五
       xcch901 LIKE xcch_t.xcch901, #期末结存数量
       xcch902 LIKE xcch_t.xcch902, #期末结存金额
       xcch902a LIKE xcch_t.xcch902a, #期末结存金额-材料
       xcch902b LIKE xcch_t.xcch902b, #期末结存金额-人工
       xcch902c LIKE xcch_t.xcch902c, #期末结存金额-加工
       xcch902d LIKE xcch_t.xcch902d, #期末结存金额-制费一
       xcch902e LIKE xcch_t.xcch902e, #期末结存金额-制费二
       xcch902f LIKE xcch_t.xcch902f, #期末结存金额-制费三
       xcch902g LIKE xcch_t.xcch902g, #期末结存金额-制费四
       xcch902h LIKE xcch_t.xcch902h, #期末结存金额-制费五
       xcchtime LIKE xcch_t.xcchtime  #最近成本计算时间
END RECORD
#161124-00048#21 add(e)
DEFINE l_sfaa052       LIKE sfaa_t.sfaa052
DEFINE l_sfaa009       LIKE sfaa_t.sfaa009
DEFINE l_sfaa028       LIKE sfaa_t.sfaa028
DEFINE l_sfaa029       LIKE sfaa_t.sfaa029
DEFINE l_sfaasite      LIKE sfaa_t.sfaasite
DEFINE l_sfaa017       LIKE sfaa_t.sfaa017
DEFINE ld_date         DATETIME YEAR TO SECOND
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,l_xcea.xceacrtdt,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "ins xcea"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   #非拆件工單 xccd_t
   #帳套本位幣順序+工單+主件  

   LET g_sql = " SELECT SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),",
               "        SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xccd_t,xcce_t",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea004,
               "    AND xccd005 = ",g_xcea005,
               "    AND xcceent = xccdent",
               "    AND xcceld  = xccdld",
               "    AND xcce001 = xccd001",
               "    AND xcce003 = xccd003",
               "    AND xcce004 = xccd004",
               "    AND xcce005 = xccd005",
               "    AND xcce006 = xccd006",
               "    AND xcce007 != 'DL+OH+SUB'",
               "    AND xccd006 = ? AND xccd007 = ? AND xccd008 = ? AND xccd002 = ? "                
 

   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '2' " 
   
   DECLARE xccd_prep2 CURSOR FROM g_sql1

   

   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '3' " 
   
   DECLARE xccd_prep3 CURSOR FROM g_sql1

               
   LET g_sql = " SELECT xccd006,xccd007,xccd008,xccd002,",
               "        SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),",
               "        SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xccd_t,xcce_t",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea004,
               "    AND xccd005 = ",g_xcea005,
               "    AND xccd001 = '1' ",
               "    AND xcceent = xccdent",
               "    AND xcceld  = xccdld",
               "    AND xcce001 = xccd001",
               "    AND xcce003 = xccd003",
               "    AND xcce004 = xccd004",
               "    AND xcce005 = xccd005",
               "    AND xcce006 = xccd006",
               "    AND xcce007 != 'DL+OH+SUB'",
               "  GROUP BY xccd006,xccd007,xccd008,xccd002 ",
               "  ORDER BY xccd006,xccd007,xccd008,xccd002 "
   PREPARE xccd_prep FROM g_sql
   DECLARE xccd_curs CURSOR FOR xccd_prep
   FOREACH xccd_curs INTO l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002,l_xcce.xcce202,l_xcce.xcce202a,
                          l_xcce.xcce202b,l_xcce.xcce202c,l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,
                          l_xcce.xcce202g,l_xcce.xcce202h 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xccd"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN g_success
         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''
      LET l_sfaasite =''
      
      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb001 = l_xccd.xccd006 #工單
      LET l_xceb.xceb004 = l_xccd.xccd007 #主件
      LET l_xceb.xceb005 = l_xccd.xccd008 #特性
      LET l_xceb.xceb103 = l_xccd.xccd002 #成本域
 

      #本位幣一
      LET l_xceb.xceb202 = l_xcce.xcce202
      LET l_xceb.xceb202a = l_xcce.xcce202a
      LET l_xceb.xceb202b = l_xcce.xcce202b
      LET l_xceb.xceb202c = l_xcce.xcce202c
      LET l_xceb.xceb202d = l_xcce.xcce202d
      LET l_xceb.xceb202e = l_xcce.xcce202e
      LET l_xceb.xceb202f = l_xcce.xcce202f
      LET l_xceb.xceb202g = l_xcce.xcce202g
      LET l_xceb.xceb202h = l_xcce.xcce202h
       

      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF                            
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF
      
      #本位幣二
      IF g_glaa015 = 'Y' THEN
         OPEN xccd_prep2 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep2 INTO l_xcce.xcce202,l_xcce.xcce202a,l_xcce.xcce202b,l_xcce.xcce202c,
                               l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,l_xcce.xcce202g,l_xcce.xcce202h 
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF                        
          
         LET l_xceb.xceb212a = l_xcce.xcce202a
         LET l_xceb.xceb212b = l_xcce.xcce202b
         LET l_xceb.xceb212c = l_xcce.xcce202c
         LET l_xceb.xceb212d = l_xcce.xcce202d
         LET l_xceb.xceb212e = l_xcce.xcce202e
         LET l_xceb.xceb212f = l_xcce.xcce202f
         LET l_xceb.xceb212g = l_xcce.xcce202g
         LET l_xceb.xceb212h = l_xcce.xcce202h
          
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF                            
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0                            
         LET l_xceb.xceb212  = 0      
      END IF

      #本位幣三
      IF g_glaa019 = 'Y' THEN  
         OPEN xccd_prep3 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep3 INTO l_xcce.xcce202,l_xcce.xcce202a,l_xcce.xcce202b,l_xcce.xcce202c,
                               l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,l_xcce.xcce202g,l_xcce.xcce202h 
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
          
         LET l_xceb.xceb222a = l_xcce.xcce202a
         LET l_xceb.xceb222b = l_xcce.xcce202b
         LET l_xceb.xceb222c = l_xcce.xcce202c
         LET l_xceb.xceb222d = l_xcce.xcce202d
         LET l_xceb.xceb222e = l_xcce.xcce202e
         LET l_xceb.xceb222f = l_xcce.xcce202f
         LET l_xceb.xceb222g = l_xcce.xcce202g
         LET l_xceb.xceb222h = l_xcce.xcce202h
          
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF                            
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0                            
         LET l_xceb.xceb222  = 0      
      END IF
      
      #項次
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise 
         AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xceb.xceb003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xceb.xceb101

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xceb.xceb101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xceb.xceb101,l_errno
      END IF
      

      LET l_xceb.xceb115 = ''  #經營類別
      LET l_xceb.xceb116 = ''  #渠道
      LET l_xceb.xceb118 = ''  #品牌

      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xceb.xceb111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
      ELSE
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF      


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      SELECT ooeg004 INTO l_xceb.xceb114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017  
      
      #品類
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xceb.xceb004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' '
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF      
#      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xccd_prep2
   CLOSE xccd_prep3   
   END FOREACH     


   #非拆件工單 xcce_t
   #帳套本位幣順序+工單+元件  
   LET g_sql = " SELECT SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xcce_t", 
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea004,
               "    AND xcce005 = ",g_xcea005,  
               "    AND xcce007 != 'DL+OH+SUB'",
               "    AND xcce006 = ? AND xcce007 = ? AND xcce002 = ? AND xcce008 = ? AND xcce009 = ?  " 
 
   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '2' " 
   
   DECLARE xcce_prep2 CURSOR FROM g_sql1
   

   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '3' " 
   
   DECLARE xcce_prep3 CURSOR FROM g_sql1

   
   LET g_sql = " SELECT xcce006,xcce007,xcce002,xcce008,xcce009,SUM(xcce201)+SUM(xcce205)+SUM(xcce207)+SUM(xcce209),",
               "        SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xcce_t",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea004,
               "    AND xcce005 = ",g_xcea005,
               "    AND xcce007 != 'DL+OH+SUB'",
               "    AND xcce001 = '1' ",
               "  GROUP BY xcce006,xcce007,xcce002,xcce008,xcce009",
               "  ORDER BY xcce006,xcce007,xcce002,xcce008,xcce009 "
   PREPARE xcce_prep FROM g_sql
   DECLARE xcce_curs CURSOR FOR xcce_prep
   FOREACH xcce_curs INTO l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce002,l_xcce.xcce008,l_xcce.xcce009,
                          l_xcce.xcce201,l_xcce.xcce202,l_xcce.xcce202a,
                          l_xcce.xcce202b,l_xcce.xcce202c,l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,
                          l_xcce.xcce202g,l_xcce.xcce202h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcce"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''
      LET l_sfaasite =''
      
      INITIALIZE l_xcec.* TO NULL
      
      LET l_xcec.xcec001 = l_xcce.xcce006 #工單
      LET l_xcec.xcec004 = l_xcce.xcce007 #主件
      LET l_xcec.xcec005 = l_xcce.xcce008 #特性
      LET l_xcec.xcec103 = l_xcce.xcce002 #成本域
      
      #本位幣一
      LET l_xcec.xcec201 =  l_xcce.xcce201#投入數量
      LET l_xcec.xcec202a = l_xcce.xcce202a 
      LET l_xcec.xcec202b = l_xcce.xcce202b   
      LET l_xcec.xcec202c = l_xcce.xcce202c 
      LET l_xcec.xcec202d = l_xcce.xcce202d 
      LET l_xcec.xcec202e = l_xcce.xcce202e 
      LET l_xcec.xcec202f = l_xcce.xcce202f 
      LET l_xcec.xcec202g = l_xcce.xcce202g 
      LET l_xcec.xcec202h = l_xcce.xcce202h 
      LET l_xcec.xcec202  = l_xcce.xcce202       

      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF
     
      IF g_glaa015 ='Y' THEN
      #本位幣二
         OPEN xcce_prep2 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce002,l_xcce.xcce008,l_xcce.xcce009
         FETCH xcce_prep2 INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                               l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF 
      ELSE
         LET l_xcec.xcec212a = 0
         LET l_xcec.xcec212b = 0
         LET l_xcec.xcec212c = 0
         LET l_xcec.xcec212d = 0
         LET l_xcec.xcec212e = 0
         LET l_xcec.xcec212f = 0
         LET l_xcec.xcec212g = 0
         LET l_xcec.xcec212h = 0
         LET l_xcec.xcec212  = 0
      END IF      
      IF g_glaa019 ='Y' THEN
      #本位幣三
         OPEN xcce_prep3 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce002,l_xcce.xcce008,l_xcce.xcce009
         FETCH xcce_prep3 INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                               l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF      
      ELSE
         LET l_xcec.xcec222a = 0
         LET l_xcec.xcec222b = 0
         LET l_xcec.xcec222c = 0
         LET l_xcec.xcec222d = 0
         LET l_xcec.xcec222e = 0
         LET l_xcec.xcec222f = 0
         LET l_xcec.xcec222g = 0
         LET l_xcec.xcec222h = 0
         LET l_xcec.xcec222  = 0
      END IF 
      #項次
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise 
         AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xcec.xcec003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      #150812-00010#3--s
      IF l_xcec.xcec004 = 'ADJUST' THEN
         #調整科目
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','9') RETURNING g_sub_success,l_xcec.xcec101,g_errno
      ELSE
      #150812-00010#3--e        
         #存貨科目
         CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
           RETURNING l_success,l_xcec.xcec101    
      END IF   #150812-00010#3
      

      LET l_xcec.xcec102 = ''  #摘要
      LET l_xcec.xcec115 = ''  #經營類別
      LET l_xcec.xcec116 = ''  #渠道
      LET l_xcec.xcec118 = ''  #品牌
      
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xcec.xcec111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
      ELSE
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF      


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      SELECT ooeg004 INTO l_xcec.xcec114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017 
       

      #品類
      SELECT imag011 INTO l_xcec.xcec117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xcec.xcec004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001

      #人员
      LET l_xcec.xcec107 = ' '
      #部门
      LET l_xcec.xcec108 = ' '
      #账款对象
      LET l_xcec.xcec109 = ' '
      #自由核算项1～10  
      LET l_xcec.xcec121 = ' '
      LET l_xcec.xcec122 = ' '
      LET l_xcec.xcec123 = ' '
      LET l_xcec.xcec124 = ' '
      LET l_xcec.xcec125 = ' '
      LET l_xcec.xcec126 = ' '
      LET l_xcec.xcec127 = ' '
      LET l_xcec.xcec128 = ' '
      LET l_xcec.xcec129 = ' '
      LET l_xcec.xcec130 = ' '
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
      #                                                       l_xcec.xcec101,
      #                                                       l_xcec.xcec102,
      #                                                       l_xcec.xcec103,
      #                                                       l_xcec.xcec110,
      #                                                       l_xcec.xcec111,
      #                                                       l_xcec.xcec112,
      #                                                       l_xcec.xcec113,
      #                                                       l_xcec.xcec114,
      #                                                       l_xcec.xcec115,
      #                                                       l_xcec.xcec116,
      #                                                       l_xcec.xcec117,
      #                                                       l_xcec.xcec118,
      #                                                       l_xcec.xcec119,
      #                                                       l_xcec.xcec120,
      #                                                       l_xcec.xcec107,
      #                                                       l_xcec.xcec108,
      #                                                       l_xcec.xcec109,
      #                                                       l_xcec.xcec121,
      #                                                       l_xcec.xcec122,
      #                                                       l_xcec.xcec123,
      #                                                       l_xcec.xcec124,
      #                                                       l_xcec.xcec125,
      #                                                       l_xcec.xcec126,
      #                                                       l_xcec.xcec127,
      #                                                       l_xcec.xcec128,
      #                                                       l_xcec.xcec129,
      #                                                       l_xcec.xcec130 
      #20150805--mark--end--lujh      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF  
#      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xcce_prep2
   CLOSE xcce_prep3      
   END FOREACH 
   
   #拆件工單 xcch_t
   #帳套本位幣順序+工單+主件   

   LET g_sql = " SELECT SUM(xcch202a),SUM(xcch202a),",
               "        SUM(xcch202b),SUM(xcch202c),SUM(xcch202d),SUM(xcch202e),",
               "        SUM(xcch202f),SUM(xcch202g),SUM(xcch202h) ",
               "   FROM xcch_t", 
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea004,
               "    AND xcch005 = ",g_xcea005,  
               "    AND xcch006 = ? AND xcch007 = ? AND xcch008 = ? AND xcch002 = ? " 

   LET g_sql1 = g_sql CLIPPED," AND xcch001 = '2' " 
   
   DECLARE xcch_prep2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xcch001 = '3' " 
   
   DECLARE xcch_prep3 CURSOR FROM g_sql1

   LET g_sql = " SELECT xcch006,xcch007,xcch008,xcch002,SUM(xcci201)+SUM(xcci301),SUM(xcci202)+SUM(xcci302),SUM(xcci202a)+SUM(xcci302a),",
               "        SUM(xcci202b)+SUM(xcci302b),SUM(xcci202c)+SUM(xcci302c),SUM(xcci202d)+SUM(xcci302d),SUM(xcci202e)+SUM(xcci302e),",
               "        SUM(xcci202f)+SUM(xcci302f),SUM(xcci202g)+SUM(xcci302g),SUM(xcci202h)+SUM(xcci302h) ",
               "   FROM xcch_t,xcci_t",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea004,
               "    AND xcch005 = ",g_xcea005,
               "    AND xcch001 = '1' ",
               "    AND xcchent = xccient",
               "    AND xcchld  = xccild",
               "    AND xcch001 = xcci001",
              #"    AND xcch002 = xcci002",     #160813-00002#1 mark
               "    AND xcch003 = xcci003",
               "    AND xcch004 = xcci004",
               "    AND xcch005 = xcci005",
               "    AND xcch006 = xcci006",
               "    AND xcci007 != 'DL+OH+SUB'",
               "  GROUP BY xcch006,xcch007,xcch008,xcch002",
               "  ORDER BY xcch006,xcch007,xcch008,xcch002 "
   PREPARE xcch_prep FROM g_sql
   DECLARE xcch_curs CURSOR FOR xcch_prep
   FOREACH xcch_curs INTO l_xcch.xcch006,l_xcch.xcch007,l_xcch.xcch008,l_xcch.xcch002,l_xcch.xcch202a,l_xcch.xcch202a,
                          l_xcch.xcch202b,l_xcch.xcch202c,l_xcch.xcch202d,l_xcch.xcch202e,l_xcch.xcch202f,
                          l_xcch.xcch202g,l_xcch.xcch202h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcch"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = '' 
      LET l_sfaasite =''
      
      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb001 = l_xcch.xcch006 #工單
      LET l_xceb.xceb004 = l_xcch.xcch007 #主件
      LET l_xceb.xceb005 = l_xcch.xcch008 #特性
      LET l_xceb.xceb103 = l_xcch.xcch002 #成本域
 
      #本位幣一
      IF cl_null(l_xcch.xcch202a) THEN LET l_xcch.xcch202a = 0 END IF
      IF cl_null(l_xcch.xcch204a) THEN LET l_xcch.xcch204a = 0 END IF
      
      LET l_xceb.xceb202a = l_xcch.xcch202a + l_xcch.xcch204a
      LET l_xceb.xceb202b = l_xcch.xcch204b   
      LET l_xceb.xceb202c = l_xcch.xcch204c 
      LET l_xceb.xceb202d = l_xcch.xcch204d 
      LET l_xceb.xceb202e = l_xcch.xcch204e 
      LET l_xceb.xceb202f = l_xcch.xcch204f 
      LET l_xceb.xceb202g = l_xcch.xcch204g 
      LET l_xceb.xceb202h = l_xcch.xcch204h 
      
      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      
      
      LET l_xceb.xceb202  = l_xceb.xceb202a + l_xceb.xceb202b + l_xceb.xceb202c + l_xceb.xceb202d +
                            l_xceb.xceb202e + l_xceb.xceb202f + l_xceb.xceb202g + l_xceb.xceb202h           
      
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF  

     IF g_glaa015 ='Y' THEN
     #本位幣二
         OPEN xcch_prep2 USING l_xcch.xcch006,l_xcch.xcch007,l_xcch.xcch008,l_xcch.xcch002
         FETCH xcch_prep2 INTO l_xcch.xcch202a,l_xcch.xcch204a,l_xcch.xcch204b,l_xcch.xcch204c,l_xcch.xcch204d,
                               l_xcch.xcch204e,l_xcch.xcch204f,l_xcch.xcch204g,l_xcch.xcch204h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcch_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xcch.xcch202a) THEN LET l_xcch.xcch202a = 0 END IF
         IF cl_null(l_xcch.xcch204a) THEN LET l_xcch.xcch204a = 0 END IF
                          
         LET l_xceb.xceb212a = l_xcch.xcch202a + l_xcch.xcch204a
         LET l_xceb.xceb212b = l_xcch.xcch204b   
         LET l_xceb.xceb212c = l_xcch.xcch204c 
         LET l_xceb.xceb212d = l_xcch.xcch204d 
         LET l_xceb.xceb212e = l_xcch.xcch204e 
         LET l_xceb.xceb212f = l_xcch.xcch204f 
         LET l_xceb.xceb212g = l_xcch.xcch204g 
         LET l_xceb.xceb212h = l_xcch.xcch204h 
         
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         
         
         LET l_xceb.xceb212  = l_xceb.xceb212a + l_xceb.xceb212b + l_xceb.xceb212c + l_xceb.xceb212d +
                               l_xceb.xceb212e + l_xceb.xceb212f + l_xceb.xceb212g + l_xceb.xceb212h
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF                               
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF      
 
      #本位幣三
      IF g_glaa019 ='Y' THEN
         OPEN xcch_prep3 USING l_xcch.xcch006,l_xcch.xcch007,l_xcch.xcch008,l_xcch.xcch002
         FETCH xcch_prep3 INTO l_xcch.xcch202a,l_xcch.xcch204a,l_xcch.xcch204b,l_xcch.xcch204c,l_xcch.xcch204d,
                               l_xcch.xcch204e,l_xcch.xcch204f,l_xcch.xcch204g,l_xcch.xcch204h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcch_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
         
         IF cl_null(l_xcch.xcch202a) THEN LET l_xcch.xcch202a = 0 END IF
         IF cl_null(l_xcch.xcch204a) THEN LET l_xcch.xcch204a = 0 END IF
         
         
         LET l_xceb.xceb222a = l_xcch.xcch202a + l_xcch.xcch204a
         LET l_xceb.xceb222b = l_xcch.xcch204b   
         LET l_xceb.xceb222c = l_xcch.xcch204c 
         LET l_xceb.xceb222d = l_xcch.xcch204d 
         LET l_xceb.xceb222e = l_xcch.xcch204e 
         LET l_xceb.xceb222f = l_xcch.xcch204f 
         LET l_xceb.xceb222g = l_xcch.xcch204g 
         LET l_xceb.xceb222h = l_xcch.xcch204h
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         
         
         LET l_xceb.xceb222  = l_xceb.xceb222a + l_xceb.xceb222b + l_xceb.xceb222c + l_xceb.xceb222d +
                               l_xceb.xceb222e + l_xceb.xceb222f + l_xceb.xceb222g + l_xceb.xceb222h       
            
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF 
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      #項次
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise 
         AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xceb.xceb003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xceb.xceb101  

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xceb.xceb101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xceb.xceb101,l_errno
      END IF
      
      LET l_xceb.xceb102 = ''  #摘要
      LET l_xceb.xceb115 = ''  #經營類別
      LET l_xceb.xceb116 = ''  #渠道
      LET l_xceb.xceb118 = ''  #品牌
      
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xceb.xceb111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
      ELSE
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF        

      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      SELECT ooeg004 INTO l_xceb.xceb114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017  
       
      #品類
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xceb.xceb004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF 
      
      #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF      
   CLOSE xcch_prep2
   CLOSE xcch_prep3      
   END FOREACH     


   #拆件工單 xcci_t
   #帳套本位幣順序+工單+元件
   LET g_sql = " SELECT SUM(xcci202),SUM(xcci202a), ",
               "        SUM(xcci202b),SUM(xcci202c),SUM(xcci202d),SUM(xcci202e),",
               "        SUM(xcci202f),SUM(xcci202g),SUM(xcci202h) ",
               "   FROM xcci_t", 
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea004,
               "    AND xcci005 = ",g_xcea005,  
               "    AND xcci007 != 'DL+OH+SUB'",
               "    AND xcci006 = ? AND xcci007 = ? AND xcci008 = ? AND xcci002 = ? AND xcci009 = ?  " 

   LET g_sql1 = g_sql CLIPPED," AND xcci001 = '2' " 
   
   DECLARE xcci_prep2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xcci001 = '3' " 
   
   DECLARE xcci_prep3 CURSOR FROM g_sql1

   LET g_sql = " SELECT xcci006,xcci007,xcci008,xcci002,xcci009,SUM(xcci201)+SUM(xcci301),SUM(xcci202)+SUM(xcci302),SUM(xcci202a)+SUM(xcci302a),",
               "        SUM(xcci202b)+SUM(xcci302b),SUM(xcci202c)+SUM(xcci302c),SUM(xcci202d)+SUM(xcci302d),SUM(xcci202e)+SUM(xcci302e),",
               "        SUM(xcci202f)+SUM(xcci302f),SUM(xcci202g)+SUM(xcci302g),SUM(xcci202h)+SUM(xcci302h) ",
               "   FROM xcci_t",
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea004,
               "    AND xcci005 = ",g_xcea005,
               "    AND xcci007 != 'DL+OH+SUB'",
               "    AND xcci001 = '1' ",
               "  GROUP BY xcci006,xcci007,xcci008,xcci002,xcci009 ",
               "  ORDER BY xcci006,xcci007,xcci008,xcci002,xcci009 "
   PREPARE xcci_prep FROM g_sql
   DECLARE xcci_curs CURSOR FOR xcci_prep
   FOREACH xcci_curs INTO l_xcci.xcci006,l_xcci.xcci007,l_xcci.xcci008,l_xcci.xcci002,l_xcci.xcci009,
                          l_xcci.xcci201,l_xcci.xcci202,l_xcci.xcci202a,
                          l_xcci.xcci202b,l_xcci.xcci202c,l_xcci.xcci202d,l_xcci.xcci202e,l_xcci.xcci202f,
                          l_xcci.xcci202g,l_xcci.xcci202h                          
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcci"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''      
      LET l_sfaasite =''
      
      INITIALIZE l_xcec.* TO NULL      
        
      LET l_xcec.xcec001 = l_xcci.xcci006 #工單
      LET l_xcec.xcec004 = l_xcci.xcci007 #主件
      LET l_xcec.xcec005 = l_xcci.xcci008 #特性
      LET l_xcec.xcec103 = l_xcci.xcci002 #成本域
      
      #本位幣一
      LET l_xcec.xcec201 =  l_xcci.xcci201 #投入數量
      LET l_xcec.xcec202a = l_xcci.xcci202a 
      LET l_xcec.xcec202b = l_xcci.xcci202b   
      LET l_xcec.xcec202c = l_xcci.xcci202c 
      LET l_xcec.xcec202d = l_xcci.xcci202d 
      LET l_xcec.xcec202e = l_xcci.xcci202e 
      LET l_xcec.xcec202f = l_xcci.xcci202f 
      LET l_xcec.xcec202g = l_xcci.xcci202g 
      LET l_xcec.xcec202h = l_xcci.xcci202h 
      LET l_xcec.xcec202  = l_xcci.xcci202   
   
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF


      #本位幣二
      IF g_glaa015 ='Y' THEN
         OPEN xcci_prep2 USING l_xcci.xcci006,l_xcci.xcci007,l_xcci.xcci008,l_xcci.xcci002,l_xcci.xcci009
         FETCH xcci_prep2 INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                               l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h 
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcci_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
         
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

      #本位幣三
      IF g_glaa019 ='Y' THEN
         OPEN xcci_prep3 USING l_xcci.xcci006,l_xcci.xcci007,l_xcci.xcci008,l_xcci.xcci002,l_xcci.xcci009
         FETCH xcci_prep3 INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                               l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcci_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF                               
         
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      #項次
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise 
         AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xcec.xcec003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      #存貨科目
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xcec.xcec101 

      LET l_xcec.xcec102 = ''  #摘要
      LET l_xcec.xcec115 = ''  #經營類別
      LET l_xcec.xcec116 = ''  #渠道
      LET l_xcec.xcec118 = ''  #品牌
      
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xcec.xcec111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
      ELSE
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF        


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      SELECT ooeg004 INTO l_xcec.xcec114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017 
       
      #品類
      SELECT imag011 INTO l_xcec.xcec117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xcec.xcec004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
      #                                                       l_xcec.xcec101,
      #                                                       l_xcec.xcec102,
      #                                                       l_xcec.xcec103,
      #                                                       l_xcec.xcec110,
      #                                                       l_xcec.xcec111,
      #                                                       l_xcec.xcec112,
      #                                                       l_xcec.xcec113,
      #                                                       l_xcec.xcec114,
      #                                                       l_xcec.xcec115,
      #                                                       l_xcec.xcec116,
      #                                                       l_xcec.xcec117,
      #                                                       l_xcec.xcec118,
      #                                                       l_xcec.xcec119,
      #                                                       l_xcec.xcec120,
      #                                                       l_xcec.xcec107,
      #                                                       l_xcec.xcec108,
      #                                                       l_xcec.xcec109,
      #                                                       l_xcec.xcec121,
      #                                                       l_xcec.xcec122,
      #                                                       l_xcec.xcec123,
      #                                                       l_xcec.xcec124,
      #                                                       l_xcec.xcec125,
      #                                                       l_xcec.xcec126,
      #                                                       l_xcec.xcec127,
      #                                                       l_xcec.xcec128,
      #                                                       l_xcec.xcec129,
      #                                                       l_xcec.xcec130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF
      #      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF

   CLOSE xcci_prep2
   CLOSE xcci_prep3   
       
   END FOREACH

   RETURN g_success   
END FUNCTION

################################################################################
# Descriptions...: 在制入庫新增   2.在製入庫憑證  axct702
# Memo...........:
# Usage..........: CALL axct901_01_ins_2()
# Input parameter: 
# Return code....:  
# Date & Author..: 2014/4/20 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_2()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xced          RECORD LIKE xced_t.*
#DEFINE l_xccd          RECORD LIKE xccd_t.*
#DEFINE l_xcce          RECORD LIKE xcce_t.*
#DEFINE l_xcch          RECORD LIKE xcch_t.*
#DEFINE l_xcci          RECORD LIKE xcci_t.*
#DEFINE l_xccg          RECORD LIKE xccg_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(a)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xccd RECORD  #在製主件成本期異動統計檔
       xccdent LIKE xccd_t.xccdent, #企业编号
       xccdcomp LIKE xccd_t.xccdcomp, #法人组织
       xccdld LIKE xccd_t.xccdld, #账套
       xccd001 LIKE xccd_t.xccd001, #账套本位币顺序
       xccd002 LIKE xccd_t.xccd002, #成本域
       xccd003 LIKE xccd_t.xccd003, #成本计算类型
       xccd004 LIKE xccd_t.xccd004, #年度
       xccd005 LIKE xccd_t.xccd005, #期别
       xccd006 LIKE xccd_t.xccd006, #工单编号
       xccd007 LIKE xccd_t.xccd007, #主件料号
       xccd008 LIKE xccd_t.xccd008, #产品特征
       xccd009 LIKE xccd_t.xccd009, #批号
       xccd010 LIKE xccd_t.xccd010, #项目号
       xccd011 LIKE xccd_t.xccd011, #核算币种
       xccd012 LIKE xccd_t.xccd012, #重复性成产否
       xccd013 LIKE xccd_t.xccd013, #成产计划号
       xccd014 LIKE xccd_t.xccd014, #BOM特性
       xccd101 LIKE xccd_t.xccd101, #上期结存数量
       xccd102 LIKE xccd_t.xccd102, #上期结存金额
       xccd102a LIKE xccd_t.xccd102a, #上期结存金额-材料
       xccd102b LIKE xccd_t.xccd102b, #上期结存金额-人工
       xccd102c LIKE xccd_t.xccd102c, #上期结存金额-加工
       xccd102d LIKE xccd_t.xccd102d, #上期结存金额-制费一
       xccd102e LIKE xccd_t.xccd102e, #上期结存金额-制费二
       xccd102f LIKE xccd_t.xccd102f, #上期结存金额-制费三
       xccd102g LIKE xccd_t.xccd102g, #上期结存金额-制费四
       xccd102h LIKE xccd_t.xccd102h, #上期结存金额-制费五
       xccd200 LIKE xccd_t.xccd200, #本期投入工时
       xccd201 LIKE xccd_t.xccd201, #本期投入数量
       xccd202 LIKE xccd_t.xccd202, #本期本阶投入金额
       xccd202a LIKE xccd_t.xccd202a, #本期本阶投入金额-材料
       xccd202b LIKE xccd_t.xccd202b, #本期本阶投入金额-人工
       xccd202c LIKE xccd_t.xccd202c, #本期本阶投入金额-加工
       xccd202d LIKE xccd_t.xccd202d, #本期本阶投入金额-制费一
       xccd202e LIKE xccd_t.xccd202e, #本期本阶投入金额-制费二
       xccd202f LIKE xccd_t.xccd202f, #本期本阶投入金额-制费三
       xccd202g LIKE xccd_t.xccd202g, #本期本阶投入金额-制费四
       xccd202h LIKE xccd_t.xccd202h, #本期本阶投入金额-制费五
       xccd204 LIKE xccd_t.xccd204, #本期下阶投入金额
       xccd204a LIKE xccd_t.xccd204a, #本期下阶投入金额-材料
       xccd204b LIKE xccd_t.xccd204b, #本期下阶投入金额-人工
       xccd204c LIKE xccd_t.xccd204c, #本期下阶投入金额-加工
       xccd204d LIKE xccd_t.xccd204d, #本期下阶投入金额-制费一
       xccd204e LIKE xccd_t.xccd204e, #本期下阶投入金额-制费二
       xccd204f LIKE xccd_t.xccd204f, #本期下阶投入金额-制费三
       xccd204g LIKE xccd_t.xccd204g, #本期下阶投入金额-制费四
       xccd204h LIKE xccd_t.xccd204h, #本期下阶投入金额-制费五
       xccd301 LIKE xccd_t.xccd301, #本期转出数量
       xccd302 LIKE xccd_t.xccd302, #本期转出金额
       xccd302a LIKE xccd_t.xccd302a, #本期转出金额-材料
       xccd302b LIKE xccd_t.xccd302b, #本期转出金额-人工
       xccd302c LIKE xccd_t.xccd302c, #本期转出金额-加工
       xccd302d LIKE xccd_t.xccd302d, #本期转出金额-制费一
       xccd302e LIKE xccd_t.xccd302e, #本期转出金额-制费二
       xccd302f LIKE xccd_t.xccd302f, #本期转出金额-制费三
       xccd302g LIKE xccd_t.xccd302g, #本期转出金额-制费四
       xccd302h LIKE xccd_t.xccd302h, #本期转出金额-制费五
       xccd303 LIKE xccd_t.xccd303, #差异转出数量
       xccd304 LIKE xccd_t.xccd304, #差异转出金额
       xccd304a LIKE xccd_t.xccd304a, #差异转出金额-材料
       xccd304b LIKE xccd_t.xccd304b, #差异转出金额-人工
       xccd304c LIKE xccd_t.xccd304c, #差异转出金额-加工
       xccd304d LIKE xccd_t.xccd304d, #差异转出金额-制费一
       xccd304e LIKE xccd_t.xccd304e, #差异转出金额-制费二
       xccd304f LIKE xccd_t.xccd304f, #差异转出金额-制费三
       xccd304g LIKE xccd_t.xccd304g, #差异转出金额-制费四
       xccd304h LIKE xccd_t.xccd304h, #差异转出金额-制费五
       xccd901 LIKE xccd_t.xccd901, #期末结存数量
       xccd902 LIKE xccd_t.xccd902, #期末结存金额
       xccd902a LIKE xccd_t.xccd902a, #期末结存金额-材料
       xccd902b LIKE xccd_t.xccd902b, #期末结存金额-人工
       xccd902c LIKE xccd_t.xccd902c, #期末结存金额-加工
       xccd902d LIKE xccd_t.xccd902d, #期末结存金额-制费一
       xccd902e LIKE xccd_t.xccd902e, #期末结存金额-制费二
       xccd902f LIKE xccd_t.xccd902f, #期末结存金额-制费三
       xccd902g LIKE xccd_t.xccd902g, #期末结存金额-制费四
       xccd902h LIKE xccd_t.xccd902h, #期末结存金额-制费五
       xccdtime LIKE xccd_t.xccdtime  #最近成本计算时间
END RECORD
DEFINE l_xcce RECORD  #在製元件成本期異動統計檔
       xcceent LIKE xcce_t.xcceent, #企业编号
       xccecomp LIKE xcce_t.xccecomp, #法人组织
       xcceld LIKE xcce_t.xcceld, #账套
       xcce001 LIKE xcce_t.xcce001, #账套本位币顺序
       xcce002 LIKE xcce_t.xcce002, #成本域
       xcce003 LIKE xcce_t.xcce003, #成本计算类型
       xcce004 LIKE xcce_t.xcce004, #年度
       xcce005 LIKE xcce_t.xcce005, #期别
       xcce006 LIKE xcce_t.xcce006, #工单编号
       xcce007 LIKE xcce_t.xcce007, #元件编号
       xcce008 LIKE xcce_t.xcce008, #产品特征
       xcce009 LIKE xcce_t.xcce009, #批号
       xcce010 LIKE xcce_t.xcce010, #核算币种
       xcce101 LIKE xcce_t.xcce101, #上期结存数量
       xcce102 LIKE xcce_t.xcce102, #上期结存金额
       xcce102a LIKE xcce_t.xcce102a, #上期结存金额-材料
       xcce102b LIKE xcce_t.xcce102b, #上期结存金额-人工
       xcce102c LIKE xcce_t.xcce102c, #上期结存金额-加工
       xcce102d LIKE xcce_t.xcce102d, #上期结存金额-制费一
       xcce102e LIKE xcce_t.xcce102e, #上期结存金额-制费二
       xcce102f LIKE xcce_t.xcce102f, #上期结存金额-制费三
       xcce102g LIKE xcce_t.xcce102g, #上期结存金额-制费四
       xcce102h LIKE xcce_t.xcce102h, #上期结存金额-制费五
       xcce201 LIKE xcce_t.xcce201, #本期投入数量
       xcce202 LIKE xcce_t.xcce202, #本期本阶投入金额
       xcce202a LIKE xcce_t.xcce202a, #本期本阶投入金额-材料
       xcce202b LIKE xcce_t.xcce202b, #本期本阶投入金额-人工
       xcce202c LIKE xcce_t.xcce202c, #本期本阶投入金额-加工
       xcce202d LIKE xcce_t.xcce202d, #本期本阶投入金额-制费一
       xcce202e LIKE xcce_t.xcce202e, #本期本阶投入金额-制费二
       xcce202f LIKE xcce_t.xcce202f, #本期本阶投入金额-制费三
       xcce202g LIKE xcce_t.xcce202g, #本期本阶投入金额-制费四
       xcce202h LIKE xcce_t.xcce202h, #本期本阶投入金额-制费五
       xcce205 LIKE xcce_t.xcce205, #本期当站下线数量
       xcce206 LIKE xcce_t.xcce206, #本期当站下线成本
       xcce206a LIKE xcce_t.xcce206a, #本期当站下线成本-材料
       xcce206b LIKE xcce_t.xcce206b, #本期当站下线成本-人工
       xcce206c LIKE xcce_t.xcce206c, #本期当站下线成本-加工
       xcce206d LIKE xcce_t.xcce206d, #本期当站下线成本-制费一
       xcce206e LIKE xcce_t.xcce206e, #本期当站下线成本-制费二
       xcce206f LIKE xcce_t.xcce206f, #本期当站下线成本-制费三
       xcce206g LIKE xcce_t.xcce206g, #本期当站下线成本-制费四
       xcce206h LIKE xcce_t.xcce206h, #本期当站下线成本-制费五
       xcce207 LIKE xcce_t.xcce207, #本期一般退料数量
       xcce208 LIKE xcce_t.xcce208, #本期一般退料成本
       xcce208a LIKE xcce_t.xcce208a, #本期一般退料成本-材料
       xcce208b LIKE xcce_t.xcce208b, #本期一般退料成本-人工
       xcce208c LIKE xcce_t.xcce208c, #本期一般退料成本-加工
       xcce208d LIKE xcce_t.xcce208d, #本期一般退料成本-制费一
       xcce208e LIKE xcce_t.xcce208e, #本期一般退料成本-制费二
       xcce208f LIKE xcce_t.xcce208f, #本期一般退料成本-制费三
       xcce208g LIKE xcce_t.xcce208g, #本期一般退料成本-制费四
       xcce208h LIKE xcce_t.xcce208h, #本期一般退料成本-制费五
       xcce209 LIKE xcce_t.xcce209, #本期超领退数量
       xcce210 LIKE xcce_t.xcce210, #本期超领退金额
       xcce210a LIKE xcce_t.xcce210a, #本期超领退金额-材料
       xcce210b LIKE xcce_t.xcce210b, #本期超领退金额-人工
       xcce210c LIKE xcce_t.xcce210c, #本期超领退金额-加工
       xcce210d LIKE xcce_t.xcce210d, #本期超领退金额-制费一
       xcce210e LIKE xcce_t.xcce210e, #本期超领退金额-制费二
       xcce210f LIKE xcce_t.xcce210f, #本期超领退金额-制费三
       xcce210g LIKE xcce_t.xcce210g, #本期超领退金额-制费四
       xcce210h LIKE xcce_t.xcce210h, #本期超领退金额-制费五
       xcce301 LIKE xcce_t.xcce301, #本期转出数量
       xcce302 LIKE xcce_t.xcce302, #本期转出金额
       xcce302a LIKE xcce_t.xcce302a, #本期转出金额-材料
       xcce302b LIKE xcce_t.xcce302b, #本期转出金额-人工
       xcce302c LIKE xcce_t.xcce302c, #本期转出金额-加工
       xcce302d LIKE xcce_t.xcce302d, #本期转出金额-制费一
       xcce302e LIKE xcce_t.xcce302e, #本期转出金额-制费二
       xcce302f LIKE xcce_t.xcce302f, #本期转出金额-制费三
       xcce302g LIKE xcce_t.xcce302g, #本期转出金额-制费四
       xcce302h LIKE xcce_t.xcce302h, #本期转出金额-制费五
       xcce303 LIKE xcce_t.xcce303, #差异转出数量
       xcce304 LIKE xcce_t.xcce304, #差异转出金额
       xcce304a LIKE xcce_t.xcce304a, #差异转出金额-材料
       xcce304b LIKE xcce_t.xcce304b, #差异转出金额-人工
       xcce304c LIKE xcce_t.xcce304c, #差异转出金额-加工
       xcce304d LIKE xcce_t.xcce304d, #差异转出金额-制费一
       xcce304e LIKE xcce_t.xcce304e, #差异转出金额-制费二
       xcce304f LIKE xcce_t.xcce304f, #差异转出金额-制费三
       xcce304g LIKE xcce_t.xcce304g, #差异转出金额-制费四
       xcce304h LIKE xcce_t.xcce304h, #差异转出金额-制费五
       xcce307 LIKE xcce_t.xcce307, #盘差数量
       xcce308 LIKE xcce_t.xcce308, #盘差金额
       xcce308a LIKE xcce_t.xcce308a, #盘差金额-材料
       xcce308b LIKE xcce_t.xcce308b, #盘差金额-人工
       xcce308c LIKE xcce_t.xcce308c, #盘差金额-加工
       xcce308d LIKE xcce_t.xcce308d, #盘差金额-制费一
       xcce308e LIKE xcce_t.xcce308e, #盘差金额-制费二
       xcce308f LIKE xcce_t.xcce308f, #盘差金额-制费三
       xcce308g LIKE xcce_t.xcce308g, #盘差金额-制费四
       xcce308h LIKE xcce_t.xcce308h, #盘差金额-制费五
       xcce901 LIKE xcce_t.xcce901, #期末结存数量
       xcce902 LIKE xcce_t.xcce902, #期末结存金额
       xcce902a LIKE xcce_t.xcce902a, #期末结存金额-材料
       xcce902b LIKE xcce_t.xcce902b, #期末结存金额-人工
       xcce902c LIKE xcce_t.xcce902c, #期末结存金额-加工
       xcce902d LIKE xcce_t.xcce902d, #期末结存金额-制费一
       xcce902e LIKE xcce_t.xcce902e, #期末结存金额-制费二
       xcce902f LIKE xcce_t.xcce902f, #期末结存金额-制费三
       xcce902g LIKE xcce_t.xcce902g, #期末结存金额-制费四
       xcce902h LIKE xcce_t.xcce902h, #期末结存金额-制费五
       xccetime LIKE xcce_t.xccetime  #最近成本计算时间
END RECORD
DEFINE l_xcci RECORD  #拆件在製元件成本期異動統計檔
       xccient LIKE xcci_t.xccient, #企业编号
       xccicomp LIKE xcci_t.xccicomp, #法人组织
       xccild LIKE xcci_t.xccild, #账套
       xcci001 LIKE xcci_t.xcci001, #账套本位币顺序
       xcci002 LIKE xcci_t.xcci002, #成本域
       xcci003 LIKE xcci_t.xcci003, #成本计算类型
       xcci004 LIKE xcci_t.xcci004, #年度
       xcci005 LIKE xcci_t.xcci005, #期别
       xcci006 LIKE xcci_t.xcci006, #拆件工单编号
       xcci007 LIKE xcci_t.xcci007, #元件料号
       xcci008 LIKE xcci_t.xcci008, #特性
       xcci009 LIKE xcci_t.xcci009, #批号
       xcci010 LIKE xcci_t.xcci010, #核算币种
       xcci101 LIKE xcci_t.xcci101, #上期结存数量
       xcci102 LIKE xcci_t.xcci102, #上期结存金额
       xcci102a LIKE xcci_t.xcci102a, #上期结存金额-材料
       xcci102b LIKE xcci_t.xcci102b, #上期结存金额-人工
       xcci102c LIKE xcci_t.xcci102c, #上期结存金额-加工
       xcci102d LIKE xcci_t.xcci102d, #上期结存金额-制费一
       xcci102e LIKE xcci_t.xcci102e, #上期结存金额-制费二
       xcci102f LIKE xcci_t.xcci102f, #上期结存金额-制费三
       xcci102g LIKE xcci_t.xcci102g, #上期结存金额-制费四
       xcci102h LIKE xcci_t.xcci102h, #上期结存金额-制费五
       xcci201 LIKE xcci_t.xcci201, #本期投入数量
       xcci202 LIKE xcci_t.xcci202, #本期本阶投入金额
       xcci202a LIKE xcci_t.xcci202a, #本期本阶投入金额-材料
       xcci202b LIKE xcci_t.xcci202b, #本期本阶投入金额-人工
       xcci202c LIKE xcci_t.xcci202c, #本期本阶投入金额-加工
       xcci202d LIKE xcci_t.xcci202d, #本期本阶投入金额-制费一
       xcci202e LIKE xcci_t.xcci202e, #本期本阶投入金额-制费二
       xcci202f LIKE xcci_t.xcci202f, #本期本阶投入金额-制费三
       xcci202g LIKE xcci_t.xcci202g, #本期本阶投入金额-制费四
       xcci202h LIKE xcci_t.xcci202h, #本期本阶投入金额-制费五
       xcci301 LIKE xcci_t.xcci301, #本期转出数量
       xcci302 LIKE xcci_t.xcci302, #本期转出金额
       xcci302a LIKE xcci_t.xcci302a, #本期转出金额-材料
       xcci302b LIKE xcci_t.xcci302b, #本期转出金额-人工
       xcci302c LIKE xcci_t.xcci302c, #本期转出金额-加工
       xcci302d LIKE xcci_t.xcci302d, #本期转出金额-制费一
       xcci302e LIKE xcci_t.xcci302e, #本期转出金额-制费二
       xcci302f LIKE xcci_t.xcci302f, #本期转出金额-制费三
       xcci302g LIKE xcci_t.xcci302g, #本期转出金额-制费四
       xcci302h LIKE xcci_t.xcci302h, #本期转出金额-制费五
       xcci303 LIKE xcci_t.xcci303, #差异转出数量
       xcci304 LIKE xcci_t.xcci304, #差异转出金额
       xcci304a LIKE xcci_t.xcci304a, #差异转出金额-材料
       xcci304b LIKE xcci_t.xcci304b, #差异转出金额-人工
       xcci304c LIKE xcci_t.xcci304c, #差异转出金额-加工
       xcci304d LIKE xcci_t.xcci304d, #差异转出金额-制费一
       xcci304e LIKE xcci_t.xcci304e, #差异转出金额-制费二
       xcci304f LIKE xcci_t.xcci304f, #差异转出金额-制费三
       xcci304g LIKE xcci_t.xcci304g, #差异转出金额-制费四
       xcci304h LIKE xcci_t.xcci304h, #差异转出金额-制费五
       xcci901 LIKE xcci_t.xcci901, #期末结存数量
       xcci902 LIKE xcci_t.xcci902, #期末结存金额
       xcci902a LIKE xcci_t.xcci902a, #期末结存金额-材料
       xcci902b LIKE xcci_t.xcci902b, #期末结存金额-人工
       xcci902c LIKE xcci_t.xcci902c, #期末结存金额-加工
       xcci902d LIKE xcci_t.xcci902d, #期末结存金额-制费一
       xcci902e LIKE xcci_t.xcci902e, #期末结存金额-制费二
       xcci902f LIKE xcci_t.xcci902f, #期末结存金额-制费三
       xcci902g LIKE xcci_t.xcci902g, #期末结存金额-制费四
       xcci902h LIKE xcci_t.xcci902h, #期末结存金额-制费五
       xccitime LIKE xcci_t.xccitime  #最近成本计算时间
END RECORD
DEFINE l_xcch RECORD  #拆件在製主件成本期異動統計檔
       xcchent LIKE xcch_t.xcchent, #企业编号
       xcchcomp LIKE xcch_t.xcchcomp, #法人组织
       xcchld LIKE xcch_t.xcchld, #账套
       xcch001 LIKE xcch_t.xcch001, #账套本位币顺序
       xcch002 LIKE xcch_t.xcch002, #成本域
       xcch003 LIKE xcch_t.xcch003, #成本计算类型
       xcch004 LIKE xcch_t.xcch004, #年度
       xcch005 LIKE xcch_t.xcch005, #期别
       xcch006 LIKE xcch_t.xcch006, #拆件工单编号
       xcch007 LIKE xcch_t.xcch007, #主件料号
       xcch008 LIKE xcch_t.xcch008, #特性
       xcch009 LIKE xcch_t.xcch009, #批号
       xcch010 LIKE xcch_t.xcch010, #项目号
       xcch011 LIKE xcch_t.xcch011, #核算币种
       xcch101 LIKE xcch_t.xcch101, #上期结存数量
       xcch102 LIKE xcch_t.xcch102, #上期结存金额
       xcch102a LIKE xcch_t.xcch102a, #上期结存金额-材料
       xcch102b LIKE xcch_t.xcch102b, #上期结存金额-人工
       xcch102c LIKE xcch_t.xcch102c, #上期结存金额-加工
       xcch102d LIKE xcch_t.xcch102d, #上期结存金额-制费一
       xcch102e LIKE xcch_t.xcch102e, #上期结存金额-制费二
       xcch102f LIKE xcch_t.xcch102f, #上期结存金额-制费三
       xcch102g LIKE xcch_t.xcch102g, #上期结存金额-制费四
       xcch102h LIKE xcch_t.xcch102h, #上期结存金额-制费五
       xcch200 LIKE xcch_t.xcch200, #本期投入工时
       xcch201 LIKE xcch_t.xcch201, #本期投入数量
       xcch202 LIKE xcch_t.xcch202, #本期本阶投入金额
       xcch202a LIKE xcch_t.xcch202a, #本期本阶投入金额-材料
       xcch202b LIKE xcch_t.xcch202b, #本期本阶投入金额-人工
       xcch202c LIKE xcch_t.xcch202c, #本期本阶投入金额-加工
       xcch202d LIKE xcch_t.xcch202d, #本期本阶投入金额-制费一
       xcch202e LIKE xcch_t.xcch202e, #本期本阶投入金额-制费二
       xcch202f LIKE xcch_t.xcch202f, #本期本阶投入金额-制费三
       xcch202g LIKE xcch_t.xcch202g, #本期本阶投入金额-制费四
       xcch202h LIKE xcch_t.xcch202h, #本期本阶投入金额-制费五
       xcch204 LIKE xcch_t.xcch204, #本期下阶投入金额
       xcch204a LIKE xcch_t.xcch204a, #本期下阶投入金额-材料
       xcch204b LIKE xcch_t.xcch204b, #本期下阶投入金额-人工
       xcch204c LIKE xcch_t.xcch204c, #本期下阶投入金额-加工
       xcch204d LIKE xcch_t.xcch204d, #本期下阶投入金额-制费一
       xcch204e LIKE xcch_t.xcch204e, #本期下阶投入金额-制费二
       xcch204f LIKE xcch_t.xcch204f, #本期下阶投入金额-制费三
       xcch204g LIKE xcch_t.xcch204g, #本期下阶投入金额-制费四
       xcch204h LIKE xcch_t.xcch204h, #本期下阶投入金额-制费五
       xcch301 LIKE xcch_t.xcch301, #本期转出数量
       xcch302 LIKE xcch_t.xcch302, #本期转出金额
       xcch302a LIKE xcch_t.xcch302a, #本期转出金额-材料
       xcch302b LIKE xcch_t.xcch302b, #本期转出金额-人工
       xcch302c LIKE xcch_t.xcch302c, #本期转出金额-加工
       xcch302d LIKE xcch_t.xcch302d, #本期转出金额-制费一
       xcch302e LIKE xcch_t.xcch302e, #本期转出金额-制费二
       xcch302f LIKE xcch_t.xcch302f, #本期转出金额-制费三
       xcch302g LIKE xcch_t.xcch302g, #本期转出金额-制费四
       xcch302h LIKE xcch_t.xcch302h, #本期转出金额-制费五
       xcch303 LIKE xcch_t.xcch303, #差异转出数量
       xcch304 LIKE xcch_t.xcch304, #差异转出金额
       xcch304a LIKE xcch_t.xcch304a, #差异转出金额-材料
       xcch304b LIKE xcch_t.xcch304b, #差异转出金额-人工
       xcch304c LIKE xcch_t.xcch304c, #差异转出金额-加工
       xcch304d LIKE xcch_t.xcch304d, #差异转出金额-制费一
       xcch304e LIKE xcch_t.xcch304e, #差异转出金额-制费二
       xcch304f LIKE xcch_t.xcch304f, #差异转出金额-制费三
       xcch304g LIKE xcch_t.xcch304g, #差异转出金额-制费四
       xcch304h LIKE xcch_t.xcch304h, #差异转出金额-制费五
       xcch901 LIKE xcch_t.xcch901, #期末结存数量
       xcch902 LIKE xcch_t.xcch902, #期末结存金额
       xcch902a LIKE xcch_t.xcch902a, #期末结存金额-材料
       xcch902b LIKE xcch_t.xcch902b, #期末结存金额-人工
       xcch902c LIKE xcch_t.xcch902c, #期末结存金额-加工
       xcch902d LIKE xcch_t.xcch902d, #期末结存金额-制费一
       xcch902e LIKE xcch_t.xcch902e, #期末结存金额-制费二
       xcch902f LIKE xcch_t.xcch902f, #期末结存金额-制费三
       xcch902g LIKE xcch_t.xcch902g, #期末结存金额-制费四
       xcch902h LIKE xcch_t.xcch902h, #期末结存金额-制费五
       xcchtime LIKE xcch_t.xcchtime  #最近成本计算时间
END RECORD
DEFINE l_xced RECORD  #成本憑證第三單身檔(在製人工費用科目設定)
       xcedent LIKE xced_t.xcedent, #企业编号
       xcedcomp LIKE xced_t.xcedcomp, #法人组织
       xcedld LIKE xced_t.xcedld, #账套
       xceddocno LIKE xced_t.xceddocno, #单据编号
       xcedseq LIKE xced_t.xcedseq, #项次
       xced001 LIKE xced_t.xced001, #在制科目分类
       xced101 LIKE xced_t.xced101, #科目编号
       xced102 LIKE xced_t.xced102, #摘要
       xced110 LIKE xced_t.xced110, #原因码
       xced111 LIKE xced_t.xced111, #收付款客商
       xced112 LIKE xced_t.xced112, #客群
       xced113 LIKE xced_t.xced113, #区域
       xced114 LIKE xced_t.xced114, #成本中心
       xced115 LIKE xced_t.xced115, #经营类别
       xced116 LIKE xced_t.xced116, #渠道
       xced117 LIKE xced_t.xced117, #品类
       xced118 LIKE xced_t.xced118, #品牌
       xced119 LIKE xced_t.xced119, #项目编号
       xced120 LIKE xced_t.xced120, #WBS
       xced202 LIKE xced_t.xced202, #成本金额(本位币一)
       xced212 LIKE xced_t.xced212, #成本金额(本位币二)
       xced222 LIKE xced_t.xced222, #成本金额(本位币三)
       xced301 LIKE xced_t.xced301, #凭证编号
       xced302 LIKE xced_t.xced302, #凭证项次
       xced107 LIKE xced_t.xced107, #人员
       xced108 LIKE xced_t.xced108, #部门
       xced109 LIKE xced_t.xced109, #账款对象
       xced121 LIKE xced_t.xced121, #自由核算项1
       xced122 LIKE xced_t.xced122, #自由核算项2
       xced123 LIKE xced_t.xced123, #自由核算项3
       xced124 LIKE xced_t.xced124, #自由核算项4
       xced125 LIKE xced_t.xced125, #自由核算项5
       xced126 LIKE xced_t.xced126, #自由核算项6
       xced127 LIKE xced_t.xced127, #自由核算项7
       xced128 LIKE xced_t.xced128, #自由核算项8
       xced129 LIKE xced_t.xced129, #自由核算项9
       xced130 LIKE xced_t.xced130  #自由核算项10
END RECORD
DEFINE l_xccg RECORD  #聯產品成本期異動統計檔
       xccgent LIKE xccg_t.xccgent, #企业编号
       xccgcomp LIKE xccg_t.xccgcomp, #法人组织
       xccgld LIKE xccg_t.xccgld, #账套
       xccg001 LIKE xccg_t.xccg001, #账套本位币顺序
       xccg002 LIKE xccg_t.xccg002, #成本域
       xccg003 LIKE xccg_t.xccg003, #成本计算类型
       xccg004 LIKE xccg_t.xccg004, #年度
       xccg005 LIKE xccg_t.xccg005, #期别
       xccg006 LIKE xccg_t.xccg006, #工单编号
       xccg007 LIKE xccg_t.xccg007, #联产品料号
       xccg008 LIKE xccg_t.xccg008, #特性
       xccg009 LIKE xccg_t.xccg009, #批号
       xccg010 LIKE xccg_t.xccg010, #核算币种
       xccg101 LIKE xccg_t.xccg101, #上期结存数量
       xccg102 LIKE xccg_t.xccg102, #上期结存金额
       xccg102a LIKE xccg_t.xccg102a, #上期结存金额-材料
       xccg102b LIKE xccg_t.xccg102b, #上期结存金额-人工
       xccg102c LIKE xccg_t.xccg102c, #上期结存金额-加工
       xccg102d LIKE xccg_t.xccg102d, #上期结存金额-制费一
       xccg102e LIKE xccg_t.xccg102e, #上期结存金额-制费二
       xccg102f LIKE xccg_t.xccg102f, #上期结存金额-制费三
       xccg102g LIKE xccg_t.xccg102g, #上期结存金额-制费四
       xccg102h LIKE xccg_t.xccg102h, #上期结存金额-制费五
       xccg301 LIKE xccg_t.xccg301, #本期转出数量
       xccg302 LIKE xccg_t.xccg302, #本期转出金额
       xccg302a LIKE xccg_t.xccg302a, #本期转出金额-材料
       xccg302b LIKE xccg_t.xccg302b, #本期转出金额-人工
       xccg302c LIKE xccg_t.xccg302c, #本期转出金额-加工
       xccg302d LIKE xccg_t.xccg302d, #本期转出金额-制费一
       xccg302e LIKE xccg_t.xccg302e, #本期转出金额-制费二
       xccg302f LIKE xccg_t.xccg302f, #本期转出金额-制费三
       xccg302g LIKE xccg_t.xccg302g, #本期转出金额-制费四
       xccg302h LIKE xccg_t.xccg302h, #本期转出金额-制费五
       xccg901 LIKE xccg_t.xccg901, #期末结存数量
       xccg902 LIKE xccg_t.xccg902, #期末结存金额
       xccg902a LIKE xccg_t.xccg902a, #期末结存金额-材料
       xccg902b LIKE xccg_t.xccg902b, #期末结存金额-人工
       xccg902c LIKE xccg_t.xccg902c, #期末结存金额-加工
       xccg902d LIKE xccg_t.xccg902d, #期末结存金额-制费一
       xccg902e LIKE xccg_t.xccg902e, #期末结存金额-制费二
       xccg902f LIKE xccg_t.xccg902f, #期末结存金额-制费三
       xccg902g LIKE xccg_t.xccg902g, #期末结存金额-制费四
       xccg902h LIKE xccg_t.xccg902h, #期末结存金额-制费五
       xccgtime LIKE xccg_t.xccgtime  #最近成本计算时间
END RECORD
#161124-00048#21 add(e)
DEFINE l_sfaa052       LIKE sfaa_t.sfaa052
DEFINE l_sfaa009       LIKE sfaa_t.sfaa009
DEFINE l_sfaa028       LIKE sfaa_t.sfaa028
DEFINE l_sfaa029       LIKE sfaa_t.sfaa029
DEFINE l_sfaa017       LIKE sfaa_t.sfaa017
DEFINE l_sfaasite      LIKE sfaa_t.sfaasite
DEFINE l_xced101_1     LIKE xced_t.xced101
DEFINE l_xced101_2     LIKE xced_t.xced101
DEFINE l_xced101_3     LIKE xced_t.xced101
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,l_xcea.xceacrtdt,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "ins xcea"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   #工單是否有聯產品入庫-若無
   #非拆件工單 xccd_t-主件
   #在xccd中排除工單中即有聯產品入庫，又有無聯產品入庫
   LET g_sql = " SELECT SUM(xccd302) *(-1),SUM(xccd302a)*(-1),",
               "        SUM(xccd302b)*(-1),SUM(xccd302c)*(-1),SUM(xccd302d)*(-1),SUM(xccd302e)*(-1),",
               "        SUM(xccd302f)*(-1),SUM(xccd302g)*(-1),SUM(xccd302h)*(-1) ",
               "   FROM xccd_t", 
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea004,
               "    AND xccd005 = ",g_xcea005,  
#               "    AND xccd006 NOT IN (SELECT xccg006 FROM xccg_t  WHERE xccgent = '",g_enterprise,"' ",
#               "                              AND xccgld = '",g_xcea_m.xceald,"' ",
#               "                              AND xccg003 = '",g_xcea_m.xcea003,"' ",
#               "                              AND xccg004 = ",g_xcea004,
#               "                              AND xccg005 = ",g_xcea005,")",               
               "    AND xccd006 = ? AND xccd007 = ? AND xccd008 = ? AND xccd002 = ? " 
 
   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '2' " 
   
   DECLARE xccd_prep2_2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '3' " 
   
   DECLARE xccd_prep3_2 CURSOR FROM g_sql1
   
   LET g_sql = " SELECT xccd006,xccd007,xccd008,xccd002,",
               "        SUM(xccd301) *(-1),SUM(xccd302) *(-1),SUM(xccd302a)*(-1),",
               "        SUM(xccd302b)*(-1),SUM(xccd302c)*(-1),SUM(xccd302d)*(-1),SUM(xccd302e)*(-1),",
               "        SUM(xccd302f)*(-1),SUM(xccd302g)*(-1),SUM(xccd302h)*(-1) ",
               "   FROM xccd_t",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea004,
               "    AND xccd005 = ",g_xcea005,
               "    AND xccd001 = '1' ",                
               "  GROUP BY xccd006,xccd007,xccd008,xccd002",
               "  ORDER BY xccd006,xccd007,xccd008,xccd002"
   PREPARE xccd_prep_2 FROM g_sql
   DECLARE xccd_curs_2 CURSOR FOR xccd_prep_2
   FOREACH xccd_curs_2 INTO l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002, 
                          l_xccd.xccd301,l_xccd.xccd302,l_xccd.xccd302a,
                          l_xccd.xccd302b,l_xccd.xccd302c,l_xccd.xccd302d,l_xccd.xccd302e,l_xccd.xccd302f,
                          l_xccd.xccd302g,l_xccd.xccd302h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xccd"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''      
      LET l_sfaasite =''
      
      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb001 = l_xccd.xccd006 #工單
      LET l_xceb.xceb004 = l_xccd.xccd007 #主件
      LET l_xceb.xceb005 = l_xccd.xccd008 #特性
      LET l_xceb.xceb103 = l_xccd.xccd002 #成本域
      
      #本位幣一
      LET l_xceb.xceb201 =  l_xccd.xccd301#入庫數量
      LET l_xceb.xceb202a = l_xccd.xccd302a 
      LET l_xceb.xceb202b = l_xccd.xccd302b   
      LET l_xceb.xceb202c = l_xccd.xccd302c 
      LET l_xceb.xceb202d = l_xccd.xccd302d 
      LET l_xceb.xceb202e = l_xccd.xccd302e 
      LET l_xceb.xceb202f = l_xccd.xccd302f 
      LET l_xceb.xceb202g = l_xccd.xccd302g 
      LET l_xceb.xceb202h = l_xccd.xccd302h 
      LET l_xceb.xceb202  = l_xccd.xccd302       

      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF
      
      IF g_glaa015 ='Y' THEN
      #本位幣二
         OPEN xccd_prep2_2 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep2_2 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                                 l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

      IF g_glaa019 ='Y' THEN
      #本位幣三
         OPEN xccd_prep3_2 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep3_2 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                                 l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      #項次
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise 
         AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xceb.xceb003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      #存貨科目
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xceb.xceb101  

      LET l_xceb.xceb102 = ''  #摘要
      LET l_xceb.xceb115 = ''  #經營類別
      LET l_xceb.xceb116 = ''  #渠道
      LET l_xceb.xceb118 = ''  #品牌
       
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xceb.xceb111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
      ELSE
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF        


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      SELECT ooeg004 INTO l_xceb.xceb114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017   
       
      #品類
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xceb.xceb004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      IF l_xceb.xceb201=0 AND l_xceb.xceb202 = 0 AND l_xceb.xceb202a = 0 AND
         l_xceb.xceb202b = 0 AND l_xceb.xceb202c = 0 AND l_xceb.xceb202d = 0 AND 
         l_xceb.xceb202d = 0 AND l_xceb.xceb202f = 0 AND l_xceb.xceb202g = 0 AND 
         l_xceb.xceb202h = 0 THEN 
         CONTINUE FOREACH
      END IF 
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','2') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF 
      #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xccd_prep2_2
   CLOSE xccd_prep3_2      
   END FOREACH 


      
   #非拆件工單 xcce_t-元件
   LET g_sql = " SELECT SUM(xcce302) *(-1),SUM(xcce302a)*(-1), ",
               "        SUM(xcce302b)*(-1),SUM(xcce302c)*(-1),SUM(xcce302d)*(-1),SUM(xcce302e)*(-1),",
               "        SUM(xcce302f)*(-1),SUM(xcce302g)*(-1),SUM(xcce302h)*(-1) ",
               "   FROM xcce_t", 
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea004,
               "    AND xcce005 = ",g_xcea005,  
               "    AND xcce006 = ? AND xcce007 = ? AND xcce008 = ? AND xcce002 = ?  " 
 
   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '2' " 
   
   DECLARE xcce_prep2_2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '3' " 
   
   DECLARE xcce_prep3_2 CURSOR FROM g_sql1
   
   LET g_sql = " SELECT xcce006,xcce007,xcce008,xcce002,",
               "        SUM(xcce301) *(-1),SUM(xcce302) *(-1),SUM(xcce302a)*(-1),",
               "        SUM(xcce302b)*(-1),SUM(xcce302c)*(-1),SUM(xcce302d)*(-1),SUM(xcce302e)*(-1),",
               "        SUM(xcce302f)*(-1),SUM(xcce302g)*(-1),SUM(xcce302h)*(-1) ",
               "   FROM xcce_t",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea004,
               "    AND xcce005 = ",g_xcea005,
               "    AND xcce001 = '1' ",
               "  GROUP BY xcce006,xcce007,xcce008,xcce002",
               "  ORDER BY xcce006,xcce007,xcce008,xcce002 "
   PREPARE xcce_prep_2 FROM g_sql
   DECLARE xcce_curs_2 CURSOR FOR xcce_prep_2
   FOREACH xcce_curs_2 INTO l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce008,l_xcce.xcce002,
                          l_xcce.xcce301,l_xcce.xcce302,l_xcce.xcce302a,
                          l_xcce.xcce302b,l_xcce.xcce302c,l_xcce.xcce302d,l_xcce.xcce302e,l_xcce.xcce302f,
                          l_xcce.xcce302g,l_xcce.xcce302h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcce"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''
      LET l_sfaasite =''
      
      INITIALIZE l_xcec.* TO NULL
      
      LET l_xcec.xcec001 = l_xcce.xcce006 #工單
      LET l_xcec.xcec004 = l_xcce.xcce007 #主件
      LET l_xcec.xcec005 = l_xcce.xcce008 #特性
      LET l_xcec.xcec103 = l_xcce.xcce002 #成本域
      
      #本位幣一
      LET l_xcec.xcec201 =  l_xcce.xcce301#投入數量
      LET l_xcec.xcec202a = l_xcce.xcce302a 
      LET l_xcec.xcec202b = l_xcce.xcce302b   
      LET l_xcec.xcec202c = l_xcce.xcce302c 
      LET l_xcec.xcec202d = l_xcce.xcce302d 
      LET l_xcec.xcec202e = l_xcce.xcce302e 
      LET l_xcec.xcec202f = l_xcce.xcce302f 
      LET l_xcec.xcec202g = l_xcce.xcce302g 
      LET l_xcec.xcec202h = l_xcce.xcce302h 
      LET l_xcec.xcec202  = l_xcce.xcce302       

      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF

      #本位幣二
      IF g_glaa015 ='Y' THEN
         OPEN  xcce_prep2_2 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce008,l_xcce.xcce002
         FETCH xcce_prep2_2 INTO  l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                                  l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF  
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF         
      
      #本位幣三
      IF g_glaa019 ='Y' THEN
         OPEN  xcce_prep3_2 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce008,l_xcce.xcce002
         FETCH xcce_prep3_2 INTO  l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                                  l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF         
      
      #項次
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise 
         AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xcec.xcec003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xcec.xcec101 

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      
      LET l_xcec.xcec102 = ''  #摘要
      LET l_xcec.xcec115 = ''  #經營類別
      LET l_xcec.xcec116 = ''  #渠道
      LET l_xcec.xcec118 = ''  #品牌

      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xcec.xcec111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
      ELSE
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      SELECT ooeg004 INTO l_xcec.xcec114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017 

      #品類
      SELECT imag011 INTO l_xcec.xcec117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xcec.xcec004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      IF l_xcec.xcec201 = 0 AND l_xcec.xcec202 = 0 AND l_xcec.xcec202a = 0 AND l_xcec.xcec202b= 0 AND
         l_xcec.xcec202c= 0  AND l_xcec.xcec202d= 0  AND l_xcec.xcec202e= 0   AND l_xcec.xcec202f= 0  AND 
         l_xcec.xcec202g= 0  AND l_xcec.xcec202h= 0 THEN 
         CONTINUE FOREACH 
      END IF
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','2') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
      #                                                       l_xcec.xcec101,
      #                                                       l_xcec.xcec102,
      #                                                       l_xcec.xcec103,
      #                                                       l_xcec.xcec110,
      #                                                       l_xcec.xcec111,
      #                                                       l_xcec.xcec112,
      #                                                       l_xcec.xcec113,
      #                                                       l_xcec.xcec114,
      #                                                       l_xcec.xcec115,
      #                                                       l_xcec.xcec116,
      #                                                       l_xcec.xcec117,
      #                                                       l_xcec.xcec118,
      #                                                       l_xcec.xcec119,
      #                                                       l_xcec.xcec120,
      #                                                       l_xcec.xcec107,
      #                                                       l_xcec.xcec108,
      #                                                       l_xcec.xcec109,
      #                                                       l_xcec.xcec121,
      #                                                       l_xcec.xcec122,
      #                                                       l_xcec.xcec123,
      #                                                       l_xcec.xcec124,
      #                                                       l_xcec.xcec125,
      #                                                       l_xcec.xcec126,
      #                                                       l_xcec.xcec127,
      #                                                       l_xcec.xcec128,
      #                                                       l_xcec.xcec129,
      #                                                       l_xcec.xcec130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF
      #      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xcce_prep2_2
   CLOSE xcce_prep3_2      
   END FOREACH 

   #第三單身
   CALL axct901_01_ins_xced() RETURNING l_success
   IF NOT l_success THEN LET g_success = 'N' END IF 

 RETURN g_success
END FUNCTION

################################################################################
# Descriptions...: 新增xced
# Memo...........:
# Usage..........: CALL axct901_01_ins_xced()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/20 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_xced()
#DEFINE l_xcec          RECORD LIKE xcec_t.*  #161124-00048#21 mark
#DEFINE l_xced          RECORD LIKE xced_t.*  #161124-00048#21 mark
#161124-00048#21 add(s)
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xced RECORD  #成本憑證第三單身檔(在製人工費用科目設定)
       xcedent LIKE xced_t.xcedent, #企业编号
       xcedcomp LIKE xced_t.xcedcomp, #法人组织
       xcedld LIKE xced_t.xcedld, #账套
       xceddocno LIKE xced_t.xceddocno, #单据编号
       xcedseq LIKE xced_t.xcedseq, #项次
       xced001 LIKE xced_t.xced001, #在制科目分类
       xced101 LIKE xced_t.xced101, #科目编号
       xced102 LIKE xced_t.xced102, #摘要
       xced110 LIKE xced_t.xced110, #原因码
       xced111 LIKE xced_t.xced111, #收付款客商
       xced112 LIKE xced_t.xced112, #客群
       xced113 LIKE xced_t.xced113, #区域
       xced114 LIKE xced_t.xced114, #成本中心
       xced115 LIKE xced_t.xced115, #经营类别
       xced116 LIKE xced_t.xced116, #渠道
       xced117 LIKE xced_t.xced117, #品类
       xced118 LIKE xced_t.xced118, #品牌
       xced119 LIKE xced_t.xced119, #项目编号
       xced120 LIKE xced_t.xced120, #WBS
       xced202 LIKE xced_t.xced202, #成本金额(本位币一)
       xced212 LIKE xced_t.xced212, #成本金额(本位币二)
       xced222 LIKE xced_t.xced222, #成本金额(本位币三)
       xced301 LIKE xced_t.xced301, #凭证编号
       xced302 LIKE xced_t.xced302, #凭证项次
       xced107 LIKE xced_t.xced107, #人员
       xced108 LIKE xced_t.xced108, #部门
       xced109 LIKE xced_t.xced109, #账款对象
       xced121 LIKE xced_t.xced121, #自由核算项1
       xced122 LIKE xced_t.xced122, #自由核算项2
       xced123 LIKE xced_t.xced123, #自由核算项3
       xced124 LIKE xced_t.xced124, #自由核算项4
       xced125 LIKE xced_t.xced125, #自由核算项5
       xced126 LIKE xced_t.xced126, #自由核算项6
       xced127 LIKE xced_t.xced127, #自由核算项7
       xced128 LIKE xced_t.xced128, #自由核算项8
       xced129 LIKE xced_t.xced129, #自由核算项9
       xced130 LIKE xced_t.xced130  #自由核算项10
END RECORD
#161124-00048#21 add(e)
DEFINE l_xced101_1     LIKE xced_t.xced101
DEFINE l_xced101_2     LIKE xced_t.xced101
DEFINE l_xced101_3     LIKE xced_t.xced101
DEFINE l_xced101_4     LIKE xced_t.xced101
DEFINE l_xced101_5     LIKE xced_t.xced101
DEFINE l_xced101_6     LIKE xced_t.xced101
DEFINE l_xced101_7     LIKE xced_t.xced101
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001

INITIALIZE l_xcec.* TO NULL
INITIALIZE l_xced.* TO NULL
   #xcec_t中DL+OH_SUB元件彙總-xced   
   LET g_sql = " SELECT xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120,",
               "        SUM(xcec202b),SUM(xcec202c),SUM(xcec202d),SUM(xcec202e),",
               "        SUM(xcec202f),SUM(xcec202g),SUM(xcec202h), ",
               "        SUM(xcec212b),SUM(xcec212c),SUM(xcec212d),SUM(xcec212e),",
               "        SUM(xcec212f),SUM(xcec212g),SUM(xcec212h), ",
               "        SUM(xcec222b),SUM(xcec222c),SUM(xcec222d),SUM(xcec222e),",
               "        SUM(xcec222f),SUM(xcec222g),SUM(xcec222h) ",
               "   FROM xcec_t",
               "  WHERE xcecent = '",g_enterprise,"' AND xcecld = '",g_xcea_m.xceald,"'",
               "    AND xcecdocno = '",g_xcea_m.xceadocno,"'", 
               "    AND xcec004 = 'DL+OH+SUB' ",
               "  GROUP BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 ",
               "  ORDER BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 "
   PREPARE xcec_prep_2 FROM g_sql
   DECLARE xcec_curs_2 CURSOR FOR xcec_prep_2
   FOREACH xcec_curs_2 INTO l_xcec.xcec102,l_xcec.xcec114,l_xcec.xcec113,
                            l_xcec.xcec111,l_xcec.xcec117,l_xcec.xcec119,l_xcec.xcec120,
                            l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,
                            l_xcec.xcec202g,l_xcec.xcec202h, 
                            l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,
                            l_xcec.xcec212g,l_xcec.xcec212h,
                            l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,
                            l_xcec.xcec222g,l_xcec.xcec222h                        
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  
   
      LET l_xced.xced102 = l_xcec.xcec102
      LET l_xced.xced114 = l_xcec.xcec114
      LET l_xced.xced113 = l_xcec.xcec113
      LET l_xced.xced111 = l_xcec.xcec111
      LET l_xced.xced117 = l_xcec.xcec117
      LET l_xced.xced119 = l_xcec.xcec119
      LET l_xced.xced120 = l_xcec.xcec120
      
      #在制人工科目
      CALL s_get_item_acc(g_xcea_m.xceald,'6',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_1  

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xced101_1) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','2') RETURNING l_success,l_xced101_1,l_errno
      END IF
      
      #在制加工费科目
      CALL s_get_item_acc(g_xcea_m.xceald,'7',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_2  

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xced101_2) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','3') RETURNING l_success,l_xced101_2,l_errno
      END IF
      
      #在制制费一科目
      CALL s_get_item_acc(g_xcea_m.xceald,'11',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_3  

      IF cl_null(l_xced101_3) THEN
         LET l_xced101_3 = l_xced101_2
      END IF
      
      #在制制费二科目
      CALL s_get_item_acc(g_xcea_m.xceald,'12',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_4  

      IF cl_null(l_xced101_4) THEN
         LET l_xced101_4 = l_xced101_2
      END IF
      
      #在制制费三科目
      CALL s_get_item_acc(g_xcea_m.xceald,'13',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_5  

      IF cl_null(l_xced101_5) THEN
         LET l_xced101_5 = l_xced101_2
      END IF
      
      #在制费四科目
      CALL s_get_item_acc(g_xcea_m.xceald,'14',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_6  

      IF cl_null(l_xced101_6) THEN
         LET l_xced101_6 = l_xced101_2
      END IF
      
      #在制制费五科目
      CALL s_get_item_acc(g_xcea_m.xceald,'15',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_7  

      IF cl_null(l_xced101_7) THEN
         LET l_xced101_7 = l_xced101_2
      END IF         
                
      #項次
      SELECT MAX(xcedseq) INTO l_xced.xcedseq FROM xced_t
       WHERE xcedent = g_enterprise 
         AND xcedld = g_xcea_m.xceald
         AND xceddocno = g_xcea_m.xceadocno
      IF cl_null(l_xced.xcedseq) OR l_xced.xcedseq = 0 THEN
         LET l_xced.xcedseq = 1
      ELSE
         LET l_xced.xcedseq = l_xced.xcedseq + 1
      END IF       
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 1
      LET l_xced.xced101   = l_xced101_1
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202b
      LET l_xced.xced212   = l_xcec.xcec212b
      LET l_xced.xced222   = l_xcec.xcec222b
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      
#      INSERT INTO xced_t VALUES (l_xced.*)  #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xced_t(xcedent,xcedcomp,xcedld,xceddocno,xcedseq,xced001,xced101,xced102,xced110,
                         xced111,xced112,xced113,xced114,xced115,xced116,xced117,xced118,xced119,
                         xced120,xced202,xced212,xced222,xced301,xced302,xced107,xced108,xced109,
                         xced121,xced122,xced123,xced124,xced125,xced126,xced127,xced128,xced129,xced130) 
                 VALUES (l_xced.xcedent,l_xced.xcedcomp,l_xced.xcedld,l_xced.xceddocno,l_xced.xcedseq,l_xced.xced001,l_xced.xced101,l_xced.xced102,l_xced.xced110,
                         l_xced.xced111,l_xced.xced112,l_xced.xced113,l_xced.xced114,l_xced.xced115,l_xced.xced116,l_xced.xced117,l_xced.xced118,l_xced.xced119,
                         l_xced.xced120,l_xced.xced202,l_xced.xced212,l_xced.xced222,l_xced.xced301,l_xced.xced302,l_xced.xced107,l_xced.xced108,l_xced.xced109,
                         l_xced.xced121,l_xced.xced122,l_xced.xced123,l_xced.xced124,l_xced.xced125,l_xced.xced126,l_xced.xced127,l_xced.xced128,l_xced.xced129,l_xced.xced130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 1"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  

      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 2
      LET l_xced.xced101   = l_xced101_2
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202c
      LET l_xced.xced212   = l_xcec.xcec212c
      LET l_xced.xced222   = l_xcec.xcec222c
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1    
      
#      INSERT INTO xced_t VALUES (l_xced.*)  #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xced_t(xcedent,xcedcomp,xcedld,xceddocno,xcedseq,xced001,xced101,xced102,xced110,
                         xced111,xced112,xced113,xced114,xced115,xced116,xced117,xced118,xced119,
                         xced120,xced202,xced212,xced222,xced301,xced302,xced107,xced108,xced109,
                         xced121,xced122,xced123,xced124,xced125,xced126,xced127,xced128,xced129,xced130) 
                 VALUES (l_xced.xcedent,l_xced.xcedcomp,l_xced.xcedld,l_xced.xceddocno,l_xced.xcedseq,l_xced.xced001,l_xced.xced101,l_xced.xced102,l_xced.xced110,
                         l_xced.xced111,l_xced.xced112,l_xced.xced113,l_xced.xced114,l_xced.xced115,l_xced.xced116,l_xced.xced117,l_xced.xced118,l_xced.xced119,
                         l_xced.xced120,l_xced.xced202,l_xced.xced212,l_xced.xced222,l_xced.xced301,l_xced.xced302,l_xced.xced107,l_xced.xced108,l_xced.xced109,
                         l_xced.xced121,l_xced.xced122,l_xced.xced123,l_xced.xced124,l_xced.xced125,l_xced.xced126,l_xced.xced127,l_xced.xced128,l_xced.xced129,l_xced.xced130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 2"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF


      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 3
      LET l_xced.xced101   = l_xced101_3
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202d
      LET l_xced.xced212   = l_xcec.xcec212d
      LET l_xced.xced222   = l_xcec.xcec222d
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
#      INSERT INTO xced_t VALUES (l_xced.*)  #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xced_t(xcedent,xcedcomp,xcedld,xceddocno,xcedseq,xced001,xced101,xced102,xced110,
                         xced111,xced112,xced113,xced114,xced115,xced116,xced117,xced118,xced119,
                         xced120,xced202,xced212,xced222,xced301,xced302,xced107,xced108,xced109,
                         xced121,xced122,xced123,xced124,xced125,xced126,xced127,xced128,xced129,xced130) 
                 VALUES (l_xced.xcedent,l_xced.xcedcomp,l_xced.xcedld,l_xced.xceddocno,l_xced.xcedseq,l_xced.xced001,l_xced.xced101,l_xced.xced102,l_xced.xced110,
                         l_xced.xced111,l_xced.xced112,l_xced.xced113,l_xced.xced114,l_xced.xced115,l_xced.xced116,l_xced.xced117,l_xced.xced118,l_xced.xced119,
                         l_xced.xced120,l_xced.xced202,l_xced.xced212,l_xced.xced222,l_xced.xced301,l_xced.xced302,l_xced.xced107,l_xced.xced108,l_xced.xced109,
                         l_xced.xced121,l_xced.xced122,l_xced.xced123,l_xced.xced124,l_xced.xced125,l_xced.xced126,l_xced.xced127,l_xced.xced128,l_xced.xced129,l_xced.xced130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 3"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF   
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 4
      LET l_xced.xced101   = l_xced101_4
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202e
      LET l_xced.xced212   = l_xcec.xcec212e
      LET l_xced.xced222   = l_xcec.xcec222e
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
#      INSERT INTO xced_t VALUES (l_xced.*)  #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xced_t(xcedent,xcedcomp,xcedld,xceddocno,xcedseq,xced001,xced101,xced102,xced110,
                         xced111,xced112,xced113,xced114,xced115,xced116,xced117,xced118,xced119,
                         xced120,xced202,xced212,xced222,xced301,xced302,xced107,xced108,xced109,
                         xced121,xced122,xced123,xced124,xced125,xced126,xced127,xced128,xced129,xced130) 
                 VALUES (l_xced.xcedent,l_xced.xcedcomp,l_xced.xcedld,l_xced.xceddocno,l_xced.xcedseq,l_xced.xced001,l_xced.xced101,l_xced.xced102,l_xced.xced110,
                         l_xced.xced111,l_xced.xced112,l_xced.xced113,l_xced.xced114,l_xced.xced115,l_xced.xced116,l_xced.xced117,l_xced.xced118,l_xced.xced119,
                         l_xced.xced120,l_xced.xced202,l_xced.xced212,l_xced.xced222,l_xced.xced301,l_xced.xced302,l_xced.xced107,l_xced.xced108,l_xced.xced109,
                         l_xced.xced121,l_xced.xced122,l_xced.xced123,l_xced.xced124,l_xced.xced125,l_xced.xced126,l_xced.xced127,l_xced.xced128,l_xced.xced129,l_xced.xced130)
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 4"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 5
      LET l_xced.xced101   = l_xced101_5
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202f
      LET l_xced.xced212   = l_xcec.xcec212f
      LET l_xced.xced222   = l_xcec.xcec222f
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
#      INSERT INTO xced_t VALUES (l_xced.*)  #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xced_t(xcedent,xcedcomp,xcedld,xceddocno,xcedseq,xced001,xced101,xced102,xced110,
                         xced111,xced112,xced113,xced114,xced115,xced116,xced117,xced118,xced119,
                         xced120,xced202,xced212,xced222,xced301,xced302,xced107,xced108,xced109,
                         xced121,xced122,xced123,xced124,xced125,xced126,xced127,xced128,xced129,xced130) 
                 VALUES (l_xced.xcedent,l_xced.xcedcomp,l_xced.xcedld,l_xced.xceddocno,l_xced.xcedseq,l_xced.xced001,l_xced.xced101,l_xced.xced102,l_xced.xced110,
                         l_xced.xced111,l_xced.xced112,l_xced.xced113,l_xced.xced114,l_xced.xced115,l_xced.xced116,l_xced.xced117,l_xced.xced118,l_xced.xced119,
                         l_xced.xced120,l_xced.xced202,l_xced.xced212,l_xced.xced222,l_xced.xced301,l_xced.xced302,l_xced.xced107,l_xced.xced108,l_xced.xced109,
                         l_xced.xced121,l_xced.xced122,l_xced.xced123,l_xced.xced124,l_xced.xced125,l_xced.xced126,l_xced.xced127,l_xced.xced128,l_xced.xced129,l_xced.xced130)
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 5"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 6
      LET l_xced.xced101   = l_xced101_6
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202g
      LET l_xced.xced212   = l_xcec.xcec212g
      LET l_xced.xced222   = l_xcec.xcec222g
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
 #      INSERT INTO xced_t VALUES (l_xced.*)  #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xced_t(xcedent,xcedcomp,xcedld,xceddocno,xcedseq,xced001,xced101,xced102,xced110,
                         xced111,xced112,xced113,xced114,xced115,xced116,xced117,xced118,xced119,
                         xced120,xced202,xced212,xced222,xced301,xced302,xced107,xced108,xced109,
                         xced121,xced122,xced123,xced124,xced125,xced126,xced127,xced128,xced129,xced130) 
                 VALUES (l_xced.xcedent,l_xced.xcedcomp,l_xced.xcedld,l_xced.xceddocno,l_xced.xcedseq,l_xced.xced001,l_xced.xced101,l_xced.xced102,l_xced.xced110,
                         l_xced.xced111,l_xced.xced112,l_xced.xced113,l_xced.xced114,l_xced.xced115,l_xced.xced116,l_xced.xced117,l_xced.xced118,l_xced.xced119,
                         l_xced.xced120,l_xced.xced202,l_xced.xced212,l_xced.xced222,l_xced.xced301,l_xced.xced302,l_xced.xced107,l_xced.xced108,l_xced.xced109,
                         l_xced.xced121,l_xced.xced122,l_xced.xced123,l_xced.xced124,l_xced.xced125,l_xced.xced126,l_xced.xced127,l_xced.xced128,l_xced.xced129,l_xced.xced130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 6"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF 
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 7
      LET l_xced.xced101   = l_xced101_7
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202h
      LET l_xced.xced212   = l_xcec.xcec212h
      LET l_xced.xced222   = l_xcec.xcec222h
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
#      INSERT INTO xced_t VALUES (l_xced.*)  #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xced_t(xcedent,xcedcomp,xcedld,xceddocno,xcedseq,xced001,xced101,xced102,xced110,
                         xced111,xced112,xced113,xced114,xced115,xced116,xced117,xced118,xced119,
                         xced120,xced202,xced212,xced222,xced301,xced302,xced107,xced108,xced109,
                         xced121,xced122,xced123,xced124,xced125,xced126,xced127,xced128,xced129,xced130) 
                 VALUES (l_xced.xcedent,l_xced.xcedcomp,l_xced.xcedld,l_xced.xceddocno,l_xced.xcedseq,l_xced.xced001,l_xced.xced101,l_xced.xced102,l_xced.xced110,
                         l_xced.xced111,l_xced.xced112,l_xced.xced113,l_xced.xced114,l_xced.xced115,l_xced.xced116,l_xced.xced117,l_xced.xced118,l_xced.xced119,
                         l_xced.xced120,l_xced.xced202,l_xced.xced212,l_xced.xced222,l_xced.xced301,l_xced.xced302,l_xced.xced107,l_xced.xced108,l_xced.xced109,
                         l_xced.xced121,l_xced.xced122,l_xced.xced123,l_xced.xced124,l_xced.xced125,l_xced.xced126,l_xced.xced127,l_xced.xced128,l_xced.xced129,l_xced.xced130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 7"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF                                 
 
   END FOREACH
   RETURN g_success 
END FUNCTION

################################################################################
# Descriptions...: 新增axct707    6.雜項進出憑證   axct707
# Memo...........:
# Usage..........: CALL axct901_01_ins_6()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/22 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_7()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xcck          RECORD LIKE xcck_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xcck RECORD  #本期料件明細進出成本檔
       xcckent LIKE xcck_t.xcckent, #企业编号
       xccksite LIKE xcck_t.xccksite, #site组织
       xcckcomp LIKE xcck_t.xcckcomp, #法人组织
       xcckld LIKE xcck_t.xcckld, #账套
       xcck001 LIKE xcck_t.xcck001, #账套本位币顺序
       xcck002 LIKE xcck_t.xcck002, #成本域
       xcck003 LIKE xcck_t.xcck003, #成本计算类型
       xcck004 LIKE xcck_t.xcck004, #年度
       xcck005 LIKE xcck_t.xcck005, #期别
       xcck006 LIKE xcck_t.xcck006, #参考单号
       xcck007 LIKE xcck_t.xcck007, #项次
       xcck008 LIKE xcck_t.xcck008, #项序
       xcck009 LIKE xcck_t.xcck009, #出入库码
       xcck010 LIKE xcck_t.xcck010, #料号
       xcck011 LIKE xcck_t.xcck011, #产品特征
       xcck012 LIKE xcck_t.xcck012, #单据类型
       xcck013 LIKE xcck_t.xcck013, #单据日期
       xcck014 LIKE xcck_t.xcck014, #时间
       xcck015 LIKE xcck_t.xcck015, #仓库编号
       xcck016 LIKE xcck_t.xcck016, #储位编号
       xcck017 LIKE xcck_t.xcck017, #批号
       xcck020 LIKE xcck_t.xcck020, #异动类型
       xcck021 LIKE xcck_t.xcck021, #原因码
       xcck022 LIKE xcck_t.xcck022, #交易对象
       xcck023 LIKE xcck_t.xcck023, #客群
       xcck024 LIKE xcck_t.xcck024, #区域
       xcck025 LIKE xcck_t.xcck025, #成本中心
       xcck026 LIKE xcck_t.xcck026, #经营类别
       xcck027 LIKE xcck_t.xcck027, #渠道
       xcck028 LIKE xcck_t.xcck028, #品类
       xcck029 LIKE xcck_t.xcck029, #品牌
       xcck030 LIKE xcck_t.xcck030, #项目号
       xcck031 LIKE xcck_t.xcck031, #WBS
       xcck032 LIKE xcck_t.xcck032, #存货科目
       xcck033 LIKE xcck_t.xcck033, #费用成本科目
       xcck034 LIKE xcck_t.xcck034, #收入科目
       xcck040 LIKE xcck_t.xcck040, #交易币种
       xcck041 LIKE xcck_t.xcck041, #本位币种
       xcck042 LIKE xcck_t.xcck042, #汇率
       xcck043 LIKE xcck_t.xcck043, #交易单位
       xcck044 LIKE xcck_t.xcck044, #成本单位
       xcck045 LIKE xcck_t.xcck045, #换算率
       xcck046 LIKE xcck_t.xcck046, #交易数量
       xcck047 LIKE xcck_t.xcck047, #工单号码
       xcck048 LIKE xcck_t.xcck048, #重复性生产-计划编号
       xcck049 LIKE xcck_t.xcck049, #重复性生产-生产料号
       xcck050 LIKE xcck_t.xcck050, #重复性生产-生产料号BOM特性
       xcck051 LIKE xcck_t.xcck051, #重复性生产-生产料号产品特征
       xcck055 LIKE xcck_t.xcck055, #xccc类型
       xcck201 LIKE xcck_t.xcck201, #本期异动数量
       xcck202 LIKE xcck_t.xcck202, #本期异动金额
       xcck202a LIKE xcck_t.xcck202a, #本期异动金额-材料
       xcck202b LIKE xcck_t.xcck202b, #本期异动金额-人工
       xcck202c LIKE xcck_t.xcck202c, #本期异动金额-加工费
       xcck202d LIKE xcck_t.xcck202d, #本期异动金额-制费一
       xcck202e LIKE xcck_t.xcck202e, #本期异动金额-制费二
       xcck202f LIKE xcck_t.xcck202f, #本期异动金额-制费三
       xcck202g LIKE xcck_t.xcck202g, #本期异动金额-制费四
       xcck202h LIKE xcck_t.xcck202h, #本期异动金额-制费五
       xcck282 LIKE xcck_t.xcck282, #本期异动单价
       xcck282a LIKE xcck_t.xcck282a, #本期异动单价-材料
       xcck282b LIKE xcck_t.xcck282b, #本期异动单价-人工
       xcck282c LIKE xcck_t.xcck282c, #本期异动单价-加工
       xcck282d LIKE xcck_t.xcck282d, #本期异动单价-制费一
       xcck282e LIKE xcck_t.xcck282e, #本期异动单价-制费二
       xcck282f LIKE xcck_t.xcck282f, #本期异动单价-制费三
       xcck282g LIKE xcck_t.xcck282g, #本期异动单价-制费四
       xcck282h LIKE xcck_t.xcck282h, #本期异动单价-制费五
       xcck301 LIKE xcck_t.xcck301, #已耗数量
       xcck302 LIKE xcck_t.xcck302, #已耗金额
       xcck302a LIKE xcck_t.xcck302a, #已耗金额-材料
       xcck302b LIKE xcck_t.xcck302b, #已耗金额-人工
       xcck302c LIKE xcck_t.xcck302c, #已耗金额-加工费
       xcck302d LIKE xcck_t.xcck302d, #已耗金额-制费一
       xcck302e LIKE xcck_t.xcck302e, #已耗金额-制费二
       xcck302f LIKE xcck_t.xcck302f, #已耗金额-制费三
       xcck302g LIKE xcck_t.xcck302g, #已耗金额-制费四
       xcck302h LIKE xcck_t.xcck302h, #已耗金额-制费五
       xcck901 LIKE xcck_t.xcck901, #结存数量
       xcck902 LIKE xcck_t.xcck902, #结存金额
       xcck902a LIKE xcck_t.xcck902a, #结存金额-材料
       xcck902b LIKE xcck_t.xcck902b, #结存金额-人工
       xcck902c LIKE xcck_t.xcck902c, #结存金额-加工费
       xcck902d LIKE xcck_t.xcck902d, #结存金额-制费一
       xcck902e LIKE xcck_t.xcck902e, #结存金额-制费二
       xcck902f LIKE xcck_t.xcck902f, #结存金额-制费三
       xcck902g LIKE xcck_t.xcck902g, #结存金额-制费四
       xcck902h LIKE xcck_t.xcck902h, #结存金额-制费五
       xcck980 LIKE xcck_t.xcck980, #结存单位成本
       xcck980a LIKE xcck_t.xcck980a, #结存单位成本-材料
       xcck980b LIKE xcck_t.xcck980b, #结存单位成本-人工
       xcck980c LIKE xcck_t.xcck980c, #结存单位成本-加工费
       xcck980d LIKE xcck_t.xcck980d, #结存单位成本-制费一
       xcck980e LIKE xcck_t.xcck980e, #结存单位成本-制费二
       xcck980f LIKE xcck_t.xcck980f, #结存单位成本-制费三
       xcck980g LIKE xcck_t.xcck980g, #结存单位成本-制费四
       xcck980h LIKE xcck_t.xcck980h, #结存单位成本-制费五
       xcck903 LIKE xcck_t.xcck903, #结存调整金额
       xcck903a LIKE xcck_t.xcck903a, #结存调整金额-材料
       xcck903b LIKE xcck_t.xcck903b, #结存调整金额-人工
       xcck903c LIKE xcck_t.xcck903c, #结存调整金额-加工费
       xcck903d LIKE xcck_t.xcck903d, #结存调整金额-制费一
       xcck903e LIKE xcck_t.xcck903e, #结存调整金额-制费二
       xcck903f LIKE xcck_t.xcck903f, #结存调整金额-制费三
       xcck903g LIKE xcck_t.xcck903g, #结存调整金额-制费四
       xcck903h LIKE xcck_t.xcck903h, #结存调整金额-制费五
       xcckownid LIKE xcck_t.xcckownid, #资料所有者
       xcckowndp LIKE xcck_t.xcckowndp, #资料所有部门
       xcckcrtid LIKE xcck_t.xcckcrtid, #资料录入者
       xcckcrtdp LIKE xcck_t.xcckcrtdp, #资料录入部门
       xcckcrtdt LIKE xcck_t.xcckcrtdt, #资料创建日
       xcckmodid LIKE xcck_t.xcckmodid, #资料更改者
       xcckmoddt LIKE xcck_t.xcckmoddt, #最近更改日
       xcckstus LIKE xcck_t.xcckstus, #状态码
       xcck056 LIKE xcck_t.xcck056  #成本代销单号
END RECORD
#161124-00048#21 add(e)
DEFINE ld_date         DATETIME YEAR TO SECOND
DEFINE l_imaa009       LIKE imaa_t.imaa009       
DEFINE l_ooaa002       LIKE ooaa_t.ooaa002
DEFINE l_sql,l_sql1,l_sql2,l_sql3    STRING
DEFINE l_str           STRING
DEFINE ls_wc                   STRING   #C151008-004 Add   #管理品类
DEFINE ls_wc1,ls_wc2,ls_wc3    STRING   #add by zhr 151231 单据类型、原因码、管理品类
DEFINE l_xceb108       LIKE xckd_t.xckd021
DEFINE l_xceaud001     LIKE xcea_t.xceaud001 
DEFINE l_xceaud RECORD
       xceaud001 LIKE xcea_t.xceaud001
END RECORD
DEFINE l_n   LIKE type_t.num5    
DEFINE l_cnt LIKE type_t.num5   
DEFINE l_c1 LIKE  type_t.chr500
DEFINE l_c2 LIKE  type_t.chr500
DEFINE l_n1 LIKE  type_t.num5
DEFINE l_n2 LIKE  type_t.num5
DEFINE l_xcea002      LIKE xcea_t.xcea002 
DEFINE l_list        DYNAMIC ARRAY OF RECORD
          xceaud001     LIKE xcea_t.xceaud001
                     END RECORD
DEFINE l_ac   LIKE  type_t.num5
DEFINE l_ac_t   LIKE  type_t.num5
DEFINE l_docno  LIKE xcea_t.xceadocno

   LET l_cnt = 1
   LET l_n = 1  
   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   
 
   LET ls_wc  = g_wc_xcck026   #经营类别
   #LET ls_wc1 = g_wc_xcck012   #单据类型
   LET ls_wc2 = g_wc_xcck021   #原因码
   LET ls_wc3 = g_wc_xcck028   #管理品类
   LET ls_wc  = cl_replace_str(ls_wc, "xcck026","xckd013")  
   #LET ls_wc1 = cl_replace_str(ls_wc1,"xcck012","xckd007")
   LET ls_wc2 = cl_replace_str(ls_wc2,"xcck021","xckd012")  
   LET ls_wc3 = cl_replace_str(ls_wc3,"xcck028","xckd014")
   #add by zhr 151231 end 
   #单据类型xckd007
   #ls_wc1
   LET l_sql1 =" SELECT distinct xckd007 FROM xckd_t ", 
               "  WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
               "    AND xckd003 = '",g_xcea_m.xcea003,"' ",
               "    AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xckdsite = '",g_xcea_m.xceasite,"'",
               "    AND xckd001 = '1' ",
               "    AND ",ls_wc,   
               #"    AND ",ls_wc1,   #add 
               "    AND ",ls_wc2,   #add
               "    AND ",ls_wc3    #add
            #   "    AND NVL(xckd019,'N') = 'N' "    #mark by zhr 160103
   CASE
      #WHEN g_prog = 'axct707'   #杂收入库101 杂发出库301  #160524-00009#1 mark
      WHEN g_prog = 'axct907'    #杂收入库101 杂发出库301  #160524-00009#1 add
         LET l_sql1 = l_sql1,"    AND xckd011 IN ('101','301') ", " AND NVL(xckd019,'N') = 'N' "    #add by zhr 160103
      WHEN g_prog = 'cxct707'   #跨法人成本   '102‘采购入库
         LET l_sql1 = l_sql1,"    AND xckd011 = '102' AND xckd007 = 'aint511' ", "    AND NVL(xckd019,'N') = 'N' "   #mark by zhr 160103
      #add by zhr 160102 ---str----cxct710  销售出库 xckd011 = '201' 
       WHEN g_prog = 'cxct710'  #跨法人收入 
         LET l_sql1 = l_sql1,"    AND xckd011 = '201' AND xckd007 = 'aint511' and xckd006 = '-1'  "############3
      #add by zhr 160102 ---end----
# #mark by zhr 160103      
#      WHEN g_prog = 'cxct708'   #跨门店成本  ‘401’调拨 
#         LET l_sql1 = l_sql1,"    AND xckd011 = '401' AND xckd007 = 'aint511' "      
   END CASE
   LET l_sql1 = l_sql1," GROUP BY xckd007 "
   PREPARE xcck_prep1 FROM l_sql1
   DECLARE xcck_curs1 CURSOR FOR xcck_prep1

   LET l_ac = 1
   FOREACH xcck_curs1 INTO l_list[l_ac].xceaud001
      LET l_ac = l_ac + 1
   END FOREACH
 
   LET g_sql = " SELECT xckd002 ,'' xcck006,'' xcck007,'' xcck010,'' xcck011,xckd006 ,xckd012 ,'' xcck022,'' xcck023,",
               "        '' xcck024,xckd020 ,xckd013 ,'' xcck027,xckd014 ,'' xcck029,'' xcck030,'' xcck031,'' xcck033,",
               "        SUM(xckd006 *xckd016),SUM(xckd006 *xckd017),SUM(xckd006 *xckd018),",
               "        SUM(xckd006*0) xcck202b,SUM(xckd006*0) xcck202c,SUM(xckd006*0) xcck202d,",
               "        SUM(xckd006*0) xcck202e,SUM(xckd006*0) xcck202f,SUM(xckd006*0) xcck202g,SUM(xckd006*0) xcck202h,xckd008,xckd007,xckd021 ",
               "        FROM xckd_t ", 
               "  WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
               "    AND xckd003 = '",g_xcea_m.xcea003,"' ",
               "    AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xckdsite = '",g_xcea_m.xceasite,"'",
               "    AND xckd001 = '1' ",
               "    AND ",ls_wc,    #经营品类add
               "    AND ",ls_wc2,   #原因码add
               "    AND ",ls_wc3    #品类add 
            #   "    AND NVL(xckd019,'N') = 'N' "    #mark by zhr 160103
   CASE
      #WHEN g_prog = 'axct707'    #160524-00009#1 mark
      WHEN g_prog = 'axct907'     #160524-00009#1 add
      LET g_sql = g_sql,"    AND NVL(xckd019,'N') = 'N' " ,
                        "    AND xckd011 IN ('101','301') "
   END CASE
   LET g_sql = g_sql,
   " GROUP BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd008,xckd007,xckd021",
   " ORDER BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd008,xckd007,xckd021"
   PREPARE xcck_prep FROM g_sql
   DECLARE xcck_curs CURSOR FOR xcck_prep

   LET g_sql = " SELECT xckd002 ,'' xcck006,'' xcck007,'' xcck010,'' xcck011,xckd006 ,xckd012 ,'' xcck022,'' xcck023,",
               "        '' xcck024,xckd020 ,xckd013 ,'' xcck027,xckd014 ,'' xcck029,'' xcck030,'' xcck031,'' xcck032,",
               "        SUM(xckd006 *xckd016),SUM(xckd006 *xckd017),SUM(xckd006 *xckd018),",
               "        SUM(xckd006*0) xcck202b,SUM(xckd006*0) xcck202c,SUM(xckd006*0) xcck202d,",
               "        SUM(xckd006*0) xcck202e,SUM(xckd006*0) xcck202f,SUM(xckd006*0) xcck202g,SUM(xckd006*0) xcck202h,xckd008,xckd007,xckd021 ",
               "        FROM xckd_t ", 
               "  WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
               "    AND xckd003 = '",g_xcea_m.xcea003,"' ",
               "    AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xckdsite = '",g_xcea_m.xceasite,"'",
               "    AND xckd001 = '1' ",
               "    AND ",ls_wc,   
               "    AND ",ls_wc2,   #add 
               "    AND ",ls_wc3    #add
        #       "    AND NVL(xckd019,'N') = 'N' "
   CASE
      #WHEN g_prog = 'axct707'  #160524-00009#1 mark
      WHEN g_prog = 'axct907'   #160524-00009#1 add
      LET g_sql = g_sql,"    AND NVL(xckd019,'N') = 'N' " ,
                        "    AND xckd011 IN ('101','301') "
   END CASE
   LET g_sql = g_sql,
   " GROUP BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd008,xckd007,xckd021",
   " ORDER BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd008,xckd007,xckd021"
  #C151008-004 Add  ---(E)---
   PREPARE xcck_prep_1 FROM g_sql
   DECLARE xcck_curs_1 CURSOR FOR xcck_prep_1


   LET l_sql = "UPDATE xckd_t SET xckd019 = 'Y' ",
               " WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
               "   AND xckd003 = '",g_xcea_m.xcea003,"' ",
               "   AND xckdsite= '",g_xcea_m.xceasite,"'",
               "   AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "   AND xckd001 = '1' "
   ##add by zhr 160103 cxct710    
   
   LET l_sql2 = "UPDATE xckd_t SET xckd022 = 'Y' ",
               " WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
               "   AND xckd003 = '",g_xcea_m.xcea003,"' ",
               "   AND xckdsite= '",g_xcea_m.xceasite,"'",
               "   AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "   AND xckd001 = '1' "
               
   CASE
      #WHEN g_prog = 'axct707'   #160524-00009#1 mark
      WHEN g_prog = 'axct907'    #160524-00009#1 add
      LET l_sql = l_sql,"    AND xckd011 IN ('101','301') ","   AND NVL(xckd019,'N') = 'N' AND ",ls_wc CLIPPED
   END CASE
   
   PREPARE xcck_prep_7_2 FROM l_sql

   LET l_docno = g_xcea_m.xceadocno
   #FOR l_ac = 1 TO l_list.getLength()
   #   IF cl_null(l_list[l_ac].xceaud001) THEN CONTINUE FOR END IF
   #   LET l_xceaud.xceaud001 = l_list[l_ac].xceaud001     #单据类型
      CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',l_docno,g_xcea_m.xcea001,g_prog_name1)
         RETURNING l_success,g_xcea_m.xceadocno
      IF l_success  = 0  THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'apm-00003'
         LET g_errparam.extend = g_xcea_m.xceadocno
         LET g_errparam.popup = TRUE
         CALL cl_err()
         LET g_success = 'N'
      END IF
      CASE
         #WHEN g_prog = 'axct707'  #160524-00009#1 mark
         WHEN g_prog = 'axct907'   #160524-00009#1 mark
            LET l_xcea002 = g_xcea002
      END CASE
      
      INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,
                          xcea001,xcea002,xcea004,xcea005,xcea003,
                          xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,
                          xceacrtdt,xceamodid,xceamoddt,xceasite)
                  VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
                          g_xcea_m.xcea001,l_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003,
                          'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid,l_xcea.xceacrtdp,
                          ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "g_xcea_m"
         LET g_errparam.popup = TRUE
         CALL cl_err()
         LET g_success = 'N'
      END IF
      #add by zhanghr 151120 str--账套+编号存进动态数组
      LET g_rec_d[l_n].xceald = g_xcea_m.xceald
      LET g_rec_d[l_n].xceadocno = g_xcea_m.xceadocno
      LET l_n = l_n +1
      LET l_cnt = l_cnt + 1

      FOREACH xcck_curs  INTO l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,
                              l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,
                              l_xcck.xcck023,l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,
                              l_xcck.xcck027,l_xcck.xcck028,l_xcck.xcck029,l_xcck.xcck030,
                              l_xcck.xcck031,l_xcck.xcck033,l_xcck.xcck201,l_xcck.xcck202,
                              l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,l_xcck.xcck202d,
                              l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h,
                              l_xcck.xcck013,l_xcck.xcck012,l_xceb108

         INITIALIZE l_xceb.* TO NULL

         CASE l_xcck.xcck009
            WHEN -1          #杂发
               LET l_xceb.xceb003 = '5'
            WHEN  1          #杂收
               LET l_xceb.xceb003 = '6'        
         END CASE

         LET l_xceb.xceb103 = l_xcck.xcck002 #成本域
         LET l_xceb.xceb001 = l_xcck.xcck006 #参考单号
         LET l_xceb.xceb002 = l_xcck.xcck007 #参考项次
         LET l_xceb.xceb004 = l_xcck.xcck010 #料號
         LET l_xceb.xceb005 = l_xcck.xcck011 #特性
         LET l_xceb.xceb110 = l_xcck.xcck021 #原因碼
         LET l_xcec.xcec108 = l_xceb108      
         LET l_xceb.xceb108 = l_xceb108
         
         LET l_xceb.xceb111 = l_xcck.xcck022 #交易對象      
         LET l_xceb.xceb112 = l_xcck.xcck023 #客群 
         LET l_xceb.xceb113 = l_xcck.xcck024 #區域  
         LET l_xceb.xceb114 = l_xcck.xcck025 #成本中心      
         LET l_xceb.xceb115 = l_xcck.xcck026 #經營類別
         LET l_xceb.xceb116 = l_xcck.xcck027 #渠道
         LET l_xceb.xceb117 = l_xcck.xcck028 #品類    
         LET l_xceb.xceb118 = l_xcck.xcck029 #品牌
         LET l_xceb.xceb119 = l_xcck.xcck030 #項目號
         LET l_xceb.xceb120 = l_xcck.xcck031 #WBS
         LET l_xceb.xceb101 = l_xcck.xcck033 #費用科目  ==SELECT '' INTO XCCK033
         
         LET l_xceb.xceb201 = l_xcck.xcck201
         LET l_xceb.xceb202 = l_xcck.xcck202
         LET l_xceb.xceb202a = l_xcck.xcck202a
         LET l_xceb.xceb202b = l_xcck.xcck202b
         LET l_xceb.xceb202c = l_xcck.xcck202c
         LET l_xceb.xceb202d = l_xcck.xcck202d
         LET l_xceb.xceb202e = l_xcck.xcck202e
         LET l_xceb.xceb202f = l_xcck.xcck202f
         LET l_xceb.xceb202g = l_xcck.xcck202g
         LET l_xceb.xceb202h = l_xcck.xcck202h
         
         IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
         IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
         IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
         IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
         IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
         IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
         IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
         IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
         IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
         IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF      
      
         #增加栏位，为了删除资料时还原   20151008
         #LET l_xceb.xcebua001= l_xcck.xcck013
         #LET l_xceb.xcebud001= l_xcck.xcck012
         
         #160527-00019#1--s
         LET l_xceb.xceb131= l_xcck.xcck012
         LET l_xceb.xceb132= l_xcck.xcck013
         #160527-00019#1--e
         
         SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
          WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
            AND xcebdocno = g_xcea_m.xceadocno
         IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
            LET l_xceb.xcebseq = 1
         ELSE
            LET l_xceb.xcebseq = l_xceb.xcebseq + 1
         END IF  
     
         ####
         IF cl_null(l_xcck.xcck033) THEN  
         #杂项费用科目        
            #抓agli180的科目
            IF cl_null(l_xceb.xceb101) THEN
               SELECT glab005 INTO l_xceb.xceb101
                 FROM glab_t
                WHERE glabld  = g_xcea_m.xceald
                  AND glab001 = '11'
                  AND glab002 = '216'
                  AND glab003 = l_xcck.xcck021
                  AND glabent = g_enterprise         
            END IF
            #agli180抓不到，改抓agli201的科目
            IF cl_null(l_xceb.xceb101) THEN
               CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','7') RETURNING l_success,l_xceb.xceb101,l_errno
            END IF
         ELSE
            LET l_xceb.xceb101 = l_xcck.xcck033 
         END IF      

         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     

         LET l_xceb.xcebent = g_enterprise 
         LET l_xceb.xcebcomp = g_xcea_m.xceacomp
         LET l_xceb.xcebld = g_xcea_m.xceald
         LET l_xceb.xcebdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xceb.xceb102) THEN
            CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','7') RETURNING l_success,l_xceb.xceb102
         END IF    
         #如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
            CONTINUE FOREACH
         END IF       
         #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xceb"
            LET g_errparam.popup = TRUE
            CALL cl_err()
            LET g_success = 'N'
            EXIT FOREACH
         END IF 
      END FOREACH

      FOREACH xcck_curs_1 INTO l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,
                               l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,
                               l_xcck.xcck023,l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,
                               l_xcck.xcck027,l_xcck.xcck028,l_xcck.xcck029,l_xcck.xcck030,
                               l_xcck.xcck031,l_xcck.xcck032,l_xcck.xcck201,l_xcck.xcck202,
                               l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,l_xcck.xcck202d,
                               l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h,
                               l_xcck.xcck013,l_xcck.xcck012,l_xceb108

         INITIALIZE l_xcec.* TO NULL
        
         CASE l_xcck.xcck009
            WHEN -1          #杂发
               LET l_xcec.xcec003 = '5'
            WHEN  1          #杂收
               LET l_xcec.xcec003 = '6'        
         END CASE
       
         LET l_xcec.xcec108 = l_xceb108
           
         LET l_xcec.xcec103 = l_xcck.xcck002 #成本域
         LET l_xcec.xcec004 = l_xcck.xcck010 #料號
         LET l_xcec.xcec005 = l_xcck.xcck011 #特性
         IF NOT cl_null(l_xcck.xcck021) THEN
            LET l_xcec.xcec110 = l_xcck.xcck021 #原因碼
         END IF
     
         LET l_xcec.xcec111 = l_xcck.xcck022 #交易對象      
         LET l_xcec.xcec112 = l_xcck.xcck023 #客群 
         LET l_xcec.xcec113 = l_xcck.xcck024 #區域  
         LET l_xcec.xcec114 = l_xcck.xcck025 #成本中心      
         LET l_xcec.xcec115 = l_xcck.xcck026 #經營類別
         LET l_xcec.xcec116 = l_xcck.xcck027 #渠道
         LET l_xcec.xcec117 = l_xcck.xcck028 #品類  
     
         LET l_xcec.xcec118 = l_xcck.xcck029 #品牌
         LET l_xcec.xcec119 = l_xcck.xcck030 #項目號
         LET l_xcec.xcec120 = l_xcck.xcck031 #WBS
         LET l_xcec.xcec101 = l_xcck.xcck032 #存貨科目 
     
         LET l_xcec.xcec202 = l_xcck.xcck202
         LET l_xcec.xcec202a = l_xcck.xcck202a
         LET l_xcec.xcec202b = l_xcck.xcck202b
         LET l_xcec.xcec202c = l_xcck.xcck202c
         LET l_xcec.xcec202d = l_xcck.xcck202d
         LET l_xcec.xcec202e = l_xcck.xcck202e
         LET l_xcec.xcec202f = l_xcck.xcck202f
         LET l_xcec.xcec202g = l_xcck.xcck202g
         LET l_xcec.xcec202h = l_xcck.xcck202h
        
         IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
         IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
         IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
         IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
         IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
         IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
         IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
         IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
         IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF         
         IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF        
        
         SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
          WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
            AND xcecdocno = g_xcea_m.xceadocno
         IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
            LET l_xcec.xcecseq = 1
         ELSE
            LET l_xcec.xcecseq = l_xcec.xcecseq + 1
         END IF  
     
         IF cl_null(l_xcck.xcck032) THEN
            SELECT glab007 INTO l_xcec.xcec101   
             FROM glab_t
            WHERE glabent = g_enterprise
              AND glabld =  g_xcea_m.xceald
              AND glab001 = 'RTAX'
              AND glab002 = '1'
           #  AND glab003 = l_xceb.xceb117
              AND glab003 = l_xcec.xcec117   #modify by chenhz 16/01/09
         ELSE
            LET l_xcec.xcec101 = l_xcck.xcck032 
         END IF      
      
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     

         LET l_xcec.xcecent = g_enterprise 
         LET l_xcec.xceccomp = g_xcea_m.xceacomp
         LET l_xcec.xcecld = g_xcea_m.xceald
         LET l_xcec.xcecdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xcec.xcec102) THEN
            CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','7') RETURNING l_success,l_xcec.xcec102
         END IF     
         #如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
            CONTINUE FOREACH
         END IF      
         #      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xcec"
            LET g_errparam.popup = TRUE
            CALL cl_err()
     
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF  
      END FOREACH 

      # 产生资料成功，更新xcck中的立账状态码
      IF g_success='Y' THEN
         TRY
            EXECUTE xcck_prep_7_2 
         CATCH
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "upd xcck_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()
      
               LET g_success = 'N'
            END IF
         END TRY
      END IF
   #END FOR

   RETURN g_success
END FUNCTION

################################################################################
# Descriptions...: 新增axct708   7.雜項進出差异憑證  axct708
# Memo...........:
# Usage..........: CALL axct901_01_ins_8()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/22 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_8()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xceb1         RECORD LIKE xceb_t.*
#DEFINE l_xcec1         RECORD LIKE xcec_t.*
#DEFINE l_xcck          RECORD LIKE xcck_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xceb1 RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xcec1 RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xcck RECORD  #本期料件明細進出成本檔
       xcckent LIKE xcck_t.xcckent, #企业编号
       xccksite LIKE xcck_t.xccksite, #site组织
       xcckcomp LIKE xcck_t.xcckcomp, #法人组织
       xcckld LIKE xcck_t.xcckld, #账套
       xcck001 LIKE xcck_t.xcck001, #账套本位币顺序
       xcck002 LIKE xcck_t.xcck002, #成本域
       xcck003 LIKE xcck_t.xcck003, #成本计算类型
       xcck004 LIKE xcck_t.xcck004, #年度
       xcck005 LIKE xcck_t.xcck005, #期别
       xcck006 LIKE xcck_t.xcck006, #参考单号
       xcck007 LIKE xcck_t.xcck007, #项次
       xcck008 LIKE xcck_t.xcck008, #项序
       xcck009 LIKE xcck_t.xcck009, #出入库码
       xcck010 LIKE xcck_t.xcck010, #料号
       xcck011 LIKE xcck_t.xcck011, #产品特征
       xcck012 LIKE xcck_t.xcck012, #单据类型
       xcck013 LIKE xcck_t.xcck013, #单据日期
       xcck014 LIKE xcck_t.xcck014, #时间
       xcck015 LIKE xcck_t.xcck015, #仓库编号
       xcck016 LIKE xcck_t.xcck016, #储位编号
       xcck017 LIKE xcck_t.xcck017, #批号
       xcck020 LIKE xcck_t.xcck020, #异动类型
       xcck021 LIKE xcck_t.xcck021, #原因码
       xcck022 LIKE xcck_t.xcck022, #交易对象
       xcck023 LIKE xcck_t.xcck023, #客群
       xcck024 LIKE xcck_t.xcck024, #区域
       xcck025 LIKE xcck_t.xcck025, #成本中心
       xcck026 LIKE xcck_t.xcck026, #经营类别
       xcck027 LIKE xcck_t.xcck027, #渠道
       xcck028 LIKE xcck_t.xcck028, #品类
       xcck029 LIKE xcck_t.xcck029, #品牌
       xcck030 LIKE xcck_t.xcck030, #项目号
       xcck031 LIKE xcck_t.xcck031, #WBS
       xcck032 LIKE xcck_t.xcck032, #存货科目
       xcck033 LIKE xcck_t.xcck033, #费用成本科目
       xcck034 LIKE xcck_t.xcck034, #收入科目
       xcck040 LIKE xcck_t.xcck040, #交易币种
       xcck041 LIKE xcck_t.xcck041, #本位币种
       xcck042 LIKE xcck_t.xcck042, #汇率
       xcck043 LIKE xcck_t.xcck043, #交易单位
       xcck044 LIKE xcck_t.xcck044, #成本单位
       xcck045 LIKE xcck_t.xcck045, #换算率
       xcck046 LIKE xcck_t.xcck046, #交易数量
       xcck047 LIKE xcck_t.xcck047, #工单号码
       xcck048 LIKE xcck_t.xcck048, #重复性生产-计划编号
       xcck049 LIKE xcck_t.xcck049, #重复性生产-生产料号
       xcck050 LIKE xcck_t.xcck050, #重复性生产-生产料号BOM特性
       xcck051 LIKE xcck_t.xcck051, #重复性生产-生产料号产品特征
       xcck055 LIKE xcck_t.xcck055, #xccc类型
       xcck201 LIKE xcck_t.xcck201, #本期异动数量
       xcck202 LIKE xcck_t.xcck202, #本期异动金额
       xcck202a LIKE xcck_t.xcck202a, #本期异动金额-材料
       xcck202b LIKE xcck_t.xcck202b, #本期异动金额-人工
       xcck202c LIKE xcck_t.xcck202c, #本期异动金额-加工费
       xcck202d LIKE xcck_t.xcck202d, #本期异动金额-制费一
       xcck202e LIKE xcck_t.xcck202e, #本期异动金额-制费二
       xcck202f LIKE xcck_t.xcck202f, #本期异动金额-制费三
       xcck202g LIKE xcck_t.xcck202g, #本期异动金额-制费四
       xcck202h LIKE xcck_t.xcck202h, #本期异动金额-制费五
       xcck282 LIKE xcck_t.xcck282, #本期异动单价
       xcck282a LIKE xcck_t.xcck282a, #本期异动单价-材料
       xcck282b LIKE xcck_t.xcck282b, #本期异动单价-人工
       xcck282c LIKE xcck_t.xcck282c, #本期异动单价-加工
       xcck282d LIKE xcck_t.xcck282d, #本期异动单价-制费一
       xcck282e LIKE xcck_t.xcck282e, #本期异动单价-制费二
       xcck282f LIKE xcck_t.xcck282f, #本期异动单价-制费三
       xcck282g LIKE xcck_t.xcck282g, #本期异动单价-制费四
       xcck282h LIKE xcck_t.xcck282h, #本期异动单价-制费五
       xcck301 LIKE xcck_t.xcck301, #已耗数量
       xcck302 LIKE xcck_t.xcck302, #已耗金额
       xcck302a LIKE xcck_t.xcck302a, #已耗金额-材料
       xcck302b LIKE xcck_t.xcck302b, #已耗金额-人工
       xcck302c LIKE xcck_t.xcck302c, #已耗金额-加工费
       xcck302d LIKE xcck_t.xcck302d, #已耗金额-制费一
       xcck302e LIKE xcck_t.xcck302e, #已耗金额-制费二
       xcck302f LIKE xcck_t.xcck302f, #已耗金额-制费三
       xcck302g LIKE xcck_t.xcck302g, #已耗金额-制费四
       xcck302h LIKE xcck_t.xcck302h, #已耗金额-制费五
       xcck901 LIKE xcck_t.xcck901, #结存数量
       xcck902 LIKE xcck_t.xcck902, #结存金额
       xcck902a LIKE xcck_t.xcck902a, #结存金额-材料
       xcck902b LIKE xcck_t.xcck902b, #结存金额-人工
       xcck902c LIKE xcck_t.xcck902c, #结存金额-加工费
       xcck902d LIKE xcck_t.xcck902d, #结存金额-制费一
       xcck902e LIKE xcck_t.xcck902e, #结存金额-制费二
       xcck902f LIKE xcck_t.xcck902f, #结存金额-制费三
       xcck902g LIKE xcck_t.xcck902g, #结存金额-制费四
       xcck902h LIKE xcck_t.xcck902h, #结存金额-制费五
       xcck980 LIKE xcck_t.xcck980, #结存单位成本
       xcck980a LIKE xcck_t.xcck980a, #结存单位成本-材料
       xcck980b LIKE xcck_t.xcck980b, #结存单位成本-人工
       xcck980c LIKE xcck_t.xcck980c, #结存单位成本-加工费
       xcck980d LIKE xcck_t.xcck980d, #结存单位成本-制费一
       xcck980e LIKE xcck_t.xcck980e, #结存单位成本-制费二
       xcck980f LIKE xcck_t.xcck980f, #结存单位成本-制费三
       xcck980g LIKE xcck_t.xcck980g, #结存单位成本-制费四
       xcck980h LIKE xcck_t.xcck980h, #结存单位成本-制费五
       xcck903 LIKE xcck_t.xcck903, #结存调整金额
       xcck903a LIKE xcck_t.xcck903a, #结存调整金额-材料
       xcck903b LIKE xcck_t.xcck903b, #结存调整金额-人工
       xcck903c LIKE xcck_t.xcck903c, #结存调整金额-加工费
       xcck903d LIKE xcck_t.xcck903d, #结存调整金额-制费一
       xcck903e LIKE xcck_t.xcck903e, #结存调整金额-制费二
       xcck903f LIKE xcck_t.xcck903f, #结存调整金额-制费三
       xcck903g LIKE xcck_t.xcck903g, #结存调整金额-制费四
       xcck903h LIKE xcck_t.xcck903h, #结存调整金额-制费五
       xcckownid LIKE xcck_t.xcckownid, #资料所有者
       xcckowndp LIKE xcck_t.xcckowndp, #资料所有部门
       xcckcrtid LIKE xcck_t.xcckcrtid, #资料录入者
       xcckcrtdp LIKE xcck_t.xcckcrtdp, #资料录入部门
       xcckcrtdt LIKE xcck_t.xcckcrtdt, #资料创建日
       xcckmodid LIKE xcck_t.xcckmodid, #资料更改者
       xcckmoddt LIKE xcck_t.xcckmoddt, #最近更改日
       xcckstus LIKE xcck_t.xcckstus, #状态码
       xcck056 LIKE xcck_t.xcck056  #成本代销单号
END RECORD
#161124-00048#21 add(e)
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET g_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"'",
               #"    AND xcck004 = ",g_xcea004,
               #"    AND xcck005 = ",g_xcea005,
               "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xcck020 IN ('101','301') ",                     
               "    AND xcck002 = ? AND xcck010 = ? AND xcck011 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 
   
   LET g_sql1 = g_sql CLIPPED," AND xcck001 = '2' " 
     
   LET g_sql2 = g_sql CLIPPED," AND xcck001 = '3' " 

   
   LET g_sql = " SELECT xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck033,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"'",
               #"    AND xcck004 = ",g_xcea004,
               #"    AND xcck005 = ",g_xcea005,
               "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('101','301') ",
               " GROUP BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033",
               " ORDER BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033"
   PREPARE xcck_prep_2 FROM g_sql
   DECLARE xcck_curs_2 CURSOR FOR xcck_prep_2
   

   FOREACH xcck_curs_2 INTO l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h

      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb103 = l_xcck.xcck002 #成本域
      LET l_xceb.xceb004 = l_xcck.xcck010 #料號
      LET l_xceb.xceb005 = l_xcck.xcck011 #料號特性
      LET l_xceb.xceb110 = l_xcck.xcck021 #原因碼
      LET l_xceb.xceb111 = l_xcck.xcck022 #交易對象      
      LET l_xceb.xceb112 = l_xcck.xcck023 #客群 
      LET l_xceb.xceb113 = l_xcck.xcck024 #區域  
      LET l_xceb.xceb114 = l_xcck.xcck025 #成本中心      
      LET l_xceb.xceb115 = l_xcck.xcck026 #經營類別
      LET l_xceb.xceb116 = l_xcck.xcck027 #渠道
      LET l_xceb.xceb117 = l_xcck.xcck028 #品類
      LET l_xceb.xceb118 = l_xcck.xcck029 #品牌
      LET l_xceb.xceb119 = l_xcck.xcck030 #項目號
      LET l_xceb.xceb120 = l_xcck.xcck031 #WBS
      LET l_xceb.xceb101 = l_xcck.xcck033 #費用科目  
      LET l_xceb.xceb201 = l_xcck.xcck201
      LET l_xceb.xceb202 = l_xcck.xcck202
      LET l_xceb.xceb202a = l_xcck.xcck202a
      LET l_xceb.xceb202b = l_xcck.xcck202b
      LET l_xceb.xceb202c = l_xcck.xcck202c
      LET l_xceb.xceb202d = l_xcck.xcck202d
      LET l_xceb.xceb202e = l_xcck.xcck202e
      LET l_xceb.xceb202f = l_xcck.xcck202f
      LET l_xceb.xceb202g = l_xcck.xcck202g
      LET l_xceb.xceb202h = l_xcck.xcck202h

      
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF  

      IF cl_null(l_xcck.xcck033) THEN  
#杂项费用科目
#抓agli180的科目
         IF cl_null(l_xceb.xceb101) THEN
            SELECT glab005 INTO l_xceb.xceb101
              FROM glab_t
             WHERE glabld  = g_xcea_m.xceald
               AND glab001 = '11'
               AND glab002 = '216'
               AND glab003 = l_xcck.xcck021
               AND glabent = g_enterprise         
         END IF
#agli180抓不到，改抓agli201的科目
         IF cl_null(l_xceb.xceb101) THEN
            CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','7') RETURNING l_success,l_xceb.xceb101,l_errno
         END IF        
      ELSE
         LET l_xceb.xceb101 = l_xcck.xcck033 
      END IF      
    
      IF g_glaa015 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql1 = g_sql1," AND xcck033 = ? "
#         END IF
         DECLARE xcck_prep2_2 CURSOR FROM g_sql1
         OPEN xcck_prep2_2 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
         FETCH xcck_prep2_2 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep2_2"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql2 = g_sql2," AND xcck033 = ? "
#         END IF
         DECLARE xcck_prep3_2 CURSOR FROM g_sql2
         OPEN xcck_prep3_2 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
         FETCH xcck_prep3_2 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep3_2"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF
      
      #雜項進出憑證xcea002 = '7'
      LET g_sql = " SELECT SUM(xceb201),SUM(xceb202), ",
               "        SUM(xceb202a),SUM(xceb202b),SUM(xceb202c),SUM(xceb202d),",
               "        SUM(xceb202e),SUM(xceb202f),SUM(xceb202g),SUM(xceb202h), ",
               "        SUM(xceb212),SUM(xceb212a),SUM(xceb212b),SUM(xceb212c),SUM(xceb212d),",
               "        SUM(xceb212e),SUM(xceb212f),SUM(xceb212g),SUM(xceb212h), ",
               "        SUM(xceb222),SUM(xceb222a),SUM(xceb222b),SUM(xceb222c),SUM(xceb222d),",
               "        SUM(xceb222e),SUM(xceb222f),SUM(xceb222g),SUM(xceb222h) ",               
               "        FROM xcea_t LEFT OUTER JOIN xceb_t ON xceaent = xcebent AND xceald = xcebld ",
               "         AND xceadocno = xcebdocno " ,              
               "  WHERE xceaent = '",g_enterprise,"' AND xceald = '",g_xcea_m.xceald,"'",
               "    AND xcea003 = '",g_xcea_m.xcea003,"'",
               #"    AND xcea004 = ",g_xcea004,
               #"    AND xcea005 = ",g_xcea005,
               "    AND xcea001 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xcea002 = '7' ",
               "    AND xceb103 = ? ",
               "    AND xceb004 = ? ", 
               "    AND xceb005 = ? ",
               "    AND xceb110 = ? ", 
               "    AND xceb111 = ? ",      
               "    AND xceb112 = ? ", 
               "    AND xceb113 = ? ",  
               "    AND xceb114 = ? ",      
               "    AND xceb115 = ? ",
               "    AND xceb116 = ? ",
               "    AND xceb117 = ? ", 
               "    AND xceb118 = ? ",
               "    AND xceb119 = ? ",
               "    AND xceb120 = ? ",
               "    AND xceb101 = ? "
               
      PREPARE xceb_prep FROM g_sql
      DECLARE xceb_curs CURSOR FOR xceb_prep
      
      OPEN xceb_curs USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
      FOREACH xceb_curs INTO l_xceb1.xceb201,
                             l_xceb1.xceb202,l_xceb1.xceb202a,l_xceb1.xceb202b,l_xceb1.xceb202c,l_xceb1.xceb202d,
                             l_xceb1.xceb202e,l_xceb1.xceb202f,l_xceb1.xceb202g,l_xceb1.xceb202h,
                             l_xceb1.xceb212,l_xceb1.xceb212a,l_xceb1.xceb212b,l_xceb1.xceb212c,l_xceb1.xceb212d,
                             l_xceb1.xceb212e,l_xceb1.xceb212f,l_xceb1.xceb212g,l_xceb1.xceb212h,
                             l_xceb1.xceb222,l_xceb1.xceb222a,l_xceb1.xceb222b,l_xceb1.xceb222c,l_xceb1.xceb222d,
                             l_xceb1.xceb222e,l_xceb1.xceb222f,l_xceb1.xceb222g,l_xceb1.xceb222h


         IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
         IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
         IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
         IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
         IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
         IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
         IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
         IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
         IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF
         IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF    
         IF cl_null(l_xceb1.xceb202a) THEN LET l_xceb1.xceb202a = 0 END IF
         IF cl_null(l_xceb1.xceb202b) THEN LET l_xceb1.xceb202b = 0 END IF
         IF cl_null(l_xceb1.xceb202c) THEN LET l_xceb1.xceb202c = 0 END IF
         IF cl_null(l_xceb1.xceb202d) THEN LET l_xceb1.xceb202d = 0 END IF
         IF cl_null(l_xceb1.xceb202e) THEN LET l_xceb1.xceb202e = 0 END IF
         IF cl_null(l_xceb1.xceb202f) THEN LET l_xceb1.xceb202f = 0 END IF
         IF cl_null(l_xceb1.xceb202g) THEN LET l_xceb1.xceb202g = 0 END IF
         IF cl_null(l_xceb1.xceb202h) THEN LET l_xceb1.xceb202h = 0 END IF
         IF cl_null(l_xceb1.xceb202)  THEN LET l_xceb1.xceb202  = 0 END IF
         IF cl_null(l_xceb1.xceb201)  THEN LET l_xceb1.xceb201  = 0 END IF    
         
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF 
         IF cl_null(l_xceb1.xceb212a) THEN LET l_xceb1.xceb212a = 0 END IF
         IF cl_null(l_xceb1.xceb212b) THEN LET l_xceb1.xceb212b = 0 END IF
         IF cl_null(l_xceb1.xceb212c) THEN LET l_xceb1.xceb212c = 0 END IF
         IF cl_null(l_xceb1.xceb212d) THEN LET l_xceb1.xceb212d = 0 END IF
         IF cl_null(l_xceb1.xceb212e) THEN LET l_xceb1.xceb212e = 0 END IF
         IF cl_null(l_xceb1.xceb212f) THEN LET l_xceb1.xceb212f = 0 END IF
         IF cl_null(l_xceb1.xceb212g) THEN LET l_xceb1.xceb212g = 0 END IF
         IF cl_null(l_xceb1.xceb212h) THEN LET l_xceb1.xceb212h = 0 END IF
         IF cl_null(l_xceb1.xceb212)  THEN LET l_xceb1.xceb212  = 0 END IF
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF 
         IF cl_null(l_xceb1.xceb222a) THEN LET l_xceb1.xceb222a = 0 END IF
         IF cl_null(l_xceb1.xceb222b) THEN LET l_xceb1.xceb222b = 0 END IF
         IF cl_null(l_xceb1.xceb222c) THEN LET l_xceb1.xceb222c = 0 END IF
         IF cl_null(l_xceb1.xceb222d) THEN LET l_xceb1.xceb222d = 0 END IF
         IF cl_null(l_xceb1.xceb222e) THEN LET l_xceb1.xceb222e = 0 END IF
         IF cl_null(l_xceb1.xceb222f) THEN LET l_xceb1.xceb222f = 0 END IF
         IF cl_null(l_xceb1.xceb222g) THEN LET l_xceb1.xceb222g = 0 END IF
         IF cl_null(l_xceb1.xceb222h) THEN LET l_xceb1.xceb222h = 0 END IF
         IF cl_null(l_xceb1.xceb222)  THEN LET l_xceb1.xceb222  = 0 END IF
         
         LET l_xceb.xceb201 =  l_xceb.xceb201  - l_xceb1.xceb201
         LET l_xceb.xceb202 =  l_xceb.xceb202  - l_xceb1.xceb202
         LET l_xceb.xceb202a = l_xceb.xceb202a - l_xceb1.xceb202a
         LET l_xceb.xceb202b = l_xceb.xceb202b - l_xceb1.xceb202b
         LET l_xceb.xceb202c = l_xceb.xceb202c - l_xceb1.xceb202c
         LET l_xceb.xceb202d = l_xceb.xceb202d - l_xceb1.xceb202d
         LET l_xceb.xceb202e = l_xceb.xceb202e - l_xceb1.xceb202e
         LET l_xceb.xceb202f = l_xceb.xceb202f - l_xceb1.xceb202f
         LET l_xceb.xceb202g = l_xceb.xceb202g - l_xceb1.xceb202g
         LET l_xceb.xceb202h = l_xceb.xceb202h - l_xceb1.xceb202h
         LET l_xceb.xceb212 =  l_xceb.xceb212  - l_xceb1.xceb212
         LET l_xceb.xceb212a = l_xceb.xceb212a - l_xceb1.xceb212a
         LET l_xceb.xceb212b = l_xceb.xceb212b - l_xceb1.xceb212b
         LET l_xceb.xceb212c = l_xceb.xceb212c - l_xceb1.xceb212c
         LET l_xceb.xceb212d = l_xceb.xceb212d - l_xceb1.xceb212d
         LET l_xceb.xceb212e = l_xceb.xceb212e - l_xceb1.xceb212e
         LET l_xceb.xceb212f = l_xceb.xceb212f - l_xceb1.xceb212f
         LET l_xceb.xceb212g = l_xceb.xceb212g - l_xceb1.xceb212g
         LET l_xceb.xceb212h = l_xceb.xceb212h - l_xceb1.xceb212h
         LET l_xceb.xceb222 =  l_xceb.xceb222  - l_xceb1.xceb222
         LET l_xceb.xceb222a = l_xceb.xceb222a - l_xceb1.xceb222a
         LET l_xceb.xceb222b = l_xceb.xceb222b - l_xceb1.xceb222b
         LET l_xceb.xceb222c = l_xceb.xceb222c - l_xceb1.xceb222c
         LET l_xceb.xceb222d = l_xceb.xceb222d - l_xceb1.xceb222d
         LET l_xceb.xceb222e = l_xceb.xceb222e - l_xceb1.xceb222e
         LET l_xceb.xceb222f = l_xceb.xceb222f - l_xceb1.xceb222f
         LET l_xceb.xceb222g = l_xceb.xceb222g - l_xceb1.xceb222g
         LET l_xceb.xceb222h = l_xceb.xceb222h - l_xceb1.xceb222h 
         
         LET l_xceb.xcebent = g_enterprise 
         LET l_xceb.xcebcomp = g_xcea_m.xceacomp
         LET l_xceb.xcebld = g_xcea_m.xceald
         LET l_xceb.xcebdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xceb.xceb102) THEN
            CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','8') RETURNING l_success,l_xceb.xceb102
         END IF  
         #20150805--mark--str--lujh                  
         #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
         #                                                       l_xceb.xceb101,
         #                                                       l_xceb.xceb102,
         #                                                       l_xceb.xceb103,
         #                                                       l_xceb.xceb110,
         #                                                       l_xceb.xceb111,
         #                                                       l_xceb.xceb112,
         #                                                       l_xceb.xceb113,
         #                                                       l_xceb.xceb114,
         #                                                       l_xceb.xceb115,
         #                                                       l_xceb.xceb116,
         #                                                       l_xceb.xceb117,
         #                                                       l_xceb.xceb118,
         #                                                       l_xceb.xceb119,
         #                                                       l_xceb.xceb120,
         #                                                       l_xceb.xceb107,
         #                                                       l_xceb.xceb108,
         #                                                       l_xceb.xceb109,
         #                                                       l_xceb.xceb121,
         #                                                       l_xceb.xceb122,
         #                                                       l_xceb.xceb123,
         #                                                       l_xceb.xceb124,
         #                                                       l_xceb.xceb125,
         #                                                       l_xceb.xceb126,
         #                                                       l_xceb.xceb127,
         #                                                       l_xceb.xceb128,
         #                                                       l_xceb.xceb129,
         #                                                       l_xceb.xceb130     
         #20150805--mark--end--lujh           
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
            CONTINUE FOREACH
         END IF              
         #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xceb"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF                       
      END FOREACH    
      CLOSE xcck_prep2_2
      CLOSE xcck_prep3_2  
  END FOREACH  
  
  LET g_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"'",
               #"    AND xcck004 = ",g_xcea004,
               #"    AND xcck005 = ",g_xcea005,
               "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xcck020 IN ('101','301') ",                   
               "    AND xcck002 = ? AND xcck010 = ? AND xcck011 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 
  
   LET g_sql1 = g_sql CLIPPED," AND xcck001 = '2' " 
 
   LET g_sql2 = g_sql CLIPPED," AND xcck001 = '3' " 

   
   LET g_sql = " SELECT xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck032,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"'",
               #"    AND xcck004 = ",g_xcea004,
               #"    AND xcck005 = ",g_xcea005,
               "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('101','301') ",   
               " GROUP BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032",
               " ORDER BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032"
   PREPARE xcck_prep_3 FROM g_sql
   DECLARE xcck_curs_3 CURSOR FOR xcck_prep_3
   

   FOREACH xcck_curs_3 INTO   l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h

      INITIALIZE l_xcec.* TO NULL
      
      LET l_xcec.xcec103 = l_xcck.xcck002 #成本域
      LET l_xcec.xcec004 = l_xcck.xcck010 #料號
      LET l_xcec.xcec005 = l_xcck.xcck011 #料號特性
      LET l_xcec.xcec110 = l_xcck.xcck021 #原因碼
      LET l_xcec.xcec111 = l_xcck.xcck022 #交易對象      
      LET l_xcec.xcec112 = l_xcck.xcck023 #客群 
      LET l_xcec.xcec113 = l_xcck.xcck024 #區域  
      LET l_xcec.xcec114 = l_xcck.xcck025 #成本中心      
      LET l_xcec.xcec115 = l_xcck.xcck026 #經營類別
      LET l_xcec.xcec116 = l_xcck.xcck027 #渠道
      LET l_xcec.xcec117 = l_xcck.xcck028 #品類
      LET l_xcec.xcec118 = l_xcck.xcck029 #品牌
      LET l_xcec.xcec119 = l_xcck.xcck030 #項目號
      LET l_xcec.xcec120 = l_xcck.xcck031 #WBS
      LET l_xcec.xcec101 = l_xcck.xcck032 #存貨科目  
      LET l_xcec.xcec201 = l_xcck.xcck201
      LET l_xcec.xcec202 = l_xcck.xcck202
      LET l_xcec.xcec202a = l_xcck.xcck202a
      LET l_xcec.xcec202b = l_xcck.xcck202b
      LET l_xcec.xcec202c = l_xcck.xcck202c
      LET l_xcec.xcec202d = l_xcck.xcck202d
      LET l_xcec.xcec202e = l_xcck.xcck202e
      LET l_xcec.xcec202f = l_xcck.xcck202f
      LET l_xcec.xcec202g = l_xcck.xcck202g
      LET l_xcec.xcec202h = l_xcck.xcck202h
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF  

      IF cl_null(l_xcck.xcck032) THEN  
         CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'')  #存貨科目   #wujie 150214
          RETURNING l_success,l_xcec.xcec101      
      ELSE
         LET l_xcec.xcec101 = l_xcck.xcck032 
      END IF      
    
      IF g_glaa015 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck032) THEN
            LET g_sql1 = g_sql1," AND xcck032 = ? "
#         END IF
         DECLARE xcck_prep2_3 CURSOR FROM g_sql1
         OPEN xcck_prep2_3 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
         FETCH xcck_prep2_3 INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                               l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep2_3"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck032) THEN
            LET g_sql2 = g_sql2," AND xcck032 = ? "
#         END IF
         DECLARE xcck_prep3_3 CURSOR FROM g_sql2
         OPEN xcck_prep3_3 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
         FETCH xcck_prep3_3 INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                               l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep3_3"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF         
      
      #雜項進出憑證xcea002 = '7'
      LET g_sql = " SELECT SUM(xcec201),SUM(xcec202), ",
               "        SUM(xcec202a),SUM(xcec202b),SUM(xcec202c),SUM(xcec202d),",
               "        SUM(xcec202e),SUM(xcec202f),SUM(xcec202g),SUM(xcec202h), ",
               "        SUM(xcec212),SUM(xcec212a),SUM(xcec212b),SUM(xcec212c),SUM(xcec212d),",
               "        SUM(xcec212e),SUM(xcec212f),SUM(xcec212g),SUM(xcec212h), ",
               "        SUM(xcec222),SUM(xcec222a),SUM(xcec222b),SUM(xcec222c),SUM(xcec222d),",
               "        SUM(xcec222e),SUM(xcec222f),SUM(xcec222g),SUM(xcec222h) ",               
               "        FROM xcea_t LEFT OUTER JOIN xcec_t ON xceaent = xcecent AND xceald = xcecld ",
               "         AND xceadocno = xcecdocno ",               
               "  WHERE xceaent = '",g_enterprise,"' AND xceald = '",g_xcea_m.xceald,"'",
               "    AND xcea003 = '",g_xcea_m.xcea003,"'",
               #"    AND xcea004 = ",g_xcea004,
               #"    AND xcea005 = ",g_xcea005,
               "    AND xcea001 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xcea002 = '7' ",
               "    AND xcec103 = ? ",
               "    AND xcec004 = ? ", 
               "    AND xcec005 = ? ",
               "    AND xcec110 = ? ", 
               "    AND xcec111 = ? ",      
               "    AND xcec112 = ? ", 
               "    AND xcec113 = ? ",  
               "    AND xcec114 = ? ",      
               "    AND xcec115 = ? ",
               "    AND xcec116 = ? ",
               "    AND xcec117 = ? ", 
               "    AND xcec118 = ? ",
               "    AND xcec119 = ? ",
               "    AND xcec120 = ? ",
               "    AND xcec101 = ? "
               
      PREPARE xcec_prep FROM g_sql
      DECLARE xcec_curs CURSOR FOR xcec_prep
      
      OPEN xcec_curs USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
                            
      FOREACH xcec_curs INTO l_xcec1.xcec201,
                             l_xcec1.xcec202,l_xcec1.xcec202a,l_xcec1.xcec202b,l_xcec1.xcec202c,l_xcec1.xcec202d,
                             l_xcec1.xcec202e,l_xcec1.xcec202f,l_xcec1.xcec202g,l_xcec1.xcec202h,
                             l_xcec1.xcec212,l_xcec1.xcec212a,l_xcec1.xcec212b,l_xcec1.xcec212c,l_xcec1.xcec212d,
                             l_xcec1.xcec212e,l_xcec1.xcec212f,l_xcec1.xcec212g,l_xcec1.xcec212h,
                             l_xcec1.xcec222,l_xcec1.xcec222a,l_xcec1.xcec222b,l_xcec1.xcec222c,l_xcec1.xcec222d,
                             l_xcec1.xcec222e,l_xcec1.xcec222f,l_xcec1.xcec222g,l_xcec1.xcec222h

      INITIALIZE l_xcec.* TO NULL
      
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF                             
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF
      IF cl_null(l_xcec1.xcec201)  THEN LET l_xcec1.xcec201  = 0 END IF
      IF cl_null(l_xcec1.xcec202a) THEN LET l_xcec1.xcec202a = 0 END IF
      IF cl_null(l_xcec1.xcec202b) THEN LET l_xcec1.xcec202b = 0 END IF
      IF cl_null(l_xcec1.xcec202c) THEN LET l_xcec1.xcec202c = 0 END IF
      IF cl_null(l_xcec1.xcec202d) THEN LET l_xcec1.xcec202d = 0 END IF
      IF cl_null(l_xcec1.xcec202e) THEN LET l_xcec1.xcec202e = 0 END IF
      IF cl_null(l_xcec1.xcec202f) THEN LET l_xcec1.xcec202f = 0 END IF
      IF cl_null(l_xcec1.xcec202g) THEN LET l_xcec1.xcec202g = 0 END IF
      IF cl_null(l_xcec1.xcec202h) THEN LET l_xcec1.xcec202h = 0 END IF
      IF cl_null(l_xcec1.xcec202)  THEN LET l_xcec1.xcec202  = 0 END IF  

                           
      IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
      IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
      IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
      IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
      IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
      IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
      IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
      IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
      IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF
      IF cl_null(l_xcec1.xcec212a) THEN LET l_xcec1.xcec212a = 0 END IF
      IF cl_null(l_xcec1.xcec212b) THEN LET l_xcec1.xcec212b = 0 END IF
      IF cl_null(l_xcec1.xcec212c) THEN LET l_xcec1.xcec212c = 0 END IF
      IF cl_null(l_xcec1.xcec212d) THEN LET l_xcec1.xcec212d = 0 END IF
      IF cl_null(l_xcec1.xcec212e) THEN LET l_xcec1.xcec212e = 0 END IF
      IF cl_null(l_xcec1.xcec212f) THEN LET l_xcec1.xcec212f = 0 END IF
      IF cl_null(l_xcec1.xcec212g) THEN LET l_xcec1.xcec212g = 0 END IF
      IF cl_null(l_xcec1.xcec212h) THEN LET l_xcec1.xcec212h = 0 END IF
      IF cl_null(l_xcec1.xcec212)  THEN LET l_xcec1.xcec212  = 0 END IF 
      
                                 
      IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
      IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
      IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
      IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
      IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
      IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
      IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
      IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
      IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF
      IF cl_null(l_xcec1.xcec222a) THEN LET l_xcec1.xcec222a = 0 END IF
      IF cl_null(l_xcec1.xcec222b) THEN LET l_xcec1.xcec222b = 0 END IF
      IF cl_null(l_xcec1.xcec222c) THEN LET l_xcec1.xcec222c = 0 END IF
      IF cl_null(l_xcec1.xcec222d) THEN LET l_xcec1.xcec222d = 0 END IF
      IF cl_null(l_xcec1.xcec222e) THEN LET l_xcec1.xcec222e = 0 END IF
      IF cl_null(l_xcec1.xcec222f) THEN LET l_xcec1.xcec222f = 0 END IF
      IF cl_null(l_xcec1.xcec222g) THEN LET l_xcec1.xcec222g = 0 END IF
      IF cl_null(l_xcec1.xcec222h) THEN LET l_xcec1.xcec222h = 0 END IF
      IF cl_null(l_xcec1.xcec222)  THEN LET l_xcec1.xcec222  = 0 END IF      

         LET l_xcec.xcec201 =  l_xcec.xcec201  - l_xcec1.xcec201
         LET l_xcec.xcec202 =  l_xcec.xcec202  - l_xcec1.xcec202
         LET l_xcec.xcec202a = l_xcec.xcec202a - l_xcec1.xcec202a
         LET l_xcec.xcec202b = l_xcec.xcec202b - l_xcec1.xcec202b
         LET l_xcec.xcec202c = l_xcec.xcec202c - l_xcec1.xcec202c
         LET l_xcec.xcec202d = l_xcec.xcec202d - l_xcec1.xcec202d
         LET l_xcec.xcec202e = l_xcec.xcec202e - l_xcec1.xcec202e
         LET l_xcec.xcec202f = l_xcec.xcec202f - l_xcec1.xcec202f
         LET l_xcec.xcec202g = l_xcec.xcec202g - l_xcec1.xcec202g
         LET l_xcec.xcec202h = l_xcec.xcec202h - l_xcec1.xcec202h
         LET l_xcec.xcec212 =  l_xcec.xcec212  - l_xcec1.xcec212
         LET l_xcec.xcec212a = l_xcec.xcec212a - l_xcec1.xcec212a
         LET l_xcec.xcec212b = l_xcec.xcec212b - l_xcec1.xcec212b
         LET l_xcec.xcec212c = l_xcec.xcec212c - l_xcec1.xcec212c
         LET l_xcec.xcec212d = l_xcec.xcec212d - l_xcec1.xcec212d
         LET l_xcec.xcec212e = l_xcec.xcec212e - l_xcec1.xcec212e
         LET l_xcec.xcec212f = l_xcec.xcec212f - l_xcec1.xcec212f
         LET l_xcec.xcec212g = l_xcec.xcec212g - l_xcec1.xcec212g
         LET l_xcec.xcec212h = l_xcec.xcec212h - l_xcec1.xcec212h
         LET l_xcec.xcec222 =  l_xcec.xcec222  - l_xcec1.xcec222
         LET l_xcec.xcec222a = l_xcec.xcec222a - l_xcec1.xcec222a
         LET l_xcec.xcec222b = l_xcec.xcec222b - l_xcec1.xcec222b
         LET l_xcec.xcec222c = l_xcec.xcec222c - l_xcec1.xcec222c
         LET l_xcec.xcec222d = l_xcec.xcec222d - l_xcec1.xcec222d
         LET l_xcec.xcec222e = l_xcec.xcec222e - l_xcec1.xcec222e
         LET l_xcec.xcec222f = l_xcec.xcec222f - l_xcec1.xcec222f
         LET l_xcec.xcec222g = l_xcec.xcec222g - l_xcec1.xcec222g
         LET l_xcec.xcec222h = l_xcec.xcec222h - l_xcec1.xcec222h 
               
         LET l_xcec.xcecent = g_enterprise 
         LET l_xcec.xceccomp = g_xcea_m.xceacomp
         LET l_xcec.xcecld = g_xcea_m.xceald
         LET l_xcec.xcecdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xcec.xcec102) THEN
            CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','8') RETURNING l_success,l_xcec.xcec102
         END IF
         #20150805--mark--str--lujh           
         #CALL axct901_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
         #                                                       l_xcec.xcec101,
         #                                                       l_xcec.xcec102,
         #                                                       l_xcec.xcec103,
         #                                                       l_xcec.xcec110,
         #                                                       l_xcec.xcec111,
         #                                                       l_xcec.xcec112,
         #                                                       l_xcec.xcec113,
         #                                                       l_xcec.xcec114,
         #                                                       l_xcec.xcec115,
         #                                                       l_xcec.xcec116,
         #                                                       l_xcec.xcec117,
         #                                                       l_xcec.xcec118,
         #                                                       l_xcec.xcec119,
         #                                                       l_xcec.xcec120,
         #                                                       l_xcec.xcec107,
         #                                                       l_xcec.xcec108,
         #                                                       l_xcec.xcec109,
         #                                                       l_xcec.xcec121,
         #                                                       l_xcec.xcec122,
         #                                                       l_xcec.xcec123,
         #                                                       l_xcec.xcec124,
         #                                                       l_xcec.xcec125,
         #                                                       l_xcec.xcec126,
         #                                                       l_xcec.xcec127,
         #                                                       l_xcec.xcec128,
         #                                                       l_xcec.xcec129,
         #                                                       l_xcec.xcec130 
         #20150805--mark--end--lujh              
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
            CONTINUE FOREACH
         END IF            
         #      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xcec"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
      END FOREACH   
      CLOSE xcck_prep2_3
      CLOSE xcck_prep3_3  
  END FOREACH
  RETURN g_success
END FUNCTION

################################################################################
# Descriptions...: 抓取xcck_t銷貨資料產生到銷貨成本憑證axct706中   銷貨成本傳票產生維護作業
# Memo...........:
# Usage..........: CALL axct901_01_ins_6()
# Date & Author..: 2014/5/9 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_6()
   DEFINE l_success       LIKE type_t.num5
#161124-00048#21 mark(s)
#   DEFINE l_xcea          RECORD LIKE xcea_t.*
#   DEFINE l_xceb          RECORD LIKE xceb_t.*
#   DEFINE l_xcec          RECORD LIKE xcec_t.*
#   DEFINE l_xcck          RECORD LIKE xcck_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xcck RECORD  #本期料件明細進出成本檔
       xcckent LIKE xcck_t.xcckent, #企业编号
       xccksite LIKE xcck_t.xccksite, #site组织
       xcckcomp LIKE xcck_t.xcckcomp, #法人组织
       xcckld LIKE xcck_t.xcckld, #账套
       xcck001 LIKE xcck_t.xcck001, #账套本位币顺序
       xcck002 LIKE xcck_t.xcck002, #成本域
       xcck003 LIKE xcck_t.xcck003, #成本计算类型
       xcck004 LIKE xcck_t.xcck004, #年度
       xcck005 LIKE xcck_t.xcck005, #期别
       xcck006 LIKE xcck_t.xcck006, #参考单号
       xcck007 LIKE xcck_t.xcck007, #项次
       xcck008 LIKE xcck_t.xcck008, #项序
       xcck009 LIKE xcck_t.xcck009, #出入库码
       xcck010 LIKE xcck_t.xcck010, #料号
       xcck011 LIKE xcck_t.xcck011, #产品特征
       xcck012 LIKE xcck_t.xcck012, #单据类型
       xcck013 LIKE xcck_t.xcck013, #单据日期
       xcck014 LIKE xcck_t.xcck014, #时间
       xcck015 LIKE xcck_t.xcck015, #仓库编号
       xcck016 LIKE xcck_t.xcck016, #储位编号
       xcck017 LIKE xcck_t.xcck017, #批号
       xcck020 LIKE xcck_t.xcck020, #异动类型
       xcck021 LIKE xcck_t.xcck021, #原因码
       xcck022 LIKE xcck_t.xcck022, #交易对象
       xcck023 LIKE xcck_t.xcck023, #客群
       xcck024 LIKE xcck_t.xcck024, #区域
       xcck025 LIKE xcck_t.xcck025, #成本中心
       xcck026 LIKE xcck_t.xcck026, #经营类别
       xcck027 LIKE xcck_t.xcck027, #渠道
       xcck028 LIKE xcck_t.xcck028, #品类
       xcck029 LIKE xcck_t.xcck029, #品牌
       xcck030 LIKE xcck_t.xcck030, #项目号
       xcck031 LIKE xcck_t.xcck031, #WBS
       xcck032 LIKE xcck_t.xcck032, #存货科目
       xcck033 LIKE xcck_t.xcck033, #费用成本科目
       xcck034 LIKE xcck_t.xcck034, #收入科目
       xcck040 LIKE xcck_t.xcck040, #交易币种
       xcck041 LIKE xcck_t.xcck041, #本位币种
       xcck042 LIKE xcck_t.xcck042, #汇率
       xcck043 LIKE xcck_t.xcck043, #交易单位
       xcck044 LIKE xcck_t.xcck044, #成本单位
       xcck045 LIKE xcck_t.xcck045, #换算率
       xcck046 LIKE xcck_t.xcck046, #交易数量
       xcck047 LIKE xcck_t.xcck047, #工单号码
       xcck048 LIKE xcck_t.xcck048, #重复性生产-计划编号
       xcck049 LIKE xcck_t.xcck049, #重复性生产-生产料号
       xcck050 LIKE xcck_t.xcck050, #重复性生产-生产料号BOM特性
       xcck051 LIKE xcck_t.xcck051, #重复性生产-生产料号产品特征
       xcck055 LIKE xcck_t.xcck055, #xccc类型
       xcck201 LIKE xcck_t.xcck201, #本期异动数量
       xcck202 LIKE xcck_t.xcck202, #本期异动金额
       xcck202a LIKE xcck_t.xcck202a, #本期异动金额-材料
       xcck202b LIKE xcck_t.xcck202b, #本期异动金额-人工
       xcck202c LIKE xcck_t.xcck202c, #本期异动金额-加工费
       xcck202d LIKE xcck_t.xcck202d, #本期异动金额-制费一
       xcck202e LIKE xcck_t.xcck202e, #本期异动金额-制费二
       xcck202f LIKE xcck_t.xcck202f, #本期异动金额-制费三
       xcck202g LIKE xcck_t.xcck202g, #本期异动金额-制费四
       xcck202h LIKE xcck_t.xcck202h, #本期异动金额-制费五
       xcck282 LIKE xcck_t.xcck282, #本期异动单价
       xcck282a LIKE xcck_t.xcck282a, #本期异动单价-材料
       xcck282b LIKE xcck_t.xcck282b, #本期异动单价-人工
       xcck282c LIKE xcck_t.xcck282c, #本期异动单价-加工
       xcck282d LIKE xcck_t.xcck282d, #本期异动单价-制费一
       xcck282e LIKE xcck_t.xcck282e, #本期异动单价-制费二
       xcck282f LIKE xcck_t.xcck282f, #本期异动单价-制费三
       xcck282g LIKE xcck_t.xcck282g, #本期异动单价-制费四
       xcck282h LIKE xcck_t.xcck282h, #本期异动单价-制费五
       xcck301 LIKE xcck_t.xcck301, #已耗数量
       xcck302 LIKE xcck_t.xcck302, #已耗金额
       xcck302a LIKE xcck_t.xcck302a, #已耗金额-材料
       xcck302b LIKE xcck_t.xcck302b, #已耗金额-人工
       xcck302c LIKE xcck_t.xcck302c, #已耗金额-加工费
       xcck302d LIKE xcck_t.xcck302d, #已耗金额-制费一
       xcck302e LIKE xcck_t.xcck302e, #已耗金额-制费二
       xcck302f LIKE xcck_t.xcck302f, #已耗金额-制费三
       xcck302g LIKE xcck_t.xcck302g, #已耗金额-制费四
       xcck302h LIKE xcck_t.xcck302h, #已耗金额-制费五
       xcck901 LIKE xcck_t.xcck901, #结存数量
       xcck902 LIKE xcck_t.xcck902, #结存金额
       xcck902a LIKE xcck_t.xcck902a, #结存金额-材料
       xcck902b LIKE xcck_t.xcck902b, #结存金额-人工
       xcck902c LIKE xcck_t.xcck902c, #结存金额-加工费
       xcck902d LIKE xcck_t.xcck902d, #结存金额-制费一
       xcck902e LIKE xcck_t.xcck902e, #结存金额-制费二
       xcck902f LIKE xcck_t.xcck902f, #结存金额-制费三
       xcck902g LIKE xcck_t.xcck902g, #结存金额-制费四
       xcck902h LIKE xcck_t.xcck902h, #结存金额-制费五
       xcck980 LIKE xcck_t.xcck980, #结存单位成本
       xcck980a LIKE xcck_t.xcck980a, #结存单位成本-材料
       xcck980b LIKE xcck_t.xcck980b, #结存单位成本-人工
       xcck980c LIKE xcck_t.xcck980c, #结存单位成本-加工费
       xcck980d LIKE xcck_t.xcck980d, #结存单位成本-制费一
       xcck980e LIKE xcck_t.xcck980e, #结存单位成本-制费二
       xcck980f LIKE xcck_t.xcck980f, #结存单位成本-制费三
       xcck980g LIKE xcck_t.xcck980g, #结存单位成本-制费四
       xcck980h LIKE xcck_t.xcck980h, #结存单位成本-制费五
       xcck903 LIKE xcck_t.xcck903, #结存调整金额
       xcck903a LIKE xcck_t.xcck903a, #结存调整金额-材料
       xcck903b LIKE xcck_t.xcck903b, #结存调整金额-人工
       xcck903c LIKE xcck_t.xcck903c, #结存调整金额-加工费
       xcck903d LIKE xcck_t.xcck903d, #结存调整金额-制费一
       xcck903e LIKE xcck_t.xcck903e, #结存调整金额-制费二
       xcck903f LIKE xcck_t.xcck903f, #结存调整金额-制费三
       xcck903g LIKE xcck_t.xcck903g, #结存调整金额-制费四
       xcck903h LIKE xcck_t.xcck903h, #结存调整金额-制费五
       xcckownid LIKE xcck_t.xcckownid, #资料所有者
       xcckowndp LIKE xcck_t.xcckowndp, #资料所有部门
       xcckcrtid LIKE xcck_t.xcckcrtid, #资料录入者
       xcckcrtdp LIKE xcck_t.xcckcrtdp, #资料录入部门
       xcckcrtdt LIKE xcck_t.xcckcrtdt, #资料创建日
       xcckmodid LIKE xcck_t.xcckmodid, #资料更改者
       xcckmoddt LIKE xcck_t.xcckmoddt, #最近更改日
       xcckstus LIKE xcck_t.xcckstus, #状态码
       xcck056 LIKE xcck_t.xcck056  #成本代销单号
END RECORD
#161124-00048#21 add(e)
   DEFINE ld_date         DATETIME YEAR TO SECOND
   DEFINE l_xcck020       LIKE xcck_t.xcck020
   DEFINE l_sql,l_sql1,l_sql2,l_sql3    STRING
   DEFINE l_str           STRING
   DEFINE ls_wc,ls_wc1,ls_wc2,ls_wc3           STRING   #C151008-004 Add
   DEFINE l_xceb108       LIKE xckd_t.xckd021
   
   #######################
   DEFINE l_cnt11     LIKE type_t.num5
   DEFINE l_cnt22     LIKE type_t.num5
   DEFINE r_success1  LIKE type_t.chr1

   #######################   
   
  #add by zhr 151231 str
   DEFINE l_xceaud RECORD
       xceaud001 LIKE xcea_t.xceaud001    #单据类型
   END RECORD
   DEFINE l_n   LIKE type_t.num5    
   DEFINE l_cnt LIKE type_t.num5   
   DEFINE l_c1 LIKE  type_t.chr500
   DEFINE l_c2 LIKE  type_t.chr500
   DEFINE l_n1 LIKE  type_t.num5
   DEFINE l_n2 LIKE  type_t.num5
   DEFINE l_xcea002      LIKE xcea_t.xcea002 
   DEFINE l_list        DYNAMIC ARRAY OF RECORD
             xceaud001     LIKE xcea_t.xceaud001
   END RECORD
   DEFINE l_ac   LIKE  type_t.num5
   DEFINE l_ac_t   LIKE  type_t.num5
   DEFINE l_docno  LIKE xcea_t.xceadocno
#add by zhr 151231 end  
   
   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   
   
   #按照单据类型产生单据  #add by zhr 151231 str
   LET ls_wc  = g_wc_xcck026   #经营类别
   #LET ls_wc1 = g_wc_xcck012   #单据类型
   LET ls_wc2 = g_wc_xcck021   #原因码
   LET ls_wc3 = g_wc_xcck028   #品类 
   LET ls_wc  = cl_replace_str(ls_wc,  "xcck026","xckd013")
   #LET ls_wc1 = cl_replace_str(ls_wc1, "xcck012","xckd007")   
   LET ls_wc2 = cl_replace_str(ls_wc2, "xcck021","xckd012")
   LET ls_wc3 = cl_replace_str(ls_wc3, "xcck028","xckd014")    
   LET l_cnt = 1
   LET l_n = 1 
   
   LET l_sql1 =" SELECT distinct xckd007 FROM xckd_t ", 
               "  WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
               "    AND xckd003 = '",g_xcea_m.xcea003,"' ",
               "    AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xckdsite = '",g_xcea_m.xceasite,"'",
               "    AND xckd001 = '1' ",
               "    AND ",ls_wc,   
               #"    AND ",ls_wc1,   #add 
               "    AND ",ls_wc2,   #add
               "    AND ",ls_wc3,   #add
               "    AND NVL(xckd019,'N') = 'N' "

   LET l_sql1 = l_sql1," GROUP BY xckd007 "
   PREPARE xcck_prep6 FROM l_sql1
   DECLARE xcck_curs6 CURSOR FOR xcck_prep6
   
   LET l_ac = 1
   FOREACH xcck_curs6 INTO l_list[l_ac].xceaud001
      LET l_ac = l_ac + 1
   END FOREACH

   LET l_docno = g_xcea_m.xceadocno
   #FOR l_ac = 1 TO l_list.getLength()
   #   IF cl_null(l_list[l_ac].xceaud001) THEN CONTINUE FOR END IF
   #   LET l_xceaud.xceaud001 = l_list[l_ac].xceaud001
      #add by zhr 151231 end
      CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',l_docno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
      RETURNING l_success,g_xcea_m.xceadocno
      IF l_success  = 0  THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'apm-00003'
         LET g_errparam.extend = g_xcea_m.xceadocno
         LET g_errparam.popup = TRUE
         CALL cl_err()
   
         LET g_success = 'N'
         RETURN g_success
      END IF
      
      INSERT INTO xcea_t (xceaent,xceald,xceacomp,xceadocno,xcea001,xcea002,xcea003,xcea004, 
                          xcea005,xcea006,xcea007,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,
                          xceacrtdt, xceamodid,xceamoddt,xceasite)  
      VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xceadocno,g_xcea_m.xcea001,g_xcea002,
              g_xcea_m.xcea003,g_xcea004,g_xcea005,g_xcea_m.xcea006,g_xcea_m.xcea007, 
              'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
              l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
          
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcea_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
     
         LET g_success = 'N'
         RETURN g_success
      END IF
      
      
      #add by zhr 151231    str--账套+编号存进动态数组
      #LET g_rec_d[l_n].xceald = g_xcea_m.xceald
      #LET g_rec_d[l_n].xceadocno = g_xcea_m.xceadocno
      #LET l_n = l_n +1
      #LET l_cnt = l_cnt + 1
      #add by 151231 end
      
      LET l_sql = " SELECT SUM(xcck009*xcck202), ",
                  "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
                  "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
                  "        FROM xcck_t ", 
                  "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
                  "    AND xcck003 = '",g_xcea_m.xcea003,"' ",
   #               "    AND xcck004 = ",g_xcea_m.xcea004,
   #               "    AND xcck005 = ",g_xcea_m.xcea005,
                  "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
                  "    AND ",g_wc_xcck026,       #20150731 add lujh  经营类别 
                  "    AND ",g_wc_xcck021,       #add by zhr 151231  原因码
                  "    AND ",g_wc_xcck028,       #add by zhr 151231  管理品类
                  "    AND NVL(xcckud001,'N') = 'N' ",
                  "    AND xcck020 IN ('201','202') ",                
                  "    AND xcck002 = ? AND xcck006 = ? AND xcck007 = ? ",
                  "    AND xcck010 = ? AND xcck011 = ? ",
                  "    AND xcck009 = ? AND xcck021 = ? ",
                  "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
                  "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
                  "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
                  "    AND xcck031 = ? " 
                  #"    AND xcck012 = '",l_xceaud.xceaud001,"'   "   #add by zhr 151231 单据类型 #160512-00011#1 mark
                  
      
      LET g_sql1 = l_sql CLIPPED," AND xcck001 = '2' " 
      
      LET g_sql2 = l_sql CLIPPED," AND xcck001 = '3' " 
   
     #C151008-004 Add  ---(S)---
 
     #  #add by zhr 151231 str
      LET ls_wc  = g_wc_xcck026   #经营类别
      #LET ls_wc1 = g_wc_xcck012   #单据类型
      LET ls_wc2 = g_wc_xcck021   #原因码
      LET ls_wc3 = g_wc_xcck028   #管理品类
      LET ls_wc  = cl_replace_str(ls_wc, "xcck026","xckd013")  
      #LET ls_wc1 = cl_replace_str(ls_wc1,"xcck012","xckd007")
      LET ls_wc2 = cl_replace_str(ls_wc2,"xcck021","xckd012")  
      LET ls_wc3 = cl_replace_str(ls_wc3,"xcck028","xckd014")
     #   #add by zhr 151231 end 
      LET g_sql = " SELECT xckd002 ,'' xcck006,'' xcck007,'' xcck010,'' xcck011,xckd006 ,xckd012 ,'' xcck022,'' xcck023,",
                  "        '' xcck024,xckd020 ,xckd013 ,'' xcck027,xckd014 ,'' xcck029,'' xcck030,'' xcck031,'' xcck033,",
                  "        SUM(xckd006 *xckd016),SUM(xckd006 *xckd017),SUM(xckd006 *xckd018),",
                  "        SUM(xckd006*0) xcck202b,SUM(xckd006*0) xcck202c,SUM(xckd006*0) xcck202d,",
                  "        SUM(xckd006*0) xcck202e,SUM(xckd006*0) xcck202f,SUM(xckd006*0) xcck202g,SUM(xckd006*0) xcck202h,xckd008,xckd007,xckd021 ",
                  "        FROM xckd_t ", 
                  "  WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
                  "    AND xckd003 = '",g_xcea_m.xcea003,"' ",
                  "    AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
                  "    AND xckdsite = '",g_xcea_m.xceasite,"'",
                  "    AND xckd001 = '1' ",
                  "    AND ",ls_wc,   #经营类别
                  "    AND ",ls_wc2,        #原因码add by zhr 151228 str
                  "    AND ",ls_wc3,        #品类  add by zhr 151228 str
                  "    AND NVL(xckd019,'N') = 'N' ",
                  "    AND xckd011 IN ('201','202') ",  
                  #"    AND xckd007 = '",l_xceaud.xceaud001,"'   ",   #add by zhr 151231 单据类型   #160512-00011#1 mark
                  " GROUP BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd008,xckd007,xckd021",
                  " ORDER BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd008,xckd007,xckd021"
     #C151008-004 Add  ---(E)---
      PREPARE axct901_01_xcck_pr FROM g_sql
      DECLARE axct901_01_xcck_cs CURSOR FOR axct901_01_xcck_pr
   
      LET l_sql = " SELECT SUM(xcck009*xcck202), ",
                  "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
                  "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
                  "        FROM xcck_t ", 
                  "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
                  "    AND xcck003 = '",g_xcea_m.xcea003,"' ",
                  "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
                  "    AND ",g_wc_xcck026,       #20150731 add lujh
                  "    AND ",g_wc_xcck021,       #add by zhr 151231  原因码
                  "    AND ",g_wc_xcck028,       #add by zhr 151231  管理品类                 
                  "    AND NVL(xcckud001,'N') = 'N' ",
                  "    AND xcck020 IN ('201','202') ",                
                  "    AND xcck002 = ? AND xcck006 = ? AND xcck007 = ? ",
                  "    AND xcck010 = ? AND xcck011 = ? ",
                  "    AND xcck009 = ? AND xcck021 = ? ",
                  "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
                  "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
                  "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
                  "    AND xcck031 = ? " 
                  #"    AND xcck012 = '",l_xceaud.xceaud001,"'   "   #add by zhr 151231 单据类型 #160512-00011#1 mark
                  
      
      LET g_sql1 = l_sql CLIPPED," AND xcck001 = '2' " 
      
      LET g_sql2 = l_sql CLIPPED," AND xcck001 = '3' " 
 
#  #add by zhr 151231 str
      LET ls_wc  = g_wc_xcck026   #经营类别
      #LET ls_wc1 = g_wc_xcck012   #单据类型
      LET ls_wc2 = g_wc_xcck021   #原因码
      LET ls_wc3 = g_wc_xcck028   #管理品类
      LET ls_wc  = cl_replace_str(ls_wc, "xcck026","xckd013")  
      #LET ls_wc1 = cl_replace_str(ls_wc1,"xcck012","xckd007")
      LET ls_wc2 = cl_replace_str(ls_wc2,"xcck021","xckd012")  
      LET ls_wc3 = cl_replace_str(ls_wc3,"xcck028","xckd014")
#   #add by zhr 151231 end 
      LET g_sql = " SELECT xckd002 ,'' xcck006,'' xcck007,'' xcck010,'' xcck011,xckd006 ,xckd012 ,'' xcck022,'' xcck023,",
                  "        '' xcck024,xckd020 ,xckd013 ,'' xcck027,xckd014 ,'' xcck029,'' xcck030,'' xcck031,'' xcck032,",
                  "        SUM(xckd006 *xckd016),SUM(xckd006 *xckd017),SUM(xckd006 *xckd018),",
                  "        SUM(xckd006*0) xcck202b,SUM(xckd006*0) xcck202c,SUM(xckd006*0) xcck202d,",
                  "        SUM(xckd006*0) xcck202e,SUM(xckd006*0) xcck202f,SUM(xckd006*0) xcck202g,SUM(xckd006*0) xcck202h,xckd021 ",
                  "        FROM xckd_t ", 
                  "  WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
                  "    AND xckd003 = '",g_xcea_m.xcea003,"' ",
                  "    AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
                  "    AND xckdsite = '",g_xcea_m.xceasite,"'",
                  "    AND xckd001 = '1' ",
                  "    AND ",ls_wc,
                  "    AND ",ls_wc2,  #add by zhr 151228 str
                  "    AND ",ls_wc3,  #add by zhr 151228 str 
                  #"    AND xckd007 = '",l_xceaud.xceaud001,"'   "   ,#add by zhr 151231 单据类型   #160512-00011#1 mark
                  "    AND NVL(xckd019,'N') = 'N' ",
                  "    AND xckd011 IN ('201','202') ",  
                  " GROUP BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd021",
                  " ORDER BY xckd002,xckd006,xckd012,xckd020,xckd013,xckd014,xckd021"
     #C151008-004 Add  ---(E)---
      PREPARE axct901_01_xcck_pr_1 FROM g_sql
      DECLARE axct901_01_xcck_cs_1 CURSOR FOR axct901_01_xcck_pr_1
      
      FOREACH axct901_01_xcck_cs INTO l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                      l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                      l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033,
                                      l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                                      l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h,l_xcck.xcck013,l_xcck.xcck012,l_xceb108
   
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
     
            LET g_success = 'N'
            RETURN g_success
         END IF
         
         IF cl_null(l_xcck.xcck201)  THEN LET l_xcck.xcck201=0  END IF
         IF cl_null(l_xcck.xcck202)  THEN LET l_xcck.xcck202=0  END IF
         IF cl_null(l_xcck.xcck202a) THEN LET l_xcck.xcck202a=0 END IF
         IF cl_null(l_xcck.xcck202b) THEN LET l_xcck.xcck202b=0 END IF
         IF cl_null(l_xcck.xcck202c) THEN LET l_xcck.xcck202c=0 END IF
         IF cl_null(l_xcck.xcck202d) THEN LET l_xcck.xcck202d=0 END IF
         IF cl_null(l_xcck.xcck202e) THEN LET l_xcck.xcck202e=0 END IF
         IF cl_null(l_xcck.xcck202f) THEN LET l_xcck.xcck202f=0 END IF
         IF cl_null(l_xcck.xcck202g) THEN LET l_xcck.xcck202g=0 END IF
         IF cl_null(l_xcck.xcck202h) THEN LET l_xcck.xcck202h=0 END IF
   
         INITIALIZE l_xceb.* TO NULL
         
         CASE l_xcck.xcck009
            WHEN -1          #销货
               LET l_xceb.xceb003 = '7'
            WHEN  1          #销退
               LET l_xceb.xceb003 = '8'        
         END CASE
   
        #SELECT xmdk004 INTO l_xceb.xceb108   #部门
        #  FROM xmdk_t
        # WHERE xmdkent = g_enterprise
        #   AND xmdkdocno = l_xcck.xcck006
         LET l_xceb.xceb108 = l_xceb108
            
         LET l_xceb.xceb103 = l_xcck.xcck002 #成本域
         LET l_xceb.xceb001 = l_xcck.xcck006 #参考单号
         LET l_xceb.xceb002 = l_xcck.xcck007 #参考项次
         LET l_xceb.xceb004 = l_xcck.xcck010 #料號
         LET l_xceb.xceb005 = l_xcck.xcck011 #特性
         LET l_xceb.xceb110 = l_xcck.xcck021 #原因碼
         LET l_xceb.xceb111 = l_xcck.xcck022 #交易對象      
         LET l_xceb.xceb112 = l_xcck.xcck023 #客群 
         LET l_xceb.xceb113 = l_xcck.xcck024 #區域  
         LET l_xceb.xceb114 = l_xcck.xcck025 #成本中心      
         LET l_xceb.xceb115 = l_xcck.xcck026 #經營類別
         LET l_xceb.xceb116 = l_xcck.xcck027 #渠道
         LET l_xceb.xceb117 = l_xcck.xcck028 #品類
         LET l_xceb.xceb118 = l_xcck.xcck029 #品牌
         LET l_xceb.xceb119 = l_xcck.xcck030 #項目號
         LET l_xceb.xceb120 = l_xcck.xcck031 #WBS
         LET l_xceb.xceb101 = l_xcck.xcck033 #費用科目 
         
         LET l_xceb.xceb201 = l_xcck.xcck201
         LET l_xceb.xceb202 = l_xcck.xcck202
         LET l_xceb.xceb202a = l_xcck.xcck202a
         LET l_xceb.xceb202b = l_xcck.xcck202b
         LET l_xceb.xceb202c = l_xcck.xcck202c
         LET l_xceb.xceb202d = l_xcck.xcck202d
         LET l_xceb.xceb202e = l_xcck.xcck202e
         LET l_xceb.xceb202f = l_xcck.xcck202f
         LET l_xceb.xceb202g = l_xcck.xcck202g
         LET l_xceb.xceb202h = l_xcck.xcck202h
         
         #增加栏位，为了删除资料时还原   20151008
         #LET l_xceb.xcebua001= l_xcck.xcck013
         #LET l_xceb.xcebud001= l_xcck.xcck012
         
         IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201 = 0  END IF
         IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
         IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
         IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
         IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
         IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
         IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
         IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
         IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
         IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF     
         
         
         SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
          WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
            AND xcebdocno = g_xcea_m.xceadocno
         IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
            LET l_xceb.xcebseq = 1
         ELSE
            LET l_xceb.xcebseq = l_xceb.xcebseq + 1
         END IF  
         
         #20150806--mod--str--lujh
       #IF cl_null(l_xcck.xcck033) THEN  
       #   CALL s_get_item_acc(g_xcea_m.xceald,'2',l_xcck.xcck010,'','',g_xcea_m.xceacomp,'')  #銷貨成本科目
       #    RETURNING l_success,l_xcec.xcec101    
       #ELSE
       #   LET l_xcec.xcec101 = l_xcck.xcck032 
       #END IF
         #mark by zhang str
         SELECT glab006 INTO l_xceb.xceb101     
          FROM glab_t
         WHERE glabent = g_enterprise
           AND glabld =  g_xcea_m.xceald
           AND glab001 = 'RTAX'
           AND glab002 = l_xceb.xceb115
           AND glab003 = l_xceb.xceb117
         #20150806--mod--end--lujh
         #mark by zhanghr end
         #核算項組合sql
         CALL axct901_01_mark_sql(l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,
                                  l_xcck.xcck027,l_xcck.xcck028,l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031)
         RETURNING l_str
         #銷貨成本科目
         IF cl_null(l_xceb.xceb101) THEN
            CALL s_get_item_acc(g_xcea_m.xceald,'5',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'')    #wujie 150214
              RETURNING l_success,l_xceb.xceb101 
         END IF
   #      IF l_xcck.xcck033 IS NULL THEN
   #         LET l_str=l_str," AND xcck033 IS NULL"
   #      ELSE
   #         LET l_str=l_str," AND xcck033 = '",l_xcck.xcck033,"'"
   #      END IF
         IF g_glaa015 = 'Y' THEN  
   #         IF NOT cl_null(l_xcck.xcck033) THEN
               LET g_sql1 = g_sql1," AND xcck033 = ? "
   #         END IF
            PREPARE axct901_01_xcck_pr2 FROM g_sql1
            EXECUTE axct901_01_xcck_pr2 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                      l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                      l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
                                         INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,
                                              l_xceb.xceb212d,l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,
                                              l_xceb.xceb212h,l_xceb.xceb108
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "axct901_01_xcck_pr2"
               LET g_errparam.popup = FALSE
               CALL cl_err()
   
               LET g_success = 'N'
               RETURN g_success
               EXIT FOREACH
            END IF
   
            IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212=0  END IF
            IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a=0 END IF
            IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b=0 END IF
            IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c=0 END IF
            IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d=0 END IF
            IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e=0 END IF
            IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f=0 END IF
            IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g=0 END IF
            IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h=0 END IF
         ELSE
            LET l_xceb.xceb212a = 0
            LET l_xceb.xceb212b = 0
            LET l_xceb.xceb212c = 0
            LET l_xceb.xceb212d = 0
            LET l_xceb.xceb212e = 0
            LET l_xceb.xceb212f = 0
            LET l_xceb.xceb212g = 0
            LET l_xceb.xceb212h = 0
            LET l_xceb.xceb212  = 0     
         END IF
         
         IF g_glaa019 = 'Y' THEN
   #         IF NOT cl_null(l_xcck.xcck033) THEN
               LET g_sql2 = g_sql2," AND xcck033 = ? "
   #         END IF     
            PREPARE axct901_01_xcck_pr3 FROM g_sql2         
            EXECUTE axct901_01_xcck_pr3 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                      l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                      l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
                                         INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,
                                              l_xceb.xceb222d,l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,
                                              l_xceb.xceb222h
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "axct901_01_xcck_pr3"
               LET g_errparam.popup = FALSE
               CALL cl_err()
   
               LET g_success = 'N'
               RETURN g_success
               EXIT FOREACH
            END IF
   
            IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222=0  END IF
            IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a=0 END IF
            IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b=0 END IF
            IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c=0 END IF
            IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d=0 END IF
            IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e=0 END IF
            IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f=0 END IF
            IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g=0 END IF
            IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h=0 END IF
         ELSE
            LET l_xceb.xceb222a = 0
            LET l_xceb.xceb222b = 0
            LET l_xceb.xceb222c = 0
            LET l_xceb.xceb222d = 0
            LET l_xceb.xceb222e = 0
            LET l_xceb.xceb222f = 0
            LET l_xceb.xceb222g = 0
            LET l_xceb.xceb222h = 0
            LET l_xceb.xceb222  = 0     
         END IF
         
         LET l_xceb.xcebent = g_enterprise 
         LET l_xceb.xcebcomp = g_xcea_m.xceacomp
         LET l_xceb.xcebld = g_xcea_m.xceald
         LET l_xceb.xcebdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xceb.xceb102) THEN
            CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','6') RETURNING l_success,l_xceb.xceb102
         END IF
         #20150805--mark--str--lujh
         #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
         #                                                       l_xceb.xceb101,
         #                                                       l_xceb.xceb102,
         #                                                       l_xceb.xceb103,
         #                                                       l_xceb.xceb110,
         #                                                       l_xceb.xceb111,
         #                                                       l_xceb.xceb112,
         #                                                       l_xceb.xceb113,
         #                                                       l_xceb.xceb114,
         #                                                       l_xceb.xceb115,
         #                                                       l_xceb.xceb116,
         #                                                       l_xceb.xceb117,
         #                                                       l_xceb.xceb118,
         #                                                       l_xceb.xceb119,
         #                                                       l_xceb.xceb120,
         #                                                       l_xceb.xceb107,
         #                                                       l_xceb.xceb108,
         #                                                       l_xceb.xceb109,
         #                                                       l_xceb.xceb121,
         #                                                       l_xceb.xceb122,
         #                                                       l_xceb.xceb123,
         #                                                       l_xceb.xceb124,
         #                                                       l_xceb.xceb125,
         #                                                       l_xceb.xceb126,
         #                                                       l_xceb.xceb127,
         #                                                       l_xceb.xceb128,
         #                                                       l_xceb.xceb129,
         #                                                       l_xceb.xceb130 
         #20150805--mark--end--lujh      
   #如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
            CONTINUE FOREACH
         END IF      
         #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xceb_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()
     
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
           
      END FOREACH  
   
      FOREACH axct901_01_xcck_cs_1 INTO l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                        l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                        l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032,
                                        l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                                        l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h,l_xceb108
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
     
            LET g_success = 'N'
            RETURN g_success
         END IF
         
         IF cl_null(l_xcck.xcck201)  THEN LET l_xcck.xcck201=0  END IF
         IF cl_null(l_xcck.xcck202)  THEN LET l_xcck.xcck202=0  END IF
         IF cl_null(l_xcck.xcck202a) THEN LET l_xcck.xcck202a=0 END IF
         IF cl_null(l_xcck.xcck202b) THEN LET l_xcck.xcck202b=0 END IF
         IF cl_null(l_xcck.xcck202c) THEN LET l_xcck.xcck202c=0 END IF
         IF cl_null(l_xcck.xcck202d) THEN LET l_xcck.xcck202d=0 END IF
         IF cl_null(l_xcck.xcck202e) THEN LET l_xcck.xcck202e=0 END IF
         IF cl_null(l_xcck.xcck202f) THEN LET l_xcck.xcck202f=0 END IF
         IF cl_null(l_xcck.xcck202g) THEN LET l_xcck.xcck202g=0 END IF
         IF cl_null(l_xcck.xcck202h) THEN LET l_xcck.xcck202h=0 END IF
   
         INITIALIZE l_xcec.* TO NULL
         
         CASE l_xcck.xcck009
            WHEN -1          #销货
               LET l_xcec.xcec003 = '7'
            WHEN  1          #销退
               LET l_xcec.xcec003 = '8'        
         END CASE
   
         SELECT xmdk004 INTO l_xcec.xcec108   #部门
           FROM xmdk_t
          WHERE xmdkent = g_enterprise
            AND xmdkdocno = l_xcck.xcck006
            LET l_xcec.xcec108 = l_xceb108
         LET l_xcec.xcec103 = l_xcck.xcck002 #成本域
         LET l_xcec.xcec001 = l_xcck.xcck006 #参考单号
         LET l_xcec.xcec002 = l_xcck.xcck007 #参考项次
         LET l_xcec.xcec004 = l_xcck.xcck010 #料號
         LET l_xcec.xcec005 = l_xcck.xcck011 #特性
         LET l_xcec.xcec110 = l_xcck.xcck021 #原因碼
         LET l_xcec.xcec111 = l_xcck.xcck022 #交易對象      
         LET l_xcec.xcec112 = l_xcck.xcck023 #客群 
         LET l_xcec.xcec113 = l_xcck.xcck024 #區域  
         LET l_xcec.xcec114 = l_xcck.xcck025 #成本中心      
         LET l_xcec.xcec115 = l_xcck.xcck026 #經營類別
         LET l_xcec.xcec116 = l_xcck.xcck027 #渠道
         LET l_xcec.xcec117 = l_xcck.xcck028 #品類
         LET l_xcec.xcec118 = l_xcck.xcck029 #品牌
         LET l_xcec.xcec119 = l_xcck.xcck030 #項目號
         LET l_xcec.xcec120 = l_xcck.xcck031 #WBS
         LET l_xcec.xcec101 = l_xcck.xcck032 #存貨科目 
   
         LET l_xcec.xcec201 = l_xcck.xcck201
         LET l_xcec.xcec202 = l_xcck.xcck202
         LET l_xcec.xcec202a = l_xcck.xcck202a
         LET l_xcec.xcec202b = l_xcck.xcck202b
         LET l_xcec.xcec202c = l_xcck.xcck202c
         LET l_xcec.xcec202d = l_xcck.xcck202d
         LET l_xcec.xcec202e = l_xcck.xcck202e
         LET l_xcec.xcec202f = l_xcck.xcck202f
         LET l_xcec.xcec202g = l_xcck.xcck202g
         LET l_xcec.xcec202h = l_xcck.xcck202h
         
         SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
          WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
            AND xcecdocno = g_xcea_m.xceadocno
         IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
            LET l_xcec.xcecseq = 1
         ELSE
            LET l_xcec.xcecseq = l_xcec.xcecseq + 1
         END IF  
   
         #20150806--mod--str--lujh
         #IF cl_null(l_xcck.xcck032) THEN  
         #   CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcck.xcck010,'','',g_xcea_m.xceacomp,'')  #存貨科目
         #    RETURNING l_success,l_xcec.xcec101   
         #ELSE
         #   LET l_xcec.xcec101 = l_xcck.xcck032 
         #END IF
         #mark by zhanghr str
   #      SELECT glab006 INTO l_xcec.xcec101   
   #       FROM glab_t
   #      WHERE glabent = g_enterprise
   #        AND glabld =  g_xcea_m.xceald
   #        AND glab001 = 'RTAX'
   #        AND glab002 = l_xceb.xceb115
   #        AND glab003 = l_xceb.xceb117
         #20150806--mod--end--lujh
         #mark by zhanghr end
           SELECT glab007 INTO l_xcec.xcec101   
          FROM glab_t
         WHERE glabent = g_enterprise
           AND glabld =  g_xcea_m.xceald
           AND glab001 = 'RTAX'
           AND glab002 = l_xcck.xcck026
           AND glab003 = l_xcck.xcck028
         #核算項組合sql
         CALL axct901_01_mark_sql(l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,
                                  l_xcck.xcck027,l_xcck.xcck028,l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031)
         RETURNING l_str
   
         IF g_glaa015 = 'Y' THEN
   #         IF NOT cl_null(l_xcck.xcck033) THEN
               LET g_sql1 = g_sql1," AND xcck032 = ? "
   #         END IF
            PREPARE axct901_01_xcck_pr2_1 FROM g_sql1
            EXECUTE axct901_01_xcck_pr2_1 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                      l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                      l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
                                           INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,
                                                l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,
                                                l_xcec.xcec212h
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "axct901_01_xcck_pr2_1"
               LET g_errparam.popup = FALSE
               CALL cl_err()
   
               LET g_success = 'N'
               RETURN g_success
               EXIT FOREACH
            END IF
   
            IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212=0 END IF
            IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a=0 END IF
            IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212=0 END IF
            IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c=0 END IF
            IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d=0 END IF
            IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e=0 END IF
            IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f=0 END IF
            IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g=0 END IF
            IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h=0 END IF
         ELSE
            LET l_xceb.xceb212a = 0
            LET l_xceb.xceb212b = 0
            LET l_xceb.xceb212c = 0
            LET l_xceb.xceb212d = 0
            LET l_xceb.xceb212e = 0
            LET l_xceb.xceb212f = 0
            LET l_xceb.xceb212g = 0
            LET l_xceb.xceb212h = 0
            LET l_xceb.xceb212  = 0     
         END IF
         
         IF g_glaa019 = 'Y' THEN
   #         IF NOT cl_null(l_xcck.xcck033) THEN
               LET g_sql2 = g_sql2," AND xcck032 = ? "
   #         END IF
            PREPARE axct901_01_xcck_pr3_1 FROM g_sql2
            EXECUTE axct901_01_xcck_pr3_1 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                      l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                      l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
                                           INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,
                                                l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                                                l_xcec.xcec222h
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "axct901_01_xcck_pr3_1"
               LET g_errparam.popup = FALSE
               CALL cl_err()
   
               LET g_success = 'N'
               RETURN g_success
               EXIT FOREACH
            END IF
   
            IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222=0 END IF
            IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a=0 END IF
            IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222=0 END IF
            IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c=0 END IF
            IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d=0 END IF
            IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e=0 END IF
            IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f=0 END IF
            IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g=0 END IF
            IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h=0 END IF
         ELSE
            LET l_xceb.xceb222a = 0
            LET l_xceb.xceb222b = 0
            LET l_xceb.xceb222c = 0
            LET l_xceb.xceb222d = 0
            LET l_xceb.xceb222e = 0
            LET l_xceb.xceb222f = 0
            LET l_xceb.xceb222g = 0
            LET l_xceb.xceb222h = 0
            LET l_xceb.xceb222  = 0     
         END IF      
         
         LET l_xcec.xcecent = g_enterprise 
         LET l_xcec.xceccomp = g_xcea_m.xceacomp
         LET l_xcec.xcecld = g_xcea_m.xceald
         LET l_xcec.xcecdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xcec.xcec102) THEN
            CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','6') RETURNING l_success,l_xcec.xcec102
         END IF
         #20150805--mark--str--lujh
         #CALL axct901_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
         #                                                       l_xcec.xcec101,
         #                                                       l_xcec.xcec102,
         #                                                       l_xcec.xcec103,
         #                                                       l_xcec.xcec110,
         #                                                       l_xcec.xcec111,
         #                                                       l_xcec.xcec112,
         #                                                       l_xcec.xcec113,
         #                                                       l_xcec.xcec114,
         #                                                       l_xcec.xcec115,
         #                                                       l_xcec.xcec116,
         #                                                       l_xcec.xcec117,
         #                                                       l_xcec.xcec118,
         #                                                       l_xcec.xcec119,
         #                                                       l_xcec.xcec120,
         #                                                       l_xcec.xcec107,
         #                                                       l_xcec.xcec108,
         #                                                       l_xcec.xcec109,
         #                                                       l_xcec.xcec121,
         #                                                       l_xcec.xcec122,
         #                                                       l_xcec.xcec123,
         #                                                       l_xcec.xcec124,
         #                                                       l_xcec.xcec125,
         #                                                       l_xcec.xcec126,
         #                                                       l_xcec.xcec127,
         #                                                       l_xcec.xcec128,
         #                                                       l_xcec.xcec129,
         #                                                       l_xcec.xcec130 
         #20150805--mark--end--lujh      
   #如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
            CONTINUE FOREACH
         END IF      
         #      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xcec_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()
     
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
     END FOREACH 
     
   #add by zhr 160101 ------str-----      
   LET r_success1 = 'Y'
   LET l_cnt11 = 0
   LET l_cnt22 = 0
   
   SELECT COUNT(*) INTO l_cnt11 
     FROM xceb_t 
    WHERE xcebent = g_enterprise
      AND xcebld  = g_xcea_m.xceald
      AND xcebdocno=g_xcea_m.xceadocno
      
   SELECT COUNT(*) INTO l_cnt22 
     FROM xcec_t 
    WHERE xcecent = g_enterprise
      AND xcecld  = g_xcea_m.xceald
      AND xcecdocno=g_xcea_m.xceadocno      

   IF l_cnt11 = 0 AND l_cnt22 = 0 THEN
      DELETE FROM xcea_t 
       WHERE xceaent = g_enterprise
         AND xceald  = g_xcea_m.xceald
         AND xceadocno=g_xcea_m.xceadocno
   END IF
   #add by zhr 160101 ------end-----      
     
      # 产生资料成功，更新xcck中的立账状态码
      IF g_success='Y' THEN
        #C151008-004 Mark ---(S)---
        #LET l_sql = "UPDATE xcck_t SET xcckud001 = 'Y' ",
        #            " WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
        #            "   AND xcck003 = '",g_xcea_m.xcea003,"' ",
        #            "   AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
        #            "   AND xcck001 = '1' ",
        #            "   AND xcck020 IN ('201','202') ",  
        #            "   AND NVL(xcckud001,'N') = 'N' ",
        #            "   AND ",g_wc_xcck026,
        #            "   AND EXISTS(SELECT 1 FROM xceb_t ",
        #            "               WHERE xcebent = ",g_enterprise,
        #            "                 AND xcebld = '",g_xcea_m.xceald,"' ",
        #            "                 AND xcebdocno = '",g_xcea_m.xceadocno,"' ",
        #            "                 AND xceb001 = xcck006 ",
        #            "                 AND xceb002 = xcck007 ",
        #            "             ) "
        #C151008-004 Mark ---(E)---
        #C151008-004 Add  ---(S)---
         LET l_sql = "UPDATE xckd_t SET xckd019 = 'Y' ",
                     " WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
                     "   AND xckd003 = '",g_xcea_m.xcea003,"' ",
                     "   AND xckdsite= '",g_xcea_m.xceasite,"'",
                     "   AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
                     "   AND xckd001 = '1' ",
                     "   AND xckd011 IN ('201','202') ",  
                     "   AND NVL(xckd019,'N') = 'N' ",
                     #"    AND xckd007 = '",l_xceaud.xceaud001,"'   ",   #add by zhr 151231 单据类型  
                     "   AND ",ls_wc CLIPPED
        #C151008-004 Add  ---(E)---
         TRY
            EXECUTE IMMEDIATE l_sql
         CATCH
            IF SQLCA.sqlcode THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "upd xckd_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()
     
               LET g_success = 'N'
            END IF
         END TRY
      END IF

   #END FOR
 
   
  RETURN g_success
END FUNCTION
# 在制差異憑證資料產生  axct705
PRIVATE FUNCTION axct901_01_ins_5()
   DEFINE l_success       LIKE type_t.num5
   DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#   DEFINE l_xcea          RECORD LIKE xcea_t.*
#   DEFINE l_xceb          RECORD LIKE xceb_t.*
#   DEFINE l_xcec          RECORD LIKE xcec_t.*
#   DEFINE l_xccd          RECORD LIKE xccd_t.*
#   DEFINE l_xcce          RECORD LIKE xcce_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcce RECORD  #在製元件成本期異動統計檔
       xcceent LIKE xcce_t.xcceent, #企业编号
       xccecomp LIKE xcce_t.xccecomp, #法人组织
       xcceld LIKE xcce_t.xcceld, #账套
       xcce001 LIKE xcce_t.xcce001, #账套本位币顺序
       xcce002 LIKE xcce_t.xcce002, #成本域
       xcce003 LIKE xcce_t.xcce003, #成本计算类型
       xcce004 LIKE xcce_t.xcce004, #年度
       xcce005 LIKE xcce_t.xcce005, #期别
       xcce006 LIKE xcce_t.xcce006, #工单编号
       xcce007 LIKE xcce_t.xcce007, #元件编号
       xcce008 LIKE xcce_t.xcce008, #产品特征
       xcce009 LIKE xcce_t.xcce009, #批号
       xcce010 LIKE xcce_t.xcce010, #核算币种
       xcce101 LIKE xcce_t.xcce101, #上期结存数量
       xcce102 LIKE xcce_t.xcce102, #上期结存金额
       xcce102a LIKE xcce_t.xcce102a, #上期结存金额-材料
       xcce102b LIKE xcce_t.xcce102b, #上期结存金额-人工
       xcce102c LIKE xcce_t.xcce102c, #上期结存金额-加工
       xcce102d LIKE xcce_t.xcce102d, #上期结存金额-制费一
       xcce102e LIKE xcce_t.xcce102e, #上期结存金额-制费二
       xcce102f LIKE xcce_t.xcce102f, #上期结存金额-制费三
       xcce102g LIKE xcce_t.xcce102g, #上期结存金额-制费四
       xcce102h LIKE xcce_t.xcce102h, #上期结存金额-制费五
       xcce201 LIKE xcce_t.xcce201, #本期投入数量
       xcce202 LIKE xcce_t.xcce202, #本期本阶投入金额
       xcce202a LIKE xcce_t.xcce202a, #本期本阶投入金额-材料
       xcce202b LIKE xcce_t.xcce202b, #本期本阶投入金额-人工
       xcce202c LIKE xcce_t.xcce202c, #本期本阶投入金额-加工
       xcce202d LIKE xcce_t.xcce202d, #本期本阶投入金额-制费一
       xcce202e LIKE xcce_t.xcce202e, #本期本阶投入金额-制费二
       xcce202f LIKE xcce_t.xcce202f, #本期本阶投入金额-制费三
       xcce202g LIKE xcce_t.xcce202g, #本期本阶投入金额-制费四
       xcce202h LIKE xcce_t.xcce202h, #本期本阶投入金额-制费五
       xcce205 LIKE xcce_t.xcce205, #本期当站下线数量
       xcce206 LIKE xcce_t.xcce206, #本期当站下线成本
       xcce206a LIKE xcce_t.xcce206a, #本期当站下线成本-材料
       xcce206b LIKE xcce_t.xcce206b, #本期当站下线成本-人工
       xcce206c LIKE xcce_t.xcce206c, #本期当站下线成本-加工
       xcce206d LIKE xcce_t.xcce206d, #本期当站下线成本-制费一
       xcce206e LIKE xcce_t.xcce206e, #本期当站下线成本-制费二
       xcce206f LIKE xcce_t.xcce206f, #本期当站下线成本-制费三
       xcce206g LIKE xcce_t.xcce206g, #本期当站下线成本-制费四
       xcce206h LIKE xcce_t.xcce206h, #本期当站下线成本-制费五
       xcce207 LIKE xcce_t.xcce207, #本期一般退料数量
       xcce208 LIKE xcce_t.xcce208, #本期一般退料成本
       xcce208a LIKE xcce_t.xcce208a, #本期一般退料成本-材料
       xcce208b LIKE xcce_t.xcce208b, #本期一般退料成本-人工
       xcce208c LIKE xcce_t.xcce208c, #本期一般退料成本-加工
       xcce208d LIKE xcce_t.xcce208d, #本期一般退料成本-制费一
       xcce208e LIKE xcce_t.xcce208e, #本期一般退料成本-制费二
       xcce208f LIKE xcce_t.xcce208f, #本期一般退料成本-制费三
       xcce208g LIKE xcce_t.xcce208g, #本期一般退料成本-制费四
       xcce208h LIKE xcce_t.xcce208h, #本期一般退料成本-制费五
       xcce209 LIKE xcce_t.xcce209, #本期超领退数量
       xcce210 LIKE xcce_t.xcce210, #本期超领退金额
       xcce210a LIKE xcce_t.xcce210a, #本期超领退金额-材料
       xcce210b LIKE xcce_t.xcce210b, #本期超领退金额-人工
       xcce210c LIKE xcce_t.xcce210c, #本期超领退金额-加工
       xcce210d LIKE xcce_t.xcce210d, #本期超领退金额-制费一
       xcce210e LIKE xcce_t.xcce210e, #本期超领退金额-制费二
       xcce210f LIKE xcce_t.xcce210f, #本期超领退金额-制费三
       xcce210g LIKE xcce_t.xcce210g, #本期超领退金额-制费四
       xcce210h LIKE xcce_t.xcce210h, #本期超领退金额-制费五
       xcce301 LIKE xcce_t.xcce301, #本期转出数量
       xcce302 LIKE xcce_t.xcce302, #本期转出金额
       xcce302a LIKE xcce_t.xcce302a, #本期转出金额-材料
       xcce302b LIKE xcce_t.xcce302b, #本期转出金额-人工
       xcce302c LIKE xcce_t.xcce302c, #本期转出金额-加工
       xcce302d LIKE xcce_t.xcce302d, #本期转出金额-制费一
       xcce302e LIKE xcce_t.xcce302e, #本期转出金额-制费二
       xcce302f LIKE xcce_t.xcce302f, #本期转出金额-制费三
       xcce302g LIKE xcce_t.xcce302g, #本期转出金额-制费四
       xcce302h LIKE xcce_t.xcce302h, #本期转出金额-制费五
       xcce303 LIKE xcce_t.xcce303, #差异转出数量
       xcce304 LIKE xcce_t.xcce304, #差异转出金额
       xcce304a LIKE xcce_t.xcce304a, #差异转出金额-材料
       xcce304b LIKE xcce_t.xcce304b, #差异转出金额-人工
       xcce304c LIKE xcce_t.xcce304c, #差异转出金额-加工
       xcce304d LIKE xcce_t.xcce304d, #差异转出金额-制费一
       xcce304e LIKE xcce_t.xcce304e, #差异转出金额-制费二
       xcce304f LIKE xcce_t.xcce304f, #差异转出金额-制费三
       xcce304g LIKE xcce_t.xcce304g, #差异转出金额-制费四
       xcce304h LIKE xcce_t.xcce304h, #差异转出金额-制费五
       xcce307 LIKE xcce_t.xcce307, #盘差数量
       xcce308 LIKE xcce_t.xcce308, #盘差金额
       xcce308a LIKE xcce_t.xcce308a, #盘差金额-材料
       xcce308b LIKE xcce_t.xcce308b, #盘差金额-人工
       xcce308c LIKE xcce_t.xcce308c, #盘差金额-加工
       xcce308d LIKE xcce_t.xcce308d, #盘差金额-制费一
       xcce308e LIKE xcce_t.xcce308e, #盘差金额-制费二
       xcce308f LIKE xcce_t.xcce308f, #盘差金额-制费三
       xcce308g LIKE xcce_t.xcce308g, #盘差金额-制费四
       xcce308h LIKE xcce_t.xcce308h, #盘差金额-制费五
       xcce901 LIKE xcce_t.xcce901, #期末结存数量
       xcce902 LIKE xcce_t.xcce902, #期末结存金额
       xcce902a LIKE xcce_t.xcce902a, #期末结存金额-材料
       xcce902b LIKE xcce_t.xcce902b, #期末结存金额-人工
       xcce902c LIKE xcce_t.xcce902c, #期末结存金额-加工
       xcce902d LIKE xcce_t.xcce902d, #期末结存金额-制费一
       xcce902e LIKE xcce_t.xcce902e, #期末结存金额-制费二
       xcce902f LIKE xcce_t.xcce902f, #期末结存金额-制费三
       xcce902g LIKE xcce_t.xcce902g, #期末结存金额-制费四
       xcce902h LIKE xcce_t.xcce902h, #期末结存金额-制费五
       xccetime LIKE xcce_t.xccetime  #最近成本计算时间
END RECORD
DEFINE l_xccd RECORD  #在製主件成本期異動統計檔
       xccdent LIKE xccd_t.xccdent, #企业编号
       xccdcomp LIKE xccd_t.xccdcomp, #法人组织
       xccdld LIKE xccd_t.xccdld, #账套
       xccd001 LIKE xccd_t.xccd001, #账套本位币顺序
       xccd002 LIKE xccd_t.xccd002, #成本域
       xccd003 LIKE xccd_t.xccd003, #成本计算类型
       xccd004 LIKE xccd_t.xccd004, #年度
       xccd005 LIKE xccd_t.xccd005, #期别
       xccd006 LIKE xccd_t.xccd006, #工单编号
       xccd007 LIKE xccd_t.xccd007, #主件料号
       xccd008 LIKE xccd_t.xccd008, #产品特征
       xccd009 LIKE xccd_t.xccd009, #批号
       xccd010 LIKE xccd_t.xccd010, #项目号
       xccd011 LIKE xccd_t.xccd011, #核算币种
       xccd012 LIKE xccd_t.xccd012, #重复性成产否
       xccd013 LIKE xccd_t.xccd013, #成产计划号
       xccd014 LIKE xccd_t.xccd014, #BOM特性
       xccd101 LIKE xccd_t.xccd101, #上期结存数量
       xccd102 LIKE xccd_t.xccd102, #上期结存金额
       xccd102a LIKE xccd_t.xccd102a, #上期结存金额-材料
       xccd102b LIKE xccd_t.xccd102b, #上期结存金额-人工
       xccd102c LIKE xccd_t.xccd102c, #上期结存金额-加工
       xccd102d LIKE xccd_t.xccd102d, #上期结存金额-制费一
       xccd102e LIKE xccd_t.xccd102e, #上期结存金额-制费二
       xccd102f LIKE xccd_t.xccd102f, #上期结存金额-制费三
       xccd102g LIKE xccd_t.xccd102g, #上期结存金额-制费四
       xccd102h LIKE xccd_t.xccd102h, #上期结存金额-制费五
       xccd200 LIKE xccd_t.xccd200, #本期投入工时
       xccd201 LIKE xccd_t.xccd201, #本期投入数量
       xccd202 LIKE xccd_t.xccd202, #本期本阶投入金额
       xccd202a LIKE xccd_t.xccd202a, #本期本阶投入金额-材料
       xccd202b LIKE xccd_t.xccd202b, #本期本阶投入金额-人工
       xccd202c LIKE xccd_t.xccd202c, #本期本阶投入金额-加工
       xccd202d LIKE xccd_t.xccd202d, #本期本阶投入金额-制费一
       xccd202e LIKE xccd_t.xccd202e, #本期本阶投入金额-制费二
       xccd202f LIKE xccd_t.xccd202f, #本期本阶投入金额-制费三
       xccd202g LIKE xccd_t.xccd202g, #本期本阶投入金额-制费四
       xccd202h LIKE xccd_t.xccd202h, #本期本阶投入金额-制费五
       xccd204 LIKE xccd_t.xccd204, #本期下阶投入金额
       xccd204a LIKE xccd_t.xccd204a, #本期下阶投入金额-材料
       xccd204b LIKE xccd_t.xccd204b, #本期下阶投入金额-人工
       xccd204c LIKE xccd_t.xccd204c, #本期下阶投入金额-加工
       xccd204d LIKE xccd_t.xccd204d, #本期下阶投入金额-制费一
       xccd204e LIKE xccd_t.xccd204e, #本期下阶投入金额-制费二
       xccd204f LIKE xccd_t.xccd204f, #本期下阶投入金额-制费三
       xccd204g LIKE xccd_t.xccd204g, #本期下阶投入金额-制费四
       xccd204h LIKE xccd_t.xccd204h, #本期下阶投入金额-制费五
       xccd301 LIKE xccd_t.xccd301, #本期转出数量
       xccd302 LIKE xccd_t.xccd302, #本期转出金额
       xccd302a LIKE xccd_t.xccd302a, #本期转出金额-材料
       xccd302b LIKE xccd_t.xccd302b, #本期转出金额-人工
       xccd302c LIKE xccd_t.xccd302c, #本期转出金额-加工
       xccd302d LIKE xccd_t.xccd302d, #本期转出金额-制费一
       xccd302e LIKE xccd_t.xccd302e, #本期转出金额-制费二
       xccd302f LIKE xccd_t.xccd302f, #本期转出金额-制费三
       xccd302g LIKE xccd_t.xccd302g, #本期转出金额-制费四
       xccd302h LIKE xccd_t.xccd302h, #本期转出金额-制费五
       xccd303 LIKE xccd_t.xccd303, #差异转出数量
       xccd304 LIKE xccd_t.xccd304, #差异转出金额
       xccd304a LIKE xccd_t.xccd304a, #差异转出金额-材料
       xccd304b LIKE xccd_t.xccd304b, #差异转出金额-人工
       xccd304c LIKE xccd_t.xccd304c, #差异转出金额-加工
       xccd304d LIKE xccd_t.xccd304d, #差异转出金额-制费一
       xccd304e LIKE xccd_t.xccd304e, #差异转出金额-制费二
       xccd304f LIKE xccd_t.xccd304f, #差异转出金额-制费三
       xccd304g LIKE xccd_t.xccd304g, #差异转出金额-制费四
       xccd304h LIKE xccd_t.xccd304h, #差异转出金额-制费五
       xccd901 LIKE xccd_t.xccd901, #期末结存数量
       xccd902 LIKE xccd_t.xccd902, #期末结存金额
       xccd902a LIKE xccd_t.xccd902a, #期末结存金额-材料
       xccd902b LIKE xccd_t.xccd902b, #期末结存金额-人工
       xccd902c LIKE xccd_t.xccd902c, #期末结存金额-加工
       xccd902d LIKE xccd_t.xccd902d, #期末结存金额-制费一
       xccd902e LIKE xccd_t.xccd902e, #期末结存金额-制费二
       xccd902f LIKE xccd_t.xccd902f, #期末结存金额-制费三
       xccd902g LIKE xccd_t.xccd902g, #期末结存金额-制费四
       xccd902h LIKE xccd_t.xccd902h, #期末结存金额-制费五
       xccdtime LIKE xccd_t.xccdtime  #最近成本计算时间
END RECORD
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
#161124-00048#21 add(e)
   DEFINE l_sql           STRING
   DEFINE l_rate          LIKE type_t.num26_10
   DEFINE l_rate1         LIKE type_t.num26_10
   DEFINE ld_date         DATETIME YEAR TO SECOND
#   DEFINE l_xced          RECORD LIKE xced_t.*  #161124-00048#21 mark
   #161124-00048#21 add(s)
   DEFINE l_xced RECORD  #成本憑證第三單身檔(在製人工費用科目設定)
       xcedent LIKE xced_t.xcedent, #企业编号
       xcedcomp LIKE xced_t.xcedcomp, #法人组织
       xcedld LIKE xced_t.xcedld, #账套
       xceddocno LIKE xced_t.xceddocno, #单据编号
       xcedseq LIKE xced_t.xcedseq, #项次
       xced001 LIKE xced_t.xced001, #在制科目分类
       xced101 LIKE xced_t.xced101, #科目编号
       xced102 LIKE xced_t.xced102, #摘要
       xced110 LIKE xced_t.xced110, #原因码
       xced111 LIKE xced_t.xced111, #收付款客商
       xced112 LIKE xced_t.xced112, #客群
       xced113 LIKE xced_t.xced113, #区域
       xced114 LIKE xced_t.xced114, #成本中心
       xced115 LIKE xced_t.xced115, #经营类别
       xced116 LIKE xced_t.xced116, #渠道
       xced117 LIKE xced_t.xced117, #品类
       xced118 LIKE xced_t.xced118, #品牌
       xced119 LIKE xced_t.xced119, #项目编号
       xced120 LIKE xced_t.xced120, #WBS
       xced202 LIKE xced_t.xced202, #成本金额(本位币一)
       xced212 LIKE xced_t.xced212, #成本金额(本位币二)
       xced222 LIKE xced_t.xced222, #成本金额(本位币三)
       xced301 LIKE xced_t.xced301, #凭证编号
       xced302 LIKE xced_t.xced302, #凭证项次
       xced107 LIKE xced_t.xced107, #人员
       xced108 LIKE xced_t.xced108, #部门
       xced109 LIKE xced_t.xced109, #账款对象
       xced121 LIKE xced_t.xced121, #自由核算项1
       xced122 LIKE xced_t.xced122, #自由核算项2
       xced123 LIKE xced_t.xced123, #自由核算项3
       xced124 LIKE xced_t.xced124, #自由核算项4
       xced125 LIKE xced_t.xced125, #自由核算项5
       xced126 LIKE xced_t.xced126, #自由核算项6
       xced127 LIKE xced_t.xced127, #自由核算项7
       xced128 LIKE xced_t.xced128, #自由核算项8
       xced129 LIKE xced_t.xced129, #自由核算项9
       xced130 LIKE xced_t.xced130  #自由核算项10
END RECORD
   #161124-00048#21 add(e)
   DEFINE l_sfaa057       LIKE sfaa_t.sfaa057
   DEFINE l_sfaasite      LIKE sfaa_t.sfaasite

   LET g_success = 'Y'
   
   INITIALIZE l_xcea.* TO NULL
   INITIALIZE l_xceb.* TO NULL
   INITIALIZE l_xcec.* TO NULL
   INITIALIZE l_xccd.* TO NULL
   INITIALIZE l_xcce.* TO NULL
   INITIALIZE l_xced.* TO NULL
   
   
   
   #單頭
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   #第一單身：在制主件成本档(xccd_t),拆件在制主件成本档(xcch_t)
   #本位幣一
   LET l_sql = "SELECT xccd002,xccd006,xccd007,xccd008,",
               "       SUM(xccd303), SUM(xccd304), SUM(xccd304a),SUM(xccd304b),SUM(xccd304c),",
               "       SUM(xccd304d),SUM(xccd304e),SUM(xccd304f),SUM(xccd304g),SUM(xccd304h) ",
               "  FROM xccd_t ",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"'",
               "    AND xccd004 = ",g_xcea004,
               "    AND xccd005 = ",g_xcea005,
               "    AND xccd001 = '1'",
               "    AND (xccd303 <> 0 OR xccd304 <> 0)",
               " GROUP BY xccd002,xccd006,xccd007,xccd008 ",
               " UNION ",
               "SELECT xcch002,xcch006,xcch007,xcch008,",
               "       SUM(xcch303), SUM(xcch304), SUM(xcch304a),SUM(xcch304b),SUM(xcch304c),",
               "       SUM(xcch304d),SUM(xcch304e),SUM(xcch304f),SUM(xcch304g),SUM(xcch304h) ",
               "  FROM xcch_t ",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea004,
               "    AND xcch005 = ",g_xcea005,
               "    AND xcch001 = '1'",
               "    AND (xcch303 <> 0 OR xcch304 <> 0)",
               " GROUP BY xcch002,xcch006,xcch007,xcch008"
   PREPARE xccd_prep1 FROM l_sql
   DECLARE xccd_curs1 CURSOR FOR xccd_prep1
                            
   
   #本位幣二  
   LET l_sql = " SELECT SUM(xccd304), SUM(xccd304a),SUM(xccd304b),SUM(xccd304c),",
               "        SUM(xccd304d),SUM(xccd304e),SUM(xccd304f),SUM(xccd304g),SUM(xccd304h) ",
               "        FROM xccd_t ", 
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea004,
               "    AND xccd005 = ",g_xcea005,
               "    AND xccd002 = ? AND xccd006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND (xccd303 <> 0 OR xccd304 <> 0)",
               "    AND xccd001 = '2' ",
               " UNION ",
               " SELECT SUM(xcch304), SUM(xcch304a),SUM(xcch304b),SUM(xcch304c),",
               "        SUM(xcch304d),SUM(xcch304e),SUM(xcch304f),SUM(xcch304g),SUM(xcch304h) ",
               "  FROM xcch_t ",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea004,
               "    AND xcch005 = ",g_xcea005,
               "    AND xcch002 = ? AND xcch006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND (xcch303 <> 0 OR xcch304 <> 0)",
               "    AND xcch001 = '2'"
   PREPARE xccd_prep2_3 FROM l_sql
   DECLARE xccd_curs2_3 CURSOR FOR xccd_prep2_3
   
   #本位幣三
   LET l_sql = " SELECT SUM(xccd304), SUM(xccd304a),SUM(xccd304b),SUM(xccd304c),",
               "        SUM(xccd304d),SUM(xccd304e),SUM(xccd304f),SUM(xccd304g),SUM(xccd304h) ",
               "        FROM xccd_t ", 
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea004,
               "    AND xccd005 = ",g_xcea005,
               "    AND xccd002 = ? AND xccd006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND xccd001 = '3' ",
               " UNION ",
               " SELECT SUM(xcch304), SUM(xcch304a),SUM(xcch304b),SUM(xcch304c),",
               "        SUM(xcch304d),SUM(xcch304e),SUM(xcch304f),SUM(xcch304g),SUM(xcch304h) ",
               "  FROM xcch_t ",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea004,
               "    AND xcch005 = ",g_xcea005,
               "    AND xcch002 = ? AND xcch006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND (xcch303 <> 0 OR xcch304 <> 0)",
               "    AND xcch001 = '3'"
   PREPARE xccd_prep3_3 FROM l_sql
   DECLARE xccd_curs3_3 CURSOR FOR xccd_prep3_3
   
   #第二單身：在制元件成本档(xcce_t),拆件在制元件成本档(xcci_t)
   #本位幣一
   LET l_sql = "SELECT xcce002,xcce006,xcce007,xcce008,xcce009,",
               "       SUM(xcce303), SUM(xcce304), SUM(xcce304a),SUM(xcce304b),SUM(xcce304c),",
               "       SUM(xcce304d),SUM(xcce304e),SUM(xcce304f),SUM(xcce304g),SUM(xcce304h) ",
               "  FROM xcce_t ",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea004,
               "    AND xcce005 = ",g_xcea005,
               "    AND xcce001 = '1'",
               "    AND (xcce303 <> 0 OR xcce304 <> 0)",
               " GROUP BY xcce002,xcce006,xcce007,xcce008,xcce009 ",
               " UNION ",
               "SELECT xcci002,xcci006,xcci007,xcci008,xcci009,",
               "       SUM(xcci303), SUM(xcci304), SUM(xcci304a),SUM(xcci304b),SUM(xcci304c),",
               "       SUM(xcci304d),SUM(xcci304e),SUM(xcci304f),SUM(xcci304g),SUM(xcci304h) ",
               "  FROM xcci_t ",
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea004,
               "    AND xcci005 = ",g_xcea005,
               "    AND xcci001 = '1'",
               "    AND (xcci303 <> 0 OR xcci304 <> 0)",
               " GROUP BY xcci002,xcci006,xcci007,xcci008,xcci009"  
   PREPARE xccd_prep4 FROM l_sql
   DECLARE xccd_curs4 CURSOR FOR xccd_prep4
   
   #本位幣二
   LET l_sql = "SELECT SUM(xcce304), SUM(xcce304a),SUM(xcce304b),SUM(xcce304c),",
               "       SUM(xcce304d),SUM(xcce304e),SUM(xcce304f),SUM(xcce304g),SUM(xcce304h) ",
               "  FROM xcce_t ",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea004,
               "    AND xcce005 = ",g_xcea005,
               "    AND xcce002 = ? AND xcce006 = ? AND xcce007 = ? AND xcce008 = ? ",
               "    AND xcce009 = ?  ",
               "    AND (xcce303 <> 0 OR xcce304 <> 0)",
               "    AND xcce001 = '2'",
               " UNION ",
               "SELECT SUM(xcci304), SUM(xcci304a),SUM(xcci304b),SUM(xcci304c),",
               "       SUM(xcci304d),SUM(xcci304e),SUM(xcci304f),SUM(xcci304g),SUM(xcci304h) ",
               "  FROM xcci_t ",
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea004,
               "    AND xcci005 = ",g_xcea005,
               "    AND xcci002 = ? AND xcci006 = ? AND xcci007 = ? ",
               "    AND xcci008 = ?  AND xcci009 = ? ",
               "    AND (xcci303 <> 0 OR xcci304 <> 0)",
               "    AND xcci001 = '2'"
   PREPARE xccd_prep5 FROM l_sql
   DECLARE xccd_curs5 CURSOR FOR xccd_prep5
   
   #本位幣三
   LET l_sql = "SELECT SUM(xcce304), SUM(xcce304a),SUM(xcce304b),SUM(xcce304c),",
               "       SUM(xcce304d),SUM(xcce304e),SUM(xcce304f),SUM(xcce304g),SUM(xcce304h) ",
               "  FROM xcce_t ",
               " WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "   AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea004,
               "   AND xcce005 = ",g_xcea005,
               "   AND xcce002 = ? AND xcce006 = ? AND xcce007 = ? ",
               "   AND xcce008 = ? AND xcce009 = ?  ",
               "    AND (xcce303 <> 0 OR xcce304 <> 0)",
               "   AND xcce001 = '3'",
               " UNION ",
               "SELECT SUM(xcci304), SUM(xcci304a),SUM(xcci304b),SUM(xcci304c),",
               "       SUM(xcci304d),SUM(xcci304e),SUM(xcci304f),SUM(xcci304g),SUM(xcci304h) ",
               "  FROM xcci_t ",
               " WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "   AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea004,
               "   AND xcci005 = ",g_xcea005,
               "   AND xcci002 = ? AND xcci006 = ? AND xcci007 = ? ",
               "   AND xcci008 = ? AND xcci009 = ?  ",
               "    AND (xcci303 <> 0 OR xcci304 <> 0)",
               "   AND xcci001 = '3'"
   PREPARE xccd_prep6 FROM l_sql
   DECLARE xccd_curs6 CURSOR FOR xccd_prep6
   
#   #第三單身
#   #xcec_t中DL+OH_SUB元件彙總-xced   
#   LET l_sql = " SELECT xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120,",
#               "        SUM(xcec202b),SUM(xcec202c),SUM(xcec202d),SUM(xcec202e),",
#               "        SUM(xcec202f),SUM(xcec202g),SUM(xcec202h), ",
#               "        SUM(xcec212b),SUM(xcec212c),SUM(xcec212d),SUM(xcec212e),",
#               "        SUM(xcec212f),SUM(xcec212g),SUM(xcec212h), ",
#               "        SUM(xcec222b),SUM(xcec222c),SUM(xcec222d),SUM(xcec222e),",
#               "        SUM(xcec222f),SUM(xcec222g),SUM(xcec222h) ",
#               "   FROM xcec_t",
#               "  WHERE xcecent = '",g_enterprise,"' AND xcecld = '",g_xcea_m.xceald,"'",
#               "    AND xcecdocno = '",g_xcea_m.xceadocno,"'", 
#               "    AND xcec004 = 'DL+OH+SUB' ",
#               "  GROUP BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 ",
#               "  ORDER BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 "
#   PREPARE xcec_prep_3 FROM l_sql
#   DECLARE xcec_curs_3 CURSOR FOR xcec_prep_3
   
   
   #第一單身
   FOREACH xccd_curs1 INTO l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008,
                           l_xccd.xccd303, l_xccd.xccd304, l_xccd.xccd304a,l_xccd.xccd304b,l_xccd.xccd304c,
                           l_xccd.xccd304d,l_xccd.xccd304e,l_xccd.xccd304f,l_xccd.xccd304g,l_xccd.xccd304h

      INITIALIZE l_xceb.* TO NULL
      
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 
      
      #工單類型   廠內/委外
      LET l_sfaa057 = ''
      LET l_sfaasite = ''
      SELECT sfaa003,sfaa057,sfaa009,sfaasite,sfaa028,sfaa029 INTO l_xceb.xceb003,l_sfaa057,l_xceb.xceb111,l_sfaasite,l_xceb.xceb119,l_xceb.xceb120
        FROM sfaa_t WHERE sfaaent = g_enterprise AND sfaadocno = l_xccd.xccd006
      
      #生产成本-差异科目
#目前没有，先空着   #wujie 150214
      LET l_xceb.xceb101 = ''

      IF cl_null(l_xceb.xceb101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','4') RETURNING l_success,l_xceb.xceb101,l_errno
      END IF
      
      IF l_sfaa057 = '2' THEN   #委外
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
         
         
      ELSE   #廠內
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 
      
      #品類
      SELECT imag011 INTO l_xceb.xceb117 
        FROM imag_t 
       WHERE imagent = g_enterprise 
         AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xccd.xccd007
      
      LET l_xceb.xcebent   = g_enterprise
      LET l_xceb.xcebcomp  = g_xcea_m.xceacomp
      LET l_xceb.xcebld    = g_xcea_m.xceald     
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      LET l_xceb.xceb001   = l_xccd.xccd006 
      LET l_xceb.xceb002   = ''
      LET l_xceb.xceb004   = l_xccd.xccd007 
      LET l_xceb.xceb005   = l_xccd.xccd008      
      LET l_xceb.xceb102   = '' 
      LET l_xceb.xceb102   = ''
      LET l_xceb.xceb103   = l_xccd.xccd002
      LET l_xceb.xceb110   = ''
      LET l_xceb.xceb114   = ''
      LET l_xceb.xceb115   = ' '
      LET l_xceb.xceb116   = ' '  
      LET l_xceb.xceb118   = ' '
      LET l_xceb.xceb201   = l_xccd.xccd303
      LET l_xceb.xceb202   = l_xccd.xccd304
      LET l_xceb.xceb202a  = l_xccd.xccd304a
      LET l_xceb.xceb202b  = l_xccd.xccd304b
      LET l_xceb.xceb202c  = l_xccd.xccd304c
      LET l_xceb.xceb202d  = l_xccd.xccd304d
      LET l_xceb.xceb202e  = l_xccd.xccd304e
      LET l_xceb.xceb202f  = l_xccd.xccd304f
      LET l_xceb.xceb202g  = l_xccd.xccd304g
      LET l_xceb.xceb202h  = l_xccd.xccd304h
      LET l_xceb.xceb301   = ''
      LET l_xceb.xceb302   = ''
      
      
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF      
      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF        

#小于0的要变成正数
      #mark--2015/11/10 By shiun--(S)
#      IF l_xceb.xceb202a < 0 THEN LET l_xceb.xceb202a = l_xceb.xceb202a * -1 END IF
#      IF l_xceb.xceb202b < 0 THEN LET l_xceb.xceb202b = l_xceb.xceb202b * -1 END IF
#      IF l_xceb.xceb202c < 0 THEN LET l_xceb.xceb202c = l_xceb.xceb202c * -1 END IF
#      IF l_xceb.xceb202d < 0 THEN LET l_xceb.xceb202d = l_xceb.xceb202d * -1 END IF
#      IF l_xceb.xceb202e < 0 THEN LET l_xceb.xceb202e = l_xceb.xceb202e * -1 END IF
#      IF l_xceb.xceb202f < 0 THEN LET l_xceb.xceb202f = l_xceb.xceb202f * -1 END IF
#      IF l_xceb.xceb202g < 0 THEN LET l_xceb.xceb202g = l_xceb.xceb202g * -1 END IF
#      IF l_xceb.xceb202h < 0 THEN LET l_xceb.xceb202h = l_xceb.xceb202h * -1 END IF
#      IF l_xceb.xceb202  < 0 THEN LET l_xceb.xceb202  = l_xceb.xceb202  * -1 END IF      
#      IF l_xceb.xceb201  < 0 THEN LET l_xceb.xceb201  = l_xceb.xceb201  * -1 END IF 
      #mark--2015/11/10 By shiun--(E)
      IF g_glaa015 = 'Y' THEN 
         OPEN xccd_curs2_3 USING  l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008,
                                  l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008         
         FETCH xccd_curs2_3 INTO l_xceb.xceb212, l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,
                               l_xceb.xceb212d,l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
        #EXECUTE xccd_curs2 USING l_xceb.xceb103,l_xceb.xceb001,l_xceb.xceb103,l_xceb.xceb001 
        #                    INTO l_xceb.xceb212, l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,
        #                         l_xceb.xceb212d,l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

#小于0的要变成正数
      IF l_xceb.xceb212a < 0 THEN LET l_xceb.xceb212a = l_xceb.xceb212a * -1 END IF
      IF l_xceb.xceb212b < 0 THEN LET l_xceb.xceb212b = l_xceb.xceb212b * -1 END IF
      IF l_xceb.xceb212c < 0 THEN LET l_xceb.xceb212c = l_xceb.xceb212c * -1 END IF
      IF l_xceb.xceb212d < 0 THEN LET l_xceb.xceb212d = l_xceb.xceb212d * -1 END IF
      IF l_xceb.xceb212e < 0 THEN LET l_xceb.xceb212e = l_xceb.xceb212e * -1 END IF
      IF l_xceb.xceb212f < 0 THEN LET l_xceb.xceb212f = l_xceb.xceb212f * -1 END IF
      IF l_xceb.xceb212g < 0 THEN LET l_xceb.xceb212g = l_xceb.xceb212g * -1 END IF
      IF l_xceb.xceb212h < 0 THEN LET l_xceb.xceb212h = l_xceb.xceb212h * -1 END IF
      IF l_xceb.xceb212  < 0 THEN LET l_xceb.xceb212  = l_xceb.xceb212  * -1 END IF      
      
      IF g_glaa019 = 'Y' THEN 
         OPEN xccd_curs3_3 USING l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008,
                                 l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008
         FETCH xccd_curs3_3 INTO l_xceb.xceb222, l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,
                               l_xceb.xceb222d,l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #EXECUTE xccd_curs3 USING l_xceb.xceb103,l_xceb.xceb001,l_xceb.xceb103,l_xceb.xceb001 
         #                    INTO l_xceb.xceb222, l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,
         #                         l_xceb.xceb222d,l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF 

#小于0的要变成正数
      IF l_xceb.xceb222a < 0 THEN LET l_xceb.xceb222a = l_xceb.xceb222a * -1 END IF
      IF l_xceb.xceb222b < 0 THEN LET l_xceb.xceb222b = l_xceb.xceb222b * -1 END IF
      IF l_xceb.xceb222c < 0 THEN LET l_xceb.xceb222c = l_xceb.xceb222c * -1 END IF
      IF l_xceb.xceb222d < 0 THEN LET l_xceb.xceb222d = l_xceb.xceb222d * -1 END IF
      IF l_xceb.xceb222e < 0 THEN LET l_xceb.xceb222e = l_xceb.xceb222e * -1 END IF
      IF l_xceb.xceb222f < 0 THEN LET l_xceb.xceb222f = l_xceb.xceb222f * -1 END IF
      IF l_xceb.xceb222g < 0 THEN LET l_xceb.xceb222g = l_xceb.xceb222g * -1 END IF
      IF l_xceb.xceb222h < 0 THEN LET l_xceb.xceb222h = l_xceb.xceb222h * -1 END IF
      IF l_xceb.xceb222  < 0 THEN LET l_xceb.xceb222  = l_xceb.xceb222  * -1 END IF
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','5') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF
      #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = SQLCA.sqlcode
        LET g_errparam.extend = "l_xceb"
        LET g_errparam.popup = TRUE
        CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
                           
   END FOREACH
   
   
   #第二單身
   FOREACH xccd_curs4 INTO l_xcce.xcce002, l_xcce.xcce006, l_xcce.xcce007, l_xcce.xcce008,l_xcce.xcce009, 
                           l_xcce.xcce303, l_xcce.xcce304, l_xcce.xcce304a,l_xcce.xcce304b,l_xcce.xcce304c,
                           l_xcce.xcce304d,l_xcce.xcce304e,l_xcce.xcce304f,l_xcce.xcce304g,l_xcce.xcce304h

      INITIALIZE l_xcec.* TO NULL

      LET l_xcec.xcecent   = g_enterprise
      LET l_xcec.xceccomp  = g_xcea_m.xceacomp
      LET l_xcec.xcecld    = g_xcea_m.xceald     
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      LET l_xcec.xcec001   = l_xcce.xcce006
      LET l_xcec.xcec002   = ''
      LET l_xcec.xcec004   = l_xcce.xcce007 
      LET l_xcec.xcec005   = l_xcce.xcce008       
      LET l_xcec.xcec102   = '' 
      LET l_xcec.xcec102   = ''
      LET l_xcec.xcec103   = l_xcce.xcce002
      LET l_xcec.xcec110   = ''
      LET l_xcec.xcec114   = ''
      LET l_xcec.xcec115   = ' '
      LET l_xcec.xcec116   = ' '  
      LET l_xcec.xcec118   = ' '
      LET l_xcec.xcec201   = l_xcce.xcce303
      LET l_xcec.xcec202   = l_xcce.xcce304
      LET l_xcec.xcec202a  = l_xcce.xcce304a
      LET l_xcec.xcec202b  = l_xcce.xcce304b
      LET l_xcec.xcec202c  = l_xcce.xcce304c
      LET l_xcec.xcec202d  = l_xcce.xcce304d
      LET l_xcec.xcec202e  = l_xcce.xcce304e
      LET l_xcec.xcec202f  = l_xcce.xcce304f
      LET l_xcec.xcec202g  = l_xcce.xcce304g
      LET l_xcec.xcec202h  = l_xcce.xcce304h
      LET l_xcec.xcec301   = ''
      LET l_xcec.xcec302   = ''

      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型   廠內/委外
      LET l_sfaa057 = ''
      LET l_sfaasite = ''
      SELECT sfaa003,sfaa057,sfaa009,sfaasite,sfaa028,sfaa029 INTO l_xcec.xcec003,l_sfaa057,l_xcec.xcec111,l_sfaasite,l_xcec.xcec119,l_xcec.xcec120
        FROM sfaa_t WHERE sfaaent = g_enterprise AND sfaadocno = l_xcce.xcce006
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xcec.xcec101

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      
      IF l_sfaa057 = '2' THEN   #委外
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
         
         
      ELSE   #廠內
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 
      
      #品類
      SELECT imag011 INTO l_xcec.xcec117 
        FROM imag_t 
       WHERE imagent = g_enterprise 
         AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xcce.xcce007
            
      
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF   
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF

#小于0的要变成正数
      #mark--2015/11/10 By shiun--(S)
#      IF l_xcec.xcec202a < 0 THEN LET l_xcec.xcec202a = l_xcec.xcec202a * -1 END IF
#      IF l_xcec.xcec202b < 0 THEN LET l_xcec.xcec202b = l_xcec.xcec202b * -1 END IF
#      IF l_xcec.xcec202c < 0 THEN LET l_xcec.xcec202c = l_xcec.xcec202c * -1 END IF
#      IF l_xcec.xcec202d < 0 THEN LET l_xcec.xcec202d = l_xcec.xcec202d * -1 END IF
#      IF l_xcec.xcec202e < 0 THEN LET l_xcec.xcec202e = l_xcec.xcec202e * -1 END IF
#      IF l_xcec.xcec202f < 0 THEN LET l_xcec.xcec202f = l_xcec.xcec202f * -1 END IF
#      IF l_xcec.xcec202g < 0 THEN LET l_xcec.xcec202g = l_xcec.xcec202g * -1 END IF
#      IF l_xcec.xcec202h < 0 THEN LET l_xcec.xcec202h = l_xcec.xcec202h * -1 END IF
#      IF l_xcec.xcec202  < 0 THEN LET l_xcec.xcec202  = l_xcec.xcec202  * -1 END IF      
#      IF l_xcec.xcec201  < 0 THEN LET l_xcec.xcec201  = l_xcec.xcec201  * -1 END IF 
      #mark--2015/11/10 By shiun--(E)
      IF g_glaa015 = 'Y' THEN 
         OPEN xccd_curs5 USING  l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009,
                                l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009
         FETCH xccd_curs5 INTO l_xcec.xcec212, l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,
                               l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         #EXECUTE xccd_curs5 USING l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008,
         #                         l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008
         #                    INTO l_xcec.xcec212, l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,
         #                         l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF  
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

#小于0的要变成正数
      IF l_xcec.xcec212a < 0 THEN LET l_xcec.xcec212a = l_xcec.xcec212a * -1 END IF
      IF l_xcec.xcec212b < 0 THEN LET l_xcec.xcec212b = l_xcec.xcec212b * -1 END IF
      IF l_xcec.xcec212c < 0 THEN LET l_xcec.xcec212c = l_xcec.xcec212c * -1 END IF
      IF l_xcec.xcec212d < 0 THEN LET l_xcec.xcec212d = l_xcec.xcec212d * -1 END IF
      IF l_xcec.xcec212e < 0 THEN LET l_xcec.xcec212e = l_xcec.xcec212e * -1 END IF
      IF l_xcec.xcec212f < 0 THEN LET l_xcec.xcec212f = l_xcec.xcec212f * -1 END IF
      IF l_xcec.xcec212g < 0 THEN LET l_xcec.xcec212g = l_xcec.xcec212g * -1 END IF
      IF l_xcec.xcec212h < 0 THEN LET l_xcec.xcec212h = l_xcec.xcec212h * -1 END IF
      IF l_xcec.xcec212  < 0 THEN LET l_xcec.xcec212  = l_xcec.xcec212  * -1 END IF       
      
      IF g_glaa019 = 'Y' THEN 
         OPEN xccd_curs6 USING  l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009,
                                l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009
         FETCH xccd_curs6 INTO l_xcec.xcec222, l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,
                               l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         #EXECUTE xccd_curs6 USING l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008,
         #                         l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008       
         #                    INTO l_xcec.xcec222, l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,
         #                         l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF  
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF 

#小于0的要变成正数
      IF l_xcec.xcec222a < 0 THEN LET l_xcec.xcec222a = l_xcec.xcec222a * -1 END IF
      IF l_xcec.xcec222b < 0 THEN LET l_xcec.xcec222b = l_xcec.xcec222b * -1 END IF
      IF l_xcec.xcec222c < 0 THEN LET l_xcec.xcec222c = l_xcec.xcec222c * -1 END IF
      IF l_xcec.xcec222d < 0 THEN LET l_xcec.xcec222d = l_xcec.xcec222d * -1 END IF
      IF l_xcec.xcec222e < 0 THEN LET l_xcec.xcec222e = l_xcec.xcec222e * -1 END IF
      IF l_xcec.xcec222f < 0 THEN LET l_xcec.xcec222f = l_xcec.xcec222f * -1 END IF
      IF l_xcec.xcec222g < 0 THEN LET l_xcec.xcec222g = l_xcec.xcec222g * -1 END IF
      IF l_xcec.xcec222h < 0 THEN LET l_xcec.xcec222h = l_xcec.xcec222h * -1 END IF
      IF l_xcec.xcec222  < 0 THEN LET l_xcec.xcec222  = l_xcec.xcec222  * -1 END IF      
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','5') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
      #                                                       l_xcec.xcec101,
      #                                                       l_xcec.xcec102,
      #                                                       l_xcec.xcec103,
      #                                                       l_xcec.xcec110,
      #                                                       l_xcec.xcec111,
      #                                                       l_xcec.xcec112,
      #                                                       l_xcec.xcec113,
      #                                                       l_xcec.xcec114,
      #                                                       l_xcec.xcec115,
      #                                                       l_xcec.xcec116,
      #                                                       l_xcec.xcec117,
      #                                                       l_xcec.xcec118,
      #                                                       l_xcec.xcec119,
      #                                                       l_xcec.xcec120,
      #                                                       l_xcec.xcec107,
      #                                                       l_xcec.xcec108,
      #                                                       l_xcec.xcec109,
      #                                                       l_xcec.xcec121,
      #                                                       l_xcec.xcec122,
      #                                                       l_xcec.xcec123,
      #                                                       l_xcec.xcec124,
      #                                                       l_xcec.xcec125,
      #                                                       l_xcec.xcec126,
      #                                                       l_xcec.xcec127,
      #                                                       l_xcec.xcec128,
      #                                                       l_xcec.xcec129,
      #                                                       l_xcec.xcec130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF
     #      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = SQLCA.sqlcode
        LET g_errparam.extend = "l_xcec"
        LET g_errparam.popup = TRUE
        CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
                           
   END FOREACH
   
   #第三單身
   CALL axct901_01_ins_xced() RETURNING l_success
   IF NOT l_success THEN LET g_success = 'N' END IF 
   
   RETURN g_success
END FUNCTION

################################################################################
# Descriptions...: 组合sql
# Memo...........:
# Usage..........: CALL axct901_01_mark_sql(p_xcck022,p_xcck023,p_xcck024,p_xcck025,p_xcck026,p_xcck027,p_xcck028,p_xcck029,p_xcck030,p_xcck031)
#                  RETURNING r_str
# Input parameter: p_xcck021 原因碼
#                : p_xcck022,p_xcck023,p_xcck024,p_xcck025,p_xcck026,p_xcck027,p_xcck028,p_xcck029,p_xcck030,p_xcck031 核算项
# Return code....: r_str          sql语句
# Date & Author..: 2014/06/04 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_mark_sql(p_xcck021,p_xcck022,p_xcck023,p_xcck024,p_xcck025,p_xcck026,p_xcck027,p_xcck028,p_xcck029,p_xcck030,p_xcck031)
   DEFINE p_xcck021      LIKE xcck_t.xcck021
   DEFINE p_xcck022      LIKE xcck_t.xcck022
   DEFINE p_xcck023      LIKE xcck_t.xcck023
   DEFINE p_xcck024      LIKE xcck_t.xcck024
   DEFINE p_xcck025      LIKE xcck_t.xcck025
   DEFINE p_xcck026      LIKE xcck_t.xcck026
   DEFINE p_xcck027      LIKE xcck_t.xcck027
   DEFINE p_xcck028      LIKE xcck_t.xcck028
   DEFINE p_xcck029      LIKE xcck_t.xcck029
   DEFINE p_xcck030      LIKE xcck_t.xcck030
   DEFINE p_xcck031      LIKE xcck_t.xcck031
   DEFINE r_str          STRING
   
   LET r_str=""
   #原因碼
   IF p_xcck021 IS NULL THEN
      LET r_str=r_str," AND xcck021 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck021 = '",p_xcck021,"'"
   END IF
   #交易對象
   IF p_xcck022 IS NULL THEN
      LET r_str=r_str," AND xcck022 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck022 = '",p_xcck022,"'"
   END IF
   #客群
   IF p_xcck023 IS NULL THEN
      LET r_str=r_str," AND xcck023 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck023 = '",p_xcck023,"'"
   END IF
   #區域
   IF p_xcck024 IS NULL THEN
      LET r_str=r_str," AND xcck024 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck024 = '",p_xcck024,"'"
   END IF
   #成本中心
   IF p_xcck025 IS NULL THEN
      LET r_str=r_str," AND xcck025 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck025 = '",p_xcck025,"'"
   END IF
   #經營類別
   IF p_xcck026 IS NULL THEN
      LET r_str=r_str," AND xcck026 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck026 = '",p_xcck026,"'"
   END IF
   #渠道
   IF p_xcck027 IS NULL THEN
      LET r_str=r_str," AND xcck027 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck027 = '",p_xcck027,"'"
   END IF
   #品類
   IF p_xcck028 IS NULL THEN
      LET r_str=r_str," AND xcck028 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck028 = '",p_xcck028,"'"
   END IF
   #品牌
   IF p_xcck029 IS NULL THEN
      LET r_str=r_str," AND xcck029 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck029 = '",p_xcck029,"'"
   END IF
   #項目編號
   IF p_xcck030 IS NULL THEN
      LET r_str=r_str," AND xcck030 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck030 = '",p_xcck030,"'"
   END IF
   #WBS編號
   IF p_xcck031 IS NULL THEN
      LET r_str=r_str," AND xcck031 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck031 = '",p_xcck031,"'"
   END IF
   RETURN r_str
END FUNCTION

################################################################################
# Descriptions...: 批次產生檢查
# Memo...........:
# Usage..........: CALL axct901_01_check(p_xcea002)
# Input parameter:  
# Date & Author..: 2014/08/28 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_check(p_xcea002)
DEFINE l_cnt     LIKE type_t.num5
DEFINE l_cnt1    LIKE type_t.num5
DEFINE l_xceadocno  LIKE xcea_t.xceadocno
DEFINE r_success    LIKE type_t.num5
DEFINE p_xcea002    LIKE xcea_t.xcea002
DEFINE l_success    LIKE type_t.num5
DEFINE l_glaa121    LIKE glaa_t.glaa121
DEFINE l_xcea001    LIKE xcea_t.xcea001

   LET r_success = TRUE
   
   # 4/6/7 允许产生多张单据
   IF p_xcea002 MATCHES '[467]' THEN
      RETURN r_success
   END IF

   #檢查是否存在xcea_t中,根據帳套、成本類型、年度、期別、凭证类型
   #1.狀態已確認--提示，不做處理
   LET l_cnt = 0 
   SELECT COUNT(*) INTO l_cnt FROM xcea_t
    WHERE xceaent = g_enterprise
      AND xceald = g_xcea_m.xceald
      AND xcea003 = g_xcea_m.xcea003
      AND xcea004 = g_xcea004
      AND xcea005 = g_xcea005
      AND xcea002 = p_xcea002
      AND xceastus = 'Y'
      AND xceasite = g_xcea_m.xceasite #add by zhr 160114 
    
   #若存在已审核的资料，则提示    
   IF l_cnt > 0 THEN 
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = ""
      LET g_errparam.code = "afa-00185"
      LET g_errparam.popup = FALSE
      CALL cl_err()
      LET r_success = FALSE
   END IF   
      
   #2.狀態未確認--刪除xcea\xceb\xcec資料，重新產生   
   LET l_cnt1 = 0 
   SELECT COUNT(*) INTO l_cnt1 FROM xcea_t
    WHERE xceaent = g_enterprise
      AND xceald = g_xcea_m.xceald
      AND xcea003 = g_xcea_m.xcea003
      AND xcea004 = g_xcea004
      AND xcea005 = g_xcea005
      AND xcea002 = p_xcea002
      AND xceastus = 'N'
      AND xceasite = g_xcea_m.xceasite
    
   #若存在已审核的资料，则提示    
   IF l_cnt1 > 0 THEN 
      IF cl_ask_confirm('afa-00186') THEN   #是，删除资料新增
         LET r_success = TRUE
         
         
         #获取单据编号
         DECLARE axct901_01_sel_xcea_cs CURSOR FOR
         SELECT DISTINCT xceadocno,xcea001 FROM xcea_t
          WHERE xceaent = g_enterprise
            AND xceald  = g_xcea_m.xceald
            AND xcea003 = g_xcea_m.xcea003
            AND xcea004 = g_xcea004
            AND xcea005 = g_xcea005
            AND xcea002 = p_xcea002
            AND xceastus = 'N'
         FOREACH axct901_01_sel_xcea_cs INTO l_xceadocno,l_xcea001
            #单头
            DELETE FROM xcea_t    
             WHERE xceaent = g_enterprise
               AND xceald = g_xcea_m.xceald
               AND xceadocno = l_xceadocno
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xcea" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
              LET r_success = FALSE
           END IF        
           
           IF NOT s_aooi200_fin_del_docno(g_xcea_m.xceald,l_xceadocno,l_xcea001) THEN LET r_success = FALSE RETURN r_success END IF   #wujie 150214          
           CALL s_ld_sel_glaa(g_xcea_m.xceald,'glaa121') RETURNING  l_success,l_glaa121
           IF l_glaa121 = 'Y' THEN
              CALL s_pre_voucher_del('XC','C10',g_xcea_m.xceald,l_xceadocno) RETURNING r_success
              IF NOT r_success THEN
                 RETURN r_success
              END IF
           END IF
           
           #单身一
           DELETE FROM xceb_t    
            WHERE xcebent = g_enterprise
              AND xcebld = g_xcea_m.xceald
              AND xcebdocno = l_xceadocno
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xceb" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
              LET r_success = FALSE
           END IF   
           
           #单身二
           DELETE FROM xcec_t    
            WHERE xcecent = g_enterprise
              AND xcecld = g_xcea_m.xceald
              AND xcecdocno = l_xceadocno
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xcec" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
              LET r_success = FALSE
           END IF 
           
           #单身三
           DELETE FROM xced_t    
            WHERE xcedent = g_enterprise
              AND xcedld = g_xcea_m.xceald
              AND xceddocno = l_xceadocno
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xced" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
              LET r_success = FALSE
           END IF 
        END FOREACH
        
      ELSE
        LET r_success = FALSE
      END IF       
   END IF    

   RETURN r_success
END FUNCTION

################################################################################
# Descriptions...: axct709批次产生   13.制費結轉傳票
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_9()
   DEFINE l_success       LIKE type_t.num5
   DEFINE l_errno         LIKE gzze_t.gzze001
#   DEFINE l_xcea          RECORD LIKE xcea_t.*  #161124-00048#21 mark
#   DEFINE l_xceb          RECORD LIKE xceb_t.*  #161124-00048#21 mark
#   DEFINE l_xcec          RECORD LIKE xcec_t.*  #161124-00048#21 mark
   #161124-00048#21 add(s)
   DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
   #161124-00048#21 add(e)
   DEFINE ld_date         DATETIME YEAR TO SECOND
   DEFINE l_sfaa057       LIKE sfaa_t.sfaa057
   DEFINE l_flag          LIKE type_t.num5
   DEFINE l_sfaasite      LIKE sfaa_t.sfaasite
   DEFINE l_sfaa010       LIKE sfaa_t.sfaa010

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
   RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xceadocno,xcea001,xcea002,xcea003,xcea004, 
                       xcea005,xcea006,xcea007,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,
                       xceacrtdt, xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xceadocno,g_xcea_m.xcea001,g_xcea002,
           g_xcea_m.xcea003,g_xcea004,g_xcea005,g_xcea_m.xcea006,g_xcea_m.xcea007, 
           'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
           l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "ins xcea_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   

   LET g_sql = " SELECT xcbl001,xcbl010,xcbl019,xcbl020,xcbl016,xcbl017,xcbl018,",
               "        xcbl021,xcbl022,xcbl013,xcbl014,xcbl015,xcbl012,",  
               "        SUM(xcbl100),SUM(xcbl110),SUM(xcbl120) ",
               "   FROM xcbl_t ",  
               "  WHERE xcblent  = '",g_enterprise,"'",
               "    AND xcblcomp = '",g_xcea_m.xceacomp,"'",
               "    AND xcblld   = '",g_xcea_m.xceald,"'",
#               "    AND xcbl001 <> '1' ",
               "    AND xcbl002  = '",g_xcea004,"'",
               "    AND xcbl003  = '",g_xcea005,"'",
               "  GROUP BY xcbl001,xcbl010,xcbl019,xcbl020,xcbl016,xcbl017,xcbl018,xcbl021,xcbl022,xcbl013,xcbl014,xcbl015,xcbl012,xcbl024,xcbl025"  #151208-00020#2 add xcbl024,xcbl025

   PREPARE axct901_01_xcbl_pr FROM g_sql
   DECLARE axct901_01_xcbl_cs CURSOR FOR axct901_01_xcbl_pr

   LET g_sql = " SELECT xcbk006,xcbk007,SUM(xcbk202),SUM(xcbk212),SUM(xcbk222) ",
               "   FROM xcbk_t ",
               "  WHERE xcbkent  = '",g_enterprise,"'",
               "    AND xcbkcomp = '",g_xcea_m.xceacomp,"'",
               "    AND xcbkld   = '",g_xcea_m.xceald,"'",
               "    AND xcbk001  = '",g_xcea_m.xcea003,"'",
               "    AND xcbk002  = '",g_xcea004,"'",
               "    AND xcbk003  = '",g_xcea005,"'",
#               "    AND xcbk005 <> '1' ",
               "  GROUP BY xcbk006,xcbk007 ",
               "  ORDER BY xcbk006,xcbk007 "
 
   PREPARE axct901_01_xcbk_pr FROM g_sql
   DECLARE axct901_01_xcbk_cs CURSOR FOR axct901_01_xcbk_pr 
   LET l_flag = FALSE                                              
   FOREACH axct901_01_xcbl_cs INTO l_xceb.xceb003,l_xceb.xceb101,l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                                   l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb108,
                                   l_xceb.xceb202,l_xceb.xceb212,l_xceb.xceb222

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF
            
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 

      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201 = 0  END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF     
       
      
      IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212=0  END IF
      IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a=0 END IF
      IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b=0 END IF
      IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c=0 END IF
      IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d=0 END IF
      IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e=0 END IF
      IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f=0 END IF
      IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g=0 END IF
      IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h=0 END IF
      

      IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222=0  END IF
      IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a=0 END IF
      IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b=0 END IF
      IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c=0 END IF
      IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d=0 END IF
      IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e=0 END IF
      IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f=0 END IF
      IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g=0 END IF
      IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h=0 END IF
      
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','9') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130      
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF      
      #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF   
      LET l_flag = TRUE
   END FOREACH  

   IF NOT l_flag THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'axc-00400'
      LET g_errparam.extend = ""
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success   
   END IF
   LET l_flag = FALSE
   FOREACH axct901_01_xcbk_cs INTO l_xcec.xcec001,l_xcec.xcec003,l_xcec.xcec202,l_xcec.xcec212,l_xcec.xcec222
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 
      
      LET l_xcec.xcec101 = NULL
      LET l_xcec.xcec102 = NULL
      LET l_xcec.xcec110 = NULL
      LET l_xcec.xcec111 = NULL
      LET l_xcec.xcec112 = NULL
      LET l_xcec.xcec113 = NULL
      LET l_xcec.xcec114 = NULL
      LET l_xcec.xcec115 = ' '
      LET l_xcec.xcec116 = ' '
      LET l_xcec.xcec117 = NULL
      LET l_xcec.xcec118 = ' '
      LET l_xcec.xcec119 = NULL
      LET l_xcec.xcec120 = NULL
      
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201=0 END IF
      
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202=0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a=0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b=0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c=0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d=0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e=0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f=0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g=0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h=0 END IF


      IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212=0 END IF
      IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a=0 END IF
      IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b=0 END IF
      IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c=0 END IF
      IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d=0 END IF
      IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e=0 END IF
      IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f=0 END IF
      IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g=0 END IF
      IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h=0 END IF


      IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222=0 END IF
      IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a=0 END IF
      IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b=0 END IF
      IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c=0 END IF
      IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d=0 END IF
      IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e=0 END IF
      IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f=0 END IF
      IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g=0 END IF
      IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h=0 END IF
            
#廠內/委外      #項目編號/WBS
      LET l_sfaa057 = ''
      LET l_sfaasite =''
      LET l_sfaa010  = ''
      SELECT sfaa010,sfaa068,sfaa028,sfaa029,sfaa057,sfaasite,sfaa009,sfaa029 INTO l_sfaa010,l_xcec.xcec114,l_xcec.xcec119,l_xcec.xcec120,l_sfaa057,l_sfaasite,l_xcec.xcec111,l_xcec.xcec120
        FROM sfaa_t WHERE sfaaent = g_enterprise AND sfaadocno = l_xcec.xcec001

#成本科目
      CALL s_get_item_acc(g_xcea_m.xceald,'11',l_sfaa010,'','',g_xcea_m.xceacomp,'') 
           RETURNING l_success,l_xcec.xcec101

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','3') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      
      IF l_sfaa057 = '2' THEN   #委外
         #客群/區域
         SELECT pmaa002,pmaa005 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
         
         
      ELSE   #廠內
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 
      
      #品類
      SELECT imag011 INTO l_xcec.xcec117 
        FROM imag_t 
       WHERE imagent = g_enterprise 
         AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xcce.xcce007
            

      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','9') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
      #                                                       l_xcec.xcec101,
      #                                                       l_xcec.xcec102,
      #                                                       l_xcec.xcec103,
      #                                                       l_xcec.xcec110,
      #                                                       l_xcec.xcec111,
      #                                                       l_xcec.xcec112,
      #                                                       l_xcec.xcec113,
      #                                                       l_xcec.xcec114,
      #                                                       l_xcec.xcec115,
      #                                                       l_xcec.xcec116,
      #                                                       l_xcec.xcec117,
      #                                                       l_xcec.xcec118,
      #                                                       l_xcec.xcec119,
      #                                                       l_xcec.xcec120,
      #                                                       l_xcec.xcec107,
      #                                                       l_xcec.xcec108,
      #                                                       l_xcec.xcec109,
      #                                                       l_xcec.xcec121,
      #                                                       l_xcec.xcec122,
      #                                                       l_xcec.xcec123,
      #                                                       l_xcec.xcec124,
      #                                                       l_xcec.xcec125,
      #                                                       l_xcec.xcec126,
      #                                                       l_xcec.xcec127,
      #                                                       l_xcec.xcec128,
      #                                                       l_xcec.xcec129,
      #                                                       l_xcec.xcec130      
      #20150805--mark--end--lujh
#      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
      LET l_flag = TRUE
   END FOREACH 
   IF NOT l_flag THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'axc-00573'
      LET g_errparam.extend = ""
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success   
   END IF
   RETURN g_success
END FUNCTION

################################################################################
# Descriptions...: 描述说明    11.庫存調整憑證  axct703
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_3()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xcco          RECORD LIKE xcco_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
 DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xcco RECORD  #本期庫存成本調整檔
       xccoent LIKE xcco_t.xccoent, #企业编号
       xccold LIKE xcco_t.xccold, #账套
       xccocomp LIKE xcco_t.xccocomp, #法人组织
       xcco001 LIKE xcco_t.xcco001, #账套本位币顺序
       xcco002 LIKE xcco_t.xcco002, #成本域
       xcco003 LIKE xcco_t.xcco003, #成本计算类型
       xcco004 LIKE xcco_t.xcco004, #年度
       xcco005 LIKE xcco_t.xcco005, #期别
       xcco006 LIKE xcco_t.xcco006, #料件编号
       xcco007 LIKE xcco_t.xcco007, #特性
       xcco008 LIKE xcco_t.xcco008, #批号
       xcco009 LIKE xcco_t.xcco009, #参考单号
       xcco010 LIKE xcco_t.xcco010, #数据源
       xcco011 LIKE xcco_t.xcco011, #调整说明
       xcco102 LIKE xcco_t.xcco102, #当月调整金额-金额合计
       xcco102a LIKE xcco_t.xcco102a, #当月调整金额-材料
       xcco102b LIKE xcco_t.xcco102b, #当月调整金额-人工
       xcco102c LIKE xcco_t.xcco102c, #当月调整金额-委外加工
       xcco102d LIKE xcco_t.xcco102d, #当月调整金额-制费一
       xcco102e LIKE xcco_t.xcco102e, #当月调整金额-制费二
       xcco102f LIKE xcco_t.xcco102f, #当月调整金额-制费三
       xcco102g LIKE xcco_t.xcco102g, #当月调整金额-制费四
       xcco102h LIKE xcco_t.xcco102h, #当月调整金额-制费五
       xccoownid LIKE xcco_t.xccoownid, #资料所有者
       xccoowndp LIKE xcco_t.xccoowndp, #资料所有部门
       xccocrtid LIKE xcco_t.xccocrtid, #资料录入者
       xccocrtdp LIKE xcco_t.xccocrtdp, #资料录入部门
       xccocrtdt LIKE xcco_t.xccocrtdt, #资料创建日
       xccomodid LIKE xcco_t.xccomodid, #资料更改者
       xccomoddt LIKE xcco_t.xccomoddt, #最近更改日
       xccocnfid LIKE xcco_t.xccocnfid, #资料审核者
       xccocnfdt LIKE xcco_t.xccocnfdt, #数据审核日
       xccopstid LIKE xcco_t.xccopstid, #资料过账者
       xccopstdt LIKE xcco_t.xccopstdt, #资料过账日
       xccostus LIKE xcco_t.xccostus  #状态码
END RECORD
#161124-00048#21 add(e)
DEFINE l_sql           STRING
DEFINE l_sql1          STRING
DEFINE l_rate          LIKE type_t.num26_10
DEFINE l_rate1         LIKE type_t.num26_10
DEFINE ld_date         DATETIME YEAR TO SECOND
#20150805--add--str--lujh
DEFINE l_imaa009       LIKE imaa_t.imaa009       
DEFINE l_ooaa002       LIKE ooaa_t.ooaa002
#20150805--add--end--lujh

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET l_sql = " SELECT SUM(xcco102), ",
               "        SUM(xcco102a),SUM(xcco102b),SUM(xcco102c),SUM(xcco102d),",
               "        SUM(xcco102e),SUM(xcco102f),SUM(xcco102g),SUM(xcco102h) ",
               "        FROM xcco_t ", 
               "  WHERE xccoent = '",g_enterprise,"' AND xccold = '",g_xcea_m.xceald,"'",
               "    AND xcco003 = '",g_xcea_m.xcea003,"' AND xcco004 = ",g_xcea004,
               "    AND xcco005 = ",g_xcea005,
               "    AND xcco002 = ? AND xcco009 = ? AND xcco006 = ? ",
               "    AND xcco007 = ? AND xcco008 = ? AND xcco010 = ?  ",
               "    AND xcco010 = '1'"
    
   LET g_sql = l_sql CLIPPED," AND xcco001 = '2' " 

   DECLARE xcae_prep2 CURSOR FROM g_sql
   
   LET g_sql = l_sql CLIPPED," AND xcco001 = '3' " 

   DECLARE xcae_prep3 CURSOR FROM g_sql
   
   LET l_sql = " SELECT xcco002,xcco009,xcco006,xcco007,xcco008,xcco010,SUM(xcco102), ",
               "        SUM(xcco102a),SUM(xcco102b),SUM(xcco102c),SUM(xcco102d),",
               "        SUM(xcco102e),SUM(xcco102f),SUM(xcco102g),SUM(xcco102h) ",
               "        FROM xcco_t ", 
               "  WHERE xccoent = '",g_enterprise,"' AND xccold = '",g_xcea_m.xceald,"'",
               "    AND xcco003 = '",g_xcea_m.xcea003,"' AND xcco004 = ",g_xcea004,
               "    AND xcco005 = ",g_xcea005,
               "    AND xcco010 = '1'"
   LET l_sql1 = l_sql CLIPPED," AND xcco001 = '1' ",
                " GROUP BY xcco002,xcco009,xcco006,xcco007,xcco008,xcco010",
                " ORDER BY xcco002,xcco009,xcco006,xcco007,xcco008,xcco010"
   PREPARE xcae_prep FROM l_sql1
   DECLARE xcae_curs CURSOR FOR xcae_prep
   

   FOREACH xcae_curs INTO  l_xcco.xcco002,l_xcco.xcco009,l_xcco.xcco006,l_xcco.xcco007,l_xcco.xcco008,l_xcco.xcco010,
                           l_xcco.xcco102,l_xcco.xcco102a,l_xcco.xcco102b,l_xcco.xcco102c,l_xcco.xcco102d,
                           l_xcco.xcco102e,l_xcco.xcco102f,l_xcco.xcco102g,l_xcco.xcco102h
      
      IF g_glaa015 ='Y' THEN      
         OPEN xcae_prep2 USING  l_xcco.xcco002,l_xcco.xcco009,l_xcco.xcco006,l_xcco.xcco007,l_xcco.xcco008,l_xcco.xcco010
         FETCH xcae_prep2 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep2
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

         
#      IF g_glaa015 = 'Y' THEN
#         CALL s_aooi160_get_exrate('2',g_xcea_m.xceald,g_xcea_m.xcea001,g_glaa001,
#                                        #目的幣別;  交易金額;              匯類類型
#                                         g_glaa016,0,g_glaa018)
#                  RETURNING l_rate
#      END IF
#      
#      IF g_glaa019 = 'Y' THEN
#         CALL s_aooi160_get_exrate('2',g_xcea_m.xceald,g_xcea_m.xcea001,g_glaa001,
#                                        #目的幣別;  交易金額;              匯類類型
#                                         g_glaa016,0,g_glaa022)
#          RETURNING l_rate1
#      END IF
      
      IF g_glaa019 ='Y' THEN
         OPEN xcae_prep3 USING  l_xcco.xcco002,l_xcco.xcco009,l_xcco.xcco006,l_xcco.xcco007,l_xcco.xcco008,l_xcco.xcco010
         FETCH xcae_prep3 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep3
            CALL s_transaction_end('N','0')
            RETURN
         END IF 
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 
  
      LET l_xceb.xcebent = g_enterprise
      LET l_xceb.xcebld  = g_xcea_m.xceald
      LET l_xceb.xcebdocno=g_xcea_m.xceadocno
      LET l_xceb.xcebcomp=g_xcea_m.xceacomp
      LET l_xceb.xceb001 = l_xcco.xcco009
      LET l_xceb.xceb003 = l_xcco.xcco010
      LET l_xceb.xceb004 = l_xcco.xcco006
      LET l_xceb.xceb005 = l_xcco.xcco007
      LET l_xceb.xceb102 = ''
      LET l_xceb.xceb103 = l_xcco.xcco002
      LET l_xceb.xceb119 = ''
      LET l_xceb.xceb201 = 0
      LET l_xceb.xceb202 = l_xcco.xcco102
      LET l_xceb.xceb202a = l_xcco.xcco102a
      LET l_xceb.xceb202b = l_xcco.xcco102b
      LET l_xceb.xceb202c = l_xcco.xcco102c
      LET l_xceb.xceb202d = l_xcco.xcco102d
      LET l_xceb.xceb202e = l_xcco.xcco102e
      LET l_xceb.xceb202f = l_xcco.xcco102f
      LET l_xceb.xceb202g = l_xcco.xcco102g
      LET l_xceb.xceb202h = l_xcco.xcco102h
     
      #20150805--mod--str--lujh
      #SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
      # WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp
      #   AND imag001 = l_xceb.xceb004  
      SELECT imaa009 INTO l_imaa009 
        FROM imaa_t
       WHERE imaaent = g_enterprise
         AND imaa001 = l_xceb.xceb004
      #品类管理层级aoos010
      CALL cl_get_para(g_enterprise,'','E-CIR-0001') RETURNING l_ooaa002
      
      SELECT rtaw001 INTO l_xceb.xceb117
        FROM rtaw_t
       WHERE rtawent = g_enterprise
         AND rtaw002 = l_imaa009
         AND rtaw003 = l_ooaa002      
      #20150805--mod--end--lujh      
 
      #160518-00022#1---mod---s
      #CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
      # RETURNING l_success,l_xceb.xceb101 
      #抓axci201的科目
      IF cl_null(l_xceb.xceb101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','5') RETURNING l_success,l_xceb.xceb101,l_errno
      END IF   
      #160518-00022#1---mod---e
      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' ' 
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','3') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF
     #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
     
     IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
      
      INITIALIZE l_xcec.* TO NULL
           
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 
      
      LET l_xcec.xcecent = g_enterprise
      LET l_xcec.xcecld  = g_xcea_m.xceald
      LET l_xcec.xcecdocno=g_xcea_m.xceadocno
      LET l_xcec.xceccomp=g_xcea_m.xceacomp
      LET l_xcec.xcec001 = l_xcco.xcco009
      LET l_xcec.xcec003 = l_xcco.xcco010
      LET l_xcec.xcec004 = l_xcco.xcco006
      LET l_xcec.xcec005 = l_xcco.xcco007
      LET l_xcec.xcec101 = ''

      #160518-00022#1---mod---s
      ##抓axci201的科目
      #IF cl_null(l_xcec.xcec101) THEN
      #   CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','5') RETURNING l_success,l_xcec.xcec101,l_errno
      #END IF      
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
       RETURNING l_success,l_xcec.xcec101  
      #160518-00022#1---mod---e      
      LET l_xcec.xcec102 = ''
      LET l_xcec.xcec103 = l_xcco.xcco002
      LET l_xcec.xcec117 = l_xceb.xceb117
      LET l_xcec.xcec119 = ''
      LET l_xcec.xcec201 = 0
      LET l_xcec.xcec202 = l_xcco.xcco102
      LET l_xcec.xcec202a = l_xcco.xcco102a
      LET l_xcec.xcec202b = l_xcco.xcco102b
      LET l_xcec.xcec202c = l_xcco.xcco102c
      LET l_xcec.xcec202d = l_xcco.xcco102d
      LET l_xcec.xcec202e = l_xcco.xcco102e
      LET l_xcec.xcec202f = l_xcco.xcco102f
      LET l_xcec.xcec202g = l_xcco.xcco102g
      LET l_xcec.xcec202h = l_xcco.xcco102h
      LET l_xcec.xcec212  = l_xceb.xceb212
      LET l_xcec.xcec212a  = l_xceb.xceb212a
      LET l_xcec.xcec212b  = l_xceb.xceb212b
      LET l_xcec.xcec212c  = l_xceb.xceb212c
      LET l_xcec.xcec212d  = l_xceb.xceb212d
      LET l_xcec.xcec212e  = l_xceb.xceb212e
      LET l_xcec.xcec212f  = l_xceb.xceb212f
      LET l_xcec.xcec212g  = l_xceb.xceb212g
      LET l_xcec.xcec212h  = l_xceb.xceb212h
      LET l_xcec.xcec222   = l_xceb.xceb222
      LET l_xcec.xcec222a  = l_xceb.xceb222a
      LET l_xcec.xcec222b  = l_xceb.xceb222b
      LET l_xcec.xcec222c  = l_xceb.xceb222c
      LET l_xcec.xcec222d  = l_xceb.xceb222d
      LET l_xcec.xcec222e  = l_xceb.xceb222e
      LET l_xcec.xcec222f  = l_xceb.xceb222f
      LET l_xcec.xcec222g  = l_xceb.xceb222g
      LET l_xcec.xcec222h  = l_xceb.xceb222h
      LET l_xcec.xcec107  = l_xceb.xceb107
      LET l_xcec.xcec108  = l_xceb.xceb108
      LET l_xcec.xcec109  = l_xceb.xceb109
      LET l_xcec.xcec121  = l_xceb.xceb121
      LET l_xcec.xcec122  = l_xceb.xceb122
      LET l_xcec.xcec123  = l_xceb.xceb123
      LET l_xcec.xcec124  = l_xceb.xceb124
      LET l_xcec.xcec125  = l_xceb.xceb125
      LET l_xcec.xcec126  = l_xceb.xceb126
      LET l_xcec.xcec127  = l_xceb.xceb127
      LET l_xcec.xcec128  = l_xceb.xceb128
      LET l_xcec.xcec129  = l_xceb.xceb129
      LET l_xcec.xcec130  = l_xceb.xceb130   
 
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','3') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130  
      #20150805--mark--end--lujh      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF       
#      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
         LET g_success = 'N'
         EXIT FOREACH
      END IF
      
      
      CLOSE xcae_prep2
      CLOSE xcae_prep3
   END FOREACH   
   RETURN g_success  
END FUNCTION

################################################################################
# Descriptions...: 描述说明  10.盤因虧憑證  axct704
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_4()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xcck          RECORD LIKE xcck_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xcck RECORD  #本期料件明細進出成本檔
       xcckent LIKE xcck_t.xcckent, #企业编号
       xccksite LIKE xcck_t.xccksite, #site组织
       xcckcomp LIKE xcck_t.xcckcomp, #法人组织
       xcckld LIKE xcck_t.xcckld, #账套
       xcck001 LIKE xcck_t.xcck001, #账套本位币顺序
       xcck002 LIKE xcck_t.xcck002, #成本域
       xcck003 LIKE xcck_t.xcck003, #成本计算类型
       xcck004 LIKE xcck_t.xcck004, #年度
       xcck005 LIKE xcck_t.xcck005, #期别
       xcck006 LIKE xcck_t.xcck006, #参考单号
       xcck007 LIKE xcck_t.xcck007, #项次
       xcck008 LIKE xcck_t.xcck008, #项序
       xcck009 LIKE xcck_t.xcck009, #出入库码
       xcck010 LIKE xcck_t.xcck010, #料号
       xcck011 LIKE xcck_t.xcck011, #产品特征
       xcck012 LIKE xcck_t.xcck012, #单据类型
       xcck013 LIKE xcck_t.xcck013, #单据日期
       xcck014 LIKE xcck_t.xcck014, #时间
       xcck015 LIKE xcck_t.xcck015, #仓库编号
       xcck016 LIKE xcck_t.xcck016, #储位编号
       xcck017 LIKE xcck_t.xcck017, #批号
       xcck020 LIKE xcck_t.xcck020, #异动类型
       xcck021 LIKE xcck_t.xcck021, #原因码
       xcck022 LIKE xcck_t.xcck022, #交易对象
       xcck023 LIKE xcck_t.xcck023, #客群
       xcck024 LIKE xcck_t.xcck024, #区域
       xcck025 LIKE xcck_t.xcck025, #成本中心
       xcck026 LIKE xcck_t.xcck026, #经营类别
       xcck027 LIKE xcck_t.xcck027, #渠道
       xcck028 LIKE xcck_t.xcck028, #品类
       xcck029 LIKE xcck_t.xcck029, #品牌
       xcck030 LIKE xcck_t.xcck030, #项目号
       xcck031 LIKE xcck_t.xcck031, #WBS
       xcck032 LIKE xcck_t.xcck032, #存货科目
       xcck033 LIKE xcck_t.xcck033, #费用成本科目
       xcck034 LIKE xcck_t.xcck034, #收入科目
       xcck040 LIKE xcck_t.xcck040, #交易币种
       xcck041 LIKE xcck_t.xcck041, #本位币种
       xcck042 LIKE xcck_t.xcck042, #汇率
       xcck043 LIKE xcck_t.xcck043, #交易单位
       xcck044 LIKE xcck_t.xcck044, #成本单位
       xcck045 LIKE xcck_t.xcck045, #换算率
       xcck046 LIKE xcck_t.xcck046, #交易数量
       xcck047 LIKE xcck_t.xcck047, #工单号码
       xcck048 LIKE xcck_t.xcck048, #重复性生产-计划编号
       xcck049 LIKE xcck_t.xcck049, #重复性生产-生产料号
       xcck050 LIKE xcck_t.xcck050, #重复性生产-生产料号BOM特性
       xcck051 LIKE xcck_t.xcck051, #重复性生产-生产料号产品特征
       xcck055 LIKE xcck_t.xcck055, #xccc类型
       xcck201 LIKE xcck_t.xcck201, #本期异动数量
       xcck202 LIKE xcck_t.xcck202, #本期异动金额
       xcck202a LIKE xcck_t.xcck202a, #本期异动金额-材料
       xcck202b LIKE xcck_t.xcck202b, #本期异动金额-人工
       xcck202c LIKE xcck_t.xcck202c, #本期异动金额-加工费
       xcck202d LIKE xcck_t.xcck202d, #本期异动金额-制费一
       xcck202e LIKE xcck_t.xcck202e, #本期异动金额-制费二
       xcck202f LIKE xcck_t.xcck202f, #本期异动金额-制费三
       xcck202g LIKE xcck_t.xcck202g, #本期异动金额-制费四
       xcck202h LIKE xcck_t.xcck202h, #本期异动金额-制费五
       xcck282 LIKE xcck_t.xcck282, #本期异动单价
       xcck282a LIKE xcck_t.xcck282a, #本期异动单价-材料
       xcck282b LIKE xcck_t.xcck282b, #本期异动单价-人工
       xcck282c LIKE xcck_t.xcck282c, #本期异动单价-加工
       xcck282d LIKE xcck_t.xcck282d, #本期异动单价-制费一
       xcck282e LIKE xcck_t.xcck282e, #本期异动单价-制费二
       xcck282f LIKE xcck_t.xcck282f, #本期异动单价-制费三
       xcck282g LIKE xcck_t.xcck282g, #本期异动单价-制费四
       xcck282h LIKE xcck_t.xcck282h, #本期异动单价-制费五
       xcck301 LIKE xcck_t.xcck301, #已耗数量
       xcck302 LIKE xcck_t.xcck302, #已耗金额
       xcck302a LIKE xcck_t.xcck302a, #已耗金额-材料
       xcck302b LIKE xcck_t.xcck302b, #已耗金额-人工
       xcck302c LIKE xcck_t.xcck302c, #已耗金额-加工费
       xcck302d LIKE xcck_t.xcck302d, #已耗金额-制费一
       xcck302e LIKE xcck_t.xcck302e, #已耗金额-制费二
       xcck302f LIKE xcck_t.xcck302f, #已耗金额-制费三
       xcck302g LIKE xcck_t.xcck302g, #已耗金额-制费四
       xcck302h LIKE xcck_t.xcck302h, #已耗金额-制费五
       xcck901 LIKE xcck_t.xcck901, #结存数量
       xcck902 LIKE xcck_t.xcck902, #结存金额
       xcck902a LIKE xcck_t.xcck902a, #结存金额-材料
       xcck902b LIKE xcck_t.xcck902b, #结存金额-人工
       xcck902c LIKE xcck_t.xcck902c, #结存金额-加工费
       xcck902d LIKE xcck_t.xcck902d, #结存金额-制费一
       xcck902e LIKE xcck_t.xcck902e, #结存金额-制费二
       xcck902f LIKE xcck_t.xcck902f, #结存金额-制费三
       xcck902g LIKE xcck_t.xcck902g, #结存金额-制费四
       xcck902h LIKE xcck_t.xcck902h, #结存金额-制费五
       xcck980 LIKE xcck_t.xcck980, #结存单位成本
       xcck980a LIKE xcck_t.xcck980a, #结存单位成本-材料
       xcck980b LIKE xcck_t.xcck980b, #结存单位成本-人工
       xcck980c LIKE xcck_t.xcck980c, #结存单位成本-加工费
       xcck980d LIKE xcck_t.xcck980d, #结存单位成本-制费一
       xcck980e LIKE xcck_t.xcck980e, #结存单位成本-制费二
       xcck980f LIKE xcck_t.xcck980f, #结存单位成本-制费三
       xcck980g LIKE xcck_t.xcck980g, #结存单位成本-制费四
       xcck980h LIKE xcck_t.xcck980h, #结存单位成本-制费五
       xcck903 LIKE xcck_t.xcck903, #结存调整金额
       xcck903a LIKE xcck_t.xcck903a, #结存调整金额-材料
       xcck903b LIKE xcck_t.xcck903b, #结存调整金额-人工
       xcck903c LIKE xcck_t.xcck903c, #结存调整金额-加工费
       xcck903d LIKE xcck_t.xcck903d, #结存调整金额-制费一
       xcck903e LIKE xcck_t.xcck903e, #结存调整金额-制费二
       xcck903f LIKE xcck_t.xcck903f, #结存调整金额-制费三
       xcck903g LIKE xcck_t.xcck903g, #结存调整金额-制费四
       xcck903h LIKE xcck_t.xcck903h, #结存调整金额-制费五
       xcckownid LIKE xcck_t.xcckownid, #资料所有者
       xcckowndp LIKE xcck_t.xcckowndp, #资料所有部门
       xcckcrtid LIKE xcck_t.xcckcrtid, #资料录入者
       xcckcrtdp LIKE xcck_t.xcckcrtdp, #资料录入部门
       xcckcrtdt LIKE xcck_t.xcckcrtdt, #资料创建日
       xcckmodid LIKE xcck_t.xcckmodid, #资料更改者
       xcckmoddt LIKE xcck_t.xcckmoddt, #最近更改日
       xcckstus LIKE xcck_t.xcckstus, #状态码
       xcck056 LIKE xcck_t.xcck056  #成本代销单号
END RECORD
#161124-00048#21 add(e)
DEFINE l_sql           STRING
DEFINE l_sql1          STRING
DEFINE l_rate          LIKE type_t.num26_10
DEFINE l_rate1         LIKE type_t.num26_10
DEFINE ld_date         DATETIME YEAR TO SECOND
#20150805--add--str--lujh
DEFINE l_imaa009       LIKE imaa_t.imaa009       
DEFINE l_ooaa002       LIKE ooaa_t.ooaa002
#20150805--add--end--lujh
DEFINE ls_wc           STRING   #C151008-004 Add

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET l_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"'",
               #"    AND xcck004 = ",g_xcea004,
               #"    AND xcck005 = ",g_xcea005,
               "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xcck055 = '311' ",
               "    AND ",g_wc_xcck026,       #20150731 add lujh
               "    AND xcck002 = ? AND xcck008 = ? AND xcck006 = ? ",
               "    AND xcck010 = ? AND xcck011 = ? AND xcck012 = ? AND xcck007 = ?"
  
   LET g_sql1 = l_sql CLIPPED," AND xcck001 = '2' " 

   DECLARE xcae_prep5 CURSOR FROM g_sql1
   
   LET g_sql2 = l_sql CLIPPED," AND xcck001 = '3' " 

   DECLARE xcae_prep6 CURSOR FROM g_sql2
   
   #C151008-004 Mark ---(S)---
  #LET l_sql = " SELECT xcck002,xcck006,xcck007,xcck010,xcck011,xcck012,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
  #            "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
  #            "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
  #            "        FROM xcck_t ", 
  #            "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
  #            "    AND xcck003 = '",g_xcea_m.xcea003,"' ",
# #             "    AND xcck004 = ",g_xcea_m.xcea004,
# #             "    AND xcck005 = ",g_xcea_m.xcea005,
  #            "    AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
  #            "    AND xcck055 = '311' ",
  #            "    AND NVL(xcckud001,'N') = 'N' ",
  #            "    AND ",g_wc_xcck026       #20150731 add lujh
  #LET l_sql1 = l_sql CLIPPED," AND xcck001 = '1' ",
  #             " GROUP BY xcck002,xcck006,xcck007,xcck010,xcck011,xcck012",
  #             " ORDER BY xcck002,xcck006,xcck007,xcck010,xcck011,xcck012"
  #C151008-004 Mark ---(E)---

  #C151008-004 Mark ---(E)---
  #C151008-004 Add  ---(S)---
   LET ls_wc = g_wc_xcck026
   LET ls_wc = cl_replace_str(ls_wc,"xcck026","xckd013")
   LET ls_wc = cl_replace_str(ls_wc,"xcck012","xckd007")
   LET ls_wc = cl_replace_str(ls_wc,"xcck021","xckd012")
   LET l_sql1= " SELECT xckd002 ,'' xcck006,'' xcck007,xckd014 xcck010,'' xcck011,xckd007,",    #modify by 20151011
               "        SUM(xckd006 *xckd016),SUM(xckd006 *xckd017),SUM(xckd006 *xckd018),",
               "        SUM(xckd006*0) xcck202b,SUM(xckd006*0) xcck202c,SUM(xckd006*0) xcck202d,",
               "        SUM(xckd006*0) xcck202e,SUM(xckd006*0) xcck202f,SUM(xckd006*0) xcck202g,SUM(xckd006*0) xcck202h,xckd008,xckd012 ",
               "        FROM xckd_t ", 
               "  WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
               "    AND xckd003 = '",g_xcea_m.xcea003,"' ",
               "    AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
               "    AND xckdsite = '",g_xcea_m.xceasite,"'",
               "    AND xckd001 = '1' ",
               "    AND ",ls_wc,
               "    AND NVL(xckd019,'N') = 'N' ",
               "    AND xckd015 IN ('311') ",     #modify 20151011
               " GROUP BY xckd002,xckd007,xckd008,xckd012,xckd014",    #modify by 20151011
               " ORDER BY xckd002,xckd007,xckd008,xckd012,xckd014"      #modify by 20151011
  #C151008-004 Add  ---(E)---
   PREPARE xcae_prep4 FROM l_sql1
   DECLARE xcae_curs4 CURSOR FOR xcae_prep4
   

   FOREACH xcae_curs4 INTO  l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,
                            l_xcck.xcck012,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h,l_xcck.xcck013,l_xcck.xcck021   
      
     #SELECT glcc002 INTO l_xceb.xceb101 FROM glcc_t 
     # WHERE glccent = g_enterprise AND glccld = g_xcea_m.xceald AND glcc001 = '1'
      IF g_glaa015 ='Y' THEN
         OPEN xcae_prep5 USING  l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,
                                l_xcck.xcck012
         FETCH xcae_prep5 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep5
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
         OPEN xcae_prep6 USING  l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck007,l_xcck.xcck010,l_xcck.xcck011,
                                l_xcck.xcck012
         FETCH xcae_prep6 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep6
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      LET l_xceb.xcebent = g_enterprise
      LET l_xceb.xcebld  = g_xcea_m.xceald
      LET l_xceb.xcebdocno=g_xcea_m.xceadocno
      LET l_xceb.xcebcomp=g_xcea_m.xceacomp
      LET l_xceb.xceb001 = l_xcck.xcck006
      LET l_xceb.xceb002 = l_xcck.xcck007
      LET l_xceb.xceb003 = l_xcck.xcck012
      #LET l_xceb.xceb004 = l_xcck.xcck010  #modify by 20151011
      LET l_xceb.xceb005 = l_xcck.xcck011
      LET l_xceb.xceb102 = ''
      LET l_xceb.xceb103 = l_xcck.xcck002
      LET l_xceb.xceb119 = l_xcck.xcck030
      LET l_xceb.xceb201 = l_xcck.xcck201
      LET l_xceb.xceb202 = l_xcck.xcck202
      LET l_xceb.xceb202a = l_xcck.xcck202a
      LET l_xceb.xceb202b = l_xcck.xcck202b
      LET l_xceb.xceb202c = l_xcck.xcck202c
      LET l_xceb.xceb202d = l_xcck.xcck202d
      LET l_xceb.xceb202e = l_xcck.xcck202e
      LET l_xceb.xceb202f = l_xcck.xcck202f
      LET l_xceb.xceb202g = l_xcck.xcck202g
      LET l_xceb.xceb202h = l_xcck.xcck202h
      LET l_xceb.xceb110 = l_xcck.xcck021 #原因碼   #C151008-004 Add
       
      #20150805--mod--str--lujh      
      #SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
      # WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp
      #   AND imag001 = l_xceb.xceb004 
#       #modify by 20151011 str   
#      SELECT imaa009 INTO l_imaa009 
#        FROM imaa_t
#       WHERE imaaent = g_enterprise
#         AND imaa001 = l_xceb.xceb004
 #modify by 20151011 end
      #品类管理层级aoos010
      CALL cl_get_para(g_enterprise,'','E-CIR-0001') RETURNING l_ooaa002
#       #modify by 20151011
#      SELECT rtaw001 INTO l_xceb.xceb117
#        FROM rtaw_t
#       WHERE rtawent = g_enterprise
#         AND rtaw002 = l_imaa009
#         AND rtaw003 = l_ooaa002   
      #20150805--mod--end--lujh
      LET l_xceb.xceb117 = l_xcck.xcck010   #modify by 20151011 end

      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF      
      
      #CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
      # RETURNING l_success,l_xceb.xceb101
       
      SELECT glab007 INTO l_xceb.xceb101 FROM glab_t
       WHERE glabent = g_enterprise
         AND glabld = g_xcea_m.xceald
         AND glab001 = 'RTAX'
         AND glab002 = '1'
         AND glab003 = l_xceb.xceb117
 

      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' '
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','4') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh

     #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
     
     IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
      
   
      INITIALIZE l_xcec.* TO NULL 

      LET l_xcec.xcecent = g_enterprise
      LET l_xcec.xcecld  = g_xcea_m.xceald
      LET l_xcec.xceccomp  = g_xcea_m.xceacomp
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      LET l_xcec.xcec001 = l_xcck.xcck006
      LET l_xcec.xcec002 = l_xcck.xcck007
      LET l_xcec.xcec003 = l_xcck.xcck012
      LET l_xcec.xcec004 = l_xcck.xcck010
      LET l_xcec.xcec005 = l_xcck.xcck011
      LET l_xcec.xcec101 = ''
#抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','6') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      LET l_xcec.xcec102 = ''
      LET l_xcec.xcec103 = l_xcck.xcck002
      LET l_xcec.xcec117 = l_xceb.xceb117
      LET l_xcec.xcec119 = l_xcck.xcck030
      LET l_xcec.xcec201 = l_xcck.xcck201
      LET l_xcec.xcec202 = l_xcck.xcck202
      LET l_xcec.xcec202a = l_xcck.xcck202a
      LET l_xcec.xcec202b = l_xcck.xcck202b
      LET l_xcec.xcec202c = l_xcck.xcck202c
      LET l_xcec.xcec202d = l_xcck.xcck202d
      LET l_xcec.xcec202e = l_xcck.xcck202e
      LET l_xcec.xcec202f = l_xcck.xcck202f
      LET l_xcec.xcec202g = l_xcck.xcck202g
      LET l_xcec.xcec202h = l_xcck.xcck202h
      LET l_xcec.xcec212  = l_xceb.xceb212
      LET l_xcec.xcec212a  = l_xceb.xceb212a
      LET l_xcec.xcec212b  = l_xceb.xceb212b
      LET l_xcec.xcec212c  = l_xceb.xceb212c
      LET l_xcec.xcec212d  = l_xceb.xceb212d
      LET l_xcec.xcec212e  = l_xceb.xceb212e
      LET l_xcec.xcec212f  = l_xceb.xceb212f
      LET l_xcec.xcec212g  = l_xceb.xceb212g
      LET l_xcec.xcec212h  = l_xceb.xceb212h
      LET l_xcec.xcec222   = l_xceb.xceb222
      LET l_xcec.xcec222a  = l_xceb.xceb222a
      LET l_xcec.xcec222b  = l_xceb.xceb222b
      LET l_xcec.xcec222c  = l_xceb.xceb222c
      LET l_xcec.xcec222d  = l_xceb.xceb222d
      LET l_xcec.xcec222e  = l_xceb.xceb222e
      LET l_xcec.xcec222f  = l_xceb.xceb222f
      LET l_xcec.xcec222g  = l_xceb.xceb222g
      LET l_xcec.xcec222h  = l_xceb.xceb222h
      LET l_xcec.xcec107  = l_xceb.xceb107
      LET l_xcec.xcec108  = l_xceb.xceb108
      LET l_xcec.xcec109  = l_xceb.xceb109
      LET l_xcec.xcec121  = l_xceb.xceb121
      LET l_xcec.xcec122  = l_xceb.xceb122
      LET l_xcec.xcec123  = l_xceb.xceb123
      LET l_xcec.xcec124  = l_xceb.xceb124
      LET l_xcec.xcec125  = l_xceb.xceb125
      LET l_xcec.xcec126  = l_xceb.xceb126
      LET l_xcec.xcec127  = l_xceb.xceb127
      LET l_xcec.xcec128  = l_xceb.xceb128
      LET l_xcec.xcec129  = l_xceb.xceb129
      LET l_xcec.xcec130  = l_xceb.xceb130
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 

      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','4') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130   
      #20150805--mark--end--lujh      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF            
#      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
         LET g_success = 'N'
         EXIT FOREACH
      END IF
      
      
      CLOSE xcae_prep5
      CLOSE xcae_prep6
   END FOREACH   
   
   # 产生资料成功，更新xcck中的立账状态码
   IF g_success='Y' THEN
     #C151008-004 Mark ---(S)---
     #LET l_sql = "UPDATE xcck_t SET xcckud001 = 'Y' ",
     #            " WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
     #            "   AND xcck003 = '",g_xcea_m.xcea003,"' ",
     #            "   AND xcck013 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
     #            "   AND xcck055 = '311' ",
     #            "   AND NVL(xcckud001,'N') = 'N' ",
     #            "   AND ",g_wc_xcck026,
     #            "   AND xcck001 = '1' ",
     #            "   AND EXISTS(SELECT 1 FROM xceb_t ",
     #            "               WHERE xcebent = ",g_enterprise,
     #            "                 AND xcebld = '",g_xcea_m.xceald,"' ",
     #            "                 AND xcebdocno = '",g_xcea_m.xceadocno,"' ",
     #            "                 AND xceb001 = xcck006 ",
     #            "                 AND xceb002 = xcck007 ",
     #            "             ) "
     #C151008-004 Mark ---(E)---
     #C151008-004 Add  ---(S)---
      LET l_sql = "UPDATE xckd_t SET xckd019 = 'Y' ",
                  " WHERE xckdent = '",g_enterprise,"' AND xckdld = '",g_xcea_m.xceald,"'",
                  "   AND xckd003 = '",g_xcea_m.xcea003,"' ",
                  "   AND xckdsite= '",g_xcea_m.xceasite,"'",
                  "   AND xckd008 BETWEEN '",g_xcea_m.l_sdate,"' AND '",g_xcea_m.l_edate,"' ",
                  "   AND xckd001 = '1' ",
                  "   AND xckd015 IN ('311') ",     #modify 20151011
                  "   AND NVL(xckd019,'N') = 'N' ",
                  "   AND ",ls_wc CLIPPED
     #C151008-004 Add  ---(E)---
      TRY
         EXECUTE IMMEDIATE l_sql
      CATCH
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "upd xcck_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()
  
            LET g_success = 'N'
         END IF
      END TRY
   END IF
   
   RETURN g_success 
END FUNCTION

################################################################################
# Descriptions...: 描述说明   12.結存調整憑證  axct710
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_ins_10()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xccc          RECORD LIKE xccc_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
DEFINE l_xccc RECORD  #料件庫存成本期異動統計檔
       xcccent LIKE xccc_t.xcccent, #企业编号
       xccccomp LIKE xccc_t.xccccomp, #法人组织
       xcccld LIKE xccc_t.xcccld, #账套
       xccc001 LIKE xccc_t.xccc001, #账套本位币顺序
       xccc002 LIKE xccc_t.xccc002, #成本域
       xccc003 LIKE xccc_t.xccc003, #成本计算类型
       xccc004 LIKE xccc_t.xccc004, #年度
       xccc005 LIKE xccc_t.xccc005, #期别
       xccc006 LIKE xccc_t.xccc006, #料号
       xccc007 LIKE xccc_t.xccc007, #产品特征
       xccc008 LIKE xccc_t.xccc008, #批号
       xccc010 LIKE xccc_t.xccc010, #核算币种
       xccc101 LIKE xccc_t.xccc101, #上期结存数量
       xccc102 LIKE xccc_t.xccc102, #上期结存金额
       xccc102a LIKE xccc_t.xccc102a, #上期结存金额-材料
       xccc102b LIKE xccc_t.xccc102b, #上期结存金额-人工
       xccc102c LIKE xccc_t.xccc102c, #上期结存金额-加工
       xccc102d LIKE xccc_t.xccc102d, #上期结存金额-制费一
       xccc102e LIKE xccc_t.xccc102e, #上期结存金额-制费二
       xccc102f LIKE xccc_t.xccc102f, #上期结存金额-制费三
       xccc102g LIKE xccc_t.xccc102g, #上期结存金额-制费四
       xccc102h LIKE xccc_t.xccc102h, #上期结存金额-制费五
       xccc201 LIKE xccc_t.xccc201, #本期采购入库数量
       xccc202 LIKE xccc_t.xccc202, #本期采购入库金额
       xccc202a LIKE xccc_t.xccc202a, #本期采购入库金额-材料
       xccc202b LIKE xccc_t.xccc202b, #本期采购入库金额-人工
       xccc202c LIKE xccc_t.xccc202c, #本期采购入库金额-加工
       xccc202d LIKE xccc_t.xccc202d, #本期采购入库金额-制费一
       xccc202e LIKE xccc_t.xccc202e, #本期采购入库金额-制费二
       xccc202f LIKE xccc_t.xccc202f, #本期采购入库金额-制费三
       xccc202g LIKE xccc_t.xccc202g, #本期采购入库金额-制费四
       xccc202h LIKE xccc_t.xccc202h, #本期采购入库金额-制费五
       xccc203 LIKE xccc_t.xccc203, #本期委外入库数量
       xccc204 LIKE xccc_t.xccc204, #本期委外入库金额
       xccc204a LIKE xccc_t.xccc204a, #本期委外入库金额-材料
       xccc204b LIKE xccc_t.xccc204b, #本期委外入库金额-人工
       xccc204c LIKE xccc_t.xccc204c, #本期委外入库金额-加工
       xccc204d LIKE xccc_t.xccc204d, #本期委外入库金额-制费一
       xccc204e LIKE xccc_t.xccc204e, #本期委外入库金额-制费二
       xccc204f LIKE xccc_t.xccc204f, #本期委外入库金额-制费三
       xccc204g LIKE xccc_t.xccc204g, #本期委外入库金额-制费四
       xccc204h LIKE xccc_t.xccc204h, #本期委外入库金额-制费五
       xccc205 LIKE xccc_t.xccc205, #本期工单入库数量
       xccc206 LIKE xccc_t.xccc206, #本期工单入库金额
       xccc206a LIKE xccc_t.xccc206a, #本期工单入库金额-材料
       xccc206b LIKE xccc_t.xccc206b, #本期工单入库金额-人工
       xccc206c LIKE xccc_t.xccc206c, #本期工单入库金额-加工
       xccc206d LIKE xccc_t.xccc206d, #本期工单入库金额-制费一
       xccc206e LIKE xccc_t.xccc206e, #本期工单入库金额-制费二
       xccc206f LIKE xccc_t.xccc206f, #本期工单入库金额-制费三
       xccc206g LIKE xccc_t.xccc206g, #本期工单入库金额-制费四
       xccc206h LIKE xccc_t.xccc206h, #本期工单入库金额-制费五
       xccc207 LIKE xccc_t.xccc207, #本期返工领出数量
       xccc208 LIKE xccc_t.xccc208, #本期返工领出金额
       xccc208a LIKE xccc_t.xccc208a, #本期返工领出金额-材料
       xccc208b LIKE xccc_t.xccc208b, #本期返工领出金额-人工
       xccc208c LIKE xccc_t.xccc208c, #本期返工领出金额-加工
       xccc208d LIKE xccc_t.xccc208d, #本期返工领出金额-制费一
       xccc208e LIKE xccc_t.xccc208e, #本期返工领出金额-制费二
       xccc208f LIKE xccc_t.xccc208f, #本期返工领出金额-制费三
       xccc208g LIKE xccc_t.xccc208g, #本期返工领出金额-制费四
       xccc208h LIKE xccc_t.xccc208h, #本期返工领出金额-制费五
       xccc209 LIKE xccc_t.xccc209, #本期返工入库数量
       xccc210 LIKE xccc_t.xccc210, #本期返工入库金额
       xccc210a LIKE xccc_t.xccc210a, #本期返工入库金额-材料
       xccc210b LIKE xccc_t.xccc210b, #本期返工入库金额-人工
       xccc210c LIKE xccc_t.xccc210c, #本期返工入库金额-加工
       xccc210d LIKE xccc_t.xccc210d, #本期返工入库金额-制费一
       xccc210e LIKE xccc_t.xccc210e, #本期返工入库金额-制费二
       xccc210f LIKE xccc_t.xccc210f, #本期返工入库金额-制费三
       xccc210g LIKE xccc_t.xccc210g, #本期返工入库金额-制费四
       xccc210h LIKE xccc_t.xccc210h, #本期返工入库金额-制费五
       xccc211 LIKE xccc_t.xccc211, #本期杂项入库数量
       xccc212 LIKE xccc_t.xccc212, #本期杂项入库金额
       xccc212a LIKE xccc_t.xccc212a, #本期杂项入库金额-材料
       xccc212b LIKE xccc_t.xccc212b, #本期杂项入库金额-人工
       xccc212c LIKE xccc_t.xccc212c, #本期杂项入库金额-加工
       xccc212d LIKE xccc_t.xccc212d, #本期杂项入库金额-制费一
       xccc212e LIKE xccc_t.xccc212e, #本期杂项入库金额-制费二
       xccc212f LIKE xccc_t.xccc212f, #本期杂项入库金额-制费三
       xccc212g LIKE xccc_t.xccc212g, #本期杂项入库金额-制费四
       xccc212h LIKE xccc_t.xccc212h, #本期杂项入库金额-制费五
       xccc213 LIKE xccc_t.xccc213, #本期调整入库数量
       xccc214 LIKE xccc_t.xccc214, #本期调整入库金额
       xccc214a LIKE xccc_t.xccc214a, #本期调整入库金额-材料
       xccc214b LIKE xccc_t.xccc214b, #本期调整入库金额-人工
       xccc214c LIKE xccc_t.xccc214c, #本期调整入库金额-加工
       xccc214d LIKE xccc_t.xccc214d, #本期调整入库金额-制费一
       xccc214e LIKE xccc_t.xccc214e, #本期调整入库金额-制费二
       xccc214f LIKE xccc_t.xccc214f, #本期调整入库金额-制费三
       xccc214g LIKE xccc_t.xccc214g, #本期调整入库金额-制费四
       xccc214h LIKE xccc_t.xccc214h, #本期调整入库金额-制费五
       xccc215 LIKE xccc_t.xccc215, #本期销退入库数量
       xccc216 LIKE xccc_t.xccc216, #本期销退入库金额
       xccc216a LIKE xccc_t.xccc216a, #本期销退入库金额-材料
       xccc216b LIKE xccc_t.xccc216b, #本期销退入库金额-人工
       xccc216c LIKE xccc_t.xccc216c, #本期销退入库金额-加工
       xccc216d LIKE xccc_t.xccc216d, #本期销退入库金额-制费一
       xccc216e LIKE xccc_t.xccc216e, #本期销退入库金额-制费二
       xccc216f LIKE xccc_t.xccc216f, #本期销退入库金额-制费三
       xccc216g LIKE xccc_t.xccc216g, #本期销退入库金额-制费四
       xccc216h LIKE xccc_t.xccc216h, #本期销退入库金额-制费五
       xccc217 LIKE xccc_t.xccc217, #本期调拨入库数量
       xccc218 LIKE xccc_t.xccc218, #本期调拨入库金额
       xccc218a LIKE xccc_t.xccc218a, #本期调拨入库金额-材料
       xccc218b LIKE xccc_t.xccc218b, #本期调拨入库金额-人工
       xccc218c LIKE xccc_t.xccc218c, #本期调拨入库金额-加工
       xccc218d LIKE xccc_t.xccc218d, #本期调拨入库金额-制费一
       xccc218e LIKE xccc_t.xccc218e, #本期调拨入库金额-制费二
       xccc218f LIKE xccc_t.xccc218f, #本期调拨入库金额-制费三
       xccc218g LIKE xccc_t.xccc218g, #本期调拨入库金额-制费四
       xccc218h LIKE xccc_t.xccc218h, #本期调拨入库金额-制费五
       xccc280 LIKE xccc_t.xccc280, #本期平均单价
       xccc280a LIKE xccc_t.xccc280a, #本期平均单价-材料
       xccc280b LIKE xccc_t.xccc280b, #本期平均单价-人工
       xccc280c LIKE xccc_t.xccc280c, #本期平均单价-加工
       xccc280d LIKE xccc_t.xccc280d, #本期平均单价-制费一
       xccc280e LIKE xccc_t.xccc280e, #本期平均单价-制费二
       xccc280f LIKE xccc_t.xccc280f, #本期平均单价-制费三
       xccc280g LIKE xccc_t.xccc280g, #本期平均单价-制费四
       xccc280h LIKE xccc_t.xccc280h, #本期平均单价-制费五
       xccc301 LIKE xccc_t.xccc301, #本期工单领用数量
       xccc302 LIKE xccc_t.xccc302, #本期工单领用金额
       xccc302a LIKE xccc_t.xccc302a, #本期工单领用金额-材料
       xccc302b LIKE xccc_t.xccc302b, #本期工单领用金额-人工
       xccc302c LIKE xccc_t.xccc302c, #本期工单领用金额-加工
       xccc302d LIKE xccc_t.xccc302d, #本期工单领用金额-制费一
       xccc302e LIKE xccc_t.xccc302e, #本期工单领用金额-制费二
       xccc302f LIKE xccc_t.xccc302f, #本期工单领用金额-制费三
       xccc302g LIKE xccc_t.xccc302g, #本期工单领用金额-制费四
       xccc302h LIKE xccc_t.xccc302h, #本期工单领用金额-制费五
       xccc303 LIKE xccc_t.xccc303, #本期销货数量
       xccc304 LIKE xccc_t.xccc304, #本期销货成本
       xccc304a LIKE xccc_t.xccc304a, #本期销货成本-材料
       xccc304b LIKE xccc_t.xccc304b, #本期销货成本-人工
       xccc304c LIKE xccc_t.xccc304c, #本期销货成本-加工
       xccc304d LIKE xccc_t.xccc304d, #本期销货成本-制费一
       xccc304e LIKE xccc_t.xccc304e, #本期销货成本-制费二
       xccc304f LIKE xccc_t.xccc304f, #本期销货成本-制费三
       xccc304g LIKE xccc_t.xccc304g, #本期销货成本-制费四
       xccc304h LIKE xccc_t.xccc304h, #本期销货成本-制费五
       xccc305 LIKE xccc_t.xccc305, #本期销退数量
       xccc306 LIKE xccc_t.xccc306, #本期销退成本
       xccc306a LIKE xccc_t.xccc306a, #本期销退成本-材料
       xccc306b LIKE xccc_t.xccc306b, #本期销退成本-人工
       xccc306c LIKE xccc_t.xccc306c, #本期销退成本-加工
       xccc306d LIKE xccc_t.xccc306d, #本期销退成本-制费一
       xccc306e LIKE xccc_t.xccc306e, #本期销退成本-制费二
       xccc306f LIKE xccc_t.xccc306f, #本期销退成本-制费三
       xccc306g LIKE xccc_t.xccc306g, #本期销退成本-制费四
       xccc306h LIKE xccc_t.xccc306h, #本期销退成本-制费五
       xccc307 LIKE xccc_t.xccc307, #本期销售费用数量
       xccc308 LIKE xccc_t.xccc308, #本期销售费用成本
       xccc308a LIKE xccc_t.xccc308a, #本期销售费用成本-材料
       xccc308b LIKE xccc_t.xccc308b, #本期销售费用成本-人工
       xccc308c LIKE xccc_t.xccc308c, #本期销售费用成本-加工
       xccc308d LIKE xccc_t.xccc308d, #本期销售费用成本-制费一
       xccc308e LIKE xccc_t.xccc308e, #本期销售费用成本-制费二
       xccc308f LIKE xccc_t.xccc308f, #本期销售费用成本-制费三
       xccc308g LIKE xccc_t.xccc308g, #本期销售费用成本-制费四
       xccc308h LIKE xccc_t.xccc308h, #本期销售费用成本-制费五
       xccc309 LIKE xccc_t.xccc309, #本期杂发数量
       xccc310 LIKE xccc_t.xccc310, #本期杂发金额
       xccc310a LIKE xccc_t.xccc310a, #本期杂发金额-材料
       xccc310b LIKE xccc_t.xccc310b, #本期杂发金额-人工
       xccc310c LIKE xccc_t.xccc310c, #本期杂发金额-加工
       xccc310d LIKE xccc_t.xccc310d, #本期杂发金额-制费一
       xccc310e LIKE xccc_t.xccc310e, #本期杂发金额-制费二
       xccc310f LIKE xccc_t.xccc310f, #本期杂发金额-制费三
       xccc310g LIKE xccc_t.xccc310g, #本期杂发金额-制费四
       xccc310h LIKE xccc_t.xccc310h, #本期杂发金额-制费五
       xccc311 LIKE xccc_t.xccc311, #本期盘盈亏数量
       xccc312 LIKE xccc_t.xccc312, #本期盘盈亏金额
       xccc312a LIKE xccc_t.xccc312a, #本期盘盈亏金额-材料
       xccc312b LIKE xccc_t.xccc312b, #本期盘盈亏金额-人工
       xccc312c LIKE xccc_t.xccc312c, #本期盘盈亏金额-加工
       xccc312d LIKE xccc_t.xccc312d, #本期盘盈亏金额-制费一
       xccc312e LIKE xccc_t.xccc312e, #本期盘盈亏金额-制费二
       xccc312f LIKE xccc_t.xccc312f, #本期盘盈亏金额-制费三
       xccc312g LIKE xccc_t.xccc312g, #本期盘盈亏金额-制费四
       xccc312h LIKE xccc_t.xccc312h, #本期盘盈亏金额-制费五
       xccc313 LIKE xccc_t.xccc313, #本期调拨出库数量
       xccc314 LIKE xccc_t.xccc314, #本期调拨出库金额
       xccc314a LIKE xccc_t.xccc314a, #本期调拨出库金额-材料
       xccc314b LIKE xccc_t.xccc314b, #本期调拨出库金额-人工
       xccc314c LIKE xccc_t.xccc314c, #本期调拨出库金额-加工
       xccc314d LIKE xccc_t.xccc314d, #本期调拨出库金额-制费一
       xccc314e LIKE xccc_t.xccc314e, #本期调拨出库金额-制费二
       xccc314f LIKE xccc_t.xccc314f, #本期调拨出库金额-制费三
       xccc314g LIKE xccc_t.xccc314g, #本期调拨出库金额-制费四
       xccc314h LIKE xccc_t.xccc314h, #本期调拨出库金额-制费五
       xccc401 LIKE xccc_t.xccc401, #本期销货收入金额
       xccc402 LIKE xccc_t.xccc402, #本期销退金额
       xccc901 LIKE xccc_t.xccc901, #期末结存数量
       xccc902 LIKE xccc_t.xccc902, #期末结存金额
       xccc902a LIKE xccc_t.xccc902a, #期末结存金额-材料
       xccc902b LIKE xccc_t.xccc902b, #期末结存金额-人工
       xccc902c LIKE xccc_t.xccc902c, #期末结存金额-加工
       xccc902d LIKE xccc_t.xccc902d, #期末结存金额-制费一
       xccc902e LIKE xccc_t.xccc902e, #期末结存金额-制费二
       xccc902f LIKE xccc_t.xccc902f, #期末结存金额-制费三
       xccc902g LIKE xccc_t.xccc902g, #期末结存金额-制费四
       xccc902h LIKE xccc_t.xccc902h, #期末结存金额-制费五
       xccc903 LIKE xccc_t.xccc903, #期末结存调整金额
       xccc903a LIKE xccc_t.xccc903a, #期末结存调整金额-材料
       xccc903b LIKE xccc_t.xccc903b, #期末结存调整金额-人工
       xccc903c LIKE xccc_t.xccc903c, #期末结存调整金额-加工
       xccc903d LIKE xccc_t.xccc903d, #期末结存调整金额-制费一
       xccc903e LIKE xccc_t.xccc903e, #期末结存调整金额-制费二
       xccc903f LIKE xccc_t.xccc903f, #期末结存调整金额-制费三
       xccc903g LIKE xccc_t.xccc903g, #期末结存调整金额-制费四
       xccc903h LIKE xccc_t.xccc903h, #期末结存调整金额-制费五
       xccctime LIKE xccc_t.xccctime  #最近成本计算时间
END RECORD
#161124-00048#21 add(e)
DEFINE l_sql           STRING
DEFINE l_sql1          STRING
DEFINE l_rate          LIKE type_t.num26_10
DEFINE l_rate1         LIKE type_t.num26_10
DEFINE ld_date         DATETIME YEAR TO SECOND
#20150805--add--str--lujh
DEFINE l_imaa009       LIKE imaa_t.imaa009       
DEFINE l_ooaa002       LIKE ooaa_t.ooaa002
#20150805--add--end--lujh
DEFINE ls_wc3 STRING  #add by zhr 151228 

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceasite  = g_xcea_m.xceasite
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt,xceasite)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea004,g_xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceasite) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET l_sql = " SELECT SUM(xccc202), ",
               "        SUM(xccc202a),SUM(xccc202b),SUM(xccc202c),SUM(xccc202d),",
               "        SUM(xccc202e),SUM(xccc202f),SUM(xccc202g),SUM(xccc202h) ",
               "        FROM xccc_t ", 
               "  WHERE xcccent = '",g_enterprise,"' AND xcccld = '",g_xcea_m.xceald,"'",
               "    AND xccc003 = '",g_xcea_m.xcea003,"' AND xccc004 = ",g_xcea004,
               "    AND xccc005 = ",g_xcea005,
               "    AND xccc002 = ? AND xccc008 = ? AND xccc006 = ?",
               "    AND xccc903 <> 0 ",
               "    AND xccc007 = ? " 
   
   LET g_sql = l_sql CLIPPED," AND xccc001 = '2' " 
   DECLARE xcae_prep8 CURSOR FROM g_sql
   
   LET g_sql = l_sql CLIPPED," AND xccc001 = '3' " 
   DECLARE xcae_prep9 CURSOR FROM g_sql
   
   LET l_sql = " SELECT xccc002,xccc008,xccc006,xccc007,SUM(xccc903), ",
               "        SUM(xccc903a),SUM(xccc903b),SUM(xccc903c),SUM(xccc903d),",
               "        SUM(xccc903e),SUM(xccc903f),SUM(xccc903g),SUM(xccc903h) ",
               "        FROM xccc_t ", 
               "  WHERE xcccent = '",g_enterprise,"' AND xcccld = '",g_xcea_m.xceald,"'",
               "    AND xccc003 = '",g_xcea_m.xcea003,"' AND xccc004 = ",g_xcea004,
               "    AND xccc903 <> 0 ",
               #160524-00015#1----s
               #"    AND xccc002 = '",g_xcea_m.xceasite,"' ",   
               "     AND ((xccc002 <> ' ' AND xccc002 = '",g_xcea_m.xceasite,"' ) OR (xccc002 = ' ' AND xccccomp = '",g_xcea_m.xceacomp,"' ) )  ",
               #160524-00015#1----e
               "    AND xccc005 = ",g_xcea005
   LET l_sql1 = l_sql CLIPPED," AND xccc001 = '1' ",
                " GROUP BY xccc002,xccc008,xccc006,xccc007",
                " ORDER BY xccc002,xccc008,xccc006,xccc007"
   PREPARE xcae_prep7 FROM l_sql1
   DECLARE xcae_curs7 CURSOR FOR xcae_prep7
   
   FOREACH xcae_curs7 INTO  l_xccc.xccc002,l_xccc.xccc008,l_xccc.xccc006,l_xccc.xccc007,
                            l_xccc.xccc903,l_xccc.xccc903a,l_xccc.xccc903b,l_xccc.xccc903c,
                            l_xccc.xccc903d,l_xccc.xccc903e,l_xccc.xccc903f,l_xccc.xccc903g,l_xccc.xccc903h      
      
      IF g_glaa015 ='Y' THEN      
         OPEN xcae_prep8 USING  l_xccc.xccc002,l_xccc.xccc008,l_xccc.xccc006,l_xccc.xccc007
         FETCH xcae_prep8 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep8
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
         OPEN xcae_prep9 USING  l_xccc.xccc002,l_xccc.xccc008,l_xccc.xccc006,l_xccc.xccc007
         FETCH xcae_prep9 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep9
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF
       
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 
      
      LET l_xceb.xcebent  = g_enterprise
      LET l_xceb.xcebld   = g_xcea_m.xceald
      LET l_xceb.xcebdocno= g_xcea_m.xceadocno
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xceb001  = ''
      LET l_xceb.xceb002  = ''
      LET l_xceb.xceb003  = ''
      LET l_xceb.xceb004  = l_xccc.xccc006
      LET l_xceb.xceb005  = l_xccc.xccc007
      LET l_xceb.xceb102  = ''
      LET l_xceb.xceb103  = l_xccc.xccc002
      LET l_xceb.xceb201  = 0
      LET l_xceb.xceb202  = l_xccc.xccc903
      LET l_xceb.xceb202a = l_xccc.xccc903a
      LET l_xceb.xceb202b = l_xccc.xccc903b
      LET l_xceb.xceb202c = l_xccc.xccc903c
      LET l_xceb.xceb202d = l_xccc.xccc903d
      LET l_xceb.xceb202e = l_xccc.xccc903e
      LET l_xceb.xceb202f = l_xccc.xccc903f
      LET l_xceb.xceb202g = l_xccc.xccc903g
      LET l_xceb.xceb202h = l_xccc.xccc903h
       
      #20150805--mod--str--lujh 
      #SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
      # WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp
      #   AND imag001 = l_xceb.xceb004
      SELECT imaa009 INTO l_imaa009 
        FROM imaa_t
       WHERE imaaent = g_enterprise
         AND imaa001 = l_xceb.xceb004
      #品类管理层级aoos010
      CALL cl_get_para(g_enterprise,'','E-CIR-0001') RETURNING l_ooaa002
      
      SELECT rtaw001 INTO l_xceb.xceb117
        FROM rtaw_t
       WHERE rtawent = g_enterprise
         AND rtaw002 = l_imaa009
         AND rtaw003 = l_ooaa002
      #20150805--mod--end--lujh

     LET l_xceb.xceb101 = ''
      #存貨科目
      #CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
      #  RETURNING l_success,l_xceb.xceb101
      SELECT glab007 INTO l_xceb.xceb101 FROM glab_t
       WHERE glabent = g_enterprise
         AND glabld = g_xcea_m.xceald
         AND glab001 = 'RTAX'
         AND glab002 = '1'
         AND glab003 = l_xceb.xceb117        

      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' '
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','10') RETURNING l_success,l_xceb.xceb102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF
     #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
     
     IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
      
     INITIALIZE l_xcec.* TO NULL
     
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 

 
      LET l_xcec.xcecent = g_enterprise
      LET l_xcec.xcecld  = g_xcea_m.xceald
      LET l_xcec.xceccomp  = g_xcea_m.xceacomp
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      LET l_xcec.xcec001 = ''
      LET l_xcec.xcec002 = ''
      LET l_xcec.xcec003 = ''
      LET l_xcec.xcec004 = l_xccc.xccc006
      LET l_xcec.xcec005 = l_xccc.xccc007
      LET l_xcec.xcec101 = ''
#抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','8') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      LET l_xcec.xcec102 = ''
      LET l_xcec.xcec103 = l_xccc.xccc002
      LET l_xcec.xcec117 = l_xceb.xceb117
      LET l_xcec.xcec119 = l_xceb.xceb119
      LET l_xcec.xcec201 = 0
      LET l_xcec.xcec202 = l_xccc.xccc903
      LET l_xcec.xcec202a = l_xccc.xccc903a
      LET l_xcec.xcec202b = l_xccc.xccc903b
      LET l_xcec.xcec202c = l_xccc.xccc903c
      LET l_xcec.xcec202d = l_xccc.xccc903d
      LET l_xcec.xcec202e = l_xccc.xccc903e
      LET l_xcec.xcec202f = l_xccc.xccc903f
      LET l_xcec.xcec202g = l_xccc.xccc903g
      LET l_xcec.xcec202h = l_xccc.xccc903h
      LET l_xcec.xcec212 = l_xceb.xceb212
      LET l_xcec.xcec212a = l_xceb.xceb212a
      LET l_xcec.xcec212b = l_xceb.xceb212b
      LET l_xcec.xcec212c = l_xceb.xceb212c
      LET l_xcec.xcec212d = l_xceb.xceb212d
      LET l_xcec.xcec212e = l_xceb.xceb212e
      LET l_xcec.xcec212f = l_xceb.xceb212f
      LET l_xcec.xcec212g = l_xceb.xceb212g
      LET l_xcec.xcec212h = l_xceb.xceb212h
      LET l_xcec.xcec222 = l_xceb.xceb222
      LET l_xcec.xcec222a = l_xceb.xceb222a
      LET l_xcec.xcec222b = l_xceb.xceb222b
      LET l_xcec.xcec222c = l_xceb.xceb222c
      LET l_xcec.xcec222d = l_xceb.xceb222d
      LET l_xcec.xcec222e = l_xceb.xceb222e
      LET l_xcec.xcec222f = l_xceb.xceb222f
      LET l_xcec.xcec222g = l_xceb.xceb222g
      LET l_xcec.xcec222h = l_xceb.xceb222h
      LET l_xcec.xcec107 = l_xceb.xceb107
      LET l_xcec.xcec108 = l_xceb.xceb108
      LET l_xcec.xcec109 = l_xceb.xceb109
      LET l_xcec.xcec121 = l_xceb.xceb121
      LET l_xcec.xcec122 = l_xceb.xceb122
      LET l_xcec.xcec123 = l_xceb.xceb123
      LET l_xcec.xcec124 = l_xceb.xceb124
      LET l_xcec.xcec125 = l_xceb.xceb125
      LET l_xcec.xcec126 = l_xceb.xceb126
      LET l_xcec.xcec127 = l_xceb.xceb127
      LET l_xcec.xcec128 = l_xceb.xceb128
      LET l_xcec.xcec129 = l_xceb.xceb129
      LET l_xcec.xcec130 = l_xceb.xceb130
 
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','10') RETURNING l_success,l_xcec.xcec102
      END IF
      #20150805--mark--str--lujh
      #CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
      #                                                       l_xceb.xceb101,
      #                                                       l_xceb.xceb102,
      #                                                       l_xceb.xceb103,
      #                                                       l_xceb.xceb110,
      #                                                       l_xceb.xceb111,
      #                                                       l_xceb.xceb112,
      #                                                       l_xceb.xceb113,
      #                                                       l_xceb.xceb114,
      #                                                       l_xceb.xceb115,
      #                                                       l_xceb.xceb116,
      #                                                       l_xceb.xceb117,
      #                                                       l_xceb.xceb118,
      #                                                       l_xceb.xceb119,
      #                                                       l_xceb.xceb120,
      #                                                       l_xceb.xceb107,
      #                                                       l_xceb.xceb108,
      #                                                       l_xceb.xceb109,
      #                                                       l_xceb.xceb121,
      #                                                       l_xceb.xceb122,
      #                                                       l_xceb.xceb123,
      #                                                       l_xceb.xceb124,
      #                                                       l_xceb.xceb125,
      #                                                       l_xceb.xceb126,
      #                                                       l_xceb.xceb127,
      #                                                       l_xceb.xceb128,
      #                                                       l_xceb.xceb129,
      #                                                       l_xceb.xceb130
      #20150805--mark--end--lujh      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF       
#      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
         LET g_success = 'N'
         EXIT FOREACH
      END IF
      
      
      CLOSE xcae_prep8
      CLOSE xcae_prep9
   END FOREACH   
   RETURN g_success 
END FUNCTION

#发出商品
#add zhangllc 151009
PRIVATE FUNCTION axct901_01_ins_11()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
#161124-00048#21 mark(s)
#DEFINE l_xcea          RECORD LIKE xcea_t.*
#DEFINE l_xceb          RECORD LIKE xceb_t.*
#DEFINE l_xcec          RECORD LIKE xcec_t.*
#DEFINE l_xckb          RECORD LIKE xckb_t.*
#161124-00048#21 mark(e)
#161124-00048#21 add(s)
DEFINE l_xckb RECORD  #發出商品統計檔
       xckbent LIKE xckb_t.xckbent, #企业编号
       xckbcomp LIKE xckb_t.xckbcomp, #法人
       xckbld LIKE xckb_t.xckbld, #账套
       xckb001 LIKE xckb_t.xckb001, #来源
       xckb002 LIKE xckb_t.xckb002, #方向
       xckb003 LIKE xckb_t.xckb003, #发票号码
       xckb004 LIKE xckb_t.xckb004, #据点site
       xckb005 LIKE xckb_t.xckb005, #出货单号
       xckb006 LIKE xckb_t.xckb006, #出货项次
       xckb007 LIKE xckb_t.xckb007, #年度
       xckb008 LIKE xckb_t.xckb008, #期别
       xckb009 LIKE xckb_t.xckb009, #客户编号
       xckb010 LIKE xckb_t.xckb010, #人员编号
       xckb011 LIKE xckb_t.xckb011, #部门编号
       xckb012 LIKE xckb_t.xckb012, #产品编号
       xckb013 LIKE xckb_t.xckb013, #销售单位
       xckb014 LIKE xckb_t.xckb014, #数量
       xckb015 LIKE xckb_t.xckb015, #仓库编号
       xckb016 LIKE xckb_t.xckb016, #库位编号
       xckb017 LIKE xckb_t.xckb017, #批号
       xckb018 LIKE xckb_t.xckb018, #no use
       xckb019 LIKE xckb_t.xckb019, #发票编号
       xckb020 LIKE xckb_t.xckb020, #库存单位
       xckb021 LIKE xckb_t.xckb021, #库存数量
       xckb022 LIKE xckb_t.xckb022, #科目编号
       xckb023 LIKE xckb_t.xckb023, #多角贸易否
       xckb024 LIKE xckb_t.xckb024, #开票年度
       xckb025 LIKE xckb_t.xckb025, #开票期别
       xckb026 LIKE xckb_t.xckb026, #币种一
       xckb027 LIKE xckb_t.xckb027, #金额
       xckb028 LIKE xckb_t.xckb028, #币种二
       xckb029 LIKE xckb_t.xckb029, #金额
       xckb030 LIKE xckb_t.xckb030, #币种三
       xckb031 LIKE xckb_t.xckb031, #金额
       xckb032 LIKE xckb_t.xckb032, #no use
       xckb033 LIKE xckb_t.xckb033, #no use
       xckb034 LIKE xckb_t.xckb034, #no use
       xckb035 LIKE xckb_t.xckb035, #no use
       xckb036 LIKE xckb_t.xckb036, #项序
       xckb037 LIKE xckb_t.xckb037, #特性
       xckb101 LIKE xckb_t.xckb101, #币种一成本单价
       xckb101a LIKE xckb_t.xckb101a, #币种一成本单价-材料
       xckb101b LIKE xckb_t.xckb101b, #币种一成本单价-人工
       xckb101c LIKE xckb_t.xckb101c, #币种一成本单价-加工
       xckb101d LIKE xckb_t.xckb101d, #币种一成本单价-制费一
       xckb101e LIKE xckb_t.xckb101e, #币种一成本单价-制费二
       xckb101f LIKE xckb_t.xckb101f, #币种一成本单价-制费三
       xckb101g LIKE xckb_t.xckb101g, #币种一成本单价-制费四
       xckb101h LIKE xckb_t.xckb101h, #币种一成本单价-制费五
       xckb102 LIKE xckb_t.xckb102, #币种一成本金额
       xckb102a LIKE xckb_t.xckb102a, #币种一成本金额-材料
       xckb102b LIKE xckb_t.xckb102b, #币种一成本金额-人工
       xckb102c LIKE xckb_t.xckb102c, #币种一成本金额-加工
       xckb102d LIKE xckb_t.xckb102d, #币种一成本金额-制费一
       xckb102e LIKE xckb_t.xckb102e, #币种一成本金额-制费二
       xckb102f LIKE xckb_t.xckb102f, #币种一成本金额-制费三
       xckb102g LIKE xckb_t.xckb102g, #币种一成本金额-制费四
       xckb102h LIKE xckb_t.xckb102h, #币种一成本金额-制费五
       xckb111 LIKE xckb_t.xckb111, #币种二成本单价
       xckb111a LIKE xckb_t.xckb111a, #币种二成本单价-材料
       xckb111b LIKE xckb_t.xckb111b, #币种二成本单价-人工
       xckb111c LIKE xckb_t.xckb111c, #币种二成本单价-加工
       xckb111d LIKE xckb_t.xckb111d, #币种二成本单价-制费一
       xckb111e LIKE xckb_t.xckb111e, #币种二成本单价-制费二
       xckb111f LIKE xckb_t.xckb111f, #币种二成本单价-制费三
       xckb111g LIKE xckb_t.xckb111g, #币种二成本单价-制费四
       xckb111h LIKE xckb_t.xckb111h, #币种二成本单价-制费五
       xckb112 LIKE xckb_t.xckb112, #币种二成本金额
       xckb112a LIKE xckb_t.xckb112a, #币种二成本金额-材料
       xckb112b LIKE xckb_t.xckb112b, #币种二成本金额-人工
       xckb112c LIKE xckb_t.xckb112c, #币种二成本金额-加工
       xckb112d LIKE xckb_t.xckb112d, #币种二成本金额-制费一
       xckb112e LIKE xckb_t.xckb112e, #币种二成本金额-制费二
       xckb112f LIKE xckb_t.xckb112f, #币种二成本金额-制费三
       xckb112g LIKE xckb_t.xckb112g, #币种二成本金额-制费四
       xckb112h LIKE xckb_t.xckb112h, #币种二成本金额-制费五
       xckb121 LIKE xckb_t.xckb121, #币种三成本单价
       xckb121a LIKE xckb_t.xckb121a, #币种三成本单价-材料
       xckb121b LIKE xckb_t.xckb121b, #币种三成本单价-人工
       xckb121c LIKE xckb_t.xckb121c, #币种三成本单价-加工
       xckb121d LIKE xckb_t.xckb121d, #币种三成本单价-制费一
       xckb121e LIKE xckb_t.xckb121e, #币种三成本单价-制费二
       xckb121f LIKE xckb_t.xckb121f, #币种三成本单价-制费三
       xckb121g LIKE xckb_t.xckb121g, #币种三成本单价-制费四
       xckb121h LIKE xckb_t.xckb121h, #币种三成本单价-制费五
       xckb122 LIKE xckb_t.xckb122, #币种三成本金额
       xckb122a LIKE xckb_t.xckb122a, #币种三成本金额-材料
       xckb122b LIKE xckb_t.xckb122b, #币种三成本金额-人工
       xckb122c LIKE xckb_t.xckb122c, #币种三成本金额-加工
       xckb122d LIKE xckb_t.xckb122d, #币种三成本金额-制费一
       xckb122e LIKE xckb_t.xckb122e, #种三成本金额-制费二
       xckb122f LIKE xckb_t.xckb122f, #币种三成本金额-制费三
       xckb122g LIKE xckb_t.xckb122g, #币种三成本金额-制费四
       xckb122h LIKE xckb_t.xckb122h, #币种三成本金额-制费五
       xckb038 LIKE xckb_t.xckb038  #成本域
END RECORD
DEFINE l_xcea RECORD  #工單發料成本憑證單頭檔
       xceaent LIKE xcea_t.xceaent, #企业编号
       xceacomp LIKE xcea_t.xceacomp, #法人组织
       xceald LIKE xcea_t.xceald, #账套
       xceadocno LIKE xcea_t.xceadocno, #单据编号
       xcea001 LIKE xcea_t.xcea001, #单据日期
       xcea002 LIKE xcea_t.xcea002, #成本凭证类型
       xcea003 LIKE xcea_t.xcea003, #成本计算类型
       xcea004 LIKE xcea_t.xcea004, #年度
       xcea005 LIKE xcea_t.xcea005, #期别
       xcea006 LIKE xcea_t.xcea006, #账务人员
       xcea007 LIKE xcea_t.xcea007, #账务部门
       xcea101 LIKE xcea_t.xcea101, #凭证编号
       xcea102 LIKE xcea_t.xcea102, #凭证日期
       xceaownid LIKE xcea_t.xceaownid, #资料所有者
       xceaowndp LIKE xcea_t.xceaowndp, #资料所有部门
       xceacrtid LIKE xcea_t.xceacrtid, #资料录入者
       xceacrtdp LIKE xcea_t.xceacrtdp, #资料录入部门
       xceacrtdt LIKE xcea_t.xceacrtdt, #资料创建日
       xceamodid LIKE xcea_t.xceamodid, #资料更改者
       xceamoddt LIKE xcea_t.xceamoddt, #最近更改日
       xceacnfid LIKE xcea_t.xceacnfid, #资料审核者
       xceacnfdt LIKE xcea_t.xceacnfdt, #数据审核日
       xceapstid LIKE xcea_t.xceapstid, #资料过账者
       xceapstdt LIKE xcea_t.xceapstdt, #资料过账日
       xceastus LIKE xcea_t.xceastus, #状态码
       xceasite LIKE xcea_t.xceasite  #营运据点
END RECORD
DEFINE l_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
#161124-00048#21 add(e)
DEFINE l_sql           STRING
DEFINE l_sql1          STRING
DEFINE l_rate          LIKE type_t.num26_10
DEFINE l_rate1         LIKE type_t.num26_10
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaent   = g_enterprise
   LET l_xcea.xceacomp  = g_xcea_m.xceacomp
   LET l_xcea.xceald    = g_xcea_m.xceald
   LET l_xcea.xcea001   = g_xcea_m.xcea001
   LET l_xcea.xcea002   = g_xcea002   #11转入 12转出
   LET l_xcea.xcea003   = g_xcea_m.xcea003
   LET l_xcea.xcea004   = g_xcea004
   LET l_xcea.xcea005   = g_xcea005
   LET l_xcea.xcea006   = g_xcea_m.xcea006
   LET l_xcea.xcea007   = g_xcea_m.xcea007
   LET l_xcea.xcea101   = ''
   LET l_xcea.xcea102   = ''
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   LET l_xcea.xceacnfid = ""
   LET l_xcea.xceacnfdt = ""
   LET l_xcea.xceapstid = ""
   LET l_xcea.xceapstdt = ""
   LET l_xcea.xceastus  = 'N'
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,l_xcea.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET g_success = 'N'
      RETURN g_success
   END IF
#   INSERT INTO xcea_t VALUES(l_xcea.*)  #161124-00048#21 mark
   #161124-00048#21 add(s)
   INSERT INTO xcea_t(xceaent,xceacomp,xceald,xceadocno,xcea001,xcea002,xcea003,xcea004,xcea005,
                      xcea006,xcea007,xcea101,xcea102,xceaownid,xceaowndp,xceacrtid,xceacrtdp,
                      xceacrtdt,xceamodid,xceamoddt,xceacnfid,xceacnfdt,xceapstid,xceapstdt,xceastus,xceasite) 
               VALUES(l_xcea.xceaent,l_xcea.xceacomp,l_xcea.xceald,l_xcea.xceadocno,l_xcea.xcea001,l_xcea.xcea002,l_xcea.xcea003,l_xcea.xcea004,l_xcea.xcea005,
                      l_xcea.xcea006,l_xcea.xcea007,l_xcea.xcea101,l_xcea.xcea102,l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid,l_xcea.xceacrtdp,
                      l_xcea.xceacrtdt,l_xcea.xceamodid,l_xcea.xceamoddt,l_xcea.xceacnfid,l_xcea.xceacnfdt,l_xcea.xceapstid,l_xcea.xceapstdt,l_xcea.xceastus,l_xcea.xceasite)
   #161124-00048#21 add(e)
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "xcea_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET g_success = 'N'
      RETURN g_success
   END IF
   LET g_xcea_m.xceadocno = l_xcea.xceadocno
   
   #xceb单身
#   LET l_sql = " SELECT * FROM xckb_t ",  #161124-00048#21 mark
   #161124-00048#21 add(s)
   LET l_sql = " SELECT xckbent,xckbcomp,xckbld,xckb001,xckb002,xckb003,xckb004,xckb005,xckb006,        ",
               "        xckb007,xckb008,xckb009,xckb010,xckb011,xckb012,xckb013,xckb014,xckb015,        ",
               "        xckb016,xckb017,xckb018,xckb019,xckb020,xckb021,xckb022,xckb023,xckb024,        ",
               "        xckb025,xckb026,xckb027,xckb028,xckb029,xckb030,xckb031,xckb032,xckb033,        ",
               "        xckb034,xckb035,xckb036,xckb037,xckb101,xckb101a,xckb101b,xckb101c,xckb101d,    ",
               "        xckb101e,xckb101f,xckb101g,xckb101h,xckb102,xckb102a,xckb102b,xckb102c,xckb102d,",
               "        xckb102e,xckb102f,xckb102g,xckb102h,xckb111,xckb111a,xckb111b,xckb111c,xckb111d,",
               "        xckb111e,xckb111f,xckb111g,xckb111h,xckb112,xckb112a,xckb112b,xckb112c,xckb112d,",
               "        xckb112e,xckb112f,xckb112g,xckb112h,xckb121,xckb121a,xckb121b,xckb121c,xckb121d,",
               "        xckb121e,xckb121f,xckb121g,xckb121h,xckb122,xckb122a,xckb122b,xckb122c,xckb122d,",
               "        xckb122e,xckb122f,xckb122g,xckb122h,xckb038 FROM xckb_t ",
   #161124-00048#21 add(e)
               "  WHERE xckbent = '",g_enterprise,"' AND xckbld = '",g_xcea_m.xceald,"'",
               "    AND xckbcomp= '",g_xcea_m.xceacomp,"' ",
               "    AND xckb007 = ",g_xcea004," AND xckb008 = ",g_xcea005, #年度，期別
               "    AND xckb102 <> 0 "  #成本金额
   IF  l_xcea.xcea002 = '11' THEN  #11转入 12转出
       LET l_sql = l_sql CLIPPED," AND xckb002 = 1 "  #转入
   ELSE
       LET l_sql = l_sql CLIPPED," AND xckb002 = -1 "  #转出
   END IF
   PREPARE axct901_01_ins_11_p1 FROM l_sql
   DECLARE axct901_01_ins_11_c1 CURSOR FOR axct901_01_ins_11_p1
   FOREACH axct901_01_ins_11_c1 INTO  l_xckb.*     
      
      INITIALIZE l_xceb.* TO NULL
       
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 
      
      LET l_xceb.xcebent  = g_enterprise
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld   = g_xcea_m.xceald
      LET l_xceb.xcebdocno= g_xcea_m.xceadocno
      LET l_xceb.xceb001  = l_xckb.xckb005  #參考單據編號
      LET l_xceb.xceb002  = l_xckb.xckb006  #參考單據項次
      LET l_xceb.xceb003  = '9'             #單據類型--发出商品
      LET l_xceb.xceb004  = l_xckb.xckb012  #料件編號
      LET l_xceb.xceb005  = l_xckb.xckb037  #特性
      
      LET l_xceb.xceb101 = ''               #科目编号
      IF g_xcea002='11' THEN   #11转入 12转出
         #发出商品
         CALL s_get_item_acc(g_xcea_m.xceald,'17',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
           RETURNING l_success,l_xceb.xceb101 
      ELSE
         #销售收入
         CALL s_get_item_acc(g_xcea_m.xceald,'5',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
           RETURNING l_success,l_xceb.xceb101 
      END IF
      
      LET l_xceb.xceb102  = ''              #摘要
      #摘要
      IF g_xcea002='11' THEN   #11转入 12转出
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','11') RETURNING l_success,l_xceb.xceb102
      ELSE
         CALL axct901_01_get_summ(g_xcea_m.xceald,'61','8925','12') RETURNING l_success,l_xceb.xceb102
      END IF
      
      LET l_xceb.xceb103  = l_xckb.xckb038  #成本域
      LET l_xceb.xceb110 = ' '  #原因碼
      
      LET l_xceb.xceb111 = ' '  #交易對象
      LET l_xceb.xceb112 = ' '  #客群
      LET l_xceb.xceb113 = ' '  #區域
      LET l_xceb.xceb114 = ' '  #成本中心
      LET l_xceb.xceb115 = ' '  #經營類別
      LET l_xceb.xceb116 = ' '  #渠道
      LET l_xceb.xceb119 = ' '  #項目號
      LET l_xceb.xceb120 = ' '  #WBS
      LET l_xceb.xceb107 = ' '  #人员
      LET l_xceb.xceb108 = ' '  #部门
      SELECT xmdk008,pmaa090,xmdl222,ooeg004,xmdl216,xmdl200,xmdl030,xmdl031,xmdl213,xmdl214
        INTO l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb107,l_xceb.xceb108
        FROM xmdk_t LEFT JOIN pmaa_t ON pmaaent = xmdkent AND pmaa001=xmdk008 ,
             xmdl_t LEFT JOIN ooeg_t ON ooegent = xmdlent AND ooeg001=xmdl214 AND ooeg003='3' #成本中心
       WHERE xmdkent  = xmdlent
         AND xmdkdocno= xmdldocno
         AND xmdlent  = g_enterprise
         AND xmdldocno= l_xceb.xceb001
         AND xmdlseq  = l_xceb.xceb002
      IF cl_null(l_xceb.xceb114) THEN LET l_xceb.xceb114 = l_xceb.xceb108 END IF  #成本中心为空就为部门
      LET l_xceb.xceb109 = l_xceb.xceb111  #账款对象

      LET l_xceb.xceb117 = ' '  #品類
      LET l_xceb.xceb118 = ' '  #品牌
      SELECT imaa009,imaa126 INTO l_xceb.xceb117,l_xceb.xceb118 FROM imaa_t
       WHERE imaaent = g_enterprise
         AND imaa001 = l_xceb.xceb004

      LET l_xceb.xceb201  = l_xckb.xckb021  #數量
      LET l_xceb.xceb202  = l_xckb.xckb102  #成本金額(本位幣一)
      LET l_xceb.xceb202a = l_xckb.xckb102a #成本-材料(本位幣一)
      LET l_xceb.xceb202b = l_xckb.xckb102b #成本-人工(本位幣一)
      LET l_xceb.xceb202c = l_xckb.xckb102c #成本-加工(本位幣一)
      LET l_xceb.xceb202d = l_xckb.xckb102d #成本-制費一(本位幣一)
      LET l_xceb.xceb202e = l_xckb.xckb102e #成本-制費二(本位幣一)
      LET l_xceb.xceb202f = l_xckb.xckb102f #成本-制費三(本位幣一)
      LET l_xceb.xceb202g = l_xckb.xckb102g #成本-制費四(本位幣一)
      LET l_xceb.xceb202h = l_xckb.xckb102h #成本-制費五(本位幣一)
      LET l_xceb.xceb212  = l_xckb.xckb112  #成本金額(本位幣二)
      LET l_xceb.xceb212a = l_xckb.xckb112a #成本-材料(本位幣二)
      LET l_xceb.xceb212b = l_xckb.xckb112b #成本-人工(本位幣二)
      LET l_xceb.xceb212c = l_xckb.xckb112c #成本-加工(本位幣二)
      LET l_xceb.xceb212d = l_xckb.xckb112d #成本-制費一(本位幣二)
      LET l_xceb.xceb212e = l_xckb.xckb112e #成本-制費二(本位幣二)
      LET l_xceb.xceb212f = l_xckb.xckb112f #成本-制費三(本位幣二)
      LET l_xceb.xceb212g = l_xckb.xckb112g #成本-制費四(本位幣二)
      LET l_xceb.xceb212h = l_xckb.xckb112h #成本-制費五(本位幣二)
      LET l_xceb.xceb222  = l_xckb.xckb122  #成本金額(本位幣三)
      LET l_xceb.xceb222a = l_xckb.xckb122a #成本-材料(本位幣三)
      LET l_xceb.xceb222b = l_xckb.xckb122b #成本-人工(本位幣三)
      LET l_xceb.xceb222c = l_xckb.xckb122c #成本-加工(本位幣三)
      LET l_xceb.xceb222d = l_xckb.xckb122d #成本-制費一(本位幣三)
      LET l_xceb.xceb222e = l_xckb.xckb122e #成本-制費二(本位幣三)
      LET l_xceb.xceb222f = l_xckb.xckb122f #成本-制費三(本位幣三)
      LET l_xceb.xceb222g = l_xckb.xckb122g #成本-制費四(本位幣三)
      LET l_xceb.xceb222h = l_xckb.xckb122h #成本-制費五(本位幣三)

      LET l_xceb.xceb301  = ''    #憑證編號
      LET l_xceb.xceb302  = ''    #憑證項次
      LET l_xceb.xcebud021= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud022= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud023= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud024= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud025= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud026= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud027= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud028= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud029= ''    #自定義欄位(日期時間)
      LET l_xceb.xcebud030= ''    #自定義欄位(日期時間)
      
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '   #自由核算項1
      LET l_xceb.xceb122 = ' '   #自由核算項2
      LET l_xceb.xceb123 = ' '   #自由核算項3
      LET l_xceb.xceb124 = ' '   #自由核算項4
      LET l_xceb.xceb125 = ' '   #自由核算項5
      LET l_xceb.xceb126 = ' '   #自由核算項6
      LET l_xceb.xceb127 = ' '   #自由核算項7
      LET l_xceb.xceb128 = ' '   #自由核算項8
      LET l_xceb.xceb129 = ' '   #自由核算項9
      LET l_xceb.xceb130 = ' '   #自由核算項10
      
      CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130

      #如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF
      #      INSERT INTO xceb_t VALUES(l_xceb.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xceb_t(xcebent,xcebcomp,xcebld,xcebdocno,xcebseq,xceb001,xceb002,xceb003,xceb004,xceb005,
                         xceb101,xceb102,xceb103,xceb110,xceb111,xceb112,xceb113,xceb114,xceb115,xceb116,
                         xceb117,xceb118,xceb119,xceb120,xceb201,xceb202,xceb202a,xceb202b,xceb202c,xceb202d,
                         xceb202e,xceb202f,xceb202g,xceb202h,xceb212,xceb212a,xceb212b,xceb212c,xceb212d,
                         xceb212e,xceb212f,xceb212g,xceb212h,xceb222,xceb222a,xceb222b,xceb222c,xceb222d,
                         xceb222e,xceb222f,xceb222g,xceb222h,xceb301,xceb302,xceb107,xceb108,xceb109,xceb121,
                         xceb122,xceb123,xceb124,xceb125,xceb126,xceb127,xceb128,xceb129,xceb130,xceb131,xceb132) 
                  VALUES(l_xceb.xcebent,l_xceb.xcebcomp,l_xceb.xcebld,l_xceb.xcebdocno,l_xceb.xcebseq,l_xceb.xceb001,l_xceb.xceb002,l_xceb.xceb003,l_xceb.xceb004,l_xceb.xceb005,
                         l_xceb.xceb101,l_xceb.xceb102,l_xceb.xceb103,l_xceb.xceb110,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                         l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb201,l_xceb.xceb202,l_xceb.xceb202a,l_xceb.xceb202b,l_xceb.xceb202c,l_xceb.xceb202d,
                         l_xceb.xceb202e,l_xceb.xceb202f,l_xceb.xceb202g,l_xceb.xceb202h,l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                         l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h,l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                         l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h,l_xceb.xceb301,l_xceb.xceb302,l_xceb.xceb107,l_xceb.xceb108,l_xceb.xceb109,l_xceb.xceb121,
                         l_xceb.xceb122,l_xceb.xceb123,l_xceb.xceb124,l_xceb.xceb125,l_xceb.xceb126,l_xceb.xceb127,l_xceb.xceb128,l_xceb.xceb129,l_xceb.xceb130,l_xceb.xceb131,l_xceb.xceb132) 
      #161124-00048#21 add(e)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
         LET g_success = 'N'
         EXIT FOREACH
      END IF
       
      INITIALIZE l_xcec.* TO NULL
     
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 
      
      LET l_xcec.xcecent  = g_enterprise       #企業編號
      LET l_xcec.xcecld   = g_xcea_m.xceald    #帳套
      LET l_xcec.xceccomp = g_xcea_m.xceacomp  #法人組織
      LET l_xcec.xcecdocno= g_xcea_m.xceadocno #單據編號
      LET l_xcec.xcec001  = l_xceb.xceb001     #參考單據
      LET l_xcec.xcec002  = l_xceb.xceb002     #參考單據項次
      LET l_xcec.xcec003  = l_xceb.xceb003     #單據類型
      LET l_xcec.xcec004  = l_xceb.xceb004     #料件編號
      LET l_xcec.xcec005  = l_xceb.xceb005     #特性
      
      LET l_xcec.xcec101  = ''                 #科目編號
      IF g_xcea002='11' THEN   #11转入 12转出
         #存貨科目
         CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
           RETURNING l_success,l_xcec.xcec101
      ELSE
         #发出商品
         CALL s_get_item_acc(g_xcea_m.xceald,'17',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
           RETURNING l_success,l_xcec.xcec101 
      END IF
      
      LET l_xcec.xcec102 = l_xceb.xceb102  #摘要
      LET l_xcec.xcec103 = l_xceb.xceb103  #成本域
      LET l_xcec.xcec110 = l_xceb.xceb110  #原因碼
      LET l_xcec.xcec111 = l_xceb.xceb111  #交易對象
      LET l_xcec.xcec112 = l_xceb.xceb112  #客群
      LET l_xcec.xcec113 = l_xceb.xceb113  #區域
      LET l_xcec.xcec114 = l_xceb.xceb114  #成本中心
      LET l_xcec.xcec115 = l_xceb.xceb115  #經營類別
      LET l_xcec.xcec116 = l_xceb.xceb116  #渠道
      LET l_xcec.xcec117 = l_xceb.xceb117  #品類
      LET l_xcec.xcec118 = l_xceb.xceb118  #品牌
      LET l_xcec.xcec119 = l_xceb.xceb119  #項目號
      LET l_xcec.xcec120 = l_xceb.xceb120  #WBS
      LET l_xcec.xcec201 = l_xceb.xceb201  #數量
      LET l_xcec.xcec202 = l_xceb.xceb202  #成本金額(本位幣一)
      LET l_xcec.xcec202a= l_xceb.xceb202a #成本-材料(本位幣一)
      LET l_xcec.xcec202b= l_xceb.xceb202b #成本-人工(本位幣一)
      LET l_xcec.xcec202c= l_xceb.xceb202c #成本-加工(本位幣一)
      LET l_xcec.xcec202d= l_xceb.xceb202d #成本-制費一(本位幣一)
      LET l_xcec.xcec202e= l_xceb.xceb202e #成本-制費二(本位幣一)
      LET l_xcec.xcec202f= l_xceb.xceb202f #成本-制費三(本位幣一)
      LET l_xcec.xcec202g= l_xceb.xceb202g #成本-制費四(本位幣一)
      LET l_xcec.xcec202h= l_xceb.xceb202h #成本-制費五(本位幣一)
      LET l_xcec.xcec212 = l_xceb.xceb212  #成本-金額(本位幣二)
      LET l_xcec.xcec212a= l_xceb.xceb212a
      LET l_xcec.xcec212b= l_xceb.xceb212b
      LET l_xcec.xcec212c= l_xceb.xceb212c
      LET l_xcec.xcec212d= l_xceb.xceb212d
      LET l_xcec.xcec212e= l_xceb.xceb212e
      LET l_xcec.xcec212f= l_xceb.xceb212f
      LET l_xcec.xcec212g= l_xceb.xceb212g
      LET l_xcec.xcec212h= l_xceb.xceb212h
      LET l_xcec.xcec222 = l_xceb.xceb222  #成本-金額(本位幣三)
      LET l_xcec.xcec222a= l_xceb.xceb222a
      LET l_xcec.xcec222b= l_xceb.xceb222b
      LET l_xcec.xcec222c= l_xceb.xceb222c
      LET l_xcec.xcec222d= l_xceb.xceb222d
      LET l_xcec.xcec222e= l_xceb.xceb222e
      LET l_xcec.xcec222f= l_xceb.xceb222f
      LET l_xcec.xcec222g= l_xceb.xceb222g
      LET l_xcec.xcec222h= l_xceb.xceb222h
      LET l_xcec.xcec301 = l_xceb.xceb301  #憑證編號
      LET l_xcec.xcec302 = l_xceb.xceb302  #憑證項次
      LET l_xcec.xcecud021 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud022 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud023 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud024 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud025 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud026 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud027 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud028 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud029 = '' #自定義欄位(日期時間)
      LET l_xcec.xcecud030 = '' #自定義欄位(日期時間)
      LET l_xcec.xcec107 = l_xceb.xceb107 #人員
      LET l_xcec.xcec108 = l_xceb.xceb108 #部門
      LET l_xcec.xcec109 = l_xceb.xceb109 #帳款對象
      LET l_xcec.xcec121 = l_xceb.xceb121 #自由核算項1
      LET l_xcec.xcec122 = l_xceb.xceb122 #自由核算項2
      LET l_xcec.xcec123 = l_xceb.xceb123 #自由核算項3
      LET l_xcec.xcec124 = l_xceb.xceb124 #自由核算項4
      LET l_xcec.xcec125 = l_xceb.xceb125 #自由核算項5
      LET l_xcec.xcec126 = l_xceb.xceb126 #自由核算項6
      LET l_xcec.xcec127 = l_xceb.xceb127 #自由核算項7
      LET l_xcec.xcec128 = l_xceb.xceb128 #自由核算項8
      LET l_xcec.xcec129 = l_xceb.xceb129 #自由核算項9
      LET l_xcec.xcec130 = l_xceb.xceb130 #自由核算項10

      CALL axct901_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF       
#      INSERT INTO xcec_t VALUES(l_xcec.*) #161124-00048#21 mark
      #161124-00048#21 add(s)
      INSERT INTO xcec_t(xcecent,xceccomp,xcecld,xcecdocno,xcecseq,xcec001,xcec002,xcec003,xcec004,
                         xcec005,xcec101,xcec102,xcec103,xcec110,xcec111,xcec112,xcec113,xcec114,
                         xcec115,xcec116,xcec117,xcec118,xcec119,xcec120,xcec201,xcec202,xcec202a,
                         xcec202b,xcec202c,xcec202d,xcec202e,xcec202f,xcec202g,xcec202h,xcec212,
                         xcec212a,xcec212b,xcec212c,xcec212d,xcec212e,xcec212f,xcec212g,xcec212h,
                         xcec222,xcec222a,xcec222b,xcec222c,xcec222d,xcec222e,xcec222f,xcec222g,
                         xcec222h,xcec301,xcec302,xcec107,xcec108,xcec109,xcec121,xcec122,xcec123,
                         xcec124,xcec125,xcec126,xcec127,xcec128,xcec129,xcec130) 
                  VALUES(l_xcec.xcecent,l_xcec.xceccomp,l_xcec.xcecld,l_xcec.xcecdocno,l_xcec.xcecseq,l_xcec.xcec001,l_xcec.xcec002,l_xcec.xcec003,l_xcec.xcec004,
                         l_xcec.xcec005,l_xcec.xcec101,l_xcec.xcec102,l_xcec.xcec103,l_xcec.xcec110,l_xcec.xcec111,l_xcec.xcec112,l_xcec.xcec113,l_xcec.xcec114,
                         l_xcec.xcec115,l_xcec.xcec116,l_xcec.xcec117,l_xcec.xcec118,l_xcec.xcec119,l_xcec.xcec120,l_xcec.xcec201,l_xcec.xcec202,l_xcec.xcec202a,
                         l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,l_xcec.xcec202g,l_xcec.xcec202h,l_xcec.xcec212,
                         l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h,
                         l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                         l_xcec.xcec222h,l_xcec.xcec301,l_xcec.xcec302,l_xcec.xcec107,l_xcec.xcec108,l_xcec.xcec109,l_xcec.xcec121,l_xcec.xcec122,l_xcec.xcec123,
                         l_xcec.xcec124,l_xcec.xcec125,l_xcec.xcec126,l_xcec.xcec127,l_xcec.xcec128,l_xcec.xcec129,l_xcec.xcec130)
      #161124-00048#21 add(e)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
         LET g_success = 'N'
         EXIT FOREACH
      END IF
      
   END FOREACH   
   RETURN g_success 
END FUNCTION

################################################################################
# Descriptions...: 不能留空的值给空格
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_default_space_xceb(p_xceb)
#   DEFINE p_xceb     RECORD LIKE xceb_t.*  #161124-00048#21 mark
#   DEFINE l_glad     RECORD LIKE glad_t.*    #wujie 150214  #161124-00048#21 mark
   #161124-00048#21 add(s)
   DEFINE p_xceb RECORD  #成本憑證第一單身檔
       xcebent LIKE xceb_t.xcebent, #企业编号
       xcebcomp LIKE xceb_t.xcebcomp, #法人组织
       xcebld LIKE xceb_t.xcebld, #账套
       xcebdocno LIKE xceb_t.xcebdocno, #单据编号
       xcebseq LIKE xceb_t.xcebseq, #项次
       xceb001 LIKE xceb_t.xceb001, #参考单据编号
       xceb002 LIKE xceb_t.xceb002, #参考单据项次
       xceb003 LIKE xceb_t.xceb003, #单据类型
       xceb004 LIKE xceb_t.xceb004, #料件编号
       xceb005 LIKE xceb_t.xceb005, #特性
       xceb101 LIKE xceb_t.xceb101, #科目编号
       xceb102 LIKE xceb_t.xceb102, #摘要
       xceb103 LIKE xceb_t.xceb103, #成本域
       xceb110 LIKE xceb_t.xceb110, #原因码
       xceb111 LIKE xceb_t.xceb111, #收付款客商
       xceb112 LIKE xceb_t.xceb112, #客群
       xceb113 LIKE xceb_t.xceb113, #区域
       xceb114 LIKE xceb_t.xceb114, #成本中心
       xceb115 LIKE xceb_t.xceb115, #经营类别
       xceb116 LIKE xceb_t.xceb116, #渠道
       xceb117 LIKE xceb_t.xceb117, #品类
       xceb118 LIKE xceb_t.xceb118, #品牌
       xceb119 LIKE xceb_t.xceb119, #项目号
       xceb120 LIKE xceb_t.xceb120, #WBS
       xceb201 LIKE xceb_t.xceb201, #数量
       xceb202 LIKE xceb_t.xceb202, #成本金额(本位币一)
       xceb202a LIKE xceb_t.xceb202a, #成本-材料(本位币一)
       xceb202b LIKE xceb_t.xceb202b, #成本-人工(本位币一)
       xceb202c LIKE xceb_t.xceb202c, #成本-加工(本位币一)
       xceb202d LIKE xceb_t.xceb202d, #成本-制费一(本位币一)
       xceb202e LIKE xceb_t.xceb202e, #成本-制费二(本位币一)
       xceb202f LIKE xceb_t.xceb202f, #成本-制费三(本位币一)
       xceb202g LIKE xceb_t.xceb202g, #成本-制费四(本位币一)
       xceb202h LIKE xceb_t.xceb202h, #成本-制费五(本位币一)
       xceb212 LIKE xceb_t.xceb212, #成本金额(本位币二)
       xceb212a LIKE xceb_t.xceb212a, #成本-材料(本位币二)
       xceb212b LIKE xceb_t.xceb212b, #成本-人工(本位币二)
       xceb212c LIKE xceb_t.xceb212c, #成本-加工(本位币二)
       xceb212d LIKE xceb_t.xceb212d, #成本-制费一(本位币二)
       xceb212e LIKE xceb_t.xceb212e, #成本-制费二(本位币二)
       xceb212f LIKE xceb_t.xceb212f, #成本-制费三(本位币二)
       xceb212g LIKE xceb_t.xceb212g, #成本-制费四(本位币二)
       xceb212h LIKE xceb_t.xceb212h, #成本-制费五(本位币二)
       xceb222 LIKE xceb_t.xceb222, #成本金额(本位币三)
       xceb222a LIKE xceb_t.xceb222a, #成本-材料(本位币三)
       xceb222b LIKE xceb_t.xceb222b, #成本-人工(本位币三)
       xceb222c LIKE xceb_t.xceb222c, #成本-加工(本位币三)
       xceb222d LIKE xceb_t.xceb222d, #成本-制费一(本位币三)
       xceb222e LIKE xceb_t.xceb222e, #成本-制费二(本位币三)
       xceb222f LIKE xceb_t.xceb222f, #成本-制费三(本位币三)
       xceb222g LIKE xceb_t.xceb222g, #成本-制费四(本位币三)
       xceb222h LIKE xceb_t.xceb222h, #成本-制费五(本位币三)
       xceb301 LIKE xceb_t.xceb301, #凭证编号
       xceb302 LIKE xceb_t.xceb302, #凭证项次
       xcebud001 LIKE xceb_t.xcebud001, #自定义字段(文本)001
       xcebud002 LIKE xceb_t.xcebud002, #自定义字段(文本)002
       xcebud003 LIKE xceb_t.xcebud003, #自定义字段(文本)003
       xcebud004 LIKE xceb_t.xcebud004, #自定义字段(文本)004
       xcebud005 LIKE xceb_t.xcebud005, #自定义字段(文本)005
       xcebud006 LIKE xceb_t.xcebud006, #自定义字段(文本)006
       xcebud007 LIKE xceb_t.xcebud007, #自定义字段(文本)007
       xcebud008 LIKE xceb_t.xcebud008, #自定义字段(文本)008
       xcebud009 LIKE xceb_t.xcebud009, #自定义字段(文本)009
       xcebud010 LIKE xceb_t.xcebud010, #自定义字段(文本)010
       xcebud011 LIKE xceb_t.xcebud011, #自定义字段(数字)011
       xcebud012 LIKE xceb_t.xcebud012, #自定义字段(数字)012
       xcebud013 LIKE xceb_t.xcebud013, #自定义字段(数字)013
       xcebud014 LIKE xceb_t.xcebud014, #自定义字段(数字)014
       xcebud015 LIKE xceb_t.xcebud015, #自定义字段(数字)015
       xcebud016 LIKE xceb_t.xcebud016, #自定义字段(数字)016
       xcebud017 LIKE xceb_t.xcebud017, #自定义字段(数字)017
       xcebud018 LIKE xceb_t.xcebud018, #自定义字段(数字)018
       xcebud019 LIKE xceb_t.xcebud019, #自定义字段(数字)019
       xcebud020 LIKE xceb_t.xcebud020, #自定义字段(数字)020
       xcebud021 LIKE xceb_t.xcebud021, #自定义字段(日期时间)021
       xcebud022 LIKE xceb_t.xcebud022, #自定义字段(日期时间)022
       xcebud023 LIKE xceb_t.xcebud023, #自定义字段(日期时间)023
       xcebud024 LIKE xceb_t.xcebud024, #自定义字段(日期时间)024
       xcebud025 LIKE xceb_t.xcebud025, #自定义字段(日期时间)025
       xcebud026 LIKE xceb_t.xcebud026, #自定义字段(日期时间)026
       xcebud027 LIKE xceb_t.xcebud027, #自定义字段(日期时间)027
       xcebud028 LIKE xceb_t.xcebud028, #自定义字段(日期时间)028
       xcebud029 LIKE xceb_t.xcebud029, #自定义字段(日期时间)029
       xcebud030 LIKE xceb_t.xcebud030, #自定义字段(日期时间)030
       xceb107 LIKE xceb_t.xceb107, #人员
       xceb108 LIKE xceb_t.xceb108, #部门
       xceb109 LIKE xceb_t.xceb109, #账款对象
       xceb121 LIKE xceb_t.xceb121, #自由核算项1
       xceb122 LIKE xceb_t.xceb122, #自由核算项2
       xceb123 LIKE xceb_t.xceb123, #自由核算项3
       xceb124 LIKE xceb_t.xceb124, #自由核算项4
       xceb125 LIKE xceb_t.xceb125, #自由核算项5
       xceb126 LIKE xceb_t.xceb126, #自由核算项6
       xceb127 LIKE xceb_t.xceb127, #自由核算项7
       xceb128 LIKE xceb_t.xceb128, #自由核算项8
       xceb129 LIKE xceb_t.xceb129, #自由核算项9
       xceb130 LIKE xceb_t.xceb130, #自由核算项10
       xceb131 LIKE xceb_t.xceb131, #单据类型(for 流通)
       xceb132 LIKE xceb_t.xceb132  #单据日期(for 流通)
END RECORD
DEFINE l_glad RECORD  #帳套科目管理設定檔
       gladent LIKE glad_t.gladent, #企业编号
       gladownid LIKE glad_t.gladownid, #资料所有者
       gladowndp LIKE glad_t.gladowndp, #资料所有部门
       gladcrtid LIKE glad_t.gladcrtid, #资料录入者
       gladcrtdp LIKE glad_t.gladcrtdp, #资料录入部门
       gladcrtdt LIKE glad_t.gladcrtdt, #资料创建日
       gladmodid LIKE glad_t.gladmodid, #资料更改者
       gladmoddt LIKE glad_t.gladmoddt, #最近更改日
       gladstus LIKE glad_t.gladstus, #状态码
       gladld LIKE glad_t.gladld, #账套
       glad001 LIKE glad_t.glad001, #会计科目编号
       glad002 LIKE glad_t.glad002, #是否按余额类型生成分录
       glad003 LIKE glad_t.glad003, #启用凭证项次细项立冲
       glad004 LIKE glad_t.glad004, #凭证项次异动别
       glad005 LIKE glad_t.glad005, #是否启用数量金额式
       glad006 LIKE glad_t.glad006, #借方现金变动码
       glad007 LIKE glad_t.glad007, #启用部门管理
       glad008 LIKE glad_t.glad008, #启用利润成本管理
       glad009 LIKE glad_t.glad009, #启用区域管理
       glad010 LIKE glad_t.glad010, #启用收付款客商管理
       glad011 LIKE glad_t.glad011, #启用客群管理
       glad012 LIKE glad_t.glad012, #启用产品类别管理
       glad013 LIKE glad_t.glad013, #启用人员管理
       glad014 LIKE glad_t.glad014, #no use
       glad015 LIKE glad_t.glad015, #启用项目管理
       glad016 LIKE glad_t.glad016, #启用WBS管理
       glad017 LIKE glad_t.glad017, #启用自由核算项一
       glad0171 LIKE glad_t.glad0171, #自由核算项一类型编号
       glad0172 LIKE glad_t.glad0172, #自由核算项一控制方式
       glad018 LIKE glad_t.glad018, #启用自由核算项二
       glad0181 LIKE glad_t.glad0181, #自由核算项二类型编号
       glad0182 LIKE glad_t.glad0182, #自由核算项二控制方式
       glad019 LIKE glad_t.glad019, #启用自由核算项三
       glad0191 LIKE glad_t.glad0191, #自由核算项三类型编号
       glad0192 LIKE glad_t.glad0192, #自由核算项三控制方式
       glad020 LIKE glad_t.glad020, #启用自由核算项四
       glad0201 LIKE glad_t.glad0201, #自由核算项四类型编号
       glad0202 LIKE glad_t.glad0202, #自由核算项四控制方式
       glad021 LIKE glad_t.glad021, #启用自由核算项五
       glad0211 LIKE glad_t.glad0211, #自由核算项五类型编号
       glad0212 LIKE glad_t.glad0212, #自由核算项五控制方式
       glad022 LIKE glad_t.glad022, #启用自由核算项六
       glad0221 LIKE glad_t.glad0221, #自由核算项六类型编号
       glad0222 LIKE glad_t.glad0222, #自由核算项六控制方式
       glad023 LIKE glad_t.glad023, #启用自由核算项七
       glad0231 LIKE glad_t.glad0231, #自由核算项七类型编号
       glad0232 LIKE glad_t.glad0232, #自由核算项七控制方式
       glad024 LIKE glad_t.glad024, #启用自由核算项八
       glad0241 LIKE glad_t.glad0241, #自由核算项八类型编号
       glad0242 LIKE glad_t.glad0242, #自由核算项八控制方式
       glad025 LIKE glad_t.glad025, #启用自由核算项九
       glad0251 LIKE glad_t.glad0251, #自由核算项九类型编号
       glad0252 LIKE glad_t.glad0252, #自由核算项九控制方式
       glad026 LIKE glad_t.glad026, #启用自由核算项十
       glad0261 LIKE glad_t.glad0261, #自由核算项十类型编号
       glad0262 LIKE glad_t.glad0262, #自由核算项十控制方式
       glad027 LIKE glad_t.glad027, #启用账款客商管理
       glad030 LIKE glad_t.glad030, #是否进行预算管控
       glad031 LIKE glad_t.glad031, #启用经营方式管理
       glad032 LIKE glad_t.glad032, #启用渠道管理
       glad033 LIKE glad_t.glad033, #启用品牌管理
       glad034 LIKE glad_t.glad034, #科目做多币种管理
       glad035 LIKE glad_t.glad035, #是否是子系统科目
       glad036 LIKE glad_t.glad036  #贷方现金变动码
END RECORD
   #161124-00048#21 add(e)
   
   IF p_xceb.xceb005 IS NULL THEN LET p_xceb.xceb005 = ' ' END IF 	#特性
   IF p_xceb.xceb101 IS NULL THEN LET p_xceb.xceb101 = ' ' END IF 	#科目编号
   IF p_xceb.xceb102 IS NULL THEN LET p_xceb.xceb102 = ' ' END IF 	#摘要
   IF p_xceb.xceb103 IS NULL THEN LET p_xceb.xceb103 = ' ' END IF 	#成本域
   IF p_xceb.xceb110 IS NULL THEN LET p_xceb.xceb110 = ' ' END IF 	#原因码
   IF p_xceb.xceb111 IS NULL THEN LET p_xceb.xceb111 = ' ' END IF 	#交易对象
   IF p_xceb.xceb112 IS NULL THEN LET p_xceb.xceb112 = ' ' END IF 	#客群
   IF p_xceb.xceb113 IS NULL THEN LET p_xceb.xceb113 = ' ' END IF 	#区域
   IF p_xceb.xceb114 IS NULL THEN LET p_xceb.xceb114 = ' ' END IF 	#成本中心
   IF p_xceb.xceb115 IS NULL THEN LET p_xceb.xceb115 = ' ' END IF 	#经营类别
   IF p_xceb.xceb116 IS NULL THEN LET p_xceb.xceb116 = ' ' END IF 	#渠道
   IF p_xceb.xceb117 IS NULL THEN LET p_xceb.xceb117 = ' ' END IF 	#品类
   IF p_xceb.xceb118 IS NULL THEN LET p_xceb.xceb118 = ' ' END IF 	#品牌
   IF p_xceb.xceb119 IS NULL THEN LET p_xceb.xceb119 = ' ' END IF 	#项目号
   IF p_xceb.xceb120 IS NULL THEN LET p_xceb.xceb120 = ' ' END IF 	#WBS
   IF p_xceb.xceb107	IS NULL THEN LET p_xceb.xceb107 = ' ' END IF  #人员
   IF p_xceb.xceb108	IS NULL THEN LET p_xceb.xceb108 = ' ' END IF  #部门
   IF p_xceb.xceb109	IS NULL THEN LET p_xceb.xceb109 = ' ' END IF  #账款对象
   IF p_xceb.xceb121	IS NULL THEN LET p_xceb.xceb121 = ' ' END IF  #自由核算项1
   IF p_xceb.xceb122	IS NULL THEN LET p_xceb.xceb122 = ' ' END IF  #自由核算项2
   IF p_xceb.xceb123	IS NULL THEN LET p_xceb.xceb123 = ' ' END IF  #自由核算项3
   IF p_xceb.xceb124	IS NULL THEN LET p_xceb.xceb124 = ' ' END IF  #自由核算项4
   IF p_xceb.xceb125	IS NULL THEN LET p_xceb.xceb125 = ' ' END IF  #自由核算项5
   IF p_xceb.xceb126	IS NULL THEN LET p_xceb.xceb126 = ' ' END IF  #自由核算项6
   IF p_xceb.xceb127	IS NULL THEN LET p_xceb.xceb127 = ' ' END IF  #自由核算项7
   IF p_xceb.xceb128	IS NULL THEN LET p_xceb.xceb128 = ' ' END IF  #自由核算项8
   IF p_xceb.xceb129	IS NULL THEN LET p_xceb.xceb129 = ' ' END IF  #自由核算项9
   IF p_xceb.xceb130	IS NULL THEN LET p_xceb.xceb130 = ' ' END IF  #自由核算项10
 
   INITIALIZE l_glad.* TO NULL
#   SELECT * INTO l_glad.* FROM glad_t  #161124-00048#21 mark
   #161124-00048#21 add(s)
   SELECT gladent,gladownid,gladowndp,gladcrtid,gladcrtdp,gladcrtdt,gladmodid,gladmoddt,
          gladstus,gladld,glad001,glad002,glad003,glad004,glad005,glad006,glad007,glad008,
          glad009,glad010,glad011,glad012,glad013,glad014,glad015,glad016,glad017,glad0171,
          glad0172,glad018,glad0181,glad0182,glad019,glad0191,glad0192,glad020,glad0201,
          glad0202,glad021,glad0211,glad0212,glad022,glad0221,glad0222,glad023,glad0231,
          glad0232,glad024,glad0241,glad0242,glad025,glad0251,glad0252,glad026,glad0261,
          glad0262,glad027,glad030,glad031,glad032,glad033,glad034,glad035,glad036 
     INTO l_glad.* FROM glad_t
   #161124-00048#21 add(e)
    WHERE gladent = p_xceb.xcebent
      AND gladld  = p_xceb.xcebld
      AND glad001 = p_xceb.xceb101

   IF l_glad.glad010 = 'N' THEN   #启用交易对象
      LET p_xceb.xceb111 = ' '
   END IF
   
   IF l_glad.glad011 = 'N' THEN   #启用客群
      LET p_xceb.xceb112 = ' '
   END IF

   IF l_glad.glad009 = 'N' THEN   #启用区域
      LET p_xceb.xceb113 = ' '
   END IF
   
   IF l_glad.glad008 = 'N' THEN   #启用成本中心
      LET p_xceb.xceb114 = ' '
   END IF
   
   IF l_glad.glad031 = 'N' THEN   #启用经营类别
      LET p_xceb.xceb115 = ' '
   END IF
 
   IF l_glad.glad032 = 'N' THEN   #启用渠道
      LET p_xceb.xceb116 = ' '
   END IF

   IF l_glad.glad012 = 'N' THEN   #启用品类
      LET p_xceb.xceb117 = ' '
   END IF
   
   IF l_glad.glad033 = 'N' THEN   #启用品牌
      LET p_xceb.xceb118 = ' '
   END IF
 
   IF l_glad.glad015 = 'N' THEN   #启用项目号
      LET p_xceb.xceb119 = ' '
   END IF
 
   IF l_glad.glad016 = 'N' THEN   #启用WBS
      LET p_xceb.xceb120 = ' '
   END IF
 
   IF l_glad.glad013 = 'N' THEN   #启用人员
      LET p_xceb.xceb107 = ' '
   END IF
 
   IF l_glad.glad007 = 'N' THEN   #启用部门
      LET p_xceb.xceb108 = ' '
   END IF
   
   IF l_glad.glad027 = 'N' THEN   #启用账款对象
      LET p_xceb.xceb109 = ' '
   END IF
   
   IF l_glad.glad017 = 'N' THEN   #启用自由核算项1
      LET p_xceb.xceb121 = ' '
   END IF
 
   IF l_glad.glad018 = 'N' THEN   #启用自由核算项2
      LET p_xceb.xceb122 = ' '
   END IF
 
   IF l_glad.glad019 = 'N' THEN   #启用自由核算项3
      LET p_xceb.xceb123 = ' '
   END IF

   IF l_glad.glad020 = 'N' THEN   #启用自由核算项4
      LET p_xceb.xceb124 = ' '
   END IF

   IF l_glad.glad021 = 'N' THEN   #启用自由核算项5
      LET p_xceb.xceb125 = ' '
   END IF

   IF l_glad.glad022 = 'N' THEN   #启用自由核算项6
      LET p_xceb.xceb126 = ' '
   END IF

   IF l_glad.glad023 = 'N' THEN   #启用自由核算项7
      LET p_xceb.xceb127 = ' '
   END IF

   IF l_glad.glad024 = 'N' THEN   #启用自由核算项8
      LET p_xceb.xceb128 = ' '
   END IF

   IF l_glad.glad025 = 'N' THEN   #启用自由核算项9
      LET p_xceb.xceb129 = ' '
   END IF

   IF l_glad.glad026 = 'N' THEN   #启用自由核算项10
      LET p_xceb.xceb130 = ' '
   END IF
   
   IF cl_null(p_xceb.xceb101) THEN
      LET p_xceb.xceb111 = ' '  	#交易对象
      LET p_xceb.xceb112 = ' '  	#客群
      LET p_xceb.xceb113 = ' '  	#区域
      LET p_xceb.xceb114 = ' '  	#成本中心
      LET p_xceb.xceb115 = ' '  	#经营类别
      LET p_xceb.xceb116 = ' '  	#渠道
      LET p_xceb.xceb117 = ' '  	#品类
      LET p_xceb.xceb118 = ' '  	#品牌
      LET p_xceb.xceb119 = ' '  	#项目号
      LET p_xceb.xceb120 = ' '  	#WBS
      LET p_xceb.xceb107 = ' '   #人员
      LET p_xceb.xceb108 = ' '   #部门
      LET p_xceb.xceb109 = ' '   #账款对象
      LET p_xceb.xceb121 = ' '   #自由核算项1
      LET p_xceb.xceb122 = ' '   #自由核算项2
      LET p_xceb.xceb123 = ' '   #自由核算项3
      LET p_xceb.xceb124 = ' '   #自由核算项4
      LET p_xceb.xceb125 = ' '   #自由核算项5
      LET p_xceb.xceb126 = ' '   #自由核算项6
      LET p_xceb.xceb127 = ' '   #自由核算项7
      LET p_xceb.xceb128 = ' '   #自由核算项8
      LET p_xceb.xceb129 = ' '   #自由核算项9
      LET p_xceb.xceb130 = ' '   #自由核算项10
   END IF
   
   RETURN p_xceb.xceb005,
          p_xceb.xceb101,
          p_xceb.xceb102,
          p_xceb.xceb103,
          p_xceb.xceb110,
          p_xceb.xceb111,
          p_xceb.xceb112,
          p_xceb.xceb113,
          p_xceb.xceb114,
          p_xceb.xceb115,
          p_xceb.xceb116,
          p_xceb.xceb117,
          p_xceb.xceb118,
          p_xceb.xceb119,
          p_xceb.xceb120,
          p_xceb.xceb107,
          p_xceb.xceb108,
          p_xceb.xceb109,
          p_xceb.xceb121,
          p_xceb.xceb122,
          p_xceb.xceb123,
          p_xceb.xceb124,
          p_xceb.xceb125,
          p_xceb.xceb126,
          p_xceb.xceb127,
          p_xceb.xceb128,
          p_xceb.xceb129,
          p_xceb.xceb130
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_default_space_xcec(p_xcec)
#   DEFINE p_xcec     RECORD LIKE xcec_t.*                  #161124-00048#21 mark
#   DEFINE l_glad     RECORD LIKE glad_t.*    #wujie 150214 #161124-00048#21 mark
   #161124-00048#21 add(s)
   DEFINE p_xcec RECORD  #成本憑證第二單身檔
       xcecent LIKE xcec_t.xcecent, #企业编号
       xceccomp LIKE xcec_t.xceccomp, #法人组织
       xcecld LIKE xcec_t.xcecld, #账套
       xcecdocno LIKE xcec_t.xcecdocno, #单据编号
       xcecseq LIKE xcec_t.xcecseq, #项次
       xcec001 LIKE xcec_t.xcec001, #参考单据
       xcec002 LIKE xcec_t.xcec002, #参考单据项次
       xcec003 LIKE xcec_t.xcec003, #单据类型
       xcec004 LIKE xcec_t.xcec004, #料件编号
       xcec005 LIKE xcec_t.xcec005, #特性
       xcec101 LIKE xcec_t.xcec101, #科目编号
       xcec102 LIKE xcec_t.xcec102, #摘要
       xcec103 LIKE xcec_t.xcec103, #成本域
       xcec110 LIKE xcec_t.xcec110, #原因码
       xcec111 LIKE xcec_t.xcec111, #收付款客商
       xcec112 LIKE xcec_t.xcec112, #客群
       xcec113 LIKE xcec_t.xcec113, #区域
       xcec114 LIKE xcec_t.xcec114, #成本中心
       xcec115 LIKE xcec_t.xcec115, #经营类别
       xcec116 LIKE xcec_t.xcec116, #渠道
       xcec117 LIKE xcec_t.xcec117, #品类
       xcec118 LIKE xcec_t.xcec118, #品牌
       xcec119 LIKE xcec_t.xcec119, #项目号
       xcec120 LIKE xcec_t.xcec120, #WBS
       xcec201 LIKE xcec_t.xcec201, #数量
       xcec202 LIKE xcec_t.xcec202, #成本金额(本位币一)
       xcec202a LIKE xcec_t.xcec202a, #成本-材料(本位币一)
       xcec202b LIKE xcec_t.xcec202b, #成本-人工(本位币一)
       xcec202c LIKE xcec_t.xcec202c, #成本-加工(本位币一)
       xcec202d LIKE xcec_t.xcec202d, #成本-制费一(本位币一)
       xcec202e LIKE xcec_t.xcec202e, #成本-制费二(本位币一)
       xcec202f LIKE xcec_t.xcec202f, #成本-制费三(本位币一)
       xcec202g LIKE xcec_t.xcec202g, #成本-制费四(本位币一)
       xcec202h LIKE xcec_t.xcec202h, #成本-制费五(本位币一)
       xcec212 LIKE xcec_t.xcec212, #成本-金额(本位币二)
       xcec212a LIKE xcec_t.xcec212a, #成本-材料(本位币二)
       xcec212b LIKE xcec_t.xcec212b, #成本-人工(本位币二)
       xcec212c LIKE xcec_t.xcec212c, #成本-加工(本位币二)
       xcec212d LIKE xcec_t.xcec212d, #成本-制费一(本位币二)
       xcec212e LIKE xcec_t.xcec212e, #成本-制费二(本位币二)
       xcec212f LIKE xcec_t.xcec212f, #成本-制费三(本位币二)
       xcec212g LIKE xcec_t.xcec212g, #成本-制费四(本位币二)
       xcec212h LIKE xcec_t.xcec212h, #成本-制费五(本位币二)
       xcec222 LIKE xcec_t.xcec222, #成本-金额(本位币三)
       xcec222a LIKE xcec_t.xcec222a, #成本-材料(本位币三)
       xcec222b LIKE xcec_t.xcec222b, #成本-人工(本位币三)
       xcec222c LIKE xcec_t.xcec222c, #成本-加工(本位币三)
       xcec222d LIKE xcec_t.xcec222d, #成本-制费一(本位币三)
       xcec222e LIKE xcec_t.xcec222e, #成本-制费二(本位币三)
       xcec222f LIKE xcec_t.xcec222f, #成本-制费三(本位币三)
       xcec222g LIKE xcec_t.xcec222g, #成本-制费四(本位币三)
       xcec222h LIKE xcec_t.xcec222h, #成本-制费五(本位币三)
       xcec301 LIKE xcec_t.xcec301, #凭证编号
       xcec302 LIKE xcec_t.xcec302, #凭证项次
       xcecud001 LIKE xcec_t.xcecud001, #自定义字段(文本)001
       xcecud002 LIKE xcec_t.xcecud002, #自定义字段(文本)002
       xcecud003 LIKE xcec_t.xcecud003, #自定义字段(文本)003
       xcecud004 LIKE xcec_t.xcecud004, #自定义字段(文本)004
       xcecud005 LIKE xcec_t.xcecud005, #自定义字段(文本)005
       xcecud006 LIKE xcec_t.xcecud006, #自定义字段(文本)006
       xcecud007 LIKE xcec_t.xcecud007, #自定义字段(文本)007
       xcecud008 LIKE xcec_t.xcecud008, #自定义字段(文本)008
       xcecud009 LIKE xcec_t.xcecud009, #自定义字段(文本)009
       xcecud010 LIKE xcec_t.xcecud010, #自定义字段(文本)010
       xcecud011 LIKE xcec_t.xcecud011, #自定义字段(数字)011
       xcecud012 LIKE xcec_t.xcecud012, #自定义字段(数字)012
       xcecud013 LIKE xcec_t.xcecud013, #自定义字段(数字)013
       xcecud014 LIKE xcec_t.xcecud014, #自定义字段(数字)014
       xcecud015 LIKE xcec_t.xcecud015, #自定义字段(数字)015
       xcecud016 LIKE xcec_t.xcecud016, #自定义字段(数字)016
       xcecud017 LIKE xcec_t.xcecud017, #自定义字段(数字)017
       xcecud018 LIKE xcec_t.xcecud018, #自定义字段(数字)018
       xcecud019 LIKE xcec_t.xcecud019, #自定义字段(数字)019
       xcecud020 LIKE xcec_t.xcecud020, #自定义字段(数字)020
       xcecud021 LIKE xcec_t.xcecud021, #自定义字段(日期时间)021
       xcecud022 LIKE xcec_t.xcecud022, #自定义字段(日期时间)022
       xcecud023 LIKE xcec_t.xcecud023, #自定义字段(日期时间)023
       xcecud024 LIKE xcec_t.xcecud024, #自定义字段(日期时间)024
       xcecud025 LIKE xcec_t.xcecud025, #自定义字段(日期时间)025
       xcecud026 LIKE xcec_t.xcecud026, #自定义字段(日期时间)026
       xcecud027 LIKE xcec_t.xcecud027, #自定义字段(日期时间)027
       xcecud028 LIKE xcec_t.xcecud028, #自定义字段(日期时间)028
       xcecud029 LIKE xcec_t.xcecud029, #自定义字段(日期时间)029
       xcecud030 LIKE xcec_t.xcecud030, #自定义字段(日期时间)030
       xcec107 LIKE xcec_t.xcec107, #人员
       xcec108 LIKE xcec_t.xcec108, #部门
       xcec109 LIKE xcec_t.xcec109, #账款对象
       xcec121 LIKE xcec_t.xcec121, #自由核算项1
       xcec122 LIKE xcec_t.xcec122, #自由核算项2
       xcec123 LIKE xcec_t.xcec123, #自由核算项3
       xcec124 LIKE xcec_t.xcec124, #自由核算项4
       xcec125 LIKE xcec_t.xcec125, #自由核算项5
       xcec126 LIKE xcec_t.xcec126, #自由核算项6
       xcec127 LIKE xcec_t.xcec127, #自由核算项7
       xcec128 LIKE xcec_t.xcec128, #自由核算项8
       xcec129 LIKE xcec_t.xcec129, #自由核算项9
       xcec130 LIKE xcec_t.xcec130  #自由核算项10
END RECORD
   DEFINE l_glad RECORD  #帳套科目管理設定檔
       gladent LIKE glad_t.gladent, #企业编号
       gladownid LIKE glad_t.gladownid, #资料所有者
       gladowndp LIKE glad_t.gladowndp, #资料所有部门
       gladcrtid LIKE glad_t.gladcrtid, #资料录入者
       gladcrtdp LIKE glad_t.gladcrtdp, #资料录入部门
       gladcrtdt LIKE glad_t.gladcrtdt, #资料创建日
       gladmodid LIKE glad_t.gladmodid, #资料更改者
       gladmoddt LIKE glad_t.gladmoddt, #最近更改日
       gladstus LIKE glad_t.gladstus, #状态码
       gladld LIKE glad_t.gladld, #账套
       glad001 LIKE glad_t.glad001, #会计科目编号
       glad002 LIKE glad_t.glad002, #是否按余额类型生成分录
       glad003 LIKE glad_t.glad003, #启用凭证项次细项立冲
       glad004 LIKE glad_t.glad004, #凭证项次异动别
       glad005 LIKE glad_t.glad005, #是否启用数量金额式
       glad006 LIKE glad_t.glad006, #借方现金变动码
       glad007 LIKE glad_t.glad007, #启用部门管理
       glad008 LIKE glad_t.glad008, #启用利润成本管理
       glad009 LIKE glad_t.glad009, #启用区域管理
       glad010 LIKE glad_t.glad010, #启用收付款客商管理
       glad011 LIKE glad_t.glad011, #启用客群管理
       glad012 LIKE glad_t.glad012, #启用产品类别管理
       glad013 LIKE glad_t.glad013, #启用人员管理
       glad014 LIKE glad_t.glad014, #no use
       glad015 LIKE glad_t.glad015, #启用项目管理
       glad016 LIKE glad_t.glad016, #启用WBS管理
       glad017 LIKE glad_t.glad017, #启用自由核算项一
       glad0171 LIKE glad_t.glad0171, #自由核算项一类型编号
       glad0172 LIKE glad_t.glad0172, #自由核算项一控制方式
       glad018 LIKE glad_t.glad018, #启用自由核算项二
       glad0181 LIKE glad_t.glad0181, #自由核算项二类型编号
       glad0182 LIKE glad_t.glad0182, #自由核算项二控制方式
       glad019 LIKE glad_t.glad019, #启用自由核算项三
       glad0191 LIKE glad_t.glad0191, #自由核算项三类型编号
       glad0192 LIKE glad_t.glad0192, #自由核算项三控制方式
       glad020 LIKE glad_t.glad020, #启用自由核算项四
       glad0201 LIKE glad_t.glad0201, #自由核算项四类型编号
       glad0202 LIKE glad_t.glad0202, #自由核算项四控制方式
       glad021 LIKE glad_t.glad021, #启用自由核算项五
       glad0211 LIKE glad_t.glad0211, #自由核算项五类型编号
       glad0212 LIKE glad_t.glad0212, #自由核算项五控制方式
       glad022 LIKE glad_t.glad022, #启用自由核算项六
       glad0221 LIKE glad_t.glad0221, #自由核算项六类型编号
       glad0222 LIKE glad_t.glad0222, #自由核算项六控制方式
       glad023 LIKE glad_t.glad023, #启用自由核算项七
       glad0231 LIKE glad_t.glad0231, #自由核算项七类型编号
       glad0232 LIKE glad_t.glad0232, #自由核算项七控制方式
       glad024 LIKE glad_t.glad024, #启用自由核算项八
       glad0241 LIKE glad_t.glad0241, #自由核算项八类型编号
       glad0242 LIKE glad_t.glad0242, #自由核算项八控制方式
       glad025 LIKE glad_t.glad025, #启用自由核算项九
       glad0251 LIKE glad_t.glad0251, #自由核算项九类型编号
       glad0252 LIKE glad_t.glad0252, #自由核算项九控制方式
       glad026 LIKE glad_t.glad026, #启用自由核算项十
       glad0261 LIKE glad_t.glad0261, #自由核算项十类型编号
       glad0262 LIKE glad_t.glad0262, #自由核算项十控制方式
       glad027 LIKE glad_t.glad027, #启用账款客商管理
       glad030 LIKE glad_t.glad030, #是否进行预算管控
       glad031 LIKE glad_t.glad031, #启用经营方式管理
       glad032 LIKE glad_t.glad032, #启用渠道管理
       glad033 LIKE glad_t.glad033, #启用品牌管理
       glad034 LIKE glad_t.glad034, #科目做多币种管理
       glad035 LIKE glad_t.glad035, #是否是子系统科目
       glad036 LIKE glad_t.glad036  #贷方现金变动码
END RECORD
   #161124-00048#21 add(e)
   
   IF p_xcec.xcec005 IS NULL THEN LET p_xcec.xcec005 = ' ' END IF 	#特性
   IF p_xcec.xcec101 IS NULL THEN LET p_xcec.xcec101 = ' ' END IF 	#科目编号
   IF p_xcec.xcec102 IS NULL THEN LET p_xcec.xcec102 = ' ' END IF 	#摘要
   IF p_xcec.xcec103 IS NULL THEN LET p_xcec.xcec103 = ' ' END IF 	#成本域
   IF p_xcec.xcec110 IS NULL THEN LET p_xcec.xcec110 = ' ' END IF 	#原因码
   IF p_xcec.xcec111 IS NULL THEN LET p_xcec.xcec111 = ' ' END IF 	#交易对象
   IF p_xcec.xcec112 IS NULL THEN LET p_xcec.xcec112 = ' ' END IF 	#客群
   IF p_xcec.xcec113 IS NULL THEN LET p_xcec.xcec113 = ' ' END IF 	#区域
   IF p_xcec.xcec114 IS NULL THEN LET p_xcec.xcec114 = ' ' END IF 	#成本中心
   IF p_xcec.xcec115 IS NULL THEN LET p_xcec.xcec115 = ' ' END IF 	#经营类别
   IF p_xcec.xcec116 IS NULL THEN LET p_xcec.xcec116 = ' ' END IF 	#渠道
   IF p_xcec.xcec117 IS NULL THEN LET p_xcec.xcec117 = ' ' END IF 	#品类
   IF p_xcec.xcec118 IS NULL THEN LET p_xcec.xcec118 = ' ' END IF 	#品牌
   IF p_xcec.xcec119 IS NULL THEN LET p_xcec.xcec119 = ' ' END IF 	#项目号
   IF p_xcec.xcec120 IS NULL THEN LET p_xcec.xcec120 = ' ' END IF 	#WBS
   IF p_xcec.xcec107	IS NULL THEN LET p_xcec.xcec107 = ' ' END IF  #人员
   IF p_xcec.xcec108	IS NULL THEN LET p_xcec.xcec108 = ' ' END IF  #部门
   IF p_xcec.xcec109	IS NULL THEN LET p_xcec.xcec109 = ' ' END IF  #账款对象
   IF p_xcec.xcec121	IS NULL THEN LET p_xcec.xcec121 = ' ' END IF  #自由核算项1
   IF p_xcec.xcec122	IS NULL THEN LET p_xcec.xcec122 = ' ' END IF  #自由核算项2
   IF p_xcec.xcec123	IS NULL THEN LET p_xcec.xcec123 = ' ' END IF  #自由核算项3
   IF p_xcec.xcec124	IS NULL THEN LET p_xcec.xcec124 = ' ' END IF  #自由核算项4
   IF p_xcec.xcec125	IS NULL THEN LET p_xcec.xcec125 = ' ' END IF  #自由核算项5
   IF p_xcec.xcec126	IS NULL THEN LET p_xcec.xcec126 = ' ' END IF  #自由核算项6
   IF p_xcec.xcec127	IS NULL THEN LET p_xcec.xcec127 = ' ' END IF  #自由核算项7
   IF p_xcec.xcec128	IS NULL THEN LET p_xcec.xcec128 = ' ' END IF  #自由核算项8
   IF p_xcec.xcec129	IS NULL THEN LET p_xcec.xcec129 = ' ' END IF  #自由核算项9
   IF p_xcec.xcec130	IS NULL THEN LET p_xcec.xcec130 = ' ' END IF  #自由核算项10

   INITIALIZE l_glad.* TO NULL
#   SELECT * INTO l_glad.* FROM glad_t  #161124-00048#21 mark
   #161124-00048#21 add(s)
   SELECT gladent,gladownid,gladowndp,gladcrtid,gladcrtdp,gladcrtdt,gladmodid,gladmoddt,
          gladstus,gladld,glad001,glad002,glad003,glad004,glad005,glad006,glad007,glad008,
          glad009,glad010,glad011,glad012,glad013,glad014,glad015,glad016,glad017,glad0171,
          glad0172,glad018,glad0181,glad0182,glad019,glad0191,glad0192,glad020,glad0201,
          glad0202,glad021,glad0211,glad0212,glad022,glad0221,glad0222,glad023,glad0231,
          glad0232,glad024,glad0241,glad0242,glad025,glad0251,glad0252,glad026,glad0261,
          glad0262,glad027,glad030,glad031,glad032,glad033,glad034,glad035,glad036 
     INTO l_glad.* FROM glad_t
   #161124-00048#21 add(e)
    WHERE gladent = p_xcec.xcecent
      AND gladld  = p_xcec.xcecld
      AND glad001 = p_xcec.xcec101

   IF l_glad.glad010 = 'N' THEN   #启用交易对象
      LET p_xcec.xcec111 = ' '
   END IF
   
   IF l_glad.glad011 = 'N' THEN   #启用客群
      LET p_xcec.xcec112 = ' '
   END IF

   IF l_glad.glad009 = 'N' THEN   #启用区域
      LET p_xcec.xcec113 = ' '
   END IF
   
   IF l_glad.glad008 = 'N' THEN   #启用成本中心
      LET p_xcec.xcec114 = ' '
   END IF
   
   IF l_glad.glad031 = 'N' THEN   #启用经营类别
      LET p_xcec.xcec115 = ' '
   END IF
 
   IF l_glad.glad032 = 'N' THEN   #启用渠道
      LET p_xcec.xcec116 = ' '
   END IF

   IF l_glad.glad012 = 'N' THEN   #启用品类
      LET p_xcec.xcec117 = ' '
   END IF
   
   IF l_glad.glad033 = 'N' THEN   #启用品牌
      LET p_xcec.xcec118 = ' '
   END IF
 
   IF l_glad.glad015 = 'N' THEN   #启用项目号
      LET p_xcec.xcec119 = ' '
   END IF
 
   IF l_glad.glad016 = 'N' THEN   #启用WBS
      LET p_xcec.xcec120 = ' '
   END IF
 
   IF l_glad.glad013 = 'N' THEN   #启用人员
      LET p_xcec.xcec107 = ' '
   END IF
 
   IF l_glad.glad007 = 'N' THEN   #启用部门
      LET p_xcec.xcec108 = ' '
   END IF
   
   IF l_glad.glad027 = 'N' THEN   #启用账款对象
      LET p_xcec.xcec109 = ' '
   END IF
   
   IF l_glad.glad017 = 'N' THEN   #启用自由核算项1
      LET p_xcec.xcec121 = ' '
   END IF
 
   IF l_glad.glad018 = 'N' THEN   #启用自由核算项2
      LET p_xcec.xcec122 = ' '
   END IF
 
   IF l_glad.glad019 = 'N' THEN   #启用自由核算项3
      LET p_xcec.xcec123 = ' '
   END IF

   IF l_glad.glad020 = 'N' THEN   #启用自由核算项4
      LET p_xcec.xcec124 = ' '
   END IF

   IF l_glad.glad021 = 'N' THEN   #启用自由核算项5
      LET p_xcec.xcec125 = ' '
   END IF

   IF l_glad.glad022 = 'N' THEN   #启用自由核算项6
      LET p_xcec.xcec126 = ' '
   END IF

   IF l_glad.glad023 = 'N' THEN   #启用自由核算项7
      LET p_xcec.xcec127 = ' '
   END IF

   IF l_glad.glad024 = 'N' THEN   #启用自由核算项8
      LET p_xcec.xcec128 = ' '
   END IF

   IF l_glad.glad025 = 'N' THEN   #启用自由核算项9
      LET p_xcec.xcec129 = ' '
   END IF

   IF l_glad.glad026 = 'N' THEN   #启用自由核算项10
      LET p_xcec.xcec130 = ' '
   END IF

   IF cl_null(p_xcec.xcec101) THEN
      LET p_xcec.xcec111 = ' '  	#交易对象
      LET p_xcec.xcec112 = ' '  	#客群
      LET p_xcec.xcec113 = ' '  	#区域
      LET p_xcec.xcec114 = ' '  	#成本中心
      LET p_xcec.xcec115 = ' '  	#经营类别
      LET p_xcec.xcec116 = ' '  	#渠道
      LET p_xcec.xcec117 = ' '  	#品类
      LET p_xcec.xcec118 = ' '  	#品牌
      LET p_xcec.xcec119 = ' '  	#项目号
      LET p_xcec.xcec120 = ' '  	#WBS
      LET p_xcec.xcec107 = ' '   #人员
      LET p_xcec.xcec108 = ' '   #部门
      LET p_xcec.xcec109 = ' '   #账款对象
      LET p_xcec.xcec121 = ' '   #自由核算项1
      LET p_xcec.xcec122 = ' '   #自由核算项2
      LET p_xcec.xcec123 = ' '   #自由核算项3
      LET p_xcec.xcec124 = ' '   #自由核算项4
      LET p_xcec.xcec125 = ' '   #自由核算项5
      LET p_xcec.xcec126 = ' '   #自由核算项6
      LET p_xcec.xcec127 = ' '   #自由核算项7
      LET p_xcec.xcec128 = ' '   #自由核算项8
      LET p_xcec.xcec129 = ' '   #自由核算项9
      LET p_xcec.xcec130 = ' '   #自由核算项10
   END IF

   RETURN p_xcec.xcec005,
          p_xcec.xcec101,
          p_xcec.xcec102,
          p_xcec.xcec103,
          p_xcec.xcec110,
          p_xcec.xcec111,
          p_xcec.xcec112,
          p_xcec.xcec113,
          p_xcec.xcec114,
          p_xcec.xcec115,
          p_xcec.xcec116,
          p_xcec.xcec117,
          p_xcec.xcec118,
          p_xcec.xcec119,
          p_xcec.xcec120,
          p_xcec.xcec107,
          p_xcec.xcec108,
          p_xcec.xcec109,
          p_xcec.xcec121,
          p_xcec.xcec122,
          p_xcec.xcec123,
          p_xcec.xcec124,
          p_xcec.xcec125,
          p_xcec.xcec126,
          p_xcec.xcec127,
          p_xcec.xcec128,
          p_xcec.xcec129,
          p_xcec.xcec130
END FUNCTION

################################################################################
# Descriptions...: 若无单身产生，单头也要取消
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_del_all()
   DEFINE l_cnt1     LIKE type_t.num5
   DEFINE l_cnt2     LIKE type_t.num5
   DEFINE r_success  LIKE type_t.chr1
   
   LET r_success = 'Y'
   LET l_cnt1 = 0
   LET l_cnt2 = 0
   
   SELECT COUNT(*) INTO l_cnt1 
     FROM xceb_t 
    WHERE xcebent = g_enterprise
      AND xcebld  = g_xcea_m.xceald
      AND xcebdocno=g_xcea_m.xceadocno
      
   SELECT COUNT(*) INTO l_cnt2 
     FROM xcec_t 
    WHERE xcecent = g_enterprise
      AND xcecld  = g_xcea_m.xceald
      AND xcecdocno=g_xcea_m.xceadocno      

   IF l_cnt1 = 0 AND l_cnt2 = 0 THEN
      DELETE FROM xcea_t 
       WHERE xceaent = g_enterprise
         AND xceald  = g_xcea_m.xceald
         AND xceadocno=g_xcea_m.xceadocno
     
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'agl-00167'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET r_success = 'N'
      LET g_xcea_m.xceald = ''
      LET g_xcea_m.xceadocno = ''
   END IF
   RETURN r_success
END FUNCTION

################################################################################
# Descriptions...: 取得axci202维护的摘要
# Memo...........:
# Usage..........: CALL axct901_01_get_summ(p_glabld,p_glab001,p_glab002,p_glab003)
#                  RETURNING r_success,r_summ
# Input parameter: p_glabld       帳別
#                : p_glab001      科目對應的帳務類型
#                : p_glab002      帳款類別
#                : p_glab003      預設科目代號(SCC設定)
# Return code....: r_success      TRUE成功/FALSE失敗
#                : r_summ         摘要
# Date & Author..: 15/03/26 By wujie
# Modify.........:
################################################################################
PRIVATE FUNCTION axct901_01_get_summ(p_glabld,p_glab001,p_glab002,p_glab003)
   DEFINE p_glabld      LIKE glab_t.glabld
   DEFINE p_glab001     LIKE glab_t.glab001
   DEFINE p_glab002     LIKE glab_t.glab002
   DEFINE p_glab003     LIKE glab_t.glab003
   DEFINE r_summ        LIKE glab_t.glab010
   DEFINE r_success     LIKE type_t.num10
   DEFINE l_success     LIKE type_t.num10
   
   WHENEVER ERROR CONTINUE
   
   LET r_summ = NULL
   LET r_success = TRUE
   SELECT glab010 INTO r_summ
     FROM glab_t
    WHERE glabld  = p_glabld
      AND glab001 = p_glab001
      AND glab002 = p_glab002
      AND glab003 = p_glab003
      AND glabent = g_enterprise
      
   RETURN r_success,r_summ
END FUNCTION

 
{</section>}
 
