<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="axct701_01" std_prog="axct701_01" erpver="1.0" module="AXC" ver="8" env="s" zone="t10prd" booking="N" type="S" identity="s" section_flag="N" designer_ver="1.0">
  <other>
    <code_template value="F" status="u"/>
    <free_style value="N" status="u"/>
    <start_arg value="" status="u"/>
  </other>
  <point name="function.axct701_01_get_xceald_desc" order="1" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 獲取帳套說明
# Memo...........:
# Usage..........: CALL axct701_01_get_xceald_desc()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_get_xceald_desc()
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceald
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceald_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceald_desc
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_get_xceacomp" order="2" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 默認帶出帳套的所屬法人
# Memo...........:
# Usage..........: CALL axct701_01_get_xceacomp()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_get_xceacomp()
   SELECT glaacomp INTO g_xcea_m.xceacomp FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = g_xcea_m.xceald
   CALL axct701_01_get_xceacomp_desc()   
   DISPLAY BY NAME g_xcea_m.xceacomp,g_xcea_m.xceacomp_desc   
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_get_xceacomp_desc" order="3" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 獲取法人說明
# Memo...........:
# Usage..........: CALL  axct701_01_get_xceacomp_desc()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_get_xceacomp_desc()
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceacomp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceacomp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceacomp_desc
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_get_xcea003_desc" order="4" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 獲取成本計算類型說明
# Memo...........:
# Usage..........: CALL axct701_01_get_xcea003_desc()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_get_xcea003_desc()
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xcea003
            CALL ap_ref_array2(g_ref_fields,"SELECT xcatl003 FROM xcatl_t WHERE xcatlent='"||g_enterprise||"' AND xcatl001=? AND xcatl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xcea003_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xcea003_desc
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_get_glaa" order="5" ver="4" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 根據帳套獲取相關資料
# Memo...........:
# Usage..........: CALL axct701_01_get_glaa()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_get_glaa()
   #會計週期參照表、會計科目參照表、單據別參照表
   SELECT glaa001,glaa003,glaa004,glaa015,glaa016,glaa018,glaa019,glaa020,glaa022,glaa024 
     INTO g_glaa001,g_glaa003,g_glaa004,g_glaa015,g_glaa016,g_glaa018,g_glaa019,g_glaa020,g_glaa022,g_glaa024 
     FROM glaa_t
    WHERE glaaent = g_enterprise 
      AND glaald = g_xcea_m.xceald   
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins" order="6" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 新增xcea,xceb,xcec  1.在製投入憑證 axct701
# Memo...........:
# Usage..........: CALL axct701_01_ins()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/16 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins()
DEFINE l_xcea          RECORD LIKE xcea_t.*
DEFINE l_xceb          RECORD LIKE xceb_t.*
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xccd          RECORD LIKE xccd_t.*
DEFINE l_xcce          RECORD LIKE xcce_t.*
DEFINE l_xcch          RECORD LIKE xcch_t.*
DEFINE l_xcci          RECORD LIKE xcci_t.*
DEFINE l_sfaa052       LIKE sfaa_t.sfaa052
DEFINE l_sfaa009       LIKE sfaa_t.sfaa009
DEFINE l_sfaa028       LIKE sfaa_t.sfaa028
DEFINE l_sfaa029       LIKE sfaa_t.sfaa029
DEFINE l_sfaasite      LIKE sfaa_t.sfaasite
DEFINE l_sfaa017       LIKE sfaa_t.sfaa017
DEFINE ld_date         DATETIME YEAR TO SECOND
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,l_xcea.xceacrtdt,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "ins xcea"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   #非拆件工單 xccd_t
   #帳套本位幣順序+工單+主件  

   LET g_sql = " SELECT SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),",
               "        SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xccd_t,xcce_t",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea_m.xcea004,
               "    AND xccd005 = ",g_xcea_m.xcea005,
               "    AND xcceent = xccdent",
               "    AND xcceld  = xccdld",
               "    AND xcce001 = xccd001",
               "    AND xcce003 = xccd003",
               "    AND xcce004 = xccd004",
               "    AND xcce005 = xccd005",
               "    AND xcce006 = xccd006",
               "    AND xcce007 != 'DL+OH+SUB'",
               "    AND xccd006 = ? AND xccd007 = ? AND xccd008 = ? AND xccd002 = ? "                
 

   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '2' " 
   
   DECLARE xccd_prep2 CURSOR FROM g_sql1

   

   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '3' " 
   
   DECLARE xccd_prep3 CURSOR FROM g_sql1

               
   LET g_sql = " SELECT xccd006,xccd007,xccd008,xccd002,",
               "        SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),",
               "        SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xccd_t,xcce_t",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea_m.xcea004,
               "    AND xccd005 = ",g_xcea_m.xcea005,
               "    AND xccd001 = '1' ",
               "    AND xcceent = xccdent",
               "    AND xcceld  = xccdld",
               "    AND xcce001 = xccd001",
               "    AND xcce003 = xccd003",
               "    AND xcce004 = xccd004",
               "    AND xcce005 = xccd005",
               "    AND xcce006 = xccd006",
               "    AND xcce007 != 'DL+OH+SUB'",
               "  GROUP BY xccd006,xccd007,xccd008,xccd002 ",
               "  ORDER BY xccd006,xccd007,xccd008,xccd002 "
   PREPARE xccd_prep FROM g_sql
   DECLARE xccd_curs CURSOR FOR xccd_prep
   FOREACH xccd_curs INTO l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002,l_xcce.xcce202,l_xcce.xcce202a,
                          l_xcce.xcce202b,l_xcce.xcce202c,l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,
                          l_xcce.xcce202g,l_xcce.xcce202h 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xccd"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN g_success
         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''
      LET l_sfaasite =''
      
      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb001 = l_xccd.xccd006 #工單
      LET l_xceb.xceb004 = l_xccd.xccd007 #主件
      LET l_xceb.xceb005 = l_xccd.xccd008 #特性
      LET l_xceb.xceb103 = l_xccd.xccd002 #成本域
 

      #本位幣一
      LET l_xceb.xceb202 = l_xcce.xcce202
      LET l_xceb.xceb202a = l_xcce.xcce202a
      LET l_xceb.xceb202b = l_xcce.xcce202b
      LET l_xceb.xceb202c = l_xcce.xcce202c
      LET l_xceb.xceb202d = l_xcce.xcce202d
      LET l_xceb.xceb202e = l_xcce.xcce202e
      LET l_xceb.xceb202f = l_xcce.xcce202f
      LET l_xceb.xceb202g = l_xcce.xcce202g
      LET l_xceb.xceb202h = l_xcce.xcce202h
       

      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF                            
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF
      
      #本位幣二
      IF g_glaa015 = 'Y' THEN
         OPEN xccd_prep2 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep2 INTO l_xcce.xcce202,l_xcce.xcce202a,l_xcce.xcce202b,l_xcce.xcce202c,
                               l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,l_xcce.xcce202g,l_xcce.xcce202h 
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF                        
          
         LET l_xceb.xceb212a = l_xcce.xcce202a
         LET l_xceb.xceb212b = l_xcce.xcce202b
         LET l_xceb.xceb212c = l_xcce.xcce202c
         LET l_xceb.xceb212d = l_xcce.xcce202d
         LET l_xceb.xceb212e = l_xcce.xcce202e
         LET l_xceb.xceb212f = l_xcce.xcce202f
         LET l_xceb.xceb212g = l_xcce.xcce202g
         LET l_xceb.xceb212h = l_xcce.xcce202h
          
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF                            
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0                            
         LET l_xceb.xceb212  = 0      
      END IF

      #本位幣三
      IF g_glaa019 = 'Y' THEN  
         OPEN xccd_prep3 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep3 INTO l_xcce.xcce202,l_xcce.xcce202a,l_xcce.xcce202b,l_xcce.xcce202c,
                               l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,l_xcce.xcce202g,l_xcce.xcce202h 
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
          
         LET l_xceb.xceb222a = l_xcce.xcce202a
         LET l_xceb.xceb222b = l_xcce.xcce202b
         LET l_xceb.xceb222c = l_xcce.xcce202c
         LET l_xceb.xceb222d = l_xcce.xcce202d
         LET l_xceb.xceb222e = l_xcce.xcce202e
         LET l_xceb.xceb222f = l_xcce.xcce202f
         LET l_xceb.xceb222g = l_xcce.xcce202g
         LET l_xceb.xceb222h = l_xcce.xcce202h
          
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF                            
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0                            
         LET l_xceb.xceb222  = 0      
      END IF
      
      #項次
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise 
         AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xceb.xceb003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xceb.xceb101

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xceb.xceb101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xceb.xceb101,l_errno
      END IF
      

      LET l_xceb.xceb115 = ''  #經營類別
      LET l_xceb.xceb116 = ''  #渠道
      LET l_xceb.xceb118 = ''  #品牌

      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xceb.xceb111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
      ELSE
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF      


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      SELECT ooeg004 INTO l_xceb.xceb114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017  
      
      #品類
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xceb.xceb004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' '
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF      
      INSERT INTO xceb_t VALUES(l_xceb.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xccd_prep2
   CLOSE xccd_prep3   
   END FOREACH     


   #非拆件工單 xcce_t
   #帳套本位幣順序+工單+元件  
   LET g_sql = " SELECT SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xcce_t", 
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea_m.xcea004,
               "    AND xcce005 = ",g_xcea_m.xcea005,  
               "    AND xcce007 != 'DL+OH+SUB'",
               "    AND xcce006 = ? AND xcce007 = ? AND xcce002 = ? AND xcce008 = ? AND xcce009 = ?  " 
 
   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '2' " 
   
   DECLARE xcce_prep2 CURSOR FROM g_sql1
   

   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '3' " 
   
   DECLARE xcce_prep3 CURSOR FROM g_sql1

   
   LET g_sql = " SELECT xcce006,xcce007,xcce002,xcce008,xcce009,SUM(xcce201)+SUM(xcce205)+SUM(xcce207)+SUM(xcce209),",
               "        SUM(xcce202)+SUM(xcce206)+SUM(xcce208)+SUM(xcce210),SUM(xcce202a)+SUM(xcce206a)+SUM(xcce208a)+SUM(xcce210a),",
               "        SUM(xcce202b)+SUM(xcce206b)+SUM(xcce208b)+SUM(xcce210b),SUM(xcce202c)+SUM(xcce206c)+SUM(xcce208c)+SUM(xcce210c),",
               "        SUM(xcce202d)+SUM(xcce206d)+SUM(xcce208d)+SUM(xcce210d),SUM(xcce202e)+SUM(xcce206e)+SUM(xcce208e)+SUM(xcce210e),",
               "        SUM(xcce202f)+SUM(xcce206f)+SUM(xcce208f)+SUM(xcce210f),SUM(xcce202g)+SUM(xcce206g)+SUM(xcce208g)+SUM(xcce210g),SUM(xcce202h)+SUM(xcce206h)+SUM(xcce208h)+SUM(xcce210h) ",
               "   FROM xcce_t",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea_m.xcea004,
               "    AND xcce005 = ",g_xcea_m.xcea005,
               "    AND xcce007 != 'DL+OH+SUB'",
               "    AND xcce001 = '1' ",
               "  GROUP BY xcce006,xcce007,xcce002,xcce008,xcce009",
               "  ORDER BY xcce006,xcce007,xcce002,xcce008,xcce009 "
   PREPARE xcce_prep FROM g_sql
   DECLARE xcce_curs CURSOR FOR xcce_prep
   FOREACH xcce_curs INTO l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce002,l_xcce.xcce008,l_xcce.xcce009,
                          l_xcce.xcce201,l_xcce.xcce202,l_xcce.xcce202a,
                          l_xcce.xcce202b,l_xcce.xcce202c,l_xcce.xcce202d,l_xcce.xcce202e,l_xcce.xcce202f,
                          l_xcce.xcce202g,l_xcce.xcce202h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcce"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''
      LET l_sfaasite =''
      
      INITIALIZE l_xcec.* TO NULL
      
      LET l_xcec.xcec001 = l_xcce.xcce006 #工單
      LET l_xcec.xcec004 = l_xcce.xcce007 #主件
      LET l_xcec.xcec005 = l_xcce.xcce008 #特性
      LET l_xcec.xcec103 = l_xcce.xcce002 #成本域
      
      #本位幣一
      LET l_xcec.xcec201 =  l_xcce.xcce201#投入數量
      LET l_xcec.xcec202a = l_xcce.xcce202a 
      LET l_xcec.xcec202b = l_xcce.xcce202b   
      LET l_xcec.xcec202c = l_xcce.xcce202c 
      LET l_xcec.xcec202d = l_xcce.xcce202d 
      LET l_xcec.xcec202e = l_xcce.xcce202e 
      LET l_xcec.xcec202f = l_xcce.xcce202f 
      LET l_xcec.xcec202g = l_xcce.xcce202g 
      LET l_xcec.xcec202h = l_xcce.xcce202h 
      LET l_xcec.xcec202  = l_xcce.xcce202       

      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF
     
      IF g_glaa015 ='Y' THEN
      #本位幣二
         OPEN xcce_prep2 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce002,l_xcce.xcce008,l_xcce.xcce009
         FETCH xcce_prep2 INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                               l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF 
      ELSE
         LET l_xcec.xcec212a = 0
         LET l_xcec.xcec212b = 0
         LET l_xcec.xcec212c = 0
         LET l_xcec.xcec212d = 0
         LET l_xcec.xcec212e = 0
         LET l_xcec.xcec212f = 0
         LET l_xcec.xcec212g = 0
         LET l_xcec.xcec212h = 0
         LET l_xcec.xcec212  = 0
      END IF      
      IF g_glaa019 ='Y' THEN
      #本位幣三
         OPEN xcce_prep3 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce002,l_xcce.xcce008,l_xcce.xcce009
         FETCH xcce_prep3 INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                               l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF      
      ELSE
         LET l_xcec.xcec222a = 0
         LET l_xcec.xcec222b = 0
         LET l_xcec.xcec222c = 0
         LET l_xcec.xcec222d = 0
         LET l_xcec.xcec222e = 0
         LET l_xcec.xcec222f = 0
         LET l_xcec.xcec222g = 0
         LET l_xcec.xcec222h = 0
         LET l_xcec.xcec222  = 0
      END IF 
      #項次
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise 
         AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xcec.xcec003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      #存貨科目
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xcec.xcec101    

      LET l_xcec.xcec102 = ''  #摘要
      LET l_xcec.xcec115 = ''  #經營類別
      LET l_xcec.xcec116 = ''  #渠道
      LET l_xcec.xcec118 = ''  #品牌
      
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xcec.xcec111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
      ELSE
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF      


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      SELECT ooeg004 INTO l_xcec.xcec114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017 
       

      #品類
      SELECT imag011 INTO l_xcec.xcec117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xcec.xcec004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001

      #人员
      LET l_xcec.xcec107 = ' '
      #部门
      LET l_xcec.xcec108 = ' '
      #账款对象
      LET l_xcec.xcec109 = ' '
      #自由核算项1～10  
      LET l_xcec.xcec121 = ' '
      LET l_xcec.xcec122 = ' '
      LET l_xcec.xcec123 = ' '
      LET l_xcec.xcec124 = ' '
      LET l_xcec.xcec125 = ' '
      LET l_xcec.xcec126 = ' '
      LET l_xcec.xcec127 = ' '
      LET l_xcec.xcec128 = ' '
      LET l_xcec.xcec129 = ' '
      LET l_xcec.xcec130 = ' '
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xcec.xcec102
      END IF
      CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                             l_xcec.xcec101,
                                                             l_xcec.xcec102,
                                                             l_xcec.xcec103,
                                                             l_xcec.xcec110,
                                                             l_xcec.xcec111,
                                                             l_xcec.xcec112,
                                                             l_xcec.xcec113,
                                                             l_xcec.xcec114,
                                                             l_xcec.xcec115,
                                                             l_xcec.xcec116,
                                                             l_xcec.xcec117,
                                                             l_xcec.xcec118,
                                                             l_xcec.xcec119,
                                                             l_xcec.xcec120,
                                                             l_xcec.xcec107,
                                                             l_xcec.xcec108,
                                                             l_xcec.xcec109,
                                                             l_xcec.xcec121,
                                                             l_xcec.xcec122,
                                                             l_xcec.xcec123,
                                                             l_xcec.xcec124,
                                                             l_xcec.xcec125,
                                                             l_xcec.xcec126,
                                                             l_xcec.xcec127,
                                                             l_xcec.xcec128,
                                                             l_xcec.xcec129,
                                                             l_xcec.xcec130  
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF  
      INSERT INTO xcec_t VALUES(l_xcec.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xcce_prep2
   CLOSE xcce_prep3      
   END FOREACH 
   
   #拆件工單 xcch_t
   #帳套本位幣順序+工單+主件   

   LET g_sql = " SELECT SUM(xcch202a),SUM(xcch202a),",
               "        SUM(xcch202b),SUM(xcch202c),SUM(xcch202d),SUM(xcch202e),",
               "        SUM(xcch202f),SUM(xcch202g),SUM(xcch202h) ",
               "   FROM xcch_t", 
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea_m.xcea004,
               "    AND xcch005 = ",g_xcea_m.xcea005,  
               "    AND xcch006 = ? AND xcch007 = ? AND xcch008 = ? AND xcch002 = ? " 

   LET g_sql1 = g_sql CLIPPED," AND xcch001 = '2' " 
   
   DECLARE xcch_prep2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xcch001 = '3' " 
   
   DECLARE xcch_prep3 CURSOR FROM g_sql1

   LET g_sql = " SELECT xcch006,xcch007,xcch008,xcch002,SUM(xcci201)+SUM(xcci301),SUM(xcci202)+SUM(xcci302),SUM(xcci202a)+SUM(xcci302a),",
               "        SUM(xcci202b)+SUM(xcci302b),SUM(xcci202c)+SUM(xcci302c),SUM(xcci202d)+SUM(xcci302d),SUM(xcci202e)+SUM(xcci302e),",
               "        SUM(xcci202f)+SUM(xcci302f),SUM(xcci202g)+SUM(xcci302g),SUM(xcci202h)+SUM(xcci302h) ",
               "   FROM xcch_t,xcci_t",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea_m.xcea004,
               "    AND xcch005 = ",g_xcea_m.xcea005,
               "    AND xcch001 = '1' ",
               "    AND xcchent = xccient",
               "    AND xcchld  = xccild",
               "    AND xcch001 = xcci001",
               "    AND xcch002 = xcci002",
               "    AND xcch003 = xcci003",
               "    AND xcch004 = xcci004",
               "    AND xcch005 = xcci005",
               "    AND xcch006 = xcci006",
               "    AND xcci007 != 'DL+OH+SUB'",
               "  GROUP BY xcch006,xcch007,xcch008,xcch002",
               "  ORDER BY xcch006,xcch007,xcch008,xcch002 "
   PREPARE xcch_prep FROM g_sql
   DECLARE xcch_curs CURSOR FOR xcch_prep
   FOREACH xcch_curs INTO l_xcch.xcch006,l_xcch.xcch007,l_xcch.xcch008,l_xcch.xcch002,l_xcch.xcch202a,l_xcch.xcch202a,
                          l_xcch.xcch202b,l_xcch.xcch202c,l_xcch.xcch202d,l_xcch.xcch202e,l_xcch.xcch202f,
                          l_xcch.xcch202g,l_xcch.xcch202h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcch"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = '' 
      LET l_sfaasite =''
      
      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb001 = l_xcch.xcch006 #工單
      LET l_xceb.xceb004 = l_xcch.xcch007 #主件
      LET l_xceb.xceb005 = l_xcch.xcch008 #特性
      LET l_xceb.xceb103 = l_xcch.xcch002 #成本域
 
      #本位幣一
      IF cl_null(l_xcch.xcch202a) THEN LET l_xcch.xcch202a = 0 END IF
      IF cl_null(l_xcch.xcch204a) THEN LET l_xcch.xcch204a = 0 END IF
      
      LET l_xceb.xceb202a = l_xcch.xcch202a + l_xcch.xcch204a
      LET l_xceb.xceb202b = l_xcch.xcch204b   
      LET l_xceb.xceb202c = l_xcch.xcch204c 
      LET l_xceb.xceb202d = l_xcch.xcch204d 
      LET l_xceb.xceb202e = l_xcch.xcch204e 
      LET l_xceb.xceb202f = l_xcch.xcch204f 
      LET l_xceb.xceb202g = l_xcch.xcch204g 
      LET l_xceb.xceb202h = l_xcch.xcch204h 
      
      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      
      
      LET l_xceb.xceb202  = l_xceb.xceb202a + l_xceb.xceb202b + l_xceb.xceb202c + l_xceb.xceb202d +
                            l_xceb.xceb202e + l_xceb.xceb202f + l_xceb.xceb202g + l_xceb.xceb202h           
      
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF  

     IF g_glaa015 ='Y' THEN
     #本位幣二
         OPEN xcch_prep2 USING l_xcch.xcch006,l_xcch.xcch007,l_xcch.xcch008,l_xcch.xcch002
         FETCH xcch_prep2 INTO l_xcch.xcch202a,l_xcch.xcch204a,l_xcch.xcch204b,l_xcch.xcch204c,l_xcch.xcch204d,
                               l_xcch.xcch204e,l_xcch.xcch204f,l_xcch.xcch204g,l_xcch.xcch204h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcch_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xcch.xcch202a) THEN LET l_xcch.xcch202a = 0 END IF
         IF cl_null(l_xcch.xcch204a) THEN LET l_xcch.xcch204a = 0 END IF
                          
         LET l_xceb.xceb212a = l_xcch.xcch202a + l_xcch.xcch204a
         LET l_xceb.xceb212b = l_xcch.xcch204b   
         LET l_xceb.xceb212c = l_xcch.xcch204c 
         LET l_xceb.xceb212d = l_xcch.xcch204d 
         LET l_xceb.xceb212e = l_xcch.xcch204e 
         LET l_xceb.xceb212f = l_xcch.xcch204f 
         LET l_xceb.xceb212g = l_xcch.xcch204g 
         LET l_xceb.xceb212h = l_xcch.xcch204h 
         
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         
         
         LET l_xceb.xceb212  = l_xceb.xceb212a + l_xceb.xceb212b + l_xceb.xceb212c + l_xceb.xceb212d +
                               l_xceb.xceb212e + l_xceb.xceb212f + l_xceb.xceb212g + l_xceb.xceb212h
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF                               
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF      
 
      #本位幣三
      IF g_glaa019 ='Y' THEN
         OPEN xcch_prep3 USING l_xcch.xcch006,l_xcch.xcch007,l_xcch.xcch008,l_xcch.xcch002
         FETCH xcch_prep3 INTO l_xcch.xcch202a,l_xcch.xcch204a,l_xcch.xcch204b,l_xcch.xcch204c,l_xcch.xcch204d,
                               l_xcch.xcch204e,l_xcch.xcch204f,l_xcch.xcch204g,l_xcch.xcch204h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcch_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
         
         IF cl_null(l_xcch.xcch202a) THEN LET l_xcch.xcch202a = 0 END IF
         IF cl_null(l_xcch.xcch204a) THEN LET l_xcch.xcch204a = 0 END IF
         
         
         LET l_xceb.xceb222a = l_xcch.xcch202a + l_xcch.xcch204a
         LET l_xceb.xceb222b = l_xcch.xcch204b   
         LET l_xceb.xceb222c = l_xcch.xcch204c 
         LET l_xceb.xceb222d = l_xcch.xcch204d 
         LET l_xceb.xceb222e = l_xcch.xcch204e 
         LET l_xceb.xceb222f = l_xcch.xcch204f 
         LET l_xceb.xceb222g = l_xcch.xcch204g 
         LET l_xceb.xceb222h = l_xcch.xcch204h
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         
         
         LET l_xceb.xceb222  = l_xceb.xceb222a + l_xceb.xceb222b + l_xceb.xceb222c + l_xceb.xceb222d +
                               l_xceb.xceb222e + l_xceb.xceb222f + l_xceb.xceb222g + l_xceb.xceb222h       
            
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF 
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      #項次
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise 
         AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xceb.xceb003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xceb.xceb101  

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xceb.xceb101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xceb.xceb101,l_errno
      END IF
      
      LET l_xceb.xceb102 = ''  #摘要
      LET l_xceb.xceb115 = ''  #經營類別
      LET l_xceb.xceb116 = ''  #渠道
      LET l_xceb.xceb118 = ''  #品牌
      
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xceb.xceb111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
      ELSE
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF        

      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      SELECT ooeg004 INTO l_xceb.xceb114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017  
       
      #品類
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xceb.xceb004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF 
      
      INSERT INTO xceb_t VALUES(l_xceb.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF      
   CLOSE xcch_prep2
   CLOSE xcch_prep3      
   END FOREACH     


   #拆件工單 xcci_t
   #帳套本位幣順序+工單+元件
   LET g_sql = " SELECT SUM(xcci202),SUM(xcci202a), ",
               "        SUM(xcci202b),SUM(xcci202c),SUM(xcci202d),SUM(xcci202e),",
               "        SUM(xcci202f),SUM(xcci202g),SUM(xcci202h) ",
               "   FROM xcci_t", 
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea_m.xcea004,
               "    AND xcci005 = ",g_xcea_m.xcea005,  
               "    AND xcci007 != 'DL+OH+SUB'",
               "    AND xcci006 = ? AND xcci007 = ? AND xcci008 = ? AND xcci002 = ? AND xcci009 = ?  " 

   LET g_sql1 = g_sql CLIPPED," AND xcci001 = '2' " 
   
   DECLARE xcci_prep2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xcci001 = '3' " 
   
   DECLARE xcci_prep3 CURSOR FROM g_sql1

   LET g_sql = " SELECT xcci006,xcci007,xcci008,xcci002,xcci009,SUM(xcci201)+SUM(xcci301),SUM(xcci202)+SUM(xcci302),SUM(xcci202a)+SUM(xcci302a),",
               "        SUM(xcci202b)+SUM(xcci302b),SUM(xcci202c)+SUM(xcci302c),SUM(xcci202d)+SUM(xcci302d),SUM(xcci202e)+SUM(xcci302e),",
               "        SUM(xcci202f)+SUM(xcci302f),SUM(xcci202g)+SUM(xcci302g),SUM(xcci202h)+SUM(xcci302h) ",
               "   FROM xcci_t",
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea_m.xcea004,
               "    AND xcci005 = ",g_xcea_m.xcea005,
               "    AND xcci007 != 'DL+OH+SUB'",
               "    AND xcci001 = '1' ",
               "  GROUP BY xcci006,xcci007,xcci008,xcci002,xcci009 ",
               "  ORDER BY xcci006,xcci007,xcci008,xcci002,xcci009 "
   PREPARE xcci_prep FROM g_sql
   DECLARE xcci_curs CURSOR FOR xcci_prep
   FOREACH xcci_curs INTO l_xcci.xcci006,l_xcci.xcci007,l_xcci.xcci008,l_xcci.xcci002,l_xcci.xcci009,
                          l_xcci.xcci201,l_xcci.xcci202,l_xcci.xcci202a,
                          l_xcci.xcci202b,l_xcci.xcci202c,l_xcci.xcci202d,l_xcci.xcci202e,l_xcci.xcci202f,
                          l_xcci.xcci202g,l_xcci.xcci202h                          
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcci"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''      
      LET l_sfaasite =''
      
      INITIALIZE l_xcec.* TO NULL      
        
      LET l_xcec.xcec001 = l_xcci.xcci006 #工單
      LET l_xcec.xcec004 = l_xcci.xcci007 #主件
      LET l_xcec.xcec005 = l_xcci.xcci008 #特性
      LET l_xcec.xcec103 = l_xcci.xcci002 #成本域
      
      #本位幣一
      LET l_xcec.xcec201 =  l_xcci.xcci201 #投入數量
      LET l_xcec.xcec202a = l_xcci.xcci202a 
      LET l_xcec.xcec202b = l_xcci.xcci202b   
      LET l_xcec.xcec202c = l_xcci.xcci202c 
      LET l_xcec.xcec202d = l_xcci.xcci202d 
      LET l_xcec.xcec202e = l_xcci.xcci202e 
      LET l_xcec.xcec202f = l_xcci.xcci202f 
      LET l_xcec.xcec202g = l_xcci.xcci202g 
      LET l_xcec.xcec202h = l_xcci.xcci202h 
      LET l_xcec.xcec202  = l_xcci.xcci202   
   
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF


      #本位幣二
      IF g_glaa015 ='Y' THEN
         OPEN xcci_prep2 USING l_xcci.xcci006,l_xcci.xcci007,l_xcci.xcci008,l_xcci.xcci002,l_xcci.xcci009
         FETCH xcci_prep2 INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                               l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h 
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcci_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
         
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

      #本位幣三
      IF g_glaa019 ='Y' THEN
         OPEN xcci_prep3 USING l_xcci.xcci006,l_xcci.xcci007,l_xcci.xcci008,l_xcci.xcci002,l_xcci.xcci009
         FETCH xcci_prep3 INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                               l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcci_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF                               
         
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      #項次
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise 
         AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xcec.xcec003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      #存貨科目
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xcec.xcec101 

      LET l_xcec.xcec102 = ''  #摘要
      LET l_xcec.xcec115 = ''  #經營類別
      LET l_xcec.xcec116 = ''  #渠道
      LET l_xcec.xcec118 = ''  #品牌
      
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xcec.xcec111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
      ELSE
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF        


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      SELECT ooeg004 INTO l_xcec.xcec114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017 
       
      #品類
      SELECT imag011 INTO l_xcec.xcec117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xcec.xcec004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','1') RETURNING l_success,l_xcec.xcec102
      END IF
      CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                             l_xcec.xcec101,
                                                             l_xcec.xcec102,
                                                             l_xcec.xcec103,
                                                             l_xcec.xcec110,
                                                             l_xcec.xcec111,
                                                             l_xcec.xcec112,
                                                             l_xcec.xcec113,
                                                             l_xcec.xcec114,
                                                             l_xcec.xcec115,
                                                             l_xcec.xcec116,
                                                             l_xcec.xcec117,
                                                             l_xcec.xcec118,
                                                             l_xcec.xcec119,
                                                             l_xcec.xcec120,
                                                             l_xcec.xcec107,
                                                             l_xcec.xcec108,
                                                             l_xcec.xcec109,
                                                             l_xcec.xcec121,
                                                             l_xcec.xcec122,
                                                             l_xcec.xcec123,
                                                             l_xcec.xcec124,
                                                             l_xcec.xcec125,
                                                             l_xcec.xcec126,
                                                             l_xcec.xcec127,
                                                             l_xcec.xcec128,
                                                             l_xcec.xcec129,
                                                             l_xcec.xcec130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF
      INSERT INTO xcec_t VALUES(l_xcec.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF

   CLOSE xcci_prep2
   CLOSE xcci_prep3   
       
   END FOREACH

   RETURN g_success   
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_2" order="7" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 在制入庫新增   2.在製入庫憑證  axct702
# Memo...........:
# Usage..........: CALL axct701_01_ins_2()
# Input parameter: 
# Return code....:  
# Date & Author..: 2014/4/20 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_2()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
DEFINE l_xcea          RECORD LIKE xcea_t.*
DEFINE l_xceb          RECORD LIKE xceb_t.*
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xced          RECORD LIKE xced_t.*
DEFINE l_xccd          RECORD LIKE xccd_t.*
DEFINE l_xcce          RECORD LIKE xcce_t.*
DEFINE l_xcch          RECORD LIKE xcch_t.*
DEFINE l_xcci          RECORD LIKE xcci_t.*
DEFINE l_xccg          RECORD LIKE xccg_t.*
DEFINE l_sfaa052       LIKE sfaa_t.sfaa052
DEFINE l_sfaa009       LIKE sfaa_t.sfaa009
DEFINE l_sfaa028       LIKE sfaa_t.sfaa028
DEFINE l_sfaa029       LIKE sfaa_t.sfaa029
DEFINE l_sfaa017       LIKE sfaa_t.sfaa017
DEFINE l_sfaasite      LIKE sfaa_t.sfaasite
DEFINE l_xced101_1     LIKE xced_t.xced101
DEFINE l_xced101_2     LIKE xced_t.xced101
DEFINE l_xced101_3     LIKE xced_t.xced101
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,l_xcea.xceacrtdt,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "ins xcea"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   #工單是否有聯產品入庫-若無
   #非拆件工單 xccd_t-主件
   #在xccd中排除工單中即有聯產品入庫，又有無聯產品入庫
   LET g_sql = " SELECT SUM(xccd302) *(-1),SUM(xccd302a)*(-1),",
               "        SUM(xccd302b)*(-1),SUM(xccd302c)*(-1),SUM(xccd302d)*(-1),SUM(xccd302e)*(-1),",
               "        SUM(xccd302f)*(-1),SUM(xccd302g)*(-1),SUM(xccd302h)*(-1) ",
               "   FROM xccd_t", 
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea_m.xcea004,
               "    AND xccd005 = ",g_xcea_m.xcea005,  
#               "    AND xccd006 NOT IN (SELECT xccg006 FROM xccg_t  WHERE xccgent = '",g_enterprise,"' ",
#               "                              AND xccgld = '",g_xcea_m.xceald,"' ",
#               "                              AND xccg003 = '",g_xcea_m.xcea003,"' ",
#               "                              AND xccg004 = ",g_xcea_m.xcea004,
#               "                              AND xccg005 = ",g_xcea_m.xcea005,")",               
               "    AND xccd006 = ? AND xccd007 = ? AND xccd008 = ? AND xccd002 = ? " 
 
   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '2' " 
   
   DECLARE xccd_prep2_2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xccd001 = '3' " 
   
   DECLARE xccd_prep3_2 CURSOR FROM g_sql1
   
   LET g_sql = " SELECT xccd006,xccd007,xccd008,xccd002,",
               "        SUM(xccd301) *(-1),SUM(xccd302) *(-1),SUM(xccd302a)*(-1),",
               "        SUM(xccd302b)*(-1),SUM(xccd302c)*(-1),SUM(xccd302d)*(-1),SUM(xccd302e)*(-1),",
               "        SUM(xccd302f)*(-1),SUM(xccd302g)*(-1),SUM(xccd302h)*(-1) ",
               "   FROM xccd_t",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea_m.xcea004,
               "    AND xccd005 = ",g_xcea_m.xcea005,
               "    AND xccd001 = '1' ",                
               "  GROUP BY xccd006,xccd007,xccd008,xccd002",
               "  ORDER BY xccd006,xccd007,xccd008,xccd002"
   PREPARE xccd_prep_2 FROM g_sql
   DECLARE xccd_curs_2 CURSOR FOR xccd_prep_2
   FOREACH xccd_curs_2 INTO l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002, 
                          l_xccd.xccd301,l_xccd.xccd302,l_xccd.xccd302a,
                          l_xccd.xccd302b,l_xccd.xccd302c,l_xccd.xccd302d,l_xccd.xccd302e,l_xccd.xccd302f,
                          l_xccd.xccd302g,l_xccd.xccd302h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xccd"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''      
      LET l_sfaasite =''
      
      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb001 = l_xccd.xccd006 #工單
      LET l_xceb.xceb004 = l_xccd.xccd007 #主件
      LET l_xceb.xceb005 = l_xccd.xccd008 #特性
      LET l_xceb.xceb103 = l_xccd.xccd002 #成本域
      
      #本位幣一
      LET l_xceb.xceb201 =  l_xccd.xccd301#入庫數量
      LET l_xceb.xceb202a = l_xccd.xccd302a 
      LET l_xceb.xceb202b = l_xccd.xccd302b   
      LET l_xceb.xceb202c = l_xccd.xccd302c 
      LET l_xceb.xceb202d = l_xccd.xccd302d 
      LET l_xceb.xceb202e = l_xccd.xccd302e 
      LET l_xceb.xceb202f = l_xccd.xccd302f 
      LET l_xceb.xceb202g = l_xccd.xccd302g 
      LET l_xceb.xceb202h = l_xccd.xccd302h 
      LET l_xceb.xceb202  = l_xccd.xccd302       

      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF
      
      IF g_glaa015 ='Y' THEN
      #本位幣二
         OPEN xccd_prep2_2 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep2_2 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                                 l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

      IF g_glaa019 ='Y' THEN
      #本位幣三
         OPEN xccd_prep3_2 USING l_xccd.xccd006,l_xccd.xccd007,l_xccd.xccd008,l_xccd.xccd002
         FETCH xccd_prep3_2 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                                 l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xccd_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      #項次
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise 
         AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xceb.xceb003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      #存貨科目
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xceb.xceb101  

      LET l_xceb.xceb102 = ''  #摘要
      LET l_xceb.xceb115 = ''  #經營類別
      LET l_xceb.xceb116 = ''  #渠道
      LET l_xceb.xceb118 = ''  #品牌
       
      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xceb.xceb111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
      ELSE
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF        


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      SELECT ooeg004 INTO l_xceb.xceb114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017   
       
      #品類
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xceb.xceb004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xceb.xceb001
      
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      IF l_xceb.xceb201=0 AND l_xceb.xceb202 = 0 AND l_xceb.xceb202a = 0 AND
         l_xceb.xceb202b = 0 AND l_xceb.xceb202c = 0 AND l_xceb.xceb202d = 0 AND 
         l_xceb.xceb202d = 0 AND l_xceb.xceb202f = 0 AND l_xceb.xceb202g = 0 AND 
         l_xceb.xceb202h = 0 THEN 
         CONTINUE FOREACH
      END IF 
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','2') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF 
      INSERT INTO xceb_t VALUES(l_xceb.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xccd_prep2_2
   CLOSE xccd_prep3_2      
   END FOREACH 


      
   #非拆件工單 xcce_t-元件
   LET g_sql = " SELECT SUM(xcce302) *(-1),SUM(xcce302a)*(-1), ",
               "        SUM(xcce302b)*(-1),SUM(xcce302c)*(-1),SUM(xcce302d)*(-1),SUM(xcce302e)*(-1),",
               "        SUM(xcce302f)*(-1),SUM(xcce302g)*(-1),SUM(xcce302h)*(-1) ",
               "   FROM xcce_t", 
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea_m.xcea004,
               "    AND xcce005 = ",g_xcea_m.xcea005,  
               "    AND xcce006 = ? AND xcce007 = ? AND xcce008 = ? AND xcce002 = ?  " 
 
   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '2' " 
   
   DECLARE xcce_prep2_2 CURSOR FROM g_sql1
   
   LET g_sql1 = g_sql CLIPPED," AND xcce001 = '3' " 
   
   DECLARE xcce_prep3_2 CURSOR FROM g_sql1
   
   LET g_sql = " SELECT xcce006,xcce007,xcce008,xcce002,",
               "        SUM(xcce301) *(-1),SUM(xcce302) *(-1),SUM(xcce302a)*(-1),",
               "        SUM(xcce302b)*(-1),SUM(xcce302c)*(-1),SUM(xcce302d)*(-1),SUM(xcce302e)*(-1),",
               "        SUM(xcce302f)*(-1),SUM(xcce302g)*(-1),SUM(xcce302h)*(-1) ",
               "   FROM xcce_t",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea_m.xcea004,
               "    AND xcce005 = ",g_xcea_m.xcea005,
               "    AND xcce001 = '1' ",
               "  GROUP BY xcce006,xcce007,xcce008,xcce002",
               "  ORDER BY xcce006,xcce007,xcce008,xcce002 "
   PREPARE xcce_prep_2 FROM g_sql
   DECLARE xcce_curs_2 CURSOR FOR xcce_prep_2
   FOREACH xcce_curs_2 INTO l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce008,l_xcce.xcce002,
                          l_xcce.xcce301,l_xcce.xcce302,l_xcce.xcce302a,
                          l_xcce.xcce302b,l_xcce.xcce302c,l_xcce.xcce302d,l_xcce.xcce302e,l_xcce.xcce302f,
                          l_xcce.xcce302g,l_xcce.xcce302h                         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcce"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF  
      LET l_sfaa052 = ''
      LET l_sfaa009 = ''
      LET l_sfaa028 = ''
      LET l_sfaa029 = ''
      LET l_sfaa017 = ''
      LET l_sfaasite =''
      
      INITIALIZE l_xcec.* TO NULL
      
      LET l_xcec.xcec001 = l_xcce.xcce006 #工單
      LET l_xcec.xcec004 = l_xcce.xcce007 #主件
      LET l_xcec.xcec005 = l_xcce.xcce008 #特性
      LET l_xcec.xcec103 = l_xcce.xcce002 #成本域
      
      #本位幣一
      LET l_xcec.xcec201 =  l_xcce.xcce301#投入數量
      LET l_xcec.xcec202a = l_xcce.xcce302a 
      LET l_xcec.xcec202b = l_xcce.xcce302b   
      LET l_xcec.xcec202c = l_xcce.xcce302c 
      LET l_xcec.xcec202d = l_xcce.xcce302d 
      LET l_xcec.xcec202e = l_xcce.xcce302e 
      LET l_xcec.xcec202f = l_xcce.xcce302f 
      LET l_xcec.xcec202g = l_xcce.xcce302g 
      LET l_xcec.xcec202h = l_xcce.xcce302h 
      LET l_xcec.xcec202  = l_xcce.xcce302       

      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF

      #本位幣二
      IF g_glaa015 ='Y' THEN
         OPEN  xcce_prep2_2 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce008,l_xcce.xcce002
         FETCH xcce_prep2_2 INTO  l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                                  l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep2"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF  
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF         
      
      #本位幣三
      IF g_glaa019 ='Y' THEN
         OPEN  xcce_prep3_2 USING l_xcce.xcce006,l_xcce.xcce007,l_xcce.xcce008,l_xcce.xcce002
         FETCH xcce_prep3_2 INTO  l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                                  l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcce_prep3"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF 
         
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF         
      
      #項次
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise 
         AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型
      SELECT sfaa003 INTO l_xcec.xcec003 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xcec.xcec101 

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      
      LET l_xcec.xcec102 = ''  #摘要
      LET l_xcec.xcec115 = ''  #經營類別
      LET l_xcec.xcec116 = ''  #渠道
      LET l_xcec.xcec118 = ''  #品牌

      #交易對象
      SELECT sfaa052,sfaa009,sfaasite INTO l_sfaa052,l_sfaa009,l_sfaasite FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      IF l_sfaa052 = '2' THEN #委外
         LET l_xcec.xcec111 = l_sfaa009
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
      ELSE
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 


      
      #成本中心--暫用部門sfaa017抓取其歸屬成本中心
      SELECT sfaa017 INTO l_sfaa017 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      SELECT ooeg004 INTO l_xcec.xcec114 FROM ooeg_t
       WHERE ooegent = g_enterprise AND ooeg001 = l_sfaa017 

      #品類
      SELECT imag011 INTO l_xcec.xcec117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp 
         AND imag001 = l_xcec.xcec004   

      #項目編號+WBS
      SELECT sfaa028,sfaa029 INTO l_sfaa028,l_sfaa029 FROM sfaa_t
       WHERE sfaaent = g_enterprise 
         AND sfaadocno = l_xcec.xcec001
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      IF l_xcec.xcec201 = 0 AND l_xcec.xcec202 = 0 AND l_xcec.xcec202a = 0 AND l_xcec.xcec202b= 0 AND
         l_xcec.xcec202c= 0  AND l_xcec.xcec202d= 0  AND l_xcec.xcec202e= 0   AND l_xcec.xcec202f= 0  AND 
         l_xcec.xcec202g= 0  AND l_xcec.xcec202h= 0 THEN 
         CONTINUE FOREACH 
      END IF
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','2') RETURNING l_success,l_xcec.xcec102
      END IF

      CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                             l_xcec.xcec101,
                                                             l_xcec.xcec102,
                                                             l_xcec.xcec103,
                                                             l_xcec.xcec110,
                                                             l_xcec.xcec111,
                                                             l_xcec.xcec112,
                                                             l_xcec.xcec113,
                                                             l_xcec.xcec114,
                                                             l_xcec.xcec115,
                                                             l_xcec.xcec116,
                                                             l_xcec.xcec117,
                                                             l_xcec.xcec118,
                                                             l_xcec.xcec119,
                                                             l_xcec.xcec120,
                                                             l_xcec.xcec107,
                                                             l_xcec.xcec108,
                                                             l_xcec.xcec109,
                                                             l_xcec.xcec121,
                                                             l_xcec.xcec122,
                                                             l_xcec.xcec123,
                                                             l_xcec.xcec124,
                                                             l_xcec.xcec125,
                                                             l_xcec.xcec126,
                                                             l_xcec.xcec127,
                                                             l_xcec.xcec128,
                                                             l_xcec.xcec129,
                                                             l_xcec.xcec130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF
      INSERT INTO xcec_t VALUES(l_xcec.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
   CLOSE xcce_prep2_2
   CLOSE xcce_prep3_2      
   END FOREACH 

   #第三單身
   CALL axct701_01_ins_xced() RETURNING l_success
   IF NOT l_success THEN LET g_success = 'N' END IF 

 RETURN g_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_xced" order="8" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 新增xced
# Memo...........:
# Usage..........: CALL axct701_01_ins_xced()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/20 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_xced()
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xced          RECORD LIKE xced_t.*
DEFINE l_xced101_1     LIKE xced_t.xced101
DEFINE l_xced101_2     LIKE xced_t.xced101
DEFINE l_xced101_3     LIKE xced_t.xced101
DEFINE l_xced101_4     LIKE xced_t.xced101
DEFINE l_xced101_5     LIKE xced_t.xced101
DEFINE l_xced101_6     LIKE xced_t.xced101
DEFINE l_xced101_7     LIKE xced_t.xced101
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001

INITIALIZE l_xcec.* TO NULL
INITIALIZE l_xced.* TO NULL
   #xcec_t中DL+OH_SUB元件彙總-xced   
   LET g_sql = " SELECT xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120,",
               "        SUM(xcec202b),SUM(xcec202c),SUM(xcec202d),SUM(xcec202e),",
               "        SUM(xcec202f),SUM(xcec202g),SUM(xcec202h), ",
               "        SUM(xcec212b),SUM(xcec212c),SUM(xcec212d),SUM(xcec212e),",
               "        SUM(xcec212f),SUM(xcec212g),SUM(xcec212h), ",
               "        SUM(xcec222b),SUM(xcec222c),SUM(xcec222d),SUM(xcec222e),",
               "        SUM(xcec222f),SUM(xcec222g),SUM(xcec222h) ",
               "   FROM xcec_t",
               "  WHERE xcecent = '",g_enterprise,"' AND xcecld = '",g_xcea_m.xceald,"'",
               "    AND xcecdocno = '",g_xcea_m.xceadocno,"'", 
               "    AND xcec004 = 'DL+OH+SUB' ",
               "  GROUP BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 ",
               "  ORDER BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 "
   PREPARE xcec_prep_2 FROM g_sql
   DECLARE xcec_curs_2 CURSOR FOR xcec_prep_2
   FOREACH xcec_curs_2 INTO l_xcec.xcec102,l_xcec.xcec114,l_xcec.xcec113,
                            l_xcec.xcec111,l_xcec.xcec117,l_xcec.xcec119,l_xcec.xcec120,
                            l_xcec.xcec202b,l_xcec.xcec202c,l_xcec.xcec202d,l_xcec.xcec202e,l_xcec.xcec202f,
                            l_xcec.xcec202g,l_xcec.xcec202h, 
                            l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,
                            l_xcec.xcec212g,l_xcec.xcec212h,
                            l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,
                            l_xcec.xcec222g,l_xcec.xcec222h                        
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "foreach xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  
   
      LET l_xced.xced102 = l_xcec.xcec102
      LET l_xced.xced114 = l_xcec.xcec114
      LET l_xced.xced113 = l_xcec.xcec113
      LET l_xced.xced111 = l_xcec.xcec111
      LET l_xced.xced117 = l_xcec.xcec117
      LET l_xced.xced119 = l_xcec.xcec119
      LET l_xced.xced120 = l_xcec.xcec120
      
      #在制人工科目
      CALL s_get_item_acc(g_xcea_m.xceald,'6',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_1  

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xced101_1) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','2') RETURNING l_success,l_xced101_1,l_errno
      END IF
      
      #在制加工费科目
      CALL s_get_item_acc(g_xcea_m.xceald,'7',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_2  

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xced101_2) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','3') RETURNING l_success,l_xced101_2,l_errno
      END IF
      
      #在制制费一科目
      CALL s_get_item_acc(g_xcea_m.xceald,'11',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_3  

      IF cl_null(l_xced101_3) THEN
         LET l_xced101_3 = l_xced101_2
      END IF
      
      #在制制费二科目
      CALL s_get_item_acc(g_xcea_m.xceald,'12',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_4  

      IF cl_null(l_xced101_4) THEN
         LET l_xced101_4 = l_xced101_2
      END IF
      
      #在制制费三科目
      CALL s_get_item_acc(g_xcea_m.xceald,'13',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_5  

      IF cl_null(l_xced101_5) THEN
         LET l_xced101_5 = l_xced101_2
      END IF
      
      #在制费四科目
      CALL s_get_item_acc(g_xcea_m.xceald,'14',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_6  

      IF cl_null(l_xced101_6) THEN
         LET l_xced101_6 = l_xced101_2
      END IF
      
      #在制制费五科目
      CALL s_get_item_acc(g_xcea_m.xceald,'15',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xced101_7  

      IF cl_null(l_xced101_7) THEN
         LET l_xced101_7 = l_xced101_2
      END IF         
                
      #項次
      SELECT MAX(xcedseq) INTO l_xced.xcedseq FROM xced_t
       WHERE xcedent = g_enterprise 
         AND xcedld = g_xcea_m.xceald
         AND xceddocno = g_xcea_m.xceadocno
      IF cl_null(l_xced.xcedseq) OR l_xced.xcedseq = 0 THEN
         LET l_xced.xcedseq = 1
      ELSE
         LET l_xced.xcedseq = l_xced.xcedseq + 1
      END IF       
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 1
      LET l_xced.xced101   = l_xced101_1
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202b
      LET l_xced.xced212   = l_xcec.xcec212b
      LET l_xced.xced222   = l_xcec.xcec222b
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      
      INSERT INTO xced_t VALUES (l_xced.*)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 1"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  

      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 2
      LET l_xced.xced101   = l_xced101_2
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202c
      LET l_xced.xced212   = l_xcec.xcec212c
      LET l_xced.xced222   = l_xcec.xcec222c
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1    
      
      INSERT INTO xced_t VALUES (l_xced.*)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 2"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF


      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 3
      LET l_xced.xced101   = l_xced101_3
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202d
      LET l_xced.xced212   = l_xcec.xcec212d
      LET l_xced.xced222   = l_xcec.xcec222d
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
      INSERT INTO xced_t VALUES (l_xced.*)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 3"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF   
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 4
      LET l_xced.xced101   = l_xced101_4
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202e
      LET l_xced.xced212   = l_xcec.xcec212e
      LET l_xced.xced222   = l_xcec.xcec222e
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
      INSERT INTO xced_t VALUES (l_xced.*) 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 4"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 5
      LET l_xced.xced101   = l_xced101_5
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202f
      LET l_xced.xced212   = l_xcec.xcec212f
      LET l_xced.xced222   = l_xcec.xcec222f
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
      INSERT INTO xced_t VALUES (l_xced.*)     
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 5"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF  
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 6
      LET l_xced.xced101   = l_xced101_6
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202g
      LET l_xced.xced212   = l_xcec.xcec212g
      LET l_xced.xced222   = l_xcec.xcec222g
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
      INSERT INTO xced_t VALUES (l_xced.*)  
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 6"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF 
      
      LET l_xced.xcedent   = g_enterprise
      LET l_xced.xcedcomp  = g_xcea_m.xceacomp
      LET l_xced.xcedld    = g_xcea_m.xceald
      LET l_xced.xceddocno = g_xcea_m.xceadocno
      LET l_xced.xced001   = 7
      LET l_xced.xced101   = l_xced101_7
      LET l_xced.xced110   = ''
      LET l_xced.xced112   = ''
      LET l_xced.xced115   = ''
      LET l_xced.xced116   = ''
      LET l_xced.xced118   = ''
      LET l_xced.xced202   = l_xcec.xcec202h
      LET l_xced.xced212   = l_xcec.xcec212h
      LET l_xced.xced222   = l_xcec.xcec222h
      LET l_xced.xced301   = ''
      LET l_xced.xced302   = '' 
      LET l_xced.xcedseq = l_xced.xcedseq + 1 
      
      INSERT INTO xced_t VALUES (l_xced.*)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "xced 7"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET g_success = 'N'
         EXIT FOREACH
      END IF                                 
 
   END FOREACH
   RETURN g_success 
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_7" order="9" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 新增axct707    6.雜項進出憑證   axct707
# Memo...........:
# Usage..........: CALL axct701_01_ins_6()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/22 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_7()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
DEFINE l_xcea          RECORD LIKE xcea_t.*
DEFINE l_xceb          RECORD LIKE xceb_t.*
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xcck          RECORD LIKE xcck_t.*
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET g_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck020 IN ('101','301') ",            
               "    AND xcck002 = ? AND xcck006 = ? AND xcck010 = ? AND xcck011 = ? AND xcck009 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 

   LET g_sql1 = g_sql CLIPPED," AND xcck001 = '2' " 
   LET g_sql1 = g_sql1," AND xcck033 = ? "    
   LET g_sql2 = g_sql CLIPPED," AND xcck001 = '3' "    
   LET g_sql2 = g_sql2," AND xcck033 = ? "
   LET g_sql = " SELECT xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck033,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('101','301') ",
               " GROUP BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033",
               " ORDER BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033"
   PREPARE xcck_prep FROM g_sql
   DECLARE xcck_curs CURSOR FOR xcck_prep
   

   FOREACH xcck_curs INTO   l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h

      INITIALIZE l_xceb.* TO NULL

      CASE l_xcck.xcck009
         WHEN -1          #杂发
            LET l_xceb.xceb003 = '5'
         WHEN  1          #杂收
            LET l_xceb.xceb003 = '6'        
      END CASE

#wujie 150409 --begin
      SELECT inba004,inba007 INTO l_xceb.xceb108,l_xceb.xceb110   #部门
        FROM inba_t
       WHERE inbaent = g_enterprise
         AND inbadocno = l_xcck.xcck006
         
      LET l_xceb.xceb103 = l_xcck.xcck002 #成本域
      LET l_xceb.xceb004 = l_xcck.xcck010 #料號
      LET l_xceb.xceb005 = l_xcck.xcck011 #特性
      IF NOT cl_null(l_xcck.xcck021) THEN
         LET l_xceb.xceb110 = l_xcck.xcck021 #原因碼
      END IF
#wujie 150409 --end
      LET l_xceb.xceb111 = l_xcck.xcck022 #交易對象      
      LET l_xceb.xceb112 = l_xcck.xcck023 #客群 
      LET l_xceb.xceb113 = l_xcck.xcck024 #區域  
      LET l_xceb.xceb114 = l_xcck.xcck025 #成本中心      
      LET l_xceb.xceb115 = l_xcck.xcck026 #經營類別
      LET l_xceb.xceb116 = l_xcck.xcck027 #渠道
      LET l_xceb.xceb117 = l_xcck.xcck028 #品類
      LET l_xceb.xceb118 = l_xcck.xcck029 #品牌
      LET l_xceb.xceb119 = l_xcck.xcck030 #項目號
      LET l_xceb.xceb120 = l_xcck.xcck031 #WBS
      LET l_xceb.xceb101 = l_xcck.xcck033 #費用科目  
      
      LET l_xceb.xceb201 = l_xcck.xcck201
      LET l_xceb.xceb202 = l_xcck.xcck202
      LET l_xceb.xceb202a = l_xcck.xcck202a
      LET l_xceb.xceb202b = l_xcck.xcck202b
      LET l_xceb.xceb202c = l_xcck.xcck202c
      LET l_xceb.xceb202d = l_xcck.xcck202d
      LET l_xceb.xceb202e = l_xcck.xcck202e
      LET l_xceb.xceb202f = l_xcck.xcck202f
      LET l_xceb.xceb202g = l_xcck.xcck202g
      LET l_xceb.xceb202h = l_xcck.xcck202h
      
      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF      
      
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF  

      IF cl_null(l_xcck.xcck033) THEN  
#杂项费用科目        
#抓agli180的科目
         IF cl_null(l_xceb.xceb101) THEN
            SELECT glab005 INTO l_xceb.xceb101
              FROM glab_t
             WHERE glabld  = g_xcea_m.xceald
               AND glab001 = '11'
               AND glab002 = '216'
               AND glab003 = l_xcck.xcck021
               AND glabent = g_enterprise         
         END IF
#agli180抓不到，改抓agli201的科目
         IF cl_null(l_xceb.xceb101) THEN
            CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','7') RETURNING l_success,l_xceb.xceb101,l_errno
         END IF
      ELSE
         LET l_xceb.xceb101 = l_xcck.xcck033 
      END IF      
      IF g_glaa015 = 'Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN       

#         END IF
         DECLARE xcck_prep2 CURSOR FROM g_sql1
         OPEN xcck_prep2 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
         FETCH xcck_prep2 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep2"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
           
      
      IF g_glaa019 = 'Y' THEN 
#         IF NOT cl_null(l_xcck.xcck033) THEN       
            
#         END IF
         DECLARE xcck_prep3 CURSOR FROM g_sql2
         OPEN xcck_prep3 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
         FETCH xcck_prep3 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep3"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF

         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','7') RETURNING l_success,l_xceb.xceb102
      END IF     
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF       
      INSERT INTO xceb_t VALUES(l_xceb.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
      CLOSE xcck_prep2
      CLOSE xcck_prep3  
  END FOREACH  
  
  LET g_sql = " SELECT  SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck020 IN ('101','301') ",                       
               "    AND xcck002 = ? AND xcck006 = ? AND xcck010 = ? AND xcck011 = ? AND xcck009 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 
  
   LET g_sql1 = g_sql CLIPPED," AND xcck001 = '2' " 
   LET g_sql1 = g_sql1," AND xcck032 = ? "
   LET g_sql2 = g_sql CLIPPED," AND xcck001 = '3' " 
   LET g_sql2 = g_sql2," AND xcck032 = ? "
   
   LET g_sql = " SELECT xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck032,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('101','301') ",
               " GROUP BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032",
               " ORDER BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032"
   PREPARE xcck_prep_1 FROM g_sql
   DECLARE xcck_curs_1 CURSOR FOR xcck_prep_1
   

   FOREACH xcck_curs_1 INTO   l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h

      INITIALIZE l_xcec.* TO NULL
      
      CASE l_xcck.xcck009
         WHEN -1          #杂发
            LET l_xcec.xcec003 = '5'
         WHEN  1          #杂收
            LET l_xcec.xcec003 = '6'        
      END CASE
     
#wujie 150409 --begin
      SELECT inba004,inba007 INTO l_xcec.xcec108,l_xcec.xcec110   #部门
        FROM inba_t
       WHERE inbaent = g_enterprise
         AND inbadocno = l_xcck.xcck006  
         
      LET l_xcec.xcec103 = l_xcck.xcck002 #成本域
      LET l_xcec.xcec004 = l_xcck.xcck010 #料號
      LET l_xcec.xcec005 = l_xcck.xcck011 #特性
      IF NOT cl_null(l_xcck.xcck021) THEN
         LET l_xcec.xcec110 = l_xcck.xcck021 #原因碼
      END IF
#wujie 150409 --end
      LET l_xcec.xcec111 = l_xcck.xcck022 #交易對象      
      LET l_xcec.xcec112 = l_xcck.xcck023 #客群 
      LET l_xcec.xcec113 = l_xcck.xcck024 #區域  
      LET l_xcec.xcec114 = l_xcck.xcck025 #成本中心      
      LET l_xcec.xcec115 = l_xcck.xcck026 #經營類別
      LET l_xcec.xcec116 = l_xcck.xcck027 #渠道
      LET l_xcec.xcec117 = l_xcck.xcck028 #品類
      LET l_xcec.xcec118 = l_xcck.xcck029 #品牌
      LET l_xcec.xcec119 = l_xcck.xcck030 #項目號
      LET l_xcec.xcec120 = l_xcck.xcck031 #WBS
      LET l_xcec.xcec101 = l_xcck.xcck032 #存貨科目 

  


      LET l_xcec.xcec202 = l_xcck.xcck202
      LET l_xcec.xcec202a = l_xcck.xcck202a
      LET l_xcec.xcec202b = l_xcck.xcck202b
      LET l_xcec.xcec202c = l_xcck.xcck202c
      LET l_xcec.xcec202d = l_xcck.xcck202d
      LET l_xcec.xcec202e = l_xcck.xcck202e
      LET l_xcec.xcec202f = l_xcck.xcck202f
      LET l_xcec.xcec202g = l_xcck.xcck202g
      LET l_xcec.xcec202h = l_xcck.xcck202h
      
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF         
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF        
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF  

      IF cl_null(l_xcck.xcck032) THEN  
         CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'')  #存貨科目   #wujie 150214
          RETURNING l_success,l_xcec.xcec101    
      ELSE
         LET l_xcec.xcec101 = l_xcck.xcck032 
      END IF      
    
      IF g_glaa015 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck032) THEN
            
#         END IF
         DECLARE xcck_prep2_1 CURSOR FROM g_sql1
         OPEN xcck_prep2_1 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
         FETCH xcck_prep2_1 INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                               l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep2_1"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
         
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF 
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF         
      
      IF g_glaa019 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck032) THEN 
            
#         END IF
         DECLARE xcck_prep3_1 CURSOR FROM g_sql2
         OPEN xcck_prep3_1 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
         FETCH xcck_prep3_1 INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                               l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep3_1"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF  
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF         
      
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','7') RETURNING l_success,l_xcec.xcec102
      END IF
      
      CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                             l_xcec.xcec101,
                                                             l_xcec.xcec102,
                                                             l_xcec.xcec103,
                                                             l_xcec.xcec110,
                                                             l_xcec.xcec111,
                                                             l_xcec.xcec112,
                                                             l_xcec.xcec113,
                                                             l_xcec.xcec114,
                                                             l_xcec.xcec115,
                                                             l_xcec.xcec116,
                                                             l_xcec.xcec117,
                                                             l_xcec.xcec118,
                                                             l_xcec.xcec119,
                                                             l_xcec.xcec120,
                                                             l_xcec.xcec107,
                                                             l_xcec.xcec108,
                                                             l_xcec.xcec109,
                                                             l_xcec.xcec121,
                                                             l_xcec.xcec122,
                                                             l_xcec.xcec123,
                                                             l_xcec.xcec124,
                                                             l_xcec.xcec125,
                                                             l_xcec.xcec126,
                                                             l_xcec.xcec127,
                                                             l_xcec.xcec128,
                                                             l_xcec.xcec129,
                                                             l_xcec.xcec130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF      
      INSERT INTO xcec_t VALUES(l_xcec.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
      CLOSE xcck_prep2_1
      CLOSE xcck_prep3_1  
  END FOREACH 
  RETURN g_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_8" order="10" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 新增axct708   7.雜項進出差异憑證  axct708
# Memo...........:
# Usage..........: CALL axct701_01_ins_8()
# Input parameter:  
# Return code....:  
# Date & Author..: 2014/4/22 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_8()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
DEFINE l_xcea          RECORD LIKE xcea_t.*
DEFINE l_xceb          RECORD LIKE xceb_t.*
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xceb1         RECORD LIKE xceb_t.*
DEFINE l_xcec1         RECORD LIKE xcec_t.*
DEFINE l_xcck          RECORD LIKE xcck_t.*
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET g_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck020 IN ('101','301') ",                     
               "    AND xcck002 = ? AND xcck010 = ? AND xcck011 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 
   
   LET g_sql1 = g_sql CLIPPED," AND xcck001 = '2' " 
     
   LET g_sql2 = g_sql CLIPPED," AND xcck001 = '3' " 

   
   LET g_sql = " SELECT xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck033,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('101','301') ",
               " GROUP BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033",
               " ORDER BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033"
   PREPARE xcck_prep_2 FROM g_sql
   DECLARE xcck_curs_2 CURSOR FOR xcck_prep_2
   

   FOREACH xcck_curs_2 INTO l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h

      INITIALIZE l_xceb.* TO NULL
      
      LET l_xceb.xceb103 = l_xcck.xcck002 #成本域
      LET l_xceb.xceb004 = l_xcck.xcck010 #料號
      LET l_xceb.xceb005 = l_xcck.xcck011 #料號特性
      LET l_xceb.xceb110 = l_xcck.xcck021 #原因碼
      LET l_xceb.xceb111 = l_xcck.xcck022 #交易對象      
      LET l_xceb.xceb112 = l_xcck.xcck023 #客群 
      LET l_xceb.xceb113 = l_xcck.xcck024 #區域  
      LET l_xceb.xceb114 = l_xcck.xcck025 #成本中心      
      LET l_xceb.xceb115 = l_xcck.xcck026 #經營類別
      LET l_xceb.xceb116 = l_xcck.xcck027 #渠道
      LET l_xceb.xceb117 = l_xcck.xcck028 #品類
      LET l_xceb.xceb118 = l_xcck.xcck029 #品牌
      LET l_xceb.xceb119 = l_xcck.xcck030 #項目號
      LET l_xceb.xceb120 = l_xcck.xcck031 #WBS
      LET l_xceb.xceb101 = l_xcck.xcck033 #費用科目  
      LET l_xceb.xceb201 = l_xcck.xcck201
      LET l_xceb.xceb202 = l_xcck.xcck202
      LET l_xceb.xceb202a = l_xcck.xcck202a
      LET l_xceb.xceb202b = l_xcck.xcck202b
      LET l_xceb.xceb202c = l_xcck.xcck202c
      LET l_xceb.xceb202d = l_xcck.xcck202d
      LET l_xceb.xceb202e = l_xcck.xcck202e
      LET l_xceb.xceb202f = l_xcck.xcck202f
      LET l_xceb.xceb202g = l_xcck.xcck202g
      LET l_xceb.xceb202h = l_xcck.xcck202h

      
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF  

      IF cl_null(l_xcck.xcck033) THEN  
#杂项费用科目
#抓agli180的科目
         IF cl_null(l_xceb.xceb101) THEN
            SELECT glab005 INTO l_xceb.xceb101
              FROM glab_t
             WHERE glabld  = g_xcea_m.xceald
               AND glab001 = '11'
               AND glab002 = '216'
               AND glab003 = l_xcck.xcck021
               AND glabent = g_enterprise         
         END IF
#agli180抓不到，改抓agli201的科目
         IF cl_null(l_xceb.xceb101) THEN
            CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','7') RETURNING l_success,l_xceb.xceb101,l_errno
         END IF        
      ELSE
         LET l_xceb.xceb101 = l_xcck.xcck033 
      END IF      
    
      IF g_glaa015 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql1 = g_sql1," AND xcck033 = ? "
#         END IF
         DECLARE xcck_prep2_2 CURSOR FROM g_sql1
         OPEN xcck_prep2_2 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
         FETCH xcck_prep2_2 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep2_2"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql2 = g_sql2," AND xcck033 = ? "
#         END IF
         DECLARE xcck_prep3_2 CURSOR FROM g_sql2
         OPEN xcck_prep3_2 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
         FETCH xcck_prep3_2 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep3_2"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF
      
      #雜項進出憑證xcea002 = '7'
      LET g_sql = " SELECT SUM(xceb201),SUM(xceb202), ",
               "        SUM(xceb202a),SUM(xceb202b),SUM(xceb202c),SUM(xceb202d),",
               "        SUM(xceb202e),SUM(xceb202f),SUM(xceb202g),SUM(xceb202h), ",
               "        SUM(xceb212),SUM(xceb212a),SUM(xceb212b),SUM(xceb212c),SUM(xceb212d),",
               "        SUM(xceb212e),SUM(xceb212f),SUM(xceb212g),SUM(xceb212h), ",
               "        SUM(xceb222),SUM(xceb222a),SUM(xceb222b),SUM(xceb222c),SUM(xceb222d),",
               "        SUM(xceb222e),SUM(xceb222f),SUM(xceb222g),SUM(xceb222h) ",               
               "        FROM xcea_t LEFT OUTER JOIN xceb_t ON xceaent = xcebent AND xceald = xcebld ",
               "         AND xceadocno = xcebdocno " ,              
               "  WHERE xceaent = '",g_enterprise,"' AND xceald = '",g_xcea_m.xceald,"'",
               "    AND xcea003 = '",g_xcea_m.xcea003,"' AND xcea004 = ",g_xcea_m.xcea004,
               "    AND xcea005 = ",g_xcea_m.xcea005," AND xcea002 = '7' ",
               "    AND xceb103 = ? ",
               "    AND xceb004 = ? ", 
               "    AND xceb005 = ? ",
               "    AND xceb110 = ? ", 
               "    AND xceb111 = ? ",      
               "    AND xceb112 = ? ", 
               "    AND xceb113 = ? ",  
               "    AND xceb114 = ? ",      
               "    AND xceb115 = ? ",
               "    AND xceb116 = ? ",
               "    AND xceb117 = ? ", 
               "    AND xceb118 = ? ",
               "    AND xceb119 = ? ",
               "    AND xceb120 = ? ",
               "    AND xceb101 = ? "
               
      PREPARE xceb_prep FROM g_sql
      DECLARE xceb_curs CURSOR FOR xceb_prep
      
      OPEN xceb_curs USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
      FOREACH xceb_curs INTO l_xceb1.xceb201,
                             l_xceb1.xceb202,l_xceb1.xceb202a,l_xceb1.xceb202b,l_xceb1.xceb202c,l_xceb1.xceb202d,
                             l_xceb1.xceb202e,l_xceb1.xceb202f,l_xceb1.xceb202g,l_xceb1.xceb202h,
                             l_xceb1.xceb212,l_xceb1.xceb212a,l_xceb1.xceb212b,l_xceb1.xceb212c,l_xceb1.xceb212d,
                             l_xceb1.xceb212e,l_xceb1.xceb212f,l_xceb1.xceb212g,l_xceb1.xceb212h,
                             l_xceb1.xceb222,l_xceb1.xceb222a,l_xceb1.xceb222b,l_xceb1.xceb222c,l_xceb1.xceb222d,
                             l_xceb1.xceb222e,l_xceb1.xceb222f,l_xceb1.xceb222g,l_xceb1.xceb222h


         IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
         IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
         IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
         IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
         IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
         IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
         IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
         IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
         IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF
         IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF    
         IF cl_null(l_xceb1.xceb202a) THEN LET l_xceb1.xceb202a = 0 END IF
         IF cl_null(l_xceb1.xceb202b) THEN LET l_xceb1.xceb202b = 0 END IF
         IF cl_null(l_xceb1.xceb202c) THEN LET l_xceb1.xceb202c = 0 END IF
         IF cl_null(l_xceb1.xceb202d) THEN LET l_xceb1.xceb202d = 0 END IF
         IF cl_null(l_xceb1.xceb202e) THEN LET l_xceb1.xceb202e = 0 END IF
         IF cl_null(l_xceb1.xceb202f) THEN LET l_xceb1.xceb202f = 0 END IF
         IF cl_null(l_xceb1.xceb202g) THEN LET l_xceb1.xceb202g = 0 END IF
         IF cl_null(l_xceb1.xceb202h) THEN LET l_xceb1.xceb202h = 0 END IF
         IF cl_null(l_xceb1.xceb202)  THEN LET l_xceb1.xceb202  = 0 END IF
         IF cl_null(l_xceb1.xceb201)  THEN LET l_xceb1.xceb201  = 0 END IF    
         
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF 
         IF cl_null(l_xceb1.xceb212a) THEN LET l_xceb1.xceb212a = 0 END IF
         IF cl_null(l_xceb1.xceb212b) THEN LET l_xceb1.xceb212b = 0 END IF
         IF cl_null(l_xceb1.xceb212c) THEN LET l_xceb1.xceb212c = 0 END IF
         IF cl_null(l_xceb1.xceb212d) THEN LET l_xceb1.xceb212d = 0 END IF
         IF cl_null(l_xceb1.xceb212e) THEN LET l_xceb1.xceb212e = 0 END IF
         IF cl_null(l_xceb1.xceb212f) THEN LET l_xceb1.xceb212f = 0 END IF
         IF cl_null(l_xceb1.xceb212g) THEN LET l_xceb1.xceb212g = 0 END IF
         IF cl_null(l_xceb1.xceb212h) THEN LET l_xceb1.xceb212h = 0 END IF
         IF cl_null(l_xceb1.xceb212)  THEN LET l_xceb1.xceb212  = 0 END IF
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF 
         IF cl_null(l_xceb1.xceb222a) THEN LET l_xceb1.xceb222a = 0 END IF
         IF cl_null(l_xceb1.xceb222b) THEN LET l_xceb1.xceb222b = 0 END IF
         IF cl_null(l_xceb1.xceb222c) THEN LET l_xceb1.xceb222c = 0 END IF
         IF cl_null(l_xceb1.xceb222d) THEN LET l_xceb1.xceb222d = 0 END IF
         IF cl_null(l_xceb1.xceb222e) THEN LET l_xceb1.xceb222e = 0 END IF
         IF cl_null(l_xceb1.xceb222f) THEN LET l_xceb1.xceb222f = 0 END IF
         IF cl_null(l_xceb1.xceb222g) THEN LET l_xceb1.xceb222g = 0 END IF
         IF cl_null(l_xceb1.xceb222h) THEN LET l_xceb1.xceb222h = 0 END IF
         IF cl_null(l_xceb1.xceb222)  THEN LET l_xceb1.xceb222  = 0 END IF
         
         LET l_xceb.xceb201 =  l_xceb.xceb201  - l_xceb1.xceb201
         LET l_xceb.xceb202 =  l_xceb.xceb202  - l_xceb1.xceb202
         LET l_xceb.xceb202a = l_xceb.xceb202a - l_xceb1.xceb202a
         LET l_xceb.xceb202b = l_xceb.xceb202b - l_xceb1.xceb202b
         LET l_xceb.xceb202c = l_xceb.xceb202c - l_xceb1.xceb202c
         LET l_xceb.xceb202d = l_xceb.xceb202d - l_xceb1.xceb202d
         LET l_xceb.xceb202e = l_xceb.xceb202e - l_xceb1.xceb202e
         LET l_xceb.xceb202f = l_xceb.xceb202f - l_xceb1.xceb202f
         LET l_xceb.xceb202g = l_xceb.xceb202g - l_xceb1.xceb202g
         LET l_xceb.xceb202h = l_xceb.xceb202h - l_xceb1.xceb202h
         LET l_xceb.xceb212 =  l_xceb.xceb212  - l_xceb1.xceb212
         LET l_xceb.xceb212a = l_xceb.xceb212a - l_xceb1.xceb212a
         LET l_xceb.xceb212b = l_xceb.xceb212b - l_xceb1.xceb212b
         LET l_xceb.xceb212c = l_xceb.xceb212c - l_xceb1.xceb212c
         LET l_xceb.xceb212d = l_xceb.xceb212d - l_xceb1.xceb212d
         LET l_xceb.xceb212e = l_xceb.xceb212e - l_xceb1.xceb212e
         LET l_xceb.xceb212f = l_xceb.xceb212f - l_xceb1.xceb212f
         LET l_xceb.xceb212g = l_xceb.xceb212g - l_xceb1.xceb212g
         LET l_xceb.xceb212h = l_xceb.xceb212h - l_xceb1.xceb212h
         LET l_xceb.xceb222 =  l_xceb.xceb222  - l_xceb1.xceb222
         LET l_xceb.xceb222a = l_xceb.xceb222a - l_xceb1.xceb222a
         LET l_xceb.xceb222b = l_xceb.xceb222b - l_xceb1.xceb222b
         LET l_xceb.xceb222c = l_xceb.xceb222c - l_xceb1.xceb222c
         LET l_xceb.xceb222d = l_xceb.xceb222d - l_xceb1.xceb222d
         LET l_xceb.xceb222e = l_xceb.xceb222e - l_xceb1.xceb222e
         LET l_xceb.xceb222f = l_xceb.xceb222f - l_xceb1.xceb222f
         LET l_xceb.xceb222g = l_xceb.xceb222g - l_xceb1.xceb222g
         LET l_xceb.xceb222h = l_xceb.xceb222h - l_xceb1.xceb222h 
         
         LET l_xceb.xcebent = g_enterprise 
         LET l_xceb.xcebcomp = g_xcea_m.xceacomp
         LET l_xceb.xcebld = g_xcea_m.xceald
         LET l_xceb.xcebdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xceb.xceb102) THEN
            CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','8') RETURNING l_success,l_xceb.xceb102
         END IF       
         CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                                l_xceb.xceb101,
                                                                l_xceb.xceb102,
                                                                l_xceb.xceb103,
                                                                l_xceb.xceb110,
                                                                l_xceb.xceb111,
                                                                l_xceb.xceb112,
                                                                l_xceb.xceb113,
                                                                l_xceb.xceb114,
                                                                l_xceb.xceb115,
                                                                l_xceb.xceb116,
                                                                l_xceb.xceb117,
                                                                l_xceb.xceb118,
                                                                l_xceb.xceb119,
                                                                l_xceb.xceb120,
                                                                l_xceb.xceb107,
                                                                l_xceb.xceb108,
                                                                l_xceb.xceb109,
                                                                l_xceb.xceb121,
                                                                l_xceb.xceb122,
                                                                l_xceb.xceb123,
                                                                l_xceb.xceb124,
                                                                l_xceb.xceb125,
                                                                l_xceb.xceb126,
                                                                l_xceb.xceb127,
                                                                l_xceb.xceb128,
                                                                l_xceb.xceb129,
                                                                l_xceb.xceb130             
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
            CONTINUE FOREACH
         END IF              
         INSERT INTO xceb_t VALUES(l_xceb.*)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xceb"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF                       
      END FOREACH    
      CLOSE xcck_prep2_2
      CLOSE xcck_prep3_2  
  END FOREACH  
  
  LET g_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck020 IN ('101','301') ",                   
               "    AND xcck002 = ? AND xcck010 = ? AND xcck011 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 
  
   LET g_sql1 = g_sql CLIPPED," AND xcck001 = '2' " 
 
   LET g_sql2 = g_sql CLIPPED," AND xcck001 = '3' " 

   
   LET g_sql = " SELECT xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck032,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('101','301') ",   
               " GROUP BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032",
               " ORDER BY xcck002,xcck010,xcck011,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032"
   PREPARE xcck_prep_3 FROM g_sql
   DECLARE xcck_curs_3 CURSOR FOR xcck_prep_3
   

   FOREACH xcck_curs_3 INTO   l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h

      INITIALIZE l_xcec.* TO NULL
      
      LET l_xcec.xcec103 = l_xcck.xcck002 #成本域
      LET l_xcec.xcec004 = l_xcck.xcck010 #料號
      LET l_xcec.xcec005 = l_xcck.xcck011 #料號特性
      LET l_xcec.xcec110 = l_xcck.xcck021 #原因碼
      LET l_xcec.xcec111 = l_xcck.xcck022 #交易對象      
      LET l_xcec.xcec112 = l_xcck.xcck023 #客群 
      LET l_xcec.xcec113 = l_xcck.xcck024 #區域  
      LET l_xcec.xcec114 = l_xcck.xcck025 #成本中心      
      LET l_xcec.xcec115 = l_xcck.xcck026 #經營類別
      LET l_xcec.xcec116 = l_xcck.xcck027 #渠道
      LET l_xcec.xcec117 = l_xcck.xcck028 #品類
      LET l_xcec.xcec118 = l_xcck.xcck029 #品牌
      LET l_xcec.xcec119 = l_xcck.xcck030 #項目號
      LET l_xcec.xcec120 = l_xcck.xcck031 #WBS
      LET l_xcec.xcec101 = l_xcck.xcck032 #存貨科目  
      LET l_xcec.xcec201 = l_xcck.xcck201
      LET l_xcec.xcec202 = l_xcck.xcck202
      LET l_xcec.xcec202a = l_xcck.xcck202a
      LET l_xcec.xcec202b = l_xcck.xcck202b
      LET l_xcec.xcec202c = l_xcck.xcck202c
      LET l_xcec.xcec202d = l_xcck.xcck202d
      LET l_xcec.xcec202e = l_xcck.xcck202e
      LET l_xcec.xcec202f = l_xcck.xcck202f
      LET l_xcec.xcec202g = l_xcck.xcck202g
      LET l_xcec.xcec202h = l_xcck.xcck202h
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF  

      IF cl_null(l_xcck.xcck032) THEN  
         CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'')  #存貨科目   #wujie 150214
          RETURNING l_success,l_xcec.xcec101      
      ELSE
         LET l_xcec.xcec101 = l_xcck.xcck032 
      END IF      
    
      IF g_glaa015 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck032) THEN
            LET g_sql1 = g_sql1," AND xcck032 = ? "
#         END IF
         DECLARE xcck_prep2_3 CURSOR FROM g_sql1
         OPEN xcck_prep2_3 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
         FETCH xcck_prep2_3 INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,l_xcec.xcec212d,
                               l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep2_3"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
#         IF NOT cl_null(l_xcck.xcck032) THEN
            LET g_sql2 = g_sql2," AND xcck032 = ? "
#         END IF
         DECLARE xcck_prep3_3 CURSOR FROM g_sql2
         OPEN xcck_prep3_3 USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                               l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                               l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
         FETCH xcck_prep3_3 INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,l_xcec.xcec222d,
                               l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "xcck_prep3_3"
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF         
      
      #雜項進出憑證xcea002 = '7'
      LET g_sql = " SELECT SUM(xcec201),SUM(xcec202), ",
               "        SUM(xcec202a),SUM(xcec202b),SUM(xcec202c),SUM(xcec202d),",
               "        SUM(xcec202e),SUM(xcec202f),SUM(xcec202g),SUM(xcec202h), ",
               "        SUM(xcec212),SUM(xcec212a),SUM(xcec212b),SUM(xcec212c),SUM(xcec212d),",
               "        SUM(xcec212e),SUM(xcec212f),SUM(xcec212g),SUM(xcec212h), ",
               "        SUM(xcec222),SUM(xcec222a),SUM(xcec222b),SUM(xcec222c),SUM(xcec222d),",
               "        SUM(xcec222e),SUM(xcec222f),SUM(xcec222g),SUM(xcec222h) ",               
               "        FROM xcea_t LEFT OUTER JOIN xcec_t ON xceaent = xcecent AND xceald = xcecld ",
               "         AND xceadocno = xcecdocno ",               
               "  WHERE xceaent = '",g_enterprise,"' AND xceald = '",g_xcea_m.xceald,"'",
               "    AND xcea003 = '",g_xcea_m.xcea003,"' AND xcea004 = ",g_xcea_m.xcea004,
               "    AND xcea005 = ",g_xcea_m.xcea005," AND xcea002 = '7' ",
               "    AND xcec103 = ? ",
               "    AND xcec004 = ? ", 
               "    AND xcec005 = ? ",
               "    AND xcec110 = ? ", 
               "    AND xcec111 = ? ",      
               "    AND xcec112 = ? ", 
               "    AND xcec113 = ? ",  
               "    AND xcec114 = ? ",      
               "    AND xcec115 = ? ",
               "    AND xcec116 = ? ",
               "    AND xcec117 = ? ", 
               "    AND xcec118 = ? ",
               "    AND xcec119 = ? ",
               "    AND xcec120 = ? ",
               "    AND xcec101 = ? "
               
      PREPARE xcec_prep FROM g_sql
      DECLARE xcec_curs CURSOR FOR xcec_prep
      
      OPEN xcec_curs USING l_xcck.xcck002,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                            l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                            l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
                            
      FOREACH xcec_curs INTO l_xcec1.xcec201,
                             l_xcec1.xcec202,l_xcec1.xcec202a,l_xcec1.xcec202b,l_xcec1.xcec202c,l_xcec1.xcec202d,
                             l_xcec1.xcec202e,l_xcec1.xcec202f,l_xcec1.xcec202g,l_xcec1.xcec202h,
                             l_xcec1.xcec212,l_xcec1.xcec212a,l_xcec1.xcec212b,l_xcec1.xcec212c,l_xcec1.xcec212d,
                             l_xcec1.xcec212e,l_xcec1.xcec212f,l_xcec1.xcec212g,l_xcec1.xcec212h,
                             l_xcec1.xcec222,l_xcec1.xcec222a,l_xcec1.xcec222b,l_xcec1.xcec222c,l_xcec1.xcec222d,
                             l_xcec1.xcec222e,l_xcec1.xcec222f,l_xcec1.xcec222g,l_xcec1.xcec222h

      INITIALIZE l_xcec.* TO NULL
      
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF                             
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF
      IF cl_null(l_xcec1.xcec201)  THEN LET l_xcec1.xcec201  = 0 END IF
      IF cl_null(l_xcec1.xcec202a) THEN LET l_xcec1.xcec202a = 0 END IF
      IF cl_null(l_xcec1.xcec202b) THEN LET l_xcec1.xcec202b = 0 END IF
      IF cl_null(l_xcec1.xcec202c) THEN LET l_xcec1.xcec202c = 0 END IF
      IF cl_null(l_xcec1.xcec202d) THEN LET l_xcec1.xcec202d = 0 END IF
      IF cl_null(l_xcec1.xcec202e) THEN LET l_xcec1.xcec202e = 0 END IF
      IF cl_null(l_xcec1.xcec202f) THEN LET l_xcec1.xcec202f = 0 END IF
      IF cl_null(l_xcec1.xcec202g) THEN LET l_xcec1.xcec202g = 0 END IF
      IF cl_null(l_xcec1.xcec202h) THEN LET l_xcec1.xcec202h = 0 END IF
      IF cl_null(l_xcec1.xcec202)  THEN LET l_xcec1.xcec202  = 0 END IF  

                           
      IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
      IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
      IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
      IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
      IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
      IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
      IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
      IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
      IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF
      IF cl_null(l_xcec1.xcec212a) THEN LET l_xcec1.xcec212a = 0 END IF
      IF cl_null(l_xcec1.xcec212b) THEN LET l_xcec1.xcec212b = 0 END IF
      IF cl_null(l_xcec1.xcec212c) THEN LET l_xcec1.xcec212c = 0 END IF
      IF cl_null(l_xcec1.xcec212d) THEN LET l_xcec1.xcec212d = 0 END IF
      IF cl_null(l_xcec1.xcec212e) THEN LET l_xcec1.xcec212e = 0 END IF
      IF cl_null(l_xcec1.xcec212f) THEN LET l_xcec1.xcec212f = 0 END IF
      IF cl_null(l_xcec1.xcec212g) THEN LET l_xcec1.xcec212g = 0 END IF
      IF cl_null(l_xcec1.xcec212h) THEN LET l_xcec1.xcec212h = 0 END IF
      IF cl_null(l_xcec1.xcec212)  THEN LET l_xcec1.xcec212  = 0 END IF 
      
                                 
      IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
      IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
      IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
      IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
      IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
      IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
      IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
      IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
      IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF
      IF cl_null(l_xcec1.xcec222a) THEN LET l_xcec1.xcec222a = 0 END IF
      IF cl_null(l_xcec1.xcec222b) THEN LET l_xcec1.xcec222b = 0 END IF
      IF cl_null(l_xcec1.xcec222c) THEN LET l_xcec1.xcec222c = 0 END IF
      IF cl_null(l_xcec1.xcec222d) THEN LET l_xcec1.xcec222d = 0 END IF
      IF cl_null(l_xcec1.xcec222e) THEN LET l_xcec1.xcec222e = 0 END IF
      IF cl_null(l_xcec1.xcec222f) THEN LET l_xcec1.xcec222f = 0 END IF
      IF cl_null(l_xcec1.xcec222g) THEN LET l_xcec1.xcec222g = 0 END IF
      IF cl_null(l_xcec1.xcec222h) THEN LET l_xcec1.xcec222h = 0 END IF
      IF cl_null(l_xcec1.xcec222)  THEN LET l_xcec1.xcec222  = 0 END IF      

         LET l_xcec.xcec201 =  l_xcec.xcec201  - l_xcec1.xcec201
         LET l_xcec.xcec202 =  l_xcec.xcec202  - l_xcec1.xcec202
         LET l_xcec.xcec202a = l_xcec.xcec202a - l_xcec1.xcec202a
         LET l_xcec.xcec202b = l_xcec.xcec202b - l_xcec1.xcec202b
         LET l_xcec.xcec202c = l_xcec.xcec202c - l_xcec1.xcec202c
         LET l_xcec.xcec202d = l_xcec.xcec202d - l_xcec1.xcec202d
         LET l_xcec.xcec202e = l_xcec.xcec202e - l_xcec1.xcec202e
         LET l_xcec.xcec202f = l_xcec.xcec202f - l_xcec1.xcec202f
         LET l_xcec.xcec202g = l_xcec.xcec202g - l_xcec1.xcec202g
         LET l_xcec.xcec202h = l_xcec.xcec202h - l_xcec1.xcec202h
         LET l_xcec.xcec212 =  l_xcec.xcec212  - l_xcec1.xcec212
         LET l_xcec.xcec212a = l_xcec.xcec212a - l_xcec1.xcec212a
         LET l_xcec.xcec212b = l_xcec.xcec212b - l_xcec1.xcec212b
         LET l_xcec.xcec212c = l_xcec.xcec212c - l_xcec1.xcec212c
         LET l_xcec.xcec212d = l_xcec.xcec212d - l_xcec1.xcec212d
         LET l_xcec.xcec212e = l_xcec.xcec212e - l_xcec1.xcec212e
         LET l_xcec.xcec212f = l_xcec.xcec212f - l_xcec1.xcec212f
         LET l_xcec.xcec212g = l_xcec.xcec212g - l_xcec1.xcec212g
         LET l_xcec.xcec212h = l_xcec.xcec212h - l_xcec1.xcec212h
         LET l_xcec.xcec222 =  l_xcec.xcec222  - l_xcec1.xcec222
         LET l_xcec.xcec222a = l_xcec.xcec222a - l_xcec1.xcec222a
         LET l_xcec.xcec222b = l_xcec.xcec222b - l_xcec1.xcec222b
         LET l_xcec.xcec222c = l_xcec.xcec222c - l_xcec1.xcec222c
         LET l_xcec.xcec222d = l_xcec.xcec222d - l_xcec1.xcec222d
         LET l_xcec.xcec222e = l_xcec.xcec222e - l_xcec1.xcec222e
         LET l_xcec.xcec222f = l_xcec.xcec222f - l_xcec1.xcec222f
         LET l_xcec.xcec222g = l_xcec.xcec222g - l_xcec1.xcec222g
         LET l_xcec.xcec222h = l_xcec.xcec222h - l_xcec1.xcec222h 
               
         LET l_xcec.xcecent = g_enterprise 
         LET l_xcec.xceccomp = g_xcea_m.xceacomp
         LET l_xcec.xcecld = g_xcea_m.xceald
         LET l_xcec.xcecdocno = g_xcea_m.xceadocno
         #摘要
         IF cl_null(l_xcec.xcec102) THEN
            CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','8') RETURNING l_success,l_xcec.xcec102
         END IF
               
         CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                                l_xcec.xcec101,
                                                                l_xcec.xcec102,
                                                                l_xcec.xcec103,
                                                                l_xcec.xcec110,
                                                                l_xcec.xcec111,
                                                                l_xcec.xcec112,
                                                                l_xcec.xcec113,
                                                                l_xcec.xcec114,
                                                                l_xcec.xcec115,
                                                                l_xcec.xcec116,
                                                                l_xcec.xcec117,
                                                                l_xcec.xcec118,
                                                                l_xcec.xcec119,
                                                                l_xcec.xcec120,
                                                                l_xcec.xcec107,
                                                                l_xcec.xcec108,
                                                                l_xcec.xcec109,
                                                                l_xcec.xcec121,
                                                                l_xcec.xcec122,
                                                                l_xcec.xcec123,
                                                                l_xcec.xcec124,
                                                                l_xcec.xcec125,
                                                                l_xcec.xcec126,
                                                                l_xcec.xcec127,
                                                                l_xcec.xcec128,
                                                                l_xcec.xcec129,
                                                                l_xcec.xcec130            
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
         IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
            CONTINUE FOREACH
         END IF            
         INSERT INTO xcec_t VALUES(l_xcec.*)
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "ins xcec"
            LET g_errparam.popup = TRUE
            CALL cl_err()
         
            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF   
      END FOREACH   
      CLOSE xcck_prep2_3
      CLOSE xcck_prep3_3  
  END FOREACH
  RETURN g_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_6" order="11" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 抓取xcck_t銷貨資料產生到銷貨成本憑證axct706中   銷貨成本傳票產生維護作業
# Memo...........:
# Usage..........: CALL axct701_01_ins_6()
# Date & Author..: 2014/5/9 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_6()
   DEFINE l_success       LIKE type_t.num5
   DEFINE l_xcea          RECORD LIKE xcea_t.*
   DEFINE l_xceb          RECORD LIKE xceb_t.*
   DEFINE l_xcec          RECORD LIKE xcec_t.*
   DEFINE l_xcck          RECORD LIKE xcck_t.*
   DEFINE ld_date         DATETIME YEAR TO SECOND
   DEFINE l_xcck020       LIKE xcck_t.xcck020
   DEFINE l_sql,l_sql1,l_sql2,l_sql3    STRING
   DEFINE l_str           STRING
   
   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
   RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xceadocno,xcea001,xcea002,xcea003,xcea004, 
                       xcea005,xcea006,xcea007,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,
                       xceacrtdt, xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xceadocno,g_xcea_m.xcea001,g_xcea002,
           g_xcea_m.xcea003,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea006,g_xcea_m.xcea007, 
           'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
           l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "ins xcea_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET l_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck020 IN ('201','202') ",                
               "    AND xcck002 = ? AND xcck006 = ? AND xcck010 = ? AND xcck011 = ? ",
               "    AND xcck009 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 
               
   
   LET g_sql1 = l_sql CLIPPED," AND xcck001 = '2' " 
   
   LET g_sql2 = l_sql CLIPPED," AND xcck001 = '3' " 
   
   LET g_sql = " SELECT xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck033,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('201','202') ",  
               " GROUP BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033",
               " ORDER BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck033"
   PREPARE axct701_01_xcck_pr FROM g_sql
   DECLARE axct701_01_xcck_cs CURSOR FOR axct701_01_xcck_pr

   LET l_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck020 IN ('201','202') ",                
               "    AND xcck002 = ? AND xcck006 = ? AND xcck010 = ? AND xcck011 = ? ",
               "    AND xcck009 = ? AND xcck021 = ? ",
               "    AND xcck022 = ? AND xcck023 = ? AND xcck024 = ? ",
               "    AND xcck025 = ? AND xcck026 = ? AND xcck027 = ? ",
               "    AND xcck028 = ? AND xcck029 = ? AND xcck030 = ? ",
               "    AND xcck031 = ? " 
               
   
   LET g_sql1 = l_sql CLIPPED," AND xcck001 = '2' " 
   
   LET g_sql2 = l_sql CLIPPED," AND xcck001 = '3' " 
   
   LET g_sql = " SELECT xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,",
               "        xcck029,xcck030,xcck031,xcck032,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck001 = '1' ",
               "    AND xcck020 IN ('201','202') ",   
               " GROUP BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032",
               " ORDER BY xcck002,xcck006,xcck010,xcck011,xcck009,xcck021,xcck022,xcck023,xcck024,xcck025,xcck026,xcck027,xcck028,xcck029,xcck030,xcck031,xcck032"
   PREPARE axct701_01_xcck_pr_1 FROM g_sql
   DECLARE axct701_01_xcck_cs_1 CURSOR FOR axct701_01_xcck_pr_1
   
   FOREACH axct701_01_xcck_cs INTO l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                   l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                   l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033,
                                   l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                                   l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF
      
      IF cl_null(l_xcck.xcck201)  THEN LET l_xcck.xcck201=0  END IF
      IF cl_null(l_xcck.xcck202)  THEN LET l_xcck.xcck202=0  END IF
      IF cl_null(l_xcck.xcck202a) THEN LET l_xcck.xcck202a=0 END IF
      IF cl_null(l_xcck.xcck202b) THEN LET l_xcck.xcck202b=0 END IF
      IF cl_null(l_xcck.xcck202c) THEN LET l_xcck.xcck202c=0 END IF
      IF cl_null(l_xcck.xcck202d) THEN LET l_xcck.xcck202d=0 END IF
      IF cl_null(l_xcck.xcck202e) THEN LET l_xcck.xcck202e=0 END IF
      IF cl_null(l_xcck.xcck202f) THEN LET l_xcck.xcck202f=0 END IF
      IF cl_null(l_xcck.xcck202g) THEN LET l_xcck.xcck202g=0 END IF
      IF cl_null(l_xcck.xcck202h) THEN LET l_xcck.xcck202h=0 END IF

      INITIALIZE l_xceb.* TO NULL
      
      CASE l_xcck.xcck009
         WHEN -1          #销货
            LET l_xceb.xceb003 = '7'
         WHEN  1          #销退
            LET l_xceb.xceb003 = '8'        
      END CASE

      SELECT xmdk004 INTO l_xceb.xceb108   #部门
        FROM xmdk_t
       WHERE xmdkent = g_enterprise
         AND xmdkdocno = l_xcck.xcck006
         
      LET l_xceb.xceb103 = l_xcck.xcck002 #成本域
      LET l_xceb.xceb004 = l_xcck.xcck010 #料號
      LET l_xceb.xceb005 = l_xcck.xcck011 #特性
      LET l_xceb.xceb110 = l_xcck.xcck021 #原因碼
      LET l_xceb.xceb111 = l_xcck.xcck022 #交易對象      
      LET l_xceb.xceb112 = l_xcck.xcck023 #客群 
      LET l_xceb.xceb113 = l_xcck.xcck024 #區域  
      LET l_xceb.xceb114 = l_xcck.xcck025 #成本中心      
      LET l_xceb.xceb115 = l_xcck.xcck026 #經營類別
      LET l_xceb.xceb116 = l_xcck.xcck027 #渠道
      LET l_xceb.xceb117 = l_xcck.xcck028 #品類
      LET l_xceb.xceb118 = l_xcck.xcck029 #品牌
      LET l_xceb.xceb119 = l_xcck.xcck030 #項目號
      LET l_xceb.xceb120 = l_xcck.xcck031 #WBS
      LET l_xceb.xceb101 = l_xcck.xcck033 #費用科目 
      
      LET l_xceb.xceb201 = l_xcck.xcck201
      LET l_xceb.xceb202 = l_xcck.xcck202
      LET l_xceb.xceb202a = l_xcck.xcck202a
      LET l_xceb.xceb202b = l_xcck.xcck202b
      LET l_xceb.xceb202c = l_xcck.xcck202c
      LET l_xceb.xceb202d = l_xcck.xcck202d
      LET l_xceb.xceb202e = l_xcck.xcck202e
      LET l_xceb.xceb202f = l_xcck.xcck202f
      LET l_xceb.xceb202g = l_xcck.xcck202g
      LET l_xceb.xceb202h = l_xcck.xcck202h
      
      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201 = 0  END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF     
      
      
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF  
      
      IF cl_null(l_xcck.xcck033) THEN  
         CALL s_get_item_acc(g_xcea_m.xceald,'2',l_xcck.xcck010,'','',g_xcea_m.xceacomp,'')  #銷貨成本科目
          RETURNING l_success,l_xcec.xcec101    
      ELSE
         LET l_xcec.xcec101 = l_xcck.xcck032 
      END IF
      
      #核算項組合sql
      CALL axct701_01_mark_sql(l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,
                               l_xcck.xcck027,l_xcck.xcck028,l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031)
      RETURNING l_str
      #銷貨成本科目
      IF cl_null(l_xceb.xceb101) THEN
         CALL s_get_item_acc(g_xcea_m.xceald,'5',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'')    #wujie 150214
           RETURNING l_success,l_xceb.xceb101 
      END IF
#      IF l_xcck.xcck033 IS NULL THEN
#         LET l_str=l_str," AND xcck033 IS NULL"
#      ELSE
#         LET l_str=l_str," AND xcck033 = '",l_xcck.xcck033,"'"
#      END IF
      IF g_glaa015 = 'Y' THEN  
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql1 = g_sql1," AND xcck033 = ? "
#         END IF
         PREPARE axct701_01_xcck_pr2 FROM g_sql1
         EXECUTE axct701_01_xcck_pr2 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                   l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                   l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
                                      INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,
                                           l_xceb.xceb212d,l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,
                                           l_xceb.xceb212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "axct701_01_xcck_pr2"
            LET g_errparam.popup = FALSE
            CALL cl_err()

            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF

         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212=0  END IF
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a=0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b=0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c=0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d=0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e=0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f=0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g=0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h=0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 = 'Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql2 = g_sql2," AND xcck033 = ? "
#         END IF     
         PREPARE axct701_01_xcck_pr3 FROM g_sql2         
         EXECUTE axct701_01_xcck_pr3 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                   l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                   l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck033
                                      INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,
                                           l_xceb.xceb222d,l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,
                                           l_xceb.xceb222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "axct701_01_xcck_pr3"
            LET g_errparam.popup = FALSE
            CALL cl_err()

            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF

         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222=0  END IF
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a=0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b=0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c=0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d=0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e=0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f=0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g=0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h=0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF
      
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','6') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF      
      INSERT INTO xceb_t VALUES(l_xceb.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
        
   END FOREACH  
  
   FOREACH axct701_01_xcck_cs_1 INTO l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                     l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                     l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032,
                                     l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                                     l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF
      
      IF cl_null(l_xcck.xcck201)  THEN LET l_xcck.xcck201=0  END IF
      IF cl_null(l_xcck.xcck202)  THEN LET l_xcck.xcck202=0  END IF
      IF cl_null(l_xcck.xcck202a) THEN LET l_xcck.xcck202a=0 END IF
      IF cl_null(l_xcck.xcck202b) THEN LET l_xcck.xcck202b=0 END IF
      IF cl_null(l_xcck.xcck202c) THEN LET l_xcck.xcck202c=0 END IF
      IF cl_null(l_xcck.xcck202d) THEN LET l_xcck.xcck202d=0 END IF
      IF cl_null(l_xcck.xcck202e) THEN LET l_xcck.xcck202e=0 END IF
      IF cl_null(l_xcck.xcck202f) THEN LET l_xcck.xcck202f=0 END IF
      IF cl_null(l_xcck.xcck202g) THEN LET l_xcck.xcck202g=0 END IF
      IF cl_null(l_xcck.xcck202h) THEN LET l_xcck.xcck202h=0 END IF

      INITIALIZE l_xcec.* TO NULL
      
      CASE l_xcck.xcck009
         WHEN -1          #销货
            LET l_xcec.xcec003 = '7'
         WHEN  1          #销退
            LET l_xcec.xcec003 = '8'        
      END CASE

      SELECT xmdk004 INTO l_xcec.xcec108   #部门
        FROM xmdk_t
       WHERE xmdkent = g_enterprise
         AND xmdkdocno = l_xcck.xcck006
         
      LET l_xcec.xcec103 = l_xcck.xcck002 #成本域
      LET l_xcec.xcec004 = l_xcck.xcck010 #料號
      LET l_xcec.xcec005 = l_xcck.xcck011 #特性
      LET l_xcec.xcec110 = l_xcck.xcck021 #原因碼
      LET l_xcec.xcec111 = l_xcck.xcck022 #交易對象      
      LET l_xcec.xcec112 = l_xcck.xcck023 #客群 
      LET l_xcec.xcec113 = l_xcck.xcck024 #區域  
      LET l_xcec.xcec114 = l_xcck.xcck025 #成本中心      
      LET l_xcec.xcec115 = l_xcck.xcck026 #經營類別
      LET l_xcec.xcec116 = l_xcck.xcck027 #渠道
      LET l_xcec.xcec117 = l_xcck.xcck028 #品類
      LET l_xcec.xcec118 = l_xcck.xcck029 #品牌
      LET l_xcec.xcec119 = l_xcck.xcck030 #項目號
      LET l_xcec.xcec120 = l_xcck.xcck031 #WBS
      LET l_xcec.xcec101 = l_xcck.xcck032 #存貨科目 

      LET l_xcec.xcec201 = l_xcck.xcck201
      LET l_xcec.xcec202 = l_xcck.xcck202
      LET l_xcec.xcec202a = l_xcck.xcck202a
      LET l_xcec.xcec202b = l_xcck.xcck202b
      LET l_xcec.xcec202c = l_xcck.xcck202c
      LET l_xcec.xcec202d = l_xcck.xcck202d
      LET l_xcec.xcec202e = l_xcck.xcck202e
      LET l_xcec.xcec202f = l_xcck.xcck202f
      LET l_xcec.xcec202g = l_xcck.xcck202g
      LET l_xcec.xcec202h = l_xcck.xcck202h
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF  

      IF cl_null(l_xcck.xcck032) THEN  
         CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xcck.xcck010,'','',g_xcea_m.xceacomp,'')  #存貨科目
          RETURNING l_success,l_xcec.xcec101   
      ELSE
         LET l_xcec.xcec101 = l_xcck.xcck032 
      END IF
      
      #核算項組合sql
      CALL axct701_01_mark_sql(l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,
                               l_xcck.xcck027,l_xcck.xcck028,l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031)
      RETURNING l_str

      IF g_glaa015 = 'Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql1 = g_sql1," AND xcck032 = ? "
#         END IF
         PREPARE axct701_01_xcck_pr2_1 FROM g_sql1
         EXECUTE axct701_01_xcck_pr2_1 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                   l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                   l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
                                        INTO l_xcec.xcec212,l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,
                                             l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,
                                             l_xcec.xcec212h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "axct701_01_xcck_pr2_1"
            LET g_errparam.popup = FALSE
            CALL cl_err()

            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF

         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212=0 END IF
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a=0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212=0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c=0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d=0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e=0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f=0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g=0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h=0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 = 'Y' THEN
#         IF NOT cl_null(l_xcck.xcck033) THEN
            LET g_sql2 = g_sql2," AND xcck032 = ? "
#         END IF
         PREPARE axct701_01_xcck_pr3_1 FROM g_sql2
         EXECUTE axct701_01_xcck_pr3_1 USING l_xcck.xcck002,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,l_xcck.xcck009,l_xcck.xcck021,l_xcck.xcck022,l_xcck.xcck023,
                                   l_xcck.xcck024,l_xcck.xcck025,l_xcck.xcck026,l_xcck.xcck027,l_xcck.xcck028,
                                   l_xcck.xcck029,l_xcck.xcck030,l_xcck.xcck031,l_xcck.xcck032
                                        INTO l_xcec.xcec222,l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,
                                             l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,
                                             l_xcec.xcec222h
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "axct701_01_xcck_pr3_1"
            LET g_errparam.popup = FALSE
            CALL cl_err()

            LET g_success = 'N'
            RETURN g_success
            EXIT FOREACH
         END IF

         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222=0 END IF
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a=0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222=0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c=0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d=0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e=0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f=0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g=0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h=0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF      
      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','6') RETURNING l_success,l_xcec.xcec102
      END IF
      
      CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                             l_xcec.xcec101,
                                                             l_xcec.xcec102,
                                                             l_xcec.xcec103,
                                                             l_xcec.xcec110,
                                                             l_xcec.xcec111,
                                                             l_xcec.xcec112,
                                                             l_xcec.xcec113,
                                                             l_xcec.xcec114,
                                                             l_xcec.xcec115,
                                                             l_xcec.xcec116,
                                                             l_xcec.xcec117,
                                                             l_xcec.xcec118,
                                                             l_xcec.xcec119,
                                                             l_xcec.xcec120,
                                                             l_xcec.xcec107,
                                                             l_xcec.xcec108,
                                                             l_xcec.xcec109,
                                                             l_xcec.xcec121,
                                                             l_xcec.xcec122,
                                                             l_xcec.xcec123,
                                                             l_xcec.xcec124,
                                                             l_xcec.xcec125,
                                                             l_xcec.xcec126,
                                                             l_xcec.xcec127,
                                                             l_xcec.xcec128,
                                                             l_xcec.xcec129,
                                                             l_xcec.xcec130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF      
      INSERT INTO xcec_t VALUES(l_xcec.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
  END FOREACH 
  RETURN g_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_5" order="12" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[# 在制差異憑證資料產生  axct705
PRIVATE FUNCTION axct701_01_ins_5()
   DEFINE l_success       LIKE type_t.num5
   DEFINE l_errno         LIKE gzze_t.gzze001
   DEFINE l_xcea          RECORD LIKE xcea_t.*
   DEFINE l_xceb          RECORD LIKE xceb_t.*
   DEFINE l_xcec          RECORD LIKE xcec_t.*
   DEFINE l_xccd          RECORD LIKE xccd_t.*
   DEFINE l_xcce          RECORD LIKE xcce_t.*
   DEFINE l_sql           STRING
   DEFINE l_rate          LIKE type_t.num26_10
   DEFINE l_rate1         LIKE type_t.num26_10
   DEFINE ld_date         DATETIME YEAR TO SECOND
   DEFINE l_xced          RECORD LIKE xced_t.*
   DEFINE l_sfaa057       LIKE sfaa_t.sfaa057
   DEFINE l_sfaasite      LIKE sfaa_t.sfaasite

   LET g_success = 'Y'
   
   INITIALIZE l_xcea.* TO NULL
   INITIALIZE l_xceb.* TO NULL
   INITIALIZE l_xcec.* TO NULL
   INITIALIZE l_xccd.* TO NULL
   INITIALIZE l_xcce.* TO NULL
   INITIALIZE l_xced.* TO NULL
   
   
   
   #單頭
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   #第一單身：在制主件成本档(xccd_t),拆件在制主件成本档(xcch_t)
   #本位幣一
   LET l_sql = "SELECT xccd002,xccd006,xccd007,xccd008,",
               "       SUM(xccd303), SUM(xccd304), SUM(xccd304a),SUM(xccd304b),SUM(xccd304c),",
               "       SUM(xccd304d),SUM(xccd304e),SUM(xccd304f),SUM(xccd304g),SUM(xccd304h) ",
               "  FROM xccd_t ",
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea_m.xcea004,
               "    AND xccd005 = ",g_xcea_m.xcea005,
               "    AND xccd001 = '1'",
               "    AND (xccd303 <> 0 OR xccd304 <> 0)",
               " GROUP BY xccd002,xccd006,xccd007,xccd008 ",
               " UNION ",
               "SELECT xcch002,xcch006,xcch007,xcch008,",
               "       SUM(xcch303), SUM(xcch304), SUM(xcch304a),SUM(xcch304b),SUM(xcch304c),",
               "       SUM(xcch304d),SUM(xcch304e),SUM(xcch304f),SUM(xcch304g),SUM(xcch304h) ",
               "  FROM xcch_t ",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea_m.xcea004,
               "    AND xcch005 = ",g_xcea_m.xcea005,
               "    AND xcch001 = '1'",
               "    AND (xcch303 <> 0 OR xcch304 <> 0)",
               " GROUP BY xcch002,xcch006,xcch007,xcch008"
   PREPARE xccd_prep1 FROM l_sql
   DECLARE xccd_curs1 CURSOR FOR xccd_prep1
                            
   
   #本位幣二  
   LET l_sql = " SELECT SUM(xccd304), SUM(xccd304a),SUM(xccd304b),SUM(xccd304c),",
               "        SUM(xccd304d),SUM(xccd304e),SUM(xccd304f),SUM(xccd304g),SUM(xccd304h) ",
               "        FROM xccd_t ", 
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea_m.xcea004,
               "    AND xccd005 = ",g_xcea_m.xcea005,
               "    AND xccd002 = ? AND xccd006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND (xccd303 <> 0 OR xccd304 <> 0)",
               "    AND xccd001 = '2' ",
               " UNION ",
               " SELECT SUM(xcch304), SUM(xcch304a),SUM(xcch304b),SUM(xcch304c),",
               "        SUM(xcch304d),SUM(xcch304e),SUM(xcch304f),SUM(xcch304g),SUM(xcch304h) ",
               "  FROM xcch_t ",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea_m.xcea004,
               "    AND xcch005 = ",g_xcea_m.xcea005,
               "    AND xcch002 = ? AND xcch006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND (xcch303 <> 0 OR xcch304 <> 0)",
               "    AND xcch001 = '2'"
   PREPARE xccd_prep2_3 FROM l_sql
   DECLARE xccd_curs2_3 CURSOR FOR xccd_prep2_3
   
   #本位幣三
   LET l_sql = " SELECT SUM(xccd304), SUM(xccd304a),SUM(xccd304b),SUM(xccd304c),",
               "        SUM(xccd304d),SUM(xccd304e),SUM(xccd304f),SUM(xccd304g),SUM(xccd304h) ",
               "        FROM xccd_t ", 
               "  WHERE xccdent = '",g_enterprise,"' AND xccdld = '",g_xcea_m.xceald,"'",
               "    AND xccd003 = '",g_xcea_m.xcea003,"' AND xccd004 = ",g_xcea_m.xcea004,
               "    AND xccd005 = ",g_xcea_m.xcea005,
               "    AND xccd002 = ? AND xccd006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND xccd001 = '3' ",
               " UNION ",
               " SELECT SUM(xcch304), SUM(xcch304a),SUM(xcch304b),SUM(xcch304c),",
               "        SUM(xcch304d),SUM(xcch304e),SUM(xcch304f),SUM(xcch304g),SUM(xcch304h) ",
               "  FROM xcch_t ",
               "  WHERE xcchent = '",g_enterprise,"' AND xcchld = '",g_xcea_m.xceald,"'",
               "    AND xcch003 = '",g_xcea_m.xcea003,"' AND xcch004 = ",g_xcea_m.xcea004,
               "    AND xcch005 = ",g_xcea_m.xcea005,
               "    AND xcch002 = ? AND xcch006 = ? ",
               "    AND xccd007 = ? AND xccd008 = ? ",
               "    AND (xcch303 <> 0 OR xcch304 <> 0)",
               "    AND xcch001 = '3'"
   PREPARE xccd_prep3_3 FROM l_sql
   DECLARE xccd_curs3_3 CURSOR FOR xccd_prep3_3
   
   #第二單身：在制元件成本档(xcce_t),拆件在制元件成本档(xcci_t)
   #本位幣一
   LET l_sql = "SELECT xcce002,xcce006,xcce007,xcce008,xcce009,",
               "       SUM(xcce303), SUM(xcce304), SUM(xcce304a),SUM(xcce304b),SUM(xcce304c),",
               "       SUM(xcce304d),SUM(xcce304e),SUM(xcce304f),SUM(xcce304g),SUM(xcce304h) ",
               "  FROM xcce_t ",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea_m.xcea004,
               "    AND xcce005 = ",g_xcea_m.xcea005,
               "    AND xcce001 = '1'",
               "    AND (xcce303 <> 0 OR xcce304 <> 0)",
               " GROUP BY xcce002,xcce006,xcce007,xcce008,xcce009 ",
               " UNION ",
               "SELECT xcci002,xcci006,xcci007,xcci008,xcci009,",
               "       SUM(xcci303), SUM(xcci304), SUM(xcci304a),SUM(xcci304b),SUM(xcci304c),",
               "       SUM(xcci304d),SUM(xcci304e),SUM(xcci304f),SUM(xcci304g),SUM(xcci304h) ",
               "  FROM xcci_t ",
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea_m.xcea004,
               "    AND xcci005 = ",g_xcea_m.xcea005,
               "    AND xcci001 = '1'",
               "    AND (xcci303 <> 0 OR xcci304 <> 0)",
               " GROUP BY xcci002,xcci006,xcci007,xcci008,xcci009"  
   PREPARE xccd_prep4 FROM l_sql
   DECLARE xccd_curs4 CURSOR FOR xccd_prep4
   
   #本位幣二
   LET l_sql = "SELECT SUM(xcce304), SUM(xcce304a),SUM(xcce304b),SUM(xcce304c),",
               "       SUM(xcce304d),SUM(xcce304e),SUM(xcce304f),SUM(xcce304g),SUM(xcce304h) ",
               "  FROM xcce_t ",
               "  WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "    AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea_m.xcea004,
               "    AND xcce005 = ",g_xcea_m.xcea005,
               "    AND xcce002 = ? AND xcce006 = ? AND xcce007 = ? AND xcce008 = ? ",
               "    AND xcce009 = ?  ",
               "    AND (xcce303 <> 0 OR xcce304 <> 0)",
               "    AND xcce001 = '2'",
               " UNION ",
               "SELECT SUM(xcci304), SUM(xcci304a),SUM(xcci304b),SUM(xcci304c),",
               "       SUM(xcci304d),SUM(xcci304e),SUM(xcci304f),SUM(xcci304g),SUM(xcci304h) ",
               "  FROM xcci_t ",
               "  WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "    AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea_m.xcea004,
               "    AND xcci005 = ",g_xcea_m.xcea005,
               "    AND xcci002 = ? AND xcci006 = ? AND xcci007 = ? ",
               "    AND xcci008 = ?  AND xcci009 = ? ",
               "    AND (xcci303 <> 0 OR xcci304 <> 0)",
               "    AND xcci001 = '2'"
   PREPARE xccd_prep5 FROM l_sql
   DECLARE xccd_curs5 CURSOR FOR xccd_prep5
   
   #本位幣三
   LET l_sql = "SELECT SUM(xcce304), SUM(xcce304a),SUM(xcce304b),SUM(xcce304c),",
               "       SUM(xcce304d),SUM(xcce304e),SUM(xcce304f),SUM(xcce304g),SUM(xcce304h) ",
               "  FROM xcce_t ",
               " WHERE xcceent = '",g_enterprise,"' AND xcceld = '",g_xcea_m.xceald,"'",
               "   AND xcce003 = '",g_xcea_m.xcea003,"' AND xcce004 = ",g_xcea_m.xcea004,
               "   AND xcce005 = ",g_xcea_m.xcea005,
               "   AND xcce002 = ? AND xcce006 = ? AND xcce007 = ? ",
               "   AND xcce008 = ? AND xcce009 = ?  ",
               "    AND (xcce303 <> 0 OR xcce304 <> 0)",
               "   AND xcce001 = '3'",
               " UNION ",
               "SELECT SUM(xcci304), SUM(xcci304a),SUM(xcci304b),SUM(xcci304c),",
               "       SUM(xcci304d),SUM(xcci304e),SUM(xcci304f),SUM(xcci304g),SUM(xcci304h) ",
               "  FROM xcci_t ",
               " WHERE xccient = '",g_enterprise,"' AND xccild = '",g_xcea_m.xceald,"'",
               "   AND xcci003 = '",g_xcea_m.xcea003,"' AND xcci004 = ",g_xcea_m.xcea004,
               "   AND xcci005 = ",g_xcea_m.xcea005,
               "   AND xcci002 = ? AND xcci006 = ? AND xcci007 = ? ",
               "   AND xcci008 = ? AND xcci009 = ?  ",
               "    AND (xcci303 <> 0 OR xcci304 <> 0)",
               "   AND xcci001 = '3'"
   PREPARE xccd_prep6 FROM l_sql
   DECLARE xccd_curs6 CURSOR FOR xccd_prep6
   
#   #第三單身
#   #xcec_t中DL+OH_SUB元件彙總-xced   
#   LET l_sql = " SELECT xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120,",
#               "        SUM(xcec202b),SUM(xcec202c),SUM(xcec202d),SUM(xcec202e),",
#               "        SUM(xcec202f),SUM(xcec202g),SUM(xcec202h), ",
#               "        SUM(xcec212b),SUM(xcec212c),SUM(xcec212d),SUM(xcec212e),",
#               "        SUM(xcec212f),SUM(xcec212g),SUM(xcec212h), ",
#               "        SUM(xcec222b),SUM(xcec222c),SUM(xcec222d),SUM(xcec222e),",
#               "        SUM(xcec222f),SUM(xcec222g),SUM(xcec222h) ",
#               "   FROM xcec_t",
#               "  WHERE xcecent = '",g_enterprise,"' AND xcecld = '",g_xcea_m.xceald,"'",
#               "    AND xcecdocno = '",g_xcea_m.xceadocno,"'", 
#               "    AND xcec004 = 'DL+OH+SUB' ",
#               "  GROUP BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 ",
#               "  ORDER BY xcec102,xcec114,xcec113,xcec111,xcec117,xcec119,xcec120 "
#   PREPARE xcec_prep_3 FROM l_sql
#   DECLARE xcec_curs_3 CURSOR FOR xcec_prep_3
   
   
   #第一單身
   FOREACH xccd_curs1 INTO l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008,
                           l_xccd.xccd303, l_xccd.xccd304, l_xccd.xccd304a,l_xccd.xccd304b,l_xccd.xccd304c,
                           l_xccd.xccd304d,l_xccd.xccd304e,l_xccd.xccd304f,l_xccd.xccd304g,l_xccd.xccd304h

      INITIALIZE l_xceb.* TO NULL
      
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 
      
      #工單類型   廠內/委外
      LET l_sfaa057 = ''
      LET l_sfaasite = ''
      SELECT sfaa003,sfaa057,sfaa009,sfaasite,sfaa028,sfaa029 INTO l_xceb.xceb003,l_sfaa057,l_xceb.xceb111,l_sfaasite,l_xceb.xceb119,l_xceb.xceb120
        FROM sfaa_t WHERE sfaaent = g_enterprise AND sfaadocno = l_xccd.xccd006
      
      #生产成本-差异科目
#目前没有，先空着   #wujie 150214
      LET l_xceb.xceb101 = ''

      IF cl_null(l_xceb.xceb101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','4') RETURNING l_success,l_xceb.xceb101,l_errno
      END IF
      
      IF l_sfaa057 = '2' THEN   #委外
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xceb.xceb112,l_xceb.xceb113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xceb.xceb111
         
         
      ELSE   #廠內
         LET l_xceb.xceb111 = ' '
         #客群
         LET l_xceb.xceb112 = ' '
         #區域
         SELECT ooef153 INTO l_xceb.xceb113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 
      
      #品類
      SELECT imag011 INTO l_xceb.xceb117 
        FROM imag_t 
       WHERE imagent = g_enterprise 
         AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xccd.xccd007
      
      LET l_xceb.xcebent   = g_enterprise
      LET l_xceb.xcebcomp  = g_xcea_m.xceacomp
      LET l_xceb.xcebld    = g_xcea_m.xceald     
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      LET l_xceb.xceb001   = l_xccd.xccd006 
      LET l_xceb.xceb002   = ''
      LET l_xceb.xceb004   = l_xccd.xccd007 
      LET l_xceb.xceb005   = l_xccd.xccd008      
      LET l_xceb.xceb102   = '' 
      LET l_xceb.xceb102   = ''
      LET l_xceb.xceb103   = l_xccd.xccd002
      LET l_xceb.xceb110   = ''
      LET l_xceb.xceb114   = ''
      LET l_xceb.xceb115   = ' '
      LET l_xceb.xceb116   = ' '  
      LET l_xceb.xceb118   = ' '
      LET l_xceb.xceb201   = l_xccd.xccd303
      LET l_xceb.xceb202   = l_xccd.xccd304
      LET l_xceb.xceb202a  = l_xccd.xccd304a
      LET l_xceb.xceb202b  = l_xccd.xccd304b
      LET l_xceb.xceb202c  = l_xccd.xccd304c
      LET l_xceb.xceb202d  = l_xccd.xccd304d
      LET l_xceb.xceb202e  = l_xccd.xccd304e
      LET l_xceb.xceb202f  = l_xccd.xccd304f
      LET l_xceb.xceb202g  = l_xccd.xccd304g
      LET l_xceb.xceb202h  = l_xccd.xccd304h
      LET l_xceb.xceb301   = ''
      LET l_xceb.xceb302   = ''
      
      
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF      
      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201  = 0 END IF        

#小于0的要变成正数
      IF l_xceb.xceb202a < 0 THEN LET l_xceb.xceb202a = l_xceb.xceb202a * -1 END IF
      IF l_xceb.xceb202b < 0 THEN LET l_xceb.xceb202b = l_xceb.xceb202b * -1 END IF
      IF l_xceb.xceb202c < 0 THEN LET l_xceb.xceb202c = l_xceb.xceb202c * -1 END IF
      IF l_xceb.xceb202d < 0 THEN LET l_xceb.xceb202d = l_xceb.xceb202d * -1 END IF
      IF l_xceb.xceb202e < 0 THEN LET l_xceb.xceb202e = l_xceb.xceb202e * -1 END IF
      IF l_xceb.xceb202f < 0 THEN LET l_xceb.xceb202f = l_xceb.xceb202f * -1 END IF
      IF l_xceb.xceb202g < 0 THEN LET l_xceb.xceb202g = l_xceb.xceb202g * -1 END IF
      IF l_xceb.xceb202h < 0 THEN LET l_xceb.xceb202h = l_xceb.xceb202h * -1 END IF
      IF l_xceb.xceb202  < 0 THEN LET l_xceb.xceb202  = l_xceb.xceb202  * -1 END IF      
      IF l_xceb.xceb201  < 0 THEN LET l_xceb.xceb201  = l_xceb.xceb201  * -1 END IF 
      
      IF g_glaa015 = 'Y' THEN 
         OPEN xccd_curs2_3 USING  l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008,
                                  l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008         
         FETCH xccd_curs2_3 INTO l_xceb.xceb212, l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,
                               l_xceb.xceb212d,l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
        #EXECUTE xccd_curs2 USING l_xceb.xceb103,l_xceb.xceb001,l_xceb.xceb103,l_xceb.xceb001 
        #                    INTO l_xceb.xceb212, l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,
        #                         l_xceb.xceb212d,l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a = 0 END IF
         IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b = 0 END IF
         IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c = 0 END IF
         IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d = 0 END IF
         IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e = 0 END IF
         IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f = 0 END IF
         IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g = 0 END IF
         IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h = 0 END IF
         IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212  = 0 END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

#小于0的要变成正数
      IF l_xceb.xceb212a < 0 THEN LET l_xceb.xceb212a = l_xceb.xceb212a * -1 END IF
      IF l_xceb.xceb212b < 0 THEN LET l_xceb.xceb212b = l_xceb.xceb212b * -1 END IF
      IF l_xceb.xceb212c < 0 THEN LET l_xceb.xceb212c = l_xceb.xceb212c * -1 END IF
      IF l_xceb.xceb212d < 0 THEN LET l_xceb.xceb212d = l_xceb.xceb212d * -1 END IF
      IF l_xceb.xceb212e < 0 THEN LET l_xceb.xceb212e = l_xceb.xceb212e * -1 END IF
      IF l_xceb.xceb212f < 0 THEN LET l_xceb.xceb212f = l_xceb.xceb212f * -1 END IF
      IF l_xceb.xceb212g < 0 THEN LET l_xceb.xceb212g = l_xceb.xceb212g * -1 END IF
      IF l_xceb.xceb212h < 0 THEN LET l_xceb.xceb212h = l_xceb.xceb212h * -1 END IF
      IF l_xceb.xceb212  < 0 THEN LET l_xceb.xceb212  = l_xceb.xceb212  * -1 END IF      
      
      IF g_glaa019 = 'Y' THEN 
         OPEN xccd_curs3_3 USING l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008,
                                 l_xccd.xccd002, l_xccd.xccd006, l_xccd.xccd007,l_xccd.xccd008
         FETCH xccd_curs3_3 INTO l_xceb.xceb222, l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,
                               l_xceb.xceb222d,l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #EXECUTE xccd_curs3 USING l_xceb.xceb103,l_xceb.xceb001,l_xceb.xceb103,l_xceb.xceb001 
         #                    INTO l_xceb.xceb222, l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,
         #                         l_xceb.xceb222d,l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         
         IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a = 0 END IF
         IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b = 0 END IF
         IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c = 0 END IF
         IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d = 0 END IF
         IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e = 0 END IF
         IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f = 0 END IF
         IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g = 0 END IF
         IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h = 0 END IF
         IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222  = 0 END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF 

#小于0的要变成正数
      IF l_xceb.xceb222a < 0 THEN LET l_xceb.xceb222a = l_xceb.xceb222a * -1 END IF
      IF l_xceb.xceb222b < 0 THEN LET l_xceb.xceb222b = l_xceb.xceb222b * -1 END IF
      IF l_xceb.xceb222c < 0 THEN LET l_xceb.xceb222c = l_xceb.xceb222c * -1 END IF
      IF l_xceb.xceb222d < 0 THEN LET l_xceb.xceb222d = l_xceb.xceb222d * -1 END IF
      IF l_xceb.xceb222e < 0 THEN LET l_xceb.xceb222e = l_xceb.xceb222e * -1 END IF
      IF l_xceb.xceb222f < 0 THEN LET l_xceb.xceb222f = l_xceb.xceb222f * -1 END IF
      IF l_xceb.xceb222g < 0 THEN LET l_xceb.xceb222g = l_xceb.xceb222g * -1 END IF
      IF l_xceb.xceb222h < 0 THEN LET l_xceb.xceb222h = l_xceb.xceb222h * -1 END IF
      IF l_xceb.xceb222  < 0 THEN LET l_xceb.xceb222  = l_xceb.xceb222  * -1 END IF      
      
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','5') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF
      INSERT INTO xceb_t VALUES(l_xceb.*)
      
      IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = SQLCA.sqlcode
        LET g_errparam.extend = "l_xceb"
        LET g_errparam.popup = TRUE
        CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
                           
   END FOREACH
   
   
   #第二單身
   FOREACH xccd_curs4 INTO l_xcce.xcce002, l_xcce.xcce006, l_xcce.xcce007, l_xcce.xcce008,l_xcce.xcce009, 
                           l_xcce.xcce303, l_xcce.xcce304, l_xcce.xcce304a,l_xcce.xcce304b,l_xcce.xcce304c,
                           l_xcce.xcce304d,l_xcce.xcce304e,l_xcce.xcce304f,l_xcce.xcce304g,l_xcce.xcce304h

      INITIALIZE l_xcec.* TO NULL

      LET l_xcec.xcecent   = g_enterprise
      LET l_xcec.xceccomp  = g_xcea_m.xceacomp
      LET l_xcec.xcecld    = g_xcea_m.xceald     
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      LET l_xcec.xcec001   = l_xcce.xcce006
      LET l_xcec.xcec002   = ''
      LET l_xcec.xcec004   = l_xcce.xcce007 
      LET l_xcec.xcec005   = l_xcce.xcce008       
      LET l_xcec.xcec102   = '' 
      LET l_xcec.xcec102   = ''
      LET l_xcec.xcec103   = l_xcce.xcce002
      LET l_xcec.xcec110   = ''
      LET l_xcec.xcec114   = ''
      LET l_xcec.xcec115   = ' '
      LET l_xcec.xcec116   = ' '  
      LET l_xcec.xcec118   = ' '
      LET l_xcec.xcec201   = l_xcce.xcce303
      LET l_xcec.xcec202   = l_xcce.xcce304
      LET l_xcec.xcec202a  = l_xcce.xcce304a
      LET l_xcec.xcec202b  = l_xcce.xcce304b
      LET l_xcec.xcec202c  = l_xcce.xcce304c
      LET l_xcec.xcec202d  = l_xcce.xcce304d
      LET l_xcec.xcec202e  = l_xcce.xcce304e
      LET l_xcec.xcec202f  = l_xcce.xcce304f
      LET l_xcec.xcec202g  = l_xcce.xcce304g
      LET l_xcec.xcec202h  = l_xcce.xcce304h
      LET l_xcec.xcec301   = ''
      LET l_xcec.xcec302   = ''

      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF   
      
      #工單類型   廠內/委外
      LET l_sfaa057 = ''
      LET l_sfaasite = ''
      SELECT sfaa003,sfaa057,sfaa009,sfaasite,sfaa028,sfaa029 INTO l_xcec.xcec003,l_sfaa057,l_xcec.xcec111,l_sfaasite,l_xcec.xcec119,l_xcec.xcec120
        FROM sfaa_t WHERE sfaaent = g_enterprise AND sfaadocno = l_xcce.xcce006
      
      #在制科目
      CALL s_get_item_acc(g_xcea_m.xceald,'3',l_xcec.xcec004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xcec.xcec101

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','1') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      
      IF l_sfaa057 = '2' THEN   #委外
         #客群/區域
         SELECT pmaa090,pmaa241 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
         
         
      ELSE   #廠內
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 
      
      #品類
      SELECT imag011 INTO l_xcec.xcec117 
        FROM imag_t 
       WHERE imagent = g_enterprise 
         AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xcce.xcce007
            
      
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a = 0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b = 0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c = 0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d = 0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e = 0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f = 0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g = 0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h = 0 END IF
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202  = 0 END IF   
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201  = 0 END IF

#小于0的要变成正数
      IF l_xcec.xcec202a < 0 THEN LET l_xcec.xcec202a = l_xcec.xcec202a * -1 END IF
      IF l_xcec.xcec202b < 0 THEN LET l_xcec.xcec202b = l_xcec.xcec202b * -1 END IF
      IF l_xcec.xcec202c < 0 THEN LET l_xcec.xcec202c = l_xcec.xcec202c * -1 END IF
      IF l_xcec.xcec202d < 0 THEN LET l_xcec.xcec202d = l_xcec.xcec202d * -1 END IF
      IF l_xcec.xcec202e < 0 THEN LET l_xcec.xcec202e = l_xcec.xcec202e * -1 END IF
      IF l_xcec.xcec202f < 0 THEN LET l_xcec.xcec202f = l_xcec.xcec202f * -1 END IF
      IF l_xcec.xcec202g < 0 THEN LET l_xcec.xcec202g = l_xcec.xcec202g * -1 END IF
      IF l_xcec.xcec202h < 0 THEN LET l_xcec.xcec202h = l_xcec.xcec202h * -1 END IF
      IF l_xcec.xcec202  < 0 THEN LET l_xcec.xcec202  = l_xcec.xcec202  * -1 END IF      
      IF l_xcec.xcec201  < 0 THEN LET l_xcec.xcec201  = l_xcec.xcec201  * -1 END IF 
      
      IF g_glaa015 = 'Y' THEN 
         OPEN xccd_curs5 USING  l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009,
                                l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009
         FETCH xccd_curs5 INTO l_xcec.xcec212, l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,
                               l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         #EXECUTE xccd_curs5 USING l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008,
         #                         l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008
         #                    INTO l_xcec.xcec212, l_xcec.xcec212a,l_xcec.xcec212b,l_xcec.xcec212c,
         #                         l_xcec.xcec212d,l_xcec.xcec212e,l_xcec.xcec212f,l_xcec.xcec212g,l_xcec.xcec212h
         IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a = 0 END IF
         IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b = 0 END IF
         IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c = 0 END IF
         IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d = 0 END IF
         IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e = 0 END IF
         IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f = 0 END IF
         IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g = 0 END IF
         IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h = 0 END IF
         IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212  = 0 END IF  
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

#小于0的要变成正数
      IF l_xcec.xcec212a < 0 THEN LET l_xcec.xcec212a = l_xcec.xcec212a * -1 END IF
      IF l_xcec.xcec212b < 0 THEN LET l_xcec.xcec212b = l_xcec.xcec212b * -1 END IF
      IF l_xcec.xcec212c < 0 THEN LET l_xcec.xcec212c = l_xcec.xcec212c * -1 END IF
      IF l_xcec.xcec212d < 0 THEN LET l_xcec.xcec212d = l_xcec.xcec212d * -1 END IF
      IF l_xcec.xcec212e < 0 THEN LET l_xcec.xcec212e = l_xcec.xcec212e * -1 END IF
      IF l_xcec.xcec212f < 0 THEN LET l_xcec.xcec212f = l_xcec.xcec212f * -1 END IF
      IF l_xcec.xcec212g < 0 THEN LET l_xcec.xcec212g = l_xcec.xcec212g * -1 END IF
      IF l_xcec.xcec212h < 0 THEN LET l_xcec.xcec212h = l_xcec.xcec212h * -1 END IF
      IF l_xcec.xcec212  < 0 THEN LET l_xcec.xcec212  = l_xcec.xcec212  * -1 END IF       
      
      IF g_glaa019 = 'Y' THEN 
         OPEN xccd_curs6 USING  l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009,
                                l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcec.xcec005,l_xcce.xcce009
         FETCH xccd_curs6 INTO l_xcec.xcec222, l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,
                               l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         #EXECUTE xccd_curs6 USING l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008,
         #                         l_xcec.xcec103,l_xcec.xcec001,l_xcec.xcec004,l_xcce.xcce008       
         #                    INTO l_xcec.xcec222, l_xcec.xcec222a,l_xcec.xcec222b,l_xcec.xcec222c,
         #                         l_xcec.xcec222d,l_xcec.xcec222e,l_xcec.xcec222f,l_xcec.xcec222g,l_xcec.xcec222h
         
         IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a = 0 END IF
         IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b = 0 END IF
         IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c = 0 END IF
         IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d = 0 END IF
         IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e = 0 END IF
         IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f = 0 END IF
         IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g = 0 END IF
         IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h = 0 END IF
         IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222  = 0 END IF  
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF 

#小于0的要变成正数
      IF l_xcec.xcec222a < 0 THEN LET l_xcec.xcec222a = l_xcec.xcec222a * -1 END IF
      IF l_xcec.xcec222b < 0 THEN LET l_xcec.xcec222b = l_xcec.xcec222b * -1 END IF
      IF l_xcec.xcec222c < 0 THEN LET l_xcec.xcec222c = l_xcec.xcec222c * -1 END IF
      IF l_xcec.xcec222d < 0 THEN LET l_xcec.xcec222d = l_xcec.xcec222d * -1 END IF
      IF l_xcec.xcec222e < 0 THEN LET l_xcec.xcec222e = l_xcec.xcec222e * -1 END IF
      IF l_xcec.xcec222f < 0 THEN LET l_xcec.xcec222f = l_xcec.xcec222f * -1 END IF
      IF l_xcec.xcec222g < 0 THEN LET l_xcec.xcec222g = l_xcec.xcec222g * -1 END IF
      IF l_xcec.xcec222h < 0 THEN LET l_xcec.xcec222h = l_xcec.xcec222h * -1 END IF
      IF l_xcec.xcec222  < 0 THEN LET l_xcec.xcec222  = l_xcec.xcec222  * -1 END IF      
      
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','5') RETURNING l_success,l_xcec.xcec102
      END IF
      CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                             l_xcec.xcec101,
                                                             l_xcec.xcec102,
                                                             l_xcec.xcec103,
                                                             l_xcec.xcec110,
                                                             l_xcec.xcec111,
                                                             l_xcec.xcec112,
                                                             l_xcec.xcec113,
                                                             l_xcec.xcec114,
                                                             l_xcec.xcec115,
                                                             l_xcec.xcec116,
                                                             l_xcec.xcec117,
                                                             l_xcec.xcec118,
                                                             l_xcec.xcec119,
                                                             l_xcec.xcec120,
                                                             l_xcec.xcec107,
                                                             l_xcec.xcec108,
                                                             l_xcec.xcec109,
                                                             l_xcec.xcec121,
                                                             l_xcec.xcec122,
                                                             l_xcec.xcec123,
                                                             l_xcec.xcec124,
                                                             l_xcec.xcec125,
                                                             l_xcec.xcec126,
                                                             l_xcec.xcec127,
                                                             l_xcec.xcec128,
                                                             l_xcec.xcec129,
                                                             l_xcec.xcec130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF
      INSERT INTO xcec_t VALUES(l_xcec.*)
      
      IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = SQLCA.sqlcode
        LET g_errparam.extend = "l_xcec"
        LET g_errparam.popup = TRUE
        CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
                           
   END FOREACH
   
   #第三單身
   CALL axct701_01_ins_xced() RETURNING l_success
   IF NOT l_success THEN LET g_success = 'N' END IF 
   
   RETURN g_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_mark_sql" order="13" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 组合sql
# Memo...........:
# Usage..........: CALL axct701_01_mark_sql(p_xcck022,p_xcck023,p_xcck024,p_xcck025,p_xcck026,p_xcck027,p_xcck028,p_xcck029,p_xcck030,p_xcck031)
#                  RETURNING r_str
# Input parameter: p_xcck021 原因碼
#                : p_xcck022,p_xcck023,p_xcck024,p_xcck025,p_xcck026,p_xcck027,p_xcck028,p_xcck029,p_xcck030,p_xcck031 核算项
# Return code....: r_str          sql语句
# Date & Author..: 2014/06/04 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_mark_sql(p_xcck021,p_xcck022,p_xcck023,p_xcck024,p_xcck025,p_xcck026,p_xcck027,p_xcck028,p_xcck029,p_xcck030,p_xcck031)
   DEFINE p_xcck021      LIKE xcck_t.xcck021
   DEFINE p_xcck022      LIKE xcck_t.xcck022
   DEFINE p_xcck023      LIKE xcck_t.xcck023
   DEFINE p_xcck024      LIKE xcck_t.xcck024
   DEFINE p_xcck025      LIKE xcck_t.xcck025
   DEFINE p_xcck026      LIKE xcck_t.xcck026
   DEFINE p_xcck027      LIKE xcck_t.xcck027
   DEFINE p_xcck028      LIKE xcck_t.xcck028
   DEFINE p_xcck029      LIKE xcck_t.xcck029
   DEFINE p_xcck030      LIKE xcck_t.xcck030
   DEFINE p_xcck031      LIKE xcck_t.xcck031
   DEFINE r_str          STRING
   
   LET r_str=""
   #原因碼
   IF p_xcck021 IS NULL THEN
      LET r_str=r_str," AND xcck021 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck021 = '",p_xcck021,"'"
   END IF
   #交易對象
   IF p_xcck022 IS NULL THEN
      LET r_str=r_str," AND xcck022 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck022 = '",p_xcck022,"'"
   END IF
   #客群
   IF p_xcck023 IS NULL THEN
      LET r_str=r_str," AND xcck023 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck023 = '",p_xcck023,"'"
   END IF
   #區域
   IF p_xcck024 IS NULL THEN
      LET r_str=r_str," AND xcck024 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck024 = '",p_xcck024,"'"
   END IF
   #成本中心
   IF p_xcck025 IS NULL THEN
      LET r_str=r_str," AND xcck025 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck025 = '",p_xcck025,"'"
   END IF
   #經營類別
   IF p_xcck026 IS NULL THEN
      LET r_str=r_str," AND xcck026 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck026 = '",p_xcck026,"'"
   END IF
   #渠道
   IF p_xcck027 IS NULL THEN
      LET r_str=r_str," AND xcck027 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck027 = '",p_xcck027,"'"
   END IF
   #品類
   IF p_xcck028 IS NULL THEN
      LET r_str=r_str," AND xcck028 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck028 = '",p_xcck028,"'"
   END IF
   #品牌
   IF p_xcck029 IS NULL THEN
      LET r_str=r_str," AND xcck029 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck029 = '",p_xcck029,"'"
   END IF
   #項目編號
   IF p_xcck030 IS NULL THEN
      LET r_str=r_str," AND xcck030 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck030 = '",p_xcck030,"'"
   END IF
   #WBS編號
   IF p_xcck031 IS NULL THEN
      LET r_str=r_str," AND xcck031 IS NULL"
   ELSE
      LET r_str=r_str," AND xcck031 = '",p_xcck031,"'"
   END IF
   RETURN r_str
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_check" order="14" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 批次產生檢查
# Memo...........:
# Usage..........: CALL axct701_01_check(p_xcea002)
# Input parameter:  
# Date & Author..: 2014/08/28 By 01531
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_check(p_xcea002)
DEFINE l_cnt     LIKE type_t.num5
DEFINE l_cnt1    LIKE type_t.num5
DEFINE l_xceadocno  LIKE xcea_t.xceadocno
DEFINE r_success    LIKE type_t.num5
DEFINE p_xcea002    LIKE xcea_t.xcea002
DEFINE l_success    LIKE type_t.num5
DEFINE l_glaa121    LIKE glaa_t.glaa121
DEFINE l_xcea001    LIKE xcea_t.xcea001

   LET r_success = TRUE

   #檢查是否存在xcea_t中,根據帳套、成本類型、年度、期別、凭证类型
   #1.狀態已確認--提示，不做處理
   LET l_cnt = 0 
   SELECT COUNT(*) INTO l_cnt FROM xcea_t
    WHERE xceaent = g_enterprise
      AND xceald = g_xcea_m.xceald
      AND xcea003 = g_xcea_m.xcea003
      AND xcea004 = g_xcea_m.xcea004
      AND xcea005 = g_xcea_m.xcea005
      AND xcea002 = p_xcea002
      AND xceastus = 'Y'
    
   #若存在已审核的资料，则提示    
   IF l_cnt > 0 THEN 
      INITIALIZE g_errparam TO NULL
      LET g_errparam.extend = ""
      LET g_errparam.code = "afa-00185"
      LET g_errparam.popup = FALSE
      CALL cl_err()
      LET r_success = FALSE
   END IF   
      
   #2.狀態未確認--刪除xcea\xceb\xcec資料，重新產生   
   LET l_cnt1 = 0 
   SELECT COUNT(*) INTO l_cnt1 FROM xcea_t
    WHERE xceaent = g_enterprise
      AND xceald = g_xcea_m.xceald
      AND xcea003 = g_xcea_m.xcea003
      AND xcea004 = g_xcea_m.xcea004
      AND xcea005 = g_xcea_m.xcea005
      AND xcea002 = p_xcea002
      AND xceastus = 'N'
    
   #若存在已审核的资料，则提示    
   IF l_cnt1 > 0 THEN 
      IF cl_ask_confirm('afa-00186') THEN   #是，删除资料新增
         LET r_success = TRUE
         
         
         #获取单据编号
         DECLARE axct701_01_sel_xcea_cs CURSOR FOR
         SELECT DISTINCT xceadocno,xcea001 FROM xcea_t
          WHERE xceaent = g_enterprise
            AND xceald  = g_xcea_m.xceald
            AND xcea003 = g_xcea_m.xcea003
            AND xcea004 = g_xcea_m.xcea004
            AND xcea005 = g_xcea_m.xcea005
            AND xcea002 = p_xcea002
            AND xceastus = 'N'         
 
         FOREACH axct701_01_sel_xcea_cs INTO l_xceadocno,l_xcea001
            #单头
            DELETE FROM xcea_t    
             WHERE xceaent = g_enterprise
               AND xceald = g_xcea_m.xceald
               AND xceadocno = l_xceadocno 
               
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xcea" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
           
              LET r_success = FALSE
           END IF        
           
           IF NOT s_aooi200_fin_del_docno(g_xcea_m.xceald,l_xceadocno,l_xcea001) THEN LET r_success = FALSE RETURN r_success END IF   #wujie 150214          
           CALL s_ld_sel_glaa(g_xcea_m.xceald,'glaa121') RETURNING  l_success,l_glaa121
           IF l_glaa121 = 'Y' THEN
              CALL s_pre_voucher_del('XC','C10',g_xcea_m.xceald,l_xceadocno) RETURNING r_success
              
              IF NOT r_success THEN
                 RETURN r_success
              END IF
           END IF
           
           #单身一
           DELETE FROM xceb_t    
            WHERE xcebent = g_enterprise
              AND xcebld = g_xcea_m.xceald
              AND xcebdocno = l_xceadocno  
              
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xceb" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
           
              LET r_success = FALSE
           END IF   
           
           #单身二
           DELETE FROM xcec_t    
            WHERE xcecent = g_enterprise
              AND xcecld = g_xcea_m.xceald
              AND xcecdocno = l_xceadocno  
              
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xcec" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
           
              LET r_success = FALSE
           END IF 
           
           #单身三
           DELETE FROM xced_t    
            WHERE xcedent = g_enterprise
              AND xcedld = g_xcea_m.xceald
              AND xceddocno = l_xceadocno  
              
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL 
              LET g_errparam.extend = "del xced" 
              LET g_errparam.code   = SQLCA.sqlcode 
              LET g_errparam.popup  = FALSE 
              CALL cl_err()
           
              LET r_success = FALSE
           END IF 
        END FOREACH
        
      ELSE
        LET r_success = FALSE
      END IF       
   END IF    

   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_9" order="15" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: axct709批次产生   13.制費結轉傳票
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_9()
   DEFINE l_success       LIKE type_t.num5
   DEFINE l_errno         LIKE gzze_t.gzze001
   DEFINE l_xcea          RECORD LIKE xcea_t.*
   DEFINE l_xceb          RECORD LIKE xceb_t.*
   DEFINE l_xcec          RECORD LIKE xcec_t.*
   DEFINE ld_date         DATETIME YEAR TO SECOND
   DEFINE l_sfaa057       LIKE sfaa_t.sfaa057
   DEFINE l_flag          LIKE type_t.num5
   DEFINE l_sfaasite      LIKE sfaa_t.sfaasite
   DEFINE l_sfaa010       LIKE sfaa_t.sfaa010

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date  = cl_get_current()
   LET l_xcea.xceacrtdt = ld_date
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
   RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xceadocno,xcea001,xcea002,xcea003,xcea004, 
                       xcea005,xcea006,xcea007,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,
                       xceacrtdt, xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xceadocno,g_xcea_m.xcea001,g_xcea002,
           g_xcea_m.xcea003,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea006,g_xcea_m.xcea007, 
           'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
           l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "ins xcea_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   

   LET g_sql = " SELECT xcbl001,xcbl010,xcbl019,xcbl020,xcbl016,xcbl017,xcbl018,xcbl021,xcbl022,xcbl013,xcbl014,xcbl015,xcbl012,SUM(xcbl100),SUM(xcbl110),SUM(xcbl120) ",
               "   FROM xcbl_t ",  
               "  WHERE xcblent  = '",g_enterprise,"'",
               "    AND xcblcomp = '",g_xcea_m.xceacomp,"'",
               "    AND xcblld   = '",g_xcea_m.xceald,"'",
#               "    AND xcbl001 <> '1' ",
               "    AND xcbl002  = '",g_xcea_m.xcea004,"'",
               "    AND xcbl003  = '",g_xcea_m.xcea005,"'",
               "  GROUP BY xcbl001,xcbl010,xcbl019,xcbl020,xcbl016,xcbl017,xcbl018,xcbl021,xcbl022,xcbl013,xcbl014,xcbl015,xcbl012 "

   PREPARE axct701_01_xcbl_pr FROM g_sql
   DECLARE axct701_01_xcbl_cs CURSOR FOR axct701_01_xcbl_pr

   LET g_sql = " SELECT xcbk006,xcbk007,SUM(xcbk202),SUM(xcbk212),SUM(xcbk222) ",
               "   FROM xcbk_t ",
               "  WHERE xcbkent  = '",g_enterprise,"'",
               "    AND xcbkcomp = '",g_xcea_m.xceacomp,"'",
               "    AND xcbkld   = '",g_xcea_m.xceald,"'",
               "    AND xcbk001  = '",g_xcea_m.xcea003,"'",
               "    AND xcbk002  = '",g_xcea_m.xcea004,"'",
               "    AND xcbk003  = '",g_xcea_m.xcea005,"'",
#               "    AND xcbk005 <> '1' ",
               "  GROUP BY xcbk006,xcbk007 ",
               "  ORDER BY xcbk006,xcbk007 "
 
   PREPARE axct701_01_xcbk_pr FROM g_sql
   DECLARE axct701_01_xcbk_cs CURSOR FOR axct701_01_xcbk_pr 
   LET l_flag = FALSE                                              
   FOREACH axct701_01_xcbl_cs INTO l_xceb.xceb003,l_xceb.xceb101,l_xceb.xceb117,l_xceb.xceb118,l_xceb.xceb114,l_xceb.xceb115,l_xceb.xceb116,
                                   l_xceb.xceb119,l_xceb.xceb120,l_xceb.xceb111,l_xceb.xceb112,l_xceb.xceb113,l_xceb.xceb108,l_xceb.xceb202,l_xceb.xceb212,l_xceb.xceb222

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF
            
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 

      IF cl_null(l_xceb.xceb201)  THEN LET l_xceb.xceb201 = 0  END IF
      IF cl_null(l_xceb.xceb202a) THEN LET l_xceb.xceb202a = 0 END IF
      IF cl_null(l_xceb.xceb202b) THEN LET l_xceb.xceb202b = 0 END IF
      IF cl_null(l_xceb.xceb202c) THEN LET l_xceb.xceb202c = 0 END IF
      IF cl_null(l_xceb.xceb202d) THEN LET l_xceb.xceb202d = 0 END IF
      IF cl_null(l_xceb.xceb202e) THEN LET l_xceb.xceb202e = 0 END IF
      IF cl_null(l_xceb.xceb202f) THEN LET l_xceb.xceb202f = 0 END IF
      IF cl_null(l_xceb.xceb202g) THEN LET l_xceb.xceb202g = 0 END IF
      IF cl_null(l_xceb.xceb202h) THEN LET l_xceb.xceb202h = 0 END IF
      IF cl_null(l_xceb.xceb202)  THEN LET l_xceb.xceb202  = 0 END IF     
       
      
      IF cl_null(l_xceb.xceb212)  THEN LET l_xceb.xceb212=0  END IF
      IF cl_null(l_xceb.xceb212a) THEN LET l_xceb.xceb212a=0 END IF
      IF cl_null(l_xceb.xceb212b) THEN LET l_xceb.xceb212b=0 END IF
      IF cl_null(l_xceb.xceb212c) THEN LET l_xceb.xceb212c=0 END IF
      IF cl_null(l_xceb.xceb212d) THEN LET l_xceb.xceb212d=0 END IF
      IF cl_null(l_xceb.xceb212e) THEN LET l_xceb.xceb212e=0 END IF
      IF cl_null(l_xceb.xceb212f) THEN LET l_xceb.xceb212f=0 END IF
      IF cl_null(l_xceb.xceb212g) THEN LET l_xceb.xceb212g=0 END IF
      IF cl_null(l_xceb.xceb212h) THEN LET l_xceb.xceb212h=0 END IF
      

      IF cl_null(l_xceb.xceb222)  THEN LET l_xceb.xceb222=0  END IF
      IF cl_null(l_xceb.xceb222a) THEN LET l_xceb.xceb222a=0 END IF
      IF cl_null(l_xceb.xceb222b) THEN LET l_xceb.xceb222b=0 END IF
      IF cl_null(l_xceb.xceb222c) THEN LET l_xceb.xceb222c=0 END IF
      IF cl_null(l_xceb.xceb222d) THEN LET l_xceb.xceb222d=0 END IF
      IF cl_null(l_xceb.xceb222e) THEN LET l_xceb.xceb222e=0 END IF
      IF cl_null(l_xceb.xceb222f) THEN LET l_xceb.xceb222f=0 END IF
      IF cl_null(l_xceb.xceb222g) THEN LET l_xceb.xceb222g=0 END IF
      IF cl_null(l_xceb.xceb222h) THEN LET l_xceb.xceb222h=0 END IF
      
      LET l_xceb.xcebent = g_enterprise 
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xcebld = g_xcea_m.xceald
      LET l_xceb.xcebdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','9') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF      
      INSERT INTO xceb_t VALUES(l_xceb.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xceb_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF   
      LET l_flag = TRUE
   END FOREACH  

   IF NOT l_flag THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'axc-00400'
      LET g_errparam.extend = ""
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success   
   END IF
   LET l_flag = FALSE
   FOREACH axct701_01_xcbk_cs INTO l_xcec.xcec001,l_xcec.xcec003,l_xcec.xcec202,l_xcec.xcec212,l_xcec.xcec222
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ''
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
      END IF
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 
      
      LET l_xcec.xcec101 = NULL
      LET l_xcec.xcec102 = NULL
      LET l_xcec.xcec110 = NULL
      LET l_xcec.xcec111 = NULL
      LET l_xcec.xcec112 = NULL
      LET l_xcec.xcec113 = NULL
      LET l_xcec.xcec114 = NULL
      LET l_xcec.xcec115 = ' '
      LET l_xcec.xcec116 = ' '
      LET l_xcec.xcec117 = NULL
      LET l_xcec.xcec118 = ' '
      LET l_xcec.xcec119 = NULL
      LET l_xcec.xcec120 = NULL
      
      IF cl_null(l_xcec.xcec201)  THEN LET l_xcec.xcec201=0 END IF
      
      IF cl_null(l_xcec.xcec202)  THEN LET l_xcec.xcec202=0 END IF
      IF cl_null(l_xcec.xcec202a) THEN LET l_xcec.xcec202a=0 END IF
      IF cl_null(l_xcec.xcec202b) THEN LET l_xcec.xcec202b=0 END IF
      IF cl_null(l_xcec.xcec202c) THEN LET l_xcec.xcec202c=0 END IF
      IF cl_null(l_xcec.xcec202d) THEN LET l_xcec.xcec202d=0 END IF
      IF cl_null(l_xcec.xcec202e) THEN LET l_xcec.xcec202e=0 END IF
      IF cl_null(l_xcec.xcec202f) THEN LET l_xcec.xcec202f=0 END IF
      IF cl_null(l_xcec.xcec202g) THEN LET l_xcec.xcec202g=0 END IF
      IF cl_null(l_xcec.xcec202h) THEN LET l_xcec.xcec202h=0 END IF


      IF cl_null(l_xcec.xcec212)  THEN LET l_xcec.xcec212=0 END IF
      IF cl_null(l_xcec.xcec212a) THEN LET l_xcec.xcec212a=0 END IF
      IF cl_null(l_xcec.xcec212b) THEN LET l_xcec.xcec212b=0 END IF
      IF cl_null(l_xcec.xcec212c) THEN LET l_xcec.xcec212c=0 END IF
      IF cl_null(l_xcec.xcec212d) THEN LET l_xcec.xcec212d=0 END IF
      IF cl_null(l_xcec.xcec212e) THEN LET l_xcec.xcec212e=0 END IF
      IF cl_null(l_xcec.xcec212f) THEN LET l_xcec.xcec212f=0 END IF
      IF cl_null(l_xcec.xcec212g) THEN LET l_xcec.xcec212g=0 END IF
      IF cl_null(l_xcec.xcec212h) THEN LET l_xcec.xcec212h=0 END IF


      IF cl_null(l_xcec.xcec222)  THEN LET l_xcec.xcec222=0 END IF
      IF cl_null(l_xcec.xcec222a) THEN LET l_xcec.xcec222a=0 END IF
      IF cl_null(l_xcec.xcec222b) THEN LET l_xcec.xcec222b=0 END IF
      IF cl_null(l_xcec.xcec222c) THEN LET l_xcec.xcec222c=0 END IF
      IF cl_null(l_xcec.xcec222d) THEN LET l_xcec.xcec222d=0 END IF
      IF cl_null(l_xcec.xcec222e) THEN LET l_xcec.xcec222e=0 END IF
      IF cl_null(l_xcec.xcec222f) THEN LET l_xcec.xcec222f=0 END IF
      IF cl_null(l_xcec.xcec222g) THEN LET l_xcec.xcec222g=0 END IF
      IF cl_null(l_xcec.xcec222h) THEN LET l_xcec.xcec222h=0 END IF
            
#廠內/委外      #項目編號/WBS
      LET l_sfaa057 = ''
      LET l_sfaasite =''
      LET l_sfaa010  = ''
      SELECT sfaa010,sfaa068,sfaa028,sfaa029,sfaa057,sfaasite,sfaa009,sfaa029 INTO l_sfaa010,l_xcec.xcec114,l_xcec.xcec119,l_xcec.xcec120,l_sfaa057,l_sfaasite,l_xcec.xcec111,l_xcec.xcec120
        FROM sfaa_t WHERE sfaaent = g_enterprise AND sfaadocno = l_xcec.xcec001

#成本科目
      CALL s_get_item_acc(g_xcea_m.xceald,'11',l_sfaa010,'','',g_xcea_m.xceacomp,'') 
           RETURNING l_success,l_xcec.xcec101

#agli161抓不到，改抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','3') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      
      IF l_sfaa057 = '2' THEN   #委外
         #客群/區域
         SELECT pmaa002,pmaa005 INTO l_xcec.xcec112,l_xcec.xcec113 
           FROM pmaa_t 
          WHERE pmaaent = g_enterprise 
            AND pmaa001 = l_xcec.xcec111
         
         
      ELSE   #廠內
         LET l_xcec.xcec111 = ' '
         #客群
         LET l_xcec.xcec112 = ' '
         #區域
         SELECT ooef153 INTO l_xcec.xcec113 FROM ooef_t
          WHERE ooefent = g_enterprise
            AND ooef001 = l_sfaasite
      END IF 
      
      #品類
      SELECT imag011 INTO l_xcec.xcec117 
        FROM imag_t 
       WHERE imagent = g_enterprise 
         AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xcce.xcce007
            

      
      LET l_xcec.xcecent = g_enterprise 
      LET l_xcec.xceccomp = g_xcea_m.xceacomp
      LET l_xcec.xcecld = g_xcea_m.xceald
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','9') RETURNING l_success,l_xcec.xcec102
      END IF
      CALL axct701_01_default_space_xcec(l_xcec.*) RETURNING l_xcec.xcec005,
                                                             l_xcec.xcec101,
                                                             l_xcec.xcec102,
                                                             l_xcec.xcec103,
                                                             l_xcec.xcec110,
                                                             l_xcec.xcec111,
                                                             l_xcec.xcec112,
                                                             l_xcec.xcec113,
                                                             l_xcec.xcec114,
                                                             l_xcec.xcec115,
                                                             l_xcec.xcec116,
                                                             l_xcec.xcec117,
                                                             l_xcec.xcec118,
                                                             l_xcec.xcec119,
                                                             l_xcec.xcec120,
                                                             l_xcec.xcec107,
                                                             l_xcec.xcec108,
                                                             l_xcec.xcec109,
                                                             l_xcec.xcec121,
                                                             l_xcec.xcec122,
                                                             l_xcec.xcec123,
                                                             l_xcec.xcec124,
                                                             l_xcec.xcec125,
                                                             l_xcec.xcec126,
                                                             l_xcec.xcec127,
                                                             l_xcec.xcec128,
                                                             l_xcec.xcec129,
                                                             l_xcec.xcec130      
      
      INSERT INTO xcec_t VALUES(l_xcec.*)
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "ins xcec_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()
  
         LET g_success = 'N'
         RETURN g_success
         EXIT FOREACH
      END IF   
      LET l_flag = TRUE
   END FOREACH 
   IF NOT l_flag THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'axc-00573'
      LET g_errparam.extend = ""
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success   
   END IF
   RETURN g_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_3" order="16" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 描述说明    11.庫存調整憑證  axct703
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_3()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
DEFINE l_xcea          RECORD LIKE xcea_t.*
DEFINE l_xceb          RECORD LIKE xceb_t.*
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xcco          RECORD LIKE xcco_t.*
DEFINE l_sql           STRING
DEFINE l_sql1          STRING
DEFINE l_rate          LIKE type_t.num26_10
DEFINE l_rate1         LIKE type_t.num26_10
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET l_sql = " SELECT SUM(xcco102), ",
               "        SUM(xcco102a),SUM(xcco102b),SUM(xcco102c),SUM(xcco102d),",
               "        SUM(xcco102e),SUM(xcco102f),SUM(xcco102g),SUM(xcco102h) ",
               "        FROM xcco_t ", 
               "  WHERE xccoent = '",g_enterprise,"' AND xccold = '",g_xcea_m.xceald,"'",
               "    AND xcco003 = '",g_xcea_m.xcea003,"' AND xcco004 = ",g_xcea_m.xcea004,
               "    AND xcco005 = ",g_xcea_m.xcea005,
               "    AND xcco002 = ? AND xcco009 = ? AND xcco006 = ? ",
               "    AND xcco007 = ? AND xcco008 = ? AND xcco010 = ?  ",
               "    AND xcco010 = '1'"
    
   LET g_sql = l_sql CLIPPED," AND xcco001 = '2' " 

   DECLARE xcae_prep2 CURSOR FROM g_sql
   
   LET g_sql = l_sql CLIPPED," AND xcco001 = '3' " 

   DECLARE xcae_prep3 CURSOR FROM g_sql
   
   LET l_sql = " SELECT xcco002,xcco009,xcco006,xcco007,xcco008,xcco010,SUM(xcco102), ",
               "        SUM(xcco102a),SUM(xcco102b),SUM(xcco102c),SUM(xcco102d),",
               "        SUM(xcco102e),SUM(xcco102f),SUM(xcco102g),SUM(xcco102h) ",
               "        FROM xcco_t ", 
               "  WHERE xccoent = '",g_enterprise,"' AND xccold = '",g_xcea_m.xceald,"'",
               "    AND xcco003 = '",g_xcea_m.xcea003,"' AND xcco004 = ",g_xcea_m.xcea004,
               "    AND xcco005 = ",g_xcea_m.xcea005,
               "    AND xcco010 = '1'"
   LET l_sql1 = l_sql CLIPPED," AND xcco001 = '1' ",
                " GROUP BY xcco002,xcco009,xcco006,xcco007,xcco008,xcco010",
                " ORDER BY xcco002,xcco009,xcco006,xcco007,xcco008,xcco010"
   PREPARE xcae_prep FROM l_sql1
   DECLARE xcae_curs CURSOR FOR xcae_prep
   

   FOREACH xcae_curs INTO  l_xcco.xcco002,l_xcco.xcco009,l_xcco.xcco006,l_xcco.xcco007,l_xcco.xcco008,l_xcco.xcco010,
                           l_xcco.xcco102,l_xcco.xcco102a,l_xcco.xcco102b,l_xcco.xcco102c,l_xcco.xcco102d,
                           l_xcco.xcco102e,l_xcco.xcco102f,l_xcco.xcco102g,l_xcco.xcco102h
      
      IF g_glaa015 ='Y' THEN      
         OPEN xcae_prep2 USING  l_xcco.xcco002,l_xcco.xcco009,l_xcco.xcco006,l_xcco.xcco007,l_xcco.xcco008,l_xcco.xcco010
         FETCH xcae_prep2 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep2
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF

         
#      IF g_glaa015 = 'Y' THEN
#         CALL s_aooi160_get_exrate('2',g_xcea_m.xceald,g_xcea_m.xcea001,g_glaa001,
#                                        #目的幣別;  交易金額;              匯類類型
#                                         g_glaa016,0,g_glaa018)
#                  RETURNING l_rate
#      END IF
#      
#      IF g_glaa019 = 'Y' THEN
#         CALL s_aooi160_get_exrate('2',g_xcea_m.xceald,g_xcea_m.xcea001,g_glaa001,
#                                        #目的幣別;  交易金額;              匯類類型
#                                         g_glaa016,0,g_glaa022)
#          RETURNING l_rate1
#      END IF
      
      IF g_glaa019 ='Y' THEN
         OPEN xcae_prep3 USING  l_xcco.xcco002,l_xcco.xcco009,l_xcco.xcco006,l_xcco.xcco007,l_xcco.xcco008,l_xcco.xcco010
         FETCH xcae_prep3 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep3
            CALL s_transaction_end('N','0')
            RETURN
         END IF 
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 
  
      LET l_xceb.xcebent = g_enterprise
      LET l_xceb.xcebld  = g_xcea_m.xceald
      LET l_xceb.xcebdocno=g_xcea_m.xceadocno
      LET l_xceb.xcebcomp=g_xcea_m.xceacomp
      LET l_xceb.xceb001 = l_xcco.xcco009
      LET l_xceb.xceb003 = l_xcco.xcco010
      LET l_xceb.xceb004 = l_xcco.xcco006
      LET l_xceb.xceb005 = l_xcco.xcco007
      LET l_xceb.xceb102 = ''
      LET l_xceb.xceb103 = l_xcco.xcco002
      LET l_xceb.xceb119 = ''
      LET l_xceb.xceb201 = 0
      LET l_xceb.xceb202 = l_xcco.xcco102
      LET l_xceb.xceb202a = l_xcco.xcco102a
      LET l_xceb.xceb202b = l_xcco.xcco102b
      LET l_xceb.xceb202c = l_xcco.xcco102c
      LET l_xceb.xceb202d = l_xcco.xcco102d
      LET l_xceb.xceb202e = l_xcco.xcco102e
      LET l_xceb.xceb202f = l_xcco.xcco102f
      LET l_xceb.xceb202g = l_xcco.xcco102g
      LET l_xceb.xceb202h = l_xcco.xcco102h
     
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xceb.xceb004       
 

      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
       RETURNING l_success,l_xceb.xceb101 
        
      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' ' 
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','3') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF
     INSERT INTO xceb_t VALUES(l_xceb.*)
     
     IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
      
      INITIALIZE l_xcec.* TO NULL
           
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 
      
      LET l_xcec.xcecent = g_enterprise
      LET l_xcec.xcecld  = g_xcea_m.xceald
      LET l_xcec.xcecdocno=g_xcea_m.xceadocno
      LET l_xcec.xceccomp=g_xcea_m.xceacomp
      LET l_xcec.xcec001 = l_xcco.xcco009
      LET l_xcec.xcec003 = l_xcco.xcco010
      LET l_xcec.xcec004 = l_xcco.xcco006
      LET l_xcec.xcec005 = l_xcco.xcco007
      LET l_xcec.xcec101 = ''
#抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','5') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      LET l_xcec.xcec102 = ''
      LET l_xcec.xcec103 = l_xcco.xcco002
      LET l_xcec.xcec117 = l_xceb.xceb117
      LET l_xcec.xcec119 = ''
      LET l_xcec.xcec201 = 0
      LET l_xcec.xcec202 = l_xcco.xcco102
      LET l_xcec.xcec202a = l_xcco.xcco102a
      LET l_xcec.xcec202b = l_xcco.xcco102b
      LET l_xcec.xcec202c = l_xcco.xcco102c
      LET l_xcec.xcec202d = l_xcco.xcco102d
      LET l_xcec.xcec202e = l_xcco.xcco102e
      LET l_xcec.xcec202f = l_xcco.xcco102f
      LET l_xcec.xcec202g = l_xcco.xcco102g
      LET l_xcec.xcec202h = l_xcco.xcco102h
      LET l_xcec.xcec212  = l_xceb.xceb212
      LET l_xcec.xcec212a  = l_xceb.xceb212a
      LET l_xcec.xcec212b  = l_xceb.xceb212b
      LET l_xcec.xcec212c  = l_xceb.xceb212c
      LET l_xcec.xcec212d  = l_xceb.xceb212d
      LET l_xcec.xcec212e  = l_xceb.xceb212e
      LET l_xcec.xcec212f  = l_xceb.xceb212f
      LET l_xcec.xcec212g  = l_xceb.xceb212g
      LET l_xcec.xcec212h  = l_xceb.xceb212h
      LET l_xcec.xcec222   = l_xceb.xceb222
      LET l_xcec.xcec222a  = l_xceb.xceb222a
      LET l_xcec.xcec222b  = l_xceb.xceb222b
      LET l_xcec.xcec222c  = l_xceb.xceb222c
      LET l_xcec.xcec222d  = l_xceb.xceb222d
      LET l_xcec.xcec222e  = l_xceb.xceb222e
      LET l_xcec.xcec222f  = l_xceb.xceb222f
      LET l_xcec.xcec222g  = l_xceb.xceb222g
      LET l_xcec.xcec222h  = l_xceb.xceb222h
      LET l_xcec.xcec107  = l_xceb.xceb107
      LET l_xcec.xcec108  = l_xceb.xceb108
      LET l_xcec.xcec109  = l_xceb.xceb109
      LET l_xcec.xcec121  = l_xceb.xceb121
      LET l_xcec.xcec122  = l_xceb.xceb122
      LET l_xcec.xcec123  = l_xceb.xceb123
      LET l_xcec.xcec124  = l_xceb.xceb124
      LET l_xcec.xcec125  = l_xceb.xceb125
      LET l_xcec.xcec126  = l_xceb.xceb126
      LET l_xcec.xcec127  = l_xceb.xceb127
      LET l_xcec.xcec128  = l_xceb.xceb128
      LET l_xcec.xcec129  = l_xceb.xceb129
      LET l_xcec.xcec130  = l_xceb.xceb130   
 
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','3') RETURNING l_success,l_xcec.xcec102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF       
      INSERT INTO xcec_t VALUES(l_xcec.*)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
         LET g_success = 'N'
         EXIT FOREACH
      END IF
      
      
      CLOSE xcae_prep2
      CLOSE xcae_prep3
   END FOREACH   
   RETURN g_success  
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_4" order="17" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 描述说明  10.盤因虧憑證  axct704
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_4()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
DEFINE l_xcea          RECORD LIKE xcea_t.*
DEFINE l_xceb          RECORD LIKE xceb_t.*
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xcck          RECORD LIKE xcck_t.*
DEFINE l_sql           STRING
DEFINE l_sql1          STRING
DEFINE l_rate          LIKE type_t.num26_10
DEFINE l_rate1         LIKE type_t.num26_10
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET l_sql = " SELECT SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck005 = ",g_xcea_m.xcea005,
               "    AND xcck055 = '311' ",
               "    AND xcck002 = ? AND xcck008 = ? AND xcck006 = ? ",
               "    AND xcck010 = ? AND xcck011 = ? AND xcck012 = ? AND xcck007 = ?"
  
   LET g_sql1 = l_sql CLIPPED," AND xcck001 = '2' " 

   DECLARE xcae_prep5 CURSOR FROM g_sql1
   
   LET g_sql2 = l_sql CLIPPED," AND xcck001 = '3' " 

   DECLARE xcae_prep6 CURSOR FROM g_sql2
   
   LET l_sql = " SELECT xcck002,xcck008,xcck006,xcck010,xcck011,xcck012,xcck007,SUM(xcck009*xcck201),SUM(xcck009*xcck202), ",
               "        SUM(xcck009*xcck202a),SUM(xcck009*xcck202b),SUM(xcck009*xcck202c),SUM(xcck009*xcck202d),",
               "        SUM(xcck009*xcck202e),SUM(xcck009*xcck202f),SUM(xcck009*xcck202g),SUM(xcck009*xcck202h) ",
               "        FROM xcck_t ", 
               "  WHERE xcckent = '",g_enterprise,"' AND xcckld = '",g_xcea_m.xceald,"'",
               "    AND xcck003 = '",g_xcea_m.xcea003,"' AND xcck004 = ",g_xcea_m.xcea004,
               "    AND xcck055 = '311' ",
               "    AND xcck005 = ",g_xcea_m.xcea005
   LET l_sql1 = l_sql CLIPPED," AND xcck001 = '1' ",
                " GROUP BY xcck002,xcck008,xcck006,xcck010,xcck011,xcck012,xcck007",
                " ORDER BY xcck002,xcck008,xcck006,xcck010,xcck011,xcck012,xcck007"
   PREPARE xcae_prep4 FROM l_sql1
   DECLARE xcae_curs4 CURSOR FOR xcae_prep4
   

   FOREACH xcae_curs4 INTO  l_xcck.xcck002,l_xcck.xcck008,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,
                            l_xcck.xcck012,l_xcck.xcck007,
                            l_xcck.xcck201,l_xcck.xcck202,l_xcck.xcck202a,l_xcck.xcck202b,l_xcck.xcck202c,
                            l_xcck.xcck202d,l_xcck.xcck202e,l_xcck.xcck202f,l_xcck.xcck202g,l_xcck.xcck202h    
      
     #SELECT glcc002 INTO l_xceb.xceb101 FROM glcc_t 
     # WHERE glccent = g_enterprise AND glccld = g_xcea_m.xceald AND glcc001 = '1'
      IF g_glaa015 ='Y' THEN
         OPEN xcae_prep5 USING  l_xcck.xcck002,l_xcck.xcck008,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,
                                l_xcck.xcck012,l_xcck.xcck007
         FETCH xcae_prep5 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep5
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
         OPEN xcae_prep6 USING  l_xcck.xcck002,l_xcck.xcck008,l_xcck.xcck006,l_xcck.xcck010,l_xcck.xcck011,
                                l_xcck.xcck012,l_xcck.xcck007
         FETCH xcae_prep6 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep6
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF

      LET l_xceb.xcebent = g_enterprise
      LET l_xceb.xcebld  = g_xcea_m.xceald
      LET l_xceb.xcebdocno=g_xcea_m.xceadocno
      LET l_xceb.xcebcomp=g_xcea_m.xceacomp
      LET l_xceb.xceb001 = l_xcck.xcck006
      LET l_xceb.xceb002 = l_xcck.xcck007
      LET l_xceb.xceb003 = l_xcck.xcck012
      LET l_xceb.xceb004 = l_xcck.xcck010
      LET l_xceb.xceb005 = l_xcck.xcck011
      LET l_xceb.xceb102 = ''
      LET l_xceb.xceb103 = l_xcck.xcck002
      LET l_xceb.xceb119 = l_xcck.xcck030
      LET l_xceb.xceb201 = l_xcck.xcck201
      LET l_xceb.xceb202 = l_xcck.xcck202
      LET l_xceb.xceb202a = l_xcck.xcck202a
      LET l_xceb.xceb202b = l_xcck.xcck202b
      LET l_xceb.xceb202c = l_xcck.xcck202c
      LET l_xceb.xceb202d = l_xcck.xcck202d
      LET l_xceb.xceb202e = l_xcck.xcck202e
      LET l_xceb.xceb202f = l_xcck.xcck202f
      LET l_xceb.xceb202g = l_xcck.xcck202g
      LET l_xceb.xceb202h = l_xcck.xcck202h
       
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xceb.xceb004 

      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF      
      
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
       RETURNING l_success,l_xceb.xceb101
 

      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' '
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','4') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130


     INSERT INTO xceb_t VALUES(l_xceb.*)
     
     IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
      
   
      INITIALIZE l_xcec.* TO NULL 

      LET l_xcec.xcecent = g_enterprise
      LET l_xcec.xcecld  = g_xcea_m.xceald
      LET l_xcec.xceccomp  = g_xcea_m.xceacomp
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      LET l_xcec.xcec001 = l_xcck.xcck006
      LET l_xcec.xcec002 = l_xcck.xcck007
      LET l_xcec.xcec003 = l_xcck.xcck012
      LET l_xcec.xcec004 = l_xcck.xcck010
      LET l_xcec.xcec005 = l_xcck.xcck011
      LET l_xcec.xcec101 = ''
#抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','6') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      LET l_xcec.xcec102 = ''
      LET l_xcec.xcec103 = l_xcck.xcck002
      LET l_xcec.xcec117 = l_xceb.xceb117
      LET l_xcec.xcec119 = l_xcck.xcck030
      LET l_xcec.xcec201 = l_xcck.xcck201
      LET l_xcec.xcec202 = l_xcck.xcck202
      LET l_xcec.xcec202a = l_xcck.xcck202a
      LET l_xcec.xcec202b = l_xcck.xcck202b
      LET l_xcec.xcec202c = l_xcck.xcck202c
      LET l_xcec.xcec202d = l_xcck.xcck202d
      LET l_xcec.xcec202e = l_xcck.xcck202e
      LET l_xcec.xcec202f = l_xcck.xcck202f
      LET l_xcec.xcec202g = l_xcck.xcck202g
      LET l_xcec.xcec202h = l_xcck.xcck202h
      LET l_xcec.xcec212  = l_xceb.xceb212
      LET l_xcec.xcec212a  = l_xceb.xceb212a
      LET l_xcec.xcec212b  = l_xceb.xceb212b
      LET l_xcec.xcec212c  = l_xceb.xceb212c
      LET l_xcec.xcec212d  = l_xceb.xceb212d
      LET l_xcec.xcec212e  = l_xceb.xceb212e
      LET l_xcec.xcec212f  = l_xceb.xceb212f
      LET l_xcec.xcec212g  = l_xceb.xceb212g
      LET l_xcec.xcec212h  = l_xceb.xceb212h
      LET l_xcec.xcec222   = l_xceb.xceb222
      LET l_xcec.xcec222a  = l_xceb.xceb222a
      LET l_xcec.xcec222b  = l_xceb.xceb222b
      LET l_xcec.xcec222c  = l_xceb.xceb222c
      LET l_xcec.xcec222d  = l_xceb.xceb222d
      LET l_xcec.xcec222e  = l_xceb.xceb222e
      LET l_xcec.xcec222f  = l_xceb.xceb222f
      LET l_xcec.xcec222g  = l_xceb.xceb222g
      LET l_xcec.xcec222h  = l_xceb.xceb222h
      LET l_xcec.xcec107  = l_xceb.xceb107
      LET l_xcec.xcec108  = l_xceb.xceb108
      LET l_xcec.xcec109  = l_xceb.xceb109
      LET l_xcec.xcec121  = l_xceb.xceb121
      LET l_xcec.xcec122  = l_xceb.xceb122
      LET l_xcec.xcec123  = l_xceb.xceb123
      LET l_xcec.xcec124  = l_xceb.xceb124
      LET l_xcec.xcec125  = l_xceb.xceb125
      LET l_xcec.xcec126  = l_xceb.xceb126
      LET l_xcec.xcec127  = l_xceb.xceb127
      LET l_xcec.xcec128  = l_xceb.xceb128
      LET l_xcec.xcec129  = l_xceb.xceb129
      LET l_xcec.xcec130  = l_xceb.xceb130
      
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 

      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','4') RETURNING l_success,l_xcec.xcec102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF            
      INSERT INTO xcec_t VALUES(l_xcec.*)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
         LET g_success = 'N'
         EXIT FOREACH
      END IF
      
      
      CLOSE xcae_prep5
      CLOSE xcae_prep6
   END FOREACH   
   RETURN g_success 
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_ins_10" order="18" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 描述说明   12.結存調整憑證  axct710
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_ins_10()
DEFINE l_success       LIKE type_t.num5
DEFINE l_errno         LIKE gzze_t.gzze001
DEFINE l_xcea          RECORD LIKE xcea_t.*
DEFINE l_xceb          RECORD LIKE xceb_t.*
DEFINE l_xcec          RECORD LIKE xcec_t.*
DEFINE l_xccc          RECORD LIKE xccc_t.*
DEFINE l_sql           STRING
DEFINE l_sql1          STRING
DEFINE l_rate          LIKE type_t.num26_10
DEFINE l_rate1         LIKE type_t.num26_10
DEFINE ld_date         DATETIME YEAR TO SECOND

   LET g_success = 'Y'
   LET l_xcea.xceaownid = g_user
   LET l_xcea.xceaowndp = g_dept
   LET l_xcea.xceacrtid = g_user
   LET l_xcea.xceacrtdp = g_dept 
   LET ld_date = cl_get_current()
   LET l_xcea.xceamodid = ""
   LET l_xcea.xceamoddt = ""
   CALL s_aooi200_fin_gen_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1)      #wujie 150214
    RETURNING l_success,g_xcea_m.xceadocno
   IF l_success  = 0  THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00003'
      LET g_errparam.extend = g_xcea_m.xceadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET g_success = 'N'
      RETURN g_success
   END IF
   
   INSERT INTO xcea_t (xceaent,xceald,xceacomp,xcea006,xceadocno,xcea001,xcea002,xcea004, 
       xcea005,xcea003,xceastus,xceaownid,xceaowndp,xceacrtid,xceacrtdp,xceacrtdt, 
       xceamodid,xceamoddt)
   VALUES (g_enterprise,g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea006,g_xcea_m.xceadocno, 
       g_xcea_m.xcea001,g_xcea002,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003, 
       'N',l_xcea.xceaownid,l_xcea.xceaowndp,l_xcea.xceacrtid, 
       l_xcea.xceacrtdp,ld_date,l_xcea.xceamodid,l_xcea.xceamoddt) 
       
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
      LET g_success = 'N'
      RETURN g_success
   END IF
   
   LET l_sql = " SELECT SUM(xccc202), ",
               "        SUM(xccc202a),SUM(xccc202b),SUM(xccc202c),SUM(xccc202d),",
               "        SUM(xccc202e),SUM(xccc202f),SUM(xccc202g),SUM(xccc202h) ",
               "        FROM xccc_t ", 
               "  WHERE xcccent = '",g_enterprise,"' AND xcccld = '",g_xcea_m.xceald,"'",
               "    AND xccc003 = '",g_xcea_m.xcea003,"' AND xccc004 = ",g_xcea_m.xcea004,
               "    AND xccc005 = ",g_xcea_m.xcea005,
               "    AND xccc002 = ? AND xccc008 = ? AND xccc006 = ?",
               "    AND xccc903 <> 0 ",
               "    AND xccc007 = ? " 
   LET g_sql = l_sql CLIPPED," AND xccc001 = '2' " 

   DECLARE xcae_prep8 CURSOR FROM g_sql
   
   LET g_sql = l_sql CLIPPED," AND xccc001 = '3' " 

   DECLARE xcae_prep9 CURSOR FROM g_sql
   
   LET l_sql = " SELECT xccc002,xccc008,xccc006,xccc007,SUM(xccc903), ",
               "        SUM(xccc903a),SUM(xccc903b),SUM(xccc903c),SUM(xccc903d),",
               "        SUM(xccc903e),SUM(xccc903f),SUM(xccc903g),SUM(xccc903h) ",
               "        FROM xccc_t ", 
               "  WHERE xcccent = '",g_enterprise,"' AND xcccld = '",g_xcea_m.xceald,"'",
               "    AND xccc003 = '",g_xcea_m.xcea003,"' AND xccc004 = ",g_xcea_m.xcea004,
               "    AND xccc903 <> 0 ",
               "    AND xccc005 = ",g_xcea_m.xcea005
   LET l_sql1 = l_sql CLIPPED," AND xccc001 = '1' ",
                " GROUP BY xccc002,xccc008,xccc006,xccc007",
                " ORDER BY xccc002,xccc008,xccc006,xccc007"
   PREPARE xcae_prep7 FROM l_sql1
   DECLARE xcae_curs7 CURSOR FOR xcae_prep7
   

   FOREACH xcae_curs7 INTO  l_xccc.xccc002,l_xccc.xccc008,l_xccc.xccc006,l_xccc.xccc007,
                            l_xccc.xccc903,l_xccc.xccc903a,l_xccc.xccc903b,l_xccc.xccc903c,
                            l_xccc.xccc903d,l_xccc.xccc903e,l_xccc.xccc903f,l_xccc.xccc903g,l_xccc.xccc903h      
      
      IF g_glaa015 ='Y' THEN      
         OPEN xcae_prep8 USING  l_xccc.xccc002,l_xccc.xccc008,l_xccc.xccc006,l_xccc.xccc007
         FETCH xcae_prep8 INTO l_xceb.xceb212,l_xceb.xceb212a,l_xceb.xceb212b,l_xceb.xceb212c,l_xceb.xceb212d,
                               l_xceb.xceb212e,l_xceb.xceb212f,l_xceb.xceb212g,l_xceb.xceb212h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep8
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb212a = 0
         LET l_xceb.xceb212b = 0
         LET l_xceb.xceb212c = 0
         LET l_xceb.xceb212d = 0
         LET l_xceb.xceb212e = 0
         LET l_xceb.xceb212f = 0
         LET l_xceb.xceb212g = 0
         LET l_xceb.xceb212h = 0
         LET l_xceb.xceb212  = 0     
      END IF
      
      IF g_glaa019 ='Y' THEN
         OPEN xcae_prep9 USING  l_xccc.xccc002,l_xccc.xccc008,l_xccc.xccc006,l_xccc.xccc007
         FETCH xcae_prep9 INTO l_xceb.xceb222,l_xceb.xceb222a,l_xceb.xceb222b,l_xceb.xceb222c,l_xceb.xceb222d,
                               l_xceb.xceb222e,l_xceb.xceb222f,l_xceb.xceb222g,l_xceb.xceb222h
         #資料被他人LOCK, 或是sql執行時出現錯誤
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = g_xcea_m.xceald
            LET g_errparam.popup = FALSE
            CALL cl_err()
         
            CLOSE xcae_prep9
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      ELSE
         LET l_xceb.xceb222a = 0
         LET l_xceb.xceb222b = 0
         LET l_xceb.xceb222c = 0
         LET l_xceb.xceb222d = 0
         LET l_xceb.xceb222e = 0
         LET l_xceb.xceb222f = 0
         LET l_xceb.xceb222g = 0
         LET l_xceb.xceb222h = 0
         LET l_xceb.xceb222  = 0     
      END IF
       
      SELECT MAX(xcebseq) INTO l_xceb.xcebseq FROM xceb_t
       WHERE xcebent = g_enterprise AND xcebld = g_xcea_m.xceald
         AND xcebdocno = g_xcea_m.xceadocno
      IF cl_null(l_xceb.xcebseq) OR l_xceb.xcebseq = 0 THEN
         LET l_xceb.xcebseq = 1
      ELSE
         LET l_xceb.xcebseq = l_xceb.xcebseq + 1
      END IF 
      
      LET l_xceb.xcebent  = g_enterprise
      LET l_xceb.xcebld   = g_xcea_m.xceald
      LET l_xceb.xcebdocno= g_xcea_m.xceadocno
      LET l_xceb.xcebcomp = g_xcea_m.xceacomp
      LET l_xceb.xceb001  = ''
      LET l_xceb.xceb002  = ''
      LET l_xceb.xceb003  = ''
      LET l_xceb.xceb004  = l_xccc.xccc006
      LET l_xceb.xceb005  = l_xccc.xccc007
      LET l_xceb.xceb102  = ''
      LET l_xceb.xceb103  = l_xccc.xccc002
      LET l_xceb.xceb201  = 0
      LET l_xceb.xceb202  = l_xccc.xccc903
      LET l_xceb.xceb202a = l_xccc.xccc903a
      LET l_xceb.xceb202b = l_xccc.xccc903b
      LET l_xceb.xceb202c = l_xccc.xccc903c
      LET l_xceb.xceb202d = l_xccc.xccc903d
      LET l_xceb.xceb202e = l_xccc.xccc903e
      LET l_xceb.xceb202f = l_xccc.xccc903f
      LET l_xceb.xceb202g = l_xccc.xccc903g
      LET l_xceb.xceb202h = l_xccc.xccc903h
       
      SELECT imag011 INTO l_xceb.xceb117 FROM imag_t
       WHERE imagent = g_enterprise AND imagsite = g_xcea_m.xceacomp
         AND imag001 = l_xceb.xceb004

     LET l_xceb.xceb101 = ''
      #存貨科目
      CALL s_get_item_acc(g_xcea_m.xceald,'1',l_xceb.xceb004,'','',g_xcea_m.xceacomp,'') 
        RETURNING l_success,l_xceb.xceb101 

      #人员
      LET l_xceb.xceb107 = ' '
      #部门
      LET l_xceb.xceb108 = ' '
      #账款对象
      LET l_xceb.xceb109 = ' '
      #自由核算项1～10  
      LET l_xceb.xceb121 = ' '
      LET l_xceb.xceb122 = ' '
      LET l_xceb.xceb123 = ' '
      LET l_xceb.xceb124 = ' '
      LET l_xceb.xceb125 = ' '
      LET l_xceb.xceb126 = ' '
      LET l_xceb.xceb127 = ' '
      LET l_xceb.xceb128 = ' '
      LET l_xceb.xceb129 = ' '
      LET l_xceb.xceb130 = ' '
      #摘要
      IF cl_null(l_xceb.xceb102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','10') RETURNING l_success,l_xceb.xceb102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130

#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xceb.xceb201= 0 AND l_xceb.xceb202 = 0 THEN
         CONTINUE FOREACH
      END IF
     INSERT INTO xceb_t VALUES(l_xceb.*)
     
     IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
        LET g_success = 'N'
        EXIT FOREACH
     END IF
      
     INITIALIZE l_xcec.* TO NULL
     
      SELECT MAX(xcecseq) INTO l_xcec.xcecseq FROM xcec_t
       WHERE xcecent = g_enterprise AND xcecld = g_xcea_m.xceald
         AND xcecdocno = g_xcea_m.xceadocno
      IF cl_null(l_xcec.xcecseq) OR l_xcec.xcecseq = 0 THEN
         LET l_xcec.xcecseq = 1
      ELSE
         LET l_xcec.xcecseq = l_xcec.xcecseq + 1
      END IF 

 
      LET l_xcec.xcecent = g_enterprise
      LET l_xcec.xcecld  = g_xcea_m.xceald
      LET l_xcec.xceccomp  = g_xcea_m.xceacomp
      LET l_xcec.xcecdocno = g_xcea_m.xceadocno
      LET l_xcec.xcec001 = ''
      LET l_xcec.xcec002 = ''
      LET l_xcec.xcec003 = ''
      LET l_xcec.xcec004 = l_xccc.xccc006
      LET l_xcec.xcec005 = l_xccc.xccc007
      LET l_xcec.xcec101 = ''
#抓axci201的科目
      IF cl_null(l_xcec.xcec101) THEN
         CALL s_fin_get_account(g_xcea_m.xceald,'60','8912','8') RETURNING l_success,l_xcec.xcec101,l_errno
      END IF
      LET l_xcec.xcec102 = ''
      LET l_xcec.xcec103 = l_xccc.xccc002
      LET l_xcec.xcec117 = l_xceb.xceb117
      LET l_xcec.xcec119 = l_xceb.xceb119
      LET l_xcec.xcec201 = 0
      LET l_xcec.xcec202 = l_xccc.xccc903
      LET l_xcec.xcec202a = l_xccc.xccc903a
      LET l_xcec.xcec202b = l_xccc.xccc903b
      LET l_xcec.xcec202c = l_xccc.xccc903c
      LET l_xcec.xcec202d = l_xccc.xccc903d
      LET l_xcec.xcec202e = l_xccc.xccc903e
      LET l_xcec.xcec202f = l_xccc.xccc903f
      LET l_xcec.xcec202g = l_xccc.xccc903g
      LET l_xcec.xcec202h = l_xccc.xccc903h
      LET l_xcec.xcec212 = l_xceb.xceb212
      LET l_xcec.xcec212a = l_xceb.xceb212a
      LET l_xcec.xcec212b = l_xceb.xceb212b
      LET l_xcec.xcec212c = l_xceb.xceb212c
      LET l_xcec.xcec212d = l_xceb.xceb212d
      LET l_xcec.xcec212e = l_xceb.xceb212e
      LET l_xcec.xcec212f = l_xceb.xceb212f
      LET l_xcec.xcec212g = l_xceb.xceb212g
      LET l_xcec.xcec212h = l_xceb.xceb212h
      LET l_xcec.xcec222 = l_xceb.xceb222
      LET l_xcec.xcec222a = l_xceb.xceb222a
      LET l_xcec.xcec222b = l_xceb.xceb222b
      LET l_xcec.xcec222c = l_xceb.xceb222c
      LET l_xcec.xcec222d = l_xceb.xceb222d
      LET l_xcec.xcec222e = l_xceb.xceb222e
      LET l_xcec.xcec222f = l_xceb.xceb222f
      LET l_xcec.xcec222g = l_xceb.xceb222g
      LET l_xcec.xcec222h = l_xceb.xceb222h
      LET l_xcec.xcec107 = l_xceb.xceb107
      LET l_xcec.xcec108 = l_xceb.xceb108
      LET l_xcec.xcec109 = l_xceb.xceb109
      LET l_xcec.xcec121 = l_xceb.xceb121
      LET l_xcec.xcec122 = l_xceb.xceb122
      LET l_xcec.xcec123 = l_xceb.xceb123
      LET l_xcec.xcec124 = l_xceb.xceb124
      LET l_xcec.xcec125 = l_xceb.xceb125
      LET l_xcec.xcec126 = l_xceb.xceb126
      LET l_xcec.xcec127 = l_xceb.xceb127
      LET l_xcec.xcec128 = l_xceb.xceb128
      LET l_xcec.xcec129 = l_xceb.xceb129
      LET l_xcec.xcec130 = l_xceb.xceb130
 
      #摘要
      IF cl_null(l_xcec.xcec102) THEN
         CALL axct701_01_get_summ(g_xcea_m.xceald,'61','8925','10') RETURNING l_success,l_xcec.xcec102
      END IF
      CALL axct701_01_default_space_xceb(l_xceb.*) RETURNING l_xceb.xceb005,
                                                             l_xceb.xceb101,
                                                             l_xceb.xceb102,
                                                             l_xceb.xceb103,
                                                             l_xceb.xceb110,
                                                             l_xceb.xceb111,
                                                             l_xceb.xceb112,
                                                             l_xceb.xceb113,
                                                             l_xceb.xceb114,
                                                             l_xceb.xceb115,
                                                             l_xceb.xceb116,
                                                             l_xceb.xceb117,
                                                             l_xceb.xceb118,
                                                             l_xceb.xceb119,
                                                             l_xceb.xceb120,
                                                             l_xceb.xceb107,
                                                             l_xceb.xceb108,
                                                             l_xceb.xceb109,
                                                             l_xceb.xceb121,
                                                             l_xceb.xceb122,
                                                             l_xceb.xceb123,
                                                             l_xceb.xceb124,
                                                             l_xceb.xceb125,
                                                             l_xceb.xceb126,
                                                             l_xceb.xceb127,
                                                             l_xceb.xceb128,
                                                             l_xceb.xceb129,
                                                             l_xceb.xceb130      
#如果金额和数量都为0的话，则不产生此笔单身数据                                                             
      IF l_xcec.xcec201= 0 AND l_xcec.xcec202 = 0 THEN
         CONTINUE FOREACH
      END IF       
      INSERT INTO xcec_t VALUES(l_xcec.*)
      
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "g_xcea_m"
      LET g_errparam.popup = TRUE
      CALL cl_err()
  
         LET g_success = 'N'
         EXIT FOREACH
      END IF
      
      
      CLOSE xcae_prep8
      CLOSE xcae_prep9
   END FOREACH   
   RETURN g_success 
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_default_space_xceb" order="19" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 不能留空的值给空格
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_default_space_xceb(p_xceb)
   DEFINE p_xceb     RECORD LIKE xceb_t.*
   DEFINE l_glad     RECORD LIKE glad_t.*    #wujie 150214
   
   IF p_xceb.xceb005 IS NULL THEN LET p_xceb.xceb005 = ' ' END IF 	#特性
   IF p_xceb.xceb101 IS NULL THEN LET p_xceb.xceb101 = ' ' END IF 	#科目编号
   IF p_xceb.xceb102 IS NULL THEN LET p_xceb.xceb102 = ' ' END IF 	#摘要
   IF p_xceb.xceb103 IS NULL THEN LET p_xceb.xceb103 = ' ' END IF 	#成本域
   IF p_xceb.xceb110 IS NULL THEN LET p_xceb.xceb110 = ' ' END IF 	#原因码
   IF p_xceb.xceb111 IS NULL THEN LET p_xceb.xceb111 = ' ' END IF 	#交易对象
   IF p_xceb.xceb112 IS NULL THEN LET p_xceb.xceb112 = ' ' END IF 	#客群
   IF p_xceb.xceb113 IS NULL THEN LET p_xceb.xceb113 = ' ' END IF 	#区域
   IF p_xceb.xceb114 IS NULL THEN LET p_xceb.xceb114 = ' ' END IF 	#成本中心
   IF p_xceb.xceb115 IS NULL THEN LET p_xceb.xceb115 = ' ' END IF 	#经营类别
   IF p_xceb.xceb116 IS NULL THEN LET p_xceb.xceb116 = ' ' END IF 	#渠道
   IF p_xceb.xceb117 IS NULL THEN LET p_xceb.xceb117 = ' ' END IF 	#品类
   IF p_xceb.xceb118 IS NULL THEN LET p_xceb.xceb118 = ' ' END IF 	#品牌
   IF p_xceb.xceb119 IS NULL THEN LET p_xceb.xceb119 = ' ' END IF 	#项目号
   IF p_xceb.xceb120 IS NULL THEN LET p_xceb.xceb120 = ' ' END IF 	#WBS
   IF p_xceb.xceb107	IS NULL THEN LET p_xceb.xceb107 = ' ' END IF  #人员
   IF p_xceb.xceb108	IS NULL THEN LET p_xceb.xceb108 = ' ' END IF  #部门
   IF p_xceb.xceb109	IS NULL THEN LET p_xceb.xceb109 = ' ' END IF  #账款对象
   IF p_xceb.xceb121	IS NULL THEN LET p_xceb.xceb121 = ' ' END IF  #自由核算项1
   IF p_xceb.xceb122	IS NULL THEN LET p_xceb.xceb122 = ' ' END IF  #自由核算项2
   IF p_xceb.xceb123	IS NULL THEN LET p_xceb.xceb123 = ' ' END IF  #自由核算项3
   IF p_xceb.xceb124	IS NULL THEN LET p_xceb.xceb124 = ' ' END IF  #自由核算项4
   IF p_xceb.xceb125	IS NULL THEN LET p_xceb.xceb125 = ' ' END IF  #自由核算项5
   IF p_xceb.xceb126	IS NULL THEN LET p_xceb.xceb126 = ' ' END IF  #自由核算项6
   IF p_xceb.xceb127	IS NULL THEN LET p_xceb.xceb127 = ' ' END IF  #自由核算项7
   IF p_xceb.xceb128	IS NULL THEN LET p_xceb.xceb128 = ' ' END IF  #自由核算项8
   IF p_xceb.xceb129	IS NULL THEN LET p_xceb.xceb129 = ' ' END IF  #自由核算项9
   IF p_xceb.xceb130	IS NULL THEN LET p_xceb.xceb130 = ' ' END IF  #自由核算项10
 
   INITIALIZE l_glad.* TO NULL
   SELECT * INTO l_glad.* FROM glad_t
    WHERE gladent = p_xceb.xcebent
      AND gladld  = p_xceb.xcebld
      AND glad001 = p_xceb.xceb101

   IF l_glad.glad010 = 'N' THEN   #启用交易对象
      LET p_xceb.xceb111 = ' '
   END IF
   
   IF l_glad.glad011 = 'N' THEN   #启用客群
      LET p_xceb.xceb112 = ' '
   END IF

   IF l_glad.glad009 = 'N' THEN   #启用区域
      LET p_xceb.xceb113 = ' '
   END IF
   
   IF l_glad.glad008 = 'N' THEN   #启用成本中心
      LET p_xceb.xceb114 = ' '
   END IF
   
   IF l_glad.glad031 = 'N' THEN   #启用经营类别
      LET p_xceb.xceb115 = ' '
   END IF
 
   IF l_glad.glad032 = 'N' THEN   #启用渠道
      LET p_xceb.xceb116 = ' '
   END IF

   IF l_glad.glad012 = 'N' THEN   #启用品类
      LET p_xceb.xceb117 = ' '
   END IF
   
   IF l_glad.glad033 = 'N' THEN   #启用品牌
      LET p_xceb.xceb118 = ' '
   END IF
 
   IF l_glad.glad015 = 'N' THEN   #启用项目号
      LET p_xceb.xceb119 = ' '
   END IF
 
   IF l_glad.glad016 = 'N' THEN   #启用WBS
      LET p_xceb.xceb120 = ' '
   END IF
 
   IF l_glad.glad013 = 'N' THEN   #启用人员
      LET p_xceb.xceb107 = ' '
   END IF
 
   IF l_glad.glad007 = 'N' THEN   #启用部门
      LET p_xceb.xceb108 = ' '
   END IF
   
   IF l_glad.glad027 = 'N' THEN   #启用账款对象
      LET p_xceb.xceb109 = ' '
   END IF
   
   IF l_glad.glad017 = 'N' THEN   #启用自由核算项1
      LET p_xceb.xceb121 = ' '
   END IF
 
   IF l_glad.glad018 = 'N' THEN   #启用自由核算项2
      LET p_xceb.xceb122 = ' '
   END IF
 
   IF l_glad.glad019 = 'N' THEN   #启用自由核算项3
      LET p_xceb.xceb123 = ' '
   END IF

   IF l_glad.glad020 = 'N' THEN   #启用自由核算项4
      LET p_xceb.xceb124 = ' '
   END IF

   IF l_glad.glad021 = 'N' THEN   #启用自由核算项5
      LET p_xceb.xceb125 = ' '
   END IF

   IF l_glad.glad022 = 'N' THEN   #启用自由核算项6
      LET p_xceb.xceb126 = ' '
   END IF

   IF l_glad.glad023 = 'N' THEN   #启用自由核算项7
      LET p_xceb.xceb127 = ' '
   END IF

   IF l_glad.glad024 = 'N' THEN   #启用自由核算项8
      LET p_xceb.xceb128 = ' '
   END IF

   IF l_glad.glad025 = 'N' THEN   #启用自由核算项9
      LET p_xceb.xceb129 = ' '
   END IF

   IF l_glad.glad026 = 'N' THEN   #启用自由核算项10
      LET p_xceb.xceb130 = ' '
   END IF
   
   IF cl_null(p_xceb.xceb101) THEN
      LET p_xceb.xceb111 = ' '  	#交易对象
      LET p_xceb.xceb112 = ' '  	#客群
      LET p_xceb.xceb113 = ' '  	#区域
      LET p_xceb.xceb114 = ' '  	#成本中心
      LET p_xceb.xceb115 = ' '  	#经营类别
      LET p_xceb.xceb116 = ' '  	#渠道
      LET p_xceb.xceb117 = ' '  	#品类
      LET p_xceb.xceb118 = ' '  	#品牌
      LET p_xceb.xceb119 = ' '  	#项目号
      LET p_xceb.xceb120 = ' '  	#WBS
      LET p_xceb.xceb107 = ' '   #人员
      LET p_xceb.xceb108 = ' '   #部门
      LET p_xceb.xceb109 = ' '   #账款对象
      LET p_xceb.xceb121 = ' '   #自由核算项1
      LET p_xceb.xceb122 = ' '   #自由核算项2
      LET p_xceb.xceb123 = ' '   #自由核算项3
      LET p_xceb.xceb124 = ' '   #自由核算项4
      LET p_xceb.xceb125 = ' '   #自由核算项5
      LET p_xceb.xceb126 = ' '   #自由核算项6
      LET p_xceb.xceb127 = ' '   #自由核算项7
      LET p_xceb.xceb128 = ' '   #自由核算项8
      LET p_xceb.xceb129 = ' '   #自由核算项9
      LET p_xceb.xceb130 = ' '   #自由核算项10
   END IF
   
   RETURN p_xceb.xceb005,
          p_xceb.xceb101,
          p_xceb.xceb102,
          p_xceb.xceb103,
          p_xceb.xceb110,
          p_xceb.xceb111,
          p_xceb.xceb112,
          p_xceb.xceb113,
          p_xceb.xceb114,
          p_xceb.xceb115,
          p_xceb.xceb116,
          p_xceb.xceb117,
          p_xceb.xceb118,
          p_xceb.xceb119,
          p_xceb.xceb120,
          p_xceb.xceb107,
          p_xceb.xceb108,
          p_xceb.xceb109,
          p_xceb.xceb121,
          p_xceb.xceb122,
          p_xceb.xceb123,
          p_xceb.xceb124,
          p_xceb.xceb125,
          p_xceb.xceb126,
          p_xceb.xceb127,
          p_xceb.xceb128,
          p_xceb.xceb129,
          p_xceb.xceb130
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_default_space_xcec" order="20" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_default_space_xcec(p_xcec)
   DEFINE p_xcec     RECORD LIKE xcec_t.*
   DEFINE l_glad     RECORD LIKE glad_t.*    #wujie 150214
   
   IF p_xcec.xcec005 IS NULL THEN LET p_xcec.xcec005 = ' ' END IF 	#特性
   IF p_xcec.xcec101 IS NULL THEN LET p_xcec.xcec101 = ' ' END IF 	#科目编号
   IF p_xcec.xcec102 IS NULL THEN LET p_xcec.xcec102 = ' ' END IF 	#摘要
   IF p_xcec.xcec103 IS NULL THEN LET p_xcec.xcec103 = ' ' END IF 	#成本域
   IF p_xcec.xcec110 IS NULL THEN LET p_xcec.xcec110 = ' ' END IF 	#原因码
   IF p_xcec.xcec111 IS NULL THEN LET p_xcec.xcec111 = ' ' END IF 	#交易对象
   IF p_xcec.xcec112 IS NULL THEN LET p_xcec.xcec112 = ' ' END IF 	#客群
   IF p_xcec.xcec113 IS NULL THEN LET p_xcec.xcec113 = ' ' END IF 	#区域
   IF p_xcec.xcec114 IS NULL THEN LET p_xcec.xcec114 = ' ' END IF 	#成本中心
   IF p_xcec.xcec115 IS NULL THEN LET p_xcec.xcec115 = ' ' END IF 	#经营类别
   IF p_xcec.xcec116 IS NULL THEN LET p_xcec.xcec116 = ' ' END IF 	#渠道
   IF p_xcec.xcec117 IS NULL THEN LET p_xcec.xcec117 = ' ' END IF 	#品类
   IF p_xcec.xcec118 IS NULL THEN LET p_xcec.xcec118 = ' ' END IF 	#品牌
   IF p_xcec.xcec119 IS NULL THEN LET p_xcec.xcec119 = ' ' END IF 	#项目号
   IF p_xcec.xcec120 IS NULL THEN LET p_xcec.xcec120 = ' ' END IF 	#WBS
   IF p_xcec.xcec107	IS NULL THEN LET p_xcec.xcec107 = ' ' END IF  #人员
   IF p_xcec.xcec108	IS NULL THEN LET p_xcec.xcec108 = ' ' END IF  #部门
   IF p_xcec.xcec109	IS NULL THEN LET p_xcec.xcec109 = ' ' END IF  #账款对象
   IF p_xcec.xcec121	IS NULL THEN LET p_xcec.xcec121 = ' ' END IF  #自由核算项1
   IF p_xcec.xcec122	IS NULL THEN LET p_xcec.xcec122 = ' ' END IF  #自由核算项2
   IF p_xcec.xcec123	IS NULL THEN LET p_xcec.xcec123 = ' ' END IF  #自由核算项3
   IF p_xcec.xcec124	IS NULL THEN LET p_xcec.xcec124 = ' ' END IF  #自由核算项4
   IF p_xcec.xcec125	IS NULL THEN LET p_xcec.xcec125 = ' ' END IF  #自由核算项5
   IF p_xcec.xcec126	IS NULL THEN LET p_xcec.xcec126 = ' ' END IF  #自由核算项6
   IF p_xcec.xcec127	IS NULL THEN LET p_xcec.xcec127 = ' ' END IF  #自由核算项7
   IF p_xcec.xcec128	IS NULL THEN LET p_xcec.xcec128 = ' ' END IF  #自由核算项8
   IF p_xcec.xcec129	IS NULL THEN LET p_xcec.xcec129 = ' ' END IF  #自由核算项9
   IF p_xcec.xcec130	IS NULL THEN LET p_xcec.xcec130 = ' ' END IF  #自由核算项10

   INITIALIZE l_glad.* TO NULL
   SELECT * INTO l_glad.* FROM glad_t
    WHERE gladent = p_xcec.xcecent
      AND gladld  = p_xcec.xcecld
      AND glad001 = p_xcec.xcec101

   IF l_glad.glad010 = 'N' THEN   #启用交易对象
      LET p_xcec.xcec111 = ' '
   END IF
   
   IF l_glad.glad011 = 'N' THEN   #启用客群
      LET p_xcec.xcec112 = ' '
   END IF

   IF l_glad.glad009 = 'N' THEN   #启用区域
      LET p_xcec.xcec113 = ' '
   END IF
   
   IF l_glad.glad008 = 'N' THEN   #启用成本中心
      LET p_xcec.xcec114 = ' '
   END IF
   
   IF l_glad.glad031 = 'N' THEN   #启用经营类别
      LET p_xcec.xcec115 = ' '
   END IF
 
   IF l_glad.glad032 = 'N' THEN   #启用渠道
      LET p_xcec.xcec116 = ' '
   END IF

   IF l_glad.glad012 = 'N' THEN   #启用品类
      LET p_xcec.xcec117 = ' '
   END IF
   
   IF l_glad.glad033 = 'N' THEN   #启用品牌
      LET p_xcec.xcec118 = ' '
   END IF
 
   IF l_glad.glad015 = 'N' THEN   #启用项目号
      LET p_xcec.xcec119 = ' '
   END IF
 
   IF l_glad.glad016 = 'N' THEN   #启用WBS
      LET p_xcec.xcec120 = ' '
   END IF
 
   IF l_glad.glad013 = 'N' THEN   #启用人员
      LET p_xcec.xcec107 = ' '
   END IF
 
   IF l_glad.glad007 = 'N' THEN   #启用部门
      LET p_xcec.xcec108 = ' '
   END IF
   
   IF l_glad.glad027 = 'N' THEN   #启用账款对象
      LET p_xcec.xcec109 = ' '
   END IF
   
   IF l_glad.glad017 = 'N' THEN   #启用自由核算项1
      LET p_xcec.xcec121 = ' '
   END IF
 
   IF l_glad.glad018 = 'N' THEN   #启用自由核算项2
      LET p_xcec.xcec122 = ' '
   END IF
 
   IF l_glad.glad019 = 'N' THEN   #启用自由核算项3
      LET p_xcec.xcec123 = ' '
   END IF

   IF l_glad.glad020 = 'N' THEN   #启用自由核算项4
      LET p_xcec.xcec124 = ' '
   END IF

   IF l_glad.glad021 = 'N' THEN   #启用自由核算项5
      LET p_xcec.xcec125 = ' '
   END IF

   IF l_glad.glad022 = 'N' THEN   #启用自由核算项6
      LET p_xcec.xcec126 = ' '
   END IF

   IF l_glad.glad023 = 'N' THEN   #启用自由核算项7
      LET p_xcec.xcec127 = ' '
   END IF

   IF l_glad.glad024 = 'N' THEN   #启用自由核算项8
      LET p_xcec.xcec128 = ' '
   END IF

   IF l_glad.glad025 = 'N' THEN   #启用自由核算项9
      LET p_xcec.xcec129 = ' '
   END IF

   IF l_glad.glad026 = 'N' THEN   #启用自由核算项10
      LET p_xcec.xcec130 = ' '
   END IF

   IF cl_null(p_xcec.xcec101) THEN
      LET p_xcec.xcec111 = ' '  	#交易对象
      LET p_xcec.xcec112 = ' '  	#客群
      LET p_xcec.xcec113 = ' '  	#区域
      LET p_xcec.xcec114 = ' '  	#成本中心
      LET p_xcec.xcec115 = ' '  	#经营类别
      LET p_xcec.xcec116 = ' '  	#渠道
      LET p_xcec.xcec117 = ' '  	#品类
      LET p_xcec.xcec118 = ' '  	#品牌
      LET p_xcec.xcec119 = ' '  	#项目号
      LET p_xcec.xcec120 = ' '  	#WBS
      LET p_xcec.xcec107 = ' '   #人员
      LET p_xcec.xcec108 = ' '   #部门
      LET p_xcec.xcec109 = ' '   #账款对象
      LET p_xcec.xcec121 = ' '   #自由核算项1
      LET p_xcec.xcec122 = ' '   #自由核算项2
      LET p_xcec.xcec123 = ' '   #自由核算项3
      LET p_xcec.xcec124 = ' '   #自由核算项4
      LET p_xcec.xcec125 = ' '   #自由核算项5
      LET p_xcec.xcec126 = ' '   #自由核算项6
      LET p_xcec.xcec127 = ' '   #自由核算项7
      LET p_xcec.xcec128 = ' '   #自由核算项8
      LET p_xcec.xcec129 = ' '   #自由核算项9
      LET p_xcec.xcec130 = ' '   #自由核算项10
   END IF

   RETURN p_xcec.xcec005,
          p_xcec.xcec101,
          p_xcec.xcec102,
          p_xcec.xcec103,
          p_xcec.xcec110,
          p_xcec.xcec111,
          p_xcec.xcec112,
          p_xcec.xcec113,
          p_xcec.xcec114,
          p_xcec.xcec115,
          p_xcec.xcec116,
          p_xcec.xcec117,
          p_xcec.xcec118,
          p_xcec.xcec119,
          p_xcec.xcec120,
          p_xcec.xcec107,
          p_xcec.xcec108,
          p_xcec.xcec109,
          p_xcec.xcec121,
          p_xcec.xcec122,
          p_xcec.xcec123,
          p_xcec.xcec124,
          p_xcec.xcec125,
          p_xcec.xcec126,
          p_xcec.xcec127,
          p_xcec.xcec128,
          p_xcec.xcec129,
          p_xcec.xcec130
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_del_all" order="21" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 若无单身产生，单头也要取消
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_del_all()
   DEFINE l_cnt1     LIKE type_t.num5
   DEFINE l_cnt2     LIKE type_t.num5
   DEFINE r_success  LIKE type_t.chr1
   
   LET r_success = 'Y'
   LET l_cnt1 = 0
   LET l_cnt2 = 0
   
   SELECT COUNT(*) INTO l_cnt1 
     FROM xceb_t 
    WHERE xcebent = g_enterprise
      AND xcebld  = g_xcea_m.xceald
      AND xcebdocno=g_xcea_m.xceadocno
      
   SELECT COUNT(*) INTO l_cnt2 
     FROM xcec_t 
    WHERE xcecent = g_enterprise
      AND xcecld  = g_xcea_m.xceald
      AND xcecdocno=g_xcea_m.xceadocno      

   IF l_cnt1 = 0 AND l_cnt2 = 0 THEN
      DELETE FROM xcea_t 
       WHERE xceaent = g_enterprise
         AND xceald  = g_xcea_m.xceald
         AND xceadocno=g_xcea_m.xceadocno

      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'agl-00167'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET r_success = 'N'
      LET g_xcea_m.xceald = ''
      LET g_xcea_m.xceadocno = ''
   END IF
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.axct701_01_get_summ" order="22" ver="8" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 取得axci202维护的摘要
# Memo...........:
# Usage..........: CALL axct701_01_get_summ(p_glabld,p_glab001,p_glab002,p_glab003)
#                  RETURNING r_success,r_summ
# Input parameter: p_glabld       帳別
#                : p_glab001      科目對應的帳務類型
#                : p_glab002      帳款類別
#                : p_glab003      預設科目代號(SCC設定)
# Return code....: r_success      TRUE成功/FALSE失敗
#                : r_summ         摘要
# Date & Author..: 15/03/26 By wujie
# Modify.........:
################################################################################
PRIVATE FUNCTION axct701_01_get_summ(p_glabld,p_glab001,p_glab002,p_glab003)
   DEFINE p_glabld      LIKE glab_t.glabld
   DEFINE p_glab001     LIKE glab_t.glab001
   DEFINE p_glab002     LIKE glab_t.glab002
   DEFINE p_glab003     LIKE glab_t.glab003
   DEFINE r_summ        LIKE glab_t.glab010
   DEFINE r_success     LIKE type_t.num10
   DEFINE l_success     LIKE type_t.num10
   
   WHENEVER ERROR CONTINUE
   
   LET r_summ = NULL
   LET r_success = TRUE
   SELECT glab010 INTO r_summ
     FROM glab_t
    WHERE glabld  = p_glabld
      AND glab001 = p_glab001
      AND glab002 = p_glab002
      AND glab003 = p_glab003
      AND glabent = g_enterprise
      
   RETURN r_success,r_summ
END FUNCTION]]>
  </point>
  <point name="global.variable" order="" ver="8" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[DEFINE g_bdate      LIKE glav_t.glav004 #起始年度+期別對應的起始截止日期
DEFINE g_edate      LIKE glav_t.glav004
DEFINE g_glaa001    LIKE glaa_t.glaa001
DEFINE g_glaa003    LIKE glaa_t.glaa003
DEFINE g_glaa004    LIKE glaa_t.glaa004
DEFINE g_glaa015    LIKE glaa_t.glaa015
DEFINE g_glaa016    LIKE glaa_t.glaa016
DEFINE g_glaa018    LIKE glaa_t.glaa018
DEFINE g_glaa019    LIKE glaa_t.glaa019
DEFINE g_glaa020    LIKE glaa_t.glaa020
DEFINE g_glaa022    LIKE glaa_t.glaa022
DEFINE g_glaa024    LIKE glaa_t.glaa024
DEFINE g_prog_name1 LIKE type_t.chr20
DEFINE g_xcea002    LIKE xcea_t.xcea002
DEFINE g_sql,g_sql1,g_sql2   STRING]]>
  </point>
  <point name="input.a.xcea003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xcea_m.xcea003) THEN 
               #檢查是否存在于 成本類型設置檔 中
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? ",'agl-00194',1) THEN
                  LET g_xcea_m.xcea003 = ''
                  CALL axct701_01_get_xcea003_desc()                  
                  NEXT FIELD CURRENT
               END IF
               
               #檢查是否 有效
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? AND xcatstus = 'Y' ",'agl-00195',1) THEN
                  LET g_xcea_m.xcea003 = ''
                  CALL axct701_01_get_xcea003_desc()                  
                  NEXT FIELD CURRENT
               END IF                   
            END IF
            
            CALL axct701_01_get_xcea003_desc() 

]]>
  </point>
  <point name="input.a.xcea004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xcea_m.xcea004) THEN  
               IF NOT s_fin_date_chk_year(g_xcea_m.xcea004) THEN
                  LET g_xcea_m.xcea004 = ''
                  DISPLAY BY NAME g_xcea_m.xcea004
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'aoo-00113'
                  LET g_errparam.extend = g_xcea_m.xcea004
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD CURRENT
               END IF
            END IF   
            
            IF NOT cl_null(g_xcea_m.xcea004) AND NOT cl_null(g_xcea_m.xcea005) AND NOT cl_null(g_xcea_m.xceald) THEN
               CALL s_fin_date_get_period_range(g_glaa003,g_xcea_m.xcea004,g_xcea_m.xcea005)
                   RETURNING g_bdate,g_edate               
            END IF]]>
  </point>
  <point name="input.a.xcea005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xcea_m.xcea005) THEN 
               IF g_xcea_m.xcea005 < 1 OR g_xcea_m.xcea005 > 13 THEN
                  LET g_xcea_m.xcea005 = ''
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'amm-00106'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD CURRENT          
               END IF
            END IF
            
            IF NOT cl_null(g_xcea_m.xcea005) AND NOT cl_null(g_xcea_m.xceald) THEN                 
               IF NOT s_fin_date_chk_period(g_glaa003,g_xcea_m.xcea004,g_xcea_m.xcea005) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'afa-00119'
                  LET g_errparam.extend = g_xcea_m.xcea005
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_xcea_m.xcea005 = ''
                  DISPLAY BY NAME g_xcea_m.xcea005
                  NEXT FIELD CURRENT
               END IF
            END IF            
            
            IF NOT cl_null(g_xcea_m.xcea004) AND NOT cl_null(g_xcea_m.xcea005) AND NOT cl_null(g_xcea_m.xceald) THEN
               CALL s_fin_date_get_period_range(g_glaa003,g_xcea_m.xcea004,g_xcea_m.xcea005)
                   RETURNING g_bdate,g_edate               
            END IF]]>
  </point>
  <point name="input.a.xcea006" order="" ver="6" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            IF NOT cl_null(g_xcea_m.xcea006) THEN
               SELECT DISTINCT ooag003 INTO g_xcea_m.xcea007
                 FROM ooag_t
                 WHERE ooagent = g_enterprise
                   AND ooag001 = g_xcea_m.xcea006
                 ORDER BY ooag003
                 
               CALL s_desc_get_department_desc(g_xcea_m.xcea007) RETURNING g_xcea_m.xcea007_desc
               DISPLAY BY NAME g_xcea_m.xcea007
               DISPLAY g_xcea_m.xcea007_desc TO xcea007_desc
            END IF

            CALL s_desc_get_person_desc(g_xcea_m.xcea006) RETURNING g_xcea_m.xcea006_desc
            DISPLAY g_xcea_m.xcea006_desc TO xcea006_desc]]>
  </point>
  <point name="input.a.xcea007" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#            IF NOT cl_null(g_xcea_m.xcea007) THEN
#              #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
#              INITIALIZE g_chkparam.* TO NULL
#              #設定g_chkparam.*的參數
#              LET g_chkparam.arg1 = g_xcea_m.xcea007
#              LET g_chkparam.arg2 = g_xcea_m.xcea001
#              
#              #呼叫檢查存在並帶值的library
#              IF NOT cl_chk_exist('v_ooeg001') THEN
#                 #檢查失敗時後續處理
#                 LET g_xcea_m.xcea007 = ''
#                 NEXT FIELD xcea007
#              END IF
#            END IF
            CALL s_desc_get_department_desc(g_xcea_m.xcea007) RETURNING g_xcea_m.xcea007_desc
            DISPLAY g_xcea_m.xcea007_desc TO xcea007_desc]]>
  </point>
  <point name="input.a.xceacomp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #CALL axct701_01_get_xceacomp_desc()

]]>
  </point>
  <point name="input.a.xceadocno" order="" ver="5" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_xcea_m.xceald) AND NOT cl_null(g_xcea_m.xceadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xcea_m.xceald != g_xceald_t  OR g_xcea_m.xceadocno != g_xceadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xcea_t WHERE "||"xceaent = '" ||g_enterprise|| "' AND "||"xceald = '"||g_xcea_m.xceald ||"' AND "|| "xceadocno = '"||g_xcea_m.xceadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
                  IF NOT s_aooi200_fin_chk_docno(g_xcea_m.xceald,'','',g_xcea_m.xceadocno,g_xcea_m.xcea001,g_prog_name1) THEN
                     LET g_xcea_m.xceadocno = g_xceadocno_t
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            


]]>
  </point>
  <point name="input.a.xceald" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_xcea_m.xceald) AND NOT cl_null(g_xcea_m.xceadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_xcea_m.xceald != g_xceald_t  OR g_xcea_m.xceadocno != g_xceadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xcea_t WHERE "||"xceaent = '" ||g_enterprise|| "' AND "||"xceald = '"||g_xcea_m.xceald ||"' AND "|| "xceadocno = '"||g_xcea_m.xceadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            
            IF NOT cl_null(g_xcea_m.xceald) THEN
               #檢查是否存在 帳別資料檔 中
               IF NOT ap_chk_isExist(g_xcea_m.xceald,"SELECT COUNT(*) FROM glaa_t WHERE "||"glaaent = '" ||g_enterprise|| "' AND "||"glaald = ? ",'agl-00016',1) THEN
                  LET g_xcea_m.xceald = g_xceald_t
                  CALL axct701_01_get_xceald_desc()
                  CALL axct701_01_get_xceacomp_desc()                  
                  NEXT FIELD CURRENT
               END IF   
               
               #檢查是否 有效
               IF NOT ap_chk_isExist(g_xcea_m.xceald,"SELECT COUNT(*) FROM glaa_t WHERE "||"glaaent = '" ||g_enterprise|| "' AND "||"glaald = ? AND glaastus = 'Y'",'agl-00051',1) THEN
                  LET g_xcea_m.xceald = g_xceald_t
                  CALL axct701_01_get_xceald_desc()
                  CALL axct701_01_get_xceacomp_desc()                  
                  NEXT FIELD CURRENT
               END IF     
            END IF   
            
            IF NOT cl_null(g_xcea_m.xceald) THEN 
               CALL axct701_01_get_glaa()
            END IF 
            
            #默認帶出帳套歸屬法人
            IF NOT cl_null(g_xcea_m.xceald) THEN 
               CALL axct701_01_get_xceacomp()
            END IF
            #默認年度月份為當前成本計算年度期別
            IF NOT cl_null(g_xcea_m.xceacomp) THEN
               CALL cl_get_para(g_enterprise,g_xcea_m.xceacomp,'S-FIN-6010') RETURNING g_xcea_m.xcea004
               CALL cl_get_para(g_enterprise,g_xcea_m.xceacomp,'S-FIN-6011') RETURNING g_xcea_m.xcea005
               DISPLAY BY NAME g_xcea_m.xcea004,g_xcea_m.xcea005               
            END IF
            CALL axct701_01_get_xceald_desc()
            CALL axct701_01_get_xceacomp_desc()
]]>
  </point>
  <point name="input.action" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[  ]]>
  </point>
  <point name="input.after_input" order="" ver="8" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF INT_FLAG THEN
               RETURN '',''
            END IF
#检查成本计算类型，取消，关闭时不用检查，只有按确定才会检查
            IF NOT cl_null(g_xcea_m.xcea003) THEN 
               #檢查是否存在于 成本類型設置檔 中
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? ",'agl-00194',1) THEN
                  LET g_xcea_m.xcea003 = ''
                  CALL axct701_01_get_xcea003_desc()                  
                  NEXT FIELD xceald
               END IF
               
               #檢查是否 有效
               IF NOT ap_chk_isExist(g_xcea_m.xcea003,"SELECT COUNT(*) FROM xcat_t WHERE "||"xcatent = '" ||g_enterprise|| "' AND "||"xcat001 = ? AND xcatstus = 'Y' ",'agl-00195',1) THEN
                  LET g_xcea_m.xcea003 = ''
                  CALL axct701_01_get_xcea003_desc()                  
                  NEXT FIELD xceald
               END IF  
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'axc-00706'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()
               NEXT FIELD xceald            
            END IF]]>
  </point>
  <point name="input.before_input" order="" ver="8" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[            LET g_xcea_m.xceald = ''
            LET g_xcea_m.xceacomp = ''
            LET g_xcea_m.xcea003 = ''
            LET g_xcea_m.xcea004 = ''
            LET g_xcea_m.xcea005 = ''
            LET g_xcea_m.xceadocno = ''
            LET g_xcea_m.xcea001 = ''
            LET g_xcea_m.xcea006 = g_user
            LET g_xcea_m.xcea007 = g_dept
            LET g_xcea_m.xcea001 = g_today
            
            LET g_xcea_m.xcea006_desc = s_desc_get_person_desc(g_xcea_m.xcea006)
            LET g_xcea_m.xcea007_desc = s_desc_get_department_desc(g_xcea_m.xcea007)
            DISPLAY BY NAME g_xcea_m.xcea006_desc,g_xcea_m.xcea007_desc
            
            CALL s_axc_set_site_default() RETURNING g_xcea_m.xceacomp,g_xcea_m.xceald,g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea003
            DISPLAY BY NAME g_xcea_m.xcea004,g_xcea_m.xcea005,g_xcea_m.xcea001

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceacomp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceacomp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceacomp_desc 
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceald
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceald_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceald_desc 
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xcea003
            CALL ap_ref_array2(g_ref_fields,"SELECT xcatl003 FROM xcatl_t WHERE xcatlent='"||g_enterprise||"' AND xcatl001=? AND xcatl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xcea003_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xcea003_desc
   
   
            CASE g_xcea002
               WHEN '1' LET g_prog_name1 = 'axct701' 
               WHEN '2' LET g_prog_name1 = 'axct702'
               WHEN '3' LET g_prog_name1 = 'axct703'
               WHEN '4' LET g_prog_name1 = 'axct704' 
               WHEN '5' LET g_prog_name1 = 'axct705' 
               WHEN '6' LET g_prog_name1 = 'axct706' 
               WHEN '7' LET g_prog_name1 = 'axct707' 
               WHEN '8' LET g_prog_name1 = 'axct708'
               WHEN '9' LET g_prog_name1 = 'axct709'
               WHEN '10' LET g_prog_name1 = 'axct710'               
            END CASE
            CALL cl_set_comp_entry("xcea003",FALSE)]]>
  </point>
  <point name="input.c.xcea003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xcea003             #給予default值
            
            CALL q_xcat001()                                #呼叫開窗

            LET g_xcea_m.xcea003 = g_qryparam.return1              

            CALL axct701_01_get_xcea003_desc() 

            DISPLAY g_xcea_m.xcea003 TO xcea003              #
            DISPLAY g_xcea_m.xcea003_desc TO xcea003_desc

            NEXT FIELD xcea003                          #返回原欄位

]]>
  </point>
  <point name="input.c.xcea006" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xcea006             #給予default值

            IF NOT cl_null(g_xcea_m.xcea007) THEN
               LET g_qryparam.where = " ooag003 = '",g_xcea_m.xcea007,"'"
            END IF

            CALL q_ooag001()                                #呼叫開窗

            LET g_xcea_m.xcea006 = g_qryparam.return1              

            CALL s_desc_get_person_desc(g_xcea_m.xcea006) RETURNING g_xcea_m.xcea006_desc
            
            DISPLAY g_xcea_m.xcea006 TO xcea006              #
            DISPLAY g_xcea_m.xcea006_desc TO xcea006_desc 

            LET g_qryparam.where = '' 

            NEXT FIELD xcea006                          #返回原欄位

]]>
  </point>
  <point name="input.c.xcea007" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xcea007             #給予default值
 
            IF NOT cl_null(g_xcea_m.xcea006) THEN
               LET g_qryparam.where = " ooag001 = '",g_xcea_m.xcea006,"'"
               CALL q_ooag003_1()
            ELSE
               LET g_qryparam.arg1 = g_today  
               CALL q_ooeg001() 
            END IF  

            LET g_xcea_m.xcea007 = g_qryparam.return1              
 
            CALL s_desc_get_department_desc(g_xcea_m.xcea007) RETURNING g_xcea_m.xcea007_desc
            DISPLAY g_xcea_m.xcea007 TO xcea007              #
            DISPLAY g_xcea_m.xcea007_desc TO xcea007_desc  
            
            NEXT FIELD xcea007                          #返回原欄位

]]>
  </point>
  <point name="input.c.xceacomp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
#            INITIALIZE g_qryparam.* TO NULL
#            LET g_qryparam.state = 'i'
#            LET g_qryparam.reqry = FALSE
#
#            LET g_qryparam.default1 = g_xcea_m.xceacomp             #給予default值
#
#            #給予arg
#            LET g_qryparam.arg1 = "" #
#
#            
#            CALL q_ooef001_8()                                #呼叫開窗
#
#            LET g_xcea_m.xceacomp = g_qryparam.return1              
#
#            DISPLAY g_xcea_m.xceacomp TO xceacomp              #
#
#            NEXT FIELD xceacomp                          #返回原欄位

]]>
  </point>
  <point name="input.c.xceadocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xceadocno             #給予default值

            #給予arg
               
            LET g_qryparam.arg1 = g_glaa024
            LET g_qryparam.arg2 = g_prog_name1
            CALL q_ooba002_1()                                #呼叫開窗

            LET g_xcea_m.xceadocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_xcea_m.xceadocno TO xceadocno              #顯示到畫面上
            
            NEXT FIELD xceadocno ]]>
  </point>
  <point name="input.c.xceald" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xcea_m.xceald             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_user
            LET g_qryparam.arg2 = g_dept
            
            CALL q_authorised_ld()                                #呼叫開窗

            LET g_xcea_m.xceald = g_qryparam.return1              

            CALL axct701_01_get_xceald_desc()
            
            DISPLAY g_xcea_m.xceald TO xceald              #
            DISPLAY g_xcea_m.xceald_desc TO xceald_desc

            NEXT FIELD xceald                          #返回原欄位

]]>
  </point>
  <point name="input.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_success       LIKE type_t.chr1
   DEFINE l_n             LIKE type_t.chr5
   DEFINE p_xcea002       LIKE xcea_t.xcea002]]>
  </point>
  <point name="input.get_var" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   p_xcea002	]]>
  </point>
  <point name="input.post_input" order="" ver="8" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[   IF INT_FLAG THEN
      RETURN '',''
   END IF

   CALL s_transaction_begin()
   CALL cl_err_collect_init() #汇总错误讯息初始化
   CASE g_xcea002 
      WHEN '1'   #axct701
         CALL axct701_01_check('1') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins() RETURNING l_success
         END IF
      WHEN '2'   #axct702
         CALL axct701_01_check('2') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_2() RETURNING l_success
         END IF
      WHEN '3'   #axct703
         CALL axct701_01_check('3') RETURNING l_success
         IF l_success = TRUE THEN
            CALL axct701_01_ins_3() RETURNING l_success
         END IF
      WHEN '4'   #axct704
         CALL axct701_01_check('4') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_4() RETURNING l_success
         END IF
      WHEN '5'   #axct705
         CALL axct701_01_check('5') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_5() RETURNING l_success 
         END IF
      WHEN '6'   #axct706
         CALL axct701_01_check('6') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_6() RETURNING l_success             
         END IF
      WHEN '7'   #axct707
         CALL axct701_01_check('7') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_7() RETURNING l_success             
         END IF
      WHEN '8'   #axct708
         CALL axct701_01_check('8') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_8() RETURNING l_success             
         END IF
      WHEN '9'   #axct709
         CALL axct701_01_check('9') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_9() RETURNING l_success             
         END IF
      WHEN '10'  #axct710
         CALL axct701_01_check('10') RETURNING l_success
         IF l_success = TRUE THEN  
            CALL axct701_01_ins_10() RETURNING l_success             
         END IF
   END CASE

   CALL axct701_01_del_all() RETURNING l_success   #没有单身，则删除单头，同时提示无资料产生
   IF l_success = 'Y' THEN      
      CALL s_transaction_end('Y','0')
   ELSE
      CALL s_transaction_end('N','0')
   END IF
   CALL cl_err_collect_show()
   IF l_success = 'Y' THEN
      RETURN g_xcea_m.xceald,g_xcea_m.xceadocno
   ELSE
      RETURN '',''
   END IF]]>
  </point>
  <point name="input.pre_input" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   WHENEVER ERROR CALL cl_err_msg_log
   
   LET g_xcea002=p_xcea002]]>
  </point>
  <point name="show.head.reference" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceald
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceald_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceald_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xceacomp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xceacomp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xceacomp_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xcea003
            CALL ap_ref_array2(g_ref_fields,"SELECT xcatl003 FROM xcatl_t WHERE xcatlent='"||g_enterprise||"' AND xcatl001=? AND xcatl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xcea003_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xcea003_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xcea006
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_xcea_m.xcea006_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xcea006_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xcea_m.xcea007
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xcea_m.xcea007_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xcea_m.xcea007_desc
]]>
  </point>
  <section id="axct701_01.description" ver="91" status="" src="s" readonly="">
    <![CDATA[#應用 a00 樣板自動產生(Version:1)
#+ Version..: T100-ERP-1.00.00(SD版次:8,PR版次:8) Build-000228
#+ 
#+ Filename...: axct701_01
#+ Description: 資料批次產生
#+ Creator....: 01531(2014-04-16 09:46:52)
#+ Modifier...: 00537(2014-09-15 13:50:51) -SD/PR-
]]>
  </section>
  <section id="axct701_01.global" ver="5" status="" src="s" readonly="">
    <![CDATA[#應用 c01b 樣板自動產生(Version:5)
{<point name="global.memo" />}
 
IMPORT os
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔
{<point name="global.inc" />}
#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_xcea_m        RECORD
       xceald LIKE xcea_t.xceald, 
   xceald_desc LIKE type_t.chr80, 
   xceacomp LIKE xcea_t.xceacomp, 
   xceacomp_desc LIKE type_t.chr80, 
   xcea003 LIKE xcea_t.xcea003, 
   xcea003_desc LIKE type_t.chr80, 
   xcea004 LIKE xcea_t.xcea004, 
   xcea005 LIKE xcea_t.xcea005, 
   xceadocno LIKE xcea_t.xceadocno, 
   xcea001 LIKE xcea_t.xcea001, 
   xcea006 LIKE xcea_t.xcea006, 
   xcea006_desc LIKE type_t.chr80, 
   xcea007 LIKE xcea_t.xcea007, 
   xcea007_desc LIKE type_t.chr80
       END RECORD
DEFINE g_xcea_m        type_g_xcea_m
 
   DEFINE g_xceald_t LIKE xcea_t.xceald
DEFINE g_xceadocno_t LIKE xcea_t.xceadocno
 
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable" edit="s"/>}
#end add-point
 
#add-point:自定義客戶專用模組變數(Module Variable)
{<point name="global.variable_customerization" edit="c"/>}
#end add-point
 
#add-point:傳入參數說明(global.argv)
{<point name="global.argv"/>}
#end add-point
]]>
  </section>
  <section id="axct701_01.input" ver="5" status="" src="s" readonly="">
    <![CDATA[#+ 資料輸入
PUBLIC FUNCTION axct701_01(--)
   #add-point:input段變數傳入
   {<point name="input.get_var"/>}
   #end add-point
   )
   DEFINE l_ac_t          LIKE type_t.num10       #未取消的ARRAY CNT 
   DEFINE l_allow_insert  LIKE type_t.num5        #可新增否 
   DEFINE l_allow_delete  LIKE type_t.num5        #可刪除否  
   DEFINE l_count         LIKE type_t.num10
   DEFINE l_insert        LIKE type_t.num5
   DEFINE p_cmd           LIKE type_t.chr5
   #add-point:input段define
   {<point name="input.define" edit="s"/>}
   #end add-point
   #add-point:input段define
   {<point name="input.define_customerization" edit="c"/>}
   #end add-point
   
   #畫面開啟 (identifier)
   OPEN WINDOW w_axct701_01 WITH FORM cl_ap_formpath("axc","axct701_01")
 
   #瀏覽頁簽資料初始化
   CALL cl_ui_init()
   
   LET g_qryparam.state = "i"
   LET p_cmd = 'a'
   
   #輸入前處理
   #add-point:單頭前置處理
   {<point name="input.pre_input"/>}
   #end add-point
  
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
      #輸入開始
      INPUT BY NAME g_xcea_m.xceald,g_xcea_m.xceacomp,g_xcea_m.xcea003,g_xcea_m.xcea004,g_xcea_m.xcea005, 
          g_xcea_m.xceadocno,g_xcea_m.xcea001,g_xcea_m.xcea006,g_xcea_m.xcea007 ATTRIBUTE(WITHOUT DEFAULTS) 

         
         #自訂ACTION
         #add-point:單頭前置處理
         {<point name="input.action"/>}
         #end add-point
         
         #自訂ACTION(master_input)
         
         
         BEFORE INPUT
            #add-point:單頭輸入前處理
            {<point name="input.before_input"/>}
            #end add-point
          
                  #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xceald
            
            #add-point:AFTER FIELD xceald
            {<point name="input.a.xceald" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xceald
            #add-point:BEFORE FIELD xceald
            {<point name="input.b.xceald" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xceald
            #add-point:ON CHANGE xceald
            {<point name="input.g.xceald" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xceacomp
            
            #add-point:AFTER FIELD xceacomp
            {<point name="input.a.xceacomp" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xceacomp
            #add-point:BEFORE FIELD xceacomp
            {<point name="input.b.xceacomp" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xceacomp
            #add-point:ON CHANGE xceacomp
            {<point name="input.g.xceacomp" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xcea003
            
            #add-point:AFTER FIELD xcea003
            {<point name="input.a.xcea003" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xcea003
            #add-point:BEFORE FIELD xcea003
            {<point name="input.b.xcea003" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xcea003
            #add-point:ON CHANGE xcea003
            {<point name="input.g.xcea003" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xcea004
            #add-point:BEFORE FIELD xcea004
            {<point name="input.b.xcea004" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xcea004
            
            #add-point:AFTER FIELD xcea004
            {<point name="input.a.xcea004" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xcea004
            #add-point:ON CHANGE xcea004
            {<point name="input.g.xcea004" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xcea005
            #add-point:BEFORE FIELD xcea005
            {<point name="input.b.xcea005" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xcea005
            
            #add-point:AFTER FIELD xcea005
            {<point name="input.a.xcea005" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xcea005
            #add-point:ON CHANGE xcea005
            {<point name="input.g.xcea005" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xceadocno
            #add-point:BEFORE FIELD xceadocno
            {<point name="input.b.xceadocno" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xceadocno
            
            #add-point:AFTER FIELD xceadocno
            {<point name="input.a.xceadocno" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xceadocno
            #add-point:ON CHANGE xceadocno
            {<point name="input.g.xceadocno" />}
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xcea001
            #add-point:BEFORE FIELD xcea001
            {<point name="input.b.xcea001" />}
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xcea001
            
            #add-point:AFTER FIELD xcea001
            {<point name="input.a.xcea001" />}
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xcea001
            #add-point:ON CHANGE xcea001
            {<point name="input.g.xcea001" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xcea006
            
            #add-point:AFTER FIELD xcea006
            {<point name="input.a.xcea006" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xcea006
            #add-point:BEFORE FIELD xcea006
            {<point name="input.b.xcea006" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xcea006
            #add-point:ON CHANGE xcea006
            {<point name="input.g.xcea006" />}
            #END add-point 
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD xcea007
            
            #add-point:AFTER FIELD xcea007
            {<point name="input.a.xcea007" />}
            #END add-point
            
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD xcea007
            #add-point:BEFORE FIELD xcea007
            {<point name="input.b.xcea007" />}
            #END add-point
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE xcea007
            #add-point:ON CHANGE xcea007
            {<point name="input.g.xcea007" />}
            #END add-point 
 
 #欄位檢查
                  #Ctrlp:input.c.xceald
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xceald
            #add-point:ON ACTION controlp INFIELD xceald
            {<point name="input.c.xceald" />}
            #END add-point
 
         #Ctrlp:input.c.xceacomp
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xceacomp
            #add-point:ON ACTION controlp INFIELD xceacomp
            {<point name="input.c.xceacomp" />}
            #END add-point
 
         #Ctrlp:input.c.xcea003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xcea003
            #add-point:ON ACTION controlp INFIELD xcea003
            {<point name="input.c.xcea003" />}
            #END add-point
 
         #Ctrlp:input.c.xcea004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xcea004
            #add-point:ON ACTION controlp INFIELD xcea004
            {<point name="input.c.xcea004" />}
            #END add-point
 
         #Ctrlp:input.c.xcea005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xcea005
            #add-point:ON ACTION controlp INFIELD xcea005
            {<point name="input.c.xcea005" />}
            #END add-point
 
         #Ctrlp:input.c.xceadocno
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xceadocno
            #add-point:ON ACTION controlp INFIELD xceadocno
            {<point name="input.c.xceadocno" />}
            #END add-point
 
         #Ctrlp:input.c.xcea001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xcea001
            #add-point:ON ACTION controlp INFIELD xcea001
            {<point name="input.c.xcea001" />}
            #END add-point
 
         #Ctrlp:input.c.xcea006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xcea006
            #add-point:ON ACTION controlp INFIELD xcea006
            {<point name="input.c.xcea006" />}
            #END add-point
 
         #Ctrlp:input.c.xcea007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD xcea007
            #add-point:ON ACTION controlp INFIELD xcea007
            {<point name="input.c.xcea007" />}
            #END add-point
 
 #欄位開窗
 
         AFTER INPUT
            #add-point:單頭輸入後處理
            {<point name="input.after_input"/>}
            #end add-point
            
      END INPUT
    
      #add-point:自定義input
      {<point name="input.more_input"/>}
      #end add-point
    
      #公用action
      ON ACTION accept
         ACCEPT DIALOG
        
      ON ACTION cancel
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
 
   #add-point:畫面關閉前
   {<point name="input.before_close"/>}
   #end add-point
   
   #畫面關閉
   CLOSE WINDOW w_axct701_01 
   
   #add-point:input段after input 
   {<point name="input.post_input"/>}
   #end add-point    
   
END FUNCTION
]]>
  </section>
  <section id="axct701_01.other_dialog" ver="1" status="" src="s" readonly="">
    <![CDATA[{<point name="other.dialog"/>}
]]>
  </section>
  <section id="axct701_01.other_function" ver="1" status="" src="s" readonly="">
    <![CDATA[{<point name="other.function"/>}
]]>
  </section>
</add_points>
