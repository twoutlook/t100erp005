<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="aecm200" std_prog="aecm200" erpver="1.0" module="AEC" ver="3" env="s" zone="t10dev" booking="Y" type="M" identity="s">
  <other>
    <code_template value="F" status=""/>
    <free_style value="N" status=""/>
  </other>
  <point name="construct.c.ecba001" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_imaf001_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecba001  #顯示到畫面上

            NEXT FIELD ecba001                     #返回原欄位

]]>
  </point>
  <point name="construct.c.ecbacnfid" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbacnfid  #顯示到畫面上

            NEXT FIELD ecbacnfid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.ecbacrtdp" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooea001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbacrtdp  #顯示到畫面上

            NEXT FIELD ecbacrtdp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.ecbacrtid" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbacrtid  #顯示到畫面上

            NEXT FIELD ecbacrtid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.ecbamodid" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbamodid  #顯示到畫面上

            NEXT FIELD ecbamodid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.ecbaowndp" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooea001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbaowndp  #顯示到畫面上

            NEXT FIELD ecbaowndp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.ecbaownid" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbaownid  #顯示到畫面上

            NEXT FIELD ecbaownid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.ecbb004" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "221"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbb004  #顯示到畫面上

            NEXT FIELD ecbb004                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.ecbb008" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "221"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbb008  #顯示到畫面上

            NEXT FIELD ecbb008                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.ecbb010" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "221"
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbb010  #顯示到畫面上

            NEXT FIELD ecbb010                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.ecbb012" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ecaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbb012  #顯示到畫面上

            NEXT FIELD ecbb012                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.ecbb014" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = " ('1','3')"
            CALL q_pmaa001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbb014  #顯示到畫面上

            NEXT FIELD ecbb014                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.ecbb021" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbb021  #顯示到畫面上

            NEXT FIELD ecbb021                     #返回原欄位

]]>
  </point>
  <point name="input.a.ecba001" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            CALL aecm200_desc()
            IF NOT cl_null(g_ecba_m.ecba001) AND NOT cl_null(g_ecba_m.ecba002) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND ( p_cmd = 'u' AND (g_ecba_m.ecba001 != g_ecba001_t  OR g_ecba_m.ecba002 != g_ecba002_t ))) THEN 
                  IF NOT ap_chk_notDup(g_ecba_m.ecba001,"SELECT COUNT(*) FROM ecba_t WHERE "||"ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND "||"ecba001 = '"||g_ecba_m.ecba001 ||"' AND "|| "ecba002 = '"||g_ecba_m.ecba002 ||"'",'std-00004',0) THEN 
                     LET g_ecba_m.ecba001 = g_ecba_m_t.ecba001
                     CALL aecm200_desc()
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            IF NOT cl_null(g_ecba_m.ecba001) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_ecba_m.ecba001

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_imaf001_1") THEN
                  LET g_ecba_m.ecba001 = g_ecba_m_t.ecba001
                  CALL aecm200_desc()
                  NEXT FIELD ecba001
               END IF
            END IF
]]>
  </point>
  <point name="input.a.ecba002" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF NOT cl_null(g_ecba_m.ecba001) AND NOT cl_null(g_ecba_m.ecba002) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND ( p_cmd = 'u' AND (g_ecba_m.ecba001 != g_ecba001_t  OR g_ecba_m.ecba002 != g_ecba002_t ))) THEN 
                  IF NOT ap_chk_notDup(g_ecba_m.ecba002,"SELECT COUNT(*) FROM ecba_t WHERE "||"ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND "||"ecba001 = '"||g_ecba_m.ecba001 ||"' AND "|| "ecba002 = '"||g_ecba_m.ecba002 ||"'",'std-00004',0) THEN 
                     LET g_ecba_m.ecba002 = g_ecba_m_t.ecba002
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


]]>
  </point>
  <point name="input.a.page1.ecbb003" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF NOT cl_null(g_ecba_m.ecba001) AND NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND ( l_cmd = 'u' AND (g_ecba_m.ecba001 != g_ecba001_t OR g_ecba_m.ecba002 != g_ecba002_t OR g_ecbb_d[l_ac].ecbb003 != g_ecbb_d_t.ecbb003))) THEN 
                  IF NOT ap_chk_notDup(g_ecbb_d[l_ac].ecbb003,"SELECT COUNT(*) FROM ecbb_t WHERE "||"ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND "||"ecbb001 = '"||g_ecba_m.ecba001 ||"' AND "|| "ecbb002 = '"||g_ecba_m.ecba002 ||"' AND "|| "ecbb003 = '"||g_ecbb_d[l_ac].ecbb003 ||"'",'std-00004',0) THEN
                     LET g_ecbb_d[l_ac].ecbb003 = g_ecbb_d_t.ecbb003                  
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.ecbb004" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL aecm200_ecbb_desc()
            IF NOT cl_null(g_ecbb_d[l_ac].ecbb004) THEN
               CALL s_azzi650_chk_exist('221',g_ecbb_d[l_ac].ecbb004) RETURNING l_success
               IF NOT l_success THEN
                  LET g_ecbb_d[l_ac].ecbb004 = g_ecbb_d_t.ecbb004
                  CALL aecm200_ecbb_desc()
                  NEXT FIELD ecbb004
               END IF
               IF l_cmd = 'a' OR (l_cmd = 'u' AND g_ecbb_d[l_ac].ecbb004<>　g_ecbb_d_t.ecbb004) THEN
                  IF NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                     CALL aecm200_chk_ecbb004(l_cmd)
                     IF NOT cl_null(g_errno) THEN
                        CALL cl_err(g_ecbb_d[l_ac].ecbb004,g_errno,1)
                        LET g_ecbb_d[l_ac].ecbb004 = g_ecbb_d_t.ecbb004
                        CALL aecm200_ecbb_desc()
                        NEXT FIELD ecbb004
                     END IF
                  END IF
               END IF
               IF l_cmd = 'a' THEN
                  CALL aecm200_def_ecbb005()
               END IF
            END IF
]]>
  </point>
  <point name="input.a.page1.ecbb005" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN 
               IF l_cmd = 'a' OR (l_cmd = 'u' AND g_ecbb_d[l_ac].ecbb005<>　g_ecbb_d_t.ecbb005) THEN
                  IF NOT cl_null(g_ecbb_d[l_ac].ecbb004) THEN
                     CALL aecm200_chk_ecbb004(l_cmd)
                     IF NOT cl_null(g_errno) THEN
                        CALL cl_err(g_ecbb_d[l_ac].ecbb005,g_errno,1)
                        LET g_ecbb_d[l_ac].ecbb005 = g_ecbb_d_t.ecbb005
                        NEXT FIELD ecbb005
                     END IF
                  END IF
               END IF
            END IF 
            ]]>
  </point>
  <point name="input.a.page1.ecbb008" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL aecm200_ecbb_desc()
            IF NOT cl_null(g_ecbb_d[l_ac].ecbb008) THEN
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb009) THEN
                  CALL aecm200_chk_ecbb008(l_cmd)
                  IF NOT cl_null(g_errno) THEN
                     CALL cl_err(g_ecbb_d[l_ac].ecbb008,g_errno,1)
                     LET g_ecbb_d[l_ac].ecbb008 = g_ecbb_d_t.ecbb008
                     CALL aecm200_ecbb_desc()
                     NEXT FIELD ecbb008
                  END IF
               END IF
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb004) AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) AND NOT cl_null(g_ecbb_d[l_ac].ecbb008) AND NOT cl_null(g_ecbb_d[l_ac].ecbb009) THEN
                  IF g_ecbb_d[l_ac].ecbb008 = g_ecbb_d[l_ac].ecbb004 AND g_ecbb_d[l_ac].ecbb009 = g_ecbb_d[l_ac].ecbb005 THEN
                     CALL cl_err(g_ecbb_d[l_ac].ecbb008,'aec-00008',1)
                     LET g_ecbb_d[l_ac].ecbb008 = g_ecbb_d_t.ecbb008
                     CALL aecm200_ecbb_desc()
                     NEXT FIELD ecbb008
                  END IF
               END IF
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004) AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) AND g_ecbb_d[l_ac].ecbb008 = 'MULT' THEN
                  CALL aecm200_01(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'Y','Y')
               END IF
            END IF
            CALL aecm200_set_entry_b(l_cmd)
            CALL aecm200_set_no_entry_b(l_cmd)]]>
  </point>
  <point name="input.a.page1.ecbb010" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_ecbb_d[l_ac].ecbb010
            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_ecbb_d[l_ac].ecbb010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_ecbb_d[l_ac].ecbb010_desc
]]>
  </point>
  <point name="input.a.page1.ecbb012" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL aecm200_ecbb_desc()
            IF NOT cl_null(g_ecbb_d[l_ac].ecbb012) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_ecbb_d[l_ac].ecbb012

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_ecaa001_1") THEN
                  LET g_ecbb_d[l_ac].ecbb012 = g_ecbb_d_t.ecbb012
                  CALL aecm200_ecbb_desc()
                  NEXT FIELD ecbb012
               END IF
               
            END IF
]]>
  </point>
  <point name="input.a.page1.ecbb014" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            
            CALL aecm200_ecbb_desc()
            IF NOT cl_null(g_ecbb_d[l_ac].ecbb014) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_ecbb_d[l_ac].ecbb014

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_pmaa001_1") THEN
                  LET g_ecbb_d[l_ac].ecbb014 = g_ecbb_d_t.ecbb014
                  CALL aecm200_ecbb_desc()
                  NEXT FIELD ecbb014
               END IF
               
            END IF]]>
  </point>
  <point name="input.a.page1.ecbb022" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb022) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb023" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb023) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb024" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb024) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb025" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb025) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb026" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb026) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb027" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb027) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb028" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb028) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb029" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb029) THEN 
            END IF 
]]>
  </point>
  <point name="input.c.ecba001" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_ecba_m.ecba001             #給予default值

            #給予arg

            CALL q_imaf001_6()                                #呼叫開窗

            LET g_ecba_m.ecba001 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_ecba_m.ecba001 TO ecba001              #顯示到畫面上
            CALL aecm200_desc()
            NEXT FIELD ecba001                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.ecbb004" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_ecbb_d[l_ac].ecbb004             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "221" #

            CALL q_oocq002()                                #呼叫開窗

            LET g_ecbb_d[l_ac].ecbb004 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_ecbb_d[l_ac].ecbb004 TO ecbb004              #顯示到畫面上
            CALL aecm200_ecbb_desc()
            NEXT FIELD ecbb004                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.ecbb008" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_ecbb_d[l_ac].ecbb008             #給予default值

            #給予arg
            LET g_qryparam.where = " ecbb001 = '",g_ecba_m.ecba001,"' AND ecbb002 = '",g_ecba_m.ecba002,"' "
            CALL q_ecbb004()                                #呼叫開窗

            LET g_ecbb_d[l_ac].ecbb008 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_ecbb_d[l_ac].ecbb009 = g_qryparam.return2
            DISPLAY g_ecbb_d[l_ac].ecbb008 TO ecbb008              #顯示到畫面上
            DISPLAY g_ecbb_d[l_ac].ecbb009 TO ecbb009  
            CALL aecm200_ecbb_desc()
            LET g_qryparam.where = ""
            NEXT FIELD ecbb008                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.ecbb012" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_ecbb_d[l_ac].ecbb012             #給予default值

            #給予arg

            CALL q_ecaa001_1()                                #呼叫開窗

            LET g_ecbb_d[l_ac].ecbb012 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_ecbb_d[l_ac].ecbb012 TO ecbb012              #顯示到畫面上
            CALL aecm200_ecbb_desc()
            NEXT FIELD ecbb012                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.ecbb014" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_ecbb_d[l_ac].ecbb014             #給予default值

            #給予arg
            LET g_qryparam.arg1 = " ('1','3')" #交易對象類型

            CALL q_pmaa001_1()                                #呼叫開窗

            LET g_ecbb_d[l_ac].ecbb014 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_ecbb_d[l_ac].ecbb014 TO ecbb014              #顯示到畫面上
            CALL aecm200_ecbb_desc()
            NEXT FIELD ecbb014                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.ecbb021" order="0" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_ecbb_d[l_ac].ecbb021             #給予default值

            #給予arg

            CALL q_ooca001()                                #呼叫開窗

            LET g_ecbb_d[l_ac].ecbb021 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_ecbb_d[l_ac].ecbb021 TO ecbb021              #顯示到畫面上

            NEXT FIELD ecbb021                          #返回原欄位

]]>
  </point>
  <point name="function.aecm200_b_fill_2" order="1" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+單身3填充
PRIVATE FUNCTION aecm200_b_fill_2()
 
   IF l_ac = 0 OR cl_null(l_ac) THEN
      RETURN
   END IF
   IF l_ac1 = 0 OR cl_null(l_ac1) THEN
      RETURN
   END IF
   CALL g_ecbb3_d.clear()
   IF cl_null(g_ecbb2_d[l_ac1].ecbc004) THEN
      CALL g_ecbb2_d.deleteElement(l_ac1)
      RETURN
   END IF
   LET g_sql = "SELECT UNIQUE ecbd005,ecbd006,ecbd007,ecbd008 ",
               "  FROM ecbd_t",   
               " WHERE ecbdent=? AND ecbdsite=? AND ecbd001=? AND ecbd002=? AND ecbd003 = ? AND ecbd004 = ? "
   
   IF NOT cl_null(g_wc4_table1) THEN
      LET g_sql = g_sql CLIPPED, " AND ", g_wc4_table1 CLIPPED
   END IF
   
   LET g_sql = g_sql, " ORDER BY ecbd_t.ecbd005"
   
   PREPARE aecm200_pb2 FROM g_sql
   DECLARE b_fill_cs2 CURSOR FOR aecm200_pb2
   
   LET g_cnt = l_ac2
   LET l_ac2 = 1
   
   OPEN b_fill_cs2 USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004
                                           
   FOREACH b_fill_cs2 INTO g_ecbb3_d[l_ac2].ecbd005,g_ecbb3_d[l_ac2].ecbd006,g_ecbb3_d[l_ac2].ecbd007,g_ecbb3_d[l_ac2].ecbd008
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF
   
      LET l_ac2 = l_ac2 + 1
      IF l_ac2 > g_max_rec AND g_error_show = 1 THEN
         CALL cl_err( '', 9035, 1)
         EXIT FOREACH
      END IF
   END FOREACH
   LET g_error_show = 0
   
   CALL g_ecbb3_d.deleteElement(g_ecbb3_d.getLength())

   

   LET l_ac2 = g_cnt
   LET g_cnt = 0  
   
   FREE aecm200_pb2
END FUNCTION]]>
  </point>
  <point name="function.aecm200_chk_ecbc009" order="2" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#用量單位檢查
PRIVATE FUNCTION aecm200_chk_ecbc009()
DEFINE l_imaa006               LIKE imaa_t.imaa006
DEFINE r_success               LIKE type_t.num5
DEFINE r_rate                  LIKE type_t.num26_10


    LET g_errno = ''
    LET r_rate = ''
    LET l_imaa006 = ''
    IF NOT cl_null(g_ecbb2_d[l_ac1].ecbc009) THEN
       SELECT imaa006 INTO l_imaa006
         FROM imaa_t
        WHERE imaaent = g_enterprise
          AND imaa001 = g_ecbb2_d[l_ac1].ecbc005
        IF NOT cl_null(g_ecbb2_d[l_ac1].ecbc009) AND NOT cl_null(l_imaa006) THEN
           CALL s_aimi190_get_convert(g_ecbb2_d[l_ac1].ecbc005,g_ecbb2_d[l_ac1].ecbc009,l_imaa006) RETURNING r_success,r_rate
           IF NOT r_success THEN
              RETURN FALSE
           END IF
        END IF
        IF cl_null(l_imaa006) THEN
           LET g_errno = 'abm-00021'
           RETURN FALSE
        END IF
    END IF
    RETURN TRUE
    
END FUNCTION]]>
  </point>
  <point name="function.aecm200_ecbc_desc" order="3" ver="2" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+單身2參考欄位顯示
PRIVATE FUNCTION aecm200_ecbc_desc()
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb2_d[l_ac1].ecbc005
   CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb2_d[l_ac1].ecbc005_desc = g_rtn_fields[1]
   LET g_ecbb2_d[l_ac1].ecbc005_desc1 = g_rtn_fields[2]
   DISPLAY BY NAME g_ecbb2_d[l_ac1].ecbc005_desc
   DISPLAY BY NAME g_ecbb2_d[l_ac1].ecbc005_desc1

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb2_d[l_ac1].ecbc006
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001 = '215' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb2_d[l_ac1].ecbc006_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_ecbb2_d[l_ac1].ecbc006_desc
END FUNCTION]]>
  </point>
  <point name="function.aecm200_b_fill_1" order="4" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+單身2填充
PRIVATE FUNCTION aecm200_b_fill_1()
   
   IF l_ac = 0 OR cl_null(l_ac) THEN
      RETURN
   END IF
   CALL g_ecbb2_d.clear()
   IF cl_null(g_ecbb_d[l_ac].ecbb003) THEN
      CALL g_ecbb_d.deleteElement(l_ac)
      RETURN
   END IF
   LET g_sql = "SELECT UNIQUE ecbc004,ecbc005,'','',ecbc006,'',ecbc007,ecbc008,ecbc009,ecbc010 ",
               "  FROM ecbc_t",   
               " WHERE ecbcent=? AND ecbcsite=? AND ecbc001=? AND ecbc002=? AND ecbc003 = ?"
   
   IF NOT cl_null(g_wc3_table1) THEN
      LET g_sql = g_sql CLIPPED, " AND ", g_wc3_table1 CLIPPED
   END IF
   
   LET g_sql = g_sql, " ORDER BY ecbc_t.ecbc004"
   
   PREPARE aecm200_pb1 FROM g_sql
   DECLARE b_fill_cs1 CURSOR FOR aecm200_pb1
   
   LET g_cnt = l_ac1
   LET l_ac1 = 1
   
   OPEN b_fill_cs1 USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003
                                           
   FOREACH b_fill_cs1 INTO g_ecbb2_d[l_ac1].ecbc004,g_ecbb2_d[l_ac1].ecbc005,g_ecbb2_d[l_ac1].ecbc005_desc,g_ecbb2_d[l_ac1].ecbc005_desc1,g_ecbb2_d[l_ac1].ecbc006,g_ecbb2_d[l_ac1].ecbc006_desc,g_ecbb2_d[l_ac1].ecbc007,g_ecbb2_d[l_ac1].ecbc008,g_ecbb2_d[l_ac1].ecbc009,g_ecbb2_d[l_ac1].ecbc010
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF
      CALL aecm200_ecbc_desc()
      LET l_ac1 = l_ac1 + 1
      IF l_ac1 > g_max_rec AND g_error_show = 1 THEN
         CALL cl_err( '', 9035, 1)
         EXIT FOREACH
      END IF
   END FOREACH
   LET g_error_show = 0
   
   CALL g_ecbb2_d.deleteElement(g_ecbb2_d.getLength())

   

   LET l_ac1 = g_cnt
   LET g_cnt = 0  
   
   FREE aecm200_pb1
   
END FUNCTION]]>
  </point>
  <point name="function.aecm200_chk_ecbd005" order="5" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#起始截止數量檢查
PRIVATE FUNCTION aecm200_chk_ecbd005(p_qty,p_type,p_cmd)
DEFINE l_n         LIKE type_t.num5
DEFINE l_sql       STRING
DEFINE p_qty       LIKE ecbd_t.ecbd005
DEFINE p_type      LIKE type_t.chr1     #1.ecbd005 2.ecbd006
DEFINE p_cmd       LIKE type_t.chr1
DEFINE l_ecbd005   LIKE ecbd_t.ecbd005
DEFINE l_ecbd006   LIKE ecbd_t.ecbd006

   LET g_errno = ""
   IF cl_null(l_ac) OR l_ac = 0 THEN RETURN END IF
   IF cl_null(l_ac1) OR l_ac1 = 0 THEN RETURN END IF
   
   IF p_cmd = 'a' THEN
      LET l_sql = " SELECT ecbd005,ecbd006 ",
                  "   FROM ecbd_t",
                  "  WHERE ecbdent = '",g_enterprise,"' ",
                  "    AND ecbdsite = '",g_site,"' ",
                  "    AND ecbd001 = '",g_ecba_m.ecba001,"' ",
                  "    AND ecbd002 = '",g_ecba_m.ecba002,"' ",
                  "    AND ecbd003 = '",g_ecbb_d[l_ac].ecbb003,"'",
                  "    AND ecbd004 = '",g_ecbb2_d[l_ac1].ecbc004,"'"
   ELSE
      LET l_sql = " SELECT ecbd005,ecbd006",
                  "   FROM ecbd_t",
                  "  WHERE ecbdent = '",g_enterprise,"' ",
                  "    AND ecbdsite = '",g_site,"' ",
                  "    AND ecbd001 = '",g_ecba_m.ecba001,"' ",
                  "    AND ecbd002 = '",g_ecba_m.ecba002,"' ",
                  "    AND ecbd003 = '",g_ecbb_d[l_ac].ecbb003,"'",
                  "    AND ecbd004 = '",g_ecbb2_d[l_ac1].ecbc004,"'",
                  "    AND ecbd005 <> '",g_ecbb3_d_t.ecbd005,"'"
   END IF
   PREPARE aecm200_chk_ecbd005_pb FROM l_sql
   DECLARE aecm200_chk_ecbd005_cs CURSOR FOR aecm200_chk_ecbd005_pb
   FOREACH aecm200_chk_ecbd005_cs INTO l_ecbd005,l_ecbd006
      #--当笔输入的值不能再其他笔起止数量范围内
      #当笔输入的值不能在其他笔数量范围内
      IF NOT cl_null(l_ecbd006) AND (p_qty >= l_ecbd005 AND p_qty <= l_ecbd006) THEN
         LET g_errno = 'aec-00004'
         RETURN
      END IF
      #当笔输入的值不能在其他笔无穷大范围内
      IF cl_null(l_ecbd006) AND p_qty >= l_ecbd005 THEN
         LET g_errno = 'aec-00004'
         RETURN
      END IF
      CASE p_type
         WHEN '1'   #ecbd005
              #--当笔输入的范围，不能包含到其他笔的起止数量
              IF p_qty <= l_ecbd005 AND NOT cl_null(g_ecbb3_d[l_ac2].ecbd006) AND g_ecbb3_d[l_ac2].ecbd006 >= l_ecbd006 THEN
                 LET g_errno = 'aec-00004'
                 RETURN
              END IF
         WHEN '2'   #ecbd006
              #--当笔输入的范围，不能包含到其他笔的起止数量
              IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) AND g_ecbb3_d[l_ac2].ecbd005 <= l_ecbd005 AND p_qty >= l_ecbd006 THEN
                 LET g_errno = 'aec-00004'
                 RETURN
              END IF
              #当笔输入无穷大的，需检查当笔输入的起始数量，不可小于其他笔截止数量
              IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) AND cl_null(p_qty) AND g_ecbb3_d[l_ac2].ecbd005 <= l_ecbd006 THEN
                 LET g_errno = 'aec-00004'
                 RETURN
              END IF
              #当笔输入无穷大的，需检查其他笔没有无穷大的（不可出现两个无穷大的）
              IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) AND cl_null(p_qty) AND cl_null(l_ecbd006) THEN
                 LET g_errno = 'aec-00004'
                 RETURN
              END IF
      END CASE
   END FOREACH
END FUNCTION]]>
  </point>
  <point name="function.aecm200_def_ecbd005" order="6" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#起始數量預設值
PRIVATE FUNCTION aecm200_def_ecbd005()
DEFINE l_n          LIKE type_t.num5
DEFINE i            LIKE type_t.num5
DEFINE l_imae016    LIKE imae_t.imae016
DEFINE l_ooca002    LIKE ooca_t.ooca002
DEFINE l_ecbd006    LIKE ecbd_t.ecbd006
DEFINE l_str        STRING
DEFINE l_num        LIKE type_t.num5
            
   LET l_n = 0
   IF cl_null(l_ac) OR l_ac = 0 THEN RETURN END IF
   IF cl_null(l_ac1) OR l_ac1 = 0 THEN RETURN END IF
   SELECT COUNT(*) INTO l_n 
     FROM ecbd_t
    WHERE ecbdent = g_enterprise
      AND ecbdsite = g_site
      AND ecbd001 = g_ecba_m.ecba001
      AND ecbd002 = g_ecba_m.ecba002
      AND ecbd003 = g_ecbb_d[l_ac].ecbb003
      AND ecbd004 = g_ecbb2_d[l_ac1].ecbc004
   IF l_n = 0 THEN
      LET g_ecbb3_d[l_ac2].ecbd005 = 0
   ELSE
      SELECT imae016 INTO l_imae016
        FROM imae_t
       WHERE imaeent = g_enterprise
         AND imaesite = g_site
         AND imae001 = g_ecbb2_d[l_ac1].ecbc005
      IF cl_null(l_imae016) THEN
         LET l_ooca002 = 0
         LET l_num = 0
      ELSE
         SELECT ooca002 INTO l_ooca002
           FROM ooca_t
          WHERE oocaent = g_enterprise
            AND ooca001 = l_imae016
         IF cl_null(l_ooca002) THEN
            LET l_ooca002 = 0
            LET l_num = 0
         END IF
      END IF
      IF l_ooca002 = 1 THEN
         LET l_num = 0.1
      END IF
      IF l_ooca002 = 2 THEN
         LET l_num = 0.01
      END IF
      IF l_ooca002 > 2 THEN
         LET l_str = '0'
         FOR i=1 TO l_ooca002 -2
             LET l_str = '0',l_str
         END FOR
         LET l_str = '0.',l_str,'1'
         LET l_num = l_str
      END IF
      SELECT MAX(ecbd006) INTO l_ecbd006
        FROM ecbd_t
       WHERE ecbdent = g_enterprise
         AND ecbdsite = g_site
         AND ecbd001 = g_ecba_m.ecba001
         AND ecbd002 = g_ecba_m.ecba002
         AND ecbd003 = g_ecbb_d[l_ac].ecbb003
         AND ecbd004 = g_ecbb2_d[l_ac1].ecbc004
      IF NOT cl_null(l_ecbd006) THEN
         LET g_ecbb3_d[l_ac2].ecbd005 = l_ecbd006 + l_num +1
      END IF
   END IF
   DISPLAY BY NAME g_ecbb3_d[l_ac2].ecbd005
END FUNCTION]]>
  </point>
  <point name="function.aecm200_ecbb_desc" order="7" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+單身1參考欄位顯示
PRIVATE FUNCTION aecm200_ecbb_desc()
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb_d[l_ac].ecbb004
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001 = '221' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb_d[l_ac].ecbb004_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_ecbb_d[l_ac].ecbb004_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb_d[l_ac].ecbb008
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001 = '221' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb_d[l_ac].ecbb008_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_ecbb_d[l_ac].ecbb008_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb_d[l_ac].ecbb010
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001 = '221' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb_d[l_ac].ecbb010_desc = g_rtn_fields[1] 
   DISPLAY BY NAME g_ecbb_d[l_ac].ecbb010_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb_d[l_ac].ecbb012
   CALL ap_ref_array2(g_ref_fields,"SELECT ecaa002 FROM ecaa_t WHERE ecaaent='"||g_enterprise||"' AND ecaasite='"||g_site||"' AND ecaa001=? ","") RETURNING g_rtn_fields
   LET g_ecbb_d[l_ac].ecbb012_desc = g_rtn_fields[1] 
   DISPLAY BY NAME g_ecbb_d[l_ac].ecbb012_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb_d[l_ac].ecbb014
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb_d[l_ac].ecbb014_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_ecbb_d[l_ac].ecbb014_desc
   
   IF NOT cl_null(g_ecbb_d[l_ac].ecbb003) THEN
      CALL s_aooi360_sel('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,'','','','','','','4') RETURNING l_success,g_ecbb_d[l_ac].ooff013
   END IF   
      
END FUNCTION]]>
  </point>
  <point name="function.aecm200_desc" order="8" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+單頭參考欄位顯示
PRIVATE FUNCTION aecm200_desc()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecba_m.ecba001
   CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecba_m.ecba001_desc = g_rtn_fields[1]
   LET g_ecba_m.ecba001_desc1 = g_rtn_fields[2]
   DISPLAY BY NAME g_ecba_m.ecba001_desc
   DISPLAY BY NAME g_ecba_m.ecba001_desc1
   
   IF NOT cl_null(g_ecba_m.ecba001) AND NOT cl_null(g_ecba_m.ecba002) THEN
      CALL s_aooi360_sel('6',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,'','','','','','','','4') RETURNING l_success,g_ecba_m.ooeb013
      DISPLAY BY NAME g_ecba_m.ooeb013
   END IF
END FUNCTION]]>
  </point>
  <point name="function.aecm200_def_ecbc009" order="9" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+用量單位賦值
PRIVATE FUNCTION aecm200_def_ecbc009()
   SELECT imaa006 INTO  g_ecbb2_d[l_ac1].ecbc009
     FROM imaa_t
    WHERE imaaent = g_enterprise
      AND imaa001 = g_ecbb2_d[l_ac1].ecbc005
   DISPLAY BY NAME  g_ecbb2_d[l_ac1].ecbc009
END FUNCTION]]>
  </point>
  <point name="function.aecm200_chk_ecbb004" order="10" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+本站作業+制程序不可以重複
PRIVATE FUNCTION aecm200_chk_ecbb004(p_cmd)
DEFINE p_cmd    LIKE type_t.chr1
DEFINE l_n      LIKE type_t.num5

   LET g_errno = ""
   LET l_n = 0
   IF p_cmd = 'a' THEN
      SELECT COUNT(*) INTO l_n
        FROM ecbb_t
       WHERE ecbbent = g_enterprise
         AND ecbbsite = g_site
         AND ecbb001 = g_ecba_m.ecba001
         AND ecbb002 = g_ecba_m.ecba002
         AND ecbb004 = g_ecbb_d[l_ac].ecbb004
         AND ecbb005 = g_ecbb_d[l_ac].ecbb005
   ELSE
      SELECT COUNT(*) INTO l_n
        FROM ecbb_t
       WHERE ecbbent = g_enterprise
         AND ecbbsite = g_site
         AND ecbb001 = g_ecba_m.ecba001
         AND ecbb002 = g_ecba_m.ecba002
         AND ecbb004 = g_ecbb_d[l_ac].ecbb004
         AND ecbb005 = g_ecbb_d[l_ac].ecbb005
         AND ecbb003 <> g_ecbb_d_t.ecbb003
   END IF
   IF l_n > 0 THEN
      LET g_errno = 'aec-00006'
   END IF
END FUNCTION]]>
  </point>
  <point name="function.aecm200_def_ecbb005" order="11" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+制程序賦值
PRIVATE FUNCTION aecm200_def_ecbb005()
DEFINE l_ecbb005    LIKE ecbb_t.ecbb005
DEFINE l_ecbb005_1  LIKE type_t.num5

   SELECT MAX(ecbb005) INTO l_ecbb005
     FROM ecbb_t
    WHERE ecbbent = g_enterprise
      AND ecbbsite = g_site
      AND ecbb001 = g_ecba_m.ecba001
      AND ecbb002 = g_ecba_m.ecba002
      AND ecbb004 = g_ecbb_d[l_ac].ecbb004
   LET l_ecbb005_1 = l_ecbb005
   LET l_ecbb005_1 = l_ecbb005_1 +1
   LET g_ecbb_d[l_ac].ecbb005 = l_ecbb005_1
   IF cl_null(g_ecbb_d[l_ac].ecbb005) THEN
      LET g_ecbb_d[l_ac].ecbb005 = 1
   END IF
   DISPLAY BY NAME g_ecbb_d[l_ac].ecbb005
END FUNCTION]]>
  </point>
  <point name="function.aecm200_chk_ecbb008" order="12" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#+上站作業+上站制程序檢查
PRIVATE FUNCTION aecm200_chk_ecbb008(p_cmd)
DEFINE l_n         LIKE type_t.num5
DEFINE p_cmd       LIKE type_t.chr1

   LET g_errno = ""
   IF g_ecbb_d[l_ac].ecbb008 = 'INIT' OR g_ecbb_d[l_ac].ecbb008 = 'MULT' THEN
      RETURN
   END IF
   LET l_n = 0
   SELECT COUNT(*) INTO l_n
     FROM ecbb_t
    WHERE ecbbent = g_enterprise
      AND ecbbsite = g_site
      AND ecbb001 = g_ecba_m.ecba001
      AND ecbb002 = g_ecba_m.ecba002
      AND ecbb007 = g_ecbb_d[l_ac].ecbb008
   IF l_n > 0 THEN
      RETURN
   END IF
   LET l_n = 0
   IF p_cmd = 'a' THEN
      SELECT COUNT(*) INTO l_n
        FROM ecbb_t
       WHERE ecbbent = g_enterprise
         AND ecbbsite = g_site
         AND ecbb001 = g_ecba_m.ecba001
         AND ecbb002 = g_ecba_m.ecba002
         AND ecbb004 = g_ecbb_d[l_ac].ecbb008
         AND ecbb005 = g_ecbb_d[l_ac].ecbb009
   ELSE
      SELECT COUNT(*) INTO l_n
        FROM ecbb_t
       WHERE ecbbent = g_enterprise
         AND ecbbsite = g_site
         AND ecbb001 = g_ecba_m.ecba001
         AND ecbb002 = g_ecba_m.ecba002
         AND ecbb004 = g_ecbb_d[l_ac].ecbb008
         AND ecbb005 = g_ecbb_d[l_ac].ecbb009
         AND ecbb003 <> g_ecbb_d[l_ac].ecbb003
   END IF   
   IF l_n = 0 THEN
      LET g_errno = 'aec-00007'
   END IF
END FUNCTION]]>
  </point>
  <point name="function.aecm200_return_ecbb" order="13" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 回寫下站作業+下站制程序
# Memo...........:
# Usage..........: CALL aecm200_return_ecbb(p_ecbb008,p_ecbb009)
# Input parameter: p_ecbb008 上站作業
#................: p_ecbb009 上站制程序
# Return code....: 無
# Date & Author..: 2013/10/29 BY xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_return_ecbb(p_ecbb008,p_ecbb009)
DEFINE p_ecbb008    LIKE ecbb_t.ecbb008
DEFINE p_ecbb009    LIKE ecbb_t.ecbb009
DEFINE l_n          LIKE type_t.num5
DEFINE l_ecbb007    LIKE ecbb_t.ecbb007
DEFINE l_tot        LIKE type_t.num5
DEFINE l_n1         LIKE type_t.num5

   #計算多上站資料有幾筆相同的上站作業+製程序
   LET l_tot = 0
   SELECT COUNT(*) INTO l_tot FROM ecbe_t
    WHERE ecbeent = g_enterprise
      AND ecbesite = g_site
      AND ecbe001 = g_ecba_m.ecba001
      AND ecbe002 = g_ecba_m.ecba002
      AND ecbe004 = p_ecbb008
      AND ecbe005 = p_ecbb009
         
      
   CASE 
      #兩筆以上時，本站作業+製程序=p_ecbb008+p_ecbb009的下站作業+製程序更新為MULT+0
      WHEN l_tot > 1   
           LET l_n = 0
           LET l_n1 = 0
           SELECT COUNT(DISTINCT ecbb007),COUNT(ecbb007) INTO l_n,l_n1
             FROM ecbb_t
            WHERE ecbbent = g_enterprise
              AND ecbbsite = g_site
              AND ecbb001 = g_ecba_m.ecba001
              AND ecbb002 = g_ecba_m.ecba002
              AND ecbb004 = p_ecbb008
              AND ecbb005 = p_ecbb009
              AND ecbb007 IS  NOT NULL
           IF l_n > 1 OR l_n1 <> l_tot THEN
              UPDATE ecbb_t SET ecbb010 = 'MULT',
                                ecbb011 = 0
               WHERE ecbbent = g_enterprise
                 AND ecbbsite = g_site
                 AND ecbb001 = g_ecba_m.ecba001
                 AND ecbb002 = g_ecba_m.ecba002
                 AND ecbb004 = p_ecbb008
                 AND ecbb005 = p_ecbb009
           ELSE
              UPDATE ecbb_t SET ecbb010 = g_ecbb_d[l_ac].ecbb007,          
                                ecbb011 = g_ecbb_d[l_ac].ecbb005
               WHERE ecbbent = g_enterprise
                 AND ecbbsite = g_site
                 AND ecbb001 = g_ecba_m.ecba001
                 AND ecbb002 = g_ecba_m.ecba002
                 AND ecbb004 = p_ecbb008
                 AND ecbb005 = p_ecbb009
           END IF
           IF SQLCA.sqlcode THEN
              CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
              CALL s_transaction_end('N','0')
           END IF
      #只有一筆時，本站作業+製程序=p_ecbb008+p_ecbb009的資料更新下站作業+製程序
      WHEN l_tot = 1
           IF NOT cl_null(g_ecbb_d[l_ac].ecbb007) THEN
              #維護群組
              #更新上站作業+上站制程序且無維護群組或群組不一樣的資料對應下站程序+下站制程序為本資料的群組+本站  
              UPDATE ecbb_t SET ecbb010 = g_ecbb_d[l_ac].ecbb007,          
                                ecbb011 = 0
               WHERE ecbbent = g_enterprise
                 AND ecbbsite = g_site
                 AND ecbb001 = g_ecba_m.ecba001
                 AND ecbb002 = g_ecba_m.ecba002
                 AND ecbb004 = p_ecbb008
                 AND ecbb005 = p_ecbb009
                 AND (ecbb007 IS NULL OR ecbb007 <> g_ecbb_d[l_ac].ecbb007)
              IF SQLCA.sqlcode THEN
                 CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                 CALL s_transaction_end('N','0')
              END IF
              #更新上站作業+上站制程序且有維護群組(相同群組)的資料對應下站程序+下站制程序為本資料的本站程序+本站制程序
              UPDATE ecbb_t SET ecbb010 = g_ecbb_d[l_ac].ecbb004,          
                                ecbb011 = g_ecbb_d[l_ac].ecbb005
               WHERE ecbbent = g_enterprise
                 AND ecbbsite = g_site
                 AND ecbb001 = g_ecba_m.ecba001
                 AND ecbb002 = g_ecba_m.ecba002
                 AND ecbb004 = p_ecbb008
                 AND ecbb005 = p_ecbb009
                 AND ecbb007 = g_ecbb_d[l_ac].ecbb007
              IF SQLCA.sqlcode THEN
                 CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                 CALL s_transaction_end('N','0')
              END IF
           ELSE
              #無維護群組
              #更新上站作業+上站制程序對應下站程序+下站制程序為本資料的本站程序+本站制程序
              UPDATE ecbb_t SET ecbb010 = g_ecbb_d[l_ac].ecbb004,          
                                ecbb011 = g_ecbb_d[l_ac].ecbb005
               WHERE ecbbent = g_enterprise
                 AND ecbbsite = g_site
                 AND ecbb001 = g_ecba_m.ecba001
                 AND ecbb002 = g_ecba_m.ecba002
                 AND ecbb004 = p_ecbb008
                 AND ecbb005 = p_ecbb009
              IF SQLCA.sqlcode THEN
                 CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                 CALL s_transaction_end('N','0')
              END IF
           END IF
           #若p_ecbb008為群組
           LET l_n = 0
           SELECT COUNT(*) INTO l_n FROM ecbb_t
            WHERE ecbbent = g_enterprise
              AND ecbbsite = g_site
              AND ecbb001 = g_ecba_m.ecba001
              AND ecbb002 = g_ecba_m.ecba002
              AND ecbb007 = p_ecbb008
           IF l_n > 0 THEN
              UPDATE ecbb_t SET ecbb010 = g_ecbb_d[l_ac].ecbb004,
                                ecbb011 = g_ecbb_d[l_ac].ecbb005
               WHERE ecbbent = g_enterprise
                 AND ecbbsite = g_site
                 AND ecbb001 = g_ecba_m.ecba001
                 AND ecbb002 = g_ecba_m.ecba002
                 AND ecbb007 = p_ecbb008
                 AND ecbb010 = 'END'
                 AND ecbb011 = 0
              IF SQLCA.sqlcode THEN
                 CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                 CALL s_transaction_end('N','0')
              END IF
           END IF
        
   END CASE
END FUNCTION]]>
  </point>
  <point name="function.aecm200_rdesc" order="14" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 複製單頭品名規格顯示
# Memo...........:
# Usage..........: CALL aecm200_rdesc(p_newno)
# Input parameter: p_newno   製程料號
# Return code....: 無
# Date & Author..: 2013/11/11 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_rdesc(p_newno)
DEFINE p_newno      LIKE ecba_t.ecba001

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_newno
   CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecba_m.ecba001_desc = g_rtn_fields[1]
   LET g_ecba_m.ecba001_desc1 = g_rtn_fields[2]
   DISPLAY BY NAME g_ecba_m.ecba001_desc
   DISPLAY BY NAME g_ecba_m.ecba001_desc1
END FUNCTION]]>
  </point>
  <point name="function.aecm200_return_ecbb_mult" order="15" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 抓取上站作業+上站制程序的資料
# Memo...........:
# Usage..........: CALL aecm200_return_ecbb_mult()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2013/11/13 By xumm
# Modify.........: 2014/6/6   By wuxj
################################################################################
PRIVATE FUNCTION aecm200_return_ecbb_mult()
DEFINE l_ecbe004      LIKE ecbe_t.ecbe004
DEFINE l_ecbe005      LIKE ecbe_t.ecbe005
DEFINE l_n            LIKE type_t.num5
DEFINE r_success      LIKE type_t.num5
DEFINE l_ecbb         RECORD LIKE ecbb_t.*
DEFINE l_ecbb010      LIKE ecbb_t.ecbb010
DEFINE l_ecbb011      LIKE ecbb_t.ecbb011
DEFINE l_tot          LIKE type_t.num5
DEFINE l_n0           LIKE type_t.num5
DEFINE l_n1           LIKE type_t.num5
DEFINE l_n2           LIKE type_t.num5
DEFINE l_n3           LIKE type_t.num5

   #mark by wuxj
   # LET l_n = 0 
   # SELECT COUNT(*) INTO l_n
   #   FROM ecbe_t
   #  WHERE ecbeent = g_enterprise
   #    AND ecbesite = g_site
   #    AND ecbe001 = g_ecba_m.ecba001
   #    AND ecbe002 = g_ecba_m.ecba002
   #    AND ecbe003 = g_ecbb_d[l_ac].ecbb003
   # #无资料時，本站作業+製程序=p_ecbb008+p_ecbb009的資料更新END+0
   # IF l_n = 1 THEN
   #     #更新上站作業+上站制程序對應下站程序+下站制程序為本資料的本站程序+本站制程序
   #     UPDATE ecbb_t SET ecbb010 = 'END',          
   #                       ecbb011 = 0
   #      WHERE ecbbent = g_enterprise
   #        AND ecbbsite = g_site
   #        AND ecbb001 = g_ecba_m.ecba001
   #        AND ecbb002 = g_ecba_m.ecba002
   #        AND ecbb003 = g_ecbb_d[l_ac].ecbb003
   #     IF SQLCA.sqlcode THEN
   #        CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
   #        CALL s_transaction_end('N','0')
   #     END IF
   #END IF    
   # #多上站作業+上站製程序
   #  DECLARE ecbb_mult CURSOR FOR
   #   SELECT ecbe004,ecbe005 FROM ecbe_t
   #    WHERE ecbeent = g_enterprise
   #      AND ecbesite = g_site
   #      AND ecbe001 = g_ecba_m.ecba001
   #      AND ecbe002 = g_ecba_m.ecba002
   #      AND ecbe003 = g_ecbb_d[l_ac].ecbb003        
   #  FOREACH ecbb_mult INTO l_ecbe004,l_ecbe005
   #     CALL aecm200_return_ecbb(l_ecbe004,l_ecbe005)
   #  END FOREACH   
   #end mark

   #add by wuxja
   LET r_success = FALSE
   LET l_n = 0 
   DECLARE ecbb_mult0 CURSOR FOR 
    SELECT * FROM ecbb_t WHERE ecbbent=g_enterprise AND ecbbsite=g_site
       AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
   FOREACH ecbb_mult0 INTO l_ecbb.*
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF
   #add end
      #多上站作業+上站製程序
      DECLARE ecbb_mult CURSOR FOR
       SELECT ecbe004,ecbe005 FROM ecbe_t
        WHERE ecbeent = g_enterprise AND ecbesite = g_site
          AND ecbe001 = g_ecba_m.ecba001 AND ecbe002 = g_ecba_m.ecba002
          AND ecbe003 = l_ecbb.ecbb003 
      FOREACH ecbb_mult INTO l_ecbe004,l_ecbe005
         #計算多上站資料有幾筆相同的上站作業+製程序
         LET l_tot = 0
         SELECT COUNT(*) INTO l_tot FROM ecbe_t
          WHERE ecbeent = g_enterprise  AND ecbesite = g_site
            AND ecbe001 = g_ecba_m.ecba001 AND ecbe002 = g_ecba_m.ecba002
            AND ecbe004 = l_ecbe004 AND ecbe005 = l_ecbe005
         IF l_tot = 1 THEN
            IF NOT cl_null(l_ecbb.ecbb007) THEN
               #維護群組
               #更新上站作業+上站制程序且無維護群組或群組不一樣的資料對應下站程序+下站制程序為本資料的群組+本站  
               UPDATE ecbb_t SET ecbb010 = l_ecbb.ecbb007,ecbb011 = 0
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                  AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
                  AND ecbb004 = l_ecbe004 AND ecbb005 = l_ecbe005
                  AND (ecbb007 IS NULL OR ecbb007 <> l_ecbb.ecbb007)
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                  RETURN r_success 
               END IF
               #更新上站作業+上站制程序且有維護群組(相同群組)的資料對應下站程序+下站制程序為本資料的本站程序+本站制程序
               UPDATE ecbb_t SET ecbb010 = l_ecbb.ecbb004,ecbb011 = l_ecbb.ecbb005
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                  AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
                  AND ecbb004 = l_ecbe004 AND ecbb005 = l_ecbe005
                  AND ecbb007 = l_ecbb.ecbb007
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                  RETURN r_success
               END IF
            ELSE
               #無維護群組
               #更新上站作業+上站制程序對應下站程序+下站制程序為本資料的本站程序+本站制程序
               UPDATE ecbb_t SET ecbb010 = l_ecbb.ecbb004,ecbb011 = l_ecbb.ecbb005
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                  AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
                  AND ecbb004 = l_ecbe004 AND ecbb005 = l_ecbe005
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                  RETURN r_success
               END IF
            END IF
           
            SELECT COUNT(*) INTO l_n1 FROM ecbb_t
             WHERE ecbbent = g_enterprise AND ecbbsite = g_site
               AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
               AND ecbb007 = l_ecbe004
               AND (ecbb004 NOT IN(SELECT ecbb008 FROM ecbb_t WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                   AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002 AND ecbb007 = l_ecbe004) OR
                   ecbb005 NOT IN(SELECT ecbb009 FROM ecbb_t WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                   AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002 AND ecbb007 = l_ecbe004))
            IF l_n1 > 0 THEN
               UPDATE ecbb_t SET ecbb010 = l_ecbb.ecbb004,ecbb011 = l_ecbb.ecbb005
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                  AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
                  AND ecbb007 = l_ecbe004
                  AND (ecbb004 NOT IN(SELECT ecbb008 FROM ecbb_t WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                      AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002 AND ecbb007 = l_ecbe004) OR
                      ecbb005 NOT IN(SELECT ecbb009 FROM ecbb_t WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                      AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002 AND ecbb007 = l_ecbe004))
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                  RETURN r_success
               END IF
            END IF
         ELSE
            SELECT COUNT(DISTINCT ecbe004) INTO l_n2 FROM ecbe_t
             WHERE ecbeent = g_enterprise  AND ecbesite = g_site
               AND ecbe001 = g_ecba_m.ecba001 AND ecbe002 = g_ecba_m.ecba002
               AND ecbe004 = l_ecbe004 AND ecbe005 = l_ecbe005
            SELECT COUNT(DISTINCT ecbe005) INTO l_n3 FROM ecbe_t
             WHERE ecbeent = g_enterprise  AND ecbesite = g_site
               AND ecbe001 = g_ecba_m.ecba001 AND ecbe002 = g_ecba_m.ecba002
               AND ecbe004 = l_ecbe004 AND ecbe005 = l_ecbe005
            IF l_n2 = 1 AND l_n3 = 1 THEN
               UPDATE ecbb_t SET ecbb010 = 'MULT', ecbb011 = 0
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                  AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
                  AND ecbb004 = l_ecbe004 AND ecbb005 = l_ecbe005
            ELSE
               UPDATE ecbb_t SET ecbb010 = l_ecbb.ecbb007, ecbb011 = 0
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site
                  AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
                  AND ecbb004 = l_ecbe004 AND ecbb005 = l_ecbe005
            END IF
            IF SQLCA.sqlcode THEN
               CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
               RETURN r_success
            END IF
         END IF
      END FOREACH
      
      #add by wuxj
      #若当站对应下站不存在或者为空，则更新下站作业+下站作业序END+0
      SELECT ecbb010,ecbb011 INTO l_ecbb010,l_ecbb011 FROM ecbb_t WHERE ecbbent=g_enterprise AND ecbbsite=g_site
         AND ecbb001=g_ecba_m.ecba001 AND ecbb002=g_ecba_m.ecba002 AND ecbb003=l_ecbb.ecbb003 
      IF NOT cl_null(l_ecbb010) AND NOT cl_null(l_ecbb011) THEN
         SELECT COUNT(*) INTO l_n0 FROM ecbe_t WHERE ecbeent=g_enterprise AND ecbesite=g_site AND ecbe001=g_ecba_m.ecba001
            AND ecbe002=g_ecba_m.ecba002 AND ecbe004=l_ecbb010 AND ecbe005=l_ecbb011
         IF l_n0 = 0 THEN
            IF l_ecbb.ecbb010 = 'MULT' THEN
               SELECT COUNT(*) INTO l_n0 FROM ecbe_t WHERE ecbeent=g_enterprise AND ecbesite=g_site AND ecbe001=g_ecba_m.ecba001
                  AND ecbe002=g_ecba_m.ecba002 AND ecbe004=l_ecbb.ecbb004 AND ecbe005=l_ecbb.ecbb005
            ELSE
               #群组
               SELECT COUNT(*) INTO l_n0 FROM ecbb_t WHERE ecbbent=g_enterprise AND ecbbsite=g_site AND ecbb001=g_ecba_m.ecba001 
                  AND ecbb002=g_ecba_m.ecba002 AND ecbb008=l_ecbb.ecbb004 AND ecbb009=l_ecbb.ecbb005 AND ecbb007=l_ecbb010
               IF l_n0 = 0 THEN
                  SELECT COUNT(*) INTO l_n0 FROM ecbb_t WHERE ecbbent=g_enterprise AND ecbbsite=g_site AND ecbb001=g_ecba_m.ecba001 
                     AND ecbb002=g_ecba_m.ecba002 AND ecbb004=l_ecbb010 AND ecbb005=l_ecbb011 AND ecbb008=l_ecbb.ecbb007
               END IF
            END IF
         END IF
      END IF
      IF cl_null(l_ecbb010) OR l_n0 = 0 THEN           
         UPDATE ecbb_t SET ecbb010 = 'END',ecbb011 = 0
          WHERE ecbbent = g_enterprise
            AND ecbbsite = g_site
            AND ecbb001=g_ecba_m.ecba001
            AND ecbb002=g_ecba_m.ecba002 
            AND ecbb003=l_ecbb.ecbb003
         IF SQLCA.sqlcode THEN
            CALL cl_err("UPDATE ecbb_t",SQLCA.sqlcode,1)
            RETURN r_success
         END IF
      END IF
   END FOREACH
   
   LET r_success = TRUE
   RETURN r_success
   #end add
END FUNCTION]]>
  </point>
  <point name="function.aecm200_chk_valid" order="16" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 確認前檢查
# Memo...........:
# Usage..........: CALL aecm200_chk_valid()
# Input parameter: 無
# Return code....: 無
# Date & Author..: 2013/11/15 By xumm
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_chk_valid()
DEFINE l_n           LIKE type_t.num5
DEFINE l_sql         STRING
DEFINE l_ecbb008     LIKE ecbb_t.ecbb008
DEFINE l_ecbb009     LIKE ecbb_t.ecbb009

   LET g_errno = ""
   LET l_n = 0
   SELECT COUNT(*) INTO l_n
     FROM ecbb_t
    WHERE ecbbent = g_enterprise
      AND ecbb001 = g_ecba_m.ecba001
      AND ecbb002 = g_ecba_m.ecba002
   IF l_n = 0 THEN
      LET g_errno = 'aec-00020'
      RETURN
   END IF
   LET l_sql =" SELECT ecbb008,ecbb009 ",
              "   FROM ecbb_t ",
              "  WHERE ecbbent = '",g_enterprise,"'",
              "    AND ecbb001 = '",g_ecba_m.ecba001,"'",
              "    AND ecbb002 = '",g_ecba_m.ecba002,"'"
   DECLARE aecm200_chk_valid CURSOR FROM l_sql
   FOREACH aecm200_chk_valid INTO l_ecbb008,l_ecbb009
      IF l_ecbb008 = 'INIT' OR l_ecbb008 = 'MULT' THEN
         CONTINUE FOREACH
      END IF
      LET l_n = 0
      SELECT COUNT(*) INTO l_n
        FROM ecbb_t
        WHERE ecbbent = g_enterprise
          AND ecbb001 = g_ecba_m.ecba001
          AND ecbb002 = g_ecba_m.ecba002
          AND ((ecbb004 = l_ecbb008
               AND ecbb005 = l_ecbb009)
               OR ecbb007 = l_ecbb008)
       IF l_n = 0 THEN
          LET g_errno = 'aec-00021'
          RETURN
       END IF
   END FOREACH
END FUNCTION]]>
  </point>
  <point name="function.aecm200_b_fill_text" order="17" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 製程流程圖頁簽table值顯示
# Date & Author..: 2014/6/4 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_b_fill_text()
DEFINE l_msg1                   STRING
DEFINE l_msg2                   STRING
DEFINE l_msg3                   STRING
DEFINE l_msg4                   STRING
DEFINE l_msg5                   STRING
DEFINE l_i                      LIKE type_t.num5
DEFINE l_j                      LIKE type_t.num5

   LET l_msg1 = cl_getmsg("aec-00030",g_lang)
   LET l_msg2 = cl_getmsg("aec-00031",g_lang)
   LET l_msg3 = cl_getmsg("aec-00032",g_lang)
   LET l_msg4 = cl_getmsg("aec-00033",g_lang)
   LET l_msg5 = cl_getmsg("aec-00034",g_lang)
   #錯誤信息維護，不能維護很長，且中英文码长不同，故拆开维护
   LET l_j = 1
   FOR l_i = 1 TO 14
      IF l_i = 1 THEN
         LET g_ecbb4_d[l_i].l_text = l_msg1.subString(1,l_msg1.getIndexOf('|',1)-1)
         LET l_j = l_msg1.getIndexOf('|',1) + 1
      ELSE
         LET g_ecbb4_d[l_i].l_text = l_msg1.subString(l_j,l_msg1.getIndexOf('|',l_j)-1)
         LET l_j = l_msg1.getIndexOf('|',l_j) + 1
      END IF
   END FOR
   
   FOR l_i = 15 TO 16
      IF l_i = 15 THEN
         LET g_ecbb4_d[l_i].l_text = l_msg2.subString(1,l_msg2.getIndexOf('|',1)-1)
         LET l_j = l_msg2.getIndexOf('|',1) + 1
      ELSE
         LET g_ecbb4_d[l_i].l_text = l_msg2.subString(l_j,l_msg2.getIndexOf('|',l_j)-1)
         LET l_j = l_msg2.getIndexOf('|',l_j) + 1
      END IF
   END FOR
   
   LET g_ecbb4_d[17].l_text = l_msg3.subString(1,l_msg3.getIndexOf('|',1)-1)
   
   FOR l_i = 18 TO 20
      IF l_i = 18 THEN
         LET g_ecbb4_d[l_i].l_text = l_msg4.subString(1,l_msg4.getIndexOf('|',1)-1)
         LET l_j = l_msg4.getIndexOf('|',1) + 1
      ELSE
         LET g_ecbb4_d[l_i].l_text = l_msg4.subString(l_j,l_msg4.getIndexOf('|',l_j)-1)
         LET l_j = l_msg4.getIndexOf('|',l_j) + 1
      END IF
   END FOR
   
   FOR l_i = 21 TO 32
      IF l_i = 21 THEN
         LET g_ecbb4_d[l_i].l_text = l_msg5.subString(1,l_msg5.getIndexOf('|',1)-1)
         LET l_j = l_msg5.getIndexOf('|',1) + 1
      ELSE
         LET g_ecbb4_d[l_i].l_text = l_msg5.subString(l_j,l_msg5.getIndexOf('|',l_j)-1)
         LET l_j = l_msg5.getIndexOf('|',l_j) + 1
      END IF
   END FOR

END FUNCTION]]>
  </point>
  <point name="function.aecm200_value_def" order="18" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 流程图页签table新增时的预设值
# Date & Author..: 2014/6/4 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_value_def()
DEFINE l_ecbb003               LIKE ecbb_t.ecbb003
DEFINE l_sys                   LIKE ecbb_t.ecbb003

   LET g_ecbb4_d[7].l_value = "0"
   LET g_ecbb4_d[8].l_value = "0"
   LET g_ecbb4_d[9].l_value = "0"
   LET g_ecbb4_d[10].l_value = "0"
   LET g_ecbb4_d[11].l_value = "0"
   LET g_ecbb4_d[12].l_value = "N"
   LET g_ecbb4_d[15].l_value = "N"
   LET g_ecbb4_d[16].l_value = "N"
   LET g_ecbb4_d[17].l_value = "Y"
   LET g_ecbb4_d[18].l_value = "N"
   LET g_ecbb4_d[19].l_value = "N"
   LET g_ecbb4_d[20].l_value = "N"
   LET g_ecbb4_d[23].l_value = "1"
   LET g_ecbb4_d[24].l_value = "1"
   LET g_ecbb4_d[27].l_value = "1"
   LET g_ecbb4_d[28].l_value = "1"
   LET g_ecbb4_d[29].l_value = "N"
         
   #项次
   SELECT MAX(ecbb003) INTO l_ecbb003 FROM ecbb_t
    WHERE ecbbent = g_enterprise
      AND ecbbsite = g_site
      AND ecbb001 = g_ecba_m.ecba001
      AND ecbb002 = g_ecba_m.ecba002
   CALL cl_get_para(g_enterprise,g_site,'E-MFG-0001') RETURNING l_sys
   IF cl_null(l_sys) OR l_sys = 0 THEN LET l_sys = 1 END IF 
   IF cl_null(l_ecbb003) THEN
      LET l_ecbb003 = l_sys
   ELSE
      LET l_ecbb003 = l_ecbb003+l_sys
   END IF
   LET g_ecbb4_d[1].l_value =l_ecbb003
   SELECT imae016 INTO g_ecbb4_d[21].l_value FROM imae_t
    WHERE imaeent = g_enterprise
      AND imaesite = g_site
      AND imae001 = g_ecba_m.ecba001
   LET g_ecbb4_d[25].l_value = g_ecbb4_d[21].l_value
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb4_d[21].l_value
   CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb4_d[22].l_value = '', g_rtn_fields[1] , ''
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecbb4_d[25].l_value
   CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb4_d[26].l_value = '', g_rtn_fields[1] , ''

END FUNCTION]]>
  </point>
  <point name="function.aecm200_b_fill_value" order="19" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 制程流程图页签table栏位值显示
# Date & Author..: 2014/6/4 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_b_fill_value(p_ac)
DEFINE p_ac              LIKE type_t.num5
DEFINE l_success         LIKE type_t.num5
DEFINE l_ecbb            RECORD LIKE ecbb_t.*

   IF cl_null(p_ac) THEN
      LET p_ac = 1
   END IF
   
   SELECT * INTO l_ecbb.* FROM ecbb_t WHERE ecbbent=g_enterprise AND ecbbsite=g_site 
      AND ecbb001 = g_ecba_m.ecba001 AND ecbb002 = g_ecba_m.ecba002
      AND ecbb003 = g_ecbb_d[p_ac].ecbb003
   LET g_ecbb4_d[1].l_value = l_ecbb.ecbb003
   LET g_ecbb4_d[2].l_value = l_ecbb.ecbb004
   
   LET g_ecbb4_d[4].l_value = l_ecbb.ecbb005
   LET g_ecbb4_d[5].l_value = l_ecbb.ecbb012

   LET g_ecbb4_d[7].l_value = l_ecbb.ecbb024
   LET g_ecbb4_d[8].l_value = l_ecbb.ecbb025
   LET g_ecbb4_d[9].l_value = l_ecbb.ecbb026
   LET g_ecbb4_d[10].l_value = l_ecbb.ecbb027
   LET g_ecbb4_d[11].l_value = l_ecbb.ecbb034
   LET g_ecbb4_d[12].l_value = l_ecbb.ecbb013
   LET g_ecbb4_d[13].l_value = l_ecbb.ecbb014

   LET g_ecbb4_d[15].l_value = l_ecbb.ecbb015
   LET g_ecbb4_d[16].l_value = l_ecbb.ecbb016
   LET g_ecbb4_d[17].l_value = l_ecbb.ecbb017
   LET g_ecbb4_d[18].l_value = l_ecbb.ecbb018
   LET g_ecbb4_d[19].l_value = l_ecbb.ecbb019
   LET g_ecbb4_d[20].l_value = l_ecbb.ecbb020
   LET g_ecbb4_d[21].l_value = l_ecbb.ecbb030
   
   LET g_ecbb4_d[23].l_value = l_ecbb.ecbb031
   LET g_ecbb4_d[24].l_value = l_ecbb.ecbb032
   LET g_ecbb4_d[25].l_value = l_ecbb.ecbb021
   
   LET g_ecbb4_d[27].l_value = l_ecbb.ecbb022
   LET g_ecbb4_d[28].l_value = l_ecbb.ecbb023
   LET g_ecbb4_d[29].l_value = l_ecbb.ecbb033
   LET g_ecbb4_d[30].l_value = l_ecbb.ecbb028
   LET g_ecbb4_d[31].l_value = l_ecbb.ecbb029
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = l_ecbb.ecbb004
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001 = '221' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb4_d[3].l_value =  '', g_rtn_fields[1] , ''
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = l_ecbb.ecbb012
   CALL ap_ref_array2(g_ref_fields,"SELECT ecaa002 FROM ecaa_t WHERE ecaaent='"||g_enterprise||"' AND ecaasite='"||g_site||"' AND ecaa001=? ","") RETURNING g_rtn_fields
   LET g_ecbb4_d[6].l_value =  '', g_rtn_fields[1] , ''
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = l_ecbb.ecbb014
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb4_d[14].l_value =  '', g_rtn_fields[1] , ''
   
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = l_ecbb.ecbb030
   CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb4_d[22].l_value = '', g_rtn_fields[1] , ''
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = l_ecbb.ecbb021
   CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecbb4_d[26].l_value = '', g_rtn_fields[1] , ''
   
   
   IF NOT cl_null(g_ecbb4_d[1].l_value) THEN
      CALL s_aooi360_sel('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb4_d[1].l_value,'','','','','','','4') RETURNING l_success,g_ecbb4_d[32].l_value
   END IF
END FUNCTION]]>
  </point>
  <point name="function.aecm200_chk_value" order="20" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 流程图页签table栏位值chk
# Date & Author..: 2014/6/4 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_chk_value(p_ac,p_value,p_value_t)
DEFINE p_ac                  LIKE type_t.num5
DEFINE p_value               LIKE type_t.chr80
DEFINE p_value_t             LIKE type_t.chr80
DEFINE r_success             LIKE type_t.num5
DEFINE l_ecbb                RECORD LIKE ecbb_t.*
DEFINE l_ecbb_t              RECORD LIKE ecbb_t.*
DEFINE l_ecbb005             LIKE type_t.num5
DEFINE l_n                   LIKE type_t.num5
   
   LET r_success = FALSE
   IF cl_null(p_ac) THEN
      RETURN r_success
   END IF
   
   CASE p_ac
      WHEN 1
          LET l_ecbb.ecbb003 = p_value
          LET l_ecbb_t.ecbb003 = p_value_t
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb003,"0","0","","","azz-00079",1) THEN
             RETURN r_success
          END IF
        
          IF NOT cl_null(l_ecbb.ecbb003) AND (cl_null(l_ecbb_t.ecbb003) OR l_ecbb.ecbb003 != l_ecbb_t.ecbb003) THEN 
             IF NOT ap_chk_notDup(l_ecbb.ecbb003,"SELECT COUNT(*) FROM ecbb_t WHERE "||"ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND "||"ecbb001 = '"||g_ecba_m.ecba001 ||"' AND "|| "ecbb002 = '"||g_ecba_m.ecba002 ||"' AND "|| "ecbb003 = '"||l_ecbb.ecbb003 ||"'",'std-00004',0) THEN
                RETURN r_success
             END IF
          END IF
       
       WHEN 2
          LET l_ecbb.ecbb004 = p_value
          LET l_ecbb_t.ecbb004 = p_value_t
          IF NOT cl_null(l_ecbb.ecbb004) AND (cl_null(l_ecbb_t.ecbb004) OR l_ecbb.ecbb004 != l_ecbb_t.ecbb004) THEN 
             CALL s_azzi650_chk_exist('221',l_ecbb.ecbb004) RETURNING l_success
             IF NOT l_success THEN
                RETURN r_success
             END IF
             IF NOT cl_null(g_ecbb4_d[4].l_value) THEN
                LET l_ecbb.ecbb005 = g_ecbb4_d[4].l_value
                SELECT COUNT(*) INTO l_n FROM ecbb_t
                 WHERE ecbbent = g_enterprise
                   AND ecbbsite = g_site
                   AND ecbb001 = g_ecba_m.ecba001
                   AND ecbb002 = g_ecba_m.ecba002
                   AND ecbb004 = l_ecbb.ecbb004
                   AND ecbb005 = l_ecbb.ecbb005
                IF l_n > 0 THEN
                   CALL cl_err(l_ecbb.ecbb004,'aec-00006',1)
                   RETURN r_success
                END IF
             ELSE
                SELECT MAX(ecbb005) INTO l_ecbb005 FROM ecbb_t
                 WHERE ecbbent = g_enterprise
                   AND ecbbsite = g_site
                   AND ecbb001 = g_ecba_m.ecba001
                   AND ecbb002 = g_ecba_m.ecba002
                   AND ecbb004 = l_ecbb.ecbb004
                LET l_ecbb005 = l_ecbb005 +1
                LET g_ecbb4_d[4].l_value = l_ecbb005 + 1
                IF cl_null(g_ecbb4_d[4].l_value) THEN
                   LET g_ecbb4_d[4].l_value = 1
                END IF
             END IF
          END IF
          INITIALIZE g_ref_fields TO NULL
          LET g_ref_fields[1] = l_ecbb.ecbb004
          CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001 = '221' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
          LET g_ecbb4_d[3].l_value =  '', g_rtn_fields[1] , ''
          
       WHEN 4
          LET l_ecbb.ecbb005 = p_value
          LET l_ecbb_t.ecbb005 = p_value_t
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb005,"0.000","1","","","azz-00079",1) THEN
             RETURN r_success
          END IF
          IF NOT cl_null(l_ecbb.ecbb005) AND (cl_null(l_ecbb_t.ecbb005) OR l_ecbb.ecbb005 != l_ecbb_t.ecbb005) THEN 
             IF NOT cl_null(g_ecbb4_d[2].l_value) THEN
                LET l_ecbb.ecbb004 = g_ecbb4_d[2].l_value
                SELECT COUNT(*) INTO l_n FROM ecbb_t
                 WHERE ecbbent = g_enterprise
                   AND ecbbsite = g_site
                   AND ecbb001 = g_ecba_m.ecba001
                   AND ecbb002 = g_ecba_m.ecba002
                   AND ecbb004 = l_ecbb.ecbb004
                   AND ecbb005 = l_ecbb.ecbb005
                IF l_n > 0 THEN
                   CALL cl_err(l_ecbb.ecbb004,'aec-00006',1)
                   RETURN r_success
                END IF
             END IF
          END IF
          
       WHEN 5
          LET l_ecbb.ecbb012 = p_value
          LET l_ecbb_t.ecbb012 = p_value_t
          IF NOT cl_null(l_ecbb.ecbb012) AND (cl_null(l_ecbb_t.ecbb012) OR l_ecbb.ecbb012 != l_ecbb_t.ecbb012) THEN 
             INITIALIZE g_chkparam.* TO NULL
             LET g_chkparam.arg1 = l_ecbb.ecbb012
             IF NOT cl_chk_exist("v_ecaa001_1") THEN
                RETURN r_success
             END IF
          END IF
          INITIALIZE g_ref_fields TO NULL
          LET g_ref_fields[1] = l_ecbb.ecbb012
          CALL ap_ref_array2(g_ref_fields,"SELECT ecaa002 FROM ecaa_t WHERE ecaaent='"||g_enterprise||"' AND ecaasite='"||g_site||"' AND ecaa001=? ","") RETURNING g_rtn_fields
          LET g_ecbb4_d[6].l_value =  '', g_rtn_fields[1] , ''
          
       WHEN 7
          LET l_ecbb.ecbb024 = p_value
          LET l_ecbb_t.ecbb024 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb024,"0.000","1","","","azz-00079",1) THEN
             RETURN r_success
          END IF

       WHEN 8
          LET l_ecbb.ecbb025 = p_value
          LET l_ecbb_t.ecbb025 = p_value_t
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb025,"0.000","1","","","azz-00079",1) THEN
             RETURN r_success
          END IF
          
       WHEN 9
          LET l_ecbb.ecbb026 = p_value
          LET l_ecbb_t.ecbb026 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb026,"0.000","1","","","azz-00079",1) THEN
             RETURN r_success
          END IF
          
       WHEN 10
          LET l_ecbb.ecbb027 = p_value
          LET l_ecbb_t.ecbb027 = p_value_t
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb027,"0.000","1","","","azz-00079",1) THEN
             RETURN r_success
          END IF
          
       WHEN 11
          LET l_ecbb.ecbb034 = p_value
          LET l_ecbb_t.ecbb034 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb024,"0.000","1","","","azz-00079",1) THEN
             RETURN r_success
          END IF
       
       WHEN 12
          LET l_ecbb.ecbb013 = p_value
          LET l_ecbb_t.ecbb013 = p_value_t
          IF l_ecbb.ecbb013 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb013,'aec-00035',1)
             RETURN r_success
          END IF
          
       WHEN 13
          LET l_ecbb.ecbb014 = p_value
          LET l_ecbb_t.ecbb014 = p_value_t
          IF NOT cl_null(l_ecbb.ecbb014) AND (cl_null(l_ecbb_t.ecbb014) OR l_ecbb.ecbb014 != l_ecbb_t.ecbb014) THEN 
             INITIALIZE g_chkparam.* TO NULL
             LET g_chkparam.arg1 = l_ecbb.ecbb014
             IF NOT cl_chk_exist("v_pmaa001_1") THEN
                RETURN r_success
             END IF
          END IF
          INITIALIZE g_ref_fields TO NULL
          LET g_ref_fields[1] = l_ecbb.ecbb014
          CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
          LET g_ecbb4_d[14].l_value =  '', g_rtn_fields[1] , ''
          
       WHEN 15
          LET l_ecbb.ecbb015 = p_value
          LET l_ecbb_t.ecbb015 = p_value_t
          IF l_ecbb.ecbb015 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb015,'aec-00035',1)
             RETURN r_success
          END IF

       WHEN 16
          LET l_ecbb.ecbb016 = p_value
          LET l_ecbb_t.ecbb016 = p_value_t
          IF l_ecbb.ecbb016 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb016,'aec-00035',1)
             RETURN r_success
          END IF
          
       WHEN 17
          LET l_ecbb.ecbb017 = p_value
          LET l_ecbb_t.ecbb017 = p_value_t
          IF l_ecbb.ecbb017 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb017,'aec-00035',1)
             RETURN r_success
          END IF
          
       WHEN 18
          LET l_ecbb.ecbb018 = p_value
          LET l_ecbb_t.ecbb018 = p_value_t
          IF l_ecbb.ecbb018 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb018,'aec-00035',1)
             RETURN r_success
          END IF
          
       WHEN 19
          LET l_ecbb.ecbb019 = p_value
          LET l_ecbb_t.ecbb019 = p_value_t
          IF l_ecbb.ecbb019 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb019,'aec-00035',1)
             RETURN r_success
          END IF
          
       WHEN 20
          LET l_ecbb.ecbb020 = p_value
          LET l_ecbb_t.ecbb020 = p_value_t
          IF l_ecbb.ecbb020 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb020,'aec-00035',1)
             RETURN r_success
          END IF
          
       WHEN 21
          LET l_ecbb.ecbb030 = p_value
          LET l_ecbb_t.ecbb030 = p_value_t
          IF NOT cl_null(l_ecbb.ecbb030) AND (cl_null(l_ecbb_t.ecbb030) OR l_ecbb.ecbb030 != l_ecbb_t.ecbb030) THEN 
             INITIALIZE g_chkparam.* TO NULL
             LET g_chkparam.arg1 = l_ecbb.ecbb030
             IF NOT cl_chk_exist("v_ooca001") THEN
                RETURN r_success
             END IF
          END IF
          INITIALIZE g_ref_fields TO NULL
          LET g_ref_fields[1] = l_ecbb.ecbb030
          CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
          LET g_ecbb4_d[22].l_value = '', g_rtn_fields[1] , ''
       
       WHEN 23
          LET l_ecbb.ecbb031 = p_value
          LET l_ecbb_t.ecbb031 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb031,"0.000","0","","","azz-00079",1) THEN
             RETURN r_success
          END IF       
          
       WHEN 24
          LET l_ecbb.ecbb032 = p_value
          LET l_ecbb_t.ecbb032 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb032,"0.000","0","","","azz-00079",1) THEN
             RETURN r_success
          END IF
          
       WHEN 25
          LET l_ecbb.ecbb021 = p_value
          LET l_ecbb_t.ecbb021 = p_value_t
          IF NOT cl_null(l_ecbb.ecbb021) AND (cl_null(l_ecbb_t.ecbb021) OR l_ecbb.ecbb021 != l_ecbb_t.ecbb021) THEN 
             INITIALIZE g_chkparam.* TO NULL
             LET g_chkparam.arg1 = l_ecbb.ecbb021
             IF NOT cl_chk_exist("v_ooca001") THEN
                RETURN r_success
             END IF
          END IF
          INITIALIZE g_ref_fields TO NULL
          LET g_ref_fields[1] = l_ecbb.ecbb021
          CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
          LET g_ecbb4_d[26].l_value = '', g_rtn_fields[1] , ''
       
       WHEN 27
          LET l_ecbb.ecbb022 = p_value
          LET l_ecbb_t.ecbb022 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb022,"0.000","0","","","azz-00079",1) THEN
             RETURN r_success
          END IF       
          
       WHEN 28
          LET l_ecbb.ecbb023 = p_value
          LET l_ecbb_t.ecbb023 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb023,"0.000","0","","","azz-00079",1) THEN
             RETURN r_success
          END IF
       
       WHEN 29
          LET l_ecbb.ecbb033 = p_value
          LET l_ecbb_t.ecbb033 = p_value_t
          IF l_ecbb.ecbb033 NOT MATCHES '[YN]' THEN
             CALL cl_err(l_ecbb.ecbb033,'aec-00035',1)
             RETURN r_success
          END IF
          IF l_ecbb.ecbb033 = 'Y' THEN
             LET l_ecbb.ecbb003 = g_ecbb4_d[1].l_value
             SELECT count(*) INTO l_n FROM ecbb_t
              WHERE ecbbent = g_enterprise
                AND ecbbsite = g_site
                AND ecbb001 = g_ecba_m.ecba001
                AND ecbb002 = g_ecba_m.ecba002
                AND ecbb003 <> l_ecbb.ecbb003
                AND ecbb033 = 'Y'
             IF l_n > 0 THEN
                IF NOT cl_ask_confirm('asf-00134') THEN
                   LET g_ecbb4_d[29].l_value = 'N'
                ELSE
                   UPDATE ecbb_t SET ecbb033 = 'N' 
                    WHERE ecbbent = g_enterprise
                      AND ecbbsite = g_site
                      AND ecbb001 = g_ecba_m.ecba001
                      AND ecbb002 = g_ecba_m.ecba002
                      AND ecbb003 <> l_ecbb.ecbb003
                      AND ecbb033 = 'Y'
                END IF
             END IF
          END IF
       
       WHEN 30
          LET l_ecbb.ecbb028 = p_value
          LET l_ecbb_t.ecbb028 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb028,"0.000","1","","","azz-00079",1) THEN
             RETURN r_success
          END IF
          
       WHEN 31
          LET l_ecbb.ecbb029 = p_value
          LET l_ecbb_t.ecbb029 = p_value_t 
          IF NOT cl_ap_chk_Range(l_ecbb.ecbb029,"0.000","0","","","azz-00079",1) THEN
             RETURN r_success
          END IF
          
    END CASE
    LET r_success = TRUE
    RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.aecm200_value_controlp" order="21" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 流程图页签table栏位开窗
# Date & Author..: 2014/6/4 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_value_controlp(p_ac,p_value)
DEFINE p_ac                  LIKE type_t.num5
DEFINE p_value               LIKE type_t.chr80
DEFINE l_ecbb003             LIKE ecbb_t.ecbb003
DEFINE l_success             LIKE type_t.num5
 
   CASE p_ac
      WHEN 2
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = g_ecbb4_d[2].l_value  
         LET g_qryparam.arg1 = "221" #
         CALL q_oocq002()                                
         LET g_ecbb4_d[2].l_value = g_qryparam.return1   
         DISPLAY g_ecbb4_d[2].l_value TO l_value         
         
      WHEN 5
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = g_ecbb4_d[5].l_value  
         CALL q_ecaa001_1()                              
         LET g_ecbb4_d[5].l_value = g_qryparam.return1   
         DISPLAY g_ecbb4_d[5].l_value TO l_value         
         
      WHEN 13
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = g_ecbb4_d[13].l_value 
         LET g_qryparam.arg1 = " ('1','3')"
         CALL q_pmaa001_1()                              
         LET g_ecbb4_d[13].l_value = g_qryparam.return1  
         DISPLAY g_ecbb4_d[13].l_value TO l_value 

      WHEN 21
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = g_ecbb4_d[21].l_value 
         CALL q_ooca001()                              
         LET g_ecbb4_d[21].l_value = g_qryparam.return1  
         DISPLAY g_ecbb4_d[21].l_value TO l_value
      WHEN 25
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = g_ecbb4_d[25].l_value 
         CALL q_ooca001()                               
         LET g_ecbb4_d[25].l_value = g_qryparam.return1  
         DISPLAY g_ecbb4_d[25].l_value TO l_value
       
      WHEN 32
         IF NOT cl_null(g_ecbb4_d[1].l_value) THEN
            LET l_ecbb003 = g_ecbb4_d[1].l_value
            CALL aooi360_02('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,l_ecbb003,'','','','','','','4')
            CALL s_aooi360_sel('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,l_ecbb003,'','','','','','','4') RETURNING l_success,g_ecbb4_d[32].l_value
            DISPLAY g_ecbb4_d[32].l_value TO l_value
         END IF
   END CASE
END FUNCTION]]>
  </point>
  <point name="function.aecm200_value_ins_upd" order="22" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 根据流程页签table中维护的值，异动ecbb_t
# Date & Author..: 2014/6/4 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION aecm200_value_ins_upd(p_value,p_value_t)
DEFINE p_value           LIKE ecbb_t.ecbb003
DEFINE p_value_t         LIKE ecbb_t.ecbb003
DEFINE r_success         LIKE type_t.num5
DEFINE l_n               LIKE type_t.num5
DEFINE l_ecbb            RECORD LIKE ecbb_t.*

   LET r_success = FALSE
   SELECT COUNT(*) INTO l_n FROM ecbb_t 
    WHERE ecbbent = g_enterprise
      AND ecbbsite = g_site
      AND ecbb001 = g_ecba_m.ecba001
      AND ecbb002 = g_ecba_m.ecba002
      AND ecbb003 = p_value
   
   #ecbb赋值
   SELECT * INTO l_ecbb.* FROM ecbb_t 
    WHERE ecbbent = g_enterprise
      AND ecbbsite = g_site
      AND ecbb001 = g_ecba_m.ecba001
      AND ecbb002 = g_ecba_m.ecba002
      AND ecbb003 = p_value_t

   LET l_ecbb.ecbbent = g_enterprise
   LET l_ecbb.ecbbsite = g_site
   LET l_ecbb.ecbb001 = g_ecba_m.ecba001
   LET l_ecbb.ecbb002 = g_ecba_m.ecba002
   LET l_ecbb.ecbb003 = g_ecbb4_d[1].l_value
   LET l_ecbb.ecbb004 = g_ecbb4_d[2].l_value
   LET l_ecbb.ecbb005 = g_ecbb4_d[4].l_value
   LET l_ecbb.ecbb012 = g_ecbb4_d[5].l_value
   LET l_ecbb.ecbb013 = g_ecbb4_d[12].l_value
   LET l_ecbb.ecbb014 = g_ecbb4_d[13].l_value
   LET l_ecbb.ecbb015 = g_ecbb4_d[15].l_value
   LET l_ecbb.ecbb016 = g_ecbb4_d[16].l_value
   LET l_ecbb.ecbb017 = g_ecbb4_d[17].l_value
   LET l_ecbb.ecbb018 = g_ecbb4_d[18].l_value
   LET l_ecbb.ecbb019 = g_ecbb4_d[19].l_value
   LET l_ecbb.ecbb020 = g_ecbb4_d[20].l_value
   LET l_ecbb.ecbb021 = g_ecbb4_d[25].l_value
   LET l_ecbb.ecbb022 = g_ecbb4_d[27].l_value
   LET l_ecbb.ecbb023 = g_ecbb4_d[28].l_value
   LET l_ecbb.ecbb024 = g_ecbb4_d[7].l_value
   LET l_ecbb.ecbb025 = g_ecbb4_d[8].l_value
   LET l_ecbb.ecbb026 = g_ecbb4_d[9].l_value
   LET l_ecbb.ecbb027 = g_ecbb4_d[10].l_value
   LET l_ecbb.ecbb028 = g_ecbb4_d[30].l_value
   LET l_ecbb.ecbb029 = g_ecbb4_d[31].l_value
   LET l_ecbb.ecbb030 = g_ecbb4_d[21].l_value
   LET l_ecbb.ecbb031 = g_ecbb4_d[23].l_value
   LET l_ecbb.ecbb032 = g_ecbb4_d[24].l_value
   LET l_ecbb.ecbb033 = g_ecbb4_d[29].l_value
   LET l_ecbb.ecbb034 = g_ecbb4_d[11].l_value
   
   IF l_n = 0 THEN
      INSERT INTO ecbb_t VALUES(l_ecbb.*)
   ELSE
      UPDATE ecbb_t SET ecbb_t.* = l_ecbb.* 
       WHERE ecbbent = g_enterprise
         AND ecbbsite = g_site
         AND ecbb001 = g_ecba_m.ecba001
         AND ecbb002 = g_ecba_m.ecba002
         AND ecbb003 = p_value      
   END IF
   IF SQLCA.sqlcode THEN
      CALL cl_err("ecbb_t",SQLCA.sqlcode,1) 
      RETURN r_success
   END IF
   IF p_value != p_value_t THEN
      DELETE FROM ecbb_t
       WHERE ecbbent = g_enterprise
         AND ecbbsite = g_site
         AND ecbb001 = g_ecba_m.ecba001
         AND ecbb002 = g_ecba_m.ecba002
         AND ecbb003 = p_value_t
      IF SQLCA.sqlcode THEN
         CALL cl_err("DEL ecbb_t",SQLCA.sqlcode,1) 
         RETURN r_success
      END IF
   END IF
   IF NOT cl_null(g_ecbb4_d[32].l_value) THEN
      CALL s_aooi360_gen('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,' ',' ',' ',' ',' ',' ','4',g_ecbb4_d[32].l_value)
         RETURNING l_success
   ELSE
      CALL s_aooi360_del('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,' ',' ',' ',' ',' ',' ','4')
         RETURNING l_success
   END IF
   IF NOT l_success THEN
      RETURN r_success
   END IF
   
   LET r_success = TRUE
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="b_fill.fill" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         CALL aecm200_ecbb_desc()]]>
  </point>
  <point name="browser_fill.before_count" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_wc4 <> " 1=1" THEN
      #單身3有輸入搜尋條件                      
      LET l_sub_sql = " SELECT UNIQUE ecba001,ecba002 ",
                      "   FROM ecba_t ",
                      "   LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
                      "   LEFT JOIN ecbc_t ON ecbcent = ecbbent AND ecbcsite = ecbbsite AND ecbc001 = ecbb001 AND ecbc002 = ecbb002 AND ecbc003 = ecbb003 ",
                      "   LEFT JOIN ecbd_t ON ecbdent = ecbcent AND ecbdsite = ecbcsite AND ecbd001 = ecbc001 AND ecbd002 = ecbc002 AND ecbd003 = ecbc003 AND ecbd004 = ecbc004 ",
                      "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND ",l_wc, " AND ", l_wc2, " AND ",l_wc3, " AND ",l_wc4
   ELSE
      #單身2有輸入搜尋條件
      IF g_wc3 <> " 1=1" THEN
         LET l_sub_sql = " SELECT UNIQUE ecba001,ecba002 ",
                         "   FROM ecba_t ",
                         "   LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
                         "   LEFT JOIN ecbc_t ON ecbcent = ecbbent AND ecbcsite = ecbbsite AND ecbc001 = ecbb001 AND ecbc002 = ecbb002 AND ecbc003 = ecbb003 ",
                         "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND ",l_wc, " AND ", l_wc2, " AND ",l_wc3
      ELSE
         IF g_wc2 <> " 1=1" THEN
            LET l_sub_sql = " SELECT UNIQUE ecba001,ecba002 ",
                            "   FROM ecba_t ",
                            "   LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
                            "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND ",l_wc, " AND ", l_wc2
         ELSE
            LET l_sub_sql = " SELECT UNIQUE ecba001,ecba002 ",
                            "   FROM ecba_t ",
                            "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ",l_wc CLIPPED
         END IF
      END IF
   END IF
   
   LET g_sql = " SELECT COUNT(*) FROM (",l_sub_sql,")"]]>
  </point>
  <point name="browser_fill.before_foreach" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL g_ecbb2_d.clear()
   CALL g_ecbb3_d.clear()
   CALL g_ecbb4_d.clear()
   LET l_wc3 = g_wc3.trim()
   LET l_wc4 = g_wc4.trim()]]>
  </point>
  <point name="browser_fill.before_prepare" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_wc4 <> " 1=1" THEN
      #單身3有輸入搜尋條件                      
      LET l_sql_rank = "  SELECT DISTINCT ecbastus,ecba001,'','',ecba002,ecba003,DENSE_RANK() OVER(ORDER BY ecba001,ecba002 ",g_order,") AS RANK ",
                      "   FROM ecba_t ",
                      "   LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
                      "   LEFT JOIN ecbc_t ON ecbcent = ecbbent AND ecbcsite = ecbbsite AND ecbc001 = ecbb001 AND ecbc002 = ecbb002 AND ecbc003 = ecbb003 ",
                      "   LEFT JOIN ecbd_t ON ecbdent = ecbcent AND ecbdsite = ecbcsite AND ecbd001 = ecbc001 AND ecbd002 = ecbc002 AND ecbd003 = ecbc003 AND ecbd004 = ecbc004 ",
                      "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND ",g_wc, " AND ", g_wc2, " AND ",g_wc3, " AND ",g_wc4
   ELSE
      #單身2有輸入搜尋條件
      IF g_wc3 <> " 1=1" THEN
         LET l_sql_rank = " SELECT DISTINCT ecbastus,ecba001,'','',ecba002,ecba003,DENSE_RANK() OVER(ORDER BY ecba001,ecba002 ",g_order,") AS RANK ",
                         "   FROM ecba_t ",
                         "   LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
                         "   LEFT JOIN ecbc_t ON ecbcent = ecbbent AND ecbcsite = ecbbsite AND ecbc001 = ecbb001 AND ecbc002 = ecbb002 AND ecbc003 = ecbb003 ",
                         "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND ",g_wc, " AND ", g_wc2, " AND ",g_wc3
      ELSE
         IF g_wc2 <> " 1=1" THEN
            LET l_sql_rank = " SELECT DISTINCT ecbastus,ecba001,'','',ecba002,ecba003,DENSE_RANK() OVER(ORDER BY ecba001,ecba002 ",g_order,") AS RANK ",
                            "   FROM ecba_t ",
                            "   LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
                            "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND ",g_wc, " AND ", g_wc2
         ELSE
            LET l_sql_rank = " SELECT DISTINCT ecbastus,ecba001,'','',ecba002,ecba003,DENSE_RANK() OVER(ORDER BY ecba001,ecba002 ",g_order,") AS RANK ",
                            "   FROM ecba_t ",
                            "  WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ",g_wc CLIPPED
         END IF
      END IF
   END IF
   
   #定義翻頁CURSOR
   LET g_sql= "SELECT ecbastus,ecba001,'','',ecba002,ecba003 FROM (",l_sql_rank,") WHERE ",
              " RANK >= ",1," AND RANK<",1+g_max_browse,
              " ORDER BY ",l_searchcol," ",g_order]]>
  </point>
  <point name="browser_fill.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_wc3             STRING 
   DEFINE l_wc4             STRING ]]>
  </point>
  <point name="browser_fill.reference" order="" ver="2" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_browser[g_cnt].b_ecba001
      CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_browser[g_cnt].b_ecba001_desc = g_rtn_fields[1]
      LET g_browser[g_cnt].b_ecba001_desc1 = g_rtn_fields[2]
      DISPLAY BY NAME g_browser[g_cnt].b_ecba001_desc
      DISPLAY BY NAME g_browser[g_cnt].b_ecba001_desc1
]]>
  </point>
  <point name="construct.c.page1.ecbb030" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbb030  #顯示到畫面上

            NEXT FIELD ecbb030                     #返回原欄位

]]>
  </point>
  <point name="cs.add_cs" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      CONSTRUCT g_wc3_table1 ON ecbc004,ecbc005,ecbc006,ecbc007,ecbc008,ecbc009,ecbc010
           FROM s_detail2[1].ecbc004,s_detail2[1].ecbc005,s_detail2[1].ecbc006,s_detail2[1].ecbc007,s_detail2[1].ecbc008,s_detail2[1].ecbc009,s_detail2[1].ecbc010                   
         
         BEFORE CONSTRUCT
           # CALL cl_qbe_display_condition(lc_qbe_sn)
            
         ON ACTION controlp INFIELD ecbc004
            
         BEFORE FIELD ecbc004

         AFTER FIELD ecbc004
            
         BEFORE FIELD ecbc005
        
         AFTER FIELD ecbc005
            
         ON ACTION controlp INFIELD ecbc005
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_imaf001_6()                       #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbc005  #顯示到畫面上
            NEXT FIELD ecbc005                     #返回原欄位
            
         BEFORE FIELD ecbc006
           
         AFTER FIELD ecbc006
          
         ON ACTION controlp INFIELD ecbc006
            #開窗c段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "215" 
            CALL q_oocq002()                       #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbc006  #顯示到畫面上
            NEXT FIELD ecbc006                     #返回原欄位
            
         BEFORE FIELD ecbc007
         
         AFTER FIELD ecbc007
            
         ON ACTION controlp INFIELD ecbc007
           
         ON ACTION controlp INFIELD ecbc008
            
            
         BEFORE FIELD ecbc008
           
         AFTER FIELD ecbc008
        
         BEFORE FIELD ecbc009
          
         AFTER FIELD ecbc009
      
         ON ACTION controlp INFIELD ecbc009
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                      #呼叫開窗
            DISPLAY g_qryparam.return1 TO ecbc009   #顯示到畫面上
            NEXT FIELD ecbc009                      #返回原欄位
            
         ON ACTION controlp INFIELD ecbc010
           
         BEFORE FIELD ecbc010
            
         AFTER FIELD ecbc010
       
      END CONSTRUCT
      
      CONSTRUCT g_wc4_table1 ON ecbd005,ecbd006,ecbd007,ecbd008
           FROM s_detail3[1].ecbd005,s_detail3[1].ecbd006,s_detail3[1].ecbd007,s_detail3[1].ecbd008
           
         BEFORE CONSTRUCT
            #CALL cl_qbe_display_condition(lc_qbe_sn)
            
         BEFORE FIELD ecbd005
        
         AFTER FIELD ecbd005
            
         ON ACTION controlp INFIELD ecbd005
            
         BEFORE FIELD ecbd006
           
         AFTER FIELD ecbd006
          
         ON ACTION controlp INFIELD ecbd006
            
         BEFORE FIELD ecbd007
         
         AFTER FIELD ecbd007
            
         ON ACTION controlp INFIELD ecbd007
           
         ON ACTION controlp INFIELD ecbd008
            
            
         BEFORE FIELD ecbd008
           
         AFTER FIELD ecbd008
       
      END CONSTRUCT]]>
  </point>
  <point name="cs.after_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_wc3 = g_wc3_table1
   LET g_wc4 = g_wc4_table1]]>
  </point>
  <point name="cs.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL g_ecbb2_d.clear()
   CALL g_ecbb3_d.clear()   
   INITIALIZE g_wc3 TO NULL
   INITIALIZE g_wc3_table1 TO NULL
   INITIALIZE g_wc4 TO NULL
   INITIALIZE g_wc4_table1 TO NULL]]>
  </point>
  <point name="delete.before_ask" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_ecba_m.ecbastus <> 'N' THEN
      CALL cl_err(g_ecba_m.ecbastus,'apm-00034',1)
      RETURN
   END IF]]>
  </point>
  <point name="delete.body.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      DELETE FROM ecbc_t
       WHERE ecbcent = g_enterprise 
         AND ecbcsite = g_site 
         AND ecbc001 = g_ecba_m.ecba001
         AND ecbc002 = g_ecba_m.ecba002
      IF SQLCA.sqlcode THEN
         CALL cl_err("ecbc_t",SQLCA.sqlcode,0) 
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      DELETE FROM ecbd_t
       WHERE ecbdent = g_enterprise 
         AND ecbdsite = g_site 
         AND ecbd001 = g_ecba_m.ecba001
         AND ecbd002 = g_ecba_m.ecba002
      IF SQLCA.sqlcode THEN
         CALL cl_err("ecbd_t",SQLCA.sqlcode,0) 
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      DELETE FROM ecbe_t
       WHERE ecbeent = g_enterprise 
         AND ecbesite = g_site 
         AND ecbe001 = g_ecba_m.ecba001 
         AND ecbe002 = g_ecba_m.ecba002
      IF SQLCA.sqlcode THEN
         CALL cl_err("ecbe_t",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
         RETURN   
      END IF
      DELETE FROM ecbf_t
       WHERE ecbfent = g_enterprise 
         AND ecbfsite = g_site 
         AND ecbf001 = g_ecba_m.ecba001 
         AND ecbf002 = g_ecba_m.ecba002
      IF SQLCA.sqlcode THEN
         CALL cl_err("ecbf_t",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
         RETURN  
      END IF
      DELETE FROM ecbg_t
       WHERE ecbgent = g_enterprise 
         AND ecbgsite = g_site 
         AND ecbg001 = g_ecba_m.ecba001 
         AND ecbg002 = g_ecba_m.ecba002
      IF SQLCA.sqlcode THEN
         CALL cl_err("ecbg_t",SQLCA.sqlcode,1)
         CALL s_transaction_end('N','0')
         RETURN
      END IF]]>
  </point>
  <point name="detail_reproduce.body.table1.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   #add by wuxj  ---2014/6/6---
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE aecm200_detail AS ",
                "SELECT * FROM ecbc_t "
   PREPARE repro_tb2 FROM ls_sql
   EXECUTE repro_tb2
   FREE repro_tb2
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO aecm200_detail SELECT * FROM ecbc_t 
                                         WHERE ecbcent = g_enterprise AND ecbcsite = g_site AND ecbc001 = g_ecba001_t
                                         AND ecbc002 = g_ecba002_t
 
   
   #將key修正為調整後   
   UPDATE aecm200_detail 
      #更新key欄位
      SET ecbc001 = g_ecba_m.ecba001
          , ecbc002 = g_ecba_m.ecba002
 
      #更新共用欄位
      
                                       
  
   #將資料塞回原table   
   INSERT INTO ecbc_t SELECT * FROM aecm200_detail
   
   IF SQLCA.sqlcode THEN
      CALL cl_err("reproduce",SQLCA.sqlcode,1)
      RETURN
   END IF
   
   DROP TABLE aecm200_detail
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE aecm200_detail AS ",
                "SELECT * FROM ecbd_t "
   PREPARE repro_tb3 FROM ls_sql
   EXECUTE repro_tb3
   FREE repro_tb3
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO aecm200_detail SELECT * FROM ecbd_t 
                                         WHERE ecbdent = g_enterprise AND ecbdsite = g_site AND ecbd001 = g_ecba001_t
                                         AND ecbd002 = g_ecba002_t
 
   
   #將key修正為調整後   
   UPDATE aecm200_detail 
      #更新key欄位
      SET ecbd001 = g_ecba_m.ecba001
          , ecbd002 = g_ecba_m.ecba002
 
      #更新共用欄位
       
   #將資料塞回原table   
   INSERT INTO ecbd_t SELECT * FROM aecm200_detail
   
   IF SQLCA.sqlcode THEN
      CALL cl_err("reproduce",SQLCA.sqlcode,1)
      RETURN
   END IF
   
   DROP TABLE aecm200_detail
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE aecm200_detail AS ",
                "SELECT * FROM ecbe_t "
   PREPARE repro_tb4 FROM ls_sql
   EXECUTE repro_tb4
   FREE repro_tb4
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO aecm200_detail SELECT * FROM ecbe_t 
                                         WHERE ecbeent = g_enterprise AND ecbesite = g_site AND ecbe001 = g_ecba001_t
                                         AND ecbe002 = g_ecba002_t
 
   
   #將key修正為調整後   
   UPDATE aecm200_detail 
      #更新key欄位
      SET ecbe001 = g_ecba_m.ecba001
          , ecbe002 = g_ecba_m.ecba002
 
      #更新共用欄位
       
   #將資料塞回原table   
   INSERT INTO ecbe_t SELECT * FROM aecm200_detail
   
   IF SQLCA.sqlcode THEN
      CALL cl_err("reproduce",SQLCA.sqlcode,1)
      RETURN
   END IF
   
   DROP TABLE aecm200_detail
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE aecm200_detail AS ",
                "SELECT * FROM ecbf_t "
   PREPARE repro_tb5 FROM ls_sql
   EXECUTE repro_tb5
   FREE repro_tb5
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO aecm200_detail SELECT * FROM ecbf_t 
                                         WHERE ecbfent = g_enterprise AND ecbfsite = g_site AND ecbf001 = g_ecba001_t
                                         AND ecbf002 = g_ecba002_t
 
   
   #將key修正為調整後   
   UPDATE aecm200_detail 
      #更新key欄位
      SET ecbf001 = g_ecba_m.ecba001
          , ecbf002 = g_ecba_m.ecba002
 
      #更新共用欄位
       
   #將資料塞回原table   
   INSERT INTO ecbf_t SELECT * FROM aecm200_detail
   
   IF SQLCA.sqlcode THEN
      CALL cl_err("reproduce",SQLCA.sqlcode,1)
      RETURN
   END IF
   
   DROP TABLE aecm200_detail
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE aecm200_detail AS ",
                "SELECT * FROM ecbg_t "
   PREPARE repro_tb6 FROM ls_sql
   EXECUTE repro_tb6
   FREE repro_tb6
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO aecm200_detail SELECT * FROM ecbg_t 
                                         WHERE ecbgent = g_enterprise AND ecbgsite = g_site AND ecbg001 = g_ecba001_t
                                         AND ecbg002 = g_ecba002_t
 
   
   #將key修正為調整後   
   UPDATE aecm200_detail 
      #更新key欄位
      SET ecbg001 = g_ecba_m.ecba001
          , ecbg002 = g_ecba_m.ecba002
 
      #更新共用欄位
       
   #將資料塞回原table   
   INSERT INTO ecbg_t SELECT * FROM aecm200_detail
   
   IF SQLCA.sqlcode THEN
      CALL cl_err("reproduce",SQLCA.sqlcode,1)
      RETURN
   END IF
   DROP TABLE aecm200_detail]]>
  </point>
  <point name="fetch.action_control" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[ # IF g_ecba_m.ecbastus = 'N'  THEN
 #    CALL cl_set_act_visible("modify,delete,reproduce", TRUE)
 # ELSE
 #    CALL cl_set_act_visible("modify,delete,reproduce", FALSE)
 # END IF]]>
  </point>
  <point name="global.variable" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#單身2 type 宣告
 TYPE type_g_ecbb2_d        RECORD
       ecbc004 LIKE ecbc_t.ecbc004, 
       ecbc005 LIKE ecbc_t.ecbc005,
       ecbc005_desc  LIKE type_t.chr80,
       ecbc005_desc1 LIKE type_t.chr80,   
       ecbc006 LIKE ecbc_t.ecbc006, 
       ecbc006_desc LIKE type_t.chr80, 
       ecbc007 LIKE ecbc_t.ecbc007, 
       ecbc008 LIKE ecbc_t.ecbc008, 
       ecbc009 LIKE ecbc_t.ecbc009, 
       ecbc010 LIKE ecbc_t.ecbc010
       END RECORD
#單身3 type 宣告
 TYPE type_g_ecbb3_d        RECORD
       ecbd005 LIKE ecbd_t.ecbd005,
       ecbd006 LIKE ecbd_t.ecbd006,
       ecbd007 LIKE ecbd_t.ecbd007, 
       ecbd008 LIKE ecbd_t.ecbd008
       END RECORD
       
DEFINE g_ecbb2_d          DYNAMIC ARRAY OF type_g_ecbb2_d
DEFINE g_ecbb2_d_t        type_g_ecbb2_d
DEFINE g_ecbb3_d          DYNAMIC ARRAY OF type_g_ecbb3_d
DEFINE g_ecbb3_d_t        type_g_ecbb3_d
DEFINE g_rec_b1           LIKE type_t.num5           
DEFINE l_ac1              LIKE type_t.num5
DEFINE g_rec_b2           LIKE type_t.num5           
DEFINE l_ac2              LIKE type_t.num5    
DEFINE g_wc3              STRING  
DEFINE g_wc3_table1       STRING
DEFINE g_wc4              STRING
DEFINE g_wc4_table1       STRING
DEFINE l_success          LIKE type_t.num5
#add by wuxj 
DEFINE g_ecbb4_d          DYNAMIC ARRAY OF RECORD
       l_text             LIKE type_t.chr80,
       l_value            LIKE type_t.chr80
                          END RECORD
DEFINE g_ecbb4_d_t        DYNAMIC ARRAY OF RECORD
       l_text             LIKE type_t.chr80,
       l_value            LIKE type_t.chr80
                          END RECORD
DEFINE l_ac3              LIKE type_t.num5]]>
  </point>
  <point name="idx_chk.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_current_page = 2 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail2")
      IF g_detail_idx > g_ecbb2_d.getLength() THEN
         LET g_detail_idx = g_ecbb2_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_ecbb2_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_ecbb_d.getLength() TO FORMONLY.cnt
   END IF
   IF g_current_page = 3 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail3")
      IF g_detail_idx > g_ecbb3_d.getLength() THEN
         LET g_detail_idx = g_ecbb3_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_ecbb3_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_ecbb_d.getLength() TO FORMONLY.cnt
   END IF
   ]]>
  </point>
  <point name="init.init" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL cl_set_combo_scc('ecbc010','1108') ]]>
  </point>
  <point name="input.a.ooeb013" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecba_m.ooeb013) AND NOT cl_null(g_ecba_m.ecba001) AND NOT cl_null(g_ecba_m.ecba002) THEN
               CALL s_aooi360_gen('6',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,'','','','','','','','4',g_ecba_m.ooeb013) RETURNING l_success
               IF NOT l_success THEN
                  NEXT FIELD ooeb013
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.ecbb006" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb007) THEN
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb006) THEN
                  LET l_n1 = 0
                  SELECT COUNT(*) INTO l_n1
                    FROM ecbb_t
                   WHERE ecbbent = g_enterprise
                     AND ecbbsite = g_site
                     AND ecbb001 = g_ecba_m.ecba001
                     AND ecbb002 = g_ecba_m.ecba002
                     AND ecbb003 <> g_ecbb_d[l_ac].ecbb003
                     AND ecbb006 <>'1'
                     AND ecbb006 <> g_ecbb_d[l_ac].ecbb006
                     AND ecbb007 = g_ecbb_d[l_ac].ecbb007
                  IF l_n1 > 0 THEN
                     CALL cl_err(g_ecbb_d[l_ac].ecbb006,'aec-00026',1)
                     LET g_ecbb_d[l_ac].ecbb006 = g_ecbb_d_t.ecbb006
                     NEXT FIELD ecbb006
                  END IF
               END IF
            END IF
            CALL aecm200_set_entry_b(l_cmd)
            CALL aecm200_set_no_entry_b(l_cmd)]]>
  </point>
  <point name="input.a.page1.ecbb007" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb007) THEN
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb006) THEN
                  LET l_n1 = 0
                  SELECT COUNT(*) INTO l_n1
                    FROM ecbb_t
                   WHERE ecbbent = g_enterprise
                     AND ecbbsite = g_site
                     AND ecbb001 = g_ecba_m.ecba001
                     AND ecbb002 = g_ecba_m.ecba002
                     AND ecbb003 <> g_ecbb_d[l_ac].ecbb003
                     AND ecbb006 <>'1'
                     AND ecbb006 <> g_ecbb_d[l_ac].ecbb006
                     AND ecbb007 = g_ecbb_d[l_ac].ecbb007
                  IF l_n1 > 0 THEN
                     CALL cl_err(g_ecbb_d[l_ac].ecbb007,'aec-00026',1)
                     LET g_ecbb_d[l_ac].ecbb007 = g_ecbb_d_t.ecbb007
                     NEXT FIELD ecbb007
                  END IF
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.ecbb009" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL aecm200_ecbb_desc()
            IF NOT cl_null(g_ecbb_d[l_ac].ecbb009) THEN
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb008) THEN
                  CALL aecm200_chk_ecbb008(l_cmd)
                  IF NOT cl_null(g_errno) THEN
                     CALL cl_err(g_ecbb_d[l_ac].ecbb009,g_errno,1)
                     LET g_ecbb_d[l_ac].ecbb009 = g_ecbb_d_t.ecbb009
                     CALL aecm200_ecbb_desc()
                     NEXT FIELD ecbb009
                  END IF
               END IF
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb004) AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) AND NOT cl_null(g_ecbb_d[l_ac].ecbb008) AND NOT cl_null(g_ecbb_d[l_ac].ecbb009) THEN
                  IF g_ecbb_d[l_ac].ecbb008 = g_ecbb_d[l_ac].ecbb004 AND g_ecbb_d[l_ac].ecbb009 = g_ecbb_d[l_ac].ecbb005 THEN
                     CALL cl_err(g_ecbb_d[l_ac].ecbb008,'aec-00008',1)
                     LET g_ecbb_d[l_ac].ecbb009 = g_ecbb_d_t.ecbb009
                     CALL aecm200_ecbb_desc()
                     NEXT FIELD ecbb009
                  END IF
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.ecbb021" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb021) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_ecbb_d[l_ac].ecbb021

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_ooca001") THEN
                  LET g_ecbb_d[l_ac].ecbb021 = g_ecbb_d_t.ecbb021
                  NEXT FIELD ecbb021
               END IF
               
            END IF]]>
  </point>
  <point name="input.a.page1.ecbb030" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb030) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_ecbb_d[l_ac].ecbb030

                  
               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_ooca001") THEN
                  LET g_ecbb_d[l_ac].ecbb030 = g_ecbb_d_t.ecbb030
                  NEXT FIELD ecbb030
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.ecbb031" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb031) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb032" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb032) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.ecbb033" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF g_ecbb_d[l_ac].ecbb033 = 'Y' THEN
               IF l_cmd = 'a' OR (l_cmd = 'u' AND g_ecbb_d[l_ac].ecbb033<>　g_ecbb_d_t.ecbb033) THEN
                  LET l_n1 = 0 
                  SELECT COUNT(*) INTO l_n1
                    FROM ecbb_t
                   WHERE ecbbent = g_enterprise
                     AND ecbbsite = g_site
                     AND ecbb001 = g_ecba_m.ecba001
                     AND ecbb002 = g_ecba_m.ecba002
                     AND ecbb003 <> g_ecbb_d[l_ac].ecbb003
                     AND ecbb033 = 'Y'
                  IF l_n1 > 0 THEN
                     CALL cl_err(g_ecbb_d[l_ac].ecbb033,'aec-00025',1)
                     LET g_ecbb_d[l_ac].ecbb033 = g_ecbb_d_t.ecbb033
                     NEXT FIELD ecbb033
                  END IF
               END IF
            END IF]]>
  </point>
  <point name="input.a.page1.ecbb034" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_ecbb_d[l_ac].ecbb034) THEN 
            END IF 
]]>
  </point>
  <point name="input.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF l_flag = 'N' THEN
      CONTINUE WHILE
   ELSE
      EXIT WHILE
   END IF 
   END WHILE]]>
  </point>
  <point name="input.after_set_entry" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_forupd_sql = "SELECT ecbc004,ecbc005,'','',ecbc006,'',ecbc007,ecbc008,ecbc009,ecbc010 FROM ecbc_t WHERE ecbcent=? AND ecbcsite=? AND ecbc001=? AND ecbc002=? AND ecbc003=? AND ecbc004=? FOR UPDATE"
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE aecm200_bcl2 CURSOR FROM g_forupd_sql
   
   LET g_forupd_sql = "SELECT ecbd005,ecbd006,ecbd007,ecbd008 FROM ecbd_t WHERE ecbdent=? AND ecbdsite=? AND ecbd001=? AND ecbd002=? AND ecbd003=? AND ecbd004=? AND ecbd005=? FOR UPDATE"
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE aecm200_bcl3 CURSOR FROM g_forupd_sql]]>
  </point>
  <point name="input.b.page1.ecbb008" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="input.before_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         IF l_flag = 'N' THEN
            NEXT FIELD l_value
         END IF]]>
  </point>
  <point name="input.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_errshow = 1 
   LET l_flag = 'Y'
   WHILE TRUE]]>
  </point>
  <point name="input.body.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                  DELETE FROM ecbe_t
                   WHERE ecbeent = g_enterprise 
                     AND ecbesite = g_site 
                     AND ecbe001 = g_ecba_m.ecba001 
                     AND ecbe002 = g_ecba_m.ecba002 
                     AND ecbe003 = g_ecbb_d_t.ecbb003
                  IF SQLCA.sqlcode THEN
                     CALL cl_err("ecbe_t",SQLCA.sqlcode,1)
                     CALL s_transaction_end('N','0')
                     CANCEL DELETE   
                  END IF
                  DELETE FROM ecbf_t
                   WHERE ecbfent = g_enterprise 
                     AND ecbfsite = g_site 
                     AND ecbf001 = g_ecba_m.ecba001 
                     AND ecbf002 = g_ecba_m.ecba002 
                     AND ecbf003 = g_ecbb_d_t.ecbb003
                  IF SQLCA.sqlcode THEN
                     CALL cl_err("ecbf_t",SQLCA.sqlcode,1)
                     CALL s_transaction_end('N','0')
                     CANCEL DELETE   
                  END IF
                  DELETE FROM ecbg_t
                   WHERE ecbgent = g_enterprise 
                     AND ecbgsite = g_site 
                     AND ecbg001 = g_ecba_m.ecba001 
                     AND ecbg002 = g_ecba_m.ecba002 
                     AND ecbg003 = g_ecbb_d_t.ecbb003
                  IF SQLCA.sqlcode THEN
                     CALL cl_err("ecbg_t",SQLCA.sqlcode,1)
                     CALL s_transaction_end('N','0')
                     CANCEL DELETE   
                  END IF
                  #add by wuxja 
                  CALL s_aooi360_del('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,' ',' ',' ',' ',' ',' ','4')
                     RETURNING l_success
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                  END IF
                  IF NOT aecm200_return_ecbb_mult() THEN
                     CALL s_transaction_end('N','0')
                  END IF
                  #end]]>
  </point>
  <point name="input.body.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#               LET l_sql = " SELECT * FROM ecab_t",
#                           "  WHERE ecabent = '",g_enterprise,"' ",
#                           "    AND ecab001 = '",g_ecbb_d[l_ac].ecbb004,"'"
#               PREPARE aecm200_sel_ecab_pb FROM l_sql
#               DECLARE aecm200_sel_ecab_cs CURSOR FOR aecm200_sel_ecab_pb
#               FOREACH aecm200_sel_ecab_cs INTO l_ecab.*
#                  LET l_n1 = 0
#                  SELECT COUNT(*) INTO l_n1
#                    FROM ecbf_t
#                   WHERE ecbfent = g_enterprise
#                     AND ecbfsite = g_site
#                     AND ecbf001 = g_ecba_m.ecba001
#                     AND ecbf002 = g_ecba_m.ecba002
#                     AND ecbf003 = g_ecbb_d[l_ac].ecbb003
#                     AND ecbf004 = l_ecab.ecab002
#                     AND ecbf005 = l_ecab.ecab003
#                  IF l_n1 = 0 THEN
#                     SELECT MAX(ecbfseq) +1 INTO l_ecbfseq
#                       FROM ecbf_t
#                      WHERE ecbfent = g_enterprise
#                        AND ecbfsite = g_site
#                        AND ecbf001 = g_ecba_m.ecba001
#                        AND ecbf002 = g_ecba_m.ecba002
#                        AND ecbf003 = g_ecbb_d[l_ac].ecbb003
#                     IF cl_null(l_ecbfseq) THEN
#                        LET l_ecbfseq = 1
#                     END IF
#                     INSERT INTO ecbf_t(ecbfent,ecbfsite,ecbf001,ecbf002,ecbf003,ecbfseq,ecbf004,ecbf005,ecbf006,ecbf007,ecbf008,ecbf009,ecbf010)
#                                 VALUES(g_enterprise,g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,l_ecbfseq,l_ecab.ecab002,l_ecab.ecab003,l_ecab.ecab004,l_ecab.ecab005,l_ecab.ecab006,l_ecab.ecab007,l_ecab.ecab008)
#                     IF SQLCA.sqlcode THEN
#                        CALL cl_err("ins_ecbf_t",SQLCA.sqlcode,1) 
#                        CALL s_transaction_end('N','0')
#                     END IF    
#                  END IF
#               END FOREACH
               LET l_sql = " MERGE INTO ecbf_t ",
                           " USING (SELECT ecab001,ecabseq,ecab002,ecab003,ecab004,ecab005,ecab006,ecab007,ecab008",
                           "          FROM ecab_t ",
                           "         WHERE ecabent = '",g_enterprise,"' AND ecab001 = '",g_ecbb_d[l_ac].ecbb004,"') ",
                           "    ON (ecab002 = ecbf004 AND ecab003 = ecbf005 AND ecbf002 = '",g_ecba_m.ecba002,"'",
                           "        AND ecbfent = '",g_enterprise,"' AND ecbfsite = '",g_site,"' AND ecbf001 = '",g_ecba_m.ecba001,"'",
                           "        AND ecbf003 = '",g_ecbb_d[l_ac].ecbb003,"')",
                           "  WHEN NOT MATCHED THEN ",
                           "INSERT(ecbfent,ecbfsite,ecbf001,ecbf002,ecbf003,ecbfseq,ecbf004,ecbf005,ecbf006,ecbf007,ecbf008,ecbf009,ecbf010) ",
                           "VALUES('",g_enterprise,"','",g_site,"','",g_ecba_m.ecba001,"','",g_ecba_m.ecba002,"','",g_ecbb_d[l_ac].ecbb003,"',ecabseq,ecab002,ecab003,ecab004,ecab005,ecab006,ecab007,ecab008)"
               PREPARE aecm200_ins_ecbf_pre FROM l_sql
               EXECUTE aecm200_ins_ecbf_pre
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ins_ecbf_t",SQLCA.sqlcode,1) 
                  CALL s_transaction_end('N','0')
               END IF            
               IF g_ecbb_d[l_ac].ecbb008 <> 'MULT' THEN
                  LET l_n1 = 0
                  SELECT COUNT(*) INTO l_n1
                    FROM ecbe_t
                   WHERE ecbeent = g_enterprise
                     AND ecbesite = g_site
                     AND ecbe001 = g_ecba_m.ecba001
                     AND ecbe002 = g_ecba_m.ecba002
                     AND ecbe003 = g_ecbb_d[l_ac].ecbb003
                     AND ecbe004 = g_ecbb_d[l_ac].ecbb008
                     AND ecbe005 = g_ecbb_d[l_ac].ecbb009
                  SELECT MAX(ecbeseq) +1 INTO l_ecbeseq
                    FROM ecbe_t
                   WHERE ecbeent = g_enterprise
                     AND ecbesite = g_site
                     AND ecbe001 = g_ecba_m.ecba001
                     AND ecbe002 = g_ecba_m.ecba002
                     AND ecbe003 = g_ecbb_d[l_ac].ecbb003
                  IF cl_null(l_ecbeseq) THEN
                     LET l_ecbeseq = 1
                  END IF
                  IF l_n1 = 0 THEN
                     INSERT INTO ecbe_t(ecbeent,ecbesite,ecbe001,ecbe002,ecbe003,ecbeseq,ecbe004,ecbe005)
                                 VALUES(g_enterprise,g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,l_ecbeseq,g_ecbb_d[l_ac].ecbb008,g_ecbb_d[l_ac].ecbb009)
                     IF SQLCA.sqlcode THEN
                        CALL cl_err("ins_ecbe_t",SQLCA.sqlcode,1) 
                        CALL s_transaction_end('N','0')
                     END IF
                  END IF
               END IF 
               #add by wuxja 
               IF NOT cl_null(g_ecbb_d[l_ac].ooff013) THEN
                  CALL s_aooi360_gen('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,' ',' ',' ',' ',' ',' ','4',g_ecbb_d[l_ac].ooff013)
                     RETURNING l_success
               ELSE
                  CALL s_aooi360_del('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,' ',' ',' ',' ',' ',' ','4')
                     RETURNING l_success
               END IF
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
               END IF
               #end
               #CALL aecm200_return_ecbb_mult()
               IF NOT aecm200_return_ecbb_mult() THEN
                  CALL s_transaction_end('N','0')
               END IF
               CALL aecm200_b_fill()]]>
  </point>
  <point name="input.body.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[               IF g_ecbb_d[l_ac].ecbb008 <> 'MULT' THEN
                  UPDATE ecbe_t SET ecbe004 = g_ecbb_d[l_ac].ecbb008,
                                    ecbe005 = g_ecbb_d[l_ac].ecbb009
                   WHERE ecbeent = g_enterprise
                     AND ecbesite = g_site
                     AND ecbe001 = g_ecba_m.ecba001
                     AND ecbe002 = g_ecba_m.ecba002
                     AND ecbe003 = g_ecbb_d[l_ac].ecbb003
                     AND ecbe004 = g_ecbb_d_t.ecbb008
                     AND ecbe005 = g_ecbb_d_t.ecbb009
                  IF SQLCA.sqlcode THEN
                     CALL cl_err("ecbe_t",SQLCA.sqlcode,1) 
                     CALL s_transaction_end('N','0')
                  END IF
               END IF
               #add by wuxja
               IF NOT cl_null(g_ecbb_d[l_ac].ooff013) THEN
                  CALL s_aooi360_gen('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,' ',' ',' ',' ',' ',' ','4',g_ecbb_d[l_ac].ooff013)
                     RETURNING l_success
               ELSE
                  CALL s_aooi360_del('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,' ',' ',' ',' ',' ',' ','4')
                     RETURNING l_success
               END IF
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
               END IF
               #end
               #CALL aecm200_return_ecbb_mult()
               IF NOT aecm200_return_ecbb_mult() THEN
                  CALL s_transaction_end('N','0')
               END IF
               CALL aecm200_b_fill()]]>
  </point>
  <point name="input.body.before_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #add by wuxja ---begin---
            SELECT MAX(ecbb003) INTO g_ecbb_d[l_ac].ecbb003 FROM ecbb_t
             WHERE ecbbent = g_enterprise
               AND ecbbsite = g_site
               AND ecbb001 = g_ecba_m.ecba001
               AND ecbb002 = g_ecba_m.ecba002
            CALL cl_get_para(g_enterprise,g_site,'E-MFG-0001') RETURNING l_sys
            IF cl_null(l_sys) OR l_sys = 0 THEN LET l_sys = 1 END IF 
            IF cl_null(g_ecbb_d[l_ac].ecbb003) THEN
               LET g_ecbb_d[l_ac].ecbb003 = l_sys
               LET g_ecbb_d[l_ac].ecbb008 = 'INIT'
               LET g_ecbb_d[l_ac].ecbb009 ='0'
            ELSE           
               SELECT ecbb004,ecbb005 INTO g_ecbb_d[l_ac].ecbb008,g_ecbb_d[l_ac].ecbb009 FROM ecbb_t
                WHERE ecbbent = g_enterprise
                  AND ecbbsite = g_site
                  AND ecbb001 = g_ecba_m.ecba001
                  AND ecbb002 = g_ecba_m.ecba002
                  AND ecbb003 = g_ecbb_d[l_ac].ecbb003
               LET g_ecbb_d[l_ac].ecbb003 = g_ecbb_d[l_ac].ecbb003 + l_sys
            END IF
            #end
            
            SELECT imae016 INTO g_ecbb_d[l_ac].ecbb021
              FROM imae_t
             WHERE imaeent = g_enterprise
               AND imaesite = g_site
               AND imae001 = g_ecba_m.ecba001
            #add by wuxj
            IF cl_null(g_ecbb_d[l_ac].ecbb021) THEN
               SELECT imaa006 INTO g_ecbb_d[l_ac].ecbb021 FROM imaa_t
                WHERE imaaent = g_enterprise AND imaa001 = g_ecba_m.ecba001
            END IF
            LET g_ecbb_d[l_ac].ecbb030 = g_ecbb_d[l_ac].ecbb021
            #end

            CALL g_ecbb2_d.clear()]]>
  </point>
  <point name="input.body.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.c.page1.ecbb030" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_ecbb_d[l_ac].ecbb030             #給予default值

            #給予arg

            CALL q_ooca001()                                #呼叫開窗

            LET g_ecbb_d[l_ac].ecbb030 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_ecbb_d[l_ac].ecbb030 TO ecbb030              #顯示到畫面上

            NEXT FIELD ecbb030                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.ooff013" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE  l_n1                  LIKE type_t.num5
   DEFINE  l_sql                 STRING
   DEFINE  l_success             LIKE type_t.num5
   DEFINE  l_ecbeseq             LIKE ecbe_t.ecbeseq
   DEFINE  l_ecbfseq             LIKE ecbf_t.ecbfseq
   DEFINE  l_ecab                RECORD LIKE ecab_t.*
   DEFINE  l_flag                LIKE type_t.chr1    #add by wuxja
   DEFINE  l_n2                  LIKE type_t.chr2    #add by wuxja
   DEFINE  l_sys                 LIKE type_t.num5    #add by wuxja]]>
  </point>
  <point name="input.detail_input.page1.checkin" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                   CALL aecm200_02(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'1','Y','N')
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="input.detail_input.page1.checkout" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                   CALL aecm200_02(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'2','Y','N')
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="input.detail_input.page1.resource" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                   CALL aecm200_03(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'Y','N')
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="input.detail_input.page1.stand" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                   IF g_ecba_m.ecbastus = 'N' AND g_ecbb_d[l_ac].ecbb008 = 'MULT'  THEN
                      CALL aecm200_01(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'Y','N')
                   ELSE
                      CALL aecm200_01(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'N','N')
                   END IF
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="input.g.page1.ecbb006" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.ecbb008" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.ooff013" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            ON ACTION controlp INFIELD ooff013
               IF NOT cl_null(g_ecbb_d[l_ac].ecbb003) THEN
                  CALL aooi360_02('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,'','','','','','','4')
                  CALL s_aooi360_sel('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,'','','','','','','4') RETURNING l_success,g_ecbb_d[l_ac].ooff013
               END IF]]>
  </point>
  <point name="input.more_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      
      INPUT ARRAY g_ecbb2_d FROM s_detail2.*
          ATTRIBUTE(COUNT = g_rec_b1,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         
         BEFORE INPUT
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
               CALL FGL_SET_ARR_CURR(g_ecbb2_d.getLength()+1) 
               LET g_insert = 'N' 
           END IF 
           CALL aecm200_b_fill_1()
           LET g_rec_b1 = g_ecbb2_d.getLength()
           IF cl_null(g_ecbb_d[l_ac].ecbb003) THEN
              NEXT FIELD ecbb003
           END IF
           
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac1 = ARR_CURR()
            LET g_detail_idx = l_ac1
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac1 TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aecm200_cl USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002
            IF STATUS THEN
               CALL cl_err("OPEN aecm200_cl:", STATUS, 1)
               CLOSE aecm200_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            LET g_rec_b1 = g_ecbb2_d.getLength()
            
            IF g_rec_b1 >= l_ac1 AND NOT cl_null(g_ecbb2_d[l_ac1].ecbc004) THEN
               LET l_cmd='u'
               LET g_ecbb2_d_t.* = g_ecbb2_d[l_ac1].*  #BACKUP
               CALL aecm200_set_entry_b(l_cmd)
               CALL aecm200_set_no_entry_b(l_cmd)
               OPEN aecm200_bcl2 USING g_enterprise,g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004
               IF SQLCA.sqlcode THEN
                  CALL cl_err("aecm200_bcl2",SQLCA.sqlcode,1)
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aecm200_bcl2 INTO g_ecbb2_d[l_ac1].ecbc004,g_ecbb2_d[l_ac1].ecbc005,g_ecbb2_d[l_ac1].ecbc005_desc,g_ecbb2_d[l_ac1].ecbc005_desc1,g_ecbb2_d[l_ac1].ecbc006,g_ecbb2_d[l_ac1].ecbc006_desc,g_ecbb2_d[l_ac1].ecbc007,g_ecbb2_d[l_ac1].ecbc008,g_ecbb2_d[l_ac1].ecbc009,g_ecbb2_d[l_ac1].ecbc010
                  IF SQLCA.sqlcode THEN
                     CALL cl_err(g_ecbb2_d_t.ecbc004,SQLCA.sqlcode,1)
                     LET l_lock_sw = "Y"
                  END IF
                  LET g_bfill = "N"
                  CALL aecm200_show()
                  LET g_bfill = "Y"
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
        
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_ecbb2_d[l_ac1].* TO NULL 
            LET g_ecbb2_d[l_ac1].ecbc007 = 1
            LET g_ecbb2_d[l_ac1].ecbc008 = 1
            LET g_ecbb2_d[l_ac1].ecbc010 = "1"
            LET g_ecbb2_d_t.* = g_ecbb2_d[l_ac1].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aecm200_set_entry_b(l_cmd)
            CALL aecm200_set_no_entry_b(l_cmd)
            SELECT MAX(ecbc004)+1 INTO g_ecbb2_d[l_ac1].ecbc004
              FROM ecbc_t
             WHERE ecbcent = g_enterprise
               AND ecbcsite = g_site 
               AND ecbc001 = g_ecba_m.ecba001
               AND ecbc002 = g_ecba_m.ecba002
               AND ecbc003 = g_ecbb_d[l_ac].ecbb003
            IF cl_null(g_ecbb2_d[l_ac1].ecbc004) THEN
               LET g_ecbb2_d[l_ac1].ecbc004 = 1
               DISPLAY BY NAME g_ecbb2_d[l_ac1].ecbc004 
            END IF
            CALL g_ecbb3_d.clear()
            
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
            IF cl_null(g_ecbb2_d[l_ac1].ecbc006) THEN
               LET g_ecbb2_d[l_ac1].ecbc006 = ' '
            END IF
            LET l_count = 1  
            SELECT COUNT(*) INTO l_count FROM ecbc_t 
             WHERE ecbcent = g_enterprise
               AND ecbcsite = g_site 
               AND ecbc001 = g_ecba_m.ecba001
               AND ecbc002 = g_ecba_m.ecba002
               AND ecbc003 = g_ecbb_d[l_ac].ecbb003
               AND ecbc004 = g_ecbb2_d[l_ac1].ecbc004
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               INSERT INTO ecbc_t(ecbcent,ecbcsite,ecbc001,ecbc002,ecbc003,ecbc004,ecbc005,ecbc006,ecbc007,ecbc008,ecbc009,ecbc010) 
                           VALUES(g_enterprise,g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004,g_ecbb2_d[l_ac1].ecbc005,g_ecbb2_d[l_ac1].ecbc006,g_ecbb2_d[l_ac1].ecbc007,g_ecbb2_d[l_ac1].ecbc008,g_ecbb2_d[l_ac1].ecbc009,g_ecbb2_d[l_ac1].ecbc010)
            ELSE    
               CALL cl_err('INSERT',"std-00006",1)
               INITIALIZE g_ecbb2_d[l_ac1].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               CALL cl_err("ecbc_t",SQLCA.sqlcode,1)  
               CALL s_transaction_end('N','0')                    
               CANCEL INSERT
            ELSE
               CALL s_transaction_end('Y','0')
               ERROR 'INSERT O.K'
               LET g_rec_b1 = g_rec_b1 + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               CALL FGL_SET_ARR_CURR(l_ac1-1)
               CALL g_ecbb2_d.deleteElement(l_ac1)
               NEXT FIELD ecbc004
            END IF
         
            IF NOT cl_null(g_ecbb2_d[l_ac1].ecbc004) THEN 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  CALL cl_err("", -263, 1)
                  CANCEL DELETE
               END IF
               DELETE FROM ecbc_t
                WHERE ecbcent = g_enterprise
                  AND ecbcsite = g_site 
                  AND ecbc001 = g_ecba_m.ecba001 
                  AND ecbc002 = g_ecba_m.ecba002 
                  AND ecbc003 = g_ecbb_d[l_ac].ecbb003
                  AND ecbc004 = g_ecbb2_d_t.ecbc004
               
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbc_t",SQLCA.sqlcode,1)
                  CALL s_transaction_end('N','0')
                  CANCEL DELETE   
               ELSE
                  LET g_rec_b1 = g_rec_b1-1
                  CALL s_transaction_end('Y','0')
               END IF 
               CLOSE aecm200_bcl2
               LET l_count = g_ecbb2_d.getLength()
            END IF 
            
              
         AFTER DELETE 
            DELETE FROM ecbc_t
             WHERE ecbcent = g_enterprise
               AND ecbcsite = g_site 
               AND ecbc001 = g_ecba_m.ecba001 
               AND ecbc002 = g_ecba_m.ecba002 
               AND ecbc003 = g_ecbb_d[l_ac].ecbb003
               AND ecbc004 = g_ecbb2_d_t.ecbc004
               
         AFTER FIELD ecbc004
            IF NOT cl_ap_chk_Range(g_ecbb2_d[l_ac1].ecbc004,"0","0","","","azz-00079",1) THEN
               NEXT FIELD ecbc004
            END IF
            IF NOT cl_null(g_ecba_m.ecba001) AND NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb2_d[l_ac1].ecbc004) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND g_ecbb2_d[l_ac1].ecbc004 != g_ecbb2_d_t.ecbc004) THEN 
                  IF NOT ap_chk_notDup(g_ecbb2_d[l_ac1].ecbc004,"SELECT COUNT(*) FROM ecbc_t WHERE "||"ecbcent = '" ||g_enterprise|| "' AND ecbcsite = '" ||g_site|| "' AND "||"ecbc001 = '"||g_ecba_m.ecba001 ||"' AND "|| "ecbc002 = '"||g_ecba_m.ecba002 ||"' AND "|| "ecbc003 = '"||g_ecbb_d[l_ac].ecbb003 ||"' AND "|| "ecbc004 = '"||g_ecbb2_d[l_ac1].ecbc004 ||"'",'std-00004',0) THEN 
                     LET g_ecbb2_d[l_ac1].ecbc004 = g_ecbb2_d_t.ecbc004
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            
         BEFORE FIELD ecbc004

         ON CHANGE ecbc004
   

         AFTER FIELD ecbc005
            CALL aecm200_ecbc_desc()
            IF NOT cl_null(g_ecbb2_d[l_ac1].ecbc005) THEN 
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_ecbb2_d[l_ac1].ecbc005

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_imaf001_1") THEN
                  LET g_ecbb2_d[l_ac1].ecbc005 = g_ecbb2_d_t.ecbc005
                  CALL aecm200_ecbc_desc()
                  NEXT FIELD ecbc005
               END IF
               
               IF g_ecbb2_d[l_ac1].ecbc005 = g_ecba_m.ecba001 THEN
                  CALL cl_err(g_ecbb2_d[l_ac1].ecbc005,'aec-00003',1)
                  LET g_ecbb2_d[l_ac1].ecbc005 = g_ecbb2_d_t.ecbc005
                  CALL aecm200_ecbc_desc()
                  NEXT FIELD ecbc005
               END IF
               CALL aecm200_def_ecbc009()
            END IF 

         BEFORE FIELD ecbc005
          
         ON CHANGE ecbc005
        
         BEFORE FIELD ecbc006
            
         AFTER FIELD ecbc006
            CALL aecm200_ecbc_desc()
            IF NOT cl_null(g_ecbb2_d[l_ac1].ecbc006) THEN 
               CALL s_azzi650_chk_exist('215',g_ecbb2_d[l_ac1].ecbc006) RETURNING l_success
               IF NOT l_success THEN
                  LET g_ecbb2_d[l_ac1].ecbc006 = g_ecbb2_d_t.ecbc006
                  CALL aecm200_ecbc_desc()
                  NEXT FIELD ecbc006
               END IF
            END IF 
            
         ON CHANGE ecbc006
        
         BEFORE FIELD ecbc007

         AFTER FIELD ecbc007
            IF NOT cl_ap_chk_Range(g_ecbb2_d[l_ac1].ecbc007,"0.000","1","","","azz-00079",1) THEN
               LET g_ecbb2_d[l_ac1].ecbc007 = g_ecbb2_d_t.ecbc007
               NEXT FIELD ecbc007
            END IF
            
         ON CHANGE ecbc007
           
         AFTER FIELD ecbc008
            IF NOT cl_ap_chk_Range(g_ecbb2_d[l_ac1].ecbc008,"0.000","0","","","azz-00079",1) THEN
               LET g_ecbb2_d[l_ac1].ecbc008 = g_ecbb2_d_t.ecbc008
               NEXT FIELD ecbc008
            END IF
            
         BEFORE FIELD ecbc008
            
         ON CHANGE ecbc008
            
         BEFORE FIELD ecbc009
            
         AFTER FIELD ecbc009
            IF NOT cl_null(g_ecbb2_d[l_ac1].ecbc009) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_ecbb2_d[l_ac1].ecbc009

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_ooca001") THEN
                  LET g_ecbb2_d[l_ac1].ecbc009 = g_ecbb2_d_t.ecbc009
                  NEXT FIELD ecbc009
               END IF
               
               IF NOT aecm200_chk_ecbc009() THEN
                  IF NOT cl_null(g_errno) THEN
                     CALL cl_err(g_ecbb2_d[l_ac1].ecbc009,g_errno,1)
                  END IF
                  LET g_ecbb2_d[l_ac1].ecbc009 = g_ecbb2_d_t.ecbc009
                  NEXT FIELD ecbc009
               END IF
               
            END IF
            
         ON CHANGE ecbc009
           
         AFTER FIELD ecbc010
           
         BEFORE FIELD ecbc010
           
         ON CHANGE ecbc010
           
         ON ACTION controlp INFIELD ecbc004

         ON ACTION controlp INFIELD ecbc005
            #開窗i段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_ecbb2_d[l_ac1].ecbc005     #給予default值
            CALL q_imaf001_6()                                       #呼叫開窗
            LET g_ecbb2_d[l_ac1].ecbc005 = g_qryparam.return1      #將開窗取得的值回傳到變數
            DISPLAY g_ecbb2_d[l_ac1].ecbc005 TO ecbc005            #顯示到畫面上
            CALL aecm200_ecbc_desc()
            NEXT FIELD ecbc005                                     #返回原欄位
            
         ON ACTION controlp INFIELD ecbc006
            #開窗i段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_ecbb2_d[l_ac1].ecbc006     #給予default值
            #給予arg
            LET g_qryparam.arg1 = "215" 
            CALL q_oocq002()                                       #呼叫開窗
            LET g_ecbb2_d[l_ac1].ecbc006 = g_qryparam.return1      #將開窗取得的值回傳到變數
            DISPLAY g_ecbb2_d[l_ac1].ecbc006 TO ecbc006            #顯示到畫面上
            CALL aecm200_ecbc_desc()
            NEXT FIELD ecbc006                                     #返回原欄位
            
         ON ACTION controlp INFIELD ecbc007
            
         ON ACTION controlp INFIELD ecbc008
     
         ON ACTION controlp INFIELD ecbc009
            #開窗i段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_ecbb2_d[l_ac1].ecbc009     #給予default值
            CALL q_ooca001_1()                                       #呼叫開窗
            LET g_ecbb2_d[l_ac1].ecbc009 = g_qryparam.return1      #將開窗取得的值回傳到變數
            DISPLAY g_ecbb2_d[l_ac1].ecbc009 TO ecbc009            #顯示到畫面上
            NEXT FIELD ecbc009   
            
         ON ACTION controlp INFIELD ecbc010

 
         ON ROW CHANGE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               LET g_ecbb2_d[l_ac1].* = g_ecbb2_d_t.*
               CLOSE aecm200_bcl2
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               CALL cl_err(g_ecbb2_d[l_ac1].ecbc004,-263,1)
               LET g_ecbb2_d[l_ac1].* = g_ecbb2_d_t.*
            ELSE
               #寫入修改者/修改日期資訊(單身)
               UPDATE ecbc_t SET (ecbc001,ecbc002,ecbc003,ecbc004,ecbc005,ecbc006,ecbc007,ecbc008,ecbc009,ecbc010)
                               = (g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004,g_ecbb2_d[l_ac1].ecbc005,g_ecbb2_d[l_ac1].ecbc006,g_ecbb2_d[l_ac1].ecbc007,g_ecbb2_d[l_ac1].ecbc008,g_ecbb2_d[l_ac1].ecbc009,g_ecbb2_d[l_ac1].ecbc010)
                WHERE ecbcent = g_enterprise 
                  AND ecbcsite = g_site 
                  AND ecbc001 = g_ecba_m.ecba001 
                  AND ecbc002 = g_ecba_m.ecba002 
                  AND ecbc003 = g_ecbb_d[l_ac].ecbb003
                  AND ecbc004 = g_ecbb2_d_t.ecbc004 #項次   
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbc_t",SQLCA.sqlcode,1)   
                  LET g_ecbb2_d[l_ac1].* = g_ecbb2_d_t.*
               ELSE
                  UPDATE ecbc_t SET (ecbc001,ecbc002,ecbc003,ecbc004,ecbc005,ecbc006,ecbc007,ecbc008,ecbc009,ecbc010)
                                  = (g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004,g_ecbb2_d[l_ac1].ecbc005,g_ecbb2_d[l_ac1].ecbc006,g_ecbb2_d[l_ac1].ecbc007,g_ecbb2_d[l_ac1].ecbc008,g_ecbb2_d[l_ac1].ecbc009,g_ecbb2_d[l_ac1].ecbc010)
                   WHERE ecbcent = g_enterprise 
                     AND ecbcsite = g_site 
                     AND ecbc001 = g_ecba_m.ecba001 
                     AND ecbc002 = g_ecba_m.ecba002 
                     AND ecbc003 = g_ecbb_d[l_ac].ecbb003
                     AND ecbc004 = g_ecbb2_d_t.ecbc004 #項次 
               END IF
              
            END IF
            
         AFTER ROW
      
            CLOSE aecm200_bcl2
            CALL s_transaction_end('Y','0')
              
         AFTER INPUT
         
      END INPUT
      
      
      INPUT ARRAY g_ecbb3_d FROM s_detail3.*
          ATTRIBUTE(COUNT = g_rec_b2,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         
         BEFORE INPUT
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
               CALL FGL_SET_ARR_CURR(g_ecbb3_d.getLength()+1) 
               LET g_insert = 'N' 
           END IF 
           CALL aecm200_b_fill_2()
           LET g_rec_b2 = g_ecbb3_d.getLength()
           IF cl_null(g_ecbb2_d[l_ac1].ecbc004) THEN
              NEXT FIELD ecbc004
           END IF
           
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac2 = ARR_CURR()
            LET g_detail_idx = l_ac2
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac2 TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aecm200_cl USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002
            IF STATUS THEN
               CALL cl_err("OPEN aecm200_cl:", STATUS, 1)
               CLOSE aecm200_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            LET g_rec_b2 = g_ecbb3_d.getLength()
            
            IF g_rec_b2 >= l_ac2 AND NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) THEN
               LET l_cmd='u'
               LET g_ecbb3_d_t.* = g_ecbb3_d[l_ac2].*  #BACKUP
               CALL aecm200_set_entry_b(l_cmd)
               CALL aecm200_set_no_entry_b(l_cmd)
               OPEN aecm200_bcl3 USING g_enterprise,g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004,g_ecbb3_d[l_ac2].ecbd005
               IF SQLCA.sqlcode THEN
                  CALL cl_err("aecm200_bcl3",SQLCA.sqlcode,1)
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aecm200_bcl3 INTO g_ecbb3_d[l_ac2].ecbd005,g_ecbb3_d[l_ac2].ecbd006,g_ecbb3_d[l_ac2].ecbd007,g_ecbb3_d[l_ac2].ecbd008
                  IF SQLCA.sqlcode THEN
                     CALL cl_err(g_ecbb3_d_t.ecbd005,SQLCA.sqlcode,1)
                     LET l_lock_sw = "Y"
                  END IF
                  LET g_bfill = "N"
                  CALL aecm200_show()
                  LET g_bfill = "Y"
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            
        
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_ecbb3_d[l_ac2].* TO NULL 
            LET g_ecbb3_d[l_ac2].ecbd007 = 0
            LET g_ecbb3_d[l_ac2].ecbd008 = 0
            LET g_ecbb3_d_t.* = g_ecbb3_d[l_ac2].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aecm200_set_entry_b(l_cmd)
            CALL aecm200_set_no_entry_b(l_cmd)
            CALL aecm200_def_ecbd005()
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
            LET l_count = 1  
            SELECT COUNT(*) INTO l_count FROM ecbd_t 
             WHERE ecbdent = g_enterprise
               AND ecbdsite = g_site 
               AND ecbd001 = g_ecba_m.ecba001
               AND ecbd002 = g_ecba_m.ecba002
               AND ecbd003 = g_ecbb_d[l_ac].ecbb003
               AND ecbd004 = g_ecbb2_d[l_ac1].ecbc004
               AND ecbd005 = g_ecbb3_d[l_ac2].ecbd005
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               INSERT INTO ecbd_t(ecbdent,ecbdsite,ecbd001,ecbd002,ecbd003,ecbd004,ecbd005,ecbd006,ecbd007,ecbd008) 
                           VALUES(g_enterprise,g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004,g_ecbb3_d[l_ac2].ecbd005,g_ecbb3_d[l_ac2].ecbd006,g_ecbb3_d[l_ac2].ecbd007,g_ecbb3_d[l_ac2].ecbd008)
            ELSE    
               CALL cl_err('INSERT',"std-00006",1)
               INITIALIZE g_ecbb3_d[l_ac2].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               CALL cl_err("ecbd_t",SQLCA.sqlcode,1)  
               CALL s_transaction_end('N','0')                    
               CANCEL INSERT
            ELSE
               CALL s_transaction_end('Y','0')
               ERROR 'INSERT O.K'
               LET g_rec_b2 = g_rec_b2 + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               CALL FGL_SET_ARR_CURR(l_ac2-1)
               CALL g_ecbb3_d.deleteElement(l_ac2)
               NEXT FIELD ecbd005
            END IF
         
            IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) THEN 
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  CALL cl_err("", -263, 1)
                  CANCEL DELETE
               END IF
               DELETE FROM ecbd_t
                WHERE ecbdent = g_enterprise
                  AND ecbdsite = g_site 
                  AND ecbd001 = g_ecba_m.ecba001 
                  AND ecbd002 = g_ecba_m.ecba002 
                  AND ecbd003 = g_ecbb_d[l_ac].ecbb003
                  AND ecbd004 = g_ecbb2_d[l_ac1].ecbc004
                  AND ecbd005 = g_ecbb3_d_t.ecbd005
               
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbd_t",SQLCA.sqlcode,1)
                  CALL s_transaction_end('N','0')
                  CANCEL DELETE   
               ELSE
                  LET g_rec_b2 = g_rec_b2-1
                  CALL s_transaction_end('Y','0')
               END IF 
               CLOSE aecm200_bcl3
               LET l_count = g_ecbb3_d.getLength()
            END IF 
            
              
         AFTER DELETE 
            DELETE FROM ecbd_t
             WHERE ecbdent = g_enterprise
               AND ecbdsite = g_site 
               AND ecbd001 = g_ecba_m.ecba001 
               AND ecbd002 = g_ecba_m.ecba002 
               AND ecbd003 = g_ecbb_d[l_ac].ecbb003
               AND ecbd004 = g_ecbb2_d[l_ac1].ecbc004
               AND ecbd005 = g_ecbb3_d_t.ecbd005
               
         AFTER FIELD ecbd005
            IF NOT cl_ap_chk_Range(g_ecbb3_d[l_ac2].ecbd005,"0.000","1","","","azz-00079",1) THEN
               LET g_ecbb3_d[l_ac2].ecbd005 = g_ecbb3_d_t.ecbd005
               NEXT FIELD ecbd005
            END IF
            IF NOT cl_null(g_ecba_m.ecba001) AND NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb2_d[l_ac1].ecbc004) AND NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND g_ecbb3_d[l_ac2].ecbd005 != g_ecbb3_d_t.ecbd005) THEN 
                  IF NOT ap_chk_notDup(g_ecbb3_d[l_ac2].ecbd005,"SELECT COUNT(*) FROM ecbd_t WHERE "||"ecbdent = '" ||g_enterprise|| "' AND ecbdsite = '" ||g_site|| "' AND "||"ecbd001 = '"||g_ecba_m.ecba001 ||"' AND "|| "ecbd002 = '"||g_ecba_m.ecba002 ||"' AND "|| "ecbd003 = '"||g_ecbb_d[l_ac].ecbb003 ||"' AND "|| "ecbd004 = '"||g_ecbb2_d[l_ac1].ecbc004 ||"' AND "|| "ecbd005 = '"||g_ecbb3_d[l_ac2].ecbd005 ||"'",'std-00004',0) THEN 
                     LET g_ecbb3_d[l_ac2].ecbd005 = g_ecbb3_d_t.ecbd005
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) THEN
               IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd006) THEN
                  IF g_ecbb3_d[l_ac2].ecbd005 > g_ecbb3_d[l_ac2].ecbd006 THEN
                     CALL cl_err(g_ecbb3_d[l_ac2].ecbd005,'aec-00005',1)
                     LET g_ecbb3_d[l_ac2].ecbd005 = g_ecbb3_d_t.ecbd005
                     NEXT FIELD ecbd005
                  END IF
               END IF
               CALL aecm200_chk_ecbd005(g_ecbb3_d[l_ac2].ecbd005,'1',l_cmd)
               IF NOT cl_null(g_errno) THEN
                  CALL cl_err(g_ecbb3_d[l_ac2].ecbd005,g_errno,1)
                  LET g_ecbb3_d[l_ac2].ecbd005 = g_ecbb3_d_t.ecbd005
                  NEXT FIELD ecbd005
               END IF
            END IF
            NEXT FIELD ecbd006
            
         BEFORE FIELD ecbd005

         ON CHANGE ecbd005
        
         BEFORE FIELD ecbd006
            
         AFTER FIELD ecbd006
            IF NOT cl_ap_chk_Range(g_ecbb3_d[l_ac2].ecbd006,"0.000","1","","","azz-00079",1) THEN
               LET g_ecbb3_d[l_ac2].ecbd006 = g_ecbb3_d_t.ecbd006
               NEXT FIELD ecbd006
            END IF
            IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd006) THEN
               IF NOT cl_null(g_ecbb3_d[l_ac2].ecbd005) THEN
                  IF g_ecbb3_d[l_ac2].ecbd005 > g_ecbb3_d[l_ac2].ecbd006 THEN
                     CALL cl_err(g_ecbb3_d[l_ac2].ecbd006,'aec-00005',1)
                     LET g_ecbb3_d[l_ac2].ecbd006 = g_ecbb3_d_t.ecbd006
                     NEXT FIELD ecbd006
                  END IF
               END IF
            END IF
            CALL aecm200_chk_ecbd005(g_ecbb3_d[l_ac2].ecbd006,'2',l_cmd)
            IF NOT cl_null(g_errno) THEN
               CALL cl_err(g_ecbb3_d[l_ac2].ecbd006,g_errno,1)
               LET g_ecbb3_d[l_ac2].ecbd006 = g_ecbb3_d_t.ecbd006
               NEXT FIELD ecbd006
            END IF
            
         ON CHANGE ecbd006
        
         BEFORE FIELD ecbd007

         AFTER FIELD ecbd007
            IF NOT cl_ap_chk_Range(g_ecbb3_d[l_ac2].ecbd007,"0.000","1","","","azz-00079",1) THEN
               LET g_ecbb3_d[l_ac2].ecbd007 = g_ecbb3_d_t.ecbd007
               NEXT FIELD ecbd007
            END IF
            
         ON CHANGE ecbd007
           
         AFTER FIELD ecbd008
            IF NOT cl_ap_chk_Range(g_ecbb3_d[l_ac2].ecbd008,"0.000","1","","","azz-00079",1) THEN
               LET g_ecbb3_d[l_ac2].ecbd008 = g_ecbb3_d_t.ecbd008
               NEXT FIELD ecbd008
            END IF
            
         BEFORE FIELD ecbd008
            
         ON CHANGE ecbd008
           
         ON ACTION controlp INFIELD ecbd005
            
         ON ACTION controlp INFIELD ecbd006
                       
         ON ACTION controlp INFIELD ecbd007
            
         ON ACTION controlp INFIELD ecbd008
    
         ON ROW CHANGE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               LET g_ecbb3_d[l_ac2].* = g_ecbb3_d_t.*
               CLOSE aecm200_bcl3
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               CALL cl_err(g_ecbb3_d[l_ac2].ecbd005,-263,1)
               LET g_ecbb3_d[l_ac2].* = g_ecbb3_d_t.*
            ELSE
               #寫入修改者/修改日期資訊(單身)
               UPDATE ecbd_t SET (ecbd001,ecbd002,ecbd003,ecbd004,ecbd005,ecbd006,ecbd007,ecbd008)
                               = (g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004,g_ecbb3_d[l_ac2].ecbd005,g_ecbb3_d[l_ac2].ecbd006,g_ecbb3_d[l_ac2].ecbd007,g_ecbb3_d[l_ac2].ecbd008)
                WHERE ecbdent = g_enterprise 
                  AND ecbdsite = g_site 
                  AND ecbd001 = g_ecba_m.ecba001 
                  AND ecbd002 = g_ecba_m.ecba002 
                  AND ecbd003 = g_ecbb_d[l_ac].ecbb003
                  AND ecbd004 = g_ecbb2_d[l_ac1].ecbc004
                  AND ecbd005 = g_ecbb3_d_t.ecbd005   
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbd_t",SQLCA.sqlcode,1)   
                  LET g_ecbb3_d[l_ac2].* = g_ecbb3_d_t.*
               ELSE
                  UPDATE ecbd_t SET (ecbd001,ecbd002,ecbd003,ecbd004,ecbd005,ecbd006,ecbd007,ecbd008)
                                  = (g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb2_d[l_ac1].ecbc004,g_ecbb3_d[l_ac2].ecbd005,g_ecbb3_d[l_ac2].ecbd006,g_ecbb3_d[l_ac2].ecbd007,g_ecbb3_d[l_ac2].ecbd008)
                   WHERE ecbdent = g_enterprise 
                     AND ecbdsite = g_site 
                     AND ecbd001 = g_ecba_m.ecba001 
                     AND ecbd002 = g_ecba_m.ecba002 
                     AND ecbd003 = g_ecbb_d[l_ac].ecbb003
                     AND ecbd004 = g_ecbb2_d[l_ac1].ecbc004
                     AND ecbd005 = g_ecbb3_d_t.ecbd005
               END IF
              
            END IF
            
         AFTER ROW
      
            CLOSE aecm200_bcl3
            CALL s_transaction_end('Y','0')
              
         AFTER INPUT
         
      END INPUT
      
      #add by wuxja --begin---
      INPUT ARRAY g_ecbb4_d FROM s_detail4.*
         ATTRIBUTE(COUNT = 32,MAXCOUNT = 32,WITHOUT DEFAULTS, 
                  INSERT ROW = FALSE, 
                  DELETE ROW = FALSE,
                  APPEND ROW = FALSE)
                  
         BEFORE INPUT                
          #  CALL aecm200_b_fill_text()
            CALL s_transaction_begin()
            CALL DIALOG.setCurrentRow("s_detail4",l_ac3)
            IF l_flag = 'Y' THEN
               CALL aecm200_b_fill_value(l_ac)
               #项次为空，代表是新增，反之是修改
               IF cl_null(g_ecbb4_d[1].l_value) THEN
                  CALL aecm200_value_def()
               END IF
               #赋旧值
               FOR l_ac3 = 1 TO 32
                  LET g_ecbb4_d_t[l_ac3].* = g_ecbb4_d[l_ac3].*
               END FOR
               NEXT FIELD l_value
            END IF
            
         BEFORE ROW
            LET l_ac3 = ARR_CURR()
            IF l_ac3 = 3 OR l_ac3 = 6 OR l_ac3 = 14 OR l_ac3 = 22 OR l_ac3 = 26 THEN
               LET l_ac3 = l_ac3 + 1
               LET l_flag = 'N'
               EXIT DIALOG
            ELSE
               LET l_flag = 'Y'
            END IF
            
            
         AFTER FIELD l_value
            IF NOT aecm200_chk_value(l_ac3,g_ecbb4_d[l_ac3].l_value,g_ecbb4_d_t[l_ac3].l_value) THEN
               LET g_ecbb4_d[l_ac3].l_value = g_ecbb4_d_t[l_ac3].l_value
               NEXT FIELD CURRENT
            END IF
         
         ON ACTION controlp INFIELD l_value
            CALL aecm200_value_controlp(l_ac3,g_ecbb4_d[l_ac3].l_value)
            NEXT FIELD CURRENT        

         AFTER INPUT
            IF NOT aecm200_value_ins_upd(g_ecbb4_d[1].l_value,g_ecbb4_d_t[1].l_value) THEN
               CALL s_transaction_end('N','0')
            ELSE
               CALL s_transaction_end('Y','0')
            END IF
               
               
      END INPUT
      #add by wuxja ---end---
      ]]>
  </point>
  <point name="insert.default" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      CALL g_ecbb2_d.clear()
      CALL g_ecbb3_d.clear()   
      INITIALIZE g_ecba_m_t.* LIKE ecba_t.*      ]]>
  </point>
  <point name="menu.bom" order="" ver="1" cite_std="N" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[                CALL aecm200_04(g_ecba_m.ecba001,g_ecba_m.ecba002)
                LET g_action_choice=""]]>
  </point>
  <point name="menu.checkin" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF l_ac > 0 THEN
                   IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                      IF g_ecba_m.ecbastus = 'N' THEN
                         CALL aecm200_02(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'1','Y','N')
                      ELSE             
                         CALL aecm200_02(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'1','N','N')
                      END IF
                   END IF
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="menu.checkout" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF l_ac > 0 THEN
                   IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                      IF g_ecba_m.ecbastus = 'N' THEN
                         CALL aecm200_02(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'2','Y','N')
                      ELSE             
                         CALL aecm200_02(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'2','N','N')
                      END IF
                   END IF
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="menu.resource" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF l_ac > 0 THEN
                   IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                      IF g_ecba_m.ecbastus = 'N' THEN
                         CALL aecm200_03(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'Y','N')
                      ELSE             
                         CALL aecm200_03(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'N','N')
                      END IF
                   END IF
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="menu.stand" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                IF l_ac > 0 THEN
                   IF NOT cl_null(g_ecba_m.ecba001) AND  NOT cl_null(g_ecba_m.ecba002) AND NOT cl_null(g_ecbb_d[l_ac].ecbb003) AND NOT cl_null(g_ecbb_d[l_ac].ecbb004)  AND NOT cl_null(g_ecbb_d[l_ac].ecbb005) THEN
                      IF g_ecba_m.ecbastus = 'N' AND g_ecbb_d[l_ac].ecbb008 = 'MULT' THEN
                         CALL aecm200_01(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'Y','N')
                      ELSE
                         CALL aecm200_01(g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,'N','N')
                      END IF
                   END IF
                END IF
                LET g_action_choice=""]]>
  </point>
  <point name="modify.body.a_fk_update" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         UPDATE ecbc_t SET ecbc001 = g_ecba_m.ecba001,
                           ecbc002 = g_ecba_m.ecba002
          WHERE ecbcent = g_enterprise 
            AND ecbcsite = g_site
            AND ecbc001 = g_ecba001_t
            AND ecbc002 = g_ecba002_t
         IF SQLCA.sqlcode THEN
             CALL cl_err("",SQLCA.sqlcode,1) 
             CALL s_transaction_end('N','0')
             CONTINUE WHILE
         END IF
         
         UPDATE ecbd_t SET ecbd001 = g_ecba_m.ecba001,
                           ecbd002 = g_ecba_m.ecba002
          WHERE ecbdent = g_enterprise 
            AND ecbdsite = g_site
            AND ecbd001 = g_ecba001_t
            AND ecbd002 = g_ecba002_t
         IF SQLCA.sqlcode THEN
             CALL cl_err("",SQLCA.sqlcode,1) 
             CALL s_transaction_end('N','0')
             CONTINUE WHILE
         END IF]]>
  </point>
  <point name="reproduce.a.ecba001" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         CALL aecm200_rdesc(l_newno)
         IF NOT cl_null(l_newno) AND NOT cl_null(l_newno02) THEN
            IF NOT ap_chk_notDup(l_newno,"SELECT COUNT(*) FROM ecba_t WHERE "||"ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND "||"ecba001 = '"||l_newno ||"' AND "|| "ecba002 = '"||l_newno02 ||"'",'std-00004',0) THEN 
               LET l_newno = ""
               CALL aecm200_rdesc(l_newno)
               NEXT FIELD CURRENT
            END IF
         END IF
         IF NOT cl_null(l_newno) THEN
            IF NOT ap_chk_isExist(l_newno,"SELECT COUNT(*) FROM imaa_t WHERE imaaent = '" ||g_enterprise||"' AND imaa001 = ? ","aim-00001",1 ) THEN
               LET l_newno = ""
               CALL aecm200_rdesc(l_newno)
               NEXT FIELD ecba001
            END IF
            IF NOT ap_chk_isExist(l_newno,"SELECT COUNT(*) FROM imaa_t WHERE imaaent = '" ||g_enterprise||"' AND imaa001 = ? AND (imaastus = 'Y' OR imaastus = 'N') ","aim-00002",1 ) THEN
               LET l_newno = ""
               CALL aecm200_rdesc(l_newno)
               NEXT FIELD ecba001
            END IF
            IF NOT ap_chk_isExist(l_newno,"SELECT COUNT(*) FROM imaa_t WHERE imaaent = '" ||g_enterprise||"' AND imaa001 = ? AND (imaastus = 'Y' OR imaastus = 'X') ","aim-00121",1 ) THEN
               LET l_newno = ""
               CALL aecm200_rdesc(l_newno)
               NEXT FIELD ecba001
            END IF
         END IF]]>
  </point>
  <point name="reproduce.a.ecba002" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         IF NOT cl_null(l_newno) AND NOT cl_null(l_newno02) THEN
            IF NOT ap_chk_notDup(l_newno,"SELECT COUNT(*) FROM ecba_t WHERE "||"ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND "||"ecba001 = '"||l_newno ||"' AND "|| "ecba002 = '"||l_newno02 ||"'",'std-00004',0) THEN 
               LET l_newno02 = ""
               NEXT FIELD CURRENT
            END IF
         END IF]]>
  </point>
  <point name="reproduce.action" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      ON ACTION controlp INFIELD ecba001            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = l_newno           #給予default值
            #給予arg
            CALL q_imaa001_10()                         #呼叫開窗
            LET l_newno = g_qryparam.return1            #將開窗取得的值回傳到變數
            DISPLAY l_newno TO ecba001                  #顯示到畫面上
            NEXT FIELD ecba001                          #返回原欄位
]]>
  </point>
  <point name="reproduce.body.table1.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      INITIALIZE l_detail2.* TO NULL
      LET l_sql = "SELECT * FROM ecbc_t ",
                  " WHERE ecbcent = '",g_enterprise,"' ",
                  "   AND ecbcsite = '",g_site,"' ",
                  "   AND ecbc001 = '",g_ecba_m.ecba001,"'",
                  "   AND ecbc002 = '",g_ecba_m.ecba002,"'",
                  "   AND ecbc003 = '",l_detail.ecbb003,"'"
      DECLARE aecm200_reproduce1 CURSOR FROM l_sql
      FOREACH aecm200_reproduce1 INTO l_detail2.*
         LET l_detail2.ecbc001 = l_newno
         LET l_detail2.ecbc002 = l_newno02
         INSERT INTO ecbc_t VALUES (l_detail2.*) #複製單身2
         IF SQLCA.sqlcode THEN
            CALL cl_err('Insert ecbc_t error!',SQLCA.sqlcode,1)
            CALL s_transaction_end('N','0')
            RETURN
         END IF
         INSERT INTO ecbd_t(ecbdent,ecbdsite,ecbd001,ecbd002,ecbd003,ecbd004,ecbd005,ecbd006,ecbd007,ecbd008)
         SELECT g_enterprise,g_site,l_newno,l_newno02,l_detail.ecbb003,l_detail2.ecbc004,ecbd005,ecbd006,ecbd007,ecbd008
           FROM ecbd_t
          WHERE ecbdent = g_enterprise
            AND ecbdsite = g_site
            AND ecbd001 = g_ecba_m.ecba001
            AND ecbd002 = g_ecba_m.ecba002
            AND ecbd003 = l_detail.ecbb003
            AND ecbd004 = l_detail2.ecbc004
         IF SQLCA.sqlcode THEN
            CALL cl_err('Insert ecbd_t error!',SQLCA.sqlcode,1)
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      END FOREACH]]>
  </point>
  <point name="reproduce.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_detail2   RECORD LIKE ecbc_t.*
   DEFINE l_sql       STRING]]>
  </point>
  <point name="reproduce.head.b_input" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_ecba_m.ecbacnfid = ''
   LET g_ecba_m.ecbacnfdt = '']]>
  </point>
  <point name="set_entry.after_control" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_entry_b.set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL cl_set_comp_entry("ecbb007",TRUE)
   CALL cl_set_comp_entry("ecbb009",TRUE)]]>
  </point>
  <point name="set_no_entry.after_control" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_no_entry_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_n     LIKE type_t.num5]]>
  </point>
  <point name="set_no_entry_b.set_no_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF NOT (g_ecbb_d[l_ac].ecbb006 = '2' OR g_ecbb_d[l_ac].ecbb006 = '3') THEN
      CALL cl_set_comp_entry("ecbb007",FALSE)
      LET g_ecbb_d[l_ac].ecbb007 = ""
   END IF
   
   IF g_ecbb_d[l_ac].ecbb008 = 'INIT' OR g_ecbb_d[l_ac].ecbb008 = 'MULT' THEN
      LET g_ecbb_d[l_ac].ecbb009 = 0
      CALL cl_set_comp_entry("ecbb009",FALSE)
   END IF
   LET l_n = 0 
   SELECT COUNT(*) INTO l_n
     FROM ecbb_t
    WHERE ecbbent = g_enterprise
      AND ecbbsite = g_site
      AND ecbb001 = g_ecba_m.ecba001
      AND ecbb002 = g_ecba_m.ecba002
      AND ecbb007 = g_ecbb_d[l_ac].ecbb008
   IF l_n > 0 THEN
      LET g_ecbb_d[l_ac].ecbb009 = 0
      CALL cl_set_comp_entry("ecbb009",FALSE)
   END IF]]>
  </point>
  <point name="show.after" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[  ]]>
  </point>
  <point name="show.before" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF l_ac = 0 OR cl_null(l_ac) THEN
      LET l_ac = 1
   END IF
   IF l_ac1 = 0 OR cl_null(l_ac1) THEN
      LET l_ac1 = 1
   END IF]]>
  </point>
  <point name="show.body.reference" order="" ver="2" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      IF NOT cl_null(g_ecbb_d[l_ac].ecbb003) THEN
         CALL s_aooi360_sel('7',g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003,'','','','','','','4') RETURNING l_success,g_ecbb_d[l_ac].ooff013
      END IF 
      DISPLAY BY NAME g_ecbb_d[l_ac].ooff013]]>
  </point>
  <point name="show.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_ac1_t   LIKE type_t.num5]]>
  </point>
  <point name="show.head.reference" order="" ver="2" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[  
   CALL aecm200_b_fill_1() 
   CALL aecm200_b_fill_2()
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecba_m.ecbaownid
   CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
   LET g_ecba_m.ecbaownid_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_ecba_m.ecbaownid_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecba_m.ecbaowndp
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecba_m.ecbaowndp_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_ecba_m.ecbaowndp_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecba_m.ecbacrtid
   CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
   LET g_ecba_m.ecbacrtid_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_ecba_m.ecbacrtid_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecba_m.ecbacrtdp
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_ecba_m.ecbacrtdp_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_ecba_m.ecbacrtdp_desc
 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecba_m.ecbamodid
   CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
   LET g_ecba_m.ecbamodid_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_ecba_m.ecbamodid_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ecba_m.ecbacnfid
   CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
   LET g_ecba_m.ecbacnfid_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_ecba_m.ecbacnfid_desc
   
   CALL aecm200_desc()   
   ]]>
  </point>
  <point name="show.other" order="" ver="2" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[
   CALL aecm200_b_fill_text()
   CALL aecm200_b_fill_value(l_ac_t)]]>
  </point>
  <point name="statechange.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF lc_state = "Y" THEN
      LET l_time = cl_get_current()
      UPDATE ecba_t SET ecbacnfid = g_user,
                        ecbacnfdt = l_time
       WHERE ecbaent = g_enterprise
         AND ecbasite = g_site
         AND ecba001 = g_ecba_m.ecba001
         AND ecba002 = g_ecba_m.ecba002
   END IF
   IF lc_state = "N" THEN
      UPDATE ecba_t SET ecbacnfid = '',
                        ecbacnfdt = ''
       WHERE ecbaent = g_enterprise
         AND ecbasite = g_site
         AND ecba001 = g_ecba_m.ecba001
         AND ecba002 = g_ecba_m.ecba002
   END IF]]>
  </point>
  <point name="statechange.before_menu" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      IF g_ecba_m.ecbastus = 'Y' THEN
         CALL cl_set_act_visible("void",FALSE)
      END IF
      IF g_ecba_m.ecbastus = 'X' THEN
         CALL cl_set_act_visible("valid",FAlSE)
      END IF]]>
  </point>
  <point name="statechange.define" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_time      DATETIME YEAR TO SECOND]]>
  </point>
  <point name="statechange.valid" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         CALL aecm200_chk_valid()
         IF NOT cl_null(g_errno) THEN
            CALL cl_err(g_ecba_m.ecba001,g_errno,1)
            RETURN
         END IF]]>
  </point>
  <point name="ui_detailshow.after" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail2",g_detail_idx)      
      CALL g_curr_diag.setCurrentRow("s_detail3",g_detail_idx) 
   END IF]]>
  </point>
  <point name="ui_dialog.body1.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[               CALL aecm200_b_fill_1()
               DISPLAY ARRAY g_ecbb2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b1)
                  BEFORE DISPLAY
                    EXIT DISPLAY
               END DISPLAY
               CALL aecm200_b_fill_2()
               DISPLAY ARRAY g_ecbb3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b2)
                  BEFORE DISPLAY
                    EXIT DISPLAY
               END DISPLAY]]>
  </point>
  <point name="ui_dialog.more_displayarray" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[         DISPLAY ARRAY g_ecbb2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b1) #page2  
    
            BEFORE ROW
               CALL aecm200_idx_chk()
               LET l_ac1 = DIALOG.getCurrentRow("s_detail2")
               LET g_detail_idx = l_ac1
               CALL aecm200_b_fill_2()
               DISPLAY ARRAY g_ecbb3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b2)
                  BEFORE DISPLAY
                    EXIT DISPLAY
               END DISPLAY
               
            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac1 = DIALOG.getCurrentRow("s_detail2")
               CALL aecm200_idx_chk()
               LET g_current_page = 2
               
               
         END DISPLAY
         DISPLAY ARRAY g_ecbb3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b2) #page2  
    
            BEFORE ROW
               CALL aecm200_idx_chk()
               LET l_ac2 = DIALOG.getCurrentRow("s_detail3")
               LET g_detail_idx = l_ac2

            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac2 = DIALOG.getCurrentRow("s_detail3")
               CALL aecm200_idx_chk()
               LET g_current_page = 3
               
               
         END DISPLAY
         
         DISPLAY ARRAY g_ecbb4_d TO s_detail4.* ATTRIBUTES(COUNT=32)   
    
            BEFORE ROW
               CALL aecm200_idx_chk()
               LET l_ac3 = DIALOG.getCurrentRow("s_detail4")
               LET g_detail_idx = l_ac2

            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac3 = DIALOG.getCurrentRow("s_detail4")
               CALL aecm200_idx_chk()
                           
         END DISPLAY]]>
  </point>
  <point name="ui_dialog.page1.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" mark_hard="N">
    <![CDATA[               #add by wuxja 
               CALL aecm200_b_fill_1()
               DISPLAY ARRAY g_ecbb2_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b1)
                  BEFORE DISPLAY
                    EXIT DISPLAY
               END DISPLAY
               
               LET l_ac1 = 1
               CALL aecm200_b_fill_2()
               DISPLAY ARRAY g_ecbb3_d TO s_detail3.* ATTRIBUTES(COUNT=g_rec_b2)
                  BEFORE DISPLAY
                    EXIT DISPLAY
               END DISPLAY
               
               CALL aecm200_b_fill_value(g_detail_idx)
               DISPLAY ARRAY g_ecbb4_d TO s_detail4.* ATTRIBUTES(COUNT=32)
                  BEFORE DISPLAY
                    EXIT DISPLAY
               END DISPLAY
               #end]]>
  </point>
  <section id="aecm200.b_fill" ver="7" status="" src="s">
    <![CDATA[#+ 單身陣列填充
PRIVATE FUNCTION aecm200_b_fill()
   DEFINE p_wc2      STRING
   #add-point:b_fill段define
   {<point name="b_fill.define"/>}
   #end add-point     
 
   CALL g_ecbb_d.clear()    #g_ecbb_d 單頭及單身 
 
 
   #add-point:b_fill段sql_before
   {<point name="b_fill.sql_before"/>}
   #end add-point
   
   #判斷是否填充
   IF aecm200_fill_chk(1) THEN
   
      LET g_sql = "SELECT  UNIQUE ecbb003,ecbb004,ecbb005,ecbb006,ecbb007,ecbb008,ecbb009,ecbb010,ecbb011, 
          ecbb012,ecbb024,ecbb025,ecbb026,ecbb027,ecbb034,ecbb013,ecbb014,ecbb015,ecbb016,ecbb017,ecbb018, 
          ecbb019,ecbb020,ecbb030,ecbb031,ecbb032,ecbb021,ecbb022,ecbb023,ecbb033,ecbb028,ecbb029,ecbb035, 
          ecbb036 ,t1.oocql004 ,t2.oocql004 ,t3.oocql004 ,t4.ecaa002 ,t5.pmaal004 FROM ecbb_t",   
                  " INNER JOIN ecba_t ON ecba001 = ecbb001 ",
                  " AND ecba002 = ecbb002 ",
 
                  #"",
                  
                  "",
                                 " LEFT JOIN oocql_t t1 ON t1.oocqlent='"||g_enterprise||"' AND t1.oocql001='221' AND t1.oocql002=ecbb004 AND t1.oocql003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t2 ON t2.oocqlent='"||g_enterprise||"' AND t2.oocql001='221' AND t2.oocql002=ecbb008 AND t2.oocql003='"||g_dlang||"' ",
               " LEFT JOIN oocql_t t3 ON t3.oocqlent='"||g_enterprise||"' AND t3.oocql001='221' AND t3.oocql002=ecbb010 AND t3.oocql003='"||g_dlang||"' ",
               " LEFT JOIN ecaa_t t4 ON t4.ecaaent='"||g_enterprise||"' AND t4.ecaa001=ecbb012  ",
               " LEFT JOIN pmaal_t t5 ON t5.pmaalent='"||g_enterprise||"' AND t5.pmaal001=ecbb014 AND t5.pmaal002='"||g_dlang||"' ",
 
                  " WHERE ecbbent=? AND ecbbsite=? AND ecbb001=? AND ecbb002=?"
      LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
      #add-point:b_fill段sql_before
      {<point name="b_fill.body.fill_sql"/>}
      #end add-point
      IF NOT cl_null(g_wc2_table1) THEN
         LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
      END IF
      
      #子單身的WC
      
      
      LET g_sql = g_sql, " ORDER BY ecbb_t.ecbb003"
      
      #add-point:單身填充控制
      {<point name="b_fill.sql"/>}
      #end add-point
      
      LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
      PREPARE aecm200_pb FROM g_sql
      DECLARE b_fill_cs CURSOR FOR aecm200_pb
      
      LET g_cnt = l_ac
      LET l_ac = 1
      
      OPEN b_fill_cs USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002
                                               
      FOREACH b_fill_cs INTO g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,g_ecbb_d[l_ac].ecbb006, 
          g_ecbb_d[l_ac].ecbb007,g_ecbb_d[l_ac].ecbb008,g_ecbb_d[l_ac].ecbb009,g_ecbb_d[l_ac].ecbb010, 
          g_ecbb_d[l_ac].ecbb011,g_ecbb_d[l_ac].ecbb012,g_ecbb_d[l_ac].ecbb024,g_ecbb_d[l_ac].ecbb025, 
          g_ecbb_d[l_ac].ecbb026,g_ecbb_d[l_ac].ecbb027,g_ecbb_d[l_ac].ecbb034,g_ecbb_d[l_ac].ecbb013, 
          g_ecbb_d[l_ac].ecbb014,g_ecbb_d[l_ac].ecbb015,g_ecbb_d[l_ac].ecbb016,g_ecbb_d[l_ac].ecbb017, 
          g_ecbb_d[l_ac].ecbb018,g_ecbb_d[l_ac].ecbb019,g_ecbb_d[l_ac].ecbb020,g_ecbb_d[l_ac].ecbb030, 
          g_ecbb_d[l_ac].ecbb031,g_ecbb_d[l_ac].ecbb032,g_ecbb_d[l_ac].ecbb021,g_ecbb_d[l_ac].ecbb022, 
          g_ecbb_d[l_ac].ecbb023,g_ecbb_d[l_ac].ecbb033,g_ecbb_d[l_ac].ecbb028,g_ecbb_d[l_ac].ecbb029, 
          g_ecbb_d[l_ac].ecbb035,g_ecbb_d[l_ac].ecbb036,g_ecbb_d[l_ac].ecbb004_desc,g_ecbb_d[l_ac].ecbb008_desc, 
          g_ecbb_d[l_ac].ecbb010_desc,g_ecbb_d[l_ac].ecbb012_desc,g_ecbb_d[l_ac].ecbb014_desc
         IF SQLCA.sqlcode THEN
            CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充
         {<point name="b_fill.fill"/>}
         #end add-point
      
         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec THEN
            IF g_error_show = 1 THEN
               CALL cl_err( '', 9035, 1)
            END IF
            EXIT FOREACH
         END IF
         
      END FOREACH
      LET g_error_show = 0
   
   END IF
   
 
   
   #add-point:browser_fill段其他table處理
   {<point name="browser_fill.other_fill"/>}
   #end add-point
   
   CALL g_ecbb_d.deleteElement(g_ecbb_d.getLength())
 
   
 
   LET l_ac = g_cnt
   LET g_cnt = 0  
   
   FREE aecm200_pb
 
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.b_fill2" ver="3" status="" src="s">
    <![CDATA[#+ 單身陣列填充2
PRIVATE FUNCTION aecm200_b_fill2(pi_idx)
   DEFINE pi_idx          LIKE type_t.num5
   DEFINE li_ac           LIKE type_t.num5
   DEFINE ls_chk          LIKE type_t.chr1
   #add-point:b_fill2段define
   {<point name="b_fill2.define"/>}
   #end add-point
   
   LET li_ac = l_ac 
   
   IF g_detail_idx <= 0 THEN
      RETURN
   END IF
   
 
      
   #add-point:單身填充後
   {<point name="b_fill2.after_fill" />}
   #end add-point
    
   LET l_ac = li_ac
   
   CALL aecm200_detail_show()
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.browser_fill" ver="8" status="" src="s">
    <![CDATA[#+ 瀏覽頁簽資料填充
PRIVATE FUNCTION aecm200_browser_fill(ps_page_action)
   DEFINE ps_page_action    STRING
   DEFINE l_wc              STRING
   DEFINE l_wc2             STRING
   DEFINE l_sql             STRING
   DEFINE l_sub_sql         STRING
   DEFINE l_sql_rank        STRING
   DEFINE l_searchcol       STRING
   #add-point:browser_fill段define
   {<point name="browser_fill.define"/>}
   #end add-point    
 
   #清除畫面
   CLEAR FORM                
   INITIALIZE g_ecba_m.* TO NULL
   CALL g_ecbb_d.clear()        
 
   CALL g_browser.clear()
   
   #搜尋用
   IF cl_null(g_searchcol) OR g_searchcol = '0' THEN
      LET l_searchcol = "ecba001,ecba002"
   ELSE
      LET l_searchcol = g_searchcol
   END IF
   
   IF cl_null(g_wc) THEN
      LET g_wc = " 1=1"
   END IF
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   LET l_wc  = g_wc.trim() 
   LET l_wc2 = g_wc2.trim()
 
   #add-point:browser_fill,foreach前
   {<point name="browser_fill.before_foreach"/>}
   #end add-point
    
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件                      
      LET l_sub_sql = " SELECT UNIQUE ecba001,ecba002 ",
                      " FROM ecba_t ",
                      " ",
                      " LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
 
 
                      " ", 
                      " ", 
                      " WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecbbent = '" ||g_enterprise|| "' AND ecbbsite = '" ||g_site|| "' AND ",l_wc, " AND ", l_wc2, cl_sql_add_filter("ecba_t")
   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT UNIQUE ecba001,ecba002 ",
                      " FROM ecba_t ", 
                      "  ",
                      "  ",
                      " WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ",l_wc CLIPPED, cl_sql_add_filter("ecba_t")
   END IF
   
   LET g_sql = " SELECT COUNT(*) FROM (",l_sub_sql,")"
   
   #add-point:browser_fill,count前
   {<point name="browser_fill.before_count"/>}
   #end add-point
   
   PREPARE header_cnt_pre FROM g_sql
   EXECUTE header_cnt_pre INTO g_browser_cnt   #總筆數
   FREE header_cnt_pre
 
   DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
   DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
 
   #依照ecba001,'','',ecba002,ecba003 Browser欄位定義(取代原本bs_sql功能)
   LET g_sql = " SELECT DISTINCT ecbastus,ecba001,'','',ecba002,ecba003,t1.imaal003 ",
               " FROM ecba_t ",
               "  ",
               "  LEFT JOIN ecbb_t ON ecbbent = ecbaent AND ecbbsite = ecbasite AND ecba001 = ecbb001 AND ecba002 = ecbb002 ",
 
 
               "  ",
               "  ",
                              " LEFT JOIN imaal_t t1 ON t1.imaalent='"||g_enterprise||"' AND t1.imaal001=ecba001 AND t1.imaal002='"||g_lang||"' ",
 
               " WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ",l_wc," AND ",l_wc2, cl_sql_add_filter("ecba_t"),
               " ORDER BY ",l_searchcol," ",g_order
 
   #add-point:browser_fill,before_prepare
   {<point name="browser_fill.before_prepare"/>}
   #end add-point
        
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   PREPARE browse_pre FROM g_sql
   DECLARE browse_cur CURSOR FOR browse_pre
   
   #add-point:browser_fill,open
   {<point name="browser_fill.open"/>}
   #end add-point
 
   CALL g_browser.clear()
   LET g_cnt = 1
   FOREACH browse_cur INTO g_browser[g_cnt].b_statepic,g_browser[g_cnt].b_ecba001,g_browser[g_cnt].b_ecba001_desc, 
       g_browser[g_cnt].b_ecba001_desc1,g_browser[g_cnt].b_ecba002,g_browser[g_cnt].b_ecba003,g_browser[g_cnt].b_ecba001_desc 

      IF SQLCA.sqlcode THEN
         CALL cl_err('foreach:',SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF
  
      #add-point:browser_fill段reference
      {<point name="browser_fill.reference"/>}
      #end add-point
  
            #此段落由子樣板a24產生
      CASE g_browser[g_cnt].b_statepic
         WHEN "N"
            LET g_browser[g_cnt].b_statepic = "stus/16/open.png"
         WHEN "X"
            LET g_browser[g_cnt].b_statepic = "stus/16/void.png"
         WHEN "Y"
            LET g_browser[g_cnt].b_statepic = "stus/16/valid.png"
         
      END CASE
 
 
      LET g_cnt = g_cnt + 1
      IF g_cnt > g_max_rec THEN
         CALL cl_err('',9035,0)
         EXIT FOREACH
      END IF
      
   END FOREACH
 
   CALL g_browser.deleteElement(g_cnt)
   LET g_header_cnt = g_browser.getLength()
 
   LET g_rec_b = g_cnt - 1
   LET g_detail_cnt = g_rec_b
   LET g_cnt = 0
   
   FREE browse_pre
   
   #add-point:browser_fill段結束前
   {<point name="browser_fill.after"/>}
   #end add-point
   
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,delete,reproduce", FALSE)
   ELSE
      CALL cl_set_act_visible("statechange,modify,delete,reproduce", TRUE)
   END IF
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.browser_search" ver="3" status="" src="s">
    <![CDATA[#+ 瀏覽頁簽資料搜尋
PRIVATE FUNCTION aecm200_browser_search(p_type)
   DEFINE p_type LIKE type_t.chr10
   #add-point:browser_search段define
   {<point name="browser_search.define"/>}
   #end add-point    
   
   #若無輸入關鍵字則查找出所有資料
   IF NOT cl_null(g_searchstr) AND g_searchcol='0' THEN
      CALL cl_err("searchcol","std-00005",0)
      RETURN FALSE 
   END IF 
   
   IF NOT cl_null(g_searchstr) THEN
      LET g_wc = " lower(", g_searchcol, ") LIKE '%", g_searchstr, "%'"
      LET g_wc = g_wc.toLowerCase()
   ELSE
      LET g_wc = " 1=1 "
   END IF         
   
   #若為排序搜尋則添加以下條件
   IF cl_null(g_searchcol) OR g_searchcol = "0" THEN
      LET g_wc = g_wc, " ORDER BY ecba001"
   ELSE
      LET g_wc = g_wc, " ORDER BY ", g_searchcol
   END IF 
 
   CALL aecm200_browser_fill("F")
   RETURN TRUE
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.construct" ver="7" status="" src="s">
    <![CDATA[#+ QBE資料查詢
PRIVATE FUNCTION aecm200_construct()
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING 
   DEFINE ls_wc       STRING 
   #add-point:cs段define
   {<point name="cs.define"/>}
   #end add-point    
 
   #清除畫面
   CLEAR FORM                
   INITIALIZE g_ecba_m.* TO NULL
   CALL g_ecbb_d.clear()        
 
   
   LET g_action_choice = ""
    
   INITIALIZE g_wc TO NULL
   INITIALIZE g_wc2 TO NULL
   
   INITIALIZE g_wc2_table1 TO NULL
 
    
   LET g_qryparam.state = 'c'
   
   #add-point:cs段開始前
   {<point name="cs.before_construct"/>}
   #end add-point 
   
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      
      #單頭
      CONSTRUCT BY NAME g_wc ON ecba001,ecba002,ecba003,ecbastus,ooeb013,ecbacrtid,ecbacrtdp,ecbacrtdt, 
          ecbaownid,ecbaowndp,ecbamodid,ecbamoddt,ecbacnfid,ecbacnfdt
 
         BEFORE CONSTRUCT
            #add-point:cs段before_construct
            {<point name="cs.head.before_construct"/>}
            #end add-point 
            
         #公用欄位開窗相關處理
         #此段落由子樣板a11產生
         ##----<<ecbacrtdt>>----
         AFTER FIELD ecbacrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<ecbamoddt>>----
         AFTER FIELD ecbamoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<ecbacnfdt>>----
         AFTER FIELD ecbacnfdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<ecbapstdt>>----
 
 
            
         #一般欄位開窗相關處理    
                  #Ctrlp:construct.c.ecba001
         ON ACTION controlp INFIELD ecba001
            #add-point:ON ACTION controlp INFIELD ecba001
            {<point name="construct.c.ecba001" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecba001
            #add-point:BEFORE FIELD ecba001
            {<point name="construct.b.ecba001" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecba001
            
            #add-point:AFTER FIELD ecba001
            {<point name="construct.a.ecba001" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecba002
            #add-point:BEFORE FIELD ecba002
            {<point name="construct.b.ecba002" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecba002
            
            #add-point:AFTER FIELD ecba002
            {<point name="construct.a.ecba002" />}
            #END add-point
            
 
         #Ctrlp:construct.c.ecba002
         ON ACTION controlp INFIELD ecba002
            #add-point:ON ACTION controlp INFIELD ecba002
            {<point name="construct.c.ecba002" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecba003
            #add-point:BEFORE FIELD ecba003
            {<point name="construct.b.ecba003" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecba003
            
            #add-point:AFTER FIELD ecba003
            {<point name="construct.a.ecba003" />}
            #END add-point
            
 
         #Ctrlp:construct.c.ecba003
         ON ACTION controlp INFIELD ecba003
            #add-point:ON ACTION controlp INFIELD ecba003
            {<point name="construct.c.ecba003" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbastus
            #add-point:BEFORE FIELD ecbastus
            {<point name="construct.b.ecbastus" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbastus
            
            #add-point:AFTER FIELD ecbastus
            {<point name="construct.a.ecbastus" />}
            #END add-point
            
 
         #Ctrlp:construct.c.ecbastus
         ON ACTION controlp INFIELD ecbastus
            #add-point:ON ACTION controlp INFIELD ecbastus
            {<point name="construct.c.ecbastus" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ooeb013
            #add-point:BEFORE FIELD ooeb013
            {<point name="construct.b.ooeb013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ooeb013
            
            #add-point:AFTER FIELD ooeb013
            {<point name="construct.a.ooeb013" />}
            #END add-point
            
 
         #Ctrlp:construct.c.ooeb013
         ON ACTION controlp INFIELD ooeb013
            #add-point:ON ACTION controlp INFIELD ooeb013
            {<point name="construct.c.ooeb013" />}
            #END add-point
 
         #Ctrlp:construct.c.ecbacrtid
         ON ACTION controlp INFIELD ecbacrtid
            #add-point:ON ACTION controlp INFIELD ecbacrtid
            {<point name="construct.c.ecbacrtid" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbacrtid
            #add-point:BEFORE FIELD ecbacrtid
            {<point name="construct.b.ecbacrtid" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbacrtid
            
            #add-point:AFTER FIELD ecbacrtid
            {<point name="construct.a.ecbacrtid" />}
            #END add-point
            
 
         #Ctrlp:construct.c.ecbacrtdp
         ON ACTION controlp INFIELD ecbacrtdp
            #add-point:ON ACTION controlp INFIELD ecbacrtdp
            {<point name="construct.c.ecbacrtdp" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbacrtdp
            #add-point:BEFORE FIELD ecbacrtdp
            {<point name="construct.b.ecbacrtdp" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbacrtdp
            
            #add-point:AFTER FIELD ecbacrtdp
            {<point name="construct.a.ecbacrtdp" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbacrtdt
            #add-point:BEFORE FIELD ecbacrtdt
            {<point name="construct.b.ecbacrtdt" />}
            #END add-point
 
         #Ctrlp:construct.c.ecbaownid
         ON ACTION controlp INFIELD ecbaownid
            #add-point:ON ACTION controlp INFIELD ecbaownid
            {<point name="construct.c.ecbaownid" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbaownid
            #add-point:BEFORE FIELD ecbaownid
            {<point name="construct.b.ecbaownid" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbaownid
            
            #add-point:AFTER FIELD ecbaownid
            {<point name="construct.a.ecbaownid" />}
            #END add-point
            
 
         #Ctrlp:construct.c.ecbaowndp
         ON ACTION controlp INFIELD ecbaowndp
            #add-point:ON ACTION controlp INFIELD ecbaowndp
            {<point name="construct.c.ecbaowndp" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbaowndp
            #add-point:BEFORE FIELD ecbaowndp
            {<point name="construct.b.ecbaowndp" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbaowndp
            
            #add-point:AFTER FIELD ecbaowndp
            {<point name="construct.a.ecbaowndp" />}
            #END add-point
            
 
         #Ctrlp:construct.c.ecbamodid
         ON ACTION controlp INFIELD ecbamodid
            #add-point:ON ACTION controlp INFIELD ecbamodid
            {<point name="construct.c.ecbamodid" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbamodid
            #add-point:BEFORE FIELD ecbamodid
            {<point name="construct.b.ecbamodid" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbamodid
            
            #add-point:AFTER FIELD ecbamodid
            {<point name="construct.a.ecbamodid" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbamoddt
            #add-point:BEFORE FIELD ecbamoddt
            {<point name="construct.b.ecbamoddt" />}
            #END add-point
 
         #Ctrlp:construct.c.ecbacnfid
         ON ACTION controlp INFIELD ecbacnfid
            #add-point:ON ACTION controlp INFIELD ecbacnfid
            {<point name="construct.c.ecbacnfid" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbacnfid
            #add-point:BEFORE FIELD ecbacnfid
            {<point name="construct.b.ecbacnfid" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbacnfid
            
            #add-point:AFTER FIELD ecbacnfid
            {<point name="construct.a.ecbacnfid" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbacnfdt
            #add-point:BEFORE FIELD ecbacnfdt
            {<point name="construct.b.ecbacnfdt" />}
            #END add-point
 
 
         
      END CONSTRUCT
 
      #單身根據table分拆construct
      CONSTRUCT g_wc2_table1 ON ecbb003,ecbb004,ecbb005,ecbb006,ecbb007,ecbb008,ecbb009,ecbb010,ecbb011, 
          ecbb012,ecbb024,ecbb025,ecbb026,ecbb027,ecbb034,ecbb013,ecbb014,ecbb015,ecbb016,ecbb017,ecbb018, 
          ecbb019,ecbb020,ecbb030,ecbb031,ecbb032,ecbb021,ecbb022,ecbb023,ecbb033,ecbb028,ecbb029,ooff013, 
          ecbb035,ecbb036
           FROM s_detail1[1].ecbb003,s_detail1[1].ecbb004,s_detail1[1].ecbb005,s_detail1[1].ecbb006, 
               s_detail1[1].ecbb007,s_detail1[1].ecbb008,s_detail1[1].ecbb009,s_detail1[1].ecbb010,s_detail1[1].ecbb011, 
               s_detail1[1].ecbb012,s_detail1[1].ecbb024,s_detail1[1].ecbb025,s_detail1[1].ecbb026,s_detail1[1].ecbb027, 
               s_detail1[1].ecbb034,s_detail1[1].ecbb013,s_detail1[1].ecbb014,s_detail1[1].ecbb015,s_detail1[1].ecbb016, 
               s_detail1[1].ecbb017,s_detail1[1].ecbb018,s_detail1[1].ecbb019,s_detail1[1].ecbb020,s_detail1[1].ecbb030, 
               s_detail1[1].ecbb031,s_detail1[1].ecbb032,s_detail1[1].ecbb021,s_detail1[1].ecbb022,s_detail1[1].ecbb023, 
               s_detail1[1].ecbb033,s_detail1[1].ecbb028,s_detail1[1].ecbb029,s_detail1[1].ooff013,s_detail1[1].ecbb035, 
               s_detail1[1].ecbb036
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct
            {<point name="cs.body.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
                #此段落由子樣板a01產生
         BEFORE FIELD ecbb003
            #add-point:BEFORE FIELD ecbb003
            {<point name="construct.b.page1.ecbb003" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb003
            
            #add-point:AFTER FIELD ecbb003
            {<point name="construct.a.page1.ecbb003" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb003
         ON ACTION controlp INFIELD ecbb003
            #add-point:ON ACTION controlp INFIELD ecbb003
            {<point name="construct.c.page1.ecbb003" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.ecbb004
         ON ACTION controlp INFIELD ecbb004
            #add-point:ON ACTION controlp INFIELD ecbb004
            {<point name="construct.c.page1.ecbb004" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb004
            #add-point:BEFORE FIELD ecbb004
            {<point name="construct.b.page1.ecbb004" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb004
            
            #add-point:AFTER FIELD ecbb004
            {<point name="construct.a.page1.ecbb004" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb005
            #add-point:BEFORE FIELD ecbb005
            {<point name="construct.b.page1.ecbb005" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb005
            
            #add-point:AFTER FIELD ecbb005
            {<point name="construct.a.page1.ecbb005" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb005
         ON ACTION controlp INFIELD ecbb005
            #add-point:ON ACTION controlp INFIELD ecbb005
            {<point name="construct.c.page1.ecbb005" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb006
            #add-point:BEFORE FIELD ecbb006
            {<point name="construct.b.page1.ecbb006" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb006
            
            #add-point:AFTER FIELD ecbb006
            {<point name="construct.a.page1.ecbb006" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb006
         ON ACTION controlp INFIELD ecbb006
            #add-point:ON ACTION controlp INFIELD ecbb006
            {<point name="construct.c.page1.ecbb006" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb007
            #add-point:BEFORE FIELD ecbb007
            {<point name="construct.b.page1.ecbb007" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb007
            
            #add-point:AFTER FIELD ecbb007
            {<point name="construct.a.page1.ecbb007" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb007
         ON ACTION controlp INFIELD ecbb007
            #add-point:ON ACTION controlp INFIELD ecbb007
            {<point name="construct.c.page1.ecbb007" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.ecbb008
         ON ACTION controlp INFIELD ecbb008
            #add-point:ON ACTION controlp INFIELD ecbb008
            {<point name="construct.c.page1.ecbb008" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb008
            #add-point:BEFORE FIELD ecbb008
            {<point name="construct.b.page1.ecbb008" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb008
            
            #add-point:AFTER FIELD ecbb008
            {<point name="construct.a.page1.ecbb008" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb009
            #add-point:BEFORE FIELD ecbb009
            {<point name="construct.b.page1.ecbb009" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb009
            
            #add-point:AFTER FIELD ecbb009
            {<point name="construct.a.page1.ecbb009" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb009
         ON ACTION controlp INFIELD ecbb009
            #add-point:ON ACTION controlp INFIELD ecbb009
            {<point name="construct.c.page1.ecbb009" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.ecbb010
         ON ACTION controlp INFIELD ecbb010
            #add-point:ON ACTION controlp INFIELD ecbb010
            {<point name="construct.c.page1.ecbb010" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb010
            #add-point:BEFORE FIELD ecbb010
            {<point name="construct.b.page1.ecbb010" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb010
            
            #add-point:AFTER FIELD ecbb010
            {<point name="construct.a.page1.ecbb010" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb011
            #add-point:BEFORE FIELD ecbb011
            {<point name="construct.b.page1.ecbb011" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb011
            
            #add-point:AFTER FIELD ecbb011
            {<point name="construct.a.page1.ecbb011" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb011
         ON ACTION controlp INFIELD ecbb011
            #add-point:ON ACTION controlp INFIELD ecbb011
            {<point name="construct.c.page1.ecbb011" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.ecbb012
         ON ACTION controlp INFIELD ecbb012
            #add-point:ON ACTION controlp INFIELD ecbb012
            {<point name="construct.c.page1.ecbb012" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb012
            #add-point:BEFORE FIELD ecbb012
            {<point name="construct.b.page1.ecbb012" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb012
            
            #add-point:AFTER FIELD ecbb012
            {<point name="construct.a.page1.ecbb012" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb024
            #add-point:BEFORE FIELD ecbb024
            {<point name="construct.b.page1.ecbb024" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb024
            
            #add-point:AFTER FIELD ecbb024
            {<point name="construct.a.page1.ecbb024" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb024
         ON ACTION controlp INFIELD ecbb024
            #add-point:ON ACTION controlp INFIELD ecbb024
            {<point name="construct.c.page1.ecbb024" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb025
            #add-point:BEFORE FIELD ecbb025
            {<point name="construct.b.page1.ecbb025" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb025
            
            #add-point:AFTER FIELD ecbb025
            {<point name="construct.a.page1.ecbb025" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb025
         ON ACTION controlp INFIELD ecbb025
            #add-point:ON ACTION controlp INFIELD ecbb025
            {<point name="construct.c.page1.ecbb025" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb026
            #add-point:BEFORE FIELD ecbb026
            {<point name="construct.b.page1.ecbb026" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb026
            
            #add-point:AFTER FIELD ecbb026
            {<point name="construct.a.page1.ecbb026" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb026
         ON ACTION controlp INFIELD ecbb026
            #add-point:ON ACTION controlp INFIELD ecbb026
            {<point name="construct.c.page1.ecbb026" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb027
            #add-point:BEFORE FIELD ecbb027
            {<point name="construct.b.page1.ecbb027" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb027
            
            #add-point:AFTER FIELD ecbb027
            {<point name="construct.a.page1.ecbb027" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb027
         ON ACTION controlp INFIELD ecbb027
            #add-point:ON ACTION controlp INFIELD ecbb027
            {<point name="construct.c.page1.ecbb027" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb034
            #add-point:BEFORE FIELD ecbb034
            {<point name="construct.b.page1.ecbb034" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb034
            
            #add-point:AFTER FIELD ecbb034
            {<point name="construct.a.page1.ecbb034" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb034
         ON ACTION controlp INFIELD ecbb034
            #add-point:ON ACTION controlp INFIELD ecbb034
            {<point name="construct.c.page1.ecbb034" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb013
            #add-point:BEFORE FIELD ecbb013
            {<point name="construct.b.page1.ecbb013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb013
            
            #add-point:AFTER FIELD ecbb013
            {<point name="construct.a.page1.ecbb013" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb013
         ON ACTION controlp INFIELD ecbb013
            #add-point:ON ACTION controlp INFIELD ecbb013
            {<point name="construct.c.page1.ecbb013" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.ecbb014
         ON ACTION controlp INFIELD ecbb014
            #add-point:ON ACTION controlp INFIELD ecbb014
            {<point name="construct.c.page1.ecbb014" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb014
            #add-point:BEFORE FIELD ecbb014
            {<point name="construct.b.page1.ecbb014" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb014
            
            #add-point:AFTER FIELD ecbb014
            {<point name="construct.a.page1.ecbb014" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb015
            #add-point:BEFORE FIELD ecbb015
            {<point name="construct.b.page1.ecbb015" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb015
            
            #add-point:AFTER FIELD ecbb015
            {<point name="construct.a.page1.ecbb015" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb015
         ON ACTION controlp INFIELD ecbb015
            #add-point:ON ACTION controlp INFIELD ecbb015
            {<point name="construct.c.page1.ecbb015" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb016
            #add-point:BEFORE FIELD ecbb016
            {<point name="construct.b.page1.ecbb016" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb016
            
            #add-point:AFTER FIELD ecbb016
            {<point name="construct.a.page1.ecbb016" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb016
         ON ACTION controlp INFIELD ecbb016
            #add-point:ON ACTION controlp INFIELD ecbb016
            {<point name="construct.c.page1.ecbb016" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb017
            #add-point:BEFORE FIELD ecbb017
            {<point name="construct.b.page1.ecbb017" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb017
            
            #add-point:AFTER FIELD ecbb017
            {<point name="construct.a.page1.ecbb017" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb017
         ON ACTION controlp INFIELD ecbb017
            #add-point:ON ACTION controlp INFIELD ecbb017
            {<point name="construct.c.page1.ecbb017" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb018
            #add-point:BEFORE FIELD ecbb018
            {<point name="construct.b.page1.ecbb018" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb018
            
            #add-point:AFTER FIELD ecbb018
            {<point name="construct.a.page1.ecbb018" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb018
         ON ACTION controlp INFIELD ecbb018
            #add-point:ON ACTION controlp INFIELD ecbb018
            {<point name="construct.c.page1.ecbb018" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb019
            #add-point:BEFORE FIELD ecbb019
            {<point name="construct.b.page1.ecbb019" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb019
            
            #add-point:AFTER FIELD ecbb019
            {<point name="construct.a.page1.ecbb019" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb019
         ON ACTION controlp INFIELD ecbb019
            #add-point:ON ACTION controlp INFIELD ecbb019
            {<point name="construct.c.page1.ecbb019" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb020
            #add-point:BEFORE FIELD ecbb020
            {<point name="construct.b.page1.ecbb020" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb020
            
            #add-point:AFTER FIELD ecbb020
            {<point name="construct.a.page1.ecbb020" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb020
         ON ACTION controlp INFIELD ecbb020
            #add-point:ON ACTION controlp INFIELD ecbb020
            {<point name="construct.c.page1.ecbb020" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.ecbb030
         ON ACTION controlp INFIELD ecbb030
            #add-point:ON ACTION controlp INFIELD ecbb030
            {<point name="construct.c.page1.ecbb030" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb030
            #add-point:BEFORE FIELD ecbb030
            {<point name="construct.b.page1.ecbb030" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb030
            
            #add-point:AFTER FIELD ecbb030
            {<point name="construct.a.page1.ecbb030" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb031
            #add-point:BEFORE FIELD ecbb031
            {<point name="construct.b.page1.ecbb031" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb031
            
            #add-point:AFTER FIELD ecbb031
            {<point name="construct.a.page1.ecbb031" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb031
         ON ACTION controlp INFIELD ecbb031
            #add-point:ON ACTION controlp INFIELD ecbb031
            {<point name="construct.c.page1.ecbb031" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb032
            #add-point:BEFORE FIELD ecbb032
            {<point name="construct.b.page1.ecbb032" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb032
            
            #add-point:AFTER FIELD ecbb032
            {<point name="construct.a.page1.ecbb032" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb032
         ON ACTION controlp INFIELD ecbb032
            #add-point:ON ACTION controlp INFIELD ecbb032
            {<point name="construct.c.page1.ecbb032" />}
            #END add-point
 
         #Ctrlp:construct.c.page1.ecbb021
         ON ACTION controlp INFIELD ecbb021
            #add-point:ON ACTION controlp INFIELD ecbb021
            {<point name="construct.c.page1.ecbb021" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb021
            #add-point:BEFORE FIELD ecbb021
            {<point name="construct.b.page1.ecbb021" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb021
            
            #add-point:AFTER FIELD ecbb021
            {<point name="construct.a.page1.ecbb021" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb022
            #add-point:BEFORE FIELD ecbb022
            {<point name="construct.b.page1.ecbb022" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb022
            
            #add-point:AFTER FIELD ecbb022
            {<point name="construct.a.page1.ecbb022" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb022
         ON ACTION controlp INFIELD ecbb022
            #add-point:ON ACTION controlp INFIELD ecbb022
            {<point name="construct.c.page1.ecbb022" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb023
            #add-point:BEFORE FIELD ecbb023
            {<point name="construct.b.page1.ecbb023" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb023
            
            #add-point:AFTER FIELD ecbb023
            {<point name="construct.a.page1.ecbb023" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb023
         ON ACTION controlp INFIELD ecbb023
            #add-point:ON ACTION controlp INFIELD ecbb023
            {<point name="construct.c.page1.ecbb023" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb033
            #add-point:BEFORE FIELD ecbb033
            {<point name="construct.b.page1.ecbb033" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb033
            
            #add-point:AFTER FIELD ecbb033
            {<point name="construct.a.page1.ecbb033" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb033
         ON ACTION controlp INFIELD ecbb033
            #add-point:ON ACTION controlp INFIELD ecbb033
            {<point name="construct.c.page1.ecbb033" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb028
            #add-point:BEFORE FIELD ecbb028
            {<point name="construct.b.page1.ecbb028" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb028
            
            #add-point:AFTER FIELD ecbb028
            {<point name="construct.a.page1.ecbb028" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb028
         ON ACTION controlp INFIELD ecbb028
            #add-point:ON ACTION controlp INFIELD ecbb028
            {<point name="construct.c.page1.ecbb028" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb029
            #add-point:BEFORE FIELD ecbb029
            {<point name="construct.b.page1.ecbb029" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb029
            
            #add-point:AFTER FIELD ecbb029
            {<point name="construct.a.page1.ecbb029" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb029
         ON ACTION controlp INFIELD ecbb029
            #add-point:ON ACTION controlp INFIELD ecbb029
            {<point name="construct.c.page1.ecbb029" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ooff013
            #add-point:BEFORE FIELD ooff013
            {<point name="construct.b.page1.ooff013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ooff013
            
            #add-point:AFTER FIELD ooff013
            {<point name="construct.a.page1.ooff013" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ooff013
         ON ACTION controlp INFIELD ooff013
            #add-point:ON ACTION controlp INFIELD ooff013
            {<point name="construct.c.page1.ooff013" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb035
            #add-point:BEFORE FIELD ecbb035
            {<point name="construct.b.page1.ecbb035" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb035
            
            #add-point:AFTER FIELD ecbb035
            {<point name="construct.a.page1.ecbb035" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb035
         ON ACTION controlp INFIELD ecbb035
            #add-point:ON ACTION controlp INFIELD ecbb035
            {<point name="construct.c.page1.ecbb035" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb036
            #add-point:BEFORE FIELD ecbb036
            {<point name="construct.b.page1.ecbb036" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb036
            
            #add-point:AFTER FIELD ecbb036
            {<point name="construct.a.page1.ecbb036" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.ecbb036
         ON ACTION controlp INFIELD ecbb036
            #add-point:ON ACTION controlp INFIELD ecbb036
            {<point name="construct.c.page1.ecbb036" />}
            #END add-point
 
   
       
      END CONSTRUCT
      
 
      
 
      
      #add-point:cs段add_cs(本段內只能出現新的CONSTRUCT指令)
      {<point name="cs.add_cs"/>}
      #end add-point
 
      BEFORE DIALOG
         CALL cl_qbe_init()
         #add-point:cs段b_dialog
         {<point name="cs.b_dialog"/>}
         #end add-point  
 
      #查詢方案列表
      ON ACTION qbe_select
         LET ls_wc = ""
         CALL cl_qbe_list("c") RETURNING ls_wc
    
      #條件儲存為方案
      ON ACTION qbe_save
         CALL cl_qbe_save()
 
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   END DIALOG
   
   #組合g_wc2
   LET g_wc2 = g_wc2_table1
 
 
 
   
   #add-point:cs段結束前
   {<point name="cs.after_construct"/>}
   #end add-point    
 
   IF INT_FLAG THEN
      RETURN
   END IF
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.default_search" ver="5" status="" src="s">
    <![CDATA[#+ 外部參數搜尋
PRIVATE FUNCTION aecm200_default_search()
   DEFINE li_idx  LIKE type_t.num5
   DEFINE li_cnt  LIKE type_t.num5
   DEFINE ls_wc   STRING
   #add-point:default_search段define
   {<point name="default_search.define"/>}
   #end add-point  
   
   #add-point:default_search段開始前
   {<point name="default_search.before"/>}
   #end add-point  
   
   LET g_pagestart = 1
   
   IF cl_null(g_order) THEN
      LET g_order = "ASC"
   END IF
   
   IF NOT cl_null(g_argv[01]) THEN
      LET ls_wc = ls_wc, " ecba001 = '", g_argv[01], "' AND "
   END IF
   
   IF NOT cl_null(g_argv[02]) THEN
      LET ls_wc = ls_wc, " ecba002 = '", g_argv[02], "' AND "
   END IF
 
   
   IF NOT cl_null(ls_wc) THEN
      LET g_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_default = TRUE
   ELSE
      LET g_default = FALSE
      #預設查詢條件
      LET g_wc = cl_qbe_get_default_qryplan()
      IF cl_null(g_wc) THEN
         LET g_wc = " 1=1"
      END IF
   END IF
   
   #add-point:default_search段結束前
   {<point name="default_search.after"/>}
   #end add-point  
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.delete" ver="10" status="" src="s">
    <![CDATA[#+ 資料刪除
PRIVATE FUNCTION aecm200_delete()
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   #add-point:delete段define
   {<point name="delete.define"/>}
   #end add-point     
   
   IF g_ecba_m.ecba001 IS NULL
   OR g_ecba_m.ecba002 IS NULL
 
   THEN
      CALL cl_err("","std-00003",0)
      RETURN
   END IF
 
   EXECUTE aecm200_master_referesh USING g_ecba_m.ecba001,g_ecba_m.ecba002 INTO g_ecba_m.ecba001,g_ecba_m.ecba002, 
       g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid, 
       g_ecba_m.ecbaowndp,g_ecba_m.ecbamodid,g_ecba_m.ecbamoddt,g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt, 
       g_ecba_m.ecbacrtid_desc,g_ecba_m.ecbacrtdp_desc,g_ecba_m.ecbaownid_desc,g_ecba_m.ecbaowndp_desc, 
       g_ecba_m.ecbamodid_desc,g_ecba_m.ecbacnfid_desc
   
   
 
   CALL aecm200_show()
   
   CALL s_transaction_begin()
 
   OPEN aecm200_cl USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002
   IF STATUS THEN
      CALL cl_err("OPEN aecm200_cl:", STATUS, 1)
      CLOSE aecm200_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE aecm200_master_referesh USING g_ecba_m.ecba001,g_ecba_m.ecba002 INTO g_ecba_m.ecba001,g_ecba_m.ecba002, 
       g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid, 
       g_ecba_m.ecbaowndp,g_ecba_m.ecbamodid,g_ecba_m.ecbamoddt,g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt, 
       g_ecba_m.ecbacrtid_desc,g_ecba_m.ecbacrtdp_desc,g_ecba_m.ecbaownid_desc,g_ecba_m.ecbaowndp_desc, 
       g_ecba_m.ecbamodid_desc,g_ecba_m.ecbacnfid_desc
 
   IF SQLCA.sqlcode THEN
      CALL cl_err(g_ecba_m.ecba001,SQLCA.sqlcode,0)          #資料被他人LOCK
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #add-point:delete段before ask
   {<point name="delete.before_ask"/>}
   #end add-point 
 
   IF cl_ask_del_master() THEN              #確認一下
   
      #add-point:單頭刪除前
      {<point name="delete.head.b_delete" mark="Y"/>}
      #end add-point   
      
      #+ 此段落由子樣板a47產生
      #刪除相關文件
      CALL aecm200_set_pk_array()
      #add-point:相關文件刪除前
      {<point name="delete.befroe.related_document_remove"/>}
      #end add-point   
      CALL cl_doc_remove()  
 
  
  
      #資料備份
      LET g_ecba001_t = g_ecba_m.ecba001
      LET g_ecba002_t = g_ecba_m.ecba002
 
 
      DELETE FROM ecba_t
       WHERE ecbaent = g_enterprise AND ecbasite = g_site AND ecba001 = g_ecba_m.ecba001
         AND ecba002 = g_ecba_m.ecba002
 
       
      #add-point:單頭刪除中
      {<point name="delete.head.m_delete"/>}
      #end add-point
       
      IF SQLCA.sqlcode THEN
         CALL cl_err(g_ecba_m.ecba001,SQLCA.sqlcode,0) 
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      #add-point:單頭刪除後
      {<point name="delete.head.a_delete"/>}
      #end add-point
  
      #add-point:單身刪除前
      {<point name="delete.body.b_delete" mark="Y"/>}
      #end add-point
      
      DELETE FROM ecbb_t
       WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND ecbb001 = g_ecba_m.ecba001
         AND ecbb002 = g_ecba_m.ecba002
 
 
      #add-point:單身刪除中
      {<point name="delete.body.m_delete"/>}
      #end add-point
         
      IF SQLCA.sqlcode THEN
         CALL cl_err("ecbb_t",SQLCA.sqlcode,0) 
         CALL s_transaction_end('N','0')
         RETURN
      END IF    
 
      #add-point:單身刪除後
      {<point name="delete.body.a_delete"/>}
      #end add-point
      
            
                                                               
 
 
 
                                                               
      CLEAR FORM
      CALL g_ecbb_d.clear() 
 
     
      #CALL aecm200_ui_browser_refresh()  
      CALL aecm200_ui_headershow()  
      CALL aecm200_ui_detailshow()
       
      IF g_browser_cnt > 0 THEN 
         CALL aecm200_browser_fill("")
         CALL aecm200_fetch('P')
         DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
      ELSE
         LET g_wc = " 1=1"
         CALL aecm200_browser_fill("F")
      END IF
      
      #單頭多語言刪除
      
      
      #單身多語言刪除
      
 
 
   
      #add-point:多語言刪除
      {<point name="delete.lang.delete"/>}
      #end add-point
   
   END IF
 
   CALL s_transaction_end('Y','0')
   
   CLOSE aecm200_cl
 
   #流程通知預埋點-D
   CALL cl_flow_notify(g_ecba_m.ecba001,'D')
    
END FUNCTION
]]>
  </section>
  <section id="aecm200.delete_b" ver="2" status="" src="s">
    <![CDATA[#+ 刪除單身後其他table連動
PRIVATE FUNCTION aecm200_delete_b(ps_table,ps_keys_bak,ps_page)
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   #add-point:delete_b段define
   {<point name="delete_b.define"/>}
   #end add-point     
 
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前
      {<point name="delete_b.b_delete" mark="Y"/>}
      #end add-point    
      DELETE FROM ecbb_t
       WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND
         ecbb001 = ps_keys_bak[1] AND ecbb002 = ps_keys_bak[2] AND ecbb003 = ps_keys_bak[3]
      #add-point:delete_b段刪除中
      {<point name="delete_b.m_delete"/>}
      #end add-point    
      IF SQLCA.sqlcode THEN
         CALL cl_err("",SQLCA.sqlcode,0)
      END IF
      #add-point:delete_b段刪除後
      {<point name="delete_b.a_delete"/>}
      #end add-point   
   END IF
   
 
   
 
   
   #add-point:delete_b段other
   {<point name="delete_b.other"/>}
   #end add-point  
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.description" ver="34" status="" src="s">
    <![CDATA[#+ Version..: T100-ERP-1.00.00(SD版次:3,PR版次:3) Build-000327
#+ 
#+ Filename...: aecm200
#+ Description: 料件製程資料維護作業
#+ Creator....: 02482(2013/09/23)
#+ Modifier...: 01258(2014/06/30)
#+ Buildtype..: 應用 t01 樣板自動產生
#+ 以上段落由子樣板a00產生
]]>
  </section>
  <section id="aecm200.detail_reproduce" ver="3" status="" src="s">
    <![CDATA[#+ 單身自動複製
PRIVATE FUNCTION aecm200_detail_reproduce()
   DEFINE ls_sql      STRING
   DEFINE ld_date     DATETIME YEAR TO SECOND
   DEFINE l_detail    RECORD LIKE ecbb_t.*
 
 
   #add-point:delete段define
   {<point name="detail_reproduce.define"/>}
   #end add-point    
   
   CALL s_transaction_begin()
   
   LET ld_date = cl_get_current()
   
   DROP TABLE aecm200_detail
   
   #add-point:單身複製前1
   {<point name="detail_reproduce.body.table1.b_insert" mark="Y"/>}
   #end add-point
   
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE aecm200_detail AS ",
                "SELECT * FROM ecbb_t "
   PREPARE repro_tbl FROM ls_sql
   EXECUTE repro_tbl
   FREE repro_tbl
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO aecm200_detail SELECT * FROM ecbb_t 
                                         WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND ecbb001 = g_ecba001_t
                                         AND ecbb002 = g_ecba002_t
 
   
   #將key修正為調整後   
   UPDATE aecm200_detail 
      #更新key欄位
      SET ecbb001 = g_ecba_m.ecba001
          , ecbb002 = g_ecba_m.ecba002
 
      #更新共用欄位
      
                                       
  
   #將資料塞回原table   
   INSERT INTO ecbb_t SELECT * FROM aecm200_detail
   
   IF SQLCA.sqlcode THEN
      CALL cl_err("reproduce",SQLCA.sqlcode,1)
      RETURN
   END IF
   
   #add-point:單身複製中1
   {<point name="detail_reproduce.body.table1.m_insert"/>}
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE aecm200_detail
   
   #add-point:單身複製後1
   {<point name="detail_reproduce.body.table1.a_insert"/>}
   #end add-point
 
 
   
 
   
   #多語言複製段落
   
   
   CALL s_transaction_end('Y','0')
   
   #已新增完, 調整資料內容(修改時使用)
   LET g_ecba001_t = g_ecba_m.ecba001
   LET g_ecba002_t = g_ecba_m.ecba002
 
   
   DROP TABLE aecm200_detail
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.detail_show" ver="4" status="" src="s">
    <![CDATA[#+ 第二階單身reference
PRIVATE FUNCTION aecm200_detail_show()
   #add-point:detail_show段define
   {<point name="detail_show.define"/>}
   #end add-point  
 
   #add-point:detail_show段之前
   {<point name="detail_show.before"/>}
   #end add-point
   
   #add-point:detail_show段之後
   {<point name="detail_show.after"/>}
   #end add-point
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.fetch" ver="10" status="" src="s">
    <![CDATA[#+ 指定PK後抓取單頭其他資料
PRIVATE FUNCTION aecm200_fetch(p_flag)
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   #add-point:fetch段define
   {<point name="fetch.define"/>}
   #end add-point    
   
   IF g_browser_cnt = 0 THEN
      RETURN
   END IF
   
   CASE p_flag
      WHEN 'F' LET g_current_idx = 1
      WHEN 'L' LET g_current_idx = g_header_cnt        
      WHEN 'P'
         IF g_current_idx > 1 THEN               
            LET g_current_idx = g_current_idx - 1
         END IF 
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF        
      WHEN '/'
         IF (NOT g_no_ask) THEN    
            CALL cl_set_act_visible("accept,cancel", TRUE)    
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0
 
            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl" 
            END PROMPT
 
            CALL cl_set_act_visible("accept,cancel", FALSE)    
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE  
            END IF           
         END IF
         
         IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
             LET g_current_idx = g_jump
         END IF
         
         LET g_no_ask = FALSE  
   END CASE 
   
   
   CALL g_curr_diag.setCurrentRow("s_browse", g_current_idx) #設定browse 索引
   
   LET g_detail_cnt = g_header_cnt                  
   
   #單身總筆數顯示
   #LET g_detail_idx = 1
   IF g_detail_cnt > 0 THEN
      #LET g_detail_idx = 1
      DISPLAY g_detail_idx TO FORMONLY.idx  
   ELSE
      LET g_detail_idx = 0
      DISPLAY ' ' TO FORMONLY.idx    
   END IF
   
   #瀏覽頁筆數顯示
   LET g_browser_idx = g_pagestart+g_current_idx-1
   DISPLAY g_browser_idx TO FORMONLY.b_index   #當下筆數
   DISPLAY g_browser_idx TO FORMONLY.h_index   #當下筆數
   
   CALL cl_navigator_setting( g_current_idx, g_browser_cnt )
   
   #代表沒有資料
   IF g_current_idx = 0 OR g_browser.getLength() = 0 THEN
      RETURN
   END IF
   
   #超出範圍
   IF g_current_idx > g_browser.getLength() THEN
      LET g_current_idx = g_browser.getLength()
   END IF
   
   LET g_ecba_m.ecba001 = g_browser[g_current_idx].b_ecba001
   LET g_ecba_m.ecba002 = g_browser[g_current_idx].b_ecba002
 
   
   #重讀DB,因TEMP有不被更新特性
   EXECUTE aecm200_master_referesh USING g_ecba_m.ecba001,g_ecba_m.ecba002 INTO g_ecba_m.ecba001,g_ecba_m.ecba002, 
       g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid, 
       g_ecba_m.ecbaowndp,g_ecba_m.ecbamodid,g_ecba_m.ecbamoddt,g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt, 
       g_ecba_m.ecbacrtid_desc,g_ecba_m.ecbacrtdp_desc,g_ecba_m.ecbaownid_desc,g_ecba_m.ecbaowndp_desc, 
       g_ecba_m.ecbamodid_desc,g_ecba_m.ecbacnfid_desc
   IF SQLCA.sqlcode THEN
      CALL cl_err("ecba_t",SQLCA.sqlcode,1)
      INITIALIZE g_ecba_m.* TO NULL
      RETURN
   END IF
   
   #add-point:fetch段action控制
   {<point name="fetch.action_control"/>}
   #end add-point  
   
   
   
   #add-point:fetch結束前
   {<point name="fetch.after" />}
   #end add-point
   
   #LET g_data_owner =       
   #LET g_data_group =   
   
   #重新顯示   
   CALL aecm200_show()
 
   
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.fill_chk" ver="4" status="" src="s">
    <![CDATA[#+ 單身填充確認
PRIVATE FUNCTION aecm200_fill_chk(ps_idx)
   DEFINE ps_idx        LIKE type_t.chr10
   #add-point:fill_chk段define
   {<point name="fill_chk.define"/>}
   #end add-point
   
   #add-point:fill_chk段before_chk
   {<point name="fill_chk.before_chk"/>}
   #end add-point
   
   #全部為1=1 or null時回傳true
   IF (cl_null(g_wc2_table1) OR g_wc2_table1.trim() = '1=1') THEN
      #add-point:fill_chk段other_chk
      {<point name="fill_chk.other_chk"/>}
      #end add-point
      RETURN TRUE
   END IF
   
   #第一單身
   IF ps_idx = 1 AND
      ((NOT cl_null(g_wc2_table1) AND g_wc2_table1.trim() <> '1=1')) THEN
      RETURN TRUE
   END IF
   
   #根據wc判定是否需要填充
 
 
   RETURN FALSE
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.filter" ver="6" status="" src="s">
    <![CDATA[#+ 此段落由子樣板a50產生
#+ filter過濾功能
PRIVATE FUNCTION aecm200_filter()
   #add-point:filter段define
   {<point name="filter.define"/>}
   #end add-point   
 
   #切換畫面
   IF NOT g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF   
 
   LET INT_FLAG = 0
 
   LET g_qryparam.state = 'c'
 
   LET g_wc_filter_t = g_wc_filter.trim()
   LET g_wc_t = g_wc
 
   LET g_wc = cl_replace_str(g_wc, g_wc_filter_t, '')
 
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
      #單頭
      CONSTRUCT g_wc_filter ON ecba001,ecba002,ecba003
                          FROM s_browse[1].b_ecba001,s_browse[1].b_ecba002,s_browse[1].b_ecba003
 
         BEFORE CONSTRUCT
               DISPLAY aecm200_filter_parser('ecba001') TO s_browse[1].b_ecba001
            DISPLAY aecm200_filter_parser('ecba002') TO s_browse[1].b_ecba002
            DISPLAY aecm200_filter_parser('ecba003') TO s_browse[1].b_ecba003
      
         #add-point:filter段cs_ctrl
         {<point name="filter.cs_ctrl"/>}
         #end add-point
      
      END CONSTRUCT
 
      #add-point:filter段add_cs
      {<point name="filter.add_cs"/>}
      #end add-point
 
      BEFORE DIALOG
         #add-point:filter段b_dialog
         {<point name="filter.b_dialog"/>}
         #end add-point  
      
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   
   END DIALOG
 
   IF NOT INT_FLAG THEN
      LET g_wc_filter = "   AND   ", g_wc_filter, "   "
      LET g_wc = g_wc , g_wc_filter
   ELSE
      LET g_wc_filter = g_wc_filter_t
      LET g_wc = g_wc_t
   END IF
 
      CALL aecm200_filter_show('ecba001')
   CALL aecm200_filter_show('ecba002')
   CALL aecm200_filter_show('ecba003')
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.filter_parser" ver="2" status="" src="s">
    <![CDATA[#+ filter過濾功能
PRIVATE FUNCTION aecm200_filter_parser(ps_field)
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num5
   DEFINE li_tmp2    LIKE type_t.num5
   DEFINE ls_var     STRING
   #add-point:filter段define
   {<point name="filter_parser.define"/>}
   #end add-point    
 
   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF
 
   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF
 
   RETURN ls_var
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.filter_show" ver="2" status="" src="s">
    <![CDATA[#+ 顯示過濾條件
PRIVATE FUNCTION aecm200_filter_show(ps_field)
   DEFINE ps_field         STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING
 
   LET ls_name = "formonly.b_", ps_field
   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LEt ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF
 
   #顯示資料組合
   LET ls_condition = aecm200_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF
 
   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.global" ver="8" status="" src="s">
    <![CDATA[{<point name="global.memo" />}
        
IMPORT os
IMPORT util
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds 
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔
{<point name="global.inc" />}
#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_ecba_m        RECORD
       ecba001 LIKE ecba_t.ecba001, 
   ecba001_desc LIKE type_t.chr80, 
   ecba001_desc1 LIKE type_t.chr80, 
   ecba002 LIKE ecba_t.ecba002, 
   ecba003 LIKE ecba_t.ecba003, 
   ecbastus LIKE ecba_t.ecbastus, 
   ooeb013 LIKE type_t.chr80, 
   ecbacrtid LIKE ecba_t.ecbacrtid, 
   ecbacrtid_desc LIKE type_t.chr80, 
   ecbacrtdp LIKE ecba_t.ecbacrtdp, 
   ecbacrtdp_desc LIKE type_t.chr80, 
   ecbacrtdt DATETIME YEAR TO SECOND, 
   ecbaownid LIKE ecba_t.ecbaownid, 
   ecbaownid_desc LIKE type_t.chr80, 
   ecbaowndp LIKE ecba_t.ecbaowndp, 
   ecbaowndp_desc LIKE type_t.chr80, 
   ecbamodid LIKE ecba_t.ecbamodid, 
   ecbamodid_desc LIKE type_t.chr80, 
   ecbamoddt DATETIME YEAR TO SECOND, 
   ecbacnfid LIKE ecba_t.ecbacnfid, 
   ecbacnfid_desc LIKE type_t.chr80, 
   ecbacnfdt DATETIME YEAR TO SECOND
       END RECORD
 
#單身 type 宣告
PRIVATE TYPE type_g_ecbb_d        RECORD
       ecbb003 LIKE ecbb_t.ecbb003, 
   ecbb004 LIKE ecbb_t.ecbb004, 
   ecbb004_desc LIKE type_t.chr500, 
   ecbb005 LIKE ecbb_t.ecbb005, 
   ecbb006 LIKE ecbb_t.ecbb006, 
   ecbb007 LIKE ecbb_t.ecbb007, 
   ecbb008 LIKE ecbb_t.ecbb008, 
   ecbb008_desc LIKE type_t.chr500, 
   ecbb009 LIKE ecbb_t.ecbb009, 
   ecbb010 LIKE ecbb_t.ecbb010, 
   ecbb010_desc LIKE type_t.chr500, 
   ecbb011 LIKE ecbb_t.ecbb011, 
   ecbb012 LIKE ecbb_t.ecbb012, 
   ecbb012_desc LIKE type_t.chr500, 
   ecbb024 LIKE ecbb_t.ecbb024, 
   ecbb025 LIKE ecbb_t.ecbb025, 
   ecbb026 LIKE ecbb_t.ecbb026, 
   ecbb027 LIKE ecbb_t.ecbb027, 
   ecbb034 LIKE ecbb_t.ecbb034, 
   ecbb013 LIKE ecbb_t.ecbb013, 
   ecbb014 LIKE ecbb_t.ecbb014, 
   ecbb014_desc LIKE type_t.chr500, 
   ecbb015 LIKE ecbb_t.ecbb015, 
   ecbb016 LIKE ecbb_t.ecbb016, 
   ecbb017 LIKE ecbb_t.ecbb017, 
   ecbb018 LIKE ecbb_t.ecbb018, 
   ecbb019 LIKE ecbb_t.ecbb019, 
   ecbb020 LIKE ecbb_t.ecbb020, 
   ecbb030 LIKE ecbb_t.ecbb030, 
   ecbb031 LIKE ecbb_t.ecbb031, 
   ecbb032 LIKE ecbb_t.ecbb032, 
   ecbb021 LIKE ecbb_t.ecbb021, 
   ecbb022 LIKE ecbb_t.ecbb022, 
   ecbb023 LIKE ecbb_t.ecbb023, 
   ecbb033 LIKE ecbb_t.ecbb033, 
   ecbb028 LIKE ecbb_t.ecbb028, 
   ecbb029 LIKE ecbb_t.ecbb029, 
   ooff013 LIKE type_t.chr80, 
   ecbb035 LIKE ecbb_t.ecbb035, 
   ecbb036 LIKE ecbb_t.ecbb036
       END RECORD
 
 
#模組變數(Module Variables)
DEFINE g_ecba_m          type_g_ecba_m
DEFINE g_ecba_m_t        type_g_ecba_m
 
   DEFINE g_ecba001_t LIKE ecba_t.ecba001
DEFINE g_ecba002_t LIKE ecba_t.ecba002
 
 
DEFINE g_ecbb_d          DYNAMIC ARRAY OF type_g_ecbb_d
DEFINE g_ecbb_d_t        type_g_ecbb_d
 
 
DEFINE g_browser    DYNAMIC ARRAY OF RECORD    #資料瀏覽之欄位 
         b_statepic     LIKE type_t.chr50,
            b_ecba001 LIKE ecba_t.ecba001,
   b_ecba001_desc LIKE type_t.chr80,
   b_ecba001_desc1 LIKE type_t.chr80,
      b_ecba002 LIKE ecba_t.ecba002,
      b_ecba003 LIKE ecba_t.ecba003
      END RECORD 
      
DEFINE g_browser_f  RECORD    #資料瀏覽之欄位 
         b_statepic     LIKE type_t.chr50,
            b_ecba001 LIKE ecba_t.ecba001,
   b_ecba001_desc LIKE type_t.chr80,
   b_ecba001_desc1 LIKE type_t.chr80,
      b_ecba002 LIKE ecba_t.ecba002,
      b_ecba003 LIKE ecba_t.ecba003
      END RECORD 
      
 
DEFINE g_wc                  STRING
DEFINE g_wc_t                STRING
DEFINE g_wc2                 STRING                          #單身CONSTRUCT結果
DEFINE g_wc2_table1          STRING
 
 
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING
 
DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10     
DEFINE g_jump                LIKE type_t.num10        
DEFINE g_no_ask              LIKE type_t.num5        
DEFINE g_rec_b               LIKE type_t.num5           
DEFINE l_ac                  LIKE type_t.num5    
DEFINE g_curr_diag           ui.Dialog                     #Current Dialog
    
DEFINE g_pagestart           LIKE type_t.num5           
DEFINE gwin_curr             ui.Window                     #Current Window
DEFINE gfrm_curr             ui.Form                       #Current Form
DEFINE g_page_action         STRING                        #page action
DEFINE g_header_hidden       LIKE type_t.num5              #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5              #隱藏工作Panel
DEFINE g_page                STRING                        #第幾頁
DEFINE g_state               STRING       
 
DEFINE g_detail_cnt          LIKE type_t.num5              #單身總筆數
DEFINE g_detail_idx          LIKE type_t.num5              #單身目前所在筆數
DEFINE g_detail_idx2         LIKE type_t.num5              #單身2目前所在筆數
DEFINE g_browser_cnt         LIKE type_t.num5              #Browser總筆數
DEFINE g_browser_idx         LIKE type_t.num5              #Browser目前所在筆數
DEFINE g_temp_idx            LIKE type_t.num5              #Browser目前所在筆數(暫存用)
 
DEFINE g_searchcol           STRING                        #查詢欄位代碼
DEFINE g_searchstr           STRING                        #查詢欄位字串
DEFINE g_order               STRING                        #查詢排序欄位
                                                        
DEFINE g_current_row         LIKE type_t.num5              #Browser所在筆數
DEFINE g_current_sw          BOOLEAN                       #Browser所在筆數用開關
DEFINE g_current_page        LIKE type_t.num5              #目前所在頁數
DEFINE g_insert              LIKE type_t.chr5              #是否導到其他page
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys               DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak           DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_bfill               LIKE type_t.chr5              #是否刷新單身
DEFINE g_error_show          LIKE type_t.num5              #
 
DEFINE g_wc_frozen           STRING                        #凍結欄位使用
DEFINE g_chk                 BOOLEAN                       #助記碼判斷用
DEFINE g_aw                  STRING                        #確定當下點擊的單身
DEFINE g_default             BOOLEAN                       #是否有外部參數查詢
DEFINE g_log1                STRING                        #log用
DEFINE g_log2                STRING                        #log用
DEFINE g_loc                 LIKE type_t.chr5              #判斷游標所在位置
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable"/>}
#end add-point
 
#add-point:傳入參數說明(global.argv)
{<point name="global.argv"/>}
#end add-point
]]>
  </section>
  <section id="aecm200.idx_chk" ver="1" status="" src="s">
    <![CDATA[#+ 單身筆數變更
PRIVATE FUNCTION aecm200_idx_chk()
   #add-point:idx_chk段define
   {<point name="idx_chk.define"/>}
   #end add-point  
   
   IF g_current_page = 1 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail1")
      IF g_detail_idx > g_ecbb_d.getLength() THEN
         LET g_detail_idx = g_ecbb_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_ecbb_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_ecbb_d.getLength() TO FORMONLY.cnt
   END IF
   
 
   
   #add-point:idx_chk段other
   {<point name="idx_chk.other"/>}
   #end add-point  
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.init" ver="2" status="" src="s">
    <![CDATA[#+ 瀏覽頁簽資料初始化
PRIVATE FUNCTION aecm200_init()
   #add-point:init段define
   {<point name="init.define"/>}
   #end add-point    
   
   LET g_bfill       = "Y"
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   LET g_error_show  = 1
   LET l_ac = 1
      CALL cl_set_combo_scc_part('ecbastus','50','N,X,Y')
 
      CALL cl_set_combo_scc('ecbb006','1202') 
 
   LET gwin_curr = ui.Window.getCurrent()  #取得現行畫面
   LET gfrm_curr = gwin_curr.getForm()     #取出物件化後的畫面物件
 
   #add-point:畫面資料初始化
   {<point name="init.init"/>}
   #end add-point
   
   CALL aecm200_default_search()
    
END FUNCTION
]]>
  </section>
  <section id="aecm200.input" ver="5" status="" src="s">
    <![CDATA[#+ 資料輸入
PRIVATE FUNCTION aecm200_input(p_cmd)
   DEFINE  p_cmd                 LIKE type_t.chr1
   DEFINE  l_cmd_t               LIKE type_t.chr1
   DEFINE  l_cmd                 LIKE type_t.chr1
   DEFINE  l_n                   LIKE type_t.num5                #檢查重複用  
   DEFINE  l_cnt                 LIKE type_t.num5                #檢查重複用  
   DEFINE  l_lock_sw             LIKE type_t.chr1                #單身鎖住否  
   DEFINE  l_allow_insert        LIKE type_t.num5                #可新增否 
   DEFINE  l_allow_delete        LIKE type_t.num5                #可刪除否  
   DEFINE  l_count               LIKE type_t.num5
   DEFINE  l_i                   LIKE type_t.num5
   DEFINE  l_insert              BOOLEAN
   DEFINE  ls_return             STRING
   DEFINE  l_var_keys            DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys          DYNAMIC ARRAY OF STRING
   DEFINE  l_vars                DYNAMIC ARRAY OF STRING
   DEFINE  l_fields              DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak        DYNAMIC ARRAY OF STRING
   DEFINE  lb_reproduce          BOOLEAN
   DEFINE  li_reproduce          LIKE type_t.num5
   DEFINE  li_reproduce_target   LIKE type_t.num5
   #add-point:input段define
   {<point name="input.define"/>}
   #end add-point  
 
   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r'
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF   
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
 
   CALL cl_set_head_visible("","YES")  
 
   LET l_insert = FALSE
   LET g_action_choice = ""
 
   #add-point:input段define_sql
   {<point name="input.define_sql" mark="Y"/>}
   #end add-point 
   LET g_forupd_sql = "SELECT ecbb003,ecbb004,ecbb005,ecbb006,ecbb007,ecbb008,ecbb009,ecbb010,ecbb011, 
       ecbb012,ecbb024,ecbb025,ecbb026,ecbb027,ecbb034,ecbb013,ecbb014,ecbb015,ecbb016,ecbb017,ecbb018, 
       ecbb019,ecbb020,ecbb030,ecbb031,ecbb032,ecbb021,ecbb022,ecbb023,ecbb033,ecbb028,ecbb029,ecbb035, 
       ecbb036 FROM ecbb_t WHERE ecbbent=? AND ecbbsite=? AND ecbb001=? AND ecbb002=? AND ecbb003=?  
       FOR UPDATE"
   #add-point:input段define_sql
   {<point name="input.after_define_sql"/>}
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aecm200_bcl CURSOR FROM g_forupd_sql
   
 
   
 
 
   #add-point:input段define_sql
   {<point name="input.other_sql"/>}
   #end add-point 
 
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'
   
   #控制key欄位可否輸入
   CALL aecm200_set_entry(p_cmd)
   #add-point:set_entry後
   {<point name="input.after_set_entry"/>}
   #end add-point
   CALL aecm200_set_no_entry(p_cmd)
 
   DISPLAY BY NAME g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ooeb013 

   
   LET lb_reproduce = FALSE
   
   #add-point:資料輸入前
   {<point name="input.before_input"/>}
   #end add-point
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
]]>
  </section>
  <section id="aecm200.input.body" ver="19" status="" src="s">
    <![CDATA[   
      #Page1 預設值產生於此處
      INPUT ARRAY g_ecbb_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         #自訂ACTION(detail_input,page_1)
         
 
         #+ 此段落由子樣板a43產生
         ON ACTION checkout
            LET g_action_choice="checkout"
            IF cl_auth_chk_act("checkout") THEN
               
               #add-point:ON ACTION checkout
               {<point name="input.detail_input.page1.checkout" />}
               #END add-point
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION resource
            LET g_action_choice="resource"
            IF cl_auth_chk_act("resource") THEN
               
               #add-point:ON ACTION resource
               {<point name="input.detail_input.page1.resource" />}
               #END add-point
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION stand
            LET g_action_choice="stand"
            IF cl_auth_chk_act("stand") THEN
               
               #add-point:ON ACTION stand
               {<point name="input.detail_input.page1.stand" />}
               #END add-point
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION checkin
            LET g_action_choice="checkin"
            IF cl_auth_chk_act("checkin") THEN
               
               #add-point:ON ACTION checkin
               {<point name="input.detail_input.page1.checkin" />}
               #END add-point
            END IF
 
 
         
         BEFORE INPUT
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_ecbb_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL aecm200_b_fill()
            LET g_rec_b = g_ecbb_d.getLength()
            #add-point:資料輸入前
            {<point name="input.d.before_input"/>}
            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2
            {<point name="input.body.before_row2"/>}
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN aecm200_cl USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002
            IF STATUS THEN
               CALL cl_err("OPEN aecm200_cl:", STATUS, 1)
               CLOSE aecm200_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF
            
            LET g_rec_b = g_ecbb_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_ecbb_d[l_ac].ecbb003 IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_ecbb_d_t.* = g_ecbb_d[l_ac].*  #BACKUP
               CALL aecm200_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b
               {<point name="input.body.after_set_entry_b"/>}
               #end add-point  
               CALL aecm200_set_no_entry_b(l_cmd)
               IF NOT aecm200_lock_b("ecbb_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH aecm200_bcl INTO g_ecbb_d[l_ac].ecbb003,g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005, 
                      g_ecbb_d[l_ac].ecbb006,g_ecbb_d[l_ac].ecbb007,g_ecbb_d[l_ac].ecbb008,g_ecbb_d[l_ac].ecbb009, 
                      g_ecbb_d[l_ac].ecbb010,g_ecbb_d[l_ac].ecbb011,g_ecbb_d[l_ac].ecbb012,g_ecbb_d[l_ac].ecbb024, 
                      g_ecbb_d[l_ac].ecbb025,g_ecbb_d[l_ac].ecbb026,g_ecbb_d[l_ac].ecbb027,g_ecbb_d[l_ac].ecbb034, 
                      g_ecbb_d[l_ac].ecbb013,g_ecbb_d[l_ac].ecbb014,g_ecbb_d[l_ac].ecbb015,g_ecbb_d[l_ac].ecbb016, 
                      g_ecbb_d[l_ac].ecbb017,g_ecbb_d[l_ac].ecbb018,g_ecbb_d[l_ac].ecbb019,g_ecbb_d[l_ac].ecbb020, 
                      g_ecbb_d[l_ac].ecbb030,g_ecbb_d[l_ac].ecbb031,g_ecbb_d[l_ac].ecbb032,g_ecbb_d[l_ac].ecbb021, 
                      g_ecbb_d[l_ac].ecbb022,g_ecbb_d[l_ac].ecbb023,g_ecbb_d[l_ac].ecbb033,g_ecbb_d[l_ac].ecbb028, 
                      g_ecbb_d[l_ac].ecbb029,g_ecbb_d[l_ac].ecbb035,g_ecbb_d[l_ac].ecbb036
                  IF SQLCA.sqlcode THEN
                     CALL cl_err(g_ecbb_d_t.ecbb003,SQLCA.sqlcode,1)
                     LET l_lock_sw = "Y"
                  END IF
                  
                  LET g_bfill = "N"
                  CALL aecm200_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row
            {<point name="input.body.before_row"/>}
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
            #其他table進行lock
            
        
         BEFORE INSERT
            
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_ecbb_d[l_ac].* TO NULL 
                  LET g_ecbb_d[l_ac].ecbb006 = "1"
      LET g_ecbb_d[l_ac].ecbb024 = "0"
      LET g_ecbb_d[l_ac].ecbb025 = "0"
      LET g_ecbb_d[l_ac].ecbb026 = "0"
      LET g_ecbb_d[l_ac].ecbb027 = "0"
      LET g_ecbb_d[l_ac].ecbb034 = "0"
      LET g_ecbb_d[l_ac].ecbb013 = "N"
      LET g_ecbb_d[l_ac].ecbb015 = "N"
      LET g_ecbb_d[l_ac].ecbb016 = "N"
      LET g_ecbb_d[l_ac].ecbb017 = "Y"
      LET g_ecbb_d[l_ac].ecbb018 = "N"
      LET g_ecbb_d[l_ac].ecbb019 = "N"
      LET g_ecbb_d[l_ac].ecbb020 = "N"
      LET g_ecbb_d[l_ac].ecbb031 = "1"
      LET g_ecbb_d[l_ac].ecbb032 = "1"
      LET g_ecbb_d[l_ac].ecbb022 = "1"
      LET g_ecbb_d[l_ac].ecbb023 = "1"
      LET g_ecbb_d[l_ac].ecbb033 = "N"
 
            LET g_ecbb_d_t.* = g_ecbb_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL aecm200_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b
            {<point name="input.body.insert.after_set_entry_b"/>}
            #end add-point
            CALL aecm200_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_ecbb_d[li_reproduce_target].* = g_ecbb_d[li_reproduce].*
 
               LET g_ecbb_d[li_reproduce_target].ecbb003 = NULL
 
            END IF
            #公用欄位給值(單身)
            
            
            #add-point:modify段before insert
            {<point name="input.body.before_insert"/>}
            #end add-point  
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身新增
            {<point name="input.body.b_a_insert"/>}
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(*) INTO l_count FROM ecbb_t 
             WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND ecbb001 = g_ecba_m.ecba001
               AND ecbb002 = g_ecba_m.ecba002
 
               AND ecbb003 = g_ecbb_d[l_ac].ecbb003
 
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身新增前
               {<point name="input.body.b_insert"/>}
               #end add-point
            
               #同步新增到同層的table
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_ecba_m.ecba001
               LET gs_keys[2] = g_ecba_m.ecba002
               LET gs_keys[3] = g_ecbb_d[g_detail_idx].ecbb003
               CALL aecm200_insert_b('ecbb_t',gs_keys,"'1'")
                           
               #add-point:單身新增後
               {<point name="input.body.a_insert"/>}
               #end add-point
            ELSE    
               CALL cl_err('INSERT',"std-00006",1)
               INITIALIZE g_ecbb_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               CALL cl_err("ecbb_t",SQLCA.sqlcode,1)  
               CALL s_transaction_end('N','0')                    
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL aecm200_b_fill()
               #資料多語言用-增/改
               
               #add-point:input段-after_insert
               {<point name="input.body.a_insert2"/>}
               #end add-point
               CALL s_transaction_end('Y','0')
               ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' AND g_ecbb_d.getLength() < l_ac THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
               CALL g_ecbb_d.deleteElement(l_ac)
               NEXT FIELD ecbb003
            END IF
         
            IF g_ecbb_d[l_ac].ecbb003 IS NOT NULL
 
               THEN 
               
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  CALL cl_err("", -263, 1)
                  CANCEL DELETE
               END IF
               
               #add-point:單身刪除前
               {<point name="input.body.b_delete" mark="Y"/>}
               #end add-point 
               
               DELETE FROM ecbb_t
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND ecbb001 = g_ecba_m.ecba001 AND
                                          ecbb002 = g_ecba_m.ecba002 AND
 
                      ecbb003 = g_ecbb_d_t.ecbb003
 
                  
               #add-point:單身刪除中
               {<point name="input.body.m_delete"/>}
               #end add-point 
               
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                  CALL s_transaction_end('N','0')
                  CANCEL DELETE   
               ELSE
                  LET g_rec_b = g_rec_b-1
                  
                  #add-point:單身刪除後
                  {<point name="input.body.a_delete"/>}
                  #end add-point
                  CALL s_transaction_end('Y','0')
               END IF 
               CLOSE aecm200_bcl
               LET l_count = g_ecbb_d.getLength()
            END IF 
            
                           INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_ecba_m.ecba001
               LET gs_keys[2] = g_ecba_m.ecba002
               LET gs_keys[3] = g_ecbb_d[g_detail_idx].ecbb003
 
              
         AFTER DELETE 
            #add-point:單身刪除後2
            {<point name="input.body.after_delete"/>}
            #end add-point
                           CALL aecm200_delete_b('ecbb_t',gs_keys,"'1'")
 
                  #此段落由子樣板a02產生
         AFTER FIELD ecbb003
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb003,"0","0","","","azz-00079",1) THEN
               NEXT FIELD ecbb003
            END IF
 
 
            #add-point:AFTER FIELD ecbb003
            {<point name="input.a.page1.ecbb003" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb003
            #add-point:BEFORE FIELD ecbb003
            {<point name="input.b.page1.ecbb003" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb003
            #add-point:ON CHANGE ecbb003
            {<point name="input.g.page1.ecbb003" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb004
            
            #add-point:AFTER FIELD ecbb004
            {<point name="input.a.page1.ecbb004" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb004
            #add-point:BEFORE FIELD ecbb004
            {<point name="input.b.page1.ecbb004" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb004
            #add-point:ON CHANGE ecbb004
            {<point name="input.g.page1.ecbb004" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb005
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb005,"0","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb005
            END IF
 
 
            #add-point:AFTER FIELD ecbb005
            {<point name="input.a.page1.ecbb005" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb005
            #add-point:BEFORE FIELD ecbb005
            {<point name="input.b.page1.ecbb005" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb005
            #add-point:ON CHANGE ecbb005
            {<point name="input.g.page1.ecbb005" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb006
            #add-point:BEFORE FIELD ecbb006
            {<point name="input.b.page1.ecbb006" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb006
            
            #add-point:AFTER FIELD ecbb006
            {<point name="input.a.page1.ecbb006" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb006
            #add-point:ON CHANGE ecbb006
            {<point name="input.g.page1.ecbb006" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb007
            #add-point:BEFORE FIELD ecbb007
            {<point name="input.b.page1.ecbb007" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb007
            
            #add-point:AFTER FIELD ecbb007
            {<point name="input.a.page1.ecbb007" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb007
            #add-point:ON CHANGE ecbb007
            {<point name="input.g.page1.ecbb007" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb008
            
            #add-point:AFTER FIELD ecbb008
            {<point name="input.a.page1.ecbb008" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb008
            #add-point:BEFORE FIELD ecbb008
            {<point name="input.b.page1.ecbb008" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb008
            #add-point:ON CHANGE ecbb008
            {<point name="input.g.page1.ecbb008" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb009
            #add-point:BEFORE FIELD ecbb009
            {<point name="input.b.page1.ecbb009" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb009
            
            #add-point:AFTER FIELD ecbb009
            {<point name="input.a.page1.ecbb009" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb009
            #add-point:ON CHANGE ecbb009
            {<point name="input.g.page1.ecbb009" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb010
            
            #add-point:AFTER FIELD ecbb010
            {<point name="input.a.page1.ecbb010" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb010
            #add-point:BEFORE FIELD ecbb010
            {<point name="input.b.page1.ecbb010" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb010
            #add-point:ON CHANGE ecbb010
            {<point name="input.g.page1.ecbb010" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb011
            #add-point:BEFORE FIELD ecbb011
            {<point name="input.b.page1.ecbb011" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb011
            
            #add-point:AFTER FIELD ecbb011
            {<point name="input.a.page1.ecbb011" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb011
            #add-point:ON CHANGE ecbb011
            {<point name="input.g.page1.ecbb011" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb012
            
            #add-point:AFTER FIELD ecbb012
            {<point name="input.a.page1.ecbb012" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb012
            #add-point:BEFORE FIELD ecbb012
            {<point name="input.b.page1.ecbb012" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb012
            #add-point:ON CHANGE ecbb012
            {<point name="input.g.page1.ecbb012" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb024
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb024,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb024
            END IF
 
 
            #add-point:AFTER FIELD ecbb024
            {<point name="input.a.page1.ecbb024" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb024
            #add-point:BEFORE FIELD ecbb024
            {<point name="input.b.page1.ecbb024" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb024
            #add-point:ON CHANGE ecbb024
            {<point name="input.g.page1.ecbb024" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb025
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb025,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb025
            END IF
 
 
            #add-point:AFTER FIELD ecbb025
            {<point name="input.a.page1.ecbb025" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb025
            #add-point:BEFORE FIELD ecbb025
            {<point name="input.b.page1.ecbb025" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb025
            #add-point:ON CHANGE ecbb025
            {<point name="input.g.page1.ecbb025" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb026
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb026,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb026
            END IF
 
 
            #add-point:AFTER FIELD ecbb026
            {<point name="input.a.page1.ecbb026" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb026
            #add-point:BEFORE FIELD ecbb026
            {<point name="input.b.page1.ecbb026" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb026
            #add-point:ON CHANGE ecbb026
            {<point name="input.g.page1.ecbb026" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb027
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb027,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb027
            END IF
 
 
            #add-point:AFTER FIELD ecbb027
            {<point name="input.a.page1.ecbb027" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb027
            #add-point:BEFORE FIELD ecbb027
            {<point name="input.b.page1.ecbb027" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb027
            #add-point:ON CHANGE ecbb027
            {<point name="input.g.page1.ecbb027" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb034
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb034,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb034
            END IF
 
 
            #add-point:AFTER FIELD ecbb034
            {<point name="input.a.page1.ecbb034" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb034
            #add-point:BEFORE FIELD ecbb034
            {<point name="input.b.page1.ecbb034" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb034
            #add-point:ON CHANGE ecbb034
            {<point name="input.g.page1.ecbb034" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb013
            #add-point:BEFORE FIELD ecbb013
            {<point name="input.b.page1.ecbb013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb013
            
            #add-point:AFTER FIELD ecbb013
            {<point name="input.a.page1.ecbb013" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb013
            #add-point:ON CHANGE ecbb013
            {<point name="input.g.page1.ecbb013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb014
            
            #add-point:AFTER FIELD ecbb014
            {<point name="input.a.page1.ecbb014" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb014
            #add-point:BEFORE FIELD ecbb014
            {<point name="input.b.page1.ecbb014" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb014
            #add-point:ON CHANGE ecbb014
            {<point name="input.g.page1.ecbb014" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb015
            #add-point:BEFORE FIELD ecbb015
            {<point name="input.b.page1.ecbb015" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb015
            
            #add-point:AFTER FIELD ecbb015
            {<point name="input.a.page1.ecbb015" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb015
            #add-point:ON CHANGE ecbb015
            {<point name="input.g.page1.ecbb015" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb016
            #add-point:BEFORE FIELD ecbb016
            {<point name="input.b.page1.ecbb016" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb016
            
            #add-point:AFTER FIELD ecbb016
            {<point name="input.a.page1.ecbb016" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb016
            #add-point:ON CHANGE ecbb016
            {<point name="input.g.page1.ecbb016" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb017
            #add-point:BEFORE FIELD ecbb017
            {<point name="input.b.page1.ecbb017" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb017
            
            #add-point:AFTER FIELD ecbb017
            {<point name="input.a.page1.ecbb017" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb017
            #add-point:ON CHANGE ecbb017
            {<point name="input.g.page1.ecbb017" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb018
            #add-point:BEFORE FIELD ecbb018
            {<point name="input.b.page1.ecbb018" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb018
            
            #add-point:AFTER FIELD ecbb018
            {<point name="input.a.page1.ecbb018" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb018
            #add-point:ON CHANGE ecbb018
            {<point name="input.g.page1.ecbb018" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb019
            #add-point:BEFORE FIELD ecbb019
            {<point name="input.b.page1.ecbb019" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb019
            
            #add-point:AFTER FIELD ecbb019
            {<point name="input.a.page1.ecbb019" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb019
            #add-point:ON CHANGE ecbb019
            {<point name="input.g.page1.ecbb019" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb020
            #add-point:BEFORE FIELD ecbb020
            {<point name="input.b.page1.ecbb020" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb020
            
            #add-point:AFTER FIELD ecbb020
            {<point name="input.a.page1.ecbb020" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb020
            #add-point:ON CHANGE ecbb020
            {<point name="input.g.page1.ecbb020" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb030
            
            #add-point:AFTER FIELD ecbb030
            {<point name="input.a.page1.ecbb030" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb030
            #add-point:BEFORE FIELD ecbb030
            {<point name="input.b.page1.ecbb030" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb030
            #add-point:ON CHANGE ecbb030
            {<point name="input.g.page1.ecbb030" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb031
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb031,"0.000000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb031
            END IF
 
 
            #add-point:AFTER FIELD ecbb031
            {<point name="input.a.page1.ecbb031" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb031
            #add-point:BEFORE FIELD ecbb031
            {<point name="input.b.page1.ecbb031" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb031
            #add-point:ON CHANGE ecbb031
            {<point name="input.g.page1.ecbb031" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb032
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb032,"0.000000","0","","","azz-00079",1) THEN
               NEXT FIELD ecbb032
            END IF
 
 
            #add-point:AFTER FIELD ecbb032
            {<point name="input.a.page1.ecbb032" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb032
            #add-point:BEFORE FIELD ecbb032
            {<point name="input.b.page1.ecbb032" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb032
            #add-point:ON CHANGE ecbb032
            {<point name="input.g.page1.ecbb032" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb021
            
            #add-point:AFTER FIELD ecbb021
            {<point name="input.a.page1.ecbb021" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb021
            #add-point:BEFORE FIELD ecbb021
            {<point name="input.b.page1.ecbb021" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb021
            #add-point:ON CHANGE ecbb021
            {<point name="input.g.page1.ecbb021" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb022
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb022,"0.000000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb022
            END IF
 
 
            #add-point:AFTER FIELD ecbb022
            {<point name="input.a.page1.ecbb022" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb022
            #add-point:BEFORE FIELD ecbb022
            {<point name="input.b.page1.ecbb022" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb022
            #add-point:ON CHANGE ecbb022
            {<point name="input.g.page1.ecbb022" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb023
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb023,"0.000000","0","","","azz-00079",1) THEN
               NEXT FIELD ecbb023
            END IF
 
 
            #add-point:AFTER FIELD ecbb023
            {<point name="input.a.page1.ecbb023" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb023
            #add-point:BEFORE FIELD ecbb023
            {<point name="input.b.page1.ecbb023" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb023
            #add-point:ON CHANGE ecbb023
            {<point name="input.g.page1.ecbb023" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb033
            #add-point:BEFORE FIELD ecbb033
            {<point name="input.b.page1.ecbb033" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb033
            
            #add-point:AFTER FIELD ecbb033
            {<point name="input.a.page1.ecbb033" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb033
            #add-point:ON CHANGE ecbb033
            {<point name="input.g.page1.ecbb033" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb028
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb028,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb028
            END IF
 
 
            #add-point:AFTER FIELD ecbb028
            {<point name="input.a.page1.ecbb028" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb028
            #add-point:BEFORE FIELD ecbb028
            {<point name="input.b.page1.ecbb028" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb028
            #add-point:ON CHANGE ecbb028
            {<point name="input.g.page1.ecbb028" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb029
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_ecbb_d[l_ac].ecbb029,"0.000","1","","","azz-00079",1) THEN
               NEXT FIELD ecbb029
            END IF
 
 
            #add-point:AFTER FIELD ecbb029
            {<point name="input.a.page1.ecbb029" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb029
            #add-point:BEFORE FIELD ecbb029
            {<point name="input.b.page1.ecbb029" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb029
            #add-point:ON CHANGE ecbb029
            {<point name="input.g.page1.ecbb029" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ooff013
            #add-point:BEFORE FIELD ooff013
            {<point name="input.b.page1.ooff013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ooff013
            
            #add-point:AFTER FIELD ooff013
            {<point name="input.a.page1.ooff013" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ooff013
            #add-point:ON CHANGE ooff013
            {<point name="input.g.page1.ooff013" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb035
            #add-point:BEFORE FIELD ecbb035
            {<point name="input.b.page1.ecbb035" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb035
            
            #add-point:AFTER FIELD ecbb035
            {<point name="input.a.page1.ecbb035" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb035
            #add-point:ON CHANGE ecbb035
            {<point name="input.g.page1.ecbb035" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbb036
            #add-point:BEFORE FIELD ecbb036
            {<point name="input.b.page1.ecbb036" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbb036
            
            #add-point:AFTER FIELD ecbb036
            {<point name="input.a.page1.ecbb036" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbb036
            #add-point:ON CHANGE ecbb036
            {<point name="input.g.page1.ecbb036" />}
            #END add-point
 
 
                  #Ctrlp:input.c.page1.ecbb003
         ON ACTION controlp INFIELD ecbb003
            #add-point:ON ACTION controlp INFIELD ecbb003
            {<point name="input.c.page1.ecbb003" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb004
         ON ACTION controlp INFIELD ecbb004
            #add-point:ON ACTION controlp INFIELD ecbb004
            {<point name="input.c.page1.ecbb004" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb005
         ON ACTION controlp INFIELD ecbb005
            #add-point:ON ACTION controlp INFIELD ecbb005
            {<point name="input.c.page1.ecbb005" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb006
         ON ACTION controlp INFIELD ecbb006
            #add-point:ON ACTION controlp INFIELD ecbb006
            {<point name="input.c.page1.ecbb006" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb007
         ON ACTION controlp INFIELD ecbb007
            #add-point:ON ACTION controlp INFIELD ecbb007
            {<point name="input.c.page1.ecbb007" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb008
         ON ACTION controlp INFIELD ecbb008
            #add-point:ON ACTION controlp INFIELD ecbb008
            {<point name="input.c.page1.ecbb008" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb009
         ON ACTION controlp INFIELD ecbb009
            #add-point:ON ACTION controlp INFIELD ecbb009
            {<point name="input.c.page1.ecbb009" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb010
         ON ACTION controlp INFIELD ecbb010
            #add-point:ON ACTION controlp INFIELD ecbb010
            {<point name="input.c.page1.ecbb010" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb011
         ON ACTION controlp INFIELD ecbb011
            #add-point:ON ACTION controlp INFIELD ecbb011
            {<point name="input.c.page1.ecbb011" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb012
         ON ACTION controlp INFIELD ecbb012
            #add-point:ON ACTION controlp INFIELD ecbb012
            {<point name="input.c.page1.ecbb012" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb024
         ON ACTION controlp INFIELD ecbb024
            #add-point:ON ACTION controlp INFIELD ecbb024
            {<point name="input.c.page1.ecbb024" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb025
         ON ACTION controlp INFIELD ecbb025
            #add-point:ON ACTION controlp INFIELD ecbb025
            {<point name="input.c.page1.ecbb025" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb026
         ON ACTION controlp INFIELD ecbb026
            #add-point:ON ACTION controlp INFIELD ecbb026
            {<point name="input.c.page1.ecbb026" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb027
         ON ACTION controlp INFIELD ecbb027
            #add-point:ON ACTION controlp INFIELD ecbb027
            {<point name="input.c.page1.ecbb027" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb034
         ON ACTION controlp INFIELD ecbb034
            #add-point:ON ACTION controlp INFIELD ecbb034
            {<point name="input.c.page1.ecbb034" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb013
         ON ACTION controlp INFIELD ecbb013
            #add-point:ON ACTION controlp INFIELD ecbb013
            {<point name="input.c.page1.ecbb013" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb014
         ON ACTION controlp INFIELD ecbb014
            #add-point:ON ACTION controlp INFIELD ecbb014
            {<point name="input.c.page1.ecbb014" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb015
         ON ACTION controlp INFIELD ecbb015
            #add-point:ON ACTION controlp INFIELD ecbb015
            {<point name="input.c.page1.ecbb015" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb016
         ON ACTION controlp INFIELD ecbb016
            #add-point:ON ACTION controlp INFIELD ecbb016
            {<point name="input.c.page1.ecbb016" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb017
         ON ACTION controlp INFIELD ecbb017
            #add-point:ON ACTION controlp INFIELD ecbb017
            {<point name="input.c.page1.ecbb017" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb018
         ON ACTION controlp INFIELD ecbb018
            #add-point:ON ACTION controlp INFIELD ecbb018
            {<point name="input.c.page1.ecbb018" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb019
         ON ACTION controlp INFIELD ecbb019
            #add-point:ON ACTION controlp INFIELD ecbb019
            {<point name="input.c.page1.ecbb019" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb020
         ON ACTION controlp INFIELD ecbb020
            #add-point:ON ACTION controlp INFIELD ecbb020
            {<point name="input.c.page1.ecbb020" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb030
         ON ACTION controlp INFIELD ecbb030
            #add-point:ON ACTION controlp INFIELD ecbb030
            {<point name="input.c.page1.ecbb030" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb031
         ON ACTION controlp INFIELD ecbb031
            #add-point:ON ACTION controlp INFIELD ecbb031
            {<point name="input.c.page1.ecbb031" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb032
         ON ACTION controlp INFIELD ecbb032
            #add-point:ON ACTION controlp INFIELD ecbb032
            {<point name="input.c.page1.ecbb032" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb021
         ON ACTION controlp INFIELD ecbb021
            #add-point:ON ACTION controlp INFIELD ecbb021
            {<point name="input.c.page1.ecbb021" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb022
         ON ACTION controlp INFIELD ecbb022
            #add-point:ON ACTION controlp INFIELD ecbb022
            {<point name="input.c.page1.ecbb022" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb023
         ON ACTION controlp INFIELD ecbb023
            #add-point:ON ACTION controlp INFIELD ecbb023
            {<point name="input.c.page1.ecbb023" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb033
         ON ACTION controlp INFIELD ecbb033
            #add-point:ON ACTION controlp INFIELD ecbb033
            {<point name="input.c.page1.ecbb033" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb028
         ON ACTION controlp INFIELD ecbb028
            #add-point:ON ACTION controlp INFIELD ecbb028
            {<point name="input.c.page1.ecbb028" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb029
         ON ACTION controlp INFIELD ecbb029
            #add-point:ON ACTION controlp INFIELD ecbb029
            {<point name="input.c.page1.ecbb029" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ooff013
         ON ACTION controlp INFIELD ooff013
            #add-point:ON ACTION controlp INFIELD ooff013
            {<point name="input.c.page1.ooff013" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb035
         ON ACTION controlp INFIELD ecbb035
            #add-point:ON ACTION controlp INFIELD ecbb035
            {<point name="input.c.page1.ecbb035" />}
            #END add-point
 
         #Ctrlp:input.c.page1.ecbb036
         ON ACTION controlp INFIELD ecbb036
            #add-point:ON ACTION controlp INFIELD ecbb036
            {<point name="input.c.page1.ecbb036" />}
            #END add-point
 
 
 
         ON ROW CHANGE
            IF INT_FLAG THEN
               CALL cl_err('',9001,0)
               LET INT_FLAG = 0
               LET g_ecbb_d[l_ac].* = g_ecbb_d_t.*
               CLOSE aecm200_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               CALL cl_err(g_ecbb_d[l_ac].ecbb003,-263,1)
               LET g_ecbb_d[l_ac].* = g_ecbb_d_t.*
            ELSE
            
               #add-point:單身修改前
               {<point name="input.body.b_update" mark="Y"/>}
               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
               UPDATE ecbb_t SET (ecbb001,ecbb002,ecbb003,ecbb004,ecbb005,ecbb006,ecbb007,ecbb008,ecbb009, 
                   ecbb010,ecbb011,ecbb012,ecbb024,ecbb025,ecbb026,ecbb027,ecbb034,ecbb013,ecbb014,ecbb015, 
                   ecbb016,ecbb017,ecbb018,ecbb019,ecbb020,ecbb030,ecbb031,ecbb032,ecbb021,ecbb022,ecbb023, 
                   ecbb033,ecbb028,ecbb029,ecbb035,ecbb036) = (g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[l_ac].ecbb003, 
                   g_ecbb_d[l_ac].ecbb004,g_ecbb_d[l_ac].ecbb005,g_ecbb_d[l_ac].ecbb006,g_ecbb_d[l_ac].ecbb007, 
                   g_ecbb_d[l_ac].ecbb008,g_ecbb_d[l_ac].ecbb009,g_ecbb_d[l_ac].ecbb010,g_ecbb_d[l_ac].ecbb011, 
                   g_ecbb_d[l_ac].ecbb012,g_ecbb_d[l_ac].ecbb024,g_ecbb_d[l_ac].ecbb025,g_ecbb_d[l_ac].ecbb026, 
                   g_ecbb_d[l_ac].ecbb027,g_ecbb_d[l_ac].ecbb034,g_ecbb_d[l_ac].ecbb013,g_ecbb_d[l_ac].ecbb014, 
                   g_ecbb_d[l_ac].ecbb015,g_ecbb_d[l_ac].ecbb016,g_ecbb_d[l_ac].ecbb017,g_ecbb_d[l_ac].ecbb018, 
                   g_ecbb_d[l_ac].ecbb019,g_ecbb_d[l_ac].ecbb020,g_ecbb_d[l_ac].ecbb030,g_ecbb_d[l_ac].ecbb031, 
                   g_ecbb_d[l_ac].ecbb032,g_ecbb_d[l_ac].ecbb021,g_ecbb_d[l_ac].ecbb022,g_ecbb_d[l_ac].ecbb023, 
                   g_ecbb_d[l_ac].ecbb033,g_ecbb_d[l_ac].ecbb028,g_ecbb_d[l_ac].ecbb029,g_ecbb_d[l_ac].ecbb035, 
                   g_ecbb_d[l_ac].ecbb036)
                WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND ecbb001 = g_ecba_m.ecba001 
                  AND ecbb002 = g_ecba_m.ecba002 
 
                  AND ecbb003 = g_ecbb_d_t.ecbb003 #項次   
 
                  
               #add-point:單身修改中
               {<point name="input.body.m_update"/>}
               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     CALL cl_err("ecbb_t","std-00009",1)
                     CALL s_transaction_end('N','0')
                     LET g_ecbb_d[l_ac].* = g_ecbb_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     CALL cl_err("ecbb_t",SQLCA.sqlcode,1)
                     LET g_ecbb_d[l_ac].* = g_ecbb_d_t.*                     
                     CALL s_transaction_end('N','0')
                  OTHERWISE
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_ecba_m.ecba001
               LET gs_keys_bak[1] = g_ecba001_t
               LET gs_keys[2] = g_ecba_m.ecba002
               LET gs_keys_bak[2] = g_ecba002_t
               LET gs_keys[3] = g_ecbb_d[g_detail_idx].ecbb003
               LET gs_keys_bak[3] = g_ecbb_d_t.ecbb003
               CALL aecm200_update_b('ecbb_t',gs_keys,gs_keys_bak,"'1'")
                     #資料多語言用-增/改
                     
               END CASE
               
               LET g_log1 = util.JSON.stringify(g_ecba_m),util.JSON.stringify(g_ecbb_d_t)
               LET g_log2 = util.JSON.stringify(g_ecba_m),util.JSON.stringify(g_ecbb_d[l_ac])
               
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               END IF
               
               #add-point:單身修改後
               {<point name="input.body.a_update"/>}
               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row
            {<point name="input.body.after_row"/>}
            #end add-point
            CALL aecm200_unlock_b("ecbb_t","'1'")
            CALL s_transaction_end('Y','0')
            #其他table進行unlock
            #add-point:單身after_row2
            {<point name="input.body.after_row2"/>}
            #end add-point
              
         AFTER INPUT
            #add-point:input段after input 
            {<point name="input.body.after_input"/>}
            #end add-point 
 
         ON ACTION controlo    
            CALL FGL_SET_ARR_CURR(g_ecbb_d.getLength()+1)
            LET lb_reproduce = TRUE
            LET li_reproduce = l_ac
            LET li_reproduce_target = g_ecbb_d.getLength()+1
            
         #ON ACTION cancel
         #   LET INT_FLAG = 1
         #   LET g_detail_idx = 1
         #   EXIT DIALOG 
 
      END INPUT
      
 
      
 
      
 
      
 
      
]]>
  </section>
  <section id="aecm200.input.head" ver="8" status="" src="s">
    <![CDATA[      #單頭段
      INPUT BY NAME g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ooeb013  

         ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂ACTION(master_input)
         
     
         BEFORE INPUT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            
            IF l_cmd_t = 'r' THEN
               
            END IF
            #add-point:資料輸入前
            {<point name="input.m.before_input"/>}
            #end add-point
 
                  #此段落由子樣板a02產生
         AFTER FIELD ecba001
            
            #add-point:AFTER FIELD ecba001
            {<point name="input.a.ecba001" />}
            #END add-point
            
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecba001
            #add-point:BEFORE FIELD ecba001
            {<point name="input.b.ecba001" />}
            #END add-point
 
         #此段落由子樣板a04產生
         ON CHANGE ecba001
            #add-point:ON CHANGE ecba001
            {<point name="input.g.ecba001" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecba002
            #add-point:BEFORE FIELD ecba002
            {<point name="input.b.ecba002" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecba002
            
            #add-point:AFTER FIELD ecba002
            {<point name="input.a.ecba002" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecba002
            #add-point:ON CHANGE ecba002
            {<point name="input.g.ecba002" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecba003
            #add-point:BEFORE FIELD ecba003
            {<point name="input.b.ecba003" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecba003
            
            #add-point:AFTER FIELD ecba003
            {<point name="input.a.ecba003" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecba003
            #add-point:ON CHANGE ecba003
            {<point name="input.g.ecba003" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ecbastus
            #add-point:BEFORE FIELD ecbastus
            {<point name="input.b.ecbastus" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ecbastus
            
            #add-point:AFTER FIELD ecbastus
            {<point name="input.a.ecbastus" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ecbastus
            #add-point:ON CHANGE ecbastus
            {<point name="input.g.ecbastus" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD ooeb013
            #add-point:BEFORE FIELD ooeb013
            {<point name="input.b.ooeb013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD ooeb013
            
            #add-point:AFTER FIELD ooeb013
            {<point name="input.a.ooeb013" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE ooeb013
            #add-point:ON CHANGE ooeb013
            {<point name="input.g.ooeb013" />}
            #END add-point
 
 #欄位檢查
                  #Ctrlp:input.c.ecba001
         ON ACTION controlp INFIELD ecba001
            #add-point:ON ACTION controlp INFIELD ecba001
            {<point name="input.c.ecba001" />}
            #END add-point
 
         #Ctrlp:input.c.ecba002
         ON ACTION controlp INFIELD ecba002
            #add-point:ON ACTION controlp INFIELD ecba002
            {<point name="input.c.ecba002" />}
            #END add-point
 
         #Ctrlp:input.c.ecba003
         ON ACTION controlp INFIELD ecba003
            #add-point:ON ACTION controlp INFIELD ecba003
            {<point name="input.c.ecba003" />}
            #END add-point
 
         #Ctrlp:input.c.ecbastus
         ON ACTION controlp INFIELD ecbastus
            #add-point:ON ACTION controlp INFIELD ecbastus
            {<point name="input.c.ecbastus" />}
            #END add-point
 
         #Ctrlp:input.c.ooeb013
         ON ACTION controlp INFIELD ooeb013
            #add-point:ON ACTION controlp INFIELD ooeb013
            {<point name="input.c.ooeb013" />}
            #END add-point
 
 #欄位開窗
            
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
 
            CALL cl_showmsg()      #錯誤訊息統整顯示
            DISPLAY BY NAME g_ecba_m.ecba001,g_ecba_m.ecba002
                        
            #add-point:單頭INPUT後
            {<point name="input.head.after_input"/>}
            #end add-point
                        
            IF p_cmd <> 'u' THEN
    
               CALL s_transaction_begin()
               
               #add-point:單頭新增前
               {<point name="input.head.b_insert" mark="Y"/>}
               #end add-point
               
               INSERT INTO ecba_t (ecbaent, ecbasite,ecba001,ecba002,ecba003,ecbastus,ecbacrtid,ecbacrtdp, 
                   ecbacrtdt,ecbaownid,ecbaowndp,ecbacnfid,ecbacnfdt)
               VALUES (g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecba_m.ecba003,g_ecba_m.ecbastus, 
                   g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid,g_ecba_m.ecbaowndp, 
                   g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt) 
               IF SQLCA.sqlcode THEN
                  CALL cl_err("g_ecba_m",SQLCA.sqlcode,1)  
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF
               
               #add-point:單頭新增中
               {<point name="input.head.m_insert"/>}
               #end add-point
               
               
               
               
               #add-point:單頭新增後
               {<point name="input.head.a_insert"/>}
               #end add-point
               CALL s_transaction_end('Y','0') 
               
               IF l_cmd_t = 'r' AND p_cmd = 'a' THEN
                  CALL aecm200_detail_reproduce()
               END IF
               
               LET p_cmd = 'u'
            ELSE
               CALL s_transaction_begin()
            
               #add-point:單頭修改前
               {<point name="input.head.b_update" mark="Y"/>}
               #end add-point
               
               UPDATE ecba_t SET (ecba001,ecba002,ecba003,ecbastus,ecbacrtid,ecbacrtdp,ecbacrtdt,ecbaownid, 
                   ecbaowndp,ecbacnfid,ecbacnfdt) = (g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecba_m.ecba003, 
                   g_ecba_m.ecbastus,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid, 
                   g_ecba_m.ecbaowndp,g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt)
                WHERE ecbaent = g_enterprise AND ecbasite = g_site AND ecba001 = g_ecba001_t
                  AND ecba002 = g_ecba002_t
 
               IF SQLCA.sqlcode THEN
                  CALL cl_err("ecba_t",SQLCA.sqlcode,1)  
                  CALL s_transaction_end('N','0')
                  CONTINUE DIALOG
               END IF
               
               #add-point:單頭修改中
               {<point name="input.head.m_update"/>}
               #end add-point
               
               
               
               
               LET g_log1 = util.JSON.stringify(g_ecba_m_t)
               LET g_log2 = util.JSON.stringify(g_ecba_m)
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                  CALL s_transaction_end('N','0')
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
               
               #add-point:單頭修改後
               {<point name="input.head.a_update"/>}
               #end add-point
            END IF
            
            LET g_ecba001_t = g_ecba_m.ecba001
            LET g_ecba002_t = g_ecba_m.ecba002
 
            #controlp
            
      END INPUT
   
]]>
  </section>
  <section id="aecm200.input.other" ver="3" status="" src="s">
    <![CDATA[      
      #add-point:自定義input
      {<point name="input.more_input"/>}
      #end add-point
      
      BEFORE DIALOG 
         #add-point:input段before dialog
         {<point name="input.before_dialog"/>}
         #end add-point    
         #新增時強制從單頭開始填
         IF p_cmd = 'a' THEN
            NEXT FIELD ecba001
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD ecbb003
 
            END CASE
         END IF
    
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         IF g_header_hidden THEN
            CALL gfrm_curr.setElementHidden("vb_master",0)
            CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
            LET g_header_hidden = 0     #visible
         ELSE
            CALL gfrm_curr.setElementHidden("vb_master",1)
            CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
            LET g_header_hidden = 1     #hidden     
         END IF
 
      ON ACTION accept
         #add-point:input段accept 
         {<point name="input.accept"/>}
         #end add-point    
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
         
   END DIALOG
    
   #add-point:input段after input 
   {<point name="input.after_input"/>}
   #end add-point    
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.insert" ver="4" status="" src="s">
    <![CDATA[#+ 資料新增
PRIVATE FUNCTION aecm200_insert()
   #add-point:insert段define
   {<point name="insert.define"/>}
   #end add-point    
   
   #清畫面欄位內容
   CLEAR FORM                    
   CALL g_ecbb_d.clear()   
 
 
   INITIALIZE g_ecba_m.* LIKE ecba_t.*             #DEFAULT 設定
   
   LET g_ecba001_t = NULL
   LET g_ecba002_t = NULL
 
   
   CALL s_transaction_begin()
   WHILE TRUE
      #公用欄位給值(單頭)
      #此段落由子樣板a14產生    
      LET g_ecba_m.ecbaownid = g_user
      LET g_ecba_m.ecbaowndp = g_dept
      LET g_ecba_m.ecbacrtid = g_user
      LET g_ecba_m.ecbacrtdp = g_dept 
      LET g_ecba_m.ecbacrtdt = cl_get_current()
      LET g_ecba_m.ecbamodid = ""
      LET g_ecba_m.ecbamoddt = ""
      LET g_ecba_m.ecbastus = "N"
 
 
 
      #append欄位給值
      
     
      #一般欄位給值
            LET g_ecba_m.ecbastus = "N"
 
  
      #add-point:單頭預設值
      {<point name="insert.default"/>}
      #end add-point 
     
      CALL aecm200_input("a")
      
      #add-point:單頭輸入後
      {<point name="insert.after_insert"/>}
      #end add-point
      
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_ecba_m.* = g_ecba_m_t.*
         CALL aecm200_show()
         CALL cl_err('',9001,0)
         CALL s_transaction_end('N','0')
         EXIT WHILE
      END IF
      
      CALL g_ecbb_d.clear()
 
 
      LET g_rec_b = 0
      CALL s_transaction_end('Y','0')
      EXIT WHILE
        
   END WHILE
   
   LET g_state = "Y"
   LET g_current_idx = 1 
   
   LET g_ecba001_t = g_ecba_m.ecba001
   LET g_ecba002_t = g_ecba_m.ecba002
 
   
   LET g_wc = g_wc,  
              " OR ( ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND",
              " ecba001 = '", g_ecba_m.ecba001 CLIPPED, "' "
              ," AND ecba002 = '", g_ecba_m.ecba002 CLIPPED, "' "
 
              , ") "
   
   CLOSE aecm200_cl
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.insert_b" ver="3" status="" src="s">
    <![CDATA[#+ 新增單身後其他table連動
PRIVATE FUNCTION aecm200_insert_b(ps_table,ps_keys,ps_page)
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys     DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE ls_page     STRING
   #add-point:insert_b段define
   {<point name="insert_b.define"/>}
   #end add-point     
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前
      {<point name="insert_b.before_insert" mark="Y"/>}
      #end add-point 
      INSERT INTO ecbb_t
                  (ecbbent, ecbbsite,
                   ecbb001,ecbb002,
                   ecbb003
                   ,ecbb004,ecbb005,ecbb006,ecbb007,ecbb008,ecbb009,ecbb010,ecbb011,ecbb012,ecbb024,ecbb025,ecbb026,ecbb027,ecbb034,ecbb013,ecbb014,ecbb015,ecbb016,ecbb017,ecbb018,ecbb019,ecbb020,ecbb030,ecbb031,ecbb032,ecbb021,ecbb022,ecbb023,ecbb033,ecbb028,ecbb029,ecbb035,ecbb036) 
            VALUES(g_enterprise, g_site,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_ecbb_d[g_detail_idx].ecbb004,g_ecbb_d[g_detail_idx].ecbb005,g_ecbb_d[g_detail_idx].ecbb006, 
                       g_ecbb_d[g_detail_idx].ecbb007,g_ecbb_d[g_detail_idx].ecbb008,g_ecbb_d[g_detail_idx].ecbb009, 
                       g_ecbb_d[g_detail_idx].ecbb010,g_ecbb_d[g_detail_idx].ecbb011,g_ecbb_d[g_detail_idx].ecbb012, 
                       g_ecbb_d[g_detail_idx].ecbb024,g_ecbb_d[g_detail_idx].ecbb025,g_ecbb_d[g_detail_idx].ecbb026, 
                       g_ecbb_d[g_detail_idx].ecbb027,g_ecbb_d[g_detail_idx].ecbb034,g_ecbb_d[g_detail_idx].ecbb013, 
                       g_ecbb_d[g_detail_idx].ecbb014,g_ecbb_d[g_detail_idx].ecbb015,g_ecbb_d[g_detail_idx].ecbb016, 
                       g_ecbb_d[g_detail_idx].ecbb017,g_ecbb_d[g_detail_idx].ecbb018,g_ecbb_d[g_detail_idx].ecbb019, 
                       g_ecbb_d[g_detail_idx].ecbb020,g_ecbb_d[g_detail_idx].ecbb030,g_ecbb_d[g_detail_idx].ecbb031, 
                       g_ecbb_d[g_detail_idx].ecbb032,g_ecbb_d[g_detail_idx].ecbb021,g_ecbb_d[g_detail_idx].ecbb022, 
                       g_ecbb_d[g_detail_idx].ecbb023,g_ecbb_d[g_detail_idx].ecbb033,g_ecbb_d[g_detail_idx].ecbb028, 
                       g_ecbb_d[g_detail_idx].ecbb029,g_ecbb_d[g_detail_idx].ecbb035,g_ecbb_d[g_detail_idx].ecbb036) 

      #add-point:insert_b段資料新增中
      {<point name="insert_b.m_insert"/>}
      #end add-point 
      IF SQLCA.sqlcode THEN
         CALL cl_err("ecbb_t",SQLCA.sqlcode,0)
      END IF
      #add-point:insert_b段資料新增後
      {<point name="insert_b.after_insert"/>}
      #end add-point 
   END IF
   
 
   
 
   
   #add-point:insert_b段other
   {<point name="insert_b.other"/>}
   #end add-point     
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.lock_b" ver="3" status="" src="s">
    <![CDATA[#+ 連動lock其他單身table資料
PRIVATE FUNCTION aecm200_lock_b(ps_table,ps_page)
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:lock_b段define
   {<point name="lock_b.define"/>}
   #end add-point   
   
   #先刷新資料
   #CALL aecm200_b_fill()
   
   #鎖定整組table
   #LET ls_group = "'1',"
   #僅鎖定自身table
   LET ls_group = "ecbb_t"
   
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN aecm200_bcl USING g_enterprise, g_site,
                                       g_ecba_m.ecba001,g_ecba_m.ecba002,g_ecbb_d[g_detail_idx].ecbb003  
                                               
      IF SQLCA.sqlcode THEN
         CALL cl_err("aecm200_bcl",SQLCA.sqlcode,1)
         RETURN FALSE
      END IF
   END IF
                                    
 
   
 
   
   #add-point:lock_b段other
   {<point name="lock_b.other"/>}
   #end add-point  
   
   RETURN TRUE
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.main" ver="9" status="" src="s">
    <![CDATA[#+ 此段落由子樣板a26產生
#OPTIONS SHORT CIRCUIT
#+ 作業開始 
MAIN
   #add-point:main段define
   {<point name="main.define"/>}
   #end add-point   
 
   OPTIONS
   INPUT NO WRAP
   DEFER INTERRUPT
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
       
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("aec","")
 
   #add-point:作業初始化
   {<point name="main.init" />}
   #end add-point
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define
   {<point name="main.define_sql" />}
   #end add-point
   LET g_forupd_sql = " SELECT ecba001,'','',ecba002,ecba003,ecbastus,'',ecbacrtid,'',ecbacrtdp,'',ecbacrtdt, 
       ecbaownid,'',ecbaowndp,'',ecbamodid,'',ecbamoddt,ecbacnfid,'',ecbacnfdt", 
                      " FROM ecba_t",
                      " WHERE ecbaent= ? AND ecbasite= ? AND ecba001=? AND ecba002=? FOR UPDATE"
   #add-point:SQL_define
   {<point name="main.after_define_sql"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)                #轉換不同資料庫語法
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aecm200_cl CURSOR FROM g_forupd_sql                 # LOCK CURSOR
 
   LET g_sql = " SELECT UNIQUE ecba001,ecba002,ecba003,ecbastus,ecbacrtid,ecbacrtdp,ecbacrtdt,ecbaownid, 
       ecbaowndp,ecbamodid,ecbamoddt,ecbacnfid,ecbacnfdt,t1.oofa011 ,t2.ooefl003 ,t3.oofa011 ,t4.ooefl003 , 
       t5.oofa011 ,t6.oofa011",
               " FROM ecba_t",
                              " LEFT JOIN oofa_t t1 ON t1.oofaent='"||g_enterprise||"' AND t1.oofa002='2' AND t1.oofa003=ecbacrtid  ",
               " LEFT JOIN ooefl_t t2 ON t2.ooeflent='"||g_enterprise||"' AND t2.ooefl001=ecbacrtdp AND t2.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN oofa_t t3 ON t3.oofaent='"||g_enterprise||"' AND t3.oofa002='2' AND t3.oofa003=ecbaownid  ",
               " LEFT JOIN ooefl_t t4 ON t4.ooeflent='"||g_enterprise||"' AND t4.ooefl001=ecbaowndp AND t4.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN oofa_t t5 ON t5.oofaent='"||g_enterprise||"' AND t5.oofa002='2' AND t5.oofa003=ecbamodid  ",
               " LEFT JOIN oofa_t t6 ON t6.oofaent='"||g_enterprise||"' AND t6.oofa002='2' AND t6.oofa003=ecbacnfid  ",
 
               " WHERE ecbaent = '" ||g_enterprise|| "' AND ecbasite = '" ||g_site|| "' AND ecba001 = ? AND ecba002 = ?"
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   #add-point:SQL_define
   {<point name="main.after_refresh_sql"/>}
   #end add-point
   PREPARE aecm200_master_referesh FROM g_sql
 
 
 
   
   IF g_bgjob = "Y" THEN
      #add-point:Service Call
      {<point name="main.servicecall" />}
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_aecm200 WITH FORM cl_ap_formpath("aec",g_code)
   
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
   
      #程式初始化
      CALL aecm200_init()   
 
      #進入選單 Menu (="N")
      CALL aecm200_ui_dialog() 
      
      #add-point:畫面關閉前
      {<point name="main.before_close" />}
      #end add-point
 
      #畫面關閉
      CLOSE WINDOW w_aecm200
      
   END IF 
   
   CLOSE aecm200_cl
   
   
 
   #add-point:作業離開前
   {<point name="main.exit" />}
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
   
END MAIN
 
 
]]>
  </section>
  <section id="aecm200.modify" ver="9" status="" src="s">
    <![CDATA[#+ 資料修改
PRIVATE FUNCTION aecm200_modify()
   DEFINE l_new_key    DYNAMIC ARRAY OF STRING
   DEFINE l_old_key    DYNAMIC ARRAY OF STRING
   DEFINE l_field_key  DYNAMIC ARRAY OF STRING
   #add-point:modify段define
   {<point name="modify.define"/>}
   #end add-point    
   
   IF g_ecba_m.ecba001 IS NULL
   OR g_ecba_m.ecba002 IS NULL
 
   THEN
      CALL cl_err("","std-00003",0)
      RETURN
   END IF
   
   EXECUTE aecm200_master_referesh USING g_ecba_m.ecba001,g_ecba_m.ecba002 INTO g_ecba_m.ecba001,g_ecba_m.ecba002, 
       g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid, 
       g_ecba_m.ecbaowndp,g_ecba_m.ecbamodid,g_ecba_m.ecbamoddt,g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt, 
       g_ecba_m.ecbacrtid_desc,g_ecba_m.ecbacrtdp_desc,g_ecba_m.ecbaownid_desc,g_ecba_m.ecbaowndp_desc, 
       g_ecba_m.ecbamodid_desc,g_ecba_m.ecbacnfid_desc
 
   ERROR ""
  
   LET g_ecba001_t = g_ecba_m.ecba001
   LET g_ecba002_t = g_ecba_m.ecba002
 
   CALL s_transaction_begin()
   
   OPEN aecm200_cl USING g_enterprise, g_site,g_ecba_m.ecba001,g_ecba_m.ecba002
   IF STATUS THEN
      CALL cl_err("OPEN aecm200_cl:", STATUS, 1)
      CLOSE aecm200_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE aecm200_master_referesh USING g_ecba_m.ecba001,g_ecba_m.ecba002 INTO g_ecba_m.ecba001,g_ecba_m.ecba002, 
       g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid, 
       g_ecba_m.ecbaowndp,g_ecba_m.ecbamodid,g_ecba_m.ecbamoddt,g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt, 
       g_ecba_m.ecbacrtid_desc,g_ecba_m.ecbacrtdp_desc,g_ecba_m.ecbaownid_desc,g_ecba_m.ecbaowndp_desc, 
       g_ecba_m.ecbamodid_desc,g_ecba_m.ecbacnfid_desc
 
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      CALL cl_err(g_ecba_m.ecba001,SQLCA.sqlcode,0)
      CLOSE aecm200_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   
   
   #add-point:modify段show之前
   {<point name="modify.before_show"/>}
   #end add-point  
   
   CALL aecm200_show()
   WHILE TRUE
      LET g_ecba001_t = g_ecba_m.ecba001
      LET g_ecba002_t = g_ecba_m.ecba002
 
      
      #寫入修改者/修改日期資訊(單頭)
      LET g_ecba_m.ecbamodid = g_user 
LET g_ecba_m.ecbamoddt = cl_get_current()
 
      
      #add-point:modify段修改前
      {<point name="modify.before_input"/>}
      #end add-point
      
      #欄位更改
      CALL aecm200_input("u")
 
      #add-point:modify段修改後
      {<point name="modify.after_input"/>}
      #end add-point
      
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_ecba_m.* = g_ecba_m_t.*
         CALL aecm200_show()
         CALL cl_err('',9001,0)
         CALL s_transaction_end('N','0')
         EXIT WHILE
      END IF 
      
      #若有modid跟moddt則進行update
      UPDATE ecba_t SET (ecbamodid,ecbamoddt) = (g_ecba_m.ecbamodid,g_ecba_m.ecbamoddt)
       WHERE ecbaent = g_enterprise AND ecbasite = g_site AND ecba001 = g_ecba001_t
         AND ecba002 = g_ecba002_t
 
                  
      #若單頭key欄位有變更
      IF g_ecba_m.ecba001 != g_ecba001_t 
      OR g_ecba_m.ecba002 != g_ecba002_t 
 
      THEN
         CALL s_transaction_begin()
         
         #add-point:單身fk修改前
         {<point name="modify.body.b_fk_update" mark="Y"/>}
         #end add-point
         
         #更新單身key值
         UPDATE ecbb_t SET ecbb001 = g_ecba_m.ecba001
                                       ,ecbb002 = g_ecba_m.ecba002
 
          WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND ecbb001 = g_ecba001_t
            AND ecbb002 = g_ecba002_t
 
            
         #add-point:單身fk修改中
         {<point name="modify.body.m_fk_update"/>}
         #end add-point
 
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               CALL cl_err("ecbb_t","std-00009",1)
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               CALL cl_err("ecbb_t",SQLCA.sqlcode,1)  
               CALL s_transaction_end('N','0')
               CONTINUE WHILE
         END CASE
         
         #add-point:單身fk修改後
         {<point name="modify.body.a_fk_update"/>}
         #end add-point
         
 
         
 
         
         #UPDATE 多語言table key值
         
 
         CALL s_transaction_end('Y','0')
      END IF
    
      EXIT WHILE
   END WHILE
 
   #修改歷程記錄
   #IF NOT cl_log_modified_record(g_ecba_m.ecba001,g_site) THEN 
   #   CALL s_transaction_end('N','0')
   #END IF
 
   CLOSE aecm200_cl
   CALL s_transaction_end('Y','0')
 
   #流程通知預埋點-U
   CALL cl_flow_notify(g_ecba_m.ecba001,'U')
 
END FUNCTION   
]]>
  </section>
  <section id="aecm200.other_dialog" ver="2" status="" src="s">
    <![CDATA[   
]]>
  </section>
  <section id="aecm200.other_function" ver="2" status="" src="s">
    <![CDATA[{<point name="other.function"/>}
]]>
  </section>
  <section id="aecm200.query" ver="4" status="" src="s">
    <![CDATA[#+ 資料查詢QBE功能準備
PRIVATE FUNCTION aecm200_query()
   DEFINE ls_wc STRING
   #add-point:query段define
   {<point name="query.define"/>}
   #end add-point   
 
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF   
   
   LET ls_wc = g_wc
   
   LET INT_FLAG = 0
   CALL cl_navigator_setting( g_current_idx, g_detail_cnt )
   ERROR ""
   
   #清除畫面及相關資料
   CLEAR FORM
   CALL g_browser.clear()       
   CALL g_ecbb_d.clear()
 
   
   #add-point:query段other
   {<point name="query.other"/>}
   #end add-point   
   
   DISPLAY ' ' TO FORMONLY.idx
   DISPLAY ' ' TO FORMONLY.cnt
   DISPLAY ' ' TO FORMONLY.b_index
   DISPLAY ' ' TO FORMONLY.b_count
   DISPLAY ' ' TO FORMONLY.h_index
   DISPLAY ' ' TO FORMONLY.h_count
   
   CALL aecm200_construct()
 
   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      LET g_wc = ls_wc
      CALL aecm200_browser_fill("")
      CALL aecm200_fetch("")
      RETURN
   END IF
   
   #儲存WC資訊
   CALL cl_dlg_save_user_latestqry("("||g_wc||") AND ("||g_wc2||")")
   
   #搜尋後資料初始化 
   LET g_detail_cnt  = 0
   LET g_current_idx = 1
   LET g_current_row = 0
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   LET g_error_show  = 1
   LET g_wc_filter   = ""
   LET l_ac = 1
   CALL FGL_SET_ARR_CURR(1)
      CALL aecm200_filter_show('ecba001')
   CALL aecm200_filter_show('ecba002')
   CALL aecm200_filter_show('ecba003')
   CALL aecm200_browser_fill("F")
         
   IF g_browser_cnt = 0 THEN
      CALL cl_err("","-100",1)
   ELSE
      CALL aecm200_fetch("F") 
   END IF
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.reproduce" ver="5" status="" src="s">
    <![CDATA[#+ 資料複製
PRIVATE FUNCTION aecm200_reproduce()
   DEFINE l_newno     LIKE ecba_t.ecba001 
   DEFINE l_oldno     LIKE ecba_t.ecba001 
   DEFINE l_newno02     LIKE ecba_t.ecba002 
   DEFINE l_oldno02     LIKE ecba_t.ecba002 
 
   DEFINE l_master    RECORD LIKE ecba_t.*
   DEFINE l_detail    RECORD LIKE ecbb_t.*
 
 
   DEFINE l_cnt       LIKE type_t.num5
   #add-point:reproduce段define
   {<point name="reproduce.define"/>}
   #end add-point   
 
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
   
   IF g_ecba_m.ecba001 IS NULL
   OR g_ecba_m.ecba002 IS NULL
 
   THEN
      CALL cl_err("","std-00003",0)
      RETURN
   END IF
    
   LET g_ecba001_t = g_ecba_m.ecba001
   LET g_ecba002_t = g_ecba_m.ecba002
 
    
   LET g_ecba_m.ecba001 = ""
   LET g_ecba_m.ecba002 = ""
 
    
   CALL aecm200_set_entry('a')
   CALL aecm200_set_no_entry('a')
 
   CALL cl_set_head_visible("","YES")
 
   #公用欄位給予預設值
   #此段落由子樣板a14產生    
      LET g_ecba_m.ecbaownid = g_user
      LET g_ecba_m.ecbaowndp = g_dept
      LET g_ecba_m.ecbacrtid = g_user
      LET g_ecba_m.ecbacrtdp = g_dept 
      LET g_ecba_m.ecbacrtdt = cl_get_current()
      LET g_ecba_m.ecbamodid = ""
      LET g_ecba_m.ecbamoddt = ""
      LET g_ecba_m.ecbastus = "N"
 
 
   
   CALL s_transaction_begin()
   
   #add-point:複製輸入前
   {<point name="reproduce.head.b_input"/>}
   #end add-point
   
   CALL aecm200_input("r")
   
      LET g_ecba_m.ecba001_desc = ''
   DISPLAY BY NAME g_ecba_m.ecba001_desc
   LET g_ecba_m.ecba001_desc1 = ''
   DISPLAY BY NAME g_ecba_m.ecba001_desc1
 
   
   IF INT_FLAG THEN
      LET INT_FLAG = 0
      RETURN
   END IF
 
   LET g_state = "Y"
   LET g_current_idx = 1 
   
   LET g_wc = g_wc,  
              " OR (",
              " ecba001 = '", g_ecba_m.ecba001 CLIPPED, "' "
              ," AND ecba002 = '", g_ecba_m.ecba002 CLIPPED, "' "
 
              , ") "
   
   #add-point:完成複製段落後
   {<point name="reproduce.after_reproduce" />}
   #end add-point
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.set_entry" ver="2" status="" src="s">
    <![CDATA[#+ 單頭欄位開啟設定
PRIVATE FUNCTION aecm200_set_entry(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1  
   #add-point:set_entry段define
   {<point name="set_entry.define"/>}
   #end add-point       
 
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("ecba001,ecba002",TRUE)
      #add-point:set_entry段欄位控制
      {<point name="set_entry.field_control"/>}
      #end add-point  
   END IF
   
   #add-point:set_entry段欄位控制後
   {<point name="set_entry.after_control"/>}
   #end add-point 
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.set_entry_b" ver="2" status="" src="s">
    <![CDATA[#+ 單身欄位開啟設定
PRIVATE FUNCTION aecm200_set_entry_b(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_entry_b段define
   {<point name="set_entry_b.define"/>}
   #end add-point     
   #add-point:set_entry_b段
   {<point name="set_entry_b.set_entry_b"/>}
   #end add-point  
END FUNCTION
]]>
  </section>
  <section id="aecm200.set_no_entry" ver="3" status="" src="s">
    <![CDATA[#+ 單頭欄位關閉設定
PRIVATE FUNCTION aecm200_set_no_entry(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry段define
   {<point name="set_no_entry.define"/>}
   #end add-point     
 
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("ecba001,ecba002",FALSE)
      #add-point:set_no_entry段欄位控制
      {<point name="set_no_entry.field_control"/>}
      #end add-point 
   END IF 
   
   #add-point:set_no_entry段欄位控制後
   {<point name="set_no_entry.after_control"/>}
   #end add-point 
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.set_no_entry_b" ver="2" status="" src="s">
    <![CDATA[#+ 單身欄位關閉設定
PRIVATE FUNCTION aecm200_set_no_entry_b(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry_b段define
   {<point name="set_no_entry_b.define"/>}
   #end add-point    
   #add-point:set_no_entry_b段
   {<point name="set_no_entry_b.set_no_entry_b"/>}
   #end add-point     
END FUNCTION
]]>
  </section>
  <section id="aecm200.set_pk_array" ver="1" status="" src="s">
    <![CDATA[   #+ 此段落由子樣板a51產生
#+ 給予pk_array內容
PRIVATE FUNCTION aecm200_set_pk_array()
   #add-point:set_pk_array段define
   {<point name="set_pk_array.define"/>}
   #end add-point
   
   #add-point:set_pk_array段之前
   {<point name="set_pk_array.before"/>}
   #end add-point  
   
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_ecba_m.ecba001
   LET g_pk_array[1].column = 'ecba001'
   LET g_pk_array[2].values = g_ecba_m.ecba002
   LET g_pk_array[2].column = 'ecba002'
   
   #add-point:set_pk_array段之後
   {<point name="set_pk_array.after"/>}
   #end add-point  
   
END FUNCTION
 
 
]]>
  </section>
  <section id="aecm200.show" ver="6" status="" src="s">
    <![CDATA[#+ 單頭資料重新顯示及單身資料重抓
PRIVATE FUNCTION aecm200_show()
   DEFINE l_ac_t    LIKE type_t.num5
   #add-point:show段define
   {<point name="show.define"/>}
   #end add-point  
 
   #add-point:show段之前
   {<point name="show.before"/>}
   #end add-point
   
   
   
   LET g_ecba_m_t.* = g_ecba_m.*      #保存單頭舊值
   
   IF g_bfill = "Y" THEN
      CALL aecm200_b_fill() #單身填充
      CALL aecm200_b_fill2('0') #單身填充
   END IF
     
   #帶出公用欄位reference值
   #此段落由子樣板a12產生
      #LET g_ecba_m.ecbaownid_desc = cl_get_username(g_ecba_m.ecbaownid)
      #LET g_ecba_m.ecbaowndp_desc = cl_get_deptname(g_ecba_m.ecbaowndp)
      #LET g_ecba_m.ecbacrtid_desc = cl_get_username(g_ecba_m.ecbacrtid)
      #LET g_ecba_m.ecbacrtdp_desc = cl_get_deptname(g_ecba_m.ecbacrtdp)
      #LET g_ecba_m.ecbamodid_desc = cl_get_username(g_ecba_m.ecbamodid)
      #LET g_ecba_m.ecbacnfid_desc = cl_get_deptname(g_ecba_m.ecbacnfid)
      
 
 
   
   #顯示followup圖示
   #+ 此段落由子樣板a48產生
   CALL aecm200_set_pk_array()
   #add-point:ON ACTION agendum
   {<point name="show.follow_pic"/>}
   #END add-point
   CALL cl_user_overview_set_follow_pic()
 
 
   
   LET l_ac_t = l_ac
   
   #讀入ref值(單頭)
   #add-point:show段reference
   {<point name="show.head.reference"/>}
   #end add-point
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_ecba_m.ecba001,g_ecba_m.ecba001_desc,g_ecba_m.ecba001_desc1,g_ecba_m.ecba002,g_ecba_m.ecba003, 
       g_ecba_m.ecbastus,g_ecba_m.ooeb013,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtid_desc,g_ecba_m.ecbacrtdp, 
       g_ecba_m.ecbacrtdp_desc,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid,g_ecba_m.ecbaownid_desc,g_ecba_m.ecbaowndp, 
       g_ecba_m.ecbaowndp_desc,g_ecba_m.ecbamodid,g_ecba_m.ecbamodid_desc,g_ecba_m.ecbamoddt,g_ecba_m.ecbacnfid, 
       g_ecba_m.ecbacnfid_desc,g_ecba_m.ecbacnfdt
   
   #顯示狀態(stus)圖片
         #此段落由子樣板a21產生
      CASE g_ecba_m.ecbastus
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/void.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/valid.png")
         
      END CASE
 
 
   
   #讀入ref值(單身)
   FOR l_ac = 1 TO g_ecbb_d.getLength()
      #add-point:show段單身reference
      {<point name="show.body.reference"/>}
      #end add-point
   END FOR
   
 
   
    
   
   #add-point:show段other
   {<point name="show.other"/>}
   #end add-point  
   
   LET l_ac = l_ac_t
   
   #移動上下筆可以連動切換資料
   CALL cl_show_fld_cont()     
 
   CALL aecm200_detail_show()
   
   #add-point:show段之後
   {<point name="show.after"/>}
   #end add-point
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.signature" ver="1" status="" src="s">
    <![CDATA[   
]]>
  </section>
  <section id="aecm200.state_change" ver="4" status="" src="s">
    <![CDATA[   #+ 此段落由子樣板a09產生
#+ 確認碼變更
PRIVATE FUNCTION aecm200_statechange()
   DEFINE lc_state LIKE type_t.chr5
   #add-point:statechange段define
   {<point name="statechange.define"/>}
   #end add-point  
   
   #add-point:statechange段開始前
   {<point name="statechange.before"/>}
   #end add-point  
   
   ERROR ""     #清空畫面右下側ERROR區塊
 
   IF g_ecba_m.ecba001 IS NULL
      OR g_ecba_m.ecba002 IS NULL
   THEN
      CALL cl_err("","std-00003",0)
      RETURN
   END IF
 
   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_ecba_m.ecbastus
            WHEN "N"
               HIDE OPTION "open"
            WHEN "X"
               HIDE OPTION "void"
            WHEN "Y"
               HIDE OPTION "valid"
            
         END CASE
     
      #add-point:menu前
      {<point name="statechange.before_menu"/>}
      #end add-point
      
      ON ACTION open
         LET lc_state = "N"
         #add-point:action控制
         {<point name="statechange.open"/>}
         #end add-point
         EXIT MENU
      ON ACTION void
         LET lc_state = "X"
         #add-point:action控制
         {<point name="statechange.void"/>}
         #end add-point
         EXIT MENU
      ON ACTION valid
         LET lc_state = "Y"
         #add-point:action控制
         {<point name="statechange.valid"/>}
         #end add-point
         EXIT MENU
      
      
      
      #add-point:stus控制
      {<point name="statechange.more_control"/>}
      #end add-point
      
   END MENU
   
   IF (lc_state <> "N" 
      AND lc_state <> "X"
      AND lc_state <> "Y"
      ) OR 
      cl_null(lc_state) THEN
      RETURN
   END IF
   
   #add-point:stus修改前
   {<point name="statechange.b_update"/>}
   #end add-point
      
   UPDATE ecba_t SET ecbastus = lc_state 
    WHERE ecbaent = g_enterprise AND ecbasite = g_site AND ecba001 = g_ecba_m.ecba001
      AND ecba002 = g_ecba_m.ecba002
  
   IF SQLCA.sqlcode THEN
      CALL cl_err("",SQLCA.sqlcode,0)
   ELSE
      CASE lc_state
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/void.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/valid.png")
         
      END CASE
      LET g_ecba_m.ecbastus = lc_state
      DISPLAY BY NAME g_ecba_m.ecbastus
   END IF
 
   #add-point:stus修改後
   {<point name="statechange.a_update"/>}
   #end add-point
 
   #add-point:statechange段結束前
   {<point name="statechange.after"/>}
   #end add-point  
 
END FUNCTION
 
 
]]>
  </section>
  <section id="aecm200.ui_browser_refresh" ver="4" status="" src="s">
    <![CDATA[#+ 瀏覽頁簽資料重新顯示
PRIVATE FUNCTION aecm200_ui_browser_refresh()
   DEFINE l_i  LIKE type_t.num10
   #add-point:ui_browser_refresh段define
   {<point name="ui_browser_refresh.define"/>}
   #end add-point    
   
   FOR l_i =1 TO g_browser.getLength()
      IF g_browser[l_i].b_ecba001 = g_ecba_m.ecba001 
         AND g_browser[l_i].b_ecba002 = g_ecba_m.ecba002 
 
         THEN  
         CALL g_browser.deleteElement(l_i)
         LET g_header_cnt = g_header_cnt - 1
         EXIT FOR
      END IF
   END FOR
 
   LET g_browser_cnt = g_browser_cnt - 1
   IF g_current_row > g_browser_cnt THEN        #確定browse 筆數指在同一筆
      LET g_current_row = g_browser_cnt
   END IF
 
   #DISPLAY g_browser_cnt TO FORMONLY.b_count    #總筆數的顯示
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.ui_detailshow" ver="1" status="" src="s">
    <![CDATA[#+ 單身資料重新顯示
PRIVATE FUNCTION aecm200_ui_detailshow()
   #add-point:ui_detailshow段define
   {<point name="ui_detailshow.define"/>}
   #end add-point    
   
   #add-point:ui_detailshow段before
   {<point name="ui_detailshow.before"/>}
   #end add-point    
   
   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail1",g_detail_idx)      
 
   END IF
   
   #add-point:ui_detailshow段after
   {<point name="ui_detailshow.after"/>}
   #end add-point    
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.ui_dialog" ver="21" status="" src="s">
    <![CDATA[#+ 功能選單
PRIVATE FUNCTION aecm200_ui_dialog()
   DEFINE li_idx    LIKE type_t.num5
   DEFINE ls_wc     STRING
   DEFINE lb_first  BOOLEAN
   DEFINE la_param  RECORD
             prog   STRING,
             param  DYNAMIC ARRAY OF STRING
                    END RECORD
   DEFINE ls_js     STRING
   #add-point:ui_dialog段define
   {<point name="ui_dialog.define"/>}
   #end add-point
   
   CALL cl_set_act_visible("accept,cancel", FALSE)
 
   CALL gfrm_curr.setElementImage("logo","logo/applogo.png") 
   IF g_default THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   ELSE
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF
   
   #action default動作
   #+ 此段落由子樣板a42產生
   CASE g_actdefault
      WHEN "insert"
         LET g_action_choice="insert"
         LET g_actdefault = ""
         IF cl_auth_chk_act("insert") THEN
            CALL aecm200_insert()
            #add-point:ON ACTION insert
            {<point name="menu.default.insert" />}
            #END add-point
         END IF
 
      #add-point:action default自訂
      {<point name="ui_dialog.action_default"/>}
      #end add-point
      OTHERWISE
         
   END CASE
 
 
   
   LET lb_first = TRUE
   
   #add-point:ui_dialog段before dialog 
   {<point name="ui_dialog.before_dialog"/>}
   #end add-point
   
   WHILE TRUE 
   
      CALL aecm200_browser_fill("")
      CALL lib_cl_dlg.cl_dlg_before_display()
      CALL cl_notice()
            
      #判斷前一個動作是否為新增, 若是的話切換到新增的筆數
      IF g_state = "Y" THEN
         FOR li_idx = 1 TO g_browser.getLength()
            IF g_browser[li_idx].b_ecba001 = g_ecba001_t
               AND g_browser[li_idx].b_ecba002 = g_ecba002_t
 
               THEN
               LET g_current_row = li_idx
               LET g_current_idx = li_idx
               EXIT FOR
            END IF
         END FOR
         LET g_state = ""
      END IF
            
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
         #左側瀏覽頁簽
         DISPLAY ARRAY g_browser TO s_browse.* ATTRIBUTES(COUNT=g_header_cnt)
 
            BEFORE ROW
               #回歸舊筆數位置 (回到當時異動的筆數)
               LET g_current_idx = DIALOG.getCurrentRow("s_browse")
               IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                  LET g_current_idx = g_current_row
               END IF
               LET g_current_row = g_current_idx #目前指標
               LET g_current_sw = TRUE
 
               IF g_current_idx > g_browser.getLength() THEN
                  LET g_current_idx = g_browser.getLength()
               END IF 
               
               CALL aecm200_fetch('') # reload data
               LET l_ac = 1
               CALL aecm200_ui_detailshow() #Setting the current row 
      
               CALL aecm200_idx_chk()
               #NEXT FIELD ecbb003
         
         END DISPLAY
        
         DISPLAY ARRAY g_ecbb_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) #page1  
    
            BEFORE ROW
               CALL aecm200_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_detail_idx = l_ac
               
               #add-point:page1, before row動作
               {<point name="ui_dialog.page1.before_row"/>}
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單頭則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_detail_idx)
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_current_page = 1
               CALL aecm200_idx_chk()
               #add-point:page1自定義行為
               {<point name="ui_dialog.page1.before_display"/>}
               #end add-point
               
            #自訂ACTION(detail_show,page_1)
            
               
            #add-point:page1自定義行為
            {<point name="ui_dialog.page1.action"/>}
            #end add-point
               
         END DISPLAY
        
 
         
 
         
         #add-point:ui_dialog段自定義display array
         {<point name="ui_dialog.more_displayarray"/>}
         #end add-point
         
         SUBDIALOG lib_cl_dlg.cl_dlg_qryplan
         SUBDIALOG lib_cl_dlg.cl_dlg_relateapps
      
         BEFORE DIALOG
            CALL cl_navigator_setting(g_current_idx, g_detail_cnt)
            LET g_curr_diag = ui.DIALOG.getCurrent()
            LET g_page = "first"
            LET g_current_sw = FALSE
            #回歸舊筆數位置 (回到當時異動的筆數)
            LET g_current_idx = DIALOG.getCurrentRow("s_browse")
            IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
               CALL DIALOG.setCurrentRow("s_browse",g_current_row)
               LET g_current_idx = g_current_row
            END IF
            LET g_current_row = g_current_idx #目前指標
            IF g_current_idx = 0 THEN
               LET g_current_idx = 1
            END IF
            LET g_current_sw = TRUE
            
            IF g_current_idx > g_browser.getLength() THEN
               LEt g_current_idx = g_browser.getLength()
            END IF 
            
            #有資料才進行fetch
            IF g_current_idx <> 0 THEN
               CALL aecm200_fetch('') # reload data
            END IF
            #LET g_detail_idx = 1
            CALL aecm200_ui_detailshow() #Setting the current row 
            
            #筆數顯示
            LET g_current_page = 1
            CALL aecm200_idx_chk()
            
            #add-point:ui_dialog段before_dialog2
            {<point name="ui_dialog.before_dialog2"/>}
            #end add-point
        
         ON ACTION statechange
            LET g_action_choice = "statechange"
            CALL aecm200_statechange()
            EXIT DIALOG
      
         
          
         ON ACTION queryplansel
            CALL cl_dlg_qryplan_select() RETURNING ls_wc
            #不是空條件才寫入g_wc跟重新找資料
            IF NOT cl_null(ls_wc) THEN
               LET g_wc = ls_wc
               CALL aecm200_browser_fill("F")   #browser_fill()會將notice區塊清空
               CALL cl_notice()   #重新顯示,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            END IF
 
         ON ACTION qbe_select
            CALL cl_qbe_list("m") RETURNING ls_wc
            IF NOT cl_null(ls_wc) THEN
               LET g_wc = ls_wc
               #取得條件後需要重查、跳到結果第一筆資料的功能程式段
               CALL aecm200_browser_fill("F")
               IF g_browser_cnt = 0 THEN
                  CALL cl_err("","-100",1)
                  CLEAR FORM
               ELSE
                  CALL aecm200_fetch("F")
               END IF
            END IF
            #重新搜尋會將notice區塊清空,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            CALL cl_notice()
          
         #+ 此段落由子樣板a49產生
            ON ACTION filter
               #add-point:filter action
               {<point name="ui_dialog.action.filter"/>}
               #end add-point
               CALL aecm200_filter()
               EXIT DIALOG
 
 
 
         
         ON ACTION first
            CALL aecm200_fetch('F')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aecm200_idx_chk()
            
         ON ACTION previous
            CALL aecm200_fetch('P')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aecm200_idx_chk()
            
         ON ACTION jump
            CALL aecm200_fetch('/')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aecm200_idx_chk()
            
         ON ACTION next
            CALL aecm200_fetch('N')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aecm200_idx_chk()
            
         ON ACTION last
            CALL aecm200_fetch('L')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL aecm200_idx_chk()
            
         ON ACTION close
            LET INT_FLAG = FALSE
            LET g_action_choice = "exit"
            EXIT DIALOG
          
         ON ACTION exit
            LET g_action_choice = "exit"
            EXIT DIALOG
      
         ON ACTION mainhidden       #主頁摺疊
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF
            
         ON ACTION worksheethidden   #瀏覽頁折疊
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF
            IF lb_first THEN
               LET lb_first = FALSE
               NEXT FIELD ecbb003
            END IF
       
         ON ACTION controls      #單頭摺疊，可利用hot key "Ctrl-s"開啟/關閉單頭
            IF g_header_hidden THEN
               CALL gfrm_curr.setElementHidden("vb_master",0)
               CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
               LET g_header_hidden = 0     #visible
            ELSE
               CALL gfrm_curr.setElementHidden("vb_master",1)
               CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
               LET g_header_hidden = 1     #hidden     
            END IF
    
         
         #+ 此段落由子樣板a43產生
         ON ACTION checkout
            LET g_action_choice="checkout"
            IF cl_auth_chk_act("checkout") THEN
               
               #add-point:ON ACTION checkout
               {<point name="menu.checkout" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL aecm200_modify()
               #add-point:ON ACTION modify
               {<point name="menu.modify" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION modify_detail
            LET g_action_choice="modify_detail"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = g_curr_diag.getCurrentItem()
               CALL aecm200_modify()
               #add-point:ON ACTION modify_detail
               {<point name="menu.modify_detail" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL aecm200_delete()
               #add-point:ON ACTION delete
               {<point name="menu.delete" />}
               #END add-point
               
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL aecm200_insert()
               #add-point:ON ACTION insert
               {<point name="menu.insert" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output
               {<point name="menu.output" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION reproduce
            LET g_action_choice="reproduce"
            IF cl_auth_chk_act("reproduce") THEN
               CALL aecm200_reproduce()
               #add-point:ON ACTION reproduce
               {<point name="menu.reproduce" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL aecm200_query()
               #add-point:ON ACTION query
               {<point name="menu.query" />}
               #END add-point
               
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION resource
            LET g_action_choice="resource"
            IF cl_auth_chk_act("resource") THEN
               
               #add-point:ON ACTION resource
               {<point name="menu.resource" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION stand
            LET g_action_choice="stand"
            IF cl_auth_chk_act("stand") THEN
               
               #add-point:ON ACTION stand
               {<point name="menu.stand" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION bom
            LET g_action_choice="bom"
            IF cl_auth_chk_act("bom") THEN
               
               #add-point:ON ACTION bom
               {<point name="menu.bom" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         #+ 此段落由子樣板a43產生
         ON ACTION checkin
            LET g_action_choice="checkin"
            IF cl_auth_chk_act("checkin") THEN
               
               #add-point:ON ACTION checkin
               {<point name="menu.checkin" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         
         #+ 此段落由子樣板a46產生
         #新增相關文件
         ON ACTION related_document
            CALL aecm200_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document
               {<point name="ui_dialog.dialog.related_document"/>}
               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL aecm200_set_pk_array()
            #add-point:ON ACTION agendum
            {<point name="ui_dialog.dialog.agendum"/>}
            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL aecm200_set_pk_array()
            #add-point:ON ACTION followup
            {<point name="ui_dialog.dialog.followup"/>}
            #END add-point
            CALL cl_user_overview_follow('')
 
 
         
         #主選單用ACTION
         &include "main_menu.4gl"
         &include "relating_action.4gl"
         #交談指令共用ACTION
         &include "common_action.4gl" 
            CONTINUE DIALOG
            
      END DIALOG
    
      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         EXIT WHILE
      END IF
    
   END WHILE    
      
   CALL cl_set_act_visible("accept,cancel", TRUE)
    
END FUNCTION
]]>
  </section>
  <section id="aecm200.ui_headershow" ver="5" status="" src="s">
    <![CDATA[#+ 單頭資料重新顯示
PRIVATE FUNCTION aecm200_ui_headershow()
   #add-point:ui_headershow段define
   {<point name="ui_headershow.define"/>}
   #end add-point    
   
   LET g_ecba_m.ecba001 = g_browser[g_current_idx].b_ecba001   
   LET g_ecba_m.ecba002 = g_browser[g_current_idx].b_ecba002   
 
   EXECUTE aecm200_master_referesh USING g_ecba_m.ecba001,g_ecba_m.ecba002 INTO g_ecba_m.ecba001,g_ecba_m.ecba002, 
       g_ecba_m.ecba003,g_ecba_m.ecbastus,g_ecba_m.ecbacrtid,g_ecba_m.ecbacrtdp,g_ecba_m.ecbacrtdt,g_ecba_m.ecbaownid, 
       g_ecba_m.ecbaowndp,g_ecba_m.ecbamodid,g_ecba_m.ecbamoddt,g_ecba_m.ecbacnfid,g_ecba_m.ecbacnfdt, 
       g_ecba_m.ecbacrtid_desc,g_ecba_m.ecbacrtdp_desc,g_ecba_m.ecbaownid_desc,g_ecba_m.ecbaowndp_desc, 
       g_ecba_m.ecbamodid_desc,g_ecba_m.ecbacnfid_desc
   CALL aecm200_show()
   
END FUNCTION
]]>
  </section>
  <section id="aecm200.unlock_b" ver="2" status="" src="s">
    <![CDATA[#+ 連動unlock其他單身table資料
PRIVATE FUNCTION aecm200_unlock_b(ps_table,ps_page)
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:unlock_b段define
   {<point name="unlock_b.define"/>}
   #end add-point  
   
   LET ls_group = "'1',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE aecm200_bcl
   END IF
   
 
   
 
 
   #add-point:unlock_b段other
   {<point name="unlock_b.other"/>}
   #end add-point  
 
END FUNCTION
]]>
  </section>
  <section id="aecm200.update_b" ver="3" status="" src="s">
    <![CDATA[#+ 修改單身後其他table連動
PRIVATE FUNCTION aecm200_update_b(ps_table,ps_keys,ps_keys_bak,ps_page)
   DEFINE ps_table         STRING
   DEFINE ps_page          STRING
   DEFINE ps_keys          DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_keys_bak      DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group         STRING
   DEFINE li_idx           LIKE type_t.num5 
   DEFINE lb_chk           BOOLEAN
   DEFINE l_new_key        DYNAMIC ARRAY OF STRING
   DEFINE l_old_key        DYNAMIC ARRAY OF STRING
   DEFINE l_field_key      DYNAMIC ARRAY OF STRING
   #add-point:update_b段define
   {<point name="update_b.define"/>}
   #end add-point     
   
   #判斷key是否有改變
   LET lb_chk = TRUE
   FOR li_idx = 1 TO ps_keys.getLength()
      IF ps_keys[li_idx] <> ps_keys_bak[li_idx] THEN
         LET lb_chk = FALSE
         EXIT FOR
      END IF
   END FOR
   
   #不需要做處理
   IF lb_chk THEN
      RETURN
   END IF
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "ecbb_t" THEN
      #add-point:update_b段修改前
      {<point name="update_b.before_update" mark="Y"/>}
      #end add-point     
      UPDATE ecbb_t 
         SET (ecbb001,ecbb002,
              ecbb003
              ,ecbb004,ecbb005,ecbb006,ecbb007,ecbb008,ecbb009,ecbb010,ecbb011,ecbb012,ecbb024,ecbb025,ecbb026,ecbb027,ecbb034,ecbb013,ecbb014,ecbb015,ecbb016,ecbb017,ecbb018,ecbb019,ecbb020,ecbb030,ecbb031,ecbb032,ecbb021,ecbb022,ecbb023,ecbb033,ecbb028,ecbb029,ecbb035,ecbb036) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_ecbb_d[g_detail_idx].ecbb004,g_ecbb_d[g_detail_idx].ecbb005,g_ecbb_d[g_detail_idx].ecbb006, 
                  g_ecbb_d[g_detail_idx].ecbb007,g_ecbb_d[g_detail_idx].ecbb008,g_ecbb_d[g_detail_idx].ecbb009, 
                  g_ecbb_d[g_detail_idx].ecbb010,g_ecbb_d[g_detail_idx].ecbb011,g_ecbb_d[g_detail_idx].ecbb012, 
                  g_ecbb_d[g_detail_idx].ecbb024,g_ecbb_d[g_detail_idx].ecbb025,g_ecbb_d[g_detail_idx].ecbb026, 
                  g_ecbb_d[g_detail_idx].ecbb027,g_ecbb_d[g_detail_idx].ecbb034,g_ecbb_d[g_detail_idx].ecbb013, 
                  g_ecbb_d[g_detail_idx].ecbb014,g_ecbb_d[g_detail_idx].ecbb015,g_ecbb_d[g_detail_idx].ecbb016, 
                  g_ecbb_d[g_detail_idx].ecbb017,g_ecbb_d[g_detail_idx].ecbb018,g_ecbb_d[g_detail_idx].ecbb019, 
                  g_ecbb_d[g_detail_idx].ecbb020,g_ecbb_d[g_detail_idx].ecbb030,g_ecbb_d[g_detail_idx].ecbb031, 
                  g_ecbb_d[g_detail_idx].ecbb032,g_ecbb_d[g_detail_idx].ecbb021,g_ecbb_d[g_detail_idx].ecbb022, 
                  g_ecbb_d[g_detail_idx].ecbb023,g_ecbb_d[g_detail_idx].ecbb033,g_ecbb_d[g_detail_idx].ecbb028, 
                  g_ecbb_d[g_detail_idx].ecbb029,g_ecbb_d[g_detail_idx].ecbb035,g_ecbb_d[g_detail_idx].ecbb036)  

         WHERE ecbbent = g_enterprise AND ecbbsite = g_site AND ecbb001 = ps_keys_bak[1] AND ecbb002 = ps_keys_bak[2] AND ecbb003 = ps_keys_bak[3]
      #add-point:update_b段修改中
      {<point name="update_b.m_update"/>}
      #end add-point   
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            CALL cl_err("ecbb_t","std-00009",1)
            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            CALL cl_err("ecbb_t",SQLCA.sqlcode,1)  
            CALL s_transaction_end('N','0')
         OTHERWISE
            
      END CASE
      #add-point:update_b段修改後
      {<point name="update_b.after_update"/>}
      #end add-point  
   END IF
   
 
   
 
   
 
   
   #add-point:update_b段other
   {<point name="update_b.other"/>}
   #end add-point  
   
END FUNCTION
]]>
  </section>
</add_points>
