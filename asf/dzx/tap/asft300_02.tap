<add_points prog="asft300_02" std_prog="asft300_02" erpver="1.0" module="ASF" ver="1" env="s" zone="t10dev" booking="Y">
  <point name="input.a.page1.sfba005" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba005
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba005_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba005_desc
]]>
</point>
  <point name="input.a.page1.sfbadocno" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_sfba_d[g_detail_idx].sfbasite IS NOT NULL AND g_sfba_d[g_detail_idx].sfbadocno IS NOT NULL AND g_sfba_d[g_detail_idx].sfbaseq IS NOT NULL AND g_sfba_d[g_detail_idx].sfbaseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfba_d[g_detail_idx].sfbasite != g_sfba_d_t.sfbasite OR g_sfba_d[g_detail_idx].sfbadocno != g_sfba_d_t.sfbadocno OR g_sfba_d[g_detail_idx].sfbaseq != g_sfba_d_t.sfbaseq OR g_sfba_d[g_detail_idx].sfbaseq1 != g_sfba_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND "||"sfbasite = '"||g_sfba_d[g_detail_idx].sfbasite ||"' AND "|| "sfbadocno = '"||g_sfba_d[g_detail_idx].sfbadocno ||"' AND "|| "sfbaseq = '"||g_sfba_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page1.sfbaseq" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[]]>
</point>
  <point name="input.a.page1.sfbaseq1" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[]]>
</point>
  <point name="input.a.page1.sfbasite" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_sfba_d[g_detail_idx].sfbasite IS NOT NULL AND g_sfba_d[g_detail_idx].sfbadocno IS NOT NULL AND g_sfba_d[g_detail_idx].sfbaseq IS NOT NULL AND g_sfba_d[g_detail_idx].sfbaseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfba_d[g_detail_idx].sfbasite != g_sfba_d_t.sfbasite OR g_sfba_d[g_detail_idx].sfbadocno != g_sfba_d_t.sfbadocno OR g_sfba_d[g_detail_idx].sfbaseq != g_sfba_d_t.sfbaseq OR g_sfba_d[g_detail_idx].sfbaseq1 != g_sfba_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND "||"sfbasite = '"||g_sfba_d[g_detail_idx].sfbasite ||"' AND "|| "sfbadocno = '"||g_sfba_d[g_detail_idx].sfbadocno ||"' AND "|| "sfbaseq = '"||g_sfba_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page2.sfbadocno_2" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_sfba2_d[g_detail_idx].sfbasite IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbadocno IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfba2_d[g_detail_idx].sfbasite != g_sfba2_d_t.sfbasite OR g_sfba2_d[g_detail_idx].sfbadocno != g_sfba2_d_t.sfbadocno OR g_sfba2_d[g_detail_idx].sfbaseq != g_sfba2_d_t.sfbaseq OR g_sfba2_d[g_detail_idx].sfbaseq1 != g_sfba2_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND "||"sfbasite = '"||g_sfba2_d[g_detail_idx].sfbasite ||"' AND "|| "sfbadocno = '"||g_sfba2_d[g_detail_idx].sfbadocno ||"' AND "|| "sfbaseq = '"||g_sfba2_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba2_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page2.sfbaseq1_2" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_sfba2_d[g_detail_idx].sfbasite IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbadocno IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfba2_d[g_detail_idx].sfbasite != g_sfba2_d_t.sfbasite OR g_sfba2_d[g_detail_idx].sfbadocno != g_sfba2_d_t.sfbadocno OR g_sfba2_d[g_detail_idx].sfbaseq != g_sfba2_d_t.sfbaseq OR g_sfba2_d[g_detail_idx].sfbaseq1 != g_sfba2_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND "||"sfbasite = '"||g_sfba2_d[g_detail_idx].sfbasite ||"' AND "|| "sfbadocno = '"||g_sfba2_d[g_detail_idx].sfbadocno ||"' AND "|| "sfbaseq = '"||g_sfba2_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba2_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page2.sfbaseq_2" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_sfba2_d[g_detail_idx].sfbasite IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbadocno IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfba2_d[g_detail_idx].sfbasite != g_sfba2_d_t.sfbasite OR g_sfba2_d[g_detail_idx].sfbadocno != g_sfba2_d_t.sfbadocno OR g_sfba2_d[g_detail_idx].sfbaseq != g_sfba2_d_t.sfbaseq OR g_sfba2_d[g_detail_idx].sfbaseq1 != g_sfba2_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND "||"sfbasite = '"||g_sfba2_d[g_detail_idx].sfbasite ||"' AND "|| "sfbadocno = '"||g_sfba2_d[g_detail_idx].sfbadocno ||"' AND "|| "sfbaseq = '"||g_sfba2_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba2_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page2.sfbasite_2" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_sfba2_d[g_detail_idx].sfbasite IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbadocno IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq IS NOT NULL AND g_sfba2_d[g_detail_idx].sfbaseq1 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfba2_d[g_detail_idx].sfbasite != g_sfba2_d_t.sfbasite OR g_sfba2_d[g_detail_idx].sfbadocno != g_sfba2_d_t.sfbadocno OR g_sfba2_d[g_detail_idx].sfbaseq != g_sfba2_d_t.sfbaseq OR g_sfba2_d[g_detail_idx].sfbaseq1 != g_sfba2_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND "||"sfbasite = '"||g_sfba2_d[g_detail_idx].sfbasite ||"' AND "|| "sfbadocno = '"||g_sfba2_d[g_detail_idx].sfbadocno ||"' AND "|| "sfbaseq = '"||g_sfba2_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba2_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="show.body.reference" cite_std="N" status="" ver="1" src="s" new="N" order="0" cite_ver="" mark_hard="N">
<![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba005
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba005_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba005_desc
]]>
</point>
  <point name="function.asft300_02_b_fill1" cite_std="N" status="u" ver="1" src="s" new="Y" order="1" cite_ver="" mark_hard="N">
<![CDATA[#单身一显示
PRIVATE FUNCTION asft300_02_b_fill1()
DEFINE l_i       LIKE type_t.num5
DEFINE l_qty3    LIKE sfba_t.sfba013
  CALL g_sfba_d.clear()
  LET l_ac = 1
  FOREACH asft300_02_cs1 INTO g_sfba_d[l_ac].*
     IF SQLCA.sqlcode THEN
        CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
        EXIT FOREACH
     END IF
     CALL asft300_02_b_fill2(l_ac)
     LET l_qty3 = 0
     FOR l_i = 1 TO g_rec_b2
        LET l_qty3 = l_qty3 + g_sfba2_d[l_i].qty6
     END FOR
     LET g_sfba_d[l_ac].qty3 = g_sfba_d[l_ac].qty3 + l_qty3
     #取替代建议
     CALL s_abmm201_get_proposal(g_site,g_sfaa010,g_sfaa011,g_sfba_d[l_ac].sfba005,g_sfba_d[l_ac].sfba002,g_sfba_d[l_ac].sfba003,g_sfba_d[l_ac].sfba004) RETURNING g_sfba_d[l_ac].replace
     
     SELECT SUM(sfba013/sfba022) INTO g_sfba_d[l_ac].qty1 FROM sfba_t 
      WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno AND sfbaseq = g_sfba_d[l_ac].sfbaseq
     IF cl_null(g_sfba_d[l_ac].qty1) THEN
        LET g_sfba_d[l_ac].qty1 = 0
     END IF 
     SELECT SUM(sfba013/sfba022) INTO g_sfba_d[l_ac].qty2 FROM sfba_t 
      WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno AND sfbaseq = g_sfba_d[l_ac].sfbaseq
        AND sfbaseq1 != 0
     IF cl_null(g_sfba_d[l_ac].qty2) THEN
        LET g_sfba_d[l_ac].qty2 = 0
     END IF 

     LET l_ac = l_ac + 1
     IF l_ac > g_max_rec THEN
        EXIT FOREACH
     END IF
  END FOREACH
  CALL g_sfba_d.deleteElement(g_sfba_d.getLength())
  LET g_rec_b = l_ac - 1
END FUNCTION]]>
</point>
  <point name="function.asft300_02_b_fill2" cite_std="N" status="u" ver="1" src="s" new="Y" order="2" cite_ver="" mark_hard="N">
<![CDATA[#单身二显示
PRIVATE FUNCTION asft300_02_b_fill2(p_ac)
DEFINE p_ac         LIKE type_t.num5
DEFINE l_n          LIKE type_t.num5
DEFINE l_n1         LIKE type_t.num5
DEFINE l_bmea014    LIKE bmea_t.bmea014

  CALL g_sfba2_d.clear()
  LET l_ac2 = 1
  FOREACH asft300_02_cs2 USING g_sfba_d[p_ac].sfba005,g_sfba_d[p_ac].sfba002,g_sfba_d[p_ac].sfba003,g_sfba_d[p_ac].sfba004 INTO g_sfba2_d[l_ac2].*
     IF SQLCA.sqlcode THEN
        CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
        EXIT FOREACH
     END IF
     

     SELECT COUNT(*) INTO l_n FROM bmea_t WHERE bmeaent=g_enterprise AND bmeasite = g_site AND bmea001 = g_sfaa010 AND bmea002 = g_sfaa011
        AND bmea003 = g_sfba_d[p_ac].sfba005 AND bmea004 = g_sfba_d[p_ac].sfba002 AND bmea005 = g_sfba_d[p_ac].sfba003 AND bmea006 = g_sfba_d[p_ac].sfba004
        AND bmea008 = g_sfba2_d[l_ac2].part
     IF l_n > 1 THEN
        SELECT bmea014,bmea016,bmea017 INTO g_bmea[l_ac2].* FROM bmea_t WHERE bmeaent=g_enterprise AND bmeasite = g_site AND bmea001 = g_sfaa010 AND bmea002 = g_sfaa011
           AND bmea003 = g_sfba_d[p_ac].sfba005 AND bmea004 = g_sfba_d[p_ac].sfba002 AND bmea005 = g_sfba_d[p_ac].sfba003 AND bmea006 = g_sfba_d[p_ac].sfba004
           AND bmea008 = g_sfba2_d[l_ac2].part AND bmea007 = '2'
        #替代料有限定客戶,需检查
        IF g_bmea[l_ac2].bmea014 = 'Y' AND NOT cl_null(g_sfaa009) THEN
           SELECT COUNT(*) INTO l_n1 FROM bmeb_t WHERE bmebent=g_enterprise AND bmebsite = g_site AND bmeb001 = g_sfaa010 AND bmeb002 = g_sfaa011
              AND bmeb003 = g_sfba_d[p_ac].sfba005 AND bmeb004 = g_sfba_d[p_ac].sfba002 AND bmeb005 = g_sfba_d[p_ac].sfba003 AND bmeb006 = g_sfba_d[p_ac].sfba004
              AND bmeb008 = g_sfba2_d[l_ac2].part AND bmeb007 = '2' AND bmeb009 = g_sfaa009
           IF l_n1 = 0 THEN
              CONTINUE FOREACH
           END IF
        END IF
     ELSE
        SELECT bmea014,bmea016,bmea017 INTO g_bmea[l_ac2].* FROM bmea_t WHERE bmeaent=g_enterprise AND bmeasite = g_site AND bmea001 = g_sfaa010 AND bmea002 = g_sfaa011
           AND bmea003 = g_sfba_d[p_ac].sfba005 AND bmea004 = g_sfba_d[p_ac].sfba002 AND bmea005 = g_sfba_d[p_ac].sfba003 AND bmea006 = g_sfba_d[p_ac].sfba004
           AND bmea008 = g_sfba2_d[l_ac2].part
        #替代料有限定客戶,需检查
        IF g_bmea[l_ac2].bmea014 = 'Y' AND NOT cl_null(g_sfaa009) THEN
           SELECT COUNT(*) INTO l_n1 FROM bmeb_t WHERE bmebent=g_enterprise AND bmebsite = g_site AND bmeb001 = g_sfaa010 AND bmeb002 = g_sfaa011
              AND bmeb003 = g_sfba_d[p_ac].sfba005 AND bmeb004 = g_sfba_d[p_ac].sfba002 AND bmeb005 = g_sfba_d[p_ac].sfba003 AND bmeb006 = g_sfba_d[p_ac].sfba004
              AND bmeb008 = g_sfba2_d[l_ac2].part  AND bmeb009 = g_sfaa009
           IF l_n1 = 0 THEN
              CONTINUE FOREACH
           END IF
        END IF
     END IF
     
     SELECT sfba013 INTO g_sfba2_d[l_ac2].qty4 FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site
        AND sfbadocno = g_sfaadocno
        AND sfbaseq = g_sfba_d[p_ac].sfbaseq AND sfba006 = g_sfba2_d[l_ac2].part
     IF cl_null(g_sfba2_d[l_ac2].qty4) THEN
        LET g_sfba2_d[l_ac2].qty4 = 0
     END IF 
     LET g_sfba2_d[l_ac2].qty6 = g_sfba2_d[l_ac2].qty5*g_sfba2_d[l_ac2].mole/g_sfba2_d[l_ac2].deno
     SELECT SUM(inag009) INTO g_sfba2_d[l_ac2].qty7 FROM inag_t WHERE inagent = g_enterprise AND inagsite = g_site 
        AND inag001 = g_sfba2_d[l_ac2].part AND inag010 = 'Y'
     LET g_sfba2_d[l_ac2].qty10 = g_sfba2_d[l_ac2].qty7 + g_sfba2_d[l_ac2].qty8 - g_sfba2_d[l_ac2].qty9
     LET l_ac2 = l_ac2 + 1
     IF l_ac2 > g_max_rec THEN
        EXIT FOREACH
     END IF
  END FOREACH
  CALL g_sfba2_d.deleteElement(g_sfba2_d.getLength())
  LET g_rec_b2 = l_ac2 - 1

END FUNCTION]]>
</point>
  <point name="function.asft300_02_sfba" cite_std="N" status="u" ver="1" src="s" new="Y" order="3" cite_ver="" mark_hard="N">
<![CDATA[#将取替代料产生入工单单身
PRIVATE FUNCTION asft300_02_sfba(p_ac)
DEFINE p_ac                 LIKE type_t.num5
DEFINE l_sfaa004            LIKE sfaa_t.sfaa004
DEFINE l_i                  LIKE type_t.num5
DEFINE l_sfba               RECORD LIKE sfba_t.*

  # CALL s_transaction_begin()
   FOR l_i = 1 TO g_rec_b2
      IF g_sfba2_d[l_i].qty4 = 0 AND g_sfba2_d[l_i].qty5 != 0 THEN 
         SELECT * INTO l_sfba.* FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site 
            AND sfbadocno = g_sfaadocno AND sfbaseq = g_sfba_d[p_ac].sfbaseq AND sfbaseq1 = 0
         LET l_sfba.sfbaent = g_enterprise
         LET l_sfba.sfbasite = g_site
         LET l_sfba.sfbadocno = g_sfaadocno
         LET l_sfba.sfbaseq = g_sfba_d[p_ac].sfbaseq
         SELECT MAX(sfbaseq1)+ 1 INTO l_sfba.sfbaseq1 FROM sfba_t
          WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno AND sfbaseq = l_sfba.sfbaseq
         LET l_sfba.sfba002 = g_sfba_d[p_ac].sfba002
         LET l_sfba.sfba003 = g_sfba_d[p_ac].sfba003
         LET l_sfba.sfba004 = g_sfba_d[p_ac].sfba004
         LET l_sfba.sfba005 = g_sfba_d[p_ac].sfba005
         LET l_sfba.sfba006 = g_sfba2_d[l_i].part
         LET l_sfba.sfba007=0        
         LET l_sfba.sfba010=0
         LET l_sfba.sfba011=0
         LET l_sfba.sfba012=0
         LET l_sfba.sfba015=0
         LET l_sfba.sfba016=0
         LET l_sfba.sfba017=0
         LET l_sfba.sfba018=0
         LET l_sfba.sfba022=g_sfba2_d[l_i].mole/g_sfba2_d[l_i].deno
         LET l_sfba.sfba023=0
         LET l_sfba.sfba024=0
         LET l_sfba.sfba025=0
         LET l_sfba.sfba026='1'
         LET l_sfba.sfba028='N'
      #  SELECT sfaa004 INTO l_sfaa004 FROM sfaa_t WHERE sfaaent=g_enterprise AND sfaasite=g_site
      #     AND sfaadocno=l_sfba.sfbadocno
      #  IF l_sfaa004='1' THEN
      #     LET l_sfba.sfba009='N'
      #  END IF 
      #  IF l_sfaa004='2' THEN
      #     LET l_sfba.sfba009='Y'
      #  END IF 
         LET l_sfba.sfba013=g_sfba2_d[l_i].qty4+g_sfba2_d[l_i].qty5
         LET l_sfba.sfba014=g_sfba2_d[l_i].unit
         INSERT INTO sfba_t VALUES(l_sfba.*)        
         IF SQLCA.SQLcode  THEN
            CALL cl_err("ins sfba_t",SQLCA.sqlcode,1)
    #        CALL s_transaction_end('N',0)
            RETURN FALSE
         END IF 
      END IF
      IF g_sfba2_d[l_i].qty4 > 0 THEN
         IF g_sfba2_d[l_i].qty4+g_sfba2_d[l_i].qty5 > 0 THEN
            UPDATE sfba_t SET sfba013 = g_sfba2_d[l_i].qty4+g_sfba2_d[l_i].qty5 
             WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno
               AND sfbaseq= g_sfba_d[p_ac].sfbaseq AND sfba006 = g_sfba2_d[l_i].part
            IF SQLCA.SQLcode  THEN
               CALL cl_err("upd sfba_t",SQLCA.sqlcode,1)
   #            CALL s_transaction_end('N',0)
              RETURN FALSE
            END IF
         END IF 
         IF g_sfba2_d[l_i].qty4+g_sfba2_d[l_i].qty5 = 0 THEN
            DELETE FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno
               AND sfbaseq= g_sfba_d[p_ac].sfbaseq AND sfba006 = g_sfba2_d[l_i].part
            IF SQLCA.SQLcode  THEN
               CALL cl_err("del sfba_t",SQLCA.sqlcode,1)
   #            CALL s_transaction_end('N',0)
              RETURN FALSE
            END IF
         END IF
      END IF       
   END FOR
   
   UPDATE sfba_t SET sfba013 =  g_sfba_d[p_ac].qty1 - g_sfba_d[p_ac].qty2 - g_sfba_d[p_ac].qty3 
    WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno
      AND sfbaseq =  g_sfba_d[p_ac].sfbaseq AND sfbaseq1 = 0
   IF SQLCA.SQLcode  THEN
      CALL cl_err("upd sfba_t",SQLCA.sqlcode,1)
  #    CALL s_transaction_end('N',0)
      RETURN FALSE
   END IF
   
 # CALL s_transaction_end('Y',0)
   RETURN TRUE   

END FUNCTION]]>
</point>
  <point name="global.variable" cite_std="N" status="u" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[DEFINE g_sfaadocno           LIKE sfaa_t.sfaadocno
DEFINE g_sfaa009             LIKE sfaa_t.sfaa009
DEFINE g_sfaa010             LIKE sfaa_t.sfaa010
DEFINE g_sfaa011             LIKE sfaa_t.sfaa011
DEFINE g_sql                 STRING
DEFINE l_ac2                 LIKE type_t.num5
DEFINE g_rec_b2              LIKE type_t.num5
DEFINE l_qty6                LIKE sfba_t.sfba013
DEFINE l_qty6_t              LIKE sfba_t.sfba013
DEFINE g_bmea                DYNAMIC ARRAY OF RECORD
       bmea014               LIKE bmea_t.bmea014,
       bmea016               LIKE bmea_t.bmea016,
       bmea017               LIKE bmea_t.bmea017
                             END RECORD
                             ]]>
</point>
  <point name="input.a.page2.qty5" cite_std="N" status="u" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[            IF cl_null(g_sfba2_d[l_ac2].qty5) THEN
               CALL cl_err('','asf-00067',1)
               NEXT FIELD qty5
            END IF 
            IF (g_sfba2_d[l_ac2].qty4 + g_sfba2_d[l_ac2].qty5) < 0 THEN
               CALL cl_err(g_sfba2_d[l_ac2].qty5,'asf-00068',1)
               NEXT FIELD qty5
            END IF 
            
               
            LET l_qty6 = g_sfba2_d[l_ac2].qty5 / g_sfba2_d[l_ac2].mole * g_sfba2_d[l_ac2].deno
            LET l_qty6_t = g_sfba2_d_t.qty5 / g_sfba2_d[l_ac2].mole * g_sfba2_d[l_ac2].deno
            
            #替代料為完全替代時，應要控制全部的應發量都要轉換為替代料數量
            IF g_bmea[l_ac2].bmea016 = '2' THEN
               IF l_qty6 + g_sfba2_d[l_ac2].qty4 != g_sfba_d[l_ac].qty1 - g_sfba_d[l_ac].qty2 THEN
                  CALL cl_err('','asf-00326',1)
                  NEXT FIELD qty5
               END IF
            END IF
            
            #替代料为部分替代时，替代料的數量不可超过上限比率
            IF g_bmea[l_ac2].bmea016 = '1' THEN
               IF l_qty6 > g_sfba_d[l_ac].qty1 * g_bmea[l_ac2].bmea017 / 100 - g_sfba_d[l_ac].qty2 THEN
                  CALL cl_err('','asf-00327',1)
                  NEXT FIELD qty5
               END IF
            END IF
            
            #折合量与已取代量之和不可大于总应发量
            IF (g_sfba_d[l_ac].qty3 - l_qty6_t + l_qty6 + g_sfba_d[l_ac].qty2) > g_sfba_d[l_ac].qty1 THEN
               CALL cl_err(g_sfba2_d[l_ac2].qty5,'asf-00069',1)
               NEXT FIELD qty5
            END IF
            LET g_sfba2_d[l_ac2].qty6 = l_qty6
            LET g_sfba_d[l_ac].qty3 =  g_sfba_d[l_ac].qty3 - l_qty6_t + l_qty6
            DISPLAY BY NAME g_sfba_d[l_ac].qty3            ]]>
</point>
  <point name="input.after_input2" cite_std="N" status="u" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[            IF NOT asft300_02_sfba(l_ac) THEN
               CALL s_transaction_end('N',0)
               LET INT_FLAG = TRUE
               EXIT DIALOG 
            END IF ]]>
</point>
  <point name="input.before_close" cite_std="N" status="u" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[   IF l_flag = 'N' THEN
      DISPLAY ARRAY g_sfba_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b)
         BEFORE ROW
            LET l_ac = DIALOG.getCurrentRow("s_detail1")
            
         ON ACTION cancel
            LET INT_FLAG = TRUE 
            EXIT DISPLAY
    
         ON ACTION close
            LET INT_FLAG = TRUE 
            EXIT DISPLAY
    
         ON ACTION exit
            LET INT_FLAG = TRUE 
            EXIT DISPLAY          
      END DISPLAY
   END IF
   
   IF INT_FLAG THEN
      CALL s_transaction_end('N',0)
      LET INT_FLAG = 0
      EXIT WHILE
   ELSE
      CALL s_transaction_end('Y',0)
      IF NOT cl_ask_confirm('asf-00191') THEN
         EXIT WHILE
      END IF
   END IF
   
   END WHILE]]>
</point>
  <point name="input.before_input" cite_std="N" status="u" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[            IF g_rec_b = 0 THEN
               LET l_flag = 'N'
               EXIT DIALOG
            ELSE
               CALL asft300_02_b_fill1()
            END IF
            
         BEFORE ROW
            LET l_ac = ARR_CURR()
            CALL asft300_02_b_fill2(l_ac)
            IF g_rec_b2 > 0 THEN
               LET l_flag = 'Y'
               NEXT FIELD qty5
            ELSE
               LET l_flag = 'N'
               EXIT DIALOG
            END IF               ]]>
</point>
  <point name="input.before_input2" cite_std="N" status="" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[         
         BEFORE ROW
            LET l_ac2 = ARR_CURR()
            LET g_sfba2_d_t.* =  g_sfba2_d[l_ac2].*
            
         ON ROW CHANGE 
            ]]>
</point>
  <point name="input.define" cite_std="N" status="" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[   DEFINE p_sfaadocno           LIKE sfaa_t.sfaadocno
   DEFINE l_flag                LIKE type_t.chr1]]>
</point>
  <point name="input.get_var" cite_std="N" status="" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[   p_sfaadocno]]>
</point>
  <point name="input.pre_input" cite_std="N" status="u" ver="1" src="s" new="N" order="" cite_ver="" mark_hard="N">
<![CDATA[   LET g_sfaadocno = p_sfaadocno
   SELECT sfaa009,sfaa010,sfaa011 INTO g_sfaa009,g_sfaa010,g_sfaa011 FROM sfaa_t 
    WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaadocno
   LET g_sql = "SELECT unique sfbaseq,sfbaseq1,sfba002,sfba003,sfba004,sfba006,imaal003,imaal004,'',0,0,0 FROM sfba_t",
               "  LEFT OUTER JOIN imaal_t ON imaalent = sfbaent AND imaal001 = sfba006,bmea_t ",
               " WHERE sfbaent = bmeaent AND sfbasite = bmeasite AND bmea003 = sfba006 AND bmea004 = sfba002 AND bmea005 = sfba003 AND bmea006 = sfba004 ",
               "   AND sfbaent = '",g_enterprise,"' AND sfbasite = '",g_site,"'",
               "   AND sfbadocno = '",g_sfaadocno,"' AND sfbaseq1 = 0 AND bmea001 = '",g_sfaa010,"' AND bmea002 = '",g_sfaa011,"'"
   PREPARE asft300_02_pre1 FROM g_sql
   DECLARE asft300_02_cs1 CURSOR FOR asft300_02_pre1 
   
   LET g_sql = "SELECT unique bmea008,imaal003,imaal004,bmea013,bmea011,bmea012,0,0,0,0,0,0,0 FROM bmea_t ",
               "  LEFT OUTER JOIN imaal_t ON imaalent = bmeaent AND imaal001 = bmea008 ",
               " WHERE bmeaent = '",g_enterprise,"' AND bmeasite = '",g_site,"' AND bmea001 = '",g_sfaa010,"' AND bmea002 = '",g_sfaa011,"'",
               "   AND bmea003 = ? AND bmea004 = ? AND bmea005 = ? AND bmea006 = ? "
   PREPARE asft300_02_pre2 FROM g_sql
   DECLARE asft300_02_cs2 CURSOR FOR asft300_02_pre2
   
   CALL asft300_02_b_fill1()
   IF g_rec_b > 0 THEN
      CALL asft300_02_b_fill2(1)
   END IF 
   
   WHILE TRUE
      CALL s_transaction_begin()]]>
</point>
  <point name="global.memo" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="global.import" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="global.inc" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="global.argv" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.action" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page1.replace" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.a.page1.replace" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page1.replace" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page1.replace" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.after_input" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.action2" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page2.qty4" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.a.page2.qty4" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page2.qty4" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page2.qty5" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page2.qty5" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page2.qty6" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.a.page2.qty6" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page2.qty6" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page2.qty7" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.a.page2.qty7" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page2.qty7" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page2.qty8" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.a.page2.qty8" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page2.qty8" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page2.qty9" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.a.page2.qty9" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page2.qty9" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.b.page2.qty10" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.a.page2.qty10" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.g.page2.qty10" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page2.qty4" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page2.qty5" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page2.qty6" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page2.qty7" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page2.qty8" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page2.qty9" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.c.page2.qty10" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.more_input" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="input.post_input" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <section id="asft300_02.description" ver="1" status="" src="s">
<![CDATA[#+ Version..: T100-ERP-1.00.00(版次:1) Build-000059
#+ 
#+ Filename...: asft300_02
#+ Description: ...
#+ Creator....: 01258(2014/01/02)
#+ Modifier...: 01258(2014/01/09)
#+ Buildtype..: 應用 c02b 樣板自動產生
#+ 以上段落由子樣板a00產生
]]>
</section>
  <section id="asft300_02.global" ver="1" status="" src="s">
<![CDATA[{<point name="global.memo" />}
 
IMPORT os
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
{<Module define>}
#單身 type 宣告
PRIVATE TYPE type_g_sfba_d        RECORD
       sfbaseq LIKE sfba_t.sfbaseq, 
   sfbaseq1 LIKE sfba_t.sfbaseq1, 
   sfba002 LIKE sfba_t.sfba002, 
   sfba003 LIKE sfba_t.sfba003, 
   sfba004 LIKE sfba_t.sfba004, 
   sfba005 LIKE sfba_t.sfba005, 
   sfba005_desc LIKE type_t.chr500, 
   sfba005_desc_desc LIKE type_t.chr500, 
   replace LIKE type_t.chr80, 
   qty1 LIKE type_t.num20_6, 
   qty2 LIKE type_t.num20_6, 
   qty3 LIKE type_t.num20_6
       END RECORD
PRIVATE TYPE type_g_sfba2_d RECORD
       part LIKE type_t.chr500, 
   part_desc LIKE type_t.chr500, 
   part_desc_desc LIKE type_t.chr500, 
   unit LIKE type_t.chr10, 
   mole LIKE type_t.num20_6, 
   deno LIKE type_t.num20_6, 
   qty4 LIKE type_t.num20_6, 
   qty5 LIKE type_t.num20_6, 
   qty6 LIKE type_t.num20_6, 
   qty7 LIKE type_t.num20_6, 
   qty8 LIKE type_t.num20_6, 
   qty9 LIKE type_t.num20_6, 
   qty10 LIKE type_t.num20_6
       END RECORD
 
 
 
DEFINE g_sfba_d          DYNAMIC ARRAY OF type_g_sfba_d
DEFINE g_sfba_d_t        type_g_sfba_d
DEFINE g_sfba2_d   DYNAMIC ARRAY OF type_g_sfba2_d
DEFINE g_sfba2_d_t type_g_sfba2_d
 
 
 
DEFINE g_sfbadocno_t   LIKE sfba_t.sfbadocno    #Key值備份
DEFINE g_sfbaseq_t      LIKE sfba_t.sfbaseq    #Key值備份
 
DEFINE g_sfbaseq1_t      LIKE sfba_t.sfbaseq1    #Key值備份
 
 
 
DEFINE l_ac                  LIKE type_t.num5
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rec_b               LIKE type_t.num5  
DEFINE g_detail_idx          LIKE type_t.num5  
 
{</Module define>} 
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable"/>}
#end add-point
    
#add-point:傳入參數說明
{<point name="global.argv"/>}
#end add-point	
]]>
</section>
  <section id="asft300_02.input" ver="1" status="" src="s">
<![CDATA[#+ 資料輸入
PUBLIC FUNCTION asft300_02(--)
   #add-point:input段變數傳入
   {<point name="input.get_var"/>}
   #end add-point
   )
   {<Local define>}
   DEFINE l_ac_t          LIKE type_t.num5        #未取消的ARRAY CNT 
   DEFINE l_allow_insert  LIKE type_t.num5        #可新增否 
   DEFINE l_allow_delete  LIKE type_t.num5        #可刪除否  
   DEFINE l_count         LIKE type_t.num5
   DEFINE l_insert        LIKE type_t.num5
   DEFINE l_cmd           LIKE type_t.chr5
   {</Local define>}
   #add-point:input段define
   {<point name="input.define"/>}
   #end add-point
 
   #畫面開啟 (identifier)
   OPEN WINDOW w_asft300_02 WITH FORM cl_ap_formpath("asf","asft300_02")
 
   #瀏覽頁簽資料初始化
   CALL cl_ui_init()
   
   LET g_qryparam.state = "i"
   
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   
   #輸入前處理
   #add-point:單身前置處理
   {<point name="input.pre_input"/>}
   #end add-point
  
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
      #輸入開始
      INPUT ARRAY g_sfba_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                  INSERT ROW = FALSE,
                  DELETE ROW = FALSE,
                  APPEND ROW = FALSE)
         
         #自訂ACTION
         #add-point:單身前置處理
         {<point name="input.action"/>}
         #end add-point
         
         #自訂ACTION(detail_input)
         
         
         BEFORE INPUT
            #add-point:單身輸入前處理
            {<point name="input.before_input"/>}
            #end add-point
          
         #---------------------<  Detail: page1  >---------------------
         #----<<replace>>----
         #此段落由子樣板a01產生
         BEFORE FIELD replace
            #add-point:BEFORE FIELD replace
            {<point name="input.b.page1.replace" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD replace
            
            #add-point:AFTER FIELD replace
            {<point name="input.a.page1.replace" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE replace
            #add-point:ON CHANGE replace
            {<point name="input.g.page1.replace" />}
            #END add-point
 
 
         #---------------------<  Detail: page1  >---------------------
         #----<<replace>>----
         #Ctrlp:input.c.page1.replace
         ON ACTION controlp INFIELD replace
            #add-point:ON ACTION controlp INFIELD replace
            {<point name="input.c.page1.replace" />}
            #END add-point
 
 
 
         AFTER INPUT
            #add-point:單身輸入後處理
            {<point name="input.after_input"/>}
            #end add-point
            
      END INPUT
      
      INPUT ARRAY g_sfba2_d FROM s_detail2.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
                  INSERT ROW = FALSE,
                  DELETE ROW = FALSE,
                  APPEND ROW = FALSE)
         
         #自訂ACTION
         #add-point:單身前置處理
         {<point name="input.action2"/>}
         #end add-point
         
         #自訂ACTION(detail_input)
         
         
         BEFORE INPUT
            #add-point:單身輸入前處理
            {<point name="input.before_input2"/>}
            #end add-point
          
         #---------------------<  Detail: page2  >---------------------
         #----<<qty4>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qty4
            #add-point:BEFORE FIELD qty4
            {<point name="input.b.page2.qty4" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qty4
            
            #add-point:AFTER FIELD qty4
            {<point name="input.a.page2.qty4" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qty4
            #add-point:ON CHANGE qty4
            {<point name="input.g.page2.qty4" />}
            #END add-point
 
         #----<<qty5>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qty5
            #add-point:BEFORE FIELD qty5
            {<point name="input.b.page2.qty5" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qty5
            
            #add-point:AFTER FIELD qty5
            {<point name="input.a.page2.qty5" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qty5
            #add-point:ON CHANGE qty5
            {<point name="input.g.page2.qty5" />}
            #END add-point
 
         #----<<qty6>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qty6
            #add-point:BEFORE FIELD qty6
            {<point name="input.b.page2.qty6" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qty6
            
            #add-point:AFTER FIELD qty6
            {<point name="input.a.page2.qty6" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qty6
            #add-point:ON CHANGE qty6
            {<point name="input.g.page2.qty6" />}
            #END add-point
 
         #----<<qty7>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qty7
            #add-point:BEFORE FIELD qty7
            {<point name="input.b.page2.qty7" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qty7
            
            #add-point:AFTER FIELD qty7
            {<point name="input.a.page2.qty7" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qty7
            #add-point:ON CHANGE qty7
            {<point name="input.g.page2.qty7" />}
            #END add-point
 
         #----<<qty8>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qty8
            #add-point:BEFORE FIELD qty8
            {<point name="input.b.page2.qty8" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qty8
            
            #add-point:AFTER FIELD qty8
            {<point name="input.a.page2.qty8" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qty8
            #add-point:ON CHANGE qty8
            {<point name="input.g.page2.qty8" />}
            #END add-point
 
         #----<<qty9>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qty9
            #add-point:BEFORE FIELD qty9
            {<point name="input.b.page2.qty9" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qty9
            
            #add-point:AFTER FIELD qty9
            {<point name="input.a.page2.qty9" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qty9
            #add-point:ON CHANGE qty9
            {<point name="input.g.page2.qty9" />}
            #END add-point
 
         #----<<qty10>>----
         #此段落由子樣板a01產生
         BEFORE FIELD qty10
            #add-point:BEFORE FIELD qty10
            {<point name="input.b.page2.qty10" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD qty10
            
            #add-point:AFTER FIELD qty10
            {<point name="input.a.page2.qty10" />}
            #END add-point
            
 
         #此段落由子樣板a04產生
         ON CHANGE qty10
            #add-point:ON CHANGE qty10
            {<point name="input.g.page2.qty10" />}
            #END add-point
 
 
         #---------------------<  Detail: page2  >---------------------
         #----<<qty4>>----
         #Ctrlp:input.c.page2.qty4
         ON ACTION controlp INFIELD qty4
            #add-point:ON ACTION controlp INFIELD qty4
            {<point name="input.c.page2.qty4" />}
            #END add-point
 
         #----<<qty5>>----
         #Ctrlp:input.c.page2.qty5
         ON ACTION controlp INFIELD qty5
            #add-point:ON ACTION controlp INFIELD qty5
            {<point name="input.c.page2.qty5" />}
            #END add-point
 
         #----<<qty6>>----
         #Ctrlp:input.c.page2.qty6
         ON ACTION controlp INFIELD qty6
            #add-point:ON ACTION controlp INFIELD qty6
            {<point name="input.c.page2.qty6" />}
            #END add-point
 
         #----<<qty7>>----
         #Ctrlp:input.c.page2.qty7
         ON ACTION controlp INFIELD qty7
            #add-point:ON ACTION controlp INFIELD qty7
            {<point name="input.c.page2.qty7" />}
            #END add-point
 
         #----<<qty8>>----
         #Ctrlp:input.c.page2.qty8
         ON ACTION controlp INFIELD qty8
            #add-point:ON ACTION controlp INFIELD qty8
            {<point name="input.c.page2.qty8" />}
            #END add-point
 
         #----<<qty9>>----
         #Ctrlp:input.c.page2.qty9
         ON ACTION controlp INFIELD qty9
            #add-point:ON ACTION controlp INFIELD qty9
            {<point name="input.c.page2.qty9" />}
            #END add-point
 
         #----<<qty10>>----
         #Ctrlp:input.c.page2.qty10
         ON ACTION controlp INFIELD qty10
            #add-point:ON ACTION controlp INFIELD qty10
            {<point name="input.c.page2.qty10" />}
            #END add-point
 
 
 
         AFTER INPUT
            #add-point:單身輸入後處理
            {<point name="input.after_input2"/>}
            #end add-point
            
      END INPUT
 
 
      
      #add-point:自定義input
      {<point name="input.more_input"/>}
      #end add-point
    
      #公用action
      ON ACTION accept
         ACCEPT DIALOG
        
      ON ACTION cancel
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
 
   #add-point:畫面關閉前
   {<point name="input.before_close"/>}
   #end add-point
   
   #畫面關閉
   CLOSE WINDOW w_asft300_02 
   
   #add-point:input段after input 
   {<point name="input.post_input"/>}
   #end add-point    
   
END FUNCTION
]]>
</section>
  <section id="asft300_02.other_dialog" ver="1" status="" src="s">
<![CDATA[{<point name="other.dialog"/>}
]]>
</section>
  <section id="asft300_02.other_function" ver="1" status="" src="s">
<![CDATA[{<point name="other.dialog"/>}
{<point name="other.function"/>}
]]>
</section>
</add_points>