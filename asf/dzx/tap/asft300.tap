<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="asft300" std_prog="asft300" erpver="1.0" module="ASF" ver="9" env="s" zone="t10prd" booking="Y" type="M" identity="s" section_flag="N" designer_ver="1.0">
  <other>
    <code_template value="F" status="u"/>
    <free_style value="Y" status="u"/>
    <start_arg value="" status="u"/>
  </other>
  <point name="construct.c.sfaa002" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa002  #顯示到畫面上

            NEXT FIELD sfaa002                     #返回原欄位

]]>
  </point>
  <point name="show.head.reference" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaaownid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaaownid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaaownid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaaowndp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaaowndp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaaowndp_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaacrtid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaacrtid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaacrtid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaacrtdp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaacrtdp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaacrtdp_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaamodid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaamodid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaamodid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaacnfid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaacnfid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaacnfid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaapstid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaapstid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaapstid_desc
]]>
  </point>
  <point name="show.body.reference6" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
   INITIALIZE g_ref_fields TO NULL 
   LET g_ref_fields[1] = g_sfaa_m.sfaadocno
   LET g_ref_fields[2] = g_sfaa_m.sfaadocno
   CALL ap_ref_array2(g_ref_fields," SELECT sfaf001,sfaf001 FROM sfaf_t WHERE sfafent = '"||g_enterprise||"' AND ","") RETURNING g_rtn_fields 
   LET g_sfba6_d[l_ac].sfaf001 = g_rtn_fields[1] 
   LET g_sfba6_d[l_ac].sfaf001 = g_rtn_fields[2] 
   DISPLAY BY NAME g_sfba6_d[l_ac].sfaf001,g_sfba6_d[l_ac].sfaf001]]>
  </point>
  <point name="show.body.reference5" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba5_d[l_ac].sfae005
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfba5_d[l_ac].sfae005_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba5_d[l_ac].sfae005_desc

   INITIALIZE g_ref_fields TO NULL 
   LET g_ref_fields[1] = g_sfaa_m.sfaadocno
   LET g_ref_fields[2] = g_sfaa_m.sfaadocno
   CALL ap_ref_array2(g_ref_fields," SELECT sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,sfae006,sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,sfae006 FROM sfae_t WHERE sfaeent = '"||g_enterprise||"' AND ","") RETURNING g_rtn_fields 
   LET g_sfba5_d[l_ac].sfaeseq = g_rtn_fields[1] 
   LET g_sfba5_d[l_ac].sfae001 = g_rtn_fields[2] 
   LET g_sfba5_d[l_ac].sfae002 = g_rtn_fields[3] 
   LET g_sfba5_d[l_ac].sfae003 = g_rtn_fields[4] 
   LET g_sfba5_d[l_ac].sfae004 = g_rtn_fields[5] 
   LET g_sfba5_d[l_ac].sfae005 = g_rtn_fields[6] 
   LET g_sfba5_d[l_ac].sfae006 = g_rtn_fields[7] 
   LET g_sfba5_d[l_ac].sfaeseq = g_rtn_fields[8] 
   LET g_sfba5_d[l_ac].sfae001 = g_rtn_fields[9] 
   LET g_sfba5_d[l_ac].sfae002 = g_rtn_fields[10] 
   LET g_sfba5_d[l_ac].sfae003 = g_rtn_fields[11] 
   LET g_sfba5_d[l_ac].sfae004 = g_rtn_fields[12] 
   LET g_sfba5_d[l_ac].sfae005 = g_rtn_fields[13] 
   LET g_sfba5_d[l_ac].sfae006 = g_rtn_fields[14] 
   DISPLAY BY NAME g_sfba5_d[l_ac].sfaeseq,g_sfba5_d[l_ac].sfae001,g_sfba5_d[l_ac].sfae002,g_sfba5_d[l_ac].sfae003,g_sfba5_d[l_ac].sfae004,g_sfba5_d[l_ac].sfae005,g_sfba5_d[l_ac].sfae006,g_sfba5_d[l_ac].sfaeseq,g_sfba5_d[l_ac].sfae001,g_sfba5_d[l_ac].sfae002,g_sfba5_d[l_ac].sfae003,g_sfba5_d[l_ac].sfae004,g_sfba5_d[l_ac].sfae005,g_sfba5_d[l_ac].sfae006]]>
  </point>
  <point name="show.body.reference4" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
   INITIALIZE g_ref_fields TO NULL 
   LET g_ref_fields[1] = g_sfaa_m.sfaadocno
   LET g_ref_fields[2] = g_sfaa_m.sfaadocno
   CALL ap_ref_array2(g_ref_fields," SELECT sfad001,sfad002,sfad003,sfad001,sfad002,sfad003 FROM sfad_t WHERE sfadent = '"||g_enterprise||"' AND ","") RETURNING g_rtn_fields 
   LET g_sfba4_d[l_ac].sfad001 = g_rtn_fields[1] 
   LET g_sfba4_d[l_ac].sfad002 = g_rtn_fields[2] 
   LET g_sfba4_d[l_ac].sfad003 = g_rtn_fields[3] 
   LET g_sfba4_d[l_ac].sfad001 = g_rtn_fields[4] 
   LET g_sfba4_d[l_ac].sfad002 = g_rtn_fields[5] 
   LET g_sfba4_d[l_ac].sfad003 = g_rtn_fields[6] 
   DISPLAY BY NAME g_sfba4_d[l_ac].sfad001,g_sfba4_d[l_ac].sfad002,g_sfba4_d[l_ac].sfad003,g_sfba4_d[l_ac].sfad001,g_sfba4_d[l_ac].sfad002,g_sfba4_d[l_ac].sfad003]]>
  </point>
  <point name="show.body.reference3" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba3_d[l_ac].sfac001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba3_d[l_ac].sfac001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba3_d[l_ac].sfac001_desc

   INITIALIZE g_ref_fields TO NULL 
   LET g_ref_fields[1] = g_sfaa_m.sfaadocno
   LET g_ref_fields[2] = g_sfaa_m.sfaadocno
   CALL ap_ref_array2(g_ref_fields," SELECT sfac002,sfac001,sfac003,sfac004,sfac005,sfac002,sfac001,sfac003,sfac004,sfac005 FROM sfac_t WHERE sfacent = '"||g_enterprise||"' AND ","") RETURNING g_rtn_fields 
   LET g_sfba3_d[l_ac].sfac002 = g_rtn_fields[1] 
   LET g_sfba3_d[l_ac].sfac001 = g_rtn_fields[2] 
   LET g_sfba3_d[l_ac].sfac003 = g_rtn_fields[3] 
   LET g_sfba3_d[l_ac].sfac004 = g_rtn_fields[4] 
   LET g_sfba3_d[l_ac].sfac005 = g_rtn_fields[5] 
   LET g_sfba3_d[l_ac].sfac002 = g_rtn_fields[6] 
   LET g_sfba3_d[l_ac].sfac001 = g_rtn_fields[7] 
   LET g_sfba3_d[l_ac].sfac003 = g_rtn_fields[8] 
   LET g_sfba3_d[l_ac].sfac004 = g_rtn_fields[9] 
   LET g_sfba3_d[l_ac].sfac005 = g_rtn_fields[10] 
   DISPLAY BY NAME g_sfba3_d[l_ac].sfac002,g_sfba3_d[l_ac].sfac001,g_sfba3_d[l_ac].sfac003,g_sfba3_d[l_ac].sfac004,g_sfba3_d[l_ac].sfac005,g_sfba3_d[l_ac].sfac002,g_sfba3_d[l_ac].sfac001,g_sfba3_d[l_ac].sfac003,g_sfba3_d[l_ac].sfac004,g_sfba3_d[l_ac].sfac005]]>
  </point>
  <point name="show.body.reference2" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba2_d[l_ac].a6
            CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba2_d[l_ac].a6_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba2_d[l_ac].a6_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba2_d[l_ac].a7
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba2_d[l_ac].a7_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba2_d[l_ac].a7_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba2_d[l_ac].a8
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfba2_d[l_ac].a8_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba2_d[l_ac].a8_desc

   INITIALIZE g_ref_fields TO NULL 
   LET g_ref_fields[1] = g_sfaa_m.sfaadocno
   LET g_ref_fields[2] = g_sfaa_m.sfaadocno
   CALL ap_ref_array2(g_ref_fields," SELECT sfab001,sfab002,sfab003,sfab004,sfab005,sfab006 FROM sfab_t WHERE sfabent = '"||g_enterprise||"' AND sfabsite = ? AND sfabdocno = ? AND sfab001 = ? AND sfab002 = ? AND sfab003 = ? AND sfab004 = ? ","") RETURNING g_rtn_fields 
   LET g_sfba2_d[l_ac].sfab001 = g_rtn_fields[1] 
   LET g_sfba2_d[l_ac].sfab002 = g_rtn_fields[2] 
   LET g_sfba2_d[l_ac].sfab003 = g_rtn_fields[3] 
   LET g_sfba2_d[l_ac].sfab004 = g_rtn_fields[4] 
   LET g_sfba2_d[l_ac].sfab005 = g_rtn_fields[5] 
   LET g_sfba2_d[l_ac].sfab006 = g_rtn_fields[6] 
   DISPLAY BY NAME g_sfba2_d[l_ac].sfab001,g_sfba2_d[l_ac].sfab002,g_sfba2_d[l_ac].sfab003,g_sfba2_d[l_ac].sfab004,g_sfba2_d[l_ac].sfab005,g_sfba2_d[l_ac].sfab006]]>
  </point>
  <point name="show.body.reference" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba006
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba006_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba006_desc
]]>
  </point>
  <point name="input.c.sfaadocno" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaadocno             #給予default值

            #給予arg

            CALL q_ooba002()                                #呼叫開窗

            LET g_sfaa_m.sfaadocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaadocno TO sfaadocno              #顯示到畫面上

            NEXT FIELD sfaadocno                          #返回原欄位

]]>
  </point>
  <point name="input.c.sfaa060" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa060             #給予default值

            #給予arg

            CALL q_ooca001()                                #呼叫開窗

            LET g_sfaa_m.sfaa060 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa060 TO sfaa060              #顯示到畫面上

            NEXT FIELD sfaa060                          #返回原欄位

]]>
  </point>
  <point name="input.c.sfaa013" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa013             #給予default值

            #給予arg

            CALL q_ooca001()                                #呼叫開窗

            LET g_sfaa_m.sfaa013 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa013 TO sfaa013              #顯示到畫面上

            NEXT FIELD sfaa013                          #返回原欄位

]]>
  </point>
  <point name="input.c.sfaa010" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa010             #給予default值

            #給予arg

            CALL q_imaa001_9()                                #呼叫開窗

            LET g_sfaa_m.sfaa010 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa010 TO sfaa010              #顯示到畫面上

            NEXT FIELD sfaa010                          #返回原欄位

]]>
  </point>
  <point name="input.c.sfaa009" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa009             #給予default值

            #給予arg

            CALL q_pmaa001_6()                                #呼叫開窗

            LET g_sfaa_m.sfaa009 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa009 TO sfaa009              #顯示到畫面上

            NEXT FIELD sfaa009                          #返回原欄位

]]>
  </point>
  <point name="input.c.sfaa002" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa002             #給予default值

            #給予arg

            CALL q_ooag001()                                #呼叫開窗

            LET g_sfaa_m.sfaa002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa002 TO sfaa002              #顯示到畫面上

            NEXT FIELD sfaa002                          #返回原欄位

]]>
  </point>
  <point name="input.a.sfaeseq" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaeseq) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfae005" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.a.sfae001" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfae001) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfad002" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfad002) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfac003" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfac003) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfac001" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.a.sfab005" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfab005) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfaadocno" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaa_t WHERE "||"sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND "||"sfaadocno = '"||g_sfaa_m.sfaadocno ||"'",'std-00004',0) THEN 
                     LET g_sfaa_m.sfaadocno = g_sfaadocno_t
                     NEXT FIELD CURRENT
                  END IF
                  
                  #单别带出单据名称
                  SELECT ooef004 INTO l_ooef004 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001=g_site
                  SELECT oobal004 INTO g_sfaa_m.oobal004 FROM oobal_t WHERE oobalent = g_enterprise AND oobal001 = l_ooef004 AND oobal002 = g_sfaa_m.sfaadocno AND oobal003 = g_lang
                  DISPLAY g_sfaa_m.oobal004 TO FORMONLY.oobal004
                  
                  #依单别预设工单类型
                  SELECT oobb005 INTO g_sfaa_m.sfaa003 FROM oobb_t WHERE oobbent=g_enterprise AND oobb001=l_ooef004 AND oobb002=g_sfaa_m.sfaadocno AND oobb004='sfaa003'
                  IF cl_null(g_sfaa_m.sfaa003) THEN
                     LET g_sfaa_m.sfaa003 = '1' 
                  END IF
                  
                  #依单别预设委外类型
                  SELECT oobb005 INTO g_sfaa_m.sfaa057 FROM oobb_t WHERE oobbent=g_enterprise AND oobb001=l_ooef004 AND oobb002=g_sfaa_m.sfaadocno AND oobb004='sfaa057'
                  IF cl_null(g_sfaa_m.sfaa057) THEN
                     LET g_sfaa_m.sfaa057 = '1' 
                  END IF
               END IF
            END IF
            ]]>
  </point>
  <point name="input.a.sfaa058" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaa058) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfaa033" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaa033) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfaa032" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaa032) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfaa027" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaa027) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfaa017" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa017
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa017_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa017_desc
]]>
  </point>
  <point name="input.a.sfaa016" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa010
            LET g_ref_fields[2] = g_sfaa_m.sfaa016
            CALL ap_ref_array2(g_ref_fields,"SELECT ecba003 FROM ecba_t WHERE ecbaent='"||g_enterprise||"' AND ecba001=? AND ecba002=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa016_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa016_desc
]]>
  </point>
  <point name="input.a.sfaa012" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaa012) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.sfaa010" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaa010) THEN
               IF g_sfaa_m.sfaa003 MATCHES '[145]' THEN
                  LET l_sql = "SELECT bmaa001,bmaastus FROM bmaa_t WHERE bmaaent='",g_enterprise,"' AND bmaasite='",g_site,"'",
                              "   AND bmaa001='", g_sfaa_m.sfaa010,"'"
                  IF g_sfaa_m.sfaa011 IS NOT NULL THEN
                     LET l_sql = l_sql," AND bmaa002='",g_sfaa_m.sfaa011,"'"
                  END IF 
                  PREPARE sel_bmaa_pre FROM l_sql
                  EXECUTE sel_bmaa_pre INTO l_bmaa001,l_bmaastus
                  IF cl_null(l_bmaa001) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00045'
                     LET g_errparam.extend = g_sfaa_m.sfaa010
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfaa_m.sfaa010 = g_sfaa_m_t.sfaa010
                     NEXT FIELD sfaa010
                  END IF
                  IF cl_null(l_bmaastus) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00045'
                     LET g_errparam.extend = g_sfaa_m.sfaa010
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfaa_m.sfaa010 = g_sfaa_m_t.sfaa010
                     NEXT FIELD sfaa010
                  END IF
               END IF 
            END IF 
                  
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa010
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa010_desc
]]>
  </point>
  <point name="input.a.sfaa009" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa009
            CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa009_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa009_desc
]]>
  </point>
  <point name="input.a.sfaa002" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfaa_m.sfaa002) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_sfaa_m.sfaa002

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_ooag001") THEN
                  LET g_sfaa_m.sfaa002 = g_sfaa_m_t.sfaa002  
                  NEXT FIELD CURRENT
               END IF
            END IF
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa002
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa002_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa002_desc
]]>
  </point>
  <point name="input.a.page6.sfaadocno_6" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba6_d[g_detail_idx].sfaadocno) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba6_d[g_detail_idx].sfaadocno != g_sfba6_d_t.sfaadocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaa_t WHERE "||"sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND "||"sfaadocno = '"||g_sfaa_m.sfaadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page5.sfae005" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba5_d[l_ac].sfae005
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfba5_d[l_ac].sfae005_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba5_d[l_ac].sfae005_desc
]]>
  </point>
  <point name="input.a.page5.sfaadocno_5" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba5_d[g_detail_idx].sfaadocno) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba5_d[g_detail_idx].sfaadocno != g_sfba5_d_t.sfaadocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaa_t WHERE "||"sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND "||"sfaadocno = '"||g_sfaa_m.sfaadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page4.sfaadocno_4" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba4_d[g_detail_idx].sfaadocno) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba4_d[g_detail_idx].sfaadocno != g_sfba4_d_t.sfaadocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaa_t WHERE "||"sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND "||"sfaadocno = '"||g_sfaa_m.sfaadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page3.sfac001" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba3_d[l_ac].sfac001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba3_d[l_ac].sfac001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba3_d[l_ac].sfac001_desc
]]>
  </point>
  <point name="input.a.page3.sfaadocno_3" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba3_d[g_detail_idx].sfaadocno) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba3_d[g_detail_idx].sfaadocno != g_sfba3_d_t.sfaadocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaa_t WHERE "||"sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND "||"sfaadocno = '"||g_sfaa_m.sfaadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page2.sfaadocno" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba2_d[g_detail_idx].sfaadocno) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba2_d[g_detail_idx].sfaadocno != g_sfba2_d_t.sfaadocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaa_t WHERE "||"sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND "||"sfaadocno = '"||g_sfaa_m.sfaadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page2.a8" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba2_d[l_ac].a8
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfba2_d[l_ac].a8_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba2_d[l_ac].a8_desc
]]>
  </point>
  <point name="input.a.page2.a7" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba2_d[l_ac].a7
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba2_d[l_ac].a7_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba2_d[l_ac].a7_desc
]]>
  </point>
  <point name="input.a.page2.a6" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba2_d[l_ac].a6
            CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba2_d[l_ac].a6_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba2_d[l_ac].a6_desc
]]>
  </point>
  <point name="input.a.page1.sfbaseq1" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba_d[g_detail_idx].sfbaseq != g_sfba_d_t.sfbaseq OR g_sfba_d[g_detail_idx].sfbaseq1 != g_sfba_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND sfbasite = '" ||g_site|| "' AND "||"sfbadocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfbaseq = '"||g_sfba_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.sfbaseq" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba_d[g_detail_idx].sfbaseq != g_sfba_d_t.sfbaseq OR g_sfba_d[g_detail_idx].sfbaseq1 != g_sfba_d_t.sfbaseq1)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND sfbasite = '" ||g_site|| "' AND "||"sfbadocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfbaseq = '"||g_sfba_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.sfba023" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfba_d[l_ac].sfba023) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.sfba022" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfba_d[l_ac].sfba022) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.sfba015" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfba_d[l_ac].sfba015) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.sfba012" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_sfba_d[l_ac].sfba012) THEN 
            END IF 
]]>
  </point>
  <point name="input.a.page1.sfba006" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba006
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba006_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba006_desc
]]>
  </point>
  <point name="input.a.a8" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.a.a7" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.a.a6" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="construct.c.sfaapstid" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaapstid  #顯示到畫面上

            NEXT FIELD sfaapstid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaaownid" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaaownid  #顯示到畫面上

            NEXT FIELD sfaaownid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaaowndp" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaaowndp  #顯示到畫面上

            NEXT FIELD sfaaowndp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaamodid" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaamodid  #顯示到畫面上

            NEXT FIELD sfaamodid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaadocno" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_sfaadocno_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaadocno  #顯示到畫面上

            NEXT FIELD sfaadocno                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaacrtid" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaacrtid  #顯示到畫面上

            NEXT FIELD sfaacrtid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaacrtdp" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaacrtdp  #顯示到畫面上

            NEXT FIELD sfaacrtdp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaacnfid" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaacnfid  #顯示到畫面上

            NEXT FIELD sfaacnfid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaa060" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa060  #顯示到畫面上

            NEXT FIELD sfaa060                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaa013" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa013  #顯示到畫面上

            NEXT FIELD sfaa013                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaa010" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaa001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa010  #顯示到畫面上

            NEXT FIELD sfaa010                     #返回原欄位

]]>
  </point>
  <point name="construct.c.sfaa009" order="0" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pmaa001_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa009  #顯示到畫面上

            NEXT FIELD sfaa009                     #返回原欄位

]]>
  </point>
  <point name="function.asft300_init" order="1" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_init()
   #add-point:init段define
   
   DEFINE l_sys      LIKE type_t.chr80
   #end add-point

   LET g_bfill = "Y"
   LET g_detail_idx = 1
   LET g_detail_idx2 = 1
   LET g_error_show = 1
      CALL cl_set_combo_scc_part('sfaastus','13','A,C,D,E,F,M,N,R,W,X,Y')

      CALL cl_set_combo_scc('sfaa003','4007')
   CALL cl_set_combo_scc('sfaa057','4010')
   CALL cl_set_combo_scc('sfaa004','4008')
   CALL cl_set_combo_scc('sfaa005','4009')
   CALL cl_set_combo_scc('sfaa065','4022')
   CALL cl_set_combo_scc('sfab001','4009')
   CALL cl_set_combo_scc('sfac002','4019')
   CALL cl_set_combo_scc('sfba008','1101')
   CALL cl_set_combo_scc('sfba026','4012')
   CALL cl_set_combo_scc('imaf013','2022')

   LET gwin_curr = ui.Window.getCurrent()  #取得現行畫面
   LET gfrm_curr = gwin_curr.getForm()     #取出物件化後的畫面物件
   
   #add-point:畫面資料初始化
   CALL cl_set_combo_scc('b_sfaa003','4007')
   CALL cl_set_combo_scc('b_sfaa057','4010')
   CALL cl_set_combo_scc('b_sfaa004','4008')
   
   CALL cl_get_para(g_enterprise,g_site,'S-BAS-0028') RETURNING l_sys
   IF l_sys = 'N' THEN
      CALL cl_set_comp_visible("sfaa058,sfaa060,sfaa060_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("sfaa058,sfaa060,sfaa060_desc",TRUE)
   END IF 
   
   CALL cl_set_act_visible("modify_date",FALSE)
   #end add-point

   CALL asft300_default_search()

END FUNCTION]]>
  </point>
  <point name="function.asft300_ui_dialog" order="2" ver="9" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_ui_dialog()
   {<Local define>}
   DEFINE li_idx  LIKE type_t.num5
   DEFINE l_success LIKE type_t.num5
   DEFINE l_num     LIKE type_t.num5
   DEFINE l_n       LIKE type_t.num5
   DEFINE la_param  RECORD
          prog      STRING,
          param     DYNAMIC ARRAY OF STRING
                    END RECORD
   DEFINE ls_js     STRING

   {</Local define>}
   #add-point:ui_dialog段define
   DEFINE l_m       LIKE type_t.num5
   DEFINE l_wc       STRING
   DEFINE ls_wc       STRING
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   #end add-point

   CALL cl_set_act_visible("accept,cancel", FALSE)

   CALL gfrm_curr.setElementImage("logo","logo/applogo.png")
   IF g_default THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   ELSE
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF

   #add-point:ui_dialog段before dialog
   
   #end add-point

   WHILE TRUE

      CALL asft300_browser_fill("")
      CALL lib_cl_dlg.cl_dlg_before_display()
      CALL cl_notice()

      #判斷前一個動作是否為新增, 若是的話切換到新增的筆數
      IF g_state = "Y" THEN
         FOR li_idx = 1 TO g_browser.getLength()
            IF g_browser[li_idx].b_sfaadocno = g_sfaadocno_t

               THEN
               LET g_current_row = li_idx
               LET g_current_idx = li_idx
               EXIT FOR
            END IF
         END FOR
         LET g_state = ""
      END IF

      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)

         #INPUT g_searchstr,g_searchcol FROM formonly.searchstr,formonly.cbo_searchcol
         #
         #   BEFORE INPUT
         #
         #END INPUT

         #左側瀏覽頁簽
         DISPLAY ARRAY g_browser TO s_browse.* ATTRIBUTES(COUNT=g_header_cnt)

            BEFORE ROW
               #回歸舊筆數位置 (回到當時異動的筆數)
               LET g_current_idx = DIALOG.getCurrentRow("s_browse")
               IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                  LET g_current_idx = g_current_row
               END IF
               LET g_current_row = g_current_idx #目前指標
               LET g_current_sw = TRUE

               IF g_current_idx > g_browser.getLength() THEN
                  LET g_current_idx = g_browser.getLength()
               END IF

               CALL asft300_fetch('') # reload data
               LET l_ac = 1
               CALL asft300_ui_detailshow() #Setting the current row

               CALL asft300_idx_chk()
               #NEXT FIELD sfbaseq

         END DISPLAY
         
         DISPLAY ARRAY g_sfab_d TO s_sfab.* ATTRIBUTES(COUNT=g_rec_b_sfab) #page1

            BEFORE ROW
               CALL asft300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_sfab")

            BEFORE DISPLAY
               LET l_ac = DIALOG.getCurrentRow("s_sfab")
               CALL asft300_idx_chk()

         END DISPLAY
         
         DISPLAY ARRAY g_sfac_d TO s_sfac.* ATTRIBUTES(COUNT=g_rec_b_sfac) #page1

            BEFORE ROW
               CALL asft300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_sfac")

            BEFORE DISPLAY
               LET l_ac = DIALOG.getCurrentRow("s_sfac")
               CALL asft300_idx_chk()

         END DISPLAY
         
         DISPLAY ARRAY g_sfad_d TO s_sfad.* ATTRIBUTES(COUNT=g_rec_b_sfad) #page1

            BEFORE ROW
               CALL asft300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_sfad")

            BEFORE DISPLAY
               LET l_ac = DIALOG.getCurrentRow("s_sfad")
               CALL asft300_idx_chk()

         END DISPLAY
         
         DISPLAY ARRAY g_sfae_d TO s_sfae.* ATTRIBUTES(COUNT=g_rec_b_sfae) #page1

            BEFORE ROW
               CALL asft300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_sfae")

            BEFORE DISPLAY
               LET l_ac = DIALOG.getCurrentRow("s_sfae")
               CALL asft300_idx_chk()

         END DISPLAY
         
         DISPLAY ARRAY g_sfaf_d TO s_sfaf.* ATTRIBUTES(COUNT=g_rec_b_sfaf) #page1

            BEFORE ROW
               CALL asft300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_sfaf")

            BEFORE DISPLAY
               LET l_ac = DIALOG.getCurrentRow("s_sfaf")
               CALL asft300_idx_chk()

         END DISPLAY

         DISPLAY ARRAY g_sfba_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) #page1

            BEFORE ROW
               CALL asft300_idx_chk()
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_detail_idx = l_ac

               #add-point:page1, before row動作
               
               #end add-point

            BEFORE DISPLAY
               CALL FGL_SET_ARR_CURR(g_detail_idx)
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               CALL asft300_idx_chk()
               LET g_current_page = 1

            #自訂ACTION(detail_show,page_1)


            #add-point:page1自定義行為
            
            #end add-point

         END DISPLAY



         #add-point:ui_dialog段自定義display array
         
         #end add-point

         SUBDIALOG lib_cl_dlg.cl_dlg_qryplan
         SUBDIALOG lib_cl_dlg.cl_dlg_relateapps

         BEFORE DIALOG
            CALL cl_navigator_setting(g_current_idx, g_detail_cnt)
            LET g_curr_diag = ui.DIALOG.getCurrent()
            LET g_page = "first"
            LET g_current_sw = FALSE
            #回歸舊筆數位置 (回到當時異動的筆數)
            LET g_current_idx = DIALOG.getCurrentRow("s_browse")
            IF g_current_row > 1 AND g_current_idx = 1 AND g_current_sw = FALSE THEN
               CALL DIALOG.setCurrentRow("s_browse",g_current_row)
               LET g_current_idx = g_current_row
            END IF
            LET g_current_row = g_current_idx #目前指標
            IF g_current_idx = 0 THEN
               LET g_current_idx = 1
            END IF
            LET g_current_sw = TRUE

            IF g_current_idx > g_browser.getLength() THEN
               LEt g_current_idx = g_browser.getLength()
            END IF

            #有資料才進行fetch
            IF g_current_idx <> 0 THEN
               CALL asft300_fetch('') # reload data
            END IF
            #LET g_detail_idx = 1
            CALL asft300_ui_detailshow() #Setting the current row

            #筆數顯示
            LET g_current_page = 1
            CALL asft300_idx_chk()

            #add-point:ui_dialog段before_dialog2
            CALL gfrm_curr.ensureFieldVisible("sfaa005")
            #end add-point

            #NEXT FIELD sfbaseq

         ON ACTION statechange
            CALL asft300_statechange()
            LET g_action_choice = "statechange"
            EXIT DIALOG

         #此段落由子樣板a32產生
         #簽核狀況
         ON ACTION bpm_status
            #查詢簽核狀況, 統一建立HyperLink
            CALL cl_bpm_status()
            #add-point:ON ACTION bpm_status
            
            #END add-point

        #查詢方案選擇
         ON ACTION queryplansel
            CALL cl_dlg_qryplan_select() RETURNING ls_wc
            #不是空條件才寫入g_wc跟重新找資料
            IF NOT cl_null(ls_wc) THEN
               #mod pattern 修改调整150624
               #LET g_wc = ls_wc
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_extend TO NULL
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "sfaa_t"
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "sfba_t"
                        LET g_wc2 = la_wc[li_idx].wc

                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2) OR NOT cl_null(g_wc2_extend) THEN
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF

                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
               END IF
               #mod pattern 修改调整150624 end
               CALL asft300_browser_fill("F")   #browser_fill()會將notice區塊清空
               CALL cl_notice()   #重新顯示,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            END IF

         #查詢方案選擇
         ON ACTION qbe_select
            CALL cl_qbe_list("m") RETURNING ls_wc
            IF NOT cl_null(ls_wc) THEN
              #mod pattern 修改调整150624
              #LET g_wc = ls_wc
              ##取得條件後需要重查、跳到結果第一筆資料的功能程式段
              #CALL asft300_browser_fill("F")
              #IF g_browser_cnt = 0 THEN
              #   INITIALIZE g_errparam TO NULL
              #   LET g_errparam.extend = ""
              #   LET g_errparam.code   = "-100"
              #   LET g_errparam.popup  = TRUE
              #   CALL cl_err()
              #
              #   CLEAR FORM
              #ELSE
              #   CALL asft300_fetch("F")
              #END IF
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_extend TO NULL
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "sfaa_t"
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "sfba_t"
                        LET g_wc2 = la_wc[li_idx].wc

                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2) OR NOT cl_null(g_wc2_extend) THEN
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF

                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
                  CALL asft300_browser_fill("F")
                  IF g_browser_cnt = 0 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.extend = ""
                     LET g_errparam.code   = "-100"
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()                 
                     CLEAR FORM
                  ELSE
                     CALL asft300_fetch("F")
                  END IF
               END IF
               #mod pattern 修改调整150624 end
            END IF
            #重新搜尋會將notice區塊清空,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
            CALL cl_notice()
      

         #ACTION表單列
         ON ACTION filter
            CALL asft300_filter()
            EXIT DIALOG

         ON ACTION first
            CALL asft300_fetch('F')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL asft300_idx_chk()

         ON ACTION previous
            CALL asft300_fetch('P')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL asft300_idx_chk()

         ON ACTION jump
            CALL asft300_fetch('/')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL asft300_idx_chk()

         ON ACTION next
            CALL asft300_fetch('N')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL asft300_idx_chk()

         ON ACTION last
            CALL asft300_fetch('L')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL asft300_idx_chk()

         ON ACTION close
            LET INT_FLAG=FALSE
            LET g_action_choice = "exit"
            EXIT DIALOG

         ON ACTION exit
            LET g_action_choice = "exit"
            EXIT DIALOG

         ON ACTION mainhidden       #主頁摺疊
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF

         ON ACTION worksheethidden   #瀏覽頁折疊
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
            END IF

         ON ACTION controls      #單頭摺疊，可利用hot key "Ctrl-s"開啟/關閉單頭
            IF g_header_hidden THEN
               CALL gfrm_curr.setElementHidden("vb_master",0)
               CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
               LET g_header_hidden = 0     #visible
            ELSE
               CALL gfrm_curr.setElementHidden("vb_master",1)
               CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
               LET g_header_hidden = 1     #hidden     
            END IF

         ON ACTION controlo
            DISPLAY "Controlo"



         ON ACTION delete

            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL asft300_delete()
               #add-point:ON ACTION delete
               
               #END add-point
            END IF


         ON ACTION insert

            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL asft300_insert()
               #add-point:ON ACTION insert
               CALL cl_set_combo_scc('sfaa005','4009')  #add by lixh 20150527
               #END add-point
                EXIT DIALOG
            END IF


         ON ACTION modify

            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               CALL asft300_modify()
               #add-point:ON ACTION modify
               
               #END add-point
                EXIT DIALOG
            END IF


         ON ACTION modify_detail

            LET g_action_choice="modify_detail"
            IF cl_auth_chk_act("modify_detail") THEN
               CALL asft300_modify()
               #add-point:ON ACTION modify_detail
               
               #END add-point
                EXIT DIALOG
            END IF


         ON ACTION output

            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               #add-point:ON ACTION output
              #LET l_wc = " sfaadocno = '",g_sfaa_m.sfaadocno,"'"
              #CALL asfr300_g01(l_wc,'','')
               LET g_rep_wc = " sfaadocno = '",g_sfaa_m.sfaadocno,"'"
               &include "erp/asf/asft300_rep.4gl"
               #END add-point
                EXIT DIALOG
            END IF

         ON ACTION exporttoexcel   #匯出excel
            LET g_action_choice="exporttoexcel"
            IF cl_auth_chk_act("exporttoexcel") THEN
               CALL g_export_node.clear()
               LET g_export_node[1] = base.typeInfo.create(g_browser)
               LET g_export_id[1]   = "s_browse"
               LET g_export_node[2] = base.typeInfo.create(g_sfab_d)
               LET g_export_id[2]   = "s_sfab"
               LET g_export_node[3] = base.typeInfo.create(g_sfac_d)
               LET g_export_id[3]   = "s_sfac"
               LET g_export_node[4] = base.typeInfo.create(g_sfaf_d)
               LET g_export_id[4]   = "s_sfaf"
               LET g_export_node[5] = base.typeInfo.create(g_sfba_d)
               LET g_export_id[5]   = "s_detail1"
               CALL cl_export_to_excel_getpage()
               CALL cl_export_to_excel()
            END IF

         ON ACTION query

            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL asft300_query()
               #add-point:ON ACTION query
               
               #END add-point
            END IF


         ON ACTION reproduce

            LET g_action_choice="reproduce"
            IF cl_auth_chk_act("reproduce") THEN
               CALL asft300_reproduce()
               #add-point:ON ACTION reproduce
               
               #END add-point
                EXIT DIALOG
            END IF
         
      #  ON ACTION modify_date
      #     LET g_action_choice="modify_date"
      #     IF cl_auth_chk_act("modify_date") THEN
      #        IF g_sfaa_m.sfaastus MATCHES '[NYF]' THEN
      #           LET g_flag_date = 'Y'
      #           CALL asft300_input('u')
      #           LET g_flag_date = 'N'
      #        END IF
      #        EXIT DIALOG
      #     END IF
            
         ON ACTION gen_allotment
            LET g_action_choice="gen_allotment"
            IF cl_auth_chk_act("gen_allotment") THEN
               IF g_sfaa_m.sfaastus MATCHES '[NY]' AND NOT cl_null(g_sfaa_m.sfaadocno) THEN
                  SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
                  IF l_n > 0 THEN
                     IF cl_ask_confirm('asf-00198') THEN 
                        CALL asft300_del_allotment('N')
                        CALL s_transaction_begin()
                        CALL s_asft300_02(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa003,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa015,g_sfaa_m.sfaa012,'N') RETURNING l_success,l_num
                        IF NOT l_success THEN
                           CALL s_transaction_end('N','0')
                        ELSE
                           CALL s_transaction_end('Y','0')
                         # INITIALIZE g_errparam TO NULL
                         # LET g_errparam.code = 'asf-00166'
                         # LET g_errparam.extend = ''
                         # LET g_errparam.popup = TRUE
                         # LET g_errparam.replace[1] = l_num
                         # CALL cl_err()

                        END IF
                     END IF
                  END IF
                  IF l_n = 0 THEN
                     CALL s_transaction_begin()
                     CALL s_asft300_02(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa003,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa015,g_sfaa_m.sfaa012,'N') RETURNING l_success,l_num              
                     IF NOT l_success THEN
                        CALL s_transaction_end('N','0')
                     ELSE
                        CALL s_transaction_end('Y','0')
                      # INITIALIZE g_errparam TO NULL
                      #    LET g_errparam.code = 'asf-00166'
                      #    LET g_errparam.extend = ''
                      #    LET g_errparam.popup = TRUE
                      #    LET g_errparam.replace[1] = l_num
                      #    CALL cl_err()

                     END IF
                  END IF 
               END IF
               EXIT DIALOG
            END IF
            
         ON ACTION del_allotment
            LET g_action_choice="del_allotment"
            IF cl_auth_chk_act("del_allotment") THEN
               IF g_sfaa_m.sfaastus MATCHES '[NY]' AND NOT cl_null(g_sfaa_m.sfaadocno) THEN
                  IF cl_ask_confirm('asf-00199') THEN 
                     CALL asft300_del_allotment('Y')
                  END IF
               END IF 
               EXIT DIALOG
            END IF
            
         ON ACTION gen_routing
            LET g_action_choice="gen_routing"
            IF cl_auth_chk_act("gen_routing") THEN
               IF g_sfaa_m.sfaastus = 'N' AND NOT cl_null(g_sfaa_m.sfaadocno) THEN
                  SELECT COUNT(*) INTO l_n FROM sfca_t WHERE sfcaent=g_enterprise AND sfcasite=g_site AND sfcadocno=g_sfaa_m.sfaadocno
                  CALL s_transaction_begin()
                  IF l_n > 0 THEN
                     IF cl_ask_confirm('asf-00113') THEN
                        DELETE FROM sfca_t WHERE sfcaent=g_enterprise AND sfcasite=g_site AND sfcadocno=g_sfaa_m.sfaadocno
                        DELETE FROM sfcb_t WHERE sfcbent=g_enterprise AND sfcbsite=g_site AND sfcbdocno=g_sfaa_m.sfaadocno
                        DELETE FROM sfcc_t WHERE sfccent=g_enterprise AND sfccsite=g_site AND sfccdocno=g_sfaa_m.sfaadocno
                        DELETE FROM sfcd_t WHERE sfcdent=g_enterprise AND sfcdsite=g_site AND sfcddocno=g_sfaa_m.sfaadocno
                        IF s_asft300_08(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa010,g_sfaa_m.sfaa016) THEN
                           INITIALIZE g_errparam TO NULL
                           LET g_errparam.code = 'asf-00112'
                           LET g_errparam.extend = ''
                           LET g_errparam.popup = TRUE
                           CALL cl_err()

                           CALL s_transaction_end('Y','0')
                        ELSE
                           CALL s_transaction_end('N','0')
                        END IF
                     END IF
                  ELSE               
                     IF s_asft300_08(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa010,g_sfaa_m.sfaa016) THEN
                        INITIALIZE g_errparam TO NULL
                           LET g_errparam.code = 'asf-00112'
                           LET g_errparam.extend = ''
                           LET g_errparam.popup = TRUE
                           CALL cl_err()

                        CALL s_transaction_end('Y','0')
                     ELSE
                        CALL s_transaction_end('N','0')
                     END IF
                  END IF
               END IF 
               EXIT DIALOG
            END IF

         ON ACTION routing
            LET g_action_choice="routing"
            IF cl_auth_chk_act("routing") THEN
               LET la_param.prog = "asft301"
               LET la_param.param[1] = g_sfaa_m.sfaadocno
               LET la_param.param[2] = 0
               LET ls_js = util.JSON.stringify(la_param)
               CALL cl_cmdrun(ls_js)
               #CALL cl_cmdrun("asft301 '"||g_sfaa_m.sfaadocno||"' "||0)
               EXIT DIALOG
            END IF
            
         #工单委外   
         ON ACTION sub_po
            LET g_action_choice="sub_po"
            IF cl_auth_chk_act("sub_po") THEN
               IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
                  CALL asft300_sub_po()
               END IF
               EXIT DIALOG
            END IF
            
         ON ACTION po_gen
            LET g_action_choice="po_gen"
            IF cl_auth_chk_act("po_gen") THEN
               IF g_sfaa_m.sfaa005 = '1' AND NOT cl_null(g_sfaa_m.sfaadocno) AND g_sfaa_m.sfaastus = 'N' THEN
                  SELECT COUNT(*) INTO l_m FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
                  IF l_m > 0 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00329'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                  ELSE
                     CALL asft300_01(g_sfaa_m.sfaadocno)
                  END IF
                  EXIT DIALOG
               END IF
            END IF
            
         ON ACTION replace
            LET g_action_choice="replace"
            IF cl_auth_chk_act("replace") THEN
               IF g_sfaa_m.sfaastus MATCHES '[NYF]' AND NOT cl_null(g_sfaa_m.sfaadocno) THEN
                  CALL asft300_02(g_sfaa_m.sfaadocno)
               END IF 
               EXIT DIALOG
            END IF

         ON ACTION replace_set
            LET g_action_choice="replace_set"
            IF cl_auth_chk_act("replace_set") THEN
               IF g_sfaa_m.sfaastus MATCHES '[NYF]' AND NOT cl_null(g_sfaa_m.sfaadocno) THEN
                  CALL asft300_03(g_sfaa_m.sfaadocno)
               END IF 
               EXIT DIALOG
            END IF
         
         ON ACTION open_asft300_05
            LET g_action_choice="open_asft300_05"
            IF cl_auth_chk_act("open_asft300_05") THEN
               
               #add-point:ON ACTION open_asft300_05
               CALL asft300_05(g_sfaa_m.sfaadocno)
               #END add-point
               
            END IF
         
         #新增相關文件
         ON ACTION related_document
            CALL asft300_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               CALL cl_doc()
            END IF

         ON ACTION agendum
            CALL asft300_set_pk_array()
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()

         ON ACTION followup
            CALL asft300_set_pk_array()
            CALL cl_user_overview_follow(g_sfaa_m.sfaadocdt)
            
         ON ACTION prog_ainq100
            LET g_action_choice="prog_ainq100"
            IF cl_auth_chk_act("prog_ainq100") THEN
               #使用JSON格式組合參數與作業編號(串查)
               INITIALIZE la_param.* TO NULL
               LET la_param.prog     = 'ainq100'
               LET la_param.param[1] = '2'
               LET la_param.param[2] = g_sfaa_m.sfaadocno
               LET ls_js = util.JSON.stringify(la_param)
               CALL cl_cmdrun_wait(ls_js)            
            END IF

         #主選單用ACTION
         &include "main_menu.4gl"
         &include "relating_action.4gl"
         #交談指令共用ACTION
         &include "common_action.4gl"
            CONTINUE DIALOG

      END DIALOG

      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         EXIT WHILE
      END IF

   END WHILE

   CALL cl_set_act_visible("accept,cancel", TRUE)

END FUNCTION]]>
  </point>
  <point name="function.asft300_browser_search" order="3" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_browser_search(p_type)
   {<Local define>}
   DEFINE p_type LIKE type_t.chr10
   {</Local define>}
   #add-point:browser_search段define
   
   #end add-point

   #若無輸入關鍵字則查找出所有資料
   IF NOT cl_null(g_searchstr) AND g_searchcol='0' THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00005"
      LET g_errparam.extend = "searchcol"
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN FALSE 
   END IF

   IF NOT cl_null(g_searchstr) THEN
      LET g_wc = " lower(", g_searchcol, ") LIKE '%", g_searchstr, "%'"
      LET g_wc = g_wc.toLowerCase()
   ELSE
      LET g_wc = " 1=1 "
   END IF

   #若為排序搜尋則添加以下條件
   IF cl_null(g_searchcol) OR g_searchcol = "0" THEN
      LET g_wc = g_wc, " ORDER BY sfaadocno"
   ELSE
      LET g_wc = g_wc, " ORDER BY ", g_searchcol
   END IF

   CALL asft300_browser_fill("F")
   CALL ui.Interface.refresh()
   RETURN TRUE

END FUNCTION]]>
  </point>
  <point name="function.asft300_browser_fill" order="4" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_browser_fill(ps_page_action)
   {<Local define>}
   DEFINE ps_page_action    STRING
   DEFINE l_wc              STRING
   DEFINE l_wc2             STRING
   DEFINE l_sql             STRING
   DEFINE l_sub_sql         STRING
   DEFINE l_sql_rank        STRING
   DEFINE l_searchcol       STRING
   {</Local define>}
   #add-point:browser_fill段define
   DEFINE l_success         LIKE type_t.num5
   DEFINE l_slip            STRING
   #end add-point

   #清除畫面
   CLEAR FORM
   INITIALIZE g_sfaa_m.* TO NULL
   CALL g_sfba_d.clear()

   CALL g_browser.clear()

   #搜尋用
   IF cl_null(g_searchcol) OR g_searchcol = '0' THEN
      LET l_searchcol = "sfaadocno"

   ELSE
      LET l_searchcol = g_searchcol
   END IF

   LET l_wc  = g_wc.trim()
   LET l_wc2 = g_wc2.trim()
   IF cl_null(l_wc) THEN  #p_wc 查詢條件
      RETURN
   END IF

   #add-point:browser_fill,foreach前
   
   #end add-point

   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件
      LET l_sub_sql = " SELECT UNIQUE sfaadocno ",

                        " FROM sfaa_t ",
                              " LEFT JOIN sfab_t ON sfabent = sfaaent AND sfabsite = sfaasite AND sfabdocno = sfaadocno ",
                              " LEFT JOIN sfac_t ON sfacent = sfaaent AND sfacsite = sfaasite AND sfacdocno = sfaadocno ",
                              " LEFT JOIN sfad_t ON sfadent = sfaaent AND sfadsite = sfaasite AND sfaddocno = sfaadocno ",
                              " LEFT JOIN sfae_t ON sfaeent = sfaaent AND sfaesite = sfaasite AND sfaedocno = sfaadocno ",
                              " LEFT JOIN sfaf_t ON sfafent = sfaaent AND sfafsite = sfaasite AND sfafdocno = sfaadocno ",
                              " LEFT JOIN sfba_t ON sfbaent = sfaaent AND sfbasite = sfaasite AND sfbadocno = sfaadocno ",
                              " LEFT JOIN ooff_t ON ooffent = sfaaent AND ooff002   = sfaadocno AND ooff001 = '6' AND ooff012 = '2'",
                       " WHERE sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND sfbaent = '" ||g_enterprise|| "' AND sfbasite = '" ||g_site|| "' AND ",l_wc, " AND ", l_wc2

   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT UNIQUE sfaadocno ",

                        " FROM sfaa_t ",
                              " LEFT JOIN sfab_t ON sfabent = sfaaent AND sfabsite = sfaasite AND sfabdocno = sfaadocno ",
                              " LEFT JOIN sfac_t ON sfacent = sfaaent AND sfacsite = sfaasite AND sfacdocno = sfaadocno ",
                              " LEFT JOIN sfad_t ON sfadent = sfaaent AND sfadsite = sfaasite AND sfaddocno = sfaadocno ",
                              " LEFT JOIN sfae_t ON sfaeent = sfaaent AND sfaesite = sfaasite AND sfaedocno = sfaadocno ",
                              " LEFT JOIN sfaf_t ON sfafent = sfaaent AND sfafsite = sfaasite AND sfafdocno = sfaadocno ",
                              " LEFT JOIN ooff_t ON ooffent = sfaaent AND ooff002  = sfaadocno AND ooff001 = '6' AND ooff012 = '2'",
                        "WHERE sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND ",l_wc CLIPPED

   END IF

   LET g_sql = " SELECT COUNT(*) FROM (",l_sub_sql,")"

   #add-point:browser_fill,count前
   
   #end add-point

   PREPARE header_cnt_pre FROM g_sql
   EXECUTE header_cnt_pre INTO g_browser_cnt   #總筆數
   FREE header_cnt_pre

   DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
   DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示

   #LET g_page_action = ps_page_action          # Keep Action

   IF ps_page_action = "F" OR
      ps_page_action = "P" OR
      ps_page_action = "N" OR
      ps_page_action = "L" THEN
      LET g_page_action = ps_page_action
   END IF

   CASE ps_page_action
      WHEN "F"
         LET g_pagestart = 1

      WHEN "P"
         LET g_pagestart = g_pagestart - g_max_browse
         IF g_pagestart < 1 THEN
            LET g_pagestart = 1
         END IF

      WHEN "N"
         LET g_pagestart = g_pagestart + g_max_browse
         IF g_pagestart > g_browser_cnt THEN
            LET g_pagestart = g_browser_cnt - (g_browser_cnt mod g_max_browse) + 1
            WHILE g_pagestart > g_browser_cnt
               LET g_pagestart = g_pagestart - g_max_browse
            END WHILE
         END IF

      WHEN "L"
         LET g_pagestart = g_browser_cnt - (g_browser_cnt mod g_max_browse) + 1
         WHILE g_pagestart > g_browser_cnt
            LET g_pagestart = g_pagestart - g_max_browse
         END WHILE

      WHEN '/'
         LET g_pagestart = g_jump
         IF g_pagestart > g_browser_cnt THEN
            LET g_pagestart = 1
         END IF

   END CASE

   #單身有輸入查詢條件且非null
   IF g_wc2 <> " 1=1" AND NOT cl_null(g_wc2) THEN
      #依照sfaadocno,sfaa001,sfaadocdt,sfaa002,sfaa003,sfaa057,sfaa004 Browser欄位定義(取代原本bs_sql功能)
      LET l_sql_rank = "SELECT DISTINCT sfaastus,sfaadocno,'',sfaa001,sfaadocdt,sfaa002,'',sfaa003,sfaa057,sfaa004,DENSE_RANK() OVER(ORDER BY sfaadocno ",g_order,") AS RANK ",
                        " FROM sfaa_t ",
                              " LEFT JOIN sfab_t ON sfabent = sfaaent AND sfabsite = sfaasite AND sfabdocno = sfaadocno ",
                              " LEFT JOIN sfac_t ON sfacent = sfaaent AND sfacsite = sfaasite AND sfacdocno = sfaadocno ",
                              " LEFT JOIN sfad_t ON sfadent = sfaaent AND sfadsite = sfaasite AND sfaddocno = sfaadocno ",
                              " LEFT JOIN sfae_t ON sfaeent = sfaaent AND sfaesite = sfaasite AND sfaedocno = sfaadocno ",
                              " LEFT JOIN sfaf_t ON sfafent = sfaaent AND sfafsite = sfaasite AND sfafdocno = sfaadocno ",
                              " LEFT JOIN sfba_t ON sfbaent = sfaaent AND sfbasite = sfaasite AND sfbadocno = sfaadocno ",
                              " LEFT JOIN ooff_t ON ooffent = sfaaent AND ooff002  = sfaadocno AND ooff001 = '6' AND ooff012 = '2'",
                       " WHERE sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND ",g_wc," AND ",g_wc2
   ELSE
      #單身無輸入資料
      LET l_sql_rank = "SELECT DISTINCT sfaastus,sfaadocno,'',sfaa001,sfaadocdt,sfaa002,'',sfaa003,sfaa057,sfaa004,DENSE_RANK() OVER(ORDER BY sfaadocno ",g_order,") AS RANK ",
                       " FROM sfaa_t ",
                              " LEFT JOIN sfab_t ON sfabent = sfaaent AND sfabsite = sfaasite AND sfabdocno = sfaadocno ",
                              " LEFT JOIN sfac_t ON sfacent = sfaaent AND sfacsite = sfaasite AND sfacdocno = sfaadocno ",
                              " LEFT JOIN sfad_t ON sfadent = sfaaent AND sfadsite = sfaasite AND sfaddocno = sfaadocno ",
                              " LEFT JOIN sfae_t ON sfaeent = sfaaent AND sfaesite = sfaasite AND sfaedocno = sfaadocno ",
                              " LEFT JOIN sfaf_t ON sfafent = sfaaent AND sfafsite = sfaasite AND sfafdocno = sfaadocno ",
                              " LEFT JOIN ooff_t ON ooffent = sfaaent AND ooff002  = sfaadocno AND ooff001 = '6' AND ooff012 = '2'",
                       " WHERE sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND ", g_wc
   END IF

   #定義翻頁CURSOR
   LET g_sql= "SELECT sfaastus,sfaadocno,'',sfaa001,sfaadocdt,sfaa002,'',sfaa003,sfaa057,sfaa004 FROM (",l_sql_rank,") WHERE ",
              " RANK >= ",1," AND RANK<",1+g_max_browse,
              " ORDER BY ",l_searchcol," ",g_order

   #add-point:browser_fill,before_prepare
   
   #end add-point

   PREPARE browse_pre FROM g_sql
   DECLARE browse_cur CURSOR FOR browse_pre

   CALL g_browser.clear()
   LET g_cnt = 1
   FOREACH browse_cur INTO g_browser[g_cnt].b_statepic,g_browser[g_cnt].b_sfaadocno,g_browser[g_cnt].b_sfaadocno_desc,g_browser[g_cnt].b_sfaa001,g_browser[g_cnt].b_sfaadocdt,g_browser[g_cnt].b_sfaa002,g_browser[g_cnt].b_sfaa002_desc,g_browser[g_cnt].b_sfaa003,g_browser[g_cnt].b_sfaa057,g_browser[g_cnt].b_sfaa004#,g_browser[g_cnt].rank
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = 'foreach:'
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF



      #add-point:browser_fill段reference
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_browser[g_cnt].b_sfaa002
      CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ", "") RETURNING g_rtn_fields
      LET g_browser[g_cnt].b_sfaa002_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_browser[g_cnt].b_sfaa002_desc
      
      CALL s_aooi200_get_slip(g_browser[g_cnt].b_sfaadocno) RETURNING l_success,l_slip
      CALL s_aooi200_get_slip_desc(l_slip)
        RETURNING g_browser[g_cnt].b_sfaadocno_desc
      DISPLAY BY NAME g_browser[g_cnt].b_sfaadocno_desc
      
      SELECT sfaa010,imaal003,imaal004,sfaa012 
        INTO g_browser[g_cnt].b_sfaa010,g_browser[g_cnt].b_sfaa010_desc,g_browser[g_cnt].b_sfaa010_desc_1,g_browser[g_cnt].b_sfaa012 
        FROM sfaa_t LEFT OUTER JOIN imaal_t ON sfaaent = imaalent AND sfaa010 = imaal001 AND imaal002 = g_lang
       WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_browser[g_cnt].b_sfaadocno
      #end add-point

            #此段落由子樣板a24產生
      CASE g_browser[g_cnt].b_statepic
         WHEN "C"
            LET g_browser[g_cnt].b_statepic = "stus/16/closed.png"
         WHEN "D"
            LET g_browser[g_cnt].b_statepic = "stus/16/withdraw.png"

         WHEN "E"
            LET g_browser[g_cnt].b_statepic = "stus/16/closed_irregular.png"

         WHEN "F"
            LET g_browser[g_cnt].b_statepic = "stus/16/released.png"

         WHEN "M"
            LET g_browser[g_cnt].b_statepic = "stus/16/costing_closed.png"

         WHEN "N"
            LET g_browser[g_cnt].b_statepic = "stus/16/open.png"

         WHEN "R"
            LET g_browser[g_cnt].b_statepic = "stus/16/rejection.png"

         WHEN "W"
            LET g_browser[g_cnt].b_statepic = "stus/16/signing.png"

         WHEN "X"
            LET g_browser[g_cnt].b_statepic = "stus/16/invalid.png"

         WHEN "Y"
            LET g_browser[g_cnt].b_statepic = "stus/16/confirmed.png"


		 #此段落由子樣板a33產生
         WHEN "W"
            LET g_browser[g_cnt].b_statepic = "stus/16/signing.png"
         WHEN "A"
            LET g_browser[g_cnt].b_statepic = "stus/16/approved.png"
         WHEN "D"
            LET g_browser[g_cnt].b_statepic = "stus/16/draw_out.png"
         WHEN "R"
            LET g_browser[g_cnt].b_statepic = "stus/16/rejection.png"


      END CASE


      LET g_cnt = g_cnt + 1
      IF g_cnt > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 9035
         LET g_errparam.extend = ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF

   END FOREACH

   CALL g_browser.deleteElement(g_cnt)
   LET g_header_cnt = g_browser.getLength()

   LET g_rec_b = g_cnt - 1
   LET g_detail_cnt = g_rec_b
   LET g_cnt = 0

   FREE browse_pre

   #add-point:browser_fill段結束前
   
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_ui_headershow" order="5" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_ui_headershow()
   #add-point:ui_headershow段define
   
   #end add-point

   LET g_sfaa_m.sfaadocno = g_browser[g_current_idx].b_sfaadocno

    SELECT UNIQUE sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa009,sfaa022,sfaa023,sfaa024,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,'',sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt
 INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt
 FROM sfaa_t
 WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
   CALL asft300_show()

END FUNCTION]]>
  </point>
  <point name="function.asft300_ui_detailshow" order="6" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_ui_detailshow()
   #add-point:ui_detailshow段define
   
   #end add-point

   #add-point:ui_detailshow段before
   
   #end add-point

   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail1",g_detail_idx)

   END IF

   #add-point:ui_detailshow段after
   
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_ui_browser_refresh" order="7" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_ui_browser_refresh()
   {<Local define>}
   DEFINE l_i  LIKE type_t.num10
   {</Local define>}
   #add-point:ui_browser_refresh段define
   
   #end add-point

   FOR l_i =1 TO g_browser.getLength()
      IF g_browser[l_i].b_sfaadocno = g_sfaa_m.sfaadocno

         THEN
         CALL g_browser.deleteElement(l_i)
         LET g_header_cnt = g_header_cnt - 1
      END IF
   END FOR

   LET g_browser_cnt = g_browser_cnt - 1
   IF g_current_row > g_browser_cnt THEN        #確定browse 筆數指在同一筆
      LET g_current_row = g_browser_cnt
   END IF

   #DISPLAY g_browser_cnt TO FORMONLY.b_count    #總筆數的顯示

END FUNCTION]]>
  </point>
  <point name="function.asft300_construct" order="8" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_construct()
   {<Local define>}
   DEFINE lc_qbe_sn   LIKE type_t.num10
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING
   DEFINE ls_wc       STRING
   {</Local define>}
   #add-point:cs段define
   
   #end add-point

   #清除畫面
   CLEAR FORM
   INITIALIZE g_sfaa_m.* TO NULL
   CALL g_sfba_d.clear()


   LET g_action_choice = ""

   INITIALIZE g_wc TO NULL
   INITIALIZE g_wc2 TO NULL

   INITIALIZE g_wc2_table1 TO NULL


   LET g_qryparam.state = 'c'

   #add-point:cs段開始前
   
   #end add-point

   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)

      #單頭
      CONSTRUCT BY NAME g_wc ON sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfabseq,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006,sfacseq,sfac002,sfac001,sfac006,sfac003,sfac004,sfac005,sfadseq,sfad001,sfad002,sfad003,sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,sfae006,sfafseq,sfaf001,ooff013,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt

         BEFORE CONSTRUCT
           # CALL cl_qbe_init()
            #add-point:cs段before_construct
            
            #end add-point

         #公用欄位開窗相關處理
         #此段落由子樣板a11產生
         ##----<<sfaaownid>>----
         #ON ACTION controlp INFIELD sfaaownid
         #   CALL q_common('sfaa_t','sfaaownid',TRUE,FALSE,g_sfaa_m.sfaaownid) RETURNING ls_return
         #   DISPLAY ls_return TO sfaaownid
         #   NEXT FIELD sfaaownid
         #
         ##----<<sfaaowndp>>----
         #ON ACTION controlp INFIELD sfaaowndp
         #   CALL q_common('sfaa_t','sfaaowndp',TRUE,FALSE,g_sfaa_m.sfaaowndp) RETURNING ls_return
         #   DISPLAY ls_return TO sfaaowndp
         #   NEXT FIELD sfaaowndp
         #
         ##----<<sfaacrtid>>----
         #ON ACTION controlp INFIELD sfaacrtid
         #   CALL q_common('sfaa_t','sfaacrtid',TRUE,FALSE,g_sfaa_m.sfaacrtid) RETURNING ls_return
         #   DISPLAY ls_return TO sfaacrtid
         #   NEXT FIELD sfaacrtid
         #
         ##----<<sfaacrtdp>>----
         #ON ACTION controlp INFIELD sfaacrtdp
         #   CALL q_common('sfaa_t','sfaacrtdp',TRUE,FALSE,g_sfaa_m.sfaacrtdp) RETURNING ls_return
         #   DISPLAY ls_return TO sfaacrtdp
         #   NEXT FIELD sfaacrtdp
         #
         ##----<<sfaamodid>>----
         #ON ACTION controlp INFIELD sfaamodid
         #   CALL q_common('sfaa_t','sfaamodid',TRUE,FALSE,g_sfaa_m.sfaamodid) RETURNING ls_return
         #   DISPLAY ls_return TO sfaamodid
         #   NEXT FIELD sfaamodid
         #
         ##----<<sfaacnfid>>----
         #ON ACTION controlp INFIELD sfaacnfid
         #   CALL q_common('sfaa_t','sfaacnfid',TRUE,FALSE,g_sfaa_m.sfaacnfid) RETURNING ls_return
         #   DISPLAY ls_return TO sfaacnfid
         #   NEXT FIELD sfaacnfid
         #
         ##----<<sfaapstid>>----
         #ON ACTION controlp INFIELD sfaapstid
         #   CALL q_common('sfaa_t','sfaapstid',TRUE,FALSE,g_sfaa_m.sfaapstid) RETURNING ls_return
         #   DISPLAY ls_return TO sfaapstid
         #   NEXT FIELD sfaapstid

         ##----<<sfaacrtdt>>----
         AFTER FIELD sfaacrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)

         #----<<sfaamoddt>>----
         AFTER FIELD sfaamoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)

         #----<<sfaacnfdt>>----
         AFTER FIELD sfaacnfdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)

         #----<<sfaapstdt>>----
         AFTER FIELD sfaapstdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)



         #一般欄位開窗相關處理
         #---------------------------<  Master  >---------------------------
         #----<<sfaadocno>>----
         #Ctrlp:construct.c.sfaadocno
         ON ACTION controlp INFIELD sfaadocno
            #add-point:ON ACTION controlp INFIELD sfaadocno
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaadocno_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaadocno  #顯示到畫面上

            NEXT FIELD sfaadocno                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaadocno
            #add-point:BEFORE FIELD sfaadocno
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaadocno

            #add-point:AFTER FIELD sfaadocno
            
            #END add-point


         #----<<sfaa001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa001
            #add-point:BEFORE FIELD sfaa001
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa001

            #add-point:AFTER FIELD sfaa001
            
            #END add-point


         #Ctrlp:construct.c.sfaa001
#         ON ACTION controlp INFIELD sfaa001
            #add-point:ON ACTION controlp INFIELD sfaa001
            
            #END add-point

         #----<<sfaadocdt>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaadocdt
            #add-point:BEFORE FIELD sfaadocdt
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaadocdt

            #add-point:AFTER FIELD sfaadocdt
            
            #END add-point


         #Ctrlp:construct.c.sfaadocdt
#         ON ACTION controlp INFIELD sfaadocdt
            #add-point:ON ACTION controlp INFIELD sfaadocdt
            
            #END add-point

         #----<<sfaa003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa003
            #add-point:BEFORE FIELD sfaa003
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa003

            #add-point:AFTER FIELD sfaa003
            
            #END add-point


         #Ctrlp:construct.c.sfaa003
#         ON ACTION controlp INFIELD sfaa003
            #add-point:ON ACTION controlp INFIELD sfaa003
            
            #END add-point

         #----<<sfaa057>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa057
            #add-point:BEFORE FIELD sfaa057
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa057

            #add-point:AFTER FIELD sfaa057
            
            #END add-point


         #Ctrlp:construct.c.sfaa057
#         ON ACTION controlp INFIELD sfaa057
            #add-point:ON ACTION controlp INFIELD sfaa057
            
            #END add-point

         #----<<sfaa002>>----
         #Ctrlp:construct.c.sfaa002
         ON ACTION controlp INFIELD sfaa002
            #add-point:ON ACTION controlp INFIELD sfaa002
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa002  #顯示到畫面上

            NEXT FIELD sfaa002                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaa002
            #add-point:BEFORE FIELD sfaa002
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa002

            #add-point:AFTER FIELD sfaa002
            
            #END add-point


         #----<<sfaa004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa004
            #add-point:BEFORE FIELD sfaa004
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa004

            #add-point:AFTER FIELD sfaa004
            
            #END add-point


         #Ctrlp:construct.c.sfaa004
#         ON ACTION controlp INFIELD sfaa004
            #add-point:ON ACTION controlp INFIELD sfaa004
            
            #END add-point

         #----<<sfaastus>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaastus
            #add-point:BEFORE FIELD sfaastus
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaastus

            #add-point:AFTER FIELD sfaastus
            
            #END add-point


         #Ctrlp:construct.c.sfaastus
#         ON ACTION controlp INFIELD sfaastus
            #add-point:ON ACTION controlp INFIELD sfaastus
            
            #END add-point

         #----<<sfaa005>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa005
            #add-point:BEFORE FIELD sfaa005
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa005

            #add-point:AFTER FIELD sfaa005
            
            #END add-point


         #Ctrlp:construct.c.sfaa005
         ON ACTION controlp INFIELD sfaa006
            #add-point:ON ACTION controlp INFIELD sfaa005
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa006()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa006      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa007      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa008      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa063      #顯示到畫面上
            NEXT FIELD sfaa006                         #返回原欄位
            #END add-point

         #----<<sfaa006>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa006
            #add-point:BEFORE FIELD sfaa006
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa006

            #add-point:AFTER FIELD sfaa006
            
            #END add-point



         #----<<sfaa007>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa007
            #add-point:BEFORE FIELD sfaa007
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa007

            #add-point:AFTER FIELD sfaa007
            
            #END add-point


         #Ctrlp:construct.c.sfaa007
         ON ACTION controlp INFIELD sfaa007
            #add-point:ON ACTION controlp INFIELD sfaa007
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa006()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa006      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa007      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa008      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa063      #顯示到畫面上
            NEXT FIELD sfaa007                         #返回原欄位
            #END add-point

         #----<<sfaa008>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa008
            #add-point:BEFORE FIELD sfaa008
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa008

            #add-point:AFTER FIELD sfaa008
            
            #END add-point


         #Ctrlp:construct.c.sfaa008
         ON ACTION controlp INFIELD sfaa008
            #add-point:ON ACTION controlp INFIELD sfaa008
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa006()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa006      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa007      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa008      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa063      #顯示到畫面上
            NEXT FIELD sfaa008                         #返回原欄位                
            #END add-point
            
         ON ACTION controlp INFIELD sfaa063
            #add-point:ON ACTION controlp INFIELD sfaa008
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa006()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa006      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa007      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa008      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa063      #顯示到畫面上
            NEXT FIELD sfaa063                         #返回原欄位 

         #----<<sfaa009>>----
         #Ctrlp:construct.c.sfaa009
         ON ACTION controlp INFIELD sfaa009
            #add-point:ON ACTION controlp INFIELD sfaa009
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			   LET g_qryparam.arg1 = g_site
            CALL q_pmaa001_6()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa009  #顯示到畫面上

            NEXT FIELD sfaa009                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaa009
            #add-point:BEFORE FIELD sfaa009
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa009

            #add-point:AFTER FIELD sfaa009
            
            #END add-point


         #----<<sfaa022>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa022
            #add-point:BEFORE FIELD sfaa022
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa022

            #add-point:AFTER FIELD sfaa022
            
            #END add-point


         #Ctrlp:construct.c.sfaa022
         ON ACTION controlp INFIELD sfaa022
            #add-point:ON ACTION controlp INFIELD sfaa022
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa022()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa022      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa023      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa024      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa064      #顯示到畫面上
            NEXT FIELD sfaa022                         #返回原欄位 
            #END add-point

         #----<<sfaa023>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa023
            #add-point:BEFORE FIELD sfaa023
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa023

            #add-point:AFTER FIELD sfaa023
            
            #END add-point


         #Ctrlp:construct.c.sfaa023
         ON ACTION controlp INFIELD sfaa023
            #add-point:ON ACTION controlp INFIELD sfaa023
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa022()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa022      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa023      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa024      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa064      #顯示到畫面上
            NEXT FIELD sfaa023                         #返回原欄位             
            #END add-point

         #----<<sfaa024>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa024
            #add-point:BEFORE FIELD sfaa024
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa024

            #add-point:AFTER FIELD sfaa024
            
            #END add-point


         #Ctrlp:construct.c.sfaa024
         ON ACTION controlp INFIELD sfaa024
            #add-point:ON ACTION controlp INFIELD sfaa024
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa022()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa022      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa023      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa024      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa064      #顯示到畫面上
            NEXT FIELD sfaa024                         #返回原欄位             
            #END add-point
         
         ON ACTION controlp INFIELD sfaa064
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa022()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa022      #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfaa023      #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfaa024      #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfaa064      #顯示到畫面上
            NEXT FIELD sfaa064                         #返回原欄位 
            
         #----<<sfaa021>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa021
            #add-point:BEFORE FIELD sfaa021
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa021

            #add-point:AFTER FIELD sfaa021
            
            #END add-point


         #Ctrlp:construct.c.sfaa021
         ON ACTION controlp INFIELD sfaa021
            #add-point:ON ACTION controlp INFIELD sfaa021
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa021()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa021      #顯示到畫面上
            NEXT FIELD sfaa021                         #返回原欄位             
            #END add-point

         #----<<sfaa025>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa025
            #add-point:BEFORE FIELD sfaa025
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa025

            #add-point:AFTER FIELD sfaa025
            
            #END add-point


         #Ctrlp:construct.c.sfaa025
         ON ACTION controlp INFIELD sfaa025
            #add-point:ON ACTION controlp INFIELD sfaa025
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaa025()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa025      #顯示到畫面上
            NEXT FIELD sfaa025                         #返回原欄位             
            #END add-point

         #----<<sfaa010>>----
         #Ctrlp:construct.c.sfaa010
         ON ACTION controlp INFIELD sfaa010
            #add-point:ON ACTION controlp INFIELD sfaa010
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_imaa001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa010  #顯示到畫面上

            NEXT FIELD sfaa010                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaa010
            #add-point:BEFORE FIELD sfaa010
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa010

            #add-point:AFTER FIELD sfaa010
            
            #END add-point


         #----<<sfaa011>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa011
            #add-point:BEFORE FIELD sfaa011
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa011

            #add-point:AFTER FIELD sfaa011
            
            #END add-point


         #Ctrlp:construct.c.sfaa011
#         ON ACTION controlp INFIELD sfaa011
            #add-point:ON ACTION controlp INFIELD sfaa011
            
            #END add-point

         #----<<sfaa012>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa012
            #add-point:BEFORE FIELD sfaa012
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa012

            #add-point:AFTER FIELD sfaa012
            
            #END add-point


         #Ctrlp:construct.c.sfaa012
#         ON ACTION controlp INFIELD sfaa012
            #add-point:ON ACTION controlp INFIELD sfaa012
            
            #END add-point

         #----<<sfaa013>>----
         #Ctrlp:construct.c.sfaa013
         ON ACTION controlp INFIELD sfaa013
            #add-point:ON ACTION controlp INFIELD sfaa013
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa013  #顯示到畫面上

            NEXT FIELD sfaa013                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaa013
            #add-point:BEFORE FIELD sfaa013
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa013

            #add-point:AFTER FIELD sfaa013
            
            #END add-point


         #----<<sfaa058>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa058
            #add-point:BEFORE FIELD sfaa058
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa058

            #add-point:AFTER FIELD sfaa058
            
            #END add-point


         #Ctrlp:construct.c.sfaa058
#         ON ACTION controlp INFIELD sfaa058
            #add-point:ON ACTION controlp INFIELD sfaa058
            
            #END add-point

         #----<<sfaa060>>----
         #Ctrlp:construct.c.sfaa060
         ON ACTION controlp INFIELD sfaa060
            #add-point:ON ACTION controlp INFIELD sfaa060
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa060  #顯示到畫面上

            NEXT FIELD sfaa060                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaa060
            #add-point:BEFORE FIELD sfaa060
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa060

            #add-point:AFTER FIELD sfaa060
            
            #END add-point


         #----<<sfaa061>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa061
            #add-point:BEFORE FIELD sfaa061
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa061

            #add-point:AFTER FIELD sfaa061
            
            #END add-point


         #Ctrlp:construct.c.sfaa061
#         ON ACTION controlp INFIELD sfaa061
            #add-point:ON ACTION controlp INFIELD sfaa061
            
            #END add-point

         #----<<sfaa016>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa016
            #add-point:BEFORE FIELD sfaa016
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa016

            #add-point:AFTER FIELD sfaa016
            
            #END add-point


         #Ctrlp:construct.c.sfaa016
         ON ACTION controlp INFIELD sfaa016
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ecba002()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa016  #顯示到畫面上
            NEXT FIELD sfaa016                     #返回原欄位

         #----<<sfaa017>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa017
            #add-point:BEFORE FIELD sfaa017
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa017

            #add-point:AFTER FIELD sfaa017
            
            #END add-point


         #Ctrlp:construct.c.sfaa017
         ON ACTION controlp INFIELD sfaa017
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa017  #顯示到畫面上
            NEXT FIELD sfaa017                     #返回原欄位

         #----<<sfaa018>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa018
            #add-point:BEFORE FIELD sfaa018
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa018

            #add-point:AFTER FIELD sfaa018
            
            #END add-point


         #Ctrlp:construct.c.sfaa018
         ON ACTION controlp INFIELD sfaa018
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooef001()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa018  #顯示到畫面上
            NEXT FIELD sfaa018                     #返回原欄位

         #----<<sfaa019>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa019
            #add-point:BEFORE FIELD sfaa019
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa019

            #add-point:AFTER FIELD sfaa019
            
            #END add-point


         #Ctrlp:construct.c.sfaa019
#         ON ACTION controlp INFIELD sfaa019
            #add-point:ON ACTION controlp INFIELD sfaa019
            
            #END add-point

         #----<<sfaa020>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa020
            #add-point:BEFORE FIELD sfaa020
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa020

            #add-point:AFTER FIELD sfaa020
            
            #END add-point


         #Ctrlp:construct.c.sfaa020
#         ON ACTION controlp INFIELD sfaa020
            #add-point:ON ACTION controlp INFIELD sfaa020
            
            #END add-point

         #----<<sfaa014>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa014
            #add-point:BEFORE FIELD sfaa014
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa014

            #add-point:AFTER FIELD sfaa014
            
            #END add-point


         #Ctrlp:construct.c.sfaa014
#         ON ACTION controlp INFIELD sfaa014
            #add-point:ON ACTION controlp INFIELD sfaa014
            
            #END add-point

         #----<<sfaa028>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa028
            #add-point:BEFORE FIELD sfaa028
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa028

            #add-point:AFTER FIELD sfaa028
            
            #END add-point


         #Ctrlp:construct.c.sfaa028
         ON ACTION controlp INFIELD sfaa028
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pjba001()                         #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa028  #顯示到畫面上
            NEXT FIELD sfaa028                     #返回原欄位

         #----<<sfaa015>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa015
            #add-point:BEFORE FIELD sfaa015
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa015

            #add-point:AFTER FIELD sfaa015
            
            #END add-point


         #Ctrlp:construct.c.sfaa015
#         ON ACTION controlp INFIELD sfaa015
            #add-point:ON ACTION controlp INFIELD sfaa015
            
            #END add-point

         #----<<sfaa029>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa029
            #add-point:BEFORE FIELD sfaa029
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa029

            #add-point:AFTER FIELD sfaa029
            
            #END add-point


         #Ctrlp:construct.c.sfaa029
         ON ACTION controlp INFIELD sfaa029
                        #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_pjbb002()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa029  #顯示到畫面上
            NEXT FIELD sfaa029                     #返回原欄位

         #----<<sfaa026>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa026
            #add-point:BEFORE FIELD sfaa026
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa026

            #add-point:AFTER FIELD sfaa026
            
            #END add-point


         #Ctrlp:construct.c.sfaa026
#         ON ACTION controlp INFIELD sfaa026
            #add-point:ON ACTION controlp INFIELD sfaa026
            
            #END add-point

         #----<<sfaa030>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa030
            #add-point:BEFORE FIELD sfaa030
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa030

            #add-point:AFTER FIELD sfaa030
            
            #END add-point


         #Ctrlp:construct.c.sfaa030
         ON ACTION controlp INFIELD sfaa030
            #add-point:ON ACTION controlp INFIELD sfaa030
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
			   CALL q_pjbm002()  #modify by lixiang 2015/06/17
            #CALL q_pjbm01()                            #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa030  #顯示到畫面上
            NEXT FIELD sfaa030                     #返回原欄位            
            #END add-point

         #----<<sfaa031>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa031
            #add-point:BEFORE FIELD sfaa031
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa031

            #add-point:AFTER FIELD sfaa031
            
            #END add-point


         #Ctrlp:construct.c.sfaa031
         ON ACTION controlp INFIELD sfaa031
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = '225'
            CALL q_oocq002()                         #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa031  #顯示到畫面上
            NEXT FIELD sfaa031                     #返回原欄位

         #----<<sfaa062>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa062
            #add-point:BEFORE FIELD sfaa062
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa062

            #add-point:AFTER FIELD sfaa062
            
            #END add-point


         #Ctrlp:construct.c.sfaa062
#         ON ACTION controlp INFIELD sfaa062
            #add-point:ON ACTION controlp INFIELD sfaa062
            
            #END add-point

         #----<<sfaa032>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa032
            #add-point:BEFORE FIELD sfaa032
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa032

            #add-point:AFTER FIELD sfaa032
            
            #END add-point


         #Ctrlp:construct.c.sfaa032
#         ON ACTION controlp INFIELD sfaa032
            #add-point:ON ACTION controlp INFIELD sfaa032
            
            #END add-point

         ON ACTION controlp INFIELD sfaa068
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = cl_get_today()
            CALL q_ooeg001_8()                        #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa068  #顯示到畫面上
            NEXT FIELD sfaa068                     #返回原欄位
            
         #----<<sfaa033>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa033
            #add-point:BEFORE FIELD sfaa033
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa033

            #add-point:AFTER FIELD sfaa033
            
            #END add-point


         #Ctrlp:construct.c.sfaa033
#         ON ACTION controlp INFIELD sfaa033
            #add-point:ON ACTION controlp INFIELD sfaa033
            
            #END add-point

         #----<<sfaa034>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa034
            #add-point:BEFORE FIELD sfaa034
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa034

            #add-point:AFTER FIELD sfaa034
            
            #END add-point


         #Ctrlp:construct.c.sfaa034
         ON ACTION controlp INFIELD sfaa034
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_inaa001_2()                         #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa034  #顯示到畫面上
            NEXT FIELD sfaa034                     #返回原欄位

         #----<<sfaa035>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa035
            #add-point:BEFORE FIELD sfaa035
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa035

            #add-point:AFTER FIELD sfaa035
            
            #END add-point


         #Ctrlp:construct.c.sfaa035
         ON ACTION controlp INFIELD sfaa035
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_inab002_2()                        #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaa035  #顯示到畫面上
            NEXT FIELD sfaa035                     #返回原欄位

         #----<<sfaa059>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa059
            #add-point:BEFORE FIELD sfaa059
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa059

            #add-point:AFTER FIELD sfaa059
            
            #END add-point


         #Ctrlp:construct.c.sfaa059
#         ON ACTION controlp INFIELD sfaa059
            #add-point:ON ACTION controlp INFIELD sfaa059
            
            #END add-point

         #----<<sfaa036>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa036
            #add-point:BEFORE FIELD sfaa036
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa036

            #add-point:AFTER FIELD sfaa036
            
            #END add-point


         #Ctrlp:construct.c.sfaa036
#         ON ACTION controlp INFIELD sfaa036
            #add-point:ON ACTION controlp INFIELD sfaa036
            
            #END add-point

         #----<<sfaa037>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa037
            #add-point:BEFORE FIELD sfaa037
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa037

            #add-point:AFTER FIELD sfaa037
            
            #END add-point


         #Ctrlp:construct.c.sfaa037
#         ON ACTION controlp INFIELD sfaa037
            #add-point:ON ACTION controlp INFIELD sfaa037
            
            #END add-point

         #----<<sfaa038>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa038
            #add-point:BEFORE FIELD sfaa038
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa038

            #add-point:AFTER FIELD sfaa038
            
            #END add-point


         #Ctrlp:construct.c.sfaa038
#         ON ACTION controlp INFIELD sfaa038
            #add-point:ON ACTION controlp INFIELD sfaa038
            
            #END add-point

         #----<<sfaa039>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa039
            #add-point:BEFORE FIELD sfaa039
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa039

            #add-point:AFTER FIELD sfaa039
            
            #END add-point


         #Ctrlp:construct.c.sfaa039
#         ON ACTION controlp INFIELD sfaa039
            #add-point:ON ACTION controlp INFIELD sfaa039
            
            #END add-point

         #----<<sfaa040>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa040
            #add-point:BEFORE FIELD sfaa040
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa040

            #add-point:AFTER FIELD sfaa040
            
            #END add-point


         #Ctrlp:construct.c.sfaa040
#         ON ACTION controlp INFIELD sfaa040
            #add-point:ON ACTION controlp INFIELD sfaa040
            
            #END add-point

         #----<<sfaa041>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa041
            #add-point:BEFORE FIELD sfaa041
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa041

            #add-point:AFTER FIELD sfaa041
            
            #END add-point


         #Ctrlp:construct.c.sfaa041
#         ON ACTION controlp INFIELD sfaa041
            #add-point:ON ACTION controlp INFIELD sfaa041
            
            #END add-point

         #----<<sfaa042>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa042
            #add-point:BEFORE FIELD sfaa042
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa042

            #add-point:AFTER FIELD sfaa042
            
            #END add-point


         #Ctrlp:construct.c.sfaa042
#         ON ACTION controlp INFIELD sfaa042
            #add-point:ON ACTION controlp INFIELD sfaa042
            
            #END add-point

         #----<<sfaa043>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa043
            #add-point:BEFORE FIELD sfaa043
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa043

            #add-point:AFTER FIELD sfaa043
            
            #END add-point


         #Ctrlp:construct.c.sfaa043
#         ON ACTION controlp INFIELD sfaa043
            #add-point:ON ACTION controlp INFIELD sfaa043
            
            #END add-point

         #----<<sfaa044>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa044
            #add-point:BEFORE FIELD sfaa044
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa044

            #add-point:AFTER FIELD sfaa044
            
            #END add-point


         #Ctrlp:construct.c.sfaa044
#         ON ACTION controlp INFIELD sfaa044
            #add-point:ON ACTION controlp INFIELD sfaa044
            
            #END add-point

         #----<<sfaa045>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa045
            #add-point:BEFORE FIELD sfaa045
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa045

            #add-point:AFTER FIELD sfaa045
            
            #END add-point


         #Ctrlp:construct.c.sfaa045
#         ON ACTION controlp INFIELD sfaa045
            #add-point:ON ACTION controlp INFIELD sfaa045
            
            #END add-point

         #----<<sfaa049>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa049
            #add-point:BEFORE FIELD sfaa049
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa049

            #add-point:AFTER FIELD sfaa049
            
            #END add-point


         #Ctrlp:construct.c.sfaa049
#         ON ACTION controlp INFIELD sfaa049
            #add-point:ON ACTION controlp INFIELD sfaa049
            
            #END add-point

         #----<<sfaa046>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa046
            #add-point:BEFORE FIELD sfaa046
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa046

            #add-point:AFTER FIELD sfaa046
            
            #END add-point


         #Ctrlp:construct.c.sfaa046
#         ON ACTION controlp INFIELD sfaa046
            #add-point:ON ACTION controlp INFIELD sfaa046
            
            #END add-point

         #----<<sfaa050>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa050
            #add-point:BEFORE FIELD sfaa050
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa050

            #add-point:AFTER FIELD sfaa050
            
            #END add-point


         #Ctrlp:construct.c.sfaa050
#         ON ACTION controlp INFIELD sfaa050
            #add-point:ON ACTION controlp INFIELD sfaa050
            
            #END add-point

         #----<<sfaa047>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa047
            #add-point:BEFORE FIELD sfaa047
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa047

            #add-point:AFTER FIELD sfaa047
            
            #END add-point


         #Ctrlp:construct.c.sfaa047
#         ON ACTION controlp INFIELD sfaa047
            #add-point:ON ACTION controlp INFIELD sfaa047
            
            #END add-point

         #----<<sfaa051>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa051
            #add-point:BEFORE FIELD sfaa051
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa051

            #add-point:AFTER FIELD sfaa051
            
            #END add-point


         #Ctrlp:construct.c.sfaa051
#         ON ACTION controlp INFIELD sfaa051
            #add-point:ON ACTION controlp INFIELD sfaa051
            
            #END add-point

         #----<<sfaa048>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa048
            #add-point:BEFORE FIELD sfaa048
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa048

            #add-point:AFTER FIELD sfaa048
            
            #END add-point


         #Ctrlp:construct.c.sfaa048
#         ON ACTION controlp INFIELD sfaa048
            #add-point:ON ACTION controlp INFIELD sfaa048
            
            #END add-point

         #----<<sfaa055>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa055
            #add-point:BEFORE FIELD sfaa055
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa055

            #add-point:AFTER FIELD sfaa055
            
            #END add-point


         #Ctrlp:construct.c.sfaa055
#         ON ACTION controlp INFIELD sfaa055
            #add-point:ON ACTION controlp INFIELD sfaa055
            
            #END add-point

         #----<<sfaa056>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa056
            #add-point:BEFORE FIELD sfaa056
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa056

            #add-point:AFTER FIELD sfaa056
            
            #END add-point


         #Ctrlp:construct.c.sfaa056
#         ON ACTION controlp INFIELD sfaa056
            #add-point:ON ACTION controlp INFIELD sfaa056
            
            #END add-point

         #----<<ooff013>>----
         #此段落由子樣板a01產生
       #  BEFORE FIELD ooff013
            #add-point:BEFORE FIELD ooff013
            
            #END add-point

         #此段落由子樣板a02產生
       #  AFTER FIELD ooff013

            #add-point:AFTER FIELD ooff013
            
            #END add-point


         #Ctrlp:construct.c.ooff013
#         ON ACTION controlp INFIELD ooff013
            #add-point:ON ACTION controlp INFIELD ooff013
            
            #END add-point

         #----<<sfaaownid>>----
         #Ctrlp:construct.c.sfaaownid
         ON ACTION controlp INFIELD sfaaownid
            #add-point:ON ACTION controlp INFIELD sfaaownid
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaaownid  #顯示到畫面上

            NEXT FIELD sfaaownid                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaaownid
            #add-point:BEFORE FIELD sfaaownid
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaaownid

            #add-point:AFTER FIELD sfaaownid
            
            #END add-point


         #----<<sfaaowndp>>----
         #Ctrlp:construct.c.sfaaowndp
         ON ACTION controlp INFIELD sfaaowndp
            #add-point:ON ACTION controlp INFIELD sfaaowndp
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaaowndp  #顯示到畫面上

            NEXT FIELD sfaaowndp                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaaowndp
            #add-point:BEFORE FIELD sfaaowndp
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaaowndp

            #add-point:AFTER FIELD sfaaowndp
            
            #END add-point


         #----<<sfaacrtid>>----
         #Ctrlp:construct.c.sfaacrtid
         ON ACTION controlp INFIELD sfaacrtid
            #add-point:ON ACTION controlp INFIELD sfaacrtid
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaacrtid  #顯示到畫面上

            NEXT FIELD sfaacrtid                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaacrtid
            #add-point:BEFORE FIELD sfaacrtid
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaacrtid

            #add-point:AFTER FIELD sfaacrtid
            
            #END add-point


         #----<<sfaacrtdp>>----
         #Ctrlp:construct.c.sfaacrtdp
         ON ACTION controlp INFIELD sfaacrtdp
            #add-point:ON ACTION controlp INFIELD sfaacrtdp
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaacrtdp  #顯示到畫面上

            NEXT FIELD sfaacrtdp                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaacrtdp
            #add-point:BEFORE FIELD sfaacrtdp
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaacrtdp

            #add-point:AFTER FIELD sfaacrtdp
            
            #END add-point


         #----<<sfaacrtdt>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaacrtdt
            #add-point:BEFORE FIELD sfaacrtdt
            
            #END add-point

         #----<<sfaamodid>>----
         #Ctrlp:construct.c.sfaamodid
         ON ACTION controlp INFIELD sfaamodid
            #add-point:ON ACTION controlp INFIELD sfaamodid
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaamodid  #顯示到畫面上

            NEXT FIELD sfaamodid                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaamodid
            #add-point:BEFORE FIELD sfaamodid
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaamodid

            #add-point:AFTER FIELD sfaamodid
            
            #END add-point


         #----<<sfaamoddt>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaamoddt
            #add-point:BEFORE FIELD sfaamoddt
            
            #END add-point

         #----<<sfaacnfid>>----
         #Ctrlp:construct.c.sfaacnfid
         ON ACTION controlp INFIELD sfaacnfid
            #add-point:ON ACTION controlp INFIELD sfaacnfid
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaacnfid  #顯示到畫面上

            NEXT FIELD sfaacnfid                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaacnfid
            #add-point:BEFORE FIELD sfaacnfid
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaacnfid

            #add-point:AFTER FIELD sfaacnfid
            
            #END add-point


         #----<<sfaacnfdt>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaacnfdt
            #add-point:BEFORE FIELD sfaacnfdt
            
            #END add-point

         #----<<sfaapstid>>----
         #Ctrlp:construct.c.sfaapstid
         ON ACTION controlp INFIELD sfaapstid
            #add-point:ON ACTION controlp INFIELD sfaapstid
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfaapstid  #顯示到畫面上

            NEXT FIELD sfaapstid                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfaapstid
            #add-point:BEFORE FIELD sfaapstid
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaapstid

            #add-point:AFTER FIELD sfaapstid
            
            #END add-point


         #----<<sfaapstdt>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaapstdt
            #add-point:BEFORE FIELD sfaapstdt
            
            #END add-point
          
         ON ACTION controlp INFIELD sfab002
		   	INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_sfab002()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfab002     #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfab003     #顯示到畫面上
            DISPLAY g_qryparam.return3 TO sfab004     #顯示到畫面上
            DISPLAY g_qryparam.return4 TO sfab005     #顯示到畫面上
            NEXT FIELD sfab002                        #返回原欄位  
 
         ON ACTION controlp INFIELD sfac001
		   	INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_sfac001()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfac001     #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfac006     #顯示到畫面上
            NEXT FIELD sfac001                        #返回原欄位  
            
         ON ACTION controlp INFIELD sfac006
		   	INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_sfac001()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfac001     #顯示到畫面上
            DISPLAY g_qryparam.return2 TO sfac006     #顯示到畫面上
            NEXT FIELD sfac006                        #返回原欄位
           
         ON ACTION controlp INFIELD sfac004           
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_ooca001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfac004  #顯示到畫面上

            NEXT FIELD sfac004                    #返回原欄位

      END CONSTRUCT

      #單身根據table分拆construct
      CONSTRUCT g_wc2_table1 ON sfbaseq,sfbaseq1,sfba002,sfba003,sfba004,sfba005,sfba022,sfba006,sfba021,sfba007,sfba008,sfba009,sfba010,sfba011,sfba012,sfba023,sfba024,sfba013,sfba014,sfba015,sfba016,sfba025,sfba017,sfba018,sfba019,sfba020,sfba029,sfba030,sfba028,sfba001,sfba026,sfba027
           FROM s_detail1[1].sfbaseq,s_detail1[1].sfbaseq1,s_detail1[1].sfba002,s_detail1[1].sfba003,s_detail1[1].sfba004,s_detail1[1].sfba005,s_detail1[1].sfba022,s_detail1[1].sfba006,s_detail1[1].sfba021,s_detail1[1].sfba007,s_detail1[1].sfba008,s_detail1[1].sfba009,s_detail1[1].sfba010,s_detail1[1].sfba011,s_detail1[1].sfba012,s_detail1[1].sfba023,s_detail1[1].sfba024,s_detail1[1].sfba013,s_detail1[1].sfba014,s_detail1[1].sfba015,s_detail1[1].sfba016,s_detail1[1].sfba025,s_detail1[1].sfba017,s_detail1[1].sfba018,s_detail1[1].sfba019,s_detail1[1].sfba020,s_detail1[1].sfba029,s_detail1[1].sfba030,s_detail1[1].sfba028,s_detail1[1].sfba001,s_detail1[1].sfba026,s_detail1[1].sfba027

         BEFORE CONSTRUCT
           # CALL cl_qbe_display_condition(lc_qbe_sn)
            #add-point:cs段before_construct
            
            #end add-point

       #單身公用欄位開窗相關處理


       #單身一般欄位開窗相關處理
       #---------------------<  Detail: page1  >---------------------
         #----<<sfbaseq>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfbaseq
            #add-point:BEFORE FIELD sfbaseq
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfbaseq

            #add-point:AFTER FIELD sfbaseq
            
            #END add-point


         #Ctrlp:construct.c.page1.sfbaseq
#         ON ACTION controlp INFIELD sfbaseq
            #add-point:ON ACTION controlp INFIELD sfbaseq
            
            #END add-point

         #----<<sfbaseq1>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfbaseq1
            #add-point:BEFORE FIELD sfbaseq1
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfbaseq1

            #add-point:AFTER FIELD sfbaseq1
            
            #END add-point


         #Ctrlp:construct.c.page1.sfbaseq1
#         ON ACTION controlp INFIELD sfbaseq1
            #add-point:ON ACTION controlp INFIELD sfbaseq1
            
            #END add-point

         #----<<sfba002>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba002
            #add-point:BEFORE FIELD sfba002
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba002

            #add-point:AFTER FIELD sfba002
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba002
         ON ACTION controlp INFIELD sfba002
            #add-point:ON ACTION controlp INFIELD sfba002
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "215" #應用分類
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba002 #顯示到畫面上

            NEXT FIELD sfba002            
            
            #END add-point

         #----<<sfba003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba003
            #add-point:BEFORE FIELD sfba003
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba003

            #add-point:AFTER FIELD sfba003
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba003
         ON ACTION controlp INFIELD sfba003
            #add-point:ON ACTION controlp INFIELD sfba003
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = "221" #應用分類
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba003 #顯示到畫面上

            NEXT FIELD sfba003            
            
            #END add-point

         #----<<sfba004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba004
            #add-point:BEFORE FIELD sfba004
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba004

            #add-point:AFTER FIELD sfba004
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba004
#         ON ACTION controlp INFIELD sfba004
            #add-point:ON ACTION controlp INFIELD sfba004
            
            #END add-point

         #----<<sfba005>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba005
            #add-point:BEFORE FIELD sfba005
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba005

            #add-point:AFTER FIELD sfba005
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba005
         ON ACTION controlp INFIELD sfba005
            #add-point:ON ACTION controlp INFIELD sfba005
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_imaa001_10()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba005 #顯示到畫面上

            NEXT FIELD sfba005            
            
            #END add-point

         #----<<replace>>----
         #此段落由子樣板a01產生
         BEFORE FIELD replace
            #add-point:BEFORE FIELD replace
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD replace

            #add-point:AFTER FIELD replace
            
            #END add-point


         #Ctrlp:construct.c.page1.replace
#         ON ACTION controlp INFIELD replace
            #add-point:ON ACTION controlp INFIELD replace
            
            #END add-point

         #----<<sfba022>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba022
            #add-point:BEFORE FIELD sfba022
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba022

            #add-point:AFTER FIELD sfba022
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba022
#         ON ACTION controlp INFIELD sfba022
            #add-point:ON ACTION controlp INFIELD sfba022
            
            #END add-point

         #----<<sfba006>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba006
            #add-point:BEFORE FIELD sfba006
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba006

            #add-point:AFTER FIELD sfba006
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba006
         ON ACTION controlp INFIELD sfba006
            #add-point:ON ACTION controlp INFIELD sfba006
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_imaa001_10()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba006 #顯示到畫面上

            NEXT FIELD sfba006             
            
            #END add-point

         #----<<imaf013>>----
         #此段落由子樣板a01產生
         BEFORE FIELD imaf013
            #add-point:BEFORE FIELD imaf013
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD imaf013

            #add-point:AFTER FIELD imaf013
            
            #END add-point


         #Ctrlp:construct.c.page1.imaf013
#         ON ACTION controlp INFIELD imaf013
            #add-point:ON ACTION controlp INFIELD imaf013
            
            #END add-point

         #----<<sfba021>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba021
            #add-point:BEFORE FIELD sfba021
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba021

            #add-point:AFTER FIELD sfba021
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba021
         ON ACTION controlp INFIELD sfba021
            #add-point:ON ACTION controlp INFIELD sfba021
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_sfba021()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba021         #顯示到畫面上
            NEXT FIELD sfba021 
            #END add-point

         #----<<sfba007>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba007
            #add-point:BEFORE FIELD sfba007
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba007

            #add-point:AFTER FIELD sfba007
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba007
#         ON ACTION controlp INFIELD sfba007
            #add-point:ON ACTION controlp INFIELD sfba007
            
            #END add-point

         #----<<sfba008>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba008
            #add-point:BEFORE FIELD sfba008
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba008

            #add-point:AFTER FIELD sfba008
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba008
#         ON ACTION controlp INFIELD sfba008
            #add-point:ON ACTION controlp INFIELD sfba008
            
            #END add-point

         #----<<sfba009>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba009
            #add-point:BEFORE FIELD sfba009
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba009

            #add-point:AFTER FIELD sfba009
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba009
#         ON ACTION controlp INFIELD sfba009
            #add-point:ON ACTION controlp INFIELD sfba009
            
            #END add-point

         #----<<sfba010>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba010
            #add-point:BEFORE FIELD sfba010
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba010

            #add-point:AFTER FIELD sfba010
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba010
#         ON ACTION controlp INFIELD sfba010
            #add-point:ON ACTION controlp INFIELD sfba010
            
            #END add-point

         #----<<sfba011>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba011
            #add-point:BEFORE FIELD sfba011
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba011

            #add-point:AFTER FIELD sfba011
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba011
#         ON ACTION controlp INFIELD sfba011
            #add-point:ON ACTION controlp INFIELD sfba011
            
            #END add-point

         #----<<sfba012>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba012
            #add-point:BEFORE FIELD sfba012
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba012

            #add-point:AFTER FIELD sfba012
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba012
#         ON ACTION controlp INFIELD sfba012
            #add-point:ON ACTION controlp INFIELD sfba012
            
            #END add-point

         #----<<sfba023>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba023
            #add-point:BEFORE FIELD sfba023
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba023

            #add-point:AFTER FIELD sfba023
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba023
#         ON ACTION controlp INFIELD sfba023
            #add-point:ON ACTION controlp INFIELD sfba023
            
            #END add-point

         #----<<sfba024>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba024
            #add-point:BEFORE FIELD sfba024
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba024

            #add-point:AFTER FIELD sfba024
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba024
#         ON ACTION controlp INFIELD sfba024
            #add-point:ON ACTION controlp INFIELD sfba024
            
            #END add-point

         #----<<sfba013>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba013
            #add-point:BEFORE FIELD sfba013
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba013

            #add-point:AFTER FIELD sfba013
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba013
#         ON ACTION controlp INFIELD sfba013
            #add-point:ON ACTION controlp INFIELD sfba013
            
            #END add-point

         #----<<sfba014>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba014
            #add-point:BEFORE FIELD sfba014
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba014

            #add-point:AFTER FIELD sfba014
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba014
         ON ACTION controlp INFIELD sfba014
            #add-point:ON ACTION controlp INFIELD sfba014
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba014 #顯示到畫面上

            NEXT FIELD sfba014            
            
            #END add-point

         #----<<sfba015>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba015
            #add-point:BEFORE FIELD sfba015
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba015

            #add-point:AFTER FIELD sfba015
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba015
#         ON ACTION controlp INFIELD sfba015
            #add-point:ON ACTION controlp INFIELD sfba015
            
            #END add-point

         #----<<sfba016>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba016
            #add-point:BEFORE FIELD sfba016
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba016

            #add-point:AFTER FIELD sfba016
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba016
#         ON ACTION controlp INFIELD sfba016
            #add-point:ON ACTION controlp INFIELD sfba016
            
            #END add-point

         #----<<sfba025>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba025
            #add-point:BEFORE FIELD sfba025
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba025

            #add-point:AFTER FIELD sfba025
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba025
#         ON ACTION controlp INFIELD sfba025
            #add-point:ON ACTION controlp INFIELD sfba025
            
            #END add-point

         #----<<number1>>----
         #此段落由子樣板a01產生
         BEFORE FIELD number1
            #add-point:BEFORE FIELD number1
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD number1

            #add-point:AFTER FIELD number1
            
            #END add-point


         #Ctrlp:construct.c.page1.number1
#         ON ACTION controlp INFIELD number1
            #add-point:ON ACTION controlp INFIELD number1
            
            #END add-point

         #----<<number2>>----
         #此段落由子樣板a01產生
         BEFORE FIELD number2
            #add-point:BEFORE FIELD number2
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD number2

            #add-point:AFTER FIELD number2
            
            #END add-point


         #Ctrlp:construct.c.page1.number2
#         ON ACTION controlp INFIELD number2
            #add-point:ON ACTION controlp INFIELD number2
            
            #END add-point

         #----<<sfba017>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba017
            #add-point:BEFORE FIELD sfba017
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba017

            #add-point:AFTER FIELD sfba017
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba017
#         ON ACTION controlp INFIELD sfba017
            #add-point:ON ACTION controlp INFIELD sfba017
            
            #END add-point

         #----<<sfba018>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba018
            #add-point:BEFORE FIELD sfba018
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba018

            #add-point:AFTER FIELD sfba018
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba018
#         ON ACTION controlp INFIELD sfba018
            #add-point:ON ACTION controlp INFIELD sfba018
            
            #END add-point

         #----<<sfba019>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba019
            #add-point:BEFORE FIELD sfba019
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba019

            #add-point:AFTER FIELD sfba019
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba019
         ON ACTION controlp INFIELD sfba019
            #add-point:ON ACTION controlp INFIELD sfba019
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_inaa001_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba019 #顯示到畫面上

            NEXT FIELD sfba019            
            
            #END add-point

         #----<<sfba020>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba020
            #add-point:BEFORE FIELD sfba020
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba020

            #add-point:AFTER FIELD sfba020
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba020
         ON ACTION controlp INFIELD sfba020
            #add-point:ON ACTION controlp INFIELD sfba020
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_sfba_d[l_ac].sfba019
            CALL q_inab002_3()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba020 #顯示到畫面上

            NEXT FIELD sfba020                
            
            #END add-point

         #----<<sfba028>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba028
            #add-point:BEFORE FIELD sfba028
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba028

            #add-point:AFTER FIELD sfba028
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba028
#         ON ACTION controlp INFIELD sfba028
            #add-point:ON ACTION controlp INFIELD sfba028
            
            #END add-point

         #----<<sfba001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba001
            #add-point:BEFORE FIELD sfba001
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba001

            #add-point:AFTER FIELD sfba001
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba001
         ON ACTION controlp INFIELD sfba001
            #add-point:ON ACTION controlp INFIELD sfba001
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_imaa001_10()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO sfba001 #顯示到畫面上

            NEXT FIELD sfba001             
            
            #END add-point

         #----<<sfba026>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba026
            #add-point:BEFORE FIELD sfba026
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba026

            #add-point:AFTER FIELD sfba026
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba026
#         ON ACTION controlp INFIELD sfba026
            #add-point:ON ACTION controlp INFIELD sfba026
            
            #END add-point

         #----<<sfba027>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba027
            #add-point:BEFORE FIELD sfba027
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba027

            #add-point:AFTER FIELD sfba027
            
            #END add-point


         #Ctrlp:construct.c.page1.sfba027
#         ON ACTION controlp INFIELD sfba027
            #add-point:ON ACTION controlp INFIELD sfba027
            
            #END add-point



      END CONSTRUCT





      #add-point:cs段add_cs(本段內只能出現新的CONSTRUCT指令)
      
      #end add-point

      BEFORE DIALOG
         #add-point:cs段b_dialog
         
         #end add-point

      ON ACTION qbe_select     #條件查詢
         LET ls_wc = ''
         CALL cl_qbe_list("c") RETURNING ls_wc

      ON ACTION qbe_save       #條件儲存
         CALL cl_qbe_save()

      ON ACTION accept
         ACCEPT DIALOG

      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG

      #交談指令共用ACTION
      &include "common_action.4gl"
         CONTINUE DIALOG
   END DIALOG

   #組合g_wc2
   LET g_wc2 = g_wc2_table1




   #add-point:cs段結束前
   
   #end add-point

   IF INT_FLAG THEN
      RETURN
   END IF

END FUNCTION]]>
  </point>
  <point name="function.asft300_filter" order="9" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_filter()
   {<Local define>}
   {</Local define>}
   #add-point:filter段define
   
   #end add-point

   #切換畫面
   IF NOT g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",1)
      CALL gfrm_curr.setElementHidden("worksheet",0)
      LET g_main_hidden = 1
   END IF

   LET INT_FLAG = 0

   LET g_qryparam.state = 'c'

   LET g_wc_filter_t = g_wc_filter
   LET g_wc_t = g_wc

   LET g_wc = cl_replace_str(g_wc, g_wc_filter, '')

   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)

      #單頭
      CONSTRUCT g_wc_filter ON sfaadocno,sfaa001,sfaadocdt,sfaa002,sfaa003,sfaa057,sfaa004,sfaa010,sfaa012
                          FROM s_browse[1].b_sfaadocno,s_browse[1].b_sfaa001,s_browse[1].b_sfaadocdt,
                               s_browse[1].b_sfaa002,s_browse[1].b_sfaa003,s_browse[1].b_sfaa057,s_browse[1].b_sfaa004,
                               s_browse[1].b_sfaa010,s_browse[1].b_sfaa012
                               
         BEFORE CONSTRUCT
            CALL cl_qbe_init()
               DISPLAY asft300_filter_parser('sfaadocno') TO s_detail[1].b_sfaadocno
            DISPLAY asft300_filter_parser('sfaa001') TO s_detail[1].b_sfaa001
            DISPLAY asft300_filter_parser('sfaadocdt') TO s_detail[1].b_sfaadocdt
            DISPLAY asft300_filter_parser('sfaa002') TO s_detail[1].b_sfaa002
            DISPLAY asft300_filter_parser('sfaa003') TO s_detail[1].b_sfaa003
            DISPLAY asft300_filter_parser('sfaa057') TO s_detail[1].b_sfaa057
            DISPLAY asft300_filter_parser('sfaa004') TO s_detail[1].b_sfaa004
            DISPLAY asft300_filter_parser('sfaa010') TO s_detail[1].b_sfaa010
            DISPLAY asft300_filter_parser('sfaa012') TO s_detail[1].b_sfaa012
            
         ON ACTION controlp INFIELD b_sfaadocno
            #add-point:ON ACTION controlp INFIELD sfaadocno
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " sfaasite = '",g_site,"'"
            CALL q_sfaadocno_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_sfaadocno  #顯示到畫面上

            NEXT FIELD b_sfaadocno                     #返回原欄位


      ON ACTION controlp INFIELD b_sfaa002
            #add-point:ON ACTION controlp INFIELD sfaa002
            #此段落由子樣板a08產生
            #開窗c段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_sfaa002  #顯示到畫面上

            NEXT FIELD b_sfaa002                     #返回原欄位

      ON ACTION controlp INFIELD b_sfaa010
            #add-point:ON ACTION controlp INFIELD sfaa010
            #此段落由子樣板a08產生
            #開窗c段
		    	INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			   LET g_qryparam.reqry = FALSE
            CALL q_imaa001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_sfaa010  #顯示到畫面上

            NEXT FIELD b_sfaa010                     #返回原欄位

      END CONSTRUCT

      #add-point:filter段add_cs
      
      #end add-point

      BEFORE DIALOG
         #add-point:filter段b_dialog
         
         #end add-point
           
      ON ACTION accept
         ACCEPT DIALOG

      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG

      #交談指令共用ACTION
      &include "common_action.4gl"
         CONTINUE DIALOG

   END DIALOG

   IF NOT INT_FLAG THEN
      LET g_wc_filter = "   AND   ", g_wc_filter, "   "
      LET g_wc = g_wc , g_wc_filter
   ELSE
      LET g_wc_filter = g_wc_filter_t
      LET g_wc = g_wc_t
   END IF

      CALL asft300_filter_show('sfaadocno')
   CALL asft300_filter_show('sfaa001')
   CALL asft300_filter_show('sfaadocdt')
   CALL asft300_filter_show('sfaa002')
   CALL asft300_filter_show('sfaa003')
   CALL asft300_filter_show('sfaa057')
   CALL asft300_filter_show('sfaa004')
   CALL asft300_filter_show('sfaa010')
   CALL asft300_filter_show('sfaa012')

END FUNCTION]]>
  </point>
  <point name="function.asft300_filter_parser" order="10" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_filter_parser(ps_field)
   {<Local define>}
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num5
   DEFINE li_tmp2    LIKE type_t.num5
   DEFINE ls_var     STRING
   {</Local define>}
   #add-point:filter段define
   
   #end add-point

   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF

   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF

   RETURN ls_var

END FUNCTION]]>
  </point>
  <point name="function.asft300_filter_show" order="11" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_filter_show(ps_field)
   DEFINE ps_field         STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING

   LET ls_name = "formonly.b_", ps_field

   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LEt ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF

   #顯示資料組合
   LET ls_condition = asft300_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF

   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)

END FUNCTION]]>
  </point>
  <point name="function.asft300_query" order="12" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_query()
   {<Local define>}
   DEFINE ls_wc STRING
   {</Local define>}
   #add-point:query段define
   
   #end add-point

   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF

   LET ls_wc = g_wc

   LET INT_FLAG = 0
   CALL cl_navigator_setting( g_current_idx, g_detail_cnt )
   ERROR ""

   #清除畫面及相關資料
   CLEAR FORM
   CALL g_browser.clear()
   CALL g_sfba_d.clear()

   DISPLAY ' ' TO FORMONLY.idx
   DISPLAY ' ' TO FORMONLY.cnt
   DISPLAY ' ' TO FORMONLY.b_index
   DISPLAY ' ' TO FORMONLY.b_count
   DISPLAY ' ' TO FORMONLY.h_index
   DISPLAY ' ' TO FORMONLY.h_count

   CALL asft300_construct()

   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      LET g_wc = ls_wc
      CALL asft300_browser_fill("")
      CALL asft300_fetch("")
      RETURN
   END IF

   #搜尋後資料初始化
   LET g_detail_cnt = 0
   LET g_current_idx = 1
   LET g_current_row = 0
   LET g_detail_idx = 1
   LET g_detail_idx2 = 1
   LET l_ac = 1
   LET g_wc_filter = ""
   CALL FGL_SET_ARR_CURR(1)
      CALL asft300_filter_show('sfaadocno')
   CALL asft300_filter_show('sfaa001')
   CALL asft300_filter_show('sfaadocdt')
   CALL asft300_filter_show('sfaa002')
   CALL asft300_filter_show('sfaa003')
   CALL asft300_filter_show('sfaa057')
   CALL asft300_filter_show('sfaa004')
   LET g_error_show = 1
   CALL asft300_browser_fill("F")

   IF g_browser_cnt = 0 THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "-100"
      LET g_errparam.extend = ""
      LET g_errparam.popup = TRUE
      CALL cl_err()

   ELSE
      CALL asft300_fetch("F")
   END IF

END FUNCTION]]>
  </point>
  <point name="function.asft300_fetch" order="13" ver="7" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_fetch(p_flag)
   {<Local define>}
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   {</Local define>}
   #add-point:fetch段define
   
   #end add-point

   IF g_browser_cnt = 0 THEN
      RETURN
   END IF

   CASE p_flag
      WHEN 'F' LET g_current_idx = 1
      WHEN 'L' LET g_current_idx = g_header_cnt
      WHEN 'P'
         IF g_current_idx > 1 THEN
            LET g_current_idx = g_current_idx - 1
         END IF
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF
      WHEN '/'
         IF (NOT g_no_ask) THEN
            CALL cl_set_act_visible("accept,cancel", TRUE)
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0

            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl"
            END PROMPT

            CALL cl_set_act_visible("accept,cancel", FALSE)
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE
            END IF
         END IF

         IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
             LET g_current_idx = g_jump
         END IF

         LET g_no_ask = FALSE
   END CASE

   #該樣板不需此段落CALL asft300_browser_fill(p_flag)

   CALL g_curr_diag.setCurrentRow("s_browse", g_current_idx) #設定browse 索引

   LET g_detail_cnt = g_header_cnt

   #單身總筆數顯示
   #LET g_detail_idx = 1
   IF g_detail_cnt > 0 THEN
      #LET g_detail_idx = 1
      DISPLAY g_detail_idx TO FORMONLY.idx
   ELSE
      LET g_detail_idx = 0
      DISPLAY ' ' TO FORMONLY.idx
   END IF

   #瀏覽頁筆數顯示
   LET g_browser_idx = g_pagestart+g_current_idx-1
   #該樣板不需此段落LET g_pagestart = g_current_idx
   DISPLAY g_browser_idx TO FORMONLY.b_index   #當下筆數
   DISPLAY g_browser_idx TO FORMONLY.h_index   #當下筆數
   #該樣板不需此段落DISPLAY g_pagestart TO FORMONLY.b_index   #當下筆數
   #該樣板不需此段落DISPLAY g_pagestart TO FORMONLY.h_index   #當下筆數

   CALL cl_navigator_setting( g_current_idx, g_browser_cnt )
   #該樣板不需此段落CALL cl_navigator_setting( g_pagestart, g_browser_cnt )

   #代表沒有資料
   IF g_current_idx = 0 OR g_browser.getLength() = 0 THEN
      RETURN
   END IF

   #超出範圍
   IF g_current_idx > g_browser.getLength() THEN
      LET g_current_idx = g_browser.getLength()
   END IF

   LET g_sfaa_m.sfaadocno = g_browser[g_current_idx].b_sfaadocno


   #重讀DB,因TEMP有不被更新特性
    SELECT UNIQUE sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,'',sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt
 INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt
 FROM sfaa_t
 WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "sfaa_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      INITIALIZE g_sfaa_m.* TO NULL
      RETURN
   END IF

   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,delete,reproduce", FALSE)
   ELSE
      CALL cl_set_act_visible("statechange,modify,delete,reproduce", TRUE)
   END IF

   #add-point:fetch段action控制
   CALL cl_set_act_visible("open_asft300_05", TRUE)
   IF g_sfaa_m.sfaastus != 'F' THEN  
      CALL cl_set_act_visible("open_asft300_05", FALSE)             
   END IF
   IF g_sfaa_m.sfaastus NOT MATCHES "[NDR]" THEN   # N未確認/D抽單/R已拒絕允許修改
      CALL cl_set_act_visible("modify,delete,modify_detail", FALSE)
   END IF
   #end add-point



   #add-point:fetch結束前
   
   #end add-point

   #LET g_data_owner =
   #LET g_data_group =

   #重新顯示
   CALL asft300_show()

END FUNCTION]]>
  </point>
  <point name="function.asft300_insert" order="14" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_insert()
   #add-point:insert段define
   
   #end add-point

   #清畫面欄位內容
   CLEAR FORM
   CALL g_sfab_d.clear()
   CALL g_sfac_d.clear()
   CALL g_sfad_d.clear()
   CALL g_sfaf_d.clear()
   CALL g_sfba_d.clear()
   CALL cl_set_combo_scc_part('sfaa005','4009','1,2,3,4')  #add by lixh 20150527

   INITIALIZE g_sfaa_m.* LIKE sfaa_t.*             #DEFAULT 設定

   LET g_sfaadocno_t = NULL

   LET g_master_insert = FALSE
   
   CALL s_transaction_begin()
   WHILE TRUE
      #公用欄位給值(單頭)
      #此段落由子樣板a14產生
      LET g_sfaa_m.sfaaownid = g_user
      LET g_sfaa_m.sfaaowndp = g_dept
      LET g_sfaa_m.sfaacrtid = g_user
      LET g_sfaa_m.sfaacrtdp = g_dept
      LET g_sfaa_m.sfaacrtdt = cl_get_current()
      LET g_sfaa_m.sfaamodid = ""
      LET g_sfaa_m.sfaamoddt = ""
      #LET g_sfaa_m.sfaastus = ""



      #append欄位給值


      #一般欄位給值
            LET g_sfaa_m.sfaa001 = "0"
      LET g_sfaa_m.sfaastus = "N"
      LET g_sfaa_m.sfaa005 = "0"
      LET g_sfaa_m.sfaa061 = 'N'
      LET g_sfaa_m.sfaa062 = "Y"
      LET g_sfaa_m.sfaa038 = "N"
      LET g_sfaa_m.sfaa039 = "N"
      LET g_sfaa_m.sfaa040 = "N"
      LET g_sfaa_m.sfaa041 = "N"
      LET g_sfaa_m.sfaa042 = "N"
      LET g_sfaa_m.sfaa043 = "N"
      LET g_sfaa_m.sfaa044 = "N"
      LET g_sfaa_m.sfaa049 = "0"
      LET g_sfaa_m.sfaa050 = "0"
      LET g_sfaa_m.sfaa051 = "0"
      LET g_sfaa_m.sfaa055 = "0"
      LET g_sfaa_m.sfaa056 = "0"
      LET g_sfaa_m.sfaa003 = '1'
      LET g_sfaa_m.sfaa057 = '1'
      LET g_sfaa_m.sfaa065 = '0'



      #add-point:單頭預設值
      LET g_sfaa_m.sfaadocdt = g_today
      LET g_sfaa_m.sfaa002 = g_user
      LET g_sfaa_m.sfaa004 = '1'          {#ADP版次:1#}
      LET g_flag1 = 'N'
      LET g_sfaa_m.sfaa019 = g_today
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_sfaa_m.sfaa002
      CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
      LET g_sfaa_m.sfaa002_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_sfaa_m.sfaa002_desc
      
      LET g_sfaa_m_t.* = g_sfaa_m.*
      #end add-point

      CALL asft300_input("a")

      #add-point:單頭輸入後
      
      #end add-point

      IF INT_FLAG AND NOT g_master_insert THEN
         LET INT_FLAG = 0
         LET g_sfaa_m.* = g_sfaa_m_t.*
         CALL asft300_show()
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 9001
         LET g_errparam.extend = ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
        #EXIT WHILE
         RETURN
      END IF

      CALL g_sfba_d.clear()


      LET g_rec_b = 0
      CALL s_transaction_end('Y','0')
      EXIT WHILE

   END WHILE

   LET g_state = "Y"

   LET g_sfaadocno_t = g_sfaa_m.sfaadocno


   LET g_wc = g_wc,
              " OR ( sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND",
              " sfaadocno = '", g_sfaa_m.sfaadocno CLIPPED, "' "

              , ") "

   CLOSE asft300_cl

END FUNCTION]]>
  </point>
  <point name="function.asft300_modify" order="15" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_modify()
   {<Local define>}
   DEFINE l_new_key    DYNAMIC ARRAY OF STRING
   DEFINE l_old_key    DYNAMIC ARRAY OF STRING
   DEFINE l_field_key  DYNAMIC ARRAY OF STRING
   {</Local define>}
   #add-point:modify段define
   
   #end add-point

   IF g_sfaa_m.sfaadocno IS NULL

   THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF
   
#   IF g_sfaa_m.sfaastus <> 'N' THEN
   IF g_sfaa_m.sfaastus NOT MATCHES '[NDR]' THEN   #MOD BY zhujing 2015-6-16
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00035'
      LET g_errparam.extend = g_sfaa_m.sfaastus
      LET g_errparam.popup = TRUE
      CALL cl_err()

      RETURN
   END IF 

    SELECT UNIQUE sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa009,sfaa022,sfaa023,sfaa024,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,'',sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt
 INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt
 FROM sfaa_t
 WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno

   ERROR ""

   LET g_sfaadocno_t = g_sfaa_m.sfaadocno

   CALL s_transaction_begin()

   OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN asft300_cl:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF

   #鎖住將被更改或取消的資料
   FETCH asft300_cl INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.oobal004,g_sfaa_m.sfaa002,g_sfaa_m.sfaa002_desc,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa009_desc,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa010_desc,g_sfaa_m.sfaa010_desc1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa016_desc,g_sfaa_m.sfaa017,g_sfaa_m.sfaa017_desc,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.ooff013,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaownid_desc,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaaowndp_desc,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtid_desc,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdp_desc,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamodid_desc,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfid_desc,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstid_desc,g_sfaa_m.sfaapstdt

   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF



   CALL asft300_show()
   WHILE TRUE
      LET g_sfaadocno_t = g_sfaa_m.sfaadocno


      #寫入修改者/修改日期資訊(單頭)
      LET g_sfaa_m.sfaamodid = g_user
LET g_sfaa_m.sfaamoddt = cl_get_current()


      #add-point:modify段修改前
      #「D抽單 / R已拒絕」狀況碼更改資料後，需還原為「N未確認」
      IF g_sfaa_m.sfaastus MATCHES "[DR]" THEN
         LET g_sfaa_m.sfaastus = "N"
      END IF
      #end add-point

      CALL asft300_input("u")     #欄位更改

      #add-point:modify段修改後
      
      #end add-point

      IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_sfaa_m.* = g_sfaa_m_t.*
         CALL asft300_show()
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 9001
         LET g_errparam.extend = ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT WHILE
      END IF

      #若單頭key欄位有變更
      IF g_sfaa_m.sfaadocno != g_sfaadocno_t

      THEN
         CALL s_transaction_begin()

         #add-point:單身fk修改前
         
         #end add-point

         #更新單身key值
         UPDATE sfba_t SET sfbadocno = g_sfaa_m.sfaadocno

          WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno_t


         #add-point:單身fk修改中
         
         #end add-point

         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00009"
               LET g_errparam.extend = "sfba_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CALL s_transaction_end('N','0')
               CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "sfba_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CALL s_transaction_end('N','0')
               CONTINUE WHILE
         END CASE

         #add-point:單身fk修改後
         
         #end add-point





         #UPDATE 多語言table key值


         CALL s_transaction_end('Y','0')
      END IF

      EXIT WHILE
   END WHILE

   #修改歷程記錄
   IF NOT cl_log_modified_record(g_sfaa_m.sfaadocno,g_site) THEN
      CALL s_transaction_end('N','0')
   END IF

   CLOSE asft300_cl
   CALL s_transaction_end('Y','0')

   #流程通知預埋點-U
   CALL cl_flow_notify(g_sfaa_m.sfaadocno,'U')

END FUNCTION]]>
  </point>
  <point name="function.asft300_input" order="16" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_input(p_cmd)
   {<Local define>}
   DEFINE  p_cmd           LIKE type_t.chr1
   DEFINE  l_cmd_t         LIKE type_t.chr1
   DEFINE  l_cmd           LIKE type_t.chr1
   DEFINE  l_ac_t          LIKE type_t.num5                #未取消的ARRAY CNT
   DEFINE  l_n             LIKE type_t.num5                #檢查重複用
   DEFINE  l_cnt           LIKE type_t.num5                #檢查重複用
   DEFINE  l_lock_sw       LIKE type_t.chr1                #單身鎖住否
   DEFINE  l_allow_insert  LIKE type_t.num5                #可新增否
   DEFINE  l_allow_delete  LIKE type_t.num5                #可刪除否
   DEFINE  l_count         LIKE type_t.num5
   DEFINE  l_i             LIKE type_t.num5
   DEFINE  l_insert        BOOLEAN
   DEFINE  ls_return       STRING
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   {</Local define>}
   #add-point:input段define
   DEFINE  l_ooef004       LIKE ooef_t.ooef004
   DEFINE  l_sql           STRING
   DEFINE  l_bmaa001       LIKE bmaa_t.bmaa001
   DEFINE  l_bmaastus      LIKE bmaa_t.bmaastus             {#ADP版次:1#}
   DEFINE  l_m             LIKE type_t.num5
   DEFINE  l_ooef017       LIKE ooef_t.ooef017
   DEFINE  l_ooef017_1     LIKE ooef_t.ooef017
   DEFINE  l_sys           LIKE type_t.num5 
   DEFINE  l_success       LIKE type_t.num5
   DEFINE  l_imaa006       LIKE imaa_t.imaa006
   DEFINE  l_rate          LIKE type_t.num26_10  
   DEFINE  l_num           LIKE type_t.num5
   DEFINE  l_imaa005       LIKE imaa_t.imaa005
   DEFINE  l_inam          DYNAMIC ARRAY OF RECORD   #記錄產品特徵
              inam001      LIKE inam_t.inam001,
              inam002      LIKE inam_t.inam002,
              inam004      LIKE inam_t.inam004
                           END RECORD
   DEFINE  l_sfad          RECORD LIKE sfad_t.*
   DEFINE  l_flag          LIKE type_t.chr1
   DEFINE  l_flag0         LIKE type_t.chr1
   DEFINE  l_flag1         LIKE type_t.chr1
   DEFINE  l_flag2         LIKE type_t.chr1
   DEFINE  l_flag3         LIKE type_t.chr1
   DEFINE  l_flag4         LIKE type_t.num5
   DEFINE  l_flag5         LIKE type_t.chr1
   DEFINE  l_sum_sfad002   LIKE sfad_t.sfad002
   DEFINE  l_sum_sfae001   LIKE sfae_t.sfae001
   DEFINE  l_sfae002_max   LIKE sfae_t.sfae002
   DEFINE  l_sfae002_min   LIKE sfae_t.sfae002
   DEFINE  l_sfba013       LIKE sfba_t.sfba013
   DEFINE  l_imae032       LIKE imae_t.imae032
   DEFINE  l_ooba002       LIKE ooba_t.ooba002
   DEFINE  l_fields_1      STRING
   DEFINE  l_imae015       LIKE imae_t.imae015
   DEFINE  l_sfab007_sum   LIKE sfab_t.sfab007
   DEFINE  l_sfab007_sum1  LIKE sfab_t.sfab007
   DEFINE  l_imae017       LIKE imae_t.imae017
   DEFINE  l_imae018       LIKE imae_t.imae018
   DEFINE  l_imae019       LIKE imae_t.imae019
   DEFINE  l_sfaa012       LIKE sfaa_t.sfaa012
   DEFINE  l_n_sfaa012     LIKE type_t.num20
   DEFINE  l_bmba          DYNAMIC ARRAY OF RECORD
           bmba001         LIKE bmba_t.bmba001,    #bom相关资料都可以通过回传的key值抓取
           bmba002         LIKE bmba_t.bmba002,
           bmba003         LIKE bmba_t.bmba003,
           bmba004         LIKE bmba_t.bmba004,
           bmba005         DATETIME YEAR TO SECOND,
           bmba007         LIKE bmba_t.bmba007,
           bmba008         LIKE bmba_t.bmba008,
           l_bmba011       LIKE bmba_t.bmba011,     #QPA 分子，对应于原始的主件料号
           l_bmba012       LIKE bmba_t.bmba012,     #QPA 分母，对应于原始的主件料号
           l_inam002       LIKE inam_t.inam002      #元件对应特征
                           END RECORD
   DEFINE  l_sfac003       LIKE sfac_t.sfac003
   DEFINE  l_sfac003_sum   LIKE sfac_t.sfac003
   DEFINE  l_sfae001_sum   LIKE sfae_t.sfae001
   DEFINE  l_ooef008       LIKE ooef_t.ooef008
   DEFINE  l_days          LIKE type_t.num5
   DEFINE  l_j             LIKE type_t.num5
   DEFINE  l_k             LIKE type_t.num5
   DEFINE  l_sfba          RECORD LIKE sfba_t.*
   DEFINE  l_sfac          RECORD LIKE sfac_t.*
   DEFINE  l_imaa005_1     LIKE imaa_t.imaa005
   DEFINE  l_msg           STRING
   DEFINE  l_sfaa007_n1    LIKE type_t.num5
   DEFINE  l_sfaa007_n2    LIKE type_t.num5
   DEFINE  l_sfaa007_str   STRING
   DEFINE  l_sfaa008_str   STRING
   DEFINE  l_sfaa063_str   STRING
   DEFINE  l_imae082       LIKE imae_t.imae082
   DEFINE  l_imae083       LIKE imae_t.imae083
   DEFINE  l_imae084       LIKE imae_t.imae084
   DEFINE  l_n_sfba013     LIKE type_t.num20
   DEFINE  l_n1            LIKE type_t.num5
   DEFINE  l_n2            LIKE type_t.num5
   #end add-point  

   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r'
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF

   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF

   CALL cl_set_head_visible("","YES")

   LET l_insert = FALSE
   LET g_action_choice = ""

   LET g_forupd_sql = "SELECT sfabseq,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006,'','','','','',sfab007,'','','','','','' ",
                      "  FROM sfab_t ",
                      " WHERE sfabent=? AND sfabsite=? AND sfabdocno=?  AND sfabseq=? ",
                    #  "   AND sfab001=? AND sfab002=? AND sfab003=? AND sfab004=? ",
                      "   FOR UPDATE"
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE asft300_sfab_bcl CURSOR FROM g_forupd_sql
   
   LET g_forupd_sql = "SELECT sfacseq,sfac002,sfac001,'','',sfac006,'',sfac003,sfac004,'',sfac005 ",
                      "  FROM sfac_t ",
                      " WHERE sfacent=? AND sfacsite=? AND sfacdocno=? AND sfacseq=? FOR UPDATE "
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE asft300_sfac_bcl CURSOR FROM g_forupd_sql
   
   LET g_forupd_sql = "SELECT sfadseq,sfad001,sfad002,sfad003 ",
                      "  FROM sfad_t ",
                      " WHERE sfadent=? AND sfadsite=? AND sfaddocno=? AND sfadseq=? FOR UPDATE "
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE asft300_sfad_bcl CURSOR FROM g_forupd_sql
   
   LET g_forupd_sql = "SELECT sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,'',sfae006 ",
                      "  FROM sfae_t ",
                      " WHERE sfaeent=? AND sfaesite=? AND sfaedocno=? AND sfaeseq=? FOR UPDATE "
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE asft300_sfae_bcl CURSOR FROM g_forupd_sql
   
   LET g_forupd_sql = "SELECT sfafseq,sfaf001 ",
                      "  FROM sfaf_t ",
                      " WHERE sfafent=? AND sfafsite=? AND sfafdocno=? AND sfafseq=? FOR UPDATE "
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE asft300_sfaf_bcl CURSOR FROM g_forupd_sql
   
   LET g_forupd_sql = "SELECT sfbaseq,sfbaseq1,sfba002,sfba003,sfba004,sfba005,'',sfba022,sfba006,'','','',sfba021,sfba007,sfba008,sfba009,sfba010,sfba011,sfba012,sfba023,sfba024,sfba013,sfba014,sfba015,sfba016,sfba025,'','',sfba017,sfba018,sfba019,sfba020,sfba029,sfba030,sfba028,sfba001,sfba026,sfba027 FROM sfba_t WHERE sfbaent=? AND sfbasite=? AND sfbadocno=? AND sfbaseq=? AND sfbaseq1=? FOR UPDATE"
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   DECLARE asft300_bcl CURSOR FROM g_forupd_sql





   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'

   #控制key欄位可否輸入
   CALL asft300_set_entry(p_cmd)
   #add-point:set_entry後
   
   #end add-point
   CALL asft300_set_no_entry(p_cmd)

   DISPLAY BY NAME g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.ooff013,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt

   #add-point:資料輸入前
   LET l_flag0 = 'Y'
   LET l_flag1 = 'Y'
   LET l_flag2 = 'Y'
   LET l_flag3 = 'Y'
   LET l_flag5 = 'Y'
   WHILE TRUE
   #end add-point
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)

      #單頭段
      INPUT BY NAME g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.l_sfaa007,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.l_sfaa023,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt
         ATTRIBUTE(WITHOUT DEFAULTS)

         #自訂ACTION(master_input)


         BEFORE INPUT
            IF g_flag_date = 'Y' THEN
               EXIT DIALOG
            END IF 
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF

            IF l_cmd_t = 'r' THEN

            END IF
            #add-point:資料輸入前
            CALL cl_set_comp_entry('sfaa006,sfaa007,sfaa008,sfaa063,l_sfaa007,sfaa009,sfaa010,sfaa011,sfaa058',TRUE)
            
            #有單身資料時，工單類型、發料制度、工單來源、來源單號項次項序分批序、生產料號、BOM特性、生產數量、生產單位、工單來源頁籤，
            #限制不可修改，以免已存在的單身資料與單頭不合
            CALL cl_set_comp_entry("sfaa003,sfaa057,sfaa004,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,l_sfaa007,sfaa010,sfaa011,sfaa012,sfaa013",TRUE)
            IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
               SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
               IF l_n > 0 THEN
                  CALL cl_set_comp_entry("sfaa003,sfaa057,sfaa004,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,l_sfaa007,sfaa010,sfaa011,sfaa012,sfaa013",FALSE)
               END IF
            END IF
            #end add-point

         #---------------------------<  Master  >---------------------------
         #----<<sfaadocno>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaadocno
            #add-point:BEFORE FIELD sfaadocno
            #开启由预设关闭的栏位，防止不同单别栏位还是关闭的
            IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
               LET l_fields_1 = ''
               CALL s_aooi200_get_doc_fields(g_site,'1',g_sfaa_m.sfaadocno) RETURNING l_fields_1
               CALL cl_set_comp_entry(l_fields_1,TRUE)
            END IF
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaadocno

            #add-point:AFTER FIELD sfaadocno
            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) THEN
               CALL s_aooi200_chk_slip(g_site,'',g_sfaa_m.sfaadocno,'asft300')
               RETURNING l_success
               IF NOT l_success THEN
                  NEXT FIELD CURRENT
               END IF
               
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t )) THEN
               #  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaa_t WHERE "||"sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND "||"sfaadocno = '"||g_sfaa_m.sfaadocno ||"'",'std-00004',0) THEN
               #     LET g_sfaa_m.sfaadocno = g_sfaadocno_t
               #     NEXT FIELD CURRENT
               #  END IF

                  #单别带出单据名称
                  CALL s_aooi200_get_slip_desc(g_sfaa_m.sfaadocno)
                    RETURNING g_sfaa_m.oobal004
                  DISPLAY g_sfaa_m.oobal004 TO FORMONLY.oobal004

               #  #依单别预设工单类型
               #  SELECT oobb005 INTO g_sfaa_m.sfaa003 FROM oobb_t WHERE oobbent=g_enterprise AND oobb001=l_ooef004 AND oobb002=g_sfaa_m.sfaadocno AND oobb004='sfaa003'
               #  IF cl_null(g_sfaa_m.sfaa003) THEN
               #     LET g_sfaa_m.sfaa003 = '1'
               #  END IF
               #
               #  #依单别预设委外类型
               #  SELECT oobb005 INTO g_sfaa_m.sfaa057 FROM oobb_t WHERE oobbent=g_enterprise AND oobb001=l_ooef004 AND oobb002=g_sfaa_m.sfaadocno AND oobb004='sfaa057'
               #  IF cl_null(g_sfaa_m.sfaa057) THEN
               #     LET g_sfaa_m.sfaa057 = '1'
               #  END IF
               #  
               #  #依单别预设制程否
               #  LET g_sfaa_m.sfaa061 = cl_get_doc_para(g_enterprise,g_site,g_sfaa_m.sfaadocno,'D-MFG-0041')
               #  IF cl_null(g_sfaa_m.sfaa061) THEN
               #     LET g_sfaa_m.sfaa061 = 'N'
               #  END IF 
               #  
               #  #依单别预设FQC否
               #  LET g_sfaa_m.sfaa044 = cl_get_doc_para(g_enterprise,g_site,g_sfaa_m.sfaadocno,'D-MFG-0042')
               #  IF cl_null(g_sfaa_m.sfaa044) THEN
               #     LET g_sfaa_m.sfaa044 = 'N'
               #  END IF 
                  
                  CALL asft300_get_col_default()
                  
                  IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
                     LET l_fields_1 = ''
                     CALL s_aooi200_get_doc_fields(g_site,'1',g_sfaa_m.sfaadocno) RETURNING l_fields_1
                     CALL cl_set_comp_entry(l_fields_1,FALSE)
                  END IF
               END IF
            END IF
                      {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaadocno
            #add-point:ON CHANGE sfaadocno
            
            #END add-point

         #----<<sfaa001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa001
            #add-point:BEFORE FIELD sfaa001
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa001

            #add-point:AFTER FIELD sfaa001
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa001
            #add-point:ON CHANGE sfaa001
            
            #END add-point

         #----<<sfaadocdt>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaadocdt
            #add-point:BEFORE FIELD sfaadocdt
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaadocdt

            #add-point:AFTER FIELD sfaadocdt
            IF NOT cl_null(g_sfaa_m.sfaadocdt) AND (cl_null(g_sfaa_m_t.sfaadocdt) OR g_sfaa_m.sfaadocdt != g_sfaa_m_t.sfaadocdt) THEN
               IF NOT cl_null(g_sfaa_m.sfaa019) THEN
                  IF g_sfaa_m.sfaadocdt > g_sfaa_m.sfaa019 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00308'
                     LET g_errparam.extend = g_sfaa_m.sfaadocdt
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF               
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaadocdt
            #add-point:ON CHANGE sfaadocdt
            
            #END add-point

         #----<<sfaa003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa003
            #add-point:BEFORE FIELD sfaa003
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa003

            #add-point:AFTER FIELD sfaa003
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa003
            #add-point:ON CHANGE sfaa003
            IF g_sfaa_m.sfaa003 = '5' THEN 
               CALL cl_set_comp_entry("sfaa025",TRUE)
            ELSE
               CALL cl_set_comp_entry("sfaa025",FALSE)
            END IF
            #END add-point

         #----<<sfaa057>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa057
            #add-point:BEFORE FIELD sfaa057
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa057

            #add-point:AFTER FIELD sfaa057
            IF g_sfaa_m.sfaa057 = '2' THEN
               CALL cl_set_comp_entry("sfaa018",TRUE)
            ELSE
               CALL cl_set_comp_entry("sfaa018",FALSE)
            END IF
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa057
            #add-point:ON CHANGE sfaa057
            
            #END add-point

         #----<<sfaa002>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa002

            #add-point:AFTER FIELD sfaa002
            IF NOT cl_null(g_sfaa_m.sfaa002) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL

               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_sfaa_m.sfaa002

               #呼叫檢查存在並帶值的library
               IF NOT cl_chk_exist("v_ooag001") THEN
                  LET g_sfaa_m.sfaa002 = g_sfaa_m_t.sfaa002
                  NEXT FIELD CURRENT
               END IF
            END IF
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa002
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa002_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa002_desc
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa002
            #add-point:BEFORE FIELD sfaa002
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfaa002
            #add-point:ON CHANGE sfaa002
            
            #END add-point

         #----<<sfaa004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa004
            #add-point:BEFORE FIELD sfaa004
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa004

            #add-point:AFTER FIELD sfaa004
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa004
            #add-point:ON CHANGE sfaa004
            
            #END add-point

         #----<<sfaastus>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaastus
            #add-point:BEFORE FIELD sfaastus
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaastus

            #add-point:AFTER FIELD sfaastus
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaastus
            #add-point:ON CHANGE sfaastus
            
            #END add-point

         #----<<sfaa005>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa005
            #add-point:BEFORE FIELD sfaa005
            CALL cl_set_comp_entry('sfaa005',TRUE)
            IF g_sfaa_m_t.sfaa005 MATCHES '[34]' THEN
               CALL cl_set_comp_entry('sfaa005',FALSE)
            END IF
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa005
            IF p_cmd = 'a' OR (NOT cl_null(g_sfaa_m.sfaa005) AND (cl_null(g_sfaa_m_t.sfaa005) OR (g_sfaa_m.sfaa005 != g_sfaa_m_t.sfaa005))) THEN
               IF g_sfaa_m.sfaa005 MATCHES '[01]' THEN
                  LET g_sfaa_m.sfaa006 = ''
                  LET g_sfaa_m.sfaa007 = ''
                  LET g_sfaa_m.sfaa008 = ''
                  LET g_sfaa_m.sfaa063 = ''
                  LET g_sfaa_m.l_sfaa007 = ''
                  DISPLAY BY NAME g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.l_sfaa007
                  CALL cl_set_comp_entry('sfaa010,sfaa011',TRUE)
                  IF g_sfaa_m.sfaa005 = '1' THEN
                    # SELECT MAX(xmdd011) INTO g_sfaa_m.sfaa019 FROM xmdd_t WHERE xmddent=g_enterprise AND xmddsite=g_site AND (xmdddocno,xmddseq,xmddseq1,xmddseq2) IN (SELECT sfab002,sfab003,sfab004,sfab005 FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site AND sfabdocno=g_sfaa_m.sfaadocno)
                  END IF
                  IF cl_null(g_sfaa_m.sfaa019) THEN
                     LET g_sfaa_m.sfaa019 = cl_get_today()
                  END IF                  
               END IF 
               IF g_sfaa_m.sfaa005 MATCHES '[34]' THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00316'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD sfaa005
               END IF
               #當為MULTI時，先開啟多訂單來源產生子畫面，產生完後再進入工單來源頁籤
               IF g_sfaa_m.sfaa005 = '1' THEN
                  LET g_sfaa_m_t.sfaadocno = g_sfaa_m.sfaadocno
                  IF p_cmd <> 'u' THEN
                     #自动编号
                     CALL s_aooi200_gen_docno(g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfaadocdt,g_prog)
                          RETURNING l_success,g_sfaa_m.sfaadocno
                     IF NOT l_success THEN
                        NEXT FIELD sfaadocno
                     ELSE
                        SELECT COUNT(*) INTO l_count FROM sfaa_t
                         WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
                        IF l_count = 0 THEN
                           INSERT INTO sfaa_t (sfaaent, sfaasite,sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt)
                           VALUES (g_enterprise, g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt)
                        END IF
                     END IF
                  END IF
		            CALL asft300_01(g_sfaa_m.sfaadocno)
		            SELECT COUNT(*) INTO l_count FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site
		               AND sfabdocno=g_sfaa_m.sfaadocno
		            IF l_count > 0 THEN
		               LET l_flag0 = 'N'
		               
		               SELECT UNIQUE sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,'',sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt
                       INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt
                       FROM sfaa_t
                      WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
		               CALL asft300_show()
		               #写入工单生产料号明细,拆件式不控管
		               IF g_sfaa_m.sfaa003 != '3' THEN
                        IF NOT cl_null(g_sfaa_m.sfaa010) AND g_sfaa_m.sfaa011 IS NOT NULL AND p_cmd = 'a' AND g_flag1 = 'N' THEN
                           CALL asft300_ins_sfac()
                           LET g_flag1 = 'Y'
                        END IF 
                     END IF
                     
                     #写入计划完工日期sfae
                     IF NOT cl_null(g_sfaa_m.sfaa012) AND NOT cl_null(g_sfaa_m.sfaa020) THEN
                        DELETE FROM sfae_t WHERE sfaeent=g_enterprise AND sfaesite=g_site AND sfaedocno=g_sfaa_m.sfaadocno
                        INSERT INTO sfae_t(sfaeent,sfaesite,sfaedocno,sfaeseq,sfae001,sfae002,sfae004) 
                         VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020,0)
                        IF SQLCA.sqlcode THEN
                           INITIALIZE g_errparam TO NULL
                           LET g_errparam.code = SQLCA.sqlcode
                           LET g_errparam.extend = "ins sfab_t"
                           LET g_errparam.popup = TRUE
                           CALL cl_err()

                           CONTINUE DIALOG
                        END IF
                     END IF
                     
                     CALL s_transaction_end('Y','0')
		               LET p_cmd = 'u'
		               LET g_sfaadocno_t = g_sfaa_m.sfaadocno
		               LET g_sfaa_m.sfaamodid = g_user
                     LET g_sfaa_m.sfaamoddt = cl_get_current()
		               EXIT DIALOG
		            ELSE
		               LET g_sfaa_m.sfaadocno = g_sfaa_m_t.sfaadocno
		            END IF
               END IF
               
               #非人工录入时推算预计开工日和预计完工日
               IF g_sfaa_m.sfaa005 != 0 THEN
               END IF 
            END IF
               
                      {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa005
            #add-point:ON CHANGE sfaa005
            CALL cl_set_comp_entry("sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,l_sfaa007",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' THEN
               CALL cl_set_comp_entry("sfaa006,sfaa007,sfaa008,sfaa063,l_sfaa007",FALSE)
            END IF
            IF g_sfaa_m.sfaa005 = '2' THEN
               CALL cl_set_comp_entry("sfaa009",FALSE)
            END IF
            #END add-point

         #----<<sfaa006>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa006
            #add-point:BEFORE FIELD sfaa006
            CALL cl_set_comp_entry("sfaa006",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' OR g_sfaa_m.sfaa005 = '4' THEN
               CALL cl_set_comp_entry("sfaa006",FALSE)
            END IF                     {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa006

            #add-point:AFTER FIELD sfaa006
            #當等於訂單、計畫等，檢查是否存在來源資料裡
            IF NOT cl_null(g_sfaa_m.sfaa006) AND (cl_null(g_sfaa_m_t.sfaa006) OR g_sfaa_m.sfaa006 != g_sfaa_m_t.sfaa006) THEN
               IF NOT asft300_sfaa006_chk() THEN
                  LET g_sfaa_m.sfaa006 = g_sfaa_m_t.sfaa006
                  NEXT FIELD sfaa006
               END IF
            END IF
            IF cl_null(g_sfaa_m.sfaa006) AND g_sfaa_m.sfaa005 MATCHES '[23]'THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00150'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()
               
            END IF
                           
                      {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa006
            #add-point:ON CHANGE sfaa006
            
            #END add-point

         #----<<sfaa007>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa007
            #add-point:BEFORE FIELD sfaa007
            CALL cl_set_comp_entry("sfaa007",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' OR g_sfaa_m.sfaa005 = '4' THEN
               CALL cl_set_comp_entry("sfaa007",FALSE)
            END IF            {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa007

            #add-point:AFTER FIELD sfaa007
            IF NOT cl_null(g_sfaa_m.sfaa007) AND (cl_null(g_sfaa_m_t.sfaa007) OR g_sfaa_m.sfaa007 != g_sfaa_m_t.sfaa007) THEN
               IF NOT asft300_sfaa006_chk() THEN
                  LET g_sfaa_m.sfaa007 = g_sfaa_m_t.sfaa007
                  NEXT FIELD sfaa007
               END IF
            END IF
            IF cl_null(g_sfaa_m.sfaa007) AND g_sfaa_m.sfaa005 MATCHES '[23]'THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00150'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

            END IF
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa007
            #add-point:ON CHANGE sfaa007
            
            #END add-point

         #----<<sfaa008>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa008
            #add-point:BEFORE FIELD sfaa008
            CALL cl_set_comp_entry("sfaa008",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' OR g_sfaa_m.sfaa005 = '4' THEN
               CALL cl_set_comp_entry("sfaa008",FALSE)
            END IF            {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa008

            #add-point:AFTER FIELD sfaa008
            #當等於訂單、銷售合約、計畫等，檢查是否存在來源資料裡
            IF NOT cl_null(g_sfaa_m.sfaa008) AND (cl_null(g_sfaa_m_t.sfaa008) OR g_sfaa_m.sfaa008 != g_sfaa_m_t.sfaa008) THEN
               IF NOT asft300_sfaa006_chk() THEN
                  LET g_sfaa_m.sfaa008 = g_sfaa_m_t.sfaa008
                  NEXT FIELD sfaa008
               END IF
            END IF
            IF cl_null(g_sfaa_m.sfaa008) AND g_sfaa_m.sfaa005 MATCHES '[23]'THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00150'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

            END IF
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa008
            #add-point:ON CHANGE sfaa008
            
            #END add-point

         BEFORE FIELD sfaa063
            #add-point:BEFORE FIELD sfaa008
            CALL cl_set_comp_entry("sfaa063",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' OR g_sfaa_m.sfaa005 = '4' THEN
               CALL cl_set_comp_entry("sfaa063",FALSE)
            END IF            {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa063

            #add-point:AFTER FIELD sfaa008
            #當等於訂單、銷售合約、計畫等，檢查是否存在來源資料裡
            IF NOT cl_null(g_sfaa_m.sfaa063) AND (cl_null(g_sfaa_m_t.sfaa063) OR g_sfaa_m.sfaa063 != g_sfaa_m_t.sfaa063) THEN
               IF NOT asft300_sfaa006_chk() THEN
                  LET g_sfaa_m.sfaa063 = g_sfaa_m_t.sfaa063
                  NEXT FIELD sfaa063
               END IF
            END IF
            IF cl_null(g_sfaa_m.sfaa063) AND g_sfaa_m.sfaa005 MATCHES '[23]'THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00150'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

            END IF
            
         BEFORE FIELD l_sfaa007
            CALL cl_set_comp_entry("l_sfaa007",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' OR g_sfaa_m.sfaa005 = '4' THEN
               CALL cl_set_comp_entry("l_sfaa007",FALSE)
            END IF  
            
         AFTER FIELD l_sfaa007
            #项次/项序/分批序 格式，例如：项次1，项序2，分批序3，则1-2-3
            IF NOT cl_null(g_sfaa_m.l_sfaa007) AND (cl_null(g_sfaa_m_t.l_sfaa007) OR g_sfaa_m.l_sfaa007 != g_sfaa_m_t.l_sfaa007) THEN
               #根据“-”截位
               LET l_sfaa007_n1 = g_sfaa_m.l_sfaa007.getIndexOf("-",2)
               IF l_sfaa007_n1 > 0 THEN
                  LET g_sfaa_m.sfaa007 = g_sfaa_m.l_sfaa007.substring(1,l_sfaa007_n1-1)#.trim()
                  LET l_sfaa007_n2 = g_sfaa_m.l_sfaa007.getIndexOf("-",l_sfaa007_n1+1)
                  IF l_sfaa007_n2 > 0 THEN
                     LET g_sfaa_m.sfaa008 = g_sfaa_m.l_sfaa007.substring(l_sfaa007_n1+1,l_sfaa007_n2-1)#.trim()
                     LET g_sfaa_m.sfaa063 = g_sfaa_m.l_sfaa007.substring(l_sfaa007_n2+1,g_sfaa_m.l_sfaa007.getLength())#.trim()
                  ELSE
                     LET g_sfaa_m.sfaa008 = g_sfaa_m.l_sfaa007.substring(l_sfaa007_n1+1,g_sfaa_m.l_sfaa007.getLength())#.trim()
                     LET g_sfaa_m.sfaa063 = ''
                  END IF
               ELSE
                  LET g_sfaa_m.sfaa007 = g_sfaa_m.l_sfaa007.trim()
                  LET g_sfaa_m.sfaa008 = ''
                  LET g_sfaa_m.sfaa063 = ''
               END IF
                             
               IF NOT asft300_sfaa006_chk() THEN
                  LET g_sfaa_m.l_sfaa007 = g_sfaa_m_t.l_sfaa007
                  NEXT FIELD l_sfaa007
               END IF
            END IF
            
            
         #----<<sfaa009>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa009
            IF NOT cl_null(g_sfaa_m.sfaa009) AND (cl_null(g_sfaa_m_t.sfaa009) OR g_sfaa_m.sfaa009 != g_sfaa_m_t.sfaa009) THEN
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = g_sfaa_m.sfaa009
               LET g_chkparam.arg2 = g_site
              #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pmaa001_3") THEN
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = g_sfaa_m.sfaa009
                  CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                  LET g_sfaa_m.sfaa009_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfaa_m.sfaa009_desc
               ELSE
                  #檢查失敗時後續處理
                  LET g_sfaa_m.sfaa028 = g_sfaa_m_t.sfaa028
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = g_sfaa_m.sfaa009
                  CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                  LET g_sfaa_m.sfaa009_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfaa_m.sfaa009_desc
                  NEXT FIELD CURRENT
               END IF
            END IF                
            
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa009
            #add-point:BEFORE FIELD sfaa009
            CALL cl_set_comp_entry("sfaa009",TRUE)
            IF g_sfaa_m.sfaa005 = '2' THEN
               CALL cl_set_comp_entry("sfaa009",FALSE)
            END IF
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfaa009
            #add-point:ON CHANGE sfaa009
            
            #END add-point

         #----<<sfaa022>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa022
            #add-point:BEFORE FIELD sfaa022
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa022

            #add-point:AFTER FIELD sfaa022
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa022
            #add-point:ON CHANGE sfaa022
            
            #END add-point

         #----<<sfaa023>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa023
            #add-point:BEFORE FIELD sfaa023
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa023

            #add-point:AFTER FIELD sfaa023
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa023
            #add-point:ON CHANGE sfaa023
            
            #END add-point

         #----<<sfaa024>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa024
            #add-point:BEFORE FIELD sfaa024
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa024

            #add-point:AFTER FIELD sfaa024
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa024
            #add-point:ON CHANGE sfaa024
            
            #END add-point

         #----<<sfaa021>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa021
            #add-point:BEFORE FIELD sfaa021
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa021

            #add-point:AFTER FIELD sfaa021
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa021
            #add-point:ON CHANGE sfaa021
            
            #END add-point

         #----<<sfaa025>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa025
            IF g_sfaa_m.sfaa003 = '5' THEN 
               CALL cl_set_comp_entry("sfaa025",TRUE)
            ELSE
               CALL cl_set_comp_entry("sfaa025",FALSE)
            END IF

         #此段落由子樣板a02產生
         AFTER FIELD sfaa025

            #add-point:AFTER FIELD sfaa025
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa025
            #add-point:ON CHANGE sfaa025
            
            #END add-point

         #----<<sfaa010>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa010

            #add-point:AFTER FIELD sfaa010
            IF NOT cl_null(g_sfaa_m.sfaa010) AND (cl_null(g_sfaa_m_t.sfaa010) OR g_sfaa_m.sfaa010 != g_sfaa_m_t.sfaa010) THEN
               
               IF NOT asft300_sfaa010() THEN
                  LET g_sfaa_m.sfaa010 = g_sfaa_m_t.sfaa010
                  NEXT FIELD sfaa010
               END IF 
               
               #特征管理
               IF NOT asft300_sfaa010_feature() THEN
                  LET g_sfaa_m.sfaa010 = g_sfaa_m_t.sfaa010
                  NEXT FIELD sfaa010
               END IF
               
               SELECT imae016,imae020,imae034 INTO g_sfaa_m.sfaa013,g_sfaa_m.imae020,g_sfaa_m.sfaa017 FROM imae_t
                WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfaa_m.sfaa010
               IF cl_null(g_sfaa_m.imae020) THEN
                  LET g_sfaa_m.imae020 = 0 
               END IF
               SELECT imaf015 INTO g_sfaa_m.sfaa060 FROM imaf_t
                WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_sfaa_m.sfaa010   
               CALL asft300_sfaa058(g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa060)               
               DISPLAY BY NAME g_sfaa_m.sfaa013,g_sfaa_m.sfaa017,g_sfaa_m.imae020,g_sfaa_m.sfaa060
                
               IF g_sfaa_m.sfaa061 = 'Y' THEN
                  SELECT imae033 INTO g_sfaa_m.sfaa016 FROM imae_t
                   WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfaa_m.sfaa010
                  DISPLAY BY NAME g_sfaa_m.sfaa016
                  SELECT imae032 INTO l_imae032 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
                  IF cl_null(l_imae032) THEN
                     LET l_imae032 = g_sfaa_m.sfaa010
                  END IF
               END IF 
               
               IF NOT cl_null(g_sfaa_m.sfaa010) AND NOT cl_null(g_sfaa_m.sfaa012) THEN
                  IF p_cmd = 'a' THEN
                     IF NOT cl_null(g_sfaa_m.sfaa020) THEN
                        CALL s_asft300_06('2',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020) RETURNING l_success,g_sfaa_m.sfaa019
                        IF g_sfaa_m.sfaa019 < g_sfaa_m.sfaadocdt THEN
                           LET l_days = g_sfaa_m.sfaadocdt - g_sfaa_m.sfaa019
                           LET g_sfaa_m.sfaa019 = g_sfaa_m.sfaadocdt        
                           #根据当前营运据点g_site抓取aooi120中设置的行事历参照表号
                           SELECT ooef008 INTO l_ooef008 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001=g_site
                           CALL s_date_get_work_date(g_site,l_ooef008,'2',g_sfaa_m.sfaa020,0,l_days) RETURNING g_sfaa_m.sfaa020 
                        END IF
                     ELSE
                        IF NOT cl_null(g_sfaa_m.sfaa019) THEN
                           CALL s_asft300_06('1',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa019) RETURNING l_success,g_sfaa_m.sfaa020
                        END IF
                     END IF
                  END IF
                  IF p_cmd = 'u' THEN
                     IF cl_ask_confirm('asf-00192') THEN
                        IF NOT cl_null(g_sfaa_m.sfaa020) THEN
                           CALL s_asft300_06('2',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020) RETURNING l_success,g_sfaa_m.sfaa019
                           IF g_sfaa_m.sfaa019 < g_sfaa_m.sfaadocdt THEN
                              LET l_days = g_sfaa_m.sfaadocdt - g_sfaa_m.sfaa019
                              LET g_sfaa_m.sfaa019 = g_sfaa_m.sfaadocdt        
                              #根据当前营运据点g_site抓取aooi120中设置的行事历参照表号
                              SELECT ooef008 INTO l_ooef008 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001=g_site
                              CALL s_date_get_work_date(g_site,l_ooef008,'2',g_sfaa_m.sfaa020,0,l_days) RETURNING g_sfaa_m.sfaa020 
                           END IF
                        ELSE
                           IF NOT cl_null(g_sfaa_m.sfaa019) THEN
                              CALL s_asft300_06('1',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa019) RETURNING l_success,g_sfaa_m.sfaa020
                           END IF
                        END IF
                     END IF
                  END IF
                  IF l_success THEN
                     LET g_sfaa_m_t.sfaa019 = g_sfaa_m.sfaa019
                     LET g_sfaa_m_t.sfaa020 = g_sfaa_m.sfaa020
                  END IF
                  DISPLAY BY NAME g_sfaa_m.sfaa019,g_sfaa_m.sfaa020
               END IF
               
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = g_sfaa_m.sfaa010
               CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa010_desc = '', g_rtn_fields[1] , ''
               DISPLAY BY NAME g_sfaa_m.sfaa010_desc
               
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = g_sfaa_m.sfaa010
               CALL ap_ref_array2(g_ref_fields,"SELECT imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa010_desc1 = '', g_rtn_fields[1] , ''
               DISPLAY BY NAME g_sfaa_m.sfaa010_desc1
               
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = g_sfaa_m.sfaa013
               CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa013_desc = '', g_rtn_fields[1] , ''
               DISPLAY BY NAME g_sfaa_m.sfaa013_desc
               
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = g_sfaa_m.sfaa060
               CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa060_desc = '', g_rtn_fields[1] , ''
               DISPLAY BY NAME g_sfaa_m.sfaa060_desc
               
               IF NOT cl_null(l_imae032) AND NOT cl_null(g_sfaa_m.sfaa016) THEN
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = l_imae032
                  LET g_ref_fields[2] = g_sfaa_m.sfaa016
                  CALL ap_ref_array2(g_ref_fields,"SELECT ecba003 FROM ecba_t WHERE ecbaent='"||g_enterprise||"' AND ecba001=? AND ecba002=? ","") RETURNING g_rtn_fields
                  LET g_sfaa_m.sfaa016_desc = '', g_rtn_fields[1] , ''
               ELSE
                  LET g_sfaa_m.sfaa016_desc = ''
               END IF
               DISPLAY BY NAME g_sfaa_m.sfaa016_desc
            END IF 
            CALL cl_set_comp_entry("sfaa016",TRUE)
            IF g_sfaa_m.sfaa061 = 'N' THEN
               CALL cl_set_comp_entry("sfaa016",FALSE)
            END IF 
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa010
            #add-point:BEFORE FIELD sfaa010
            
            CALL cl_set_comp_entry("sfaa010",TRUE)
            IF g_sfaa_m.sfaa005 MATCHES '[123]' THEN
               CALL cl_set_comp_entry("sfaa010",FALSE)
               IF cl_null(g_sfaa_m.sfaa006) OR cl_null(g_sfaa_m.sfaa007) OR cl_null(g_sfaa_m.sfaa008) OR cl_null(g_sfaa_m.sfaa063) THEN
                  INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00150'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

                  NEXT FIELD sfaa006
               END IF
            END IF           {#ADP版次:1#}
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfaa010
            #add-point:ON CHANGE sfaa010
            
            #END add-point

         #----<<sfaa011>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa011
            #add-point:BEFORE FIELD sfaa011
            CALL cl_set_comp_entry("sfaa011",TRUE)
            IF g_sfaa_m.sfaa005 MATCHES '[234]' THEN
               CALL cl_set_comp_entry("sfaa011",FALSE)
               IF cl_null(g_sfaa_m.sfaa006) OR cl_null(g_sfaa_m.sfaa007) OR cl_null(g_sfaa_m.sfaa008) OR cl_null(g_sfaa_m.sfaa063) THEN
                  INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00150'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

                  NEXT FIELD sfaa006
               END IF
            END IF
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa011

            #add-point:AFTER FIELD sfaa011
            IF cl_null(g_sfaa_m.sfaa011) THEN
               LET g_sfaa_m.sfaa011 = ' '
            END IF
            IF g_sfaa_m.sfaa011 IS NOT NULL AND (g_sfaa_m_t.sfaa011 IS NULL OR g_sfaa_m.sfaa011 != g_sfaa_m_t.sfaa011) THEN
            IF NOT cl_null(g_sfaa_m.sfaa010) THEN              
               IF g_sfaa_m.sfaa003 MATCHES '[145]' THEN
                  LET l_bmaa001 = ''
                  LET l_bmaastus = ''
                  LET l_sql = "SELECT bmaa001,bmaastus FROM bmaa_t WHERE bmaaent='",g_enterprise,"' AND bmaasite='",g_site,"'",
                              "   AND bmaa001='", g_sfaa_m.sfaa010,"' AND bmaa002='",g_sfaa_m.sfaa011,"'"
                  PREPARE sel_bmaa_pre1 FROM l_sql
                  EXECUTE sel_bmaa_pre1 INTO l_bmaa001,l_bmaastus
                  IF cl_null(l_bmaa001) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00045'
                     LET g_errparam.extend = g_sfaa_m.sfaa011
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfaa_m.sfaa011 = g_sfaa_m_t.sfaa011
                     NEXT FIELD sfaa011
                  END IF
                  IF cl_null(l_bmaastus) THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00045'
                     LET g_errparam.extend = g_sfaa_m.sfaa011
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfaa_m.sfaa011 = g_sfaa_m_t.sfaa011
                     NEXT FIELD sfaa011
                  END IF
               END IF
            END IF 
            END IF

            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa011
            #add-point:ON CHANGE sfaa011
            
            #END add-point
         BEFORE FIELD sfaa012
            LET g_sfaa_m_t.sfaa012 = g_sfaa_m.sfaa012
            
         #----<<sfaa012>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa012
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfaa_m.sfaa012,"0","0","","","azz-00079",1) THEN
               LET g_sfaa_m.sfaa012 = g_sfaa_m_t.sfaa012
               NEXT FIELD sfaa012
            END IF
            IF (NOT cl_null(g_sfaa_m.sfaa012) AND (cl_null(g_sfaa_m_t.sfaa012) OR g_sfaa_m.sfaa012 != g_sfaa_m_t.sfaa012)) OR l_flag5 = 'N' THEN
               IF NOT cl_null(g_sfaa_m.sfaa013) THEN
                  #单位取位
                  CALL s_aooi250_take_decimals(g_sfaa_m.sfaa013,g_sfaa_m.sfaa012)
                       RETURNING l_success,g_sfaa_m.sfaa012
               END IF
               LET l_sfaa012 = g_sfaa_m.sfaa012
               SELECT imae017,imae018,imae019 INTO l_imae017,l_imae018,l_imae019 FROM imae_t
                WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfaa_m.sfaa010
               IF NOT cl_null(l_imae018) THEN
                  IF g_sfaa_m.sfaa012 < l_imae018 THEN
                     LET l_sfaa012 = l_imae018
                  ELSE
                     LET l_sfaa012 = g_sfaa_m.sfaa012
                  END IF
               ELSE
                  LET l_sfaa012 = g_sfaa_m.sfaa012
               END IF
               
               IF NOT cl_null(l_imae017) AND l_imae017 != 0 THEN
                  LET l_n_sfaa012 = l_sfaa012 / l_imae017
                  IF l_sfaa012  != l_imae017 * l_n_sfaa012 THEN
                     IF l_sfaa012 > l_imae017 * l_n_sfaa012 THEN
                        LET l_sfaa012 = l_imae017 * (l_n_sfaa012 + 1)
                     ELSE
                        LET l_sfaa012 = l_imae017 * l_n_sfaa012
                     END IF
                  END IF
             # ELSE
             #    LET l_sfaa012 = g_sfaa_m.sfaa012
               END IF
               
               IF l_sfaa012 != g_sfaa_m.sfaa012 AND NOT cl_null(l_imae019) AND l_imae019 != '3' THEN
                  IF l_imae019 = '1' THEN
                     LET l_msg = cl_getmsg('asf-00332',g_lang),l_sfaa012 USING '---,---,---,--&.&&&'
                     IF cl_ask_promp(l_msg) THEN
                        LET g_sfaa_m.sfaa012 = l_sfaa012
                     END IF
                  END IF
                  IF l_imae019 = '2' THEN
                     LET l_msg = cl_getmsg('asf-00452',g_lang),l_sfaa012 USING '---,---,---,--&.&&&'
                     IF cl_ask_promp(l_msg) THEN
                        LET g_sfaa_m.sfaa012 = l_sfaa012
                     ELSE
                        LET l_flag5 = 'N'
                        NEXT FIELD sfaa012
                     END IF
                  END IF
               END IF
               LET l_flag5 = 'Y'
               
               IF NOT asft300_sfaa012_chk() THEN
                  LET g_sfaa_m.sfaa012 = g_sfaa_m_t.sfaa012
                  NEXT FIELD sfaa012
               END IF
               
               CALL asft300_sfaa058(g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa060) 
               
               IF NOT cl_null(g_sfaa_m.sfaa010) AND NOT cl_null(g_sfaa_m.sfaa012) THEN
                  IF p_cmd = 'a' THEN
                     IF NOT cl_null(g_sfaa_m.sfaa020) THEN
                        CALL s_asft300_06('2',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020) RETURNING l_success,g_sfaa_m.sfaa019
                        IF g_sfaa_m.sfaa019 < g_sfaa_m.sfaadocdt THEN
                           LET l_days = g_sfaa_m.sfaadocdt - g_sfaa_m.sfaa019
                           LET g_sfaa_m.sfaa019 = g_sfaa_m.sfaadocdt        
                           #根据当前营运据点g_site抓取aooi120中设置的行事历参照表号
                           SELECT ooef008 INTO l_ooef008 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001=g_site
                           CALL s_date_get_work_date(g_site,l_ooef008,'2',g_sfaa_m.sfaa020,0,l_days) RETURNING g_sfaa_m.sfaa020 
                        END IF
                     ELSE
                        IF NOT cl_null(g_sfaa_m.sfaa019) THEN
                           CALL s_asft300_06('1',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa019) RETURNING l_success,g_sfaa_m.sfaa020
                        END IF
                     END IF
                  END IF
                  IF p_cmd = 'u' THEN
                     IF cl_ask_confirm('asf-00193') THEN
                        IF NOT cl_null(g_sfaa_m.sfaa020) THEN
                           CALL s_asft300_06('2',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020) RETURNING l_success,g_sfaa_m.sfaa019
                           IF g_sfaa_m.sfaa019 < g_sfaa_m.sfaadocdt THEN
                              LET l_days = g_sfaa_m.sfaadocdt - g_sfaa_m.sfaa019
                              LET g_sfaa_m.sfaa019 = g_sfaa_m.sfaadocdt        
                              #根据当前营运据点g_site抓取aooi120中设置的行事历参照表号
                              SELECT ooef008 INTO l_ooef008 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001=g_site
                              CALL s_date_get_work_date(g_site,l_ooef008,'2',g_sfaa_m.sfaa020,0,l_days) RETURNING g_sfaa_m.sfaa020 
                           END IF
                        ELSE
                           IF NOT cl_null(g_sfaa_m.sfaa019) THEN
                              CALL s_asft300_06('1',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa019) RETURNING l_success,g_sfaa_m.sfaa020
                           END IF
                        END IF
                     END IF
                  END IF
                  IF l_success THEN
                     LET g_sfaa_m_t.sfaa019 = g_sfaa_m.sfaa019
                     LET g_sfaa_m_t.sfaa020 = g_sfaa_m.sfaa020
                  END IF
                  DISPLAY BY NAME g_sfaa_m.sfaa019,g_sfaa_m.sfaa020
               END IF
               IF g_inam.getLength() > 0 AND g_inam004_sum > 0 THEN
                  FOR l_j = 1 TO g_inam.getLength()
                     LET g_inam[l_j].inam004 = g_inam[l_j].inam004 * g_sfaa_m.sfaa012 / g_inam004_sum
                  END FOR
               END IF
            END IF
                  
         #----<<sfaa013>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa013
            #add-point:BEFORE FIELD sfaa013
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa013
            IF NOT cl_null(g_sfaa_m.sfaa013) AND (cl_null(g_sfaa_m_t.sfaa013) OR g_sfaa_m.sfaa013 != g_sfaa_m_t.sfaa013) THEN
               IF NOT asft300_chk_sfaa013(g_sfaa_m.sfaa013) THEN
                  LET g_sfaa_m.sfaa013 = g_sfaa_m_t.sfaa013
                  NEXT FIELD sfaa013
               END IF
               CALL asft300_sfaa058(g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa060)
               
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = g_sfaa_m.sfaa013
               CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa013_desc = '', g_rtn_fields[1] , ''
               DISPLAY BY NAME g_sfaa_m.sfaa013_desc
            END IF 
           
         #此段落由子樣板a04產生
         ON CHANGE sfaa013
            #add-point:ON CHANGE sfaa013
            
            #END add-point

         #----<<sfaa058>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa058
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfaa_m.sfaa058,"0","0","","","azz-00079",1) THEN
               LET g_sfaa_m.sfaa058 = g_sfaa_m_t.sfaa058
               NEXT FIELD sfaa058
            END IF
            IF NOT cl_null(g_sfaa_m.sfaa060) THEN
               #单位取位
               CALL s_aooi250_take_decimals(g_sfaa_m.sfaa060,g_sfaa_m.sfaa058)
                    RETURNING l_success,g_sfaa_m.sfaa058
            END IF
            #add-point:AFTER FIELD sfaa058
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa058
            #add-point:BEFORE FIELD sfaa058
            CALL cl_set_comp_entry('sfaa058',TRUE)
            IF cl_null(g_sfaa_m.sfaa060) THEN
               CALL cl_set_comp_entry('sfaa058',FALSE)
            END IF
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfaa058
            #add-point:ON CHANGE sfaa058
            
            #END add-point

         #----<<sfaa060>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa060
            #add-point:BEFORE FIELD sfaa060
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa060
            IF NOT cl_null(g_sfaa_m.sfaa060) AND (cl_null(g_sfaa_m_t.sfaa060) OR g_sfaa_m.sfaa060 != g_sfaa_m_t.sfaa060) THEN
               IF NOT asft300_chk_sfaa013(g_sfaa_m.sfaa060) THEN
                  LET g_sfaa_m.sfaa060 = g_sfaa_m_t.sfaa060
                  NEXT FIELD sfaa060
               END IF
               
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = g_sfaa_m.sfaa060
               CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa060_desc = '', g_rtn_fields[1] , ''
               DISPLAY BY NAME g_sfaa_m.sfaa060_desc
            END IF


         #此段落由子樣板a04產生
         ON CHANGE sfaa060
            #add-point:ON CHANGE sfaa060
            
            #END add-point

         #----<<sfaa061>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa061
            #add-point:BEFORE FIELD sfaa061
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa061

            #add-point:AFTER FIELD sfaa061
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa061
            #add-point:ON CHANGE sfaa061
            
            #END add-point

         #----<<sfaa016>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa016
            IF NOT cl_null(g_sfaa_m.sfaa016) AND (cl_null(g_sfaa_m_t.sfaa016) OR g_sfaa_m.sfaa016 != g_sfaa_m_t.sfaa016) THEN
               #抓制程料号
               SELECT imae032 INTO l_imae032 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
               IF cl_null(l_imae032) THEN
                  LET l_imae032 = g_sfaa_m.sfaa010
               END IF
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = g_site
               LET g_chkparam.arg2 = l_imae032
               LET g_chkparam.arg3 = g_sfaa_m.sfaa016
              #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ecba002_1") THEN
                  #檢查成功時後續處理
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = l_imae032
                  LET g_ref_fields[2] = g_sfaa_m.sfaa016
                  CALL ap_ref_array2(g_ref_fields,"SELECT ecba003 FROM ecba_t WHERE ecbaent='"||g_enterprise||"' AND ecba001=? AND ecba002=? ","") RETURNING g_rtn_fields
                  LET g_sfaa_m.sfaa016_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfaa_m.sfaa016_desc
               ELSE
                  #檢查失敗時後續處理
                  LET g_sfaa_m.sfaa016 = g_sfaa_m_t.sfaa016
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = l_imae032
                  LET g_ref_fields[2] = g_sfaa_m.sfaa016
                  CALL ap_ref_array2(g_ref_fields,"SELECT ecba003 FROM ecba_t WHERE ecbaent='"||g_enterprise||"' AND ecba001=? AND ecba002=? ","") RETURNING g_rtn_fields
                  LET g_sfaa_m.sfaa016_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfaa_m.sfaa016_desc
                  NEXT FIELD CURRENT
               END IF
            END IF

          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa016
            CALL cl_set_comp_entry("sfaa016",TRUE)
            IF g_sfaa_m.sfaa061 = 'N' THEN
               CALL cl_set_comp_entry("sfaa016",FALSE)
            END IF 
            IF cl_null(g_sfaa_m.sfaa010) THEN
               NEXT FIELD sfaa010
            END IF 

         #此段落由子樣板a04產生
         ON CHANGE sfaa016
            #add-point:ON CHANGE sfaa016
            
            #END add-point

         #----<<sfaa017>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa017
            IF NOT cl_null(g_sfaa_m.sfaa017) AND (cl_null(g_sfaa_m_t.sfaa017) OR g_sfaa_m.sfaa017 != g_sfaa_m_t.sfaa017) THEN
               INITIALIZE g_chkparam.* TO NULL
               IF g_sfaa_m.sfaa057 = '2' THEN 
                  LET g_chkparam.arg1 = g_sfaa_m.sfaa017
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_pmaa001_1") THEN
                     CALL cl_ref_val("v_pmaal004")
                     LET g_sfaa_m.sfaa017_desc = g_chkparam.return1
                     DISPLAY BY NAME g_sfaa_m.sfaa017_desc
                  ELSE
                     LET g_sfaa_m.sfaa017 = g_sfaa_m_t.sfaa017
                     NEXT FIELD sfaa017 
                  END IF 
               ELSE
                  LET g_chkparam.arg1 = g_sfaa_m.sfaa017
                  LET g_chkparam.arg2 = g_today
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_ooeg001_2") THEN
                     CALL s_desc_get_department_desc(g_sfaa_m.sfaa017) RETURNING g_sfaa_m.sfaa017_desc
                     DISPLAY BY NAME g_sfaa_m.sfaa017_desc
                  ELSE
                     LET g_sfaa_m.sfaa017 = g_sfaa_m_t.sfaa017
                     NEXT FIELD sfaa017
                  END IF
               END IF
            END IF 


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa017
            #add-point:BEFORE FIELD sfaa017
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfaa017
            #add-point:ON CHANGE sfaa017
            
            #END add-point

         #----<<sfaa018>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa018
            IF g_sfaa_m.sfaa057 = '2' THEN
               CALL cl_set_comp_entry("sfaa018",TRUE)
            ELSE
               CALL cl_set_comp_entry("sfaa018",FALSE)
            END IF

         #此段落由子樣板a02產生
         AFTER FIELD sfaa018
            IF NOT cl_null(g_sfaa_m.sfaa018) AND (cl_null(g_sfaa_m_t.sfaa018) OR g_sfaa_m.sfaa018 != g_sfaa_m_t.sfaa018) THEN
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = g_sfaa_m.sfaa018
              #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooef001") THEN
                  SELECT ooef017 INTO l_ooef017 FROM ooef_t WHERE ooefent = g_enterprise
                     AND ooef001 = g_sfaa_m.sfaa018
                  SELECT ooef017 INTO l_ooef017_1 FROM ooef_t WHERE ooefent = g_enterprise
                     AND ooef001 = g_site
                  IF l_ooef017 = l_ooef017_1 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00057'
                     LET g_errparam.extend = g_sfaa_m.sfaa018
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     NEXT FIELD sfaa018
                  END IF 
                  SELECT ooeal003 INTO g_sfaa_m.sfaa018_desc FROM ooeal_t
                   WHERE ooealent = g_enterprise AND ooeal001 = g_sfaa_m.sfaa018 AND ooeal002 = g_lang
                  DISPLAY BY NAME g_sfaa_m.sfaa018_desc
               ELSE
                  LET g_sfaa_m.sfaa018 = g_sfaa_m_t.sfaa018
                  NEXT FIELD sfaa018
               END IF
            END IF                

         #此段落由子樣板a04產生
         ON CHANGE sfaa018
            #add-point:ON CHANGE sfaa018
            
            #END add-point

         #----<<sfaa019>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa019
            #add-point:BEFORE FIELD sfaa019
            LET g_sfaa_m_t.sfaa019 = g_sfaa_m.sfaa019
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa019
            IF NOT cl_null(g_sfaa_m.sfaa019) AND (cl_null(g_sfaa_m_t.sfaa019) OR g_sfaa_m.sfaa019 != g_sfaa_m_t.sfaa019) THEN
               IF cl_ask_confirm('asf-00142') THEN
                  CALL s_asft300_06('1',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa019) RETURNING l_success,g_sfaa_m.sfaa020
                  IF l_success THEN
                     LET g_sfaa_m_t.sfaa020 = g_sfaa_m.sfaa020
                  END IF
               END IF
               IF g_sfaa_m.sfaa019 > g_sfaa_m.sfaa020 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00058'
                  LET g_errparam.extend = g_sfaa_m.sfaa019
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfaa_m.sfaa019 = g_sfaa_m_t.sfaa019
                  NEXT FIELD sfaa019
               END IF
               IF NOT cl_null(g_sfaa_m.sfaadocdt) THEN
                  IF g_sfaa_m.sfaadocdt > g_sfaa_m.sfaa019 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00308'
                     LET g_errparam.extend = g_sfaa_m.sfaa019
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
           
         #此段落由子樣板a04產生
         ON CHANGE sfaa019
            #add-point:ON CHANGE sfaa019
            
            #END add-point

         #----<<sfaa020>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa020
            #add-point:BEFORE FIELD sfaa020
            LET g_sfaa_m_t.sfaa020 = g_sfaa_m.sfaa020
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa020
            IF NOT cl_null(g_sfaa_m.sfaa020) AND (cl_null(g_sfaa_m_t.sfaa020) OR g_sfaa_m.sfaa020 != g_sfaa_m_t.sfaa020) THEN
               IF cl_ask_confirm('asf-00143') THEN
                  CALL s_asft300_06('2',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020) RETURNING l_success,g_sfaa_m.sfaa019
                  IF g_sfaa_m.sfaa019 < g_sfaa_m.sfaadocdt THEN
                     LET g_sfaa_m.sfaa019 = g_sfaa_m.sfaadocdt        
                  END IF
               END IF
               IF g_sfaa_m.sfaa020 < g_sfaa_m.sfaa019 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00058'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfaa_m.sfaa020 = g_sfaa_m_t.sfaa020
                  LET g_sfaa_m.sfaa019 = g_sfaa_m_t.sfaa019
                  NEXT FIELD sfaa020
               END IF
            END IF


         #此段落由子樣板a04產生
         ON CHANGE sfaa020
            #add-point:ON CHANGE sfaa020
            
            #END add-point

         #----<<sfaa014>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa014
            #add-point:BEFORE FIELD sfaa014
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa014
            IF NOT cl_null(g_sfaa_m.sfaa014) AND NOT cl_null(g_sfaa_m.sfaa010) AND g_sfaa_m.sfaa011 IS NOT NULL THEN            
               IF NOT asft300_chk_sfaa014() THEN
                  LET g_sfaa_m.sfaa014 = g_sfaa_m_t.sfaa014
                  NEXT FIELD sfaa014
               END IF
            END IF 


         #此段落由子樣板a04產生
         ON CHANGE sfaa014
            #add-point:ON CHANGE sfaa014
            
            #END add-point

         #----<<sfaa028>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa028
            #add-point:BEFORE FIELD sfaa028
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa028
            IF NOT cl_null(g_sfaa_m.sfaa028) AND (cl_null(g_sfaa_m_t.sfaa028) OR g_sfaa_m.sfaa028 != g_sfaa_m_t.sfaa028) THEN
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = g_sfaa_m.sfaa028
              #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_pjba001") THEN
                  #檢查成功時後續處理
                  CALL asft300_sfaa028_desc(g_sfaa_m.sfaa028) 
               ELSE
                  #檢查失敗時後續處理
                  LET g_sfaa_m.sfaa028 = g_sfaa_m_t.sfaa028
                  CALL asft300_sfaa028_desc(g_sfaa_m.sfaa028)
                  NEXT FIELD CURRENT
               END IF
            END IF

         #此段落由子樣板a04產生
         ON CHANGE sfaa028
            #add-point:ON CHANGE sfaa028
            
            #END add-point

         #----<<sfaa015>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa015
            #add-point:BEFORE FIELD sfaa015
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa015

            #add-point:AFTER FIELD sfaa015
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa015
            #add-point:ON CHANGE sfaa015
            
            #END add-point

         #----<<sfaa029>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa029
            #add-point:BEFORE FIELD sfaa029
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa029
            IF NOT cl_null(g_sfaa_m.sfaa029) AND (cl_null(g_sfaa_m_t.sfaa029) OR g_sfaa_m.sfaa029 != g_sfaa_m_t.sfaa029) THEN
               IF NOT cl_null(g_sfaa_m.sfaa028) THEN
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_chkparam.arg1 = g_sfaa_m.sfaa028
                  LET g_chkparam.arg2 = g_sfaa_m.sfaa029 
                 #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_pjbb002") THEN
                     #檢查成功時後續處理
                     CALL asft300_sfaa029_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa029) 
                  ELSE
                     #檢查失敗時後續處理
                     LET g_sfaa_m.sfaa029 = g_sfaa_m_t.sfaa029
                     CALL asft300_sfaa029_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa029)
                     NEXT FIELD CURRENT
                  END IF
               END IF 
            END IF


         #此段落由子樣板a04產生
         ON CHANGE sfaa029
            #add-point:ON CHANGE sfaa029
            
            #END add-point

         #----<<sfaa026>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa026
            #add-point:BEFORE FIELD sfaa026
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa026

            #add-point:AFTER FIELD sfaa026
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa026
            #add-point:ON CHANGE sfaa026
            
            #END add-point

         #----<<sfaa030>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa030
            #add-point:BEFORE FIELD sfaa030
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa030

            #add-point:AFTER FIELD sfaa030
            IF NOT cl_null(g_sfaa_m.sfaa030) AND (cl_null(g_sfaa_m_t.sfaa030) OR g_sfaa_m.sfaa030 != g_sfaa_m_t.sfaa030) THEN
               IF NOT cl_null(g_sfaa_m.sfaa028) THEN
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_chkparam.arg1 = g_sfaa_m.sfaa028
                  LET g_chkparam.arg2 = g_sfaa_m.sfaa030 
                 #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_pjbm002") THEN
                     #檢查成功時後續處理
                     CALL asft300_sfaa030_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa030) 
                  ELSE
                     #檢查失敗時後續處理
                     LET g_sfaa_m.sfaa030 = g_sfaa_m_t.sfaa030
                     CALL asft300_sfaa030_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa030)
                     NEXT FIELD CURRENT
                  END IF
               END IF 
            END IF
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa030
            #add-point:ON CHANGE sfaa030
            
            #END add-point


         #----<<sfaa031>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa031
            

         #此段落由子樣板a02產生
         AFTER FIELD sfaa031

            #add-point:AFTER FIELD sfaa031
            IF NOT cl_null(g_sfaa_m.sfaa031) AND (cl_null(g_sfaa_m_t.sfaa031) OR g_sfaa_m.sfaa031 != g_sfaa_m_t.sfaa031) THEN
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = '225'
               LET g_chkparam.arg2 = g_sfaa_m.sfaa031
               IF NOT cl_chk_exist("v_oocq002_1") THEN
                  LET g_sfaa_m.sfaa031 = g_sfaa_m_t.sfaa031
                  NEXT FIELD sfaa031
               END IF
            END IF
            LET g_sfaa_m.sfaa031_desc = s_desc_get_acc_desc('225',g_sfaa_m.sfaa031)
            DISPLAY BY NAME g_sfaa_m.sfaa031_desc
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa031
            #add-point:ON CHANGE sfaa031
            
            #END add-point

         #----<<sfaa062>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa062
            #add-point:BEFORE FIELD sfaa062
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa062

            #add-point:AFTER FIELD sfaa062
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa062
            #add-point:ON CHANGE sfaa062
            
            #END add-point

         #----<<sfaa032>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa032
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfaa_m.sfaa032,"0","1","100","1","azz-00087",1) THEN
               LET g_sfaa_m.sfaa032 = g_sfaa_m_t.sfaa032
               NEXT FIELD sfaa032
            END IF


            #add-point:AFTER FIELD sfaa032
            IF NOT cl_null(g_sfaa_m.sfaa032) THEN
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa032
            #add-point:BEFORE FIELD sfaa032
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfaa032
            #add-point:ON CHANGE sfaa032
            
            #END add-point
         
         AFTER FIELD sfaa068
            IF NOT cl_null(g_sfaa_m.sfaa068) THEN
              #校验
              INITIALIZE g_chkparam.* TO NULL
              LET g_chkparam.arg1 = g_sfaa_m.sfaa068
              LET g_chkparam.arg2 = cl_get_today()
              IF NOT cl_chk_exist("v_ooeg001_4") THEN
                 LET g_sfaa_m.sfaa068 = g_sfaa_m_t.sfaa068
                 NEXT FIELD sfaa068
              END IF
           END IF
           SELECT ooefl003 INTO g_sfaa_m.sfaa068_desc FROM ooefl_t 
            WHERE ooeflent = g_enterprise AND ooefl001 = g_sfaa_m.sfaa068 AND ooefl002 = g_lang
           DISPLAY BY NAME g_sfaa_m.sfaa068_desc
         
         #----<<sfaa033>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfaa033
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfaa_m.sfaa033,"0","0","","","azz-00079",1) THEN
               LET g_sfaa_m.sfaa033 = g_sfaa_m_t.sfaa033
               NEXT FIELD sfaa033
            END IF


            #add-point:AFTER FIELD sfaa033
            IF NOT cl_null(g_sfaa_m.sfaa033) THEN
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfaa033
            #add-point:BEFORE FIELD sfaa033
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfaa033
            #add-point:ON CHANGE sfaa033
            
            #END add-point

         #----<<sfaa034>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa034
            #add-point:BEFORE FIELD sfaa034
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa034
            IF NOT cl_null(g_sfaa_m.sfaa034) AND (cl_null(g_sfaa_m_t.sfaa034) OR g_sfaa_m.sfaa034 != g_sfaa_m_t.sfaa034) THEN
               IF asft300_chk_warehouses() THEN
                  LET g_sfaa_m.sfaa034_desc = s_desc_get_stock_desc(g_site,g_sfaa_m.sfaa034)
                  DISPLAY BY NAME g_sfaa_m.sfaa034_desc
               ELSE
                  LET g_sfaa_m.sfaa034 = g_sfaa_m_t.sfaa034
                  LET g_sfaa_m.sfaa034_desc = s_desc_get_stock_desc(g_site,g_sfaa_m.sfaa034)
                  DISPLAY BY NAME g_sfaa_m.sfaa034_desc
                  NEXT FIELD sfaa034
               END IF
            END IF                

         #此段落由子樣板a04產生
         ON CHANGE sfaa034
            #add-point:ON CHANGE sfaa034
            
            #END add-point

         #----<<sfaa035>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa035
            #add-point:BEFORE FIELD sfaa035
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa035
            IF g_sfaa_m.sfaa035 IS NOT NULL AND (cl_null(g_sfaa_m_t.sfaa035) OR g_sfaa_m.sfaa035 != g_sfaa_m_t.sfaa035) THEN
               IF asft300_chk_warehouses() THEN
                  LET g_sfaa_m.sfaa035_desc = s_desc_get_locator_desc(g_site,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035)
                  DISPLAY BY NAME g_sfaa_m.sfaa035_desc
               ELSE
                  LET g_sfaa_m.sfaa035 = g_sfaa_m_t.sfaa035
                  LET g_sfaa_m.sfaa035_desc = s_desc_get_locator_desc(g_site,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035)
                  DISPLAY BY NAME g_sfaa_m.sfaa035_desc
                  NEXT FIELD sfaa035
               END IF
            END IF 

         #此段落由子樣板a04產生
         ON CHANGE sfaa035
            #add-point:ON CHANGE sfaa035
            
            #END add-point

         #----<<sfaa059>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa059
            #add-point:BEFORE FIELD sfaa059
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa059

            #add-point:AFTER FIELD sfaa059
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa059
            #add-point:ON CHANGE sfaa059
            
            #END add-point

         #----<<sfaa036>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa036
            #add-point:BEFORE FIELD sfaa036
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa036

            #add-point:AFTER FIELD sfaa036
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa036
            #add-point:ON CHANGE sfaa036
            
            #END add-point

         #----<<sfaa037>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa037
            #add-point:BEFORE FIELD sfaa037
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa037

            #add-point:AFTER FIELD sfaa037
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa037
            #add-point:ON CHANGE sfaa037
            
            #END add-point

         #----<<sfaa038>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa038
            #add-point:BEFORE FIELD sfaa038
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa038

            #add-point:AFTER FIELD sfaa038
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa038
            #add-point:ON CHANGE sfaa038
            
            #END add-point

         #----<<sfaa039>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa039
            #add-point:BEFORE FIELD sfaa039
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa039

            #add-point:AFTER FIELD sfaa039
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa039
            #add-point:ON CHANGE sfaa039
            
            #END add-point

         #----<<sfaa040>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa040
            #add-point:BEFORE FIELD sfaa040
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa040

            #add-point:AFTER FIELD sfaa040
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa040
            #add-point:ON CHANGE sfaa040
            
            #END add-point

         #----<<sfaa041>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa041
            #add-point:BEFORE FIELD sfaa041
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa041

            #add-point:AFTER FIELD sfaa041
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa041
            #add-point:ON CHANGE sfaa041
            
            #END add-point

         #----<<sfaa042>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa042
            #add-point:BEFORE FIELD sfaa042
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa042

            #add-point:AFTER FIELD sfaa042
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa042
            #add-point:ON CHANGE sfaa042
            
            #END add-point

         #----<<sfaa043>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa043
            #add-point:BEFORE FIELD sfaa043
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa043

            #add-point:AFTER FIELD sfaa043
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa043
            #add-point:ON CHANGE sfaa043
            
            #END add-point

         #----<<sfaa044>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa044
            #add-point:BEFORE FIELD sfaa044
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa044

            #add-point:AFTER FIELD sfaa044
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa044
            #add-point:ON CHANGE sfaa044
            
            #END add-point

         #----<<sfaa045>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa045
            #add-point:BEFORE FIELD sfaa045
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa045

            #add-point:AFTER FIELD sfaa045
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa045
            #add-point:ON CHANGE sfaa045
            
            #END add-point

         #----<<sfaa049>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa049
            #add-point:BEFORE FIELD sfaa049
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa049

            #add-point:AFTER FIELD sfaa049
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa049
            #add-point:ON CHANGE sfaa049
            
            #END add-point

         #----<<sfaa046>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa046
            #add-point:BEFORE FIELD sfaa046
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa046

            #add-point:AFTER FIELD sfaa046
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa046
            #add-point:ON CHANGE sfaa046
            
            #END add-point

         #----<<sfaa050>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa050
            #add-point:BEFORE FIELD sfaa050
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa050

            #add-point:AFTER FIELD sfaa050
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa050
            #add-point:ON CHANGE sfaa050
            
            #END add-point

         #----<<sfaa047>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa047
            #add-point:BEFORE FIELD sfaa047
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa047

            #add-point:AFTER FIELD sfaa047
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa047
            #add-point:ON CHANGE sfaa047
            
            #END add-point

         #----<<sfaa051>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa051
            #add-point:BEFORE FIELD sfaa051
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa051

            #add-point:AFTER FIELD sfaa051
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa051
            #add-point:ON CHANGE sfaa051
            
            #END add-point

         #----<<sfaa048>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa048
            #add-point:BEFORE FIELD sfaa048
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa048

            #add-point:AFTER FIELD sfaa048
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa048
            #add-point:ON CHANGE sfaa048
            
            #END add-point

         #----<<sfaa055>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa055
            #add-point:BEFORE FIELD sfaa055
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa055

            #add-point:AFTER FIELD sfaa055
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa055
            #add-point:ON CHANGE sfaa055
            
            #END add-point

         #----<<sfaa056>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaa056
            #add-point:BEFORE FIELD sfaa056
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaa056

            #add-point:AFTER FIELD sfaa056
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfaa056
            #add-point:ON CHANGE sfaa056
            
            #END add-point

         #----<<sfaaownid>>----
         #----<<sfaaowndp>>----
         #----<<sfaacrtid>>----
         #----<<sfaacrtdp>>----
         #----<<sfaacrtdt>>----
         #----<<sfaamodid>>----
         #----<<sfaamoddt>>----
         #----<<sfaacnfid>>----
         #----<<sfaacnfdt>>----
         #----<<sfaapstid>>----
         #----<<sfaapstdt>>----
 #欄位檢查
         #---------------------------<  Master  >---------------------------
         #----<<sfaadocno>>----
         #Ctrlp:input.c.sfaadocno
         ON ACTION controlp INFIELD sfaadocno
            #add-point:ON ACTION controlp INFIELD sfaadocno
#此段落由子樣板a07產生
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaadocno             #給予default值

            #給予arg
            SELECT ooef004 INTO l_ooef004 FROM ooef_t
             WHERE ooef001 = g_site
               AND ooefent  = g_enterprise
            LET g_qryparam.arg1 = l_ooef004 #參照表編號
            LET g_qryparam.arg2 = g_prog    #作业代号

            CALL q_ooba002_1()                                #呼叫開窗

            LET g_sfaa_m.sfaadocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaadocno TO sfaadocno              #顯示到畫面上

            NEXT FIELD sfaadocno                          #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #----<<sfaa001>>----
         #Ctrlp:input.c.sfaa001
#         ON ACTION controlp INFIELD sfaa001
            #add-point:ON ACTION controlp INFIELD sfaa001
            
            #END add-point

         #----<<sfaadocdt>>----
         #Ctrlp:input.c.sfaadocdt
#         ON ACTION controlp INFIELD sfaadocdt
            #add-point:ON ACTION controlp INFIELD sfaadocdt
            
            #END add-point

         #----<<sfaa003>>----
         #Ctrlp:input.c.sfaa003
#         ON ACTION controlp INFIELD sfaa003
            #add-point:ON ACTION controlp INFIELD sfaa003
            
            #END add-point

         #----<<sfaa057>>----
         #Ctrlp:input.c.sfaa057
#         ON ACTION controlp INFIELD sfaa057
            #add-point:ON ACTION controlp INFIELD sfaa057
            
            #END add-point

         #----<<sfaa002>>----
         #Ctrlp:input.c.sfaa002
         ON ACTION controlp INFIELD sfaa002
            #add-point:ON ACTION controlp INFIELD sfaa002
#此段落由子樣板a07產生
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa002             #給予default值

            #給予arg

            CALL q_ooag001()                                #呼叫開窗

            LET g_sfaa_m.sfaa002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa002 TO sfaa002              #顯示到畫面上

            NEXT FIELD sfaa002                          #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #----<<sfaa004>>----
         #Ctrlp:input.c.sfaa004
#         ON ACTION controlp INFIELD sfaa004
            #add-point:ON ACTION controlp INFIELD sfaa004
            
            #END add-point

         #----<<sfaastus>>----
         #Ctrlp:input.c.sfaastus
#         ON ACTION controlp INFIELD sfaastus
            #add-point:ON ACTION controlp INFIELD sfaastus
            
            #END add-point

         #----<<sfaa005>>----
         #Ctrlp:input.c.sfaa005
#         ON ACTION controlp INFIELD sfaa005
            #add-point:ON ACTION controlp INFIELD sfaa005
            
            #END add-point

         #----<<sfaa006>>----
         #Ctrlp:input.c.sfaa006
         ON ACTION controlp INFIELD sfaa006
            #add-point:ON ACTION controlp INFIELD sfaa006
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa006             #給予default值
            LET g_qryparam.default2 = g_sfaa_m.sfaa007             #給予default值
            LET g_qryparam.default3 = g_sfaa_m.sfaa008             #給予default值
            LET g_qryparam.default4 = g_sfaa_m.sfaa063             #給予default值
            #給予arg
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfaa_m.sfaa006 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfaa_m.sfaa007 = g_qryparam.return2
            LET g_sfaa_m.sfaa008 = g_qryparam.return3
            LET g_sfaa_m.sfaa063 = g_qryparam.return4
            DISPLAY g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063 TO sfaa006,sfaa007,sfaa008,sfaa063             #顯示到畫面上
            NEXT FIELD sfaa006                          #返回原欄位
            
            #END add-point

         #----<<sfaa007>>----
         #Ctrlp:input.c.sfaa007
         ON ACTION controlp INFIELD sfaa007
            #add-point:ON ACTION controlp INFIELD sfaa007
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa006             #給予default值
            LET g_qryparam.default2 = g_sfaa_m.sfaa007             #給予default值
            LET g_qryparam.default3 = g_sfaa_m.sfaa008             #給予default值
            LET g_qryparam.default4 = g_sfaa_m.sfaa063             #給予default值
            #給予arg
            IF NOT cl_null(g_sfaa_m.sfaa006) THEN
               LET g_qryparam.where = "xmdddocno='",g_sfaa_m.sfaa006,"'"
            END IF
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfaa_m.sfaa006 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfaa_m.sfaa007 = g_qryparam.return2
            LET g_sfaa_m.sfaa008 = g_qryparam.return3
            LET g_sfaa_m.sfaa063 = g_qryparam.return4
            DISPLAY g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063 TO sfaa006,sfaa007,sfaa008,sfaa063              #顯示到畫面上
            NEXT FIELD sfaa007                          #返回原欄位
            #END add-point

         #----<<sfaa008>>----
         #Ctrlp:input.c.sfaa008
         ON ACTION controlp INFIELD sfaa008
            #add-point:ON ACTION controlp INFIELD sfaa008
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa006             #給予default值
            LET g_qryparam.default2 = g_sfaa_m.sfaa007             #給予default值
            LET g_qryparam.default3 = g_sfaa_m.sfaa008             #給予default值
            LET g_qryparam.default4 = g_sfaa_m.sfaa063             #給予default值
            #給予arg
            IF NOT cl_null(g_sfaa_m.sfaa006) THEN
               LET g_qryparam.where = " xmdddocno='",g_sfaa_m.sfaa006,"'"
            END IF
            IF NOT cl_null(g_sfaa_m.sfaa007) THEN
               IF NOT cl_null(g_qryparam.where) THEN
                  LET g_qryparam.where = g_qryparam.where," AND xmddseq=",g_sfaa_m.sfaa007
               ELSE
                  LET g_qryparam.where = " xmddseq=",g_sfaa_m.sfaa007
               END IF
            END IF
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfaa_m.sfaa006 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfaa_m.sfaa007 = g_qryparam.return2
            LET g_sfaa_m.sfaa008 = g_qryparam.return3
            LET g_sfaa_m.sfaa063 = g_qryparam.return4
            DISPLAY g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063 TO sfaa006,sfaa007,sfaa008,sfaa063              #顯示到畫面上
            NEXT FIELD sfaa008                          #返回原欄位            
            #END add-point
 
         ON ACTION controlp INFIELD sfaa063
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa006             #給予default值
            LET g_qryparam.default2 = g_sfaa_m.sfaa007             #給予default值
            LET g_qryparam.default3 = g_sfaa_m.sfaa008             #給予default值
            LET g_qryparam.default4 = g_sfaa_m.sfaa063             #給予default值
            #給予arg
            IF NOT cl_null(g_sfaa_m.sfaa006) THEN
               LET g_qryparam.where = "xmdddocno='",g_sfaa_m.sfaa006,"'"
            END IF
            IF NOT cl_null(g_sfaa_m.sfaa007) THEN
               IF NOT cl_null(g_qryparam.where) THEN
                  LET g_qryparam.where = g_qryparam.where," AND xmddseq=",g_sfaa_m.sfaa007
               ELSE
                  LET g_qryparam.where = " xmddseq=",g_sfaa_m.sfaa007
               END IF
            END IF
            IF NOT cl_null(g_sfaa_m.sfaa008) THEN
               IF NOT cl_null(g_qryparam.where) THEN
                  LET g_qryparam.where = g_qryparam.where," AND xmddseq1=",g_sfaa_m.sfaa008
               ELSE
                  LET g_qryparam.where = " xmddseq1=",g_sfaa_m.sfaa008
               END IF
            END IF
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfaa_m.sfaa006 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfaa_m.sfaa007 = g_qryparam.return2
            LET g_sfaa_m.sfaa008 = g_qryparam.return3
            LET g_sfaa_m.sfaa063 = g_qryparam.return4
            DISPLAY g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063 TO sfaa006,sfaa007,sfaa008,sfaa063              #顯示到畫面上
            NEXT FIELD sfaa063                          #返回原欄位

         ON ACTION controlp INFIELD l_sfaa007
            #开窗选择
            IF NOT cl_null(g_sfaa_m.sfaa006) THEN
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'i'
			      LET g_qryparam.reqry = FALSE
               LET g_qryparam.where = " xmdddocno = '",g_sfaa_m.sfaa006,"'"
               CALL q_xmdddocno()                                #呼叫開窗        
               LET g_sfaa_m.sfaa006 = g_qryparam.return1              #將開窗取得的值回傳到變數
               LET g_sfaa_m.sfaa007 = g_qryparam.return2
               LET g_sfaa_m.sfaa008 = g_qryparam.return3
               LET g_sfaa_m.sfaa063 = g_qryparam.return4
               LET l_sfaa007_str = g_sfaa_m.sfaa007
               LET l_sfaa008_str = g_sfaa_m.sfaa008
               LET l_sfaa063_str = g_sfaa_m.sfaa063
               LET g_sfaa_m.l_sfaa007 = l_sfaa007_str CLIPPED,"-",l_sfaa008_str CLIPPED,"-",l_sfaa063_str CLIPPED
               DISPLAY BY NAME g_sfaa_m.l_sfaa007
               NEXT FIELD l_sfaa007
            END IF   
            
         #----<<sfaa009>>----
         #Ctrlp:input.c.sfaa009
         ON ACTION controlp INFIELD sfaa009
            #add-point:ON ACTION controlp INFIELD sfaa009
#此段落由子樣板a07產生
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa009             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_site
            CALL q_pmaa001_6()                                #呼叫開窗

            LET g_sfaa_m.sfaa009 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa009 TO sfaa009              #顯示到畫面上

            NEXT FIELD sfaa009                          #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #----<<sfaa022>>----
         #Ctrlp:input.c.sfaa022
#         ON ACTION controlp INFIELD sfaa022
            #add-point:ON ACTION controlp INFIELD sfaa022
            
            #END add-point

         #----<<sfaa023>>----
         #Ctrlp:input.c.sfaa023
#         ON ACTION controlp INFIELD sfaa023
            #add-point:ON ACTION controlp INFIELD sfaa023
            
            #END add-point

         #----<<sfaa024>>----
         #Ctrlp:input.c.sfaa024
#         ON ACTION controlp INFIELD sfaa024
            #add-point:ON ACTION controlp INFIELD sfaa024
            
            #END add-point

         #----<<sfaa021>>----
         #Ctrlp:input.c.sfaa021
#         ON ACTION controlp INFIELD sfaa021
            #add-point:ON ACTION controlp INFIELD sfaa021
            
            #END add-point

         #----<<sfaa025>>----
         #Ctrlp:input.c.sfaa025
         ON ACTION controlp INFIELD sfaa025
            #add-point:ON ACTION controlp INFIELD sfaa025
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa025             #給予default值
            #給予arg
            LET g_qryparam.arg1 = g_site
            CALL q_sfaadocno_2()                                #呼叫開窗

            LET g_sfaa_m.sfaa025 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa025 TO sfaa025              #顯示到畫面上

            NEXT FIELD sfaa025
            #END add-point

         #----<<sfaa010>>----
         #Ctrlp:input.c.sfaa010
         ON ACTION controlp INFIELD sfaa010
            #add-point:ON ACTION controlp INFIELD sfaa010
#此段落由子樣板a07產生
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa010             #給予default值

            #給予arg

            CALL q_imaf001_6()                                #呼叫開窗

            LET g_sfaa_m.sfaa010 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa010 TO sfaa010              #顯示到畫面上

            NEXT FIELD sfaa010                          #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #----<<sfaa011>>----
         #Ctrlp:input.c.sfaa011
#         ON ACTION controlp INFIELD sfaa011
            #add-point:ON ACTION controlp INFIELD sfaa011
            
            #END add-point

         #----<<sfaa012>>----
         #Ctrlp:input.c.sfaa012
#         ON ACTION controlp INFIELD sfaa012
            #add-point:ON ACTION controlp INFIELD sfaa012
            
            #END add-point

         #----<<sfaa013>>----
         #Ctrlp:input.c.sfaa013
         ON ACTION controlp INFIELD sfaa013
            #add-point:ON ACTION controlp INFIELD sfaa013
#此段落由子樣板a07產生
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa013             #給予default值

            #給予arg

            CALL q_ooca001()                                #呼叫開窗

            LET g_sfaa_m.sfaa013 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa013 TO sfaa013              #顯示到畫面上

            NEXT FIELD sfaa013                          #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #----<<sfaa058>>----
         #Ctrlp:input.c.sfaa058
#         ON ACTION controlp INFIELD sfaa058
            #add-point:ON ACTION controlp INFIELD sfaa058
            
            #END add-point

         #----<<sfaa060>>----
         #Ctrlp:input.c.sfaa060
         ON ACTION controlp INFIELD sfaa060
            #add-point:ON ACTION controlp INFIELD sfaa060
#此段落由子樣板a07產生
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_sfaa_m.sfaa060             #給予default值

            #給予arg

            CALL q_ooca001()                                #呼叫開窗

            LET g_sfaa_m.sfaa060 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_sfaa_m.sfaa060 TO sfaa060              #顯示到畫面上

            NEXT FIELD sfaa060                          #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #----<<sfaa061>>----
         #Ctrlp:input.c.sfaa061
#         ON ACTION controlp INFIELD sfaa061
            #add-point:ON ACTION controlp INFIELD sfaa061
            
            #END add-point

         #----<<sfaa016>>----
         #Ctrlp:input.c.sfaa016
         ON ACTION controlp INFIELD sfaa016
            #開窗i段
            #抓制程料号
            SELECT imae032 INTO l_imae032 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
            IF cl_null(l_imae032) THEN
               LET l_imae032 = g_sfaa_m.sfaa010
            END IF
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa016             #給予default值
            LET g_qryparam.arg1 = g_site
            LET g_qryparam.arg2 = l_imae032
            CALL q_ecba002_3()              
            LET g_sfaa_m.sfaa016 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_sfaa_m.sfaa016 TO sfaa016              #顯示到畫面上
            NEXT FIELD sfaa016 

         #----<<sfaa017>>----
         #Ctrlp:input.c.sfaa017
         ON ACTION controlp INFIELD sfaa017
            #開窗i段
			   INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa017             #給予default值
            IF g_sfaa_m.sfaa057 = '2' THEN
               LET g_qryparam.where = " (pmaa002 = '1' OR pmaa002 ='3') "
               CALL q_pmaa001()
            ELSE
               LET g_qryparam.arg1 = g_today
               CALL q_ooeg001()  
            END IF               
            LET g_sfaa_m.sfaa017 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_sfaa_m.sfaa017 TO sfaa017              #顯示到畫面上
            NEXT FIELD sfaa017 
         #----<<sfaa018>>----
         #Ctrlp:input.c.sfaa018
         ON ACTION controlp INFIELD sfaa018
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa018             #給予default值
            CALL q_ooef001()              
            LET g_sfaa_m.sfaa018 = g_qryparam.return1              #將開窗取得的值回傳到變數
            DISPLAY g_sfaa_m.sfaa018 TO sfaa018              #顯示到畫面上
            NEXT FIELD sfaa018

         #----<<sfaa019>>----
         #Ctrlp:input.c.sfaa019
#         ON ACTION controlp INFIELD sfaa019
            #add-point:ON ACTION controlp INFIELD sfaa019
            
            #END add-point

         #----<<sfaa020>>----
         #Ctrlp:input.c.sfaa020
#         ON ACTION controlp INFIELD sfaa020
            #add-point:ON ACTION controlp INFIELD sfaa020
            
            #END add-point

         #----<<sfaa014>>----
         #Ctrlp:input.c.sfaa014
#         ON ACTION controlp INFIELD sfaa014
            #add-point:ON ACTION controlp INFIELD sfaa014
            
            #END add-point

         #----<<sfaa028>>----
         #Ctrlp:input.c.sfaa028
         ON ACTION controlp INFIELD sfaa028
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa028             #給予default值
            CALL q_pjba001()                                #呼叫開窗
            LET g_sfaa_m.sfaa028 = g_qryparam.return1              #將開窗取得的值回傳到變數
            CALL asft300_sfaa028_desc(g_sfaa_m.sfaa028)
            DISPLAY g_sfaa_m.sfaa028 TO sfaa028              #顯示到畫面上
            NEXT FIELD sfaa028                          #返回原欄位           

         #----<<sfaa015>>----
         #Ctrlp:input.c.sfaa015
#         ON ACTION controlp INFIELD sfaa015
            #add-point:ON ACTION controlp INFIELD sfaa015
            
            #END add-point

         #----<<sfaa029>>----
         #Ctrlp:input.c.sfaa029
         ON ACTION controlp INFIELD sfaa029
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa029             #給予default值
            IF NOT cl_null(g_sfaa_m.sfaa028) THEN
               LET g_qryparam.where = " pjbb001 = '",g_sfaa_m.sfaa028,"'"
            END IF 
            CALL q_pjbb002()                                #呼叫開窗
            LET g_sfaa_m.sfaa029 = g_qryparam.return1              #將開窗取得的值回傳到變數
            CALL asft300_sfaa029_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa029)
            DISPLAY g_sfaa_m.sfaa029 TO sfaa029              #顯示到畫面上
            NEXT FIELD sfaa029                          #返回原欄位  

         #----<<sfaa026>>----
         #Ctrlp:input.c.sfaa026
#         ON ACTION controlp INFIELD sfaa026
            #add-point:ON ACTION controlp INFIELD sfaa026
            
            #END add-point

         #----<<sfaa030>>----
         #Ctrlp:input.c.sfaa030
         ON ACTION controlp INFIELD sfaa030
            #add-point:ON ACTION controlp INFIELD sfaa030
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa030             #給予default值
            #IF NOT cl_null(g_sfaa_m.sfaa028) THEN
            #   LET g_qryparam.where = " pjbm001 = '",g_sfaa_m.sfaa028,"'"
            #END IF 
            LET g_qryparam.arg1 = g_sfaa_m.sfaa028 #modify by lixiang 2015/06/17
            CALL q_pjbm002()  #modify by lixiang 2015/06/17
            #CALL q_pjbm01()                                #呼叫開窗
            LET g_sfaa_m.sfaa030 = g_qryparam.return1              #將開窗取得的值回傳到變數
            CALL asft300_sfaa030_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa030)
            DISPLAY g_sfaa_m.sfaa030 TO sfaa030              #顯示到畫面上
            NEXT FIELD sfaa030                          #返回原欄位
            #END add-point


         #----<<sfaa031>>----
         #Ctrlp:input.c.sfaa031
         ON ACTION controlp INFIELD sfaa031
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa031
            LET g_qryparam.arg1 = '225'
            CALL q_oocq002()
            LET g_sfaa_m.sfaa031 = g_qryparam.return1     #將開窗取得的值回傳到變數
            NEXT FIELD sfaa031        {#ADP版次:1#}
            
         #----<<sfaa062>>----
         #Ctrlp:input.c.sfaa062
#         ON ACTION controlp INFIELD sfaa062
            #add-point:ON ACTION controlp INFIELD sfaa062
            
            #END add-point

         #----<<sfaa032>>----
         #Ctrlp:input.c.sfaa032
#         ON ACTION controlp INFIELD sfaa032
            #add-point:ON ACTION controlp INFIELD sfaa032
            
            #END add-point
         
         ON ACTION controlp INFIELD sfaa068
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa068
            LET g_qryparam.arg1 = cl_get_today()
            CALL q_ooeg001_8()
            LET g_sfaa_m.sfaa068 = g_qryparam.return1     #將開窗取得的值回傳到變數
            NEXT FIELD sfaa068        {#ADP版次:1#}
         
         #----<<sfaa033>>----
         #Ctrlp:input.c.sfaa033
#         ON ACTION controlp INFIELD sfaa033
            #add-point:ON ACTION controlp INFIELD sfaa033
            
            #END add-point

         #----<<sfaa034>>----
         #Ctrlp:input.c.sfaa034
         ON ACTION controlp INFIELD sfaa034
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa034
            CALL q_inaa001_2()
            LET g_sfaa_m.sfaa034 = g_qryparam.return1     #將開窗取得的值回傳到變數
            NEXT FIELD sfaa034          {#ADP版次:1#}

         #----<<sfaa035>>----
         #Ctrlp:input.c.sfaa035
         ON ACTION controlp INFIELD sfaa035
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfaa_m.sfaa035
            LET g_qryparam.arg1 = g_sfaa_m.sfaa034
            CALL q_inab002_3()
            LET g_sfaa_m.sfaa035 = g_qryparam.return1     #將開窗取得的值回傳到變數
            NEXT FIELD sfaa035

         #----<<sfaa059>>----
         #Ctrlp:input.c.sfaa059
#         ON ACTION controlp INFIELD sfaa059
            #add-point:ON ACTION controlp INFIELD sfaa059
            
            #END add-point

         #----<<sfaa036>>----
         #Ctrlp:input.c.sfaa036
#         ON ACTION controlp INFIELD sfaa036
            #add-point:ON ACTION controlp INFIELD sfaa036
            
            #END add-point

         #----<<sfaa037>>----
         #Ctrlp:input.c.sfaa037
#         ON ACTION controlp INFIELD sfaa037
            #add-point:ON ACTION controlp INFIELD sfaa037
            
            #END add-point

         #----<<sfaa038>>----
         #Ctrlp:input.c.sfaa038
#         ON ACTION controlp INFIELD sfaa038
            #add-point:ON ACTION controlp INFIELD sfaa038
            
            #END add-point

         #----<<sfaa039>>----
         #Ctrlp:input.c.sfaa039
#         ON ACTION controlp INFIELD sfaa039
            #add-point:ON ACTION controlp INFIELD sfaa039
            
            #END add-point

         #----<<sfaa040>>----
         #Ctrlp:input.c.sfaa040
#         ON ACTION controlp INFIELD sfaa040
            #add-point:ON ACTION controlp INFIELD sfaa040
            
            #END add-point

         #----<<sfaa041>>----
         #Ctrlp:input.c.sfaa041
#         ON ACTION controlp INFIELD sfaa041
            #add-point:ON ACTION controlp INFIELD sfaa041
            
            #END add-point

         #----<<sfaa042>>----
         #Ctrlp:input.c.sfaa042
#         ON ACTION controlp INFIELD sfaa042
            #add-point:ON ACTION controlp INFIELD sfaa042
            
            #END add-point

         #----<<sfaa043>>----
         #Ctrlp:input.c.sfaa043
#         ON ACTION controlp INFIELD sfaa043
            #add-point:ON ACTION controlp INFIELD sfaa043
            
            #END add-point

         #----<<sfaa044>>----
         #Ctrlp:input.c.sfaa044
#         ON ACTION controlp INFIELD sfaa044
            #add-point:ON ACTION controlp INFIELD sfaa044
            
            #END add-point

         #----<<sfaa045>>----
         #Ctrlp:input.c.sfaa045
#         ON ACTION controlp INFIELD sfaa045
            #add-point:ON ACTION controlp INFIELD sfaa045
            
            #END add-point

         #----<<sfaa049>>----
         #Ctrlp:input.c.sfaa049
#         ON ACTION controlp INFIELD sfaa049
            #add-point:ON ACTION controlp INFIELD sfaa049
            
            #END add-point

         #----<<sfaa046>>----
         #Ctrlp:input.c.sfaa046
#         ON ACTION controlp INFIELD sfaa046
            #add-point:ON ACTION controlp INFIELD sfaa046
            
            #END add-point

         #----<<sfaa050>>----
         #Ctrlp:input.c.sfaa050
#         ON ACTION controlp INFIELD sfaa050
            #add-point:ON ACTION controlp INFIELD sfaa050
            
            #END add-point

         #----<<sfaa047>>----
         #Ctrlp:input.c.sfaa047
#         ON ACTION controlp INFIELD sfaa047
            #add-point:ON ACTION controlp INFIELD sfaa047
            
            #END add-point

         #----<<sfaa051>>----
         #Ctrlp:input.c.sfaa051
#         ON ACTION controlp INFIELD sfaa051
            #add-point:ON ACTION controlp INFIELD sfaa051
            
            #END add-point

         #----<<sfaa048>>----
         #Ctrlp:input.c.sfaa048
#         ON ACTION controlp INFIELD sfaa048
            #add-point:ON ACTION controlp INFIELD sfaa048
            
            #END add-point

         #----<<sfaa055>>----
         #Ctrlp:input.c.sfaa055
#         ON ACTION controlp INFIELD sfaa055
            #add-point:ON ACTION controlp INFIELD sfaa055
            
            #END add-point

         #----<<sfaa056>>----
         #Ctrlp:input.c.sfaa056
#         ON ACTION controlp INFIELD sfaa056
            #add-point:ON ACTION controlp INFIELD sfaa056
            
            #END add-point

         #----<<sfab001>>----
         #Ctrlp:input.c.sfab001
#         ON ACTION controlp INFIELD sfab001
            #add-point:ON ACTION controlp INFIELD sfab001
            
            #END add-point

         #----<<sfab002>>----
         #Ctrlp:input.c.sfab002
#         ON ACTION controlp INFIELD sfab002
            #add-point:ON ACTION controlp INFIELD sfab002
            
            #END add-point

         #----<<sfab003>>----
         #Ctrlp:input.c.sfab003
#         ON ACTION controlp INFIELD sfab003
            #add-point:ON ACTION controlp INFIELD sfab003
            
            #END add-point

         #----<<sfab004>>----
         #Ctrlp:input.c.sfab004
#         ON ACTION controlp INFIELD sfab004
            #add-point:ON ACTION controlp INFIELD sfab004
            
            #END add-point

         #----<<sfab005>>----
         #Ctrlp:input.c.sfab005
#         ON ACTION controlp INFIELD sfab005
            #add-point:ON ACTION controlp INFIELD sfab005
            
            #END add-point

         #----<<a1>>----
         #Ctrlp:input.c.a1
#         ON ACTION controlp INFIELD a1
            #add-point:ON ACTION controlp INFIELD a1
            
            #END add-point

         #----<<a2>>----
         #Ctrlp:input.c.a2
#         ON ACTION controlp INFIELD a2
            #add-point:ON ACTION controlp INFIELD a2
            
            #END add-point

         #----<<a3>>----
         #Ctrlp:input.c.a3
#         ON ACTION controlp INFIELD a3
            #add-point:ON ACTION controlp INFIELD a3
            
            #END add-point

         #----<<a4>>----
         #Ctrlp:input.c.a4
#         ON ACTION controlp INFIELD a4
            #add-point:ON ACTION controlp INFIELD a4
            
            #END add-point

         #----<<a5>>----
         #Ctrlp:input.c.a5
#         ON ACTION controlp INFIELD a5
            #add-point:ON ACTION controlp INFIELD a5
            
            #END add-point

         #----<<sfab006>>----
         #Ctrlp:input.c.sfab006
#         ON ACTION controlp INFIELD sfab006
            #add-point:ON ACTION controlp INFIELD sfab006
            
            #END add-point

         #----<<a6>>----
         #Ctrlp:input.c.a6
#         ON ACTION controlp INFIELD a6
            #add-point:ON ACTION controlp INFIELD a6
            
            #END add-point

         #----<<a7>>----
         #Ctrlp:input.c.a7
#         ON ACTION controlp INFIELD a7
            #add-point:ON ACTION controlp INFIELD a7
            
            #END add-point

         #----<<a8>>----
         #Ctrlp:input.c.a8
#         ON ACTION controlp INFIELD a8
            #add-point:ON ACTION controlp INFIELD a8
            
            #END add-point

         #----<<sfac002>>----
         #Ctrlp:input.c.sfac002
#         ON ACTION controlp INFIELD sfac002
            #add-point:ON ACTION controlp INFIELD sfac002
            
            #END add-point

         #----<<sfac001>>----
         #Ctrlp:input.c.sfac001
#         ON ACTION controlp INFIELD sfac001
            #add-point:ON ACTION controlp INFIELD sfac001
            
            #END add-point

         #----<<sfac003>>----
         #Ctrlp:input.c.sfac003
#         ON ACTION controlp INFIELD sfac003
            #add-point:ON ACTION controlp INFIELD sfac003
            
            #END add-point

         #----<<sfac004>>----
         #Ctrlp:input.c.sfac004
#         ON ACTION controlp INFIELD sfac004
            #add-point:ON ACTION controlp INFIELD sfac004
            
            #END add-point

         #----<<sfac005>>----
         #Ctrlp:input.c.sfac005
#         ON ACTION controlp INFIELD sfac005
            #add-point:ON ACTION controlp INFIELD sfac005
            
            #END add-point

         #----<<sfad001>>----
         #Ctrlp:input.c.sfad001
#         ON ACTION controlp INFIELD sfad001
            #add-point:ON ACTION controlp INFIELD sfad001
            
            #END add-point

         #----<<sfad002>>----
         #Ctrlp:input.c.sfad002
#         ON ACTION controlp INFIELD sfad002
            #add-point:ON ACTION controlp INFIELD sfad002
            
            #END add-point

         #----<<sfad003>>----
         #Ctrlp:input.c.sfad003
#         ON ACTION controlp INFIELD sfad003
            #add-point:ON ACTION controlp INFIELD sfad003
            
            #END add-point

         #----<<sfaeseq>>----
         #Ctrlp:input.c.sfaeseq
#         ON ACTION controlp INFIELD sfaeseq
            #add-point:ON ACTION controlp INFIELD sfaeseq
            
            #END add-point

         #----<<sfae001>>----
         #Ctrlp:input.c.sfae001
#         ON ACTION controlp INFIELD sfae001
            #add-point:ON ACTION controlp INFIELD sfae001
            
            #END add-point

         #----<<sfae002>>----
         #Ctrlp:input.c.sfae002
#         ON ACTION controlp INFIELD sfae002
            #add-point:ON ACTION controlp INFIELD sfae002
            
            #END add-point

         #----<<sfae003>>----
         #Ctrlp:input.c.sfae003
#         ON ACTION controlp INFIELD sfae003
            #add-point:ON ACTION controlp INFIELD sfae003
            
            #END add-point

         #----<<sfae004>>----
         #Ctrlp:input.c.sfae004
#         ON ACTION controlp INFIELD sfae004
            #add-point:ON ACTION controlp INFIELD sfae004
            
            #END add-point

         #----<<sfae005>>----
         #Ctrlp:input.c.sfae005
#         ON ACTION controlp INFIELD sfae005
            #add-point:ON ACTION controlp INFIELD sfae005
            
            #END add-point

         #----<<sfae006>>----
         #Ctrlp:input.c.sfae006
#         ON ACTION controlp INFIELD sfae006
            #add-point:ON ACTION controlp INFIELD sfae006
            
            #END add-point

         #----<<sfaf001>>----
         #Ctrlp:input.c.sfaf001
#         ON ACTION controlp INFIELD sfaf001
            #add-point:ON ACTION controlp INFIELD sfaf001
            
            #END add-point

         #----<<ooff013>>----
         #Ctrlp:input.c.ooff013
#         ON ACTION controlp INFIELD ooff013
            #add-point:ON ACTION controlp INFIELD ooff013
            
            #END add-point

         #----<<sfaaownid>>----
         #----<<sfaaowndp>>----
         #----<<sfaacrtid>>----
         #----<<sfaacrtdp>>----
         #----<<sfaacrtdt>>----
         #----<<sfaamodid>>----
         #----<<sfaamoddt>>----
         #----<<sfaacnfid>>----
         #----<<sfaacnfdt>>----
         #----<<sfaapstid>>----
         #----<<sfaapstdt>>----
 #欄位開窗

         AFTER INPUT
                  
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF

        #   CALL cl_showmsg()      #錯誤訊息統整顯示
            DISPLAY BY NAME g_sfaa_m.sfaadocno
           
            IF cl_null(g_sfaa_m.sfaa011) THEN
               LET g_sfaa_m.sfaa011 = ' '
            END IF
            
            #委外工单部门厂商不可为空
            IF g_sfaa_m.sfaa057 = '2' THEN
               IF cl_null(g_sfaa_m.sfaa017) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00222'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = FALSE
                  CALL cl_err()
                  NEXT FIELD sfaa017
               END IF
            END IF

            IF p_cmd <> 'u' THEN
               CALL s_transaction_begin()
               #自动编号
               CALL s_aooi200_gen_docno(g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfaadocdt,g_prog)
                    RETURNING l_success,g_sfaa_m.sfaadocno
               IF NOT l_success THEN
                  NEXT FIELD sfaadocno
               END IF
               
               IF g_sfaa_m.sfaa061 = 'Y' AND cl_null(g_sfaa_m.sfaa016) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00190'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD sfaa016
               END IF 
               
               LET l_count = 1

               SELECT COUNT(*) INTO l_count FROM sfaa_t
                WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno

               IF l_count = 0 THEN

                  #add-point:單頭新增前
                  LET g_sfaa_m.sfaa069 = g_sfaa_m.sfaa012
                  LET g_sfaa_m.sfaa070 = g_sfaa_m.sfaa020
                  #end add-point

                  INSERT INTO sfaa_t (sfaaent, sfaasite,sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt)
                  VALUES (g_enterprise, g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt) # DISK WRITE

                  #add-point:單頭新增中
                  
                  #end add-point

                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "g_sfaa_m"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CONTINUE DIALOG
                  END IF


                  #add-point:單頭新增後
                  #工单单头有来源单据时，写入sfab
                  IF NOT cl_null(g_sfaa_m.sfaa006) AND NOT cl_null(g_sfaa_m.sfaa007) AND NOT cl_null(g_sfaa_m.sfaa008) AND NOT cl_null(g_sfaa_m.sfaa063) THEN
                     DELETE FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site AND sfabdocno=g_sfaa_m.sfaadocno
                     INSERT INTO sfab_t(sfabent,sfabsite,sfabdocno,sfabseq,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006,sfab007)
                      VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,1,'2',g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,10,g_sfaa_m.sfaa012)
                     IF SQLCA.sqlcode THEN
                        INITIALIZE g_errparam TO NULL
                           LET g_errparam.code = SQLCA.sqlcode
                           LET g_errparam.extend = "ins sfab_t"
                           LET g_errparam.popup = TRUE
                           CALL cl_err()

                        CONTINUE DIALOG
                     END IF
                  END IF
                  #工单为人工输入时，需删除sfab资料
                  IF g_sfaa_m.sfaa005 = '0' THEN
                     DELETE FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site AND sfabdocno=g_sfaa_m.sfaadocno
                     IF SQLCA.sqlcode THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = SQLCA.sqlcode
                        LET g_errparam.extend = "DEL sfab_t"
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                        CONTINUE DIALOG
                     END IF
                  END IF
                  #写入工单生产料号明细，拆件式工单不控管
                  IF g_sfaa_m.sfaa003 != '3' THEN
                     IF NOT cl_null(g_sfaa_m.sfaa010) AND g_sfaa_m.sfaa011 IS NOT NULL AND p_cmd = 'a' AND g_flag1 = 'N' THEN
                        CALL asft300_ins_sfac()
                        LET g_flag1 = 'Y'
                     END IF 
                  END IF
                  
                  #写入计划完工日期sfae
                  IF NOT cl_null(g_sfaa_m.sfaa012) AND NOT cl_null(g_sfaa_m.sfaa020) THEN
                     DELETE FROM sfae_t WHERE sfaeent=g_enterprise AND sfaesite=g_site AND sfaedocno=g_sfaa_m.sfaadocno
                     INSERT INTO sfae_t(sfaeent,sfaesite,sfaedocno,sfaeseq,sfae001,sfae002,sfae004) 
                      VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020,0)
                     IF SQLCA.sqlcode THEN
                        INITIALIZE g_errparam TO NULL
                           LET g_errparam.code = SQLCA.sqlcode
                           LET g_errparam.extend = "ins sfab_t"
                           LET g_errparam.popup = TRUE
                           CALL cl_err()

                        CONTINUE DIALOG
                     END IF
                  END IF
                  
                  
                            {#ADP版次:1#}
                  #end add-point
                  CALL s_transaction_end('Y','0')

                  IF l_cmd_t = 'r' AND p_cmd = 'a' THEN
                     CALL asft300_detail_reproduce()
                  END IF
                  
                  LET g_master_insert = TRUE
                  
                  LET p_cmd = 'u'

               ELSE
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = '!'
                  LET g_errparam.extend =  g_sfaa_m.sfaadocno
                  LET g_errparam.popup = FALSE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  NEXT FIELD sfaadocno
               END IF
            ELSE

               #add-point:單頭修改前
               IF g_sfaa_m.sfaa061 = 'Y' AND cl_null(g_sfaa_m.sfaa016) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00190'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  NEXT FIELD sfaa016
               END IF
               #end add-point
               CALL s_transaction_begin()
               
               LET g_sfaa_m.sfaa069 = g_sfaa_m.sfaa012

               UPDATE sfaa_t SET (sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt) = (g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt)
                WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaadocno_t

               #add-point:單頭修改中
               
               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "sfaa_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "sfaa_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                  OTHERWISE


                     #add-point:單頭修改後
                     #工单单头有来源单据时，写入sfab
                     IF NOT cl_null(g_sfaa_m.sfaa006) AND NOT cl_null(g_sfaa_m.sfaa007) AND NOT cl_null(g_sfaa_m.sfaa008) AND NOT cl_null(g_sfaa_m.sfaa063) THEN
                        DELETE FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site AND sfabdocno=g_sfaa_m.sfaadocno
                        INSERT INTO sfab_t(sfabent,sfabsite,sfabdocno,sfabseq,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006,sfab007)
                         VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,1,'2',g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,10,g_sfaa_m.sfaa012)
                        IF SQLCA.sqlcode THEN
                           INITIALIZE g_errparam TO NULL
                           LET g_errparam.code = SQLCA.sqlcode
                           LET g_errparam.extend = "ins sfab_t"
                           LET g_errparam.popup = TRUE
                           CALL cl_err()

                           CONTINUE DIALOG
                        END IF
                     END IF
                     #工单为人工输入时，需删除sfab资料
                     IF g_sfaa_m.sfaa005 = '0' THEN
                        DELETE FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site AND sfabdocno=g_sfaa_m.sfaadocno
                        IF SQLCA.sqlcode THEN
                           INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = SQLCA.sqlcode
                        LET g_errparam.extend = "DEL sfab_t"
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                           CONTINUE DIALOG
                        END IF
                     END IF 
                    
                     #写入工单生产料号明细,拆件式工单不控管
                     IF g_sfaa_m.sfaa003 != '3' THEN
                        IF (g_sfaa_m.sfaa010 != g_sfaa_m_t.sfaa010 OR g_sfaa_m.sfaa011 != g_sfaa_m_t.sfaa011) THEN
                           DELETE FROM sfac_t 
                            WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno = g_sfaa_m.sfaadocno
                           CALL asft300_ins_sfac()
                        ELSE                    
                           #更新sfac数量
                           SELECT SUM(sfac003) INTO l_sfac003_sum FROM sfac_t WHERE sfacent = g_enterprise AND sfacsite = g_site
                              AND sfacdocno=g_sfaa_m.sfaadocno AND (sfac002='1' OR sfac002='2')
                           IF g_sfaa_m.sfaa012 != l_sfac003_sum THEN
                              UPDATE sfac_t SET sfac003 = g_sfaa_m.sfaa012 / l_sfac003_sum * sfac003 
                               WHERE sfacent = g_enterprise AND sfacsite = g_site
                                 AND sfacdocno=g_sfaa_m.sfaadocno AND (sfac002='1' OR sfac002='2')
                           END IF
                        END IF
                     END IF 
                     
                     #更新计划完工量
                     SELECT SUM(sfae001) INTO l_sfae001_sum FROM sfae_t WHERE sfaeent = g_enterprise AND sfaesite = g_site
                        AND sfaedocno=g_sfaa_m.sfaadocno
                     IF g_sfaa_m.sfaa012 != l_sfae001_sum THEN
                        UPDATE sfae_t SET sfae001 = g_sfaa_m.sfaa012 / l_sfae001_sum * sfae001 
                         WHERE sfaeent = g_enterprise AND sfaesite = g_site
                           AND sfaedocno=g_sfaa_m.sfaadocno
                     END IF
                           {#ADP版次:1#}
                     #end add-point
                     CALL s_transaction_end('Y','0')
               END CASE
            END IF
            
            #工单备料档无资料时产生工单备料,根据参数判断  
            IF p_cmd = 'u' AND g_master_insert = TRUE THEN
               SELECT COUNT(*) INTO l_n1 FROM sfba_t 
                WHERE sfbaent = g_enterprise AND sfbasite = g_site 
                  AND sfbadocno = g_sfaa_m.sfaadocno
               IF l_n1 = 0 THEN                  
                  CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
                  IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0038') = '1' THEN              
                     CALL s_transaction_begin()         
                     #复制的时候删除后重新产生
                     DELETE FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
                     CALL s_asft300_02(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa003,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa015,g_sfaa_m.sfaa012,'N') RETURNING l_success,l_num
                     IF NOT l_success THEN
                        CALL s_transaction_end('N','0')
                     ELSE
                        CALL s_transaction_end('Y','0')
                     END IF
                     CALL asft300_b_fill()
                     LET g_rec_b = g_sfba_d.getLength()
                  END IF
               END IF
            END IF
            
            #备注无值时，若工单来源是订单，则把订单的长备注带入
            CALL asft300_gen_bz()
            
            CALL asft300_set_no_entry(p_cmd)
            LET g_sfaadocno_t = g_sfaa_m.sfaadocno

           #controlp
      END INPUT

      INPUT ARRAY g_sfab_d FROM s_sfab.*
          ATTRIBUTE(COUNT = g_rec_b_sfab,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS,
                  INSERT ROW = l_allow_insert,
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
                  
         BEFORE INPUT
            IF g_flag_date = 'Y' THEN
               EXIT DIALOG
            END IF 
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN
               CALL FGL_SET_ARR_CURR(g_sfab_d.getLength()+1)
               LET g_insert = 'N'
            END IF

            CALL asft300_b_fill_sfab()
            LET g_rec_b_sfab = g_sfab_d.getLength()
            IF g_sfaa_m.sfaa005 != '1' OR cl_null(g_sfaa_m.sfaa010) THEN
           #当不满足条件不能进入工单来源页签时，不要报错退出dialog，直接进入到下一个能进入的页签 #20140923
           #   INITIALIZE g_errparam TO NULL
           #   LET g_errparam.code = 'asf-00161'
           #   LET g_errparam.extend = ''
           #   LET g_errparam.popup = TRUE
           #   CALL cl_err()
           #
           #   EXIT DIALOG
               NEXT FIELD sfacseq
            END IF
            
            #有單身資料時，工單類型、發料制度、工單來源、來源單號項次項序分批序、生產料號、BOM特性、生產數量、生產單位、工單來源頁籤，
            #限制不可修改，以免已存在的單身資料與單頭不合
            IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
               SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
               IF l_n > 0 THEN
                 #当不满足条件不能进入工单来源页签时，不要报错退出dialog，直接进入到下一个能进入的页签 #20140923
                 #INITIALIZE g_errparam TO NULL
                 #LET g_errparam.code = 'asf-00329'
                 #LET g_errparam.extend = ''
                 #LET g_errparam.popup = TRUE
                 #CALL cl_err()
                 #
                 #EXIT DIALOG
                  NEXT FIELD sfacseq
               END IF
            END IF
            
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()

            LET l_lock_sw = 'N'  

            CALL s_transaction_begin()
            OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

            IF STATUS THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  STATUS
               LET g_errparam.extend = "OPEN asft300_cl:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CLOSE asft300_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF

         #  LET g_rec_b_sfab = g_sfab_d.getLength()

            IF g_rec_b_sfab >= l_ac
               AND g_sfab_d[l_ac].sfab001 IS NOT NULL
               AND g_sfab_d[l_ac].sfab002 IS NOT NULL
               AND g_sfab_d[l_ac].sfab003 IS NOT NULL
               AND g_sfab_d[l_ac].sfab004 IS NOT NULL


            THEN
               LET l_cmd='u'
               LET g_sfab_d_t.* = g_sfab_d[l_ac].*  #BACKUP
               OPEN asft300_sfab_bcl USING g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfab_d[l_ac].sfabseq #g_sfab_d[l_ac].sfab001,g_sfab_d[l_ac].sfab002,g_sfab_d[l_ac].sfab003,g_sfab_d[l_ac].sfab004
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "OPEN asft300_sfab_bcl"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET l_lock_sw='Y'
               ELSE
                  FETCH asft300_sfab_bcl INTO g_sfab_d[l_ac].*
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = g_sfab_d_t.sfab001
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = "Y"
                  END IF
                  CALL asft300_show_sfab_desc(l_ac)
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_sfab_d[l_ac].* TO NULL
            
            IF g_rec_b_sfab = 0 THEN
               LET g_sfab_d[1].sfab001 = '2'
            ELSE
               LET g_sfab_d[l_ac].sfab001 = g_sfab_d[l_ac-1].sfab001
            END IF 
            
            SELECT MAX(sfab006) INTO g_sfab_d[l_ac].sfab006 FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite = g_site
               AND sfabdocno = g_sfaa_m.sfaadocno
            IF cl_null(g_sfab_d[l_ac].sfab006) THEN
               LET g_sfab_d[l_ac].sfab006 = 10
            ELSE
               LET g_sfab_d[l_ac].sfab006 = g_sfab_d[l_ac].sfab006 + 10
            END IF
            LET g_sfab_d[l_ac].sfab007 = 0
            LET g_sfab_d_t.* = g_sfab_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            NEXT FIELD sfabseq
                  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CANCEL INSERT
            END IF

            SELECT COUNT(*) INTO l_count FROM sfab_t
             WHERE sfabent = g_enterprise
               AND sfabsite = g_site
               AND sfabdocno = g_sfaa_m.sfaadocno
               AND sfabseq = g_sfab_d[l_ac].sfabseq
               AND sfab001 = g_sfab_d[l_ac].sfab001
               AND sfab002 = g_sfab_d[l_ac].sfab002
               AND sfab003 = g_sfab_d[l_ac].sfab003
               AND sfab004 = g_sfab_d[l_ac].sfab004
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN
               INSERT INTO sfab_t(sfabent,sfabsite,sfabdocno,sfabseq,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006,sfab007)
               VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfab_d[l_ac].sfabseq,g_sfab_d[l_ac].sfab001,g_sfab_d[l_ac].sfab002,g_sfab_d[l_ac].sfab003,g_sfab_d[l_ac].sfab004,g_sfab_d[l_ac].sfab005,g_sfab_d[l_ac].sfab006,g_sfab_d[l_ac].sfab007)
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "INSERT sfab_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL INSERT
               ELSE
                  CALL s_transaction_end('Y','0')
                  ERROR 'INSERT O.K'
                  LET g_rec_b_sfab=g_rec_b_sfab+1
               END IF
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_sfab_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF

         BEFORE DELETE                            #是否取消單身
            IF NOT cl_null(g_sfab_d[l_ac].sfab001) THEN
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF

               DELETE FROM sfab_t
                WHERE sfabent = g_enterprise
                  AND sfabsite= g_site
                  AND sfabdocno = g_sfaa_m.sfaadocno
                  AND sfabseq = g_sfab_d[l_ac].sfabseq
                  AND sfab001 = g_sfab_d[l_ac].sfab001
                  AND sfab002 = g_sfab_d[l_ac].sfab002
                  AND sfab003 = g_sfab_d[l_ac].sfab003
                  AND sfab004 = g_sfab_d[l_ac].sfab004
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfab_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE
               ELSE
                  LET g_rec_b_sfab = g_rec_b_sfab-1
                  CALL s_transaction_end('Y','0')
               END IF
               CLOSE asft300_sfab_bcl
               LET l_count = g_sfab_d.getLength()
            END IF
            
         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_sfab_d[l_ac].* = g_sfab_d_t.*
               CLOSE asft300_sfab_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF

            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = g_sfab_d[l_ac].sfab001
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_sfab_d[l_ac].* = g_sfab_d_t.*
            ELSE
               UPDATE sfab_t SET (sfabent,sfabsite,sfabdocno,sfabseq,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006,sfab007) = (g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfab_d[l_ac].sfabseq,g_sfab_d[l_ac].sfab001,g_sfab_d[l_ac].sfab002,g_sfab_d[l_ac].sfab003,g_sfab_d[l_ac].sfab004,g_sfab_d[l_ac].sfab005,g_sfab_d[l_ac].sfab006,g_sfab_d[l_ac].sfab007)
                WHERE sfabent = g_enterprise
                  AND sfabsite = g_site
                  AND sfabdocno = g_sfaa_m.sfaadocno
                  AND sfabseq = g_sfab_d_t.sfabseq
                  AND sfab001 = g_sfab_d_t.sfab001
                  AND sfab002 = g_sfab_d_t.sfab002
                  AND sfab003 = g_sfab_d_t.sfab003
                  AND sfab004 = g_sfab_d_t.sfab004
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "sfab_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     LET g_sfab_d[l_ac].* = g_sfab_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfab_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                     LET g_sfab_d[l_ac].* = g_sfab_d_t.*
                     CALL s_transaction_end('N','0')
                  OTHERWISE
                     UPDATE sfaa_t SET sfaa012 = sfaa012 + g_sfab_d[l_ac].sfab007 - g_sfab_d_t.sfab007 
                      WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
                     IF SQLCA.sqlcode THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = SQLCA.sqlcode
                        LET g_errparam.extend = "upd sfaa_t"
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                        CALL s_transaction_end('N','0')
                     ELSE
                        CALL s_transaction_end('Y','0')
                        ERROR 'UPDATE O.K'
                     END IF
               END CASE
            END IF
         
         BEFORE FIELD sfabseq
            IF cl_null(g_sfab_d[l_ac].sfabseq) OR g_sfab_d[l_ac].sfabseq = 0  THEN 
               SELECT MAX(sfabseq)+1 INTO g_sfab_d[l_ac].sfabseq FROM sfab_t
                WHERE sfabent = g_enterprise
                  AND sfabsite = g_site
                  AND sfabdocno = g_sfaa_m.sfaadocno
               IF cl_null(g_sfab_d[l_ac].sfabseq) THEN
                  LET g_sfab_d[l_ac].sfabseq = 1
               END IF                
            END IF
            
         AFTER FIELD sfabseq
            IF NOT cl_ap_chk_Range(g_sfab_d[l_ac].sfabseq,"0","0","","","azz-00079",1) THEN
               LET g_sfab_d[l_ac].sfabseq = g_sfab_d_t.sfabseq
               NEXT FIELD sfabseq
            END IF

            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfab_d[l_ac].sfabseq) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfab_d[l_ac].sfabseq != g_sfab_d_t.sfabseq)) THEN
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfab_t WHERE "||"sfabent = '" ||g_enterprise|| "' AND sfabsite = '" ||g_site|| "' AND "||"sfabdocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfabseq = '"||g_sfab_d[l_ac].sfabseq ||"'",'std-00004',0) THEN
                     LET g_sfab_d[l_ac].sfabseq = g_sfab_d_t.sfabseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
             
         #----<<sfab001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfab001
            #add-point:BEFORE FIELD sfab001
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfab001

            #add-point:AFTER FIELD sfab001
            
            #END add-point


         #Ctrlp:construct.c.sfab001
#         ON ACTION controlp INFIELD sfab001
            #add-point:ON ACTION controlp INFIELD sfab001
            
            #END add-point

         #----<<sfab002>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfab002
            #add-point:BEFORE FIELD sfab002
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfab002

            #add-point:AFTER FIELD sfab002
            IF NOT cl_null(g_sfab_d[l_ac].sfab002) AND (cl_null(g_sfab_d_t.sfab002) OR g_sfab_d[l_ac].sfab002 != g_sfab_d_t.sfab002) THEN
               IF NOT asft300_sfab002_chk() THEN
                  LET g_sfab_d[l_ac].sfab002 = g_sfab_d_t.sfab002
                  NEXT FIELD sfab002
               END IF
            END IF
            #END add-point

         #----<<sfab003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfab003
            #add-point:BEFORE FIELD sfab003
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfab003

            #add-point:AFTER FIELD sfab003
            IF NOT cl_null(g_sfab_d[l_ac].sfab003) AND (cl_null(g_sfab_d_t.sfab003) OR g_sfab_d[l_ac].sfab003 != g_sfab_d_t.sfab003) THEN
               IF NOT asft300_sfab002_chk() THEN
                  LET g_sfab_d[l_ac].sfab003 = g_sfab_d_t.sfab003
                  NEXT FIELD sfab003
               END IF
            END IF
            #END add-point


         #----<<sfab004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfab004
            #add-point:BEFORE FIELD sfab004
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfab004

            #add-point:AFTER FIELD sfab004
            IF NOT cl_null(g_sfab_d[l_ac].sfab004) AND (cl_null(g_sfab_d_t.sfab004) OR g_sfab_d[l_ac].sfab004 != g_sfab_d_t.sfab004) THEN
               IF NOT asft300_sfab002_chk() THEN
                  LET g_sfab_d[l_ac].sfab004 = g_sfab_d_t.sfab004
                  NEXT FIELD sfab004
               END IF
            END IF
            #END add-point

         #----<<sfab005>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfab005
            #add-point:BEFORE FIELD sfab005
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfab005

            #add-point:AFTER FIELD sfab005
            IF NOT cl_null(g_sfab_d[l_ac].sfab005) AND (cl_null(g_sfab_d_t.sfab005) OR g_sfab_d[l_ac].sfab005 != g_sfab_d_t.sfab005) THEN
               IF NOT asft300_sfab002_chk() THEN
                  LET g_sfab_d[l_ac].sfab005 = g_sfab_d_t.sfab005
                  NEXT FIELD sfab005
               END IF
            END IF
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD sfab006
            #add-point:BEFORE FIELD sfab006
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfab006

            #add-point:AFTER FIELD sfab006
            IF NOT cl_ap_chk_Range(g_sfab_d[l_ac].sfab006,"0","0","","","azz-00079",1) THEN
               LET g_sfab_d[l_ac].sfab006 = g_sfab_d_t.sfab006
               NEXT FIELD sfab006
            END IF
            
            IF NOT cl_null(g_sfab_d[l_ac].sfab006) AND (cl_null(g_sfab_d_t.sfab006) OR g_sfab_d[l_ac].sfab006 != g_sfab_d_t.sfab006) THEN
               SELECT COUNT(*) INTO l_n FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site AND sfab006=g_sfab_d[l_ac].sfab006
               IF l_n > 0 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = ''
                  LET g_errparam.extend = g_sfab_d[l_ac].sfab006
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfab_d[l_ac].sfab006 = g_sfab_d_t.sfab006
                  NEXT FIELD sfab006
               END IF
            END IF
            #END add-point
            
         AFTER FIELD sfab007
            IF NOT cl_ap_chk_Range(g_sfab_d[l_ac].sfab007,"0","0","","","azz-00079",1) THEN
               LET g_sfab_d[l_ac].sfab007 = g_sfab_d_t.sfab007
               NEXT FIELD sfab007
            END IF
            SELECT imae015 INTO l_imae015 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
            IF cl_null(l_imae015) THEN
               LET l_imae015 = 0 
            END IF
            
            #单位取位
            IF NOT cl_null(g_sfaa_m.sfaa013) THEN
               CALL s_aooi250_take_decimals(g_sfaa_m.sfaa013,g_sfab_d[l_ac].sfab007)
                    RETURNING l_success,g_sfab_d[l_ac].sfab007
            END IF
               
            IF g_sfab_d[l_ac].sfab007 > (g_sfab_d[l_ac].a3 - g_sfab_d[l_ac].a5) * (1 + l_imae015 / 100) + g_sfab_d_t.sfab007 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00157'
               LET g_errparam.extend = g_sfab_d[l_ac].sfab007
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_sfab_d[l_ac].sfab007 = g_sfab_d_t.sfab007
               NEXT FIELD sfab007
            END IF
            
         AFTER INPUT 
            #更新生产数量
            SELECT SUM(sfab007) INTO l_sfab007_sum FROM sfab_t WHERE sfabent=g_enterprise AND sfabsite=g_site AND sfabdocno=g_sfaa_m.sfaadocno
            IF NOT cl_null(g_sfaa_m.sfaa060) THEN
              #CALL s_aimi190_get_convert(g_sfaa_m.sfaa010,g_sfaa_m.sfaa013,g_sfaa_m.sfaa060) RETURNING l_success,l_rate
              #IF l_success THEN
              #   LET l_sfab007_sum1 = l_sfab007_sum * l_rate
              #END IF
               CALL s_aooi250_convert_qty(g_sfaa_m.sfaa010,g_sfaa_m.sfaa013,g_sfaa_m.sfaa060,l_sfab007_sum) 
                    RETURNING l_success,l_sfab007_sum1
               IF NOT l_success THEN
                  LET l_sfab007_sum1 = l_sfab007_sum
               END IF
            END IF
              
            UPDATE sfaa_t SET sfaa012 = l_sfab007_sum,sfaa058 = l_sfab007_sum1
             WHERE sfaaent=g_enterprise AND sfaasite=g_site AND sfaadocno=g_sfaa_m.sfaadocno
            #工单备料档无资料时产生工单备料,根据参数判断                
            CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
            IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0038') = '1' THEN
               SELECT COUNT(*) INTO l_count FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
               IF l_count = 0 THEN 
                  CALL s_transaction_begin()         
                  CALL s_asft300_02(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa003,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa015,g_sfaa_m.sfaa012,'N') RETURNING l_success,l_num
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                  END IF
                  CALL asft300_b_fill()
                  LET g_rec_b = g_sfba_d.getLength()
               END IF
            END IF
            
            #备注无值时，若工单来源是订单，则把订单的长备注带入
            CALL asft300_gen_bz()
  

         ON ACTION controlp INFIELD sfab002
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfab_d[l_ac].sfab002             #給予default值
            LET g_qryparam.default2 = g_sfab_d[l_ac].sfab003             #給予default值
            LET g_qryparam.default3 = g_sfab_d[l_ac].sfab004             #給予default值
            LET g_qryparam.default4 = g_sfab_d[l_ac].sfab005             #給予default值
            LET g_qryparam.where=" xmdd001='",g_sfaa_m.sfaa010,"'"
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfab_d[l_ac].sfab002 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfab_d[l_ac].sfab003 = g_qryparam.return2
            LET g_sfab_d[l_ac].sfab004 = g_qryparam.return3
            LET g_sfab_d[l_ac].sfab005 = g_qryparam.return4
            NEXT FIELD sfab002                          #返回原欄位
            
         ON ACTION controlp INFIELD sfab003
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfab_d[l_ac].sfab002             #給予default值
            LET g_qryparam.default2 = g_sfab_d[l_ac].sfab003             #給予default值
            LET g_qryparam.default3 = g_sfab_d[l_ac].sfab004             #給予default值
            LET g_qryparam.default4 = g_sfab_d[l_ac].sfab005             #給予default值
            LET g_qryparam.where=" xmdd001='",g_sfaa_m.sfaa010,"'"
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfab_d[l_ac].sfab002 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfab_d[l_ac].sfab003 = g_qryparam.return2
            LET g_sfab_d[l_ac].sfab004 = g_qryparam.return3
            LET g_sfab_d[l_ac].sfab005 = g_qryparam.return4
            NEXT FIELD sfab003                          #返回原欄位
            
         ON ACTION controlp INFIELD sfab004
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfab_d[l_ac].sfab002             #給予default值
            LET g_qryparam.default2 = g_sfab_d[l_ac].sfab003             #給予default值
            LET g_qryparam.default3 = g_sfab_d[l_ac].sfab004             #給予default值
            LET g_qryparam.default4 = g_sfab_d[l_ac].sfab005             #給予default值
            LET g_qryparam.where=" xmdd001='",g_sfaa_m.sfaa010,"'"
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfab_d[l_ac].sfab002 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfab_d[l_ac].sfab003 = g_qryparam.return2
            LET g_sfab_d[l_ac].sfab004 = g_qryparam.return3
            LET g_sfab_d[l_ac].sfab005 = g_qryparam.return4
            NEXT FIELD sfab004                         #返回原欄位
            
         ON ACTION controlp INFIELD sfab005
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfab_d[l_ac].sfab002             #給予default值
            LET g_qryparam.default2 = g_sfab_d[l_ac].sfab003             #給予default值
            LET g_qryparam.default3 = g_sfab_d[l_ac].sfab004             #給予default值
            LET g_qryparam.default4 = g_sfab_d[l_ac].sfab005             #給予default值
            LET g_qryparam.where=" xmdd001='",g_sfaa_m.sfaa010,"'"
            CALL q_xmdddocno()                                #呼叫開窗
            LET g_sfab_d[l_ac].sfab002 = g_qryparam.return1              #將開窗取得的值回傳到變數
            LET g_sfab_d[l_ac].sfab003 = g_qryparam.return2
            LET g_sfab_d[l_ac].sfab004 = g_qryparam.return3
            LET g_sfab_d[l_ac].sfab005 = g_qryparam.return4
            NEXT FIELD sfab005                          #返回原欄位

      END INPUT
      
      INPUT ARRAY g_sfac_d FROM s_sfac.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS,
                  INSERT ROW = l_allow_insert,
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
                  
         BEFORE INPUT
            IF g_flag_date = 'Y' THEN
               EXIT DIALOG
            END IF 
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN
               CALL FGL_SET_ARR_CURR(g_sfac_d.getLength()+1)
               LET g_insert = 'N'
            END IF

            CALL asft300_b_fill_sfac()
            LET g_rec_b_sfac = g_sfac_d.getLength()
            
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()

            LET l_lock_sw = 'N'  

            CALL s_transaction_begin()
            OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

            IF STATUS THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  STATUS
               LET g_errparam.extend = "OPEN asft300_cl:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CLOSE asft300_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF

         #   LET g_rec_b_sfac = g_sfac_d.getLength()

            IF g_rec_b_sfac >= l_ac AND g_sfac_d[l_ac].sfac001 IS NOT NULL THEN
               LET l_cmd='u'
               LET g_sfac_d_t.* = g_sfac_d[l_ac].*  #BACKUP
               OPEN asft300_sfac_bcl USING g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfac_d[l_ac].sfacseq
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "OPEN asft300_sfac_bcl"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET l_lock_sw='Y'
               ELSE
                  FETCH asft300_sfac_bcl INTO g_sfac_d[l_ac].*
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = g_sfac_d_t.sfac001
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = "Y"
                  END IF
                  CALL asft300_show_sfac_desc(l_ac)
                  CALL cl_show_fld_cont()
                  IF g_sfac_d[l_ac].sfac002 = '1' THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00114'
                     LET g_errparam.extend = g_sfac_d[l_ac].sfac002
                     LET g_errparam.popup = FALSE
                     CALL cl_err()

                  END IF 
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            
            CALL asft300_set_entry_sfac()
            
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_sfac_d[l_ac].* TO NULL
            LET g_sfac_d[l_ac].sfac005 = 0 

            LET g_sfac_d_t.* = g_sfac_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            NEXT FIELD sfacseq
                  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
            
            IF cl_null(g_sfac_d[l_ac].sfac006) THEN
               LET g_sfac_d[l_ac].sfac006 = ' '
            END IF
            
            SELECT COUNT(*) INTO l_count FROM sfac_t
             WHERE sfacent = g_enterprise
               AND sfacsite = g_site
               AND sfacdocno = g_sfaa_m.sfaadocno
               AND sfac001 = g_sfac_d[l_ac].sfac001
               AND sfac006 = g_sfac_d[l_ac].sfac006

            #資料未重複, 插入新增資料
            IF l_count = 0 THEN
               IF cl_null(g_sfac_d[l_ac].sfac006) THEN
                  LET g_sfac_d[l_ac].sfac006 = ' '
               END IF
               INSERT INTO sfac_t(sfacent,sfacsite,sfacdocno,sfacseq,sfac001,sfac002,sfac003,sfac004,sfac005,sfac006)
               VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfac_d[l_ac].sfacseq,g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac002,g_sfac_d[l_ac].sfac003,g_sfac_d[l_ac].sfac004,g_sfac_d[l_ac].sfac005,g_sfac_d[l_ac].sfac006)
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "INSERT sfac_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL INSERT
               ELSE
                  #其他产品特征写入DB
                  IF l_inam.getLength() > 1 THEN  #因為第一筆資料已呈現在畫面並寫入DB, 從第二筆開始處理
                     SELECT * INTO l_sfac.* FROM sfac_t WHERE sfacent = g_enterprise AND sfacsite = g_site
                        AND sfacdocno = g_sfaa_m.sfaadocno AND sfacseq = g_sfac_d[l_ac].sfacseq
                     FOR l_k = 2 TO l_inam.getLength()
                        SELECT MAX(sfacseq)+1 INTO l_sfac.sfacseq FROM sfac_t 
                         WHERE sfacent = g_enterprise AND sfacsite = g_site
                           AND sfacdocno = g_sfaa_m.sfaadocno 
                        LET l_sfac.sfac006 = l_inam[l_k].inam002
                        LET l_sfac.sfac003 = l_inam[l_k].inam004
                        SELECT COUNT(*) INTO l_count FROM sfac_t
                         WHERE sfacent = g_enterprise
                           AND sfacsite = g_site
                           AND sfacdocno = g_sfaa_m.sfaadocno
                           AND sfac001 = g_sfac_d[l_ac].sfac001
                           AND sfac006 = l_sfac.sfac006
                        IF l_count > 0 THEN
                           CONTINUE FOR
                        END IF
                        INSERT INTO sfac_t VALUES(l_sfac.*)
                     END FOR
                     CALL asft300_b_fill_sfac()
                  END IF
                  CALL l_inam.clear()
                  CALL s_transaction_end('Y','0')
                  ERROR 'INSERT O.K'
                  LET g_rec_b_sfac=g_rec_b_sfac+1
               END IF
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_sfac_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF

         BEFORE DELETE                            #是否取消單身
            IF NOT cl_null(g_sfac_d[l_ac].sfac001) AND g_sfac_d[l_ac].sfac002 != '1' THEN
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF

               DELETE FROM sfac_t
                WHERE sfacent = g_enterprise
                  AND sfacsite= g_site
                  AND sfacdocno = g_sfaa_m.sfaadocno
                  AND sfacseq = g_sfac_d[l_ac].sfacseq
                  AND sfac001 = g_sfac_d[l_ac].sfac001
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfac_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE
               ELSE
                  LET g_rec_b_sfac = g_rec_b_sfac-1
                  CALL s_transaction_end('Y','0')
               END IF
               CLOSE asft300_sfac_bcl
               LET l_count = g_sfac_d.getLength()
            END IF

         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_sfac_d[l_ac].* = g_sfac_d_t.*
               CLOSE asft300_sfac_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF
            
            IF g_sfac_d[l_ac].sfac002 != '1' THEN

            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = g_sfac_d[l_ac].sfac001
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_sfac_d[l_ac].* = g_sfac_d_t.*
            ELSE
               IF cl_null(g_sfac_d[l_ac].sfac006) THEN
                  LET g_sfac_d[l_ac].sfac006 = ' '
               END IF
               SELECT COUNT(*) INTO l_count FROM sfac_t
                WHERE sfacent = g_enterprise
                  AND sfacsite = g_site
                  AND sfacdocno = g_sfaa_m.sfaadocno
                  AND sfac001 = g_sfac_d[l_ac].sfac001
                  AND sfac006 = g_sfac_d[l_ac].sfac006
               IF l_count <= 1 THEN
                  UPDATE sfac_t SET (sfacent,sfacsite,sfacdocno,sfac001,sfac002,sfac003,sfac004,sfac005,sfac006) = (g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac002,g_sfac_d[l_ac].sfac003,g_sfac_d[l_ac].sfac004,g_sfac_d[l_ac].sfac005,g_sfac_d[l_ac].sfac006)
                   WHERE sfacent = g_enterprise
                     AND sfacsite = g_site
                     AND sfacdocno = g_sfaa_m.sfaadocno
                     AND sfacseq = g_sfac_d_t.sfacseq
                     AND sfac001 = g_sfac_d_t.sfac001
                
                  CASE
                     WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = "std-00009"
                        LET g_errparam.extend = "sfac_t"
                        LET g_errparam.popup = TRUE
                        CALL cl_err()
                
                        CALL s_transaction_end('N','0')
                        LET g_sfac_d[l_ac].* = g_sfac_d_t.*
                     WHEN SQLCA.sqlcode #其他錯誤
                        INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "sfac_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                
                        LET g_sfac_d[l_ac].* = g_sfac_d_t.*
                        CALL s_transaction_end('N','0')
                     OTHERWISE
                        CALL s_transaction_end('Y','0')
                        ERROR 'UPDATE O.K'
                  END CASE
               END IF
            END IF
            END IF

         BEFORE FIELD sfacseq
            IF cl_null(g_sfac_d[l_ac].sfacseq) OR g_sfac_d[l_ac].sfacseq = 0  THEN 
               SELECT MAX(sfacseq)+1 INTO g_sfac_d[l_ac].sfacseq FROM sfac_t
                WHERE sfacent = g_enterprise
                  AND sfacsite = g_site
                  AND sfacdocno = g_sfaa_m.sfaadocno
               IF cl_null(g_sfac_d[l_ac].sfacseq) THEN
                  LET g_sfac_d[l_ac].sfacseq = 1
               END IF                
            END IF
            
         AFTER FIELD sfacseq
            IF NOT cl_ap_chk_Range(g_sfac_d[l_ac].sfacseq,"0","0","","","azz-00079",1) THEN
               LET g_sfac_d[l_ac].sfacseq = g_sfac_d_t.sfacseq
               NEXT FIELD sfacseq
            END IF

            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfac_d[l_ac].sfacseq) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfac_d[l_ac].sfacseq != g_sfac_d_t.sfacseq)) THEN
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfac_t WHERE "||"sfacent = '" ||g_enterprise|| "' AND sfacsite = '" ||g_site|| "' AND "||"sfacdocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfacseq = '"||g_sfac_d[l_ac].sfacseq ||"'",'std-00004',0) THEN
                     LET g_sfac_d[l_ac].sfacseq = g_sfac_d_t.sfacseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
            
         #此段落由子樣板a02產生
         AFTER FIELD sfac002
            IF NOT cl_null(g_sfac_d[l_ac].sfac002) AND (g_sfac_d[l_ac].sfac002 != g_sfac_d_t.sfac002 OR cl_null(g_sfac_d_t.sfac002)) THEN
               IF g_sfaa_m.sfaa003 = '3' THEN
                  IF g_sfac_d[l_ac].sfac002 != '4' THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00049'
                     LET g_errparam.extend = g_sfac_d[l_ac].sfac002
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
             
                     LET g_sfac_d[l_ac].sfac002 = g_sfac_d_t.sfac002
                     NEXT FIELD sfac002
                  END IF 
               END IF
               IF l_cmd = 'a' AND g_sfac_d[l_ac].sfac002 = '1' THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00114'
                  LET g_errparam.extend = g_sfac_d[l_ac].sfac002
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
             
                  LET g_sfac_d[l_ac].sfac002 = g_sfac_d_t.sfac002
                  NEXT FIELD sfac002
               END IF 
             
               CALL asft300_set_entry_sfac()
            END IF
            
         #此段落由子樣板a02產生
         AFTER FIELD sfac001
            IF NOT cl_null(g_sfac_d[l_ac].sfac001) AND (cl_null(g_sfac_d_t.sfac001) OR g_sfac_d_t.sfac001 !=g_sfac_d[l_ac].sfac001) THEN
               IF g_sfaa_m.sfaa003 MATCHES '[145]' THEN
                  IF g_sfac_d[l_ac].sfac002 = '2' THEN
                     SELECT COUNT(*) INTO l_m FROM bmab_t
                      WHERE bmabent = g_enterprise AND bmabsite = g_site 
                        AND bmab001 = g_sfaa_m.sfaa010 AND bmab002 = g_sfaa_m.sfaa011 AND bmab003 = g_sfac_d[l_ac].sfac001
                  END IF 
                  IF g_sfac_d[l_ac].sfac002 = '3' THEN
                     SELECT COUNT(*) INTO l_m FROM bmad_t
                      WHERE bmadent = g_enterprise AND bmadsite = g_site 
                        AND bmad001 = g_sfaa_m.sfaa010 AND bmad002 = g_sfaa_m.sfaa011 AND bmad003 = g_sfac_d[l_ac].sfac001
                  END IF 
                  IF g_sfac_d[l_ac].sfac002 = '5' THEN
                     SELECT COUNT(*) INTO l_m FROM bmac_t
                      WHERE bmacent = g_enterprise AND bmacsite = g_site 
                        AND bmac001 = g_sfaa_m.sfaa010 AND bmac002 = g_sfaa_m.sfaa011 AND bmac003 = g_sfac_d[l_ac].sfac001
                  END IF 
                  IF l_m = 0 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00050'
                     LET g_errparam.extend = g_sfac_d[l_ac].sfac001
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfac_d[l_ac].sfac001 = g_sfac_d_t.sfac001
                     NEXT FIELD sfac001
                  END IF
               END IF
               
               #特征管理
               SELECT imaa005 INTO l_imaa005_1 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfac_d[l_ac].sfac001
               IF g_sfac_d[l_ac].sfac002 = '2' THEN
                  SELECT imaa005 INTO l_imaa005 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfaa_m.sfaa010                 
                  IF NOT cl_null(l_imaa005) THEN
                     IF cl_null(l_imaa005_1) OR l_imaa005 != l_imaa005_1 THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = ''
                        LET g_errparam.extend = g_sfac_d[l_ac].sfac001
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                        LET g_sfac_d[l_ac].sfac001 = g_sfac_d_t.sfac001
                        NEXT FIELD sfac001
                     END IF
                  END IF
               END IF
                              
               IF NOT cl_null(l_imaa005_1) THEN
                  IF l_cmd = 'a' THEN
                     CALL l_inam.clear()          
                     CALL s_feature_multi(g_sfac_d[l_ac].sfac001,'','',g_site,g_sfaa_m.sfaadocno) RETURNING l_success,l_inam
                     LET g_sfac_d[l_ac].sfac006 = l_inam[1].inam002
                     LET g_sfac_d[l_ac].sfac003 = l_inam[1].inam004
                  END IF
               END IF
               
               #检查产品特征
               IF NOT cl_null(g_sfac_d[l_ac].sfac006) THEN                 
                  IF NOT s_feature_check(g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac006) THEN
                     LET g_sfac_d[l_ac].sfac006 = g_sfac_d_t.sfac006
                     NEXT FIELD sfac006
                  END IF
                  #显示产品特征说明
                  CALL s_feature_description(g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac006)
                     RETURNING l_success,g_sfac_d[l_ac].sfac006_desc
                  IF NOT l_success THEN
                     LET g_sfac_d[l_ac].sfac006_desc = ''
                  END IF
               ELSE 
                  LET g_sfac_d[l_ac].sfac006_desc = ''
               END IF
               DISPLAY BY NAME g_sfac_d[l_ac].sfac006_desc
            END IF
            
            #单位为空
            IF cl_null(g_sfac_d[l_ac].sfac004) THEN
               SELECT imae016 INTO g_sfac_d[l_ac].sfac004 FROM imae_t 
                WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfac_d[l_ac].sfac001
               IF cl_null(g_sfac_d[l_ac].sfac004) THEN
                  SELECT imaa006 INTO g_sfac_d[l_ac].sfac004 FROM imaa_t 
                   WHERE imaaent = g_enterprise AND imaa001 = g_sfac_d[l_ac].sfac001
               END IF
            END IF
            IF NOT cl_null(g_sfac_d[l_ac].sfac001) THEN
               CALL asft300_show_sfac_desc(l_ac)
            END IF 
               

         ON ACTION controlp INFIELD sfac001
		   	INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfac_d[l_ac].sfac001             #給予default值
            CALL q_imaa001()                                #呼叫開窗
            LET g_sfac_d[l_ac].sfac001 = g_qryparam.return1              #將開窗取得的值回傳到變數
            NEXT FIELD sfac001                         #返回原欄位


         #此段落由子樣板a02產生
         AFTER FIELD sfac003
            IF g_sfac_d[l_ac].sfac003 < 0 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'agl-00041'
               LET g_errparam.extend = g_sfac_d[l_ac].sfac003
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET g_sfac_d[l_ac].sfac003 = g_sfac_d_t.sfac003
               NEXT FIELD sfac003
            END IF 
            #单位取位
            IF NOT cl_null(g_sfac_d[l_ac].sfac004) THEN
               CALL s_aooi250_take_decimals(g_sfac_d[l_ac].sfac004,g_sfac_d[l_ac].sfac003)
                    RETURNING l_success,g_sfac_d[l_ac].sfac003
            END IF
            
         AFTER FIELD sfac006
            IF NOT cl_null(g_sfac_d[l_ac].sfac001) AND NOT cl_null(g_sfac_d[l_ac].sfac006) THEN
               SELECT COUNT(*) INTO l_n FROM sfac_t 
                WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno = g_sfaa_m.sfaadocno
                  AND sfac006 = g_sfac_d[l_ac].sfac006 AND sfac002 = '1'
               IF l_n = 0 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = ''
                  LET g_errparam.extend = g_sfac_d[l_ac].sfac006
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfac_d[l_ac].sfac006 = g_sfac_d_t.sfac006
                  NEXT FIELD sfac006
               END IF
               
               #检查产品特征
               IF NOT s_feature_check(g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac006) THEN
                  LET g_sfac_d[l_ac].sfac006 = g_sfac_d_t.sfac006
                  NEXT FIELD sfac006
               END IF
               #显示产品特征说明
               CALL s_feature_description(g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac006)
                  RETURNING l_success,g_sfac_d[l_ac].sfac006_desc
               IF NOT l_success THEN
                  LET g_sfac_d[l_ac].sfac006_desc = ''
               END IF
            ELSE 
               LET g_sfac_d[l_ac].sfac006_desc = ''
            END IF

            DISPLAY BY NAME g_sfac_d[l_ac].sfac006_desc
           
         ON ACTION controlp INFIELD sfac006
            #料号做特征管理
            SELECT imaa005 INTO l_imaa005_1 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfac_d[l_ac].sfac001
            IF NOT cl_null(l_imaa005_1) THEN
               IF l_cmd = 'a' THEN 
                  CALL l_inam.clear()          
                  CALL s_feature_multi(g_sfac_d[l_ac].sfac001,'','',g_site,g_sfaa_m.sfaadocno) RETURNING l_success,l_inam
                  LET g_sfac_d[l_ac].sfac006 = l_inam[1].inam002
                  LET g_sfac_d[l_ac].sfac003 = l_inam[1].inam004                   
               END IF
               IF l_cmd = 'u' THEN
                  CALL s_feature_single(g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac006,g_site,g_sfaa_m.sfaadocno)
                     RETURNING l_success,g_sfac_d[l_ac].sfac006
               END IF
            END IF
            
         AFTER INPUT 
            IF g_sfaa_m.sfaa003 != '3' THEN
               DECLARE asft300_input_chk_sfac_cs CURSOR FOR 
                SELECT * FROM sfac_t 
                 WHERE sfacent = g_enterprise AND sfacdocno = g_sfaa_m.sfaadocno
                   AND (sfac002 = '1' OR sfac002 = '2')
               LET l_sfac003_sum = 0
               FOREACH asft300_input_chk_sfac_cs INTO l_sfac.*
                  CALL s_aooi250_convert_qty(l_sfac.sfac001,l_sfac.sfac004,g_sfaa_m.sfaa013,l_sfac.sfac003) 
                       RETURNING l_success,l_sfac003
                  IF NOT l_success THEN
                     LET l_sfac003 = l_sfac.sfac003
                  END IF
                  LET l_sfac003_sum = l_sfac003_sum + l_sfac003
               END FOREACH
               IF l_sfac003_sum != g_sfaa_m.sfaa012 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00476'
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
                  NEXT FIELD sfac003
               END IF
            END IF

      END INPUT
      
      INPUT ARRAY g_sfad_d FROM s_sfad.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS,
                  INSERT ROW = l_allow_insert,
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
                  
         BEFORE INPUT
            IF g_flag_date = 'Y' THEN
               EXIT DIALOG
            END IF 
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN
               CALL FGL_SET_ARR_CURR(g_sfad_d.getLength()+1)
               LET g_insert = 'N'
            END IF

            CALL asft300_b_fill_sfad()
            LET g_rec_b_sfad = g_sfad_d.getLength()
            
            #生产料号未做特征管理，不可维护单身
            SELECT imaa005 INTO l_imaa005 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfaa_m.sfaa010
            IF cl_null(l_imaa005) THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00160'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

               EXIT DIALOG
            END IF
            
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()

            LET l_lock_sw = 'N'  

            CALL s_transaction_begin()
            OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

            IF STATUS THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  STATUS
               LET g_errparam.extend = "OPEN asft300_cl:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CLOSE asft300_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF

          #  LET g_rec_b_sfad = g_sfad_d.getLength()

            IF g_rec_b_sfad >= l_ac AND g_sfad_d[l_ac].sfad001 IS NOT NULL THEN
               LET l_cmd='u'
               LET g_sfad_d_t.* = g_sfad_d[l_ac].*  #BACKUP
               OPEN asft300_sfad_bcl USING g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfad_d[l_ac].sfadseq
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "OPEN asft300_sfad_bcl"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET l_lock_sw='Y'
               ELSE
                  FETCH asft300_sfad_bcl INTO g_sfad_d[l_ac].*
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = g_sfad_d_t.sfad001
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = "Y"
                  END IF
               #  CALL asft300_show_sfad_desc(l_ac)
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_sfad_d[l_ac].* TO NULL

            LET g_sfad_d_t.* = g_sfad_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            NEXT FIELD sfadseq
                  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CANCEL INSERT
            END IF

            SELECT COUNT(*) INTO l_count FROM sfad_t
             WHERE sfadent = g_enterprise
               AND sfadsite = g_site
               AND sfaddocno = g_sfaa_m.sfaadocno
               AND sfadseq = g_sfad_d[l_ac].sfadseq
               AND sfad001 = g_sfad_d[l_ac].sfad001

            #資料未重複, 插入新增資料
            IF l_count = 0 THEN
               INSERT INTO sfad_t(sfadent,sfadsite,sfaddocno,sfadseq,sfad001,sfad002,sfad003)
               VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfad_d[l_ac].sfadseq,g_sfad_d[l_ac].sfad001,g_sfad_d[l_ac].sfad002,g_sfad_d[l_ac].sfad003)
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "INSERT sfad_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL INSERT
               ELSE
                  CALL s_transaction_end('Y','0')
                  ERROR 'INSERT O.K'
                  LET g_rec_b_sfad=g_rec_b_sfad+1
               END IF
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_sfad_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF

         BEFORE DELETE                            #是否取消單身
            IF NOT cl_null(g_sfad_d[l_ac].sfad001) THEN
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF

               DELETE FROM sfad_t
                WHERE sfadent = g_enterprise
                  AND sfadsite= g_site
                  AND sfaddocno = g_sfaa_m.sfaadocno
                  AND sfadseq = g_sfad_d[l_ac].sfadseq
                  AND sfad001 = g_sfad_d[l_ac].sfad001
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfad_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE
               ELSE
                  LET g_rec_b_sfad = g_rec_b_sfad-1
                  CALL s_transaction_end('Y','0')
               END IF
               CLOSE asft300_sfad_bcl
               LET l_count = g_sfad_d.getLength()
            END IF

         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_sfad_d[l_ac].* = g_sfad_d_t.*
               CLOSE asft300_sfad_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF

            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = g_sfad_d[l_ac].sfad001
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_sfad_d[l_ac].* = g_sfad_d_t.*
            ELSE
               UPDATE sfad_t SET (sfadent,sfadsite,sfaddocno,sfadseq,sfad001,sfad002,sfad003) = (g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfad_d[l_ac].sfadseq,g_sfad_d[l_ac].sfad001,g_sfad_d[l_ac].sfad002,g_sfad_d[l_ac].sfad003)
                WHERE sfadent = g_enterprise
                  AND sfadsite = g_site
                  AND sfaddocno = g_sfaa_m.sfaadocno
                  AND sfadseq = g_sfad_d_t.sfadseq
                  AND sfad001 = g_sfad_d_t.sfad001

               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "sfad_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     LET g_sfad_d[l_ac].* = g_sfad_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfad_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                     LET g_sfad_d[l_ac].* = g_sfad_d_t.*
                     CALL s_transaction_end('N','0')
                  OTHERWISE
                     CALL s_transaction_end('Y','0')
                     ERROR 'UPDATE O.K'
               END CASE
            END IF

         BEFORE FIELD sfadseq
            IF cl_null(g_sfad_d[l_ac].sfadseq) OR g_sfad_d[l_ac].sfadseq = 0  THEN 
               SELECT MAX(sfadseq)+1 INTO g_sfad_d[l_ac].sfadseq FROM sfad_t
                WHERE sfadent = g_enterprise
                  AND sfadsite = g_site
                  AND sfaddocno = g_sfaa_m.sfaadocno
               IF cl_null(g_sfad_d[l_ac].sfadseq) THEN
                  LET g_sfad_d[l_ac].sfadseq = 1
               END IF                
            END IF
            
         AFTER FIELD sfadseq
            IF NOT cl_ap_chk_Range(g_sfad_d[l_ac].sfadseq,"0","0","","","azz-00079",1) THEN
               LET g_sfad_d[l_ac].sfadseq = g_sfad_d_t.sfadseq
               NEXT FIELD sfadseq
            END IF

            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfad_d[l_ac].sfadseq) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfad_d[l_ac].sfadseq != g_sfad_d_t.sfadseq)) THEN
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfad_t WHERE "||"sfadent = '" ||g_enterprise|| "' AND sfadsite = '" ||g_site|| "' AND "||"sfaddocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfadseq = '"||g_sfad_d[l_ac].sfadseq ||"'",'std-00004',0) THEN
                     LET g_sfad_d[l_ac].sfadseq = g_sfad_d_t.sfadseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
          
         #----<<sfad001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfad001
            #add-point:BEFORE FIELD sfad001
            IF l_cmd = 'a' THEN 
               LET l_flag = 'N'
               CALL l_inam.clear()          
               CALL s_feature_multi(g_sfaa_m.sfaa010,'','',g_site,g_sfaa_m.sfaadocno) RETURNING l_success,l_inam
               FOR l_i = 1 TO l_inam.getLength()
                  SELECT COUNT(*) INTO l_n FROM sfad_t WHERE sfadent=g_enterprise AND sfadsite=g_site 
                     AND sfaddocno=g_sfaa_m.sfaadocno AND sfad001=l_inam[l_i].inam002
                  IF l_n = 0 THEN
                     SELECT MAX(sfadseq)+1 INTO l_sfad.sfadseq FROM sfad_t WHERE sfadent=g_enterprise AND sfaddocno=g_sfaa_m.sfaadocno
                     IF cl_null(l_sfad.sfadseq) THEN
                        LET l_sfad.sfadseq = 1
                     END IF
                     LET l_sfad.sfadent=g_enterprise
                     LET l_sfad.sfadsite=g_site
                     LET l_sfad.sfaddocno=g_sfaa_m.sfaadocno
                     LET l_sfad.sfad001=l_inam[l_i].inam002
                     LET l_sfad.sfad002=l_inam[l_i].inam004
                     LET l_sfad.sfad003=0
                     INSERT INTO sfad_t VALUES(l_sfad.*)
                  ELSE
                     UPDATE sfad_t SET sfad002=sfad002+l_inam[l_i].inam004 WHERE sfadent=g_enterprise AND sfadsite=g_site 
                        AND sfaddocno=g_sfaa_m.sfaadocno AND sfad001=l_inam[l_i].inam002
                  END IF
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfad_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                     LET l_flag = 'Y'
                     EXIT FOR
                  END IF
                  LET l_flag1 = 'N'
               END FOR
               IF l_flag = 'Y' THEN
                  CALL s_transaction_end('N','0')
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
               CALL asft300_b_fill_sfad()
               LET g_rec_b_sfad = g_sfad_d.getLength()
               IF l_flag1 = 'N' THEN
                  EXIT DIALOG
               END IF                  
            END IF
            IF l_cmd = 'u' THEN
               CALL s_feature_single(g_sfaa_m.sfaa010,g_sfad_d[l_ac].sfad001,g_site,g_sfaa_m.sfaadocno) RETURNING l_success,g_sfad_d[l_ac].sfad001
               DISPLAY BY NAME g_sfad_d[l_ac].sfad001
            END IF
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfad001

            #add-point:AFTER FIELD sfad001
            IF NOT cl_null(g_sfad_d[l_ac].sfad001) AND (cl_null(g_sfad_d_t.sfad001) OR g_sfad_d[l_ac].sfad001 != g_sfad_d_t.sfad001) THEN
               SELECT COUNT(*) INTO l_n FROM sfad_t WHERE sfadent=g_enterprise AND sfadsite=g_site 
                  AND sfaddocno=g_sfaa_m.sfaadocno AND sfad001=g_sfad_d[l_ac].sfad001
               IF l_n > 0 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00158'
                  LET g_errparam.extend = g_sfad_d[l_ac].sfad001
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfad_d[l_ac].sfad001 = g_sfad_d_t.sfad001
                  NEXT FIELD sfad001
               END IF
            END IF
            #END add-point


         #Ctrlp:construct.c.sfad001
#         ON ACTION controlp INFIELD sfad001
            #add-point:ON ACTION controlp INFIELD sfad001
            
            #END add-point

         #----<<sfad002>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfad002
            #add-point:BEFORE FIELD sfad002
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfad002

            #add-point:AFTER FIELD sfad002
            IF NOT cl_ap_chk_Range(g_sfad_d[l_ac].sfad002,"0","0","","","azz-00079",1) THEN
               LET g_sfad_d[l_ac].sfad002 = g_sfad_d_t.sfad002
               NEXT FIELD sfad002
            END IF
            #END add-point

         AFTER INPUT 
            SELECT SUM(sfad002) INTO l_sum_sfad002 FROM sfad_t WHERE sfadent=g_enterprise AND sfadsite=g_site AND sfaddocno=g_sfaa_m.sfaadocno
            IF l_sum_sfad002 != g_sfaa_m.sfaa012 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00159'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

               NEXT FIELD sfad002
            END IF
       
      END INPUT
      
      INPUT ARRAY g_sfae_d FROM s_sfae.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS,
                  INSERT ROW = l_allow_insert,
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
                  
         BEFORE INPUT
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN
               CALL FGL_SET_ARR_CURR(g_sfae_d.getLength()+1)
               LET g_insert = 'N'
            END IF

            CALL asft300_b_fill_sfae()
            LET g_rec_b_sfae = g_sfae_d.getLength()
            
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()

            LET l_lock_sw = 'N'  

            CALL s_transaction_begin()
            OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

            IF STATUS THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  STATUS
               LET g_errparam.extend = "OPEN asft300_cl:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CLOSE asft300_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF

         #   LET g_rec_b_sfae = g_sfae_d.getLength()

            IF g_rec_b_sfae >= l_ac AND g_sfae_d[l_ac].sfaeseq IS NOT NULL THEN
               LET l_cmd='u'
               LET g_sfae_d_t.* = g_sfae_d[l_ac].*  #BACKUP
               OPEN asft300_sfae_bcl USING g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfae_d[l_ac].sfaeseq
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "OPEN asft300_sfae_bcl"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET l_lock_sw='Y'
               ELSE
                  FETCH asft300_sfae_bcl INTO g_sfae_d[l_ac].*
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = g_sfae_d_t.sfae001
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = "Y"
                  END IF
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = g_sfae_d[l_ac].sfae005
                  CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
                  LET g_sfae_d[l_ac].sfae005_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfae_d[l_ac].sfae005_desc
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_sfae_d[l_ac].* TO NULL
            LET g_sfae_d[l_ac].sfae004 = 0

            LET g_sfae_d_t.* = g_sfae_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            NEXT FIELD sfaeseq
                  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CANCEL INSERT
            END IF

            SELECT COUNT(*) INTO l_count FROM sfae_t
             WHERE sfaeent = g_enterprise
               AND sfaesite = g_site
               AND sfaedocno = g_sfaa_m.sfaadocno
               AND sfaeseq = g_sfae_d[l_ac].sfaeseq

            #資料未重複, 插入新增資料
            IF l_count = 0 THEN
               INSERT INTO sfae_t(sfaeent,sfaesite,sfaedocno,sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,sfae006)
               VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfae_d[l_ac].sfaeseq,g_sfae_d[l_ac].sfae001,g_sfae_d[l_ac].sfae002,g_sfae_d[l_ac].sfae003,g_sfae_d[l_ac].sfae004,g_sfae_d[l_ac].sfae005,g_sfae_d[l_ac].sfae006)
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "INSERT sfae_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL INSERT
               ELSE
                  CALL s_transaction_end('Y','0')
                  ERROR 'INSERT O.K'
                  LET g_rec_b_sfae=g_rec_b_sfae+1
               END IF
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_sfae_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF

         BEFORE DELETE                            #是否取消單身
            IF NOT cl_null(g_sfae_d[l_ac].sfaeseq) THEN
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF

               DELETE FROM sfae_t
                WHERE sfaeent = g_enterprise
                  AND sfaesite= g_site
                  AND sfaedocno = g_sfaa_m.sfaadocno
                  AND sfaeseq = g_sfae_d[l_ac].sfaeseq
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfae_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE
               ELSE
                  LET g_rec_b_sfae = g_rec_b_sfae-1
                  CALL s_transaction_end('Y','0')
               END IF
               CLOSE asft300_sfae_bcl
               LET l_count = g_sfae_d.getLength()
            END IF

         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_sfae_d[l_ac].* = g_sfae_d_t.*
               CLOSE asft300_sfae_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF

            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = g_sfae_d[l_ac].sfaeseq
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_sfae_d[l_ac].* = g_sfae_d_t.*
            ELSE
               IF g_sfaa_m.sfaastus = 'Y' THEN
                  LET g_sfae_d[l_ac].sfae004 = g_sfae_d[l_ac].sfae004 + 1
                  LET g_sfae_d[l_ac].sfae005 = g_user
                  LET g_sfae_d[l_ac].sfae006 = g_today
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = g_sfae_d[l_ac].sfae005
                  CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
                  LET g_sfae_d[l_ac].sfae005_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfae_d[l_ac].sfae005_desc
               END IF
               UPDATE sfae_t SET (sfaeent,sfaesite,sfaedocno,sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,sfae006) = (g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfae_d[l_ac].sfaeseq,g_sfae_d[l_ac].sfae001,g_sfae_d[l_ac].sfae002,g_sfae_d[l_ac].sfae003,g_sfae_d[l_ac].sfae004,g_sfae_d[l_ac].sfae005,g_sfae_d[l_ac].sfae006)
                WHERE sfaeent = g_enterprise
                  AND sfaesite = g_site
                  AND sfaedocno = g_sfaa_m.sfaadocno
                  AND sfaeseq = g_sfae_d_t.sfaeseq

               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "sfae_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     LET g_sfae_d[l_ac].* = g_sfae_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfae_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                     LET g_sfae_d[l_ac].* = g_sfae_d_t.*
                     CALL s_transaction_end('N','0')
                  OTHERWISE
                     CALL s_transaction_end('Y','0')
                     ERROR 'UPDATE O.K'
               END CASE
            END IF

         #----<<sfaeseq>>----
         BEFORE FIELD sfaeseq
            IF cl_null(g_sfae_d[l_ac].sfaeseq) OR g_sfae_d[l_ac].sfaeseq = 0  THEN 
               SELECT MAX(sfaeseq)+1 INTO g_sfae_d[l_ac].sfaeseq FROM sfae_t
                WHERE sfaeent = g_enterprise
                  AND sfaesite = g_site
                  AND sfaedocno = g_sfaa_m.sfaadocno
               IF cl_null(g_sfae_d[l_ac].sfaeseq) THEN
                  LET g_sfae_d[l_ac].sfaeseq = 1
                  LET g_sfae_d[l_ac].sfae002 = g_sfaa_m.sfaa019
               ELSE
                  SELECT sfae002 INTO g_sfae_d[l_ac].sfae002 FROM sfae_t WHERE sfaeent=g_enterprise AND sfaesite=g_site
                     AND sfaedocno=g_sfaa_m.sfaadocno AND sfaeseq=g_sfae_d[l_ac].sfaeseq-1
               END IF                
            END IF
            
         AFTER FIELD sfaeseq
            IF NOT cl_ap_chk_Range(g_sfae_d[l_ac].sfaeseq,"0","0","","","azz-00079",1) THEN
               LET g_sfae_d[l_ac].sfaeseq = g_sfae_d_t.sfaeseq
               NEXT FIELD sfaeseq
            END IF

            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfae_d[l_ac].sfaeseq) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfae_d[l_ac].sfaeseq != g_sfae_d_t.sfaeseq)) THEN
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfae_t WHERE "||"sfaeent = '" ||g_enterprise|| "' AND sfaesite = '" ||g_site|| "' AND "||"sfaedocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfaeseq = '"||g_sfae_d[l_ac].sfaeseq ||"'",'std-00004',0) THEN
                     LET g_sfae_d[l_ac].sfaeseq = g_sfae_d_t.sfaeseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


         #Ctrlp:construct.c.sfaeseq
#         ON ACTION controlp INFIELD sfaeseq
            #add-point:ON ACTION controlp INFIELD sfaeseq
            
            #END add-point

         #----<<sfae001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfae001
            #add-point:BEFORE FIELD sfae001
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfae001

            #add-point:AFTER FIELD sfae001
            IF NOT cl_ap_chk_Range(g_sfae_d[l_ac].sfae001,"0","0","","","azz-00079",1) THEN
               LET g_sfae_d[l_ac].sfae001 = g_sfae_d_t.sfae001
               NEXT FIELD sfae001
            END IF
            #END add-point


         #Ctrlp:construct.c.sfae001
#         ON ACTION controlp INFIELD sfae001
            #add-point:ON ACTION controlp INFIELD sfae001
            
            #END add-point

         #----<<sfae002>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfae002
            #add-point:BEFORE FIELD sfae002
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfae002

            #add-point:AFTER FIELD sfae002
            IF NOT cl_null(g_sfae_d[l_ac].sfae002) AND (cl_null(g_sfae_d_t.sfae002) OR g_sfae_d[l_ac].sfae002!=g_sfae_d_t.sfae002) THEN
               IF g_sfae_d[l_ac].sfae002 < g_sfaa_m.sfaadocdt THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'asf-00162'
                  LET g_errparam.extend = g_sfae_d[l_ac].sfae002
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfae_d[l_ac].sfae002=g_sfae_d_t.sfae002
                  NEXT FIELD sfae002
               END IF
               SELECT MAX(sfae002) INTO l_sfae002_max FROM sfae_t WHERE sfaeent=g_enterprise AND sfaesite=g_site
                  AND sfaedocno=g_sfaa_m.sfaadocno AND sfaeseq<g_sfae_d[l_ac].sfaeseq
               SELECT MIN(sfae002) INTO l_sfae002_min FROM sfae_t WHERE sfaeent=g_enterprise AND sfaesite=g_site
                  AND sfaedocno=g_sfaa_m.sfaadocno AND sfaeseq>g_sfae_d[l_ac].sfaeseq
               IF NOT cl_null(l_sfae002_max) THEN
                  IF g_sfae_d[l_ac].sfae002 < l_sfae002_max THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00163'
                     LET g_errparam.extend = g_sfae_d[l_ac].sfae002
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfae_d[l_ac].sfae002=g_sfae_d_t.sfae002
                     NEXT FIELD sfae002
                  END IF
               END IF
               IF NOT cl_null(l_sfae002_min) THEN
                  IF g_sfae_d[l_ac].sfae002 > l_sfae002_min THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00163'
                     LET g_errparam.extend = g_sfae_d[l_ac].sfae002
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfae_d[l_ac].sfae002=g_sfae_d_t.sfae002
                     NEXT FIELD sfae002
                  END IF
               END IF
            END IF
                  
               
            #END add-point
         AFTER INPUT 
            SELECT SUM(sfae001) INTO l_sum_sfae001 FROM sfae_t WHERE sfaeent=g_enterprise AND sfaesite=g_site AND sfaedocno=g_sfaa_m.sfaadocno
            IF l_sum_sfae001 > g_sfaa_m.sfaa012 THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00164'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

               NEXT FIELD sfae001
            END IF

         #Ctrlp:construct.c.sfae002
#         ON ACTION controlp INFIELD sfae002
            #add-point:ON ACTION controlp INFIELD sfae002
            
            #END add-point

         #----<<sfae003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfae003
            #add-point:BEFORE FIELD sfae003
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfae003

            #add-point:AFTER FIELD sfae003
            
            #END add-point


         #Ctrlp:construct.c.sfae003
#         ON ACTION controlp INFIELD sfae003
            #add-point:ON ACTION controlp INFIELD sfae003
            
            #END add-point

         #----<<sfae004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfae004
            #add-point:BEFORE FIELD sfae004
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfae004

            #add-point:AFTER FIELD sfae004
            
            #END add-point


         #Ctrlp:construct.c.sfae004
#         ON ACTION controlp INFIELD sfae004
            #add-point:ON ACTION controlp INFIELD sfae004
            
            #END add-point

         #----<<sfae005>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfae005
            #add-point:BEFORE FIELD sfae005
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfae005

            #add-point:AFTER FIELD sfae005
            
            #END add-point


         #Ctrlp:construct.c.sfae005
#         ON ACTION controlp INFIELD sfae005
            #add-point:ON ACTION controlp INFIELD sfae005
            
            #END add-point

         #----<<sfae006>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfae006
            #add-point:BEFORE FIELD sfae006
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfae006

            #add-point:AFTER FIELD sfae006
            
            #END add-point


         #Ctrlp:construct.c.sfae006
#         ON ACTION controlp INFIELD sfae006
            #add-point:ON ACTION controlp INFIELD sfae006
            
            #END add-point
      END INPUT
      
      INPUT ARRAY g_sfaf_d FROM s_sfaf.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS,
                  INSERT ROW = l_allow_insert,
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
                  
         BEFORE INPUT
            IF g_flag_date = 'Y' THEN
               EXIT DIALOG
            END IF 
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN
               CALL FGL_SET_ARR_CURR(g_sfaf_d.getLength()+1)
               LET g_insert = 'N'
            END IF

            CALL asft300_b_fill_sfaf()
            LET g_rec_b_sfaf = g_sfaf_d.getLength()
            
         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()

            LET l_lock_sw = 'N'  

            CALL s_transaction_begin()
            OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

            IF STATUS THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  STATUS
               LET g_errparam.extend = "OPEN asft300_cl:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CLOSE asft300_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF

         #   LET g_rec_b_sfaf = g_sfaf_d.getLength()

            IF g_rec_b_sfaf >= l_ac AND g_sfaf_d[l_ac].sfaf001 IS NOT NULL THEN
               LET l_cmd='u'
               LET g_sfaf_d_t.* = g_sfaf_d[l_ac].*  #BACKUP
               OPEN asft300_sfaf_bcl USING g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfaf_d[l_ac].sfafseq
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "OPEN asft300_sfaf_bcl"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET l_lock_sw='Y'
               ELSE
                  FETCH asft300_sfaf_bcl INTO g_sfaf_d[l_ac].*
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = g_sfaf_d_t.sfaf001
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = "Y"
                  END IF
               #  CALL asft300_show_sfaf_desc(l_ac)
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            
         BEFORE INSERT
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_sfaf_d[l_ac].* TO NULL

            LET g_sfaf_d_t.* = g_sfaf_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            NEXT FIELD sfafseq
                  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CANCEL INSERT
            END IF

            SELECT COUNT(*) INTO l_count FROM sfaf_t
             WHERE sfafent = g_enterprise
               AND sfafsite = g_site
               AND sfafdocno = g_sfaa_m.sfaadocno
               AND sfafseq = g_sfaf_d[l_ac].sfafseq
               AND sfaf001 = g_sfaf_d[l_ac].sfaf001

            #資料未重複, 插入新增資料
            IF l_count = 0 THEN
               INSERT INTO sfaf_t(sfafent,sfafsite,sfafdocno,sfafseq,sfaf001)
               VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfaf_d[l_ac].sfafseq,g_sfaf_d[l_ac].sfaf001)
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "INSERT sfaf_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL INSERT
               ELSE
                  CALL s_transaction_end('Y','0')
                  ERROR 'INSERT O.K'
                  LET g_rec_b_sfaf=g_rec_b_sfaf+1
               END IF
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_sfaf_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF

         BEFORE DELETE                            #是否取消單身
            IF NOT cl_null(g_sfaf_d[l_ac].sfaf001) THEN
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF

               DELETE FROM sfaf_t
                WHERE sfafent = g_enterprise
                  AND sfafsite= g_site
                  AND sfafdocno = g_sfaa_m.sfaadocno
                  AND sfafseq = g_sfaf_d[l_ac].sfafseq
                  AND sfaf001 = g_sfaf_d[l_ac].sfaf001
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfaf_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE
               ELSE
                  LET g_rec_b_sfaf = g_rec_b_sfaf-1
                  CALL s_transaction_end('Y','0')
               END IF
               CLOSE asft300_sfaf_bcl
               LET l_count = g_sfaf_d.getLength()
            END IF

         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_sfaf_d[l_ac].* = g_sfaf_d_t.*
               CLOSE asft300_sfaf_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF

            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = g_sfaf_d[l_ac].sfaf001
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_sfaf_d[l_ac].* = g_sfaf_d_t.*
            ELSE
               UPDATE sfaf_t SET (sfafent,sfafsite,sfafdocno,sfafseq,sfaf001) = (g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfaf_d[l_ac].sfafseq,g_sfaf_d[l_ac].sfaf001)
                WHERE sfafent = g_enterprise
                  AND sfafsite = g_site
                  AND sfafdocno = g_sfaa_m.sfaadocno
                  AND sfafseq = g_sfaf_d_t.sfafseq
                  AND sfaf001 = g_sfaf_d_t.sfaf001

               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "sfaf_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     LET g_sfaf_d[l_ac].* = g_sfaf_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = SQLCA.sqlcode
                  LET g_errparam.extend = "sfaf_t"
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                     LET g_sfaf_d[l_ac].* = g_sfaf_d_t.*
                     CALL s_transaction_end('N','0')
                  OTHERWISE
                     CALL s_transaction_end('Y','0')
                     ERROR 'UPDATE O.K'
               END CASE
            END IF

         BEFORE FIELD sfafseq
            IF cl_null(g_sfaf_d[l_ac].sfafseq) OR g_sfaf_d[l_ac].sfafseq = 0  THEN 
               SELECT MAX(sfafseq)+1 INTO g_sfaf_d[l_ac].sfafseq FROM sfaf_t
                WHERE sfafent = g_enterprise
                  AND sfafsite = g_site
                  AND sfafdocno = g_sfaa_m.sfaadocno
               IF cl_null(g_sfaf_d[l_ac].sfafseq) THEN
                  LET g_sfaf_d[l_ac].sfafseq = 1
               END IF                
            END IF
            
         AFTER FIELD sfafseq
            IF NOT cl_ap_chk_Range(g_sfaf_d[l_ac].sfafseq,"0","0","","","azz-00079",1) THEN
               LET g_sfaf_d[l_ac].sfafseq = g_sfaf_d_t.sfafseq
               NEXT FIELD sfafseq
            END IF

            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfaf_d[l_ac].sfafseq) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfaf_d[l_ac].sfafseq != g_sfaf_d_t.sfafseq)) THEN
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfaf_t WHERE "||"sfafent = '" ||g_enterprise|| "' AND sfafsite = '" ||g_site|| "' AND "||"sfafdocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfafseq = '"||g_sfaf_d[l_ac].sfafseq ||"'",'std-00004',0) THEN
                     LET g_sfaf_d[l_ac].sfafseq = g_sfaf_d_t.sfafseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
             

         #----<<sfaf001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfaf001
            #add-point:BEFORE FIELD sfaf001
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfaf001

            #add-point:AFTER FIELD sfaf001
            IF NOT cl_null(g_sfaf_d[l_ac].sfaf001) AND (cl_null(g_sfaf_d_t.sfaf001) OR g_sfaf_d[l_ac].sfaf001 != g_sfaf_d_t.sfaf001) THEN
               SELECT COUNT(*) INTO l_n FROM sfaf_t WHERE sfafent=g_enterprise AND sfafdocno=g_sfaa_m.sfaadocno AND sfafsite=g_site AND sfaf001=g_sfaf_d[l_ac].sfaf001 
               IF l_n > 0 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'std-00004'
                  LET g_errparam.extend = g_sfaf_d[l_ac].sfaf001
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfaf_d[l_ac].sfaf001=g_sfaf_d_t.sfaf001
                  NEXT FIELD sfaf001
               END IF
            END IF
            #END add-point


         #Ctrlp:construct.c.sfaf001
#         ON ACTION controlp INFIELD sfaf001
            #add-point:ON ACTION controlp INFIELD sfaf001
            
            #END add-point

      END INPUT
      
           #單頭段
      INPUT BY NAME g_sfaa_m.ooff013
         ATTRIBUTE(WITHOUT DEFAULTS)
         
         BEFORE INPUT
            IF g_flag_date = 'Y' THEN
               EXIT DIALOG
            END IF 

         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF

            CALL s_transaction_begin()

            IF NOT cl_null(g_sfaa_m.ooff013) THEN
               IF s_aooi360_gen('6',g_sfaa_m.sfaadocno,' ',' ',' ',' ',' ',' ',' ',' ',' ','2',g_sfaa_m.ooff013) THEN
                  CALL s_transaction_end('Y','0')
               ELSE
                  CALL s_transaction_end('N','0')
               END IF
            ELSE
               IF s_aooi360_del('6',g_sfaa_m.sfaadocno,' ',' ',' ',' ',' ',' ',' ',' ',' ','2') THEN
                  CALL s_transaction_end('Y','0')
               ELSE
                  CALL s_transaction_end('N','0')
               END IF
            END IF
      END INPUT
      
      #Page1 預設值產生於此處
      INPUT ARRAY g_sfba_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS,
                  INSERT ROW = l_allow_insert,
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)

         #自訂ACTION(detail_input,page_1)


         BEFORE INPUT           
            IF g_flag_date = 'Y' THEN
               EXIT DIALOG
            END IF 
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN
              CALL FGL_SET_ARR_CURR(g_sfba_d.getLength()+1)
              LET g_insert = 'N'
           END IF

            CALL asft300_b_fill()
            LET g_rec_b = g_sfba_d.getLength()
            IF g_rec_b = 0 THEN
               CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
               IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0038') = '1' THEN
                  CALL s_transaction_begin()
                  CALL s_asft300_02(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa003,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa015,g_sfaa_m.sfaa012,'N') RETURNING l_success,l_num
                  IF NOT l_success THEN
                     CALL s_transaction_end('N','0')
                  ELSE
                     CALL s_transaction_end('Y','0')
                  END IF
                  CALL asft300_b_fill()
                  LET g_rec_b = g_sfba_d.getLength()
               END IF
            END IF

         BEFORE ROW
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac

            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx

            CALL s_transaction_begin()
            OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

            IF STATUS THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code =  STATUS
               LET g_errparam.extend = "OPEN asft300_cl:"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CLOSE asft300_cl
               CALL s_transaction_end('N','0')
               RETURN
            END IF

            #FETCH asft300_cl INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.oobal004,g_sfaa_m.sfaa002,g_sfaa_m.sfaa002_desc,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa009,g_sfaa_m.sfaa009_desc,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa010_desc,g_sfaa_m.sfaa010_desc1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa016_desc,g_sfaa_m.sfaa017,g_sfaa_m.sfaa017_desc,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfab001,g_sfaa_m.sfab002,g_sfaa_m.sfab003,g_sfaa_m.sfab004,g_sfaa_m.sfab005,g_sfaa_m.a1,g_sfaa_m.a2,g_sfaa_m.a3,g_sfaa_m.a4,g_sfaa_m.a5,g_sfaa_m.sfab006,g_sfaa_m.a6,g_sfaa_m.a6_desc,g_sfaa_m.a7,g_sfaa_m.a7_desc,g_sfaa_m.a8,g_sfaa_m.a8_desc,g_sfaa_m.sfac002,g_sfaa_m.sfac001,g_sfaa_m.sfac001_desc,g_sfaa_m.sfac001_desc1,g_sfaa_m.sfac003,g_sfaa_m.sfac004,g_sfaa_m.sfac005,g_sfaa_m.sfad001,g_sfaa_m.sfad002,g_sfaa_m.sfad003,g_sfaa_m.sfaeseq,g_sfaa_m.sfae001,g_sfaa_m.sfae002,g_sfaa_m.sfae003,g_sfaa_m.sfae004,g_sfaa_m.sfae005,g_sfaa_m.sfae005_desc,g_sfaa_m.sfae006,g_sfaa_m.sfaf001,g_sfaa_m.ooff013,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaownid_desc,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaaowndp_desc,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtid_desc,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdp_desc,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamodid_desc,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfid_desc,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstid_desc,g_sfaa_m.sfaapstdt # 鎖住將被更改或取消的資料
            #IF SQLCA.sqlcode THEN
            #   CALL cl_err(g_sfaa_m.sfaadocno,SQLCA.sqlcode,0)
            #   CLOSE asft300_cl
            #   CALL s_transaction_end('N','0')
            #   RETURN
            #END IF

            LET g_rec_b = g_sfba_d.getLength()

            IF g_rec_b >= l_ac
               AND g_sfba_d[l_ac].sfbaseq IS NOT NULL
               AND g_sfba_d[l_ac].sfbaseq1 IS NOT NULL


            THEN
               LET l_cmd='u'
               LET g_sfba_d_t.* = g_sfba_d[l_ac].*  #BACKUP
               CALL asft300_set_entry_b(l_cmd)
               CALL asft300_set_no_entry_b(l_cmd)
               IF NOT asft300_lock_b("sfba_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH asft300_bcl INTO g_sfba_d[l_ac].sfbaseq,g_sfba_d[l_ac].sfbaseq1,g_sfba_d[l_ac].sfba002,g_sfba_d[l_ac].sfba003,g_sfba_d[l_ac].sfba004,g_sfba_d[l_ac].sfba005,g_sfba_d[l_ac].replace,g_sfba_d[l_ac].sfba022,g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba006_desc,g_sfba_d[l_ac].sfba006_desc_desc,g_sfba_d[l_ac].imaf013,g_sfba_d[l_ac].sfba021,g_sfba_d[l_ac].sfba007,g_sfba_d[l_ac].sfba008,g_sfba_d[l_ac].sfba009,g_sfba_d[l_ac].sfba010,g_sfba_d[l_ac].sfba011,g_sfba_d[l_ac].sfba012,g_sfba_d[l_ac].sfba023,g_sfba_d[l_ac].sfba024,g_sfba_d[l_ac].sfba013,g_sfba_d[l_ac].sfba014,g_sfba_d[l_ac].sfba015,g_sfba_d[l_ac].sfba016,g_sfba_d[l_ac].sfba025,g_sfba_d[l_ac].number1,g_sfba_d[l_ac].number2,g_sfba_d[l_ac].sfba017,g_sfba_d[l_ac].sfba018,g_sfba_d[l_ac].sfba019,g_sfba_d[l_ac].sfba020,g_sfba_d[l_ac].sfba029,g_sfba_d[l_ac].sfba030,g_sfba_d[l_ac].sfba028,g_sfba_d[l_ac].sfba001,g_sfba_d[l_ac].sfba026,g_sfba_d[l_ac].sfba027
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = g_sfba_d_t.sfbaseq
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET l_lock_sw = "Y"
                  END IF

                  CALL asft300_b_desc()

                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row
            CALL cl_set_comp_entry("sfba010,sfba011",TRUE)
            IF NOT cl_null(g_sfba_d[l_ac].sfba001) OR g_sfba_d[l_ac].sfbaseq1 != 0 THEN
               CALL cl_set_comp_entry("sfba010,sfba011",FALSE)
            END IF
            #end add-point
            #其他table資料備份(確定是否更改用)

            #其他table進行lock


         BEFORE INSERT

            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_sfba_d[l_ac].* TO NULL
            LET g_sfba_d[l_ac].sfba007 = 0
            LET g_sfba_d[l_ac].sfba008 = "3"
            IF g_sfaa_m.sfaa004 = '1' THEN
               LET g_sfba_d[l_ac].sfba009 = "N"
               CALL cl_set_comp_entry('sfba009',TRUE)
            END IF 
            IF g_sfaa_m.sfaa004 = '2' THEN
               LET g_sfba_d[l_ac].sfba009 = "Y"
               CALL cl_set_comp_entry('sfba009',FALSE)
            END IF
            LET g_sfba_d[l_ac].sfba010 = "1"
            LET g_sfba_d[l_ac].sfba011 = "1"
            LET g_sfba_d[l_ac].sfba012 = "0"
            LET g_sfba_d[l_ac].sfba023 = g_sfaa_m.sfaa012 * g_sfba_d[l_ac].sfba010 / g_sfba_d[l_ac].sfba011
            LET g_sfba_d[l_ac].sfba024 = "0"
            LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
            LET g_sfba_d[l_ac].sfba015 = "0"
            LET g_sfba_d[l_ac].sfba016 = "0"
            LET g_sfba_d[l_ac].sfba025 = "0"
            LET g_sfba_d[l_ac].number1 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba016           
            LET g_sfba_d[l_ac].sfba017 = "0"
            LET g_sfba_d[l_ac].sfba018 = "0"
            LET g_sfba_d[l_ac].sfba022 = 1
            LET g_sfba_d[l_ac].sfba026 = '1'
            LET g_sfba_d[l_ac].sfba028 = "N"
            LET g_sfba_d[l_ac].sfba021 = ' '
            
            LET g_sfba_d_t.* = g_sfba_d[l_ac].*     #新輸入資料
            
            SELECT MAX(sfbaseq) INTO g_sfba_d[l_ac].sfbaseq FROM sfba_t
             WHERE sfbaent = g_enterprise
               AND sfbasite = g_site
               AND sfbadocno = g_sfaa_m.sfaadocno
            CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
            CALL cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0049')  RETURNING l_sys
            IF cl_null(l_sys) OR l_sys = 0 THEN LET l_sys = 1 END IF    
            IF cl_null(g_sfba_d[l_ac].sfbaseq) THEN 
               LET g_sfba_d[l_ac].sfbaseq = l_sys                 
            ELSE  
               LET g_sfba_d[l_ac].sfbaseq = g_sfba_d[l_ac].sfbaseq+l_sys
            END IF   

            SELECT MAX(sfbaseq1)+1 INTO g_sfba_d[l_ac].sfbaseq1 FROM sfba_t
             WHERE sfbaent = g_enterprise
               AND sfbasite = g_site
               AND sfbadocno = g_sfaa_m.sfaadocno
               AND sfbaseq = g_sfba_d[l_ac].sfbaseq
            IF cl_null(g_sfba_d[l_ac].sfbaseq1) THEN
               LET g_sfba_d[l_ac].sfbaseq1 = 0 
            END IF 
          
            CALL cl_show_fld_cont()
            CALL asft300_set_entry_b(l_cmd)
            CALL asft300_set_no_entry_b(l_cmd)
            #公用欄位給值(單身)


            #add-point:modify段before insert
            
            #end add-point

         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               CANCEL INSERT
            END IF

            #add-point:單身新增
            LET l_rate = ''
            LET l_imaa006 = ''
            IF NOT cl_null(g_sfba_d[l_ac].sfba006) THEN 
               SELECT imaa006 INTO l_imaa006 FROM imaa_t
                WHERE imaaent = g_enterprise
                  AND imaa001 = g_sfba_d[l_ac].sfba006  
               IF NOT cl_null(g_sfba_d[l_ac].sfba006) AND NOT cl_null(l_imaa006) THEN
                  CALL s_aimi190_get_convert(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba014,l_imaa006) RETURNING l_success,l_rate
                  IF l_success = FALSE THEN
                     LET g_sfba_d[l_ac].sfba014 = g_sfba_d_t.sfba014
                     INITIALIZE g_ref_fields TO NULL
                     LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                     CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                     LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                     DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc 
                     NEXT FIELD sfba014                        
                  END IF
               END IF 
               IF cl_null(l_imaa006) THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'abm-00021'
                  LET g_errparam.extend = l_imaa006
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  LET g_sfba_d[l_ac].sfba014 = g_sfba_d_t.sfba014
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                  CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                  LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc 
                  NEXT FIELD sfba014 
               END IF
            END IF 
            #end add-point

            LET l_count = 1
            SELECT COUNT(*) INTO l_count FROM sfba_t
             WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno

               AND sfbaseq = g_sfba_d[l_ac].sfbaseq
               AND sfbaseq1 = g_sfba_d[l_ac].sfbaseq1



            #資料未重複, 插入新增資料
            IF l_count = 0 THEN
               #add-point:單身新增前
               
               #end add-point

                              INITIALIZE gs_keys TO NULL
               LET gs_keys[1] = g_sfaa_m.sfaadocno
               LET gs_keys[2] = g_sfba_d[g_detail_idx].sfbaseq
               LET gs_keys[3] = g_sfba_d[g_detail_idx].sfbaseq1
               CALL asft300_insert_b('sfba_t',gs_keys,"'1'")

               #add-point:單身新增後
               
               #end add-point
            ELSE
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = "std-00006"
               LET g_errparam.extend = 'INSERT'
               LET g_errparam.popup = TRUE
               CALL cl_err()

               INITIALIZE g_sfba_d[l_ac].* TO NULL
               CALL s_transaction_end('N','0')
               CANCEL INSERT
            END IF

            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "sfba_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()

               CALL s_transaction_end('N','0')
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL asft300_b_fill()
               #資料多語言用-增/改

               #add-point:input段-after_insert
               #其他产品特征写入DB
               IF l_inam.getLength() > 1 THEN  #因為第一筆資料已呈現在畫面並寫入DB, 從第二筆開始處理
                  SELECT * INTO l_sfba.* FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site
                     AND sfbadocno = g_sfaa_m.sfaadocno AND sfbaseq = g_sfba_d[l_ac].sfbaseq AND sfbaseq1 = g_sfba_d[l_ac].sfbaseq1
                  FOR l_k = 2 TO l_inam.getLength()
                     LET l_sfba.sfbaseq1 = l_sfba.sfbaseq1 + 1
                     LET l_sfba.sfba021 = l_inam[l_k].inam002
                     LET l_sfba.sfba023 = l_inam[l_k].inam004
                     LET l_sfba.sfba024 = 0
                     LET l_sfba.sfba013 = l_sfba.sfba023 + l_sfba.sfba024
                     #重算QPA分子分母
                     CALL asft300_sfba023_qpa(l_sfba.sfba023) RETURNING l_sfba.sfba010,l_sfba.sfba011
                     #建议应发数量
                     CALL s_asft300_03(l_sfba.sfba006,l_sfba.sfba013) RETURNING l_success,l_sfba013
                     IF l_success THEN
                        LET l_sfba.sfba013=l_sfba013
                     END IF               
                     LET l_sfba.sfba024 = l_sfba.sfba013 - l_sfba.sfba023
                     INSERT INTO sfba_t VALUES(l_sfba.*)
                  END FOR
                  CALL asft300_b_fill()
               END IF
               CALL l_inam.clear()
               #end add-point
               CALL s_transaction_end('Y','0')
               ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF

         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
               CALL g_sfba_d.deleteElement(l_ac)
               NEXT FIELD sfbaseq
            END IF

            IF g_sfba_d[l_ac].sfbaseq IS NOT NULL
               AND g_sfba_d_t.sfbaseq1 IS NOT NULL THEN
               
              #多项序有两种情况，一种是取替代，一种是多特征的，考虑到后面成本计算，都不做删除处理，
              #如需删除此项，对于取替代的话使用取替代还原操作，对于多特征的话直接把数量改成0
               SELECT COUNT(*) INTO l_n2 FROM sfba_t
                WHERE sfbaent = g_enterprise AND sfbasite = g_site 
                  AND sfbadocno = g_sfaa_m.sfaadocno 
                  AND sfbaseq = g_sfba_d[l_ac].sfbaseq
               IF l_n2 > 1 THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  'asf-00477'
                  LET g_errparam.extend = g_sfba_d[l_ac].sfbaseq
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL
                  LET g_errparam.code =  -263
                  LET g_errparam.extend = ""
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                  CANCEL DELETE
               END IF

               #add-point:單身刪除前
               
               #end add-point

               DELETE FROM sfba_t
                WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno AND

                      sfbaseq = g_sfba_d_t.sfbaseq
                  AND sfbaseq1 = g_sfba_d_t.sfbaseq1



               #add-point:單身刪除中
               
               #end add-point

               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "sfba_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()

                  CALL s_transaction_end('N','0')
                  CANCEL DELETE
               ELSE
                  LET g_rec_b = g_rec_b-1

                  #add-point:單身刪除後
                  
                  #end add-point
                  CALL s_transaction_end('Y','0')
               END IF
               CLOSE asft300_bcl
               LET l_count = g_sfba_d.getLength()
            END IF

                           INITIALIZE gs_keys TO NULL
               LET gs_keys[1] = g_sfaa_m.sfaadocno
               LET gs_keys[2] = g_sfba_d[g_detail_idx].sfbaseq
               LET gs_keys[3] = g_sfba_d[g_detail_idx].sfbaseq1


         AFTER DELETE
            #add-point:單身刪除後2
            
            #end add-point
                           CALL asft300_delete_b('sfba_t',gs_keys,"'1'")

         #---------------------<  Detail: page1  >---------------------
         #----<<sfbaseq>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfbaseq
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfbaseq,"0","0","","","azz-00079",1) THEN
               LET g_sfba_d[g_detail_idx].sfbaseq = g_sfba_d_t.sfbaseq
               NEXT FIELD sfbaseq
            END IF


            #add-point:AFTER FIELD sfbaseq
            #此段落由子樣板a05產生
            IF NOT cl_null(g_sfba_d[l_ac].sfbaseq) AND (cl_null(g_sfba_d_t.sfbaseq) OR g_sfba_d[l_ac].sfbaseq != g_sfba_d_t.sfbaseq) THEN
               SELECT MAX(sfbaseq1)+1 INTO g_sfba_d[l_ac].sfbaseq1 FROM sfba_t
                WHERE sfbaent = g_enterprise
                  AND sfbasite = g_site
                  AND sfbadocno = g_sfaa_m.sfaadocno
                  AND sfbaseq = g_sfba_d[l_ac].sfbaseq
               IF cl_null(g_sfba_d[l_ac].sfbaseq1) THEN
                  LET g_sfba_d[l_ac].sfbaseq1 = 0 
               END IF 
            END IF
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba_d[g_detail_idx].sfbaseq != g_sfba_d_t.sfbaseq OR g_sfba_d[g_detail_idx].sfbaseq1 != g_sfba_d_t.sfbaseq1)) THEN
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND sfbasite = '" ||g_site|| "' AND "||"sfbadocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfbaseq = '"||g_sfba_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN
                     LET g_sfba_d[g_detail_idx].sfbaseq = g_sfba_d_t.sfbaseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

            IF g_sfba_d[g_detail_idx].sfbaseq != g_sfba_d_t.sfbaseq THEN
               IF NOT asft300_sfbaseq(l_cmd) THEN
                  LET g_sfba_d[g_detail_idx].sfbaseq = g_sfba_d_t.sfbaseq
                  NEXT FIELD CURRENT
               END IF       
            END IF 
           
           IF NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN
              CALL s_asft300_07(g_sfaa_m.sfaadocno,g_sfba_d[g_detail_idx].sfbaseq,g_sfba_d[g_detail_idx].sfbaseq1) RETURNING l_success,g_sfba_d[g_detail_idx].number2
           END IF
         
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfbaseq
            #add-point:BEFORE FIELD sfbaseq
                            
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfbaseq
            #add-point:ON CHANGE sfbaseq
            
            #END add-point

         #----<<sfbaseq1>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfbaseq1
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfbaseq1,"0","1","","","azz-00079",1) THEN
               LET g_sfba_d[g_detail_idx].sfbaseq1 = g_sfba_d_t.sfbaseq1
               NEXT FIELD sfbaseq1
            END IF


            #add-point:AFTER FIELD sfbaseq1
            #此段落由子樣板a05產生
            IF  NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_sfaa_m.sfaadocno != g_sfaadocno_t OR g_sfba_d[g_detail_idx].sfbaseq != g_sfba_d_t.sfbaseq OR g_sfba_d[g_detail_idx].sfbaseq1 != g_sfba_d_t.sfbaseq1)) THEN
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM sfba_t WHERE "||"sfbaent = '" ||g_enterprise|| "' AND sfbasite = '" ||g_site|| "' AND "||"sfbadocno = '"||g_sfaa_m.sfaadocno ||"' AND "|| "sfbaseq = '"||g_sfba_d[g_detail_idx].sfbaseq ||"' AND "|| "sfbaseq1 = '"||g_sfba_d[g_detail_idx].sfbaseq1 ||"'",'std-00004',0) THEN
                     LET g_sfba_d[g_detail_idx].sfbaseq1 = g_sfba_d_t.sfbaseq1
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF
           
            IF NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq) AND NOT cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN
               CALL s_asft300_07(g_sfaa_m.sfaadocno,g_sfba_d[g_detail_idx].sfbaseq,g_sfba_d[g_detail_idx].sfbaseq1) RETURNING l_success,g_sfba_d[g_detail_idx].number2
            END IF
            
            CALL cl_set_comp_entry("sfba010,sfba011",TRUE)
            IF NOT cl_null(g_sfba_d[l_ac].sfba001) OR g_sfba_d[l_ac].sfbaseq1 != 0 THEN
               CALL cl_set_comp_entry("sfba010,sfba011",FALSE)
            END IF
            IF g_sfba_d[l_ac].sfbaseq1 != 0 THEN
               LET g_sfba_d[g_detail_idx].sfba010 = 0
               LET g_sfba_d[g_detail_idx].sfba011 = 0
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfbaseq1
            IF cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN 
               IF cl_null(g_sfba_d[g_detail_idx].sfbaseq) THEN
                  NEXT FIELD sfbaseq
               END IF
               SELECT MAX(sfbaseq1)+1 INTO g_sfba_d[g_detail_idx].sfbaseq1 FROM sfba_t
                WHERE sfbaent = g_enterprise
                  AND sfbasite = g_site
                  AND sfbadocno = g_sfaa_m.sfaadocno
                  AND sfbaseq = g_sfba_d[g_detail_idx].sfbaseq
               IF cl_null(g_sfba_d[g_detail_idx].sfbaseq1) THEN
                  LET g_sfba_d[g_detail_idx].sfbaseq1 = 0 
               END IF 
            END IF 

         #此段落由子樣板a04產生
         ON CHANGE sfbaseq1
            #add-point:ON CHANGE sfbaseq1
            
            #END add-point

         #----<<sfba002>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba002
            #add-point:BEFORE FIELD sfba002
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba002
           # IF g_sfba_d[g_detail_idx].sfba002 IS NOT NULL THEN
            IF NOT cl_null(g_sfba_d[g_detail_idx].sfba002) THEN
               IF cl_null(g_sfba_d_t.sfba002) OR g_sfba_d[g_detail_idx].sfba002 != g_sfba_d_t.sfba002 THEN
                  #检查是否存在部位
                  #LET l_n = 0
                  #SELECT COUNT(*) INTO l_n FROM oocq_t WHERE oocqent = g_enterprise AND oocq001 = '215'
                  #   AND oocq002 = g_sfba_d[g_detail_idx].sfba002
                  #IF l_n = 0 THEN
                  #   CALL cl_err_msg(g_sfba_d[g_detail_idx].sfba002,'amm-00013','215',1)
                  #   LET g_sfba_d[g_detail_idx].sfba002 = g_sfba_d_t.sfba002
                  #   INITIALIZE g_chkparam.* TO NULL
                  #   LET g_chkparam.arg1 = '215'
                  #   LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba002
                  #   CALL cl_ref_val("v_oocql002")
                  #   LET g_sfba_d[l_ac].sfba002_desc = g_chkparam.return1
                  #   DISPLAY BY NAME g_sfba_d[l_ac].sfba002_desc                     
                  #   NEXT FIELD sfba002
                  #END IF 
                  #LET l_n = 0
                  #SELECT COUNT(*) INTO l_n FROM oocq_t WHERE oocqent = g_enterprise AND oocq001 = '215'
                  #   AND oocq002 = g_sfba_d[g_detail_idx].sfba002 AND oocqstus = 'Y'
                  #IF l_n = 0 THEN
                  #   CALL cl_err_msg(g_sfba_d[g_detail_idx].sfba002,'amm-00014','215',1)
                  #   LET g_sfba_d[g_detail_idx].sfba002 = g_sfba_d_t.sfba002
                  #   INITIALIZE g_chkparam.* TO NULL
                  #   LET g_chkparam.arg1 = '215'
                  #   LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba002
                  #   CALL cl_ref_val("v_oocql002")
                  #   LET g_sfba_d[l_ac].sfba002_desc = g_chkparam.return1
                  #   DISPLAY BY NAME g_sfba_d[l_ac].sfba002_desc
                  #   NEXT FIELD sfba002
                  #END IF
                  IF NOT s_azzi650_chk_exist('215',g_sfba_d[g_detail_idx].sfba002) THEN
                     LET g_sfba_d[g_detail_idx].sfba002 = g_sfba_d_t.sfba002
                     INITIALIZE g_chkparam.* TO NULL
                     LET g_chkparam.arg1 = '215'
                     LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba002
                     CALL cl_ref_val("v_oocql002")
                     LET g_sfba_d[l_ac].sfba002_desc = g_chkparam.return1
                     DISPLAY BY NAME g_sfba_d[l_ac].sfba002_desc
                     NEXT FIELD sfba002
                  END IF
                  IF NOT asft300_sfbaseq(l_cmd) THEN
                     LET g_sfba_d[g_detail_idx].sfba002 = g_sfba_d_t.sfba002
                     INITIALIZE g_chkparam.* TO NULL
                     LET g_chkparam.arg1 = '215'
                     LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba002
                     CALL cl_ref_val("v_oocql002")
                     LET g_sfba_d[l_ac].sfba002_desc = g_chkparam.return1
                     DISPLAY BY NAME g_sfba_d[l_ac].sfba002_desc
                     NEXT FIELD sfba002
                  END IF
               END IF
            ELSE
               LET g_sfba_d[g_detail_idx].sfba002 = ' '             
            END IF
            INITIALIZE g_chkparam.* TO NULL
            LET g_chkparam.arg1 = '215'
            LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba002
            CALL cl_ref_val("v_oocql002")
            LET g_sfba_d[l_ac].sfba002_desc = g_chkparam.return1
            DISPLAY BY NAME g_sfba_d[l_ac].sfba002_desc                  
         #----<<sfba003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba003
            #add-point:BEFORE FIELD sfba003
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba003
            #IF g_sfba_d[g_detail_idx].sfba003 IS NOT NULL THEN
            IF NOT cl_null(g_sfba_d[g_detail_idx].sfba003) THEN
               IF cl_null(g_sfba_d_t.sfba003) OR g_sfba_d[g_detail_idx].sfba003 != g_sfba_d_t.sfba003 THEN
                  #检查是否存在部位
                 #SELECT COUNT(*) INTO l_n FROM oocq_t WHERE oocqent = g_enterprise AND oocq001 = '221'
                 #   AND oocq002 = g_sfba_d[g_detail_idx].sfba003
                 #IF l_n = 0 THEN
                 #   CALL cl_err(g_sfba_d[g_detail_idx].sfba003,'',1)
                 #   LET g_sfba_d[g_detail_idx].sfba003 = g_sfba_d_t.sfba003
                 #   NEXT FIELD sfba003
                 #END IF 
                  IF NOT s_azzi650_chk_exist('221',g_sfba_d[g_detail_idx].sfba003) THEN
                     LET g_sfba_d[g_detail_idx].sfba003 = g_sfba_d_t.sfba003
                     INITIALIZE g_chkparam.* TO NULL
                     LET g_chkparam.arg1 = '221'
                     LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba003
                     CALL cl_ref_val("v_oocql002")
                     LET g_sfba_d[l_ac].sfba003_desc = g_chkparam.return1
                     DISPLAY BY NAME g_sfba_d[l_ac].sfba003_desc                     
                     NEXT FIELD sfba003
                  END IF   
                  IF NOT asft300_sfbaseq(l_cmd) THEN
                     LET g_sfba_d[g_detail_idx].sfba003 = g_sfba_d_t.sfba003                  
                     #部位说明
                     INITIALIZE g_chkparam.* TO NULL
                     LET g_chkparam.arg1 = '221'
                     LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba003
                     CALL cl_ref_val("v_oocql002")
                     LET g_sfba_d[l_ac].sfba003_desc = g_chkparam.return1
                     DISPLAY BY NAME g_sfba_d[l_ac].sfba003_desc                     
                     NEXT FIELD sfba003
                  END IF
               END IF
            ELSE
               LET g_sfba_d[g_detail_idx].sfba003 = ' '            
            END IF                  
            #部位说明
            INITIALIZE g_chkparam.* TO NULL
            LET g_chkparam.arg1 = '221'
            LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba003
            CALL cl_ref_val("v_oocql002")
            LET g_sfba_d[l_ac].sfba003_desc = g_chkparam.return1
            DISPLAY BY NAME g_sfba_d[l_ac].sfba003_desc

         #此段落由子樣板a04產生
         ON CHANGE sfba003
            #add-point:ON CHANGE sfba003
            
            #END add-point

         #----<<sfba004>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba004
            #add-point:BEFORE FIELD sfba004
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba004
            IF NOT cl_null(g_sfba_d[g_detail_idx].sfba004) THEN
               IF cl_null(g_sfba_d_t.sfba004) OR g_sfba_d[g_detail_idx].sfba004 != g_sfba_d_t.sfba004 THEN
                  IF NOT asft300_sfbaseq(l_cmd) THEN
                     LET g_sfba_d[g_detail_idx].sfba004 = g_sfba_d_t.sfba004
                     NEXT FIELD sfba004
                  END IF
               END IF
            ELSE
               LET g_sfba_d[g_detail_idx].sfba004 = ' '
            END IF               

         #此段落由子樣板a04產生
         ON CHANGE sfba004
            #add-point:ON CHANGE sfba004
            
            #END add-point

         #----<<sfba005>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba005
            #add-point:BEFORE FIELD sfba005
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba005

            #add-point:AFTER FIELD sfba005
            IF NOT cl_null(g_sfba_d[g_detail_idx].sfba005) THEN
               IF cl_null(g_sfba_d_t.sfba005) OR g_sfba_d[g_detail_idx].sfba005 != g_sfba_d_t.sfba005 THEN
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_chkparam.arg1 = g_sfba_d[l_ac].sfba005
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_imaa001") THEN
                     IF NOT cl_chk_exist("v_imaf001_1") THEN
                        LET g_sfba_d[l_ac].sfba005 = g_sfba_d_t.sfba005
                        NEXT FIELD CURRENT
                     END IF
                  ELSE
                     LET g_sfba_d[l_ac].sfba005 = g_sfba_d_t.sfba005
                     NEXT FIELD CURRENT
                  END IF
                  
                  #单别对应参数设置为1时，不存在bom时报错重新输入
                  CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
                  IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0024') = '1' THEN
                     CALL s_asft300_02_bom(0,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa013,1,1,g_sfaa_m.sfaa015,'Y',g_sfba_d[l_ac].sfba005,g_sfba_d[l_ac].sfba021,'')
                          RETURNING l_bmba
                     IF l_bmba.getLength() = 0 THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'asf-00334'
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                        LET g_sfba_d[l_ac].sfba005 = g_sfba_d_t.sfba005
                        NEXT FIELD CURRENT
                     END IF
                  END IF                  
                  
                  #单别对应参数设置为3时，不存在bom时警告
                  IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0024') = '3' THEN
                     CALL s_asft300_02_bom(0,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa013,1,1,g_sfaa_m.sfaa015,'Y',g_sfba_d[l_ac].sfba005,g_sfba_d[l_ac].sfba021,'')
                          RETURNING l_bmba
                     IF l_bmba.getLength() = 0 THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'asf-00335'
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                     END IF
                  END IF 
                  
                  IF NOT asft300_sfbaseq(l_cmd) THEN
                     LET g_sfba_d[g_detail_idx].sfba005 = g_sfba_d_t.sfba005
                     NEXT FIELD sfba005
                  END IF
                  
                  #预带发料料号
                  IF cl_null(g_sfba_d[l_ac].sfba006) THEN
                     LET g_sfba_d[l_ac].sfba006 = g_sfba_d[l_ac].sfba005
                     CALL asft300_sfba006_desc()
                  END IF
               END IF
            END IF
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[g_detail_idx].sfba005
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[g_detail_idx].sfba005_desc = '', g_rtn_fields[1] , ''
            LET g_sfba_d[g_detail_idx].sfba005_desc1 = '', g_rtn_fields[2] , ''
            DISPLAY BY NAME g_sfba_d[g_detail_idx].sfba005_desc
            DISPLAY BY NAME g_sfba_d[g_detail_idx].sfba005_desc1           
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba005
            #add-point:ON CHANGE sfba005
            
            #END add-point

         #----<<replace>>----
         #此段落由子樣板a01產生
         BEFORE FIELD replace
            #add-point:BEFORE FIELD replace
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD replace

            #add-point:AFTER FIELD replace
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE replace
            #add-point:ON CHANGE replace
            
            #END add-point

         #----<<sfba022>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfba022
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfba022,"0","0","","","azz-00087",1) THEN
               LET g_sfba_d[l_ac].sfba006 = g_sfba_d_t.sfba006
               NEXT FIELD sfba022
            END IF


            #add-point:AFTER FIELD sfba022
            IF NOT cl_null(g_sfba_d[l_ac].sfba022) THEN
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfba022
            #add-point:BEFORE FIELD sfba022
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfba022
            #add-point:ON CHANGE sfba022
            
            #END add-point

         #----<<sfba006>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfba006

            #add-point:AFTER FIELD sfba006
            IF NOT cl_null(g_sfba_d[l_ac].sfba006) AND (cl_null(g_sfba_d_t.sfba006) OR g_sfba_d[l_ac].sfba006 != g_sfba_d_t.sfba006) THEN
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = g_sfba_d[l_ac].sfba006
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_imaa001") THEN
                  IF NOT cl_chk_exist("v_imaf001_1") THEN
                     LET g_sfba_d[l_ac].sfba006 = g_sfba_d_t.sfba006
                     NEXT FIELD CURRENT
                  END IF
               ELSE
                  LET g_sfba_d[l_ac].sfba006 = g_sfba_d_t.sfba006
                  NEXT FIELD CURRENT
               END IF
               
               #单别对应参数设置为1时，不存在bom时报错重新输入
               CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
               IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0024') = '1' THEN
                  CALL s_asft300_02_bom(0,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa013,1,1,g_sfaa_m.sfaa015,'Y',g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021,'')
                       RETURNING l_bmba
                  IF l_bmba.getLength() = 0 THEN
                     INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'asf-00334'
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                     LET g_sfba_d[l_ac].sfba006 = g_sfba_d_t.sfba006
                     NEXT FIELD CURRENT
                  END IF
               END IF                  
               
               #单别对应参数设置为3时，不存在bom时警告
               IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0024') = '3' THEN
                  CALL s_asft300_02_bom(0,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa013,1,1,g_sfaa_m.sfaa015,'Y',g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021,'')
                       RETURNING l_bmba
                  IF l_bmba.getLength() = 0 THEN
                     INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'asf-00335'
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        CALL cl_err()

                  END IF
               END IF 
               
               CALL asft300_sfba006_desc()
               #建议应发数量
               CALL s_asft300_03(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba013) RETURNING l_success,l_sfba013
               IF l_success THEN
                  LET g_sfba_d[l_ac].sfba013=l_sfba013
               ELSE
                  LET g_sfba_d[l_ac].sfba013=g_sfba_d_t.sfba013
               END IF               
               LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023
               
               #发料料号做特征管理
               CALL asft300_set_entry_b(l_cmd)
               CALL asft300_set_no_entry_b(l_cmd)
               SELECT imaa005 INTO l_imaa005 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfba_d[l_ac].sfba006
               IF NOT cl_null(l_imaa005) THEN
                  IF l_cmd = 'a' THEN 
                    CALL l_inam.clear()          
                    CALL s_feature_multi(g_sfba_d[l_ac].sfba006,'','',g_site,g_sfaa_m.sfaadocno) RETURNING l_success,l_inam
                    LET g_sfba_d[l_ac].sfba021 = l_inam[1].inam002
                    LET g_sfba_d[l_ac].sfba023 = l_inam[1].inam004
                    LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
                    #重算QPA分子分母
                    CALL asft300_sfba023_qpa(g_sfba_d[l_ac].sfba023) RETURNING g_sfba_d[l_ac].sfba010,g_sfba_d[l_ac].sfba011
                    #建议应发数量
                    CALL s_asft300_03(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba013) RETURNING l_success,l_sfba013
                    IF l_success THEN
                       LET g_sfba_d[l_ac].sfba013=l_sfba013
                    END IF               
                    LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023                    
                 END IF
               END IF
               
               #检查产品特征
               IF NOT cl_null(g_sfba_d[l_ac].sfba021) THEN            
                  IF NOT s_feature_check(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021) THEN
                     NEXT FIELD sfba021
                  END IF
                  #显示产品特征说明
                  CALL s_feature_description(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021)
                     RETURNING l_success,g_sfba_d[l_ac].sfba021_desc
                  IF NOT l_success THEN
                     LET g_sfba_d[l_ac].sfba021_desc = ''
                  END IF
               ELSE
                  LET g_sfba_d[l_ac].sfba021_desc = ''
               END IF
               DISPLAY BY NAME g_sfba_d[l_ac].sfba021_desc
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfba006
            #add-point:BEFORE FIELD sfba006
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfba006
            #add-point:ON CHANGE sfba006
            
            #END add-point

         #----<<imaf013>>----
         #此段落由子樣板a01產生
         BEFORE FIELD imaf013
            #add-point:BEFORE FIELD imaf013
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD imaf013

            #add-point:AFTER FIELD imaf013
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE imaf013
            #add-point:ON CHANGE imaf013
            
            #END add-point

         #----<<sfba021>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba021
            #add-point:BEFORE FIELD sfba021
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba021

            #add-point:AFTER FIELD sfba021
            IF NOT cl_null(g_sfba_d[l_ac].sfba006) AND NOT cl_null(g_sfba_d[l_ac].sfba021) THEN
               #检查产品特征
               IF NOT s_feature_check(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021) THEN
                  LET g_sfba_d[l_ac].sfba021 = g_sfba_d_t.sfba021
                  NEXT FIELD sfba021
               END IF
               #显示产品特征说明
               CALL s_feature_description(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021)
                  RETURNING l_success,g_sfba_d[l_ac].sfba021_desc
               IF NOT l_success THEN
                  LET g_sfba_d[l_ac].sfba021_desc = ''
               END IF
            ELSE 
               LET g_sfba_d[l_ac].sfba021_desc = ''
            END IF

            DISPLAY BY NAME g_sfba_d[l_ac].sfba021_desc
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba021
            #add-point:ON CHANGE sfba021
            
            #END add-point

         #----<<sfba007>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba007
            #add-point:BEFORE FIELD sfba007
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba007

            #add-point:AFTER FIELD sfba007
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba007
            #add-point:ON CHANGE sfba007
            
            #END add-point

         #----<<sfba008>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba008
            #add-point:BEFORE FIELD sfba008
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba008

            #add-point:AFTER FIELD sfba008
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba008
            #add-point:ON CHANGE sfba008
            
            #END add-point

         #----<<sfba009>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba009
            #add-point:BEFORE FIELD sfba009
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba009

            #add-point:AFTER FIELD sfba009
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba009
            #add-point:ON CHANGE sfba009
            
            #END add-point

         #----<<sfba010>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba010
            #add-point:BEFORE FIELD sfba010
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba010

            #add-point:AFTER FIELD sfba010
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfba010,"0","0","","","azz-00079",1) THEN
               LET g_sfba_d[l_ac].sfba010 = g_sfba_d_t.sfba010
               NEXT FIELD sfba010
            END IF
            IF NOT cl_null(g_sfba_d[l_ac].sfba010) AND NOT cl_null(g_sfba_d[l_ac].sfba011) THEN
               LET g_sfba_d[l_ac].sfba023 = g_sfaa_m.sfaa012 * g_sfba_d[l_ac].sfba010 / g_sfba_d[l_ac].sfba011
               LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
               IF NOT cl_null(g_sfba_d[l_ac].sfba006) THEN
                  #建议应发数量
                  CALL s_asft300_03(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba013) RETURNING l_success,l_sfba013
                  IF l_success THEN
                     LET g_sfba_d[l_ac].sfba013=l_sfba013
                  ELSE
                     LET g_sfba_d[l_ac].sfba013=g_sfba_d_t.sfba013
                  END IF               
                  LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023
               END IF
            END IF               
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba010
            #add-point:ON CHANGE sfba010
            
            #END add-point

         #----<<sfba011>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba011
            #add-point:BEFORE FIELD sfba011
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba011

            #add-point:AFTER FIELD sfba011
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfba011,"0","0","","","azz-00079",1) THEN
               LET g_sfba_d[l_ac].sfba011 = g_sfba_d_t.sfba011
               NEXT FIELD sfba011
            END IF
            IF NOT cl_null(g_sfba_d[l_ac].sfba010) AND NOT cl_null(g_sfba_d[l_ac].sfba011) THEN
               LET g_sfba_d[l_ac].sfba023 = g_sfaa_m.sfaa012 * g_sfba_d[l_ac].sfba010 / g_sfba_d[l_ac].sfba011
               LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
               IF NOT cl_null(g_sfba_d[l_ac].sfba006) THEN
                  #建议应发数量
                  CALL s_asft300_03(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba013) RETURNING l_success,l_sfba013
                  IF l_success THEN
                     LET g_sfba_d[l_ac].sfba013=l_sfba013
                  ELSE
                     LET g_sfba_d[l_ac].sfba013=g_sfba_d_t.sfba013
                  END IF               
                  LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023
               END IF
            END IF
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba011
            #add-point:ON CHANGE sfba011
            
            #END add-point

         #----<<sfba012>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfba012
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfba012,"0","1","","","azz-00079",1) THEN
               LET g_sfba_d[l_ac].sfba012 = g_sfba_d_t.sfba012
               NEXT FIELD sfba012
            END IF


            #add-point:AFTER FIELD sfba012
            IF NOT cl_null(g_sfba_d[l_ac].sfba012) THEN
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfba012
            #add-point:BEFORE FIELD sfba012
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfba012
            #add-point:ON CHANGE sfba012
            
            #END add-point

         #----<<sfba023>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfba023
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfba023,"0","1","","","azz-00079",1) THEN
               LET g_sfba_d[l_ac].sfba023 = g_sfba_d_t.sfba023
               NEXT FIELD sfba023
            END IF


            #add-point:AFTER FIELD sfba023
            IF NOT cl_null(g_sfba_d[l_ac].sfba023) AND (g_sfba_d[l_ac].sfba023 != g_sfba_d_t.sfba023 OR cl_null(g_sfba_d_t.sfba023)) THEN
               #单位取位
               IF NOT cl_null(g_sfba_d[l_ac].sfba014) THEN
                  CALL s_aooi250_take_decimals(g_sfba_d[l_ac].sfba014,g_sfba_d[l_ac].sfba023)
                       RETURNING l_success,g_sfba_d[l_ac].sfba023
               END IF
                    
               LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
               
               #依发料料号发料控管方式控制
               LET l_sfba013 = g_sfba_d[l_ac].sfba013
               SELECT imae082,imae083,imae084 INTO l_imae082,l_imae083,l_imae084 FROM imae_t
                WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfba_d[l_ac].sfba006
               IF NOT cl_null(l_imae083) THEN
                  IF g_sfba_d[l_ac].sfba013 < l_imae083 THEN
                     LET l_sfba013 = l_imae083
                  ELSE
                     LET l_sfba013 = g_sfba_d[l_ac].sfba013
                  END IF
               ELSE
                  LET l_sfba013 = g_sfba_d[l_ac].sfba013
               END IF
               
               IF NOT cl_null(l_imae082) AND l_imae082 != 0 THEN
                  LET l_n_sfba013 = l_sfba013 / l_imae082
                  IF l_sfba013  != l_imae082 * l_n_sfba013 THEN
                     IF l_sfba013 > l_imae082 * l_n_sfba013 THEN
                        LET l_sfba013 = l_imae082 * (l_n_sfba013 + 1)
                     ELSE
                        LET l_sfba013 = l_imae082 * l_n_sfba013
                     END IF
                  END IF
               END IF
               
               IF l_sfba013 != g_sfba_d[l_ac].sfba013 AND NOT cl_null(l_imae084) AND l_imae084 != '3' THEN
                  IF l_imae084 = '1' THEN
                     LET l_msg = cl_getmsg('asf-00465',g_lang),l_sfba013 USING '---,---,---,--&.&&&'
                     IF cl_ask_promp(l_msg) THEN
                        LET g_sfba_d[l_ac].sfba013 = l_sfba013
                        LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023
                     END IF
                  END IF
                  IF l_imae084 = '2' THEN
                     LET l_msg = cl_getmsg('asf-00466',g_lang),l_sfba013 USING '---,---,---,--&.&&&'
                     IF cl_ask_promp(l_msg) THEN
                        LET g_sfba_d[l_ac].sfba013 = l_sfba013
                        LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023
                     ELSE
                        LET g_sfba_d[l_ac].sfba023 = g_sfba_d_t.sfba023
                        LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
                        NEXT FIELD sfaa023
                     END IF
                  END IF
               END IF
               
               #重算QPA分子分母
               CALL asft300_sfba023_qpa(g_sfba_d[l_ac].sfba023) RETURNING g_sfba_d[l_ac].sfba010,g_sfba_d[l_ac].sfba011
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfba023
            #add-point:BEFORE FIELD sfba023
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfba023
            #add-point:ON CHANGE sfba023
            
            #END add-point

         #----<<sfba024>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba024
            #add-point:BEFORE FIELD sfba024
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba024

            #add-point:AFTER FIELD sfba024
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfba024,"0","1","","","azz-00079",1) THEN
               LET g_sfba_d[l_ac].sfba024 = g_sfba_d_t.sfba024
               NEXT FIELD sfba024
            END IF
            
            IF NOT cl_null(g_sfba_d[l_ac].sfba024) AND (g_sfba_d[l_ac].sfba024 != g_sfba_d_t.sfba024 OR cl_null(g_sfba_d_t.sfba024)) THEN
               #单位取位
               IF NOT cl_null(g_sfba_d[l_ac].sfba014) THEN
                  CALL s_aooi250_take_decimals(g_sfba_d[l_ac].sfba014,g_sfba_d[l_ac].sfba024)
                       RETURNING l_success,g_sfba_d[l_ac].sfba024
               END IF
               
               LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
               #依发料料号发料控管方式控制
               LET l_sfba013 = g_sfba_d[l_ac].sfba013
               SELECT imae082,imae083,imae084 INTO l_imae082,l_imae083,l_imae084 FROM imae_t
                WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfba_d[l_ac].sfba006
               IF NOT cl_null(l_imae083) THEN
                  IF g_sfba_d[l_ac].sfba013 < l_imae083 THEN
                     LET l_sfba013 = l_imae083
                  ELSE
                     LET l_sfba013 = g_sfba_d[l_ac].sfba013
                  END IF
               ELSE
                  LET l_sfba013 = g_sfba_d[l_ac].sfba013
               END IF
               
               IF NOT cl_null(l_imae082) AND l_imae082 != 0 THEN
                  LET l_n_sfba013 = l_sfba013 / l_imae082
                  IF l_sfba013  != l_imae082 * l_n_sfba013 THEN
                     IF l_sfba013 > l_imae082 * l_n_sfba013 THEN
                        LET l_sfba013 = l_imae082 * (l_n_sfba013 + 1)
                     ELSE
                        LET l_sfba013 = l_imae082 * l_n_sfba013
                     END IF
                  END IF
               END IF
               
               IF l_sfba013 != g_sfba_d[l_ac].sfba013 AND NOT cl_null(l_imae084) AND l_imae084 != '3' THEN
                  IF l_imae084 = '1' THEN
                     LET l_msg = cl_getmsg('asf-00465',g_lang),l_sfba013 USING '---,---,---,--&.&&&'
                     IF cl_ask_promp(l_msg) THEN
                        LET g_sfba_d[l_ac].sfba013 = l_sfba013
                        LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023
                     END IF
                  END IF
                  IF l_imae084 = '2' THEN
                     LET l_msg = cl_getmsg('asf-00466',g_lang),l_sfba013 USING '---,---,---,--&.&&&'
                     IF cl_ask_promp(l_msg) THEN
                        LET g_sfba_d[l_ac].sfba013 = l_sfba013
                        LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023
                     ELSE
                        LET g_sfba_d[l_ac].sfba024 = g_sfba_d_t.sfba024
                        LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
                        NEXT FIELD sfaa024
                     END IF
                  END IF
               END IF
            END IF
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba024
            #add-point:ON CHANGE sfba024
            
            #END add-point

         #----<<sfba013>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba013
            #add-point:BEFORE FIELD sfba013
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba013

            #add-point:AFTER FIELD sfba013
            
            IF cl_null(g_sfba_d[l_ac].sfba013) THEN 
               LET g_sfba_d[l_ac].sfba013 = 0
            END IF
            IF cl_null(g_sfba_d[l_ac].sfba015) THEN 
               LET g_sfba_d[l_ac].sfba015 = 0
            END IF
            IF cl_null(g_sfba_d[l_ac].sfba016) THEN 
               LET g_sfba_d[l_ac].sfba016 = 0
            END IF 
            IF NOT cl_null(g_sfba_d[l_ac].sfba013) THEN
               #单位取位
               IF NOT cl_null(g_sfba_d[l_ac].sfba014) THEN
                  CALL s_aooi250_take_decimals(g_sfba_d[l_ac].sfba014,g_sfba_d[l_ac].sfba013)
                       RETURNING l_success,g_sfba_d[l_ac].sfba013
               END IF
               
               IF NOT cl_null(g_sfba_d[l_ac].sfba015) THEN 
                  IF g_sfba_d[l_ac].sfba015 > g_sfba_d[l_ac].sfba013 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00087'
                     LET g_errparam.extend = g_sfba_d[l_ac].sfba013
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     NEXT FIELD sfba013
                  END IF
               END IF                  
            END IF
            LET g_sfba_d[l_ac].number1 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba015 - g_sfba_d[l_ac].sfba016
            IF g_sfba_d[l_ac].number1 < 0 THEN
               LET g_sfba_d[l_ac].number1 = 0
            END IF
                       
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba013
            #add-point:ON CHANGE sfba013
            
            #END add-point

         #----<<sfba014>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba014
            #add-point:BEFORE FIELD sfba014
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba014

            #add-point:AFTER FIELD sfba014
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc
            IF NOT cl_null(g_sfba_d[l_ac].sfba014) THEN
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = g_sfba_d[l_ac].sfba014
               IF NOT cl_chk_exist("v_ooca001") THEN
                  LET g_sfba_d[l_ac].sfba014 = g_sfba_d_t.sfba014
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                  CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                  LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                  DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc
                  NEXT FIELD sfba014
               END IF
               LET l_rate = ''
               LET l_imaa006 = ''
               IF NOT cl_null(g_sfba_d[l_ac].sfba006) THEN 
                  SELECT imaa006 INTO l_imaa006 FROM imaa_t
                   WHERE imaaent = g_enterprise
                     AND imaa001 = g_sfba_d[l_ac].sfba006  
                  IF NOT cl_null(g_sfba_d[l_ac].sfba006) AND NOT cl_null(l_imaa006) THEN
                     CALL s_aimi190_get_convert(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba014,l_imaa006) RETURNING l_success,l_rate
                     IF l_success = FALSE THEN
                        LET g_sfba_d[l_ac].sfba014 = g_sfba_d_t.sfba014
                        INITIALIZE g_ref_fields TO NULL
                        LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                        CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                        LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                        DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc 
                        NEXT FIELD sfba014                        
                     END IF
                  END IF 
                  IF cl_null(l_imaa006) THEN
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'abm-00021'
                  LET g_errparam.extend = l_imaa006
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                     LET g_sfba_d[l_ac].sfba014 = g_sfba_d_t.sfba014
                     INITIALIZE g_ref_fields TO NULL
                     LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                     CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                     LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                     DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc 
                     NEXT FIELD sfba014 
                  END IF
                  #检查是否存在于料件允许使用单位里。
                  INITIALIZE g_chkparam.* TO NULL
                  LET g_chkparam.arg1 = g_sfba_d[l_ac].sfba006
                  LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba014
                 
                  #呼叫檢查存在並帶值的library
                  IF NOT cl_chk_exist("v_imao002") THEN
                     INITIALIZE g_ref_fields TO NULL
                     LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                     CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                     LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                     NEXT FIELD sfba014 
                  END IF
               END IF                 
            END IF
            
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba014
            #add-point:ON CHANGE sfba014
            
            #END add-point

         #----<<sfba015>>----
         #此段落由子樣板a02產生
         AFTER FIELD sfba015
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_sfba_d[l_ac].sfba015,"0","1","","","azz-00079",1) THEN
               LET g_sfba_d[l_ac].sfba015 = g_sfba_d_t.sfba015
               NEXT FIELD sfba015
            END IF


            #add-point:AFTER FIELD sfba015
            IF cl_null(g_sfba_d[l_ac].sfba015) THEN 
               LET g_sfba_d[l_ac].sfba015 = 0
            END IF
            IF NOT cl_null(g_sfba_d[l_ac].sfba015) THEN
               IF NOT cl_null(g_sfba_d[l_ac].sfba013) THEN 
                  IF g_sfba_d[l_ac].sfba015 > g_sfba_d[l_ac].sfba013 THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'asf-00087'
                     LET g_errparam.extend = g_sfba_d[l_ac].sfba015
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     LET g_sfba_d[l_ac].sfba015 = g_sfba_d_t.sfba015
                     NEXT FIELD sfba015
                  END IF
               END IF                  
            END IF
            LET g_sfba_d[l_ac].number1 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba015 - g_sfba_d[l_ac].sfba016
            IF g_sfba_d[l_ac].number1 < 0 THEN
               LET g_sfba_d[l_ac].number1 = 0
            END IF
          {#ADP版次:1#}
            #END add-point


         #此段落由子樣板a01產生
         BEFORE FIELD sfba015
            #add-point:BEFORE FIELD sfba015
            
            #END add-point

         #此段落由子樣板a04產生
         ON CHANGE sfba015
            #add-point:ON CHANGE sfba015
            
            #END add-point

         #----<<sfba016>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba016
            #add-point:BEFORE FIELD sfba016
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba016

            #add-point:AFTER FIELD sfba016
            #cj
            IF cl_null(g_sfba_d[l_ac].sfba013) THEN 
               LET g_sfba_d[l_ac].sfba013 = 0
            END IF
            IF cl_null(g_sfba_d[l_ac].sfba016) THEN 
               LET g_sfba_d[l_ac].sfba016 = 0
            END IF 
            LET g_sfba_d[l_ac].number1 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba016
            IF g_sfba_d[l_ac].number1 < 0 THEN
               LET g_sfba_d[l_ac].number1 = 0
            END IF
            #cj            
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba016
            #add-point:ON CHANGE sfba016
            
            #END add-point

         #----<<sfba025>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba025
            #add-point:BEFORE FIELD sfba025
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba025

            #add-point:AFTER FIELD sfba025
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba025
            #add-point:ON CHANGE sfba025
            
            #END add-point

         #----<<number1>>----
         #此段落由子樣板a01產生
         BEFORE FIELD number1
            #add-point:BEFORE FIELD number1
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD number1

            #add-point:AFTER FIELD number1
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE number1
            #add-point:ON CHANGE number1
            
            #END add-point

         #----<<number2>>----
         #此段落由子樣板a01產生
         BEFORE FIELD number2
            #add-point:BEFORE FIELD number2
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD number2

            #add-point:AFTER FIELD number2
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE number2
            #add-point:ON CHANGE number2
            
            #END add-point

         #----<<sfba017>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba017
            #add-point:BEFORE FIELD sfba017
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba017

            #add-point:AFTER FIELD sfba017
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba017
            #add-point:ON CHANGE sfba017
            
            #END add-point

         #----<<sfba018>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba018
            #add-point:BEFORE FIELD sfba018
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba018

            #add-point:AFTER FIELD sfba018
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba018
            #add-point:ON CHANGE sfba018
            
            #END add-point

         #----<<sfba019>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba019
            #add-point:BEFORE FIELD sfba019
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba019

            #add-point:AFTER FIELD sfba019
             #cj
             IF NOT cl_null(g_sfba_d[l_ac].sfba019) THEN
                INITIALIZE g_chkparam.* TO NULL
                LET g_chkparam.arg1 = g_sfba_d[l_ac].sfba019
                IF NOT cl_chk_exist("v_inaa001_2") THEN
                   LET g_sfba_d[l_ac].sfba019 = g_sfba_d_t.sfba019
                   LET g_sfba_d[l_ac].sfba019_desc = s_desc_get_stock_desc(g_site,g_sfba_d[l_ac].sfba019)
                   NEXT FIELD sfba019
                END IF 
             END IF                
             LET g_sfba_d[l_ac].sfba019_desc = s_desc_get_stock_desc(g_site,g_sfba_d[l_ac].sfba019)
             DISPLAY BY NAME g_sfba_d[l_ac].sfba019_desc 
             #cj             
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba019
            #add-point:ON CHANGE sfba019
            
            #END add-point

         #----<<sfba020>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba020
            #add-point:BEFORE FIELD sfba020
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba020

            #add-point:AFTER FIELD sfba020
             #cj
             IF NOT cl_null(g_sfba_d[l_ac].sfba020) THEN
                INITIALIZE g_chkparam.* TO NULL
                LET g_chkparam.arg1 = g_site
                LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba019
                LET g_chkparam.arg3 = g_sfba_d[l_ac].sfba020
                IF NOT cl_chk_exist("v_inab002") THEN
                   LET g_sfba_d[l_ac].sfba020 = g_sfba_d_t.sfba020
                   LET g_sfba_d[l_ac].sfba020_desc = s_desc_get_locator_desc(g_site,g_sfba_d[l_ac].sfba019,g_sfba_d[l_ac].sfba020)
                   NEXT FIELD sfba020
                END IF 
             END IF            
             LET g_sfba_d[l_ac].sfba020_desc = s_desc_get_locator_desc(g_site,g_sfba_d[l_ac].sfba019,g_sfba_d[l_ac].sfba020)
             DISPLAY BY NAME g_sfba_d[l_ac].sfba020_desc  
            #cj            
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba020
            #add-point:ON CHANGE sfba020
            
            #END add-point

         #----<<sfba028>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba028
            #add-point:BEFORE FIELD sfba028
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba028

            #add-point:AFTER FIELD sfba028
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba028
            #add-point:ON CHANGE sfba028
            
            #END add-point

         #----<<sfba001>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba001
            #add-point:BEFORE FIELD sfba001
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba001

            #add-point:AFTER FIELD sfba001
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba001_desc = '', g_rtn_fields[1] , ''
            LET g_sfba_d[l_ac].sfba001_desc1 = '', g_rtn_fields[2] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba001_desc
            DISPLAY BY NAME g_sfba_d[l_ac].sfba001_desc1           
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba001
            #add-point:ON CHANGE sfba001
            
            #END add-point

         #----<<sfba026>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba026
            #add-point:BEFORE FIELD sfba026
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba026

            #add-point:AFTER FIELD sfba026
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba026
            #add-point:ON CHANGE sfba026
            
            #END add-point

         #----<<sfba027>>----
         #此段落由子樣板a01產生
         BEFORE FIELD sfba027
            #add-point:BEFORE FIELD sfba027
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD sfba027

            #add-point:AFTER FIELD sfba027
            
            #END add-point


         #此段落由子樣板a04產生
         ON CHANGE sfba027
            #add-point:ON CHANGE sfba027
            
            #END add-point


         #---------------------<  Detail: page1  >---------------------
         #----<<sfbaseq>>----
         #Ctrlp:input.c.page1.sfbaseq
#         ON ACTION controlp INFIELD sfbaseq
            #add-point:ON ACTION controlp INFIELD sfbaseq
            
            #END add-point

         #----<<sfbaseq1>>----
         #Ctrlp:input.c.page1.sfbaseq1
#         ON ACTION controlp INFIELD sfbaseq1
            #add-point:ON ACTION controlp INFIELD sfbaseq1
            
            #END add-point

         #----<<sfba002>>----
         #Ctrlp:input.c.page1.sfba002
         ON ACTION controlp INFIELD sfba002
            #add-point:ON ACTION controlp INFIELD sfba002
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfba_d[l_ac].sfba002
            LET g_qryparam.arg1 = "215"
            CALL q_oocq002()
            LET g_sfba_d[l_ac].sfba002 = g_qryparam.return1 
         #   DISPLAY g_sfba_d[l_ac].sfba002 TO sfba002
            NEXT FIELD sfba002
            
            #END add-point

         #----<<sfba003>>----
         #Ctrlp:input.c.page1.sfba003
         ON ACTION controlp INFIELD sfba003
            #add-point:ON ACTION controlp INFIELD sfba003
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfba_d[l_ac].sfba003
            LET g_qryparam.arg1 = "221"
            CALL q_oocq002()
            LET g_sfba_d[l_ac].sfba003 = g_qryparam.return1 
        #    DISPLAY g_sfba_d[l_ac].sfba003 TO sfba003
            NEXT FIELD sfba003            
            
            #END add-point

         #----<<sfba004>>----
         #Ctrlp:input.c.page1.sfba004
#         ON ACTION controlp INFIELD sfba004
            #add-point:ON ACTION controlp INFIELD sfba004
            
            #END add-point

         #----<<sfba005>>----
         #Ctrlp:input.c.page1.sfba005
         ON ACTION controlp INFIELD sfba005
            #add-point:ON ACTION controlp INFIELD sfba005
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfba_d[l_ac].sfba005
            LET g_qryparam.arg1 = g_sfaa_m.sfaa010
            LET g_qryparam.arg2 = g_sfaa_m.sfaa011
            IF NOT cl_null(g_sfaa_m.sfaa015) THEN
               LET g_qryparam.arg3 = g_sfaa_m.sfaa015
            ELSE
               LET g_qryparam.arg3 = cl_get_today()
            END IF
            CALL q_bmba003_2()
            LET g_sfba_d[l_ac].sfba005 = g_qryparam.return1 
            #单别对应参数设置为1时，需存在bom，不需再打开料号开窗
            CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
            IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0024') != '1' THEN
               IF cl_null(g_sfba_d[l_ac].sfba005) THEN
                  CALL q_imaf001_6()
                  LET g_sfba_d[l_ac].sfba005 = g_qryparam.return1
               END IF
            END IF
            NEXT FIELD sfba005
            
            #END add-point

         #----<<replace>>----
         #Ctrlp:input.c.page1.replace
#         ON ACTION controlp INFIELD replace
            #add-point:ON ACTION controlp INFIELD replace
            
            #END add-point

         #----<<sfba022>>----
         #Ctrlp:input.c.page1.sfba022
#         ON ACTION controlp INFIELD sfba022
            #add-point:ON ACTION controlp INFIELD sfba022
            
            #END add-point

         #----<<sfba006>>----
         #Ctrlp:input.c.page1.sfba006
         ON ACTION controlp INFIELD sfba006
            #add-point:ON ACTION controlp INFIELD sfba006
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfba_d[l_ac].sfba006
            CALL q_bmea008_4()
            LET g_sfba_d[l_ac].sfba006 = g_qryparam.return1 
           # DISPLAY g_sfba_d[l_ac].sfba006 TO sfba006
            NEXT FIELD sfba006            
            
            #END add-point

         #----<<imaf013>>----
         #Ctrlp:input.c.page1.imaf013
#         ON ACTION controlp INFIELD imaf013
            #add-point:ON ACTION controlp INFIELD imaf013
            
            #END add-point

         #----<<sfba021>>----
         #Ctrlp:input.c.page1.sfba021
         ON ACTION controlp INFIELD sfba021
            #add-point:ON ACTION controlp INFIELD sfba021
            #发料料号做特征管理
            SELECT imaa005 INTO l_imaa005 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfba_d[l_ac].sfba006
            IF NOT cl_null(l_imaa005) THEN
               IF l_cmd = 'a' THEN 
                  CALL l_inam.clear()          
                  CALL s_feature_multi(g_sfba_d[l_ac].sfba006,'','',g_site,g_sfaa_m.sfaadocno) RETURNING l_success,l_inam
                  LET g_sfba_d[l_ac].sfba021 = l_inam[1].inam002
                  LET g_sfba_d[l_ac].sfba023 = l_inam[1].inam004
                  LET g_sfba_d[l_ac].sfba013 = g_sfba_d[l_ac].sfba023 + g_sfba_d[l_ac].sfba024
                  #重算QPA分子分母
                  CALL asft300_sfba023_qpa(g_sfba_d[l_ac].sfba023) RETURNING g_sfba_d[l_ac].sfba010,g_sfba_d[l_ac].sfba011
                  #建议应发数量
                  CALL s_asft300_03(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba013) RETURNING l_success,l_sfba013
                  IF l_success THEN
                     LET g_sfba_d[l_ac].sfba013=l_sfba013
                  END IF               
                  LET g_sfba_d[l_ac].sfba024 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba023                    
               END IF
               IF l_cmd = 'u' THEN
                  CALL s_feature_single(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021,g_site,g_sfaa_m.sfaadocno)
                     RETURNING l_success,g_sfba_d[l_ac].sfba021
               END IF
               DISPLAY BY NAME g_sfba_d[l_ac].sfba021
            END IF
            #END add-point

         #----<<sfba007>>----
         #Ctrlp:input.c.page1.sfba007
#         ON ACTION controlp INFIELD sfba007
            #add-point:ON ACTION controlp INFIELD sfba007
            
            #END add-point

         #----<<sfba008>>----
         #Ctrlp:input.c.page1.sfba008
#         ON ACTION controlp INFIELD sfba008
            #add-point:ON ACTION controlp INFIELD sfba008
            
            #END add-point

         #----<<sfba009>>----
         #Ctrlp:input.c.page1.sfba009
#         ON ACTION controlp INFIELD sfba009
            #add-point:ON ACTION controlp INFIELD sfba009
            
            #END add-point

         #----<<sfba010>>----
         #Ctrlp:input.c.page1.sfba010
#         ON ACTION controlp INFIELD sfba010
            #add-point:ON ACTION controlp INFIELD sfba010
            
            #END add-point

         #----<<sfba011>>----
         #Ctrlp:input.c.page1.sfba011
#         ON ACTION controlp INFIELD sfba011
            #add-point:ON ACTION controlp INFIELD sfba011
            
            #END add-point

         #----<<sfba012>>----
         #Ctrlp:input.c.page1.sfba012
#         ON ACTION controlp INFIELD sfba012
            #add-point:ON ACTION controlp INFIELD sfba012
            
            #END add-point

         #----<<sfba023>>----
         #Ctrlp:input.c.page1.sfba023
#         ON ACTION controlp INFIELD sfba023
            #add-point:ON ACTION controlp INFIELD sfba023
            
            #END add-point

         #----<<sfba024>>----
         #Ctrlp:input.c.page1.sfba024
#         ON ACTION controlp INFIELD sfba024
            #add-point:ON ACTION controlp INFIELD sfba024
            
            #END add-point

         #----<<sfba013>>----
         #Ctrlp:input.c.page1.sfba013
#         ON ACTION controlp INFIELD sfba013
            #add-point:ON ACTION controlp INFIELD sfba013
            
            #END add-point

         #----<<sfba014>>----
         #Ctrlp:input.c.page1.sfba014
         ON ACTION controlp INFIELD sfba014
            #add-point:ON ACTION controlp INFIELD sfba014
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfba_d[l_ac].sfba014
            CALL q_ooca001_1()
            LET g_sfba_d[l_ac].sfba014 = g_qryparam.return1 
         #   DISPLAY g_sfba_d[l_ac].sfba014 TO sfba014
            NEXT FIELD sfba014             
            
            #END add-point

         #----<<sfba015>>----
         #Ctrlp:input.c.page1.sfba015
#         ON ACTION controlp INFIELD sfba015
            #add-point:ON ACTION controlp INFIELD sfba015
            
            #END add-point

         #----<<sfba016>>----
         #Ctrlp:input.c.page1.sfba016
#         ON ACTION controlp INFIELD sfba016
            #add-point:ON ACTION controlp INFIELD sfba016
            
            #END add-point

         #----<<sfba025>>----
         #Ctrlp:input.c.page1.sfba025
#         ON ACTION controlp INFIELD sfba025
            #add-point:ON ACTION controlp INFIELD sfba025
            
            #END add-point

         #----<<number1>>----
         #Ctrlp:input.c.page1.number1
#         ON ACTION controlp INFIELD number1
            #add-point:ON ACTION controlp INFIELD number1
            
            #END add-point

         #----<<number2>>----
         #Ctrlp:input.c.page1.number2
#         ON ACTION controlp INFIELD number2
            #add-point:ON ACTION controlp INFIELD number2
            
            #END add-point

         #----<<sfba017>>----
         #Ctrlp:input.c.page1.sfba017
#         ON ACTION controlp INFIELD sfba017
            #add-point:ON ACTION controlp INFIELD sfba017
            
            #END add-point

         #----<<sfba018>>----
         #Ctrlp:input.c.page1.sfba018
#         ON ACTION controlp INFIELD sfba018
            #add-point:ON ACTION controlp INFIELD sfba018
            
            #END add-point

         #----<<sfba019>>----
         #Ctrlp:input.c.page1.sfba019
         ON ACTION controlp INFIELD sfba019
            #add-point:ON ACTION controlp INFIELD sfba019
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfba_d[l_ac].sfba019
            CALL q_inaa001_2()
            LET g_sfba_d[l_ac].sfba019 = g_qryparam.return1 
            #DISPLAY g_sfba_d[l_ac].sfba019 TO sfba019
            NEXT FIELD sfba019             
            
            #END add-point

         #----<<sfba020>>----
         #Ctrlp:input.c.page1.sfba020
         ON ACTION controlp INFIELD sfba020
            #add-point:ON ACTION controlp INFIELD sfba020
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_sfba_d[l_ac].sfba020
            LET g_qryparam.arg1 = g_sfba_d[l_ac].sfba019
            CALL q_inab002_3()
            LET g_sfba_d[l_ac].sfba020 = g_qryparam.return1 
            #DISPLAY g_sfba_d[l_ac].sfba020 TO sfba020
            NEXT FIELD sfba020            
            
            #END add-point

         #----<<sfba028>>----
         #Ctrlp:input.c.page1.sfba028
#         ON ACTION controlp INFIELD sfba028
            #add-point:ON ACTION controlp INFIELD sfba028
            
            #END add-point

         #----<<sfba001>>----
         #Ctrlp:input.c.page1.sfba001
#         ON ACTION controlp INFIELD sfba001
            #add-point:ON ACTION controlp INFIELD sfba001
            
            #END add-point

         #----<<sfba026>>----
         #Ctrlp:input.c.page1.sfba026
#         ON ACTION controlp INFIELD sfba026
            #add-point:ON ACTION controlp INFIELD sfba026
            
            #END add-point

         #----<<sfba027>>----
         #Ctrlp:input.c.page1.sfba027
#         ON ACTION controlp INFIELD sfba027
            #add-point:ON ACTION controlp INFIELD sfba027
            
            #END add-point
         
         ON ACTION controlp INFIELD sfba_ooff013
            IF NOT cl_null(g_sfba_d[l_ac].sfbaseq) AND NOT cl_null(g_sfba_d[l_ac].sfbaseq1) THEN
               CALL aooi360_02('7',g_sfaa_m.sfaadocno,g_sfba_d[l_ac].sfbaseq,g_sfba_d[l_ac].sfbaseq1,'','','','','','','','2')
               CALL s_aooi360_sel('7',g_sfaa_m.sfaadocno,g_sfba_d[l_ac].sfbaseq,g_sfba_d[l_ac].sfbaseq1,'','','','','','','','2')
                    RETURNING l_success,g_sfba_d[l_ac].sfba_ooff013 
            END IF


         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 9001
               LET g_errparam.extend = ''
               LET g_errparam.popup = FALSE
               CALL cl_err()

               LET INT_FLAG = 0
               LET g_sfba_d[l_ac].* = g_sfba_d_t.*
               CLOSE asft300_bcl
               CALL s_transaction_end('N','0')
               EXIT DIALOG
            END IF

            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL
               LET g_errparam.code = -263
               LET g_errparam.extend = g_sfba_d[l_ac].sfbaseq
               LET g_errparam.popup = TRUE
               CALL cl_err()

               LET g_sfba_d[l_ac].* = g_sfba_d_t.*
            ELSE

               #add-point:單身修改前
               LET l_rate = ''
               LET l_imaa006 = ''
               IF NOT cl_null(g_sfba_d[l_ac].sfba006) THEN 
                  SELECT imaa006 INTO l_imaa006 FROM imaa_t
                   WHERE imaaent = g_enterprise
                     AND imaa001 = g_sfba_d[l_ac].sfba006  
                  IF NOT cl_null(g_sfba_d[l_ac].sfba006) AND NOT cl_null(l_imaa006) THEN
                     CALL s_aimi190_get_convert(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba014,l_imaa006) RETURNING l_success,l_rate
                     IF l_success = FALSE THEN
                        LET g_sfba_d[l_ac].sfba014 = g_sfba_d_t.sfba014
                        INITIALIZE g_ref_fields TO NULL
                        LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                        CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                        LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                        DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc 
                        NEXT FIELD sfba006                       
                     END IF
                  END IF 
                  IF cl_null(l_imaa006) THEN
                     INITIALIZE g_errparam TO NULL
                  LET g_errparam.code = 'abm-00021'
                  LET g_errparam.extend = l_imaa006
                  LET g_errparam.popup = TRUE
                  CALL cl_err()

                     LET g_sfba_d[l_ac].sfba014 = g_sfba_d_t.sfba014
                     INITIALIZE g_ref_fields TO NULL
                     LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
                     CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
                     LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
                     DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc 
                     NEXT FIELD sfba006
                  END IF
               END IF 
               #end add-point

               #寫入修改者/修改日期資訊(單身)


               UPDATE sfba_t SET (sfbadocno,sfbaseq,sfbaseq1,sfba002,sfba003,sfba004,sfba005,sfba022,sfba006,sfba021,sfba007,sfba008,sfba009,sfba010,sfba011,sfba012,sfba023,sfba024,sfba013,sfba014,sfba015,sfba016,sfba025,sfba017,sfba018,sfba019,sfba020,sfba029,sfba030,sfba028,sfba001,sfba026,sfba027) = (g_sfaa_m.sfaadocno,g_sfba_d[l_ac].sfbaseq,g_sfba_d[l_ac].sfbaseq1,g_sfba_d[l_ac].sfba002,g_sfba_d[l_ac].sfba003,g_sfba_d[l_ac].sfba004,g_sfba_d[l_ac].sfba005,g_sfba_d[l_ac].sfba022,g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021,g_sfba_d[l_ac].sfba007,g_sfba_d[l_ac].sfba008,g_sfba_d[l_ac].sfba009,g_sfba_d[l_ac].sfba010,g_sfba_d[l_ac].sfba011,g_sfba_d[l_ac].sfba012,g_sfba_d[l_ac].sfba023,g_sfba_d[l_ac].sfba024,g_sfba_d[l_ac].sfba013,g_sfba_d[l_ac].sfba014,g_sfba_d[l_ac].sfba015,g_sfba_d[l_ac].sfba016,g_sfba_d[l_ac].sfba025,g_sfba_d[l_ac].sfba017,g_sfba_d[l_ac].sfba018,g_sfba_d[l_ac].sfba019,g_sfba_d[l_ac].sfba020,g_sfba_d[l_ac].sfba029,g_sfba_d[l_ac].sfba030,g_sfba_d[l_ac].sfba028,g_sfba_d[l_ac].sfba001,g_sfba_d[l_ac].sfba026,g_sfba_d[l_ac].sfba027)
                WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno

                  AND sfbaseq = g_sfba_d_t.sfbaseq #項次
                  AND sfbaseq1 = g_sfba_d_t.sfbaseq1



               #add-point:單身修改中
               
               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = "std-00009"
                     LET g_errparam.extend = "sfba_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()

                     CALL s_transaction_end('N','0')
                     LET g_sfba_d[l_ac].* = g_sfba_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL
               LET g_errparam.code = SQLCA.sqlcode
               LET g_errparam.extend = "sfba_t"
               LET g_errparam.popup = TRUE
               CALL cl_err()

                     LET g_sfba_d[l_ac].* = g_sfba_d_t.*
                     CALL s_transaction_end('N','0')
                  OTHERWISE
                                    INITIALIZE gs_keys TO NULL
               LET gs_keys[1] = g_sfaa_m.sfaadocno
               LET gs_keys_bak[1] = g_sfaadocno_t
               LET gs_keys[2] = g_sfba_d[g_detail_idx].sfbaseq
               LET gs_keys_bak[2] = g_sfba_d_t.sfbaseq
               LET gs_keys[3] = g_sfba_d[g_detail_idx].sfbaseq1
               LET gs_keys_bak[3] = g_sfba_d_t.sfbaseq1
               CALL asft300_update_b('sfba_t',gs_keys,gs_keys_bak,"'1'")
                     #資料多語言用-增/改

               END CASE

               #add-point:單身修改後
               
               #end add-point

            END IF

         AFTER ROW
            #add-point:單身after_row
            
            #end add-point
            CALL asft300_unlock_b("sfba_t","'1'")
            CALL s_transaction_end('Y','0')
            #其他table進行unlock


         AFTER INPUT
            #add-point:input段after input
            
            #end add-point

      END INPUT

      BEFORE DIALOG
         #add-point:input段before dialog
         
         #end add-point
         #新增時強制從單頭開始填
         IF l_flag0 = 'N' THEN
            LET l_flag0 = 'Y'
            NEXT FIELD sfabseq
         END IF
         
         IF l_flag1 = 'N' THEN
            LET l_flag1 = 'Y'
            NEXT FIELD sfad001
         END IF
         IF l_flag2 = 'N' THEN
            LET l_flag2 = 'Y'
            NEXT FIELD sfae001
         END IF
         IF l_flag3 = 'N' THEN
            LET l_flag3 = 'Y'
            NEXT FIELD sfaf001
         END IF
         IF p_cmd = 'a' THEN
            NEXT FIELD sfaadocno
         END IF
         IF g_flag_date = 'Y' THEN
            NEXT FIELD sfaeseq
         END IF
         
      AFTER DIALOG
         #开启由预设关闭的栏位，防止不同单别栏位还是关闭的
         IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
            LET l_fields_1 = ''
            CALL s_aooi200_get_doc_fields(g_site,'1',g_sfaa_m.sfaadocno) RETURNING l_fields_1
            CALL cl_set_comp_entry(l_fields_1,TRUE)
         END IF
         
      ON ACTION produce_no
         LET g_action_choice="produce_no"
         IF cl_auth_chk_act("produce_no") THEN
            IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
               CALL asft300_04(g_sfaa_m.sfaadocno)
               CALL asft300_b_fill_sfaf()
               LET g_rec_b_sfaf = g_sfaf_d.getLength()
               LET l_flag3 = 'N'
               EXIT DIALOG
            END IF 
         END IF 

      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)

      ON ACTION controlr
         CALL cl_show_req_fields()

      ON ACTION controls
         CALL cl_set_head_visible("","AUTO")

      ON ACTION accept
         ACCEPT DIALOG

      ON ACTION cancel      #在dialog button (放棄)
         LET INT_FLAG = TRUE
         EXIT DIALOG

      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE
         EXIT DIALOG

      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE
         EXIT DIALOG

      #交談指令共用ACTION
      &include "common_action.4gl"
         CONTINUE DIALOG

   END DIALOG
   
   IF l_flag0 = 'N' THEN
      CONTINUE WHILE
   END IF
   
   #防止进入特征管理页签修改数量后，点取消按钮后 不走AFTER INPUT检查
   SELECT SUM(sfad002) INTO l_sum_sfad002 FROM sfad_t WHERE sfadent=g_enterprise AND sfadsite=g_site AND sfaddocno=g_sfaa_m.sfaadocno
   IF l_sum_sfad002 != g_sfaa_m.sfaa012 AND l_flag1 = 'Y' THEN
      INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00159'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

      LET l_flag1 = 'N'
   END IF
   
   #特征管理批量新增或修改后重新进入单身维护
   IF l_flag1 = 'N' THEN
      CONTINUE WHILE
   END IF
   
   SELECT SUM(sfae001) INTO l_sum_sfae001 FROM sfae_t WHERE sfaeent=g_enterprise AND sfaesite=g_site AND sfaedocno=g_sfaa_m.sfaadocno
   IF l_sum_sfae001 > g_sfaa_m.sfaa012 THEN
      INITIALIZE g_errparam TO NULL
               LET g_errparam.code = 'asf-00164'
               LET g_errparam.extend = ''
               LET g_errparam.popup = TRUE
               CALL cl_err()

      LET l_flag2 = 'N'
   END IF
   IF l_flag2 = 'N' THEN
      CONTINUE WHILE
   END IF
   
   IF l_flag3 = 'N' THEN
      CONTINUE WHILE
   END IF

   EXIT WHILE
   
   END WHILE     

END FUNCTION]]>
  </point>
  <point name="function.asft300_show" order="17" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_show()
   {<Local define>}
   DEFINE l_ac_t    LIKE type_t.num5
   DEFINE l_success LIKE type_t.num5
   DEFINE r_success   LIKE type_t.num5                 
   DEFINE r_slip      STRING    
   DEFINE l_imae032   LIKE imae_t.imae032
   DEFINE l_sfaa007_str    STRING
   DEFINE l_sfaa008_str    STRING
   DEFINE l_sfaa063_str    STRING
   DEFINE l_sfaa023_str    STRING
   DEFINE l_sfaa024_str    STRING
   DEFINE l_sfaa064_str    STRING
   {</Local define>}
   #add-point:show段define
   
   #end add-point

   #add-point:show段之前
   
   #end add-point



   LET g_sfaa_m_t.* = g_sfaa_m.*      #保存單頭舊值

   IF g_bfill = "Y" THEN
      CALL asft300_b_fill() #單身填充
      CALL asft300_b_fill2('0') #單身填充
   END IF

   #帶出公用欄位reference值
   #此段落由子樣板a12產生
      #LET g_sfaa_m.sfaaownid_desc = cl_get_username(g_sfaa_m.sfaaownid)
      #LET g_sfaa_m.sfaaowndp_desc = cl_get_deptname(g_sfaa_m.sfaaowndp)
      #LET g_sfaa_m.sfaacrtid_desc = cl_get_username(g_sfaa_m.sfaacrtid)
      #LET g_sfaa_m.sfaacrtdp_desc = cl_get_deptname(g_sfaa_m.sfaacrtdp)
      #LET g_sfaa_m.sfaamodid_desc = cl_get_username(g_sfaa_m.sfaamodid)
      #LET g_sfaa_m.sfaacnfid_desc = cl_get_deptname(g_sfaa_m.sfaacnfid)
      #LET g_sfaa_m.sfaapstid_desc = cl_get_deptname(g_sfaa_m.sfaapstid)


   CALL asft300_set_pk_array()
   CALL cl_user_overview_set_follow_pic()

   LET l_ac_t = l_ac

   #讀入ref值(單頭)
   #add-point:show段reference
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaaownid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaaownid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaaownid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaaowndp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooeal003 FROM ooeal_t WHERE ooealent='"||g_enterprise||"' AND ooeal001=? AND ooeal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaaowndp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaaowndp_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaacrtid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaacrtid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaacrtid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaacrtdp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooeal003 FROM ooeal_t WHERE ooealent='"||g_enterprise||"' AND ooeal001=? AND ooeal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaacrtdp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaacrtdp_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaamodid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaamodid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaamodid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaacnfid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaacnfid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaacnfid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaapstid
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaapstid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaapstid_desc
            
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa002
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa002_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa002_desc
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa010
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa010_desc
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa010
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa010_desc1 = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa010_desc1
            
            IF NOT cl_null(g_sfaa_m.sfaa009) THEN
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = g_sfaa_m.sfaa009
               CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa009_desc = '', g_rtn_fields[1] , ''
            ELSE
               LET g_sfaa_m.sfaa009_desc = ''
            END IF
            DISPLAY BY NAME g_sfaa_m.sfaa009_desc 
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa013
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa013_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa013_desc
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfaa_m.sfaa060
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfaa_m.sfaa060_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfaa_m.sfaa060_desc
            
            #抓制程料号
            SELECT imae032 INTO l_imae032 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
            IF cl_null(l_imae032) THEN
               LET l_imae032 = g_sfaa_m.sfaa010
            END IF
            IF NOT cl_null(l_imae032) AND NOT cl_null(g_sfaa_m.sfaa016) THEN
               INITIALIZE g_ref_fields TO NULL
               LET g_ref_fields[1] = l_imae032
               LET g_ref_fields[2] = g_sfaa_m.sfaa016
               CALL ap_ref_array2(g_ref_fields,"SELECT ecba003 FROM ecba_t WHERE ecbaent='"||g_enterprise||"' AND ecba001=? AND ecba002=? ","") RETURNING g_rtn_fields
               LET g_sfaa_m.sfaa016_desc = '', g_rtn_fields[1] , ''
            ELSE
               LET g_sfaa_m.sfaa016_desc = ''
            END IF
            DISPLAY BY NAME g_sfaa_m.sfaa016_desc
            
            IF g_sfaa_m.sfaa057 = '2' THEN
               INITIALIZE g_chkparam.* TO NULL
               LET g_chkparam.arg1 = g_sfaa_m.sfaa017
               CALL cl_ref_val("v_pmaal004")
               LET g_sfaa_m.sfaa017_desc = g_chkparam.return1
               DISPLAY BY NAME g_sfaa_m.sfaa017_desc
            ELSE
               CALL s_desc_get_department_desc(g_sfaa_m.sfaa017) RETURNING g_sfaa_m.sfaa017_desc
               DISPLAY BY NAME g_sfaa_m.sfaa017_desc
            END IF
            
            LET g_sfaa_m.sfaa018_desc=''
            SELECT ooefl003 INTO g_sfaa_m.sfaa018_desc FROM ooefl_t
             WHERE ooeflent = g_enterprise AND ooefl001 = g_sfaa_m.sfaa018 AND ooefl002 = g_lang
            DISPLAY BY NAME g_sfaa_m.sfaa018_desc
            
            LET g_sfaa_m.sfaa068_desc = ''
            SELECT ooefl003 INTO g_sfaa_m.sfaa068_desc FROM ooefl_t
             WHERE ooeflent = g_enterprise AND ooefl001 = g_sfaa_m.sfaa068 AND ooefl002 = g_lang
            DISPLAY BY NAME g_sfaa_m.sfaa068_desc
            
            LET g_sfaa_m.sfaa028_desc = ''
            CALL asft300_sfaa028_desc(g_sfaa_m.sfaa028)
            DISPLAY BY NAME g_sfaa_m.sfaa028_desc
            
            LET g_sfaa_m.sfaa029_desc = ''
            CALL asft300_sfaa029_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa029)
            DISPLAY BY NAME g_sfaa_m.sfaa029_desc
            
            LET g_sfaa_m.sfaa030_desc = ''
            CALL asft300_sfaa030_desc(g_sfaa_m.sfaa028,g_sfaa_m.sfaa030)
            DISPLAY BY NAME g_sfaa_m.sfaa030_desc
             
            LET g_sfaa_m.sfaa031_desc = s_desc_get_acc_desc('225',g_sfaa_m.sfaa031)
            DISPLAY BY NAME g_sfaa_m.sfaa031_desc
            
            LET g_sfaa_m.sfaa034_desc = s_desc_get_stock_desc(g_site,g_sfaa_m.sfaa034)
            DISPLAY BY NAME g_sfaa_m.sfaa034_desc
            
            LET g_sfaa_m.sfaa035_desc = s_desc_get_locator_desc(g_site,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035)
            DISPLAY BY NAME g_sfaa_m.sfaa035_desc
            
            IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
               CALL s_aooi360_sel('6',g_sfaa_m.sfaadocno,'','','','','','','','','','2')
                    RETURNING l_success,g_sfaa_m.ooff013
               DISPLAY BY NAME g_sfaa_m.ooff013
               CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING r_success,r_slip
               CALL s_aooi200_get_slip_desc(r_slip)
                 RETURNING g_sfaa_m.oobal004
               DISPLAY BY NAME g_sfaa_m.oobal004   
            END IF
            SELECT imae020 INTO g_sfaa_m.imae020 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
            IF cl_null(g_sfaa_m.imae020) THEN
               LET g_sfaa_m.imae020 = 0 
            END IF
            DISPLAY BY NAME g_sfaa_m.imae020    
            
            IF NOT cl_null(g_sfaa_m.sfaa007) THEN
               LET l_sfaa007_str = g_sfaa_m.sfaa007
               LET l_sfaa008_str = g_sfaa_m.sfaa008
               LET l_sfaa063_str = g_sfaa_m.sfaa063
               LET g_sfaa_m.l_sfaa007 = l_sfaa007_str CLIPPED,"-",l_sfaa008_str CLIPPED,"-",l_sfaa063_str CLIPPED
            ELSE
               LET g_sfaa_m.l_sfaa007 = ''
            END IF
            IF NOT cl_null(g_sfaa_m.sfaa023) THEN
               LET l_sfaa023_str = g_sfaa_m.sfaa023
               LET l_sfaa024_str = g_sfaa_m.sfaa024
               LET l_sfaa064_str = g_sfaa_m.sfaa064
               LET g_sfaa_m.l_sfaa023 = l_sfaa023_str CLIPPED,"-",l_sfaa024_str CLIPPED,"-",l_sfaa064_str CLIPPED
            ELSE
               LET g_sfaa_m.l_sfaa023 = ''
            END IF
          {#ADP版次:1#}
   #end add-point

   #將資料輸出到畫面上
   DISPLAY BY NAME g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.oobal004,g_sfaa_m.sfaa002,g_sfaa_m.sfaa002_desc,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.l_sfaa007,g_sfaa_m.sfaa009,g_sfaa_m.sfaa009_desc,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.l_sfaa023,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa010_desc,g_sfaa_m.sfaa010_desc1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa016_desc,g_sfaa_m.sfaa017,g_sfaa_m.sfaa017_desc,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.ooff013,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaownid_desc,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaaowndp_desc,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtid_desc,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdp_desc,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamodid_desc,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfid_desc,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstid_desc,g_sfaa_m.sfaapstdt

   #顯示狀態(stus)圖片
         #此段落由子樣板a21產生
      CASE g_sfaa_m.sfaastus
         WHEN "C"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/closed.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")

         WHEN "E"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/closed_irregular.png")

         WHEN "F"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/released.png")

         WHEN "M"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/costing_closed.png")

         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")

         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")

         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")

         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")

         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")


		 #此段落由子樣板a34產生
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/draw_out.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")



      END CASE



   #讀入ref值(單身)
   FOR l_ac = 1 TO g_sfba_d.getLength()
      #帶出公用欄位reference值

      #add-point:show段單身reference
       CALL asft300_b_desc()
          {#ADP版次:1#}
      #end add-point
   END FOR





   LET l_ac = l_ac_t
   
   CALL asft300_b_fill_sfab()
   CALL asft300_b_fill_sfac()
   CALL asft300_b_fill_sfad()
   CALL asft300_b_fill_sfae()
   CALL asft300_b_fill_sfaf()
   
   #移動上下筆可以連動切換資料
   CALL cl_show_fld_cont()

   CALL asft300_detail_show()

   #add-point:show段之後
   
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_detail_show" order="18" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_detail_show()
   {<Local define>}
   DEFINE l_ac_t    LIKE type_t.num5
   {</Local define>}
   #add-point:detail_show段define
   
   #end add-point

   #add-point:detail_show段之前
   
   #end add-point

   LET l_ac_t = l_ac

   LET l_ac = l_ac_t

   #add-point:detail_show段之後
   
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_reproduce" order="19" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_reproduce()
   {<Local define>}
   DEFINE l_newno     LIKE sfaa_t.sfaadocno
   DEFINE l_oldno     LIKE sfaa_t.sfaadocno

   DEFINE l_master    RECORD LIKE sfaa_t.*
   DEFINE l_detail    RECORD LIKE sfba_t.*


   DEFINE l_cnt       LIKE type_t.num5
   {</Local define>}
   #add-point:reproduce段define
   
   #end add-point

   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF

   LET g_master_insert = FALSE

   IF g_sfaa_m.sfaadocno IS NULL

   THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF

   LET g_sfaadocno_t = g_sfaa_m.sfaadocno


   LET g_sfaa_m.sfaadocno = ""


   CALL asft300_set_entry('a')
   CALL asft300_set_no_entry('a')

   CALL cl_set_head_visible("","YES")

   #公用欄位給予預設值
   #此段落由子樣板a14產生
      LET g_sfaa_m.sfaaownid = g_user
      LET g_sfaa_m.sfaaowndp = g_dept
      LET g_sfaa_m.sfaacrtid = g_user
      LET g_sfaa_m.sfaacrtdp = g_dept
      LET g_sfaa_m.sfaacrtdt = cl_get_current()
      LET g_sfaa_m.sfaamodid = ""
      LET g_sfaa_m.sfaamoddt = ""
      LET g_sfaa_m.sfaastus = 'N'
      LET g_sfaa_m.sfaadocdt = g_today
      LET g_sfaa_m.sfaacnfid = ''
      LET g_sfaa_m.sfaacnfdt = ''

      #相关资讯页签资料清空
      LET g_sfaa_m.sfaa039 = 'N'
      LET g_sfaa_m.sfaa040 = "N"
      LET g_sfaa_m.sfaa041 = "N"
      LET g_sfaa_m.sfaa042 = "N"
      LET g_sfaa_m.sfaa043 = "N"
      LET g_sfaa_m.sfaa044 = "N"
      LET g_sfaa_m.sfaa045 = ''
      LET g_sfaa_m.sfaa046 = ''
      LET g_sfaa_m.sfaa047 = ''
      LET g_sfaa_m.sfaa048 = ''
      LET g_sfaa_m.sfaa049 = "0"
      LET g_sfaa_m.sfaa050 = "0"
      LET g_sfaa_m.sfaa051 = "0"
      LET g_sfaa_m.sfaa055 = "0"
      LET g_sfaa_m.sfaa056 = "0"
      LET g_sfaa_m.sfaa065 = '0'
      

   #add-point:複製輸入前
   
   #end add-point

   CALL asft300_input("r")



   IF INT_FLAG AND NOT g_master_insert THEN
      LET INT_FLAG = 0
      RETURN
   END IF

   LET g_state = "Y"

   LET g_wc = g_wc,
              " OR (sfaaent = '" ||g_enterprise|| "' AND sfaasite = '" ||g_site|| "' AND",
              " sfaadocno = '", g_sfaa_m.sfaadocno CLIPPED, "' "

              , ") "

   #add-point:完成複製段落後
   
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_detail_reproduce" order="20" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_detail_reproduce()
   {<Local define>}
   DEFINE ls_sql      STRING
   DEFINE ld_date     DATETIME YEAR TO SECOND
   DEFINE l_detail    RECORD LIKE sfba_t.*


   {</Local define>}
   #add-point:delete段define
   
   #end add-point

   CALL s_transaction_begin()

   LET ld_date = cl_get_current()

   DROP TABLE asft300_detail

   #add-point:單身複製前1
   
   #end add-point

   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE asft300_detail AS ",
                "SELECT * FROM sfba_t "
   PREPARE repro_tbl FROM ls_sql
   EXECUTE repro_tbl
   FREE repro_tbl

   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO asft300_detail SELECT * FROM sfba_t
                                         WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaadocno_t


   #將key修正為調整後
   UPDATE asft300_detail
      #更新key欄位
      SET sfbadocno = g_sfaa_m.sfaadocno,
          sfba016 = 0,
          sfba025 = 0,
          sfba017 = 0,
          sfba018 = 0
      #更新共用欄位



   #將資料塞回原table
   INSERT INTO sfba_t SELECT * FROM asft300_detail

   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "reproduce"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      RETURN
   END IF

   #add-point:單身複製中1
   
   #end add-point

   #刪除TEMP TABLE
   DROP TABLE asft300_detail

   #add-point:單身複製後1
   
   #end add-point





   #多語言複製段落


   CALL s_transaction_end('Y','0')

   #已新增完, 調整資料內容(修改時使用)
   LET g_sfaadocno_t = g_sfaa_m.sfaadocno


   DROP TABLE asft300_detail

END FUNCTION]]>
  </point>
  <point name="function.asft300_delete" order="21" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_delete()
   {<Local define>}
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   DEFINE  l_n             LIKE type_t.num5
   {</Local define>}
   #add-point:delete段define
   
   #end add-point

   IF g_sfaa_m.sfaadocno IS NULL

   THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF

   IF g_sfaa_m.sfaastus <> 'N' THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'apm-00034'
      LET g_errparam.extend = g_sfaa_m.sfaastus
      LET g_errparam.popup = TRUE
      CALL cl_err()

      RETURN
   END IF
   
   #已存在子工单资料不可删除
   SELECT COUNT(*) INTO l_n FROM sfaa_t
    WHERE sfaaent = g_enterprise AND sfaasite = g_site
      AND sfaa021 = g_sfaa_m.sfaadocno
   IF l_n > 0 THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "asf-00439"
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.popup = TRUE
      CALL cl_err()

      RETURN
   END IF
   
    SELECT UNIQUE sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa009,sfaa022,sfaa023,sfaa024,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,'',sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt
 INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt
 FROM sfaa_t
 WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
   CALL s_transaction_begin()



   OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN asft300_cl:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF

   FETCH asft300_cl INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.oobal004,g_sfaa_m.sfaa002,g_sfaa_m.sfaa002_desc,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa009_desc,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa010_desc,g_sfaa_m.sfaa010_desc1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa016_desc,g_sfaa_m.sfaa017,g_sfaa_m.sfaa017_desc,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.ooff013,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaownid_desc,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaaowndp_desc,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtid_desc,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdp_desc,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamodid_desc,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfid_desc,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstid_desc,g_sfaa_m.sfaapstdt              # 鎖住將被更改或取消的資料
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.popup = FALSE
      CALL cl_err()
          #資料被他人LOCK
      CALL s_transaction_end('N','0')
      RETURN
   END IF

   CALL asft300_show()

   #IF NOT cl_ask_delete() THEN             #確認一下
   IF cl_ask_del_master() THEN              #確認一下

      #add-point:單頭刪除前
      CALL asft300_set_pk_array()
      #end add-point

      INITIALIZE g_doc.* TO NULL
      LET g_doc.column1 = "sfaadocno"
      LET g_doc.value1 = g_sfaa_m.sfaadocno
      CALL cl_doc_remove()

      #資料備份
      LET g_sfaadocno_t = g_sfaa_m.sfaadocno


      DELETE FROM sfaa_t
       WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno


      #add-point:單頭刪除中
      
      #end add-point

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF

      #add-point:單頭刪除後
      IF NOT s_aooi200_del_docno(g_sfaa_m.sfaadocno,g_sfaa_m.sfaadocdt) THEN
         CALL s_transaction_end('N','0')
         RETURN
      END IF
      #end add-point


      #add-point:單身刪除前
      DELETE FROM sfab_t
       WHERE sfabent = g_enterprise AND sfabsite = g_site AND sfabdocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfab_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfac_t
       WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfac_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfad_t
       WHERE sfadent = g_enterprise AND sfadsite = g_site AND sfaddocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfad_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfae_t
       WHERE sfaeent = g_enterprise AND sfaesite = g_site AND sfaedocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfae_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfaf_t
       WHERE sfafent = g_enterprise AND sfafsite = g_site AND sfafdocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfaf_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfca_t
       WHERE sfcaent = g_enterprise AND sfcasite = g_site AND sfcadocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfca_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfcb_t
       WHERE sfcbent = g_enterprise AND sfcbsite = g_site AND sfcbdocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfcb_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfcc_t
       WHERE sfccent = g_enterprise AND sfccsite = g_site AND sfccdocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfcc_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      
      DELETE FROM sfcd_t
       WHERE sfcdent = g_enterprise AND sfcdsite = g_site AND sfcddocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfcd_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF
      #end add-point

      DELETE FROM sfba_t
       WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno


      #add-point:單身刪除中
      
      #end add-point

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfba_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

         CALL s_transaction_end('N','0')
         RETURN
      END IF

      #add-point:單身刪除後
      #stellar 130918 add ----------(S)
      #若是從APS拋轉的工單，刪除時，也要將相關資料清除
      LET l_n = 0
      SELECT COUNT(*) INTO l_n FROM psos_t
       WHERE psosent = g_enterprise
         AND psossite= g_site
         AND psos009 = '1'   #建議單據=新增
         AND psos058 = g_sfaa_m.sfaadocno
      IF NOT cl_null(l_n) AND l_n > 0 THEN
         UPDATE psos_t SET psos057 = 'N',
                           psos058 = NULL
          WHERE psosent = g_enterprise
            AND psossite= g_site
            AND psos009 = '1'
            AND psos058 = g_sfaa_m.sfaadocno
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "psos_t"
            LET g_errparam.popup = FALSE
            CALL cl_err()
   
            CALL s_transaction_end('N','0')
            RETURN
         END IF
      END IF
      #stellar 130918 add ----------(E)
      #end add-point







      CLEAR FORM
      CALL g_sfba_d.clear()
      CALL g_sfab_d.clear()
      CALL g_sfac_d.clear()
      CALL g_sfad_d.clear()
      CALL g_sfae_d.clear()
      CALL g_sfaf_d.clear()

      CALL asft300_ui_browser_refresh()
    # CALL asft300_ui_headershow()
    # CALL asft300_ui_detailshow()

      IF g_browser_cnt > 0 THEN
         CALL asft300_fetch('P')
         DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
         DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
      ELSE
    #    LET g_wc = " 1=1"
    #    CALL asft300_browser_fill("F")
         CLEAR FORM
      END IF

   END IF

   #多語言刪除




   CLOSE asft300_cl
   CALL s_transaction_end('Y','0')

   #流程通知預埋點-D
   CALL cl_flow_notify(g_sfaa_m.sfaadocno,'D')

END FUNCTION]]>
  </point>
  <point name="function.asft300_b_fill" order="22" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_b_fill()
   {<Local define>}
   DEFINE p_wc2      STRING
   {</Local define>}
   #add-point:b_fill段define
   
   #end add-point

   CALL g_sfba_d.clear()    #g_sfba_d 單頭及單身


   #add-point:b_fill段sql_before
   
   #end add-point

   #判斷是否填充
   IF asft300_fill_chk(1) THEN

      LET g_sql = "SELECT  UNIQUE sfbaseq,sfbaseq1,sfba002,sfba003,sfba004,sfba005,'',sfba022,sfba006,'','','',sfba021,sfba007,sfba008,sfba009,sfba010,sfba011,sfba012,sfba023,sfba024,sfba013,sfba014,sfba015,sfba016,sfba025,'','',sfba017,sfba018,sfba019,sfba020,sfba029,sfba030,sfba028,sfba001,sfba026,sfba027 FROM sfba_t",
                  " INNER JOIN sfaa_t ON sfaadocno = sfbadocno ",

                  #"",

                  "",
                  " WHERE sfbaent=? AND sfbasite=? AND sfbadocno=?"

      IF NOT cl_null(g_wc2_table1) THEN
         LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
      END IF

      #子單身的WC


      LET g_sql = g_sql, " ORDER BY sfba_t.sfbaseq,sfba_t.sfbaseq1"

      #add-point:單身填充控制
      
      #end add-point

      PREPARE asft300_pb FROM g_sql
      DECLARE b_fill_cs CURSOR FOR asft300_pb

      LET g_cnt = l_ac
      LET l_ac = 1

      OPEN b_fill_cs USING g_enterprise, g_site,g_sfaa_m.sfaadocno


      FOREACH b_fill_cs INTO g_sfba_d[l_ac].sfbaseq,g_sfba_d[l_ac].sfbaseq1,g_sfba_d[l_ac].sfba002,g_sfba_d[l_ac].sfba003,g_sfba_d[l_ac].sfba004,g_sfba_d[l_ac].sfba005,g_sfba_d[l_ac].replace,g_sfba_d[l_ac].sfba022,g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba006_desc,g_sfba_d[l_ac].sfba006_desc_desc,g_sfba_d[l_ac].imaf013,g_sfba_d[l_ac].sfba021,g_sfba_d[l_ac].sfba007,g_sfba_d[l_ac].sfba008,g_sfba_d[l_ac].sfba009,g_sfba_d[l_ac].sfba010,g_sfba_d[l_ac].sfba011,g_sfba_d[l_ac].sfba012,g_sfba_d[l_ac].sfba023,g_sfba_d[l_ac].sfba024,g_sfba_d[l_ac].sfba013,g_sfba_d[l_ac].sfba014,g_sfba_d[l_ac].sfba015,g_sfba_d[l_ac].sfba016,g_sfba_d[l_ac].sfba025,g_sfba_d[l_ac].number1,g_sfba_d[l_ac].number2,g_sfba_d[l_ac].sfba017,g_sfba_d[l_ac].sfba018,g_sfba_d[l_ac].sfba019,g_sfba_d[l_ac].sfba020,g_sfba_d[l_ac].sfba029,g_sfba_d[l_ac].sfba030,g_sfba_d[l_ac].sfba028,g_sfba_d[l_ac].sfba001,g_sfba_d[l_ac].sfba026,g_sfba_d[l_ac].sfba027
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "FOREACH:"
            LET g_errparam.popup = TRUE
            CALL cl_err()

            EXIT FOREACH
         END IF

         #add-point:b_fill段資料填充
                 
         CALL asft300_b_desc()
         
         #end add-point

         LET l_ac = l_ac + 1
         IF l_ac > g_max_rec AND g_error_show = 1 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code =  9035
            LET g_errparam.extend =  ''
            LET g_errparam.popup = TRUE
            CALL cl_err()

            EXIT FOREACH
         END IF

      END FOREACH
      LET g_error_show = 0

   END IF



   CALL g_sfba_d.deleteElement(g_sfba_d.getLength())



   LET l_ac = g_cnt
   LET g_cnt = 0

   FREE asft300_pb


END FUNCTION]]>
  </point>
  <point name="function.asft300_delete_b" order="23" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_delete_b(ps_table,ps_keys_bak,ps_page)
   {<Local define>}
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   {</Local define>}
   #add-point:delete_b段define
   
   #end add-point

   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前
      
      #end add-point
      DELETE FROM sfba_t
       WHERE sfbaent = g_enterprise AND sfbasite = g_site AND
         sfbadocno = ps_keys_bak[1] AND sfbaseq = ps_keys_bak[2] AND sfbaseq1 = ps_keys_bak[3]
      #add-point:delete_b段刪除中
      
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ""
         LET g_errparam.popup = FALSE
         CALL cl_err()

      END IF
      #add-point:delete_b段刪除後
      
      #end add-point
   END IF





END FUNCTION]]>
  </point>
  <point name="function.asft300_insert_b" order="24" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_insert_b(ps_table,ps_keys,ps_page)
   {<Local define>}
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys     DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE ls_page     STRING
   {</Local define>}
   #add-point:insert_b段define
   
   #end add-point

   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前
      
      #end add-point
      INSERT INTO sfba_t
                  (sfbaent, sfbasite,
                   sfbadocno,
                   sfbaseq,sfbaseq1
                   ,sfba002,sfba003,sfba004,sfba005,sfba022,sfba006,sfba021,sfba007,sfba008,sfba009,sfba010,sfba011,sfba012,sfba023,sfba024,sfba013,sfba014,sfba015,sfba016,sfba025,sfba017,sfba018,sfba019,sfba020,sfba029,sfba030,sfba028,sfba001,sfba026,sfba027)
            VALUES(g_enterprise, g_site,
                   ps_keys[1],ps_keys[2],ps_keys[3]
                   ,g_sfba_d[g_detail_idx].sfba002,g_sfba_d[g_detail_idx].sfba003,g_sfba_d[g_detail_idx].sfba004,g_sfba_d[g_detail_idx].sfba005,g_sfba_d[g_detail_idx].sfba022,g_sfba_d[g_detail_idx].sfba006,g_sfba_d[g_detail_idx].sfba021,g_sfba_d[g_detail_idx].sfba007,g_sfba_d[g_detail_idx].sfba008,g_sfba_d[g_detail_idx].sfba009,g_sfba_d[g_detail_idx].sfba010,g_sfba_d[g_detail_idx].sfba011,g_sfba_d[g_detail_idx].sfba012,g_sfba_d[g_detail_idx].sfba023,g_sfba_d[g_detail_idx].sfba024,g_sfba_d[g_detail_idx].sfba013,g_sfba_d[g_detail_idx].sfba014,g_sfba_d[g_detail_idx].sfba015,g_sfba_d[g_detail_idx].sfba016,g_sfba_d[g_detail_idx].sfba025,g_sfba_d[g_detail_idx].sfba017,g_sfba_d[g_detail_idx].sfba018,g_sfba_d[g_detail_idx].sfba019,g_sfba_d[g_detail_idx].sfba020,g_sfba_d[g_detail_idx].sfba029,g_sfba_d[g_detail_idx].sfba030,g_sfba_d[g_detail_idx].sfba028,g_sfba_d[g_detail_idx].sfba001,g_sfba_d[g_detail_idx].sfba026,g_sfba_d[g_detail_idx].sfba027)
      #add-point:insert_b段資料新增中
      
      #end add-point
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "sfba_t"
         LET g_errparam.popup = FALSE
         CALL cl_err()

      END IF
      #add-point:insert_b段資料新增後
      
      #end add-point
   END IF





END FUNCTION]]>
  </point>
  <point name="function.asft300_update_b" order="25" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_update_b(ps_table,ps_keys,ps_keys_bak,ps_page)
   {<Local define>}
   DEFINE ps_table         STRING
   DEFINE ps_page          STRING
   DEFINE ps_keys          DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_keys_bak      DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group         STRING
   DEFINE li_idx           LIKE type_t.num5
   DEFINE lb_chk           BOOLEAN
   DEFINE l_new_key        DYNAMIC ARRAY OF STRING
   DEFINE l_old_key        DYNAMIC ARRAY OF STRING
   DEFINE l_field_key      DYNAMIC ARRAY OF STRING
   {</Local define>}
   #add-point:update_b段define
   
   #end add-point

   #判斷key是否有改變
   LET lb_chk = TRUE
   FOR li_idx = 1 TO ps_keys.getLength()
      IF ps_keys[li_idx] <> ps_keys_bak[li_idx] THEN
         LET lb_chk = FALSE
         EXIT FOR
      END IF
   END FOR

   #不需要做處理
   IF lb_chk THEN
      RETURN
   END IF

   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "sfba_t" THEN
      #add-point:update_b段修改前
      
      #end add-point
      UPDATE sfba_t
         SET (sfbadocno,
              sfbaseq,sfbaseq1
              ,sfba002,sfba003,sfba004,sfba005,sfba022,sfba006,sfba021,sfba007,sfba008,sfba009,sfba010,sfba011,sfba012,sfba023,sfba024,sfba013,sfba014,sfba015,sfba016,sfba025,sfba017,sfba018,sfba019,sfba020,sfba029,sfba030,sfba028,sfba001,sfba026,sfba027)
              =
             (ps_keys[1],ps_keys[2],ps_keys[3]
              ,g_sfba_d[g_detail_idx].sfba002,g_sfba_d[g_detail_idx].sfba003,g_sfba_d[g_detail_idx].sfba004,g_sfba_d[g_detail_idx].sfba005,g_sfba_d[g_detail_idx].sfba022,g_sfba_d[g_detail_idx].sfba006,g_sfba_d[g_detail_idx].sfba021,g_sfba_d[g_detail_idx].sfba007,g_sfba_d[g_detail_idx].sfba008,g_sfba_d[g_detail_idx].sfba009,g_sfba_d[g_detail_idx].sfba010,g_sfba_d[g_detail_idx].sfba011,g_sfba_d[g_detail_idx].sfba012,g_sfba_d[g_detail_idx].sfba023,g_sfba_d[g_detail_idx].sfba024,g_sfba_d[g_detail_idx].sfba013,g_sfba_d[g_detail_idx].sfba014,g_sfba_d[g_detail_idx].sfba015,g_sfba_d[g_detail_idx].sfba016,g_sfba_d[g_detail_idx].sfba025,g_sfba_d[g_detail_idx].sfba017,g_sfba_d[g_detail_idx].sfba018,g_sfba_d[g_detail_idx].sfba019,g_sfba_d[g_detail_idx].sfba020,g_sfba_d[g_detail_idx].sfba029,g_sfba_d[g_detail_idx].sfba030,g_sfba_d[g_detail_idx].sfba028,g_sfba_d[g_detail_idx].sfba001,g_sfba_d[g_detail_idx].sfba026,g_sfba_d[g_detail_idx].sfba027)
         WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = ps_keys_bak[1] AND sfbaseq = ps_keys_bak[2] AND sfbaseq1 = ps_keys_bak[3]
      #add-point:update_b段修改中
      
      #end add-point
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = "std-00009"
            LET g_errparam.extend = "sfba_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()

            CALL s_transaction_end('N','0')
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "sfba_t"
            LET g_errparam.popup = TRUE
            CALL cl_err()

            CALL s_transaction_end('N','0')
         OTHERWISE

      END CASE
      #add-point:update_b段修改後
      
      #end add-point
   END IF







END FUNCTION]]>
  </point>
  <point name="function.asft300_lock_b" order="26" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_lock_b(ps_table,ps_page)
   {<Local define>}
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   {</Local define>}
   #add-point:lock_b段define
   
   #end add-point

   #先刷新資料
   #CALL asft300_b_fill()

   #鎖定整組table
   #LET ls_group = "'1',"
   #僅鎖定自身table
   LET ls_group = "sfba_t"

   IF ls_group.getIndexOf(ps_table,1) THEN

      OPEN asft300_bcl USING g_enterprise, g_site,
                                       g_sfaa_m.sfaadocno,g_sfba_d[g_detail_idx].sfbaseq,g_sfba_d[g_detail_idx].sfbaseq1

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "asft300_bcl"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN FALSE
      END IF

   END IF





   RETURN TRUE

END FUNCTION]]>
  </point>
  <point name="function.asft300_unlock_b" order="27" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_unlock_b(ps_table,ps_page)
   {<Local define>}
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   {</Local define>}
   #add-point:unlock_b段define
   
   #end add-point

   LET ls_group = "'1',"

   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE asft300_bcl
   END IF





END FUNCTION]]>
  </point>
  <point name="function.asft300_set_entry" order="28" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_set_entry(p_cmd)
   {<Local define>}
   DEFINE p_cmd   LIKE type_t.chr1
   {</Local define>}
   #add-point:set_entry段define
   
   #end add-point

   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("sfaadocno",TRUE)
      #add-point:set_entry段欄位控制
      
      #end add-point
   END IF

   #add-point:set_entry段欄位控制後
   CALL cl_set_comp_entry("sfaa003,sfaa057,sfaa004,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa010,sfaa011,sfaa012,sfaa013",TRUE)
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_set_no_entry" order="29" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_set_no_entry(p_cmd)
   {<Local define>}
   DEFINE p_cmd   LIKE type_t.chr1
   {</Local define>}
   #add-point:set_no_entry段define
   DEFINE l_fields STRING
   DEFINE l_n      LIKE type_t.num5
   #end add-point

   IF p_cmd = 'u' THEN
      CALL cl_set_comp_entry("sfaadocno",FALSE)
      #add-point:set_no_entry段欄位控制
      
      #end add-point
   END IF

   #add-point:set_no_entry段欄位控制後
   IF NOT cl_null(g_sfaa_m.sfaadocno) THEN
      LET l_fields = ''
      CALL s_aooi200_get_doc_fields(g_site,'1',g_sfaa_m.sfaadocno) RETURNING l_fields
      CALL cl_set_comp_entry(l_fields,FALSE)
      
      #有單身資料時，工單類型、發料制度、工單來源、來源單號項次項序分批序、生產料號、BOM特性、生產數量、生產單位、工單來源頁籤，
      #限制不可修改，以免已存在的單身資料與單頭不合
      SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
      IF l_n > 0 THEN
         CALL cl_set_comp_entry("sfaa003,sfaa057,sfaa004,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa010,sfaa011,sfaa012,sfaa013",FALSE)
      END IF
   END IF
   
   
      
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_set_entry_b" order="30" ver="2" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_set_entry_b(p_cmd)
   {<Local define>}
   DEFINE p_cmd               LIKE type_t.chr1
   DEFINE l_success           LIKE type_t.num5
   DEFINE l_ooba002           LIKE ooba_t.ooba002
   {</Local define>}
   #add-point:set_entry_b段define
   CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
   CALL cl_set_comp_entry("sfba023",FALSE)
   IF g_sfba_d[l_ac].sfba008 = '1' THEN
      IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0034') = 'Y' THEN
         CALL cl_set_comp_entry("sfba024",TRUE)
      END IF
   END IF
   IF g_sfba_d[l_ac].sfba008 = '2' THEN
      IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0035') = 'Y' THEN
         CALL cl_set_comp_entry("sfba023,sfba024",TRUE)
      END IF
   END IF
   IF g_sfba_d[l_ac].sfba008 = '3' THEN
      IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0036') = 'Y' THEN
         CALL cl_set_comp_entry("sfba023,sfba024",TRUE)
      END IF
   END IF
   #end add-point
   #add-point:set_entry_b段
   CALL cl_set_comp_entry("sfba021",TRUE)
   #end add-point
END FUNCTION]]>
  </point>
  <point name="function.asft300_set_no_entry_b" order="31" ver="2" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_set_no_entry_b(p_cmd)
   {<Local define>}
   DEFINE p_cmd   LIKE type_t.chr1
   DEFINE l_success           LIKE type_t.num5
   DEFINE l_ooba002           LIKE ooba_t.ooba002
   DEFINE l_imaa005           LIKE imaa_t.imaa005
   {</Local define>}
   #add-point:set_no_entry_b段define
   CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
   IF g_sfba_d[l_ac].sfba008 = '1' THEN
      IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0034') = 'N' THEN
         CALL cl_set_comp_entry("sfba024",FALSE)
      END IF
   END IF
   IF g_sfba_d[l_ac].sfba008 = '2' THEN
      IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0035') = 'N' THEN
         CALL cl_set_comp_entry("sfba023,sfba024",FALSE)
      END IF
   END IF
   IF g_sfba_d[l_ac].sfba008 = '3' THEN
      IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0036') = 'N' THEN
         CALL cl_set_comp_entry("sfba023,sfba024",FALSE)
      END IF
   END IF
   #end add-point
   #add-point:set_no_entry_b段
   SELECT imaa005 INTO l_imaa005 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfba_d[l_ac].sfba006
   IF cl_null(l_imaa005) THEN
      CALL cl_set_comp_entry("sfba021",FALSE)
      LET g_sfba_d[l_ac].sfba021 = ' '
   END IF
   #end add-point
END FUNCTION]]>
  </point>
  <point name="function.asft300_default_search" order="32" ver="9" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_default_search()
   {<Local define>}
   DEFINE li_idx  LIKE type_t.num5
   DEFINE li_cnt  LIKE type_t.num5
   DEFINE ls_wc   STRING
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE ls_where   STRING
   {</Local define>}
   #add-point:default_search段define
   
   #end add-point

   #add-point:default_search段開始前
   
   #end add-point

   LET g_pagestart = 1

   IF cl_null(g_order) THEN
      LET g_order = "ASC"
   END IF

   IF NOT cl_null(g_argv[1]) THEN
      LET ls_wc = ls_wc, " sfaadocno = '", g_argv[1], "' AND "
   END IF



   IF NOT cl_null(ls_wc) THEN
      LET g_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_default = TRUE
   ELSE
      LET g_default = FALSE
      #預設查詢條件
      #mod pattern 修改调整150624
     #LET g_wc = cl_qbe_get_default_qryplan()    
     #IF cl_null(g_wc) THEN
     #   LET g_wc = " 1=2"
     #   LET g_default = TRUE 
     #END IF
      CALL cl_qbe_get_default_qryplan() RETURNING ls_where
      IF NOT cl_null(ls_where) THEN
         CALL util.JSON.parse(ls_where, la_wc)
         INITIALIZE g_wc, g_wc2,g_wc2_extend TO NULL
         FOR li_idx = 1 TO la_wc.getLength()
            CASE
               WHEN la_wc[li_idx].tableid = "sfaa_t"
                  LET g_wc = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "sfba_t"
                  LET g_wc2 = la_wc[li_idx].wc
      
               WHEN la_wc[li_idx].tableid = "EXTENDWC"
                  LET g_wc2_extend = la_wc[li_idx].wc
            END CASE
         END FOR
         IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2) OR NOT cl_null(g_wc2_extend) THEN
            IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
            END IF
      
            IF g_wc2.subString(1,5) = " AND " THEN
               LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
            END IF
         END IF
      END IF
      IF cl_null(g_wc) AND cl_null(g_wc2) THEN
         LET g_wc = " 1=2"
      END IF
     #mod pattern 修改调整150624 end
   END IF

   #add-point:default_search段結束前
   #傳單號範圍至asft300,一次查詢可查詢出多個單號資料
   IF NOT cl_null(g_argv[02]) THEN
      LET g_wc = g_wc," AND ",g_argv[02]
   END IF
   #end add-point
   
   #2014/10/30 by stellar add -------- (S)
   #給予批次串程式使用
   IF NOT cl_null(g_argv[03]) THEN
      LET g_wc = " ", g_argv[03]
   END IF
   #2014/10/30 by stellar add -------- (E)


END FUNCTION]]>
  </point>
  <point name="function.asft300_statechange" order="33" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_statechange()
   {<Local define>}
   DEFINE lc_state LIKE type_t.chr5
   DEFINE l_success LIKE type_t.num5
   DEFINE l_ooba002 LIKE ooba_t.ooba002
   DEFINE l_n       LIKE type_t.num5
   DEFINE l_num     LIKE type_t.num5
   #add-point:statechange段開始前
   
   #end add-point

   ERROR ""     #清空畫面右下側ERROR區塊

   IF g_sfaa_m.sfaadocno IS NULL

   THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

      RETURN
   END IF

   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_sfaa_m.sfaastus
            WHEN "A" #已核准
               HIDE OPTION "approved"
            WHEN "C"
               HIDE OPTION "closed"
            WHEN "D"
               HIDE OPTION "withdraw"

            WHEN "E"
               HIDE OPTION "closed_irregular"

            WHEN "F"
               HIDE OPTION "released"

            WHEN "M"
               HIDE OPTION "costing_closed"

            WHEN "N"
               HIDE OPTION "unconfirmed"
           
            WHEN "R"
               HIDE OPTION "rejection"

            WHEN "W"
               HIDE OPTION "signing"

            WHEN "X"
               HIDE OPTION "invalid"

            WHEN "Y"
               HIDE OPTION "confirmed"

         END CASE

      #add-point:menu前
         CALL cl_set_act_visible("unconfirmed,unreleased,released,invalid,confirmed",TRUE)
         #無條件關結案
         CALL cl_set_act_visible("closed,costing_closed,closed_irregular",FALSE)
         #提交和抽單一開始先無條件關
         CALL cl_set_act_visible("signing,withdraw",FALSE)
         CASE g_sfaa_m.sfaastus
            WHEN "N"
               #HIDE OPTION "open"
               CALL cl_set_act_visible("unconfirmed,released,unreleased",FALSE)
               IF cl_bpm_chk() THEN
                  CALL cl_set_act_visible("signing",TRUE)
                  CALL cl_set_act_visible("confirmed",FALSE)
               END IF

            WHEN "F"
               #HIDE OPTION "posted"
               CALL cl_set_act_visible("unconfirmed,released,invalid,confirmed",FALSE)

            WHEN "X"
               #HIDE OPTION "invalid"
               CALL cl_set_act_visible("unconfirmed,released,unreleased,invalid,confirmed",FALSE)
               RETURN

            WHEN "Y"
               #HIDE OPTION "confirmed"
               CALL cl_set_act_visible("invalid,confirmed,unreleased",FALSE)
            
            #保留修改的功能(如作廢)，隱藏其他應用功能
            WHEN "R"
               CALL cl_set_act_visible("unconfirmed,unreleased,released,confirmed",FALSE)
               
            WHEN "D"
               CALL cl_set_act_visible("unconfirmed,unreleased,released,confirmed",FALSE)
         
            #送簽中只能顯示抽單;其餘應用功能皆隱藏
            WHEN "W"
               CALL cl_set_act_visible("withdraw",TRUE)
               CALL cl_set_act_visible("unconfirmed,unreleased,released,invalid,confirmed",FALSE)
            #已核准
            WHEN "A"     #只能顯示確認; 其餘應用功能皆隱藏
                CALL cl_set_act_visible("confirmed ",TRUE)
                CALL cl_set_act_visible("unconfirmed,invalid,unreleased,released",FALSE)
         END CASE
      #end add-point
	
      ON ACTION closed
         LET lc_state = "C"
         #add-point:action控制
         RETURN
         #end add-point
         EXIT MENU

      ON ACTION closed_irregular
         LET lc_state = "E"
         #add-point:action控制
         RETURN
         #end add-point
         EXIT MENU

      ON ACTION released
         IF g_sfaa_m.sfaastus != 'Y' THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'asf-00180'
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()

            RETURN
         END IF
         CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
         IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0038') = '2' THEN
            SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno
            IF l_n = 0 THEN
               CALL s_transaction_begin()
               CALL s_asft300_02(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa003,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa015,g_sfaa_m.sfaa012,'N') RETURNING l_success,l_num
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL s_transaction_end('Y','0')
               END IF
            END IF
         END IF
         IF g_sfaa_m.sfaa004 = '2' THEN
            IF NOT asft300_upd_sfcb('INIT','0') THEN
               RETURN
            END IF
         END IF
               
         LET lc_state = "F"
         #add-point:action控制

         #end add-point
         EXIT MENU

      ON ACTION costing_closed
         LET lc_state = "M"
         #add-point:action控制
         RETURN
         #end add-point
         EXIT MENU

      ON ACTION unconfirmed
         #仅当状态为 Y.已审核 或是 X.作废时,才可以切换为N.未确认
         IF g_sfaa_m.sfaastus NOT MATCHES '[YX]' THEN            
            RETURN
         END IF
         LET lc_state = "N"
         #add-point:action控制
         #庫存需求等候  #15/02/08 add by Sarah
         IF NOT s_asft300_01_upd_inas('uncon',g_sfaa_m.sfaadocno) THEN
            RETURN
         END IF
         #end add-point
         EXIT MENU

      ON ACTION rejection
         LET lc_state = "R"
         #add-point:action控制
         RETURN
         #end add-point
         EXIT MENU

      ON ACTION signing
         LET lc_state = "W"
         #add-point:action控制
         IF cl_auth_chk_act("signing") THEN
            IF NOT asft300_send() THEN
               RETURN
            END IF
         END IF
         LET lc_state = ''   #因為_send()已有執行update動作
         #end add-point
         EXIT MENU
      
      ON ACTION approved
         LET lc_state = "A"
         EXIT MENU

      ON ACTION withdraw
         IF cl_auth_chk_act("withdraw") THEN
            IF NOT asft300_draw_out() THEN
               RETURN
            END IF
         END IF
         LET lc_state = ''  #因為_draw_out()已有執行update動作
         EXIT MENU
         
      ON ACTION invalid
         LET lc_state = "X"
         #add-point:action控制
         #仅当状态为 N.未确认时,才可以切换为 X.作废
         IF g_sfaa_m.sfaastus NOT MATCHES '[N]' THEN            
            RETURN
         END IF
         IF NOT cl_ask_confirm('aim-00109') THEN
            RETURN
         END IF
         #end add-point
         EXIT MENU

      ON ACTION confirmed
         #仅当状态为 N.未审核/F.已发出时,才可以切换为Y.已审核
         #   IF g_sfaa_m.sfaastus NOT MATCHES '[NF]' THEN
         IF g_sfaa_m.sfaastus NOT MATCHES '[NFA]' THEN   #MOD BY zhujing 2015-6-16
            RETURN
         END IF
         IF g_sfaa_m.sfaastus MATCHES '[NA]' THEN  #MOD BY zhujing 2015-6-17
            CALL s_transaction_begin()
            CALL s_asft300_01_confirm(g_sfaa_m.sfaadocno)
                 RETURNING l_success
            IF NOT l_success THEN
               CALL s_transaction_end('N',0)
               RETURN
            ELSE
               LET g_sfaa_m.sfaastus = 'Y'
               LET lc_state = "Y"
            END IF
            CALL s_aooi200_get_slip(g_sfaa_m.sfaadocno) RETURNING l_success,l_ooba002
            IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0040') = 'Y' THEN
               IF cl_get_doc_para(g_enterprise,g_site,l_ooba002,'D-MFG-0038') = '2' THEN
                  SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno
                  IF l_n = 0 THEN
                     CALL s_transaction_begin()
                     CALL s_asft300_02(g_sfaa_m.sfaadocno,g_sfaa_m.sfaa003,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa015,g_sfaa_m.sfaa012,'N') RETURNING l_success,l_num
                     IF NOT l_success THEN
                        CALL s_transaction_end('N','0')
                        RETURN
                     ELSE
                        CALL s_transaction_end('Y','0')
                     END IF
                  END IF
               END IF
               IF g_sfaa_m.sfaa004 = '2' THEN
                  IF NOT asft300_upd_sfcb('INIT','0') THEN
                     RETURN
                  END IF
               END IF
               LET lc_state = 'F'
            END IF 
            CALL s_transaction_end('Y',0)   
         END IF
         
         EXIT MENU
	
      #add-point:stus控制
      ON ACTION unreleased
         IF g_sfaa_m.sfaastus NOT MATCHES '[F]' THEN            
            RETURN
         END IF
         LET lc_state = 'Y'
         EXIT MENU
      #end add-point
	
   END MENU

   IF (lc_state <> "C"
      AND lc_state <> "D"

      AND lc_state <> "E"

      AND lc_state <> "F"

      AND lc_state <> "M"

      AND lc_state <> "N"

      AND lc_state <> "R"

      AND lc_state <> "W"

      AND lc_state <> "X"

      AND lc_state <> "Y"


      ) OR
      cl_null(lc_state) THEN
      RETURN
   END IF

   #add-point:stus修改前
   #有後續的異動記錄包含報工、發料、入庫都不能再取消发出
   IF g_sfaa_m.sfaastus = 'F' THEN
      #发料单
      SELECT COUNT(*) INTO l_n FROM sfda_t,sfdc_t WHERE sfdaent=sfdcent AND sfdadocno=sfdcdocno
         AND sfdc001 = g_sfaa_m.sfaadocno AND sfdastus !='X'
      IF l_n = 0 THEN
         SELECT COUNT(*) INTO l_n FROM sfda_t,sfdb_t WHERE sfdaent=sfdbent AND sfdadocno=sfdbdocno
            AND sfdb001 = g_sfaa_m.sfaadocno AND sfdastus !='X'
      END IF
      IF l_n > 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'asf-00318'
         LET g_errparam.extend = g_sfaa_m.sfaadocno
         LET g_errparam.popup = TRUE
         CALL cl_err()
         RETURN 
      END IF
      #入库单
      SELECT COUNT(*) INTO l_n FROM sfea_t,sfec_t WHERE sfeaent=sfecent AND sfeadocno=sfecdocno
         AND sfec001 = g_sfaa_m.sfaadocno AND sfeastus !='X'
      IF l_n = 0 THEN
         SELECT COUNT(*) INTO l_n FROM sfea_t,sfeb_t WHERE sfeaent=sfebent AND sfeadocno=sfebdocno
            AND sfeb001 = g_sfaa_m.sfaadocno AND sfeastus !='X'
      END IF
      IF l_n > 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'asf-00319'
         LET g_errparam.extend = g_sfaa_m.sfaadocno
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN 
      END IF
      #报工单
      SELECT COUNT(*) INTO l_n FROM sffb_t WHERE sffbent=g_enterprise AND sffb005=g_sfaa_m.sfaadocno AND sffbstus!='X'
      IF l_n > 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'asf-00320'
         LET g_errparam.extend = g_sfaa_m.sfaadocno
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN 
      END IF
      
      #委外采购单
      SELECT COUNT(*) INTO l_n FROM pmdl_t WHERE pmdlent=g_enterprise AND pmdl008=g_sfaa_m.sfaadocno AND pmdlstus!='X'
      IF l_n > 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'asf-00454'
         LET g_errparam.extend = g_sfaa_m.sfaadocno
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN 
      END IF

      #清除備置資料
      DELETE FROM sfbb_t
       WHERE sfbbent = g_enterprise
         AND sfbbdocno =  g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ""
         LET g_errparam.popup = FALSE
         CALL cl_err()
         RETURN 
      END IF 
      UPDATE sfba_t SET sfba031 = 0,sfba032 = ''
       WHERE sfbaent = g_enterprise 
         AND sfbadocno = g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = ""
         LET g_errparam.popup = FALSE
         CALL cl_err()
         RETURN 
      END IF 
   END IF
   
   IF lc_state = 'N' THEN
      LET g_sfaa_m.sfaacnfid = ''
      LET g_sfaa_m.sfaacnfdt = ''
      UPDATE sfaa_t SET sfaacnfid = g_sfaa_m.sfaacnfid,sfaacnfdt = g_sfaa_m.sfaacnfdt
       WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
      DISPLAY BY NAME g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt
   END IF 
   #end add-point

   UPDATE sfaa_t SET sfaastus = lc_state
    WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno


   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()

   ELSE
      CASE lc_state
         WHEN "C"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/closed.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/withdraw.png")

         WHEN "E"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/closed_irregular.png")

         WHEN "F"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/released.png")

         WHEN "M"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/costing_closed.png")

         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")

         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")

         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")

         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/invalid.png")

         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/confirmed.png")


		 #此段落由子樣板a37產生
         WHEN "W"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/signing.png")
         WHEN "A"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/approved.png")
         WHEN "D"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/draw_out.png")
         WHEN "R"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/rejection.png")



      END CASE
      LET g_sfaa_m.sfaastus = lc_state
      DISPLAY BY NAME g_sfaa_m.sfaastus
   END IF

   #add-point:stus修改後
   #stellar 130918 add ----------(S)
      #若是從APS拋轉的工單，刪除時，也要將相關資料清除
   IF lc_state = 'X' THEN
      LET l_n = 0
      SELECT COUNT(*) INTO l_n FROM psos_t
       WHERE psosent = g_enterprise
         AND psossite= g_site
         AND psos009 = '1'   #建議單據=新增
         AND psos058 = g_sfaa_m.sfaadocno
      IF NOT cl_null(l_n) AND l_n > 0 THEN
         UPDATE psos_t SET psos057 = 'N',
                           psos058 = NULL
          WHERE psosent = g_enterprise
            AND psossite= g_site
            AND psos009 = '1'
            AND psos058 = g_sfaa_m.sfaadocno
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "psos_t"
            LET g_errparam.popup = FALSE
            CALL cl_err()
            RETURN
         END IF
      END IF
   END IF
   #stellar 130918 add ----------(E)
   #end add-point

   #add-point:statechange段結束前
   
   #end add-point

END FUNCTION]]>
  </point>
  <point name="function.asft300_idx_chk" order="34" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_idx_chk()
   #add-point:idx_chk段define
   
   #end add-point

   IF g_current_page = 1 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail1")
      IF g_detail_idx > g_sfba_d.getLength() THEN
         LET g_detail_idx = g_sfba_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_sfba_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_sfba_d.getLength() TO FORMONLY.cnt
   END IF


END FUNCTION]]>
  </point>
  <point name="function.asft300_b_fill2" order="35" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_b_fill2(pi_idx)
   {<Local define>}
   DEFINE pi_idx          LIKE type_t.num5
   DEFINE li_ac           LIKE type_t.num5
   DEFINE ls_chk          LIKE type_t.chr1
   {</Local define>}
   #add-point:b_fill2段define
   
   #end add-point

   LET li_ac = l_ac



   #add-point:單身填充後
   
   #end add-point

   LET l_ac = li_ac

   CALL asft300_detail_show()

END FUNCTION]]>
  </point>
  <point name="function.asft300_fill_chk" order="36" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_fill_chk(ps_idx)
   DEFINE ps_idx        LIKE type_t.chr10

   #全部為1=1 or null時回傳true
   IF (cl_null(g_wc2_table1) OR g_wc2_table1.trim() = '1=1') THEN
      RETURN TRUE
   END IF

   #第一單身
   IF ps_idx = 1 AND
      ((NOT cl_null(g_wc2_table1) AND g_wc2_table1.trim() <> '1=1')) THEN
      RETURN TRUE
   END IF

   #根據wc判定是否需要填充


   RETURN FALSE

END FUNCTION]]>
  </point>
  <point name="function.asft300_b_fill_sfab" order="37" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#sfab资料显示
PRIVATE FUNCTION asft300_b_fill_sfab()
   CALL g_sfab_d.clear()    #g_sfab_d 單頭及單身

   LET g_sql = "SELECT UNIQUE sfabseq,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006,'','','','','','',sfab007,'','','','','','' ",
               "  FROM sfab_t ",
               " WHERE sfabent=? AND sfabsite=? AND sfabdocno=? "
   IF NOT cl_null(g_wc_sfab) THEN
      LET g_sql = g_sql CLIPPED,"   AND ",g_wc_sfab CLIPPED
   END IF
   LET g_sql = g_sql CLIPPED," ORDER BY sfab_t.sfabseq,sfab_t.sfab001,sfab_t.sfab002,sfab_t.sfab003,sfab_t.sfab004"
   PREPARE asft300_sfab_pb FROM g_sql
   DECLARE b_fill_sfab_cs CURSOR FOR asft300_sfab_pb
   LET l_ac = 1
   OPEN b_fill_sfab_cs USING g_enterprise,g_site,g_sfaa_m.sfaadocno
   FOREACH b_fill_sfab_cs INTO g_sfab_d[l_ac].*

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      CALL asft300_show_sfab_desc(l_ac)

      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code =  9035
         LET g_errparam.extend =  ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF

   END FOREACH
   CALL g_sfab_d.deleteElement(g_sfab_d.getLength())
   LET g_rec_b_sfab = l_ac - 1
   LET l_ac = 1

   CLOSE b_fill_sfab_cs
   FREE asft300_sfab_pb
END FUNCTION]]>
  </point>
  <point name="function.asft300_b_fill_sfac" order="38" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#sfac资料显示
PRIVATE FUNCTION asft300_b_fill_sfac()
   CALL g_sfac_d.clear()    #g_sfac_d 單頭及單身

   LET g_sql = "SELECT UNIQUE sfacseq,sfac002,sfac001,'','',sfac006,'',sfac003,sfac004,'',sfac005 ",
               "  FROM sfac_t ",
               " WHERE sfacent=? AND sfacsite=? AND sfacdocno=? "
   IF NOT cl_null(g_wc_sfac) THEN
      LET g_sql = g_sql CLIPPED,"   AND ",g_wc_sfac CLIPPED
   END IF
   LET g_sql = g_sql CLIPPED," ORDER BY sfac_t.sfacseq,sfac_t.sfac002,sfac_t.sfac001"
   PREPARE asft300_sfac_pb FROM g_sql
   DECLARE b_fill_sfac_cs CURSOR FOR asft300_sfac_pb
   LET l_ac = 1
   OPEN b_fill_sfac_cs USING g_enterprise,g_site,g_sfaa_m.sfaadocno
   FOREACH b_fill_sfac_cs INTO g_sfac_d[l_ac].*
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      CALL asft300_show_sfac_desc(l_ac)

      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code =  9035
         LET g_errparam.extend =  ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF

   END FOREACH 
      
   CALL g_sfac_d.deleteElement(g_sfac_d.getLength())
   LET g_rec_b_sfac = l_ac - 1
   LET l_ac = 1

   CLOSE b_fill_sfac_cs
   FREE asft300_sfac_pb
END FUNCTION]]>
  </point>
  <point name="function.asft300_b_fill_sfad" order="39" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#sfad资料显示
PRIVATE FUNCTION asft300_b_fill_sfad()
   CALL g_sfad_d.clear()    #g_sfad_d 單頭及單身

   LET g_sql = "SELECT UNIQUE sfadseq,sfad001,sfad002,sfad003 ",
               "  FROM sfad_t ",
               " WHERE sfadent=? AND sfadsite=? AND sfaddocno=? "
   IF NOT cl_null(g_wc_sfad) THEN
      LET g_sql = g_sql CLIPPED,"   AND ",g_wc_sfad CLIPPED
   END IF
   LET g_sql = g_sql CLIPPED," ORDER BY sfad_t.sfadseq"
   PREPARE asft300_sfad_pb FROM g_sql
   DECLARE b_fill_sfad_cs CURSOR FOR asft300_sfad_pb
   LET l_ac = 1
   OPEN b_fill_sfad_cs USING g_enterprise,g_site,g_sfaa_m.sfaadocno
   FOREACH b_fill_sfad_cs INTO g_sfad_d[l_ac].*

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code =  9035
         LET g_errparam.extend =  ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF

   END FOREACH
   CALL g_sfad_d.deleteElement(g_sfad_d.getLength())
   LET g_rec_b_sfad = l_ac - 1
   LET l_ac = 1

   CLOSE b_fill_sfad_cs
   FREE asft300_sfad_pb
END FUNCTION
]]>
  </point>
  <point name="function.asft300_b_fill_sfae" order="40" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#sfae资料显示
PRIVATE FUNCTION asft300_b_fill_sfae()
   CALL g_sfae_d.clear()    #g_sfae_d 單頭及單身

   LET g_sql = "SELECT UNIQUE sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,'',sfae006 ",
               "  FROM sfae_t ",
               " WHERE sfaeent=? AND sfaesite=? AND sfaedocno=? "
   IF NOT cl_null(g_wc_sfae) THEN
      LET g_sql = g_sql CLIPPED,"   AND ",g_wc_sfae CLIPPED
   END IF
   LET g_sql = g_sql CLIPPED," ORDER BY sfae_t.sfaeseq"
   PREPARE asft300_sfae_pb FROM g_sql
   DECLARE b_fill_sfae_cs CURSOR FOR asft300_sfae_pb
   LET l_ac = 1
   OPEN b_fill_sfae_cs USING g_enterprise,g_site,g_sfaa_m.sfaadocno
   FOREACH b_fill_sfae_cs INTO g_sfae_d[l_ac].*

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_sfae_d[l_ac].sfae005
      CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
      LET g_sfae_d[l_ac].sfae005_desc = '', g_rtn_fields[1] , ''
      DISPLAY BY NAME g_sfae_d[l_ac].sfae005_desc
      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code =  9035
         LET g_errparam.extend =  ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF

   END FOREACH
   CALL g_sfae_d.deleteElement(g_sfae_d.getLength())
   LET g_rec_b_sfae = l_ac - 1
   LET l_ac = 1

   CLOSE b_fill_sfae_cs
   FREE asft300_sfae_pb
END FUNCTION
]]>
  </point>
  <point name="function.asft300_b_fill_sfaf" order="41" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#sfaf资料显示
PRIVATE FUNCTION asft300_b_fill_sfaf()
   CALL g_sfaf_d.clear()    #g_sfaf_d 單頭及單身

   LET g_sql = "SELECT UNIQUE sfafseq,sfaf001 ",
               "  FROM sfaf_t ",
               " WHERE sfafent=? AND sfafsite=? AND sfafdocno=? "
   IF NOT cl_null(g_wc_sfaf) THEN
      LET g_sql = g_sql CLIPPED,"   AND ",g_wc_sfaf CLIPPED
   END IF
   LET g_sql = g_sql CLIPPED," ORDER BY sfaf_t.sfafseq"
   PREPARE asft300_sfaf_pb FROM g_sql
   DECLARE b_fill_sfaf_cs CURSOR FOR asft300_sfaf_pb
   LET l_ac = 1
   OPEN b_fill_sfaf_cs USING g_enterprise,g_site,g_sfaa_m.sfaadocno
   FOREACH b_fill_sfaf_cs INTO g_sfaf_d[l_ac].*

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF
      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code =  9035
         LET g_errparam.extend =  ''
         LET g_errparam.popup = FALSE
         CALL cl_err()

         EXIT FOREACH
      END IF

   END FOREACH
   CALL g_sfaf_d.deleteElement(g_sfaf_d.getLength())
   LET g_rec_b_sfaf = l_ac - 1
   LET l_ac = 1

   CLOSE b_fill_sfaf_cs
   FREE asft300_sfaf_pb
END FUNCTION
]]>
  </point>
  <point name="function.asft300_ins_sfac" order="42" ver="7" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[# Descriptions...: 预设sfac资料
PRIVATE FUNCTION asft300_ins_sfac()
DEFINE l_sql1     STRING
DEFINE l_sql2     STRING
DEFINE l_sql3     STRING
DEFINE l_n        LIKE type_t.num5
DEFINE l_j        LIKE type_t.num5
DEFINE l_sfac001  LIKE sfac_t.sfac001
DEFINE l_sfac003  LIKE sfac_t.sfac003
DEFINE l_sfac004  LIKE sfac_t.sfac004

      LET l_sql1 = "SELECT UNIQUE '','2',bmab003,'','',' ','',bmab004*",g_sfaa_m.sfaa012/100,",'','',0 FROM bmab_t WHERE bmabent = '",g_enterprise,"'",
                   "   AND bmabsite = '",g_site,"' AND bmab001 = '",g_sfaa_m.sfaa010,"' AND bmab002 = '",g_sfaa_m.sfaa011,"'"
      LET l_sql2 = "SELECT UNIQUE '','3',bmad003,'','',' ','',bmad004*",g_sfaa_m.sfaa012,",bmad005,'',0 FROM bmad_t WHERE bmadent='",g_enterprise,"'",
                   "   AND bmadsite='",g_site,"' AND bmad001='",g_sfaa_m.sfaa010,"' AND bmad002 = '",g_sfaa_m.sfaa011,"'"
      LET l_sql3 = "SELECT UNIQUE '','5',bmac003,'','',' ','',bmac005/bmac006*",g_sfaa_m.sfaa012,",bmac004,'',0 FROM bmac_t WHERE bmacent='",g_enterprise,"'",
                   "   AND bmacsite='",g_site,"' AND bmac001='",g_sfaa_m.sfaa010,"' AND bmac002 = '",g_sfaa_m.sfaa011,"'" 
      LET g_sql = l_sql1," UNION ",l_sql2," UNION ",l_sql3
      PREPARE asft300_sfac_pb1 FROM g_sql
      DECLARE b_fill_sfac_cs1 CURSOR FOR asft300_sfac_pb1
      LET l_ac = 1
      CALL g_sfac_d.clear()
      SELECT COUNT(*) INTO l_n FROM bmad_t WHERE bmadent=g_enterprise AND bmadsite=g_site AND bmad001=g_sfaa_m.sfaa010 AND bmad002=g_sfaa_m.sfaa011
    # IF l_n = 0 THEN 
    # IF l_n = 0 OR g_sfaa_m.sfaa003 = '3' THEN    #拆件式工单只产生‘一般’资料，不产生联产品、副产品、多产出主件
      IF l_n = 0 THEN       #多产出主件不产生生产料号明细资料
         SELECT MAX(sfacseq)+1 INTO g_sfac_d[l_ac].sfacseq FROM sfac_t WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno
         IF cl_null(g_sfac_d[l_ac].sfacseq) THEN
            LET g_sfac_d[l_ac].sfacseq = 1
         END IF 
         LET g_sfac_d[l_ac].sfac002 = '1' 
         LET g_sfac_d[l_ac].sfac001 = g_sfaa_m.sfaa010
         LET g_sfac_d[l_ac].sfac003 = g_sfaa_m.sfaa012
         LET g_sfac_d[l_ac].sfac004 = g_sfaa_m.sfaa013
         LET g_sfac_d[l_ac].sfac005 = 0
         LET g_sfac_d[l_ac].sfac006 = ' '
         INSERT INTO sfac_t(sfacent,sfacsite,sfacdocno,sfacseq,sfac001,sfac002,sfac003,sfac004,sfac005,sfac006)
         VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfac_d[l_ac].sfacseq,g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac002,g_sfac_d[l_ac].sfac003,g_sfac_d[l_ac].sfac004,g_sfac_d[l_ac].sfac005,g_sfac_d[l_ac].sfac006)
         LET l_ac = l_ac + 1
         #有做特征管理时
         IF g_inam.getLength() > 0 AND g_inam004_sum > 0 THEN
            UPDATE sfac_t SET sfac003 = g_inam[1].inam004,sfac006 = g_inam[1].inam002 
             WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno AND sfac002 = '1'
            FOR l_j = 2 TO g_inam.getLength()
               IF cl_null(g_inam[l_j].inam001) THEN
                  EXIT FOR
               END IF
               SELECT MAX(sfacseq)+1 INTO g_sfac_d[l_ac].sfacseq FROM sfac_t WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno
               IF cl_null(g_sfac_d[l_ac].sfacseq) THEN
                  LET g_sfac_d[l_ac].sfacseq = 1
               END IF 
               LET g_sfac_d[l_ac].sfac002 = '1' 
               LET g_sfac_d[l_ac].sfac001 = g_sfaa_m.sfaa010
               LET g_sfac_d[l_ac].sfac004 = g_sfaa_m.sfaa013
               LET g_sfac_d[l_ac].sfac005 = 0
               LET g_sfac_d[l_ac].sfac003 = g_inam[l_j].inam004
               LET g_sfac_d[l_ac].sfac006 = g_inam[l_j].inam002
               INSERT INTO sfac_t(sfacent,sfacsite,sfacdocno,sfacseq,sfac001,sfac002,sfac003,sfac004,sfac005,sfac006)
               VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfac_d[l_ac].sfacseq,g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac002,g_sfac_d[l_ac].sfac003,g_sfac_d[l_ac].sfac004,g_sfac_d[l_ac].sfac005,g_sfac_d[l_ac].sfac006)
               LET l_ac = l_ac + 1
            END FOR
         END IF
      END IF      
      
     #IF g_sfaa_m.sfaa003 != '3' THEN   #拆件式工单只产生‘一般’资料，不产生联产品、副产品、多产出主件
      FOREACH b_fill_sfac_cs1 INTO g_sfac_d[l_ac].*
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = SQLCA.sqlcode
            LET g_errparam.extend = "FOREACH:"
            LET g_errparam.popup = TRUE
            CALL cl_err()

            EXIT FOREACH
         END IF
         IF cl_null(g_sfac_d[l_ac].sfac001) THEN
            CONTINUE FOREACH
         END IF
         SELECT MAX(sfacseq)+1 INTO g_sfac_d[l_ac].sfacseq FROM sfac_t WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno
         IF cl_null(g_sfac_d[l_ac].sfacseq) THEN
            LET g_sfac_d[l_ac].sfacseq = 1
         END IF 
         IF cl_null(g_sfac_d[l_ac].sfac004) THEN
            SELECT bmaa004 INTO g_sfac_d[l_ac].sfac004 FROM bmaa_t WHERE bmaaent = g_enterprise AND bmaasite = g_site AND bmaa001 = g_sfaa_m.sfaa010 AND bmaa002=g_sfaa_m.sfaa011
         END IF             
         INSERT INTO sfac_t(sfacent,sfacsite,sfacdocno,sfacseq,sfac001,sfac002,sfac003,sfac004,sfac005,sfac006)
         VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfac_d[l_ac].sfacseq,g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac002,g_sfac_d[l_ac].sfac003,g_sfac_d[l_ac].sfac004,g_sfac_d[l_ac].sfac005,g_sfac_d[l_ac].sfac006)
         
         IF g_sfac_d[l_ac].sfac002 = '2' THEN
            #做特征管理
            IF g_inam.getLength() > 0 AND g_inam004_sum > 0 THEN
               LET l_sfac001 = g_sfac_d[l_ac].sfac001
               LET l_sfac004 = g_sfac_d[l_ac].sfac004
               LET l_sfac003 = g_sfac_d[l_ac].sfac003
               UPDATE sfac_t SET sfac003 = sfac003 * g_inam[1].inam004 / g_sfaa_m.sfaa012,sfac006 = g_inam[1].inam002 
                WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno AND sfac002 = '2'
                  AND sfacseq = g_sfac_d[l_ac].sfacseq
               UPDATE sfac_t SET sfac003=sfac003 - l_sfac003 * g_inam[1].inam004 / g_sfaa_m.sfaa012 WHERE sfacent = g_enterprise
                  AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno AND sfac002='1'
                  AND sfac006 = g_inam[1].inam002
               FOR l_j = 2 TO g_inam.getLength()
                  IF cl_null(g_inam[l_j].inam001) THEN
                     EXIT FOR
                  END IF
                  LET l_ac = l_ac + 1
                  SELECT MAX(sfacseq)+1 INTO g_sfac_d[l_ac].sfacseq FROM sfac_t 
                   WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno
                  
                  LET g_sfac_d[l_ac].sfac002 = '2' 
                  LET g_sfac_d[l_ac].sfac001 = l_sfac001
                  LET g_sfac_d[l_ac].sfac004 = l_sfac004
                  LET g_sfac_d[l_ac].sfac005 = 0
                  LET g_sfac_d[l_ac].sfac003 = g_inam[l_j].inam004 / g_sfaa_m.sfaa012 * l_sfac003
                  LET g_sfac_d[l_ac].sfac006 = g_inam[l_j].inam002
                  INSERT INTO sfac_t(sfacent,sfacsite,sfacdocno,sfacseq,sfac001,sfac002,sfac003,sfac004,sfac005,sfac006)
                  VALUES(g_enterprise,g_site,g_sfaa_m.sfaadocno,g_sfac_d[l_ac].sfacseq,g_sfac_d[l_ac].sfac001,g_sfac_d[l_ac].sfac002,g_sfac_d[l_ac].sfac003,g_sfac_d[l_ac].sfac004,g_sfac_d[l_ac].sfac005,g_sfac_d[l_ac].sfac006)
                  UPDATE sfac_t SET sfac003=sfac003-g_sfac_d[l_ac].sfac003 WHERE sfacent = g_enterprise
                     AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno AND sfac002='1'
                     AND sfac006 = g_inam[l_j].inam002
               END FOR
            ELSE
               UPDATE sfac_t SET sfac003=sfac003-g_sfac_d[l_ac].sfac003 WHERE sfacent = g_enterprise
                  AND sfacsite = g_site AND sfacdocno= g_sfaa_m.sfaadocno AND sfac002='1'
            END IF                     
         END IF 
         LET l_ac = l_ac + 1
         
         IF l_ac > g_max_rec THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code =  9035
            LET g_errparam.extend =  ''
            LET g_errparam.popup = FALSE
            CALL cl_err()

            EXIT FOREACH
         END IF
      END FOREACH
     #END IF
      
END FUNCTION]]>
  </point>
  <point name="function.asft300_show_sfac_desc" order="43" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[# Descriptions...: 生产料号明细相关资料显示
PRIVATE FUNCTION asft300_show_sfac_desc(p_ac)
DEFINE p_ac        LIKE type_t.num5
DEFINE l_success   LIKE type_t.num5

  SELECT imaal003,imaal004 INTO g_sfac_d[p_ac].sfac001_desc,g_sfac_d[p_ac].sfac001_desc1 FROM imaal_t
   WHERE imaalent = g_enterprise AND imaal001 = g_sfac_d[p_ac].sfac001 AND imaal002 = g_lang
   
  SELECT oocal003 INTO g_sfac_d[p_ac].sfac004_desc FROM oocal_t 
   WHERE oocalent=g_enterprise AND oocal001=g_sfac_d[p_ac].sfac004 AND oocal002=g_lang
   
  CALL s_feature_description(g_sfac_d[p_ac].sfac001,g_sfac_d[p_ac].sfac006)
     RETURNING l_success,g_sfac_d[p_ac].sfac006_desc
  IF NOT l_success THEN
     LET g_sfac_d[p_ac].sfac006_desc = ''
  END IF

  DISPLAY BY NAME g_sfac_d[p_ac].sfac001_desc,g_sfac_d[p_ac].sfac001_desc1,g_sfac_d[p_ac].sfac004_desc
   
END FUNCTION]]>
  </point>
  <point name="function.asft300_chk_sfaa013" order="44" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[# Descriptions...: 单位检查
PRIVATE FUNCTION asft300_chk_sfaa013(p_sfaa013)
   DEFINE p_sfaa013      LIKE sfaa_t.sfaa013
   DEFINE r_success      LIKE type_t.num5
   DEFINE l_imaa006      LIKE imaa_t.imaa006
   DEFINE l_success      LIKE type_t.num5
   DEFINE l_rate         LIKE inaj_t.inaj014

   LET r_success = FALSE

   #1.检查单位资料档
   INITIALIZE g_chkparam.* TO NULL
   LET g_chkparam.arg1 = p_sfaa013
   IF NOT cl_chk_exist("v_ooca001") THEN
      RETURN r_success
   END IF

   #2.检查与基础单位是否有转换率
   SELECT imaa006 INTO l_imaa006 FROM imaa_t
    WHERE imaaent = g_enterprise
      AND imaa001 = g_sfaa_m.sfaa010
   CALL s_aimi190_get_convert(g_sfaa_m.sfaa010,p_sfaa013,l_imaa006)
        RETURNING l_success,l_rate
   IF NOT l_success THEN
      RETURN r_success
   END IF
   
   #3.检查是否存在于料件允许使用单位里。
   INITIALIZE g_chkparam.* TO NULL
   LET g_chkparam.arg1 = g_sfaa_m.sfaa010
   LET g_chkparam.arg2 = p_sfaa013

   #呼叫檢查存在並帶值的library
   IF NOT cl_chk_exist("v_imao002") THEN
      RETURN r_success
   END IF

   LET r_success = TRUE
   RETURN r_success

END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa028_desc" order="45" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_sfaa028_desc(p_sfaa028)
DEFINE p_sfaa028   LIKE sfaa_t.sfaa028
   IF cl_null(p_sfaa028) THEN
      RETURN
   END IF 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = p_sfaa028
   CALL ap_ref_array2(g_ref_fields,"SELECT pjbal003 FROM pjbal_t WHERE pjbalent='"||g_enterprise||"' AND pjbal001=? AND pjbal002='"||g_lang||"'","") RETURNING g_rtn_fields
   LET g_sfaa_m.sfaa028_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_sfaa_m.sfaa028_desc
END FUNCTION]]>
  </point>
  <point name="function.asft300_chk_warehouses" order="46" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[# Descriptions...: 检查仓库sfaa034、库位sfaa035的正确性
PRIVATE FUNCTION asft300_chk_warehouses()
   DEFINE r_success      LIKE type_t.num5

   LET r_success = FALSE

   #1.检查库位基础档
   IF NOT cl_null(g_sfaa_m.sfaa034) THEN
      INITIALIZE g_chkparam.* TO NULL
      LET g_chkparam.arg1 = g_sfaa_m.sfaa034
      IF NOT cl_chk_exist("v_inaa001_2") THEN
         RETURN r_success
      END IF
   END IF

   #2.检查储位
   IF NOT cl_null(g_sfaa_m.sfaa034) AND g_sfaa_m.sfaa035 IS NOT NULL THEN
      INITIALIZE g_chkparam.* TO NULL
      LET g_chkparam.arg1 = g_site
      LET g_chkparam.arg2 = g_sfaa_m.sfaa034
      LET g_chkparam.arg3 = g_sfaa_m.sfaa035
      IF NOT cl_chk_exist("v_inab002") THEN
         RETURN r_success
      END IF
   END IF
   
   LET r_success = TRUE
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa029_desc" order="47" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION asft300_sfaa029_desc(p_sfaa028,p_sfaa029)
DEFINE p_sfaa028   LIKE sfaa_t.sfaa028
DEFINE p_sfaa029   LIKE sfaa_t.sfaa029
   INITIALIZE g_ref_fields TO NULL
   IF cl_null(p_sfaa028) OR cl_null(p_sfaa029) THEN
      RETURN
   END IF
   LET g_ref_fields[1] = p_sfaa028
   LET g_ref_fields[2] = p_sfaa029
   CALL ap_ref_array2(g_ref_fields,"SELECT pjbbl004 FROM pjbbl_t WHERE pjbblent='"||g_enterprise||"' AND pjbbl001=? AND pjbbl002=? AND pjbbl003='"||g_lang||"'","") RETURNING g_rtn_fields
   LET g_sfaa_m.sfaa029_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_sfaa_m.sfaa029_desc
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfbaseq" order="48" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#sfbaseq栏位检查
#同项次的部位+作业编号+制程序+BOM料号为相同,不同项次不可以有同样的部位+作业编号+制程序+BOM料号
PRIVATE FUNCTION asft300_sfbaseq(p_cmd)
DEFINE p_cmd     LIKE type_t.chr1
DEFINE l_n       LIKE type_t.num5
DEFINE l_n1      LIKE type_t.num5

  IF cl_null(g_sfba_d[g_detail_idx].sfbaseq) THEN
     RETURN TRUE
  END IF 
  IF g_sfba_d[g_detail_idx].sfba002 IS NULL THEN
     RETURN TRUE
  END IF 
  IF g_sfba_d[g_detail_idx].sfba003 IS NULL THEN
     RETURN TRUE
  END IF
  IF g_sfba_d[g_detail_idx].sfba004 IS NULL THEN
     RETURN TRUE
  END IF
  IF g_sfba_d[g_detail_idx].sfba005 IS NULL THEN
     RETURN TRUE
  END IF
  SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno
     AND sfbaseq = g_sfba_d[g_detail_idx].sfbaseq
  IF (l_n > 1 AND p_cmd = 'u') OR (l_n > 0 AND p_cmd = 'a') THEN
     SELECT COUNT(*) INTO l_n1 FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno
        AND sfbaseq = g_sfba_d[g_detail_idx].sfbaseq AND sfba002 = g_sfba_d[g_detail_idx].sfba002 AND sfba003 = g_sfba_d[g_detail_idx].sfba003
        AND sfba004 = g_sfba_d[g_detail_idx].sfba004 AND sfba005 = g_sfba_d[g_detail_idx].sfba005
     IF l_n1 = 0 THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = 'asf-00070'
        LET g_errparam.extend = ''
        LET g_errparam.popup = TRUE
        CALL cl_err()

        RETURN FALSE
     END IF
  ELSE
     SELECT COUNT(*) INTO l_n1 FROM sfba_t WHERE sfbaent = g_enterprise AND sfbasite = g_site AND sfbadocno = g_sfaa_m.sfaadocno
        AND sfba002 = g_sfba_d[g_detail_idx].sfba002 AND sfba003 = g_sfba_d[g_detail_idx].sfba003
        AND sfba004 = g_sfba_d[g_detail_idx].sfba004 AND sfba005 = g_sfba_d[g_detail_idx].sfba005
     IF l_n1 > 0 THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = 'asf-00070'
        LET g_errparam.extend = ''
        LET g_errparam.popup = TRUE
        CALL cl_err()

        RETURN FALSE
     END IF
  END IF
  RETURN TRUE
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa010" order="49" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[# Descriptions...: 料号相关校验及逻辑处理
PRIVATE FUNCTION asft300_sfaa010()
DEFINE  r_success      LIKE type_t.num5
DEFINE  l_n            LIKE type_t.num5
DEFINE  l_sql          STRING
DEFINE  l_imaa010      LIKE imaa_t.imaa010
DEFINE  l_oocq005      LIKE oocq_t.oocq005
DEFINE  l_oocq006      LIKE oocq_t.oocq006
DEFINE  l_imaf012      LIKE imaf_t.imaf012
DEFINE  l_success      LIKE type_t.num5
DEFINE  l_flag         LIKE type_t.num5

   LET r_success = TRUE
   #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
   INITIALIZE g_chkparam.* TO NULL
   LET g_chkparam.arg1 = g_sfaa_m.sfaa010 
   #呼叫檢查存在並帶值的library
   IF cl_chk_exist("v_imaa001") THEN
      IF NOT cl_chk_exist("v_imaf001_1") THEN
         LET r_success = FALSE
         RETURN r_success
      END IF
   ELSE
      LET r_success = FALSE
      RETURN r_success
   END IF
   
   #判斷輸入的料件編號是否在控制組限制的產品範圍內，若不在限制內則不允許請購此料
   CALL s_control_chk_group('3','6',g_user,g_dept,g_sfaa_m.sfaa010,'','','','') RETURNING l_success,l_flag
   IF NOT l_success THEN      #处理状态
      LET r_success = FALSE
      RETURN r_success
   ELSE
      IF NOT l_flag THEN      #是否存在
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'asf-00324'
         LET g_errparam.extend = g_sfaa_m.sfaa010
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF

   #檢核輸入的料件的生命週期是否在單據別限制範圍內，若不在限制內則不允許請購此料
   CALL s_control_chk_doc('4',g_sfaa_m.sfaadocno,g_sfaa_m.sfaa010,'','','','') RETURNING l_success,l_flag
   IF NOT l_success THEN      #处理状态
      LET r_success = FALSE
      RETURN r_success
   ELSE
      IF NOT l_flag THEN      #是否存在
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   #檢核輸入的料件的產品分類是否在單據別限制範圍內，若不在限制內則不允許請購此料
   CALL s_control_chk_doc('5',g_sfaa_m.sfaadocno,g_sfaa_m.sfaa010,'','','','') RETURNING l_success,l_flag
   IF NOT l_success THEN      #处理状态
      LET r_success = FALSE
      RETURN r_success
   ELSE
      IF NOT l_flag THEN      #是否存在
         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   IF g_sfaa_m.sfaa003 MATCHES '[145]' THEN
      LET l_sql = "SELECT COUNT(bmaa001) FROM bmaa_t WHERE bmaaent='",g_enterprise,"' AND bmaasite='",g_site,"'",
                  "   AND bmaa001='", g_sfaa_m.sfaa010,"' AND bmaastus='Y'"
      IF NOT cl_null(g_sfaa_m.sfaa011) THEN
         LET l_sql = l_sql," AND bmaa002='",g_sfaa_m.sfaa011,"'"
      END IF
      PREPARE sel_bmaa_pre FROM l_sql
      EXECUTE sel_bmaa_pre INTO l_n
      IF l_n = 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'asf-00045'
         LET g_errparam.extend = g_sfaa_m.sfaa010
         LET g_errparam.popup = TRUE
         CALL cl_err()

         LET r_success = FALSE
         RETURN r_success
      END IF
   END IF
   
   SELECT imaa010 INTO l_imaa010 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfaa_m.sfaa010
   IF NOT cl_null(l_imaa010) THEN
      SELECT oocq005,oocq006 INTO l_oocq005,l_oocq006 FROM oocq_t WHERE oocqent = g_enterprise 
         AND oocq001 = '210' AND oocq002 = l_imaa010 AND oocqstus = 'Y'
      IF g_sfaa_m.sfaa003 = '4' THEN
         IF l_oocq005 != 'Y' THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'asf-00052'
            LET g_errparam.extend = g_sfaa_m.sfaa010
            LET g_errparam.popup = TRUE
            CALL cl_err()

            LET r_success = FALSE
            RETURN r_success
         END IF
      ELSE
         IF l_oocq006 != 'Y' THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'asf-00053'
            LET g_errparam.extend = g_sfaa_m.sfaa010
            LET g_errparam.popup = TRUE
            CALL cl_err()

            LET r_success = FALSE
            RETURN r_success
         END IF
      END IF 
   END IF 
   
   IF cl_get_doc_para(g_enterprise,g_site,g_sfaa_m.sfaadocno,'D-MFG-0065') = 'Y' AND g_sfaa_m.sfaa003 = '1' THEN   #add g_sfaa_m.sfaa003 = '1'
      SELECT imaf012 INTO l_imaf012 FROM imaf_t WHERE imafent = g_enterprise AND imafsite = g_site AND imaf001 = g_sfaa_m.sfaa010
      CASE 
         WHEN l_imaf012 = '1' 
           IF g_sfaa_m.sfaa005 != '2' THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'asf-00054'
              LET g_errparam.extend = g_sfaa_m.sfaa010
              LET g_errparam.popup = TRUE
              CALL cl_err()

              LET r_success = FALSE
              RETURN r_success
           END IF
         WHEN l_imaf012 = '2' 
           IF g_sfaa_m.sfaa005 != '3' THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'asf-00055'
              LET g_errparam.extend = g_sfaa_m.sfaa010
              LET g_errparam.popup = TRUE
              CALL cl_err()

              LET r_success = FALSE
              RETURN r_success
           END IF
         WHEN l_imaf012 = '3' OR l_imaf012 = '4' 
           IF g_sfaa_m.sfaa005 = '2' THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'asf-00056'
              LET g_errparam.extend = g_sfaa_m.sfaa010
              LET g_errparam.popup = TRUE
              CALL cl_err()

              LET r_success = FALSE
              RETURN r_success
           END IF
         OTHERWISE 
           EXIT CASE
      END CASE
   END IF    
   
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.asft300_b_desc" order="50" ver="7" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 單身參考欄位說明帶值
PRIVATE FUNCTION asft300_b_desc()
DEFINE  l_success        LIKE type_t.num5
DEFINE  l_sql            STRING
DEFINE  l_inag           RECORD LIKE inag_t.*
DEFINE  l_sfba013        LIKE sfba_t.sfba013
DEFINE  l_sfba014        LIKE sfba_t.sfba014
DEFINE  l_sfba015        LIKE sfba_t.sfba015
DEFINE  l_sfba016        LIKE sfba_t.sfba016
DEFINE  l_rate           LIKE inaj_t.inaj014
DEFINE  l_inag008        LIKE inag_t.inag008
DEFINE  l_qty            LIKE sfba_t.sfba013
DEFINE  l_qty1           LIKE sfba_t.sfba013

            INITIALIZE g_chkparam.* TO NULL
            LET g_chkparam.arg1 = '215'
            LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba002
            CALL cl_ref_val("v_oocql002")
            LET g_sfba_d[l_ac].sfba002_desc = g_chkparam.return1
            DISPLAY BY NAME g_sfba_d[l_ac].sfba002_desc

            #部位说明
            INITIALIZE g_chkparam.* TO NULL
            LET g_chkparam.arg1 = '221'
            LET g_chkparam.arg2 = g_sfba_d[l_ac].sfba003
            CALL cl_ref_val("v_oocql002")
            LET g_sfba_d[l_ac].sfba003_desc = g_chkparam.return1
            DISPLAY BY NAME g_sfba_d[l_ac].sfba003_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba005
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba005_desc = '', g_rtn_fields[1] , ''
            LET g_sfba_d[l_ac].sfba005_desc1 = '', g_rtn_fields[2] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba005_desc
            DISPLAY BY NAME g_sfba_d[l_ac].sfba005_desc1 
            
            #取替代建议
            CALL s_abmm201_get_proposal(g_site,g_sfba_d[l_ac].sfba001,g_sfaa_m.sfaa011,g_sfba_d[l_ac].sfba005,g_sfba_d[l_ac].sfba002,g_sfba_d[l_ac].sfba003,g_sfba_d[l_ac].sfba004) RETURNING g_sfba_d[l_ac].replace
     

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba006
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba006_desc = '', g_rtn_fields[1] , ''
            LET g_sfba_d[l_ac].sfba006_desc_desc = '', g_rtn_fields[2] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba006_desc
            DISPLAY BY NAME g_sfba_d[l_ac].sfba006_desc_desc
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba006
            CALL ap_ref_array2(g_ref_fields,"SELECT imaf013 FROM imaf_t WHERE imafent='"||g_enterprise||"' AND imaf001=? AND imafsite='"||g_site||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].imaf013 = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].imaf013
            
            CALL s_feature_description(g_sfba_d[l_ac].sfba006,g_sfba_d[l_ac].sfba021)
                 RETURNING l_success,g_sfba_d[l_ac].sfba021_desc
            IF NOT l_success THEN
               LET g_sfba_d[l_ac].sfba021_desc = ''
            END IF
      
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba014
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba014_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba014_desc

            IF NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[l_ac].sfbaseq) AND NOT cl_null(g_sfba_d[l_ac].sfbaseq1) THEN
               CALL s_asft300_07(g_sfaa_m.sfaadocno,g_sfba_d[l_ac].sfbaseq,g_sfba_d[l_ac].sfbaseq1) RETURNING l_success,g_sfba_d[l_ac].number2
            END IF 
            IF cl_null(g_sfba_d[l_ac].sfba013) THEN 
               LET g_sfba_d[l_ac].sfba013 = 0
            END IF
            IF cl_null(g_sfba_d[l_ac].sfba016) THEN 
               LET g_sfba_d[l_ac].sfba016 = 0
            END IF 
            LET g_sfba_d[l_ac].number1 = g_sfba_d[l_ac].sfba013 - g_sfba_d[l_ac].sfba015 - g_sfba_d[l_ac].sfba016
            IF g_sfba_d[l_ac].number1 < 0 THEN
               LET g_sfba_d[l_ac].number1 = 0
            END IF 

            LET g_sfba_d[l_ac].sfba019_desc = s_desc_get_stock_desc(g_site,g_sfba_d[l_ac].sfba019)
            DISPLAY BY NAME g_sfba_d[l_ac].sfba019_desc      
             
             LET g_sfba_d[l_ac].sfba020_desc = s_desc_get_locator_desc(g_site,g_sfba_d[l_ac].sfba019,g_sfba_d[l_ac].sfba020)
            DISPLAY BY NAME g_sfba_d[l_ac].sfba020_desc    

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_sfba_d[l_ac].sfba001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_sfba_d[l_ac].sfba001_desc = '', g_rtn_fields[1] , ''
            LET g_sfba_d[l_ac].sfba001_desc1 = '', g_rtn_fields[2] , ''
            DISPLAY BY NAME g_sfba_d[l_ac].sfba001_desc
            DISPLAY BY NAME g_sfba_d[l_ac].sfba001_desc1
            
            IF NOT cl_null(g_sfaa_m.sfaadocno) AND NOT cl_null(g_sfba_d[l_ac].sfbaseq) AND NOT cl_null(g_sfba_d[l_ac].sfbaseq1) THEN
               CALL s_aooi360_sel('7',g_sfaa_m.sfaadocno,g_sfba_d[l_ac].sfbaseq,g_sfba_d[l_ac].sfbaseq1,'','','','','','','','2')
                    RETURNING l_success,g_sfba_d[l_ac].sfba_ooff013   
            END IF
            
            #对应发料料号库存可用量
            LET l_sql = "SELECT * FROM inag_t WHERE inagent = ",g_enterprise," AND inagsite = '",g_site,"'",
                        "   AND inag001 = '",g_sfba_d[l_ac].sfba006,"' AND inag010 = 'Y'"
            IF NOT cl_null(g_sfba_d[l_ac].sfba021) THEN
               LET l_sql = l_sql," AND inag002 = '",g_sfba_d[l_ac].sfba021,"'"
            END IF
            IF NOT cl_null(g_sfba_d[l_ac].sfba030) THEN
               LET l_sql = l_sql," AND inag003 = '",g_sfba_d[l_ac].sfba030,"'"
            END IF            
            IF NOT cl_null(g_sfba_d[l_ac].sfba019) THEN
               LET l_sql = l_sql," AND inag004 = '",g_sfba_d[l_ac].sfba019,"'"
            END IF
            IF NOT cl_null(g_sfba_d[l_ac].sfba020) THEN
               LET l_sql = l_sql," AND inag005 = '",g_sfba_d[l_ac].sfba020,"'"
            END IF
            IF NOT cl_null(g_sfba_d[l_ac].sfba029) THEN
               LET l_sql = l_sql," AND inag006 = '",g_sfba_d[l_ac].sfba029,"'"
            END IF
            LET g_sfba_d[l_ac].number3 = 0
            PREPARE asft300_b_desc_pre1 FROM l_sql
            DECLARE asft300_b_desc_cur1 CURSOR FOR asft300_b_desc_pre1
            FOREACH asft300_b_desc_cur1 INTO l_inag.*
              #CALL s_aimi190_get_convert(g_sfba_d[l_ac].sfba006,l_inag.inag007,g_sfba_d[l_ac].sfba014) RETURNING l_success,l_rate
              #IF cl_null(l_rate) THEN
              #   LET l_rate = 1
              #END IF
              #
               CALL s_aooi250_convert_qty(g_sfba_d[l_ac].sfba006,l_inag.inag007,g_sfba_d[l_ac].sfba014,l_inag.inag008)
                    RETURNING l_success,l_inag008
               IF l_success THEN
                  LET l_inag008 = l_inag.inag008
               END IF
               IF cl_null(l_inag008) THEN
                 LET l_inag008 = 0 
               END IF
               LET g_sfba_d[l_ac].number3 = g_sfba_d[l_ac].number3 + l_inag008
            END FOREACH
            
            #已开工单未发数量
            LET l_sql = "SELECT sfba013,sfba014,sfba015,sfba016 FROM sfaa_t,sfba_t",
                        " WHERE sfaaent = sfbaent AND sfaadocno = sfbadocno AND sfaastus NOT IN('X','C','M') ",
                        "   AND sfbaent = ",g_enterprise," AND sfbasite = '",g_site,"'",
                        "   AND sfba006 = '",g_sfba_d[l_ac].sfba006,"'"
            IF NOT cl_null(g_sfba_d[l_ac].sfba021) THEN
               LET l_sql = l_sql," AND sfba021 = '",g_sfba_d[l_ac].sfba021,"'"
            END IF
            LET g_sfba_d[l_ac].number4 = 0
            PREPARE asft300_b_desc_pre2 FROM l_sql
            DECLARE asft300_b_desc_cur2 CURSOR FOR asft300_b_desc_pre2
            FOREACH asft300_b_desc_cur2 INTO l_sfba013,l_sfba014,l_sfba015,l_sfba016
             # CALL s_aimi190_get_convert(g_sfba_d[l_ac].sfba006,l_sfba014,g_sfba_d[l_ac].sfba014) RETURNING l_success,l_rate
             # IF cl_null(l_rate) THEN
             #    LET l_rate = 1
             # END IF
               IF cl_null(l_sfba013) THEN
                  LET l_sfba013 = 0
               END IF
               IF cl_null(l_sfba015) THEN
                  LET l_sfba015 = 0
               END IF
               IF cl_null(l_sfba016) THEN
                  LET l_sfba016 = 0
               END IF
              #LET g_sfba_d[l_ac].number4 = g_sfba_d[l_ac].number4 + (l_sfba013 - l_sfba015 - l_sfba016) * l_rate
               LET l_qty = l_sfba013 - l_sfba015 - l_sfba016
               CALL s_aooi250_convert_qty(g_sfba_d[l_ac].sfba006,l_sfba014,g_sfba_d[l_ac].sfba014,l_qty)
                    RETURNING l_success,l_qty1
               IF NOT l_success THEN
                  LET l_qty1 = l_qty
               END IF
               LET g_sfba_d[l_ac].number4 = g_sfba_d[l_ac].number4 + l_qty1
            END FOREACH
            
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfba006_desc" order="51" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: sfba006帶值
PRIVATE FUNCTION asft300_sfba006_desc()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_sfba_d[l_ac].sfba006
   CALL ap_ref_array2(g_ref_fields,"SELECT imaal003,imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_sfba_d[l_ac].sfba006_desc = '', g_rtn_fields[1] , ''
   LET g_sfba_d[l_ac].sfba006_desc_desc = '', g_rtn_fields[2] , ''
   DISPLAY BY NAME g_sfba_d[l_ac].sfba006_desc
   DISPLAY BY NAME g_sfba_d[l_ac].sfba006_desc_desc
   IF NOT cl_null(g_sfba_d[g_detail_idx].sfba006) THEN
      SELECT imaf013 INTO g_sfba_d[g_detail_idx].imaf013 FROM imaf_t
       WHERE imafent = g_enterprise
         AND imafsite = g_site
         AND imaf001 = g_sfba_d[g_detail_idx].sfba006
       DISPLAY BY NAME g_sfba_d[g_detail_idx].imaf013
      SELECT imae081 INTO g_sfba_d[g_detail_idx].sfba014 FROM imae_t
       WHERE imaeent = g_enterprise
         AND imaesite = g_site
         AND imae001 = g_sfba_d[g_detail_idx].sfba006
      DISPLAY BY NAME g_sfba_d[g_detail_idx].sfba014               
   END IF 
END FUNCTION]]>
  </point>
  <point name="function.asft300_del_allotment" order="52" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 删除备料
# Memo...........:
# Usage..........: CALL asft300_del_allotment(p_flag)
# Date & Author..: 14/2/11 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION asft300_del_allotment(p_flag)
DEFINE p_flag      LIKE type_t.chr1
DEFINE l_n         LIKE type_t.num5
   SELECT COUNT(*) INTO l_n FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
   IF l_n = 0 THEN
      RETURN
   END IF
   CALL s_transaction_begin()
   DELETE FROM sfba_t WHERE sfbaent=g_enterprise AND sfbasite=g_site AND sfbadocno=g_sfaa_m.sfaadocno
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = "DELETE sfba_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CALL s_transaction_end('N','0')
   ELSE
      UPDATE sfaa_t SET sfaa039 = 'N' WHERE sfaaent=g_enterprise AND sfaasite=g_site AND sfaadocno=g_sfaa_m.sfaadocno
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = SQLCA.sqlcode
         LET g_errparam.extend = "UPDATE sfaa_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         CALL s_transaction_end('N','0')
      ELSE
         CALL s_transaction_end('Y','0')
         IF p_flag = 'Y' THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'asf-00167'
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
         END IF
      END IF
   END IF
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa058" order="53" ver="7" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#参考数量预设
PRIVATE FUNCTION asft300_sfaa058(p_sfaa010,p_sfaa012,p_sfaa013,p_sfaa060)
DEFINE p_sfaa010                 LIKE sfaa_t.sfaa010
DEFINE p_sfaa012                 LIKE sfaa_t.sfaa012
DEFINE p_sfaa013                 LIKE sfaa_t.sfaa013
DEFINE p_sfaa060                 LIKE sfaa_t.sfaa060
DEFINE l_success                 LIKE type_t.num5
DEFINE l_rate                    LIKE inaj_t.inaj014

   IF cl_null(p_sfaa012) OR cl_null(p_sfaa013) OR cl_null(p_sfaa060) THEN
      RETURN
   END IF
  #CALL s_aimi190_get_convert(p_sfaa010,p_sfaa013,p_sfaa060) RETURNING l_success,l_rate
  #IF l_success THEN
  #   LET g_sfaa_m.sfaa058 = p_sfaa012 * l_rate
  #ELSE
  #   LET g_sfaa_m.sfaa058 = p_sfaa012
  #END IF
   CALL s_aooi250_convert_qty(p_sfaa010,p_sfaa013,p_sfaa060,p_sfaa012) RETURNING l_success,g_sfaa_m.sfaa058
   IF NOT l_success THEN
      LET g_sfaa_m.sfaa058 = p_sfaa012
   END IF
   #单位取位
   CALL s_aooi250_take_decimals(p_sfaa060,g_sfaa_m.sfaa058)
        RETURNING l_success,g_sfaa_m.sfaa058
   DISPLAY BY NAME g_sfaa_m.sfaa058
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa006_chk" order="54" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#来源单号项次项序检查及带值
PRIVATE FUNCTION asft300_sfaa006_chk()
DEFINE p_cmd         LIKE type_t.chr1
DEFINE l_sql         STRING
DEFINE l_sql1        STRING
DEFINE l_sql2        STRING
DEFINE l_n           LIKE type_t.num5
DEFINE l_xmda004     LIKE xmda_t.xmda004
DEFINE l_xmda007     LIKE xmda_t.xmda007
DEFINE l_xmda008     LIKE xmda_t.xmda008
DEFINE l_xmdd        RECORD LIKE xmdd_t.*
DEFINE l_success     LIKE type_t.num5
DEFINE l_rate        LIKE type_t.num5
DEFINE l_imae032     LIKE imae_t.imae032
DEFINE l_sum         LIKE sfaa_t.sfaa012
DEFINE l_num         LIKE sfaa_t.sfaa012
DEFINE l_num1        LIKE sfaa_t.sfaa012
DEFINE l_xmdddocno   LIKE xmdd_t.xmdddocno
DEFINE l_xmddseq     LIKE xmdd_t.xmddseq
DEFINE l_xmddseq1    LIKE xmdd_t.xmddseq1
DEFINE l_xmddseq2    LIKE xmdd_t.xmddseq2
DEFINE l_days        LIKE type_t.num5
DEFINE l_ooef008     LIKE ooef_t.ooef008
DEFINE l_sfaa007     STRING
DEFINE l_sfaa008     STRING
DEFINE l_sfaa063     STRING

  #當等於訂單、計畫等，檢查是否存在來源資料裡
  IF NOT cl_null(g_sfaa_m.sfaa006) THEN
     #订单
     IF g_sfaa_m.sfaa005 = '2' THEN
        LET l_sql1 = "SELECT COUNT(*) "
        LET l_sql2 = "SELECT xmddseq,xmddseq1,xmddseq2 "
        LET l_sql = " FROM xmda_t,xmdd_t WHERE xmdaent=xmddent AND xmdadocno=xmdddocno ",
                    "   AND xmddent='",g_enterprise,"' AND xmddsite='",g_site,"'",
                    "   AND xmdddocno='",g_sfaa_m.sfaa006,"' AND xmdastus='Y'"
        IF NOT cl_null(g_sfaa_m.sfaa007) THEN
           LET l_sql = l_sql," AND xmddseq=", g_sfaa_m.sfaa007
        END IF
        IF NOT cl_null(g_sfaa_m.sfaa008) THEN
           LET l_sql = l_sql," AND xmddseq1=", g_sfaa_m.sfaa008
        END IF
        IF NOT cl_null(g_sfaa_m.sfaa063) THEN
           LET l_sql = l_sql," AND xmddseq2=", g_sfaa_m.sfaa063
        END IF
        LET l_sql1 = l_sql1,l_sql        
        PREPARE asft300_sfaa006_pre1 FROM l_sql1
        EXECUTE asft300_sfaa006_pre1 INTO l_n
        
        IF l_n = 0 THEN
           INITIALIZE g_errparam TO NULL
           LET g_errparam.code = 'asf-00154'
           LET g_errparam.extend = g_sfaa_m.sfaa006
           LET g_errparam.popup = TRUE
           CALL cl_err()

           RETURN FALSE
        END IF
        
        IF l_n = 1 THEN
           LET l_sql2 = l_sql2,l_sql
           PREPARE asft300_sfaa006_pre2 FROM l_sql2
           EXECUTE asft300_sfaa006_pre2 INTO g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063
        ELSE
           #开窗选择
           INITIALIZE g_qryparam.* TO NULL
           LET g_qryparam.state = 'i'
			  LET g_qryparam.reqry = FALSE
           LET g_qryparam.where = " xmdddocno = '",g_sfaa_m.sfaa006,"'"
           IF NOT cl_null(g_sfaa_m.sfaa007) THEN
              LET g_qryparam.where = g_qryparam.where," AND xmddseq = ",g_sfaa_m.sfaa007
           END IF
           IF NOT cl_null(g_sfaa_m.sfaa008) THEN
              LET g_qryparam.where = g_qryparam.where," AND xmddseq1 = ",g_sfaa_m.sfaa008
           END IF
           IF NOT cl_null(g_sfaa_m.sfaa063) THEN
              LET g_qryparam.where = g_qryparam.where," AND xmddseq2 = ",g_sfaa_m.sfaa063
           END IF
           CALL q_xmdddocno()                                #呼叫開窗        
           LET g_sfaa_m.sfaa006 = g_qryparam.return1              #將開窗取得的值回傳到變數
           LET g_sfaa_m.sfaa007 = g_qryparam.return2
           LET g_sfaa_m.sfaa008 = g_qryparam.return3
           LET g_sfaa_m.sfaa063 = g_qryparam.return4
        END IF   
        LET l_sfaa007 = g_sfaa_m.sfaa007
        LET l_sfaa008 = g_sfaa_m.sfaa008
        LET l_sfaa063 = g_sfaa_m.sfaa063
        LET g_sfaa_m.l_sfaa007 = l_sfaa007 CLIPPED,"-",l_sfaa008 CLIPPED,"-",l_sfaa063 CLIPPED
        DISPLAY BY NAME g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.l_sfaa007
     END IF
  ELSE
     RETURN FALSE
  END IF

  #带值
  IF g_sfaa_m.sfaa005 ='2' THEN
     IF NOT cl_null(g_sfaa_m.sfaa006) AND NOT cl_null(g_sfaa_m.sfaa007) AND NOT cl_null(g_sfaa_m.sfaa008) AND NOT cl_null(g_sfaa_m.sfaa063) THEN
        SELECT xmda004,xmda007,xmda008,xmdd_t.* INTO l_xmda004,l_xmda007,l_xmda008,l_xmdd.* FROM xmda_t,xmdd_t 
         WHERE xmdaent=xmddent AND xmdadocno=xmdddocno
           AND xmddent=g_enterprise AND xmddsite=g_site
           AND xmdddocno=g_sfaa_m.sfaa006 AND xmddseq=g_sfaa_m.sfaa007
           AND xmddseq1=g_sfaa_m.sfaa008 AND xmddseq2=g_sfaa_m.sfaa063
                 
        LET g_sfaa_m.sfaa010=l_xmdd.xmdd001
        SELECT imae037 INTO g_sfaa_m.sfaa011 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
        IF cl_null(g_sfaa_m.sfaa011) THEN
           LET g_sfaa_m.sfaa011 = ' '
        END IF
        #订单对应的料号应chk
        IF NOT asft300_sfaa010() THEN
           IF p_cmd = 'a' THEN
              LET g_sfaa_m.sfaa010 = g_sfaa_m_t.sfaa010
              LET g_sfaa_m.sfaa011 = g_sfaa_m_t.sfaa011
           END IF
           RETURN FALSE
        END IF
        
        LET g_sfaa_m.sfaa012=l_xmdd.xmdd006
        LET g_sfaa_m.sfaa013=l_xmdd.xmdd004        
        
        #已开工单量计算
        CALL asft300_sfaa006_chk_qty(g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa013) RETURNING l_sum
            
        LET g_sfaa_m.sfaa012 = g_sfaa_m.sfaa012 - l_sum
        IF g_sfaa_m.sfaa012 <= 0 THEN
           INITIALIZE g_errparam TO NULL
           LET g_errparam.code = 'asf-00336'
           LET g_errparam.extend = ''
           LET g_errparam.popup = TRUE
           CALL cl_err()

           IF p_cmd = 'a' THEN
              LET g_sfaa_m.sfaa010 = g_sfaa_m_t.sfaa010
              LET g_sfaa_m.sfaa011 = g_sfaa_m_t.sfaa011
              LET g_sfaa_m.sfaa012 = g_sfaa_m_t.sfaa012
              LET g_sfaa_m.sfaa013 = g_sfaa_m_t.sfaa013
           END IF
           RETURN FALSE
        END IF
        
        #预先订单对应已开工单数量也纳入计算
        IF l_xmda007 = '2' AND NOT cl_null(l_xmda008) THEN
           LET l_sql = "SELECT xmdddocno,xmddseq,xmddseq1,xmddseq2 FROM xmdd_t,xmda_t WHERE xmdaent=xmddent AND xmdasite=xmddsite AND xmdadocno=xmdddocno",
                      "   AND xmddent=",g_enterprise," AND xmddsite='",g_site,"' AND xmdadocno='",l_xmda008,"'",
                      "   AND xmdd001='",g_sfaa_m.sfaa010,"' AND xmdastus='Y'"
           PREPARE asft300_01_pre_1 FROM l_sql
           DECLARE asft300_01_cs_1 CURSOR FOR asft300_01_pre_1
           LET l_num = 0
           FOREACH asft300_01_cs_1 INTO l_xmdddocno,l_xmddseq,l_xmddseq1,l_xmddseq2
              IF SQLCA.sqlcode THEN
                 INITIALIZE g_errparam TO NULL
                 LET g_errparam.code = SQLCA.sqlcode
                 LET g_errparam.extend = "FOREACH:"
                 LET g_errparam.popup = TRUE
                 CALL cl_err()

                 EXIT FOREACH
              END IF
              CALL asft300_sfaa006_chk_qty(l_xmdddocno,l_xmddseq,l_xmddseq1,l_xmddseq2,g_sfaa_m.sfaa013) RETURNING l_num1
              LET l_num = l_num + l_num1
           END FOREACH
           LET g_sfaa_m.sfaa012 = g_sfaa_m.sfaa012 - l_num
           IF g_sfaa_m.sfaa012 <= 0 THEN
              INITIALIZE g_errparam TO NULL
           LET g_errparam.code = 'asf-00336'
           LET g_errparam.extend = ''
           LET g_errparam.popup = TRUE
           CALL cl_err()

              IF p_cmd = 'a' THEN
                 LET g_sfaa_m.sfaa010 = g_sfaa_m_t.sfaa010
                 LET g_sfaa_m.sfaa011 = g_sfaa_m_t.sfaa011
                 LET g_sfaa_m.sfaa012 = g_sfaa_m_t.sfaa012
                 LET g_sfaa_m.sfaa013 = g_sfaa_m_t.sfaa013
              END IF
              RETURN FALSE
           END IF
        END IF        

        LET g_sfaa_m.sfaa009=l_xmda004        
        LET g_sfaa_m.sfaa058=l_xmdd.xmdd025
        LET g_sfaa_m.sfaa060=l_xmdd.xmdd024
        LET g_sfaa_m.sfaa020=l_xmdd.xmdd011 
        #重算参考数量
        IF l_sum > 0 OR l_num > 0 THEN
          #CALL s_aimi190_get_convert(g_sfaa_m.sfaa010,g_sfaa_m.sfaa013,g_sfaa_m.sfaa060) RETURNING l_success,l_rate
          #IF l_success THEN
          #   LET g_sfaa_m.sfaa058 = g_sfaa_m.sfaa012 * l_rate
          #END IF
           CALL s_aooi250_convert_qty(g_sfaa_m.sfaa010,g_sfaa_m.sfaa013,g_sfaa_m.sfaa060,g_sfaa_m.sfaa012)
                RETURNING l_success,g_sfaa_m.sfaa058
           IF NOT l_success THEN
              LET g_sfaa_m.sfaa058 = g_sfaa_m.sfaa012
           END IF
        END IF
         
        IF NOT cl_null(g_sfaa_m.sfaa010) AND NOT cl_null(g_sfaa_m.sfaa012) THEN
           IF NOT cl_null(g_sfaa_m.sfaa020) THEN
              CALL s_asft300_06('2',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa020) RETURNING l_success,g_sfaa_m.sfaa019
              IF g_sfaa_m.sfaa019 < g_sfaa_m.sfaadocdt THEN
                 LET l_days = g_sfaa_m.sfaadocdt - g_sfaa_m.sfaa019
                 LET g_sfaa_m.sfaa019 = g_sfaa_m.sfaadocdt        
                 #根据当前营运据点g_site抓取aooi120中设置的行事历参照表号
                 SELECT ooef008 INTO l_ooef008 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001=g_site
                 CALL s_date_get_work_date(g_site,l_ooef008,'2',g_sfaa_m.sfaa020,0,l_days) RETURNING g_sfaa_m.sfaa020 
              END IF
           ELSE
              IF NOT cl_null(g_sfaa_m.sfaa019) THEN
                 CALL s_asft300_06('1',g_sfaa_m.sfaa010,g_sfaa_m.sfaa012,g_sfaa_m.sfaa019) RETURNING l_success,g_sfaa_m.sfaa020
              END IF
           END IF
        END IF
        LET g_sfaa_m_t.sfaa006=g_sfaa_m.sfaa006
        LET g_sfaa_m_t.sfaa007=g_sfaa_m.sfaa007
        LET g_sfaa_m_t.sfaa008=g_sfaa_m.sfaa008
        LET g_sfaa_m_t.sfaa063=g_sfaa_m.sfaa063
        LET g_sfaa_m_t.sfaa010=g_sfaa_m.sfaa010
        LET g_sfaa_m_t.sfaa011=g_sfaa_m.sfaa011
        LET g_sfaa_m_t.sfaa012=g_sfaa_m.sfaa012
        LET g_sfaa_m_t.sfaa013=g_sfaa_m.sfaa013
        LET g_sfaa_m_t.sfaa019=g_sfaa_m.sfaa019
        LET g_sfaa_m_t.sfaa020=g_sfaa_m.sfaa020
     END IF
  END IF
  
  IF g_sfaa_m.sfaa061 = 'Y' THEN
     SELECT imae033 INTO g_sfaa_m.sfaa016 FROM imae_t
      WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfaa_m.sfaa010
     SELECT imae032 INTO l_imae032 FROM imae_t WHERE imaeent=g_enterprise AND imaesite=g_site AND imae001=g_sfaa_m.sfaa010
     IF cl_null(l_imae032) THEN
        LET l_imae032 = g_sfaa_m.sfaa010
     END IF
  END IF
  
  
  DISPLAY BY NAME g_sfaa_m.sfaa009,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa016,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020
  INITIALIZE g_ref_fields TO NULL
  LET g_ref_fields[1] = g_sfaa_m.sfaa010
  CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
  LET g_sfaa_m.sfaa010_desc = '', g_rtn_fields[1] , ''
  DISPLAY BY NAME g_sfaa_m.sfaa010_desc
  
  INITIALIZE g_ref_fields TO NULL
  LET g_ref_fields[1] = g_sfaa_m.sfaa010
  CALL ap_ref_array2(g_ref_fields,"SELECT imaal004 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
  LET g_sfaa_m.sfaa010_desc1 = '', g_rtn_fields[1] , ''
  DISPLAY BY NAME g_sfaa_m.sfaa010_desc1
  
  IF NOT cl_null(g_sfaa_m.sfaa009) THEN
     INITIALIZE g_ref_fields TO NULL
     LET g_ref_fields[1] = g_sfaa_m.sfaa009
     CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
     LET g_sfaa_m.sfaa009_desc = '', g_rtn_fields[1] , ''
  ELSE
     LET g_sfaa_m.sfaa009_desc = ''
  END IF
  DISPLAY BY NAME g_sfaa_m.sfaa009_desc 
  
  IF NOT cl_null(l_imae032) AND NOT cl_null(g_sfaa_m.sfaa016) THEN
     INITIALIZE g_ref_fields TO NULL
     LET g_ref_fields[1] = l_imae032
     LET g_ref_fields[2] = g_sfaa_m.sfaa016
     CALL ap_ref_array2(g_ref_fields,"SELECT ecba003 FROM ecba_t WHERE ecbaent='"||g_enterprise||"' AND ecba001=? AND ecba002=? ","") RETURNING g_rtn_fields
     LET g_sfaa_m.sfaa016_desc = '', g_rtn_fields[1] , ''
  ELSE
     LET g_sfaa_m.sfaa016_desc = ''
  END IF
  DISPLAY BY NAME g_sfaa_m.sfaa016_desc           
  RETURN TRUE
  
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa030_desc" order="55" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#活动说明显示
PRIVATE FUNCTION asft300_sfaa030_desc(p_sfaa028,p_sfaa030)
DEFINE p_sfaa028   LIKE sfaa_t.sfaa028
DEFINE p_sfaa030   LIKE sfaa_t.sfaa030
   INITIALIZE g_ref_fields TO NULL
   IF cl_null(p_sfaa028) OR cl_null(p_sfaa030) THEN
      RETURN
   END IF
   LET g_ref_fields[1] = p_sfaa028
   LET g_ref_fields[2] = p_sfaa030
   CALL ap_ref_array2(g_ref_fields,"SELECT pjbml004 FROM pjbml_t WHERE pjbmlent='"||g_enterprise||"' AND pjbml001=? AND pjbml002=? AND pjbml003='"||g_lang||"'","") RETURNING g_rtn_fields
   LET g_sfaa_m.sfaa030_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_sfaa_m.sfaa030_desc
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfab002_chk" order="56" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#工单来源检查
PRIVATE FUNCTION asft300_sfab002_chk()
DEFINE l_sql         STRING
DEFINE l_n           LIKE type_t.num5


  #當等於訂單、計畫等，檢查是否存在來源資料裡
  IF NOT cl_null(g_sfab_d[l_ac].sfab002) THEN
     #订单
     IF g_sfab_d[l_ac].sfab001 = '2' THEN
        LET l_sql = "SELECT COUNT(*) FROM xmda_t,xmdd_t WHERE xmdaent=xmddent AND xmdadocno=xmdddocno ",
                    "   AND xmddent='",g_enterprise,"' AND xmddsite='",g_site,"'",
                    "   AND xmdddocno='",g_sfab_d[l_ac].sfab002,"' AND xmdd001='",g_sfaa_m.sfaa010,"'",
                    "   AND xmdastus = 'Y'"
        
        IF NOT cl_null(g_sfab_d[l_ac].sfab003) THEN
           LET l_sql = l_sql," AND xmddseq=", g_sfab_d[l_ac].sfab003
        END IF
        IF NOT cl_null(g_sfab_d[l_ac].sfab004) THEN
           LET l_sql = l_sql," AND xmddseq1=", g_sfab_d[l_ac].sfab004
        END IF
        IF NOT cl_null(g_sfab_d[l_ac].sfab005) THEN
           LET l_sql = l_sql," AND xmddseq2=", g_sfab_d[l_ac].sfab005
        END IF        
        PREPARE asft300_sfab002_pre1 FROM l_sql
        EXECUTE asft300_sfab002_pre1 INTO l_n
     END IF 
     #计划     
     IF g_sfaa_m.sfaa005 = '3' THEN
     END IF
     IF l_n = 0 THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = 'asf-00154'
        LET g_errparam.extend = g_sfab_d[l_ac].sfab002
        LET g_errparam.popup = TRUE
        CALL cl_err()

        RETURN FALSE
     END IF
  ELSE
     RETURN FALSE
  END IF
  
  CALL asft300_show_sfab_desc(l_ac)
  RETURN TRUE
  
END FUNCTION]]>
  </point>
  <point name="function.asft300_chk_sfaa014" order="57" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#BOM版本检查及带值
PRIVATE FUNCTION asft300_chk_sfaa014()
DEFINE r_success         LIKE type_t.num5
DEFINE l_n               LIKE type_t.num5
DEFINE l_bmfa005         DATETIME YEAR TO SECOND

   LET r_success = FALSE
   IF cl_null(g_sfaa_m.sfaa014) THEN
      LET r_success = TRUE
      RETURN r_success
   END IF
   
   #BOM版本檢查是否有存在bmfa012或bmfp007
   SELECT COUNT(*) INTO l_n FROM bmfa_t WHERE bmfaent=g_enterprise AND (bmfasite='ALL' OR bmfasite=g_site)
      AND bmfa003=g_sfaa_m.sfaa010 AND bmfa004=g_sfaa_m.sfaa011 AND bmfa012=g_sfaa_m.sfaa014
   IF l_n = 0 THEN
      SELECT COUNT(*) INTO l_n FROM bmfp_t WHERE bmfpent=g_enterprise AND (bmfpsite='ALL' OR bmfpsite=g_site)
         AND bmfp002=g_sfaa_m.sfaa010 AND bmfp003=g_sfaa_m.sfaa011 AND bmfp007=g_sfaa_m.sfaa014
      IF l_n = 0 THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'asf-00323'
         LET g_errparam.extend = g_sfaa_m.sfaa014
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN r_success
      ELSE
         SELECT MAX(bmfa005) INTO l_bmfa005 FROM bmfa_t,bmfp_t WHERE bmfaent=bmfpent AND bmfasite=bmfpsite
            AND bmfadocno=bmfpdocno AND bmfa003=bmfp002 AND bmfa004=bmfp003 
            AND bmfaent=g_enterprise AND (bmfasite='ALL' OR bmfasite=g_site)
            AND bmfa003=g_sfaa_m.sfaa010 AND bmfa004=g_sfaa_m.sfaa011 AND bmfp007=g_sfaa_m.sfaa014
      END IF
   ELSE
      SELECT MAX(bmfa005) INTO l_bmfa005 FROM bmfa_t WHERE bmfaent=g_enterprise AND (bmfasite='ALL' OR bmfasite=g_site)
         AND bmfa003=g_sfaa_m.sfaa010 AND bmfa004=g_sfaa_m.sfaa011 AND bmfa012=g_sfaa_m.sfaa014
   END IF
   LET g_sfaa_m.sfaa015 = l_bmfa005 
   DISPLAY BY NAME g_sfaa_m.sfaa015
   LET r_success = TRUE
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.asft300_get_col_default" order="58" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#工单单头栏位根据单别预设
PRIVATE FUNCTION asft300_get_col_default()
   LET g_sfaa_m.sfaadocdt = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'pmdidocdt',g_sfaa_m.sfaadocdt)
   LET g_sfaa_m.sfaa001 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa001',g_sfaa_m.sfaa001)
   LET g_sfaa_m.sfaa003 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa003',g_sfaa_m.sfaa003)
   LET g_sfaa_m.sfaa057 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa057',g_sfaa_m.sfaa057)
   LET g_sfaa_m.sfaa002 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa002',g_sfaa_m.sfaa002)
   LET g_sfaa_m.sfaa004 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa004',g_sfaa_m.sfaa004)
   LET g_sfaa_m.sfaastus = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaastus',g_sfaa_m.sfaastus)
   LET g_sfaa_m.sfaa005 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa005',g_sfaa_m.sfaa005)
   LET g_sfaa_m.sfaa006 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa006',g_sfaa_m.sfaa006)
   LET g_sfaa_m.sfaa007 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa007',g_sfaa_m.sfaa007)
   LET g_sfaa_m.sfaa008 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa008',g_sfaa_m.sfaa008)
   LET g_sfaa_m.sfaa063 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa063',g_sfaa_m.sfaa063)
   LET g_sfaa_m.sfaa009 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa009',g_sfaa_m.sfaa009)
   LET g_sfaa_m.sfaa022 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa022',g_sfaa_m.sfaa022)
   LET g_sfaa_m.sfaa023 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa023',g_sfaa_m.sfaa023)
   LET g_sfaa_m.sfaa024 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa024',g_sfaa_m.sfaa024)
   LET g_sfaa_m.sfaa064 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa064',g_sfaa_m.sfaa064)
   LET g_sfaa_m.sfaa021 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa021',g_sfaa_m.sfaa021)
   LET g_sfaa_m.sfaa025 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa025',g_sfaa_m.sfaa025)
   LET g_sfaa_m.sfaa010 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa010',g_sfaa_m.sfaa010)
   LET g_sfaa_m.sfaa011 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa011',g_sfaa_m.sfaa011)
   LET g_sfaa_m.sfaa012 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa012',g_sfaa_m.sfaa012)
   LET g_sfaa_m.sfaa013 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa013',g_sfaa_m.sfaa013)
   LET g_sfaa_m.sfaa058 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa058',g_sfaa_m.sfaa058)
   LET g_sfaa_m.sfaa060 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa060',g_sfaa_m.sfaa060)
   LET g_sfaa_m.sfaa061 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa061',g_sfaa_m.sfaa061)
   LET g_sfaa_m.sfaa016 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa016',g_sfaa_m.sfaa016)
   LET g_sfaa_m.sfaa017 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa017',g_sfaa_m.sfaa017)
   LET g_sfaa_m.sfaa018 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa018',g_sfaa_m.sfaa018)
   LET g_sfaa_m.sfaa019 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa019',g_sfaa_m.sfaa019)
   LET g_sfaa_m.sfaa020 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa020',g_sfaa_m.sfaa020)
   LET g_sfaa_m.sfaa014 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa014',g_sfaa_m.sfaa014)
   LET g_sfaa_m.sfaa028 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa028',g_sfaa_m.sfaa028)
   LET g_sfaa_m.sfaa015 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa015',g_sfaa_m.sfaa015)
   LET g_sfaa_m.sfaa029 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa029',g_sfaa_m.sfaa029)
   LET g_sfaa_m.sfaa026 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa026',g_sfaa_m.sfaa026)
   LET g_sfaa_m.sfaa030 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa030',g_sfaa_m.sfaa030)
   LET g_sfaa_m.sfaa031 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa031',g_sfaa_m.sfaa031)
   LET g_sfaa_m.sfaa062 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa062',g_sfaa_m.sfaa062)
   LET g_sfaa_m.sfaa032 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa032',g_sfaa_m.sfaa032)
   LET g_sfaa_m.sfaa068 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa068',g_sfaa_m.sfaa068)
   LET g_sfaa_m.sfaa033 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa033',g_sfaa_m.sfaa033)
   LET g_sfaa_m.sfaa034 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa034',g_sfaa_m.sfaa034)
   LET g_sfaa_m.sfaa035 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa035',g_sfaa_m.sfaa035)
   LET g_sfaa_m.sfaa059 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa059',g_sfaa_m.sfaa059)
   LET g_sfaa_m.sfaa036 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa036',g_sfaa_m.sfaa036)
   LET g_sfaa_m.sfaa037 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa037',g_sfaa_m.sfaa037)
   LET g_sfaa_m.sfaa038 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa038',g_sfaa_m.sfaa038)
   LET g_sfaa_m.sfaa039 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa039',g_sfaa_m.sfaa039)
   LET g_sfaa_m.sfaa040 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa040',g_sfaa_m.sfaa040)
   LET g_sfaa_m.sfaa041 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa041',g_sfaa_m.sfaa041)
   LET g_sfaa_m.sfaa042 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa042',g_sfaa_m.sfaa042)
   LET g_sfaa_m.sfaa043 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa043',g_sfaa_m.sfaa043)
   LET g_sfaa_m.sfaa044 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa044',g_sfaa_m.sfaa044)
   LET g_sfaa_m.sfaa069 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa069',g_sfaa_m.sfaa069)
   LET g_sfaa_m.sfaa070 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa070',g_sfaa_m.sfaa070)
   LET g_sfaa_m.sfaa065 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa065',g_sfaa_m.sfaa065)
   LET g_sfaa_m.sfaa045 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa045',g_sfaa_m.sfaa045)
   LET g_sfaa_m.sfaa046 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa046',g_sfaa_m.sfaa046)
   LET g_sfaa_m.sfaa049 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa049',g_sfaa_m.sfaa049)
   LET g_sfaa_m.sfaa050 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa050',g_sfaa_m.sfaa050)
   LET g_sfaa_m.sfaa047 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa047',g_sfaa_m.sfaa047)
   LET g_sfaa_m.sfaa051 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa051',g_sfaa_m.sfaa051)
   LET g_sfaa_m.sfaa048 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa048',g_sfaa_m.sfaa048)
   LET g_sfaa_m.sfaa055 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa055',g_sfaa_m.sfaa055)
   LET g_sfaa_m.sfaa056 = s_aooi200_get_doc_default(g_site,'1',g_sfaa_m.sfaadocno,'sfaa056',g_sfaa_m.sfaa056)
   
   CALL asft300_show()
END FUNCTION]]>
  </point>
  <point name="function.asft300_show_sfab_desc" order="59" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#工单来源页签ref栏位显示
PRIVATE FUNCTION asft300_show_sfab_desc(p_ac)
DEFINE p_ac              LIKE type_t.num5
DEFINE l_sfaa013         LIKE sfaa_t.sfaa013
DEFINE l_sfab007         LIKE sfab_t.sfab007
DEFINE l_sql             STRING
DEFINE l_xmdd            RECORD LIKE xmdd_t.*
DEFINE l_success         LIKE type_t.num5
DEFINE l_rate            LIKE inaj_t.inaj014
DEFINE l_imae016         LIKE imae_t.imae016
 
   #带值
  IF g_sfab_d[p_ac].sfab001 ='2' THEN
     IF NOT cl_null(g_sfab_d[p_ac].sfab002) AND NOT cl_null(g_sfab_d[p_ac].sfab003) AND NOT cl_null(g_sfab_d[p_ac].sfab004) AND NOT cl_null(g_sfab_d[p_ac].sfab005) THEN
        SELECT xmda004,xmda003,xmda002,xmdd_t.* INTO g_sfab_d[p_ac].a6,g_sfab_d[p_ac].a7,g_sfab_d[p_ac].a8,l_xmdd.* FROM xmda_t,xmdd_t WHERE xmdaent=xmddent AND xmdadocno=xmdddocno
           AND xmddent=g_enterprise AND xmddsite=g_site AND xmdd001=g_sfaa_m.sfaa010
           AND xmdddocno=g_sfab_d[p_ac].sfab002 AND xmddseq=g_sfab_d[p_ac].sfab003
           AND xmddseq1=g_sfab_d[p_ac].sfab004 AND xmddseq2=g_sfab_d[p_ac].sfab005
        LET g_sfab_d[p_ac].a1=l_xmdd.xmdd006
        LET g_sfab_d[p_ac].a2=l_xmdd.xmdd004
        LET g_sfab_d[p_ac].a4=g_sfaa_m.sfaa013
       #CALL s_aimi190_get_convert(l_xmdd.xmdd001,g_sfab_d[p_ac].a2,g_sfab_d[p_ac].a4) RETURNING l_success,l_rate
       #IF l_success THEN
       #   LET g_sfab_d[p_ac].a3=g_sfab_d[p_ac].a1 * l_rate
       #END IF
        CALL s_aooi250_convert_qty(l_xmdd.xmdd001,g_sfab_d[p_ac].a2,g_sfab_d[p_ac].a4,g_sfab_d[p_ac].a1)
             RETURNING l_success,g_sfab_d[p_ac].a3
        IF NOT l_success THEN
           LET g_sfab_d[p_ac].a3 = g_sfab_d[p_ac].a1
        END IF
        
        LET g_sfab_d[p_ac].a0 = l_xmdd.xmdd011
        
        #已开工单数量
        LET l_sql = "SELECT sfaa013,sfab007 FROM sfaa_t,sfab_t WHERE sfaaent=sfabent AND sfaadocno=sfabdocno",
              "   AND sfaaent=",g_enterprise," AND sfaasite='",g_site,"'",
              "   AND sfaa010='",g_sfaa_m.sfaa010,"' AND sfaastus != 'X'",
              "   AND sfab002='",g_sfab_d[p_ac].sfab002,"' AND sfab003=",g_sfab_d[p_ac].sfab003,
              "   AND sfab004=",g_sfab_d[p_ac].sfab004," AND sfab005=",g_sfab_d[p_ac].sfab005
        PREPARE asft300_qty2_pre FROM l_sql
        DECLARE asft300_qty2_cs CURSOR FOR asft300_qty2_pre
        LET g_sfab_d[p_ac].a5 = 0
        FOREACH asft300_qty2_cs INTO l_sfaa013,l_sfab007
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = SQLCA.sqlcode
              LET g_errparam.extend = "FOREACH:"
              LET g_errparam.popup = TRUE
              CALL cl_err()

              EXIT FOREACH
           END IF    
          #CALL s_aimi190_get_convert(g_sfaa_m.sfaa010,l_sfaa013,g_sfab_d[p_ac].a4) RETURNING l_success,l_rate
          #IF l_success THEN
          #   LET l_sfab007 = l_sfab007 * l_rate
          #END IF
           CALL s_aooi250_convert_qty(g_sfaa_m.sfaa010,l_sfaa013,g_sfab_d[p_ac].a4,l_sfab007)
                RETURNING l_success,l_sfab007
           LET g_sfab_d[p_ac].a5 = g_sfab_d[p_ac].a5 + l_sfab007
        END FOREACH 
        
        INITIALIZE g_ref_fields TO NULL
        LET g_ref_fields[1] = g_sfab_d[p_ac].a8
        CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
        LET g_sfab_d[p_ac].a8_desc = '', g_rtn_fields[1] , ''
        
        INITIALIZE g_ref_fields TO NULL
        LET g_ref_fields[1] = g_sfab_d[p_ac].a7
        CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
        LET g_sfab_d[p_ac].a7_desc = '', g_rtn_fields[1] , ''
       
        INITIALIZE g_ref_fields TO NULL
        LET g_ref_fields[1] = g_sfab_d[p_ac].a6
        CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
        LET g_sfab_d[p_ac].a6_desc = '', g_rtn_fields[1] , ''
     END IF
  END IF
  
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa006_chk_qty" order="60" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#已开工单量计算
PRIVATE FUNCTION asft300_sfaa006_chk_qty(p_sfab002,p_sfab003,p_sfab004,p_sfab005,p_unit)
DEFINE p_sfab002         LIKE sfab_t.sfab002
DEFINE p_sfab003         LIKE sfab_t.sfab003
DEFINE p_sfab004         LIKE sfab_t.sfab004
DEFINE p_sfab005         LIKE sfab_t.sfab005
DEFINE p_unit            LIKE sfaa_t.sfaa013
DEFINE l_sql             STRING
DEFINE l_sum             LIKE sfaa_t.sfaa012
DEFINE l_sfab007         LIKE sfab_t.sfab007
DEFINE l_sfaa013         LIKE sfaa_t.sfaa013
DEFINE l_success         LIKE type_t.num5
DEFINE l_rate            LIKE type_t.num26_10

  LET l_sql = "SELECT sfaa013,sfab007 FROM sfaa_t,sfab_t WHERE sfaaent=sfabent AND sfaadocno=sfabdocno",
              "   AND sfaaent=",g_enterprise," AND sfaasite='",g_site,"'",
              "   AND sfaa010='",g_sfaa_m.sfaa010,"' AND sfaastus != 'X'",
              "   AND sfab002=? AND sfab003=? AND sfab004=? AND sfab005=?"
  PREPARE asft300_01_qty2_pre FROM l_sql
  DECLARE asft300_01_qty2_cs CURSOR FOR asft300_01_qty2_pre
  LET l_sum = 0
  FOREACH asft300_01_qty2_cs USING p_sfab002,p_sfab003,p_sfab004,p_sfab005 INTO l_sfaa013,l_sfab007
     IF SQLCA.sqlcode THEN
        INITIALIZE g_errparam TO NULL
        LET g_errparam.code = SQLCA.sqlcode
        LET g_errparam.extend = "FOREACH:"
        LET g_errparam.popup = TRUE
        CALL cl_err()

        EXIT FOREACH
     END IF    
    #CALL s_aimi190_get_convert(g_sfaa_m.sfaa010,l_sfaa013,g_sfaa_m.sfaa013) RETURNING l_success,l_rate
    #IF l_success THEN
    #   LET l_sfab007 = l_sfab007 * l_rate
    #END IF
     CALL s_aooi250_convert_qty(g_sfaa_m.sfaa010,l_sfaa013,g_sfaa_m.sfaa013,l_sfab007)
          RETURNING l_success,l_sfab007
     LET l_sum = l_sum + l_sfab007
  END FOREACH     
     
  RETURN l_sum   

END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa012_chk" order="61" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#订单时chk数量不可大于剩余可生产量
PRIVATE FUNCTION asft300_sfaa012_chk()
DEFINE l_sql         STRING
DEFINE l_xmda007     LIKE xmda_t.xmda007
DEFINE l_xmda008     LIKE xmda_t.xmda008
DEFINE l_xmdd        RECORD LIKE xmdd_t.*
DEFINE l_success     LIKE type_t.num5
DEFINE l_rate        LIKE type_t.num5
DEFINE l_sum         LIKE sfaa_t.sfaa012
DEFINE l_num         LIKE sfaa_t.sfaa012
DEFINE l_num1        LIKE sfaa_t.sfaa012
DEFINE l_xmdddocno   LIKE xmdd_t.xmdddocno
DEFINE l_xmddseq     LIKE xmdd_t.xmddseq
DEFINE l_xmddseq1    LIKE xmdd_t.xmddseq1
DEFINE l_xmddseq2    LIKE xmdd_t.xmddseq2
DEFINE l_sfaa012     LIKE sfaa_t.sfaa012

  IF g_sfaa_m.sfaa005 ='2' THEN
     IF NOT cl_null(g_sfaa_m.sfaa006) AND NOT cl_null(g_sfaa_m.sfaa007) AND NOT cl_null(g_sfaa_m.sfaa008) AND NOT cl_null(g_sfaa_m.sfaa063) THEN
        SELECT xmda007,xmda008,xmdd_t.* INTO l_xmda007,l_xmda008,l_xmdd.* FROM xmda_t,xmdd_t 
         WHERE xmdaent=xmddent AND xmdadocno=xmdddocno
           AND xmddent=g_enterprise AND xmddsite=g_site
           AND xmdddocno=g_sfaa_m.sfaa006 AND xmddseq=g_sfaa_m.sfaa007
           AND xmddseq1=g_sfaa_m.sfaa008 AND xmddseq2=g_sfaa_m.sfaa063       
        
        #此笔工单原始数量
        SELECT sfaa012 INTO l_sfaa012 FROM sfaa_t WHERE sfaaent=g_enterprise AND sfaasite=g_site AND sfaadocno=g_sfaa_m.sfaadocno
        IF cl_null(l_sfaa012) THEN
           LET l_sfaa012 = 0
        END IF
        
       #CALL s_aimi190_get_convert(g_sfaa_m.sfaa010,l_xmdd.xmdd006,g_sfaa_m.sfaa013) RETURNING l_success,l_rate
       #IF l_success THEN
       #   LET l_xmdd.xmdd006 = l_xmdd.xmdd006 * l_rate
       #END IF
        CALL s_aooi250_convert_qty(g_sfaa_m.sfaa010,l_xmdd.xmdd006,g_sfaa_m.sfaa013,l_xmdd.xmdd006)
             RETURNING l_success,l_xmdd.xmdd006
        #已开工单量计算
        CALL asft300_sfaa006_chk_qty(g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa013) RETURNING l_sum
            
        IF g_sfaa_m.sfaa012 > l_xmdd.xmdd006 - l_sum + l_sfaa012 THEN
           INITIALIZE g_errparam TO NULL
           LET g_errparam.code = 'asf-00337'
           LET g_errparam.extend = ''
           LET g_errparam.popup = TRUE
           CALL cl_err()

           RETURN FALSE
        END IF
        #预先订单对应已开工单数量也纳入计算
        IF l_xmda007 = '2' AND NOT cl_null(l_xmda008) THEN
           LET l_sql = "SELECT xmdddocno,xmddseq,xmddseq1,xmddseq2 FROM xmdd_t,xmda_t WHERE xmdaent=xmddent AND xmdasite=xmddsite AND xmdadocno=xmdddocno",
                      "   AND xmddent=",g_enterprise," AND xmddsite='",g_site,"' AND xmdadocno='",l_xmda008,"'",
                      "   AND xmdd001='",g_sfaa_m.sfaa010,"' AND xmdastus='Y'"
           PREPARE asft300_01_pre_2 FROM l_sql
           DECLARE asft300_01_cs_2 CURSOR FOR asft300_01_pre_2
           LET l_num = 0
           FOREACH asft300_01_cs_2 INTO l_xmdddocno,l_xmddseq,l_xmddseq1,l_xmddseq2
              IF SQLCA.sqlcode THEN
                 INITIALIZE g_errparam TO NULL
                 LET g_errparam.code = SQLCA.sqlcode
                 LET g_errparam.extend = "FOREACH:"
                 LET g_errparam.popup = TRUE
                 CALL cl_err()

                 EXIT FOREACH
              END IF
              CALL asft300_sfaa006_chk_qty(l_xmdddocno,l_xmddseq,l_xmddseq1,l_xmddseq2,g_sfaa_m.sfaa013) RETURNING l_num1
              LET l_num = l_num + l_num1
           END FOREACH
           IF g_sfaa_m.sfaa012 > l_xmdd.xmdd006 - l_sum + l_sfaa012 - l_num THEN
              INITIALIZE g_errparam TO NULL
           LET g_errparam.code = 'asf-00337'
           LET g_errparam.extend = ''
           LET g_errparam.popup = TRUE
           CALL cl_err()

              RETURN FALSE
           END IF
        END IF  
     END IF
  END IF
  RETURN TRUE
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfba023_qpa" order="62" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#根据标准应发量重新算QPA
PRIVATE FUNCTION asft300_sfba023_qpa(p_sfba023)
DEFINE p_sfba023         LIKE sfba_t.sfba023
DEFINE r_sfba010         LIKE sfba_t.sfba010
DEFINE r_sfba011         LIKE sfba_t.sfba011
DEFINE l_num1            LIKE sfaa_t.sfaa012
DEFINE l_num2            LIKE sfaa_t.sfaa012
DEFINE l_num1_t          LIKE type_t.num20
DEFINE l_num2_t          LIKE type_t.num20
DEFINE l_j               LIKE type_t.num10
DEFINE l_k               LIKE type_t.num10

   LET l_num1 = g_sfaa_m.sfaa012
   LET l_num2 = p_sfba023
   LET l_num1_t = l_num1
   LET l_num2_t = l_num2
   WHILE TRUE
     #存在小数情况           
     IF l_num1 = l_num1_t AND l_num2 = l_num2_t THEN
        EXIT WHILE
     ELSE
        LET l_num1 = l_num1 * 10
        LET l_num1_t = l_num1
        LET l_num2 = l_num2 * 10
        LET l_num2_t = l_num2
        CONTINUE WHILE
     END IF
   END WHILE
      
   #QPA分子分母约分计算
   IF l_num1 < l_num2 THEN
      LET l_j = l_num1_t
   ELSE
      LET l_j = l_num2_t
   END IF
   FOR l_k = l_j TO 1 STEP -1
      IF (l_num1_t MOD l_k = 0) AND (l_num2_t MOD l_k = 0) THEN
         EXIT FOR
      END IF
   END FOR
   
   LET r_sfba010 = l_num2_t / l_k
   LET r_sfba011 = l_num1_t / l_k
   RETURN r_sfba010,r_sfba011
END FUNCTION]]>
  </point>
  <point name="function.asft300_upd_sfcb" order="63" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#發料制度如果是倒扣料時，請在工單發放時，將製程資料的在製數量寫入第一個報工點的對應欄位上(待Move in、待Check in、待報工….)
PRIVATE FUNCTION asft300_upd_sfcb(p_sfcc003,p_sfcc004)
DEFINE p_sfcc003         LIKE sfcc_t.sfcc003
DEFINE p_sfcc004         LIKE sfcc_t.sfcc004
DEFINE l_sfcb            RECORD LIKE sfcb_t.*
DEFINE l_sfcc            RECORD LIKE sfcc_t.*
DEFINE l_flag            LIKE type_t.chr1

   DECLARE asft300_sel_sfcc_init CURSOR FOR
   SELECT * FROM sfcc_t
    WHERE sfccent   = g_enterprise
      AND sfccsite  = g_site
      AND sfccdocno = g_sfaa_m.sfaadocno
      AND sfcc001   = 0
      AND sfcc003   = p_sfcc003
      AND sfcc004   = p_sfcc004
    ORDER BY sfccdocno,sfcc001,sfcc002
   LET l_flag = 'N'
   FOREACH asft300_sel_sfcc_init INTO l_sfcc.*
      LET l_flag = 'Y'
      SELECT * INTO l_sfcb.* FROM sfcb_t WHERE sfcbent = g_enterprise AND sfcbsite = g_site
         AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0 AND sfcb002 = l_sfcc.sfcc002
      
      IF l_sfcb.sfcb014 = 'Y' THEN
         UPDATE sfcb_t SET sfcb046 = g_sfaa_m.sfaa012 * l_sfcb.sfcb053 / l_sfcb.sfcb054 
          WHERE sfcbent = g_enterprise AND sfcbsite = g_site
            AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0 AND sfcb002 = l_sfcc.sfcc002
         RETURN TRUE
      END IF
      IF l_sfcb.sfcb015 = 'Y' THEN
         UPDATE sfcb_t SET sfcb047 = g_sfaa_m.sfaa012 * l_sfcb.sfcb053 / l_sfcb.sfcb054 
          WHERE sfcbent = g_enterprise AND sfcbsite = g_site
            AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0 AND sfcb002 = l_sfcc.sfcc002
         RETURN TRUE
      END IF
      IF l_sfcb.sfcb016 = 'Y' THEN
         UPDATE sfcb_t SET sfcb050 = g_sfaa_m.sfaa012 * l_sfcb.sfcb053 / l_sfcb.sfcb054 
          WHERE sfcbent = g_enterprise AND sfcbsite = g_site
            AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0 AND sfcb002 = l_sfcc.sfcc002
         RETURN TRUE
      END IF
      IF l_sfcb.sfcb017 = 'Y' THEN
         UPDATE sfcb_t SET sfcb051 = g_sfaa_m.sfaa012 * l_sfcb.sfcb053 / l_sfcb.sfcb054 
          WHERE sfcbent = g_enterprise AND sfcbsite = g_site
            AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0 AND sfcb002 = l_sfcc.sfcc002
         RETURN TRUE
      END IF
      IF l_sfcb.sfcb018 = 'Y' THEN
         UPDATE sfcb_t SET sfcb048 = g_sfaa_m.sfaa012 * l_sfcb.sfcb053 / l_sfcb.sfcb054 
          WHERE sfcbent = g_enterprise AND sfcbsite = g_site
            AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0 AND sfcb002 = l_sfcc.sfcc002
         RETURN TRUE
      END IF
      IF l_sfcb.sfcb019 = 'Y' THEN
         UPDATE sfcb_t SET sfcb049 = g_sfaa_m.sfaa012 * l_sfcb.sfcb053 / l_sfcb.sfcb054 
          WHERE sfcbent = g_enterprise AND sfcbsite = g_site
            AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0 AND sfcb002 = l_sfcc.sfcc002
         RETURN TRUE
      END IF
   END FOREACH
   
   FOREACH asft300_sel_sfcc_init INTO l_sfcc.*
      IF asft300_upd_sfcb(l_sfcc.sfcc003,l_sfcc.sfcc004) THEN
         RETURN TRUE
      END IF
   END FOREACH
   
   IF l_flag = 'N' THEN
      UPDATE sfcb_t SET sfcb050 = g_sfaa_m.sfaa012 
       WHERE sfcbent = g_enterprise AND sfcbsite = g_site
         AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb001   = 0
      RETURN TRUE
   END IF 
   RETURN FALSE
END FUNCTION]]>
  </point>
  <point name="function.asft300_set_entry_sfac" order="64" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#生产料号明细页签sfac006 特征栏位开启关闭
PRIVATE FUNCTION asft300_set_entry_sfac()
DEFINE l_n       LIKE type_t.num5

   CALL cl_set_comp_entry("sfac006",FALSE)
   #主件有维护特征
   SELECT COUNT(*) INTO l_n FROM sfac_t 
    WHERE sfacent = g_enterprise AND sfacsite = g_site AND sfacdocno = g_sfaa_m.sfaadocno
      AND sfac002 = '1' AND sfac006 IS NOT NULL
   IF l_n > 0 AND NOT cl_null(g_sfac_d[l_ac].sfac002) AND g_sfac_d[l_ac].sfac002 = '2' THEN
      CALL cl_set_comp_entry("sfac006",TRUE)
   END IF
  
END FUNCTION]]>
  </point>
  <point name="function.asft300_sfaa010_feature" order="65" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#生产料号做特征管理相关处理逻辑
PRIVATE FUNCTION asft300_sfaa010_feature()
DEFINE l_imaa005         LIKE imaa_t.imaa005
DEFINE l_success         LIKE type_t.num5
DEFINE r_success         LIKE type_t.num5
DEFINE l_i               LIKE type_t.num5
DEFINE l_imae017         LIKE imae_t.imae017
DEFINE l_imae018         LIKE imae_t.imae018
DEFINE l_imae019         LIKE imae_t.imae019
DEFINE l_sfaa012         LIKE sfaa_t.sfaa012
DEFINE l_n_sfaa012       LIKE type_t.num20
DEFINE l_msg             STRING

   LET r_success = TRUE
   SELECT imaa005 INTO l_imaa005 FROM imaa_t WHERE imaaent = g_enterprise AND imaa001 = g_sfaa_m.sfaa010
   IF cl_null(l_imaa005) THEN
      RETURN r_success
   END IF
   CALL g_inam.clear()          
   CALL s_feature_multi(g_sfaa_m.sfaa010,'','',g_site,g_sfaa_m.sfaadocno) RETURNING l_success,g_inam
   IF NOT l_success THEN
      LET r_success = FALSE
      RETURN r_success
   END IF
   LET g_inam004_sum = 0 
   FOR l_i = 1 TO g_inam.getLength()
      IF cl_null(g_inam[l_i].inam001) THEN
         EXIT FOR
      END IF
      LET g_inam004_sum = g_inam004_sum + g_inam[l_i].inam004
   END FOR
   LET g_sfaa_m.sfaa012 = g_inam004_sum 
   
   LET l_sfaa012 = g_sfaa_m.sfaa012
   SELECT imae017,imae018,imae019 INTO l_imae017,l_imae018,l_imae019 FROM imae_t
    WHERE imaeent = g_enterprise AND imaesite = g_site AND imae001 = g_sfaa_m.sfaa010
   IF NOT cl_null(l_imae018) THEN
      IF g_sfaa_m.sfaa012 < l_imae018 THEN
         LET l_sfaa012 = l_imae018
      ELSE
         LET l_sfaa012 = g_sfaa_m.sfaa012
      END IF
   ELSE
      LET l_sfaa012 = g_sfaa_m.sfaa012
   END IF
   
   IF NOT cl_null(l_imae017) AND l_imae017 != 0 THEN
      LET l_n_sfaa012 = l_sfaa012 / l_imae017
      IF l_sfaa012  != l_imae017 * l_n_sfaa012 THEN
         IF l_sfaa012 > l_imae017 * l_n_sfaa012 THEN
            LET l_sfaa012 = l_imae017 * (l_n_sfaa012 + 1)
         ELSE
            LET l_sfaa012 = l_imae017 * l_n_sfaa012
         END IF
      END IF
 # ELSE
 #    LET l_sfaa012 = g_sfaa_m.sfaa012
   END IF
   
   IF l_sfaa012 != g_sfaa_m.sfaa012 AND NOT cl_null(l_imae019) AND l_imae019 != '3' THEN
      IF l_imae019 = '1' THEN
         LET l_msg = cl_getmsg('asf-00332',g_lang),l_sfaa012 USING '---,---,---,--&.&&&'
         IF cl_ask_promp(l_msg) THEN
            IF asft300_sfaa010_feature() THEN
            END IF
         END IF
      END IF
      IF l_imae019 = '2' THEN
         LET l_msg = cl_getmsg('asf-00452',g_lang),l_sfaa012 USING '---,---,---,--&.&&&'
         IF cl_ask_promp(l_msg) THEN
            IF asft300_sfaa010_feature() THEN
            END IF
         ELSE
            LET r_success = FALSE
            RETURN r_success
         END IF
      END IF
   END IF
   
   DISPLAY BY NAME g_sfaa_m.sfaa012
   
   RETURN r_success
   
END FUNCTION]]>
  </point>
  <point name="function.asft300_set_pk_array" order="66" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#+ 給予pk_array內容
PRIVATE FUNCTION asft300_set_pk_array()
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_sfaa_m.sfaadocno
   LET g_pk_array[1].column = 'sfaadocno'
END FUNCTION]]>
  </point>
  <point name="function.asft300_send" order="67" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
##+ BPM提交
PRIVATE FUNCTION asft300_send()
   
   IF g_sfaa_m.sfaadocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()
      RETURN FALSE
   END IF
   
   #重新取得與顯示完整單據資料(最新單據資料)
   SELECT UNIQUE sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,sfaa002,sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,sfaa017,sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,'',sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,sfaaownid,sfaaowndp,sfaacrtid,sfaacrtdp,sfaacrtdt,sfaamodid,sfaamoddt,sfaacnfid,sfaacnfdt,sfaapstid,sfaapstdt
     INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.sfaa002,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa017,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstdt
     FROM sfaa_t
    WHERE sfaaent = g_enterprise AND sfaasite = g_site AND sfaadocno = g_sfaa_m.sfaadocno
  
   ERROR ""

   CALL s_transaction_begin()

   OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN asft300_cl:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF

   #鎖住將被更改或取消的資料
   FETCH asft300_cl INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.oobal004,g_sfaa_m.sfaa002,g_sfaa_m.sfaa002_desc,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa009_desc,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa010_desc,g_sfaa_m.sfaa010_desc1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa016_desc,g_sfaa_m.sfaa017,g_sfaa_m.sfaa017_desc,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.ooff013,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaownid_desc,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaaowndp_desc,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtid_desc,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdp_desc,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamodid_desc,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfid_desc,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstid_desc,g_sfaa_m.sfaapstdt

   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF
   
   #依據單據個數，需要指定所有單身條件為" 1=1"  (單身有幾個就要設幾個)
   LET g_wc2_table1 = " 1=1 "
   LET g_wc_sfab = " 1=1 "
   LET g_wc_sfac = " 1=1 "
   LET g_wc_sfad = " 1=1 "
   LET g_wc_sfae = " 1=1 "
   LET g_wc_sfaf = " 1=1 "
   
   CALL asft300_show()
   CALL asft300_set_pk_array()
   #add-point: 提交前的ADP
   #確認前檢核段
   IF NOT s_asft300_01_confirm_chk(g_sfaa_m.sfaadocno) THEN
      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF
   
   #公用變數初始化
   CALL cl_bpm_data_init()

   #依照主檔/單身個數產生 CALL cl_bpm_set_master_data() / cl_bpm_set_detail_data()
   #單頭固定為 CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(xxxx)) 傳入參數: (1)單頭陣列  ; 回傳值: 無
   CALL cl_bpm_set_master_data(util.JSONObject.fromFGL(g_sfaa_m))

   #單身固定為 CALL cl_bpm_set_detail_data(s_detailX, util.JSONArray.fromFGL(xxxx)) 傳入參數: (1)單身SR名稱  (2)
   CALL cl_bpm_set_detail_data("s_detail1", util.JSONArray.fromFGL(g_sfab_d))
   CALL cl_bpm_set_detail_data("s_detail2", util.JSONArray.fromFGL(g_sfac_d))
   CALL cl_bpm_set_detail_data("s_detail3", util.JSONArray.fromFGL(g_sfad_d))
   CALL cl_bpm_set_detail_data("s_detail4", util.JSONArray.fromFGL(g_sfae_d))
   CALL cl_bpm_set_detail_data("s_detail5", util.JSONArray.fromFGL(g_sfaf_d))
   CALL cl_bpm_set_detail_data("s_detail6", util.JSONArray.fromFGL(g_sfba_d))
   
   #開單失敗
   IF NOT cl_bpm_cli() THEN
      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF

   #完成狀態更新
   CLOSE asft300_cl
   CALL s_transaction_end('Y','0')
   
   #重新指定此筆單據資料狀態圖片=>送簽中
   LET g_browser[g_current_row].b_statepic = "stus/16/signing.png"

   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL asft300_ui_headershow()
   CALL asft300_ui_detailshow()

   RETURN TRUE
END FUNCTION]]>
  </point>
  <point name="function.asft300_draw_out" order="68" ver="6" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#抽单
PRIVATE FUNCTION asft300_draw_out()
   
   IF g_sfaa_m.sfaadocno IS NULL THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = "std-00003"
      LET g_errparam.extend = ""
      LET g_errparam.popup = FALSE
      CALL cl_err()
      RETURN FALSE
   END IF
   
   CALL s_transaction_begin()

   OPEN asft300_cl USING g_enterprise, g_site,g_sfaa_m.sfaadocno

   IF STATUS THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  STATUS
      LET g_errparam.extend = "OPEN asft300_cl:"
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF
   
   #鎖住將被更改或取消的資料
   FETCH asft300_cl INTO g_sfaa_m.sfaadocno,g_sfaa_m.sfaa001,g_sfaa_m.sfaadocdt,g_sfaa_m.sfaa003,g_sfaa_m.sfaa057,g_sfaa_m.oobal004,g_sfaa_m.sfaa002,g_sfaa_m.sfaa002_desc,g_sfaa_m.sfaa004,g_sfaa_m.sfaastus,g_sfaa_m.sfaa005,g_sfaa_m.sfaa006,g_sfaa_m.sfaa007,g_sfaa_m.sfaa008,g_sfaa_m.sfaa063,g_sfaa_m.sfaa009,g_sfaa_m.sfaa009_desc,g_sfaa_m.sfaa022,g_sfaa_m.sfaa023,g_sfaa_m.sfaa024,g_sfaa_m.sfaa064,g_sfaa_m.sfaa021,g_sfaa_m.sfaa025,g_sfaa_m.sfaa010,g_sfaa_m.sfaa011,g_sfaa_m.sfaa010_desc,g_sfaa_m.sfaa010_desc1,g_sfaa_m.sfaa012,g_sfaa_m.sfaa013,g_sfaa_m.sfaa058,g_sfaa_m.sfaa060,g_sfaa_m.sfaa061,g_sfaa_m.sfaa016,g_sfaa_m.sfaa016_desc,g_sfaa_m.sfaa017,g_sfaa_m.sfaa017_desc,g_sfaa_m.sfaa018,g_sfaa_m.sfaa019,g_sfaa_m.sfaa020,g_sfaa_m.sfaa014,g_sfaa_m.sfaa028,g_sfaa_m.sfaa015,g_sfaa_m.sfaa029,g_sfaa_m.sfaa026,g_sfaa_m.sfaa030,g_sfaa_m.imae020,g_sfaa_m.sfaa031,g_sfaa_m.sfaa062,g_sfaa_m.sfaa032,g_sfaa_m.sfaa068,g_sfaa_m.sfaa033,g_sfaa_m.sfaa034,g_sfaa_m.sfaa035,g_sfaa_m.sfaa059,g_sfaa_m.sfaa036,g_sfaa_m.sfaa037,g_sfaa_m.sfaa038,g_sfaa_m.sfaa039,g_sfaa_m.sfaa040,g_sfaa_m.sfaa041,g_sfaa_m.sfaa042,g_sfaa_m.sfaa043,g_sfaa_m.sfaa044,g_sfaa_m.sfaa069,g_sfaa_m.sfaa070,g_sfaa_m.sfaa045,g_sfaa_m.sfaa049,g_sfaa_m.sfaa046,g_sfaa_m.sfaa050,g_sfaa_m.sfaa047,g_sfaa_m.sfaa051,g_sfaa_m.sfaa048,g_sfaa_m.sfaa065,g_sfaa_m.sfaa055,g_sfaa_m.sfaa056,g_sfaa_m.ooff013,g_sfaa_m.sfaaownid,g_sfaa_m.sfaaownid_desc,g_sfaa_m.sfaaowndp,g_sfaa_m.sfaaowndp_desc,g_sfaa_m.sfaacrtid,g_sfaa_m.sfaacrtid_desc,g_sfaa_m.sfaacrtdp,g_sfaa_m.sfaacrtdp_desc,g_sfaa_m.sfaacrtdt,g_sfaa_m.sfaamodid,g_sfaa_m.sfaamodid_desc,g_sfaa_m.sfaamoddt,g_sfaa_m.sfaacnfid,g_sfaa_m.sfaacnfid_desc,g_sfaa_m.sfaacnfdt,g_sfaa_m.sfaapstid,g_sfaa_m.sfaapstid_desc,g_sfaa_m.sfaapstdt

   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.popup = FALSE
      CALL cl_err()

      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF
   
   #抽單失敗
   IF NOT cl_bpm_draw_out() THEN
      CLOSE asft300_cl
      CALL s_transaction_end('N','0')
      RETURN FALSE
   END IF

   #完成狀態更新
   CLOSE asft300_cl
   CALL s_transaction_end('Y','0')

   #重新指定此筆單據資料狀態圖片=>抽單
   LET g_browser[g_current_row].b_statepic = "stus/16/draw_out.png"

   #重新取得單頭/單身資料,DISPLAY在畫面上
   CALL asft300_ui_headershow()
   CALL asft300_ui_detailshow()

   RETURN TRUE
END FUNCTION]]>
  </point>
  <point name="function.asft300_gen_bz" order="69" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#訂單轉工單，要將訂單單身的長備註，轉到工單單頭的備註
PRIVATE FUNCTION asft300_gen_bz()
DEFINE l_sfab                RECORD LIKE sfab_t.*
DEFINE l_ooff013_1           LIKE ooff_t.ooff013
DEFINE l_ooff013_2           LIKE ooff_t.ooff013
DEFINE l_ooff013_3           LIKE ooff_t.ooff013
DEFINE l_ooff013             LIKE ooff_t.ooff013
DEFINE l_success             LIKE type_t.num5
   
   #工单备注已经有值时，不覆盖
   IF NOT cl_null(g_sfaa_m.ooff013) THEN
      RETURN 
   END IF
   
   #订单的单身长备注设置为ooff015='Y'(内部信息传递)时,要把订单长备注带至工单备注中
   #仅当sfab001='2'(订单）,sfab002(来源单号),sfab003(来源项次)有具体值时,才处理
   DECLARE asft300_gen_bz_cs CURSOR FOR
    SELECT * FROM sfab_t 
     WHERE sfabent = g_enterprise AND sfabsite = g_site
       AND sfabdocno = g_sfaa_m.sfaadocno AND sfab001 = '2'
   FOREACH asft300_gen_bz_cs INTO l_sfab.*
      IF NOT cl_null(l_sfab.sfab002) AND NOT cl_null(l_sfab.sfab003) THEN
         SELECT ooff013 INTO l_ooff013_1 FROM ooff_t
          WHERE ooffent = g_enterprise
            AND ooff001 = '7'
            AND ooff002 = l_sfab.sfab002
            AND ooff003 = l_sfab.sfab003
            AND ooff012 = '1'
            AND ooff015 = 'Y'
      
         SELECT ooff013 INTO l_ooff013_2 FROM ooff_t
          WHERE ooffent = g_enterprise
            AND ooff001 = '7'
            AND ooff002 = l_sfab.sfab002
             AND ooff003 = l_sfab.sfab003
             AND ooff012 = '2'
             AND ooff015 = 'Y'

          SELECT ooff013 INTO l_ooff013_3 FROM ooff_t
           WHERE ooffent = g_enterprise
             AND ooff001 = '7'
             AND ooff002 = l_sfab.sfab002
             AND ooff003 = l_sfab.sfab003
             AND ooff012 = '4'
             AND ooff015 = 'Y'

          LET l_ooff013 = ''
          IF NOT cl_null(l_ooff013_1) THEN
             LET l_ooff013 = l_ooff013_1
          END IF
          
          IF NOT cl_null(l_ooff013_2) THEN
             IF NOT cl_null(l_ooff013) THEN
                LET l_ooff013 = l_ooff013 CLIPPED,'\n',l_ooff013_2
             ELSE
                LET l_ooff013 = l_ooff013_2
             END IF
          END IF

          IF NOT cl_null(l_ooff013_3) THEN
             IF NOT cl_null(l_ooff013) THEN
                LET l_ooff013 = l_ooff013 CLIPPED,'\n',l_ooff013_3
             ELSE
                LET l_ooff013 = l_ooff013_3
             END IF
          END IF

          IF NOT cl_null(l_ooff013) THEN
             CALL s_aooi360_gen('6',g_sfaa_m.sfaadocno,' ',' ',' ',' ',' ',' ',' ',' ',' ','2',l_ooff013)
                  RETURNING l_success
          END IF
       END IF
    END FOREACH
END FUNCTION]]>
  </point>
  <point name="function.asft300_sub_po" order="70" ver="8" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
#工单转委外
PRIVATE FUNCTION asft300_sub_po()
DEFINE l_sfcb           RECORD LIKE sfcb_t.*
DEFINE l_n              LIKE type_t.num5
DEFINE l_i              LIKE type_t.num5
DEFINE l_doc_type       LIKE ooba_t.ooba002     
DEFINE l_date           LIKE type_t.dat    
DEFINE l_combine        LIKE type_t.chr1   
DEFINE l_begin_no       LIKE pmdl_t.pmdldocno   
DEFINE l_end_no         LIKE pmdl_t.pmdldocno
DEFINE l_success        LIKE type_t.num5
DEFINE l_choice         LIKE type_t.num5
DEFINE la_param         RECORD
                        prog   STRING,
                        param  DYNAMIC ARRAY OF STRING
                        END RECORD
DEFINE ls_js            STRING
DEFINE l_j              LIKE type_t.num5
DEFINE l_k              LIKE type_t.num5
DEFINE l_l              LIKE type_t.num5
DEFINE l_flag           LIKE type_t.chr1
DEFINE l_pmdldocno      LIKE pmdl_t.pmdldocno
DEFINE l_pmdl_where     STRING

   IF g_sfaa_m.sfaastus != 'Y' AND g_sfaa_m.sfaastus != 'F' THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.code   = 'asf-00444'      
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   SELECT COUNT(*) INTO l_n FROM sfcb_t 
    WHERE sfcbent = g_enterprise AND sfcbsite = g_site
      AND sfcbdocno = g_sfaa_m.sfaadocno AND sfcb012 = 'Y'
   IF l_n = 0 AND g_sfaa_m.sfaa057 != '2' THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.code   = 'asf-00445'      
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #已经存在工单对应委外采购单，则直接开启apmt501
   DECLARE asft300_sub_po_pmdl_cs CURSOR FOR
    SELECT pmdldocno FROM pmdl_t 
     WHERE pmdlent = g_enterprise AND pmdlsite = g_site
       AND pmdl005 = '2' AND pmdl007 = '4' AND pmdl008 = g_sfaa_m.sfaadocno
       AND pmdlstus != 'X'
   FOREACH asft300_sub_po_pmdl_cs INTO l_pmdldocno
      IF cl_null(l_pmdl_where) THEN
         LET l_pmdl_where = "'",l_pmdldocno,"'"
      ELSE
         LET l_pmdl_where = l_pmdl_where,",","'",l_pmdldocno,"'"
      END IF
   END FOREACH
   IF NOT cl_null(l_pmdl_where) THEN
      LET la_param.prog     = "apmt501"
      LET la_param.param[1] = ''
      LET la_param.param[2] = " AND pmdldocno IN(",l_pmdl_where,")"      
      LET ls_js = util.JSON.stringify( la_param )
      CALL cl_cmdrun(ls_js)
      RETURN
   END IF
   
   #可委外数大于0时才可委外
   #可委外數=標準產出數量(sfcb027)+重工轉入(sfcb029)+工單轉入(sfcb030)+分割轉入(sfcb031)+合併轉入(sfcb032)
   #        -良品轉出(sfcb033)-重工轉出(sfcb034)-工單轉出(sfcb035)-當站報廢(sfcb036)-當站下線(sfcb037)
   #        -分割轉出(sfcb038)-合併轉出(sfcb039)-委外數量(sfcb041)+委外完工數量(sfcb042) 
   SELECT COUNT(*) INTO l_n FROM sfcb_t 
    WHERE sfcbent = g_enterprise AND sfcbsite = g_site
      AND sfcbdocno = g_sfaa_m.sfaadocno
      AND (sfcb027+sfcb029+sfcb030+sfcb031+sfcb032-sfcb033-sfcb034-sfcb035-sfcb036-sfcb037-sfcb038-sfcb039-sfcb041+sfcb042) > 0
   IF l_n = 0 THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_sfaa_m.sfaadocno
      LET g_errparam.code   = 'asf-00446'      
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF  
   
   DECLARE asft300_sub_po CURSOR FOR
    SELECT sfcb_t.* FROM sfaa_t,sfcb_t 
     WHERE sfaaent = sfcbent AND sfaasite = sfcbsite AND sfaadocno = sfcbdocno
       AND sfcbent = g_enterprise AND sfcbsite = g_site AND sfcbdocno = g_sfaa_m.sfaadocno 
       AND (sfcb012  = 'Y' OR sfaa057 = '2') AND (sfaastus = 'F' OR sfaastus = 'Y')
       AND (sfcb027+sfcb029+sfcb030+sfcb031+sfcb032-sfcb033-sfcb034-sfcb035-sfcb036-sfcb037-sfcb038-sfcb039-sfcb041+sfcb042) > 0
     ORDER BY sfcbdocno,sfcb001,sfcb002
     
   LET l_i = 1
   FOREACH asft300_sub_po INTO l_sfcb.*
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "FOREACH:" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         EXIT FOREACH
      END IF 
      INITIALIZE g_detail_d[l_i].* TO NULL
      LET g_detail_d[l_i].sel              = 'Y'   
      LET g_detail_d[l_i].b_sfcbdocno      = l_sfcb.sfcbdocno
      LET g_detail_d[l_i].b_sfcb001        = l_sfcb.sfcb001
      LET g_detail_d[l_i].b_sfcb002        = l_sfcb.sfcb002
      LET g_detail_d[l_i].b_sfaa003        = g_sfaa_m.sfaa003
      LET g_detail_d[l_i].b_sfaa002        = g_sfaa_m.sfaa002
      LET g_detail_d[l_i].b_sfaa010        = g_sfaa_m.sfaa010                                                         
      LET g_detail_d[l_i].b_sfcb003        = l_sfcb.sfcb003
      LET g_detail_d[l_i].b_sfcb004        = l_sfcb.sfcb004
      LET g_detail_d[l_i].b_sfcb020        = l_sfcb.sfcb020
      
      IF cl_null(l_sfcb.sfcb027) THEN LET l_sfcb.sfcb027 = 0 END IF
      IF cl_null(l_sfcb.sfcb029) THEN LET l_sfcb.sfcb029 = 0 END IF
      IF cl_null(l_sfcb.sfcb030) THEN LET l_sfcb.sfcb030 = 0 END IF
      IF cl_null(l_sfcb.sfcb031) THEN LET l_sfcb.sfcb031 = 0 END IF
      IF cl_null(l_sfcb.sfcb032) THEN LET l_sfcb.sfcb032 = 0 END IF
      IF cl_null(l_sfcb.sfcb033) THEN LET l_sfcb.sfcb033 = 0 END IF
      IF cl_null(l_sfcb.sfcb034) THEN LET l_sfcb.sfcb034 = 0 END IF
      IF cl_null(l_sfcb.sfcb035) THEN LET l_sfcb.sfcb035 = 0 END IF
      IF cl_null(l_sfcb.sfcb036) THEN LET l_sfcb.sfcb036 = 0 END IF
      IF cl_null(l_sfcb.sfcb037) THEN LET l_sfcb.sfcb037 = 0 END IF
      IF cl_null(l_sfcb.sfcb038) THEN LET l_sfcb.sfcb038 = 0 END IF
      IF cl_null(l_sfcb.sfcb039) THEN LET l_sfcb.sfcb039 = 0 END IF
      IF cl_null(l_sfcb.sfcb041) THEN LET l_sfcb.sfcb041 = 0 END IF
      IF cl_null(l_sfcb.sfcb042) THEN LET l_sfcb.sfcb042 = 0 END IF
      LET g_detail_d[l_i].b_tot_qty        = l_sfcb.sfcb027 + l_sfcb.sfcb029 + l_sfcb.sfcb030 + l_sfcb.sfcb031 + l_sfcb.sfcb032 
                                         - l_sfcb.sfcb033 - l_sfcb.sfcb034 - l_sfcb.sfcb035 - l_sfcb.sfcb036 - l_sfcb.sfcb037 
                                         - l_sfcb.sfcb038 - l_sfcb.sfcb039 - l_sfcb.sfcb041 + l_sfcb.sfcb042
   
      LET g_detail_d[l_i].b_carry_qty      = g_detail_d[l_i].b_tot_qty
      LET g_detail_d[l_i].b_sfcb013        = l_sfcb.sfcb013
      IF cl_null(g_detail_d[l_i].b_sfcb013) THEN
         LET g_detail_d[l_i].b_sfcb013     = g_sfaa_m.sfaa017
      END IF
      LET g_detail_d[l_i].b_sfcb044        = l_sfcb.sfcb044
      LET g_detail_d[l_i].b_sfcb045        = l_sfcb.sfcb045
    #  LET g_detail_d[l_ac].b_pmal002       = ''
      CALL asft300_b_sfcb013_reference(l_i)
      LET g_detail_d[l_i].b_exrate         = asft300_get_b_exrate(g_detail_d[l_i].b_pmdl015)
      LET g_detail_d[l_i].b_price          = 0       
   
      LET l_i = l_i + 1
      IF l_ac > g_max_rec THEN
         IF g_error_show = 1 THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend =  "" 
            LET g_errparam.code   =  9035 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
 
         END IF
         EXIT FOREACH
      END IF
      
   END FOREACH
   
   CALL g_detail_d.deleteElement(l_i)
   CALL g_pmal.clear()
   
   CALL asfp400_01(g_detail_d)
        RETURNING l_success,l_doc_type,l_date,l_combine
   IF NOT l_success THEN
      RETURN
   END IF   
   
   DECLARE asft300_sub_po_tz_cs CURSOR FOR
    SELECT sfacdocno,sfac006,sum(sfac003) FROM sfac_t 
     WHERE sfacent = g_enterprise AND sfacsite = g_site
       AND sfacdocno = g_sfaa_m.sfaadocno AND (sfac002 = '1' OR sfac002 = '2')
     GROUP BY sfacdocno,sfac006
     ORDER BY sfacdocno,sfac006
   
   CALL g_arr1.clear()
   CALL g_arr2.clear()
   LET l_j = 1
   LET l_k = 1
   CALL cl_err_collect_init()
   LET l_flag = 'Y'
   FOR l_l = 1 TO g_detail_d.getLength()
      LET g_arr1[l_j].sfcbdocno = g_detail_d[l_l].b_sfcbdocno
      LET g_arr1[l_j].sfaa010   = g_detail_d[l_l].b_sfaa010  
      LET g_arr1[l_j].sfcb001   = g_detail_d[l_l].b_sfcb001  
      LET g_arr1[l_j].sfcb002   = g_detail_d[l_l].b_sfcb002  
      LET g_arr1[l_j].sfcb003   = g_detail_d[l_l].b_sfcb003  
      LET g_arr1[l_j].sfcb004   = g_detail_d[l_l].b_sfcb004  
      LET g_arr1[l_j].sfcb020   = g_detail_d[l_l].b_sfcb020  
      LET g_arr1[l_j].carry_qty = g_detail_d[l_l].b_carry_qty
      LET g_arr1[l_j].sfcb013   = g_detail_d[l_l].b_sfcb013  
      LET g_arr1[l_j].sfcb044   = g_detail_d[l_l].b_sfcb044  
      LET g_arr1[l_j].sfcb045   = g_detail_d[l_l].b_sfcb045  
      LET g_arr1[l_j].pmdl017   = g_detail_d[l_l].b_pmdl017  
      LET g_arr1[l_j].pmdl015   = g_detail_d[l_l].b_pmdl015  
      LET g_arr1[l_j].exrate    = g_detail_d[l_l].b_exrate   
      LET g_arr1[l_j].pmdl011   = g_detail_d[l_l].b_pmdl011  
      LET g_arr1[l_j].price     = g_detail_d[l_l].b_price   
   #   LET g_arr1[l_i].pmal002   = g_detail_d[l_i].b_pmal002
      
      FOREACH asft300_sub_po_tz_cs INTO g_arr2[l_k].*
          IF SQLCA.sqlcode THEN
             INITIALIZE g_errparam TO NULL
             LET g_errparam.code = SQLCA.sqlcode
             LET g_errparam.extend = 'foreach asft300_sub_po_tz_cs'
             LET g_errparam.popup = TRUE
             CALL cl_err()
             LET l_flag = 'N'
          END IF
          LET l_k = l_k + 1
      END FOREACH
      
      IF NOT s_asfp400_chk_before_carry(g_arr1[l_j].*,l_doc_type,l_date) THEN
         LET l_flag = 'N'
         CONTINUE FOR
      END IF
      
      LET l_j = l_j + 1                     
   END FOR
   
   CALL g_arr1.deleteElement(l_j)
   CALL g_arr2.deleteElement(l_k)
   CALL cl_err_collect_show()  
   IF l_flag = 'N' THEN      
      RETURN
   END IF
             
   CALL s_asfp400_cre_tmp_table(l_doc_type,l_date,g_arr1,g_arr2)
        RETURNING l_success
   IF NOT l_success THEN
      RETURN 
   END IF
   
   CALL s_transaction_begin()
   CALL s_asfp400_carry_po(l_doc_type,l_date,l_combine,g_arr1,g_arr2)
        RETURNING l_success,l_begin_no,l_end_no
   IF l_success THEN
      CALL s_transaction_end('Y',0)
      #成功产生单据，单据范围：%1 ~ %2
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'asf-00251'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      LET g_errparam.replace[1] = l_begin_no 
      LET g_errparam.replace[2] = l_end_no
      CALL cl_err()
   ELSE    
      CALL s_transaction_end('N',1)
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'asf-00447'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
      RETURN
   END IF
   
   IF l_success AND NOT cl_null(l_begin_no) THEN
      #是否要运行apmt501查看生成的采购单信息[Y/N]?
      LET l_choice = cl_ask_promp('asf-00261')
      IF l_choice = TRUE THEN
          LET la_param.prog     = "apmt501"
         # LET la_param.param[1] = '1'
         # LET la_param.param[2] = " pmdldocno BETWEEN '",l_begin_no,"' AND '",l_end_no,"'"
          LET la_param.param[1] = l_begin_no        
          LET ls_js = util.JSON.stringify( la_param )
          CALL cl_cmdrun(ls_js)
          CURRENT WINDOW IS w_asft300
      END IF
   END IF
   
END FUNCTION]]>
  </point>
  <point name="function.asft300_b_sfcb013_reference" order="71" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 厂商相关字段的DEFAULT
# Memo...........:
# Usage..........: CALL asft300_b_sfcb013_reference(p_i)
# Date & Author..: 14/10/20 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION asft300_b_sfcb013_reference(p_i)
DEFINE p_i            LIKE type_t.num5
DEFINE l_pmal         RECORD LIKE pmal_t.*
DEFINE l_pmab         RECORD LIKE pmab_t.*
DEFINE l_pmal002      LIKE pmal_t.pmal002   #控制组
DEFINE l_success      LIKE type_t.num5
DEFINE l_i            LIKE type_t.num5
   
   IF p_i <= 0 THEN
      RETURN
   END IF
   
   IF cl_null(g_detail_d[p_i].b_sfcb013) THEN
      RETURN
   END IF
   #相同的供应商时,仅提供一次取pmal002的机会,否则可能同一个供应商,有几十笔资料时,跳几十次选择的情形
   LET l_pmal002 = ''
   FOR l_i = 1 TO g_pmal.getLength()
       IF g_pmal[l_i].b_sfcb013 = g_detail_d[p_i].b_sfcb013 AND NOT cl_null(g_pmal[l_i].pmal002) THEN
          LET l_pmal002 = g_pmal[l_i].pmal002
          EXIT FOR
       END IF
   END FOR

   IF cl_null(l_pmal002) THEN
      CALL s_control_get_pmal002('4',g_user,g_dept,g_detail_d[p_i].b_sfcb013)
           RETURNING l_success,l_pmal002
      IF NOT l_success THEN
         LET l_pmal002 = NULL
      END IF        
      IF NOT cl_null(l_pmal002) THEN
         CALL g_pmal.insertElement(1)
         LET g_pmal[1].b_sfcb013 = g_detail_d[p_i].b_sfcb013
         LET g_pmal[1].pmal002 = l_pmal002
      END IF
   END IF
   
   #取供应商的控制组预设条件
   SELECT * INTO l_pmal.* FROM pmal_t
    WHERE pmalent = g_enterprise
      AND pmal001 = g_detail_d[p_i].b_sfcb013
      AND pmal002 = l_pmal002
      
   SELECT * INTO l_pmab.* FROM pmab_t
    WHERE pmabent  = g_enterprise
      AND pmabsite = g_site  
      AND pmab001  = g_detail_d[p_i].b_sfcb013

   #取价方式
   LET g_detail_d[p_i].b_pmdl017 = l_pmal.pmal021
   IF cl_null(g_detail_d[p_i].b_pmdl017) THEN
      LET g_detail_d[p_i].b_pmdl017 = l_pmab.pmab054
   END IF
   CALL s_desc_get_price_type_desc(g_detail_d[p_i].b_pmdl017)
        RETURNING g_detail_d[p_i].b_pmdl017_desc

   #币种
   LET g_detail_d[p_i].b_pmdl015 = l_pmal.pmal003
   IF cl_null(g_detail_d[p_i].b_pmdl015) THEN
      LET g_detail_d[p_i].b_pmdl015 = l_pmab.pmab033
   END IF
   CALL s_desc_get_currency_desc(g_detail_d[p_i].b_pmdl015)
        RETURNING g_detail_d[p_i].b_pmdl015_desc

   #税别
   LET g_detail_d[p_i].b_pmdl011 = l_pmal.pmal004
   IF cl_null(g_detail_d[p_i].b_pmdl011) THEN
      LET g_detail_d[p_i].b_pmdl011 = l_pmab.pmab034
   END IF
   CALL s_desc_get_tax_desc1(g_site,g_detail_d[p_i].b_pmdl011)
        RETURNING g_detail_d[p_i].b_pmdl011_desc
        
 #  LET g_detail_d[p_i].b_pmal002 = l_pmal002

END FUNCTION]]>
  </point>
  <point name="function.asft300_get_b_exrate" order="72" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 取汇率
# Memo...........:
# Usage..........: CALL asft300_get_b_exrate(p_b_pmdl015)
#                  RETURNING r_b_exrate
# Input parameter: p_b_pmdl015    币种
# Return code....: r_b_exrate     汇率
# Date & Author..: 2014-10-20 By wuxja
# Modify.........:
################################################################################
PRIVATE FUNCTION asft300_get_b_exrate(p_b_pmdl015)
   DEFINE p_b_pmdl015        LIKE pmdl_t.pmdl015
   DEFINE r_b_exrate         LIKE ooan_t.ooan005
   DEFINE l_date             LIKE type_t.dat
   DEFINE l_ooef016          LIKE ooef_t.ooef016
   DEFINE l_acc40            LIKE type_t.chr80
   
   LET r_b_exrate = 1
   IF cl_null(p_b_pmdl015) THEN
      RETURN r_b_exrate
   END IF
   
   LET l_date = cl_get_today()
   SELECT ooef016 INTO l_ooef016 FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = g_site
   CALL cl_get_para(g_enterprise,g_site,'S-BAS-0010') RETURNING l_acc40
   CALL s_aooi160_get_exrate('1',g_site,l_date,p_b_pmdl015,l_ooef016,0,l_acc40)
        RETURNING r_b_exrate   
   
   RETURN r_b_exrate
END FUNCTION]]>
  </point>
  <point name="b_fill.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="b_fill.fill" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="b_fill.sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="b_fill.sql_before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="b_fill2.after_fill" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="b_fill2.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="browser_fill.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="browser_fill.before_count" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="browser_fill.before_foreach" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="browser_fill.before_prepare" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="browser_fill.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="browser_fill.reference" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="browser_search.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="construct.a.ooff013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.imaf013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.number1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.number2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.replace" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfba028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfbaseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.page1.sfbaseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa029" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa030" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa047" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa048" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa049" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa050" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa056" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa057" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa058" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaa062" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaacnfid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaacrtdp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaacrtid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaadocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaadocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaamodid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaaowndp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaaownid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaapstid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaastus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfab001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfab002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfab003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfab004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfab005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfab006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfad001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfad002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfad003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfae001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfae002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfae003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfae004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfae005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfae006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.a.sfaf001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.ooff013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.imaf013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.number1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.number2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.replace" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfba028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfbaseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.page1.sfbaseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa029" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa030" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa047" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa048" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa049" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa050" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa056" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa057" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa058" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaa062" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaacnfdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaacnfid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaacrtdp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaacrtdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaacrtid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaadocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaadocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaamoddt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaamodid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaaowndp" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaaownid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaapstdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaapstid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaastus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfab001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfab002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfab003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfab004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfab005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfab006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfad001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfad002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfad003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfae001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfae002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfae003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfae004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfae005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfae006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.b.sfaf001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.ooff013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.imaf013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.number1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.number2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.replace" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfba028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfbaseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.page1.sfbaseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa030" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa047" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa048" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa049" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa050" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa056" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa057" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa058" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaa062" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaadocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaastus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfab001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfab002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfab003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfab004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfab005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfab006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfad001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfad002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfad003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfae001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfae002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfae003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfae004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfae005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfae006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaeseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="construct.c.sfaf001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="cs.add_cs" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="cs.after_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="cs.b_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="cs.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="cs.body.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="cs.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="cs.head.before_construct" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="default_search.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="default_search.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="default_search.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="delete.body.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete.body.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete.body.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="delete.head.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete.head.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete.head.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete_b.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete_b.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="delete_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="delete_b.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="detail_reproduce.body.table1.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="detail_reproduce.body.table1.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="detail_reproduce.body.table1.m_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="detail_reproduce.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="detail_show.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="detail_show.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="detail_show.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="fetch.action_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="fetch.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="fetch.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="filter.add_cs" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="filter.b_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="filter.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="filter_parser.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="free_style.variable" order="" ver="9" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[{<Module define>}

#單頭 type 宣告
 type type_g_sfaa_m        RECORD
       sfaadocno LIKE sfaa_t.sfaadocno,
   sfaa001 LIKE sfaa_t.sfaa001,
   sfaadocdt LIKE sfaa_t.sfaadocdt,
   sfaa003 LIKE sfaa_t.sfaa003,
   sfaa057 LIKE sfaa_t.sfaa057,
   oobal004 LIKE type_t.chr80,
   sfaa002 LIKE sfaa_t.sfaa002,
   sfaa002_desc LIKE type_t.chr80,
   sfaa004 LIKE sfaa_t.sfaa004,
   sfaastus LIKE sfaa_t.sfaastus,
   sfaa005 LIKE sfaa_t.sfaa005,
   sfaa006 LIKE sfaa_t.sfaa006,
   sfaa007 LIKE sfaa_t.sfaa007,
   sfaa008 LIKE sfaa_t.sfaa008,
   sfaa063 LIKE sfaa_t.sfaa063,
   l_sfaa007 string,
   sfaa009 LIKE sfaa_t.sfaa009,
   sfaa009_desc LIKE type_t.chr80,
   sfaa022 LIKE sfaa_t.sfaa022,
   sfaa023 LIKE sfaa_t.sfaa023,
   sfaa024 LIKE sfaa_t.sfaa024,
   sfaa064 LIKE sfaa_t.sfaa064,
   l_sfaa023 string,
   sfaa021 LIKE sfaa_t.sfaa021,
   sfaa025 LIKE sfaa_t.sfaa025,
   sfaa010 LIKE sfaa_t.sfaa010,
   sfaa011 LIKE sfaa_t.sfaa011,
   sfaa010_desc LIKE type_t.chr80,
   sfaa010_desc1 LIKE type_t.chr80,
   sfaa012 LIKE sfaa_t.sfaa012,
   sfaa013 LIKE sfaa_t.sfaa013,
   sfaa013_desc LIKE type_t.chr80,
   sfaa058 LIKE sfaa_t.sfaa058,
   sfaa060 LIKE sfaa_t.sfaa060,
   sfaa060_desc LIKE type_t.chr80,
   sfaa061 LIKE sfaa_t.sfaa061,
   sfaa016 LIKE sfaa_t.sfaa016,
   sfaa016_desc LIKE type_t.chr80,
   sfaa017 LIKE sfaa_t.sfaa017,
   sfaa017_desc LIKE type_t.chr80,
   sfaa018 LIKE sfaa_t.sfaa018,
   sfaa018_desc LIKE type_t.chr80,
   sfaa019 LIKE sfaa_t.sfaa019,
   sfaa020 LIKE sfaa_t.sfaa020,
   sfaa014 LIKE sfaa_t.sfaa014,
   sfaa028 LIKE sfaa_t.sfaa028,
   sfaa028_desc LIKE type_t.chr80,
   sfaa015 DATETIME YEAR TO SECOND,#LIKE sfaa_t.sfaa015,
   sfaa029 LIKE sfaa_t.sfaa029,
   sfaa029_desc LIKE type_t.chr80,
   sfaa026 LIKE sfaa_t.sfaa026,
   sfaa026_desc LIKE type_t.chr80,
   sfaa030 LIKE sfaa_t.sfaa030,
   sfaa030_desc LIKE type_t.chr80,
   imae020 LIKE imae_t.imae020,
   sfaa031 LIKE sfaa_t.sfaa031,
   sfaa031_desc LIKE type_t.chr80,
   sfaa062 LIKE sfaa_t.sfaa062,
   sfaa032 LIKE sfaa_t.sfaa032,
   sfaa068 LIKE sfaa_t.sfaa068,
   sfaa068_desc LIKE type_t.chr80,
   sfaa033 LIKE sfaa_t.sfaa033,
   sfaa034 LIKE sfaa_t.sfaa034,
   sfaa034_desc LIKE type_t.chr80,
   sfaa035 LIKE sfaa_t.sfaa035,
   sfaa035_desc LIKE type_t.chr80,
   sfaa059 LIKE sfaa_t.sfaa059,
   sfaa036 LIKE sfaa_t.sfaa036,
   sfaa037 LIKE sfaa_t.sfaa037,
   sfaa038 LIKE sfaa_t.sfaa038,
   sfaa039 LIKE sfaa_t.sfaa039,
   sfaa040 LIKE sfaa_t.sfaa040,
   sfaa041 LIKE sfaa_t.sfaa041,
   sfaa042 LIKE sfaa_t.sfaa042,
   sfaa043 LIKE sfaa_t.sfaa043,
   sfaa044 LIKE sfaa_t.sfaa044,
   sfaa069 LIKE sfaa_t.sfaa069,
   sfaa070 LIKE sfaa_t.sfaa070,
   sfaa045 LIKE sfaa_t.sfaa045,
   sfaa049 LIKE sfaa_t.sfaa049,
   sfaa046 LIKE sfaa_t.sfaa046,
   sfaa050 LIKE sfaa_t.sfaa050,
   sfaa047 LIKE sfaa_t.sfaa047,
   sfaa051 LIKE sfaa_t.sfaa051,
   sfaa048 LIKE sfaa_t.sfaa048,
   sfaa065 LIKE sfaa_t.sfaa065,
   sfaa055 LIKE sfaa_t.sfaa055,
   sfaa056 LIKE sfaa_t.sfaa056,
   ooff013 LIKE ooff_t.ooff013,
   sfaaownid LIKE sfaa_t.sfaaownid,
   sfaaownid_desc LIKE type_t.chr80,
   sfaaowndp LIKE sfaa_t.sfaaowndp,
   sfaaowndp_desc LIKE type_t.chr80,
   sfaacrtid LIKE sfaa_t.sfaacrtid,
   sfaacrtid_desc LIKE type_t.chr80,
   sfaacrtdp LIKE sfaa_t.sfaacrtdp,
   sfaacrtdp_desc LIKE type_t.chr80,
   sfaacrtdt DATETIME YEAR TO SECOND,
   sfaamodid LIKE sfaa_t.sfaamodid,
   sfaamodid_desc LIKE type_t.chr80,
   sfaamoddt DATETIME YEAR TO SECOND,
   sfaacnfid LIKE sfaa_t.sfaacnfid,
   sfaacnfid_desc LIKE type_t.chr80,
   sfaacnfdt DATETIME YEAR TO SECOND,
   sfaapstid LIKE sfaa_t.sfaapstid,
   sfaapstid_desc LIKE type_t.chr80,
   sfaapstdt LIKE sfaa_t.sfaapstdt
       END RECORD
       
 TYPE type_g_sfab_d        RECORD 
   sfabseq LIKE sfab_t.sfabseq, 
   sfab001 LIKE sfab_t.sfab001,
   sfab002 LIKE sfab_t.sfab002,
   sfab003 LIKE sfab_t.sfab003,
   sfab004 LIKE sfab_t.sfab004,
   sfab005 LIKE sfab_t.sfab005,
   sfab006 LIKE sfab_t.sfab006,
   a0 LIKE type_t.dat,
   a1 LIKE type_t.chr80,
   a2 LIKE type_t.chr80,
   a3 LIKE type_t.chr80,
   a4 LIKE type_t.chr80,
   a5 LIKE type_t.chr80,
   sfab007 LIKE sfab_t.sfab007,
   a6 LIKE type_t.chr80,
   a6_desc LIKE type_t.chr80,
   a7 LIKE type_t.chr80,
   a7_desc LIKE type_t.chr80,
   a8 LIKE type_t.chr80,
   a8_desc LIKE type_t.chr80
   END RECORD
   
 TYPE type_g_sfac_d        RECORD
   sfacseq LIKE sfac_t.sfacseq,
   sfac002 LIKE sfac_t.sfac002,
   sfac001 LIKE sfac_t.sfac001,
   sfac001_desc LIKE type_t.chr80,
   sfac001_desc1 LIKE type_t.chr80,
   sfac006 LIKE sfac_t.sfac006,
   sfac006_desc LIKE type_t.chr80,
   sfac003 LIKE sfac_t.sfac003,
   sfac004 LIKE sfac_t.sfac004,
   sfac004_desc LIKE type_t.chr80,
   sfac005 LIKE sfac_t.sfac005
   END RECORD
   
 TYPE type_g_sfad_d        RECORD
   sfadseq LIKE sfad_t.sfadseq,
   sfad001 LIKE sfad_t.sfad001,
   sfad002 LIKE sfad_t.sfad002,
   sfad003 LIKE sfad_t.sfad003
   END RECORD

 TYPE type_g_sfae_d        RECORD
   sfaeseq LIKE sfae_t.sfaeseq,
   sfae001 LIKE sfae_t.sfae001,
   sfae002 LIKE sfae_t.sfae002,
   sfae003 LIKE sfae_t.sfae003,
   sfae004 LIKE sfae_t.sfae004,
   sfae005 LIKE sfae_t.sfae005,
   sfae005_desc LIKE type_t.chr80,
   sfae006 LIKE sfae_t.sfae006
   END RECORD
   
 TYPE type_g_sfaf_d        RECORD
   sfafseq LIKE sfaf_t.sfafseq,
   sfaf001 LIKE sfaf_t.sfaf001
   END RECORD
   
#單身 type 宣告
 TYPE type_g_sfba_d        RECORD
       sfbaseq LIKE sfba_t.sfbaseq,
   sfbaseq1 LIKE sfba_t.sfbaseq1,
   sfba002 LIKE sfba_t.sfba002,
   sfba002_desc LIKE type_t.chr80,   #cj
   sfba003 LIKE sfba_t.sfba003,
   sfba003_desc LIKE type_t.chr80,   #cj
   sfba004 LIKE sfba_t.sfba004,
   sfba005 LIKE sfba_t.sfba005,
   sfba005_desc LIKE type_t.chr80,   #cj
   sfba005_desc1 LIKE type_t.chr80,   #cj
   replace LIKE type_t.chr80,
   sfba022 LIKE sfba_t.sfba022,
   sfba006 LIKE sfba_t.sfba006,
   sfba006_desc LIKE type_t.chr80,
   sfba006_desc_desc LIKE type_t.chr80,
   imaf013 LIKE type_t.chr80,
   sfba021 LIKE sfba_t.sfba021,
   sfba021_desc LIKE type_t.chr80,
   sfba007 LIKE sfba_t.sfba007,
   sfba008 LIKE sfba_t.sfba008,
   sfba009 LIKE sfba_t.sfba009,
   sfba010 LIKE sfba_t.sfba010,
   sfba011 LIKE sfba_t.sfba011,
   sfba012 LIKE sfba_t.sfba012,
   sfba023 LIKE sfba_t.sfba023,
   sfba024 LIKE sfba_t.sfba024,
   sfba013 LIKE sfba_t.sfba013,
   sfba014 LIKE sfba_t.sfba014,
   sfba014_desc LIKE type_t.chr80,   
   sfba015 LIKE sfba_t.sfba015,
   sfba016 LIKE sfba_t.sfba016,
   sfba025 LIKE sfba_t.sfba025,
  #number1 LIKE type_t.chr80,
  #number2 LIKE type_t.chr80,
   number1 LIKE sfba_t.sfba013,
   number2 LIKE sfba_t.sfba013,
   sfba017 LIKE sfba_t.sfba017,
   sfba018 LIKE sfba_t.sfba018,
   number3 LIKE sfba_t.sfba013,
   number4 LIKE sfba_t.sfba013,
   sfba019 LIKE sfba_t.sfba019,
   sfba019_desc LIKE type_t.chr80,   
   sfba020 LIKE sfba_t.sfba020,
   sfba020_desc LIKE type_t.chr80,  
   sfba029 LIKE sfba_t.sfba029,
   sfba030 LIKE sfba_t.sfba030,
   sfba028 LIKE sfba_t.sfba028,
   sfba001 LIKE sfba_t.sfba001,
   sfba001_desc LIKE type_t.chr80,   
   sfba001_desc1 LIKE type_t.chr80,   
   sfba026 LIKE sfba_t.sfba026,
   sfba027 LIKE sfba_t.sfba027,
   sfba_ooff013 LIKE ooff_t.ooff013
       END RECORD


#模組變數(Module Variables)
DEFINE g_sfaa_m          type_g_sfaa_m
DEFINE g_sfaa_m_t        type_g_sfaa_m

DEFINE g_sfaadocno_t     LIKE sfaa_t.sfaadocno

DEFINE g_sfab_d          DYNAMIC ARRAY OF type_g_sfab_d
DEFINE g_sfab_d_t        type_g_sfab_d
DEFINE g_sfac_d          DYNAMIC ARRAY OF type_g_sfac_d
DEFINE g_sfac_d_t        type_g_sfac_d
DEFINE g_sfad_d          DYNAMIC ARRAY OF type_g_sfad_d
DEFINE g_sfad_d_t        type_g_sfad_d
DEFINE g_sfae_d          DYNAMIC ARRAY OF type_g_sfae_d
DEFINE g_sfae_d_t        type_g_sfae_d
DEFINE g_sfaf_d          DYNAMIC ARRAY OF type_g_sfaf_d
DEFINE g_sfaf_d_t        type_g_sfaf_d
DEFINE g_sfba_d          DYNAMIC ARRAY OF type_g_sfba_d
DEFINE g_sfba_d_t        type_g_sfba_d


DEFINE g_browser    DYNAMIC ARRAY OF RECORD    #資料瀏覽之欄位
         b_statepic     LIKE type_t.chr50,
            b_sfaadocno LIKE sfaa_t.sfaadocno,
            b_sfaadocno_desc LIKE type_t.chr80,
      b_sfaa001 LIKE sfaa_t.sfaa001,
      b_sfaadocdt LIKE sfaa_t.sfaadocdt,
      b_sfaa002 LIKE sfaa_t.sfaa002,
      b_sfaa002_desc LIKE oofa_t.oofa011,
      b_sfaa003 LIKE sfaa_t.sfaa003,
      b_sfaa057 LIKE sfaa_t.sfaa057,
      b_sfaa004 LIKE sfaa_t.sfaa004,
      b_sfaa010 LIKE sfaa_t.sfaa010,
      b_sfaa010_desc LIKE imaal_t.imaal003,
      b_sfaa010_desc_1 LIKE imaal_t.imaal004,
      b_sfaa012 LIKE sfaa_t.sfaa012
         #,rank           LIKE type_t.num10
      END RECORD

DEFINE g_browser_f  RECORD    #資料瀏覽之欄位
         b_statepic     LIKE type_t.chr50,
            b_sfaadocno LIKE sfaa_t.sfaadocno,
            b_sfaadocno_desc LIKE type_t.chr80,
      b_sfaa001 LIKE sfaa_t.sfaa001,
      b_sfaadocdt LIKE sfaa_t.sfaadocdt,
      b_sfaa002 LIKE sfaa_t.sfaa002,
      b_sfaa002_desc LIKE oofa_t.oofa011,
      b_sfaa003 LIKE sfaa_t.sfaa003,
      b_sfaa057 LIKE sfaa_t.sfaa057,
      b_sfaa004 LIKE sfaa_t.sfaa004,
      b_sfaa010 LIKE sfaa_t.sfaa010,
      b_sfaa010_desc LIKE imaal_t.imaal003,
      b_sfaa010_desc_1 LIKE imaal_t.imaal004,
      b_sfaa012 LIKE sfaa_t.sfaa012
         #,rank           LIKE type_t.num10
      END RECORD

#無單頭append欄位定義
#無單身append欄位定義

DEFINE g_wc                  STRING
DEFINE g_wc_t                STRING
DEFINE g_wc2                 STRING                          #單身CONSTRUCT結果
DEFINE g_wc2_table1          STRING
DEFINE g_wc_sfab             STRING
DEFINE g_wc_sfac             STRING
DEFINE g_wc_sfad             STRING
DEFINE g_wc_sfae             STRING
DEFINE g_wc_sfaf             STRING
DEFINE g_wc2_extend          STRING
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING

DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10
DEFINE g_jump                LIKE type_t.num10
DEFINE g_no_ask              LIKE type_t.num5
DEFINE g_rec_b               LIKE type_t.num5
DEFINE g_rec_b_sfab          LIKE type_t.num5
DEFINE g_rec_b_sfac          LIKE type_t.num5
DEFINE g_rec_b_sfad          LIKE type_t.num5
DEFINE g_rec_b_sfae          LIKE type_t.num5
DEFINE g_rec_b_sfaf          LIKE type_t.num5
DEFINE l_ac                  LIKE type_t.num5
DEFINE g_curr_diag           ui.Dialog                     #Current Dialog

DEFINE g_pagestart           LIKE type_t.num5
DEFINE gwin_curr             ui.Window                     #Current Window
DEFINE gfrm_curr             ui.Form                       #Current Form
DEFINE g_page_action         STRING                        #page action
DEFINE g_header_hidden       LIKE type_t.num5              #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5              #隱藏工作Panel
DEFINE g_page                STRING                        #第幾頁
DEFINE g_state               STRING

DEFINE g_detail_cnt          LIKE type_t.num5              #單身總筆數
DEFINE g_detail_idx          LIKE type_t.num5              #單身目前所在筆數
DEFINE g_detail_idx2         LIKE type_t.num5              #單身2目前所在筆數
DEFINE g_browser_cnt         LIKE type_t.num5              #Browser總筆數
DEFINE g_browser_idx         LIKE type_t.num5              #Browser目前所在筆數
DEFINE g_temp_idx            LIKE type_t.num5              #Browser目前所在筆數(暫存用)

DEFINE g_searchcol           STRING                        #查詢欄位代碼
DEFINE g_searchstr           STRING                        #查詢欄位字串
DEFINE g_order               STRING                        #查詢排序欄位

DEFINE g_current_row         LIKE type_t.num5              #Browser所在筆數
DEFINE g_current_sw          BOOLEAN                       #Browser所在筆數用開關
DEFINE g_current_page        LIKE type_t.num5              #目前所在頁數
DEFINE g_insert              LIKE type_t.chr5              #是否導到其他page

DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys               DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak           DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_bfill               LIKE type_t.chr5              #是否刷新單身
DEFINE g_error_show          LIKE type_t.num5

DEFINE g_wc_frozen           STRING                        #凍結欄位使用
DEFINE g_chk                 BOOLEAN                       #助記碼判斷用
DEFINE g_default             BOOLEAN                       #是否有外部參數查詢
DEFINE g_master_insert       BOOLEAN                       #確認單頭資料是否寫入
{</Module define>}]]>
  </point>
  <point name="global.import" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[IMPORT util]]>
  </point>
  <point name="global.variable" order="" ver="6" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[DEFINE g_flag1               LIKE type_t.chr1 
DEFINE g_flag_date           LIKE type_t.chr1
DEFINE g_inam                DYNAMIC ARRAY OF RECORD   #記錄產品特徵
           inam001           LIKE inam_t.inam001,
           inam002           LIKE inam_t.inam002,
           inam004           LIKE inam_t.inam004
                             END RECORD
DEFINE g_inam004_sum         LIKE sfaa_t.sfaa012

DEFINE g_detail_d            DYNAMIC ARRAY OF RECORD
            sel              LIKE type_t.chr1,
            b_sfcbdocno      LIKE sfcb_t.sfcbdocno,
            b_sfcb001        LIKE sfcb_t.sfcb001, 
            b_sfcb002        LIKE sfcb_t.sfcb002, 
            b_sfaa003        LIKE sfaa_t.sfaa003,
            b_sfaa002        LIKE sfaa_t.sfaa002,
            b_sfaa002_desc   LIKE type_t.chr500,
            b_sfaa010        LIKE sfaa_t.sfaa010,   
            b_sfaa010_desc1  LIKE imaal_t.imaal003,
            b_sfaa010_desc2  LIKE imaal_t.imaal004,                                                                  
            b_sfcb003        LIKE sfcb_t.sfcb003, 
            b_sfcb003_desc   LIKE type_t.chr500,
            b_sfcb004        LIKE sfcb_t.sfcb004, 
            b_sfcb020        LIKE sfcb_t.sfcb020, 
            b_sfcb020_desc   LIKE type_t.chr500,
            b_tot_qty        LIKE sfaa_t.sfaa012,
            b_carry_qty      LIKE sfaa_t.sfaa012,
            b_sfcb013        LIKE sfcb_t.sfcb013, 
            b_sfcb013_desc   LIKE type_t.chr500,
            b_sfcb044        LIKE sfcb_t.sfcb044, 
            b_sfcb045        LIKE sfcb_t.sfcb045, 
            b_pmdl017        LIKE pmdl_t.pmdl017,
            b_pmdl017_desc   LIKE type_t.chr500,
            b_pmdl015        LIKE pmdl_t.pmdl015,
            b_pmdl015_desc   LIKE type_t.chr500,
            b_exrate         LIKE ooan_t.ooan005,
            b_pmdl011        LIKE pmdl_t.pmdl011,
            b_pmdl011_desc   LIKE type_t.chr500,
            b_price          LIKE pmdn_t.pmdn015
          # b_pmal002        LIKE pmal_t.pmal002
                             END RECORD  
DEFINE g_arr1                DYNAMIC ARRAY OF RECORD
            sfcbdocno        LIKE sfcb_t.sfcbdocno,
            sfaa010          LIKE sfaa_t.sfaa010,
            sfcb001          LIKE sfcb_t.sfcb001,
            sfcb002          LIKE sfcb_t.sfcb002,
            sfcb003          LIKE sfcb_t.sfcb003,
            sfcb004          LIKE sfcb_t.sfcb004,
            sfcb020          LIKE sfcb_t.sfcb020,
            carry_qty        LIKE sfaa_t.sfaa012,
            sfcb013          LIKE sfcb_t.sfcb013,
            sfcb044          LIKE sfcb_t.sfcb044,
            sfcb045          LIKE sfcb_t.sfcb045,
            pmdl017          LIKE pmdl_t.pmdl017,
            pmdl015          LIKE pmdl_t.pmdl015,
            exrate           LIKE ooan_t.ooan005,
            pmdl011          LIKE pmdl_t.pmdl011,
            price            LIKE pmdn_t.pmdn015
          #  pmal002          LIKE pmal_t.pmal002
                             END RECORD

DEFINE g_arr2                DYNAMIC ARRAY OF RECORD
            sfacdocno        LIKE sfac_t.sfacdocno,
            sfac006          LIKE sfac_t.sfac006,
            carry_qty        LIKE sfac_t.sfac003
                             END RECORD 
DEFINE g_pmal                DYNAMIC ARRAY OF RECORD
            b_sfcb013        LIKE pmdl_t.pmdl004,
            pmal002          LIKE pmal_t.pmal002
                             END RECORD
                            ]]>
  </point>
  <point name="idx_chk.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="init.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="init.init" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="input.a.page1.imaf013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.number1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.number2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.replace" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.page1.sfba028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL cl_set_comp_entry("sfaa006,sfaa007,sfaa008",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' THEN 
               CALL cl_set_comp_entry("sfaa006,sfaa007,sfaa008",FALSE)
            END IF
            
            #當為MULTI時，先開啟多訂單來源產生子畫面，產生完後再進入工單來源頁籤
            IF g_sfaa_m.sfaa005 = '1' THEN 
            
            END IF
            ]]>
  </point>
  <point name="input.a.sfaa006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #當等於訂單、銷售合約、計畫等，檢查是否存在來源資料裡
            IF NOT cl_null(g_sfaa_m.sfaa006) THEN
               IF g_sfaa_m.sfaa005 = '2' THEN
               END IF 
               IF g_sfaa_m.sfaa005 = '3' THEN
               END IF
               IF g_sfaa_m.sfaa005 = '4' THEN
               END IF
            END IF 
            
            #带值
            IF g_sfaa_m.sfaa005 MATCHES '[234]' THEN
               IF NOT cl_null(g_sfaa_m.sfaa006) AND NOT cl_null(g_sfaa_m.sfaa007) AND NOT cl_null(g_sfaa_m.sfaa008) THEN
               END IF 
            END IF 
            ]]>
  </point>
  <point name="input.a.sfaa007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #當等於訂單、銷售合約、計畫等，檢查是否存在來源資料裡
            IF NOT cl_null(g_sfaa_m.sfaa007) THEN
               IF g_sfaa_m.sfaa005 = '2' THEN
               END IF 
               IF g_sfaa_m.sfaa005 = '3' THEN
               END IF
               IF g_sfaa_m.sfaa005 = '4' THEN
               END IF
            END IF 
            
            #带值
            IF g_sfaa_m.sfaa005 MATCHES '[234]' THEN
               IF NOT cl_null(g_sfaa_m.sfaa006) AND NOT cl_null(g_sfaa_m.sfaa007) AND NOT cl_null(g_sfaa_m.sfaa008) THEN
               END IF 
            END IF]]>
  </point>
  <point name="input.a.sfaa008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #當等於訂單、銷售合約、計畫等，檢查是否存在來源資料裡
            IF NOT cl_null(g_sfaa_m.sfaa008) THEN
               IF g_sfaa_m.sfaa005 = '2' THEN
               END IF 
               IF g_sfaa_m.sfaa005 = '3' THEN
               END IF
               IF g_sfaa_m.sfaa005 = '4' THEN
               END IF
            END IF 
            
            #带值
            IF g_sfaa_m.sfaa005 MATCHES '[234]' THEN
               IF NOT cl_null(g_sfaa_m.sfaa006) AND NOT cl_null(g_sfaa_m.sfaa007) AND NOT cl_null(g_sfaa_m.sfaa008) THEN
               END IF 
            END IF]]>
  </point>
  <point name="input.a.sfaa011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa030" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa047" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa048" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa049" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa050" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa056" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa057" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaa062" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaadocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.a.sfaastus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.after_set_entry" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="input.b.page1.imaf013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.number1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.number2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.replace" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfba028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.page1.sfbaseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL cl_set_comp_entry("sfaa006",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' THEN 
               CALL cl_set_comp_entry("sfaa006",FALSE)
            END IF           ]]>
  </point>
  <point name="input.b.sfaa007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL cl_set_comp_entry("sfaa007",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' THEN 
               CALL cl_set_comp_entry("sfaa007",FALSE)
            END IF  ]]>
  </point>
  <point name="input.b.sfaa008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL cl_set_comp_entry("sfaa008",TRUE)
            IF g_sfaa_m.sfaa005 = '0' OR g_sfaa_m.sfaa005 = '1' THEN 
               CALL cl_set_comp_entry("sfaa008",FALSE)
            END IF  ]]>
  </point>
  <point name="input.b.sfaa009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            CALL cl_set_comp_entry("sfaa010",TRUE)
            IF g_sfaa_m.sfaa005 MATCHES '[234]' THEN 
               CALL cl_set_comp_entry("sfaa010",FALSE)
            END IF ]]>
  </point>
  <point name="input.b.sfaa011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa029" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa030" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa047" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa048" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa049" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa050" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa056" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa057" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa058" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaa062" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaadocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaadocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.b.sfaastus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.before_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="input.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="input.body.a_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                  ]]>
  </point>
  <point name="input.body.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.body.a_insert2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.body.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.body.after_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.body.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.body.after_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.body.b_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.body.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.body.before_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.body.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.body.m_delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.body.m_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.c.a1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.a2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.a3" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.a4" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.a5" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.a6" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.a7" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.a8" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.ooff013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.imaf013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.number1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.number2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.replace" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfba028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfbaseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.page1.sfbaseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa030" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa047" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa048" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa049" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa050" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa056" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa057" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa058" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaa062" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaadocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaastus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfab001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfab002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfab003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfab004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfab005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfab006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfac001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfac002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfac003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfac004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfac005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfad001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfad002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfad003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfae001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfae002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfae003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfae004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfae005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfae006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaeseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.c.sfaf001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE  l_ooef004       LIKE ooef_t.ooef004
   DEFINE  l_sql           STRING
   DEFINE  l_bmaa001       LIKE bmaa_t.bmaa001
   DEFINE  l_bmaastus      LIKE bmaa_t.bmaastus   ]]>
  </point>
  <point name="input.g.page1.imaf013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.number1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.number2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.replace" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba012" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfba028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfbaseq" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.page1.sfbaseq1" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa008" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa009" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa010" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa011" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa013" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa014" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa015" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa016" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa017" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa018" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa019" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa020" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa021" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa022" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa023" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa024" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa025" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa026" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa027" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa028" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa029" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa030" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa031" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa032" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa033" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa034" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa035" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa036" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa037" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa038" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa039" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa040" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa041" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa042" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa043" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa044" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa045" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa046" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa047" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa048" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa049" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa050" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa051" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa055" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa056" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa057" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa058" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa059" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa060" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa061" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaa062" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaadocdt" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaadocno" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.g.sfaastus" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.head.a_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                  #新增sfab_t
                  INSERT INTO sfab_t(sfabent,sfabsite,sfabdocno,sfab001,sfab002,sfab003,sfab004,sfab005,sfab006) 
                  VALUES (g_enterprise, g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfab001,g_sfaa_m.sfab002,g_sfaa_m.sfab003,g_sfaa_m.sfab004,g_sfaa_m.sfab005,g_sfaa_m.sfab006)
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "ins sfab_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
  
                     CONTINUE DIALOG
                  END IF
                  
                  #新增sfac_t
                  INSERT INTO sfac_t(sfacent,sfacsite,sfacdocno,sfac001,sfac002,sfac003,sfac004,sfac005) 
                  VALUES (g_enterprise, g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfac001,g_sfaa_m.sfac002,g_sfaa_m.sfac003,g_sfaa_m.sfac004,g_sfaa_m.sfac005)
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "ins sfac_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
  
                     CONTINUE DIALOG
                  END IF
                  
                  #新增sfad_t
                  INSERT INTO sfad_t(sfadent,sfadsite,sfaddocno,sfad001,sfad002,sfad003) 
                  VALUES (g_enterprise, g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfad001,g_sfaa_m.sfad002,g_sfaa_m.sfad003)
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "ins sfad_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
  
                     CONTINUE DIALOG
                  END IF
                  
                  #新增sfae_t
                  INSERT INTO sfae_t(sfaeent,sfaesite,sfaedocno,sfaeseq,sfae001,sfae002,sfae003,sfae004,sfae005,sfae006) 
                  VALUES (g_enterprise, g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfaeseq,g_sfaa_m.sfae001,g_sfaa_m.sfae002,g_sfaa_m.sfae003,g_sfaa_m.sfae004,g_sfaa_m.sfae005,g_sfaa_m.sfae006)
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "ins sfae_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
  
                     CONTINUE DIALOG
                  END IF
                  
                  #新增sfaf_t
                  INSERT INTO sfaf_t(sfafent,sfafsite,sfafdocno,sfaf001) 
                  VALUES (g_enterprise, g_site,g_sfaa_m.sfaadocno,g_sfaa_m.sfaf001)
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = SQLCA.sqlcode
                     LET g_errparam.extend = "ins sfaf_t"
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
  
                     CONTINUE DIALOG
                  END IF
                  
                  ]]>
  </point>
  <point name="input.head.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                 ]]>
  </point>
  <point name="input.head.b_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                  ]]>
  </point>
  <point name="input.head.b_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.head.m_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[                  ]]>
  </point>
  <point name="input.head.m_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="input.m.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="input.more_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#     INPUT ARRAY g_sfab FROM s_sfab.*
#         ATTRIBUTE(COUNT = g_rec_b1,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
#                 INSERT ROW = l_allow_insert, 
#                 DELETE ROW = l_allow_delete,
#                 APPEND ROW = l_allow_insert)
#     END INPUT
#     INPUT ARRAY g_sfac FROM s_sfac.*
#         ATTRIBUTE(COUNT = g_rec_b2,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
#                 INSERT ROW = l_allow_insert, 
#                 DELETE ROW = l_allow_delete,
#                 APPEND ROW = l_allow_insert)
#     END INPUT
#     INPUT ARRAY g_sfad FROM s_sfad.*
#         ATTRIBUTE(COUNT = g_rec_b3,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
#                 INSERT ROW = l_allow_insert, 
#                 DELETE ROW = l_allow_delete,
#                 APPEND ROW = l_allow_insert)
#     END INPUT
#     INPUT ARRAY g_sfae FROM s_sfae.*
#         ATTRIBUTE(COUNT = g_rec_b4,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
#                 INSERT ROW = l_allow_insert, 
#                 DELETE ROW = l_allow_delete,
#                 APPEND ROW = l_allow_insert)
#     END INPUT
#     INPUT ARRAY g_sfaf FROM s_sfaf.*
#         ATTRIBUTE(COUNT = g_rec_b5,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS, 
#                 INSERT ROW = l_allow_insert, 
#                 DELETE ROW = l_allow_delete,
#                 APPEND ROW = l_allow_insert)
#     END INPUT]]>
  </point>
  <point name="insert.after_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="insert.default" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      LET g_sfaa_m.sfaadocdt = g_today
      LET g_sfaa_m.sfaa002 = g_user
      LET g_sfaa_m.sfaa004 = '1']]>
  </point>
  <point name="insert.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="insert_b.after_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="insert_b.before_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="insert_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="insert_b.m_insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="lock_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="main.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="main.define_sql" order="" ver="6" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         LET g_forupd_sql = "SELECT sfaadocno,sfaa001,sfaadocdt,sfaa003,sfaa057,'',sfaa002,'',sfaa004,sfaastus,sfaa005,sfaa006,sfaa007,sfaa008,sfaa063,sfaa009,'',sfaa022,sfaa023,sfaa024,sfaa064,sfaa021,sfaa025,sfaa010,sfaa011,'','',sfaa012,sfaa013,sfaa058,sfaa060,sfaa061,sfaa016,'',sfaa017,'',sfaa018,sfaa019,sfaa020,sfaa014,sfaa028,sfaa015,sfaa029,sfaa026,sfaa030,'',sfaa031,sfaa062,sfaa032,sfaa068,sfaa033,sfaa034,sfaa035,sfaa059,sfaa036,sfaa037,sfaa038,sfaa039,sfaa040,sfaa041,sfaa042,sfaa043,sfaa044,sfaa069,sfaa070,sfaa045,sfaa049,sfaa046,sfaa050,sfaa047,sfaa051,sfaa048,sfaa065,sfaa055,sfaa056,'',sfaaownid,'',sfaaowndp,'',sfaacrtid,'',sfaacrtdp,'',sfaacrtdt,sfaamodid,'',sfaamoddt,sfaacnfid,'',sfaacnfdt,sfaapstid,'',sfaapstdt FROM sfaa_t WHERE sfaaent= ? AND sfaasite= ? AND sfaadocno=? FOR UPDATE"]]>
  </point>
  <point name="main.exit" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="main.init" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="main.servicecall" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="menu.bpm_status" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="menu.delete" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="menu.insert" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="menu.modify" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="menu.modify_detail" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="menu.output" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="menu.query" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="menu.reproduce" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="modify.after_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="modify.before_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="modify.body.a_fk_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="modify.body.b_fk_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="modify.body.m_fk_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="modify.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="query.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="reproduce.after_reproduce" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="reproduce.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="reproduce.head.b_input" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_entry.after_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_entry.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_entry.field_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="set_entry_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_entry_b.set_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_no_entry.after_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_no_entry.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_no_entry.field_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="set_no_entry_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="set_no_entry_b.set_no_entry_b" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="show.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="show.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="show.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="statechange.a_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="statechange.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="statechange.b_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="statechange.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="statechange.before_menu" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="statechange.closed" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.closed_irregular" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.costing_closed" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.invalid" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.more_control" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="statechange.open" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.rejection" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.released" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.signing" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="statechange.withdraw" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="ui_browser_refresh.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="ui_detailshow.after" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="ui_detailshow.before" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="ui_detailshow.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="ui_dialog.before_dialog" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="ui_dialog.before_dialog2" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="ui_dialog.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="ui_dialog.more_displayarray" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[         ]]>
  </point>
  <point name="ui_dialog.page1.action" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            ]]>
  </point>
  <point name="ui_dialog.page1.before_row" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[               ]]>
  </point>
  <point name="ui_headershow.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="unlock_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="update_b.after_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="update_b.before_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <point name="update_b.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   ]]>
  </point>
  <point name="update_b.m_update" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[      ]]>
  </point>
  <section id="asft300.description" ver="147" status="" src="s" readonly="">
    <![CDATA[#應用 a00 樣板自動產生(Version:1)
#+ Version..: T100-ERP-1.00.00(SD版次:9,PR版次:9) Build-000659
#+ 
#+ Filename...: asft300
#+ Description: 工單維護作業
#+ Creator....: 01258(2013-11-15 14:38:20)
#+ Modifier...: 01258(2015-07-03 09:58:15) -SD/PR-
]]>
  </section>
  <section id="asft300.global" ver="4" status="" src="s" readonly="">
    <![CDATA[#應用 i00 樣板自動產生(Version:3)
{<point name="global.memo" />}
 
IMPORT os
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:free_style模組變數(Module Variable)
{<point name="free_style.variable"/>}
#end add-point
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable" edit="s"/>}
#end add-point
 
#add-point:自定義客戶專用模組變數(Module Variable)
{<point name="global.variable_customerization" edit="c"/>}
#end add-point
]]>
  </section>
  <section id="asft300.main" ver="3" status="" src="s" readonly="">
    <![CDATA[#+ 作業開始
MAIN
   #add-point:main段define (標準程式用)
   {<point name="main.define" edit="s"/>}
   #end add-point    
   #add-point:main段define (客製程式用)
   {<point name="main.define_customerization" edit="c"/>}
   #end add-point
 
   #定義在其他link的程式則無效
   WHENEVER ERROR CALL cl_err_msg_log
 
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("asf","")
 
   #add-point:作業初始化
   {<point name="main.init"/>}
   #end add-point
 
   #add-point:SQL_define
   {<point name="main.define_sql" />}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)    #轉換不同資料庫語法
   DECLARE asft300_cl CURSOR FROM g_forupd_sql 
   
   IF g_bgjob = "Y" THEN
 
      #add-point:Service Call
      {<point name="main.servicecall" />}
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_asft300 WITH FORM cl_ap_formpath("asf",g_code)
 
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
 
      #程式初始化
      CALL asft300_init()
 
      #進入選單 Menu (='N')
      CALL asft300_ui_dialog()
   
      #畫面關閉
      CLOSE WINDOW w_asft300
   END IF
 
   #add-point:作業離開前
   {<point name="main.exit" />}
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
 
END MAIN
]]>
  </section>
  <section id="asft300.other_function" ver="1" status="" src="s" readonly="">
    <![CDATA[#add-point:自定義元件(Function)
{<point name="other.function"/>}
#end add-point
]]>
  </section>
</add_points>
