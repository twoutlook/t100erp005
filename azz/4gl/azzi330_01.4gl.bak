#該程式已解開Section, 不再透過樣板產出!
{<section id="azzi330_01.description" >}
#應用 a00 樣板自動產生(Version:1)
#+ Version..: T100-ERP-1.00.00(SD版次:5,PR版次:5) Build-000165
#+ 
#+ Filename...: azzi330_01
#+ Description: 報表表頭設定作業
#+ Creator....: 02716(2014-09-25 19:10:12)
#+ Modifier...: 04010(2015-06-12 16:09:04) -SD/PR- 04010
 
{</section>}
 
{<section id="azzi330_01.global" >}
#應用 t01 樣板自動產生(Version:34)
#+ Modifier...: No.150611-00032#5 15/06/12 cynthia  表尾功能
#+ Modifier...: No.150909-00019#1 15/09/15 cynthia  列印條件
        
IMPORT os
IMPORT util
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目

#end add-point
 
SCHEMA ds 
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔

#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_gzgj_m        RECORD
       gzgj001 LIKE gzgj_t.gzgj001, 
   gzgjl003 LIKE type_t.chr500, 
   gzgj002 LIKE gzgj_t.gzgj002, 
   gzgj010 LIKE gzgj_t.gzgj010,   #150611-00032#5 add
   gzgj003 LIKE gzgj_t.gzgj003, 
   gzgj004 LIKE gzgj_t.gzgj004, 
   gzgj005 LIKE gzgj_t.gzgj005, 
   gzgj006 LIKE gzgj_t.gzgj006, 
   gzgj007 LIKE gzgj_t.gzgj007, 
   gzgj008 LIKE gzgj_t.gzgj008, 
   gzgj009 LIKE gzgj_t.gzgj009, 
   gzgjstus LIKE gzgj_t.gzgjstus, 
   gzgjownid LIKE gzgj_t.gzgjownid, 
   gzgjownid_desc LIKE type_t.chr80, 
   gzgjowndp LIKE gzgj_t.gzgjowndp, 
   gzgjowndp_desc LIKE type_t.chr80, 
   gzgjcrtid LIKE gzgj_t.gzgjcrtid, 
   gzgjcrtid_desc LIKE type_t.chr80, 
   gzgjcrtdp LIKE gzgj_t.gzgjcrtdp, 
   gzgjcrtdp_desc LIKE type_t.chr80, 
   gzgjcrtdt LIKE gzgj_t.gzgjcrtdt, 
   gzgjmodid LIKE gzgj_t.gzgjmodid, 
   gzgjmodid_desc LIKE type_t.chr80, 
   gzgjmoddt LIKE gzgj_t.gzgjmoddt
   #150611-00032#5 add(s)
   ,l_gzgj010 LIKE gzgj_t.gzgj010, 
   l_gzgj003 LIKE gzgj_t.gzgj003, 
   l_gzgj004 LIKE gzgj_t.gzgj004, 
   l_gzgj005 LIKE gzgj_t.gzgj005, 
   l_gzgj006 LIKE gzgj_t.gzgj006, 
   l_gzgj007 LIKE gzgj_t.gzgj007, 
   l_gzgj008 LIKE gzgj_t.gzgj008,
   l_gzgj009 LIKE gzgj_t.gzgj009
   #150611-00032#5 add(e)
       END RECORD
 
#單身 type 宣告
PRIVATE TYPE type_g_gzgk_d        RECORD
       gzgk003 LIKE gzgk_t.gzgk003, 
   gzgk004 LIKE gzgk_t.gzgk004, 
   gzgk005 LIKE gzgk_t.gzgk005, 
   gzgk005_desc LIKE type_t.chr500, 
   gzgk00601 LIKE type_t.chr10, 
   gzgk00602 LIKE type_t.chr10, 
   gzgk00603 LIKE type_t.chr10, 
   gzgk00604 LIKE type_t.chr10
       END RECORD
 
#150611-00032#5 add(s)
#單身 type 宣告
PRIVATE TYPE type_g_gzgk_1_d        RECORD
   l_gzgk003 LIKE gzgk_t.gzgk003, 
   l_gzgk004 LIKE gzgk_t.gzgk004, 
   l_gzgk005 LIKE gzgk_t.gzgk005, 
   l_gzgk005_desc LIKE type_t.chr500, 
   l_gzgk00601 LIKE type_t.chr10, 
   l_gzgk00602 LIKE type_t.chr10, 
   l_gzgk00603 LIKE type_t.chr10, 
   l_gzgk00604 LIKE type_t.chr10
       END RECORD
#150611-00032#5 add(e)
 
PRIVATE TYPE type_browser RECORD
         b_statepic     LIKE type_t.chr50,
         b_gzgj001 LIKE gzgj_t.gzgj001,
         b_gzgj002 LIKE gzgj_t.gzgj002
         ,b_gzgj010 LIKE gzgj_t.gzgj010   #150611-00032#5 add
       END RECORD
       
#模組變數(Module Variables)
DEFINE g_gzgj_m          type_g_gzgj_m
DEFINE g_gzgj_m_t        type_g_gzgj_m
DEFINE g_gzgj_m_o        type_g_gzgj_m
DEFINE g_gzgj_m_mask_o   type_g_gzgj_m #轉換遮罩前資料
DEFINE g_gzgj_m_mask_n   type_g_gzgj_m #轉換遮罩後資料
 
DEFINE g_gzgj001_t       LIKE gzgj_t.gzgj001
DEFINE g_gzgj002_t       LIKE gzgj_t.gzgj002
DEFINE g_gzgj010_t       LIKE gzgj_t.gzgj010      #150611-00032#5 add
DEFINE g_l_gzgj010_t     LIKE gzgj_t.gzgj010    #150611-00032#5 add
 
 
DEFINE g_gzgk_d          DYNAMIC ARRAY OF type_g_gzgk_d
DEFINE g_gzgk_d_t        type_g_gzgk_d
DEFINE g_gzgk_d_o        type_g_gzgk_d
DEFINE g_gzgk_d_mask_o   DYNAMIC ARRAY OF type_g_gzgk_d #轉換遮罩前資料
DEFINE g_gzgk_d_mask_n   DYNAMIC ARRAY OF type_g_gzgk_d #轉換遮罩後資料
 
#150611-00032#5 add(s)
DEFINE g_gzgk_1_d          DYNAMIC ARRAY OF type_g_gzgk_1_d
DEFINE g_gzgk_1_d_t        type_g_gzgk_1_d
DEFINE g_gzgk_1_d_o        type_g_gzgk_1_d
DEFINE g_gzgk_1_d_mask_o   DYNAMIC ARRAY OF type_g_gzgk_1_d #轉換遮罩前資料
DEFINE g_gzgk_1_d_mask_n   DYNAMIC ARRAY OF type_g_gzgk_1_d #轉換遮罩後資料
#150611-00032#5 add(e)
 
DEFINE g_browser         DYNAMIC ARRAY OF type_browser
DEFINE g_browser_f       DYNAMIC ARRAY OF type_browser
 
DEFINE g_master_multi_table_t    RECORD
      gzgjl001 LIKE gzgjl_t.gzgjl001,
      gzgjl003 LIKE gzgjl_t.gzgjl003
      END RECORD
 
DEFINE g_wc                  STRING
DEFINE g_wc_t                STRING
DEFINE g_wc2                 STRING                          #單身CONSTRUCT結果
DEFINE g_wc2_table1          STRING
DEFINE g_wc2_table2          STRING   #150611-00032#5 add
 
DEFINE g_wc2_extend          STRING
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING
 
DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10     
DEFINE g_jump                LIKE type_t.num10        
DEFINE g_no_ask              LIKE type_t.num5        
DEFINE g_rec_b               LIKE type_t.num10           
DEFINE l_ac                  LIKE type_t.num10    
DEFINE g_curr_diag           ui.Dialog                     #Current Dialog
    
DEFINE g_pagestart           LIKE type_t.num10           
DEFINE gwin_curr             ui.Window                     #Current Window
DEFINE gfrm_curr             ui.Form                       #Current Form
DEFINE g_page_action         STRING                        #page action
DEFINE g_header_hidden       LIKE type_t.num5              #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5              #隱藏工作Panel
DEFINE g_page                STRING                        #第幾頁
DEFINE g_state               STRING       
DEFINE g_header_cnt          LIKE type_t.num10
DEFINE g_detail_cnt          LIKE type_t.num10              #單身總筆數
DEFINE g_detail_idx          LIKE type_t.num10              #單身目前所在筆數
DEFINE g_detail_idx2         LIKE type_t.num10              #單身2目前所在筆數
DEFINE g_browser_cnt         LIKE type_t.num10              #Browser總筆數
DEFINE g_browser_idx         LIKE type_t.num10              #Browser目前所在筆數
DEFINE g_temp_idx            LIKE type_t.num10              #Browser目前所在筆數(暫存用)
DEFINE g_order               STRING                        #查詢排序欄位
                                                        
DEFINE g_current_row         LIKE type_t.num10              #Browser所在筆數
DEFINE g_current_sw          BOOLEAN                       #Browser所在筆數用開關
DEFINE g_current_page        LIKE type_t.num10              #目前所在頁數
DEFINE g_insert              LIKE type_t.chr5              #是否導到其他page
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys               DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak           DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_bfill               LIKE type_t.chr5              #是否刷新單身
DEFINE g_error_show          LIKE type_t.num5              #是否顯示筆數提示訊息
DEFINE g_master_insert       BOOLEAN                       #確認單頭資料是否寫入
 
DEFINE g_wc_frozen           STRING                        #凍結欄位使用
DEFINE g_chk                 BOOLEAN                       #助記碼判斷用
DEFINE g_aw                  STRING                        #確定當下點擊的單身
DEFINE g_default             BOOLEAN                       #是否有外部參數查詢
DEFINE g_log1                STRING                        #log用
DEFINE g_log2                STRING                        #log用
DEFINE g_loc                 LIKE type_t.chr5              #判斷游標所在位置
DEFINE g_add_browse          STRING                        #新增填充用WC
DEFINE g_update              BOOLEAN                       #確定單頭/身是否異動過
 
#add-point:自定義模組變數(Module Variable)
#屬性 type 宣告
 TYPE type_g_gzgk_att        RECORD
   gzgk001 LIKE gzgk_t.gzgk001, 
   gzgk002 LIKE gzgk_t.gzgk002, 
   gzgk003 LIKE gzgk_t.gzgk003, 
   gzgk004 LIKE gzgk_t.gzgk004, 
   gzgk007 LIKE gzgk_t.gzgk007, 
   gzgk008 LIKE gzgk_t.gzgk008, 
   gzgk009 LIKE gzgk_t.gzgk009,
   gzgk010 LIKE gzgk_t.gzgk010, 
   gzgk011 LIKE gzgk_t.gzgk011,
   gzgk012_id LIKE type_t.chr1,   
   gzgk012 LIKE gzgk_t.gzgk012,  
   gzgk013_id LIKE type_t.chr1,   
   gzgk013 LIKE gzgk_t.gzgk013
   ,gzgk014 LIKE gzgk_t.gzgk014   #150611-00032#5 add   
       END RECORD
DEFINE g_gzgk_att_m        type_g_gzgk_att
DEFINE g_gzgk_att_t        type_g_gzgk_att
DEFINE g_gzgk_att_o        type_g_gzgk_att

#150611-00032#5 add(s)
 TYPE type_g_gzgk_1_att        RECORD
   l_gzgk001 LIKE gzgk_t.gzgk001, 
   l_gzgk002 LIKE gzgk_t.gzgk002, 
   l_gzgk003 LIKE gzgk_t.gzgk003, 
   l_gzgk004 LIKE gzgk_t.gzgk004, 
   l_gzgk007 LIKE gzgk_t.gzgk007, 
   l_gzgk008 LIKE gzgk_t.gzgk008, 
   l_gzgk009 LIKE gzgk_t.gzgk009,
   l_gzgk010 LIKE gzgk_t.gzgk010, 
   l_gzgk011 LIKE gzgk_t.gzgk011,
   l_gzgk012_id LIKE type_t.chr1,   
   l_gzgk012 LIKE gzgk_t.gzgk012,  
   l_gzgk013_id LIKE type_t.chr1,   
   l_gzgk013 LIKE gzgk_t.gzgk013
   ,l_gzgk014 LIKE gzgk_t.gzgk014
       END RECORD
DEFINE g_gzgk_1_att_m        type_g_gzgk_1_att
DEFINE g_gzgk_1_att_t        type_g_gzgk_1_att
DEFINE g_gzgk_1_att_o        type_g_gzgk_1_att     
#150611-00032#5 add(e)
#end add-point
 
#add-point:自定義客戶專用模組變數(Module Variable)

#end add-point
 
#add-point:傳入參數說明(global.argv)

#end add-point
 
{</section>}
 
{<section id="azzi330_01.main" >}
#應用 a27 樣板自動產生(Version:4)
#+ 作業開始(子程式類型)
PUBLIC FUNCTION azzi330_01(--)
   #add-point:main段變數傳入
   
   #end add-point
   )
   #add-point:main段define
   
   #end add-point   
   #add-point:main段define(客製用)
   
   #end add-point   
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
 
   #add-point:作業初始化
   
   #end add-point
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define
   
   #end add-point
   LET g_forupd_sql = "SELECT gzgj001,'',gzgj002,gzgjstus,gzgj009,gzgj003,gzgj004,gzgj005,gzgj006,gzgj007, 
       gzgj008,'','','','','','','','','','','',gzgjownid,'',gzgjowndp,'',gzgjcrtid,'',gzgjcrtdp,'', 
       gzgjcrtdt,gzgjmodid,'',gzgjmoddt FROM gzgj_t WHERE gzgj001=? AND gzgj002=? FOR UPDATE"
   #add-point:SQL_define
   #150611-00032#5 add(s)
   LET g_forupd_sql = "SELECT gzgj001,'',gzgj002,gzgj010,gzgj003,gzgj004,gzgj005,gzgj006,gzgj007,gzgj008, 
       gzgj009,gzgjstus,gzgjownid,'',gzgjowndp,'',gzgjcrtid,'',gzgjcrtdp,'',gzgjcrtdt,gzgjmodid,'',gzgjmoddt
       FROM gzgj_t WHERE gzgj001=? AND gzgj002=? AND gzgj010=? FOR UPDATE"
   #150611-00032#5 add(e)       
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)   #轉換不同資料庫語法
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE azzi330_01_cl CURSOR FROM g_forupd_sql     # LOCK CURSOR
 
   LET g_sql = " SELECT t0.gzgj001,t0.gzgj002,t0.gzgjstus,t0.gzgj009,t0.gzgj003,t0.gzgj004,t0.gzgj005, 
       t0.gzgj006,t0.gzgj007,t0.gzgj008,t0.gzgjownid,t0.gzgjowndp,t0.gzgjcrtid,t0.gzgjcrtdp,t0.gzgjcrtdt, 
       t0.gzgjmodid,t0.gzgjmoddt",
               " FROM gzgj_t t0",
               " WHERE  t0.gzgj001 = ? AND t0.gzgj002 = ?"
   #add-point:SQL_define
   #150611-00032#5 add(s)
   LET g_sql = " SELECT t0.gzgj001,t0.gzgj002,t0.gzgj010,t0.gzgj003,t0.gzgj004,t0.gzgj005,t0.gzgj006, 
       t0.gzgj007,t0.gzgj008,t0.gzgj009,t0.gzgjstus,t0.gzgjownid,t0.gzgjowndp,t0.gzgjcrtid,t0.gzgjcrtdp, 
       t0.gzgjcrtdt,t0.gzgjmodid,t0.gzgjmoddt",
               " FROM gzgj_t t0",
               " WHERE  t0.gzgj001 = ? AND t0.gzgj002 = ? AND t0.gzgj010 = ?"
   #150611-00032#5 add(e)
   #end add-point
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   PREPARE azzi330_01_master_referesh FROM g_sql
   
 
 
   
   #畫面開啟 (identifier)
   OPEN WINDOW w_azzi330_01 WITH FORM cl_ap_formpath("azz","azzi330_01")
   
   #瀏覽頁簽資料初始化
   CALL cl_ui_init()
   
   #程式初始化
   CALL azzi330_01_init()   
 
   #進入選單 Menu (="N")
   CALL azzi330_01_ui_dialog() 
 
   #畫面關閉
   CLOSE WINDOW w_azzi330_01
 
   CLOSE azzi330_01_cl
   
   
 
   #add-point:離開前
   
   #end add-point
END FUNCTION
 
 
 
{</section>}
 
{<section id="azzi330_01.init" >}
#+ 瀏覽頁簽資料初始化
PRIVATE FUNCTION azzi330_01_init()
   #add-point:init段define
   
   #end add-point    
   #add-point:init段define(客製用)
   
   #end add-point    
 
   LET g_bfill       = "Y"
   LET g_detail_idx  = 1 #第一層單身指標
   LET g_detail_idx2 = 1 #第二層單身指標
   LET g_error_show  = 1
   LET l_ac = 1 #單身指標
      CALL cl_set_combo_scc_part('gzgjstus','50','N,Y,X')
 
      CALL cl_set_combo_scc('gzgj009','173') 
   CALL cl_set_combo_scc('gzgk009','149') 
   CALL cl_set_combo_scc('gzgk003','163') 
   CALL cl_set_combo_scc('gzgk004','162') 
 
   LET gwin_curr = ui.Window.getCurrent()  #取得現行畫面
   LET gfrm_curr = gwin_curr.getForm()     #取出物件化後的畫面物件
 
   #add-point:畫面資料初始化
   CALL cl_set_combo_scc('gzgk00601','161')  #第一欄
   CALL cl_set_combo_scc('gzgk00602','161')  #第二欄
   CALL cl_set_combo_scc('gzgk00603','161')  #第三欄
   CALL cl_set_combo_scc('gzgk00604','161')  #第四欄
   #CALL cl_set_combo_scc('gzgj009','149')  #LOGO位子   #141024 cynthia mark
   CALL cl_set_combo_scc('gzgj009','173')  #LOGO位子   #141024 cynthia add
   CALL cl_set_combo_lang("gzgj_t.gzgj002") #語言別
   CALL azzi330_01_set_combobox('gzgj003','162','')  #行數
   CALL azzi330_01_set_combobox('gzgj004','163','')  #欄數
#150611-00032#5 mark(s)   
#   CALL azzi330_01_set_combobox('gzgj005','163','')  #比例1
#   CALL azzi330_01_set_combobox('gzgj006','163','')  #比例2
#   CALL azzi330_01_set_combobox('gzgj007','163','')  #比例3
#   CALL azzi330_01_set_combobox('gzgj008','163','')  #比例4
#150611-00032#5 mark(e)   

#150611-00032#5 add(s)
   CALL azzi330_01_set_combobox('gzgj005','194','')  #比例1
   CALL azzi330_01_set_combobox('gzgj006','194','')  #比例2
   CALL azzi330_01_set_combobox('gzgj007','194','')  #比例3
   CALL azzi330_01_set_combobox('gzgj008','194','')  #比例4
   CALL cl_set_combo_scc('l_gzgk00601','161')  #第一欄
   CALL cl_set_combo_scc('l_gzgk00602','161')  #第二欄
   CALL cl_set_combo_scc('l_gzgk00603','161')  #第三欄
   CALL cl_set_combo_scc('l_gzgk00604','161')  #第四欄
   
   CALL azzi330_01_set_combobox('l_gzgj003','195','')  #行數
   CALL azzi330_01_set_combobox('l_gzgj004','163','')  #欄數
   CALL azzi330_01_set_combobox('l_gzgj005','194','')  #比例1
   CALL azzi330_01_set_combobox('l_gzgj006','194','')  #比例2
   CALL azzi330_01_set_combobox('l_gzgj007','194','')  #比例3
   CALL azzi330_01_set_combobox('l_gzgj008','194','')  #比例4
   LET g_gzgj_m.gzgj010 = '1'

   CALL azzi330_01_set_gzgk005_combo('gzgk005','1')
   CALL azzi330_01_set_gzgk005_combo('l_gzgk005','2')
#150611-00032#5 add(e)
   #end add-point
   
   #初始化搜尋條件
   CALL azzi330_01_default_search()
    
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.ui_dialog" >}
#+ 功能選單
PRIVATE FUNCTION azzi330_01_ui_dialog()
   DEFINE li_idx     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE lb_first   BOOLEAN
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE la_param   RECORD
          prog       STRING,
          actionid   STRING,
          background LIKE type_t.chr1,
          param      DYNAMIC ARRAY OF STRING
          END RECORD
   DEFINE ls_js      STRING
   DEFINE la_output  DYNAMIC ARRAY OF STRING   #報表元件鬆耦合使用
   #add-point:ui_dialog段define

   #end add-point
   #add-point:ui_dialog段define(客製用)

   #end add-point
   
   CALL cl_set_act_visible("accept,cancel", FALSE)
 
   
   #action default動作
   #應用 a42 樣板自動產生(Version:2)
   #進入程式時預設執行的動作
   CASE g_actdefault
      WHEN "insert"
         LET g_action_choice="insert"
         LET g_actdefault = ""
         IF cl_auth_chk_act("insert") THEN
            CALL azzi330_01_insert()
            #add-point:ON ACTION insert

            #END add-point
         END IF
 
      #add-point:action default自訂

      #end add-point
      OTHERWISE
   END CASE
 
 
   
   LET lb_first = TRUE
   
   #add-point:ui_dialog段before dialog 
#   CALL cl_set_act_visible("edit_att", FALSE)  #141002 add   #150611-00032#5 mark
   #end add-point
   
   WHILE TRUE 
   
      IF g_action_choice = "logistics" THEN
         #清除畫面及相關資料
         CLEAR FORM
         CALL g_browser.clear()       
         INITIALIZE g_gzgj_m.* TO NULL
         CALL g_gzgk_d.clear()
         CALL g_gzgk_1_d.clear()   #150611-00032#5 add
         
         LET g_wc  = ' 1=2'
         LET g_wc2 = ' 1=1'
         LET g_action_choice = ""
         CALL azzi330_01_init()
      END IF
   
            
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
    
         DISPLAY ARRAY g_gzgk_d TO s_detail1.* ATTRIBUTES(COUNT=g_rec_b) #page1  
    
            BEFORE ROW
               #顯示單身筆數
               CALL azzi330_01_idx_chk()
               #確定當下選擇的筆數
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_detail_idx = l_ac
               
               #add-point:page1, before row動作
               #150611-00032#5 add(s)
               IF NOT cl_null(g_gzgk_d[l_ac].gzgk00601) THEN
                  CALL azzi330_01_s01_field(1,g_gzgj_m.gzgj010)
               ELSE
                  IF NOT cl_null(g_gzgk_d[l_ac].gzgk00602) THEN
                     CALL azzi330_01_s01_field(2,g_gzgj_m.gzgj010)
                  ELSE
                     IF NOT cl_null(g_gzgk_d[l_ac].gzgk00603) THEN
                        CALL azzi330_01_s01_field(3,g_gzgj_m.gzgj010)
                     ELSE
                        IF NOT cl_null(g_gzgk_d[l_ac].gzgk00604) THEN                      
                           CALL azzi330_01_s01_field(4,g_gzgj_m.gzgj010)
                        ELSE
                           CALL azzi330_01_s01_field(0,g_gzgj_m.gzgj010)
                        END IF                        
                     END IF
                  END IF                  
               END IF               
               #150611-00032#5 add(e)
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_detail_idx)
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail1")
               LET g_current_page = 1
               #顯示單身筆數
               CALL azzi330_01_idx_chk()
               #add-point:page1自定義行為
 
               #end add-point
               
            #自訂ACTION(detail_show,page_1)
            
               
            #add-point:page1自定義行為
 
            #end add-point
               
         END DISPLAY
        
 
         
 
         
         #add-point:ui_dialog段自定義display array
#150611-00032#5 add(s)
         DISPLAY ARRAY g_gzgk_1_d TO s_detail2.* ATTRIBUTES(COUNT=g_rec_b) #page2  
    
            BEFORE ROW
               #顯示單身筆數
               CALL azzi330_01_idx_chk()
               #確定當下選擇的筆數
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_detail_idx2 = l_ac
               
               #add-point:page1, before row動作
               IF NOT cl_null(g_gzgk_1_d[l_ac].l_gzgk00601) THEN
                  CALL azzi330_01_s01_field(1,g_gzgj_m.l_gzgj010)
               ELSE
                  IF NOT cl_null(g_gzgk_1_d[l_ac].l_gzgk00602) THEN
                     CALL azzi330_01_s01_field(2,g_gzgj_m.l_gzgj010)
                  ELSE
                     IF NOT cl_null(g_gzgk_1_d[l_ac].l_gzgk00603) THEN
                        CALL azzi330_01_s01_field(3,g_gzgj_m.l_gzgj010)
                     ELSE
                        IF NOT cl_null(g_gzgk_1_d[l_ac].l_gzgk00604) THEN
                           CALL azzi330_01_s01_field(4,g_gzgj_m.l_gzgj010)
                        ELSE
                           CALL azzi330_01_s01_field(0,g_gzgj_m.l_gzgj010)                        
                        END IF   
                     END IF
                  END IF                  
               END IF               
               #end add-point
               
            BEFORE DISPLAY
               #如果一直都在單身1則控制筆數位置
               IF g_loc = 'm' THEN
                  CALL FGL_SET_ARR_CURR(g_detail_idx2)
               END IF
               LET g_loc = 'm'
               LET l_ac = DIALOG.getCurrentRow("s_detail2")
               LET g_current_page = 1
               #顯示單身筆數
               CALL azzi330_01_idx_chk()
               #add-point:page1自定義行為

               #end add-point
               
            #自訂ACTION(detail_show,page_1)
            
               
            #add-point:page1自定義行為

            #end add-point
               
         END DISPLAY   
#150611-00032#5 add(e)  
         #end add-point
         
      
         BEFORE DIALOG
            #先填充browser資料
            CALL azzi330_01_browser_fill("")
            CALL cl_notice()
            CALL cl_navigator_setting(g_current_idx, g_detail_cnt)
            LET g_curr_diag = ui.DIALOG.getCurrent()
            LET g_current_sw = FALSE
            #回歸舊筆數位置 (回到當時異動的筆數)
            
            #確保g_current_idx位於正常區間內
            #小於,等於0則指到第1筆
            IF g_current_idx <= 0 THEN
               LET g_current_idx = 1
            END IF
            #超過最大筆數則指到最後1筆
            IF g_current_idx > g_browser.getLength() THEN
               LEt g_current_idx = g_browser.getLength()
            END IF 
            
            LET g_current_sw = TRUE
            LET g_current_row = g_current_idx #目前指標
            
            #有資料才進行fetch
            IF g_current_idx <> 0 THEN
               CALL azzi330_01_fetch('') # reload data
            END IF
            #LET g_detail_idx = 1
            CALL azzi330_01_ui_detailshow() #Setting the current row 
            
            #筆數顯示
            LET g_current_page = 1
            CALL azzi330_01_idx_chk()
            CALL cl_ap_performance_cal()
            #add-point:ui_dialog段before_dialog2

            #end add-point
 
         #狀態碼切換
         ON ACTION statechange
            LET g_action_choice = "statechange"
            CALL azzi330_01_statechange()
            #根據資料狀態切換action狀態
            CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
            CALL azzi330_01_set_act_visible()   
            CALL azzi330_01_set_act_no_visible()
            IF NOT (g_gzgj_m.gzgj001 IS NULL
              OR g_gzgj_m.gzgj002 IS NULL
 
              ) THEN
               #組合條件
               LET g_add_browse = " ",
                                  " gzgj001 = '", g_gzgj_m.gzgj001, "' "
                                  ," AND gzgj002 = '", g_gzgj_m.gzgj002, "' "
                                  ," AND gzgj010 = '", g_gzgj_m.gzgj010, "' "   #150611-00032#5 add
 
               #填到對應位置
               CALL azzi330_01_browser_fill("")
            END IF
         
          
         #查詢方案選擇 
         ON ACTION queryplansel
            CALL cl_dlg_qryplan_select() RETURNING ls_wc
            #不是空條件才寫入g_wc跟重新找資料
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "gzgj_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "gzgk_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  #組合g_wc2
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
 
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
               END IF
               CALL azzi330_01_browser_fill("F")   #browser_fill()會將notice區塊清空
            END IF
         
         #查詢方案選擇
         ON ACTION qbe_select
            CALL cl_qbe_list("m") RETURNING ls_wc
            IF NOT cl_null(ls_wc) THEN
               CALL util.JSON.parse(ls_wc, la_wc)
               INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
 
               FOR li_idx = 1 TO la_wc.getLength()
                  CASE
                     WHEN la_wc[li_idx].tableid = "gzgj_t" 
                        LET g_wc = la_wc[li_idx].wc
                     WHEN la_wc[li_idx].tableid = "gzgk_t" 
                        LET g_wc2_table1 = la_wc[li_idx].wc
 
                     WHEN la_wc[li_idx].tableid = "EXTENDWC"
                        LET g_wc2_extend = la_wc[li_idx].wc
                  END CASE
               END FOR
               IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1)
 
                  OR NOT cl_null(g_wc2_extend)
                  THEN
                  IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
                     LET g_wc2 = g_wc2_table1
                  END IF
 
                  IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
                     LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
                  END IF
                  IF g_wc2.subString(1,5) = " AND " THEN
                     LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
                  END IF
                  #取得條件後需要重查、跳到結果第一筆資料的功能程式段
                  CALL azzi330_01_browser_fill("F")
                  IF g_browser_cnt = 0 THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "-100" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     CLEAR FORM
                  ELSE
                     CALL azzi330_01_fetch("F")
                  END IF
               END IF
            END IF
            #重新搜尋會將notice區塊清空,此處不可用EXIT DIALOG, SUBDIALOG重讀會導致部分變數消失
          
         
         
         ON ACTION first
            LET g_action_choice = "fetch"
            CALL azzi330_01_fetch('F')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL azzi330_01_idx_chk()
            
         ON ACTION previous
            LET g_action_choice = "fetch"
            CALL azzi330_01_fetch('P')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL azzi330_01_idx_chk()
            
         ON ACTION jump
            LET g_action_choice = "fetch"
            CALL azzi330_01_fetch('/')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL azzi330_01_idx_chk()
            
         ON ACTION next
            LET g_action_choice = "fetch"
            CALL azzi330_01_fetch('N')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL azzi330_01_idx_chk()
            
         ON ACTION last
            LET g_action_choice = "fetch"
            CALL azzi330_01_fetch('L')
            LET g_current_row = g_current_idx
            LET g_curr_diag = ui.DIALOG.getCurrent()
            CALL azzi330_01_idx_chk()
          
         #excel匯出功能          
         ON ACTION exporttoexcel
            LET g_action_choice="exporttoexcel"
            IF cl_auth_chk_act("exporttoexcel") THEN
               #browser
               CALL g_export_node.clear()
               IF g_main_hidden = 1 THEN
                  LET g_export_node[1] = base.typeInfo.create(g_browser)
                  LET g_export_id[1]   = "s_browse"
                  CALL cl_export_to_excel()
               #非browser
               ELSE
                  LET g_export_node[1] = base.typeInfo.create(g_gzgk_d)
                  LET g_export_id[1]   = "s_detail1"
 
                  #add-point:ON ACTION exporttoexcel

                  #END add-point
                  CALL cl_export_to_excel_getpage()
                  CALL cl_export_to_excel()
               END IF
            END IF
        
         ON ACTION close
            LET INT_FLAG = FALSE
            LET g_action_choice = "exit"
            EXIT DIALOG
          
         ON ACTION exit
            LET g_action_choice = "exit"
            EXIT DIALOG
    
         #主頁摺疊
         ON ACTION mainhidden       
            IF g_main_hidden THEN
               CALL gfrm_curr.setElementHidden("mainlayout",0)
               CALL gfrm_curr.setElementHidden("worksheet",1)
               LET g_main_hidden = 0
            ELSE
               CALL gfrm_curr.setElementHidden("mainlayout",1)
               CALL gfrm_curr.setElementHidden("worksheet",0)
               LET g_main_hidden = 1
               CALL cl_notice()
            END IF
            
       
         #單頭摺疊，可利用hot key "Alt-s"開啟/關閉單頭
         ON ACTION controls     
            IF g_header_hidden THEN
               CALL gfrm_curr.setElementHidden("vb_master",0)
               CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
               LET g_header_hidden = 0     #visible
            ELSE
               CALL gfrm_curr.setElementHidden("vb_master",1)
               CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
               LET g_header_hidden = 1     #hidden     
            END IF
    
         
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL azzi330_01_modify()
               #add-point:ON ACTION modify

               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION modify_detail
            LET g_action_choice="modify_detail"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = g_curr_diag.getCurrentItem()
               CALL azzi330_01_modify()
               #add-point:ON ACTION modify_detail

               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL azzi330_01_delete()
               #add-point:ON ACTION delete

               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL azzi330_01_insert()
               #add-point:ON ACTION insert

               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output

               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION reproduce
            LET g_action_choice="reproduce"
            IF cl_auth_chk_act("reproduce") THEN
               CALL azzi330_01_reproduce()
               #add-point:ON ACTION reproduce

               #END add-point
               
            END IF
 
 
 
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL azzi330_01_query()
               #add-point:ON ACTION query

               #END add-point
               #應用 a59 樣板自動產生(Version:2)  
               CALL g_curr_diag.setCurrentRow("s_detail1",1)
 
 
 
            END IF
 
 
 
         
         #應用 a46 樣板自動產生(Version:2)
         #新增相關文件
         ON ACTION related_document
            CALL azzi330_01_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document

               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL azzi330_01_set_pk_array()
            #add-point:ON ACTION agendum

            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL azzi330_01_set_pk_array()
            #add-point:ON ACTION followup

            #END add-point
            CALL cl_user_overview_follow('')
 
 
         
         #主選單用ACTION
         &include "main_menu_exit_dialog.4gl"
         &include "relating_action.4gl"
    
         #交談指令共用ACTION
         &include "common_action.4gl" 
            CONTINUE DIALOG
      END DIALOG
    
      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         #add-point:ui_dialog段離開dialog前

         #end add-point
         EXIT WHILE
      END IF
    
   END WHILE    
      
   CALL cl_set_act_visible("accept,cancel", TRUE)
    
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.browser_fill" >}
#+ 瀏覽頁簽資料填充
PRIVATE FUNCTION azzi330_01_browser_fill(ps_page_action)
   DEFINE ps_page_action    STRING
   DEFINE l_wc              STRING
   DEFINE l_wc2             STRING
   DEFINE l_sql             STRING
   DEFINE l_sub_sql         STRING
   DEFINE l_sql_rank        STRING
   #add-point:browser_fill段define

   #end add-point   
   #add-point:browser_fill段define(客製用)

   #end add-point   
   
   #add-point:browser_fill段動作開始前

   #end add-point
   
   IF cl_null(g_wc) THEN
      LET g_wc = " 1=1"
   END IF
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   LET l_wc  = g_wc.trim() 
   LET l_wc2 = g_wc2.trim()
 
   #add-point:browser_fill,foreach前

   #end add-point
   
   IF g_wc2 <> " 1=1" THEN
      #單身有輸入搜尋條件                      
      LET l_sub_sql = " SELECT UNIQUE gzgj001,gzgj002 ",
                      " FROM gzgj_t ",
                      " ",
                      " LEFT JOIN gzgk_t ON gzgj001 = gzgk001 AND gzgj002 = gzgk002 ", "  ",
                      #add-point:browser_fill段sql(gzgk_t1)
                      " AND gzgj010 = gzgk014 ",   #150611-00032#5 add                
                      #end add-point
 
 
                      " LEFT JOIN gzgjl_t ON gzgj001 = gzgjl001 AND gzgjl002 = '",g_dlang,"' ", 
                      " ", 
                      " WHERE   ",l_wc, " AND ", l_wc2, cl_sql_add_filter("gzgj_t")
                      ," AND gzgj010 = '1' "   #150611-00032#5 add 
   ELSE
      #單身未輸入搜尋條件
      LET l_sub_sql = " SELECT UNIQUE gzgj001,gzgj002 ",
                      " FROM gzgj_t ", 
                      "  ",
                      "  LEFT JOIN gzgjl_t ON gzgj001 = gzgjl001 AND gzgjl002 = '",g_dlang,"' ",
                      " AND gzgj010 = '1' ",   #150611-00032#5 add
                      " WHERE  ",l_wc CLIPPED, cl_sql_add_filter("gzgj_t")
   END IF
   
   #add-point:browser_fill,cnt wc

   #end add-point
   
   LET g_sql = " SELECT COUNT(*) FROM (",l_sub_sql,")"
   
   #add-point:browser_fill,count前

   #end add-point
   
   PREPARE header_cnt_pre FROM g_sql
   EXECUTE header_cnt_pre INTO g_browser_cnt   #總筆數
   FREE header_cnt_pre
    
   IF g_browser_cnt > g_max_browse THEN
      IF g_error_show = 1 THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_browser_cnt
         LET g_errparam.code   = 9035 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
      END IF
      LET g_browser_cnt = g_max_browse
   END IF
   
   DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
   DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
 
   #根據行為確定資料填充位置及WC
   IF cl_null(g_add_browse) THEN
      #清除畫面
      CLEAR FORM                
      INITIALIZE g_gzgj_m.* TO NULL
      CALL g_gzgk_d.clear()        
 
      #add-point:browser_fill g_add_browse段額外處理
      CALL g_gzgk_1_d.clear()   #150611-00032#5 add
      #end add-point   
      CALL g_browser.clear()
      LET g_cnt = 1
   ELSE
      LET l_wc  = g_add_browse
      LET l_wc2 = " 1=1" 
      LET g_cnt = g_current_idx
   END IF
 
   #依照t0.gzgj001,t0.gzgj002 Browser欄位定義(取代原本bs_sql功能)
   #考量到單身可能下條件, 所以此處需join單身所有table
   #DISTINCT是為了避免在join時出現重複的資料(如果不加DISTINCT則須在程式中過濾)
   LET g_sql = " SELECT DISTINCT t0.gzgjstus,t0.gzgj001,t0.gzgj002 ",
               " ,t0.gzgj010 ",    #150611-00032#5 add
               " FROM gzgj_t t0",
               "  ",
               "  LEFT JOIN gzgk_t ON gzgj001 = gzgk001 AND gzgj002 = gzgk002 ", "  ", 
               #add-point:browser_fill段sql(gzgk_t1)
               " AND gzgj010 = gzgk014 ",   #150611-00032#5 add
               #end add-point
 
 
               "  ",
               
               " LEFT JOIN gzgjl_t ON gzgj001 = gzgjl001 AND gzgjl002 = '",g_dlang,"' ",
               " WHERE  ",l_wc," AND ",l_wc2, cl_sql_add_filter("gzgj_t")
               ," AND gzgk014 = '1' "    #150611-00032#5 add
   #add-point:browser_fill,sql wc
 
   #end add-point
#   LET g_sql = g_sql, " ORDER BY gzgj001,gzgj002 ",g_order           #150611-00032#5 mark
   LET g_sql = g_sql, " ORDER BY gzgj001,gzgj002,gzgj010 ",g_order   #150611-00032#5 add
   #add-point:browser_fill,before_prepare

   #end add-point
        
   #LET g_sql = cl_sql_add_tabid(g_sql,"gzgj_t") #WC重組
   LET g_sql = cl_sql_add_mask(g_sql) #遮蔽特定資料
   PREPARE browse_pre FROM g_sql
   DECLARE browse_cur CURSOR FOR browse_pre
   
   #add-point:browser_fill段open cursor

   #end add-point
   
   FOREACH browse_cur INTO g_browser[g_cnt].b_statepic,g_browser[g_cnt].b_gzgj001,g_browser[g_cnt].b_gzgj002 
                           ,g_browser[g_cnt].b_gzgj010   #150611-00032#5 add
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = 'foreach:' 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         EXIT FOREACH
      END IF
  
      #add-point:browser_fill段reference

      #end add-point
  
  
            #應用 a24 樣板自動產生(Version:2)
      #browser顯示圖片
      CASE g_browser[g_cnt].b_statepic
         WHEN "N"
            LET g_browser[g_cnt].b_statepic = "stus/16/open.png"
         WHEN "Y"
            LET g_browser[g_cnt].b_statepic = "stus/16/valid.png"
         WHEN "X"
            LET g_browser[g_cnt].b_statepic = "stus/16/void.png"
         
      END CASE
 
 
      LET g_cnt = g_cnt + 1
      IF g_cnt > g_max_browse THEN
         EXIT FOREACH
      END IF
      
   END FOREACH
   
   #清空g_add_browse, 並指定指標位置
   IF NOT cl_null(g_add_browse) THEN
      LET g_add_browse = ""
      CALL g_curr_diag.setCurrentRow("s_browse",g_current_idx)
   END IF
   
   IF cl_null(g_browser[g_cnt].b_gzgj001) THEN
      CALL g_browser.deleteElement(g_cnt)
   END IF
   
   LET g_header_cnt  = g_browser.getLength()
   LET g_browser_cnt = g_browser.getLength()
   
   #筆數顯示
   IF g_browser_cnt > 0 THEN
      DISPLAY g_browser_idx TO FORMONLY.b_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.b_count #總筆數
      DISPLAY g_browser_idx TO FORMONLY.h_index #當下筆數
      DISPLAY g_browser_cnt TO FORMONLY.h_count #總筆數
      DISPLAY g_detail_idx  TO FORMONLY.idx     #單身當下筆數
      DISPLAY g_detail_cnt  TO FORMONLY.cnt     #單身總筆數
   ELSE
      DISPLAY '' TO FORMONLY.b_index #當下筆數
      DISPLAY '' TO FORMONLY.b_count #總筆數
      DISPLAY '' TO FORMONLY.h_index #當下筆數
      DISPLAY '' TO FORMONLY.h_count #總筆數
      DISPLAY '' TO FORMONLY.idx     #單身當下筆數
      DISPLAY '' TO FORMONLY.cnt     #單身總筆數
   END IF
 
   LET g_rec_b = g_cnt - 1
   LET g_detail_cnt = g_rec_b
   LET g_cnt = 0
   
   FREE browse_pre
   
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
                  
   
   #add-point:browser_fill段結束前

   #end add-point   
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.ui_headershow" >}
#+ 單頭資料重新顯示
PRIVATE FUNCTION azzi330_01_ui_headershow()
   #add-point:ui_headershow段define

   #end add-point    
   #add-point:ui_headershow段define(客製用)

   #end add-point    
 
   LET g_gzgj_m.gzgj010 = "1"    #150611-00032#5 add
   LET g_gzgj_m.l_gzgj010 = "2"  #150611-00032#5 add 
   
   LET g_gzgj_m.gzgj001 = g_browser[g_current_idx].b_gzgj001   
   LET g_gzgj_m.gzgj002 = g_browser[g_current_idx].b_gzgj002   
  
   #150611-00032#5 mark(s)
#   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002 INTO g_gzgj_m.gzgj001, 
#       g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005, 
#       g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt,g_gzgj_m.gzgjownid_desc, 
#       g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjmodid_desc 
   #150611-00032#5 mark(e)
 
   #150611-00032#5 add(e)
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010 INTO g_gzgj_m.gzgj001, 
       g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006, 
       g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc
       
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,
       g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc   
   #150611-00032#5 add(e)
   
   CALL azzi330_01_gzgj_t_mask()
   CALL azzi330_01_show()
      
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.ui_detailshow" >}
#+ 單身資料重新顯示
PRIVATE FUNCTION azzi330_01_ui_detailshow()
   #add-point:ui_detailshow段define
   
   #end add-point    
   #add-point:ui_detailshow段define(客製用)
   
   #end add-point    
   
   #add-point:ui_detailshow段before
   
   #end add-point    
   
   IF g_curr_diag IS NOT NULL THEN
      CALL g_curr_diag.setCurrentRow("s_detail1",g_detail_idx)      
 
   END IF
   
   #add-point:ui_detailshow段after
   
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.ui_browser_refresh" >}
#+ 瀏覽頁簽資料重新顯示
PRIVATE FUNCTION azzi330_01_ui_browser_refresh()
   DEFINE l_i  LIKE type_t.num10
   #add-point:ui_browser_refresh段define
   
   #end add-point    
   #add-point:ui_browser_refresh段define(客製用)
   
   #end add-point    
   
   LET g_browser_cnt = g_browser.getLength()
   LET g_header_cnt  = g_browser.getLength()
   FOR l_i =1 TO g_browser.getLength()
      IF g_browser[l_i].b_gzgj001 = g_gzgj_m.gzgj001 
         AND g_browser[l_i].b_gzgj002 = g_gzgj_m.gzgj002 
 
         THEN
         CALL g_browser.deleteElement(l_i)
         EXIT FOR
      END IF
   END FOR
   LET g_browser_cnt = g_browser_cnt - 1
   LET g_header_cnt = g_header_cnt - 1
    
   #若無資料則關閉相關功能
   IF g_browser_cnt = 0 THEN
      CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce,mainhidden", FALSE)
      CALL cl_navigator_setting(0,0)
      CLEAR FORM
   ELSE
      CALL cl_set_act_visible("mainhidden", TRUE)
   END IF
   
   #add-point:ui_browser_refresh段after
   
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.construct" >}
#+ QBE資料查詢
PRIVATE FUNCTION azzi330_01_construct()
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING 
   DEFINE ls_wc       STRING 
   DEFINE la_wc       DYNAMIC ARRAY OF RECORD
          tableid     STRING,
          wc          STRING
          END RECORD
   DEFINE li_idx      LIKE type_t.num10
   #add-point:cs段define
 
   #end add-point    
   #add-point:cs段define(客製用)

   #end add-point    
    
   #清除畫面
   CLEAR FORM                
   INITIALIZE g_gzgj_m.* TO NULL
   CALL g_gzgk_d.clear()        
   CALL g_gzgk_1_d.clear()   #150611-00032#5 add
   
   LET g_action_choice = ""
    
   INITIALIZE g_wc TO NULL
   INITIALIZE g_wc2 TO NULL
   
   INITIALIZE g_wc2_table1 TO NULL
   INITIALIZE g_wc2_table2 TO NULL   #150611-00032#5 add
    
   LET g_qryparam.state = 'c'
   
   #add-point:cs段開始前
 
   #end add-point 
   
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      
      #單頭
      #150611-00032#5 mark(s)      
#      CONSTRUCT BY NAME g_wc ON gzgj001,gzgjl003,gzgj002,gzgjstus,gzgj009,gzgj003,gzgj004,gzgj005,gzgj006, 
#          gzgj007,gzgj008,l_col,l_row,gzgk009,gzgk007,gzgk008,gzgk012_id,gzgk012,gzgk013_id,gzgk013, 
#          gzgk010,gzgk011,gzgjownid,gzgjowndp,gzgjcrtid,gzgjcrtdp,gzgjcrtdt,gzgjmodid,gzgjmoddt
      #150611-00032#5 mark(e)      
 
      #150611-00032#5 add(s)
      CONSTRUCT BY NAME g_wc ON gzgj001,gzgjl003,gzgj002,gzgj009,gzgj003,gzgj004,gzgj005,gzgj006,gzgj007, 
          gzgj008,gzgjstus,gzgjownid,gzgjowndp,gzgjcrtid,gzgjcrtdp,gzgjcrtdt,gzgjmodid,gzgjmoddt
         ,l_gzgj003,l_gzgj004,l_gzgj005,l_gzgj006,l_gzgj007
         ,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj010
         ,l_gzgj009   #150909-00019#1 add
      #150611-00032#5 add(e)
 
         BEFORE CONSTRUCT
            #add-point:cs段before_construct

            #end add-point 
            
         #公用欄位開窗相關處理
         #應用 a11 樣板自動產生(Version:2)
         #共用欄位查詢處理  
         ##----<<gzgjcrtdt>>----
         AFTER FIELD gzgjcrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
 
         #----<<gzgjmoddt>>----
         AFTER FIELD gzgjmoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<gzgjcnfdt>>----
         
         #----<<gzgjpstdt>>----
 
 
            
         #一般欄位開窗相關處理    
                  #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj001
            #add-point:BEFORE FIELD gzgj001

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj001
            
            #add-point:AFTER FIELD gzgj001

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj001
            #add-point:ON ACTION controlp INFIELD gzgj001
            ###  ### start ###
            INITIALIZE g_qryparam.* TO NULL 
            LET g_qryparam.state = "i"
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = ""
            LET g_qryparam.default2 = ""
            LET g_qryparam.where = "1=1"
            CALL q_gzgj001()
            LET g_gzgj_m.gzgj001 = g_qryparam.return1
            LET g_gzgj_m.gzgjl003 = g_qryparam.return2
            DISPLAY g_gzgj_m.gzgj001 TO gzgj001
            DISPLAY g_gzgj_m.gzgjl003 TO gzgjl003
            ###  ### end ###
            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjl003
            #add-point:BEFORE FIELD gzgjl003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjl003
            
            #add-point:AFTER FIELD gzgjl003

            #END add-point
            
 
         #Ctrlp:construct.c.gzgjl003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjl003
            #add-point:ON ACTION controlp INFIELD gzgjl003

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj002
            #add-point:BEFORE FIELD gzgj002

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj002
            
            #add-point:AFTER FIELD gzgj002

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj002
            #add-point:ON ACTION controlp INFIELD gzgj002

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjstus
            #add-point:BEFORE FIELD gzgjstus

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjstus
            
            #add-point:AFTER FIELD gzgjstus

            #END add-point
            
 
         #Ctrlp:construct.c.gzgjstus
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjstus
            #add-point:ON ACTION controlp INFIELD gzgjstus

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj009
            #add-point:BEFORE FIELD gzgj009

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj009
            
            #add-point:AFTER FIELD gzgj009

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj009
            #add-point:ON ACTION controlp INFIELD gzgj009

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj003
            #add-point:BEFORE FIELD gzgj003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj003
            
            #add-point:AFTER FIELD gzgj003

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj003
            #add-point:ON ACTION controlp INFIELD gzgj003

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj004
            #add-point:BEFORE FIELD gzgj004

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj004
            
            #add-point:AFTER FIELD gzgj004

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj004
            #add-point:ON ACTION controlp INFIELD gzgj004

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj005
            #add-point:BEFORE FIELD gzgj005

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj005
            
            #add-point:AFTER FIELD gzgj005

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj005
            #add-point:ON ACTION controlp INFIELD gzgj005

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj006
            #add-point:BEFORE FIELD gzgj006

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj006
            
            #add-point:AFTER FIELD gzgj006

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj006
            #add-point:ON ACTION controlp INFIELD gzgj006

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj007
            #add-point:BEFORE FIELD gzgj007

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj007
            
            #add-point:AFTER FIELD gzgj007

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj007
            #add-point:ON ACTION controlp INFIELD gzgj007

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj008
            #add-point:BEFORE FIELD gzgj008

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj008
            
            #add-point:AFTER FIELD gzgj008

            #END add-point
            
 
         #Ctrlp:construct.c.gzgj008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj008
            #add-point:ON ACTION controlp INFIELD gzgj008

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_col
            #add-point:BEFORE FIELD l_col

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_col
            
            #add-point:AFTER FIELD l_col

            #END add-point
            
 
         #Ctrlp:construct.c.l_col
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_col
            #add-point:ON ACTION controlp INFIELD l_col

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_row
            #add-point:BEFORE FIELD l_row

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_row
            
            #add-point:AFTER FIELD l_row

            #END add-point
            
 
         #Ctrlp:construct.c.l_row
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_row
            #add-point:ON ACTION controlp INFIELD l_row

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk009
            #add-point:BEFORE FIELD gzgk009

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk009
            
            #add-point:AFTER FIELD gzgk009

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk009
            #add-point:ON ACTION controlp INFIELD gzgk009

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk007
            #add-point:BEFORE FIELD gzgk007

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk007
            
            #add-point:AFTER FIELD gzgk007

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk007
            #add-point:ON ACTION controlp INFIELD gzgk007

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk008
            #add-point:BEFORE FIELD gzgk008

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk008
            
            #add-point:AFTER FIELD gzgk008

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk008
            #add-point:ON ACTION controlp INFIELD gzgk008

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk012_id
            #add-point:BEFORE FIELD gzgk012_id

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk012_id
            
            #add-point:AFTER FIELD gzgk012_id

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk012_id
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk012_id
            #add-point:ON ACTION controlp INFIELD gzgk012_id

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk012
            #add-point:BEFORE FIELD gzgk012

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk012
            
            #add-point:AFTER FIELD gzgk012

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk012
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk012
            #add-point:ON ACTION controlp INFIELD gzgk012

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk013_id
            #add-point:BEFORE FIELD gzgk013_id

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk013_id
            
            #add-point:AFTER FIELD gzgk013_id

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk013_id
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk013_id
            #add-point:ON ACTION controlp INFIELD gzgk013_id

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk013
            #add-point:BEFORE FIELD gzgk013

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk013
            
            #add-point:AFTER FIELD gzgk013

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk013
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk013
            #add-point:ON ACTION controlp INFIELD gzgk013

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk010
            #add-point:BEFORE FIELD gzgk010

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk010
            
            #add-point:AFTER FIELD gzgk010

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk010
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk010
            #add-point:ON ACTION controlp INFIELD gzgk010

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk011
            #add-point:BEFORE FIELD gzgk011

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk011
            
            #add-point:AFTER FIELD gzgk011

            #END add-point
            
 
         #Ctrlp:construct.c.gzgk011
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk011
            #add-point:ON ACTION controlp INFIELD gzgk011

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjownid
            #add-point:BEFORE FIELD gzgjownid

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjownid
            
            #add-point:AFTER FIELD gzgjownid

            #END add-point
            
 
         #Ctrlp:construct.c.gzgjownid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjownid
            #add-point:ON ACTION controlp INFIELD gzgjownid

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjowndp
            #add-point:BEFORE FIELD gzgjowndp

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjowndp
            
            #add-point:AFTER FIELD gzgjowndp

            #END add-point
            
 
         #Ctrlp:construct.c.gzgjowndp
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjowndp
            #add-point:ON ACTION controlp INFIELD gzgjowndp

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjcrtid
            #add-point:BEFORE FIELD gzgjcrtid

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjcrtid
            
            #add-point:AFTER FIELD gzgjcrtid

            #END add-point
            
 
         #Ctrlp:construct.c.gzgjcrtid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjcrtid
            #add-point:ON ACTION controlp INFIELD gzgjcrtid

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjcrtdp
            #add-point:BEFORE FIELD gzgjcrtdp

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjcrtdp
            
            #add-point:AFTER FIELD gzgjcrtdp

            #END add-point
            
 
         #Ctrlp:construct.c.gzgjcrtdp
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjcrtdp
            #add-point:ON ACTION controlp INFIELD gzgjcrtdp

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjcrtdt
            #add-point:BEFORE FIELD gzgjcrtdt

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjmodid
            #add-point:BEFORE FIELD gzgjmodid

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjmodid
            
            #add-point:AFTER FIELD gzgjmodid

            #END add-point
            
 
         #Ctrlp:construct.c.gzgjmodid
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjmodid
            #add-point:ON ACTION controlp INFIELD gzgjmodid

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjmoddt
            #add-point:BEFORE FIELD gzgjmoddt

            #END add-point
 
 
         
      END CONSTRUCT
 
      #單身根據table分拆construct
      CONSTRUCT g_wc2_table1 ON gzgk003,gzgk004,gzgk005,gzgk005_desc,gzgk00601,gzgk00602,gzgk00603,gzgk00604 
 
           FROM s_detail1[1].gzgk003,s_detail1[1].gzgk004,s_detail1[1].gzgk005,s_detail1[1].gzgk005_desc, 
               s_detail1[1].gzgk00601,s_detail1[1].gzgk00602,s_detail1[1].gzgk00603,s_detail1[1].gzgk00604 
 
                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct
           
            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
                #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk003
            #add-point:BEFORE FIELD gzgk003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk003
            
            #add-point:AFTER FIELD gzgk003

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk003
            #add-point:ON ACTION controlp INFIELD gzgk003

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk004
            #add-point:BEFORE FIELD gzgk004

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk004
            
            #add-point:AFTER FIELD gzgk004

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk004
            #add-point:ON ACTION controlp INFIELD gzgk004

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk005
            #add-point:BEFORE FIELD gzgk005

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk005
            
            #add-point:AFTER FIELD gzgk005

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk005
            #add-point:ON ACTION controlp INFIELD gzgk005

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk005_desc
            #add-point:BEFORE FIELD gzgk005_desc

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk005_desc
            
            #add-point:AFTER FIELD gzgk005_desc

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk005_desc
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk005_desc
            #add-point:ON ACTION controlp INFIELD gzgk005_desc

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00601
            #add-point:BEFORE FIELD gzgk00601

            #END add-point
            
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00601
            
            #add-point:AFTER FIELD gzgk00601

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk00601
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00601
            #add-point:ON ACTION controlp INFIELD gzgk00601

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00602
            #add-point:BEFORE FIELD gzgk00602

            #END add-point
         
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00602
            
            #add-point:AFTER FIELD gzgk00602

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk00602
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00602
            #add-point:ON ACTION controlp INFIELD gzgk00602

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00603
            #add-point:BEFORE FIELD gzgk00603

            #END add-point
                     
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00603
            
            #add-point:AFTER FIELD gzgk00603

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk00603
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00603
            #add-point:ON ACTION controlp INFIELD gzgk00603

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00604
            #add-point:BEFORE FIELD gzgk00604

            #END add-point
        
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00604
            
            #add-point:AFTER FIELD gzgk00604

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk00604
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00604
            #add-point:ON ACTION controlp INFIELD gzgk00604

            #END add-point
 
   
       
      END CONSTRUCT
      
 
      
 
      
      #add-point:cs段add_cs(本段內只能出現新的CONSTRUCT指令)
      #150611-00032#5 add(s)
      #單身根據table分拆construct
      CONSTRUCT g_wc2_table2 ON l_gzgk003,l_gzgk004,l_gzgk005,l_gzgk005_desc,l_gzgk00601,l_gzgk00602,l_gzgk00603,l_gzgk00604 

           FROM s_detail2[1].l_gzgk003,s_detail2[1].l_gzgk004,s_detail2[1].l_gzgk005,s_detail2[1].l_gzgk005_desc, 
               s_detail2[1].l_gzgk00601,s_detail2[1].l_gzgk00602,s_detail2[1].l_gzgk00603,s_detail2[1].l_gzgk00604 

                      
         BEFORE CONSTRUCT
            #add-point:cs段before_construct

            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
                #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk003
            #add-point:BEFORE FIELD gzgk003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk003
            
            #add-point:AFTER FIELD gzgk003

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk003
            #add-point:ON ACTION controlp INFIELD gzgk003

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk004
            #add-point:BEFORE FIELD gzgk004

            #END add-point
         
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk004
            
            #add-point:AFTER FIELD gzgk004

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk004
            #add-point:ON ACTION controlp INFIELD gzgk004

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk005
            #add-point:BEFORE FIELD gzgk005

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk005
            
            #add-point:AFTER FIELD gzgk005

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk005
            #add-point:ON ACTION controlp INFIELD gzgk005

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk005_desc
            #add-point:BEFORE FIELD gzgk005_desc

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk005_desc
            
            #add-point:AFTER FIELD gzgk005_desc

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk005_desc
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk005_desc
            #add-point:ON ACTION controlp INFIELD gzgk005_desc

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00601
            #add-point:BEFORE FIELD gzgk00601

            #END add-point
                
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00601
            
            #add-point:AFTER FIELD gzgk00601

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk00601
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00601
            #add-point:ON ACTION controlp INFIELD gzgk00601

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00602
            #add-point:BEFORE FIELD gzgk00602

            #END add-point
                
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00602
            
            #add-point:AFTER FIELD gzgk00602

            #END add-point          
 
         #Ctrlp:construct.c.page1.gzgk00602
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00602
            #add-point:ON ACTION controlp INFIELD gzgk00602

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00603
            #add-point:BEFORE FIELD gzgk00603

            #END add-point
                   
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00603
            
            #add-point:AFTER FIELD gzgk00603

            #END add-point
            
         #Ctrlp:construct.c.page1.gzgk00603
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00603
            #add-point:ON ACTION controlp INFIELD gzgk00603

            #END add-point
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00604
            #add-point:BEFORE FIELD gzgk00604

            #END add-point

         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00604
            
            #add-point:AFTER FIELD gzgk00604

            #END add-point
            
 
         #Ctrlp:construct.c.page1.gzgk00604
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00604
            #add-point:ON ACTION controlp INFIELD gzgk00604

            #END add-point
   
      END CONSTRUCT
      #150611-00032#5 add(e)          
      #end add-point
 
      BEFORE DIALOG
         CALL cl_qbe_init()
         #add-point:cs段b_dialog

         #end add-point  
 
      #查詢方案列表
      ON ACTION qbe_select
         LET ls_wc = ""
         CALL cl_qbe_list("c") RETURNING ls_wc
         IF NOT cl_null(ls_wc) THEN
            CALL util.JSON.parse(ls_wc, la_wc)
            INITIALIZE g_wc, g_wc2, g_wc2_table1, g_wc2_extend TO NULL
 
            FOR li_idx = 1 TO la_wc.getLength()
               CASE
                  WHEN la_wc[li_idx].tableid = "gzgj_t" 
                     LET g_wc = la_wc[li_idx].wc
                  WHEN la_wc[li_idx].tableid = "gzgk_t" 
                     LET g_wc2_table1 = la_wc[li_idx].wc
 
               END CASE
            END FOR
         END IF
    
      #條件儲存為方案
      ON ACTION qbe_save
         CALL cl_qbe_save()
 
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
   END DIALOG
   
   #組合g_wc2
   LET g_wc2 = g_wc2_table1
 
 
 
   
   #add-point:cs段結束前

   #end add-point    
 
   IF INT_FLAG THEN
      RETURN
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.query" >}
#+ 資料查詢QBE功能準備
PRIVATE FUNCTION azzi330_01_query()
   DEFINE ls_wc STRING
   #add-point:query段define

   #end add-point   
   #add-point:query段define(客製用)

   #end add-point   
   
   #切換畫面
   
   LET ls_wc = g_wc
   
   LET INT_FLAG = 0
   CALL cl_navigator_setting( g_current_idx, g_detail_cnt )
   ERROR ""
   
   #清除畫面及相關資料
   CLEAR FORM
   CALL g_browser.clear()       
   CALL g_gzgk_d.clear()
   CALL g_gzgk_1_d.clear()   #150611-00032#5 add
   
   #add-point:query段other

   #end add-point   
   
   DISPLAY '' TO FORMONLY.idx
   DISPLAY '' TO FORMONLY.cnt
   DISPLAY '' TO FORMONLY.b_index
   DISPLAY '' TO FORMONLY.b_count
   DISPLAY '' TO FORMONLY.h_index
   DISPLAY '' TO FORMONLY.h_count
   
   CALL azzi330_01_construct()
 
   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      LET g_wc = ls_wc
      CALL azzi330_01_browser_fill("")
      CALL azzi330_01_fetch("")
      RETURN
   END IF
   
   #儲存WC資訊
   CALL cl_dlg_save_user_latestqry("("||g_wc||") AND ("||g_wc2||")")
   
   #搜尋後資料初始化 
   LET g_detail_cnt  = 0
   LET g_current_idx = 1
   LET g_current_row = 0
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   LET g_error_show  = 1
   LET g_wc_filter   = ""
   LET l_ac = 1
   CALL FGL_SET_ARR_CURR(1)
   CALL azzi330_01_browser_fill("F")
         
   IF g_browser_cnt = 0 THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "-100" 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
   ELSE
      CALL azzi330_01_fetch("F") 
      #顯示單身筆數
      CALL azzi330_01_idx_chk()
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.fetch" >}
#+ 指定PK後抓取單頭其他資料
PRIVATE FUNCTION azzi330_01_fetch(p_flag)
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   #add-point:fetch段define

   #end add-point    
   #add-point:fetch段define(客製用)

   #end add-point    
   
   IF g_browser_cnt = 0 THEN
      RETURN
   END IF
 
   LET g_gzgj_m.gzgj010 = "1"     #150611-00032#5 add
   LET g_gzgj_m.l_gzgj010 = "2"   #150611-00032#5 add
   
   CALL cl_ap_performance_next_start()
   CASE p_flag
      WHEN 'F' 
         LET g_current_idx = 1
      WHEN 'L'  
         LET g_current_idx = g_browser.getLength()              
      WHEN 'P'
         IF g_current_idx > 1 THEN               
            LET g_current_idx = g_current_idx - 1
         END IF 
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF        
      WHEN '/'
         IF (NOT g_no_ask) THEN    
            CALL cl_set_act_visible("accept,cancel", TRUE)    
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0
 
            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl" 
            END PROMPT
 
            CALL cl_set_act_visible("accept,cancel", FALSE)    
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE  
            END IF           
         END IF
         
         IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
             LET g_current_idx = g_jump
         END IF
         LET g_no_ask = FALSE  
   END CASE 
 
   
   LET g_current_row = g_current_idx
   LET g_detail_cnt = g_header_cnt                  
   
   #單身總筆數顯示
   IF g_detail_cnt > 0 THEN
      #若單身有資料時, idx至少為1
      IF g_detail_idx <= 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx  
   ELSE
      LET g_detail_idx = 0
      DISPLAY '' TO FORMONLY.idx    
   END IF
   
   #瀏覽頁筆數顯示
   LET g_pagestart = g_current_idx
   DISPLAY g_pagestart TO FORMONLY.b_index   #當下筆數
   DISPLAY g_pagestart TO FORMONLY.h_index   #當下筆數
   
   CALL cl_navigator_setting( g_pagestart, g_browser_cnt )
 
   #代表沒有資料
   IF g_current_idx = 0 OR g_browser.getLength() = 0 THEN
      RETURN
   END IF
   
   #超出範圍
   IF g_current_idx > g_browser.getLength() THEN
      LET g_current_idx = g_browser.getLength()
   END IF
   
   LET g_gzgj_m.gzgj001 = g_browser[g_current_idx].b_gzgj001
   LET g_gzgj_m.gzgj002 = g_browser[g_current_idx].b_gzgj002
 
   
   #重讀DB,因TEMP有不被更新特性
   #150611-00032#5 mark(s)
#   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002 INTO g_gzgj_m.gzgj001, 
#       g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005, 
#       g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt,g_gzgj_m.gzgjownid_desc, 
#       g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjmodid_desc 
   #150611-00032#5 mark(e)
   #150611-00032#5 add(s)
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010 INTO g_gzgj_m.gzgj001, 
       g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006, 
       g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc
       
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,
       g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc   
   #150611-00032#5 add(e)
   
   #遮罩相關處理
   LET g_gzgj_m_mask_o.* =  g_gzgj_m.*
   CALL azzi330_01_gzgj_t_mask()
   LET g_gzgj_m_mask_n.* =  g_gzgj_m.*
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL azzi330_01_set_act_visible()   
   CALL azzi330_01_set_act_no_visible()
   
   #add-point:fetch段action控制

   #end add-point  
   
   
   
   #add-point:fetch結束前

   #end add-point
   
   #保存單頭舊值
   LET g_gzgj_m_t.* = g_gzgj_m.*
   LET g_gzgj_m_o.* = g_gzgj_m.*
   
   LET g_data_owner = g_gzgj_m.gzgjownid      
   LET g_data_dept  = g_gzgj_m.gzgjowndp
   
   #重新顯示   
   CALL azzi330_01_show()
 
   
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.insert" >}
#+ 資料新增
PRIVATE FUNCTION azzi330_01_insert()
   #add-point:insert段define

   #end add-point    
   #add-point:insert段define(客製用)

   #end add-point    
   
   #清畫面欄位內容
   CLEAR FORM                    
   CALL g_gzgk_d.clear()   
   CALL g_gzgk_1_d.clear() #150611-00032#5 add
 
   INITIALIZE g_gzgj_m.* LIKE gzgj_t.*             #DEFAULT 設定
   
   LET g_gzgj001_t = NULL
   LET g_gzgj002_t = NULL
 
   
   LET g_master_insert = FALSE
   
   #add-point:insert段before
   #150611-00032#5 add(s)
   LET g_gzgj010_t = NULL  
   LET g_l_gzgj010_t = NULL
   LET g_gzgj_m.gzgj010 = "1"
   LET g_gzgj_m.l_gzgj010 = "2"
   #150611-00032#5 add(e)
   #end add-point    
   
   CALL s_transaction_begin()
   WHILE TRUE
      #公用欄位給值(單頭)
      #應用 a14 樣板自動產生(Version:4)    
      #公用欄位新增給值  
      LET g_gzgj_m.gzgjownid = g_user
      LET g_gzgj_m.gzgjowndp = g_dept
      LET g_gzgj_m.gzgjcrtid = g_user
      LET g_gzgj_m.gzgjcrtdp = g_dept 
      LET g_gzgj_m.gzgjcrtdt = cl_get_current()
      LET g_gzgj_m.gzgjmodid = g_user
      LET g_gzgj_m.gzgjmoddt = cl_get_current()
      LET g_gzgj_m.gzgjstus = 'N'
 
 
 
      #append欄位給值
      
     
      #一般欄位給值
      
  
      #add-point:單頭預設值
      LET g_gzgj_m.gzgjstus = "Y"
      LET g_gzgj_m.l_gzgj009 = "N"   #150909-00019#1 add
      #end add-point 
      
      #保存單頭舊值(用於資料輸入錯誤還原預設值時使用)
      LET g_gzgj_m_t.* = g_gzgj_m.*
      LET g_gzgj_m_o.* = g_gzgj_m.*
      
      #顯示狀態(stus)圖片
            #應用 a21 樣板自動產生(Version:2)
	  #根據當下狀態碼顯示圖片
      CASE g_gzgj_m.gzgjstus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/valid.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/void.png")
         
      END CASE
 
 
    
      CALL azzi330_01_input("a")
      
      #add-point:單頭輸入後

      #end add-point
      
      IF INT_FLAG THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code   = 9001 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         CALL s_transaction_end('N','0')   #150611-00032#5 add
         LET INT_FLAG = 0
      END IF
      
      IF NOT g_master_insert THEN
         DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
         DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
         INITIALIZE g_gzgj_m.* TO NULL
         INITIALIZE g_gzgk_d TO NULL
         INITIALIZE g_gzgk_1_d TO NULL   #150611-00032#5 add
         #add-point:取消新增後

         #end add-point 
         CALL azzi330_01_show()
         RETURN
      END IF
      
      LET INT_FLAG = 0
      #CALL g_gzgk_d.clear()
 
      CALL s_transaction_end('Y','0')   #150611-00032#5 add
      LET g_rec_b = 0
      EXIT WHILE
        
   END WHILE
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL azzi330_01_set_act_visible()   
   CALL azzi330_01_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_gzgj001_t = g_gzgj_m.gzgj001
   LET g_gzgj002_t = g_gzgj_m.gzgj002
   LET g_gzgj010_t = g_gzgj_m.gzgj010 #150611-00032#5 add
   LET g_l_gzgj010_t = g_gzgj_m.l_gzgj010 #150611-00032#5 add
 
   
   #組合新增資料的條件
   LET g_add_browse = " ",
                      " gzgj001 = '", g_gzgj_m.gzgj001, "' "
                      ," AND gzgj002 = '", g_gzgj_m.gzgj002, "' "
 
                      
   #add-point:組合新增資料的條件後

   #end add-point
      
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL azzi330_01_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   CLOSE azzi330_01_cl
   
   CALL azzi330_01_idx_chk()
   
   #撈取異動後的資料(主要是帶出reference)
   #150611-00032#5 mark(s)
#   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002 INTO g_gzgj_m.gzgj001, 
#       g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005, 
#       g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt,g_gzgj_m.gzgjownid_desc, 
#       g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjmodid_desc 
   #150611-00032#5 mark(e)
   #150611-00032#5 add(s)
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010 INTO g_gzgj_m.gzgj001, 
       g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006, 
       g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc
       
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,
       g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc   
   #150611-00032#5 add(e)
   
   #遮罩相關處理
   LET g_gzgj_m_mask_o.* =  g_gzgj_m.*
   CALL azzi330_01_gzgj_t_mask()
   LET g_gzgj_m_mask_n.* =  g_gzgj_m.*
   
   #將資料顯示到畫面上
   ##150611-00032#5 mark(s)
#   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009, 
#       g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#       g_gzgj_m.l_col,g_gzgj_m.l_row,g_gzgj_m.gzgk009,g_gzgj_m.gzgk007,g_gzgj_m.gzgk008,g_gzgj_m.gzgk012_id, 
#       g_gzgj_m.gzgk012,g_gzgj_m.gzgk013_id,g_gzgj_m.gzgk013,g_gzgj_m.gzgk010,g_gzgj_m.gzgk011,g_gzgj_m.gzgjownid, 
#       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc, 
#       g_gzgj_m.gzgjmoddt
   ##150611-00032#5 mark(e)
   ##150611-00032#5 add(s)
   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,
       g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
       g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt, 
       g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc,g_gzgj_m.gzgjmoddt
       ,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003, 
       g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008
       ,g_gzgj_m.l_gzgj009   #150909-00019#1 add       
   ##150611-00032#5 add(e)
   
   #add-point:新增結束後

   #end add-point 
   
   #功能已完成,通報訊息中心
   CALL azzi330_01_msgcentre_notify('')
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.modify" >}
#+ 資料修改
PRIVATE FUNCTION azzi330_01_modify()
   DEFINE l_new_key    DYNAMIC ARRAY OF STRING
   DEFINE l_old_key    DYNAMIC ARRAY OF STRING
   DEFINE l_field_key  DYNAMIC ARRAY OF STRING
   DEFINE l_wc2_table1          STRING
 
 
   #add-point:modify段define

   #end add-point    
   #add-point:modify段define(客製用)

   #end add-point    
 
   LET g_gzgj_m.gzgj010 = "1"    #150611-00032#5 add
   LET g_gzgj_m.l_gzgj010 = "2"  #150611-00032#5 add
 
   #保存單頭舊值
   LET g_gzgj_m_t.* = g_gzgj_m.*
   LET g_gzgj_m_o.* = g_gzgj_m.*
   
   IF g_gzgj_m.gzgj001 IS NULL
   OR g_gzgj_m.gzgj002 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   ERROR ""
  
   LET g_gzgj001_t = g_gzgj_m.gzgj001
   LET g_gzgj002_t = g_gzgj_m.gzgj002
   LET g_gzgj010_t = g_gzgj_m.gzgj010       #150611-00032#5 add
   LET g_l_gzgj010_t = g_gzgj_m.l_gzgj010   #150611-00032#5 add
 
   CALL s_transaction_begin()
 
   #150611-00032#5 mark(s)
#   OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002
#   IF STATUS THEN
#      INITIALIZE g_errparam TO NULL 
#      LET g_errparam.extend = "OPEN azzi330_01_cl:" 
#      LET g_errparam.code   = STATUS 
#      LET g_errparam.popup  = TRUE 
#      CALL cl_err()
#      CLOSE azzi330_01_cl
#      RETURN
#   END IF
# 
#   #顯示最新的資料
#   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002 INTO g_gzgj_m.gzgj001, 
#       g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005, 
#       g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt,g_gzgj_m.gzgjownid_desc, 
#       g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjmodid_desc 
   #150611-00032#5 mark(e)
   #150611-00032#5 add(s)
   IF NOT azzi330_01_chk_using('u') THEN RETURN END IF
   
   OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN azzi330_01_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE
      CALL cl_err()
      CLOSE azzi330_01_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010 INTO g_gzgj_m.gzgj001, 
       g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006, 
       g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc   
 
   OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN azzi330_01_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE  
      CALL cl_err()
      CLOSE azzi330_01_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,
       g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc   
   #150611-00032#5 add(e)
   
   #檢查是否允許此動作
   IF NOT azzi330_01_action_chk() THEN
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_gzgj_m_mask_o.* =  g_gzgj_m.*
   CALL azzi330_01_gzgj_t_mask()
   LET g_gzgj_m_mask_n.* =  g_gzgj_m.*
   
   
   
   #add-point:modify段show之前

   #end add-point  
   
   #LET l_wc2_table1 = g_wc2_table1
   #LET g_wc2_table1 = " 1=1"
 
 
   
   CALL azzi330_01_show()
   #add-point:modify段show之後

   #end add-point
   
   #LET g_wc2_table1 = l_wc2_table1
 
 
    
   WHILE TRUE
      LET g_gzgj001_t = g_gzgj_m.gzgj001
      LET g_gzgj002_t = g_gzgj_m.gzgj002
      LET g_gzgj010_t = g_gzgj_m.gzgj010     #150611-00032#5 add
      LET g_l_gzgj010_t = g_gzgj_m.l_gzgj010 #150611-00032#5 add
      
      #寫入修改者/修改日期資訊(單頭)
      LET g_gzgj_m.gzgjmodid = g_user 
LET g_gzgj_m.gzgjmoddt = cl_get_current()
LET g_gzgj_m.gzgjmodid_desc = cl_get_username(g_gzgj_m.gzgjmodid)
      
      #add-point:modify段修改前

      #end add-point
      
      #欄位更改
      LET g_loc = 'n'
      LET g_update = FALSE
      CALL azzi330_01_input("u")
      LET g_loc = 'n'
 
      #add-point:modify段修改後

      #end add-point
      
      IF g_update OR NOT INT_FLAG THEN
         #若有modid跟moddt則進行update
         UPDATE gzgj_t SET (gzgjmodid,gzgjmoddt) = (g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt)
          WHERE  gzgj001 = g_gzgj001_t
            AND gzgj002 = g_gzgj002_t
 
      END IF
    
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_gzgj_m.* = g_gzgj_m_t.*
         CALL azzi330_01_show()
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = '' 
         LET g_errparam.code   = 9001 
         LET g_errparam.popup  = FALSE
         CALL s_transaction_end('N','0')   #150611-00032#5 add         
         CALL cl_err()
         RETURN
      END IF 
                  
      #若單頭key欄位有變更
      IF g_gzgj_m.gzgj001 != g_gzgj001_t 
      OR g_gzgj_m.gzgj002 != g_gzgj002_t 
 
      THEN
         CALL s_transaction_begin()
         
         #add-point:單身fk修改前

         #end add-point
         
         #更新單身key值
         UPDATE gzgk_t SET gzgk001 = g_gzgj_m.gzgj001
                                       ,gzgk002 = g_gzgj_m.gzgj002
 
          WHERE  gzgk001 = g_gzgj001_t
            AND gzgk002 = g_gzgj002_t
 
            
         #add-point:單身fk修改中

         #end add-point
 
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "gzgk_t" 
               LET g_errparam.code   = "std-00009" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')   #150611-00032#5 add
               CONTINUE WHILE
            WHEN SQLCA.sqlcode #其他錯誤
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "gzgk_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')   #150611-00032#5 add
               CONTINUE WHILE
         END CASE
         
         #add-point:單身fk修改後

         #end add-point
         
 
         
 
         
         #UPDATE 多語言table key值
         
 
      END IF
    
      EXIT WHILE
   END WHILE
 
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL azzi330_01_set_act_visible()   
   CALL azzi330_01_set_act_no_visible()
 
   #組合新增資料的條件
   LET g_add_browse = " ",
                      " gzgj001 = '", g_gzgj_m.gzgj001, "' "
                      ," AND gzgj002 = '", g_gzgj_m.gzgj002, "' "
 
   #填到對應位置
   CALL azzi330_01_browser_fill("")
 
   CLOSE azzi330_01_cl
   
 
   #功能已完成,通報訊息中心
   CALL azzi330_01_msgcentre_notify('')
 
END FUNCTION   
 
{</section>}
 
{<section id="azzi330_01.input" >}
#+ 資料輸入
PRIVATE FUNCTION azzi330_01_input(p_cmd)
   DEFINE  p_cmd                 LIKE type_t.chr1
   DEFINE  l_cmd_t               LIKE type_t.chr1
   DEFINE  l_cmd                 LIKE type_t.chr1
   DEFINE  l_n                   LIKE type_t.num10                #檢查重複用  
   DEFINE  l_cnt                 LIKE type_t.num10                #檢查重複用  
   DEFINE  l_lock_sw             LIKE type_t.chr1                #單身鎖住否  
   DEFINE  l_allow_insert        LIKE type_t.num5                #可新增否 
   DEFINE  l_allow_delete        LIKE type_t.num5                #可刪除否  
   DEFINE  l_count               LIKE type_t.num10
   DEFINE  l_i                   LIKE type_t.num10
   DEFINE  l_insert              BOOLEAN
   DEFINE  ls_return             STRING
   DEFINE  l_var_keys            DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys          DYNAMIC ARRAY OF STRING
   DEFINE  l_vars                DYNAMIC ARRAY OF STRING
   DEFINE  l_fields              DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak        DYNAMIC ARRAY OF STRING
   DEFINE  lb_reproduce          BOOLEAN
   DEFINE  li_reproduce          LIKE type_t.num10
   DEFINE  li_reproduce_target   LIKE type_t.num10
   DEFINE  ls_keys               DYNAMIC ARRAY OF VARCHAR(500)
   #add-point:input段define
   DEFINE  l_gzgk006             LIKE type_t.chr10
   DEFINE  l_j                   LIKE type_t.num5
   DEFINE  l_field_idx           LIKE type_t.num5   #指到哪一欄
   DEFINE l_gzgk007   LIKE gzgk_t.gzgk007
   DEFINE l_gzgk008   LIKE gzgk_t.gzgk008
   DEFINE l_gzgk009   LIKE gzgk_t.gzgk009
   DEFINE l_gzgk010   LIKE gzgk_t.gzgk010
   DEFINE l_gzgk011   LIKE gzgk_t.gzgk011
   DEFINE l_gzgk012   LIKE gzgk_t.gzgk012
   DEFINE l_gzgk013   LIKE gzgk_t.gzgk013 
   DEFINE l_chk_width LIKE type_t.num5   
#150611-00032#5 add(s)
   DEFINE  l_gzgk006_1             LIKE type_t.chr10
   DEFINE l_gzgk007_1   LIKE gzgk_t.gzgk007
   DEFINE l_gzgk008_1   LIKE gzgk_t.gzgk008
   DEFINE l_gzgk009_1   LIKE gzgk_t.gzgk009
   DEFINE l_gzgk010_1   LIKE gzgk_t.gzgk010
   DEFINE l_gzgk011_1   LIKE gzgk_t.gzgk011
   DEFINE l_gzgk012_1   LIKE gzgk_t.gzgk012
   DEFINE l_gzgk013_1   LIKE gzgk_t.gzgk013 
#150611-00032#5 add(e)   
   #end add-point  
   #add-point:input段define(客製用)

   #end add-point  
   
   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r'
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF   
 
   #150611-00032#5 add(s)
   LET g_gzgj_m.gzgj010 = '1'
   LET g_gzgj_m.l_gzgj010 = '2' 
   LET g_gzgj010_t = g_gzgj_m.gzgj010
   LET g_l_gzgj010_t = g_gzgj_m.l_gzgj010
    
   #將資料輸出到畫面上
   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,
       g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
       g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt, 
       g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc,g_gzgj_m.gzgjmoddt
       ,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003, 
       g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008
       ,g_gzgj_m.l_gzgj009   #150909-00019#1 add       
   #150611-00032#5 add(e)
 
   #150611-00032#5 mark(s)
#   #將資料輸出到畫面上
#   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009, 
#       g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#       g_gzgj_m.l_col,g_gzgj_m.l_row,g_gzgj_m.gzgk009,g_gzgj_m.gzgk007,g_gzgj_m.gzgk008,g_gzgj_m.gzgk012_id, 
#       g_gzgj_m.gzgk012,g_gzgj_m.gzgk013_id,g_gzgj_m.gzgk013,g_gzgj_m.gzgk010,g_gzgj_m.gzgk011,g_gzgj_m.gzgjownid, 
#       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc, 
#       g_gzgj_m.gzgjmoddt
   #150611-00032#5 mark(e)
   
   #切換畫面
 
   CALL cl_set_head_visible("","YES")  
 
   LET l_insert = FALSE
   LET g_action_choice = ""
 
   #add-point:input段define_sql
   LET g_forupd_sql = "SELECT gzgk003,gzgk004,gzgk005,gzgk006 FROM gzgk_t WHERE gzgk001=? AND gzgk002=? AND 
       gzgk014=? AND gzgk003=? AND gzgk004=? FOR UPDATE"   #150611-00032#5 add gzgk014
   #end add-point 
   LET g_forupd_sql = "SELECT gzgk003,gzgk004,gzgk005 FROM gzgk_t WHERE gzgk001=? AND gzgk002=? AND  
       gzgk003=? AND gzgk004=? FOR UPDATE"
   #add-point:input段define_sql
   #150611-00032#5 add(s)
   LET g_forupd_sql = "SELECT gzgk003,gzgk004,gzgk005,gzgk006 FROM gzgk_t WHERE gzgk001=? AND gzgk002=? AND gzgk014=? AND   
       gzgk003=? AND gzgk004=?  FOR UPDATE"
   #150611-00032#5 add(e)       
   #end add-point 
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE azzi330_01_bcl CURSOR FROM g_forupd_sql
   
 
   
 
 
   #add-point:input段define_sql
   DECLARE azzi330_01_bcl2 CURSOR FROM g_forupd_sql   #150611-00032#5 add
   #end add-point 
 
   LET l_allow_insert = cl_auth_detail_input("insert")
   LET l_allow_delete = cl_auth_detail_input("delete")
   LET g_qryparam.state = 'i'
   
   #控制key欄位可否輸入
   CALL azzi330_01_set_entry(p_cmd)
   #add-point:set_entry後

   #end add-point
   CALL azzi330_01_set_no_entry(p_cmd)
 
   #150611-00032#5 mark(s)
#   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009, 
#       g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#       g_gzgj_m.l_col,g_gzgj_m.l_row,g_gzgj_m.gzgk009,g_gzgj_m.gzgk007,g_gzgj_m.gzgk008,g_gzgj_m.gzgk012_id, 
#       g_gzgj_m.gzgk012,g_gzgj_m.gzgk013_id,g_gzgj_m.gzgk013,g_gzgj_m.gzgk010,g_gzgj_m.gzgk011
   #150611-00032#5 mark(e)
 
   #150611-00032#5 add(s)
   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,
       g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
       g_gzgj_m.gzgjstus
       ,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003, 
       g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008
       ,g_gzgj_m.l_gzgj009   #150909-00019#1 add     
   #150611-00032#5 add(e)
 
   LET lb_reproduce = FALSE
   
   #關閉被遮罩相關欄位輸入, 無法確定USER是否會需要輸入此欄位
   #因此先行關閉, 若有需要可於下方add-point中自行開啟
   CALL cl_mask_set_no_entry()
   
   #add-point:資料輸入前

   #end add-point
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
{</section>}
 
{<section id="azzi330_01.input.head" >}
      #單頭段
      #150611-00032#5 mark(s)
#      INPUT BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009, 
#          g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#          g_gzgj_m.l_col,g_gzgj_m.l_row,g_gzgj_m.gzgk009,g_gzgj_m.gzgk007,g_gzgj_m.gzgk008,g_gzgj_m.gzgk012_id, 
#          g_gzgj_m.gzgk012,g_gzgj_m.gzgk013_id,g_gzgj_m.gzgk013,g_gzgj_m.gzgk010,g_gzgj_m.gzgk011 
      #150611-00032#5 mark(e)
      #150611-00032#5 add(s)
      INPUT BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgj003,
          g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
          g_gzgj_m.gzgjstus
         ,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007
         ,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj010
         ,g_gzgj_m.l_gzgj009   #150909-00019#1 add         
      #150611-00032#5 add(e)      
         ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂ACTION(master_input)
         
         #應用 a43 樣板自動產生(Version:2)
         ON ACTION update_item
            LET g_action_choice="update_item"
            IF cl_auth_chk_act("update_item") THEN
               
               #add-point:ON ACTION update_item
                IF NOT cl_null(g_gzgj_m.gzgj001) THEN
                  CALL n_gzgjl(g_gzgj_m.gzgj001) 
                  INITIALIZE g_ref_fields TO NULL 
                  LET g_ref_fields[1] = g_gzgj_m.gzgj001
                  CALL ap_ref_array2(g_ref_fields," SELECT gzgjl003 FROM gzgjl_t WHERE gzgjl001 = ?  AND gzgjl002 = '"||g_lang||"'","") RETURNING g_rtn_fields 
                  LET g_gzgj_m.gzgjl003 = g_rtn_fields[1] 
                  DISPLAY BY NAME g_gzgj_m.gzgjl003
                 
               END IF
               #END add-point
            END IF
 
 
 
     
         BEFORE INPUT
#            OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002  #150611-00032#5 mark
            #150611-00032#5 add(s)
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010            
            #150611-00032#5 add(e)
 
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN azzi330_01_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CALL s_transaction_end('N','0')   #150611-00032#5 add
               CLOSE azzi330_01_cl
               RETURN
            END IF
            LET g_master_multi_table_t.gzgjl001 = g_gzgj_m.gzgj001
LET g_master_multi_table_t.gzgjl003 = g_gzgj_m.gzgjl003
 
            IF l_cmd_t = 'r' THEN
               LET g_master_multi_table_t.gzgjl001 = ''
LET g_master_multi_table_t.gzgjl003 = ''
 
            END IF
            #因應離開單頭後已寫入資料庫, 若重新回到單頭則視為修改
            #因此需於此處開啟/關閉欄位
            CALL azzi330_01_set_entry(p_cmd)
            #add-point:資料輸入前
            IF cl_null(g_gzgj_m.l_gzgj009) THEN LET g_gzgj_m.l_gzgj009 = "N" END IF   #150909-00019#1 add
            #end add-point
            CALL azzi330_01_set_no_entry(p_cmd)
    
                  #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj001
            #add-point:BEFORE FIELD gzgj001

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj001
            
            #add-point:AFTER FIELD gzgj001
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  NOT cl_null(g_gzgj_m.gzgj001) AND NOT cl_null(g_gzgj_m.gzgj002) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_gzgj_m.gzgj001 != g_gzgj001_t  OR g_gzgj_m.gzgj002 != g_gzgj002_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM gzgj_t WHERE "||"gzgj001 = '"||g_gzgj_m.gzgj001 ||"' AND "|| "gzgj002 = '"||g_gzgj_m.gzgj002 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj001
            #add-point:ON CHANGE gzgj001

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjl003
            #add-point:BEFORE FIELD gzgjl003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjl003
            
            #add-point:AFTER FIELD gzgjl003

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgjl003
            #add-point:ON CHANGE gzgjl003

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj002
            #add-point:BEFORE FIELD gzgj002

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj002
            
            #add-point:AFTER FIELD gzgj002
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  NOT cl_null(g_gzgj_m.gzgj001) AND NOT cl_null(g_gzgj_m.gzgj002) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_gzgj_m.gzgj001 != g_gzgj001_t  OR g_gzgj_m.gzgj002 != g_gzgj002_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM gzgj_t WHERE "||"gzgj001 = '"||g_gzgj_m.gzgj001 ||"' AND "|| "gzgj002 = '"||g_gzgj_m.gzgj002 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF



            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj002
            #add-point:ON CHANGE gzgj002

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgjstus
            #add-point:BEFORE FIELD gzgjstus

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgjstus
            
            #add-point:AFTER FIELD gzgjstus

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgjstus
            #add-point:ON CHANGE gzgjstus

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj009
            #add-point:BEFORE FIELD gzgj009

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj009
            
            #add-point:AFTER FIELD gzgj009

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj009
            #add-point:ON CHANGE gzgj009

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj003
            #add-point:BEFORE FIELD gzgj003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj003
            
            #add-point:AFTER FIELD gzgj003

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj003
            #add-point:ON CHANGE gzgj003
            CALL azzi330_01_set_entry_info()   #150611-00032#5 add
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj004
            #add-point:BEFORE FIELD gzgj004

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj004
            
            #add-point:AFTER FIELD gzgj004
            ##給比例預設值
            IF g_gzgj_m.gzgj004 IS NOT NULL THEN
               CASE g_gzgj_m.gzgj004
                 WHEN "1"                
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF
                 WHEN "2"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET g_gzgj_m.gzgj006 = "1"
                   END IF                 
                 WHEN "3"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET g_gzgj_m.gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.gzgj007 IS NULL THEN
                      LET g_gzgj_m.gzgj007 = "1"
                   END IF                   
                 WHEN "4"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET g_gzgj_m.gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.gzgj007 IS NULL THEN
                      LET g_gzgj_m.gzgj007 = "1"
                   END IF    
                   IF g_gzgj_m.gzgj008 IS NULL THEN
                      LET g_gzgj_m.gzgj008 = "1"
                   END IF                      
               END CASE
            END IF
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj004
            #add-point:ON CHANGE gzgj004
            CALL azzi330_01_set_entry_info()   #150611-00032#5 add
            ##給比例預設值
            IF g_gzgj_m.gzgj004 IS NOT NULL THEN
               CASE g_gzgj_m.gzgj004
                 WHEN "1"                
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF
                 WHEN "2"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET g_gzgj_m.gzgj006 = "1"
                   END IF                 
                 WHEN "3"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET g_gzgj_m.gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.gzgj007 IS NULL THEN
                      LET g_gzgj_m.gzgj007 = "1"
                   END IF                   
                 WHEN "4"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET g_gzgj_m.gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET g_gzgj_m.gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.gzgj007 IS NULL THEN
                      LET g_gzgj_m.gzgj007 = "1"
                   END IF    
                   IF g_gzgj_m.gzgj008 IS NULL THEN
                      LET g_gzgj_m.gzgj008 = "1"
                   END IF                      
               END CASE
            END IF
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj005
            #add-point:BEFORE FIELD gzgj005

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj005
            
            #add-point:AFTER FIELD gzgj005

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj005
            #add-point:ON CHANGE gzgj005

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj006
            #add-point:BEFORE FIELD gzgj006

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj006
            
            #add-point:AFTER FIELD gzgj006
            IF g_gzgj_m.gzgj004 < 2 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj006
            #add-point:ON CHANGE gzgj006
            IF g_gzgj_m.gzgj004 < 2 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj007
            #add-point:BEFORE FIELD gzgj007
 
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj007
            
            #add-point:AFTER FIELD gzgj007
            IF g_gzgj_m.gzgj004 < 3 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj007
            #add-point:ON CHANGE gzgj007
            IF g_gzgj_m.gzgj004 < 3 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgj008
            #add-point:BEFORE FIELD gzgj008

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgj008
            
            #add-point:AFTER FIELD gzgj008
            IF g_gzgj_m.gzgj004 < 4 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgj008
            #add-point:ON CHANGE gzgj008
            IF g_gzgj_m.gzgj004 < 4 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF 
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_col
            #add-point:BEFORE FIELD l_col

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_col
            
            #add-point:AFTER FIELD l_col

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_col
            #add-point:ON CHANGE l_col

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_row
            #add-point:BEFORE FIELD l_row

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_row
            
            #add-point:AFTER FIELD l_row

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_row
            #add-point:ON CHANGE l_row

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk009
            #add-point:BEFORE FIELD gzgk009

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk009
            
            #add-point:AFTER FIELD gzgk009

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk009
            #add-point:ON CHANGE gzgk009

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk007
            #add-point:BEFORE FIELD gzgk007

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk007
            
            #add-point:AFTER FIELD gzgk007

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk007
            #add-point:ON CHANGE gzgk007

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk008
            #add-point:BEFORE FIELD gzgk008

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk008
            
            #add-point:AFTER FIELD gzgk008

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk008
            #add-point:ON CHANGE gzgk008

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk012_id
            #add-point:BEFORE FIELD gzgk012_id

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk012_id
            
            #add-point:AFTER FIELD gzgk012_id

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk012_id
            #add-point:ON CHANGE gzgk012_id

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk012
            #add-point:BEFORE FIELD gzgk012

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk012
            
            #add-point:AFTER FIELD gzgk012

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk012
            #add-point:ON CHANGE gzgk012

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk013_id
            #add-point:BEFORE FIELD gzgk013_id

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk013_id
            
            #add-point:AFTER FIELD gzgk013_id

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk013_id
            #add-point:ON CHANGE gzgk013_id

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk013
            #add-point:BEFORE FIELD gzgk013

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk013
            
            #add-point:AFTER FIELD gzgk013

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk013
            #add-point:ON CHANGE gzgk013

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk010
            #add-point:BEFORE FIELD gzgk010

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk010
            
            #add-point:AFTER FIELD gzgk010

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk010
            #add-point:ON CHANGE gzgk010

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk011
            #add-point:BEFORE FIELD gzgk011

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk011
            
            #add-point:AFTER FIELD gzgk011

            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk011
            #add-point:ON CHANGE gzgk011

            #END add-point 
 
 #欄位檢查
                  #Ctrlp:input.c.gzgj001
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj001
            #add-point:ON ACTION controlp INFIELD gzgj001
            ###  ### start ###
            INITIALIZE g_qryparam.* TO NULL 
            LET g_qryparam.state = "i"
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = ""
            LET g_qryparam.default2 = ""
            LET g_qryparam.where = "1=1"
            CALL q_gzgj001()
            LET g_gzgj_m.gzgj001 = g_qryparam.return1
            LET g_gzgj_m.gzgjl003 = g_qryparam.return2
            DISPLAY g_gzgj_m.gzgj001 TO gzgj001
            DISPLAY g_gzgj_m.gzgjl003 TO gzgjl003
            ###  ### end ###

            #END add-point
 
         #Ctrlp:input.c.gzgjl003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjl003
            #add-point:ON ACTION controlp INFIELD gzgjl003

            #END add-point
 
         #Ctrlp:input.c.gzgj002
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj002
            #add-point:ON ACTION controlp INFIELD gzgj002

            #END add-point
 
         #Ctrlp:input.c.gzgjstus
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgjstus
            #add-point:ON ACTION controlp INFIELD gzgjstus

            #END add-point
 
         #Ctrlp:input.c.gzgj009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj009
            #add-point:ON ACTION controlp INFIELD gzgj009

            #END add-point
 
         #Ctrlp:input.c.gzgj003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj003
            #add-point:ON ACTION controlp INFIELD gzgj003

            #END add-point
 
         #Ctrlp:input.c.gzgj004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj004
            #add-point:ON ACTION controlp INFIELD gzgj004

            #END add-point
 
         #Ctrlp:input.c.gzgj005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj005
            #add-point:ON ACTION controlp INFIELD gzgj005

            #END add-point
 
         #Ctrlp:input.c.gzgj006
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj006
            #add-point:ON ACTION controlp INFIELD gzgj006

            #END add-point
 
         #Ctrlp:input.c.gzgj007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj007
            #add-point:ON ACTION controlp INFIELD gzgj007

            #END add-point
 
         #Ctrlp:input.c.gzgj008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgj008
            #add-point:ON ACTION controlp INFIELD gzgj008

            #END add-point
 
         #Ctrlp:input.c.l_col
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_col
            #add-point:ON ACTION controlp INFIELD l_col

            #END add-point
 
         #Ctrlp:input.c.l_row
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_row
            #add-point:ON ACTION controlp INFIELD l_row

            #END add-point
 
         #Ctrlp:input.c.gzgk009
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk009
            #add-point:ON ACTION controlp INFIELD gzgk009

            #END add-point
 
         #Ctrlp:input.c.gzgk007
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk007
            #add-point:ON ACTION controlp INFIELD gzgk007

            #END add-point
 
         #Ctrlp:input.c.gzgk008
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk008
            #add-point:ON ACTION controlp INFIELD gzgk008

            #END add-point
 
         #Ctrlp:input.c.gzgk012_id
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk012_id
            #add-point:ON ACTION controlp INFIELD gzgk012_id

            #END add-point
 
         #Ctrlp:input.c.gzgk012
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk012
            #add-point:ON ACTION controlp INFIELD gzgk012

            #END add-point
 
         #Ctrlp:input.c.gzgk013_id
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk013_id
            #add-point:ON ACTION controlp INFIELD gzgk013_id

            #END add-point
 
         #Ctrlp:input.c.gzgk013
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk013
            #add-point:ON ACTION controlp INFIELD gzgk013

            #END add-point
 
         #Ctrlp:input.c.gzgk010
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk010
            #add-point:ON ACTION controlp INFIELD gzgk010

            #END add-point
 
         #Ctrlp:input.c.gzgk011
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk011
            #add-point:ON ACTION controlp INFIELD gzgk011

            #END add-point
 #欄位開窗
            
#150611-00032#5 add(s)
         AFTER FIELD l_gzgj004
            ##給比例預設值
            IF g_gzgj_m.l_gzgj004 IS NOT NULL THEN
               CASE g_gzgj_m.l_gzgj004
                 WHEN "1"                
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF
                 WHEN "2"
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.l_gzgj006 IS NULL THEN
                      LET g_gzgj_m.l_gzgj006 = "1"
                   END IF                 
                 WHEN "3"
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.l_gzgj006 IS NULL THEN
                      LET g_gzgj_m.l_gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.l_gzgj007 IS NULL THEN
                      LET g_gzgj_m.l_gzgj007 = "1"
                   END IF                   
                 WHEN "4"
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.l_gzgj006 IS NULL THEN
                      LET g_gzgj_m.l_gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.l_gzgj007 IS NULL THEN
                      LET g_gzgj_m.l_gzgj007 = "1"
                   END IF    
                   IF g_gzgj_m.l_gzgj008 IS NULL THEN
                      LET g_gzgj_m.l_gzgj008 = "1"
                   END IF                      
               END CASE
            END IF
 
         ON CHANGE l_gzgj004
            ##給比例預設值
            IF g_gzgj_m.l_gzgj004 IS NOT NULL THEN
               CASE g_gzgj_m.l_gzgj004
                 WHEN "1"                
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF
                 WHEN "2"
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.l_gzgj006 IS NULL THEN
                      LET g_gzgj_m.l_gzgj006 = "1"
                   END IF                 
                 WHEN "3"
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.l_gzgj006 IS NULL THEN
                      LET g_gzgj_m.l_gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.l_gzgj007 IS NULL THEN
                      LET g_gzgj_m.l_gzgj007 = "1"
                   END IF                   
                 WHEN "4"
                   IF g_gzgj_m.l_gzgj005 IS NULL THEN
                      LET g_gzgj_m.l_gzgj005 = "1"
                   END IF                 
                   IF g_gzgj_m.l_gzgj006 IS NULL THEN
                      LET g_gzgj_m.l_gzgj006 = "1"
                   END IF   
                   IF g_gzgj_m.l_gzgj007 IS NULL THEN
                      LET g_gzgj_m.l_gzgj007 = "1"
                   END IF    
                   IF g_gzgj_m.l_gzgj008 IS NULL THEN
                      LET g_gzgj_m.l_gzgj008 = "1"
                   END IF                      
               END CASE
            END IF
#150611-00032#5 add(e)
 
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
 
            #CALL cl_err_collect_show()      #錯誤訊息統整顯示
            #CALL cl_showmsg()
            DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgj002
                        
            #add-point:單頭INPUT後
            #檢查欄寬是否都有設比例
            LET l_chk_width = 0            
            CASE g_gzgj_m.gzgj004
              WHEN "1"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET l_chk_width = 1
                   END IF
              WHEN "2"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET l_chk_width = 1
                   END IF    
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET l_chk_width = 1
                   END IF  
              WHEN "3"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET l_chk_width = 1
                   END IF    
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET l_chk_width = 1
                   END IF  
                   IF g_gzgj_m.gzgj007 IS NULL THEN
                      LET l_chk_width = 1
                   END IF   
              WHEN "4"
                   IF g_gzgj_m.gzgj005 IS NULL THEN
                      LET l_chk_width = 1
                   END IF    
                   IF g_gzgj_m.gzgj006 IS NULL THEN
                      LET l_chk_width = 1
                   END IF  
                   IF g_gzgj_m.gzgj007 IS NULL THEN
                      LET l_chk_width = 1
                   END IF  
                   IF g_gzgj_m.gzgj008 IS NULL THEN
                      LET l_chk_width = 1
                   END IF                   
            END CASE
            IF l_chk_width = 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "" 
               LET g_errparam.code   = "azz-00708"
               LET g_errparam.popup  = TRUE 
               CALL cl_err()  
               EXIT DIALOG
            END IF             
            #end add-point
#150611-00032#5 mark(s)                        
#            IF p_cmd <> 'u' THEN
#    
#               CALL s_transaction_begin()
#150611-00032#5 mark(e)                                       
               #add-point:單頭新增前
#               LET g_gzgj_m.gzgjstus ='Y'  #141024 ADD #150611-00032#5 mark                    
               #end add-point
#150611-00032#5 mark(s)                                       
#               INSERT INTO gzgj_t (gzgj001,gzgj002,gzgjstus,gzgj009,gzgj003,gzgj004,gzgj005,gzgj006, 
#                   gzgj007,gzgj008,gzgjownid,gzgjowndp,gzgjcrtid,gzgjcrtdp,gzgjcrtdt,gzgjmodid,gzgjmoddt) 
#
#               VALUES (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003, 
#                   g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#                   g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt, 
#                   g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt) 
#               IF SQLCA.sqlcode THEN
#                  INITIALIZE g_errparam TO NULL 
#                  LET g_errparam.extend = "g_gzgj_m" 
#                  LET g_errparam.code   = SQLCA.sqlcode 
#                  LET g_errparam.popup  = TRUE 
#                  CALL cl_err()
#                  NEXT FIELD CURRENT
#               END IF
#150611-00032#5 mark(e)                                       
               #add-point:單頭新增中

               #end add-point
#150611-00032#5 mark(s)                                       
#                        INITIALIZE l_var_keys TO NULL 
#         INITIALIZE l_field_keys TO NULL 
#         INITIALIZE l_vars TO NULL 
#         INITIALIZE l_fields TO NULL 
#         IF g_gzgj_m.gzgj001 = g_master_multi_table_t.gzgjl001 AND
#         g_gzgj_m.gzgjl003 = g_master_multi_table_t.gzgjl003  THEN
#         ELSE 
#            LET l_var_keys[01] = g_gzgj_m.gzgj001
#            LET l_field_keys[01] = 'gzgjl001'
#            LET l_var_keys_bak[01] = g_master_multi_table_t.gzgjl001
#            LET l_var_keys[02] = g_dlang
#            LET l_field_keys[02] = 'gzgjl002'
#            LET l_var_keys_bak[02] = g_dlang
#            LET l_vars[01] = g_gzgj_m.gzgjl003
#            LET l_fields[01] = 'gzgjl003'
#            CALL cl_multitable(l_var_keys,l_field_keys,l_vars,l_fields,l_var_keys_bak,'gzgjl_t')
#         END IF 
#150611-00032#5 mark(e)                         
               
               #add-point:單頭新增後

               #end add-point
               
               IF l_cmd_t = 'r' AND p_cmd = 'a' THEN
                  CALL azzi330_01_detail_reproduce()
                  #因應特定程式需求, 重新刷新單身資料
                  CALL azzi330_01_b_fill()
               END IF
               
               #add-point:單頭新增後

               #end add-point
                                       
               LET g_master_insert = TRUE
#150611-00032#5 mark(s)             
#               LET p_cmd = 'u'
#            ELSE
#150611-00032#5 mark(e)               
               CALL s_transaction_begin()                                 
               #add-point:單頭修改前

               #end add-point
               
               #將遮罩欄位還原
               CALL azzi330_01_gzgj_t_mask_restore('restore_mask_o')
               
            SELECT COUNT(gzgj001) INTO l_count FROM gzgj_t WHERE gzgj001 = g_gzgj001_t AND gzgj002 = g_gzgj002_t AND gzgj010 = g_gzgj010_t #150611-00032#5 add
            IF l_count > 0 THEN  #150611-00032#5 add
               UPDATE gzgj_t SET (gzgj001,gzgj002,gzgjstus,gzgj009,gzgj003,gzgj004,gzgj005,gzgj006,gzgj007, 
                   gzgj008,gzgjownid,gzgjowndp,gzgjcrtid,gzgjcrtdp,gzgjcrtdt,gzgjmodid,gzgjmoddt) = (g_gzgj_m.gzgj001, 
                   g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004, 
                   g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid, 
                   g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid, 
                   g_gzgj_m.gzgjmoddt)
                WHERE  gzgj001 = g_gzgj001_t
                  AND gzgj002 = g_gzgj002_t
                  AND gzgj010 = g_gzgj010_t   #150611-00032#5 add
 
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgj_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CALL s_transaction_end('N','0')   #150611-00032#5 add                  
                  NEXT FIELD CURRENT
               END IF
            #150611-00032#5 add(s)
            ELSE
               INSERT INTO gzgj_t (gzgj001,gzgj002,gzgj010,gzgj003,gzgj004,gzgj005,gzgj006,gzgj007,gzgj008,
                   gzgj009,gzgjstus,gzgjownid,gzgjowndp,gzgjcrtid,gzgjcrtdp,gzgjcrtdt,gzgjmodid,gzgjmoddt) 
 
               VALUES (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,
                   g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
                   g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp, 
                   g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt) 
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "g_gzgj_m" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CALL s_transaction_end('N','0')
                  NEXT FIELD CURRENT
               END IF            
            END IF
            #150611-00032#5 add(e)                 
               #add-point:單頭修改中
            #150611-00032#5 add(s)
            SELECT COUNT(gzgj001) INTO l_count FROM gzgj_t WHERE gzgj001 = g_gzgj001_t AND gzgj002 = g_gzgj002_t AND gzgj010 = g_l_gzgj010_t
            IF l_count > 0 THEN
               UPDATE gzgj_t SET (gzgj001,gzgj002,gzgj003,gzgj004,gzgj005,gzgj006,gzgj007,gzgj008,
                   gzgj009,gzgjstus,gzgjownid,gzgjowndp,gzgjcrtid,gzgjcrtdp,gzgjcrtdt,gzgjmodid,gzgjmoddt) = (g_gzgj_m.gzgj001, 
                   g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,
                   g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009,g_gzgj_m.gzgjstus, 
                   g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt, 
                   g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt)
                WHERE  gzgj001 = g_gzgj001_t
                  AND gzgj002 = g_gzgj002_t
                  AND gzgj010 = g_l_gzgj010_t
 
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgj_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CALL s_transaction_end('N','0')
                  NEXT FIELD CURRENT
               END IF
            ELSE
               INSERT INTO gzgj_t (gzgj001,gzgj002,gzgj010,gzgj003,gzgj004,gzgj005,gzgj006,gzgj007,gzgj008,
                   gzgj009,gzgjstus,gzgjownid,gzgjowndp,gzgjcrtid,gzgjcrtdp,gzgjcrtdt,gzgjmodid,gzgjmoddt) 

               VALUES (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,
                   g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009, 
                   g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp, 
                   g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt) 
               IF SQLCA.sqlcode THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "g_gzgj_m" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CALL s_transaction_end('N','0')
                  NEXT FIELD CURRENT
               END IF            
            END IF            
            #150611-00032#5 add(e)
               #end add-point
               
               
                        INITIALIZE l_var_keys TO NULL 
         INITIALIZE l_field_keys TO NULL 
         INITIALIZE l_vars TO NULL 
         INITIALIZE l_fields TO NULL 
         IF g_gzgj_m.gzgj001 = g_master_multi_table_t.gzgjl001 AND
         g_gzgj_m.gzgjl003 = g_master_multi_table_t.gzgjl003  THEN
         ELSE 
            LET l_var_keys[01] = g_gzgj_m.gzgj001
            LET l_field_keys[01] = 'gzgjl001'
            LET l_var_keys_bak[01] = g_master_multi_table_t.gzgjl001
            LET l_var_keys[02] = g_dlang
            LET l_field_keys[02] = 'gzgjl002'
            LET l_var_keys_bak[02] = g_dlang
            LET l_vars[01] = g_gzgj_m.gzgjl003
            LET l_fields[01] = 'gzgjl003'
            CALL cl_multitable(l_var_keys,l_field_keys,l_vars,l_fields,l_var_keys_bak,'gzgjl_t')
         END IF 
 
               
               #將遮罩欄位進行遮蔽
               CALL azzi330_01_gzgj_t_mask_restore('restore_mask_n')
               
               #修改歷程記錄(單頭修改)
               LET g_log1 = util.JSON.stringify(g_gzgj_m_t)
               LET g_log2 = util.JSON.stringify(g_gzgj_m)
               IF NOT cl_log_modified_record(g_log1,g_log2) THEN
                  CALL s_transaction_end('N','0') #150611-00032#5 add               
               ELSE
                  CALL s_transaction_end('Y','0') #150611-00032#5 add
               END IF
               
               #add-point:單頭修改後

               #end add-point
#            END IF   #150611-00032#5 mark
            
            LET g_gzgj001_t = g_gzgj_m.gzgj001
            LET g_gzgj002_t = g_gzgj_m.gzgj002
 
            
      END INPUT
   
 
{</section>}
 
{<section id="azzi330_01.input.body" >}
   
      #Page1 預設值產生於此處
      INPUT ARRAY g_gzgk_d FROM s_detail1.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         #自訂ACTION(detail_input,page_1)
         
         
         BEFORE INPUT
            #add-point:資料輸入前
               CALL cl_set_act_visible("edit_att", TRUE)  #141002 add
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_gzgk_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL azzi330_01_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_detail_idx)
            END IF
            LET g_loc = 'm'
            LET g_rec_b = g_gzgk_d.getLength()
            #add-point:資料輸入前
             
            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2
            ##141002為了能進修改段
            # LET g_gzgk_d[l_ac].gzgk004 =1
            CALL cl_set_comp_entry("gzgk00602,gzgk00603,gzgk00604",TRUE)   #150611-00032#5 add
            #end add-point  
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx = l_ac
            LET g_current_page = 1
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002
                                     ,g_gzgj_m.gzgj010   #150611-00032#5 add
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN azzi330_01_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CLOSE azzi330_01_cl
               RETURN
            END IF
            
            LET g_rec_b = g_gzgk_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_gzgk_d[l_ac].gzgk003 IS NOT NULL
               AND g_gzgk_d[l_ac].gzgk004 IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_gzgk_d_t.* = g_gzgk_d[l_ac].*  #BACKUP
               LET g_gzgk_d_o.* = g_gzgk_d[l_ac].*  #BACKUP
               CALL azzi330_01_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b

               #end add-point  
               CALL azzi330_01_set_no_entry_b(l_cmd)
               IF NOT azzi330_01_lock_b("gzgk_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH azzi330_01_bcl INTO g_gzgk_d[l_ac].gzgk003,g_gzgk_d[l_ac].gzgk004,g_gzgk_d[l_ac].gzgk005 
 
                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_gzgk_d_t.gzgk003 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_gzgk_d_mask_o[l_ac].* =  g_gzgk_d[l_ac].*
                  CALL azzi330_01_gzgk_t_mask()
                  LET g_gzgk_d_mask_n[l_ac].* =  g_gzgk_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL azzi330_01_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row
            IF g_rec_b >= l_ac 
               AND g_gzgk_d[l_ac].gzgk003 IS NOT NULL
            THEN
               LET l_cmd='u'
               LET g_gzgk_d_t.* = g_gzgk_d[l_ac].*  #BACKUP
               LET g_gzgk_d_o.* = g_gzgk_d[l_ac].*  #BACKUP
               CALL azzi330_01_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b

               #end add-point  
               CALL azzi330_01_set_no_entry_b(l_cmd)
               IF NOT azzi330_01_lock_b("gzgk_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
#                  FETCH azzi330_01_bcl INTO g_gzgk_d[l_ac].gzgk003,g_gzgk_d[l_ac].gzgk004,g_gzgk_d[l_ac].gzgk005 
#
#                  IF SQLCA.sqlcode THEN
#                     INITIALIZE g_errparam TO NULL 
#                     LET g_errparam.extend = g_gzgk_d_t.gzgk003 
#                     LET g_errparam.code   = SQLCA.sqlcode 
#                     LET g_errparam.popup  = TRUE 
#                     CALL cl_err()
# 
#                     LET l_lock_sw = "Y"
#                  END IF
#                  
#                  LET g_bfill = "N"
#                  CALL azzi330_01_show()
#                  LET g_bfill = "Y"
#                  
#                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
            #其他table進行lock
            
        
         BEFORE INSERT
            
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_gzgk_d[l_ac].* TO NULL 
            INITIALIZE g_gzgk_d_t.* TO NULL 
            INITIALIZE g_gzgk_d_o.* TO NULL 
            #公用欄位給值(單身)
            
            #自定義預設值
            
            #add-point:modify段before備份
            ##判斷若是客戶家無法修改表頭代號是YY，ZZ
            IF FGL_GETENV("DGENV") = "c" THEN
               IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00707" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET INT_FLAG = 0
                  CANCEL INSERT                    
               END IF
            END IF
            
            
            #判斷行數是否超單頭設定行數
            IF  l_ac > g_gzgj_m.gzgj003 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00706" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET INT_FLAG = 0
                  CANCEL INSERT                  
            END IF                
            #end add-point
            LET g_gzgk_d_t.* = g_gzgk_d[l_ac].*     #新輸入資料
            LET g_gzgk_d_o.* = g_gzgk_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL azzi330_01_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b

            #end add-point
            CALL azzi330_01_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_gzgk_d[li_reproduce_target].* = g_gzgk_d[li_reproduce].*
 
               LET g_gzgk_d[li_reproduce_target].gzgk003 = NULL
               LET g_gzgk_d[li_reproduce_target].gzgk004 = NULL
 
            END IF
            
            #add-point:modify段before insert
            LET l_field_idx =''
            ##給行號
            SELECT MAX(gzgk003) + 1 INTO g_gzgk_d[l_ac].gzgk003 FROM gzgk_t
             WHERE gzgk001 = g_gzgj_m.gzgj001 AND gzgk002 = g_gzgj_m.gzgj002
               AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add
            IF g_gzgk_d[l_ac].gzgk003 = 0 OR g_gzgk_d[l_ac].gzgk003 IS NULL THEN
               LET g_gzgk_d[l_ac].gzgk003 = 1
            END IF   
            #end add-point  
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身新增
            ##判斷若是客戶家無法修改表頭代號是YY，ZZ
            IF FGL_GETENV("DGENV") = "c" THEN
               IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00707" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET INT_FLAG = 0
                  CANCEL INSERT                    
               END IF
            END IF
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(*) INTO l_count FROM gzgk_t 
             WHERE  gzgk001 = g_gzgj_m.gzgj001
               AND gzgk002 = g_gzgj_m.gzgj002
               AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add
               AND gzgk003 = g_gzgk_d[l_ac].gzgk003
               AND gzgk004 = g_gzgk_d[l_ac].gzgk004
 
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身新增前
            ##第一欄
            IF g_gzgk_d[l_ac].gzgk00601 IS NOT NULL THEN
               LET g_gzgk_d[l_ac].gzgk004 = 1 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE  gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002
                  AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add                  
                  AND gzgk003 = g_gzgk_d[l_ac].gzgk003
                  AND gzgk004 = g_gzgk_d[l_ac].gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF 
            ##第二欄
            IF g_gzgk_d[l_ac].gzgk00602 IS NOT NULL THEN
               LET g_gzgk_d[l_ac].gzgk004 = 2 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE  gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002 
                  AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add
                  AND gzgk003 = g_gzgk_d[l_ac].gzgk003
                  AND gzgk004 = g_gzgk_d[l_ac].gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF 
            ##第三欄
            IF g_gzgk_d[l_ac].gzgk00603 IS NOT NULL THEN
               LET g_gzgk_d[l_ac].gzgk004 = 3 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE  gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002
                  AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add                  
                  AND gzgk003 = g_gzgk_d[l_ac].gzgk003
                  AND gzgk004 = g_gzgk_d[l_ac].gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF 
            ##第四欄
            IF g_gzgk_d[l_ac].gzgk00604 IS NOT NULL THEN
               LET g_gzgk_d[l_ac].gzgk004 = 4 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE  gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002 
                  AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add                  
                  AND gzgk003 = g_gzgk_d[l_ac].gzgk003
                  AND gzgk004 = g_gzgk_d[l_ac].gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF             
               #end add-point
            
               #同步新增到同層的table
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_gzgj_m.gzgj001
               LET gs_keys[2] = g_gzgj_m.gzgj002
               LET gs_keys[3] = g_gzgk_d[g_detail_idx].gzgk003
               LET gs_keys[4] = g_gzgk_d[g_detail_idx].gzgk004
               CALL azzi330_01_insert_b('gzgk_t',gs_keys,"'1'")
                           
               #add-point:單身新增後

               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               INITIALIZE g_gzgk_d[l_ac].* TO NULL
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "gzgk_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL azzi330_01_b_fill()
               #資料多語言用-增/改
               
               #add-point:input段-after_insert

               #end add-point
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身刪除後(=d)

               #end add-point
            ELSE
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身刪除前
               ##判斷若是客戶家無法修改表頭代號是YY，ZZ
               IF FGL_GETENV("DGENV") = "c" THEN
                  IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "azz-00707" 
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()  

                     CANCEL DELETE                   
                  END IF
               END IF
               #end add-point 
               
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_gzgj_m.gzgj001
               LET gs_keys[gs_keys.getLength()+1] = g_gzgj_m.gzgj002
 
               LET gs_keys[gs_keys.getLength()+1] = g_gzgk_d_t.gzgk003
               LET gs_keys[gs_keys.getLength()+1] = g_gzgk_d_t.gzgk004
               LET gs_keys[gs_keys.getLength()+1] = g_gzgj_m.gzgj010   #150611-00032#5 add
            
               #刪除同層單身
               IF NOT azzi330_01_delete_b('gzgk_t',gs_keys,"'1'") THEN
                  CLOSE azzi330_01_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT azzi330_01_key_delete_b(gs_keys,'gzgk_t') THEN
                  CLOSE azzi330_01_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
               
               #add-point:單身刪除中

               #end add-point 
               
               CLOSE azzi330_01_bcl
            
               LET g_rec_b = g_rec_b-1
               #add-point:單身刪除後

               #end add-point
               LET l_count = g_gzgk_d.getLength()
               
               #add-point:單身刪除後(<>d)

               #end add-point
            END IF
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_gzgk_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
                  #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk003
            #add-point:BEFORE FIELD gzgk003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk003
            
            #add-point:AFTER FIELD gzgk003
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_gzgj_m.gzgj001 IS NOT NULL AND g_gzgj_m.gzgj002 IS NOT NULL AND g_gzgk_d[g_detail_idx].gzgk003 IS NOT NULL AND g_gzgk_d[g_detail_idx].gzgk004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_gzgj_m.gzgj001 != g_gzgj001_t OR g_gzgj_m.gzgj002 != g_gzgj002_t OR g_gzgk_d[g_detail_idx].gzgk003 != g_gzgk_d_t.gzgk003 OR g_gzgk_d[g_detail_idx].gzgk004 != g_gzgk_d_t.gzgk004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM gzgk_t WHERE "||"gzgk001 = '"||g_gzgj_m.gzgj001 ||"' AND "|| "gzgk002 = '"||g_gzgj_m.gzgj002 ||"' AND "|| "gzgk003 = '"||g_gzgk_d[g_detail_idx].gzgk003 ||"' AND "|| "gzgk004 = '"||g_gzgk_d[g_detail_idx].gzgk004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk003
            #add-point:ON CHANGE gzgk003

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk004
            #add-point:BEFORE FIELD gzgk004

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk004
            
            #add-point:AFTER FIELD gzgk004
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_gzgj_m.gzgj001 IS NOT NULL AND g_gzgj_m.gzgj002 IS NOT NULL AND g_gzgk_d[g_detail_idx].gzgk003 IS NOT NULL AND g_gzgk_d[g_detail_idx].gzgk004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_gzgj_m.gzgj001 != g_gzgj001_t OR g_gzgj_m.gzgj002 != g_gzgj002_t OR g_gzgk_d[g_detail_idx].gzgk003 != g_gzgk_d_t.gzgk003 OR g_gzgk_d[g_detail_idx].gzgk004 != g_gzgk_d_t.gzgk004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM gzgk_t WHERE "||"gzgk001 = '"||g_gzgj_m.gzgj001 ||"' AND "|| "gzgk002 = '"||g_gzgj_m.gzgj002 ||"' AND "|| "gzgk003 = '"||g_gzgk_d[g_detail_idx].gzgk003 ||"' AND "|| "gzgk004 = '"||g_gzgk_d[g_detail_idx].gzgk004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk004
            #add-point:ON CHANGE gzgk004

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk005
            #add-point:BEFORE FIELD gzgk005
            CALL azzi330_01_set_gzgk005_combo('gzgk005','1')   #150611-00032#5 add
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk005
            
            #add-point:AFTER FIELD gzgk005
            CALL azzi330_01_set_gzgk005_combo('gzgk005','1')   #150611-00032#5 add
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk005
            #add-point:ON CHANGE gzgk005
            CALL azzi330_01_set_gzgk005_combo('gzgk005','1')   #150611-00032#5 add
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk005_desc
            #add-point:BEFORE FIELD gzgk005_desc

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk005_desc
            
            #add-point:AFTER FIELD gzgk005_desc
            IF g_gzgk_d[l_ac].gzgk005_desc IS NULL THEN
               LET g_gzgk_d[l_ac].gzgk005 =''
            END IF
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk005_desc
            #add-point:ON CHANGE gzgk005_desc
            IF g_gzgk_d[l_ac].gzgk005_desc IS NULL THEN
               LET g_gzgk_d[l_ac].gzgk005 =''
            END IF
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00601
            #add-point:BEFORE FIELD gzgk00601
            #IF DIALOG.getFieldTouched("gzgk00601") THEN
               LET l_field_idx = 1
            #END IF 
            CALL azzi330_01_set_gzgk006_combo("gzgk00601",g_gzgj_m.gzgj010,l_field_idx)   #150611-00032#5 add
            #END add-point
 
         #150611-00032#5 add(s)
         IF INFIELD (gzgk00601) THEN
            LET l_field_idx = 1
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.gzgj010) 
         END IF                    
         #150611-00032#5 add(e)
         
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00601
            
            #add-point:AFTER FIELD gzgk00601
            #IF g_gzgk_d[l_ac].gzgk00601 <> g_gzgk_d_t.gzgk00601 THEN
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00601) > 1 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                                       
                  NEXT FIELD CURRENT
                END IF
           # END IF     
           # IF DIALOG.getFieldTouched("gzgk00601") THEN
               LET l_field_idx = 1
#               CALL azzi330_01_insert_combox_gzgk(l_field_idx)   #141106 add   #150611-00032#5 mark
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010) #150611-00032#5 add
           # END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk00601
            #add-point:ON CHANGE gzgk00601
            #IF g_gzgk_d[l_ac].gzgk00601 <> g_gzgk_d_t.gzgk00601 THEN  #141106 mark
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00601) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_d[l_ac].gzgk00601 =''      
                  NEXT FIELD CURRENT

               END IF
            #END IF  #141106 mark
            #IF DIALOG.getFieldTouched("gzgk00601") THEN
                  LET g_gzgk_d[l_ac].gzgk003 = g_detail_idx #150611-00032#5 add
                  LET l_field_idx = 1
#                  CALL azzi330_01_insert_combox_gzgk(l_field_idx)  #141106 add
                  CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010) #150611-00032#5 add
            #END IF 
            #150611-00032#5 add(s) 
            IF g_gzgk_d[l_ac].gzgk00601 = '20' OR g_gzgk_d[l_ac].gzgk00601 = '21' OR g_gzgk_d[l_ac].gzgk00601 = '23' OR g_gzgk_d[l_ac].gzgk00601 = '24' THEN
               LET g_gzgk_att_m.gzgk009 = '1'
            ELSE
               LET g_gzgk_att_m.gzgk009 = '3'            
            END IF            
            #150611-00032#5 add(e)            
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00602
            #add-point:BEFORE FIELD gzgk00602
            IF g_gzgj_m.gzgj004 < 2 OR g_gzgk_d[l_ac].gzgk005 MATCHES '[1467]' THEN
                  CALL cl_set_comp_entry("gzgk00602",FALSE)   #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF             
            #IF DIALOG.getFieldTouched("gzgk00602") THEN
               LET l_field_idx = 2
           # END IF 
           CALL azzi330_01_set_gzgk006_combo("gzgk00602",g_gzgj_m.gzgj010,l_field_idx)   #150611-00032#5 add
            #END add-point
 
         #150611-00032#5 add(s)
         IF INFIELD (gzgk00602) THEN
            LET l_field_idx = 2
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.gzgj010) 
         END IF                    
         #150611-00032#5 add(e)
         
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00602
            
            #add-point:AFTER FIELD gzgk00602
            IF g_gzgj_m.gzgj004 < 2  OR g_gzgk_d[l_ac].gzgk005 MATCHES '[1467]' THEN
                  CALL cl_set_comp_entry("gzgk00602",FALSE) #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_d[l_ac].gzgk00602 =''                        
            END IF               
            IF g_gzgk_d[l_ac].gzgk00602 <> g_gzgk_d_t.gzgk00602 THEN
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00602) > 1 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                     
                  NEXT FIELD CURRENT
               END IF
            END IF           
            #IF DIALOG.getFieldTouched("gzgk00602") THEN
               LET l_field_idx = 2
#               CALL azzi330_01_insert_combox_gzgk(l_field_idx)   #141106 add #150611-00032#5 mark
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010)   #150611-00032#5 add
            #END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk00602
            #add-point:ON CHANGE gzgk00602
            IF g_gzgj_m.gzgj004 < 2 OR g_gzgk_d[l_ac].gzgk005 MATCHES '[1467]' THEN
                  CALL cl_set_comp_entry("gzgk00602",FALSE)   #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_d[l_ac].gzgk00602 =''                    
            END IF            
            #IF g_gzgk_d[l_ac].gzgk00602 <> g_gzgk_d_t.gzgk00602 THEN   #141106 mark
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00602) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_d[l_ac].gzgk00602 =''      
                  NEXT FIELD CURRENT              
               END IF   
            #END IF  #141106 mark
            #IF DIALOG.getFieldTouched("gzgk00602") THEN
               LET g_gzgk_d[l_ac].gzgk003 = g_detail_idx #150611-00032#5 add
               LET l_field_idx = 2 
#                CALL azzi330_01_insert_combox_gzgk(l_field_idx) #150611-00032#5 mark
                CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010)  #150611-00032#5 add                
            #END IF 
            #150611-00032#5 add(s) 
            IF g_gzgk_d[l_ac].gzgk00602 = '20' OR g_gzgk_d[l_ac].gzgk00602 = '21' OR g_gzgk_d[l_ac].gzgk00602 = '23' OR g_gzgk_d[l_ac].gzgk00602 = '24' THEN
               LET g_gzgk_att_m.gzgk009 = '1'
            ELSE
               LET g_gzgk_att_m.gzgk009 = '3'            
            END IF            
            #150611-00032#5 add(e)             
            
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00603
            #add-point:BEFORE FIELD gzgk00603
            IF g_gzgj_m.gzgj004 < 3  OR g_gzgk_d[l_ac].gzgk005 MATCHES '[2457]' THEN
                  CALL cl_set_comp_entry("gzgk00603",FALSE)   #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()               
            END IF            
            #IF DIALOG.getFieldTouched("gzgk00603") THEN
               LET l_field_idx = 3
               CALL azzi330_01_set_gzgk006_combo("gzgk00603",g_gzgj_m.gzgj010,l_field_idx)   #150611-00032#5 add 
            #END IF 
            #END add-point
 
         #150611-00032#5 add(s)
         IF INFIELD (gzgk00603) THEN
            LET l_field_idx = 3
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.gzgj010) 
         END IF                    
         #150611-00032#5 add(e)
         
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00603
            
            #add-point:AFTER FIELD gzgk00603
            IF g_gzgj_m.gzgj004 < 3  OR g_gzgk_d[l_ac].gzgk005 MATCHES '[2457]' THEN
                  CALL cl_set_comp_entry("gzgk00603",FALSE)  #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE                   
                  CALL cl_err()  
                  LET g_gzgk_d[l_ac].gzgk00603 =''                    
            END IF            
            IF g_gzgk_d[l_ac].gzgk00603 <> g_gzgk_d_t.gzgk00603 THEN
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00603) > 1 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                   
                  NEXT FIELD CURRENT
               END IF
            END IF           
            #IF DIALOG.getFieldTouched("gzgk00603") THEN
               LET l_field_idx = 3
#               CALL azzi330_01_insert_combox_gzgk(l_field_idx)   #141106 add   #150611-00032#5 mark
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010)   #150611-00032#5 add
            #END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk00603
            #add-point:ON CHANGE gzgk00603
            IF g_gzgj_m.gzgj004 < 3 OR g_gzgk_d[l_ac].gzgk005 MATCHES '[2457]' THEN
                  CALL cl_set_comp_entry("gzgk00603",FALSE)   #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_d[l_ac].gzgk00603 =''                    
            END IF            
            #IF g_gzgk_d[l_ac].gzgk00603 <> g_gzgk_d_t.gzgk00603 THEN  #141106 mark
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00603) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_d[l_ac].gzgk00603 =''  
                  NEXT FIELD CURRENT
                    
                END IF
            #END IF        #141106 mark          
            #IF DIALOG.getFieldTouched("gzgk00603") THEN
               LET g_gzgk_d[l_ac].gzgk003 = g_detail_idx   #150611-00032#5 add
               LET l_field_idx = 3   
#               CALL azzi330_01_insert_combox_gzgk(l_field_idx)   #141106 add   #150611-00032#5 mark
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010)   #150611-00032#5 add
            #END IF 
            #150611-00032#5 add(s) 
            IF g_gzgk_d[l_ac].gzgk00603 = '20' OR g_gzgk_d[l_ac].gzgk00603 = '21' OR g_gzgk_d[l_ac].gzgk00603 = '23' OR g_gzgk_d[l_ac].gzgk00603 = '24' THEN
               LET g_gzgk_att_m.gzgk009 = '1'
            ELSE
               LET g_gzgk_att_m.gzgk009 = '3'            
            END IF            
            #150611-00032#5 add(e)             
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD gzgk00604
            #add-point:BEFORE FIELD gzgk00604

            IF g_gzgj_m.gzgj004 < 4 OR g_gzgk_d[l_ac].gzgk005 MATCHES '[3567]' THEN
                  CALL cl_set_comp_entry("gzgk00604",FALSE)   #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                                      
            END IF            
           # IF DIALOG.getFieldTouched("gzgk00604") THEN
               LET l_field_idx = 4
               CALL azzi330_01_set_gzgk006_combo("gzgk00604",g_gzgj_m.gzgj010,l_field_idx)   #150611-00032#5 add
           # END IF 
            #END add-point
 
         #150611-00032#5 add(s)
         IF INFIELD (gzgk00604) THEN
            LET l_field_idx = 4
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.gzgj010) 
         END IF 
         #150611-00032#5 add(e)
         
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD gzgk00604
            
            #add-point:AFTER FIELD gzgk00604
            IF g_gzgj_m.gzgj004 < 4  OR g_gzgk_d[l_ac].gzgk005 MATCHES '[3567]' THEN
                  CALL cl_set_comp_entry("gzgk00604",FALSE)   #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_d[l_ac].gzgk00604 =''                    
            END IF            
            IF  g_gzgk_d[l_ac].gzgk00604 <> g_gzgk_d_t.gzgk00604 THEN
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00604) > 1 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                   
                  NEXT FIELD CURRENT
                END IF
            END IF                
            #IF DIALOG.getFieldTouched("gzgk00604") THEN
               LET l_field_idx = 4
#               CALL azzi330_01_insert_combox_gzgk(l_field_idx)   #141106 add   #150611-00032#5 mark
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010)   #150611-00032#5 add
            #END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE gzgk00604
            #add-point:ON CHANGE gzgk00604

            IF g_gzgj_m.gzgj004 < 4 OR g_gzgk_d[l_ac].gzgk005 MATCHES '[3567]' THEN
                  CALL cl_set_comp_entry("gzgk00604",FALSE)   #150611-00032#5 add
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_d[l_ac].gzgk00604 =''                  
            END IF
            #IF g_gzgk_d[l_ac].gzgk00604 <> g_gzgk_d_t.gzgk00604 THEN   #141106 mark
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_d[l_ac].gzgk00604) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_d[l_ac].gzgk00604 =''  
                  NEXT FIELD CURRENT
                   
               END IF
            #END IF     #141106 mark              
            #IF DIALOG.getFieldTouched("gzgk00604") THEN
               LET g_gzgk_d[l_ac].gzgk003 = g_detail_idx   #150611-00032#5 add
               LET l_field_idx = 4  
#               CALL azzi330_01_insert_combox_gzgk(l_field_idx)   #141106 add   #150611-00032#5 mark
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010)    #150611-00032#5 add
            #END IF 
            #150611-00032#5 add(s) 
            IF g_gzgk_d[l_ac].gzgk00604 = '20' OR g_gzgk_d[l_ac].gzgk00604 = '21' OR g_gzgk_d[l_ac].gzgk00604 = '23' OR g_gzgk_d[l_ac].gzgk00604 = '24' THEN
               LET g_gzgk_att_m.gzgk009 = '1'
            ELSE
               LET g_gzgk_att_m.gzgk009 = '3'            
            END IF            
            #150611-00032#5 add(e)             
            #END add-point 
 
 
                  #Ctrlp:input.c.page1.gzgk003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk003
            #add-point:ON ACTION controlp INFIELD gzgk003


            #END add-point
 
         #Ctrlp:input.c.page1.gzgk004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk004
            #add-point:ON ACTION controlp INFIELD gzgk004

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk005
            #add-point:ON ACTION controlp INFIELD gzgk005
 
            #END add-point
 
         #Ctrlp:input.c.page1.gzgk005_desc
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk005_desc
            #add-point:ON ACTION controlp INFIELD gzgk005_desc
            ###  ### start ###
            INITIALIZE g_qryparam.* TO NULL 
            LET g_qryparam.state = "i"
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = ""
            LET g_qryparam.where = "1=1"
            LET g_qryparam.arg1 = g_gzgj_m.gzgj004
            CALL q_gzgl001()
            LET g_gzgk_d[l_ac].gzgk005 = g_qryparam.return1
            LET g_gzgk_d[l_ac].gzgk005_desc = g_qryparam.return2
            DISPLAY g_gzgk_d[l_ac].gzgk005 TO gzgk005
            DISPLAY g_gzgk_d[l_ac].gzgk005_desc TO gzgk005_desc
            ###  ### end ###
            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00601
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00601
            #add-point:ON ACTION controlp INFIELD gzgk00601

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00602
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00602
            #add-point:ON ACTION controlp INFIELD gzgk00602

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00603
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00603
            #add-point:ON ACTION controlp INFIELD gzgk00603

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00604
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD gzgk00604
            #add-point:ON ACTION controlp INFIELD gzgk00604

            #END add-point
 
 
 
         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               LET g_gzgk_d[l_ac].* = g_gzgk_d_t.*
               CLOSE azzi330_01_bcl
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_gzgk_d[l_ac].gzgk003 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_gzgk_d[l_ac].* = g_gzgk_d_t.*
            ELSE
            
               #add-point:單身修改前
               IF FGL_GETENV("DGENV") = "c" THEN
                  IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "azz-00707" 
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()  
           
                  END IF
               END IF
               
               LET g_gzgk_d_t.gzgk003 = l_ac
               FOR l_j = 1 TO g_gzgj_m.gzgj004
                  LET l_gzgk006 = ''  
                  CASE l_j
                    WHEN 1
                      LET g_gzgk_d[l_ac].gzgk004 = 1
                      LET g_gzgk_d_t.gzgk004 = 1
                      LET l_gzgk006 = g_gzgk_d[l_ac].gzgk00601
                    WHEN 2
                      LET g_gzgk_d[l_ac].gzgk004 = 2
                      LET g_gzgk_d_t.gzgk004 = 2
                      LET l_gzgk006 = g_gzgk_d[l_ac].gzgk00602 
                    WHEN 3
                      LET g_gzgk_d[l_ac].gzgk004 = 3
                      LET g_gzgk_d_t.gzgk004 = 3
                      LET l_gzgk006 = g_gzgk_d[l_ac].gzgk00603
                    WHEN 4
                      LET g_gzgk_d[l_ac].gzgk004 = 4
                      LET g_gzgk_d_t.gzgk004 = 4
                      LET l_gzgk006 = g_gzgk_d[l_ac].gzgk00604 
                   END CASE
                   
                   LET l_cnt = 0 
                   SELECT COUNT(gzgk004) INTO l_cnt FROM gzgk_t 
                      WHERE  gzgk001 = g_gzgj_m.gzgj001 
                        AND gzgk002 = g_gzgj_m.gzgj002 
                        AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add                        
                        AND gzgk003 = g_gzgk_d_t.gzgk003 #項次   
                        AND gzgk004 = g_gzgk_d_t.gzgk004
                   IF l_cnt > 0 THEN                        
                   
                     UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006) = (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002, 
                         g_gzgk_d[l_ac].gzgk003,g_gzgk_d[l_ac].gzgk004,g_gzgk_d[l_ac].gzgk005,l_gzgk006)
                      WHERE  gzgk001 = g_gzgj_m.gzgj001 
                        AND gzgk002 = g_gzgj_m.gzgj002 
                        AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add
                        AND gzgk003 = g_gzgk_d_t.gzgk003 #項次   
                        AND gzgk004 = g_gzgk_d_t.gzgk004  
                   ELSE
                     #找不到新增
                     ##語言別對應的字型
                     CASE g_gzgj_m.gzgj002
                          WHEN "en_US" 
                             LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)
                          WHEN "zh_TW" 
                             LET l_gzgk007 = cl_getmsg("azz-00700",g_lang)
                          WHEN "zh_CN" 
                             LET l_gzgk007 = cl_getmsg("azz-00701",g_lang)  
                          OTHERWISE 
                             LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)            
                     END CASE 
                    #141106 add  -(s)
                     CASE g_gzgk_d[l_ac].gzgk004
                       WHEN "11" 
                          #對內公司抬頭字型16
                          LET l_gzgk008 = "16"
                       WHEN  "12"
                          #對外公司抬頭字型16
                          LET l_gzgk008 = "16"                         
                       WHEN "16"
                          #報表抬頭
                          LET l_gzgk008 = "14"
                       OTHERWISE 
                          LET l_gzgk008 = "10"                
                     END CASE
                     #141106 add  -(s)                     
                     #LET l_gzgk008 = '10'
                     #150611-00032#5 add(s)
                     IF l_gzgk006 = '20' OR l_gzgk006 = '21' OR l_gzgk006 = '23' OR l_gzgk006 = '24' THEN
                        LET l_gzgk009 = '1'  #靠左
                     ELSE
                        LET l_gzgk009 = '3'  #置中                   
                     END IF
                     #150611-00032#5 add(e)                     
#                     LET l_gzgk009 = '3'   #150611-00032#5 mark
                     LET l_gzgk010 = 'N'
                     LET l_gzgk011 = 'N'
                     LET l_gzgk012 = '#000000'
                     LET l_gzgk013 = ''

                        INSERT INTO gzgk_t
                                (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,
                                 gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,
                                 gzgk013
                                 ,gzgk014   #150611-00032#5 add
                                ) 
                          VALUES(
                                 g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgk_d[l_ac].gzgk003,g_gzgk_d[l_ac].gzgk004
                                 ,g_gzgk_d[l_ac].gzgk005,l_gzgk006,
                                 l_gzgk007,l_gzgk008,l_gzgk009,l_gzgk010,l_gzgk011,l_gzgk012,l_gzgk013
                                 ,g_gzgj_m.gzgj010)   #150611-00032#5 add                

                   END IF
               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
#150611-00032#5 mark(s)      
#               #將遮罩欄位還原
#               CALL azzi330_01_gzgk_t_mask_restore('restore_mask_o')
#      
#               UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005) = (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002, 
#                   g_gzgk_d[l_ac].gzgk003,g_gzgk_d[l_ac].gzgk004,g_gzgk_d[l_ac].gzgk005)
#                WHERE  gzgk001 = g_gzgj_m.gzgj001 
#                  AND gzgk002 = g_gzgj_m.gzgj002 
# 
#                  AND gzgk003 = g_gzgk_d_t.gzgk003 #項次   
#                  AND gzgk004 = g_gzgk_d_t.gzgk004  
#150611-00032#5 mark(e)       
                  
               #add-point:單身修改中

               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "gzgk_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET g_gzgk_d[l_ac].* = g_gzgk_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "gzgk_t" 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()                   
                     LET g_gzgk_d[l_ac].* = g_gzgk_d_t.*  
                  OTHERWISE
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_gzgj_m.gzgj001
               LET gs_keys_bak[1] = g_gzgj001_t
               LET gs_keys[2] = g_gzgj_m.gzgj002
               LET gs_keys_bak[2] = g_gzgj002_t
               LET gs_keys[3] = g_gzgk_d[g_detail_idx].gzgk003
               LET gs_keys_bak[3] = g_gzgk_d_t.gzgk003
               LET gs_keys[4] = g_gzgk_d[g_detail_idx].gzgk004
               LET gs_keys_bak[4] = g_gzgk_d_t.gzgk004
               CALL azzi330_01_update_b('gzgk_t',gs_keys,gs_keys_bak,"'1'")
                     #資料多語言用-增/改
                     
               END CASE
 
               #將遮罩欄位進行遮蔽
               CALL azzi330_01_gzgk_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT(g_gzgk_d[g_detail_idx].gzgk003 = g_gzgk_d_t.gzgk003 
                  AND g_gzgk_d[g_detail_idx].gzgk004 = g_gzgk_d_t.gzgk004 
 
                  ) THEN
                  LET gs_keys[01] = g_gzgj_m.gzgj001
                  LET gs_keys[gs_keys.getLength()+1] = g_gzgj_m.gzgj002
 
                  LET gs_keys[gs_keys.getLength()+1] = g_gzgk_d_t.gzgk003
                  LET gs_keys[gs_keys.getLength()+1] = g_gzgk_d_t.gzgk004
 
                  CALL azzi330_01_key_update_b(gs_keys,'gzgk_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_gzgj_m),util.JSON.stringify(g_gzgk_d_t)
               LET g_log2 = util.JSON.stringify(g_gzgj_m),util.JSON.stringify(g_gzgk_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
               END IF
               
               #add-point:單身修改後
               END FOR
               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row
            CALL s_transaction_end('Y','0')   #150611-00032#5 add
            #end add-point
            CALL azzi330_01_unlock_b("gzgk_t","'1'")
            #其他table進行unlock
            #add-point:單身after_row2

            #end add-point
              
         AFTER INPUT
            #add-point:input段after input 

            #end add-point 
 
         ON ACTION controlo    
            CALL FGL_SET_ARR_CURR(g_gzgk_d.getLength()+1)
            LET lb_reproduce = TRUE
            LET li_reproduce = l_ac
            LET li_reproduce_target = g_gzgk_d.getLength()+1
            
         #ON ACTION cancel
         #   LET INT_FLAG = 1
         #   LET g_detail_idx = 1
         #   EXIT DIALOG 
 
      END INPUT
      
 
      
 
 
 
 
{</section>}
 
{<section id="azzi330_01.input.other" >}
      
      #add-point:自定義input
      #150611-00032#5 add(s)
      INPUT ARRAY g_gzgk_1_d FROM s_detail2.*
          ATTRIBUTE(COUNT = g_rec_b,WITHOUT DEFAULTS, #MAXCOUNT = g_max_rec,
                  INSERT ROW = l_allow_insert, 
                  DELETE ROW = l_allow_delete,
                  APPEND ROW = l_allow_insert)
 
         #自訂ACTION(detail_input,page_1)
         
         BEFORE INPUT
            #add-point:資料輸入前
            #end add-point
            IF g_insert = 'Y' AND NOT cl_null(g_insert) THEN 
              CALL FGL_SET_ARR_CURR(g_gzgk_1_d.getLength()+1) 
              LET g_insert = 'N' 
           END IF 
 
            CALL azzi330_01_b_fill()
            #如果一直都在單身1則控制筆數位置
            IF g_loc = 'm' AND g_rec_b != 0 THEN
               CALL FGL_SET_ARR_CURR(g_detail_idx2)
            END IF
            LET g_loc = 'm'
            LET g_rec_b = g_gzgk_1_d.getLength()
            #add-point:資料輸入前

            #end add-point
         
         BEFORE ROW
            #add-point:modify段before row2
            ##141002為了能進修改段
            # LET g_gzgk_1_d[l_ac].gzgk004 =1
            #end add-point
            CALL cl_set_comp_entry("l_gzgk00602,l_gzgk00603,l_gzgk00604",TRUE)
            LET l_insert = FALSE
            LET l_cmd = ''
            LET l_ac = ARR_CURR()
            LET g_detail_idx2 = l_ac
            
            LET l_lock_sw = 'N'            #DEFAULT
            LET l_n = ARR_COUNT()
            DISPLAY l_ac TO FORMONLY.idx
         
            CALL s_transaction_begin()
            OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010
            IF STATUS THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "OPEN azzi330_01_cl:" 
               LET g_errparam.code   = STATUS 
               LET g_errparam.popup  = TRUE
               CALL cl_err()
               CLOSE azzi330_01_cl
               RETURN
            END IF
            
            LET g_rec_b = g_gzgk_1_d.getLength()
            
            IF g_rec_b >= l_ac 
               AND g_gzgk_1_d[l_ac].l_gzgk003 IS NOT NULL
               AND g_gzgk_1_d[l_ac].l_gzgk004 IS NOT NULL
 
            THEN
               LET l_cmd='u'
               LET g_gzgk_1_d_t.* = g_gzgk_1_d[l_ac].*  #BACKUP
               LET g_gzgk_1_d_o.* = g_gzgk_1_d[l_ac].*  #BACKUP
               CALL azzi330_01_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b

               #end add-point  
               CALL azzi330_01_set_no_entry_b(l_cmd)
               IF NOT azzi330_01_lock_b("gzgk_1_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
                  FETCH azzi330_01_bcl2 INTO g_gzgk_1_d[l_ac].l_gzgk003,g_gzgk_1_d[l_ac].l_gzgk004,g_gzgk_1_d[l_ac].l_gzgk005

                  IF SQLCA.sqlcode THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = g_gzgk_1_d_t.l_gzgk003 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()
                     LET l_lock_sw = "Y"
                  END IF
                  
                  #遮罩相關處理
                  LET g_gzgk_1_d_mask_o[l_ac].* =  g_gzgk_1_d[l_ac].*
                  CALL azzi330_01_gzgk_t_mask()
                  LET g_gzgk_1_d_mask_n[l_ac].* =  g_gzgk_1_d[l_ac].*
                  
                  LET g_bfill = "N"
                  CALL azzi330_01_show()
                  LET g_bfill = "Y"
                  
                  CALL cl_show_fld_cont()
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #add-point:modify段before row
            IF g_rec_b >= l_ac 
               AND g_gzgk_1_d[l_ac].l_gzgk003 IS NOT NULL
            THEN
               LET l_cmd='u'
               LET g_gzgk_1_d_t.* = g_gzgk_1_d[l_ac].*  #BACKUP
               LET g_gzgk_1_d_o.* = g_gzgk_1_d[l_ac].*  #BACKUP
               CALL azzi330_01_set_entry_b(l_cmd)
               #add-point:modify段after_set_entry_b

               #end add-point  
               CALL azzi330_01_set_no_entry_b(l_cmd)
               IF NOT azzi330_01_lock_b("gzgk_1_t","'1'") THEN
                  LET l_lock_sw='Y'
               ELSE
               
               END IF
            ELSE
               LET l_cmd='a'
            END IF
            #end add-point  
            #其他table資料備份(確定是否更改用)
            
            #其他table進行lock
            
        
         BEFORE INSERT
            
            LET l_insert = TRUE
            LET l_n = ARR_COUNT()
            LET l_cmd = 'a'
            INITIALIZE g_gzgk_1_d[l_ac].* TO NULL 
            INITIALIZE g_gzgk_1_d_t.* TO NULL 
            INITIALIZE g_gzgk_1_d_o.* TO NULL 
            #公用欄位給值(單身)
            
            #自定義預設值
            
            #add-point:modify段before備份
            ##判斷若是客戶家無法修改表頭代號是YY，ZZ
            IF FGL_GETENV("DGENV") = "c" THEN
               IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00707" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET INT_FLAG = 0
                  CANCEL INSERT                    
               END IF
            END IF
            
            #判斷行數是否超單頭設定行數
            IF  l_ac > g_gzgj_m.l_gzgj003 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00706" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET INT_FLAG = 0
                  CANCEL INSERT                  
            END IF                
            #end add-point
            LET g_gzgk_1_d_t.* = g_gzgk_1_d[l_ac].*     #新輸入資料
            LET g_gzgk_1_d_o.* = g_gzgk_1_d[l_ac].*     #新輸入資料
            CALL cl_show_fld_cont()
            CALL azzi330_01_set_entry_b(l_cmd)
            #add-point:modify段after_set_entry_b

            #end add-point
            CALL azzi330_01_set_no_entry_b(l_cmd)
            IF lb_reproduce THEN
               LET lb_reproduce = FALSE
               LET g_gzgk_1_d[li_reproduce_target].* = g_gzgk_1_d[li_reproduce].*
 
               LET g_gzgk_1_d[li_reproduce_target].l_gzgk003 = NULL
               LET g_gzgk_1_d[li_reproduce_target].l_gzgk004 = NULL
 
            END IF
            
            #add-point:modify段before insert
            LET l_field_idx =''
            ##給行號
            SELECT MAX(gzgk003) + 1 INTO g_gzgk_1_d[l_ac].l_gzgk003 FROM gzgk_t
             WHERE gzgk001 = g_gzgj_m.gzgj001 AND gzgk002 = g_gzgj_m.gzgj002 AND gzgk014 = g_gzgj_m.l_gzgj010
            IF g_gzgk_1_d[l_ac].l_gzgk003 = 0 OR g_gzgk_1_d[l_ac].l_gzgk003 IS NULL THEN
               LET g_gzgk_1_d[l_ac].l_gzgk003 = 1
            END IF   
            #end add-point  
  
         AFTER INSERT
            LET l_insert = FALSE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               CANCEL INSERT
            END IF
               
            #add-point:單身新增
            ##判斷若是客戶家無法修改表頭代號是YY，ZZ
            IF FGL_GETENV("DGENV") = "c" THEN
               IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00707" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET INT_FLAG = 0
                  CANCEL INSERT                    
               END IF
            END IF
            #end add-point
               
            LET l_count = 1  
            SELECT COUNT(*) INTO l_count FROM gzgk_t 
             WHERE  gzgk001 = g_gzgj_m.gzgj001
               AND gzgk002 = g_gzgj_m.gzgj002
               AND gzgk014 = g_gzgj_m.l_gzgj010
 
               AND gzgk003 = g_gzgk_1_d[l_ac].l_gzgk003
               AND gzgk004 = g_gzgk_1_d[l_ac].l_gzgk004
                
            #資料未重複, 插入新增資料
            IF l_count = 0 THEN 
               #add-point:單身新增前
            ##第一欄
            IF g_gzgk_1_d[l_ac].l_gzgk00601 IS NOT NULL THEN
               LET g_gzgk_1_d[l_ac].l_gzgk004 = 1 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002
                  AND gzgk014 = g_gzgj_m.l_gzgj010                   
                  AND gzgk003 = g_gzgk_1_d[l_ac].l_gzgk003
                  AND gzgk004 = g_gzgk_1_d[l_ac].l_gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF 
            ##第二欄
            IF g_gzgk_1_d[l_ac].l_gzgk00602 IS NOT NULL THEN
               LET g_gzgk_1_d[l_ac].l_gzgk004 = 2 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002
                  AND gzgk014 = g_gzgj_m.l_gzgj010                   
                  AND gzgk003 = g_gzgk_1_d[l_ac].l_gzgk003
                  AND gzgk004 = g_gzgk_1_d[l_ac].l_gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF 
            ##第三欄
            IF g_gzgk_1_d[l_ac].l_gzgk00603 IS NOT NULL THEN
               LET g_gzgk_1_d[l_ac].l_gzgk004 = 3 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002
                  AND gzgk014 = g_gzgj_m.l_gzgj010                   
                  AND gzgk003 = g_gzgk_1_d[l_ac].l_gzgk003
                  AND gzgk004 = g_gzgk_1_d[l_ac].l_gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF 
            ##第四欄
            IF g_gzgk_1_d[l_ac].l_gzgk00604 IS NOT NULL THEN
               LET g_gzgk_1_d[l_ac].l_gzgk004 = 4 
               LET l_count = 1  
               SELECT COUNT(*) INTO l_count FROM gzgk_t 
                WHERE gzgk001 = g_gzgj_m.gzgj001
                  AND gzgk002 = g_gzgj_m.gzgj002
                  AND gzgk014 = g_gzgj_m.l_gzgj010                  
                  AND gzgk003 = g_gzgk_1_d[l_ac].l_gzgk003
                  AND gzgk004 = g_gzgk_1_d[l_ac].l_gzgk004
               IF SQLCA.SQLcode  THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "gzgk_t" 
                  LET g_errparam.code   = SQLCA.sqlcode 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()    
                  CALL s_transaction_end('N','0')                    
                  CANCEL INSERT
               END IF
            END IF             
               #end add-point
            
               #同步新增到同層的table
                              INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_gzgj_m.gzgj001
               LET gs_keys[2] = g_gzgj_m.gzgj002
               LET gs_keys[3] = g_gzgk_1_d[g_detail_idx2].l_gzgk003
               LET gs_keys[4] = g_gzgk_1_d[g_detail_idx2].l_gzgk004
               CALL azzi330_01_insert_b('gzgk_t',gs_keys,"'1'")
                           
               #add-point:單身新增後

               #end add-point
            ELSE    
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = 'INSERT' 
               LET g_errparam.code   = "std-00006" 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               INITIALIZE g_gzgk_1_d[l_ac].* TO NULL
               CANCEL INSERT
            END IF
 
            IF SQLCA.SQLcode  THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "gzgk_t" 
               LET g_errparam.code   = SQLCA.sqlcode 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               CANCEL INSERT
            ELSE
               #先刷新資料
               #CALL azzi330_01_b_fill()
               #資料多語言用-增/改
               
               #add-point:input段-after_insert

               #end add-point
               #ERROR 'INSERT O.K'
               LET g_rec_b = g_rec_b + 1
            END IF
              
         BEFORE DELETE                            #是否取消單身
            IF l_cmd = 'a' THEN
               LET l_cmd='d'
               #add-point:單身刪除後(=d)

               #end add-point
            ELSE
               IF NOT cl_ask_del_detail() THEN
                  CANCEL DELETE
               END IF
               IF l_lock_sw = "Y" THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = -263 
                  LET g_errparam.popup  = TRUE 
                  CALL cl_err()
                  CANCEL DELETE
               END IF
               
               #add-point:單身刪除前
               ##判斷若是客戶家無法修改表頭代號是YY，ZZ
               IF FGL_GETENV("DGENV") = "c" THEN
                  IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "azz-00707" 
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()  

                     CANCEL DELETE                   
                  END IF
               END IF
               #end add-point 
               
               #取得該筆資料key值
               INITIALIZE gs_keys TO NULL
               LET gs_keys[01] = g_gzgj_m.gzgj001
               LET gs_keys[gs_keys.getLength()+1] = g_gzgj_m.gzgj002
 
               LET gs_keys[gs_keys.getLength()+1] = g_gzgk_1_d_t.l_gzgk003
               LET gs_keys[gs_keys.getLength()+1] = g_gzgk_1_d_t.l_gzgk004
               LET gs_keys[gs_keys.getLength()+1] = g_gzgj_m.l_gzgj010
 
            
               #刪除同層單身
               IF NOT azzi330_01_delete_b('gzgk_t',gs_keys,"'2'") THEN
                  CLOSE azzi330_01_bcl
                  CANCEL DELETE
               END IF
    
               #刪除下層單身
               IF NOT azzi330_01_key_delete_b(gs_keys,'gzgk_t') THEN
                  CLOSE azzi330_01_bcl
                  CANCEL DELETE
               END IF
               
               #刪除多語言
               
               
               #add-point:單身刪除中

               #end add-point 
               
               CLOSE azzi330_01_bcl
            
               LET g_rec_b = g_rec_b-1
               #add-point:單身刪除後

               #end add-point
               LET l_count = g_gzgk_1_d.getLength()
               
               #add-point:單身刪除後(<>d)

               #end add-point
            END IF
 
         AFTER DELETE
            #如果是最後一筆
            IF l_ac = (g_gzgk_1_d.getLength() + 1) THEN
               CALL FGL_SET_ARR_CURR(l_ac-1)
            END IF
 
                  #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk003
            #add-point:BEFORE FIELD gzgk003

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk003
            
            #add-point:AFTER FIELD gzgk003
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_gzgj_m.gzgj001 IS NOT NULL AND g_gzgj_m.gzgj002 IS NOT NULL AND g_gzgk_1_d[g_detail_idx2].l_gzgk003 IS NOT NULL AND g_gzgk_1_d[g_detail_idx2].l_gzgk004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_gzgj_m.gzgj001 != g_gzgj001_t OR g_gzgj_m.gzgj002 != g_gzgj002_t OR g_gzgk_1_d[g_detail_idx2].l_gzgk003 != g_gzgk_1_d_t.l_gzgk003 OR g_gzgk_1_d[g_detail_idx2].l_gzgk004 != g_gzgk_1_d_t.l_gzgk004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM gzgk_t WHERE "||"gzgk001 = '"||g_gzgj_m.gzgj001 ||"' AND "|| "gzgk002 = '"||g_gzgj_m.gzgj002 ||"' AND "|| "gzgk003 = '"||g_gzgk_1_d[g_detail_idx2].l_gzgk003 ||"' AND "|| "gzgk004 = '"||g_gzgk_1_d[g_detail_idx2].l_gzgk004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk003
            #add-point:ON CHANGE gzgk003

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk004
            #add-point:BEFORE FIELD gzgk004

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk004
            
            #add-point:AFTER FIELD gzgk004
            #此段落由子樣板a05產生
            #確認資料無重複
            IF  g_gzgj_m.gzgj001 IS NOT NULL AND g_gzgj_m.gzgj002 IS NOT NULL AND g_gzgk_1_d[g_detail_idx2].l_gzgk003 IS NOT NULL AND g_gzgk_1_d[g_detail_idx2].l_gzgk004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_gzgj_m.gzgj001 != g_gzgj001_t OR g_gzgj_m.gzgj002 != g_gzgj002_t OR g_gzgk_1_d[g_detail_idx2].l_gzgk003 != g_gzgk_1_d_t.l_gzgk003 OR g_gzgk_1_d[g_detail_idx2].l_gzgk004 != g_gzgk_1_d_t.l_gzgk004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM gzgk_t WHERE "||"gzgk001 = '"||g_gzgj_m.gzgj001 ||"' AND "|| "gzgk002 = '"||g_gzgj_m.gzgj002 ||"' AND "|| "gzgk003 = '"||g_gzgk_1_d[g_detail_idx2].l_gzgk003 ||"' AND "|| "gzgk004 = '"||g_gzgk_1_d[g_detail_idx2].l_gzgk004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF


            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk004
            #add-point:ON CHANGE gzgk004

            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk005
            #add-point:BEFORE FIELD gzgk005
            CALL azzi330_01_set_gzgk005_combo('l_gzgk005','2')   #150611-00032#5 add
            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk005
            
            #add-point:AFTER FIELD gzgk005
            CALL azzi330_01_set_gzgk005_combo('l_gzgk005','2')   #150611-00032#5 add
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk005
            #add-point:ON CHANGE gzgk005
            CALL azzi330_01_set_gzgk005_combo('l_gzgk005','2')   #150611-00032#5 add
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk005_desc
            #add-point:BEFORE FIELD gzgk005_desc

            #END add-point
 
         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk005_desc
            
            #add-point:AFTER FIELD gzgk005_desc
            IF g_gzgk_1_d[l_ac].l_gzgk005_desc IS NULL THEN
               LET g_gzgk_1_d[l_ac].l_gzgk005 =''
            END IF
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk005_desc
            #add-point:ON CHANGE gzgk005_desc
            IF g_gzgk_1_d[l_ac].l_gzgk005_desc IS NULL THEN
               LET g_gzgk_1_d[l_ac].l_gzgk005 =''
            END IF
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00601
            #add-point:BEFORE FIELD gzgk00601
            #IF DIALOG.getFieldTouched("gzgk00601") THEN
               LET l_field_idx = 1
            #END IF 
            CALL azzi330_01_set_gzgk006_combo("l_gzgk00601",g_gzgj_m.l_gzgj010,l_field_idx)
            #END add-point

         IF INFIELD (l_gzgk00601) THEN
            LET l_field_idx = 1
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.l_gzgj010) 
         END IF                    

         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00601
            
            #add-point:AFTER FIELD gzgk00601
            IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00601) > 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "" 
               LET g_errparam.code   = "azz-00704" 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()                                       
               NEXT FIELD CURRENT
             END IF
           # IF DIALOG.getFieldTouched("gzgk00601") THEN
               LET l_field_idx = 1
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010)
           # END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk00601
            #add-point:ON CHANGE gzgk00601
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00601) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_1_d[l_ac].l_gzgk00601 =''      
                  NEXT FIELD CURRENT

               END IF
            #IF DIALOG.getFieldTouched("gzgk00601") THEN
                  LET l_field_idx = 1
            ##給行號
            LET g_gzgk_1_d[l_ac].l_gzgk003 = g_detail_idx2
                  CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010) 
            #END IF
            IF g_gzgk_1_d[l_ac].l_gzgk00601 = '20' OR g_gzgk_1_d[l_ac].l_gzgk00601 = '21' OR g_gzgk_1_d[l_ac].l_gzgk00601 = '23' OR g_gzgk_1_d[l_ac].l_gzgk00601 = '24' THEN
               LET g_gzgk_1_att_m.l_gzgk009 = '1'
            ELSE
               LET g_gzgk_1_att_m.l_gzgk009 = '3'            
            END IF            
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00602
            #add-point:BEFORE FIELD gzgk00602
            IF g_gzgj_m.l_gzgj004 < 2 OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[1467]' THEN
                  CALL cl_set_comp_entry("l_gzgk00602",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()
            END IF             
            #IF DIALOG.getFieldTouched("gzgk00602") THEN
               LET l_field_idx = 2
           # END IF
            CALL azzi330_01_set_gzgk006_combo("l_gzgk00602",g_gzgj_m.l_gzgj010,l_field_idx)
            #END add-point

         IF INFIELD (l_gzgk00602) THEN
            LET l_field_idx = 2
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.l_gzgj010) 
         END IF                    

         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00602
            
            #add-point:AFTER FIELD gzgk00602
            IF g_gzgj_m.l_gzgj004 < 2  OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[1467]' THEN
                  CALL cl_set_comp_entry("l_gzgk00602",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_1_d[l_ac].l_gzgk00602 =''
            END IF               
            IF g_gzgk_1_d[l_ac].l_gzgk00602 <> g_gzgk_1_d_t.l_gzgk00602 THEN
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00602) > 1 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                     
                  NEXT FIELD CURRENT
               END IF
            END IF           
            #IF DIALOG.getFieldTouched("gzgk00602") THEN
               LET l_field_idx = 2
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010)
            #END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk00602
            #add-point:ON CHANGE gzgk00602
            IF g_gzgj_m.l_gzgj004 < 2 OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[1467]' THEN
                  CALL cl_set_comp_entry("l_gzgk00602",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_1_d[l_ac].l_gzgk00602 =''
            END IF            
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00602) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_1_d[l_ac].l_gzgk00602 =''      
                  NEXT FIELD CURRENT              
               END IF   
            #IF DIALOG.getFieldTouched("gzgk00602") THEN
               LET l_field_idx = 2
            ##給行號
            LET g_gzgk_1_d[l_ac].l_gzgk003 = g_detail_idx2 
                CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010)
            #END IF

            IF g_gzgk_1_d[l_ac].l_gzgk00602 = '20' OR g_gzgk_1_d[l_ac].l_gzgk00602 = '21' OR g_gzgk_1_d[l_ac].l_gzgk00602 = '23' OR g_gzgk_1_d[l_ac].l_gzgk00602 = '24' THEN
               LET g_gzgk_1_att_m.l_gzgk009 = '1'
            ELSE
               LET g_gzgk_1_att_m.l_gzgk009 = '3'            
            END IF            
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00603
            #add-point:BEFORE FIELD gzgk00603
            IF g_gzgj_m.l_gzgj004 < 3  OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[2457]' THEN
                  CALL cl_set_comp_entry("l_gzgk00603",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()
            END IF            
            #IF DIALOG.getFieldTouched("gzgk00603") THEN
               LET l_field_idx = 3
            #END IF 
            CALL azzi330_01_set_gzgk006_combo("l_gzgk00603",g_gzgj_m.l_gzgj010,l_field_idx)      
            #END add-point

         IF INFIELD (l_gzgk00603) THEN
            LET l_field_idx = 3
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.l_gzgj010) 
         END IF                    

         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00603
            
            #add-point:AFTER FIELD gzgk00603
            IF g_gzgj_m.l_gzgj004 < 3  OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[2457]' THEN
                  CALL cl_set_comp_entry("l_gzgk00603",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE                   
                  CALL cl_err()  
                  LET g_gzgk_1_d[l_ac].l_gzgk00603 =''
            END IF            
            IF g_gzgk_1_d[l_ac].l_gzgk00603 <> g_gzgk_1_d_t.l_gzgk00603 THEN
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00603) > 1 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                   
                  NEXT FIELD CURRENT
               END IF
            END IF           
            #IF DIALOG.getFieldTouched("gzgk00603") THEN
               LET l_field_idx = 3
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010)
            #END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk00603
            #add-point:ON CHANGE gzgk00603
            IF g_gzgj_m.l_gzgj004 < 3 OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[2457]' THEN
                  CALL cl_set_comp_entry("l_gzgk00603",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_1_d[l_ac].l_gzgk00603 =''
            END IF            
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00603) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_1_d[l_ac].l_gzgk00603 =''  
                  NEXT FIELD CURRENT
                    
                END IF
            #END IF        #141106 mark          
            #IF DIALOG.getFieldTouched("gzgk00603") THEN
               LET l_field_idx = 3
            ##給行號
            LET g_gzgk_1_d[l_ac].l_gzgk003 = g_detail_idx2               
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010) 
            #END IF
            IF g_gzgk_1_d[l_ac].l_gzgk00603 = '20' OR g_gzgk_1_d[l_ac].l_gzgk00603 = '21' OR g_gzgk_1_d[l_ac].l_gzgk00603 = '23' OR g_gzgk_1_d[l_ac].l_gzgk00603 = '24' THEN
               LET g_gzgk_1_att_m.l_gzgk009 = '1'
            ELSE
               LET g_gzgk_1_att_m.l_gzgk009 = '3'            
            END IF            
            #END add-point 
 
         #應用 a01 樣板自動產生(Version:1)
         BEFORE FIELD l_gzgk00604
            #add-point:BEFORE FIELD gzgk00604

            IF g_gzgj_m.l_gzgj004 < 4 OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[3567]' THEN
                  CALL cl_set_comp_entry("l_gzgk00604",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()
            END IF            
           # IF DIALOG.getFieldTouched("gzgk00604") THEN
               LET l_field_idx = 4
           # END IF
            CALL azzi330_01_set_gzgk006_combo("l_gzgk00604",g_gzgj_m.l_gzgj010,l_field_idx)
            #END add-point

         IF INFIELD (l_gzgk00604) THEN
            LET l_field_idx = 4
            CALL azzi330_01_s01_field(l_field_idx,g_gzgj_m.l_gzgj010) 
         END IF                    

         #應用 a02 樣板自動產生(Version:1)
         AFTER FIELD l_gzgk00604
            
            #add-point:AFTER FIELD gzgk00604
            IF g_gzgj_m.l_gzgj004 < 4  OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[3567]' THEN
                  CALL cl_set_comp_entry("l_gzgk00604",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_1_d[l_ac].l_gzgk00604 =''
            END IF            
            IF  g_gzgk_1_d[l_ac].l_gzgk00604 <> g_gzgk_1_d_t.l_gzgk00604 THEN
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00604) > 1 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()                   
                  NEXT FIELD CURRENT
                END IF
            END IF                
            #IF DIALOG.getFieldTouched("gzgk00604") THEN
               LET l_field_idx = 4
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010)
            #END IF 
            #END add-point
            
 
         #應用 a04 樣板自動產生(Version:2)
         ON CHANGE l_gzgk00604
            #add-point:ON CHANGE gzgk00604

            IF g_gzgj_m.l_gzgj004 < 4 OR g_gzgk_1_d[l_ac].l_gzgk005 MATCHES '[3567]' THEN
                  CALL cl_set_comp_entry("l_gzgk00604",FALSE)
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00705" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err()  
                  LET g_gzgk_1_d[l_ac].l_gzgk00604 ='' 
            END IF
               IF azzi330_01_chk_gzgk006_exist(g_gzgk_1_d[l_ac].l_gzgk00604) > 0 THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "" 
                  LET g_errparam.code   = "azz-00704" 
                  LET g_errparam.popup  = FALSE 
                  CALL cl_err() 
                  LET g_gzgk_1_d[l_ac].l_gzgk00604 =''  
                  NEXT FIELD CURRENT
                   
               END IF
            #END IF     #141106 mark              
            #IF DIALOG.getFieldTouched("gzgk00604") THEN
               LET l_field_idx = 4
            ##給行號
            LET g_gzgk_1_d[l_ac].l_gzgk003 = g_detail_idx2             
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010)
            #END IF
            IF g_gzgk_1_d[l_ac].l_gzgk00604 = '20' OR g_gzgk_1_d[l_ac].l_gzgk00604 = '21' OR g_gzgk_1_d[l_ac].l_gzgk00604 = '23' OR g_gzgk_1_d[l_ac].l_gzgk00604 = '24' THEN
               LET g_gzgk_1_att_m.l_gzgk009 = '1'
            ELSE
               LET g_gzgk_1_att_m.l_gzgk009 = '3'            
            END IF            
            #END add-point 
 
 
                  #Ctrlp:input.c.page1.gzgk003
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk003
            #add-point:ON ACTION controlp INFIELD gzgk003


            #END add-point
 
         #Ctrlp:input.c.page1.gzgk004
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk004
            #add-point:ON ACTION controlp INFIELD gzgk004

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk005
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk005
            #add-point:ON ACTION controlp INFIELD gzgk005

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk005_desc
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk005_desc
            #add-point:ON ACTION controlp INFIELD gzgk005_desc
            ###  ### start ###
            INITIALIZE g_qryparam.* TO NULL 
            LET g_qryparam.state = "i"
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = ""
            LET g_qryparam.where = "1=1"
            LET g_qryparam.arg1 = g_gzgj_m.l_gzgj004
            CALL q_gzgl001()
            LET g_gzgk_1_d[l_ac].l_gzgk005 = g_qryparam.return1
            LET g_gzgk_1_d[l_ac].l_gzgk005_desc = g_qryparam.return2
            DISPLAY g_gzgk_1_d[l_ac].l_gzgk005 TO l_gzgk005
            DISPLAY g_gzgk_1_d[l_ac].l_gzgk005_desc TO l_gzgk005_desc
            ###  ### end ###
            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00601
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00601
            #add-point:ON ACTION controlp INFIELD gzgk00601

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00602
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00602
            #add-point:ON ACTION controlp INFIELD gzgk00602

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00603
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00603
            #add-point:ON ACTION controlp INFIELD gzgk00603

            #END add-point
 
         #Ctrlp:input.c.page1.gzgk00604
         #應用 a03 樣板自動產生(Version:2)
         ON ACTION controlp INFIELD l_gzgk00604
            #add-point:ON ACTION controlp INFIELD gzgk00604

            #END add-point
 
 
 
         ON ROW CHANGE
            IF INT_FLAG THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = '' 
               LET g_errparam.code   = 9001 
               LET g_errparam.popup  = FALSE 
               CALL cl_err()
               LET INT_FLAG = 0
               LET g_gzgk_1_d[l_ac].* = g_gzgk_1_d_t.*
               CLOSE azzi330_01_bcl
               EXIT DIALOG 
            END IF
              
            IF l_lock_sw = 'Y' THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = g_gzgk_1_d[l_ac].l_gzgk003 
               LET g_errparam.code   = -263 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
               LET g_gzgk_1_d[l_ac].* = g_gzgk_1_d_t.*
            ELSE
            
               #add-point:單身修改前
               IF FGL_GETENV("DGENV") = "c" THEN
                  IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "" 
                     LET g_errparam.code   = "azz-00707" 
                     LET g_errparam.popup  = TRUE
                     CALL cl_err()  
           
                  END IF
               END IF
                              
               LET g_gzgk_1_d_t.l_gzgk003 = l_ac
               FOR l_j = 1 TO g_gzgj_m.l_gzgj004
                  LET l_gzgk006_1 = ''  
                  CASE l_j
                    WHEN 1
                      LET g_gzgk_1_d[l_ac].l_gzgk004 = 1
                      LET g_gzgk_1_d_t.l_gzgk004 = 1
                      LET l_gzgk006_1 = g_gzgk_1_d[l_ac].l_gzgk00601
                    WHEN 2
                      LET g_gzgk_1_d[l_ac].l_gzgk004 = 2
                      LET g_gzgk_1_d_t.l_gzgk004 = 2
                      LET l_gzgk006_1 = g_gzgk_1_d[l_ac].l_gzgk00602 
                    WHEN 3
                      LET g_gzgk_1_d[l_ac].l_gzgk004 = 3
                      LET g_gzgk_1_d_t.l_gzgk004 = 3
                      LET l_gzgk006_1 = g_gzgk_1_d[l_ac].l_gzgk00603
                    WHEN 4
                      LET g_gzgk_1_d[l_ac].l_gzgk004 = 4
                      LET g_gzgk_1_d_t.l_gzgk004 = 4
                      LET l_gzgk006_1 = g_gzgk_1_d[l_ac].l_gzgk00604 
                   END CASE
                   
                   LET l_cnt = 0 
                   SELECT COUNT(gzgk004) INTO l_cnt FROM gzgk_t 
                      WHERE  gzgk001 = g_gzgj_m.gzgj001 
                        AND gzgk002 = g_gzgj_m.gzgj002
                        AND gzgk014 = g_gzgj_m.l_gzgj010                        
                        AND gzgk003 = g_gzgk_1_d_t.l_gzgk003 #項次   
                        AND gzgk004 = g_gzgk_1_d_t.l_gzgk004
                   IF l_cnt > 0 THEN                        
                   
                     UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006) = (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002, 
                         g_gzgk_1_d[l_ac].l_gzgk003,g_gzgk_1_d[l_ac].l_gzgk004,g_gzgk_1_d[l_ac].l_gzgk005,l_gzgk006_1)
                      WHERE  gzgk001 = g_gzgj_m.gzgj001 
                        AND gzgk002 = g_gzgj_m.gzgj002
                        AND gzgk014 = g_gzgj_m.l_gzgj010                        
                        AND gzgk003 = g_gzgk_1_d_t.l_gzgk003 #項次   
                        AND gzgk004 = g_gzgk_1_d_t.l_gzgk004                         
                   ELSE
                     #找不到新增
                     ##語言別對應的字型
                     CASE g_gzgj_m.gzgj002
                          WHEN "en_US" 
                             LET l_gzgk007_1 = cl_getmsg("azz-00702",g_lang)
                          WHEN "zh_TW" 
                             LET l_gzgk007_1 = cl_getmsg("azz-00700",g_lang)
                          WHEN "zh_CN" 
                             LET l_gzgk007_1 = cl_getmsg("azz-00701",g_lang)  
                          OTHERWISE 
                             LET l_gzgk007_1 = cl_getmsg("azz-00702",g_lang)            
                     END CASE 
                     CASE g_gzgk_1_d[l_ac].l_gzgk004
                       WHEN "11" 
                          #對內公司抬頭字型16
                          LET l_gzgk008_1 = "16"
                       WHEN  "12"
                          #對外公司抬頭字型16
                          LET l_gzgk008_1 = "16"                         
                       WHEN "16"
                          #報表抬頭
                          LET l_gzgk008_1 = "14"
                       OTHERWISE 
                          LET l_gzgk008_1 = "10"                
                     END CASE
                     LET l_gzgk009_1 = '3'
                     LET l_gzgk010_1 = 'N'
                     LET l_gzgk011_1 = 'N'
                     LET l_gzgk012_1 = '#000000'
                     LET l_gzgk013_1 = ''
                        INSERT INTO gzgk_t
                                (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,
                                 gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,
                                 gzgk013,gzgk014
                                ) 
                          VALUES(
                                 g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgk_1_d[l_ac].l_gzgk003,g_gzgk_1_d[l_ac].l_gzgk004
                                 ,g_gzgk_1_d[l_ac].l_gzgk005,l_gzgk006_1,
                                 l_gzgk007_1,l_gzgk008_1,l_gzgk009_1,l_gzgk010_1,l_gzgk011_1,l_gzgk012_1,l_gzgk013_1,g_gzgj_m.l_gzgj010) 
                   END IF
               #end add-point
               
               #寫入修改者/修改日期資訊(單身)
               
      
               #將遮罩欄位還原
                  
               #add-point:單身修改中

               #end add-point
               CASE
                  WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "gzgk_t" 
                     LET g_errparam.code   = "std-00009" 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()
                     LET g_gzgk_1_d[l_ac].* = g_gzgk_1_d_t.*
                  WHEN SQLCA.sqlcode #其他錯誤
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend = "gzgk_t" 
                     LET g_errparam.code   = SQLCA.sqlcode 
                     LET g_errparam.popup  = TRUE 
                     CALL cl_err()                   
                     LET g_gzgk_1_d[l_ac].* = g_gzgk_1_d_t.*  
                  OTHERWISE
                                    INITIALIZE gs_keys TO NULL 
               LET gs_keys[1] = g_gzgj_m.gzgj001
               LET gs_keys_bak[1] = g_gzgj001_t
               LET gs_keys[2] = g_gzgj_m.gzgj002
               LET gs_keys_bak[2] = g_gzgj002_t
               LET gs_keys[3] = g_gzgk_1_d[g_detail_idx2].l_gzgk003
               LET gs_keys_bak[3] = g_gzgk_1_d_t.l_gzgk003
               LET gs_keys[4] = g_gzgk_1_d[g_detail_idx2].l_gzgk004
               LET gs_keys_bak[4] = g_gzgk_1_d_t.l_gzgk004

               CALL azzi330_01_update_b('gzgk_t',gs_keys,gs_keys_bak,"'1'")
                     #資料多語言用-增/改
                     
               END CASE
 
               #將遮罩欄位進行遮蔽
               CALL azzi330_01_gzgk_t_mask_restore('restore_mask_n')
               
               #判斷key是否有改變
               INITIALIZE gs_keys TO NULL
               IF NOT(g_gzgk_1_d[g_detail_idx2].l_gzgk003 = g_gzgk_1_d_t.l_gzgk003 
                  AND g_gzgk_1_d[g_detail_idx2].l_gzgk004 = g_gzgk_1_d_t.l_gzgk004 
 
                  ) THEN
                  LET gs_keys[01] = g_gzgj_m.gzgj001
                  LET gs_keys[gs_keys.getLength()+1] = g_gzgj_m.gzgj002
 
                  LET gs_keys[gs_keys.getLength()+1] = g_gzgk_1_d_t.l_gzgk003
                  LET gs_keys[gs_keys.getLength()+1] = g_gzgk_1_d_t.l_gzgk004
 
                  CALL azzi330_01_key_update_b(gs_keys,'gzgk_t')
               END IF
               
               #修改歷程記錄(單身修改)
               LET g_log1 = util.JSON.stringify(g_gzgj_m),util.JSON.stringify(g_gzgk_1_d_t)
               LET g_log2 = util.JSON.stringify(g_gzgj_m),util.JSON.stringify(g_gzgk_1_d[l_ac])
               IF NOT cl_log_modified_record_d(g_log1,g_log2) THEN 
               END IF
               
               #add-point:單身修改後
               END FOR
               #end add-point
 
            END IF
            
         AFTER ROW
            #add-point:單身after_row

            #end add-point
            CALL azzi330_01_unlock_b("gzgk_t","'1'")
            #其他table進行unlock
            #add-point:單身after_row2
            CALL s_transaction_end('Y','0')
            #end add-point
              
         AFTER INPUT
            #add-point:input段after input 

            #end add-point 
 
         ON ACTION controlo    
            CALL FGL_SET_ARR_CURR(g_gzgk_1_d.getLength()+1)
            LET lb_reproduce = TRUE
            LET li_reproduce = l_ac
            LET li_reproduce_target = g_gzgk_1_d.getLength()+1
            
         #ON ACTION cancel
         #   LET INT_FLAG = 1
         #   LET g_detail_idx = 1
         #   EXIT DIALOG 
 
      END INPUT

       INPUT BY NAME  g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,g_gzgk_att_m.gzgk010,
                      g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012_id,g_gzgk_att_m.gzgk012,g_gzgk_att_m.gzgk013_id,
                      g_gzgk_att_m.gzgk013                                      
                      ATTRIBUTE(WITHOUT DEFAULTS)
                      
            BEFORE INPUT
               
            ON CHANGE gzgk012_id
               CALL azzi330_01_s01_set_color_16(g_gzgk_att_m.gzgk012_id,"gzgk012")
 
            ON CHANGE gzgk013_id
               CALL azzi330_01_s01_set_color_16(g_gzgk_att_m.gzgk013_id,"gzgk013") 
   
            AFTER FIELD gzgk012_id
   
            AFTER FIELD gzgk013_id
   
            AFTER INPUT 
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.gzgj010)                        
      END INPUT

       INPUT BY NAME  g_gzgk_1_att_m.l_gzgk007,g_gzgk_1_att_m.l_gzgk008,g_gzgk_1_att_m.l_gzgk009,g_gzgk_1_att_m.l_gzgk010,
                      g_gzgk_1_att_m.l_gzgk011,g_gzgk_1_att_m.l_gzgk012_id,g_gzgk_1_att_m.l_gzgk012,g_gzgk_1_att_m.l_gzgk013_id,
                      g_gzgk_1_att_m.l_gzgk013                                      
                      ATTRIBUTE(WITHOUT DEFAULTS)
                      
            BEFORE INPUT
               DISPLAY g_gzgk_1_att_m.l_gzgk003 TO FORMONLY.l_col_1
               DISPLAY g_gzgk_1_att_m.l_gzgk004 TO FORMONLY.l_row_1                               
            
            ON CHANGE l_gzgk012_id
               CALL azzi330_01_s01_set_color_16(g_gzgk_1_att_m.l_gzgk012_id,"l_gzgk012")
 
            ON CHANGE l_gzgk013_id
               CALL azzi330_01_s01_set_color_16(g_gzgk_1_att_m.l_gzgk013_id,"l_gzgk013") 
   
            AFTER FIELD l_gzgk012_id
   
            AFTER FIELD l_gzgk013_id
   
            AFTER INPUT
               CALL azzi330_01_insert_combox_gzgk(l_field_idx,g_gzgj_m.l_gzgj010)            
      END INPUT
      #150611-00032#5 add(e)
      #end add-point
    
      BEFORE DIALOG 
         #CALL cl_err_collect_init()    
         #add-point:input段before dialog
         
         #end add-point    
         #重新導回資料到正確位置上
         CALL DIALOG.setCurrentRow("s_detail1",g_detail_idx)      
 
         #新增時強制從單頭開始填
         IF p_cmd = 'a' THEN
            #add-point:input段next_field
            
            #end add-point  
            NEXT FIELD gzgj001
         ELSE
            CASE g_aw
               WHEN "s_detail1"
                  NEXT FIELD gzgk003
 
               #add-point:input段modify_detail 
               
               #end add-point  
            END CASE
         END IF
      
      AFTER DIALOG
         #add-point:input段after_dialog
         
         #end add-point    
         
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         IF g_header_hidden THEN
            CALL gfrm_curr.setElementHidden("vb_master",0)
            CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
            LET g_header_hidden = 0     #visible
         ELSE
            CALL gfrm_curr.setElementHidden("vb_master",1)
            CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
            LET g_header_hidden = 1     #hidden     
         END IF
 
      ON ACTION accept
         #add-point:input段accept 
            IF cl_ask_confirm('azz-00711') THEN
               CALL s_azzi330_4rp_progress(g_gzgj_m.gzgj001,g_gzgj_m.gzgj002)
            END IF
         #end add-point    
         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         #add-point:input段cancel
         
         #end add-point  
         LET INT_FLAG = TRUE 
         LET g_detail_idx  = 1
         LET g_detail_idx2 = 1
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         #add-point:input段close
         
         #end add-point  
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         #add-point:input段exit
         
         #end add-point
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
    
   #add-point:input段after input 
   
   #end add-point    
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.show" >}
#+ 單頭資料重新顯示及單身資料重抓
PRIVATE FUNCTION azzi330_01_show()
   DEFINE l_ac_t    LIKE type_t.num10
   #add-point:show段define

   #end add-point  
   #add-point:show段define(客製用)

   #end add-point  
   
   #add-point:show段之前

   #end add-point
   
   
   
   IF g_bfill = "Y" THEN
      CALL azzi330_01_b_fill() #單身填充
      CALL azzi330_01_b_fill2('0') #單身填充
   END IF
     
   #帶出公用欄位reference值
   #應用 a12 樣板自動產生(Version:3)
 
 
   
   #顯示followup圖示
   #應用 a48 樣板自動產生(Version:2)
   CALL azzi330_01_set_pk_array()
   #add-point:ON ACTION agendum

   #END add-point
   CALL cl_user_overview_set_follow_pic()
  
 
 
   
   LET l_ac_t = l_ac
   
   #讀入ref值(單頭)
   #add-point:show段reference

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_gzgj_m.gzgj001
   CALL ap_ref_array2(g_ref_fields," SELECT gzgjl003 FROM gzgjl_t WHERE gzgjl001 = ? AND gzgjl002 = '"||g_dlang||"'","") RETURNING g_rtn_fields 
   LET g_gzgj_m.gzgjl003 = g_rtn_fields[1] 
   DISPLAY g_gzgj_m.gzgjl003 TO gzgjl003
   #end add-point
   
   #遮罩相關處理
   LET g_gzgj_m_mask_o.* =  g_gzgj_m.*
   CALL azzi330_01_gzgj_t_mask()
   LET g_gzgj_m_mask_n.* =  g_gzgj_m.*
   
   #將資料輸出到畫面上
   #150611-00032#5 mark(s)
#   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009, 
#       g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#       g_gzgj_m.l_col,g_gzgj_m.l_row,g_gzgj_m.gzgk009,g_gzgj_m.gzgk007,g_gzgj_m.gzgk008,g_gzgj_m.gzgk012_id, 
#       g_gzgj_m.gzgk012,g_gzgj_m.gzgk013_id,g_gzgj_m.gzgk013,g_gzgj_m.gzgk010,g_gzgj_m.gzgk011,g_gzgj_m.gzgjownid, 
#       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc, 
#       g_gzgj_m.gzgjmoddt
   #150611-00032#5 mark(e)
 
   #150611-00032#5 add(s)
   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,
       g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
       g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt, 
       g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc,g_gzgj_m.gzgjmoddt
       ,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003, 
       g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008
       ,g_gzgj_m.l_gzgj009   #150909-00019#1 add       
       #150508 add(e) #150520      
   #150611-00032#5 add(e)
 
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:2)
	  #根據當下狀態碼顯示圖片
      CASE g_gzgj_m.gzgjstus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/valid.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/void.png")
         
      END CASE
 
 
   
   #讀入ref值(單身)
   FOR l_ac = 1 TO g_gzgk_d.getLength()
      #add-point:show段單身reference

      #end add-point
   END FOR
   
 
   
    
   
   #add-point:show段other

   #end add-point  
   
   LET l_ac = l_ac_t
   
   #移動上下筆可以連動切換資料
   CALL cl_show_fld_cont()     
 
   CALL azzi330_01_detail_show()
 
   #add-point:show段之後
   #150611-00032#5 add(s)
   CALL azzi330_01_set_entry_info()
   DISPLAY BY NAME g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,g_gzgk_att_m.gzgk010,
                   g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012_id,g_gzgk_att_m.gzgk012,g_gzgk_att_m.gzgk013_id,
                   g_gzgk_att_m.gzgk013                   
   DISPLAY g_gzgk_att_m.gzgk003 TO FORMONLY.l_col
   DISPLAY g_gzgk_att_m.gzgk004 TO FORMONLY.l_row                    
   
   DISPLAY BY NAME g_gzgk_1_att_m.l_gzgk007,g_gzgk_1_att_m.l_gzgk008,g_gzgk_1_att_m.l_gzgk009,g_gzgk_1_att_m.l_gzgk010,
                   g_gzgk_1_att_m.l_gzgk011,g_gzgk_1_att_m.l_gzgk012_id,g_gzgk_1_att_m.l_gzgk012,g_gzgk_1_att_m.l_gzgk013_id,
                   g_gzgk_1_att_m.l_gzgk013                   
   DISPLAY g_gzgk_1_att_m.l_gzgk003 TO FORMONLY.l_col_1
   DISPLAY g_gzgk_1_att_m.l_gzgk004 TO FORMONLY.l_row_1     
   #150611-00032#5 add(e)
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.detail_show" >}
#+ 第二階單身reference
PRIVATE FUNCTION azzi330_01_detail_show()
   #add-point:detail_show段define
   
   #end add-point  
   #add-point:detail_show段define(客製用)
   
   #end add-point  
   
   #add-point:detail_show段之前
   
   #end add-point
   
   #add-point:detail_show段之後
   
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.reproduce" >}
#+ 資料複製
PRIVATE FUNCTION azzi330_01_reproduce()
   DEFINE l_newno     LIKE gzgj_t.gzgj001 
   DEFINE l_oldno     LIKE gzgj_t.gzgj001 
   DEFINE l_newno02     LIKE gzgj_t.gzgj002 
   DEFINE l_oldno02     LIKE gzgj_t.gzgj002 
 
   DEFINE l_master    RECORD LIKE gzgj_t.*
   DEFINE l_detail    RECORD LIKE gzgk_t.*
 
 
   DEFINE l_cnt       LIKE type_t.num10
   #add-point:reproduce段define
   
   #end add-point   
   #add-point:reproduce段define(客製用)
   
   #end add-point   
   
   #切換畫面
   
   LET g_master_insert = FALSE
   
   IF g_gzgj_m.gzgj001 IS NULL
   OR g_gzgj_m.gzgj002 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
    
   LET g_gzgj001_t = g_gzgj_m.gzgj001
   LET g_gzgj002_t = g_gzgj_m.gzgj002
 
    
   LET g_gzgj_m.gzgj001 = ""
   LET g_gzgj_m.gzgj002 = ""
 
 
   CALL cl_set_head_visible("","YES")
 
   #公用欄位給予預設值
   #應用 a14 樣板自動產生(Version:4)    
      #公用欄位新增給值  
      LET g_gzgj_m.gzgjownid = g_user
      LET g_gzgj_m.gzgjowndp = g_dept
      LET g_gzgj_m.gzgjcrtid = g_user
      LET g_gzgj_m.gzgjcrtdp = g_dept 
      LET g_gzgj_m.gzgjcrtdt = cl_get_current()
      LET g_gzgj_m.gzgjmodid = g_user
      LET g_gzgj_m.gzgjmoddt = cl_get_current()
      LET g_gzgj_m.gzgjstus = 'N'
 
 
   
   CALL s_transaction_begin()
   
   #add-point:複製輸入前
      LET g_gzgj_m.gzgjstus = "Y"  #141020 add
   #end add-point
   
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:2)
	  #根據當下狀態碼顯示圖片
      CASE g_gzgj_m.gzgjstus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/valid.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/void.png")
         
      END CASE
 
 
   
   #清空key欄位的desc
   
   
   CALL azzi330_01_input("r")
   
   IF INT_FLAG AND NOT g_master_insert THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = '' 
      LET g_errparam.code   = 9001 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      LET INT_FLAG = 0
      DISPLAY g_detail_cnt  TO FORMONLY.h_count    #總筆數
      DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
      LET INT_FLAG = 0
      INITIALIZE g_gzgj_m.* TO NULL
      INITIALIZE g_gzgk_d TO NULL
 
      #add-point:複製取消後
      
      #end add-point
      CALL azzi330_01_show()
      RETURN
   END IF
   
   #根據資料狀態切換action狀態
   CALL cl_set_act_visible("statechange,modify,modify_detail,delete,reproduce", TRUE)
   CALL azzi330_01_set_act_visible()   
   CALL azzi330_01_set_act_no_visible()
   
   #將新增的資料併入搜尋條件中
   LET g_gzgj001_t = g_gzgj_m.gzgj001
   LET g_gzgj002_t = g_gzgj_m.gzgj002
 
   
   #組合新增資料的條件
   LET g_add_browse = " ",
                      " gzgj001 = '", g_gzgj_m.gzgj001, "' "
                      ," AND gzgj002 = '", g_gzgj_m.gzgj002, "' "
 
   #填到最後面
   LET g_current_idx = g_browser.getLength() + 1
   CALL azzi330_01_browser_fill("")
   
   DISPLAY g_browser_cnt TO FORMONLY.h_count    #總筆數
   DISPLAY g_current_idx TO FORMONLY.h_index    #當下筆數
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   
   #add-point:完成複製段落後
   
   #end add-point
   
   CALL azzi330_01_idx_chk()
   
   #功能已完成,通報訊息中心
   CALL azzi330_01_msgcentre_notify('')
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.detail_reproduce" >}
#+ 單身自動複製
PRIVATE FUNCTION azzi330_01_detail_reproduce()
   DEFINE ls_sql      STRING
   DEFINE ld_date     DATETIME YEAR TO SECOND
   DEFINE l_detail    RECORD LIKE gzgk_t.*
 
 
   #add-point:delete段define
   
   #end add-point    
   #add-point:delete段define(客製用)
   
   #end add-point    
   
   CALL s_transaction_begin()
   
   LET ld_date = cl_get_current()
   
   DROP TABLE azzi330_01_detail
   
   #add-point:單身複製前1
   
   #end add-point
   
   #CREATE TEMP TABLE
   LET ls_sql = "CREATE GLOBAL TEMPORARY TABLE azzi330_01_detail AS ",
                "SELECT * FROM gzgk_t "
   PREPARE repro_tbl FROM ls_sql
   EXECUTE repro_tbl
   FREE repro_tbl
                
   #將符合條件的資料丟入TEMP TABLE
   INSERT INTO azzi330_01_detail SELECT * FROM gzgk_t 
                                         WHERE  gzgk001 = g_gzgj001_t
                                         AND gzgk002 = g_gzgj002_t
 
   
   #將key修正為調整後   
   UPDATE azzi330_01_detail 
      #更新key欄位
      SET gzgk001 = g_gzgj_m.gzgj001
          , gzgk002 = g_gzgj_m.gzgj002
 
      #更新共用欄位
      
 
   #add-point:單身修改前
   
   #end add-point                                       
  
   #將資料塞回原table   
   INSERT INTO gzgk_t SELECT * FROM azzi330_01_detail
   
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "reproduce" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #add-point:單身複製中1
   
   #end add-point
   
   #刪除TEMP TABLE
   DROP TABLE azzi330_01_detail
   
   #add-point:單身複製後1
   
   #end add-point
 
 
   
 
   
   #多語言複製段落
   
   
   
   #已新增完, 調整資料內容(修改時使用)
   LET g_gzgj001_t = g_gzgj_m.gzgj001
   LET g_gzgj002_t = g_gzgj_m.gzgj002
 
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.delete" >}
#+ 資料刪除
PRIVATE FUNCTION azzi330_01_delete()
   DEFINE  l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE  l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE  l_vars          DYNAMIC ARRAY OF STRING
   DEFINE  l_fields        DYNAMIC ARRAY OF STRING
   DEFINE  l_var_keys_bak  DYNAMIC ARRAY OF STRING
   #add-point:delete段define

   #end add-point     
   #add-point:delete段define(客製用)

   #end add-point     
   
   LET g_gzgj_m.gzgj010 = "1"   #150611-00032#5 add
   LET g_gzgj_m.l_gzgj010 = "2" #150611-00032#5 add
   
   IF g_gzgj_m.gzgj001 IS NULL
   OR g_gzgj_m.gzgj002 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
   
   LET g_master_multi_table_t.gzgjl001 = g_gzgj_m.gzgj001
LET g_master_multi_table_t.gzgjl003 = g_gzgj_m.gzgjl003
 
   
   CALL s_transaction_begin()
 
   #150611-00032#5 add(s)
   OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN azzi330_01_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE
      CALL cl_err()
      CLOSE azzi330_01_cl
      RETURN
   END IF
 
   #顯示最新的資料
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,
       g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc
   #150611-00032#5 add(e)
 
   OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002
                            ,g_gzgj_m.gzgj010   #150611-00032#5 add
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN azzi330_01_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      CLOSE azzi330_01_cl
      RETURN
   END IF
 
   #顯示最新的資料
   #150611-00032#5 mark(s)   
#   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002 INTO g_gzgj_m.gzgj001, 
#       g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005, 
#       g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt,g_gzgj_m.gzgjownid_desc, 
#       g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjmodid_desc 
   #150611-00032#5 mark(e)
   #150611-00032#5 add(s)   
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,
       g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc
   #150611-00032#5 add(e)      
 
   
   #檢查是否允許此動作
   IF NOT azzi330_01_action_chk() THEN
      RETURN
   END IF
   
   #遮罩相關處理
   LET g_gzgj_m_mask_o.* =  g_gzgj_m.*
   CALL azzi330_01_gzgj_t_mask()
   LET g_gzgj_m_mask_n.* =  g_gzgj_m.*
   
   CALL azzi330_01_show()
   
   #add-point:delete段before ask
    ##判斷若是客戶家無法修改表頭代號是YY，ZZ
    IF FGL_GETENV("DGENV") = "c" THEN
       IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
          INITIALIZE g_errparam TO NULL 
          LET g_errparam.extend = "" 
          LET g_errparam.code   = "azz-00707" 
          LET g_errparam.popup  = FALSE 
          CALL cl_err()  
          LET INT_FLAG = 0
          CALL s_transaction_end('N','0')
          RETURN                    
       END IF
    END IF
    
   #150611-00032#5 add(s) 
   IF NOT azzi330_01_chk_using('d') THEN
      RETURN
   END IF   
   #150611-00032#5 add(e)       
   #end add-point 
 
   IF cl_ask_del_master() THEN              #確認一下
   
      #add-point:單頭刪除前

      #end add-point   
      
      #應用 a47 樣板自動產生(Version:2)
      #刪除相關文件
      CALL azzi330_01_set_pk_array()
      #add-point:相關文件刪除前

      #end add-point   
      CALL cl_doc_remove()  
 
 
  
  
      #資料備份
      LET g_gzgj001_t = g_gzgj_m.gzgj001
      LET g_gzgj002_t = g_gzgj_m.gzgj002
 
 
      DELETE FROM gzgj_t
       WHERE  gzgj001 = g_gzgj_m.gzgj001
         AND gzgj002 = g_gzgj_m.gzgj002
 
       
      #add-point:單頭刪除中

      #end add-point
       
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = g_gzgj_m.gzgj001 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN
      END IF
      
      #add-point:單頭刪除後

      #end add-point
  
      #add-point:單身刪除前

      #end add-point
      
      DELETE FROM gzgk_t
       WHERE  gzgk001 = g_gzgj_m.gzgj001
         AND gzgk002 = g_gzgj_m.gzgj002
 
 
      #add-point:單身刪除中

      #end add-point
         
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "gzgk_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN
      END IF    
 
      #add-point:單身刪除後

      #end add-point
      
            
                                                               
 
 
 
      
      #修改歷程記錄(刪除)
      IF NOT cl_log_modified_record('','') THEN 
         CLOSE azzi330_01_cl
         RETURN
      END IF
             
      CLEAR FORM
      CALL g_gzgk_d.clear() 
 
     
      CALL azzi330_01_ui_browser_refresh()  
      #CALL azzi330_01_ui_headershow()  
      #CALL azzi330_01_ui_detailshow()
      
      IF g_browser_cnt > 0 THEN 
         #CALL azzi330_01_browser_fill("")
         CALL azzi330_01_fetch('P')
         DISPLAY g_browser_cnt TO FORMONLY.h_count   #總筆數的顯示
         DISPLAY g_browser_cnt TO FORMONLY.b_count   #總筆數的顯示
      ELSE
         CLEAR FORM
      END IF
 
      #add-point:多語言刪除

      #end add-point
      
      #單頭多語言刪除
      INITIALIZE l_var_keys_bak TO NULL 
   INITIALIZE l_field_keys   TO NULL 
   LET l_var_keys_bak[01] = g_master_multi_table_t.gzgjl001
   LET l_field_keys[01] = 'gzgjl001'
   CALL cl_multitable_delete(l_field_keys,l_var_keys_bak,'gzgjl_t')
 
      
      #單身多語言刪除
      
 
 
   
      #add-point:多語言刪除

      #end add-point
   
   END IF
 
   CALL s_transaction_end('Y','0')   #150611-00032#5 add
   CLOSE azzi330_01_cl
 
   #功能已完成,通報訊息中心
   CALL azzi330_01_msgcentre_notify('')
    
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.b_fill" >}
#+ 單身陣列填充
PRIVATE FUNCTION azzi330_01_b_fill()
   DEFINE p_wc2      STRING
   DEFINE li_idx     LIKE type_t.num10
   #add-point:b_fill段define
   DEFINE l_gzgk004  LIKE gzgk_t.gzgk004
   DEFINE l_gzgk006  LIKE type_t.chr10
   #150611-00032#5 add(s)
   DEFINE l_gzgk004_1  LIKE gzgk_t.gzgk004
   DEFINE l_gzgk006_1  LIKE type_t.chr10
   #150611-00032#5 add(e)  
   #end add-point     
   #add-point:b_fill段define(客製用)

   #end add-point     
 
   CALL g_gzgk_d.clear()    #g_gzgk_d 單頭及單身 
   CALL g_gzgk_1_d.clear()   #150611-00032#5 add
 
   #add-point:b_fill段sql_before
   CALL azzi330_01_set_gzgk005_combo('gzgk005','1')      #150611-00032#5 add
   CALL azzi330_01_set_gzgk005_combo('l_gzgk005','2')    #150611-00032#5 add      

   ##取得每行的gzgk006
   LET g_sql = " SELECT gzgk004,gzgk006 FROM gzgk_t ",
               " WHERE gzgk001 =? AND gzgk002= ? AND gzgk003 =? ", 
               "  AND gzgk014 = ? ",   #150611-00032#5 add             
               "  ORDER BY gzgk004 "
   PREPARE azzi330_01_get_gzgk006_pre FROM g_sql
   DECLARE azzi330_01_get_gzgk006_curs CURSOR FOR azzi330_01_get_gzgk006_pre   
   #end add-point
   
   #判斷是否填充
   IF azzi330_01_fill_chk(1) THEN
      #切換上下筆時不重組SQL
      IF g_action_choice <> 'fetch' OR cl_null(g_action_choice) THEN
         LET g_sql = "SELECT  UNIQUE gzgk003,gzgk004,gzgk005  FROM gzgk_t",   
                     " INNER JOIN gzgj_t ON gzgj001 = gzgk001 ",
                     " AND gzgj002 = gzgk002 ",
                     " AND gzgj010 = gzgk014 ",   #150611-00032#5 add
                     #"",
                     
                     "",
                     
                     " WHERE"
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         #add-point:b_fill段sql_before
         LET g_sql = g_sql," 1=1 "   #150611-00032#5 add
         #end add-point
         IF NOT cl_null(g_wc2_table1) THEN
            LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
         END IF
         
         #子單身的WC
         
         
         LET g_sql = g_sql, " ORDER BY gzgk_t.gzgk003,gzgk_t.gzgk004"
         
         #add-point:單身填充控制
      #140930 add -(s)
      ##欄數用''取代，讓他一次只撈一行的資料
      LET g_sql = " "
      LET g_sql = "SELECT  UNIQUE gzgk003,'',gzgk005  FROM gzgk_t",   
                  " INNER JOIN gzgj_t ON gzgj001 = gzgk001 ",
                  " AND gzgj002 = gzgk002 ",
                  " AND gzgj010 = gzgk014 ",   #150611-00032#5 add
                  #"",
                  
                  "",
                  
                  " WHERE gzgk001 =? AND gzgk002= ?"
                  , " AND gzgk014 = ?"   #150611-00032#5 add
      LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
      
       IF NOT cl_null(g_wc2_table1) THEN
         LET g_sql = g_sql CLIPPED, " AND ", g_wc2_table1 CLIPPED
      END IF     
      
      LET g_sql = g_sql, " ORDER BY gzgk_t.gzgk003"      
      #140930 add -(e)       
         #end add-point
         
         LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
         PREPARE azzi330_01_pb FROM g_sql
         DECLARE b_fill_cs CURSOR FOR azzi330_01_pb
      END IF
      
      LET g_cnt = l_ac
      LET l_ac = 1
      
      OPEN b_fill_cs USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002
                           ,g_gzgj_m.gzgj010   #150611-00032#5 add
                                               
      FOREACH b_fill_cs INTO g_gzgk_d[l_ac].gzgk003,g_gzgk_d[l_ac].gzgk004,g_gzgk_d[l_ac].gzgk005
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充
         IF g_gzgk_d[l_ac].gzgk005 IS NOT NULL THEN
            SELECT gzgl003 INTO g_gzgk_d[l_ac].gzgk005_desc FROM gzgl_t 
             WHERE gzglstus ='Y' AND gzgl001= g_gzgk_d[l_ac].gzgk005
         END IF         
         
         LET l_gzgk004 = 0
         LET l_gzgk006 = ''
         OPEN azzi330_01_get_gzgk006_curs USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002, g_gzgk_d[l_ac].gzgk003
                                                ,g_gzgj_m.gzgj010   #150611-00032#5 add
         FOREACH azzi330_01_get_gzgk006_curs INTO l_gzgk004,l_gzgk006
             CASE l_gzgk004
               WHEN 1
                  LET g_gzgk_d[l_ac].gzgk00601 = l_gzgk006
               WHEN 2
                  LET g_gzgk_d[l_ac].gzgk00602 = l_gzgk006    
               WHEN 3
                  LET g_gzgk_d[l_ac].gzgk00603 = l_gzgk006
               WHEN 4
                  LET g_gzgk_d[l_ac].gzgk00604 = l_gzgk006                    
             END CASE
         END FOREACH
         #end add-point
      
         IF l_ac > g_max_rec THEN
            IF g_error_show = 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code   = 9035 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
            END IF
            EXIT FOREACH
         END IF
         
         LET l_ac = l_ac + 1
      END FOREACH
      
      #150611-00032#5 add(s)
      LET l_ac = 1
      OPEN b_fill_cs USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010
                                               
      FOREACH b_fill_cs INTO g_gzgk_1_d[l_ac].l_gzgk003,g_gzgk_1_d[l_ac].l_gzgk004,g_gzgk_1_d[l_ac].l_gzgk005
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "FOREACH:" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
            EXIT FOREACH
         END IF
        
         #add-point:b_fill段資料填充
         IF g_gzgk_1_d[l_ac].l_gzgk005 IS NOT NULL THEN
            SELECT gzgl003 INTO g_gzgk_1_d[l_ac].l_gzgk005_desc FROM gzgl_t 
             WHERE gzglstus ='Y' AND gzgl001= g_gzgk_1_d[l_ac].l_gzgk005
         END IF         
         
         LET l_gzgk004_1 = 0
         LET l_gzgk006_1 = ''
         OPEN azzi330_01_get_gzgk006_curs USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002, g_gzgk_1_d[l_ac].l_gzgk003,g_gzgj_m.l_gzgj010
         FOREACH azzi330_01_get_gzgk006_curs INTO l_gzgk004_1,l_gzgk006_1
             CASE l_gzgk004_1
               WHEN 1
                  LET g_gzgk_1_d[l_ac].l_gzgk00601 = l_gzgk006_1
               WHEN 2
                  LET g_gzgk_1_d[l_ac].l_gzgk00602 = l_gzgk006_1    
               WHEN 3
                  LET g_gzgk_1_d[l_ac].l_gzgk00603 = l_gzgk006_1
               WHEN 4
                  LET g_gzgk_1_d[l_ac].l_gzgk00604 = l_gzgk006_1                    
             END CASE
         END FOREACH
         #end add-point
      
         IF l_ac > g_max_rec THEN
            IF g_error_show = 1 THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = l_ac
               LET g_errparam.code   = 9035 
               LET g_errparam.popup  = TRUE 
               CALL cl_err()
            END IF
            EXIT FOREACH
         END IF
         
         LET l_ac = l_ac + 1
      END FOREACH
      #150611-00032#5 add(e)
 
      LET g_error_show = 0
   
   END IF
   
 
   
   #add-point:browser_fill段其他table處理

   #end add-point
   
   CALL g_gzgk_d.deleteElement(g_gzgk_d.getLength())
 
   
 
   LET l_ac = g_cnt
   LET g_cnt = 0  
   
   FREE azzi330_01_pb
 
   
   LET li_idx = l_ac
   
   #遮罩相關處理
   FOR l_ac = 1 TO g_gzgk_d.getLength()
      LET g_gzgk_d_mask_o[l_ac].* =  g_gzgk_d[l_ac].*
      CALL azzi330_01_gzgk_t_mask()
      LET g_gzgk_d_mask_n[l_ac].* =  g_gzgk_d[l_ac].*
   END FOR
   
   #150611-00032#5 add(s)
   FOR l_ac = 1 TO g_gzgk_1_d.getLength()
      LET g_gzgk_1_d_mask_o[l_ac].* =  g_gzgk_1_d[l_ac].*
      CALL azzi330_01_gzgk_t_mask()
      LET g_gzgk_1_d_mask_n[l_ac].* =  g_gzgk_1_d[l_ac].*
   END FOR
   CALL azzi330_01_set_entry_info()
   INITIALIZE g_gzgk_att_m.* TO NULL
   LET g_gzgk_att_m.gzgk010 = 'N' 
   LET g_gzgk_att_m.gzgk011 = 'N' 
   INITIALIZE g_gzgk_1_att_m.* TO NULL
   LET g_gzgk_1_att_m.l_gzgk010 = 'N' 
   LET g_gzgk_1_att_m.l_gzgk011 = 'N' 
   #150611-00032#5 add(e)
   
   LET l_ac = li_idx
   
   CALL cl_ap_performance_next_end()
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.delete_b" >}
#+ 刪除單身後其他table連動
PRIVATE FUNCTION azzi330_01_delete_b(ps_table,ps_keys_bak,ps_page)
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:delete_b段define
   DEFINE l_j         LIKE type_t.num5
   #end add-point     
   #add-point:delete_b段define(客製用)

   #end add-point     
 
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前
   
    ##判斷若是客戶家無法修改表頭代號是YY，ZZ
    IF FGL_GETENV("DGENV") = "c" THEN
       IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
          INITIALIZE g_errparam TO NULL 
          LET g_errparam.extend = "" 
          LET g_errparam.code   = "azz-00707" 
          LET g_errparam.popup  = FALSE 
          CALL cl_err()  
                   
       END IF
    END IF


     FOR l_j = 1 TO g_gzgj_m.gzgj004
         CASE l_j
           WHEN 1              
             LEt ps_keys_bak[4] = 1             
           WHEN 2
             LET ps_keys_bak[4] = 2             
           WHEN 3
             LET ps_keys_bak[4] = 3             
           WHEN 4
             LET ps_keys_bak[4] = 4             
          END CASE
      #end add-point    
      DELETE FROM gzgk_t
       WHERE 
         gzgk001 = ps_keys_bak[1] AND gzgk002 = ps_keys_bak[2] AND gzgk003 = ps_keys_bak[3] AND gzgk004 = ps_keys_bak[4]
         AND gzgk014 = ps_keys_bak[5]   #150611-00032#5 add
      #add-point:delete_b段刪除中
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = FALSE 
            CALL cl_err()
         END IF
      END FOR
      LET SQLCA.sqlcode = 0
      #end add-point    
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_gzgk_d.deleteElement(li_idx) 
      END IF 
 
   END IF
   
 
   
 
   
   #add-point:delete_b段other
   #150611-00032#5 add(s)
   #判斷是否是同一群組的table
   LET ls_group = "'2',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:delete_b段刪除前
   
    ##判斷若是客戶家無法修改表頭代號是YY，ZZ
    IF FGL_GETENV("DGENV") = "c" THEN
       IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
          INITIALIZE g_errparam TO NULL 
          LET g_errparam.extend = "" 
          LET g_errparam.code   = "azz-00707" 
          LET g_errparam.popup  = FALSE 
          CALL cl_err()  
                   
       END IF
    END IF


     FOR l_j = 1 TO g_gzgj_m.l_gzgj004
         CASE l_j
           WHEN 1              
             LEt ps_keys_bak[4] = 1             
           WHEN 2
             LET ps_keys_bak[4] = 2             
           WHEN 3
             LET ps_keys_bak[4] = 3             
           WHEN 4
             LET ps_keys_bak[4] = 4             
          END CASE
      #end add-point    
      DELETE FROM gzgk_t
       WHERE 
         gzgk001 = ps_keys_bak[1] AND gzgk002 = ps_keys_bak[2] AND gzgk003 = ps_keys_bak[3] AND gzgk004 = ps_keys_bak[4] 
         AND gzgk014 = ps_keys_bak[5]
      #add-point:delete_b段刪除中
         IF SQLCA.sqlcode THEN
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = FALSE 
            CALL cl_err()
         END IF
      END FOR
      LET SQLCA.sqlcode = 0
      #end add-point    
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
         RETURN FALSE
      END IF
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_gzgk_d.deleteElement(li_idx) 
      END IF 
 
   END IF
   #150611-00032#5 add(e)
   #end add-point  
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.insert_b" >}
#+ 新增單身後其他table連動
PRIVATE FUNCTION azzi330_01_insert_b(ps_table,ps_keys,ps_page)
   DEFINE ps_table    STRING
   DEFINE ps_page     STRING
   DEFINE ps_keys     DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group    STRING
   DEFINE ls_page     STRING
   DEFINE li_idx      LIKE type_t.num10
   #add-point:insert_b段define
   DEFINE l_gzgk006   LIKE type_t.chr10
   DEFINE l_i         LIKE type_t.num5
   DEFINE l_gzgk007   LIKE gzgk_t.gzgk007
   DEFINE l_gzgk008   LIKE gzgk_t.gzgk008
   DEFINE l_gzgk009   LIKE gzgk_t.gzgk009
   DEFINE l_gzgk010   LIKE gzgk_t.gzgk010
   DEFINE l_gzgk011   LIKE gzgk_t.gzgk011
   DEFINE l_gzgk012   LIKE gzgk_t.gzgk012
   DEFINE l_gzgk013   LIKE gzgk_t.gzgk013  
   DEFINE l_count     LIKE type_t.num5
   #150611-00032#5 add(s)
   DEFINE l_gzgk006_1   LIKE type_t.chr10
   DEFINE l_gzgk007_1   LIKE gzgk_t.gzgk007
   DEFINE l_gzgk008_1   LIKE gzgk_t.gzgk008
   DEFINE l_gzgk009_1   LIKE gzgk_t.gzgk009
   DEFINE l_gzgk010_1   LIKE gzgk_t.gzgk010
   DEFINE l_gzgk011_1   LIKE gzgk_t.gzgk011
   DEFINE l_gzgk012_1   LIKE gzgk_t.gzgk012
   DEFINE l_gzgk013_1   LIKE gzgk_t.gzgk013    
   #150611-00032#5 add(e)
   #end add-point     
   #add-point:insert_b段define(客製用)
   
   #end add-point     
   
   LET g_update = TRUE  
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前

     FOR l_i = 1 TO g_gzgj_m.gzgj004
        LET l_gzgk006 = ''
        CASE l_i
         WHEN 1
            LET ps_keys[4] = 1  #第一欄數
            LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00601
         WHEN 2
            LET ps_keys[4] = 2  #第二欄數
            LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00602
         WHEN 3
            LET ps_keys[4] = 3  #第三欄數
            LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00603
         WHEN 4
            LET ps_keys[4] = 4  #第四欄數
            LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00604
        END CASE
        
         LET l_count = 0  
          SELECT COUNT(*) INTO l_count FROM gzgk_t 
           WHERE gzgk001 = ps_keys[1]
             AND gzgk002 = ps_keys[2]
             AND gzgk003 = ps_keys[3]
             AND gzgk004 = ps_keys[4]
             AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add
          IF SQLCA.SQLcode  THEN
             INITIALIZE g_errparam TO NULL 
             LET g_errparam.extend = "gzgk_t" 
             LET g_errparam.code   = SQLCA.sqlcode 
             LET g_errparam.popup  = TRUE 
             CALL cl_err()       
             
          END IF          
         #141106 add  -(s)

         IF l_count = 0 THEN         
               CASE l_gzgk006
                 WHEN "11"
                    #對內公司抬頭字型16
                    LET l_gzgk008 = "16"
                 WHEN  "12"
                    #對外公司抬頭字型16
                    LET l_gzgk008 = "16"              
                 WHEN "16"
                    #報表抬頭
                    LET l_gzgk008 = "14"
                 OTHERWISE 
                    LET l_gzgk008 = "10"
               END CASE
                     ##語言別對應的字型
               CASE ps_keys[2]
                    WHEN "en_US" 
                       LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)
                    WHEN "zh_TW" 
                       LET l_gzgk007 = cl_getmsg("azz-00700",g_lang)
                    WHEN "zh_CN" 
                       LET l_gzgk007 = cl_getmsg("azz-00701",g_lang)  
                    OTHERWISE 
                       LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)            
               END CASE
               #150611-00032#5 add(s)
               IF l_gzgk006 = '20' OR l_gzgk006 = '21' OR l_gzgk006 = '23' OR l_gzgk006 = '24' THEN
                  LET l_gzgk009 = '1'  #靠左
               ELSE
                  LET l_gzgk009 = '3'  #置中                   
               END IF
               #150611-00032#5 add(e)                
#               LET l_gzgk009 = '3'   #150611-00032#5 mark
               LET l_gzgk010 = 'N'
               LET l_gzgk011 = 'N'
               LET l_gzgk012 = '#000000'
               LET l_gzgk013 = ''
               #141106 add  -(s)
      
              IF l_gzgk006 IS NOT NULL THEN  
               INSERT INTO gzgk_t
                       (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,
                        gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,
                        gzgk013
                        ,gzgk014   #150611-00032#5 add
                       ) 
                 VALUES(
                        ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4]
                        ,g_gzgk_d[g_detail_idx].gzgk005,l_gzgk006,
                        l_gzgk007,l_gzgk008,l_gzgk009,l_gzgk010,l_gzgk011,l_gzgk012,l_gzgk013
                        ,g_gzgj_m.gzgj010)    #150611-00032#5 add
               END IF          
#      #end add-point 
#      INSERT INTO gzgk_t
#                  (
#                   gzgk001,gzgk002,
#                   gzgk003,gzgk004
#                   ,gzgk005) 
#            VALUES(
#                   ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4]
#                   ,g_gzgk_d[g_detail_idx].gzgk005)
#      #add-point:insert_b段資料新增中
       ELSE  #l_count>0 
               CASE l_gzgk006
                 WHEN "11"
                    #對內公司抬頭字型16
                    LET l_gzgk008 = "16"
                 WHEN  "12"
                    #對外公司抬頭字型16
                    LET l_gzgk008 = "16"              
                 WHEN "16"
                    #報表抬頭
                    LET l_gzgk008 = "14"
                 OTHERWISE 
                    LET l_gzgk008 = "10"
               END CASE             
#              UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,gzgk008) = (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4],g_gzgk_d[g_detail_idx].gzgk005,l_gzgk006,l_gzgk008) #150611-00032#5 mark
              UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006) = (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4],g_gzgk_d[g_detail_idx].gzgk005,l_gzgk006)   #150611-00032#5 add
              WHERE  gzgk001 = ps_keys[1]
                AND gzgk002 = ps_keys[2]       
                AND gzgk003 = ps_keys[3] #行   
                AND gzgk004 = ps_keys[4]       #欄
                AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add                
       
       END IF                 
      #end add-point 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "gzgk_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx
      IF ps_page <> "'1'" THEN 
         CALL g_gzgk_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後


    END FOR  
      #end add-point 
   END IF
   
 
   
 
   
   #add-point:insert_b段other
   #150611-00032#5 add(s)
   IF ls_group.getIndexOf(ps_page,1) > 0 THEN
      #add-point:insert_b段資料新增前

     FOR l_i = 1 TO g_gzgj_m.l_gzgj004
        LET l_gzgk006_1 = ''
        CASE l_i
         WHEN 1
            LET ps_keys[4] = 1  #第一欄數
            LET l_gzgk006_1 = g_gzgk_1_d[g_detail_idx2].l_gzgk00601
         WHEN 2
            LET ps_keys[4] = 2  #第二欄數
            LET l_gzgk006_1 = g_gzgk_1_d[g_detail_idx2].l_gzgk00602
         WHEN 3
            LET ps_keys[4] = 3  #第三欄數
            LET l_gzgk006_1 = g_gzgk_1_d[g_detail_idx2].l_gzgk00603
         WHEN 4
            LET ps_keys[4] = 4  #第四欄數
            LET l_gzgk006_1 = g_gzgk_1_d[g_detail_idx2].l_gzgk00604
        END CASE
        
         LET l_count = 0  
          SELECT COUNT(*) INTO l_count FROM gzgk_t 
           WHERE gzgk001 = ps_keys[1]
             AND gzgk002 = ps_keys[2]
             AND gzgk003 = ps_keys[3]
             AND gzgk004 = ps_keys[4]
             AND gzgk014 = g_gzgj_m.l_gzgj010
          IF SQLCA.SQLcode  THEN
             INITIALIZE g_errparam TO NULL 
             LET g_errparam.extend = "gzgk_t" 
             LET g_errparam.code   = SQLCA.sqlcode 
             LET g_errparam.popup  = TRUE 
             CALL cl_err()       
             
          END IF          

         IF l_count = 0 THEN         
               CASE l_gzgk006_1
                 WHEN "11"
                    #對內公司抬頭字型16
                    LET l_gzgk008_1 = "16"
                 WHEN  "12"
                    #對外公司抬頭字型16
                    LET l_gzgk008_1 = "16"              
                 WHEN "16"
                    #報表抬頭
                    LET l_gzgk008_1 = "14"
                 OTHERWISE 
                    LET l_gzgk008_1 = "10"
               END CASE
                     ##語言別對應的字型
               CASE ps_keys[2]
                    WHEN "en_US" 
                       LET l_gzgk007_1 = cl_getmsg("azz-00702",g_lang)
                    WHEN "zh_TW" 
                       LET l_gzgk007_1 = cl_getmsg("azz-00700",g_lang)
                    WHEN "zh_CN" 
                       LET l_gzgk007_1 = cl_getmsg("azz-00701",g_lang)  
                    OTHERWISE 
                       LET l_gzgk007_1 = cl_getmsg("azz-00702",g_lang)            
               END CASE 
               LET l_gzgk009_1 = '3'
               LET l_gzgk010_1 = 'N'
               LET l_gzgk011_1 = 'N'
               LET l_gzgk012_1 = '#000000'
               LET l_gzgk013_1 = ''
      
              IF l_gzgk006_1 IS NOT NULL THEN  
               INSERT INTO gzgk_t
                       (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,
                        gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,
                        gzgk013,gzgk014
                       ) 
                 VALUES(
                        ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4]
                        ,g_gzgk_1_d[g_detail_idx2].l_gzgk005,l_gzgk006_1,
                        l_gzgk007_1,l_gzgk008_1,l_gzgk009_1,l_gzgk010_1,l_gzgk011_1,l_gzgk012_1,l_gzgk013_1,g_gzgj_m.l_gzgj010)
               END IF          
       ELSE  #l_count>0 
               CASE l_gzgk006_1
                 WHEN "11"
                    #對內公司抬頭字型16
                    LET l_gzgk008_1 = "16"
                 WHEN  "12"
                    #對外公司抬頭字型16
                    LET l_gzgk008_1 = "16"              
                 WHEN "16"
                    #報表抬頭
                    LET l_gzgk008_1 = "14"
                 OTHERWISE 
                    LET l_gzgk008_1 = "10"
               END CASE             
              UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006) = (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4],g_gzgk_1_d[g_detail_idx2].l_gzgk005,l_gzgk006_1)
              WHERE  gzgk001 = ps_keys[1]
                AND gzgk002 = ps_keys[2]       
                AND gzgk003 = ps_keys[3] #行   
                AND gzgk004 = ps_keys[4]       #欄
                AND gzgk014 = g_gzgj_m.l_gzgj010                
       
       END IF                 
      #end add-point 
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "gzgk_t" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = FALSE 
         CALL cl_err()
      END IF
      
      LET li_idx = g_detail_idx2
      IF ps_page <> "'1'" THEN 
         CALL g_gzgk_d.insertElement(li_idx) 
      END IF 
 
      #add-point:insert_b段資料新增後


    END FOR  
      #end add-point 
   END IF
   #150611-00032#5 add(e)
   #end add-point     
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.update_b" >}
#+ 修改單身後其他table連動
PRIVATE FUNCTION azzi330_01_update_b(ps_table,ps_keys,ps_keys_bak,ps_page)
   DEFINE ps_table         STRING
   DEFINE ps_page          STRING
   DEFINE ps_keys          DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_keys_bak      DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ls_group         STRING
   DEFINE li_idx           LIKE type_t.num10 
   DEFINE lb_chk           BOOLEAN
   DEFINE l_new_key        DYNAMIC ARRAY OF STRING
   DEFINE l_old_key        DYNAMIC ARRAY OF STRING
   DEFINE l_field_key      DYNAMIC ARRAY OF STRING
   #add-point:update_b段define
 
   #end add-point   
   #add-point:update_b段define(客製用)

   #end add-point   
   
   LET g_update = TRUE   
   
   #判斷key是否有改變
   LET lb_chk = TRUE
   FOR li_idx = 1 TO ps_keys.getLength()
      IF ps_keys[li_idx] <> ps_keys_bak[li_idx] THEN
         LET lb_chk = FALSE
         EXIT FOR
      END IF
   END FOR
   
   #不需要做處理
   IF lb_chk THEN
      RETURN
   END IF
   
   #判斷是否是同一群組的table
   LET ls_group = "'1',"
   IF ls_group.getIndexOf(ps_page,1) > 0 AND ps_table <> "gzgk_t" THEN
      #add-point:update_b段修改前
    ##判斷若是客戶家無法修改表頭代號是YY，ZZ
    IF FGL_GETENV("DGENV") = "c" THEN
       IF g_gzgj_m.gzgj001 ="YY" OR g_gzgj_m.gzgj001 ="ZZ" THEN
          INITIALIZE g_errparam TO NULL 
          LET g_errparam.extend = "" 
          LET g_errparam.code   = "azz-00707" 
          LET g_errparam.popup  = FALSE 
          CALL cl_err()  

          RETURN                    
       END IF
    END IF
      #end add-point 
      
      #將遮罩欄位還原
      CALL azzi330_01_gzgk_t_mask_restore('restore_mask_o')
               
      UPDATE gzgk_t 
         SET (gzgk001,gzgk002,
              gzgk003,gzgk004
              ,gzgk005) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4]
              ,g_gzgk_d[g_detail_idx].gzgk005) 
         WHERE  gzgk001 = ps_keys_bak[1] AND gzgk002 = ps_keys_bak[2] AND gzgk003 = ps_keys_bak[3] AND gzgk004 = ps_keys_bak[4]
                AND gzgk014 = g_gzgj_m.gzgj010   #150611-00032#5 add
      #add-point:update_b段修改中
      #150611-00032#5 add(s)
      UPDATE gzgk_t 
         SET (gzgk001,gzgk002,
              gzgk003,gzgk004
              ,gzgk005) 
              = 
             (ps_keys[1],ps_keys[2],ps_keys[3],ps_keys[4]
              ,g_gzgk_d[g_detail_idx].gzgk005) 
         WHERE  gzgk001 = ps_keys_bak[1] AND gzgk002 = ps_keys_bak[2] AND gzgk003 = ps_keys_bak[3] AND gzgk004 = ps_keys_bak[4]  AND gzgk014 = g_gzgj_m.l_gzgj010
      #150611-00032#5 add(e)
      #end add-point   
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "gzgk_t" 
            LET g_errparam.code   = "std-00009" 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
         WHEN SQLCA.sqlcode #其他錯誤
            INITIALIZE g_errparam TO NULL 
            LET g_errparam.extend = "gzgk_t" 
            LET g_errparam.code   = SQLCA.sqlcode 
            LET g_errparam.popup  = TRUE 
            CALL cl_err()
         OTHERWISE
            
      END CASE
      
      #將遮罩欄位進行遮蔽
      CALL azzi330_01_gzgk_t_mask_restore('restore_mask_n')
               
      #add-point:update_b段修改後

      #end add-point  
   END IF
   
 
   
 
   
   #add-point:update_b段other

   #end add-point  
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.key_update_b" >}
#+ 上層單身key欄位變動後, 連帶修正下層單身key欄位
PRIVATE FUNCTION azzi330_01_key_update_b(ps_keys_bak,ps_table)
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table    STRING
   #add-point:update_b段define
   
   #end add-point
   #add-point:update_b段define(客製用)
   
   #end add-point
   
 
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.key_delete_b" >}
#+ 上層單身刪除後, 連帶刪除下層單身key欄位
PRIVATE FUNCTION azzi330_01_key_delete_b(ps_keys_bak,ps_table)
   DEFINE ps_keys_bak DYNAMIC ARRAY OF VARCHAR(500)
   DEFINE ps_table    STRING
   #add-point:delete_b段define
   
   #end add-point
   #add-point:delete_b段define(客製用)
   
   #end add-point
   
 
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.lock_b" >}
#+ 連動lock其他單身table資料
PRIVATE FUNCTION azzi330_01_lock_b(ps_table,ps_page)
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:lock_b段define

   #end add-point   
   #add-point:lock_b段define(客製用)

   #end add-point   
    
   #先刷新資料
   #CALL azzi330_01_b_fill()
   
   #鎖定整組table
   #LET ls_group = "'1',"
   #僅鎖定自身table
   LET ls_group = "gzgk_t"
   
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN azzi330_01_bcl USING 
#                                       g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgk_d[g_detail_idx].gzgk003,   #150611-00032#5 mark
                                       g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgk_d[g_detail_idx].gzgk003,   #150611-00032#5 add
                                           g_gzgk_d[g_detail_idx].gzgk004     
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "azzi330_01_bcl" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
                                    
 
   
 
   
   #add-point:lock_b段other
   #150611-00032#5 add(s)
   LET ls_group = "gzgk_1_t"
   IF ls_group.getIndexOf(ps_table,1) THEN
      OPEN azzi330_01_bcl2 USING
                                       g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgk_1_d[g_detail_idx2].l_gzgk003,
                                           g_gzgk_1_d[g_detail_idx2].l_gzgk004
                                               
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "azzi330_01_bcl" 
         LET g_errparam.code   = SQLCA.sqlcode 
         LET g_errparam.popup  = TRUE 
         CALL cl_err()
         RETURN FALSE
      END IF
   END IF
   #150611-00032#5 add(e)
   #end add-point  
   
   RETURN TRUE
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.unlock_b" >}
#+ 連動unlock其他單身table資料
PRIVATE FUNCTION azzi330_01_unlock_b(ps_table,ps_page)
   DEFINE ps_page     STRING
   DEFINE ps_table    STRING
   DEFINE ls_group    STRING
   #add-point:unlock_b段define
   
   #end add-point  
   #add-point:unlock_b段define(客製用)
   
   #end add-point  
    
   LET ls_group = "'1',"
   
   IF ls_group.getIndexOf(ps_page,1) THEN
      CLOSE azzi330_01_bcl
   END IF
   
 
   
 
 
   #add-point:unlock_b段other
   
   #end add-point  
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_entry" >}
#+ 單頭欄位開啟設定
PRIVATE FUNCTION azzi330_01_set_entry(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1  
   #add-point:set_entry段define

   #end add-point       
   #add-point:set_entry段define(客製用)

   #end add-point       
   
   CALL cl_set_comp_entry("",TRUE)
   
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("gzgj001,gzgj002",TRUE)
      #add-point:set_entry段欄位控制

      #end add-point  
   END IF
   
   #add-point:set_entry段欄位控制後

   #end add-point 
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_no_entry" >}
#+ 單頭欄位關閉設定
PRIVATE FUNCTION azzi330_01_set_no_entry(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry段define
   
   #end add-point     
   #add-point:set_no_entry段define(客製用)
   
   #end add-point     
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("gzgj001,gzgj002",FALSE)
      #add-point:set_no_entry段欄位控制
      
      #end add-point 
   END IF 
   
   IF p_cmd = 'u' THEN
      CALL cl_set_comp_entry("",FALSE)
   END IF 
   
   #add-point:set_no_entry段欄位控制後
   
   #end add-point 
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_entry_b" >}
#+ 單身欄位開啟設定
PRIVATE FUNCTION azzi330_01_set_entry_b(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_entry_b段define
   
   #end add-point     
   #add-point:set_entry_b段define(客製用)
   
   #end add-point     
    
   IF p_cmd = 'a' THEN
      CALL cl_set_comp_entry("",TRUE)
      #add-point:set_entry段欄位控制
      
      #end add-point  
   END IF
   
   #add-point:set_entry_b段
   
   #end add-point  
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_no_entry_b" >}
#+ 單身欄位關閉設定
PRIVATE FUNCTION azzi330_01_set_no_entry_b(p_cmd)
   DEFINE p_cmd   LIKE type_t.chr1   
   #add-point:set_no_entry_b段define
   
   #end add-point    
   #add-point:set_no_entry_b段define(客製用)
   
   #end add-point    
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("",FALSE)
      #add-point:set_no_entry_b段欄位控制
      
      #end add-point 
   END IF 
   
   #add-point:set_no_entry_b段
   
   #end add-point     
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_act_visible" >}
#+ 單頭權限開啟
PRIVATE FUNCTION azzi330_01_set_act_visible()
   #add-point:set_act_visible段define
   
   #end add-point   
   #add-point:set_act_visible段define(客製用)
   
   #end add-point   
   #add-point:set_act_visible段
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_act_no_visible" >}
#+ 單頭權限關閉
PRIVATE FUNCTION azzi330_01_set_act_no_visible()
   #add-point:set_act_no_visible段define
   
   #end add-point   
   #add-point:set_act_no_visible段define(客製用)
   
   #end add-point   
   #add-point:set_act_no_visible段
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_act_visible_b" >}
#+ 單身權限開啟
PRIVATE FUNCTION azzi330_01_set_act_visible_b()
   #add-point:set_act_visible_b段define
   
   #end add-point   
   #add-point:set_act_visible_b段define(客製用)
   
   #end add-point   
   #add-point:set_act_visible_b段
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.set_act_no_visible_b" >}
#+ 單身權限關閉
PRIVATE FUNCTION azzi330_01_set_act_no_visible_b()
   #add-point:set_act_no_visible_b段define
   
   #end add-point   
   #add-point:set_act_no_visible_b段define(客製用)
   
   #end add-point   
   #add-point:set_act_no_visible_b段
   
   #end add-point   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.default_search" >}
#+ 外部參數搜尋
PRIVATE FUNCTION azzi330_01_default_search()
   DEFINE li_idx     LIKE type_t.num10
   DEFINE li_cnt     LIKE type_t.num10
   DEFINE ls_wc      STRING
   DEFINE la_wc      DYNAMIC ARRAY OF RECORD
          tableid    STRING,
          wc         STRING
          END RECORD
   DEFINE ls_where   STRING
   #add-point:default_search段define
   
   #end add-point  
   #add-point:default_search段define(客製用)
   
   #end add-point  
   
   #add-point:default_search段開始前
   
   #end add-point  
   
   LET g_pagestart = 1
   
   IF cl_null(g_order) THEN
      LET g_order = "ASC"
   END IF
   
   IF NOT cl_null(g_argv[01]) THEN
      LET ls_wc = ls_wc, " gzgj001 = '", g_argv[01], "' AND "
   END IF
   
   IF NOT cl_null(g_argv[02]) THEN
      LET ls_wc = ls_wc, " gzgj002 = '", g_argv[02], "' AND "
   END IF
 
   
   #add-point:default_search段after sql
   
   #end add-point  
   
   IF NOT cl_null(ls_wc) THEN
      LET g_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_default = TRUE
   ELSE
      #若無外部參數則預設為1=2
      LET g_default = FALSE
      
      #預設查詢條件
      CALL cl_qbe_get_default_qryplan() RETURNING ls_where
      IF NOT cl_null(ls_where) THEN
         CALL util.JSON.parse(ls_where, la_wc)
         INITIALIZE g_wc, g_wc2,g_wc2_table1,g_wc2_extend TO NULL
 
         FOR li_idx = 1 TO la_wc.getLength()
            CASE
               WHEN la_wc[li_idx].tableid = "gzgj_t" 
                  LET g_wc = la_wc[li_idx].wc
               WHEN la_wc[li_idx].tableid = "gzgk_t" 
                  LET g_wc2_table1 = la_wc[li_idx].wc
 
               WHEN la_wc[li_idx].tableid = "EXTENDWC"
                  LET g_wc2_extend = la_wc[li_idx].wc
            END CASE
         END FOR
         IF NOT cl_null(g_wc) OR NOT cl_null(g_wc2_table1) 
 
            OR NOT cl_null(g_wc2_extend)
            THEN
            #組合g_wc2
            IF g_wc2_table1 <> " 1=1" AND NOT cl_null(g_wc2_table1) THEN
               LET g_wc2 = g_wc2_table1
            END IF
 
            IF g_wc2_extend <> " 1=1" AND NOT cl_null(g_wc2_extend) THEN
               LET g_wc2 = g_wc2 ," AND ", g_wc2_extend
            END IF
         
            IF g_wc2.subString(1,5) = " AND " THEN
               LET g_wc2 = g_wc2.subString(6,g_wc2.getLength())
            END IF
         END IF
      END IF
    
      IF cl_null(g_wc) AND cl_null(g_wc2) THEN
         LET g_wc = " 1=2"
      END IF
   END IF
   
   #add-point:default_search段結束前
   
   #end add-point  
 
   IF g_wc.getIndexOf(" 1=2", 1) THEN
      LET g_default = TRUE
   END IF
 
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.state_change" >}
   #應用 a09 樣板自動產生(Version:11)
#+ 確認碼變更 
PRIVATE FUNCTION azzi330_01_statechange()
   DEFINE lc_state LIKE type_t.chr5
   #add-point:statechange段define

   #end add-point  
   #add-point:statechange段define(客製用)

   #end add-point  
   
   #add-point:statechange段開始前
   LET g_gzgj_m.gzgj010 = "1"    #150611-00032#5 add
   LET g_gzgj_m.l_gzgj010 = "2"  #150611-00032#5 add
   #end add-point  
   
   ERROR ""     #清空畫面右下側ERROR區塊
 
   IF g_gzgj_m.gzgj001 IS NULL
      OR g_gzgj_m.gzgj002 IS NULL
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   CALL s_transaction_begin()
 
   #150611-00032#5 add(s)
   OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN azzi330_01_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      CLOSE azzi330_01_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #顯示最新的資料
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006, 
       g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc
   #150611-00032#5 add(e)
 
   OPEN azzi330_01_cl USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002
                            ,g_gzgj_m.gzgj010   #150611-00032#5 add
   IF STATUS THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN azzi330_01_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      CLOSE azzi330_01_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #顯示最新的資料
   #150611-00032#5 mark(s)
#   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002 INTO g_gzgj_m.gzgj001, 
#       g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005, 
#       g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt,g_gzgj_m.gzgjownid_desc, 
#       g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjmodid_desc 
   #150611-00032#5 mark(e)
   #150611-00032#5 add(s)
   EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010 INTO g_gzgj_m.gzgj001,
       g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,
       g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
       g_gzgj_m.gzgjmodid_desc 
   #150611-00032#5 add(e)
 
 
   #檢查是否允許此動作
   IF NOT azzi330_01_action_chk() THEN
      CLOSE azzi330_01_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #將資料顯示到畫面上
   #150611-00032#5 mark(s)
#   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009, 
#       g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#       g_gzgj_m.l_col,g_gzgj_m.l_row,g_gzgj_m.gzgk009,g_gzgj_m.gzgk007,g_gzgj_m.gzgk008,g_gzgj_m.gzgk012_id, 
#       g_gzgj_m.gzgk012,g_gzgj_m.gzgk013_id,g_gzgj_m.gzgk013,g_gzgj_m.gzgk010,g_gzgj_m.gzgk011,g_gzgj_m.gzgjownid, 
#       g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc, 
#       g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc, 
#       g_gzgj_m.gzgjmoddt
   #150611-00032#5 mark(e)
   #150611-00032#5 add(s)
   DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,
       g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
       g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc, 
       g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt, 
       g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc,g_gzgj_m.gzgjmoddt
       ,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003, 
       g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008
       ,g_gzgj_m.l_gzgj009   #150909-00019#1 add       
   #150611-00032#5 add(e)
 
   CASE g_gzgj_m.gzgjstus
      WHEN "N"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")
      WHEN "Y"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/valid.png")
      WHEN "X"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/void.png")
      
   END CASE
 
   #add-point:資料刷新後

   #end add-point
 
   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_gzgj_m.gzgjstus
            
            WHEN "N"
               HIDE OPTION "open"
            WHEN "Y"
               HIDE OPTION "valid"
            WHEN "X"
               HIDE OPTION "void"
         END CASE
     
      #add-point:menu前

      #end add-point
      
      
	  
      ON ACTION open
         IF cl_auth_chk_act("open") THEN
            LET lc_state = "N"
            #add-point:action控制

            #end add-point
         END IF
         EXIT MENU
      ON ACTION valid
         IF cl_auth_chk_act("valid") THEN
            LET lc_state = "Y"
            #add-point:action控制

            #end add-point
         END IF
         EXIT MENU
      ON ACTION void
         IF cl_auth_chk_act("void") THEN
            LET lc_state = "X"
            #add-point:action控制

            #end add-point
         END IF
         EXIT MENU
 
      #add-point:stus控制

      #end add-point
      
   END MENU
   
   #確認被選取的狀態碼在清單中
   IF (lc_state <> "N" 
      AND lc_state <> "Y"
      AND lc_state <> "X"
      ) OR 
      g_gzgj_m.gzgjstus = lc_state OR cl_null(lc_state) THEN
      CLOSE azzi330_01_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #add-point:stus修改前

   #end add-point
   
   LET g_gzgj_m.gzgjmodid = g_user
   LET g_gzgj_m.gzgjmoddt = cl_get_current()
   LET g_gzgj_m.gzgjstus = lc_state
   
   #異動狀態碼欄位/修改人/修改日期
   UPDATE gzgj_t 
      SET (gzgjstus,gzgjmodid,gzgjmoddt) 
        = (g_gzgj_m.gzgjstus,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt)     
    WHERE  gzgj001 = g_gzgj_m.gzgj001
      AND gzgj002 = g_gzgj_m.gzgj002
    
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
   ELSE
      CASE lc_state
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/open.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/valid.png")
         WHEN "X"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/void.png")
         
      END CASE
 
      #150611-00032#5 mark(s)
#      #撈取異動後的資料
#      EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002 INTO g_gzgj_m.gzgj001, 
#          g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005, 
#          g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjcrtid, 
#          g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt,g_gzgj_m.gzgjownid_desc, 
#          g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjmodid_desc 
#
#      
#      #將資料顯示到畫面上
#      DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgjstus,g_gzgj_m.gzgj009, 
#          g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008, 
#          g_gzgj_m.l_col,g_gzgj_m.l_row,g_gzgj_m.gzgk009,g_gzgj_m.gzgk007,g_gzgj_m.gzgk008,g_gzgj_m.gzgk012_id, 
#          g_gzgj_m.gzgk012,g_gzgj_m.gzgk013_id,g_gzgj_m.gzgk013,g_gzgj_m.gzgk010,g_gzgj_m.gzgk011,g_gzgj_m.gzgjownid, 
#          g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc, 
#          g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc, 
#          g_gzgj_m.gzgjmoddt
      #150611-00032#5 mark(e)
      
      #150611-00032#5 add(s)
      #撈取異動後的資料
      EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010 INTO g_gzgj_m.gzgj001,
          g_gzgj_m.gzgj002,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003,g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,
          g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008,g_gzgj_m.l_gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
          g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
          g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
          g_gzgj_m.gzgjmodid_desc
 
      EXECUTE azzi330_01_master_referesh USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010 INTO g_gzgj_m.gzgj001,
          g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,
          g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009,g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjowndp, 
          g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdt,g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmoddt, 
          g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp_desc,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp_desc, 
          g_gzgj_m.gzgjmodid_desc
      
      #將資料顯示到畫面上
      DISPLAY BY NAME g_gzgj_m.gzgj001,g_gzgj_m.gzgjl003,g_gzgj_m.gzgj002,g_gzgj_m.gzgj010,g_gzgj_m.gzgj003,
          g_gzgj_m.gzgj004,g_gzgj_m.gzgj005,g_gzgj_m.gzgj006,g_gzgj_m.gzgj007,g_gzgj_m.gzgj008,g_gzgj_m.gzgj009, 
          g_gzgj_m.gzgjstus,g_gzgj_m.gzgjownid,g_gzgj_m.gzgjownid_desc,g_gzgj_m.gzgjowndp,g_gzgj_m.gzgjowndp_desc, 
          g_gzgj_m.gzgjcrtid,g_gzgj_m.gzgjcrtid_desc,g_gzgj_m.gzgjcrtdp,g_gzgj_m.gzgjcrtdp_desc,g_gzgj_m.gzgjcrtdt, 
          g_gzgj_m.gzgjmodid,g_gzgj_m.gzgjmodid_desc,g_gzgj_m.gzgjmoddt
          ,g_gzgj_m.l_gzgj010,g_gzgj_m.l_gzgj003, 
          g_gzgj_m.l_gzgj004,g_gzgj_m.l_gzgj005,g_gzgj_m.l_gzgj006,g_gzgj_m.l_gzgj007,g_gzgj_m.l_gzgj008
          ,g_gzgj_m.l_gzgj009   #150909-00019#1 add       
      #150611-00032#5 add(e)
   END IF
 
   #add-point:stus修改後

   #end add-point
 
   #add-point:statechange段結束前

   #end add-point  
 
   CLOSE azzi330_01_cl
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL azzi330_01_msgcentre_notify(lc_state)
   
END FUNCTION
 
 
 
{</section>}
 
{<section id="azzi330_01.idx_chk" >}
#+ 顯示正確的單身資料筆數
PRIVATE FUNCTION azzi330_01_idx_chk()
   #add-point:idx_chk段define
   
   #end add-point  
   #add-point:idx_chk段define(客製用)
   
   #end add-point  
   
   IF g_current_page = 1 THEN
      LET g_detail_idx = g_curr_diag.getCurrentRow("s_detail1")
      IF g_detail_idx > g_gzgk_d.getLength() THEN
         LET g_detail_idx = g_gzgk_d.getLength()
      END IF
      IF g_detail_idx = 0 AND g_gzgk_d.getLength() <> 0 THEN
         LET g_detail_idx = 1
      END IF
      DISPLAY g_detail_idx TO FORMONLY.idx
      DISPLAY g_gzgk_d.getLength() TO FORMONLY.cnt
   END IF
   
 
   
   #add-point:idx_chk段other
   
   #end add-point  
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.b_fill2" >}
#+ 單身陣列填充2
PRIVATE FUNCTION azzi330_01_b_fill2(pi_idx)
   DEFINE pi_idx          LIKE type_t.num10
   DEFINE li_ac           LIKE type_t.num10
   DEFINE ls_chk          LIKE type_t.chr1
   #add-point:b_fill2段define
   
   #end add-point
   #add-point:b_fill2段define(客製用)
   
   #end add-point
   
   LET li_ac = l_ac 
   
   IF g_detail_idx <= 0 THEN
      RETURN
   END IF
   
 
      
 
      
   #add-point:單身填充後
   
   #end add-point
    
   LET l_ac = li_ac
   
   CALL azzi330_01_detail_show()
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.fill_chk" >}
#+ 單身填充確認
PRIVATE FUNCTION azzi330_01_fill_chk(ps_idx)
   DEFINE ps_idx        LIKE type_t.chr10
   #add-point:fill_chk段define
   
   #end add-point
   #add-point:fill_chk段define(客製用)
   
   #end add-point
   
   #add-point:fill_chk段before_chk
   
   #end add-point
   
   #此funtion功能暫時停用(2015/1/12)
   #無論傳入值為何皆回傳true(代表要填充該單身)
 
   #全部為1=1 or null時回傳true
   IF (cl_null(g_wc2_table1) OR g_wc2_table1.trim() = '1=1') THEN
      #add-point:fill_chk段other_chk
      
      #end add-point
      RETURN TRUE
   END IF
   
   #add-point:fill_chk段after_chk
   
   #end add-point
   
   RETURN TRUE
 
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.status_show" >}
PRIVATE FUNCTION azzi330_01_status_show()
   #add-point:status_show段define
   
   #end add-point
   #add-point:status_show段define(客製用)
   
   #end add-point
   
   #add-point:status_show段status_show
   
   #end add-point
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.mask_functions" >}
&include "erp/azz/azzi330_01_mask.4gl"
 
{</section>}
 
{<section id="azzi330_01.signature" >}
   
 
{</section>}
 
{<section id="azzi330_01.set_pk_array" >}
   #應用 a51 樣板自動產生(Version:5)
#+ 給予pk_array內容
PRIVATE FUNCTION azzi330_01_set_pk_array()
   #add-point:set_pk_array段define
   
   #end add-point
   #add-point:set_pk_array段define
   
   #end add-point
   
   #add-point:set_pk_array段之前
   
   #end add-point  
   
   #若l_ac<=0代表沒有資料
   IF l_ac <= 0 THEN
      RETURN
   END IF
   
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_gzgj_m.gzgj001
   LET g_pk_array[1].column = 'gzgj001'
   LET g_pk_array[2].values = g_gzgj_m.gzgj002
   LET g_pk_array[2].column = 'gzgj002'
   
   #add-point:set_pk_array段之後
   
   #end add-point  
   
END FUNCTION
 
 
 
{</section>}
 
{<section id="azzi330_01.other_dialog" readonly="Y" >}
   
 
{</section>}
 
{<section id="azzi330_01.msgcentre_notify" >}
#應用 a66 樣板自動產生(Version:2)
PRIVATE FUNCTION azzi330_01_msgcentre_notify(lc_state)
   DEFINE lc_state LIKE type_t.chr5
   #add-point:msgcentre_notify段define
   
   #end add-point
   #add-point:msgcentre_notify段define
   
   #end add-point   
   
   INITIALIZE g_msgparam TO NULL
 
   #action-id與狀態填寫
   IF g_action_choice = "statechange" THEN
      LET g_msgparam.state = g_action_choice,":",lc_state
   ELSE
      LET g_msgparam.state = g_action_choice
   END IF
 
   #PK資料填寫
   CALL azzi330_01_set_pk_array()
   #單頭資料填寫
   LET g_msgparam.data[1] = util.JSON.stringify(g_gzgj_m)
 
   #add-point:msgcentre其他通知
   
   #end add-point
 
   #呼叫訊息中心傳遞本關完成訊息
   CALL cl_msgcentre_notify()
 
END FUNCTION
 
 
 
{</section>}
 
{<section id="azzi330_01.action_chk" >}
PRIVATE FUNCTION azzi330_01_action_chk()
   #add-point:action_chk段define
   
   #end add-point
   #add-point:action_chk段define(客製用)
   
   #end add-point
   
   #add-point:action_chk段action_chk
   
   #end add-point
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="azzi330_01.other_function" readonly="Y" >}

################################################################################
# Descriptions...: 自組combox，參考scc
# Memo...........:
# Usage..........: CALL azzi330_01_set_combobox (传入参数)
#                  RETURNING 回传参数
# Input parameter: ps_field   欄位
#                : ps_code    SCC代碼
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 140926 By janet
# Modify.........:
################################################################################
PUBLIC FUNCTION azzi330_01_set_combobox(ps_field,ps_code,ps_type)
   DEFINE ps_field   STRING
   DEFINE ps_code    STRING
   DEFINE ps_type    LIKE type_t.chr1
   DEFINE ls_values  STRING
   DEFINE ls_items   STRING
   DEFINE lc_gzcb002 LIKE gzcb_t.gzcb002
   DEFINE lc_gzcbl004 LIKE gzcbl_t.gzcbl004
   DEFINE ls_gzcb002 STRING
   DEFINE li         LIKE type_t.num5
   DEFINE l_code    LIKE gzca_t.gzca001
   
   LET l_code = ps_code
   LET g_sql = " SELECT gzcb002,gzcbl004 FROM gzcb_t ",
               "   LEFT JOIN gzcbl_t ON gzcb002 = gzcbl002 AND gzcb001 = gzcbl001 AND gzcbl003 ='", g_dlang ,"'",
               "  WHERE gzcb001 IN (SELECT gzca001 FROM gzca_t WHERE gzca001 =? ",
               "    AND gzcastus ='Y') ORDER BY gzcb012 "
   PREPARE azzi330_01_set_combo_scc_dt_pre FROM g_sql
   DECLARE azzi330_01_set_combo_scc_dt_cs CURSOR FOR azzi330_01_set_combo_scc_dt_pre
      IF SQLCA.SQLCODE THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code =  "lib-045"
         LET g_errparam.extend = "gzcb_t"
         LET g_errparam.popup = TRUE
         CALL cl_err()

         RETURN
      END IF
   LET ls_values = ""
   LET ls_items = ""
   LET li = 1
   FOREACH azzi330_01_set_combo_scc_dt_cs USING l_code INTO lc_gzcb002,lc_gzcbl004
      LET ls_values = ls_values, lc_gzcb002 , ',' #值
      IF ps_type ="" THEN
         LET ls_items = ls_items, lc_gzcb002 CLIPPED, ',' #items
      ELSE
         LET ls_items = ls_items, lc_gzcbl004 CLIPPED, ',' #items
      END IF
   END FOREACH
   LET ls_values = ls_values.subString(1, ls_values.getLength() - 1)
   LET ls_items = ls_items.subString(1, ls_items.getLength() - 1)

   CALL cl_set_combo_items(ps_field, ls_values, ls_items)      
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL azzi330_01_s01 (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 140929 By janet
# Modify.........: 150615 By cynthia add p_gzgj010
################################################################################
PRIVATE FUNCTION azzi330_01_s01(ps_idx,p_gzgj010)
   DEFINE ps_idx            LIKE type_t.num5
   DEFINE p_gzgj010         LIKE gzgj_t.gzgj010   #150611-00032#5 add
   DEFINE l_sql             STRING
   DEFINE lwin_curr         ui.Window
   DEFINE lfrm_curr         ui.Form
   DEFINE ls_path           STRING   
   
    IF cl_null(ps_idx) THEN RETURN END IF


    OPEN WINDOW w_azzi330_01_s01 WITH FORM cl_ap_formpath("azz","azzi330_01_s01")
    
   LET lwin_curr = ui.Window.getCurrent()
   LET lfrm_curr = lwin_curr.getForm()
   LET ls_path = os.Path.join(os.Path.join(FGL_GETENV("ERP"),"cfg"),"4tb")
   LET ls_path = os.Path.join(ls_path,"toolbar_i.4tb")
   CALL lfrm_curr.loadToolBar(ls_path)
    
    
    
  #瀏覽頁簽資料初始化
   CALL cl_ui_init()
    
   LET g_forupd_sql = "SELECT gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,gzgk013 ",
                     "  FROM gzgk_t ", 
                     " WHERE gzgk001=? AND gzgk002 =? AND gzgk003=? AND gzgk004 =? AND gzgk014 =? FOR UPDATE"   #150611-00032#5 add
#                     " WHERE gzgk001=? AND gzgk002 =? AND gzgk003=? AND gzgk004 =? FOR UPDATE"    #150611-00032#5 mark   

   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
#   DECLARE azzi300_sub_bcl CURSOR FROM g_forupd_sql     #150611-00032#5 mark
   DECLARE azzi300_sub_bcl_1 CURSOR FROM g_forupd_sql   #150611-00032#5 add
   
#    CALL azzi330_01_s01_init(ps_idx)             #150611-00032#5 mark
    CALL azzi330_01_s01_init(ps_idx,p_gzgj010)   #150611-00032#5 add

    CALL azzi330_01_s01_ui_dialog()
    
    CLOSE WINDOW w_azzi330_01_s01   
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL azzi330_01_s01_init(傳入參數)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 140929 By janet
# Modify.........: 150615 By Cynthia add p_gzgj010
################################################################################
PRIVATE FUNCTION azzi330_01_s01_init(ps_idx,p_gzgj010)
   DEFINE    ps_idx        LIKE type_t.num5
   DEFINE p_gzgj010     LIKE gzgj_t.gzgj010   #150611-00032#5 add
   DEFINE l_gzgk003     LIKE gzgk_t.gzgk003   #150611-00032#5 add 
   DEFINE l_gzgk006     LIKE gzgk_t.gzgk006   #150611-00032#5 add   

   CASE p_gzgj010   #150611-00032#5  add
      WHEN "1"   #150611-00032#5 add 
         ##表頭代號
         LET g_gzgk_att_m.gzgk001 = g_gzgj_m.gzgj001
         ##語言別
         LET g_gzgk_att_m.gzgk002 = g_gzgj_m.gzgj002
         ##行數
         LET g_gzgk_att_m.gzgk003 = g_gzgk_d[l_ac].gzgk003
         LET l_gzgk003 = g_gzgk_d[l_ac].gzgk003   #150611-00032#5  add
         ##欄數
         LET g_gzgk_att_m.gzgk004 = ps_idx    
         ##報表區塊 #150611-00032#5   add
         LET g_gzgk_att_m.gzgk014 = p_gzgj010 
       
         #字型大小
         CALL azzi330_01_set_combobox('gzgk008','165','') 
         #位置
         CALL cl_set_combo_scc('gzgk009','149')        
         #字型顏色
         CALL azzi330_01_set_combobox('gzgk012_id','166','1')
         #背景顏色 
         CALL azzi330_01_set_combobox('gzgk013_id','166','1')
         
      #150611-00032#5 add(s)
      WHEN "2"
       ##表頭代號
       LET g_gzgk_1_att_m.l_gzgk001 = g_gzgj_m.gzgj001
       ##語言別
       LET g_gzgk_1_att_m.l_gzgk002 = g_gzgj_m.gzgj002
       ##行數
       LET g_gzgk_1_att_m.l_gzgk003 = g_gzgk_1_d[l_ac].l_gzgk003
       LET l_gzgk003 = g_gzgk_1_d[l_ac].l_gzgk003
       ##欄數
       LET g_gzgk_1_att_m.l_gzgk004 = ps_idx
       ##報表區塊
       LET g_gzgk_1_att_m.l_gzgk014 = p_gzgj010
       
        #字型大小
       CALL azzi330_01_set_combobox('l_gzgk008','165','') 
        #位置
       CALL cl_set_combo_scc('l_gzgk009','149')        
        #字型顏色
       CALL azzi330_01_set_combobox('l_gzgk012_id','166','1')
        #背景顏色 
       CALL azzi330_01_set_combobox('l_gzgk013_id','166','1')      
   END CASE   
      #150611-00032#5 add(e)
      
   ##若有資料抓出
   LET g_sql = " SELECT gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,'',gzgk012,'',gzgk013 ",
               "   FROM gzgk_t ",
               "  WHERE gzgk001 =? AND gzgk002 =? AND gzgk003 =? AND gzgk004 =? AND gzgk014 =? "   #150611-00032#5  add
#               "  WHERE gzgk001 =? AND gzgk002 =? AND gzgk003 =? AND gzgk004 =? "   #150611-00032#5 mark
               
   PREPARE azzi330_01_s01_init_pre FROM g_sql
   DECLARE azzi330_01_s01_init_curs CURSOR FOR azzi330_01_s01_init_pre   
   OPEN azzi330_01_s01_init_curs USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002, g_gzgk_d[l_ac].gzgk003,ps_idx
                                       ,g_gzgj_m.gzgj010   #150611-00032#5 add
   FOREACH azzi330_01_s01_init_curs INTO g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,
                                         g_gzgk_att_m.gzgk010,g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012_id,
                                         g_gzgk_att_m.gzgk012,g_gzgk_att_m.gzgk013_id,g_gzgk_att_m.gzgk013
       CALL azzi330_01_s01_set_color("gzgk012",g_gzgk_att_m.gzgk012)   
       CALL azzi330_01_s01_set_color("gzgk013",g_gzgk_att_m.gzgk013)     
   END FOREACH 
   #150611-00032#5 add(s)
    OPEN azzi330_01_s01_init_curs USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002, g_gzgk_1_att_m.l_gzgk003,ps_idx,g_gzgj_m.l_gzgj010
    FOREACH azzi330_01_s01_init_curs INTO g_gzgk_1_att_m.l_gzgk007,g_gzgk_1_att_m.l_gzgk008,g_gzgk_1_att_m.l_gzgk009,
                                          g_gzgk_1_att_m.l_gzgk010,g_gzgk_1_att_m.l_gzgk011,g_gzgk_1_att_m.l_gzgk012_id,
                                          g_gzgk_1_att_m.l_gzgk012,g_gzgk_1_att_m.l_gzgk013_id,g_gzgk_1_att_m.l_gzgk013
        CALL azzi330_01_s01_set_color("l_gzgk012",g_gzgk_1_att_m.l_gzgk012)   
        CALL azzi330_01_s01_set_color("l_gzgk013",g_gzgk_1_att_m.l_gzgk013)     
    END FOREACH
   #150611-00032#5 add(e)

   CASE p_gzgj010   #150611-00032#5 add
      WHEN "1"   #150611-00032#5 add
         #粗體         
         IF g_gzgk_att_m.gzgk010 IS NULL THEN LET g_gzgk_att_m.gzgk010 ="N" END IF         
         #斜體
         IF g_gzgk_att_m.gzgk011 IS NULL THEN LET g_gzgk_att_m.gzgk011 ="N" END IF
         #字型大小，若沒值 預設為10
#         IF g_gzgk_att_m.gzgk008 IS NULL THEN LET g_gzgk_att_m.gzgk008 ="10" END IF   #150611-00032#5 mark
         #150611-00032#5 add(s)
         IF g_gzgk_att_m.gzgk008 IS NULL THEN
           CASE ps_idx
              WHEN 1
                   LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00601
              WHEN 2
                   LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00602
              WHEN 3
                   LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00603
              WHEN 4
                   LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00604
           END CASE     
            
           CASE l_gzgk006
                WHEN "11" 
                   #對內公司抬頭字型16
                   LET g_gzgk_att_m.gzgk008 = "16"
                WHEN "12"
                   #對外公司抬頭字型16
                   LET g_gzgk_att_m.gzgk008 = "16"                    
                WHEN "16"
                   #報表抬頭
                   LET g_gzgk_att_m.gzgk008 = "14"
                OTHERWISE 
                   LET g_gzgk_att_m.gzgk008 = "10"              
           END CASE          
         END IF
         
         IF g_gzgk_att_m.gzgk009 IS NULL THEN
            IF g_gzgk_d[g_detail_idx].gzgk00601 = '20' OR g_gzgk_d[g_detail_idx].gzgk00601 = '21'
               OR g_gzgk_d[g_detail_idx].gzgk00601 = '23' OR g_gzgk_d[g_detail_idx].gzgk00601 = '24' THEN
               LET g_gzgk_att_m.gzgk009 = "1"
            ELSE   
               LET g_gzgk_att_m.gzgk009 = "3"
            END IF   
         END IF
         #150611-00032#5 add(e)
         #字型顏色，若沒值 預設為黑
         IF g_gzgk_att_m.gzgk012 IS NULL THEN 
            LET g_gzgk_att_m.gzgk012 ="#000000" 
            LET g_gzgk_att_m.gzgk012_id = "1"
         END IF          
         IF g_gzgk_att_m.gzgk007 IS NULL THEN
            ##語言別對應的字型
            CASE g_gzgj_m.gzgj002
                 WHEN "en_US" 
                    LET g_gzgk_att_m.gzgk007 = cl_getmsg("azz-00702",g_lang)
                 WHEN "zh_TW" 
                    LET g_gzgk_att_m.gzgk007 = cl_getmsg("azz-00700",g_lang)
                 WHEN "zh_CN" 
                    LET g_gzgk_att_m.gzgk007 = cl_getmsg("azz-00701",g_lang)  
                 OTHERWISE 
                    LET g_gzgk_att_m.gzgk007 = cl_getmsg("azz-00702",g_lang)            
            END CASE 
         END IF 
         #150611-00032#5 mark(s)
#         #粗體
#         IF g_gzgk_att_m.gzgk010 IS NULL THEN
#            LET g_gzgk_att_m.gzgk010 = "N"
#         END IF 
#         #斜體         
#         IF g_gzgk_att_m.gzgk011 IS NULL THEN
#            LET g_gzgk_att_m.gzgk011 = "N"
#         END IF
         #150611-00032#5 mark(e)

      #150611-00032#5 add(s)
      WHEN "2"
        #粗體         
        IF g_gzgk_1_att_m.l_gzgk010 IS NULL THEN LET g_gzgk_1_att_m.l_gzgk010 ="N" END IF         
        #斜體
        IF g_gzgk_1_att_m.l_gzgk011 IS NULL THEN LET g_gzgk_1_att_m.l_gzgk011 ="N" END IF
        #字型大小，若沒值 預設為10
#        IF g_gzgk_1_att_m.l_gzgk008 IS NULL THEN LET g_gzgk_1_att_m.l_gzgk008 ="10" END IF
        CASE ps_idx
           WHEN 1
                LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00601
           WHEN 2
                LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00602
           WHEN 3
                LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00603
           WHEN 4
                LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00604
        END CASE                    
        CASE l_gzgk006
             WHEN "11" 
                #對內公司抬頭字型16
                LET g_gzgk_1_att_m.l_gzgk008 = "16"
             WHEN "12"
                #對外公司抬頭字型16
                LET g_gzgk_1_att_m.l_gzgk008 = "16"                    
             WHEN "16"
                #報表抬頭
                LET g_gzgk_1_att_m.l_gzgk008 = "14"
             OTHERWISE 
                LET g_gzgk_1_att_m.l_gzgk008 = "10"              
        END CASE  
        
        IF g_gzgk_1_att_m.l_gzgk009 IS NULL THEN
           IF g_gzgk_1_d[g_detail_idx2].l_gzgk00601 = '20' OR g_gzgk_1_d[g_detail_idx2].l_gzgk00601 = '21'
              OR g_gzgk_1_d[g_detail_idx2].l_gzgk00601 = '23' OR g_gzgk_1_d[g_detail_idx2].l_gzgk00601 = '24' THEN
              LET g_gzgk_1_att_m.l_gzgk009 = "1"
           ELSE   
              LET g_gzgk_1_att_m.l_gzgk009 = "3"
           END IF   
        END IF
        #字型顏色，若沒值 預設為黑
        IF g_gzgk_1_att_m.l_gzgk012 IS NULL THEN 
           LET g_gzgk_1_att_m.l_gzgk012 ="#000000" 
           LET g_gzgk_1_att_m.l_gzgk012_id = "1"
        END IF          
        IF g_gzgk_1_att_m.l_gzgk007 IS NULL THEN
           ##語言別對應的字型
           CASE g_gzgj_m.gzgj002
                WHEN "en_US" 
                   LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00702",g_lang)
                WHEN "zh_TW" 
                   LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00700",g_lang)
                WHEN "zh_CN" 
                   LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00701",g_lang)  
                OTHERWISE 
                   LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00702",g_lang)            
           END CASE 
         END IF 
      END CASE   

      IF ps_idx = 0 THEN
         CASE p_gzgj010
            WHEN "1"
               INITIALIZE g_gzgk_att_m TO NULL
            WHEN "2"
               INITIALIZE g_gzgk_1_att_m TO NULL
         END CASE   
      END IF
      #150611-00032#5 add(e) 

END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL azzi330_01_s01_ui_dialog()
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 140930 By janet
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_s01_ui_dialog()
  DEFINE  p_cmd                 LIKE type_t.chr1  
  
  DISPLAY BY NAME g_gzgk_att_m.gzgk001,g_gzgk_att_m.gzgk002,g_gzgk_att_m.gzgk003,g_gzgk_att_m.gzgk004,
                  g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,g_gzgk_att_m.gzgk010,
                  g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012_id,g_gzgk_att_m.gzgk012,g_gzgk_att_m.gzgk013_id,
                  g_gzgk_att_m.gzgk013              

  DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
       INPUT BY NAME  g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,g_gzgk_att_m.gzgk010,
                      g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012_id,g_gzgk_att_m.gzgk012,g_gzgk_att_m.gzgk013_id,
                      g_gzgk_att_m.gzgk013                                      
                      ATTRIBUTE(WITHOUT DEFAULTS)
                      
            BEFORE INPUT
            
            ON CHANGE gzgk012_id
               CALL azzi330_01_s01_set_color_16(g_gzgk_att_m.gzgk012_id,"gzgk012")
 
            ON CHANGE gzgk013_id
               CALL azzi330_01_s01_set_color_16(g_gzgk_att_m.gzgk013_id,"gzgk013") 
   
            AFTER FIELD gzgk012_id
   
            AFTER FIELD gzgk013_id
   
            AFTER INPUT 
              
        
     
   
      END INPUT 


      BEFORE DIALOG 
 
    
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name,g_fld_name,g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         CALL cl_set_head_visible("","AUTO")
 
      ON ACTION accept
           UPDATE gzgk_t SET (gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,gzgk013)=
                            (g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,
                             g_gzgk_att_m.gzgk010,g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012,
                             g_gzgk_att_m.gzgk013)
           WHERE gzgk001 = g_gzgk_att_m.gzgk001 AND gzgk002 = g_gzgk_att_m.gzgk002
             AND gzgk003 = g_gzgk_att_m.gzgk003 AND gzgk004 = g_gzgk_att_m.gzgk004
             AND gzgk014 = g_gzgk_att_m.gzgk014   #150611-00032#5 add
           IF SQLCA.sqlcode THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = SQLCA.sqlcode
              LET g_errparam.extend = "gzgk_t"
              LET g_errparam.popup = TRUE
              CALL cl_err()
  
              CALL s_transaction_end('N','0')
             
           END IF         
           CALL s_transaction_end('Y','0')

         ACCEPT DIALOG
        
      ON ACTION cancel      #在dialog button (放棄)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close       #在dialog 右上角 (X)
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit        #toolbar 離開
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
         
   END DIALOG    
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL azzi330_01_s01_set_color (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 140930 By janet
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_s01_set_color(ps_type,ps_value)
   DEFINE ps_type   STRING
   DEFINE ps_value  STRING
   DEFINE ps_id     LIKE type_t.chr1        #對應id
   
   LET ps_id =''
   CASE ps_value
     WHEN "#000000"  #黑
       LET ps_id ='1'         
     WHEN "#00008B"  #藍
       LET ps_id ='2'  
     WHEN "#006400"  #綠
       LET ps_id ='3'         
     WHEN "#8B0000"  #紅
       LET ps_id ='4'   
     WHEN "#808080"  #灰
       LET ps_id ='5'  
     WHEN "#8B008B"  #紫
       LET ps_id ='6'
     WHEN "#FFFFFF"  #白
       LET ps_id ='7'        
     OTHERWISE  #其他
       IF ps_value IS NOT NULL THEN
          LET ps_id ='8'         
       ELSE
          LET ps_id ='' 
       END IF
         
   END CASE
   IF ps_type ="gzgk012" THEN
      LET g_gzgk_att_m.gzgk012_id = ps_id
   ELSE
      LET g_gzgk_att_m.gzgk013_id = ps_id
   END IF
   
END FUNCTION

################################################################################
# Descriptions...: 選擇顏色，將16進位放至欄伅
# Memo...........:
# Usage..........: CALL azzi330_01_s01_set_color_16 (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 140930 By janet
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_s01_set_color_16(ps_idx,ps_field)
   DEFINE ps_idx    STRING
   DEFINE ps_field  STRING
   DEFINE ps_value  STRING
   DEFINE ps_id     LIKE type_t.chr1        #對應id
   
   LET ps_value =''
   CASE ps_idx
     WHEN '1' #黑
       LET ps_value = "#000000"        
     WHEN '2' #藍
       LET ps_value = "#00008B" 
     WHEN '3'#綠
       LET ps_value = "#006400"         
     WHEN '4'  #紅
       LET ps_value = "#8B0000"   
     WHEN '5' #灰
       LET ps_value = "#808080"  
     WHEN '6' #紫
       LET ps_value = "#8B008B"  
     WHEN '7' #紫
       LET ps_value = "#FFFFFF"        
     OTHERWISE  #其他
       LET ps_value = ''
   END CASE
   #150611-00032#5 mark(s)
   IF ps_field ="gzgk012" THEN
      LET g_gzgk_att_m.gzgk012 = ps_value
      DISPLAY BY NAME g_gzgk_att_m.gzgk012
   ELSE
      LET g_gzgk_att_m.gzgk013 = ps_value
      DISPLAY BY NAME g_gzgk_att_m.gzgk013
   END IF
   #150611-00032#5 mark(e)
   #150611-00032#5 add(s)
   CASE ps_field
      WHEN "gzgk012"
         LET g_gzgk_att_m.gzgk012 = ps_value
         DISPLAY BY NAME g_gzgk_att_m.gzgk012
      WHEN "gzgk013"   
         LET g_gzgk_att_m.gzgk013 = ps_value
         DISPLAY BY NAME g_gzgk_att_m.gzgk013
      WHEN "l_gzgk012"
         LET g_gzgk_1_att_m.l_gzgk012 = ps_value
         DISPLAY BY NAME g_gzgk_1_att_m.l_gzgk012
      WHEN "gzgk013"   
         LET g_gzgk_1_att_m.l_gzgk013 = ps_value
         DISPLAY BY NAME g_gzgk_1_att_m.l_gzgk013      
   END CASE   
   #150611-00032#5 add(e)
   
END FUNCTION

################################################################################
# Descriptions...: 判斷gzgk006是否存在
# Memo...........:
# Usage..........: CALL azzi330_01_chk_gzgk006_exist(ps_gzgk006)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 141001 By janet
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_chk_gzgk006_exist(ps_gzgk006)
   DEFINE  ps_gzgk006    LIKE gzgk_t.gzgk006
   DEFINE  l_cnt         LIKE type_t.num5
   
   LET l_cnt = 0
   SELECT COUNT(gzgk006) INTO l_cnt 
     FROM gzgk_t
    WHERE gzgk001 = g_gzgj_m.gzgj001 AND gzgk002 = g_gzgj_m.gzgj002
      AND gzgk006 = ps_gzgk006
      AND gzgk014 = g_gzgk_att_m.gzgk014   #150611-00032#5 add 
   
   RETURN l_cnt
END FUNCTION

################################################################################
# Descriptions...: 儲存每筆combox資料到gzgk_t
# Memo...........:
# Usage..........: CALL azzi330_01_insert_combox_gzgk (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 141106 By janet
# Modify.........: 150615 By Cynthia add p_gzgj010
################################################################################
PRIVATE FUNCTION azzi330_01_insert_combox_gzgk(ps_field_idx,p_gzgj010)
   DEFINE ps_field_idx       LIKE type_t.num5
   DEFINE p_gzgj010          LIKE gzgj_t.gzgj010   #150611-00032#5 add 
   DEFINE l_gzgk006          LIKE type_t.chr10
   DEFINe l_gzgk007          LIKE gzgk_t.gzgk007
   DEFINE l_gzgk008          LIKE gzgk_t.gzgk008   
   DEFINE l_gzgk009          LIKE gzgk_t.gzgk009
   DEFINE l_gzgk010          LIKE gzgk_t.gzgk010
   DEFINE l_gzgk011          LIKE gzgk_t.gzgk011
   DEFINE l_gzgk012          LIKE gzgk_t.gzgk012
   DEFINE l_gzgk013          LIKE gzgk_t.gzgk013 
   DEFINE l_count            LIKE type_t.num5   
 
    IF ps_field_idx > 0 THEN
       CASE p_gzgj010   #150611-00032#5 add
          WHEN "1"   #150611-00032#5 add
             LET l_count = 0  
             SELECT COUNT(*) INTO l_count FROM gzgk_t 
              WHERE  gzgk001 = g_gzgj_m.gzgj001
                AND gzgk002 = g_gzgj_m.gzgj002 
                AND gzgk003 = g_gzgk_d[g_detail_idx].gzgk003
                AND gzgk004 = ps_field_idx
                AND gzgk014 = p_gzgj010   #150611-00032#5 add
             IF SQLCA.SQLcode  THEN
                INITIALIZE g_errparam TO NULL 
                LET g_errparam.extend = "gzgk_t" 
                LET g_errparam.code   = SQLCA.sqlcode 
                LET g_errparam.popup  = TRUE 
                CALL cl_err()       
                
             END IF  
            
               CASE ps_field_idx
                  WHEN 1
                       LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00601
                  WHEN 2
                       LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00602
                  WHEN 3
                       LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00603
                  WHEN 4
                       LET l_gzgk006 = g_gzgk_d[g_detail_idx].gzgk00604
               END CASE     
               #150611-00032#5 mark(s)               
#               CASE l_gzgk006
#                    WHEN "11" 
#                       #對內公司抬頭字型16
#                       LET l_gzgk008 = "16"
#                    WHEN "12"
#                       #對外公司抬頭字型16
#                       LET l_gzgk008 = "16"                    
#                    WHEN "16"
#                       #報表抬頭
#                       LET l_gzgk008 = "14"
#                    OTHERWISE 
#                       LET l_gzgk008 = "10"                    
#               END CASE             
#               CASE g_gzgj_m.gzgj002
#                    WHEN "en_US" 
#                       LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)                   
#                    WHEN "zh_TW" 
#                       LET l_gzgk007 = cl_getmsg("azz-00700",g_lang)                      
#                    WHEN "zh_CN" 
#                       LET l_gzgk007 = cl_getmsg("azz-00701",g_lang)                        
#                    OTHERWISE 
#                       LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)            
#               END CASE      
               #150611-00032#5 mark(e)               
            
             CALL s_transaction_begin()
             IF l_count = 0 THEN
                #150611-00032#5 add(s)
               CASE l_gzgk006
                    WHEN "11" 
                       #對內公司抬頭字型16
                       LET l_gzgk008 = "16"
                       LET g_gzgk_att_m.gzgk008 = "16"   #150611-00032#5 add
                    WHEN "12"
                       #對外公司抬頭字型16
                       LET l_gzgk008 = "16"                    
                       LET g_gzgk_att_m.gzgk008 = "16"   #150611-00032#5 add
                    WHEN "16"
                       #報表抬頭
                       LET l_gzgk008 = "14"
                       LET g_gzgk_att_m.gzgk008 = "14"   #150611-00032#5 add
                    OTHERWISE 
                       LET l_gzgk008 = "10" 
                       LET g_gzgk_att_m.gzgk008 = "10"   #150611-00032#5 add                       
               END CASE             
               CASE g_gzgj_m.gzgj002
                    WHEN "en_US" 
                       LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)
                       LET g_gzgk_att_m.gzgk007 = l_gzgk007   #150611-00032#5 add                       
                    WHEN "zh_TW" 
                       LET l_gzgk007 = cl_getmsg("azz-00700",g_lang)
                       LET g_gzgk_att_m.gzgk007 = l_gzgk007   #150611-00032#5 add                       
                    WHEN "zh_CN" 
                       LET l_gzgk007 = cl_getmsg("azz-00701",g_lang)  
                       LET g_gzgk_att_m.gzgk007 = l_gzgk007   #150611-00032#5 add                       
                    OTHERWISE 
                       LET l_gzgk007 = cl_getmsg("azz-00702",g_lang)            
               END CASE  
               
                IF l_gzgk006 = '20' OR l_gzgk006 = '21' OR l_gzgk006 = '23' OR l_gzgk006 = '24' THEN
                   LET l_gzgk009 = '1'  #靠左
                   LET g_gzgk_att_m.gzgk009 = l_gzgk009   #150611-00032#5 add                       
                ELSE
                   LET l_gzgk009 = '3'  #置中                   
                   LET g_gzgk_att_m.gzgk009 = l_gzgk009   #150611-00032#5 add                       
                END IF
                #150611-00032#5 add(e)            
#                LET l_gzgk009 = '3'   #150611-00032#5 mark
                LET l_gzgk010 = 'N'
                LET g_gzgk_att_m.gzgk010 = l_gzgk010   #150611-00032#5 add                       
                LET l_gzgk011 = 'N'
                LET g_gzgk_att_m.gzgk011 = l_gzgk011   #150611-00032#5 add                       
                LET l_gzgk012 = '#000000'
                LET g_gzgk_att_m.gzgk012 = l_gzgk012   #150611-00032#5 add                       
                LET l_gzgk013 = ''      
                LET g_gzgk_att_m.gzgk013 = l_gzgk013   #150611-00032#5 add                       
            
                INSERT INTO gzgk_t
                       (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,
                        gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,
                        gzgk013
                        ,gzgk014   #150611-00032#5 add
                       ) 
                 VALUES(
                        g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgk_d[g_detail_idx].gzgk003,ps_field_idx
                        ,g_gzgk_d[g_detail_idx].gzgk005,l_gzgk006,
                        l_gzgk007,l_gzgk008,l_gzgk009,l_gzgk010,l_gzgk011,l_gzgk012,l_gzgk013
                        ,g_gzgj_m.gzgj010)   #150611-00032#5 add  
             ELSE
                IF cl_null(g_gzgk_att_m.gzgk010) THEN LET g_gzgk_att_m.gzgk010 = "N" END IF   #150611-00032#5 add
                IF cl_null(g_gzgk_att_m.gzgk011) THEN LET g_gzgk_att_m.gzgk011 = "N" END IF   #150611-00032#5 add             
#                UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,gzgk008) = (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,   #150611-00032#5 mark 
#                    g_gzgk_d[l_ac].gzgk003,ps_field_idx,g_gzgk_d[l_ac].gzgk005,l_gzgk006,l_gzgk008)   #150611-00032#5 mark
             #150611-00032#5 add(s)
             UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,gzgk007,gzgk008,
                                gzgk009,gzgk010,gzgk011,gzgk012,gzgk013) 
                             = (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgk_d[l_ac].gzgk003,ps_field_idx,g_gzgk_d[l_ac].gzgk005,  #150601 add #150520
                               l_gzgk006,g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,g_gzgk_att_m.gzgk010,  #150601 add #150520
                               g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012,g_gzgk_att_m.gzgk013) #150601 add #150520
             #150611-00032#5 add(e)
                 WHERE  gzgk001 = g_gzgj_m.gzgj001 
                   AND gzgk002 = g_gzgj_m.gzgj002       
                   AND gzgk003 = g_gzgk_d_t.gzgk003 #行   
                   AND gzgk004 = ps_field_idx       #欄  
                   AND gzgk014 = p_gzgj010   #150611-00032#5 add                   
             END IF
             IF SQLCA.sqlcode THEN
                INITIALIZE g_errparam TO NULL 
                LET g_errparam.extend = "gzgk_t" 
                LET g_errparam.code   = SQLCA.sqlcode 
                LET g_errparam.popup  = FALSE 
                CALL cl_err()
                CALL s_transaction_end('N','0')
             END IF  
             CALL s_transaction_end('Y','0')

          #150611-00032#5 add(s)
          WHEN "2"  
             LET l_count = 0  
             SELECT COUNT(*) INTO l_count FROM gzgk_t 
              WHERE gzgk001 = g_gzgj_m.gzgj001
                AND gzgk002 = g_gzgj_m.gzgj002 
                AND gzgk003 = g_gzgk_1_d[g_detail_idx2].l_gzgk003
                AND gzgk004 = ps_field_idx
                AND gzgk014 = p_gzgj010
             IF SQLCA.SQLcode  THEN
                INITIALIZE g_errparam TO NULL 
                LET g_errparam.extend = "gzgk_t" 
                LET g_errparam.code   = SQLCA.sqlcode 
                LET g_errparam.popup  = TRUE 
                CALL cl_err()       
                
             END IF         
               CASE ps_field_idx
                  WHEN 1
                       LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00601
                  WHEN 2
                       LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00602
                  WHEN 3
                       LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00603
                  WHEN 4
                       LET l_gzgk006 = g_gzgk_1_d[g_detail_idx2].l_gzgk00604
               END CASE                         
                   
             CALL s_transaction_begin()
             IF l_count = 0 THEN
               CASE l_gzgk006
                    WHEN "11" 
                       #對內公司抬頭字型16
                       LET g_gzgk_1_att_m.l_gzgk008 = "16"
                    WHEN "12"
                       #對外公司抬頭字型16
                       LET g_gzgk_1_att_m.l_gzgk008 = "16"                    
                    WHEN "16"
                       #報表抬頭
                       LET g_gzgk_1_att_m.l_gzgk008 = "14"
                    OTHERWISE 
                       LET g_gzgk_1_att_m.l_gzgk008 = "10"              
               END CASE             
               CASE g_gzgj_m.gzgj002
                    WHEN "en_US" 
                       LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00702",g_lang)
                    WHEN "zh_TW" 
                       LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00700",g_lang)
                    WHEN "zh_CN" 
                       LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00701",g_lang)  
                    OTHERWISE 
                       LET g_gzgk_1_att_m.l_gzgk007 = cl_getmsg("azz-00702",g_lang)            
               END CASE    
               
               IF l_gzgk006 = '20' OR l_gzgk006 = '21' OR l_gzgk006 = '23' OR l_gzgk006 = '24' THEN
                  LET g_gzgk_1_att_m.l_gzgk009 = '1'  #靠左
               ELSE
                  LET g_gzgk_1_att_m.l_gzgk009 = '3'  #置中                   
               END IF
               LET g_gzgk_1_att_m.l_gzgk010 = 'N'
               LET g_gzgk_1_att_m.l_gzgk011 = 'N'
               LET g_gzgk_1_att_m.l_gzgk012 = '#000000'
               LET g_gzgk_1_att_m.l_gzgk013 = ''      
            
               INSERT INTO gzgk_t
                       (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,
                        gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,
                        gzgk013 ,gzgk014
                       ) 
                 VALUES(
                        g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgk_1_d[g_detail_idx2].l_gzgk003,ps_field_idx
                        ,g_gzgk_1_d[g_detail_idx2].l_gzgk005,l_gzgk006,
                        g_gzgk_1_att_m.l_gzgk007,g_gzgk_1_att_m.l_gzgk008,g_gzgk_1_att_m.l_gzgk009,g_gzgk_1_att_m.l_gzgk010,
                        g_gzgk_1_att_m.l_gzgk011,g_gzgk_1_att_m.l_gzgk012,g_gzgk_1_att_m.l_gzgk013,g_gzgj_m.l_gzgj010)
             ELSE          
                IF cl_null(g_gzgk_1_att_m.l_gzgk010) THEN LET g_gzgk_1_att_m.l_gzgk010 = "N" END IF
                IF cl_null(g_gzgk_1_att_m.l_gzgk011) THEN LET g_gzgk_1_att_m.l_gzgk011 = "N" END IF             
                UPDATE gzgk_t SET (gzgk001,gzgk002,gzgk003,gzgk004,gzgk005,gzgk006,gzgk007,gzgk008,
                                   gzgk009,gzgk010,gzgk011,gzgk012,gzgk013) 
                                = (g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,g_gzgk_1_d[l_ac].l_gzgk003,ps_field_idx,g_gzgk_1_d[l_ac].l_gzgk005,
                                  l_gzgk006,g_gzgk_1_att_m.l_gzgk007,g_gzgk_1_att_m.l_gzgk008,g_gzgk_1_att_m.l_gzgk009,g_gzgk_1_att_m.l_gzgk010,
                                  g_gzgk_1_att_m.l_gzgk011,g_gzgk_1_att_m.l_gzgk012,g_gzgk_1_att_m.l_gzgk013)      
                 WHERE  gzgk001 = g_gzgj_m.gzgj001 
                   AND gzgk002 = g_gzgj_m.gzgj002       
                   AND gzgk003 = g_gzgk_1_d_t.l_gzgk003 #行   
                   AND gzgk004 = ps_field_idx       #欄
                   AND gzgk014 = p_gzgj010 
             END IF
             IF SQLCA.sqlcode THEN
                INITIALIZE g_errparam TO NULL 
                LET g_errparam.extend = "gzgk_t" 
                LET g_errparam.code   = SQLCA.sqlcode 
                LET g_errparam.popup  = FALSE 
                CALL cl_err()
                CALL s_transaction_end('N','0')
             END IF  
             CALL s_transaction_end('Y','0')
          END CASE            
          #150611-00032#5 add(e)
      END IF

END FUNCTION

################################################################################
# Descriptions...: 表頭各行各欄的控制
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 2015/6/15 By Cynthia
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_set_entry_info()
 
   #根據表頭行數顯示
   CASE g_gzgj_m.gzgj003
      WHEN "1"
         LET g_gzgk_d[1].gzgk003 = 1
      WHEN "2"
         LET g_gzgk_d[1].gzgk003 = 1
         LET g_gzgk_d[2].gzgk003 = 2
      WHEN "3"
         LET g_gzgk_d[1].gzgk003 = 1
         LET g_gzgk_d[2].gzgk003 = 2
         LET g_gzgk_d[3].gzgk003 = 3
      WHEN "4"
         LET g_gzgk_d[1].gzgk003 = 1
         LET g_gzgk_d[2].gzgk003 = 2
         LET g_gzgk_d[3].gzgk003 = 3
         LET g_gzgk_d[4].gzgk003 = 4
      WHEN "5"
         LET g_gzgk_d[1].gzgk003 = 1
         LET g_gzgk_d[2].gzgk003 = 2
         LET g_gzgk_d[3].gzgk003 = 3
         LET g_gzgk_d[4].gzgk003 = 4
         LET g_gzgk_d[5].gzgk003 = 5
      WHEN "6"
         LET g_gzgk_d[1].gzgk003 = 1
         LET g_gzgk_d[2].gzgk003 = 2
         LET g_gzgk_d[3].gzgk003 = 3
         LET g_gzgk_d[4].gzgk003 = 4
         LET g_gzgk_d[5].gzgk003 = 5
         LET g_gzgk_d[6].gzgk003 = 6      
   END CASE   

   #根據表尾行數顯示
   CASE g_gzgj_m.l_gzgj003
      WHEN "1"
         LET g_gzgk_1_d[1].l_gzgk003 = 1
      WHEN "2"
         LET g_gzgk_1_d[1].l_gzgk003 = 1
         LET g_gzgk_1_d[2].l_gzgk003 = 2
      WHEN "3"
         LET g_gzgk_1_d[1].l_gzgk003 = 1
         LET g_gzgk_1_d[2].l_gzgk003 = 2
         LET g_gzgk_1_d[3].l_gzgk003 = 3    
   END CASE 
   
   #根據表頭欄數顯示
   CASE g_gzgj_m.gzgj004
      WHEN "1"
         CALL cl_set_comp_visible("gzgk00602,lbl_gzgk00602,gzgj006",FALSE)
         CALL cl_set_comp_visible("gzgk00603,lbl_gzgk00603,gzgj007",FALSE)
         CALL cl_set_comp_visible("gzgk00604,lbl_gzgk00604,gzgj008",FALSE)
         CALL cl_set_comp_visible("lbl_gzgj006,lbl_gzgj006_c",FALSE)         #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj007,lbl_gzgj007_c",FALSE)         #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj008,lbl_gzgj008_c",FALSE)         #150611-00032#5 add      
      WHEN "2"
         CALL cl_set_comp_visible("gzgk00602,lbl_gzgk00602,gzgj006",TRUE)      
         CALL cl_set_comp_visible("lbl_gzgj006,lbl_gzgj006_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("gzgk00603,lbl_gzgk00603,gzgj007",FALSE)
         CALL cl_set_comp_visible("gzgk00604,lbl_gzgk00604,gzgj008",FALSE)
         CALL cl_set_comp_visible("lbl_gzgj007,lbl_gzgj007_c",FALSE)         #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj008,lbl_gzgj008_c",FALSE)         #150611-00032#5 add      
      WHEN "3"
         CALL cl_set_comp_visible("gzgk00602,lbl_gzgk00602,gzgj006",TRUE)      
         CALL cl_set_comp_visible("gzgk00603,lbl_gzgk00603,gzgj007",TRUE)
         CALL cl_set_comp_visible("lbl_gzgj006,lbl_gzgj006_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj007,lbl_gzgj007_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("gzgk00604,lbl_gzgk00604,gzgj008",FALSE)
         CALL cl_set_comp_visible("lbl_gzgj008,lbl_gzgj008_c",FALSE)         #150611-00032#5 add      
      WHEN "4"   
         CALL cl_set_comp_visible("gzgk00602,lbl_gzgk00602,gzgj006",TRUE)      
         CALL cl_set_comp_visible("gzgk00603,lbl_gzgk00603,gzgj007",TRUE)
         CALL cl_set_comp_visible("gzgk00604,lbl_gzgk00604,gzgj008",TRUE)
         CALL cl_set_comp_visible("lbl_gzgj006,lbl_gzgj006_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj007,lbl_gzgj007_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj008,lbl_gzgj008_c",TRUE)          #150611-00032#5 add      
   END CASE   

   #根據表尾行數顯示
   CASE g_gzgj_m.l_gzgj004
      WHEN "1"
         CALL cl_set_comp_visible("l_gzgk00602,lbl_gzgk00602,l_gzgj006",FALSE)
         CALL cl_set_comp_visible("l_gzgk00603,lbl_gzgk00603_1,l_gzgj007",FALSE)
         CALL cl_set_comp_visible("l_gzgk00604,lbl_gzgk00604_1,l_gzgj008",FALSE)
         CALL cl_set_comp_visible("lbl_gzgj006_1,lbl_gzgj006_1_c",FALSE)         #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj007_1,lbl_gzgj007_1_c",FALSE)         #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj008_1,lbl_gzgj008_1_c",FALSE)         #150611-00032#5 add      
      WHEN "2"
         CALL cl_set_comp_visible("l_gzgk00602,lbl_gzgk00602,l_gzgj006",TRUE)
         CALL cl_set_comp_visible("lbl_gzgj006_1,lbl_gzgj006_1_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("l_gzgk00603,lbl_gzgk00603_1,l_gzgj007",FALSE)
         CALL cl_set_comp_visible("l_gzgk00604,lbl_gzgk00604_1,l_gzgj008",FALSE)
         CALL cl_set_comp_visible("lbl_gzgj007_1,lbl_gzgj007_1_c",FALSE)         #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj008_1,lbl_gzgj008_1_c",FALSE)         #150611-00032#5 add      
      WHEN "3"
         CALL cl_set_comp_visible("l_gzgk00602,lbl_gzgk00602,l_gzgj006",TRUE)
         CALL cl_set_comp_visible("lbl_gzgj006_1,lbl_gzgj006_1_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj007_1,lbl_gzgj007_1_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("l_gzgk00603,lbl_gzgk00603_1,l_gzgj007",TRUE)
         CALL cl_set_comp_visible("l_gzgk00604,lbl_gzgk00604_1,l_gzgj008",FALSE)
         CALL cl_set_comp_visible("lbl_gzgj008_1,lbl_gzgj008_1_c",FALSE)         #150611-00032#5 add      
      WHEN "4"   
         CALL cl_set_comp_visible("l_gzgk00602,lbl_gzgk00602,l_gzgj006",TRUE)
         CALL cl_set_comp_visible("l_gzgk00603,lbl_gzgk00603_1,l_gzgj007",TRUE)
         CALL cl_set_comp_visible("l_gzgk00604,lbl_gzgk00604_1,l_gzgj008",TRUE)
         CALL cl_set_comp_visible("lbl_gzgj006_1,lbl_gzgj006_1_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj007_1,lbl_gzgj007_1_c",TRUE)          #150611-00032#5 add      
         CALL cl_set_comp_visible("lbl_gzgj008_1,lbl_gzgj008_1_c",TRUE)          #150611-00032#5 add      
   END CASE 
   
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 2015/6/15 By Cynthia
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_s01_field(ps_idx,p_gzgj010)
   DEFINE ps_idx            LIKE type_t.num5
   DEFINE p_gzgj010         LIKE gzgj_t.gzgj010

   LET g_forupd_sql = "SELECT gzgk007,gzgk008,gzgk009,gzgk010,gzgk011,gzgk012,gzgk013 ",
                     "  FROM gzgk_t ", 
                     " WHERE gzgk001=? AND gzgk002 =? AND gzgk003=? AND gzgk004 =? AND gzgk014 =? FOR UPDATE"

   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE azzi300_sub_bcl CURSOR FROM g_forupd_sql   

    CALL azzi330_01_s01_init(ps_idx,p_gzgj010)

  DISPLAY BY NAME g_gzgk_att_m.gzgk007,g_gzgk_att_m.gzgk008,g_gzgk_att_m.gzgk009,g_gzgk_att_m.gzgk010,
                  g_gzgk_att_m.gzgk011,g_gzgk_att_m.gzgk012_id,g_gzgk_att_m.gzgk012,g_gzgk_att_m.gzgk013_id,
                  g_gzgk_att_m.gzgk013                   
   DISPLAY g_gzgk_att_m.gzgk003 TO FORMONLY.l_col
   DISPLAY g_gzgk_att_m.gzgk004 TO FORMONLY.l_row                    
   
  DISPLAY BY NAME g_gzgk_1_att_m.l_gzgk007,g_gzgk_1_att_m.l_gzgk008,g_gzgk_1_att_m.l_gzgk009,g_gzgk_1_att_m.l_gzgk010,
                  g_gzgk_1_att_m.l_gzgk011,g_gzgk_1_att_m.l_gzgk012_id,g_gzgk_1_att_m.l_gzgk012,g_gzgk_1_att_m.l_gzgk013_id,
                  g_gzgk_1_att_m.l_gzgk013                   
   DISPLAY g_gzgk_1_att_m.l_gzgk003 TO FORMONLY.l_col_1
   DISPLAY g_gzgk_1_att_m.l_gzgk004 TO FORMONLY.l_row_1   
   
END FUNCTION

################################################################################
# Descriptions...: 檢查表頭資料是否有報表元件已使用
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 2015/06/15 By Cynthia
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_chk_using(p_cmd)
   DEFINE p_cmd         LIKE type_t.chr1
   DEFINE li_result     LIKE type_t.num5
   DEFINE li_cnt        LIKE type_t.num5
   DEFINE ls_sql        STRING
   DEFINE l_msg         STRING

   LET li_result = TRUE

   LET ls_sql  = "SELECT COUNT(1) FROM gzgm_t ",
                 " WHERE gzgm003 ='",g_gzgj_m.gzgj001,"'",
                 "   AND gzgm002 ='",g_gzgj_m.gzgj002,"'"

   PREPARE azzi330_gzgm_cnt FROM ls_sql
   EXECUTE azzi330_gzgm_cnt INTO li_cnt
   FREE azzi330_gzgm_cnt
   IF li_cnt > 0 THEN
      CASE p_cmd
         WHEN "u"
             CALL cl_ask_confirm_parm('azz-00806',g_gzgj_m.gzgj001) RETURNING li_result
         WHEN "d"
#             CALL cl_ask_confirm_parm('azz-00807',g_gzgj_m.gzgj001) RETURNING li_result
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = "azz-00807"
              LET g_errparam.extend = ""
              LET g_errparam.replace[1] = g_gzgj_m.gzgj001
              LET g_errparam.popup = TRUE
              CALL cl_err()
              RETURN FALSE
         OTHERWISE #none
      END CASE
   END IF
   RETURN li_result  
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 2015/06/15 By Cynthia
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_set_gzgk006_combo(ps_field,p_gzgj010,p_field_idx)
   DEFINE ps_field       STRING
   DEFINE p_gzgj010      LIKE gzgj_t.gzgj010
   DEFINE p_field_idx    LIKE type_t.num5   #指到哪一欄   
   DEFINE ps_values      STRING
   DEFINE ps_items       STRING
   DEFINE ps_field_name  STRING
   DEFINE pc_gzcb002     LIKE gzcb_t.gzcb002      #系統分類值
   DEFINE pc_gzcbl004    LIKE gzcbl_t.gzcbl004    #說明
   DEFINE pa_array DYNAMIC ARRAY OF RECORD
             value       STRING,
             label_tag   STRING,
             label       STRING
                   END RECORD
   DEFINE li_cnt         LIKE type_t.num5
   DEFINE l_sql          STRING
   DEFINE l_str          STRING
   DEFINE l_gzgk006      LIKE gzgk_t.gzgk006 
   DEFINE l_notneed_labeltag   BOOLEAN
   
   LET l_sql = "SELECT gzgk006 FROM gzgk_t WHERE gzgk001=? AND gzgk002=? AND gzgk014=? AND gzgk004 <> ?"
   PREPARE azzi330_get_gzgk006_pr FROM l_sql
   DECLARE azzi330_get_gzgk006_cs CURSOR FOR azzi330_get_gzgk006_pr
   
   LET l_str = NULL
   FOREACH azzi330_get_gzgk006_cs USING g_gzgj_m.gzgj001,g_gzgj_m.gzgj002,p_gzgj010,p_field_idx INTO l_gzgk006
      IF NOT cl_null(l_gzgk006) THEN
         LET l_str = l_str, ",'",l_gzgk006 CLIPPED,"'"
      END IF
   END FOREACH  
   
   LET l_sql = "SELECT gzcb002, gzcbl004 ",
               "  FROM gzcb_t LEFT JOIN gzcbl_t ON gzcb002 = gzcbl002 ",
               "   AND gzcb001 = gzcbl001 ",
               "   AND gzcb001 = 161 ",
               "   AND gzcbl003 = '",g_dlang CLIPPED,"' ",
               " WHERE gzcb001 IN (SELECT gzcb001 FROM gzcb_t WHERE gzcb001 = 161) "
               
   IF NOT cl_null(l_str) THEN
      LET l_str = l_str.subString(2,l_str.getLength())
      LET l_str = " AND gzcb002 NOT IN (",l_str,") "
      LET l_sql = l_sql,l_str
   END IF
               
   LET l_sql = l_sql," ORDER BY gzcb012 "            

   PREPARE azzi330_gzgk006_item_pr FROM l_sql
   DECLARE azzi330_gzgk006_item_cs CURSOR FOR azzi330_gzgk006_item_pr                                              
     
   IF SQLCA.SQLCODE THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code =  "lib-00068"
      LET g_errparam.extend = "gzcb_t"
      LET g_errparam.popup = TRUE
      CALL cl_err()
   
      RETURN
   END IF
   
   #將選項填入陣列
   LET li_cnt = 1
   FOREACH azzi330_gzgk006_item_cs INTO pc_gzcb002, pc_gzcbl004
      LET pa_array[li_cnt].value = pc_gzcb002 CLIPPED
      IF NOT l_notneed_labeltag THEN
         LET pa_array[li_cnt].label_tag = pc_gzcb002 CLIPPED
      END IF
      LET pa_array[li_cnt].label = pc_gzcbl004 CLIPPED
      LET li_cnt = li_cnt + 1
   END FOREACH
   CALL cl_set_combo_detail(ps_field, pa_array)      
   
END FUNCTION

################################################################################
# Descriptions...: 組"合併"下拉選單 #150611-00032#5 add
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 2015/07/13 By Cynthia
# Modify.........:
################################################################################
PRIVATE FUNCTION azzi330_01_set_gzgk005_combo(ps_field,p_gzgj010)
   DEFINE ps_field       STRING
   DEFINE p_gzgj010      LIKE gzgj_t.gzgj010
   DEFINE l_sql          STRING
   DEFINE pa_array DYNAMIC ARRAY OF RECORD
             value       STRING,
             label_tag   STRING,
             label       STRING
                   END RECORD
   DEFINE li_cnt         LIKE type_t.num5
   DEFINE l_gzgj004      LIKE gzgj_t.gzgj004
   DEFINE l_gzgl001      LIKE gzgl_t.gzgl001
   DEFINE l_gzgl003      LIKE gzgl_t.gzgl003
   
   LET l_sql = "SELECT gzgl001,gzgl003 FROM gzgl_t WHERE gzgl002<= ? ORDER BY gzgl001 "
   PREPARE azzi330_get_gzgk005_pr FROM l_sql
   DECLARE azzi330_get_gzgk005_cs CURSOR FOR azzi330_get_gzgk005_pr

   CASE p_gzgj010
      WHEN "1"
         LET l_gzgj004 = g_gzgj_m.gzgj004
      WHEN "2"
         LET l_gzgj004 = g_gzgj_m.l_gzgj004
   END CASE 
      
   #將選項填入陣列
   LET li_cnt = 1
   FOREACH azzi330_get_gzgk005_cs USING l_gzgj004 INTO l_gzgl001,l_gzgl003 
      LET pa_array[li_cnt].value = l_gzgl001
      LET pa_array[li_cnt].value = pa_array[li_cnt].value CLIPPED
      LET pa_array[li_cnt].label = l_gzgl003 CLIPPED
      LET li_cnt = li_cnt + 1
   END FOREACH         

   CALL cl_set_combo_detail(ps_field, pa_array)      
      
END FUNCTION

 
{</section>}
 
