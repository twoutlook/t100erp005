<spec prog="apsp800" std_prog="apsp800" erpver="1.0" ver="1" module="APS" booking="Y" class="p" template="P001_00" env="s" zone="t10dev">
  <other>
    <code_template value="P" status="" />
    <free_style value="N" status="" />
  </other>
  <toolbar items="output" />
  <prog_rel />
  <ref_field>
    <rfield cite_std="N" ver="1" name="psfa001_desc" src="s" depend_field="psfa_t.psfa001" correspon_key="psfa001" ref_table="psfal_t" ref_fk="psfal001" ref_dlang="psfal002" ref_rtn="psfal003" status="" />
  </ref_field>
  <multi_lang />
  <help_code>
    <hfield cite_std="N" ver="1" name="psfa_t.psfa001" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status="d" />
  </help_code>
  <strings>
    <sfield name="condition_page" text="條件輸入" lstr="" />
    <sfield name="group_qbe" text="QBE條件" lstr="" />
    <sfield name="lbl_psfa001" text="集團MRP版本" lstr="" />
    <sfield name="lbl_psfal003" text="說明" lstr="" />
    <sfield name="group_progress" text="處理進度" lstr="" />
    <sfield name="lbl_stagenow" text="目前處理階段:" lstr="" />
    <sfield name="lbl_stagecomplete" text="整體完成進度:" lstr="" />
    <sfield name="scheduling_page" text="排程設定" lstr="" />
    <sfield name="history_page" text="執行歷程" lstr="" />
    <sfield name="cl_err_s01_Detail" text="詳細資訊" lstr="" />
    <sfield name="cl_err_s01_Sure" text="確定" lstr="" />
    <sfield name="lbl_gzpd001" text="排程執行序號" lstr="" />
    <sfield name="lbl_gzpd002" text="排程編號" lstr="" />
    <sfield name="lbl_gzpd003" text="序號" lstr="" />
    <sfield name="lbl_gzpd004" text="執行作業" lstr="" />
    <sfield name="lbl_gzpd005" text="傳入參數" lstr="" />
    <sfield name="lbl_gzpc006" text="執行結束時間" lstr="" />
    <sfield name="lbl_gzpd007" text="作業執行狀態" lstr="" />
    <sfield name="lbl_gzpd008" text="作業執行時間" lstr="" />
    <sfield name="lbl_gzpd009" text="執行員工編號" lstr="" />
    <sfield name="lbl_gzpd010" text="作業完成時間" lstr="" />
    <sfield name="btn_schedule_reexec" text="重新執行" lstr="" />
    <sfield name="btn_view" text="重新查看" lstr="" />
    <sfield name="btn_schedule_adv" text="進階查詢" lstr="" />
    <sfield name="lbl_gzpa003" text="執行類型" lstr="" />
    <sfield name="lbl_gzpa002" text="排程說明" lstr="" />
    <sfield name="lbl_asign" text="指定時間執行" lstr="" />
    <sfield name="lbl_gzpa007" text="預定執行時間" lstr="" />
    <sfield name="lbl_exec" text="執行時間設定" lstr="" />
    <sfield name="lbl_wk1" text="第一週" lstr="" />
    <sfield name="lbl_wk2" text="第二週" lstr="" />
    <sfield name="lbl_wk3" text="第三週" lstr="" />
    <sfield name="lbl_wk4" text="第四週" lstr="" />
    <sfield name="lbl_wk5" text="第五週" lstr="" />
    <sfield name="lbl_wd0" text="週日" lstr="" />
    <sfield name="lbl_wd1" text="週一" lstr="" />
    <sfield name="lbl_wd2" text="週二" lstr="" />
    <sfield name="lbl_wd3" text="週三" lstr="" />
    <sfield name="lbl_wd4" text="週四" lstr="" />
    <sfield name="lbl_wd5" text="週五" lstr="" />
    <sfield name="lbl_wd6" text="週六" lstr="" />
    <sfield name="lbl_dayend" text="月底" lstr="" />
    <sfield name="lbl_sc1" text="時段一" lstr="" />
    <sfield name="lbl_to" text="至" lstr="" />
    <sfield name="lbl_per" text="每" lstr="" />
    <sfield name="lbl_times" text="執行一次" lstr="" />
    <sfield name="lbl_sc2" text="時段二" lstr="" />
    <sfield name="lbl_sc3" text="時段三" lstr="" />
    <sfield name="lbl_spec" text="特殊指定" lstr="" />
    <sfield name="lbl_gzpa029" text="執行日遇到假日" lstr="" />
    <sfield name="lbl_gzpa031" text="前一程序未完成時不執行新程序" lstr="" />
    <sfield name="lbl_end_call" text="執行結束通知人員" lstr="" />
    <sfield name="lbl_gzpe003" text="執行狀況" lstr="" />
    <sfield name="lbl_gzpe004" text="收件人員工編號" lstr="" />
    <sfield name="lbl_gzpe004_desc" text="員工姓名" lstr="" />
    <sfield name="lbl_addr" text="收件人信件位址" lstr="" />
    <sfield name="lbl_gzpe005" text="信件主旨" lstr="" />
    <sfield name="lbl_check" text="多選" lstr="" />
    <sfield name="lbl_gzxm001" text="QBE編號" lstr="" />
    <sfield name="cl_qbe_s02.lbl_gzxm005" text="查詢方案名稱" lstr="" />
    <sfield name="lbl_gzxm002" text="作業編號" lstr="" />
    <sfield name="lbl_gzxm003" text="員工編號" lstr="" />
    <sfield name="cl_qbe_s02.lbl_gzxm004" text="設為預設查詢條件" lstr="" />
    <sfield name="cl_qbe_s02.bpage_1" text="條件組合內容" lstr="" />
    <sfield name="cl_qbe_s02.lbl_gzxn005" text="欄位說明" lstr="" />
    <sfield name="cl_qbe_s02.lbl_gzxn006" text="運算子" lstr="" />
    <sfield name="cl_qbe_s02.lbl_gzxn007" text="條件值" lstr="" />
    <sfield name="cl_qbe_s02_Accept" text="確認" lstr="" />
    <sfield name="cl_qbe_s02_Cancel" text="取消" lstr="" />
    <sfield name="lbl_funid" text="函式代碼" lstr="" />
    <sfield name="lbl_fundesc" text="函式說明" lstr="" />
    <sfield name="cl_qbe_s01_Accept" text="確認" lstr="" />
    <sfield name="cl_qbe_s01_Cancel" text="取消" lstr="" />
    <sfield name="cl_qbe_s03.bpage_1" text="查詢方案列表" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxmstus" text="有效" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxm004" text="預設" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxm009" text="順序" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxml005" text="查詢方案說明" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxm007" text="自設SQL條件" lstr="" />
    <sfield name="cl_qbe_s03.page_2" text="條件組合內容" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxn004" text="序號" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxn005" text="條件欄位" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxn006" text="運算子" lstr="" />
    <sfield name="cl_qbe_s03.lbl_gzxn007" text="條件值" lstr="" />
    <sfield name="lbl_hbegin" text="第" lstr="" />
    <sfield name="lbl_hsep" text="筆(共" lstr="" />
    <sfield name="lbl_hend" text="筆)" lstr="" />
    <sfield name="lbl_dbegin" text="第" lstr="" />
    <sfield name="lbl_dsep" text="項(共" lstr="" />
    <sfield name="lbl_dend" text="項)" lstr="" />
    <sfield name="add_favorite_catalog" text="新增目錄" lstr="" />
    <sfield name="modify_favorite_desc" text="修改" lstr="" />
    <sfield name="favorite_del" text="移除" lstr="" />
    <sfield name="add_catalog" text="" lstr="" />
    <sfield name="accept" text="確定" lstr="" />
    <sfield name="cancel" text="取消" lstr="" />
    <sfield name="cl_about_s02_StackMesg" text="訊息" lstr="" />
    <sfield name="cl_about_s02_YesISee" text="是的，我瞭解了！" lstr="" />
    <sfield name="cl_cmdask_s01_Run" text="請輸入執行作業編號" lstr="" />
    <sfield name="cl_progress_bar_Current" text="目前進度" lstr="" />
    <sfield name="cl_progress_bar_Total" text="全部" lstr="" />
    <sfield name="cl_progress_bar_%" text="%" lstr="" />
    <sfield name="cl_ask_s04_OK" text="OK" lstr="" />
    <sfield name="cl_ask_s03_Test" text="測試" lstr="" />
    <sfield name="cl_ask_s03_OK" text="OK" lstr="" />
    <sfield name="cl_ask_s01_Choice" text="選擇" lstr="" />
    <sfield name="lbl_gzzz001" text="作業編號" lstr="" />
    <sfield name="lbl_gzzal003" text="程式名稱" lstr="" />
    <sfield name="lbl_gzxml001" text="QBE編號" lstr="" />
    <sfield name="lbl_gzxml002" text="作業編號" lstr="" />
    <sfield name="lbl_gzxml003" text="員工編號" lstr="" />
    <sfield name="lbl_gzxml004" text="語言別" lstr="" />
    <sfield name="lbl_gzxml005" text="說明" lstr="" />
    <sfield name="lbl_gzxml006" text="註記碼" lstr="" />
    <sfield name="lbl_ooag001" text="員工編號" lstr="" />
    <sfield name="lbl_oofa011" text="全名" lstr="" />
  </strings>
  <sa_spec />
  <table ver="" cite_std="N" />
  <all cite_std="N" ver="1" src="s" status="u">
<![CDATA[程式說明及目的： 依APS計算出各廠的供需，合併各廠資料，計算可調撥庫存量
作業功能：條件查詢/條件儲存/相關文件/說明/離開
作業類型：批次處理作業
輸入模式：批次 P001_00

批次流程：
1.依輸入的集團MRP版本(psfa001)，刪除集團MRP匯總檔(psga_t)及集團MRP明細檔(psgb_t)
2.依輸入的集團MRP版本(psfa001)，抓取各site的MRP結果檔(psoz_t)。(每個site取執行日期時間(psoz002)最大的資料)
   將取出的資料，依照合併時距(psfa007)匯總後，寫入集團MRP明細檔(psgb_t)
   合併時距(psfa007)：
           時距為天(psfa007='1')時，依每天為匯總日
           時距為週(psfa007='2')時，到日曆檔(ooga_t)抓取供需日期(psoz004)該週的第一天為匯總日
           時距為旬(psfa007='3')時，固定為每月1、11、21日為匯總日
           時距為月(psfa007='4')時，固定為每月1日為匯總日
   寫入集團MRP明細檔(psgb_t)：
           企業編號(psgbent)=g_enterprise
           集團MRP版本(psgb001)=畫面上輸入的psfa001
           料件編號(psgb002)=psoz038
           產品特徵(psgb003)=psoz039
           日期(psgb004)=依合併時距(psfa007)決定的匯總日
           營運據點(psgbsite)=psozsite
           庫存量(psgb005)=psoz018
           替代量(psgb006)=psoz009+psoz010+psoz013+psoz015+psoz020+psoz026+psoz027+psoz028
           請購量(psgb007)=psoz021
           採購量(psgb008)=psoz022
           在驗量(psgb009)=psoz019
           在製量(psgb010)=psoz024+psoz025
           交期重排供給增加量(psgb011)=psoz030
           備料重排需求減少量(psgb012)=psoz016
           安全庫存量(psgb013)=psoz007
           訂單未交量(psgb014)=psoz005
           預測需求量(psgb015)=psoz006
           工單備料量(psgb016)=psoz014
           計畫備料量(psgb017)=psoz012
           交期重排減少量(psgb018)=psoz029
           備料重排增加量(psgb019)=psoz017
           結存量(psgb020)=0
           建議採購量(psgb021)=0
           建議生產量(psgb022)=0
           預計結存量(psgb023)=0
           建議撥出量(psgb024)=0
           建議撥入量(psgb025)=0
           可挪動庫存量(psgb026)=0
           已轉請採購(psgb027)='N'
           已轉工單(psgb028)='N'
3.將第2點寫入的psgb_t資料，依照相同的料件編號(psgb002)+產品特徵(psgb003)+日期(psgb004)，
   去計算各site的結存量(psgb020)、可挪動的庫存量(psgb026)、調撥數量(psgb024、psgb025)、
   建議採購量(psgb021)、建議生產量(psgb022)、預計結存量(psgb023)
   結存量(psgb020)：
           a.依psgbent+psgb001+psgb002+psgb003+psgbsite找小於該日期的最大一筆日期的預計結存量(psgb023)
           b.將a抓到的預計結存量(psgb023)
              +庫存量(psgb005)+替代量(psgb006)+請購量(psgb007)+採購量(psgb008)+在驗量(psgb009)
              +在製量(psgb010)+交期重排供給增加量(psgb011)+備料重排需求減少量(psgb012)
              - 安全庫存量(psgb013)-訂單未交量(psgb014)-預測需求量(psgb015)-工單備料量(psgb016)
              - 計畫備料量(psgb017)-交期重排減少量(psgb018)-備料重排增加量(psgb019)
   可挪動的庫存量(psgb026)：
           a.依輸入的集團MRP版本(psfa001)抓取庫存保留天數(psfa002)
              a.1 若psfa002='1'(依料件前置時間)，判斷各site的料件補貨策略(imaf013)
                     imaf013 = '1'(採購)或'4'(無)時，則保留天數=文件前置時間(imaf171)+交貨前置時間(imaf172)+到廠前置時間(imaf173)+入庫前置時間(imaf174)
                     imaf013 = '2'(自製)或'3'(委外)，則保留天數=累計前置時間(imae075)
              a.2 若psfa002='2'(固定天數)，則保留天數=固定保留天數(psfa003)
           b.保留天數佔用庫存數=依料號(psbg002)+產品特徵(psgb003)抓psph_t的供給型態(psph016)=I，
                                                     且需求日(psph019)在目前計算日期(psgb004)+第a點保留天數期間內的可供給量(psph026)合計
           c.計算日期庫存數=c.1-c.2-c.3
              c.1第一天庫存數：依psgbent+psgb001+psgb002+psgb003+psgbsite抓取最小日期的庫存數
              c.2依料號(psbg002)+產品特徵(psgb003)抓psph_t的供給型態(psph016)=I，
                   且需求日(psph019)<=目前計算日期(psgb004)的可供給量(psph026)合計
              c.3依psgbent+psgb001+psgb002+psgb003+psgbsite抓取小於該日期的建議撥出數(psgb024)
           d.可挪動的庫存數(psgb026)=第c點-第b點
               若算出來的psgb026小於0，則直接給0
   調撥數量(psgb024、psgb025)：
           a.依輸入的集團MRP版本(psfa001)，抓取產生庫存調撥建議(psfa008)；若psfa008='N'，則不做調撥的處理
           b.可調撥的據點依集團MRP版本設定
               b.1若有設定群組，則只能調撥至同群組的據點。
                     以集團MRP版本(psfa001)抓取psfc_t、psfd_t，抓的到值表示有設定群組。
               b.2若無設定群組，則可調撥存在於集團MRP版本單身檔(psfb_t)的據點。
           c.撥出的順序：依集團MRP版本設定的建議撥出數量(psfa005)
              psfa005='1'(餘量最大)：抓取可挪動的庫存數(psgb026)由大到小
              psfa005='2'(餘量最小)：抓取可挪動的庫存數(psgb026)由小到大
              psfa005='3'(自訂順序)：若有群組，以psfc_t、psfd_t的順序。
                                                           若無群組，以psfb_t的順序。
          d.撥入的順序：依集團MRP版本設定的建議撥入數量(psfa004)
             psfa004='1'(缺料最大)：抓取結存量(psgb020)由小到大(因為是負的)
             psfa004='2'(缺料最小)：抓取結存量(psgb020)由大到小(因為是負的)
             psfa004='3'(自訂順序)：若有群組，以psfc_t、psfd_t的順序。
                                                          若無群組，以psfb_t的順序。
         e.若考慮調撥批量與最小調撥數量(psfa006)='Y'，則依調撥批量(imaf101)、最小調撥數量(imaf102)進位
            ex.當需求數100，可調撥量為80，但調撥批量為50時，
                 如果有考慮調撥批量，則只調撥50
            ex.當需求數80，可調撥量為100，但調撥批量為50時，
                 有考慮調撥批量時，則調撥100
          f.記錄建議撥出、撥入的明細資料psgc_t
            企業編號(psgcent)=psgbent
            集團MRP版本(psgc001)=psgb001
            項次(psgcseq)=MAX(psgcseq)+1
            料件編號(psgc002)=psgb002
            產品特徵(psgc003)=psgb003
            日期(psgc004)=psgb004
            撥出營運據點(psgc005)=撥出的營運據點
            撥入營運據點(psgc006)=撥入的營運據點
            調撥數量(psgc007)=調撥的數量
            已轉單(psgc008)='N'
    建議採購量(psgb021)、建議生產量(psgb022)、預計結存量(psgb023)
         a.數量=結存量(psgb020)-建議撥出量(psgb024)+建議撥入量(psgb025)
         b.依各site的料件補貨策略(imaf013)判斷
             imaf013 = '1'(採購)或'4'(無)時，則建議採購量(psgb021)=a.數量
             (採購批量(imaf145)、最小採購數量(imaf146)進位)
             imaf013 = '2'(自製)或'3'(委外)，則建議生產量(psgb022)=a.數量
             (生產批量(imae017)、最小生產數量(imae018)進位)
         d.預計結存量(psgb023)=結存量(psgb020)-建議撥出量(psgb024)+建議撥入量(psgb025)
                                                   +建議採購量(psgb021)+建議生產量(psgb022)
4.將psgb_t依集團MRP版本(psgb001)+料件編號(psgb002)+產品特徵(psgb003)+日期(psgb004)匯總到集團MRP匯總檔(psga_t)]]>
</all>
  <field cite_std="N" name="psfa_t.psfa001" ver="1" src="s" column="psfa001" table="psfa_t" attribute="C002" type="varchar2(10)" req="Y" i_zoom="q_psfa001" c_zoom="" chk_ref="v_psfa001" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="ButtonEdit" status="">
<![CDATA[1.編輯時開窗：q_psfa001
2.校驗帶值：v_psfa001]]>
</field>
  <exclude ver="" cite_std="N" src="" />
</spec>