<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="artt411" std_prog="artt411" erpver="1.0" module="ART" ver="1" env="s" zone="t10dev" normal_style="Y" booking="Y">
  <point name="construct.c.page1.imaa009" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_rtax001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO imaa009  #顯示到畫面上

            NEXT FIELD imaa009                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.imaa105" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO imaa105  #顯示到畫面上

            NEXT FIELD imaa105                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.rtec001" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_rtdx001_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtec001  #顯示到畫面上

            NEXT FIELD rtec001                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.rtec002" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_rtdx002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtec002  #顯示到畫面上

            NEXT FIELD rtec002                     #返回原欄位

]]>
  </point>
  <point name="construct.c.page1.rtecunit" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooef001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtecunit  #顯示到畫面上

            NEXT FIELD rtecunit                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rteb001" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooef001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rteb001  #顯示到畫面上

            NEXT FIELD rteb001                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rteb002" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_rtea002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rteb002  #顯示到畫面上

            NEXT FIELD rteb002                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rteb006" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rteb006  #顯示到畫面上

            NEXT FIELD rteb006                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rtebcnfid" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtebcnfid  #顯示到畫面上

            NEXT FIELD rtebcnfid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rtebcrtdp" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooea001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtebcrtdp  #顯示到畫面上

            NEXT FIELD rtebcrtdp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rtebcrtid" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtebcrtid  #顯示到畫面上

            NEXT FIELD rtebcrtid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rtebdocno" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_rtebdocno()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtebdocno  #顯示到畫面上

            NEXT FIELD rtebdocno                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rtebmodid" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtebmodid  #顯示到畫面上

            NEXT FIELD rtebmodid                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rtebowndp" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooea001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtebowndp  #顯示到畫面上

            NEXT FIELD rtebowndp                     #返回原欄位

]]>
  </point>
  <point name="construct.c.rtebownid" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO rtebownid  #顯示到畫面上

            NEXT FIELD rtebownid                     #返回原欄位

]]>
  </point>
  <point name="input.a.page1.imaa009" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rtec_d[l_ac].imaa009
            CALL ap_ref_array2(g_ref_fields,"SELECT rtaxl003 FROM rtaxl_t WHERE rtaxlent='"||g_enterprise||"' AND rtaxl001=? AND rtaxl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_rtec_d[l_ac].imaa009_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rtec_d[l_ac].imaa009_desc
]]>
  </point>
  <point name="input.a.page1.imaa105" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rtec_d[l_ac].imaa105
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_rtec_d[l_ac].imaa105_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rtec_d[l_ac].imaa105_desc
]]>
  </point>
  <point name="input.a.page1.rtec001" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL artt411_null_rtec001()
            IF NOT cl_null(g_rtec_d[l_ac].rtec001) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND ( g_rtec_d[l_ac].rtec001 != g_rtec_d_t.rtec001 OR g_rtec_d_t.rtec001 IS NULL )) THEN
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
               
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_rtec_d[l_ac].rtec001
                  LET g_chkparam.arg2 = g_rteb_m.rtebunit 
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_rtdx001_1") THEN
                  ELSE
                     #檢查失敗時後續處理
                     LET g_rtec_d[l_ac].rtec001 = g_rtec_d_t.rtec001
                     CALL artt411_rtec0011_ref()
                     NEXT FIELD CURRENT
                  END IF
                  CALL artt411_unique_rtec001()
                  IF NOT cl_null(g_errno) THEN
                     CALL cl_err(g_rtec_d[l_ac].rtec001,g_errno,1)
                     LET g_rtec_d[l_ac].rtec001 = g_rtec_d_t.rtec001
                     CALL artt411_rtec0011_ref()
                     NEXT FIELD rtec001
                  END IF
                  CALL artt411_rtec001_ref()
               END IF 
            END IF   
            CALL artt411_rtec0011_ref()
]]>
  </point>
  <point name="input.a.page1.rtec002" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_rtec_d[l_ac].rtec002) THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND ( g_rtec_d[l_ac].rtec002 != g_rtec_d_t.rtec002 OR g_rtec_d_t.rtec002 IS NULL )) THEN
                  #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                  INITIALIZE g_chkparam.* TO NULL
               
                  #設定g_chkparam.*的參數
                  LET g_chkparam.arg1 = g_rtec_d[l_ac].rtec002
                  LET g_chkparam.arg2 = g_rteb_m.rtebunit   
                  #呼叫檢查存在並帶值的library
                  IF cl_chk_exist("v_rtdx002") THEN
                  ELSE
                     #檢查失敗時後續處理
                     LET g_rtec_d[l_ac].rtec002 = g_rtec_d_t.rtec002
                     NEXT FIELD CURRENT
                  END IF
                  IF cl_null( g_rtec_d[l_ac].rtec001) THEN
                     CALL artt411_rtec002_ref()
                     CALL artt411_unique_rtec001()
                     IF NOT cl_null(g_errno) THEN
                        CALL cl_err(g_rtec_d[l_ac].rtec002,g_errno,1)
                        LET g_rtec_d[l_ac].rtec002 = g_rtec_d_t.rtec002
                        LET g_rtec_d[l_ac].rtec001 = NULL
                        NEXT FIELD rtec002
                     END IF
                     CALL artt411_rtec0011_ref()
                  END IF
               END IF 
            END IF   
            CALL artt411_rtec0011_ref()]]>
  </point>
  <point name="input.a.page1.rtecseq" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_rtec_d[l_ac].rtecseq) THEN 
            END IF 

            #此段落由子樣板a05產生
            IF  g_rteb_m.rtebdocno IS NOT NULL AND g_rtec_d[g_detail_idx].rtecseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_rteb_m.rtebdocno != g_rtebdocno_t OR g_rtec_d[g_detail_idx].rtecseq != g_rtec_d_t.rtecseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM rtec_t WHERE "||"rtecent = '" ||g_enterprise|| "' AND "||"rtecdocno = '"||g_rteb_m.rtebdocno ||"' AND "|| "rtecseq = '"||g_rtec_d[g_detail_idx].rtecseq ||"'",'std-00004',0) THEN 
                     LET g_rtec_d[l_ac].rtecseq = g_rtec_d_t.rtecseq
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.rtecunit" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_rtec_d[l_ac].rtecunit) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_rtec_d[l_ac].rtecunit

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_ooef001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
]]>
  </point>
  <point name="input.a.rteb001" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            LET g_rteb_m.rteb001_desc = null
            DISPLAY BY NAME g_rteb_m.rteb001_desc
            IF NOT cl_null(g_rteb_m.rteb001) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_rteb_m.rteb001 != g_rteb_m_t.rteb001 or g_rteb_m_t.rteb001 is null )) THEN 
                  CALL artt411_chk_rteb001()
                  if not cl_null(g_errno) then 
                     #檢查失敗時後續處理
                     call cl_err(g_rteb_m.rteb001,g_errno,1)
                     LET g_rteb_m.rteb001 = g_rteb_m_t.rteb001
                     CALL artt411_rteb001_ref()
                     NEXT FIELD rteb001
                  END IF
                  IF NOT cl_null(g_rteb_m.rteb002) THEN 
                     #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
                     INITIALIZE g_chkparam.* TO NULL
                     #設定g_chkparam.*的參數
                     LET g_chkparam.arg1 = g_rteb_m.rteb002
                     LET g_chkparam.arg2 = g_rteb_m.rteb001
                     #呼叫檢查存在並帶值的library
                     IF cl_chk_exist("v_rtea002") THEN

                     ELSE
                       #檢查失敗時後續處理
                        LET g_rteb_m.rteb001 = g_rteb_m_t.rteb001
                        CALL artt411_rteb001_ref()
                        NEXT FIELD rteb001
                     END IF
           
                  END IF
               END IF
            END IF 
            CALL artt411_rteb001_ref()
]]>
  </point>
  <point name="input.a.rteb002" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            LET g_rteb_m.rteb002_desc = null
            DISPLAY BY NAME g_rteb_m.rteb002_desc
            IF NOT cl_null(g_rteb_m.rteb002) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_rteb_m.rteb002
               LET g_chkparam.arg2 = g_rteb_m.rteb001

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_rtea002") THEN

               ELSE
                  #檢查失敗時後續處理
                  LET g_rteb_m.rteb002 = g_rteb_m_t.rteb002
                  CALL artt411_rteb002_ref()
                  NEXT FIELD CURRENT
               END IF
            

            END IF
            CALL artt411_rteb002_ref()            
]]>
  </point>
  <point name="input.a.rteb006" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            LET g_rteb_m.rteb006_desc = null
            DISPLAY BY NAME g_rteb_m.rteb006_desc
            IF NOT cl_null(g_rteb_m.rteb006) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_rteb_m.rteb006
   
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooag001") THEN

               ELSE
                  #檢查失敗時後續處理
                  LET g_rteb_m.rteb006 = g_rteb_m_t.rteb006
                  CALL artt411_rteb006_ref()
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            CALL artt411_rteb006_ref()
            
]]>
  </point>
  <point name="input.a.rtebdocno" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  NOT cl_null(g_rteb_m.rtebdocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_rteb_m.rtebdocno != g_rtebdocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM rteb_t WHERE "||"rtebent = '" ||g_enterprise|| "' AND "||"rtebdocno = '"||g_rteb_m.rtebdocno ||"'",'std-00004',0) THEN 
                     LET g_rteb_m.rtebdocno = g_rteb_m_t.rtebdocno
                     NEXT FIELD CURRENT
                  END IF
                  CALL artt411_chk_rtebdocno()
                  IF NOT cl_null(g_errno) THEN
                     CALL cl_err(g_rteb_m.rtebdocno,g_errno,1)
                     LET g_rteb_m.rtebdocno = g_rteb_m_t.rtebdocno
                     NEXT FIELD rtebdocno
                  END IF
               END IF
            END IF
]]>
  </point>
  <point name="input.a.rtebunit" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            LET g_rteb_m.rtebunit_desc = null
            DISPLAY BY NAME g_rteb_m.rtebunit_desc
            IF NOT cl_null(g_rteb_m.rtebunit) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg1 = g_rteb_m.rtebunit
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist("v_ooef001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 

               ELSE
                  #檢查失敗時後續處理
                  LET g_rteb_m.rtebunit = g_rteb_m_t.rtebunit
                  CALL artt411_rtebunit_ref()
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            CALL artt411_rtebunit_ref()
]]>
  </point>
  <point name="input.c.page1.imaa009" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rtec_d[l_ac].imaa009             #給予default值

            #給予arg

            CALL q_rtax001()                                #呼叫開窗

            LET g_rtec_d[l_ac].imaa009 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rtec_d[l_ac].imaa009 TO imaa009              #顯示到畫面上

            NEXT FIELD imaa009                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.imaa105" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rtec_d[l_ac].imaa105             #給予default值

            #給予arg

            CALL q_ooca001_1()                                #呼叫開窗

            LET g_rtec_d[l_ac].imaa105 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rtec_d[l_ac].imaa105 TO imaa105              #顯示到畫面上

            NEXT FIELD imaa105                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.rtec001" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            if l_cmd = 'u' then
               LET g_qryparam.state = 'i'
			   LET g_qryparam.reqry = FALSE

               LET g_qryparam.default1 = g_rtec_d[l_ac].rtec001             #給予default值

               #給予arg
               LET g_qryparam.arg1= g_rteb_m.rtebsite

               CALL q_rtdx001_3()                                #呼叫開窗

               LET g_rtec_d[l_ac].rtec001 = g_qryparam.return1              #將開窗取得的值回傳到變數
               CALL artt411_rtec001_ref()
               call artt411_rtec0011_ref()
               DISPLAY g_rtec_d[l_ac].rtec001 TO rtec001              #顯示到畫面上

               NEXT FIELD rtec001                          #返回原欄位
            else
               LET g_qryparam.state= 'c'
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.default1 = g_rtec_d[l_ac].rtec001             #給予default值
               LET g_qryparam.arg1= g_rteb_m.rtebsite
               let g_rtec_d[l_ac].rtecsite = g_rteb_m.rtebsite
               let g_rtec_d[l_ac].rtecunit = g_rteb_m.rtebunit
               CALL q_rtdx001_3()
               LET tok = base.StringTokenizer.createExt(g_qryparam.return1,"|",'',TRUE)
                  LET l_detail_cnt = g_rtec_d.getLength()
                  LET l_ac_t = l_ac
                  LET l_count = 0
                  LET l_max=0
                  SELECT max(rtecseq) INTO l_max FROM rtec_t WHERE rtecdocno = g_rteb_m.rtebdocno
                     AND rtecent = g_enterprise
                  LET l_max = l_max+1
                  IF cl_null(l_max) THEN
                     LET l_max = 1
                  END IF 
                  WHILE tok.hasMoreTokens()
                     LET l_rtec001 = tok.nextToken()
                     IF cl_null(l_rtec001) THEN
                        CONTINUE WHILE
                     END IF
                     CALL artt411_chk_rtec001(l_rtec001)
                     IF NOT cl_null(g_errno) THEN
                        CONTINUE WHILE
                     END IF
                     IF l_cmd='a' OR
                      (l_cmd='u' AND l_rtec001!=g_rtec_d_t.rtec001) THEN
                         SELECT COUNT(*) INTO l_count1 FROM rtec_t
                          WHERE rtecent= g_enterprise AND rtec001 = l_rtec001
                            AND rtecdocno = g_rteb_m.rtebdocno
                        IF l_count1>0 THEN
                           CONTINUE WHILE
                        END IF
                     END IF
                     IF l_cmd='u' AND l_rtec001=g_rtec_d_t.rtec001 THEN
                        CONTINUE WHILE
                     END IF
                     LET l_count = l_count + 1                                        
                     IF l_count > 1 THEN
                        LET l_ac = l_detail_cnt + l_count - 1
                        LET g_rtec_d[l_ac].rtec001 = l_rtec001
                        LET g_rtec_d[l_ac].rtecseq = l_max
                        LET l_rtec002 = NULL
                        
                        IF cl_null(l_rtec002) THEN
                           SELECT rtdx002 INTO l_rtec002 FROM rtdx_t WHERE rtdxent = g_enterprise
                              AND rtdx001 = l_rtec001 AND rtdxsite = g_rteb_m.rtebsite AND rownum=1
                        END IF
                        INSERT INTO rtec_t(rtecent,rtecdocno,rtecseq,rtec001,rtec002,rtecsite,rtecunit)
                        VALUES(g_enterprise,g_rteb_m.rtebdocno,l_max,l_rtec001,l_rtec002,g_rteb_m.rtebsite,g_rteb_m.rtebunit)
                        IF SQLCA.sqlcode THEN                       
                           LET l_count = l_count - 1 
                        ELSE
                           CALL artt411_rtec001_ref()
                           CALL artt411_rtec0011_ref()
                           let l_max=l_max+1
                        END IF
                     ELSE
                        LET g_rtec_d[l_ac].rtec001 = l_rtec001
                        DISPLAY BY NAME g_rtec_d[l_ac].rtec001
                        LET g_rtec_d_t.rtec001=g_rtec_d[l_ac].rtec001
                        CALL artt411_rtec001_ref()
                        CALL artt411_rtec0011_ref()
                        let l_max=l_max+1
                     END IF
                     LET l_ac = l_ac_t
                  END WHILE
                  IF l_count = 0 THEN
                     CALL cl_err('',g_errno,1)
                  END IF
            end if                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.rtec002" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rtec_d[l_ac].rtec002             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_rteb_m.rtebsite #

            CALL q_rtdx002()                                #呼叫開窗

            LET g_rtec_d[l_ac].rtec002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rtec_d[l_ac].rtec002 TO rtec002              #顯示到畫面上

            NEXT FIELD rtec002                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.rtecunit" order="0" ver="1" cite_std="" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rtec_d[l_ac].rtecunit             #給予default值

            #給予arg

            CALL q_ooef001()                                #呼叫開窗

            LET g_rtec_d[l_ac].rtecunit = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rtec_d[l_ac].rtecunit TO rtecunit              #顯示到畫面上

            NEXT FIELD rtecunit                          #返回原欄位

]]>
  </point>
  <point name="input.c.rteb001" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rteb_m.rteb001             #給予default值

            #給予arg

            CALL q_rtea001()                                #呼叫開窗

            LET g_rteb_m.rteb001 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rteb_m.rteb001 TO rteb001              #顯示到畫面上
            call artt411_rteb001_ref()
            NEXT FIELD rteb001                          #返回原欄位

]]>
  </point>
  <point name="input.c.rteb002" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rteb_m.rteb002             #給予default值
            LET g_qryparam.where = "rtea001='",g_rteb_m.rteb001,"' "
            #給予arg

            CALL q_rtea002()                                #呼叫開窗

            LET g_rteb_m.rteb002 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rteb_m.rteb002 TO rteb002              #顯示到畫面上
            call artt411_rteb002_ref()
            NEXT FIELD rteb002                          #返回原欄位

]]>
  </point>
  <point name="input.c.rteb006" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rteb_m.rteb006             #給予default值

            #給予arg

            CALL q_ooag001()                                #呼叫開窗

            LET g_rteb_m.rteb006 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rteb_m.rteb006 TO rteb006              #顯示到畫面上
            call artt411_rteb006_ref()
            NEXT FIELD rteb006                          #返回原欄位

]]>
  </point>
  <point name="input.c.rtebdocno" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_rteb_m.rtebdocno             #給予default值

            #給予arg
            LET g_qryparam.arg1 = g_ooef004 #
            LET g_qryparam.arg2 = "artt411" #

            CALL q_ooba002_1()                                #呼叫開窗

            LET g_rteb_m.rtebdocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_rteb_m.rtebdocno TO rtebdocno              #顯示到畫面上

            NEXT FIELD rtebdocno                          #返回原欄位

]]>
  </point>
  <point name="show.body.reference" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      
      CALL artt411_rtec0011_ref()  ]]>
  </point>
  <point name="show.head.reference" order="0" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL artt411_rtebunit_ref()
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rteb001
            CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_rteb_m.rteb001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rteb001_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rteb001
            LET g_ref_fields[2] = g_rteb_m.rteb002
            CALL ap_ref_array2(g_ref_fields,"SELECT rtea003 FROM rtea_t WHERE rteaent='"||g_enterprise||"' AND rtea001=? AND rtea002=? ","") RETURNING g_rtn_fields
            LET g_rteb_m.rteb002_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rteb002_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rteb006
            CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
            LET g_rteb_m.rteb006_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rteb006_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rtebownid
            CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
            LET g_rteb_m.rtebownid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rtebownid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rtebowndp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooeal003 FROM ooeal_t WHERE ooealent='"||g_enterprise||"' AND ooeal001=? AND ooeal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_rteb_m.rtebowndp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rtebowndp_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rtebcrtid
            CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
            LET g_rteb_m.rtebcrtid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rtebcrtid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rtebcrtdp
            CALL ap_ref_array2(g_ref_fields,"SELECT ooeal003 FROM ooeal_t WHERE ooealent='"||g_enterprise||"' AND ooeal001=? AND ooeal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_rteb_m.rtebcrtdp_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rtebcrtdp_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rtebmodid
            CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
            LET g_rteb_m.rtebmodid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rtebmodid_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_rteb_m.rtebcnfid
            CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
            LET g_rteb_m.rtebcnfid_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_rteb_m.rtebcnfid_desc
]]>
  </point>
  <point name="function.artt411_rtebunit_ref" order="1" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#display rtebunit
PRIVATE FUNCTION artt411_rtebunit_ref()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_rteb_m.rtebunit
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_rteb_m.rtebunit_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_rteb_m.rtebunit_desc
END FUNCTION]]>
  </point>
  <point name="function.artt411_rteb001_ref" order="2" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#display rteb001
PRIVATE FUNCTION artt411_rteb001_ref()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_rteb_m.rteb001
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_rteb_m.rteb001_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_rteb_m.rteb001_desc
END FUNCTION]]>
  </point>
  <point name="function.artt411_chk_rtebdocno" order="3" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#chk rtebdocno
PRIVATE FUNCTION artt411_chk_rtebdocno()
   DEFINE   l_cnt       LIKE type_t.num5
   DEFINE   l_cnt1      LIKE type_t.num5
   define   p_rtebdocno like rteb_t.rtebdocno   
   LET l_cnt=0
   LET l_cnt1=0
   LET g_errno = null
   SELECT COUNT(*) INTO l_cnt  FROM ooba_t lEFT JOIN oobl_t ON ooba001=oobl001 AND ooba002=oobl002
    WHERE ooba001 = g_ooef004 AND ooba002=g_rteb_m.rtebdocno
      AND oobl003 = 'artt411'
   IF l_cnt <= 0 THEN
      LET g_errno = "aim-00056"
   ELSE
      SELECT COUNT(*) INTO l_cnt1  FROM ooba_t lEFT JOIN oobl_t ON ooba001=oobl001 AND ooba002=oobl002
       WHERE oobl001 = g_ooef004 AND oobl002=g_rteb_m.rtebdocno
      AND oobl003 = 'artt411' AND oobastus='Y'
      IF l_cnt1 <= 0 THEN
         LET g_errno = "aoo-00102"
      END IF         
   END IF
END FUNCTION]]>
  </point>
  <point name="function.artt411_rteb002_ref" order="4" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#display rteb002
PRIVATE FUNCTION artt411_rteb002_ref()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_rteb_m.rteb001
   LET g_ref_fields[2] = g_rteb_m.rteb002
   CALL ap_ref_array2(g_ref_fields,"SELECT rtea003 FROM rtea_t WHERE rteaent='"||g_enterprise||"' AND rtea001=? AND rtea002=? ","") RETURNING g_rtn_fields
   LET g_rteb_m.rteb002_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_rteb_m.rteb002_desc
END FUNCTION]]>
  </point>
  <point name="function.artt411_chk_rteb005" order="5" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#chk rteb005
PRIVATE FUNCTION artt411_chk_rteb005()
   LET g_errno=null
   IF NOT cl_null(g_rteb_m.rteb005) AND NOT cl_null(g_rteb_m.rteb004) THEN
      IF g_rteb_m.rteb005<g_rteb_m.rteb004 THEN
         LET g_errno="amm-00080"
      END IF
   END IF
END FUNCTION]]>
  </point>
  <point name="function.artt411_rteb006_ref" order="6" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#display rteb006
PRIVATE FUNCTION artt411_rteb006_ref()
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_rteb_m.rteb006
   CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
   LET g_rteb_m.rteb006_desc = '', g_rtn_fields[1] , ''
   DISPLAY BY NAME g_rteb_m.rteb006_desc
END FUNCTION]]>
  </point>
  <point name="function.artt411_create_rtecseq" order="7" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#create rtecseq
PRIVATE FUNCTION artt411_create_rtecseq()
   IF (cl_null(g_rtec_d[l_ac].rtecseq) OR g_rtec_d[l_ac].rtecseq=0) THEN
      SELECT MAX(rtecseq)+1 INTO g_rtec_d[l_ac].rtecseq FROM rtec_t
       WHERE rtecdocno = g_rteb_m.rtebdocno AND rtecent = g_enterprise
   END IF
   IF (cl_null(g_rtec_d[l_ac].rtecseq) OR g_rtec_d[l_ac].rtecseq=0) THEN
      LET g_rtec_d[l_ac].rtecseq = 1
   END IF
END FUNCTION]]>
  </point>
  <point name="function.artt411_rtec001_ref" order="8" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#display rtec002
PRIVATE FUNCTION artt411_rtec001_ref()
   SELECT rtdx002 INTO g_rtec_d[l_ac].rtec002 FROM rtdx_t,imay_t
    WHERE rtdx001=imay001 AND rtdx002 = imay003 AND rtdxent=imayent AND rtdx001 = g_rtec_d[l_ac].rtec001
      AND rtdxent = g_enterprise AND rtdxstus = 'Y' AND imaystus='Y'
   DISPLAY  g_rtec_d[l_ac].rtec002 TO s_detail1[l_ac].rtec002
END FUNCTION]]>
  </point>
  <point name="function.artt411_rtec0011_ref" order="9" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#display 規格，品類等
PRIVATE FUNCTION artt411_rtec0011_ref()
   SELECT imaal003,imaal004 INTO g_rtec_d[l_ac].rtec001_desc,g_rtec_d[l_ac].imaal004
     FROM imaal_t WHERE imaal001 = g_rtec_d[l_ac].rtec001
      AND imaal002 = g_dlang
   SELECT imaa009 INTO  g_rtec_d[l_ac].imaa009
     FROM imaa_t WHERE imaa001 = g_rtec_d[l_ac].rtec001
      AND imaaent = g_enterprise 
   SELECT rtdx033 INTO g_rtec_d[l_ac].imaa105
     FROM rtdx_t WHERE rtdx001 = g_rtec_d[l_ac].rtec001
      AND rtdxent = g_enterprise AND rtdxsite = g_rteb_m.rtebsite
   IF cl_null( g_rtec_d[l_ac].imaa105) THEN
      SELECT imaa105 INTO  g_rtec_d[l_ac].imaa105
        FROM imaa_t WHERE imaa001 = g_rtec_d[l_ac].rtec001
         AND imaaent = g_enterprise 
   END IF 
   SELECT rtaxl003 INTO g_rtec_d[l_ac].imaa009_desc
     FROM rtaxl_t
    WHERE rtaxl001 =  g_rtec_d[l_ac].imaa009 AND rtaxlent = g_enterprise
      AND rtaxl002 = g_dlang
   SELECT oocal003 INTO g_rtec_d[l_ac].imaa105_desc
     FROM oocal_t
    WHERE oocal001 = g_rtec_d[l_ac].imaa105 AND oocalent = g_enterprise
      AND oocal002 = g_dlang
   DISPLAY g_rtec_d[l_ac].rtec001_desc,g_rtec_d[l_ac].imaal004,g_rtec_d[l_ac].imaa009,
           g_rtec_d[l_ac].imaa009_desc,g_rtec_d[l_ac].imaa105,g_rtec_d[l_ac].imaa105_desc 
        TO s_detail1[l_ac].rtec001_desc,s_detail1[l_ac].imaal004,s_detail1[l_ac].imaa009,
           s_detail1[l_ac].imaa009_desc,s_detail1[l_ac].imaa105,s_detail1[l_ac].imaa105_desc  
END FUNCTION]]>
  </point>
  <point name="function.artt411_rtec002_ref" order="10" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#display rtec001
PRIVATE FUNCTION artt411_rtec002_ref()
   SELECT rtdx001 INTO g_rtec_d[l_ac].rtec001 FROM rtdx_t
    WHERE rtdx002 = g_rtec_d[l_ac].rtec002 AND rownum = 1
      AND rtdxent = g_enterprise AND rtdxstus = 'Y'
   DISPLAY  g_rtec_d[l_ac].rtec001 TO s_detail1[l_ac].rtec001
END FUNCTION]]>
  </point>
  <point name="function.artt411_unique_rtec001" order="11" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#unique rtec001
PRIVATE FUNCTION artt411_unique_rtec001()
   DEFINE l_cnt LIKE type_t.num5
   LET g_errno = NULL
   LET l_cnt = 0
   SELECT count(*) INTO l_cnt FROM rtec_t WHERE rtecdocno = g_rteb_m.rtebdocno
      AND rtecent = g_enterprise AND rtec001 = g_rtec_d[l_ac].rtec001
   IF l_cnt >0 THEN
      LET g_errno  = "art-00072"
   END IF
END FUNCTION]]>
  </point>
  <point name="function.artt411_null_rtec001" order="12" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#null rtec001,rtec001_desc,imaal004等
PRIVATE FUNCTION artt411_null_rtec001()
   LET g_rtec_d[l_ac].rtec001_desc = NULL
   LET g_rtec_d[l_ac].imaal004 = NULL
   LET g_rtec_d[l_ac].imaa009 = NULL
   LET g_rtec_d[l_ac].imaa009_desc = NULL
   LET g_rtec_d[l_ac].imaa105_desc = NULL
   LET g_rtec_d[l_ac].imaa105 = NULL
   DISPLAY g_rtec_d[l_ac].rtec001_desc,g_rtec_d[l_ac].imaal004,g_rtec_d[l_ac].imaa009,
           g_rtec_d[l_ac].imaa009_desc,g_rtec_d[l_ac].imaa105,g_rtec_d[l_ac].imaa105_desc 
        TO s_detail1[l_ac].rtec001_desc,s_detail1[l_ac].imaal004,s_detail1[l_ac].imaa009,
           s_detail1[l_ac].imaa009_desc,s_detail1[l_ac].imaa105,s_detail1[l_ac].imaa105_desc   
END FUNCTION]]>
  </point>
  <point name="function.artt411_chk_rtec001" order="13" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#chk rtec001
PRIVATE FUNCTION artt411_chk_rtec001(p_rtec001)
   DEFINE   l_cnt       LIKE type_t.num5
   DEFINE   l_cnt1      LIKE type_t.num5
   DEFINE   p_rtec001   LIKE rtec_t.rtec001   

   LET g_errno = NULL
   LET l_cnt = 0
   LET l_cnt1 = 0
   SELECT COUNT(*) INTO l_cnt  FROM rtdx_t,imaa_t WHERE rtdx001=imaa001 AND imaaent=rtdxent AND rtdx001= p_rtec001 AND rtdxent = g_enterprise
      and rtdxsite = g_rteb_m.rtebsite
   IF l_cnt <= 0 THEN
      LET g_errno = "art-00151"
   ELSE
      SELECT COUNT(*) INTO l_cnt1  FROM rtdx_t left join imaa_t ON imaa001=rtdx001 AND imaaent=rtdxent 
       WHERE rtdx001= p_rtec001 AND imaastus='Y'
         AND rtdxent = g_enterprise AND rtdxstus='Y' and rtdxsite = g_rteb_m.rtebsite
      IF l_cnt1 <= 0 THEN
         LET g_errno = "art-00153"
      END IF         
   END IF
END FUNCTION]]>
  </point>
  <point name="function.artt411_chk_rteb001" order="14" ver="1" cite_std="N" cite_ver="" new="Y" status="" src="s" mark_hard="N">
    <![CDATA[#chk rteb001
PRIVATE FUNCTION artt411_chk_rteb001()
   DEFINE l_cnt   LIKE type_t.num5
   DEFINE l_cnt1  LIKE type_t.num5
   LET g_errno = NULL
   LET l_cnt = 0
   LET l_cnt1 = 0 
   SELECT count(*) INTO l_cnt FROM rtea_t,ooef_t WHERE rteaent = g_enterprise
      AND rtea001 = ooef001 AND ooefent=rteaent
      AND rtea001 = g_rteb_m.rteb001
   IF l_cnt <= 0 THEN
      LET g_errno = "art-00213"
   ELSE
      SELECT count(*) INTO l_cnt1 FROM rtea_t,ooef_t WHERE rteaent = g_enterprise
         AND rtea001 = ooef001 AND ooefent=rteaent
         AND rtea001 = g_rteb_m.rteb001 AND rteastus='Y'
      IF l_cnt1 <= 0 THEN
         LET g_errno = "art-00214"
      ELSE
         LET l_cnt1=0
         SELECT count(*) INTO l_cnt1 FROM rtea_t,ooef_t WHERE rteaent = g_enterprise
            AND rtea001 = ooef001 AND ooefent=rteaent
            AND rtea001 = g_rteb_m.rteb001 AND ooefstus='Y'
         IF l_cnt1<=0 THEN
            LET g_errno = "aoo-00095"
         END IF         
      END IF       
   END IF   
END FUNCTION]]>
  </point>
  <point name="delete.head.m_delete" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[#      IF NOT s_aooi200_del_docno(g_rteb_m.rtebdocno,g_rteb_m.rtebdocdt) THEN CALL s_transaction_end('N','0') RETURN END IF]]>
  </point>
  <point name="fetch.action_control" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_rteb_m.rtebstus<>'N' THEN
      CALL cl_set_act_visible("modify,delete", FALSE)
   ELSE
      CALL cl_set_act_visible("modify,delete", TRUE)
   END IF]]>
  </point>
  <point name="fetch.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="global.variable" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[DEFINE g_ooef004             LIKE ooef_t.ooef004
DEFINE l_cmd                 STRING
DEFINE l_cnt                 LIKE type_t.num5]]>
  </point>
  <point name="init.init" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   CALL cl_set_combo_scc('b_rteb003','6017')]]>
  </point>
  <point name="input.a.rteb004" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL artt411_chk_rteb005()
            IF NOT cl_null(g_errno) THEN
               CALL cl_err(g_rteb_m.rteb004||'>'||g_rteb_m.rteb005,g_errno,1)
               LET g_rteb_m.rteb004 = g_rteb_m_t.rteb004
               NEXT FIELD rteb004
            END IF]]>
  </point>
  <point name="input.a.rteb005" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL artt411_chk_rteb005()
            IF NOT cl_null(g_errno) THEN
               CALL cl_err(g_rteb_m.rteb004||'>'||g_rteb_m.rteb005,g_errno,1)
               LET g_rteb_m.rteb005 = g_rteb_m_t.rteb005
               NEXT FIELD rteb005
            END IF ]]>
  </point>
  <point name="input.body.before_insert" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            CALL artt411_create_rtecseq()
            LET g_rtec_d[l_ac].rtecunit = g_rteb_m.rtebunit
            LET g_rtec_d[l_ac].rtecsite = g_rteb_m.rtebsite]]>
  </point>
  <point name="input.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE  l_count1         LIKE type_t.num5
   DEFINE  l_i1             LIKE type_t.num5
   DEFINE  l_rtec001        LIKE rtec_t.rtec001 
   DEFINE  l_rtec002        LIKE rtec_t.rtec002
   DEFINE  tok              base.stringtokenizer
   DEFINE  l_detail_cnt     LIKE type_t.num5
   DEFINE  l_max            LIKE type_t.num5]]>
  </point>
  <point name="input.head.b_insert" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[                  IF NOT cl_null(g_rteb_m.rtebdocno) THEN
                     CALL s_aooi200_gen_docno(g_rteb_m.rtebsite,g_rteb_m.rtebdocno,g_rteb_m.rtebdocdt)
                     RETURNING  g_success,g_rteb_m.rtebdocno
                     IF g_success<>'1' THEN
                        call cl_err(g_rteb_m.rtebdocno,"amm-00001",1)
                        NEXT FIELD rtebdocno
                     ELSE
                        IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM rteb_t WHERE "||"rtebent = '" ||g_enterprise|| "' AND "||"rtebdocno = '"||g_rteb_m.rtebdocno ||"'",'std-00004',1) THEN
                           let g_rteb_m.rtebdocno = g_rtebdocno_t
                           NEXT FIELD rtebdocno
                        END IF

                     END IF
                     LET g_rteb_m_t.rtebdocno = g_rteb_m.rtebdocno
                  END IF]]>
  </point>
  <point name="input.m.before_input" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[            IF l_cmd_t = 'r' THEN
            ELSE
               CALL artt411_set_entry(p_cmd)
               CALL artt411_set_no_entry(p_cmd)            
            END IF
            ]]>
  </point>
  <point name="insert.default" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      LET g_rteb_m.rtebunit =g_site
      LET g_rteb_m.rtebsite = g_rteb_m.rtebunit
      CALL artt411_rtebunit_ref()
      LET g_rteb_m.rtebdocdt = g_today
      LET g_rteb_m_t.* = g_rteb_m.*]]>
  </point>
  <point name="main.init" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   SELECT ooef004 INTO g_ooef004 FROM ooef_t WHERE ooefent = g_enterprise
      AND ooef001 = g_site]]>
  </point>
  <point name="menu.open_artt412" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[               SELECT COUNT(*) INTO l_cnt FROM rted_t WHERE rted001=g_rteb_m.rtebdocno
                  AND rtedent = g_enterprise
               IF l_cnt >0 THEN   
                  LET l_cmd = "artt412 '' "||"'"||g_rteb_m.rtebdocno||"'"
                  CALL cl_cmdrun_wait(l_cmd)
               ELSE
                  CALL cl_err(g_rteb_m.rtebdocno,"art-00217",1)
               END IF               ]]>
  </point>
  <point name="modify.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_rteb_m.rtebstus <> "N" THEN
      return    
   END IF]]>
  </point>
  <point name="reproduce.head.b_input" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET g_rteb_m.rtebstus = "N"
   LET g_rteb_m.rtebcnfid = ""
   LET g_rteb_m.rtebcnfdt = ""
   DISPLAY BY NAME g_rteb_m.rtebstus,g_rteb_m.rtebcnfid,g_rteb_m.rtebcnfdt]]>
  </point>
  <point name="set_entry.field_control" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      CALL cl_set_comp_entry("rtebdocdt",TRUE)]]>
  </point>
  <point name="set_no_entry.field_control" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      CALL cl_set_comp_entry("rtebdocdt",FALSE)  ]]>
  </point>
  <point name="show.after" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET l_cnt = g_rtec_d.getLength()
   DISPLAY l_cnt TO FORMONLY.cnt   ]]>
  </point>
  <point name="show.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_cnt     like type_t.num5]]>
  </point>
  <point name="statechange.a_update" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   SELECT rtebstus,rtebcnfid,rtebcnfdt,rtebmodid,rtebmoddt INTO g_rteb_m.rtebstus,g_rteb_m.rtebcnfid,g_rteb_m.rtebcnfdt,
                                                                g_rteb_m.rtebmodid,g_rteb_m.rtebmoddt  
     FROM rteb_t
    WHERE rtebent = g_enterprise AND rtebdocno = g_rteb_m.rtebdocno
   DISPLAY BY NAME g_rteb_m.rtebstus,g_rteb_m.rtebcnfid,g_rteb_m.rtebcnfdt,g_rteb_m.rtebmodid,g_rteb_m.rtebmoddt
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_rteb_m.rtebcnfid
   CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
   LET g_rteb_m.rtebcnfid_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_rteb_m.rtebcnfid_desc   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_rteb_m.rtebmodid
   CALL ap_ref_array2(g_ref_fields,"SELECT oofa011 FROM oofa_t WHERE oofaent='"||g_enterprise||"' AND oofa002='2' AND oofa003=? ","") RETURNING g_rtn_fields
   LET g_rteb_m.rtebmodid_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_rteb_m.rtebmodid_desc
   IF g_rteb_m.rtebstus <> "N" THEN
      CALL cl_set_act_visible("delete,modify", FALSE)
   ELSE
      CALL cl_set_act_visible("delete,modify", true)    
   END IF]]>
  </point>
  <point name="statechange.b_update" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   LET l_success = TRUE
   CASE lc_state 
      WHEN 'Y' 
         SELECT rtebstus INTO g_rteb_m.rtebstus FROM rteb_t WHERE rtebdocno = g_rteb_m.rtebdocno
            AND rtebent = g_enterprise         
         CALL s_artt411_conf_chk(g_rteb_m.rtebdocno,g_rteb_m.rtebstus) RETURNING l_success,g_errno
         IF l_success THEN
            IF cl_ask_confirm('lib-014') THEN
               CALL s_transaction_begin()
               CALL s_artt411_conf_upd(g_rteb_m.rtebdocno) RETURNING l_success
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL s_transaction_end('Y','1')   
               END IF
            ELSE
               RETURN
            END IF            
         ELSE
            CALL cl_err(g_rteb_m.rtebdocno,g_errno,1)
            RETURN            
         END IF
                
      WHEN 'X'
         SELECT rtebstus INTO g_rteb_m.rtebstus FROM rteb_t WHERE rtebdocno = g_rteb_m.rtebdocno
            AND rtebent = g_enterprise  
         CALL s_artt411_void_chk(g_rteb_m.rtebdocno,g_rteb_m.rtebstus) RETURNING l_success,g_errno
         IF l_success THEN
            IF cl_ask_confirm('lib-016') THEN
               CALL s_transaction_begin()
               CALL s_artt411_void_upd(g_rteb_m.rtebdocno) RETURNING l_success
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL s_transaction_end('Y','1')
               END IF
            ELSE
               RETURN
            END IF
         ELSE
            CALL cl_err(g_rteb_m.rtebdocno,g_errno,1)
            RETURN    
         END IF
      WHEN 'N'
         SELECT rtebstus INTO g_rteb_m.rtebstus FROM rteb_t WHERE rtebdocno = g_rteb_m.rtebdocno
            AND rtebent = g_enterprise 
         CALL s_artt411_unconf_chk(g_rteb_m.rtebdocno,g_rteb_m.rtebstus) RETURNING l_success,g_errno
         IF l_success THEN
            IF cl_ask_confirm('lib-015') THEN
               CALL s_transaction_begin()
               CALL s_artt411_unconf_upd(g_rteb_m.rtebdocno) RETURNING l_success
               IF NOT l_success THEN
                  CALL s_transaction_end('N','0')
                  RETURN
               ELSE
                  CALL s_transaction_end('Y','1')
               END IF
            ELSE
               RETURN
            END IF
         ELSE
            CALL cl_err(g_rteb_m.rtebdocno,g_errno,1)
            RETURN    
         END IF   
   END CASE]]>
  </point>
  <point name="statechange.before" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   IF g_rteb_m.rtebstus = 'X' THEN
      RETURN
   END IF]]>
  </point>
  <point name="statechange.before_menu" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[      CALL cl_set_act_visible("invalid,open,confirmed", true)
      IF g_rteb_m.rtebstus <> 'N' THEN
         CALL cl_set_act_visible("invalid", FALSE)
      ELSE
         CALL cl_set_act_visible("invalid", TRUE)
         CALL cl_set_act_visible("open", FALSE)      
      END IF
      IF g_rteb_m.rtebstus = 'Y' THEN
         CALL cl_set_act_visible("open", TRUE)
         CALL cl_set_act_visible("confirmed", FALSE)      
      END IF
      if g_rteb_m.rtebstus = 'X' then
         CALL cl_set_act_visible("invalid,open,confirmed", false)
      end if  ]]>
  </point>
  <point name="statechange.define" order="" ver="1" cite_std="N" cite_ver="" new="N" status="" src="s" mark_hard="N">
    <![CDATA[   DEFINE l_success like type_t.num5]]>
  </point>
</add_points>
