<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<spec prog="aapt400_04" std_prog="aapt400_04" erpver="1.0" ver="1" module="AAP" booking="Y" class="T" template="F002_00" env="s" zone="t10dev">
  <other>
    <code_template value="F" status=""/>
    <free_style value="N" status=""/>
  </other>
  <toolbar items=""/>
  <table ver="1" cite_std="N">
    <tbl name="apcc_t" main="Y" head="N" pk="" fk_detail="" parent="" fk_master="" src="s" status="">
      <sr name="s_detail1" src="s" insert="Y" delete="Y" append="Y" cascade="Y" kind="Table" status=""/>
    </tbl>
  </table>
  <all cite_std="N" ver="" src="" status=""/>
  <field cite_std="N" name="apca001" ver="1" src="s" column="apca001" table="apca_t" attribute="C002" type="varchar2(10)" req="Y" i_zoom="" c_zoom="" chk_ref="" items="" default="12" max="" min="" can_edit="Y" can_query="Y" widget="ComboBox" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apca005" ver="1" src="s" column="apca005" table="apca_t" attribute="C004" type="varchar2(10)" req="Y" i_zoom="q_pmac002_2" c_zoom="q_pmac002_2" chk_ref="" items="" default="EMPL" max="" min="" can_edit="Y" can_query="Y" widget="ButtonEdit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcb001" ver="1" src="s" column="apcb001" table="apcb_t" attribute="C203" type="varchar2(20)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="ComboBox" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcb002" ver="1" src="s" column="apcb002" table="apcb_t" attribute="C002" type="varchar2(10)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="ButtonEdit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcb028" ver="1" src="s" column="apcb028" table="apcb_t" attribute="C552" type="varchar2(20)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="ButtonEdit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcborga" ver="1" src="s" column="apcborga" table="apcb_t" attribute="C007" type="varchar2(10)" req="N" i_zoom="q_ooef001" c_zoom="q_ooef001" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="ButtonEdit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc004" ver="1" src="s" column="apcc004" table="apcc_t" attribute="D001" type="date()" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="DateEdit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc100" ver="1" src="s" column="apcc100" table="apcc_t" attribute="C008" type="varchar2(10)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="ButtonEdit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc108" ver="1" src="s" column="apcc108" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc109" ver="1" src="s" column="apcc109" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc118" ver="1" src="s" column="apcc118" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc128" ver="1" src="s" column="apcc128" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc138" ver="1" src="s" column="apcc138" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc_t.apcc001" ver="1" src="s" column="apcc001" table="apcc_t" attribute="N004" type="number(10,0)" req="Y" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc_t.apccdocno" ver="1" src="s" column="apccdocno" table="apcc_t" attribute="C203" type="varchar2(20)" req="Y" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc_t.apccld" ver="1" src="s" column="apccld" table="apcc_t" attribute="C501" type="varchar2(5)" req="Y" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="ButtonEdit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="apcc_t.apccseq" ver="1" src="s" column="apccseq" table="apcc_t" attribute="N004" type="number(10,0)" req="Y" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="chk" ver="1" src="s" column="chr1" table="type_t" attribute="T001" type="varchar2(1)" req="Y" i_zoom="" c_zoom="" chk_ref="" items=" " default="" max="" min="" can_edit="Y" can_query="Y" widget="CheckBox" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="sum_apcc1081" ver="1" src="s" column="apcc108" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="sum_apcc1082" ver="1" src="s" column="apcc108" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="sum_apcc1181" ver="1" src="s" column="apcc118" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="sum_apcc1182" ver="1" src="s" column="apcc118" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="sum_apcc128" ver="1" src="s" column="apcc128" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <field cite_std="N" name="sum_apcc138" ver="1" src="s" column="apcc138" table="apcc_t" attribute="N202" type="number(20,6)" req="N" i_zoom="" c_zoom="" chk_ref="" items="" default="" max="" min="" can_edit="Y" can_query="Y" widget="Edit" status="">
    <![CDATA[]]>
  </field>
  <prog_rel/>
  <ref_field/>
  <multi_lang/>
  <help_code>
    <hfield cite_std="N" ver="1" name="apca001" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apca005" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcb001" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcb002" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcb028" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcborga" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc004" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc100" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc108" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc109" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc118" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc128" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc138" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc_t.apcc001" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc_t.apccdocno" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc_t.apccld" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="apcc_t.apccseq" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="chk" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="sum_apcc1081" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="sum_apcc1082" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="sum_apcc1181" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="sum_apcc1182" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="sum_apcc128" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
    <hfield cite_std="N" ver="1" name="sum_apcc138" src="s" help_table="" help_find="" help_dlang="" help_field="" help_wc="" mapping_widget="" status=""/>
  </help_code>
  <act cite_std="N" id="delete" ver="1" src="s" type="all" gen_code="Y" status="">
    <![CDATA[]]>
  </act>
  <act cite_std="N" id="insert" ver="1" src="s" type="all" gen_code="Y" status="">
    <![CDATA[]]>
  </act>
  <act cite_std="N" id="modify" ver="1" src="s" type="all" gen_code="Y" status="">
    <![CDATA[]]>
  </act>
  <act cite_std="N" id="output" ver="1" src="s" type="all" gen_code="Y" status="">
    <![CDATA[]]>
  </act>
  <act cite_std="N" id="query" ver="1" src="s" type="all" gen_code="Y" status="">
    <![CDATA[]]>
  </act>
  <act cite_std="N" id="reproduce" ver="1" src="s" type="all" gen_code="Y" status="">
    <![CDATA[]]>
  </act>
  <strings>
    <sfield name="lbl_chk" text="選擇" lstr=""/>
    <sfield name="lbl_apcborga" text="來源組織" lstr=""/>
    <sfield name="lbl_apcb001" text="來源類型" lstr=""/>
    <sfield name="lbl_apcb002" text="交易單據" lstr=""/>
    <sfield name="lbl_apcb028" text="發票號碼" lstr=""/>
    <sfield name="lbl_apcc001" text="期別" lstr=""/>
    <sfield name="lbl_apcc004" text="應到期日" lstr=""/>
    <sfield name="lbl_apcc100" text="交易幣別" lstr=""/>
    <sfield name="lbl_apcc1081" text="原幣未請款金額" lstr=""/>
    <sfield name="lbl_apcc118" text="本幣未請款金額" lstr=""/>
    <sfield name="lbl_apcc128" text="本位幣二未請款金額" lstr=""/>
    <sfield name="lbl_apcc138" text="本位幣三未請款金額" lstr=""/>
    <sfield name="lbl_apcc109" text="預沖未確認額" lstr=""/>
    <sfield name="lbl_apca001" text="帳款單性質" lstr=""/>
    <sfield name="lbl_apccdocno" text="應付帳款單號碼" lstr=""/>
    <sfield name="lbl_apca005" text="付款對象" lstr=""/>
    <sfield name="lbl_apccld" text="帳別" lstr=""/>
    <sfield name="lbl_apccseq" text="項次" lstr=""/>
    <sfield name="lbl_group_4" text="列示帳款未請款總額" lstr=""/>
    <sfield name="lbl_sum_apcc1081" text="原幣金額" lstr=""/>
    <sfield name="lbl_sum_apcc1181" text="本幣金額" lstr=""/>
    <sfield name="lbl_group_3" text="選取請款總額" lstr=""/>
    <sfield name="lbl_sum_apcc1082" text="原幣金額" lstr=""/>
    <sfield name="lbl_sum_apcc1182" text="本幣金額" lstr=""/>
    <sfield name="lbl_group_2" text="其他本位幣選取金額" lstr=""/>
    <sfield name="lbl_sum_apcc128" text="本位幣二金額" lstr=""/>
    <sfield name="lbl_sum_apcc138" text="本位幣三金額" lstr=""/>
    <sfield name="lbl_dbegin" text="第" lstr=""/>
    <sfield name="lbl_dsep" text="項(共" lstr=""/>
    <sfield name="lbl_dend" text="項)" lstr=""/>
    <sact name="delete" text="刪除" lstr=""/>
    <sact name="insert" text="新增" lstr=""/>
    <sact name="modify" text="更改" lstr=""/>
    <sact name="output" text="列印" lstr=""/>
    <sact name="query" text="查詢" lstr=""/>
    <sact name="reproduce" text="複製" lstr=""/>
  </strings>
  <sa_spec>
    <sa_field name="PanelRole1">
      <![CDATA[。符合條件之＂未沖金額＂計算後的合計值。故若有重新ＱＢＥ，則應重新計算顯示合計值。
。原幣不考慮幣別不同之問題。
。　。SCC_8506. gzcb004 判別金額加減項， 'C'為正項金額/ 'D'為負項金額。

]]>
    </sa_field>
    <sa_field name="PanelRole2">
      <![CDATA[。勾選時，合計勾選資料之＂未沖金額＂合計值。
。原幣不考慮幣別不同之問題
。依帳款單性質決定金額的加、減項判別。
 。帳款單性質link SCC設定檔 取參考欄位二gzcb004
	xrca001=gzcb002 AND gzcb001='8506'
 。SCC_8506. gzcb004 判別金額加減項， 'C'為正項金額/ 'D'為負項金額。
]]>
    </sa_field>
    <sa_field name="PanelRole4">
      <![CDATA[。該帳別有啟用＂其他本位幣＂功能者，才須顯示。
。勾選時，合計已勾選資料之＂未沖金額＂合計值。

]]>
    </sa_field>
    <sa_field name="TextFieldRole5">
      <![CDATA[.sum(本位幣二未沖金額) where 選取='Y'
]]>
    </sa_field>
    <sa_field name="TextFieldRole6">
      <![CDATA[.sum(本位幣三未沖金額) where 選取='Y'
]]>
    </sa_field>
    <sa_all name="ALL">
      <![CDATA[●aapt400_04(可請款單據查詢)
　開窗查詢及挑選，可請款之已立帳交易單資料。
　依交易單據彙總顯示。

接收參數：
	。帳套別
	。帳務中心
	。核銷對象　：apda0006
	。收付款對象：apda005
	。帳務中心　：可空白，表不限制
	。來源類型　：可空白，表不限制
	。表單性質：０不限制　'1'表立帳方單　'2'表立帳待抵單

。表單性質：依單別取對應"SCC_8506應付立帳類帳款單性質"設定之gzcb004
。開窗挑選，回傳勾選後之[單據號碼]ＫＥＹ值資料。
   1.首次開窗時，即顯示符合傳入參數條件之資料。
　 2.重新查詢時，提供對應資料的開窗或下拉處理。
。選取時，加總金額勾選之金額，合計數下方表達。
。傳回符合勾選之資料。
。子作業　04、05　可考慮合併成一支子作業來寫，　差異只在於 grou方式不同（依項次合併金額否)。
。寫入　沖帳明細檔(apce_t)
   1.寫入沖銷檔apce_t時，參數為非明細項沖帳者，則不折解至明細項次，故項次寫入'0'（[參考單號項次apce025]、[沖帳帳款項次apce004]）。
　 2.檢核可沖銷金額apce109 apce119。



============================================================================================
資料來源：
	多帳期明細(apcc_t)
		WHERE apcc108-apcc109 > 0
	應付憑單單身(xrcb_t)
	　　link條件：　帳套　AND 帳款單號apccdocno=xrcbdocno ＡＮＤ　單身項次apccseq=xrcbseq
	應付帳款單單頭(apca_t)
	    link條件：　帳套　AND 單號apccdocno=apcadocno　ＡＮＤ　帳款客戶.apca005=付款對象apda005
		 　 AND　已確認單　AND　單據日期<= 沖銷單日期.apdadocdt
		　　AND  帳款單性質apca001=參數(０不限制　'1'表立帳方單=1*　'2'表立帳待抵單=2*)

           。GROUP 單身交易單號+應付帳款單號+多帳期期別  : xrcb002 + apccdocno + apcc001


●欄位說明：
   1.首次開窗時，即顯示符合傳入參數條件之資料。
　 2.重新查詢時，提供對應資料的開窗或下拉處理。

。選取check：　checkbox, 選取時合計金額寫入"選取合計數"。
。來源組織apcborga：
	。開窗:帳務中心開窗,即單頭apdasite下之組織範圍, 取"現行執行版本"者。
。來源類型apcb001：下拉選項
	。下拉選項:   　　scc =24 where gzcb005參考欄位內容有設定'aapt3'字段者。 
。交易單號apcb002：
	。可開窗（q_apca002）
。發票號碼apcb028：
	。可開窗（q_apcb028 己立帳進項發票查詢）
	  發票代碼 發票號碼 發票幣別 發票總額     未請款金額
              ------- --------- -------- ----------- ----------
              apcb027  apcb028  apcb100  isam025      sum(apcc108-apcc109)
	條件: 立帳單身進項發票號碼串進項發票檔(isam_t) 且有未請款金額者apcc108-apcc109 > 0
	  SELECT apcb027,apcb028,apcb100,isam025,sum(apcc109)
	    FROM apcb_t, apcc_t,isam_t
	   WHERE -ENT-  AND apcbdocno=apccdocno AND apcbld=apccld AND apcbdocno=isamdocno
                     AND apcc108-apcc109>0
	         AND apcb028=isam010
	    GROUP BY apcb027,apcb028,apcb100,isam025
。付款對象apca005：
	。可開窗；
	　查詢核銷對象所指定的＂夥伴關係檔案（）＂
　            select pmac003,pmac002，客商名稱，pmac004 from pmac_t  
               where pmac001 = 付款對象apda005 
  　　               and status='Y'
。未沖金額（原幣、本幣、其他本位幣）：
　。取多帳期檔案的立帳金額，扣除已請款金額，並且須扣除"預沖未確認額"。
  。預沖未確認額(nn)=合計該筆帳款單，於請款單作業且尚未確認者(非作廢單)，同項次者。
	(n1)= sum(apce109)
	(n2)= sum(apce119)
	(n3)= sum(apce129)
	(n4)= sum(apce139)
　　1.依帳套別各自取，
    2.合計：AP沖銷檔apce_t 、AR沖銷檔案xrce_t 
      SELECT sum(apce109).....
        FROM apce_t
       WHERE apceLD=帳款單.apccLD AND apce003=帳款單.apccdocno AND apce004=帳款單.apccseq AND apce005=帳款單.apcc001

      SELECT sum(xrce109).....
        FROM xrce_t
       WHERE xrceLD=帳款單.apccLD AND xrce003=帳款單.apccdocno AND xrce004=帳款單.apccseq AND xrce005=帳款單.apcc001
　　

。其他本位幣：
	。視該帳有無啟用其他本位幣，有啟用才顯示。
	。欄位抬頭依啟用之幣別顯示，取glaa???/glaa???；Ｅx. 名稱顯示：（ＵＳＤ）未沖金額、（ＣＮＹ）未沖金額
]]>
    </sa_all>
  </sa_spec>
  <exclude ver="" cite_std="N" src=""/>
</spec>
