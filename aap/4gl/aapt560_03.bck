#該程式未解開Section, 採用最新樣板產出!
{<section id="aapt560_03.description" >}
#應用 a00 樣板自動產生(Version:3)
#+ Standard Version.....: SD版次:0013(2016-06-21 19:22:02), PR版次:0013(2017-02-20 10:14:22)
#+ Customerized Version.: SD版次:0000(1900-01-01 00:00:00), PR版次:0000(1900-01-01 00:00:00)
#+ Build......: 000052
#+ Filename...: aapt560_03
#+ Description: 信用狀作業產生帳務單
#+ Creator....: 03080(2016-06-21 19:20:34)
#+ Modifier...: 03080 -SD/PR- 05634
 
{</section>}
 
{<section id="aapt560_03.global" >}
#應用 c01b 樣板自動產生(Version:10)
#add-point:填寫註解說明 name="global.memo"
#161018-00036#1  2016/10/24 By dorishsu  修正aapt560_03_ins_ap_4()函式,apcb113/apcb115/apcb123/apcb133依幣別取位
#161006-00005#30 2016/10/28 By 08732     組織類型與職能開窗調整
#161108-00017#4  2016/11/09 By Reanna    程式中INSERT INTO 有星號作整批調整
#161104-00024#5  2016/11/10 By 08729     處理DEFINE有星號
#161208-00026#13 2016/12/13 By 08729     針對SELECT有星號的部分進行展開
#161129-00042#1  2016/12/20 By 08729     增加營利事業統一編號檢查
#161104-00046#7  2016/01/04 By 08171     單別預設值;資料依照單別user dept權限過濾單號
#161228-00062#1  2016/01/04 By 00768     修改小数取位问题
#161226-00052#1  2016/01/04 By 00768     汇率取值错误修正
#161230-00036#1  2017/01/09 By 08729     將統一編號檢核移至insert isam_t以前，當統編為非必要輸入時不進行檢核。
#160428-00001#8  2017/01/21 By 05016     費用代碼放到理由碼apcb014 欄位
#170218-00012#1  2017/02/18 By dorishsu  統一編號不為null再做檢查
#end add-point
#add-point:填寫註解說明(客製用) name="global.memo_customerization"

#end add-point
 
IMPORT os
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目 name="global.import"
IMPORT util
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔 name="global.inc" name="global.inc"

#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_apca_m        RECORD
       apcald LIKE apca_t.apcald, 
   apcasite LIKE apca_t.apcasite, 
   apcasite_desc LIKE type_t.chr80, 
   apcacomp LIKE apca_t.apcacomp, 
   apcacomp_desc LIKE type_t.chr80, 
   apcadocno LIKE apca_t.apcadocno, 
   apcadocdt LIKE apca_t.apcadocdt, 
   apca003 LIKE apca_t.apca003, 
   apca003_desc LIKE type_t.chr80, 
   apca016 LIKE apca_t.apca016, 
   apca018 LIKE apca_t.apca018, 
   apca064 LIKE apca_t.apca064
       END RECORD
	   
#add-point:自定義模組變數(Module Variable)(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="global.variable"
DEFINE g_apcacomp   LIKE apca_t.apcacomp
#161104-00046#7 --s add
DEFINE g_user_slip_wc   STRING
#161104-00046#7 --e add
#end add-point
 
DEFINE g_apca_m        type_g_apca_m
 
   DEFINE g_apcald_t LIKE apca_t.apcald
DEFINE g_apcadocno_t LIKE apca_t.apcadocno
 
 
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
 
#add-point:自定義客戶專用模組變數(Module Variable) name="global.variable_customerization"

#end add-point
 
#add-point:傳入參數說明(global.argv) name="global.argv"
 
#end add-point
 
{</section>}
 
{<section id="aapt560_03.input" >}
#+ 資料輸入
PUBLIC FUNCTION aapt560_03(--)
   #add-point:input段變數傳入 name="input.get_var"
   p_lsjs
   #end add-point
   )
   #add-point:input段define name="input.define_customerization"
   
   #end add-point
   DEFINE l_ac_t          LIKE type_t.num10       #未取消的ARRAY CNT 
   DEFINE l_allow_insert  LIKE type_t.num5        #可新增否 
   DEFINE l_allow_delete  LIKE type_t.num5        #可刪除否  
   DEFINE l_count         LIKE type_t.num10
   DEFINE l_insert        LIKE type_t.num5
   DEFINE p_cmd           LIKE type_t.chr5
   #add-point:input段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="input.define"
   DEFINE p_lsjs          STRING
   DEFINE l_comp          LIKE ooef_t.ooef001
   DEFINE l_glaa024       LIKE glaa_t.glaa024
   DEFINE r_docno         LIKE apca_t.apcadocno
   DEFINE r_success       LIKE type_t.num5
   DEFINE l_flag          LIKE type_t.num5 #161104-00046#7
   #end add-point
   
   #畫面開啟 (identifier)
   OPEN WINDOW w_aapt560_03 WITH FORM cl_ap_formpath("aap","aapt560_03")
 
   #瀏覽頁簽資料初始化
   CALL cl_ui_init()
   
   LET g_qryparam.state = "i"
   LET p_cmd = 'a'
   
   #輸入前處理
   #add-point:單頭前置處理 name="input.pre_input"
   LET r_success = TRUE
   LET r_docno = NULL
   INITIALIZE g_apca_m.* TO NULL
   
   LET l_comp = NULL
   SELECT ooef017 INTO l_comp FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = g_site
   SELECT glaald INTO g_apca_m.apcald
     FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaacomp = l_comp
      AND glaa014 = 'Y'

   CALL cl_set_combo_scc_part('apca016','8548','31,32,33,34,35,36')   #來源作業類型
   LET g_apca_m.apcadocdt = g_today
   LET g_apca_m.apca003 = g_user
   LEt g_apca_m.apca064 = 0
   CALL s_aap_get_default_apcasite('1','','') RETURNING g_sub_success,g_errno,g_apca_m.apcasite,g_apca_m.apcald,g_apca_m.apcacomp
   LET g_apcacomp = g_apca_m.apcacomp
   
   CALL s_desc_get_department_desc(g_apca_m.apcasite) RETURNING g_apca_m.apcasite_desc    #albrieo 160729
   CALL s_desc_get_department_desc(g_apca_m.apcacomp) RETURNING g_apca_m.apcacomp_desc    #albireo 160729
   DISPLAY BY NAME g_apca_m.apcasite_desc,g_apca_m.apcacomp_desc                          #albireo 160729
   #161104-00046#7 --s add
   CALL s_control_get_docno_sql(g_user,g_dept) RETURNING g_sub_success,g_user_slip_wc  
   #161104-00046#7 --e add
   #end add-point
  
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
      #輸入開始
      INPUT BY NAME g_apca_m.apcald,g_apca_m.apcasite,g_apca_m.apcacomp,g_apca_m.apcadocno,g_apca_m.apcadocdt, 
          g_apca_m.apca003,g_apca_m.apca016,g_apca_m.apca018,g_apca_m.apca064 ATTRIBUTE(WITHOUT DEFAULTS) 
 
         
         #自訂ACTION
         #add-point:單頭前置處理 name="input.action"
         
         #end add-point
         
         #自訂ACTION(master_input)
         
         
         BEFORE INPUT
            #add-point:單頭輸入前處理 name="input.before_input"
            
            #end add-point
          
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apcald
            #add-point:BEFORE FIELD apcald name="input.b.apcald"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apcald
            
            #add-point:AFTER FIELD apcald name="input.a.apcald"
            #應用 a05 樣板自動產生(Version:3)
            #確認資料無重複
            IF  NOT cl_null(g_apca_m.apcald) AND NOT cl_null(g_apca_m.apcadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_apca_m.apcald != g_apcald_t  OR g_apca_m.apcadocno != g_apcadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM apca_t WHERE "||"apcaent = '" ||g_enterprise|| "' AND "||"apcald = '"||g_apca_m.apcald ||"' AND "|| "apcadocno = '"||g_apca_m.apcadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF




            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apcald
            #add-point:ON CHANGE apcald name="input.g.apcald"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apcasite
            
            #add-point:AFTER FIELD apcasite name="input.a.apcasite"
            IF NOT cl_null(g_apca_m.apcasite)THEN
               CALL s_fin_account_center_with_ld_chk(g_apca_m.apcasite,'',g_user,'3','N','',g_today) RETURNING g_sub_success,g_errno
               IF NOT g_sub_success THEN
                  INITIALIZE g_errparam.* TO NULL
                  LET g_errparam.code = g_errno
                  LET g_errparam.extend = ''
                  LET g_errparam.popup = TRUE
                  CALL cl_err()
                  LET g_apca_m.apcasite = ''
                  LET g_apca_m.apcasite_desc = ''
                  LET g_apca_m.apcacomp = ''
                  LET g_apca_m.apcacomp_desc = ''
                  DISPLAY BY NAME g_apca_m.apcasite   ,g_apca_m.apcasite_desc,g_apca_m.apcacomp,g_apca_m.apcacomp_desc
                  NEXT FIELD apcasite
               END IF
               CALL s_fin_orga_get_comp_ld(g_apca_m.apcasite) RETURNING g_sub_success,g_errno,g_apca_m.apcacomp,g_apca_m.apcald
               LET g_apcacomp = g_apca_m.apcacomp
               CALL s_desc_get_department_desc(g_apca_m.apcacomp) RETURNING g_apca_m.apcacomp_desc
               DISPLAY BY NAME g_apca_m.apcacomp_desc,g_apca_m.apcacomp
            END IF
            CALL s_desc_get_department_desc(g_apca_m.apcasite) RETURNING g_apca_m.apcasite_desc
            DISPLAY BY NAME g_apca_m.apcacomp_desc,g_apca_m.apcacomp
            DISPLAY BY NAME g_apca_m.apcasite_desc,g_apca_m.apcasite   #albireo 160729
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apcasite
            #add-point:BEFORE FIELD apcasite name="input.b.apcasite"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apcasite
            #add-point:ON CHANGE apcasite name="input.g.apcasite"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apcacomp
            
            #add-point:AFTER FIELD apcacomp name="input.a.apcacomp"


            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apcacomp
            #add-point:BEFORE FIELD apcacomp name="input.b.apcacomp"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apcacomp
            #add-point:ON CHANGE apcacomp name="input.g.apcacomp"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apcadocno
            #add-point:BEFORE FIELD apcadocno name="input.b.apcadocno"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apcadocno
            
            #add-point:AFTER FIELD apcadocno name="input.a.apcadocno"
            #應用 a05 樣板自動產生(Version:3)
            #確認資料無重複
            IF NOT cl_null(g_apca_m.apcald) AND NOT cl_null(g_apca_m.apcadocno) THEN 
               IF p_cmd = 'a' OR ( p_cmd = 'u' AND (g_apca_m.apcald != g_apcald_t  OR g_apca_m.apcadocno != g_apcadocno_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM apca_t WHERE "||"apcaent = '" ||g_enterprise|| "' AND "||"apcald = '"||g_apca_m.apcald ||"' AND "|| "apcadocno = '"||g_apca_m.apcadocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
               CALL s_aooi200_fin_chk_slip(g_apca_m.apcald,'',g_apca_m.apcadocno,'aapt560')
                  RETURNING g_sub_success
               IF NOT g_sub_success THEN
                  LET g_apca_m.apcadocno = ''
                  DISPLAY BY NAME g_apca_m.apcadocno
                  NEXT FIELD apcadocno
               END IF
               #161104-00046#7 --s add
               CALL s_control_chk_doc('1',g_apca_m.apcadocno,'4',g_user,g_dept,'','') RETURNING g_sub_success,l_flag
               IF g_sub_success AND l_flag THEN             
               ELSE
                  LET g_apca_m.apcadocno = ''
                  NEXT FIELD CURRENT                
               END IF
               #161104-00046#7 --e add 
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apcadocno
            #add-point:ON CHANGE apcadocno name="input.g.apcadocno"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apcadocdt
            #add-point:BEFORE FIELD apcadocdt name="input.b.apcadocdt"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apcadocdt
            
            #add-point:AFTER FIELD apcadocdt name="input.a.apcadocdt"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apcadocdt
            #add-point:ON CHANGE apcadocdt name="input.g.apcadocdt"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apca003
            
            #add-point:AFTER FIELD apca003 name="input.a.apca003"

            IF NOT cl_null(g_apca_m.apca003)THEN
               LET g_errno = ''
               CALL s_employee_chk(g_apca_m.apca003) RETURNING g_sub_success
               IF NOT g_sub_success THEN
                  LET g_apca_m.apca003 = ''
                  LET g_apca_m.apca003_desc = ''
                  DISPLAY BY NAME g_apca_m.apca003,g_apca_m.apca003_desc
                  NEXT FIELD CURRENT
               END IF
            END IF
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_apca_m.apca003
            CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
            LET g_apca_m.apca003_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_apca_m.apca003_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apca003
            #add-point:BEFORE FIELD apca003 name="input.b.apca003"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apca003
            #add-point:ON CHANGE apca003 name="input.g.apca003"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apca016
            #add-point:BEFORE FIELD apca016 name="input.b.apca016"
            CALL cl_set_comp_entry('apca064',TRUE)
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apca016
            
            #add-point:AFTER FIELD apca016 name="input.a.apca016"
            IF g_apca_m.apca016 <> '32' THEN
               CALL cl_set_comp_entry('apca064',FALSE)
            ELSE
               LET g_apca_m.apca018 = NULL
               LET g_apca_m.apca064 = NULL
               DISPLAY BY NAME g_apca_m.apca018,g_apca_m.apca064
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apca016
            #add-point:ON CHANGE apca016 name="input.g.apca016"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apca018
            #add-point:BEFORE FIELD apca018 name="input.b.apca018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apca018
            
            #add-point:AFTER FIELD apca018 name="input.a.apca018"
            IF NOT cl_null(g_apca_m.apca018)THEN
               IF NOT cl_null(g_apca_m.apca018)THEN
                  IF g_apca_m.apca016 <> '32' OR (g_apca_m.apca016 = '32' AND NOT cl_null(g_apca_m.apca064))THEN
                     CALL aapt560_03_apca018_chk()RETURNING g_sub_success,g_errno 
                     IF NOT g_sub_success THEN
                        INITIALIZE g_errparam.* TO NULL
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        LET g_errparam.code = g_errno
                        CALL cl_err()
                        LET g_apca_m.apca018 = NULL
                        DISPLAY BY NAME g_apca_m.apca018
                        NEXT FIELD apca018
                     END IF
                  END IF
               END IF
               
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apca018
            #add-point:ON CHANGE apca018 name="input.g.apca018"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD apca064
            #add-point:BEFORE FIELD apca064 name="input.b.apca064"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD apca064
            
            #add-point:AFTER FIELD apca064 name="input.a.apca064"
            IF NOT cl_null(g_apca_m.apca064)THEN
               IF NOT cl_null(g_apca_m.apca064)THEN
                  CALL aapt560_03_apca018_chk()RETURNING g_sub_success,g_errno 
                  IF NOT g_sub_success THEN
                     INITIALIZE g_errparam.* TO NULL
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     LET g_errparam.code = g_errno
                     CALL cl_err()
                     LET g_apca_m.apca064= NULL
                     DISPLAY BY NAME g_apca_m.apca064
                     NEXT FIELD apca064
                  END IF
               END IF               
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE apca064
            #add-point:ON CHANGE apca064 name="input.g.apca064"
            
            #END add-point 
 
 
 #欄位檢查
                  #Ctrlp:input.c.apcald
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apcald
            #add-point:ON ACTION controlp INFIELD apcald name="input.c.apcald"
            #應用 a07 樣板自動產生(Version:3)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
 
            LET g_qryparam.default1 = g_apca_m.apcald             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s
            LET g_qryparam.arg2 = "" #s
 
            CALL q_authorised_ld()                                #呼叫開窗
 
            LET g_apca_m.apcald = g_qryparam.return1              

            DISPLAY g_apca_m.apcald TO apcald              #

            NEXT FIELD apcald                          #返回原欄位



            #END add-point
 
 
         #Ctrlp:input.c.apcasite
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apcasite
            #add-point:ON ACTION controlp INFIELD apcasite name="input.c.apcasite"
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_apca_m.apcasite       
            #LET g_qryparam.where = " ooef204 = 'Y' "   #161006-00005#30   mark 
            #CALL q_ooef001()     #161006-00005#30   mark     
            CALL q_ooef001_46()   #161006-00005#30   add     
            LET g_apca_m.apcasite = g_qryparam.return1        
            DISPLAY BY NAME g_apca_m.apcasite
            NEXT FIELD apcasite                  
            #END add-point
 
 
         #Ctrlp:input.c.apcacomp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apcacomp
            #add-point:ON ACTION controlp INFIELD apcacomp name="input.c.apcacomp"
            #應用 a07 樣板自動產生(Version:3)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
 
            LET g_qryparam.default1 = g_apca_m.apcacomp             #給予default值
            LET g_qryparam.default2 = "" #g_apca_m.ooef001 #组织编号
            #給予arg
            LET g_qryparam.arg1 = "" #s

 
            CALL q_ooef001()                                #呼叫開窗
 
            LET g_apca_m.apcacomp = g_qryparam.return1              
            #LET g_apca_m.ooef001 = g_qryparam.return2 
            DISPLAY g_apca_m.apcacomp TO apcacomp              #
            #DISPLAY g_apca_m.ooef001 TO ooef001 #组织编号
            NEXT FIELD apcacomp                          #返回原欄位



            #END add-point
 
 
         #Ctrlp:input.c.apcadocno
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apcadocno
            #add-point:ON ACTION controlp INFIELD apcadocno name="input.c.apcadocno"
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_apca_m.apcadocno
            LET l_glaa024 = NULL
            SELECT glaa024 INTO l_glaa024 FROM glaa_t
             WHERE glaaent = g_enterprise
               AND glaald = g_apca_m.apcald
            LET g_qryparam.arg1 = l_glaa024
            LET g_qryparam.arg2 = g_prog
            #161104-00046#7 --s add
            IF NOT cl_null(g_user_slip_wc)THEN
               LET g_qryparam.where = g_user_slip_wc 
            END IF
            #161104-00046#7 --e add
            CALL q_ooba002_1()
            LET g_apca_m.apcadocno = g_qryparam.return1
            DISPLAY BY NAME g_apca_m.apcadocno
            NEXT FIELD apcadocno
            #END add-point
 
 
         #Ctrlp:input.c.apcadocdt
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apcadocdt
            #add-point:ON ACTION controlp INFIELD apcadocdt name="input.c.apcadocdt"
            
            #END add-point
 
 
         #Ctrlp:input.c.apca003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apca003
            #add-point:ON ACTION controlp INFIELD apca003 name="input.c.apca003"
            #應用 a07 樣板自動產生(Version:3)   
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
 
            LET g_qryparam.default1 = g_apca_m.apca003             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #s

 
            CALL q_ooag001()                                #呼叫開窗
 
            LET g_apca_m.apca003 = g_qryparam.return1              

            DISPLAY g_apca_m.apca003 TO apca003              #

            NEXT FIELD apca003                          #返回原欄位



            #END add-point
 
 
         #Ctrlp:input.c.apca016
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apca016
            #add-point:ON ACTION controlp INFIELD apca016 name="input.c.apca016"
            
            #END add-point
 
 
         #Ctrlp:input.c.apca018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apca018
            #add-point:ON ACTION controlp INFIELD apca018 name="input.c.apca018"
            CASE
               WHEN g_apca_m.apca016 = '31'
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
			         LET g_qryparam.reqry = FALSE
                  LET g_qryparam.default1 = g_apca_m.apca018  
                  LET g_qryparam.where = "apgacomp = '",g_apca_m.apcacomp,"' AND apgastus = 'Y' " ,
                                         #160824-00049#7-----s
                                         " AND NOT EXISTS(SELECT 1 FROM apca_t WHERE apcaent = apgaent AND apca016 = '31' AND apca018 = apgadocno AND apcastus <> 'X') "
                                         #160824-00049#7-----e                                         
                  CALL q_apgadocno()
                  LET g_apca_m.apca018 = g_qryparam.return1
                  DISPLAY BY NAME g_apca_m.apca018 
                  NEXT FIELD apca018                  
               WHEN g_apca_m.apca016 = '32'
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
			         LET g_qryparam.reqry = FALSE
                  LET g_qryparam.default1 = g_apca_m.apca018 
                                         #160824-00049#7-----s                  
                  #LET g_qryparam.where = #" EXISTS (SELECT 1 FROM apgd_t WHERE apgdent = apgaent AND apgddocno = apgadocno AND apgdcomp = apgdcomp) ",   #160824-00049#7
                                         #" AND apgacomp = '",g_apca_m.apcacomp,"' ",
                  LET g_qryparam.where = " apgdcomp = '",g_apca_m.apcacomp,"' AND apgdstus = 'Y' ",
                                         " AND NOT EXISTS(SELECT 1 FROM apca_t WHERE apcaent = apgdent AND apca016 = '32' AND apca018 = apgddocno AND apca064 = apgd900 AND apcastus <> 'X') "
                                         #160824-00049#7-----e
                  CALL q_apgddocno()
                  LET g_apca_m.apca018 = g_qryparam.return1
                  LET g_apca_m.apca064 = g_qryparam.return2
                  DISPLAY BY NAME g_apca_m.apca018 ,g_apca_m.apca064
                  NEXT FIELD apca018  
               WHEN g_apca_m.apca016 = '33'
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
			         LET g_qryparam.reqry = FALSE
                  LET g_qryparam.default1 = g_apca_m.apca018     
                  LET g_qryparam.where = "apgicomp = '",g_apca_m.apcacomp,"' AND apgistus = 'Y' ",
                                         #160824-00049#7-----s
                                         " AND NOT EXISTS(SELECT 1 FROM apca_t WHERE apcaent = apgient AND apca016 = '33' AND apca018 = apgidocno AND apcastus <> 'X') "
                                         #160824-00049#7-----e                  
                  CALL q_apgidocno()
                  LET g_apca_m.apca018 = g_qryparam.return1
                  DISPLAY BY NAME g_apca_m.apca018 
                  NEXT FIELD apca018                    
               WHEN g_apca_m.apca016 = '34'
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
			         LET g_qryparam.reqry = FALSE
                  LET g_qryparam.default1 = g_apca_m.apca018     
                  LET g_qryparam.where = "apgkcomp = '",g_apca_m.apcacomp,"' AND apgkstus = 'Y' ",
                                         #160824-00049#7-----s
                                         " AND NOT EXISTS(SELECT 1 FROM apca_t WHERE apcaent = apgkent AND apca016 = '34' AND apca018 = apgkdocno AND apcastus <> 'X') "
                                         #160824-00049#7-----e
                  CALL q_apgkdocno()
                  LET g_apca_m.apca018 = g_qryparam.return1
                  DISPLAY BY NAME g_apca_m.apca018 
                  NEXT FIELD apca018    
               WHEN g_apca_m.apca016 = '35'
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
			         LET g_qryparam.reqry = FALSE
                  LET g_qryparam.default1 = g_apca_m.apca018     
                  LET g_qryparam.where = "apglcomp = '",g_apca_m.apcacomp,"' AND apglstus = 'Y' ",
                                         #160824-00049#7-----s
                                         " AND NOT EXISTS(SELECT 1 FROM apca_t WHERE apcaent = apglent AND apca016 = '35' AND apca018 = apgldocno AND apcastus <> 'X') "
                                         #160824-00049#7-----e
                  CALL q_apgldocno()
                  LET g_apca_m.apca018 = g_qryparam.return1
                  DISPLAY BY NAME g_apca_m.apca018 
                  NEXT FIELD apca018    
               WHEN g_apca_m.apca016 = '36'               
                  INITIALIZE g_qryparam.* TO NULL
                  LET g_qryparam.state = 'i'
			         LET g_qryparam.reqry = FALSE
                  LET g_qryparam.default1 = g_apca_m.apca018     
                  LET g_qryparam.where = "apgncomp = '",g_apca_m.apcacomp,"' AND apgnstus = 'Y' ",
                                         #160824-00049#7-----s
                                         " AND NOT EXISTS(SELECT 1 FROM apca_t WHERE apcaent = apgnent AND apca016 = '36' AND apca018 = apgndocno AND apcastus <> 'X') "
                                         #160824-00049#7-----e
                  CALL q_apgndocno_2()
                  LET g_apca_m.apca018 = g_qryparam.return1
                  DISPLAY BY NAME g_apca_m.apca018 
                  NEXT FIELD apca018                
               OTHERWISE
            END CASE
            
            #END add-point
 
 
         #Ctrlp:input.c.apca064
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD apca064
            #add-point:ON ACTION controlp INFIELD apca064 name="input.c.apca064"
            
            #END add-point
 
 
 #欄位開窗
 
         AFTER INPUT
            #add-point:單頭輸入後處理 name="input.after_input"
            
            #end add-point
            
      END INPUT
    
      #add-point:自定義input name="input.more_input"
      
      #end add-point
    
      #公用action
      ON ACTION accept
         ACCEPT DIALOG
        
      ON ACTION cancel
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
   END DIALOG
 
   #add-point:畫面關閉前 name="input.before_close"
   
   #end add-point
   
   #畫面關閉
   CLOSE WINDOW w_aapt560_03 
   
   #add-point:input段after input name="input.post_input"
   IF INT_FLAG THEN
      LET r_success= FALSE
      LET r_docno  = NULL
      LET INT_FLAG = 0
   ELSE
      CALL s_transaction_begin()
      LET g_apcacomp = g_apca_m.apcacomp
      CASE
         WHEN g_apca_m.apca016 = '31'
            CALL aapt560_03_ins_ap_1() RETURNING g_sub_success,r_docno
         WHEN g_apca_m.apca016 = '32'
            CALL aapt560_03_ins_ap_2() RETURNING g_sub_success,r_docno
         WHEN g_apca_m.apca016 = '33'
            CALL aapt560_03_ins_ap_3() RETURNING g_sub_success,r_docno
         WHEN g_apca_m.apca016 = '34'
            CALL aapt560_03_ins_ap_4() RETURNING g_sub_success,r_docno
         WHEN g_apca_m.apca016 = '35'
            CALL aapt560_03_ins_ap_5() RETURNING g_sub_success,r_docno
         WHEN g_apca_m.apca016 = '36'
            CALL aapt560_03_ins_ap_6() RETURNING g_sub_success,r_docno
      END CASE
      IF NOT g_sub_success THEN LET r_success = FALSE END IF
      
      IF g_sub_success = FALSE THEN       #161129-00042#1-add
         CALL s_transaction_end('N',0)    #161129-00042#1-add
      ELSE                                #161129-00042#1-add
         CALL s_transaction_end('Y',0)
      END IF                              #161129-00042#1-add
   END IF
   
   RETURN r_success,r_docno
   #end add-point    
   
END FUNCTION
 
{</section>}
 
{<section id="aapt560_03.other_dialog" readonly="Y" >}

 
{</section>}
 
{<section id="aapt560_03.other_function" readonly="Y" >}

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_ins_ap_1()
#DEFINE l_apca   RECORD LIKE apca_t.* #161104-00024#5 mark
#161104-00024#5-add(s)
DEFINE l_apca  RECORD  #應付憑單單頭
       apcaent   LIKE apca_t.apcaent, #企業編號
       apcaownid LIKE apca_t.apcaownid, #資料所有者
       apcaowndp LIKE apca_t.apcaowndp, #資料所有部門
       apcacrtid LIKE apca_t.apcacrtid, #資料建立者
       apcacrtdp LIKE apca_t.apcacrtdp, #資料建立部門
       apcacrtdt LIKE apca_t.apcacrtdt, #資料創建日
       apcamodid LIKE apca_t.apcamodid, #資料修改者
       apcamoddt LIKE apca_t.apcamoddt, #最近修改日
       apcacnfid LIKE apca_t.apcacnfid, #資料確認者
       apcacnfdt LIKE apca_t.apcacnfdt, #資料確認日
       apcapstid LIKE apca_t.apcapstid, #資料過帳者
       apcapstdt LIKE apca_t.apcapstdt, #資料過帳日
       apcastus  LIKE apca_t.apcastus, #狀態碼
       apcald    LIKE apca_t.apcald, #帳套
       apcacomp  LIKE apca_t.apcacomp, #法人
       apcadocno LIKE apca_t.apcadocno, #應付帳款單號碼
       apcadocdt LIKE apca_t.apcadocdt, #帳款日期
       apcasite  LIKE apca_t.apcasite, #帳務中心
       apca001   LIKE apca_t.apca001, #帳款單性質
       apca003   LIKE apca_t.apca003, #帳務人員
       apca004   LIKE apca_t.apca004, #帳款對象編號
       apca005   LIKE apca_t.apca005, #付款對象
       apca006   LIKE apca_t.apca006, #供應商分類
       apca007   LIKE apca_t.apca007, #帳款類別
       apca008   LIKE apca_t.apca008, #付款條件編號
       apca009   LIKE apca_t.apca009, #應付款日/應扣抵日
       apca010   LIKE apca_t.apca010, #容許票據到期日
       apca011   LIKE apca_t.apca011, #稅別
       apca012   LIKE apca_t.apca012, #稅率
       apca013   LIKE apca_t.apca013, #含稅否
       apca014   LIKE apca_t.apca014, #人員編號
       apca015   LIKE apca_t.apca015, #部門編號
       apca016   LIKE apca_t.apca016, #來源作業類型
       apca017   LIKE apca_t.apca017, #產生方式
       apca018   LIKE apca_t.apca018, #來源參考單號
       apca019   LIKE apca_t.apca019, #系統產生對應單號(待抵帳款-預付)
       apca020   LIKE apca_t.apca020, #信用狀付款否
       apca021   LIKE apca_t.apca021, #商業發票號碼(IV no.)
       apca022   LIKE apca_t.apca022, #進口報單號碼
       apca025   LIKE apca_t.apca025, #差異處理(發票與帳款差異)
       apca026   LIKE apca_t.apca026, #原幣未稅差異
       apca027   LIKE apca_t.apca027, #原幣稅額差異
       apca028   LIKE apca_t.apca028, #本幣未稅差異
       apca029   LIKE apca_t.apca029, #本幣幣稅額差異
       apca030   LIKE apca_t.apca030, #差異科目
       apca031   LIKE apca_t.apca031, #產生之差異折讓單號
       apca032   LIKE apca_t.apca032, #發票類型
       apca033   LIKE apca_t.apca033, #專案編號
       apca034   LIKE apca_t.apca034, #責任中心
       apca035   LIKE apca_t.apca035, #應付(貸方)科目編號
       apca036   LIKE apca_t.apca036, #費用(借方)科目編號
       apca037   LIKE apca_t.apca037, #產生傳票否
       apca038   LIKE apca_t.apca038, #拋轉傳票號碼
       apca039   LIKE apca_t.apca039, #會計檢核附件份數
       apca040   LIKE apca_t.apca040, #留置否
       apca041   LIKE apca_t.apca041, #留置理由碼
       apca042   LIKE apca_t.apca042, #留置設定日期
       apca043   LIKE apca_t.apca043, #留置解除日期
       apca044   LIKE apca_t.apca044, #留置原幣金額
       apca045   LIKE apca_t.apca045, #留置說明
       apca046   LIKE apca_t.apca046, #關係人否
       apca047   LIKE apca_t.apca047, #多角序號
       apca048   LIKE apca_t.apca048, #集團代付/代付單號
       apca049   LIKE apca_t.apca049, #來源營運中心編號
       apca050   LIKE apca_t.apca050, #交易原始單據份數
       apca051   LIKE apca_t.apca051, #作廢理由碼
       apca052   LIKE apca_t.apca052, #列印次數
       apca053   LIKE apca_t.apca053, #備註
       apca054   LIKE apca_t.apca054, #多帳期設定
       apca055   LIKE apca_t.apca055, #繳款優惠條件
       apca056   LIKE apca_t.apca056, #會計檢核附件狀態
       apca057   LIKE apca_t.apca057, #交易對象識別碼
       apca058   LIKE apca_t.apca058, #稅別交易類型
       apca059   LIKE apca_t.apca059, #預算編號
       apca060   LIKE apca_t.apca060, #發票開立方式
       apca061   LIKE apca_t.apca061, #預開發票基準日
       apca062   LIKE apca_t.apca062, #多角性質
       apca063   LIKE apca_t.apca063, #整帳批序號
       apca064   LIKE apca_t.apca064, #訂金序次
       apca065   LIKE apca_t.apca065, #發票編號
       apca066   LIKE apca_t.apca066, #發票號碼
       apca100   LIKE apca_t.apca100, #交易原幣別
       apca101   LIKE apca_t.apca101, #原幣匯率
       apca103   LIKE apca_t.apca103, #原幣未稅金額
       apca104   LIKE apca_t.apca104, #原幣稅額
       apca106   LIKE apca_t.apca106, #原幣應稅折抵合計金額
       apca107   LIKE apca_t.apca107, #原幣直接沖帳(調整)合計金額
       apca108   LIKE apca_t.apca108, #原幣應付金額
       apca113   LIKE apca_t.apca113, #本幣未稅金額
       apca114   LIKE apca_t.apca114, #本幣稅額
       apca116   LIKE apca_t.apca116, #本幣應稅折抵合計金額
       apca117   LIKE apca_t.apca117, #NO USE
       apca118   LIKE apca_t.apca118, #本幣應付金額
       apca120   LIKE apca_t.apca120, #本位幣二幣別
       apca121   LIKE apca_t.apca121, #本位幣二匯率
       apca123   LIKE apca_t.apca123, #本位幣二未稅金額
       apca124   LIKE apca_t.apca124, #本位幣二稅額
       apca126   LIKE apca_t.apca126, #本位幣二應稅折抵合計金額
       apca127   LIKE apca_t.apca127, #NO USE
       apca128   LIKE apca_t.apca128, #本位幣二應付金額
       apca130   LIKE apca_t.apca130, #本位幣三幣別
       apca131   LIKE apca_t.apca131, #本位幣三匯率
       apca133   LIKE apca_t.apca133, #本位幣三未稅金額
       apca134   LIKE apca_t.apca134, #本位幣三稅額
       apca136   LIKE apca_t.apca136, #本位幣三應稅折抵合計金額
       apca137   LIKE apca_t.apca137, #NO USE
       apca138   LIKE apca_t.apca138, #本位幣三應付金額
       apcaud001 LIKE apca_t.apcaud001, #自定義欄位(文字)001
       apcaud002 LIKE apca_t.apcaud002, #自定義欄位(文字)002
       apcaud003 LIKE apca_t.apcaud003, #自定義欄位(文字)003
       apcaud004 LIKE apca_t.apcaud004, #自定義欄位(文字)004
       apcaud005 LIKE apca_t.apcaud005, #自定義欄位(文字)005
       apcaud006 LIKE apca_t.apcaud006, #自定義欄位(文字)006
       apcaud007 LIKE apca_t.apcaud007, #自定義欄位(文字)007
       apcaud008 LIKE apca_t.apcaud008, #自定義欄位(文字)008
       apcaud009 LIKE apca_t.apcaud009, #自定義欄位(文字)009
       apcaud010 LIKE apca_t.apcaud010, #自定義欄位(文字)010
       apcaud011 LIKE apca_t.apcaud011, #自定義欄位(數字)011
       apcaud012 LIKE apca_t.apcaud012, #自定義欄位(數字)012
       apcaud013 LIKE apca_t.apcaud013, #自定義欄位(數字)013
       apcaud014 LIKE apca_t.apcaud014, #自定義欄位(數字)014
       apcaud015 LIKE apca_t.apcaud015, #自定義欄位(數字)015
       apcaud016 LIKE apca_t.apcaud016, #自定義欄位(數字)016
       apcaud017 LIKE apca_t.apcaud017, #自定義欄位(數字)017
       apcaud018 LIKE apca_t.apcaud018, #自定義欄位(數字)018
       apcaud019 LIKE apca_t.apcaud019, #自定義欄位(數字)019
       apcaud020 LIKE apca_t.apcaud020, #自定義欄位(數字)020
       apcaud021 LIKE apca_t.apcaud021, #自定義欄位(日期時間)021
       apcaud022 LIKE apca_t.apcaud022, #自定義欄位(日期時間)022
       apcaud023 LIKE apca_t.apcaud023, #自定義欄位(日期時間)023
       apcaud024 LIKE apca_t.apcaud024, #自定義欄位(日期時間)024
       apcaud025 LIKE apca_t.apcaud025, #自定義欄位(日期時間)025
       apcaud026 LIKE apca_t.apcaud026, #自定義欄位(日期時間)026
       apcaud027 LIKE apca_t.apcaud027, #自定義欄位(日期時間)027
       apcaud028 LIKE apca_t.apcaud028, #自定義欄位(日期時間)028
       apcaud029 LIKE apca_t.apcaud029, #自定義欄位(日期時間)029
       apcaud030 LIKE apca_t.apcaud030, #自定義欄位(日期時間)030
       apca067   LIKE apca_t.apca067, #管理品類
       apca068   LIKE apca_t.apca068, #經營方式
       apca069   LIKE apca_t.apca069, #no use
       apca070   LIKE apca_t.apca070, #no use
       apca071   LIKE apca_t.apca071, #no use
       apca072   LIKE apca_t.apca072, #no use
       apca073   LIKE apca_t.apca073  #L/C No.
           END RECORD
#161104-00024#5-add(e)
DEFINE l_desc   LIKE type_t.chr1000
DEFINE ls_js            STRING   
DEFINE lc_param_apca    RECORD
         apcald         LIKE apca_t.apcald,
         apcacomp       LIKE apca_t.apcacomp,
         apcasite       LIKE apca_t.apcasite,
         apcadocdt      LIKE apca_t.apcadocdt,
         apca001        LIKE apca_t.apca001,
         apca004        LIKE apca_t.apca004,
         ooef019        LIKE ooef_t.ooef019
                        END RECORD
DEFINE lc_param_info    RECORD
            apca005        LIKE apca_t.apca005,
            apca005_desc   LIKE type_t.chr80,
            apca006        LIKE apca_t.apca006,    #供應商分類
            apca007        LIKE apca_t.apca007,
            apca007_desc   LIKE type_t.chr80,
            apca008        LIKE apca_t.apca008,
            apca008_desc   LIKE type_t.chr80,
            apca009        LIKE apca_t.apca009,
            apca010        LIKE apca_t.apca010,
            apca011        LIKE apca_t.apca011,
            apca011_desc   LIKE type_t.chr80,
            apca012        LIKE apca_t.apca012,
            apca013        LIKE apca_t.apca013,
            apca014        LIKE apca_t.apca014,
            apca014_desc   LIKE type_t.chr80,
            apca015        LIKE apca_t.apca015,
            apca015_desc   LIKE type_t.chr80,
            apca034        LIKE apca_t.apca034,
            apca034_desc   LIKE type_t.chr80,
            apca035        LIKE apca_t.apca035,
            apca035_desc   LIKE type_t.chr80,
            apca036        LIKE apca_t.apca036,
            apca036_desc   LIKE type_t.chr80,
            apca046        LIKE apca_t.apca046,
            apca054        LIKE apca_t.apca054,
            apca054_desc   LIKE type_t.chr80,
            apca055        LIKE apca_t.apca055,
            apca055_desc   LIKE type_t.chr80,
            apca056        LIKE apca_t.apca056,
            apca058        LIKE apca_t.apca058,
            apca058_desc   LIKE type_t.chr80,
            apca060        LIKE apca_t.apca060,
            apca100        LIKE apca_t.apca100,
            apca101        LIKE apca_t.apca101,
            apca121        LIKE apca_t.apca121,
            apca131        LIKE apca_t.apca131
                       END RECORD
   DEFINE lc_param2        RECORD
         type           LIKE type_t.chr1,       #類型
         apca004        LIKE apca_t.apca004,
         sfin2009       LIKE type_t.chr1        #汇率基本    
         END RECORD
   #DEFINE l_apga    RECORD LIKE apga_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apga  RECORD  #信用狀申請單主檔
          apgaent   LIKE apga_t.apgaent, #企業編號
          apgaownid LIKE apga_t.apgaownid, #資料所有者
          apgaowndp LIKE apga_t.apgaowndp, #資料所屬部門
          apgacrtid LIKE apga_t.apgacrtid, #資料建立者
          apgacrtdp LIKE apga_t.apgacrtdp, #資料建立部門
          apgacrtdt LIKE apga_t.apgacrtdt, #資料創建日
          apgamodid LIKE apga_t.apgamodid, #資料修改者
          apgamoddt LIKE apga_t.apgamoddt, #最近修改日
          apgacnfid LIKE apga_t.apgacnfid, #資料確認者
          apgacnfdt LIKE apga_t.apgacnfdt, #資料確認日
          apgapstid LIKE apga_t.apgapstid, #資料過帳者
          apgapstdt LIKE apga_t.apgapstdt, #資料過帳日
          apgastus  LIKE apga_t.apgastus, #狀態碼
          apgacomp  LIKE apga_t.apgacomp, #法人
          apgadocno LIKE apga_t.apgadocno, #申請單號
          apgadocdt LIKE apga_t.apgadocdt, #申請日期
          apga001   LIKE apga_t.apga001, #L/C NO
          apga002   LIKE apga_t.apga002, #版次
          apga003   LIKE apga_t.apga003, #開狀日期
          apga004   LIKE apga_t.apga004, #供應商(受益人)
          apga005   LIKE apga_t.apga005, #業務人員
          apga006   LIKE apga_t.apga006, #付款類型
          apga007   LIKE apga_t.apga007, #開狀銀行
          apga008   LIKE apga_t.apga008, #信用狀類別
          apga009   LIKE apga_t.apga009, #保兌信用狀否
          apga010   LIKE apga_t.apga010, #信用狀有效日期
          apga011   LIKE apga_t.apga011, #許可證號
          apga012   LIKE apga_t.apga012, #承兌日期
          apga013   LIKE apga_t.apga013, #保兌費用支付方
          apga014   LIKE apga_t.apga014, #可否分批交運
          apga015   LIKE apga_t.apga015, #自備款比率
          apga016   LIKE apga_t.apga016, #融資利率
          apga017   LIKE apga_t.apga017, #融資天數
          apga018   LIKE apga_t.apga018, #融資合約編號
          apga019   LIKE apga_t.apga019, #最後裝運日
          apga020   LIKE apga_t.apga020, #運送方式
          apga021   LIKE apga_t.apga021, #裝載港/機場
          apga022   LIKE apga_t.apga022, #卸載港/機場
          apga023   LIKE apga_t.apga023, #E.T.D
          apga024   LIKE apga_t.apga024, #E.T.A
          apga025   LIKE apga_t.apga025, #備註
          apga026   LIKE apga_t.apga026, #開狀時支付自備款
          apga027   LIKE apga_t.apga027, #NO USE
          apga028   LIKE apga_t.apga028, #帳務單號
          apga029   LIKE apga_t.apga029, #結案否
          apga030   LIKE apga_t.apga030, #通知銀行
          apga031   LIKE apga_t.apga031, #開狀時支付自備款
          apga100   LIKE apga_t.apga100, #幣別
          apga101   LIKE apga_t.apga101, #開狀匯率
          apga103   LIKE apga_t.apga103, #開狀原幣金額
          apga104   LIKE apga_t.apga104, #自備款原幣金額
          apga105   LIKE apga_t.apga105, #融資原幣金額
          apga106   LIKE apga_t.apga106, #到單原幣金額
          apga107   LIKE apga_t.apga107, #到貨原幣金額
          apga108   LIKE apga_t.apga108, #保證金原幣金額
          apga113   LIKE apga_t.apga113, #開狀本幣金額
          apga114   LIKE apga_t.apga114, #自備款本幣金額
          apga115   LIKE apga_t.apga115, #融資本幣金額
          apgaud001 LIKE apga_t.apgaud001, #自定義欄位(文字)001
          apgaud002 LIKE apga_t.apgaud002, #自定義欄位(文字)002
          apgaud003 LIKE apga_t.apgaud003, #自定義欄位(文字)003
          apgaud004 LIKE apga_t.apgaud004, #自定義欄位(文字)004
          apgaud005 LIKE apga_t.apgaud005, #自定義欄位(文字)005
          apgaud006 LIKE apga_t.apgaud006, #自定義欄位(文字)006
          apgaud007 LIKE apga_t.apgaud007, #自定義欄位(文字)007
          apgaud008 LIKE apga_t.apgaud008, #自定義欄位(文字)008
          apgaud009 LIKE apga_t.apgaud009, #自定義欄位(文字)009
          apgaud010 LIKE apga_t.apgaud010, #自定義欄位(文字)010
          apgaud011 LIKE apga_t.apgaud011, #自定義欄位(數字)011
          apgaud012 LIKE apga_t.apgaud012, #自定義欄位(數字)012
          apgaud013 LIKE apga_t.apgaud013, #自定義欄位(數字)013
          apgaud014 LIKE apga_t.apgaud014, #自定義欄位(數字)014
          apgaud015 LIKE apga_t.apgaud015, #自定義欄位(數字)015
          apgaud016 LIKE apga_t.apgaud016, #自定義欄位(數字)016
          apgaud017 LIKE apga_t.apgaud017, #自定義欄位(數字)017
          apgaud018 LIKE apga_t.apgaud018, #自定義欄位(數字)018
          apgaud019 LIKE apga_t.apgaud019, #自定義欄位(數字)019
          apgaud020 LIKE apga_t.apgaud020, #自定義欄位(數字)020
          apgaud021 LIKE apga_t.apgaud021, #自定義欄位(日期時間)021
          apgaud022 LIKE apga_t.apgaud022, #自定義欄位(日期時間)022
          apgaud023 LIKE apga_t.apgaud023, #自定義欄位(日期時間)023
          apgaud024 LIKE apga_t.apgaud024, #自定義欄位(日期時間)024
          apgaud025 LIKE apga_t.apgaud025, #自定義欄位(日期時間)025
          apgaud026 LIKE apga_t.apgaud026, #自定義欄位(日期時間)026
          apgaud027 LIKE apga_t.apgaud027, #自定義欄位(日期時間)027
          apgaud028 LIKE apga_t.apgaud028, #自定義欄位(日期時間)028
          apgaud029 LIKE apga_t.apgaud029, #自定義欄位(日期時間)029
          apgaud030 LIKE apga_t.apgaud030, #自定義欄位(日期時間)030
          apga102   LIKE apga_t.apga102, #預付款原幣金額
          apga109   LIKE apga_t.apga109, #初開狀原幣金額
          apga112   LIKE apga_t.apga112, #預付款本幣金額
          apga117   LIKE apga_t.apga117, #到貨本幣金額
          apga118   LIKE apga_t.apga118, #保證金本幣金額
          apga032   LIKE apga_t.apga032, #保證金待抵單號
          apga033   LIKE apga_t.apga033, #預付款待抵單號
          apga034   LIKE apga_t.apga034, #保證金存提碼
          apga035   LIKE apga_t.apga035, #保證金現變碼
          apga040   LIKE apga_t.apga040, #支付帳戶
          apga041   LIKE apga_t.apga041, #多幣別採購單
          apga036   LIKE apga_t.apga036, #自備款存提碼
          apga037   LIKE apga_t.apga037, #自備款現變碼
          apga038   LIKE apga_t.apga038, #預付款存提碼
          apga039   LIKE apga_t.apga039  #預付款現變碼
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_success LIKE type_t.num5
   #DEFINE l_apgc    RECORD LIKE apgc_t.* #161104-00024#5 mark
   #DEFINE l_apcb    RECORD LIKE apcb_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgc  RECORD  #信用狀相關費用明細檔
          apgcent   LIKE apgc_t.apgcent, #企業編號
          apgccomp  LIKE apgc_t.apgccomp, #法人
          apgcdocno LIKE apgc_t.apgcdocno, #申請單號
          apgcseq   LIKE apgc_t.apgcseq, #項次
          apgc900   LIKE apgc_t.apgc900, #變更序
          apgcorga  LIKE apgc_t.apgcorga, #來源組織
          apgc001   LIKE apgc_t.apgc001, #費用編號
          apgc002   LIKE apgc_t.apgc002, #付款對象
          apgc003   LIKE apgc_t.apgc003, #付款條件
          apgc004   LIKE apgc_t.apgc004, #費用科目
          apgc005   LIKE apgc_t.apgc005, #帳款類別
          apgc006   LIKE apgc_t.apgc006, #稅別
          apgc007   LIKE apgc_t.apgc007, #發票類型
          apgc008   LIKE apgc_t.apgc008, #發票編號
          apgc009   LIKE apgc_t.apgc009, #發票號碼
          apgc010   LIKE apgc_t.apgc010, #發票日期
          apgc011   LIKE apgc_t.apgc011, #可扣抵編號
          apgc012   LIKE apgc_t.apgc012, #應付單號
          apgc013   LIKE apgc_t.apgc013, #費用來源
          apgc014   LIKE apgc_t.apgc014, #付款帳戶
          apgc015   LIKE apgc_t.apgc015, #存提碼
          apgc016   LIKE apgc_t.apgc016, #現金變動碼
          apgc100   LIKE apgc_t.apgc100, #幣別
          apgc101   LIKE apgc_t.apgc101, #匯率
          apgc103   LIKE apgc_t.apgc103, #原幣未稅金額
          apgc104   LIKE apgc_t.apgc104, #稅額
          apgc105   LIKE apgc_t.apgc105, #原幣含稅金額
          apgc113   LIKE apgc_t.apgc113, #本幣未稅金額
          apgc114   LIKE apgc_t.apgc114, #本幣稅額
          apgc115   LIKE apgc_t.apgc115, #本幣含稅金額
          apgcud001 LIKE apgc_t.apgcud001, #自定義欄位(文字)001
          apgcud002 LIKE apgc_t.apgcud002, #自定義欄位(文字)002
          apgcud003 LIKE apgc_t.apgcud003, #自定義欄位(文字)003
          apgcud004 LIKE apgc_t.apgcud004, #自定義欄位(文字)004
          apgcud005 LIKE apgc_t.apgcud005, #自定義欄位(文字)005
          apgcud006 LIKE apgc_t.apgcud006, #自定義欄位(文字)006
          apgcud007 LIKE apgc_t.apgcud007, #自定義欄位(文字)007
          apgcud008 LIKE apgc_t.apgcud008, #自定義欄位(文字)008
          apgcud009 LIKE apgc_t.apgcud009, #自定義欄位(文字)009
          apgcud010 LIKE apgc_t.apgcud010, #自定義欄位(文字)010
          apgcud011 LIKE apgc_t.apgcud011, #自定義欄位(數字)011
          apgcud012 LIKE apgc_t.apgcud012, #自定義欄位(數字)012
          apgcud013 LIKE apgc_t.apgcud013, #自定義欄位(數字)013
          apgcud014 LIKE apgc_t.apgcud014, #自定義欄位(數字)014
          apgcud015 LIKE apgc_t.apgcud015, #自定義欄位(數字)015
          apgcud016 LIKE apgc_t.apgcud016, #自定義欄位(數字)016
          apgcud017 LIKE apgc_t.apgcud017, #自定義欄位(數字)017
          apgcud018 LIKE apgc_t.apgcud018, #自定義欄位(數字)018
          apgcud019 LIKE apgc_t.apgcud019, #自定義欄位(數字)019
          apgcud020 LIKE apgc_t.apgcud020, #自定義欄位(數字)020
          apgcud021 LIKE apgc_t.apgcud021, #自定義欄位(日期時間)021
          apgcud022 LIKE apgc_t.apgcud022, #自定義欄位(日期時間)022
          apgcud023 LIKE apgc_t.apgcud023, #自定義欄位(日期時間)023
          apgcud024 LIKE apgc_t.apgcud024, #自定義欄位(日期時間)024
          apgcud025 LIKE apgc_t.apgcud025, #自定義欄位(日期時間)025
          apgcud026 LIKE apgc_t.apgcud026, #自定義欄位(日期時間)026
          apgcud027 LIKE apgc_t.apgcud027, #自定義欄位(日期時間)027
          apgcud028 LIKE apgc_t.apgcud028, #自定義欄位(日期時間)028
          apgcud029 LIKE apgc_t.apgcud029, #自定義欄位(日期時間)029
          apgcud030 LIKE apgc_t.apgcud030  #自定義欄位(日期時間)030
              END RECORD
   DEFINE l_apcb  RECORD  #應付憑單單身
          apcbent   LIKE apcb_t.apcbent, #企業編號
          apcbld    LIKE apcb_t.apcbld, #帳套
          apcblegl  LIKE apcb_t.apcblegl, #核算組織
          apcborga  LIKE apcb_t.apcborga, #帳務歸屬組織(來源組織)
          apcbsite  LIKE apcb_t.apcbsite, #應付帳務組織
          apcbdocno LIKE apcb_t.apcbdocno, #單號
          apcbseq   LIKE apcb_t.apcbseq, #項次
          apcb001   LIKE apcb_t.apcb001, #來源類型
          apcb002   LIKE apcb_t.apcb002, #來源業務單據號碼
          apcb003   LIKE apcb_t.apcb003, #來源業務單據項次
          apcb004   LIKE apcb_t.apcb004, #產品編號
          apcb005   LIKE apcb_t.apcb005, #品名規格
          apcb006   LIKE apcb_t.apcb006, #單位
          apcb007   LIKE apcb_t.apcb007, #計價數量
          apcb008   LIKE apcb_t.apcb008, #參考單據號碼
          apcb009   LIKE apcb_t.apcb009, #參考單據項次
          apcb010   LIKE apcb_t.apcb010, #業務部門
          apcb011   LIKE apcb_t.apcb011, #責任中心
          apcb012   LIKE apcb_t.apcb012, #產品類別
          apcb013   LIKE apcb_t.apcb013, #搭贈
          apcb014   LIKE apcb_t.apcb014, #理由碼
          apcb015   LIKE apcb_t.apcb015, #專案編號
          apcb016   LIKE apcb_t.apcb016, #WBS編號
          apcb017   LIKE apcb_t.apcb017, #預算細項
          apcb018   LIKE apcb_t.apcb018, #专柜编号
          apcb019   LIKE apcb_t.apcb019, #開票性質
          apcb020   LIKE apcb_t.apcb020, #稅別
          apcb021   LIKE apcb_t.apcb021, #費用會計科目
          apcb022   LIKE apcb_t.apcb022, #正負值
          apcb023   LIKE apcb_t.apcb023, #沖暫估單否
          apcb024   LIKE apcb_t.apcb024, #區域
          apcb025   LIKE apcb_t.apcb025, #傳票號碼
          apcb026   LIKE apcb_t.apcb026, #傳票項次
          apcb027   LIKE apcb_t.apcb027, #發票編號
          apcb028   LIKE apcb_t.apcb028, #發票號碼
          apcb029   LIKE apcb_t.apcb029, #應付帳款科目
          apcb030   LIKE apcb_t.apcb030, #付款條件
          apcb032   LIKE apcb_t.apcb032, #訂金序次
          apcb033   LIKE apcb_t.apcb033, #經營方式
          apcb034   LIKE apcb_t.apcb034, #通路
          apcb035   LIKE apcb_t.apcb035, #品牌
          apcb036   LIKE apcb_t.apcb036, #客群
          apcb037   LIKE apcb_t.apcb037, #自由核算項一
          apcb038   LIKE apcb_t.apcb038, #自由核算項二
          apcb039   LIKE apcb_t.apcb039, #自由核算項三
          apcb040   LIKE apcb_t.apcb040, #自由核算項四
          apcb041   LIKE apcb_t.apcb041, #自由核算項五
          apcb042   LIKE apcb_t.apcb042, #自由核算項六
          apcb043   LIKE apcb_t.apcb043, #自由核算項七
          apcb044   LIKE apcb_t.apcb044, #自由核算項八
          apcb045   LIKE apcb_t.apcb045, #自由核算項九
          apcb046   LIKE apcb_t.apcb046, #自由核算項十
          apcb047   LIKE apcb_t.apcb047, #摘要
          apcb048   LIKE apcb_t.apcb048, #來源訂購單號
          apcb049   LIKE apcb_t.apcb049, #開票單號
          apcb050   LIKE apcb_t.apcb050, #開票項次
          apcb051   LIKE apcb_t.apcb051, #業務人員
          apcb100   LIKE apcb_t.apcb100, #交易原幣
          apcb101   LIKE apcb_t.apcb101, #交易原幣單價
          apcb102   LIKE apcb_t.apcb102, #原幣匯率
          apcb103   LIKE apcb_t.apcb103, #交易原幣未稅金額
          apcb104   LIKE apcb_t.apcb104, #交易原幣稅額
          apcb105   LIKE apcb_t.apcb105, #交易原幣含稅金額
          apcb106   LIKE apcb_t.apcb106, #交易幣標準成本金額
          apcb107   LIKE apcb_t.apcb107, #入庫單單價
          apcb108   LIKE apcb_t.apcb108, #交易原幣成本認列金額
          apcb111   LIKE apcb_t.apcb111, #本幣單價
          apcb113   LIKE apcb_t.apcb113, #本幣未稅金額
          apcb114   LIKE apcb_t.apcb114, #本幣稅額
          apcb115   LIKE apcb_t.apcb115, #本幣含稅金額
          apcb116   LIKE apcb_t.apcb116, #本幣標準成本金額
          apcb117   LIKE apcb_t.apcb117, #NO USE
          apcb118   LIKE apcb_t.apcb118, #本幣成本認列金額
          apcb119   LIKE apcb_t.apcb119, #應開發票含稅金額
          apcb121   LIKE apcb_t.apcb121, #本位幣二匯率
          apcb123   LIKE apcb_t.apcb123, #本位幣二未稅金額
          apcb124   LIKE apcb_t.apcb124, #本位幣二稅額
          apcb125   LIKE apcb_t.apcb125, #本位幣二含稅金額
          apcb126   LIKE apcb_t.apcb126, #本幣二標準成本金額
          apcb127   LIKE apcb_t.apcb127, #NO USE
          apcb128   LIKE apcb_t.apcb128, #本位幣二成本認列金額
          apcb131   LIKE apcb_t.apcb131, #本位幣三匯率
          apcb133   LIKE apcb_t.apcb133, #本位幣三未稅金額
          apcb134   LIKE apcb_t.apcb134, #本位幣三稅額
          apcb135   LIKE apcb_t.apcb135, #本位幣三含稅金額
          apcb136   LIKE apcb_t.apcb136, #本幣三標準成本金額
          apcb137   LIKE apcb_t.apcb137, #NO USE
          apcb138   LIKE apcb_t.apcb138, #本位幣三成本認列金額
          apcbud001 LIKE apcb_t.apcbud001, #自定義欄位(文字)001
          apcbud002 LIKE apcb_t.apcbud002, #自定義欄位(文字)002
          apcbud003 LIKE apcb_t.apcbud003, #自定義欄位(文字)003
          apcbud004 LIKE apcb_t.apcbud004, #自定義欄位(文字)004
          apcbud005 LIKE apcb_t.apcbud005, #自定義欄位(文字)005
          apcbud006 LIKE apcb_t.apcbud006, #自定義欄位(文字)006
          apcbud007 LIKE apcb_t.apcbud007, #自定義欄位(文字)007
          apcbud008 LIKE apcb_t.apcbud008, #自定義欄位(文字)008
          apcbud009 LIKE apcb_t.apcbud009, #自定義欄位(文字)009
          apcbud010 LIKE apcb_t.apcbud010, #自定義欄位(文字)010
          apcbud011 LIKE apcb_t.apcbud011, #自定義欄位(數字)011
          apcbud012 LIKE apcb_t.apcbud012, #自定義欄位(數字)012
          apcbud013 LIKE apcb_t.apcbud013, #自定義欄位(數字)013
          apcbud014 LIKE apcb_t.apcbud014, #自定義欄位(數字)014
          apcbud015 LIKE apcb_t.apcbud015, #自定義欄位(數字)015
          apcbud016 LIKE apcb_t.apcbud016, #自定義欄位(數字)016
          apcbud017 LIKE apcb_t.apcbud017, #自定義欄位(數字)017
          apcbud018 LIKE apcb_t.apcbud018, #自定義欄位(數字)018
          apcbud019 LIKE apcb_t.apcbud019, #自定義欄位(數字)019
          apcbud020 LIKE apcb_t.apcbud020, #自定義欄位(數字)020
          apcbud021 LIKE apcb_t.apcbud021, #自定義欄位(日期時間)021
          apcbud022 LIKE apcb_t.apcbud022, #自定義欄位(日期時間)022
          apcbud023 LIKE apcb_t.apcbud023, #自定義欄位(日期時間)023
          apcbud024 LIKE apcb_t.apcbud024, #自定義欄位(日期時間)024
          apcbud025 LIKE apcb_t.apcbud025, #自定義欄位(日期時間)025
          apcbud026 LIKE apcb_t.apcbud026, #自定義欄位(日期時間)026
          apcbud027 LIKE apcb_t.apcbud027, #自定義欄位(日期時間)027
          apcbud028 LIKE apcb_t.apcbud028, #自定義欄位(日期時間)028
          apcbud029 LIKE apcb_t.apcbud029, #自定義欄位(日期時間)029
          apcbud030 LIKE apcb_t.apcbud030, #自定義欄位(日期時間)030
          apcb052   LIKE apcb_t.apcb052, #稅額
          apcb053   LIKE apcb_t.apcb053, #含稅金額
          apcb054   LIKE apcb_t.apcb054, #帳款對象
          apcb055   LIKE apcb_t.apcb055  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sql     STRING
   #DEFINE l_isam    RECORD LIKE isam_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_isam  RECORD  #進項發票主檔
          isament   LIKE isam_t.isament, #企業編號
          isamownid LIKE isam_t.isamownid, #資料所有者
          isamowndp LIKE isam_t.isamowndp, #資料所屬部門
          isamcrtid LIKE isam_t.isamcrtid, #資料建立者
          isamcrtdp LIKE isam_t.isamcrtdp, #資料建立部門
          isamcrtdt LIKE isam_t.isamcrtdt, #資料創建日
          isammodid LIKE isam_t.isammodid, #資料修改者
          isammoddt LIKE isam_t.isammoddt, #最近修改日
          isamcnfid LIKE isam_t.isamcnfid, #資料確認者
          isamcnfdt LIKE isam_t.isamcnfdt, #資料確認日
          isamstus  LIKE isam_t.isamstus, #狀態碼
          isamcomp  LIKE isam_t.isamcomp, #法人
          isamdocno LIKE isam_t.isamdocno, #收票單號
          isamseq   LIKE isam_t.isamseq, #項次
          isam001   LIKE isam_t.isam001, #發票來源
          isam002   LIKE isam_t.isam002, #開發票人
          isam004   LIKE isam_t.isam004, #帳務中心(業務組織)
          isam006   LIKE isam_t.isam006, #業務部門(登錄部門)
          isam008   LIKE isam_t.isam008, #發票類型
          isam009   LIKE isam_t.isam009, #銷方發票編號
          isam010   LIKE isam_t.isam010, #發票號碼
          isam011   LIKE isam_t.isam011, #發票日期
          isam012   LIKE isam_t.isam012, #稅別
          isam0121  LIKE isam_t.isam0121, #含稅否
          isam013   LIKE isam_t.isam013, #稅率
          isam014   LIKE isam_t.isam014, #幣別
          isam015   LIKE isam_t.isam015, #匯率
          isam016   LIKE isam_t.isam016, #購貨方名稱
          isam017   LIKE isam_t.isam017, #購貨方統一編號
          isam018   LIKE isam_t.isam018, #購貨方地址
          isam019   LIKE isam_t.isam019, #購貨方電話
          isam020   LIKE isam_t.isam020, #購貨方開戶銀行
          isam021   LIKE isam_t.isam021, #購貨方帳戶編碼
          isam022   LIKE isam_t.isam022, #銷方銀行帳戶編碼
          isam023   LIKE isam_t.isam023, #發票原幣未稅金額
          isam024   LIKE isam_t.isam024, #發票原幣稅額
          isam025   LIKE isam_t.isam025, #發票原幣含稅金額
          isam026   LIKE isam_t.isam026, #發票本幣未稅金額
          isam027   LIKE isam_t.isam027, #發票本幣稅額
          isam028   LIKE isam_t.isam028, #發票本幣含稅金額
          isam029   LIKE isam_t.isam029, #銷貨方名稱
          isam030   LIKE isam_t.isam030, #統一編號
          isam031   LIKE isam_t.isam031, #銷貨方地址
          isam032   LIKE isam_t.isam032, #銷貨方電話
          isam033   LIKE isam_t.isam033, #銷貨方開戶銀行
          isam034   LIKE isam_t.isam034, #銷貨方帳號
          isam035   LIKE isam_t.isam035, #申報數量
          isam036   LIKE isam_t.isam036, #異動狀態
          isam037   LIKE isam_t.isam037, #可扣抵編號
          isam038   LIKE isam_t.isam038, #作廢(註銷)理由碼
          isam039   LIKE isam_t.isam039, #作廢日期
          isam040   LIKE isam_t.isam040, #作廢時間
          isam041   LIKE isam_t.isam041, #作廢人員
          isam042   LIKE isam_t.isam042, #專案作廢核准文號
          isam043   LIKE isam_t.isam043, #通關方式註記
          isam044   LIKE isam_t.isam044, #列印次數
          isam045   LIKE isam_t.isam045, #支付工具卡號1
          isam046   LIKE isam_t.isam046, #支付工具卡號2
          isam047   LIKE isam_t.isam047, #支付工具卡號3
          isam048   LIKE isam_t.isam048, #通關註記
          isam049   LIKE isam_t.isam049, #備註說明
          isam050   LIKE isam_t.isam050, #立帳單號
          isam107   LIKE isam_t.isam107, #發票原幣已折金額
          isam108   LIKE isam_t.isam108, #發票原幣已折稅額
          isam117   LIKE isam_t.isam117, #發票本幣已折金額
          isam118   LIKE isam_t.isam118, #發票本幣已折稅額
          isam200   LIKE isam_t.isam200, #電子發票否
          isam201   LIKE isam_t.isam201, #愛心碼
          isam202   LIKE isam_t.isam202, #載具類別號碼
          isam203   LIKE isam_t.isam203, #載具顯碼 ID
          isam204   LIKE isam_t.isam204, #載具隱碼 ID
          isam205   LIKE isam_t.isam205, #電子發票匯出狀態
          isam206   LIKE isam_t.isam206, #電子發票匯出序號
          isam207   LIKE isam_t.isam207, #電子發票領取方式
          isam208   LIKE isam_t.isam208, #申報年度
          isam209   LIKE isam_t.isam209, #申報月份
          isam210   LIKE isam_t.isam210, #申報據點
          isamud001 LIKE isam_t.isamud001, #自定義欄位(文字)001
          isamud002 LIKE isam_t.isamud002, #自定義欄位(文字)002
          isamud003 LIKE isam_t.isamud003, #自定義欄位(文字)003
          isamud004 LIKE isam_t.isamud004, #自定義欄位(文字)004
          isamud005 LIKE isam_t.isamud005, #自定義欄位(文字)005
          isamud006 LIKE isam_t.isamud006, #自定義欄位(文字)006
          isamud007 LIKE isam_t.isamud007, #自定義欄位(文字)007
          isamud008 LIKE isam_t.isamud008, #自定義欄位(文字)008
          isamud009 LIKE isam_t.isamud009, #自定義欄位(文字)009
          isamud010 LIKE isam_t.isamud010, #自定義欄位(文字)010
          isamud011 LIKE isam_t.isamud011, #自定義欄位(數字)011
          isamud012 LIKE isam_t.isamud012, #自定義欄位(數字)012
          isamud013 LIKE isam_t.isamud013, #自定義欄位(數字)013
          isamud014 LIKE isam_t.isamud014, #自定義欄位(數字)014
          isamud015 LIKE isam_t.isamud015, #自定義欄位(數字)015
          isamud016 LIKE isam_t.isamud016, #自定義欄位(數字)016
          isamud017 LIKE isam_t.isamud017, #自定義欄位(數字)017
          isamud018 LIKE isam_t.isamud018, #自定義欄位(數字)018
          isamud019 LIKE isam_t.isamud019, #自定義欄位(數字)019
          isamud020 LIKE isam_t.isamud020, #自定義欄位(數字)020
          isamud021 LIKE isam_t.isamud021, #自定義欄位(日期時間)021
          isamud022 LIKE isam_t.isamud022, #自定義欄位(日期時間)022
          isamud023 LIKE isam_t.isamud023, #自定義欄位(日期時間)023
          isamud024 LIKE isam_t.isamud024, #自定義欄位(日期時間)024
          isamud025 LIKE isam_t.isamud025, #自定義欄位(日期時間)025
          isamud026 LIKE isam_t.isamud026, #自定義欄位(日期時間)026
          isamud027 LIKE isam_t.isamud027, #自定義欄位(日期時間)027
          isamud028 LIKE isam_t.isamud028, #自定義欄位(日期時間)028
          isamud029 LIKE isam_t.isamud029, #自定義欄位(日期時間)029
          isamud030 LIKE isam_t.isamud030, #自定義欄位(日期時間)030
          isam051   LIKE isam_t.isam051  #認證否
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_ooef002     LIKE ooef_t.ooef002
   DEFINE l_ooefl006    LIKE ooefl_t.ooefl006
   DEFINE l_pmaal003    LIKE pmaal_t.pmaal003
   DEFINE l_isao001     LIKE isao_t.isao001
   DEFINE l_dummy1      LIKE type_t.num20_6
   #DEFINE l_apde        RECORD LIKE apde_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apde RECORD  #付款及差異處理明細檔
          apdeent   LIKE apde_t.apdeent, #企業編號
          apdecomp  LIKE apde_t.apdecomp, #法人
          apdeld    LIKE apde_t.apdeld, #帳套
          apdedocno LIKE apde_t.apdedocno, #沖銷單單號
          apdeseq   LIKE apde_t.apdeseq, #項次
          apdesite  LIKE apde_t.apdesite, #帳務中心
          apdeorga  LIKE apde_t.apdeorga, #帳務歸屬組織
          apde001   LIKE apde_t.apde001, #來源作業
          apde002   LIKE apde_t.apde002, #沖銷帳款類型
          apde003   LIKE apde_t.apde003, #已付款單號
          apde004   LIKE apde_t.apde004, #沖銷單項次
          apde006   LIKE apde_t.apde006, #款別編號
          apde008   LIKE apde_t.apde008, #帳戶/票券號碼
          apde009   LIKE apde_t.apde009, #已轉資料
          apde010   LIKE apde_t.apde010, #摘要說明
          apde011   LIKE apde_t.apde011, #銀行存提碼
          apde012   LIKE apde_t.apde012, #現金變動碼
          apde013   LIKE apde_t.apde013, #轉入客商碼
          apde014   LIKE apde_t.apde014, #轉入帳款單編號
          apde015   LIKE apde_t.apde015, #沖銷加減項
          apde016   LIKE apde_t.apde016, #沖銷會科
          apde017   LIKE apde_t.apde017, #業務人員
          apde018   LIKE apde_t.apde018, #業務部門
          apde019   LIKE apde_t.apde019, #責任中心
          apde020   LIKE apde_t.apde020, #產品類別
          apde021   LIKE apde_t.apde021, #票據類型
          apde022   LIKE apde_t.apde022, #專案編號
          apde023   LIKE apde_t.apde023, #WBS編號
          apde024   LIKE apde_t.apde024, #票據號碼
          apde028   LIKE apde_t.apde028, #產生方式
          apde029   LIKE apde_t.apde029, #傳票號碼
          apde030   LIKE apde_t.apde030, #傳票項次
          apde032   LIKE apde_t.apde032, #付款日
          apde035   LIKE apde_t.apde035, #區域
          apde036   LIKE apde_t.apde036, #客群
          apde038   LIKE apde_t.apde038, #對象
          apde039   LIKE apde_t.apde039, #受款銀行
          apde040   LIKE apde_t.apde040, #受款帳號
          apde041   LIKE apde_t.apde041, #受款人全名
          apde042   LIKE apde_t.apde042, #經營方式
          apde043   LIKE apde_t.apde043, #通路
          apde044   LIKE apde_t.apde044, #品牌
          apde045   LIKE apde_t.apde045, #摘要
          apde046   LIKE apde_t.apde046, #付款申請單
          apde047   LIKE apde_t.apde047, #付款申請單項次
          apde051   LIKE apde_t.apde051, #自由核算項一
          apde052   LIKE apde_t.apde052, #自由核算項二
          apde053   LIKE apde_t.apde053, #自由核算項三
          apde054   LIKE apde_t.apde054, #自由核算項四
          apde055   LIKE apde_t.apde055, #自由核算項五
          apde056   LIKE apde_t.apde056, #自由核算項六
          apde057   LIKE apde_t.apde057, #自由核算項七
          apde058   LIKE apde_t.apde058, #自由核算項八
          apde059   LIKE apde_t.apde059, #自由核算項九
          apde060   LIKE apde_t.apde060, #自由核算項十
          apde100   LIKE apde_t.apde100, #幣別
          apde101   LIKE apde_t.apde101, #匯率
          apde104   LIKE apde_t.apde104, #原幣應稅折抵稅額
          apde109   LIKE apde_t.apde109, #原幣沖帳金額
          apde119   LIKE apde_t.apde119, #本幣沖帳金額
          apde120   LIKE apde_t.apde120, #本位幣二幣別
          apde121   LIKE apde_t.apde121, #本位幣二匯率
          apde129   LIKE apde_t.apde129, #本位幣二沖帳金額
          apde130   LIKE apde_t.apde130, #本位幣三幣別
          apde131   LIKE apde_t.apde131, #本位幣三匯率
          apde139   LIKE apde_t.apde139, #本位幣三沖帳金額
          apdeud001 LIKE apde_t.apdeud001, #自定義欄位(文字)001
          apdeud002 LIKE apde_t.apdeud002, #自定義欄位(文字)002
          apdeud003 LIKE apde_t.apdeud003, #自定義欄位(文字)003
          apdeud004 LIKE apde_t.apdeud004, #自定義欄位(文字)004
          apdeud005 LIKE apde_t.apdeud005, #自定義欄位(文字)005
          apdeud006 LIKE apde_t.apdeud006, #自定義欄位(文字)006
          apdeud007 LIKE apde_t.apdeud007, #自定義欄位(文字)007
          apdeud008 LIKE apde_t.apdeud008, #自定義欄位(文字)008
          apdeud009 LIKE apde_t.apdeud009, #自定義欄位(文字)009
          apdeud010 LIKE apde_t.apdeud010, #自定義欄位(文字)010
          apdeud011 LIKE apde_t.apdeud011, #自定義欄位(數字)011
          apdeud012 LIKE apde_t.apdeud012, #自定義欄位(數字)012
          apdeud013 LIKE apde_t.apdeud013, #自定義欄位(數字)013
          apdeud014 LIKE apde_t.apdeud014, #自定義欄位(數字)014
          apdeud015 LIKE apde_t.apdeud015, #自定義欄位(數字)015
          apdeud016 LIKE apde_t.apdeud016, #自定義欄位(數字)016
          apdeud017 LIKE apde_t.apdeud017, #自定義欄位(數字)017
          apdeud018 LIKE apde_t.apdeud018, #自定義欄位(數字)018
          apdeud019 LIKE apde_t.apdeud019, #自定義欄位(數字)019
          apdeud020 LIKE apde_t.apdeud020, #自定義欄位(數字)020
          apdeud021 LIKE apde_t.apdeud021, #自定義欄位(日期時間)021
          apdeud022 LIKE apde_t.apdeud022, #自定義欄位(日期時間)022
          apdeud023 LIKE apde_t.apdeud023, #自定義欄位(日期時間)023
          apdeud024 LIKE apde_t.apdeud024, #自定義欄位(日期時間)024
          apdeud025 LIKE apde_t.apdeud025, #自定義欄位(日期時間)025
          apdeud026 LIKE apde_t.apdeud026, #自定義欄位(日期時間)026
          apdeud027 LIKE apde_t.apdeud027, #自定義欄位(日期時間)027
          apdeud028 LIKE apde_t.apdeud028, #自定義欄位(日期時間)028
          apdeud029 LIKE apde_t.apdeud029, #自定義欄位(日期時間)029
          apdeud030 LIKE apde_t.apdeud030, #自定義欄位(日期時間)030
          apde061   LIKE apde_t.apde061  #應付來源
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_pmab055     LIKE pmab_t.pmab055
   DEFINE l_glaa121     LIKE glaa_t.glaa121
   DEFINE l_glaa016     LIKE glaa_t.glaa016
   DEFINE l_glaa020     LIKE glaa_t.glaa020
   DEFINE l_glaa019     LIKE glaa_t.glaa019
   DEFINE l_glaa015     LIKE glaa_t.glaa015
   DEFINE l_glaa001     LIKE glaa_t.glaa001
   DEFINE r_docno       LIKE apga_t.apgadocno
   DEFINE l_date        DATETIME YEAR TO SECOND
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   DEFINE l_apcb113sum  LIKE type_t.num20_6
   DEFINE l_apcb114sum  LIKE type_t.num20_6
   DEFINE l_apcb115sum  LIKE type_t.num20_6
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   DEFINE l_oodb004     LIKE oodb_t.oodb004
   DEFINE l_apca013     LIKE apca_t.apca013
   DEFINE l_apca012     LIKE apca_t.apca012
   DEFINE l_oodb011     LIKE oodb_t.oodb011
   DEFINE l_count       LIKE type_t.num10
   #161004-00019#1-----s
   DEFINE l_xrcd009     LIKE xrcd_t.xrcd009
   #161004-00019#1-----e
   DEFINE l_ooef011    LIKE ooef_t.ooef011 #161129-00042#1-add
   DEFINE l_isac004    LIKE isac_t.isac004 #161230-00036#1-add
   DEFINE l_isac008    LIKE isac_t.isac008 #161230-00036#1-add
   DEFINE l_vat_id     STRING              #161230-00036#1-add
   WHENEVER ERROR CONTINUE
   
   LET r_success = TRUE
   LET r_docno   = NULL
   INITIALIZE l_apga.* TO NULL
   #SELECT * INTO l_apga.* FROM apga_t WHERE apgaent = g_enterprise AND apgacomp = g_apcacomp AND apgadocno = g_apca_m.apca018 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgaent,apgaownid,apgaowndp,apgacrtid,apgacrtdp,
          apgacrtdt,apgamodid,apgamoddt,apgacnfid,apgacnfdt,
          apgapstid,apgapstdt,apgastus,apgacomp,apgadocno,
          apgadocdt,apga001,apga002,apga003,apga004,
          apga005,apga006,apga007,apga008,apga009,
          apga010,apga011,apga012,apga013,apga014,
          apga015,apga016,apga017,apga018,apga019,
          apga020,apga021,apga022,apga023,apga024,
          apga025,apga026,apga027,apga028,apga029,
          apga030,apga031,apga100,apga101,apga103,
          apga104,apga105,apga106,apga107,apga108,
          apga113,apga114,apga115,apgaud001,apgaud002,
          apgaud003,apgaud004,apgaud005,apgaud006,apgaud007,
          apgaud008,apgaud009,apgaud010,apgaud011,apgaud012,
          apgaud013,apgaud014,apgaud015,apgaud016,apgaud017,
          apgaud018,apgaud019,apgaud020,apgaud021,apgaud022,
          apgaud023,apgaud024,apgaud025,apgaud026,apgaud027,
          apgaud028,apgaud029,apgaud030,apga102,apga109,
          apga112,apga117,apga118,apga032,apga033,
          apga034,apga035,apga040,apga041,apga036,
          apga037,apga038,apga039 
     INTO l_apga.* 
     FROM apga_t 
    WHERE apgaent = g_enterprise 
      AND apgacomp = g_apcacomp 
      AND apgadocno = g_apca_m.apca018
   #161208-00026#13-add(e)
   
   INITIALIZE l_apca.* TO NULL
   LET l_apca.apcaent = g_enterprise
   LET l_apca.apcacomp = l_apga.apgacomp
   LET l_apca.apcald = NULL
   SELECT glaald,glaa001,glaa016,glaa020
     INTO l_apca.apcald,l_apca.apca100,l_apca.apca120,l_apca.apca130
     FROM glaa_t
    WHERE glaaent  = g_enterprise
      AND glaacomp = l_apca.apcacomp
      AND glaa014  = 'Y'
   LET l_apca.apcadocdt = g_apca_m.apcadocdt
   LET l_apca.apca003   = g_apca_m.apca003
   LET l_apca.apca016   = g_apca_m.apca016
   LET l_apca.apca018   = g_apca_m.apca018
   LET l_apca.apcadocno = g_apca_m.apcadocno
   CALL s_aooi200_fin_gen_docno(l_apca.apcald,'','',l_apca.apcadocno,l_apca.apcadocdt,'aapt560') 
      RETURNING g_sub_success,l_apca.apcadocno                                            
   IF NOT g_sub_success THEN
      LET r_success = FALSE
      RETURN r_success,r_docno
   END IF
   LET l_apca.apcastus  = 'N' # 狀態碼 
   LET l_apca.apcasite = l_apca.apcacomp   # 帳務中心                            apcasite   = apgccomp                                                    
   LET l_apca.apca001 =  '31'   #s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3001')
   LET l_apca.apca003 = g_user # 帳務人員                            apca003    = g_user                                                      
   LET l_apca.apca004 = l_apga.apga004 # 帳款對象編號                        apca004    = 廠商(受益人)apga004   
   CALL s_apmm100_sel_pmac002(l_apca.apca004,'1') RETURNING l_apca.apca005,l_desc
   IF cl_null(l_apca.apca005)THEN LET l_apca.apca005 = l_apca.apca004 END IF
   SELECT pmaa080,pmaa047 INTO l_apca.apca006,l_apca.apca046
     FROM pmaa_t
    WHERE pmaaent = g_enterprise AND pmaa001 = l_apca.apca004
   LET lc_param_apca.apcald   = l_apca.apcald
   LET lc_param_apca.apcacomp = l_apca.apcacomp
   LET lc_param_apca.apcasite = l_apca.apcasite
   LET lc_param_apca.apcadocdt= l_apca.apcadocdt
   #LET lc_param_apca.apca001  = l_apca.apca001
   LET lc_param_apca.apca001  = '19'
   LET lc_param_apca.apca004  = l_apca.apca004
   SELECT ooef019 INTO lc_param_apca.ooef019 FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = l_apca.apcacomp
   LET ls_js = util.JSON.stringify(lc_param_apca)
   CALL s_aapt300_get_apca004_info(ls_js) RETURNING ls_js
   CALL util.JSON.parse(ls_js,lc_param_info)
   LET l_apca.apca006 = lc_param_info.apca006  
   LET l_apca.apca007 = lc_param_info.apca007   # 帳款類別           apca007    = 廠商慣用條件
   LET l_apca.apca008 = lc_param_info.apca008   # 付款條件編號       apca008    = 取交易對象慣用付款條件
   LET l_apca.apca009 = lc_param_info.apca009   # 應付款日/應扣抵日  apca009    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca010 = lc_param_info.apca010   # 容許票據到期日     apca010    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca011 = lc_param_info.apca011   # 稅別               apca011    = 取交易對象慣用稅別,實際稅別在單身呈現
   LET l_apca.apca012 = lc_param_info.apca012   # 稅率               apca012    = 依稅別串 oodb006
   LET l_apca.apca013 = lc_param_info.apca013   # 含稅否             apca013    = 依稅別串 oodb005                   
   LET l_apca.apca014 = l_apga.apga005          # 人員編號           apca014    = apga005
   LET l_apca.apca015 = NULL                    # 部門編號           apca015    = apga005 所屬部門
   SELECT ooag003 INTO l_apca.apca015 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apca.apca014 
   LET l_apca.apca034 = lc_param_info.apca034   # 責任中心                            apca034    = 依 aapt300原則帶出      
   LET l_apca.apca035 = lc_param_info.apca035   # 應付(貸方)科目編號                  apca035    = 依帳款類別帶出           
   LET l_apca.apca036 = lc_param_info.apca036   # 費用(借方)科目編號                  apca036    = 依帳款類別帶出     
   LET l_apca.apca046 = lc_param_info.apca046       
   LET l_apca.apca054 = lc_param_info.apca054   # 多帳期設定                          apca054    = 依付款條件取出 
   LET l_apca.apca055 = lc_param_info.apca055   # 繳款優惠條件                        apca055    = 依付款條件取出 
   LET l_apca.apca058 = lc_param_info.apca058
   LET l_apca.apca060 = lc_param_info.apca060
   LET l_apca.apca016 = '31'
   LET l_apca.apca017 = '1'
   LET l_apca.apca018 = l_apga.apgadocno
   LET l_apca.apca020 = 'N'         # 信用狀付款否 
   LET l_apca.apca026 = 0
   LET l_apca.apca027 = 0
   LET l_apca.apca028 = 0
   LET l_apca.apca029 = 0
   LET l_apca.apca037 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-0030')# 產生傳票否                          apca037    = 取單別參數D-FIN-0030    
   LET l_apca.apca067 = l_apga.apgadocno
   LET l_apca.apca101 = 1
   LET l_apca.apca103 = 0
   LET l_apca.apca104 = 0
   LET l_apca.apca106 = 0 
   LET l_apca.apca107 = 0
   LET l_apca.apca108 = 0 
   LET l_apca.apca113 = 0
   LET l_apca.apca114 = 0 
   LET l_apca.apca116 = 0
   LEt l_apca.apca117 = 0 
   LET l_apca.apca118 = 0 
   LET lc_param2.apca004 = l_apca.apca004
   CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-3009') RETURNING lc_param2.sfin2009
   LET ls_js = util.JSON.stringify(lc_param2)   
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apca.apca100,ls_js)
        RETURNING l_apca.apca101,l_apca.apca121,l_apca.apca131
   LET l_apca.apca123 = 0
   LET l_apca.apca124 = 0
   LET l_apca.apca126 = 0 
   LET l_apca.apca127 = 0 
   LET l_apca.apca128 = 0
   LET l_apca.apca133 = 0 
   LET l_apca.apca134 = 0 
   LET l_apca.apca136 = 0 
   LET l_apca.apca137 = 0
   LET l_apca.apca138 = 0 
   LET l_apca.apca071 = 0
   LET l_apca.apca072 = 0
   #albireo 160624-----s
   LEt l_apca.apca073 = l_apga.apga001
   LET l_apca.apcaownid = g_user
   LET l_apca.apcaowndp = g_dept
   LET l_apca.apcacrtid = g_user
   LET l_apca.apcacrtdp = g_dept
   LET l_date = cl_get_current()
   LET l_apca.apcacrtdt = l_date
   #albireo 160624-----e
   #INSERT INTO apca_t VALUES(l_apca.*) #161108-00017#4 mark
   #161108-00017#4 add ------
   INSERT INTO apca_t (apcaent,apcaownid,apcaowndp,apcacrtid,apcacrtdp,
                       apcacrtdt,apcamodid,apcamoddt,apcacnfid,apcacnfdt,
                       apcapstid,apcapstdt,apcastus,apcald,apcacomp,
                       apcadocno,apcadocdt,apcasite,
                       apca001,apca003,apca004,apca005,apca006,
                       apca007,apca008,apca009,apca010,apca011,
                       apca012,apca013,apca014,apca015,apca016,
                       apca017,apca018,apca019,apca020,apca021,
                       apca022,apca025,apca026,apca027,apca028,
                       apca029,apca030,apca031,apca032,apca033,
                       apca034,apca035,apca036,apca037,apca038,
                       apca039,apca040,apca041,apca042,apca043,
                       apca044,apca045,apca046,apca047,apca048,
                       apca049,apca050,apca051,apca052,apca053,
                       apca054,apca055,apca056,apca057,apca058,
                       apca059,apca060,apca061,apca062,apca063,
                       apca064,apca065,apca066,apca100,apca101,
                       apca103,apca104,apca106,apca107,apca108,
                       apca113,apca114,apca116,apca117,apca118,
                       apca120,apca121,apca123,apca124,apca126,
                       apca127,apca128,apca130,apca131,apca133,
                       apca134,apca136,apca137,apca138,
                       apcaud001,apcaud002,apcaud003,apcaud004,apcaud005,
                       apcaud006,apcaud007,apcaud008,apcaud009,apcaud010,
                       apcaud011,apcaud012,apcaud013,apcaud014,apcaud015,
                       apcaud016,apcaud017,apcaud018,apcaud019,apcaud020,
                       apcaud021,apcaud022,apcaud023,apcaud024,apcaud025,
                       apcaud026,apcaud027,apcaud028,apcaud029,apcaud030,
                       apca067,apca068,apca069,apca070,apca071,
                       apca072,apca073
                      )
   VALUES (l_apca.apcaent,l_apca.apcaownid,l_apca.apcaowndp,l_apca.apcacrtid,l_apca.apcacrtdp,
           l_apca.apcacrtdt,l_apca.apcamodid,l_apca.apcamoddt,l_apca.apcacnfid,l_apca.apcacnfdt,
           l_apca.apcapstid,l_apca.apcapstdt,l_apca.apcastus,l_apca.apcald,l_apca.apcacomp,
           l_apca.apcadocno,l_apca.apcadocdt,l_apca.apcasite,
           l_apca.apca001,l_apca.apca003,l_apca.apca004,l_apca.apca005,l_apca.apca006,
           l_apca.apca007,l_apca.apca008,l_apca.apca009,l_apca.apca010,l_apca.apca011,
           l_apca.apca012,l_apca.apca013,l_apca.apca014,l_apca.apca015,l_apca.apca016,
           l_apca.apca017,l_apca.apca018,l_apca.apca019,l_apca.apca020,l_apca.apca021,
           l_apca.apca022,l_apca.apca025,l_apca.apca026,l_apca.apca027,l_apca.apca028,
           l_apca.apca029,l_apca.apca030,l_apca.apca031,l_apca.apca032,l_apca.apca033,
           l_apca.apca034,l_apca.apca035,l_apca.apca036,l_apca.apca037,l_apca.apca038,
           l_apca.apca039,l_apca.apca040,l_apca.apca041,l_apca.apca042,l_apca.apca043,
           l_apca.apca044,l_apca.apca045,l_apca.apca046,l_apca.apca047,l_apca.apca048,
           l_apca.apca049,l_apca.apca050,l_apca.apca051,l_apca.apca052,l_apca.apca053,
           l_apca.apca054,l_apca.apca055,l_apca.apca056,l_apca.apca057,l_apca.apca058,
           l_apca.apca059,l_apca.apca060,l_apca.apca061,l_apca.apca062,l_apca.apca063,
           l_apca.apca064,l_apca.apca065,l_apca.apca066,l_apca.apca100,l_apca.apca101,
           l_apca.apca103,l_apca.apca104,l_apca.apca106,l_apca.apca107,l_apca.apca108,
           l_apca.apca113,l_apca.apca114,l_apca.apca116,l_apca.apca117,l_apca.apca118,
           l_apca.apca120,l_apca.apca121,l_apca.apca123,l_apca.apca124,l_apca.apca126,
           l_apca.apca127,l_apca.apca128,l_apca.apca130,l_apca.apca131,l_apca.apca133,
           l_apca.apca134,l_apca.apca136,l_apca.apca137,l_apca.apca138,
           l_apca.apcaud001,l_apca.apcaud002,l_apca.apcaud003,l_apca.apcaud004,l_apca.apcaud005,
           l_apca.apcaud006,l_apca.apcaud007,l_apca.apcaud008,l_apca.apcaud009,l_apca.apcaud010,
           l_apca.apcaud011,l_apca.apcaud012,l_apca.apcaud013,l_apca.apcaud014,l_apca.apcaud015,
           l_apca.apcaud016,l_apca.apcaud017,l_apca.apcaud018,l_apca.apcaud019,l_apca.apcaud020,
           l_apca.apcaud021,l_apca.apcaud022,l_apca.apcaud023,l_apca.apcaud024,l_apca.apcaud025,
           l_apca.apcaud026,l_apca.apcaud027,l_apca.apcaud028,l_apca.apcaud029,l_apca.apcaud030,
           l_apca.apca067,l_apca.apca068,l_apca.apca069,l_apca.apca070,l_apca.apca071,
           l_apca.apca072,l_apca.apca073
          )
   #161108-00017#4 add end---
   
   #apgc產生 apcb xrcd_t
   #LET l_sql = "SELECT * FROM apgc_t ",     #161208-00026#13 mark
   #161208-00026#13-add(s)
   LET l_sql = "SELECT apgcent,apgccomp,apgcdocno,apgcseq,apgc900,
                       apgcorga,apgc001,apgc002,apgc003,apgc004,
                       apgc005,apgc006,apgc007,apgc008,apgc009,
                       apgc010,apgc011,apgc012,apgc013,apgc014,
                       apgc015,apgc016,apgc100,apgc101,apgc103,
                       apgc104,apgc105,apgc113,apgc114,apgc115,
                       apgcud001,apgcud002,apgcud003,apgcud004,apgcud005,
                       apgcud006,apgcud007,apgcud008,apgcud009,apgcud010,
                       apgcud011,apgcud012,apgcud013,apgcud014,apgcud015,
                       apgcud016,apgcud017,apgcud018,apgcud019,apgcud020,
                       apgcud021,apgcud022,apgcud023,apgcud024,apgcud025,
                       apgcud026,apgcud027,apgcud028,apgcud029,apgcud030 
                  FROM apgc_t ",
   #161208-00026#13-add(e)
               " WHERE apgcent = ",g_enterprise,
               "   AND apgccomp = '",l_apga.apgacomp,"'",
               "   AND apgcdocno = '",l_apga.apgadocno,"'",
               "   AND apgc900 = '0'"
   PREPARE sel_apgcp1 FROM l_sql
   DECLARE sel_apgcc1 CURSOR FOR sel_apgcp1
   #FOREACH sel_apgcc1 INTO l_apgc.*   #161208-00026#13 mark
   #161208-00026#13-add(s)
   FOREACH sel_apgcc1 INTO l_apgc.apgcent,l_apgc.apgccomp,l_apgc.apgcdocno,l_apgc.apgcseq,l_apgc.apgc900,
                           l_apgc.apgcorga,l_apgc.apgc001,l_apgc.apgc002,l_apgc.apgc003,l_apgc.apgc004,
                           l_apgc.apgc005,l_apgc.apgc006,l_apgc.apgc007,l_apgc.apgc008,l_apgc.apgc009,
                           l_apgc.apgc010,l_apgc.apgc011,l_apgc.apgc012,l_apgc.apgc013,l_apgc.apgc014,
                           l_apgc.apgc015,l_apgc.apgc016,l_apgc.apgc100,l_apgc.apgc101,l_apgc.apgc103,
                           l_apgc.apgc104,l_apgc.apgc105,l_apgc.apgc113,l_apgc.apgc114,l_apgc.apgc115,
                           l_apgc.apgcud001,l_apgc.apgcud002,l_apgc.apgcud003,l_apgc.apgcud004,l_apgc.apgcud005,
                           l_apgc.apgcud006,l_apgc.apgcud007,l_apgc.apgcud008,l_apgc.apgcud009,l_apgc.apgcud010,
                           l_apgc.apgcud011,l_apgc.apgcud012,l_apgc.apgcud013,l_apgc.apgcud014,l_apgc.apgcud015,
                           l_apgc.apgcud016,l_apgc.apgcud017,l_apgc.apgcud018,l_apgc.apgcud019,l_apgc.apgcud020,
                           l_apgc.apgcud021,l_apgc.apgcud022,l_apgc.apgcud023,l_apgc.apgcud024,l_apgc.apgcud025,
                           l_apgc.apgcud026,l_apgc.apgcud027,l_apgc.apgcud028,l_apgc.apgcud029,l_apgc.apgcud030 
   #161208-00026#13-add(e)
      IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
      #r2.產生apcb-----s
      INITIALIZE l_apcb.* TO NULL
      LET l_apcb.apcbent   = g_enterprise
      LET l_apcb.apcbld    = l_apca.apcald
      LET l_apcb.apcblegl  = l_apca.apcacomp
      LET l_apcb.apcbsite  = l_apca.apcasite
      LET l_apcb.apcbdocno = l_apca.apcadocno
      LET l_apcb.apcbseq   = NULL
      SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
       WHERE apcbent   = g_enterprise
         AND apcbld    = l_apcb.apcbld
         AND apcbdocno = l_apcb.apcbdocno
      IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
      LET l_apcb.apcb001 = '54'
      LET l_apcb.apcb002 = l_apgc.apgcdocno
      LET l_apcb.apcb003 = l_apgc.apgcseq
      LET l_apcb.apcb014 = l_apgc.apgc001 #160428-00001#8 
      LET l_apcb.apcb005 = s_desc_get_acc_desc('3117',l_apgc.apgc001)
      LET l_apcb.apcb006 = ' '
      LET l_apcb.apcb007 = 1
      LET l_apcb.apcb010 = l_apca.apca015
      CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                       RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
      LET l_apcb.apcb020 = l_apgc.apgc006
      LET l_apcb.apcb021 = l_apgc.apgc004
      LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')   #albireo 160624 add
      LET l_apcb.apcb023 = 'N'
      LET l_apcb.apcb027 = l_apgc.apgc008
      LET l_apcb.apcb028 = l_apgc.apgc009
      LET l_apcb.apcb029 = l_apca.apca035
      LET l_apcb.apcb030 = l_apca.apca008
      LET l_apcb.apcb051 = l_apca.apca014
      LET l_apcb.apcb100 = l_apgc.apgc100
      LET l_apcb.apcb101 = l_apgc.apgc105   #albireo 160623 add
      LET l_apcb.apcb102 = l_apgc.apgc101
      LET l_apcb.apcb103 = l_apgc.apgc103
      LET l_apcb.apcb104 = l_apgc.apgc104
      LET l_apcb.apcb105 = l_apgc.apgc105
      LET l_apcb.apcb108 = l_apcb.apcb103
      LET l_apcb.apcb111 = l_apgc.apgc115   #albireo 160623 add
      LET l_apcb.apcb113 = l_apgc.apgc113
      LET l_apcb.apcb114 = l_apgc.apgc114
      LET l_apcb.apcb115 = l_apgc.apgc115
      LET l_apcb.apcborga = l_apgc.apgcorga
      CALL s_tax_chk(l_apca.apcacomp,l_apcb.apcb020) RETURNING g_sub_success,l_oodb004,l_apca013,l_apca012,l_oodb011
      IF l_apca013 = 'Y' THEN
         LET l_apcb.apcb105 = l_apcb.apcb105
      ELSE
         LET l_apcb.apcb105 = l_apcb.apcb103
      END IF
      CALL s_tax_ins(l_apca.apcadocno,l_apcb.apcbseq,'0',l_apcb.apcborga,l_apcb.apcb105,
                     l_apcb.apcb020,l_apcb.apcb007,l_apcb.apcb100,l_apcb.apcb102,l_apca.apcald,l_apca.apca121,l_apca.apca131)   #albireo 160630
           RETURNING l_apcb.apcb103,l_apcb.apcb104,l_apcb.apcb105,
                     l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,
                     l_apcb.apcb123,l_apcb.apcb124,l_apcb.apcb125,
                     l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         EXIT FOREACH
         LET r_success = FALSE
      END IF
      #r2.產生apcb-----e
      
      #r3.產生直接付款apde-----s
      INITIALIZE l_apde.* TO NULL
      LET l_apde.apdeent  =l_apca.apcaent
      LET l_apde.apdeld =l_apca.apcald
      LET l_apde.apdecomp =l_apca.apcacomp
      LET l_apde.apdeorga =l_apca.apcacomp
      LET l_apde.apdesite =l_apca.apcasite
      LET l_apde.apdedocno =l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
      IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
      LET l_apde.apdeseq = l_apde.apdeseq + 1
      LET l_apde.apde001 = 'aapt560'
      LET l_apde.apde009 = 'Y'
      LET l_apde.apde028 = '0'
      LET l_apde.apde002 = '10'
      LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'3')
      #以判斷完匯兌損失/匯兌收益,將金額轉正顯示
      LET l_apde.apde109 =  l_apgc.apgc105
      LET l_apde.apde119 =  l_apgc.apgc115
      LET l_apde.apde006 = '10'   
      #銀行存提碼
      LET l_apde.apde011 = l_apgc.apgc015
      #現金變動碼
      LET l_apde.apde012 = l_apgc.apgc016
      LET l_apde.apde013 = ''
      LET l_apde.apde014 = ''
      LET l_apde.apde016 = ''
      LET l_apde.apde100 = l_apgc.apgc100
      LET l_apde.apde101 = l_apgc.apgc101
      LET l_apde.apde039 = l_apga.apga007
      LET l_apde.apde041 = NULL
      SELECT nmabl003 INTO l_apde.apde041
        FROM nmabl_t
       WHERE nmablent = g_enterprise
         AND nmabl001 = l_apde.apde039
         AND nmabl002 = g_dlang
      IF cl_null(l_apde.apde101) THEN LET l_apde.apde101 = 1 END IF
      LET l_apde.apde032 = l_apca.apcadocdt
      LET l_apde.apde061 = '54'
      #LET l_apde.apde016 = l_apgc.apgc004
      LET l_apde.apde008 = l_apgc.apgc014
      CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
      INSERT INTO apde_t(apdeent,
                         apdeld,apdecomp,apdesite,apdedocno,apdeseq,
                         apde001,apde009,apde028,apde002,apde015,
                         apde003,apde004,apdeorga,apde006,apde011,
                         apde012,apde013,apde014,apde016,apde017,
                         apde018,apde021,apde032,apde100,apde101,
                         apde039,apde040,apde041,
                         apde008,
                         apde109,apde119,apde061)
             VALUES(l_apde.apdeent,
                    l_apde.apdeld,l_apde.apdecomp,l_apde.apdesite,l_apde.apdedocno,l_apde.apdeseq,
                    l_apde.apde001,l_apde.apde009,l_apde.apde028,l_apde.apde002,l_apde.apde015,
                    l_apde.apde003,l_apde.apde004,l_apde.apdeorga,l_apde.apde006,l_apde.apde011,
                    l_apde.apde012,l_apde.apde013,l_apde.apde014,l_apde.apde016,l_apde.apde017,
                    l_apde.apde018,l_apde.apde021,l_apde.apde032,l_apde.apde100,l_apde.apde101,
                    l_apde.apde039,l_apde.apde040,l_apde.apde041,
                    l_apde.apde008,
                    l_apde.apde109,l_apde.apde119,l_apde.apde061)
      IF SQLCA.SQLCODE THEN LET r_success = FALSE EXIT FOREACH END IF
      #r3.產生直接付款apde-----e
      
      #INSERT isam
      INITIALIZE l_isam.* TO NULL
      LET l_isam.isament = l_apca.apcaent
      LET l_isam.isamdocno = l_apca.apcadocno
      SELECT MAX(isamseq)+1 INTO l_isam.isamseq
        FROM isam_t
       WHERE isament = g_enterprise
         AND isamdocno = l_apca.apcadocno
         AND isam001 = 'aapt560'
      IF cl_null(l_isam.isamseq)THEN LET l_isam.isamseq = 1 END IF
      LET l_isam.isam001 = 'aapt560'
      LET l_isam.isam002 = l_apca.apca004                           
      LET l_isam.isam008 = l_apgc.apgc007                           
      LET l_isam.isam009 = l_apgc.apgc008                           
      LET l_isam.isam010 = l_apgc.apgc009                           
      LET l_isam.isam011 = l_apgc.apgc010                           
      LET l_isam.isam012 = l_apgc.apgc006        
      LET l_isam.isam0121= l_apca.apca013                  
      LET l_isam.isam013 = l_apca.apca012
      LET l_isam.isam014 = l_apgc.apgc100                           
      LET l_isam.isam015 = l_apgc.apgc101                           
      LET l_isam.isam016 = l_ooefl006
      LET l_isam.isam017 = l_ooef002
      CALL s_aapp320_buy_info(l_apca.apcacomp)RETURNING l_pmaal003,l_isao001,      
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021
      LET l_isam.isam023 = l_apgc.apgc103                           
      LET l_isam.isam024 = l_apgc.apgc104                           
      LET l_isam.isam025 = l_apgc.apgc105                           
      LET l_isam.isam026 = l_apgc.apgc113                           
      LET l_isam.isam027 = l_apgc.apgc114                           
      LET l_isam.isam028 = l_apgc.apgc115                           
      LET l_isam.isam029 = s_desc_get_trading_partner_abbr_desc(l_apca.apca004)  

      SELECT isak008,isak009,isak010,isak011,isak012
        INTO l_isam.isam030,l_isam.isam031,l_isam.isam032,
             l_isam.isam033,l_isam.isam034
        FROM isak_t
       WHERE isakent = g_enterprise
         AND isak001 = l_apca.apca004
         AND isak002 = lc_param_apca.ooef019
      #161129-00042#1-add(s)            #161230-00036#1 mark(s)
      ##先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
      #LET l_ooef011 = ' '
      #SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
      #IF l_ooef011 = 'TW' THEN
      #   CALL s_rule_chk_vat_id_string(l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET r_success = FALSE
      #      RETURN r_success,r_docno
      #   END IF  
      #   #檢查營利事業統一編號邏輯，錯了下方提示不控卡
      #   CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET l_isam.isam030 = l_isam.isam030
      #   END IF
      #END IF
      #161129-00042#1-add(e)                 #161230-00036#1 mark(e)
      LET l_isam.isam035 = '1'                                 
      LET l_isam.isam036 = '11'                                
      LET l_isam.isam037 = l_apgc.apgc011                           
      LET l_isam.isam050 = l_apca.apcadocno                         
      LET l_isam.isam107    = 0                                 
      LET l_isam.isam108    = 0                                 
      LET l_isam.isam117    = 0                                 
      LET l_isam.isam118    = 0
      IF NOT cl_null(l_isam.isam010)THEN
         #161230-00036#1 add(s)
         LET l_isac004 = ''
         LET l_isac008 = ''
         SELECT isac004,isac008 INTO l_isac004,l_isac008 FROM isac_t WHERE isacent = g_enterprise 
            AND isac002 = l_isam.isam008 AND isac001 = lc_param_apca.ooef019
         #IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) THEN                                              #170218-00012#1 mark
         IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) AND l_isac004 != '28' AND l_isac004 != '29' THEN   #170218-00012#1 add         
            #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
            LET l_ooef011 = ' '
            SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
            IF l_ooef011 = 'TW' THEN
               IF NOT cl_null(l_isam.isam030) THEN   #170218-00012#1 add
                  LET l_vat_id = l_isam.isam030
                  IF l_vat_id.getLength() <> 8  THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF         
                  IF NOT cl_chk_num(l_isam.isam030,'N') THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF
                  #檢查營利事業統一編號邏輯，錯了下方提示不控卡
                  CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
                  IF NOT g_sub_success THEN
                     LET l_isam.isam030 = l_isam.isam030
                  END IF
               END IF   #170218-00012#1 add
            END IF
         END IF            
         #161230-00036#1 add(e)
         #INSERT INTO isam_t VALUES(l_isam.*)   #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO isam_t (isament,isamownid,isamowndp,isamcrtid,isamcrtdp,
                             isamcrtdt,isammodid,isammoddt,isamcnfid,isamcnfdt,
                             isamstus,isamcomp,isamdocno,isamseq,
                             isam001,isam002,isam004,isam006,isam008,
                             isam009,isam010,isam011,isam012,isam0121,
                             isam013,isam014,isam015,isam016,isam017,
                             isam018,isam019,isam020,isam021,isam022,
                             isam023,isam024,isam025,isam026,isam027,
                             isam028,isam029,isam030,isam031,isam032,
                             isam033,isam034,isam035,isam036,isam037,
                             isam038,isam039,isam040,isam041,isam042,
                             isam043,isam044,isam045,isam046,isam047,
                             isam048,isam049,isam050,isam107,isam108,
                             isam117,isam118,isam200,isam201,isam202,
                             isam203,isam204,isam205,isam206,isam207,
                             isam208,isam209,isam210,
                             isamud001,isamud002,isamud003,isamud004,isamud005,
                             isamud006,isamud007,isamud008,isamud009,isamud010,
                             isamud011,isamud012,isamud013,isamud014,isamud015,
                             isamud016,isamud017,isamud018,isamud019,isamud020,
                             isamud021,isamud022,isamud023,isamud024,isamud025,
                             isamud026,isamud027,isamud028,isamud029,isamud030,
                             isam051
                            )
         VALUES (l_isam.isament,l_isam.isamownid,l_isam.isamowndp,l_isam.isamcrtid,l_isam.isamcrtdp,
                 l_isam.isamcrtdt,l_isam.isammodid,l_isam.isammoddt,l_isam.isamcnfid,l_isam.isamcnfdt,
                 l_isam.isamstus,l_isam.isamcomp,l_isam.isamdocno,l_isam.isamseq,
                 l_isam.isam001,l_isam.isam002,l_isam.isam004,l_isam.isam006,l_isam.isam008,
                 l_isam.isam009,l_isam.isam010,l_isam.isam011,l_isam.isam012,l_isam.isam0121,
                 l_isam.isam013,l_isam.isam014,l_isam.isam015,l_isam.isam016,l_isam.isam017,
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021,l_isam.isam022,
                 l_isam.isam023,l_isam.isam024,l_isam.isam025,l_isam.isam026,l_isam.isam027,
                 l_isam.isam028,l_isam.isam029,l_isam.isam030,l_isam.isam031,l_isam.isam032,
                 l_isam.isam033,l_isam.isam034,l_isam.isam035,l_isam.isam036,l_isam.isam037,
                 l_isam.isam038,l_isam.isam039,l_isam.isam040,l_isam.isam041,l_isam.isam042,
                 l_isam.isam043,l_isam.isam044,l_isam.isam045,l_isam.isam046,l_isam.isam047,
                 l_isam.isam048,l_isam.isam049,l_isam.isam050,l_isam.isam107,l_isam.isam108,
                 l_isam.isam117,l_isam.isam118,l_isam.isam200,l_isam.isam201,l_isam.isam202,
                 l_isam.isam203,l_isam.isam204,l_isam.isam205,l_isam.isam206,l_isam.isam207,
                 l_isam.isam208,l_isam.isam209,l_isam.isam210,
                 l_isam.isamud001,l_isam.isamud002,l_isam.isamud003,l_isam.isamud004,l_isam.isamud005,
                 l_isam.isamud006,l_isam.isamud007,l_isam.isamud008,l_isam.isamud009,l_isam.isamud010,
                 l_isam.isamud011,l_isam.isamud012,l_isam.isamud013,l_isam.isamud014,l_isam.isamud015,
                 l_isam.isamud016,l_isam.isamud017,l_isam.isamud018,l_isam.isamud019,l_isam.isamud020,
                 l_isam.isamud021,l_isam.isamud022,l_isam.isamud023,l_isam.isamud024,l_isam.isamud025,
                 l_isam.isamud026,l_isam.isamud027,l_isam.isamud028,l_isam.isamud029,l_isam.isamud030,
                 l_isam.isam051
                )
         #161108-00017#4 add end---
      END IF
   END FOREACH
   
   #161004-00019#1-----s
   CALL s_fin_get_account(l_apca.apcald,'13',l_apca.apca007,'8504_04') RETURNING g_sub_success,l_xrcd009,g_errno
   UPDATE xrcd_t SET xrcd009 = l_xrcd009
    WHERE xrcdent= g_enterprise
      AND xrcdld = l_apca.apcald AND xrcddocno = l_apca.apcadocno
      AND xrcd009 IS NULL
   #161004-00019#1-----e
   
   
   LET l_pmab055 = NULL
   SELECT pmab055 INTO l_pmab055 FROM pmab_t
    WHERE pmabsite = l_apca.apcacomp
      AND pmab001 = l_apca.apca004
      AND pmabent = g_enterprise
   
   #自備款-----s
   IF l_apga.apga026 = 'Y' THEN   #albireo 160711 add
      LET l_glaa121 = NULL LET l_glaa016 = NULL
      LET l_glaa020 = NULL LET l_glaa019 = NULL
      LET l_glaa015 = NULL
      SELECT glaa121,glaa016,glaa020 ,
             glaa015,glaa019,
             glaa001  #161228-00062#1 add
        INTO l_glaa121,l_glaa016,l_glaa020,
             l_glaa015,l_glaa019,
             l_glaa001 #161228-00062#1 add
        FROM glaa_t
       WHERE glaaent = g_enterprise
         AND glaald = l_apca.apcald
      
      
      INITIALIZE l_apde.* TO NULL
      LET l_apde.apdeent   = g_enterprise
      LET l_apde.apdecomp  = l_apca.apcacomp
      LET l_apde.apdeld    = l_apca.apcald
      LET l_apde.apdedocno = l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
      #albireo 160624-----s
      IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
      LET l_apde.apdeseq = l_apde.apdeseq + 1
      #albireo 160624-----e
      LET l_apde.apdesite  = l_apca.apcasite
      LET l_apde.apdeorga  = l_apca.apcasite
      LET l_apde.apde001   = 'aapt560'
      LET l_apde.apde002   = '23'
      LET l_apde.apde006   = '10'
      LET l_apde.apde008   = l_apga.apga040
      LET l_apde.apde009 = 'Y'
      LET l_apde.apde011 = l_apga.apga036
      LET l_apde.apde012 = l_apga.apga037
      LET l_apde.apde014 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
      LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
      LET l_apde.apde016 = NULL
      #SELECT glab005 INTO l_apde.apde016 FROM glab_t
      # WHERE glabent = g_enterprise
      #   AND glabld = l_apde.apdeld
      #   AND glab001 = '13'
      #   AND glab002 = l_pmab055
      #   AND glab003 = '8504_31'
      CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
         RETURNING l_apde.apde016   #albireo 160630 add
      
      LET l_apde.apde017 = l_apga.apga005
      LET l_apde.apde018 = NULL
      SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
       WHERE ooagent = g_enterprise
         AND ooag001 = l_apde.apde017
      #LET l_apde.apde019 =          
      CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
                 RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
      LET l_apde.apde028 = '2'
      LET l_apde.apde032 = l_apga.apga003
      LET l_apde.apde038 = l_apca.apca004
      LET l_apde.apde039 = l_apga.apga007
      SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
       WHERE nmablent = g_enterprise
         AND nmabl001 = l_apde.apde039
         AND nmabl002 = g_dlang
      LET l_apde.apde100 = l_apga.apga100
      LET l_apde.apde101 = l_apga.apga101
      LET l_apde.apde104 = 0 
      LET l_apde.apde109 = l_apga.apga104
      #LET l_apde.apde119 = l_apde.apde109 * l_apde.apde101
      LET l_apde.apde119 = l_apga.apga114
      #s_curr_round
      CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
      LET lc_param2.apca004 = l_apca.apca004
      LET ls_js = util.JSON.stringify(lc_param2)
      CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
           RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
      #s_curr_round
      LET l_apde.apde101 = l_apga.apga101
      LET l_apde.apde120 = l_apca.apca120
      
      IF l_glaa015 = 'Y' THEN
         LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
         CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
      END IF
      
      LET l_apde.apde130 = l_apca.apca130
      IF l_glaa019 = 'Y' THEN
         LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
         CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
      END IF
      LET l_apde.apde061 = '51'
      IF l_apde.apde109 > 0 THEN
         #INSERT INTO apde_t VALUES(l_apde.*)  #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                             apdesite,apdeorga,
                             apde001,apde002,apde003,apde004,apde006,
                             apde008,apde009,apde010,apde011,apde012,
                             apde013,apde014,apde015,apde016,apde017,
                             apde018,apde019,apde020,apde021,apde022,
                             apde023,apde024,apde028,apde029,apde030,
                             apde032,apde035,apde036,apde038,apde039,
                             apde040,apde041,apde042,apde043,apde044,
                             apde045,apde046,apde047,apde051,apde052,
                             apde053,apde054,apde055,apde056,apde057,
                             apde058,apde059,apde060,apde100,apde101,
                             apde104,apde109,apde119,apde120,apde121,
                             apde129,apde130,apde131,apde139,
                             apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                             apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                             apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                             apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                             apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                             apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                             apde061
                            )
         VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
                 l_apde.apdesite,l_apde.apdeorga,
                 l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
                 l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
                 l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
                 l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
                 l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
                 l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
                 l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
                 l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
                 l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
                 l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
                 l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
                 l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
                 l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
                 l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
                 l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
                 l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
                 l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
                 l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
                 l_apde.apde061
                )
         #161108-00017#4 add end---
      END IF
      
      INITIALIZE l_apcb.* TO NULL
      LET l_apcb.apcbent   = g_enterprise
      LET l_apcb.apcbld    = l_apca.apcald
      LET l_apcb.apcblegl  = l_apca.apcacomp
      LET l_apcb.apcbsite  = l_apca.apcasite
      LET l_apcb.apcbdocno = l_apca.apcadocno
      LET l_apcb.apcbseq   = NULL
      SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
       WHERE apcbent   = g_enterprise
         AND apcbld    = l_apcb.apcbld
         AND apcbdocno = l_apcb.apcbdocno
      IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
      LET l_apcb.apcb001 = '51'
      LET l_apcb.apcb002 = l_apga.apgadocno
      LET l_apcb.apcb003 = 0
      
      LET l_apcb.apcb006 = ' '
      LET l_apcb.apcb007 = 1
      LET l_apcb.apcb010 = l_apca.apca015
      CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                       RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
      LET l_apcb.apcb020 = ''
      #LET l_apcb.apcb021 = l_apgc.apgc004
      SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
       WHERE glabent = g_enterprise
         AND glabld = l_apde.apdeld
         AND glab001 = '15'      #albireo 160630
         AND glab002 = '3117'    #albireo 160630
         AND glab003 = '8504_32' #albireo 1606301
      LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
      LET l_apcb.apcb023 = 'N'
      #LET l_apcb.apcb027 = l_apgc.apgc008
      #LET l_apcb.apcb028 = l_apgc.apgc009
      LET l_apcb.apcb029 = l_apca.apca035
      LET l_apcb.apcb030 = l_apca.apca008
      LET l_apcb.apcb051 = l_apca.apca014
      LET l_apcb.apcb100 = l_apga.apga100   #albireo 160630
      LET l_apcb.apcb101 = l_apga.apga104   #albireo 160624 
      LET l_apcb.apcb102 = l_apga.apga101   #albireo 160630
      LET l_apcb.apcb103 = l_apga.apga104
      LET l_apcb.apcb104 = 0
      LET l_apcb.apcb105 = l_apga.apga104
      LET l_apcb.apcb108 = l_apga.apga104
      LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
      LET l_apcb.apcb113 = l_apga.apga114
      LET l_apcb.apcb114 = 0
      LET l_apcb.apcb115 = l_apga.apga114
      LET l_apcb.apcborga = l_apca.apcacomp
      LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
      LET l_apcb.apcb124 = 0
      LET l_apcb.apcb125 = l_apcb.apcb125
      LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
      LET l_apcb.apcb134 = 0
      LET l_apcb.apcb135 = l_apcb.apcb135
      IF l_apcb.apcb115 > 0 THEN
         #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                             apcbdocno,apcbseq,
                             apcb001,apcb002,apcb003,apcb004,apcb005,
                             apcb006,apcb007,apcb008,apcb009,apcb010,
                             apcb011,apcb012,apcb013,apcb014,apcb015,
                             apcb016,apcb017,apcb018,apcb019,apcb020,
                             apcb021,apcb022,apcb023,apcb024,apcb025,
                             apcb026,apcb027,apcb028,apcb029,apcb030,
                             apcb032,apcb033,apcb034,apcb035,apcb036,
                             apcb037,apcb038,apcb039,apcb040,apcb041,
                             apcb042,apcb043,apcb044,apcb045,apcb046,
                             apcb047,apcb048,apcb049,apcb050,apcb051,
                             apcb100,apcb101,apcb102,apcb103,apcb104,
                             apcb105,apcb106,apcb107,apcb108,apcb111,
                             apcb113,apcb114,apcb115,apcb116,apcb117,
                             apcb118,apcb119,apcb121,apcb123,apcb124,
                             apcb125,apcb126,apcb127,apcb128,apcb131,
                             apcb133,apcb134,apcb135,apcb136,apcb137,
                             apcb138,
                             apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                             apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                             apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                             apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                             apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                             apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                             apcb052,apcb053,apcb054,apcb055
                            )
         VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
                 l_apcb.apcbdocno,l_apcb.apcbseq,
                 l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
                 l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
                 l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
                 l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
                 l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
                 l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
                 l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
                 l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
                 l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
                 l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
                 l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
                 l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
                 l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
                 l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
                 l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
                 l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
                 l_apcb.apcb138,
                 l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
                 l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
                 l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
                 l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
                 l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
                 l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
                 l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
                )
         #161108-00017#4 add end---
         IF SQLCA.SQLCODE THEN
            LET r_success = FALSE
         END IF
      END IF
   END IF    #albireo 160711
   #自備款-----e
   
   #保證金-----s
   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
   SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
    WHERE apdeent   = l_apde.apdeent
      AND apdeld    = l_apde.apdeld
      AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '23'
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apga.apga034    #albireo 160630
   LET l_apde.apde012 = l_apga.apga035    #albireo 160630
   LET l_apde.apde014 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '13'
   #   AND glab002 = l_pmab055
   #   AND glab003 = '8504_32'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang
   LET l_apde.apde100 = l_apga.apga100
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apga.apga108   #albireo 1606301
   #LET l_apde.apde119 = l_apde.apde109 * l_apde.apde101
   LET l_apde.apde119 = l_apga.apga118
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '52'
   IF l_apde.apde109 > 0 THEN
      #INSERT INTO apde_t VALUES(l_apde.*)  #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF
   
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '52'
   LET l_apcb.apcb002 = l_apga.apgadocno
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
    WHERE glabent = g_enterprise
      AND glabld = l_apde.apdeld
      AND glab001 = '15'     #albireo 160630
      AND glab002 = '3117'   #albireo 160630
      AND glab003 = '8504_31'#albireo 1606301
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apga.apga100   #albireo 160630
   LET l_apcb.apcb101 = l_apga.apga108   #160624 albireo
   LET l_apcb.apcb102 = l_apga.apga101   #albireo 160630
   LET l_apcb.apcb103 = l_apga.apga108
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apga.apga108
   LET l_apcb.apcb108 = l_apga.apga108
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apga.apga118
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apga.apga118
   LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   LET l_apcb.apcb124 = 0
   LET l_apcb.apcb125 = l_apcb.apcb125
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   LET l_apcb.apcb134 = 0
   LET l_apcb.apcb135 = l_apcb.apcb135
   
   IF l_apcb.apcb115 > 0 THEN
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF
   #保證金-----e
   
   #預付款-----s
   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
   SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
    WHERE apdeent   = l_apde.apdeent
      AND apdeld    = l_apde.apdeld
      AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '23'
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apga.apga038    #albireo 160630
   LET l_apde.apde012 = l_apga.apga039    #albireo 160630
   LET l_apde.apde014 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '15'   #albireo 160630
   #   AND glab002 = '3117' #albireo 160630
   #   AND glab003 = '8504_33'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang
   LET l_apde.apde100 = l_apga.apga100
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apga.apga102
   #LET l_apde.apde119 = l_apde.apde109 * l_apde.apde101
   LEt l_apde.apde119 = l_apga.apga112
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '53'
   IF l_apde.apde109 > 0 THEN
      #INSERT INTO apde_t VALUES(l_apde.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF
   
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '53'
   LET l_apcb.apcb002 = l_apga.apgadocno
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
    WHERE glabent = g_enterprise
      AND glabld = l_apde.apdeld
      AND glab001 = '15'    #albireo 160630
      AND glab002 = '3117'  #albireo 160630
      AND glab003 = '8504_33'
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apga.apga100   #albireo 160630
   LET l_apcb.apcb101 = l_apga.apga102   #albireo 160624 add
   LET l_apcb.apcb102 = l_apga.apga101   #albireo 160630
   LET l_apcb.apcb103 = l_apga.apga102
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apga.apga102
   LET l_apcb.apcb108 = l_apga.apga102
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apga.apga112
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apga.apga112
     LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   LET l_apcb.apcb124 = 0
   LET l_apcb.apcb125 = l_apcb.apcb125
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   LET l_apcb.apcb134 = 0
   LET l_apcb.apcb135 = l_apcb.apcb135
   IF l_apcb.apcb113 > 0 THEN
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF
   #預付款-----e
   
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
      
   LET l_apcb113sum = NULL   LET l_apcb114sum = NULL   LET l_apcb115sum = NULL
   SELECT SUM(apcb113),SUM(apcb114),SUM(apcb115)
     INTO l_apcb113sum,l_apcb114sum,l_apcb115sum
     FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbld  = l_apca.apcald
      AND apcbdocno = l_apca.apcadocno
   IF cl_null(l_apcb113sum)THEN LET l_apcb113sum = 0 END IF
   IF cl_null(l_apcb114sum)THEN LET l_apcb114sum = 0 END IF
   IF cl_null(l_apcb115sum)THEN LET l_apcb115sum = 0 END IF
   
   UPDATE apca_t SET apca103 = l_apcb113sum,
                     apca104 = l_apcb114sum,
                     apca108 = l_apcb115sum,
                     apca113 = l_apcb113sum,
                     apca114 = l_apcb114sum,
                     apca118 = l_apcb115sum,
                     apca107 = l_apcb115sum,
                     apca117 = l_apcb115sum
    WHERE apcaent = g_enterprise
      AND apcald  = l_apca.apcald
      AND apcadocno = l_apca.apcadocno

   CALL s_aap_multi_bill_period(l_apca.apcald,l_apca.apcadocno) RETURNING g_sub_success,g_errno

   UPDATE apcc_t SET apcc109 = apcc108 ,apcc119 = apcc118
    WHERE apccent   = g_enterprise
      AND apccdocno = l_apca.apcadocno
      AND apccld    = l_apca.apcald
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e

   CALL s_pre_voucher_ins('AP','P10',l_apca.apcald,l_apca.apcadocno,l_apca.apcadocdt,'1')
                       RETURNING g_sub_success
   IF NOT g_sub_success THEN
      LET r_success = FALSE
   END IF
   
   #160824-00049#7-----s
   LET l_count = NULL
   SELECT COUNT(*) INTO l_count FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbdocno = l_apca.apcadocno
      AND apcbld = l_apca.apcald
   IF cl_null(l_count)THEN LET l_count = 0 END IF
   
   IF l_count = 0 THEN
      LET r_success = FALSE
      INITIALIZE g_errparam.* TO NULL
      LET g_errparam.code = 'agl-00167'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
   END IF
   #160824-00049#7-----e
   
   UPDATE apga_t SET apga028 = l_apca.apcadocno
    WHERE apgaent = g_enterprise
      AND apgacomp = l_apca.apcacomp
      AND apgadocno = g_apca_m.apca018
   
   LET r_docno = l_apca.apcadocno
   RETURN r_success,r_docno
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_ins_ap_2()
#DEFINE l_apca   RECORD LIKE apca_t.* #161104-00024#5 mark
#161104-00024#5-add(s)
DEFINE l_apca  RECORD  #應付憑單單頭
       apcaent   LIKE apca_t.apcaent, #企業編號
       apcaownid LIKE apca_t.apcaownid, #資料所有者
       apcaowndp LIKE apca_t.apcaowndp, #資料所有部門
       apcacrtid LIKE apca_t.apcacrtid, #資料建立者
       apcacrtdp LIKE apca_t.apcacrtdp, #資料建立部門
       apcacrtdt LIKE apca_t.apcacrtdt, #資料創建日
       apcamodid LIKE apca_t.apcamodid, #資料修改者
       apcamoddt LIKE apca_t.apcamoddt, #最近修改日
       apcacnfid LIKE apca_t.apcacnfid, #資料確認者
       apcacnfdt LIKE apca_t.apcacnfdt, #資料確認日
       apcapstid LIKE apca_t.apcapstid, #資料過帳者
       apcapstdt LIKE apca_t.apcapstdt, #資料過帳日
       apcastus  LIKE apca_t.apcastus, #狀態碼
       apcald    LIKE apca_t.apcald, #帳套
       apcacomp  LIKE apca_t.apcacomp, #法人
       apcadocno LIKE apca_t.apcadocno, #應付帳款單號碼
       apcadocdt LIKE apca_t.apcadocdt, #帳款日期
       apcasite  LIKE apca_t.apcasite, #帳務中心
       apca001   LIKE apca_t.apca001, #帳款單性質
       apca003   LIKE apca_t.apca003, #帳務人員
       apca004   LIKE apca_t.apca004, #帳款對象編號
       apca005   LIKE apca_t.apca005, #付款對象
       apca006   LIKE apca_t.apca006, #供應商分類
       apca007   LIKE apca_t.apca007, #帳款類別
       apca008   LIKE apca_t.apca008, #付款條件編號
       apca009   LIKE apca_t.apca009, #應付款日/應扣抵日
       apca010   LIKE apca_t.apca010, #容許票據到期日
       apca011   LIKE apca_t.apca011, #稅別
       apca012   LIKE apca_t.apca012, #稅率
       apca013   LIKE apca_t.apca013, #含稅否
       apca014   LIKE apca_t.apca014, #人員編號
       apca015   LIKE apca_t.apca015, #部門編號
       apca016   LIKE apca_t.apca016, #來源作業類型
       apca017   LIKE apca_t.apca017, #產生方式
       apca018   LIKE apca_t.apca018, #來源參考單號
       apca019   LIKE apca_t.apca019, #系統產生對應單號(待抵帳款-預付)
       apca020   LIKE apca_t.apca020, #信用狀付款否
       apca021   LIKE apca_t.apca021, #商業發票號碼(IV no.)
       apca022   LIKE apca_t.apca022, #進口報單號碼
       apca025   LIKE apca_t.apca025, #差異處理(發票與帳款差異)
       apca026   LIKE apca_t.apca026, #原幣未稅差異
       apca027   LIKE apca_t.apca027, #原幣稅額差異
       apca028   LIKE apca_t.apca028, #本幣未稅差異
       apca029   LIKE apca_t.apca029, #本幣幣稅額差異
       apca030   LIKE apca_t.apca030, #差異科目
       apca031   LIKE apca_t.apca031, #產生之差異折讓單號
       apca032   LIKE apca_t.apca032, #發票類型
       apca033   LIKE apca_t.apca033, #專案編號
       apca034   LIKE apca_t.apca034, #責任中心
       apca035   LIKE apca_t.apca035, #應付(貸方)科目編號
       apca036   LIKE apca_t.apca036, #費用(借方)科目編號
       apca037   LIKE apca_t.apca037, #產生傳票否
       apca038   LIKE apca_t.apca038, #拋轉傳票號碼
       apca039   LIKE apca_t.apca039, #會計檢核附件份數
       apca040   LIKE apca_t.apca040, #留置否
       apca041   LIKE apca_t.apca041, #留置理由碼
       apca042   LIKE apca_t.apca042, #留置設定日期
       apca043   LIKE apca_t.apca043, #留置解除日期
       apca044   LIKE apca_t.apca044, #留置原幣金額
       apca045   LIKE apca_t.apca045, #留置說明
       apca046   LIKE apca_t.apca046, #關係人否
       apca047   LIKE apca_t.apca047, #多角序號
       apca048   LIKE apca_t.apca048, #集團代付/代付單號
       apca049   LIKE apca_t.apca049, #來源營運中心編號
       apca050   LIKE apca_t.apca050, #交易原始單據份數
       apca051   LIKE apca_t.apca051, #作廢理由碼
       apca052   LIKE apca_t.apca052, #列印次數
       apca053   LIKE apca_t.apca053, #備註
       apca054   LIKE apca_t.apca054, #多帳期設定
       apca055   LIKE apca_t.apca055, #繳款優惠條件
       apca056   LIKE apca_t.apca056, #會計檢核附件狀態
       apca057   LIKE apca_t.apca057, #交易對象識別碼
       apca058   LIKE apca_t.apca058, #稅別交易類型
       apca059   LIKE apca_t.apca059, #預算編號
       apca060   LIKE apca_t.apca060, #發票開立方式
       apca061   LIKE apca_t.apca061, #預開發票基準日
       apca062   LIKE apca_t.apca062, #多角性質
       apca063   LIKE apca_t.apca063, #整帳批序號
       apca064   LIKE apca_t.apca064, #訂金序次
       apca065   LIKE apca_t.apca065, #發票編號
       apca066   LIKE apca_t.apca066, #發票號碼
       apca100   LIKE apca_t.apca100, #交易原幣別
       apca101   LIKE apca_t.apca101, #原幣匯率
       apca103   LIKE apca_t.apca103, #原幣未稅金額
       apca104   LIKE apca_t.apca104, #原幣稅額
       apca106   LIKE apca_t.apca106, #原幣應稅折抵合計金額
       apca107   LIKE apca_t.apca107, #原幣直接沖帳(調整)合計金額
       apca108   LIKE apca_t.apca108, #原幣應付金額
       apca113   LIKE apca_t.apca113, #本幣未稅金額
       apca114   LIKE apca_t.apca114, #本幣稅額
       apca116   LIKE apca_t.apca116, #本幣應稅折抵合計金額
       apca117   LIKE apca_t.apca117, #NO USE
       apca118   LIKE apca_t.apca118, #本幣應付金額
       apca120   LIKE apca_t.apca120, #本位幣二幣別
       apca121   LIKE apca_t.apca121, #本位幣二匯率
       apca123   LIKE apca_t.apca123, #本位幣二未稅金額
       apca124   LIKE apca_t.apca124, #本位幣二稅額
       apca126   LIKE apca_t.apca126, #本位幣二應稅折抵合計金額
       apca127   LIKE apca_t.apca127, #NO USE
       apca128   LIKE apca_t.apca128, #本位幣二應付金額
       apca130   LIKE apca_t.apca130, #本位幣三幣別
       apca131   LIKE apca_t.apca131, #本位幣三匯率
       apca133   LIKE apca_t.apca133, #本位幣三未稅金額
       apca134   LIKE apca_t.apca134, #本位幣三稅額
       apca136   LIKE apca_t.apca136, #本位幣三應稅折抵合計金額
       apca137   LIKE apca_t.apca137, #NO USE
       apca138   LIKE apca_t.apca138, #本位幣三應付金額
       apcaud001 LIKE apca_t.apcaud001, #自定義欄位(文字)001
       apcaud002 LIKE apca_t.apcaud002, #自定義欄位(文字)002
       apcaud003 LIKE apca_t.apcaud003, #自定義欄位(文字)003
       apcaud004 LIKE apca_t.apcaud004, #自定義欄位(文字)004
       apcaud005 LIKE apca_t.apcaud005, #自定義欄位(文字)005
       apcaud006 LIKE apca_t.apcaud006, #自定義欄位(文字)006
       apcaud007 LIKE apca_t.apcaud007, #自定義欄位(文字)007
       apcaud008 LIKE apca_t.apcaud008, #自定義欄位(文字)008
       apcaud009 LIKE apca_t.apcaud009, #自定義欄位(文字)009
       apcaud010 LIKE apca_t.apcaud010, #自定義欄位(文字)010
       apcaud011 LIKE apca_t.apcaud011, #自定義欄位(數字)011
       apcaud012 LIKE apca_t.apcaud012, #自定義欄位(數字)012
       apcaud013 LIKE apca_t.apcaud013, #自定義欄位(數字)013
       apcaud014 LIKE apca_t.apcaud014, #自定義欄位(數字)014
       apcaud015 LIKE apca_t.apcaud015, #自定義欄位(數字)015
       apcaud016 LIKE apca_t.apcaud016, #自定義欄位(數字)016
       apcaud017 LIKE apca_t.apcaud017, #自定義欄位(數字)017
       apcaud018 LIKE apca_t.apcaud018, #自定義欄位(數字)018
       apcaud019 LIKE apca_t.apcaud019, #自定義欄位(數字)019
       apcaud020 LIKE apca_t.apcaud020, #自定義欄位(數字)020
       apcaud021 LIKE apca_t.apcaud021, #自定義欄位(日期時間)021
       apcaud022 LIKE apca_t.apcaud022, #自定義欄位(日期時間)022
       apcaud023 LIKE apca_t.apcaud023, #自定義欄位(日期時間)023
       apcaud024 LIKE apca_t.apcaud024, #自定義欄位(日期時間)024
       apcaud025 LIKE apca_t.apcaud025, #自定義欄位(日期時間)025
       apcaud026 LIKE apca_t.apcaud026, #自定義欄位(日期時間)026
       apcaud027 LIKE apca_t.apcaud027, #自定義欄位(日期時間)027
       apcaud028 LIKE apca_t.apcaud028, #自定義欄位(日期時間)028
       apcaud029 LIKE apca_t.apcaud029, #自定義欄位(日期時間)029
       apcaud030 LIKE apca_t.apcaud030, #自定義欄位(日期時間)030
       apca067   LIKE apca_t.apca067, #管理品類
       apca068   LIKE apca_t.apca068, #經營方式
       apca069   LIKE apca_t.apca069, #no use
       apca070   LIKE apca_t.apca070, #no use
       apca071   LIKE apca_t.apca071, #no use
       apca072   LIKE apca_t.apca072, #no use
       apca073   LIKE apca_t.apca073  #L/C No.
           END RECORD
#161104-00024#5-add(e)
DEFINE l_desc   LIKE type_t.chr1000
DEFINE ls_js            STRING   
DEFINE lc_param_apca    RECORD
         apcald         LIKE apca_t.apcald,
         apcacomp       LIKE apca_t.apcacomp,
         apcasite       LIKE apca_t.apcasite,
         apcadocdt      LIKE apca_t.apcadocdt,
         apca001        LIKE apca_t.apca001,
         apca004        LIKE apca_t.apca004,
         ooef019        LIKE ooef_t.ooef019
                        END RECORD
DEFINE lc_param_info    RECORD
            apca005        LIKE apca_t.apca005,
            apca005_desc   LIKE type_t.chr80,
            apca006        LIKE apca_t.apca006,    #供應商分類
            apca007        LIKE apca_t.apca007,
            apca007_desc   LIKE type_t.chr80,
            apca008        LIKE apca_t.apca008,
            apca008_desc   LIKE type_t.chr80,
            apca009        LIKE apca_t.apca009,
            apca010        LIKE apca_t.apca010,
            apca011        LIKE apca_t.apca011,
            apca011_desc   LIKE type_t.chr80,
            apca012        LIKE apca_t.apca012,
            apca013        LIKE apca_t.apca013,
            apca014        LIKE apca_t.apca014,
            apca014_desc   LIKE type_t.chr80,
            apca015        LIKE apca_t.apca015,
            apca015_desc   LIKE type_t.chr80,
            apca034        LIKE apca_t.apca034,
            apca034_desc   LIKE type_t.chr80,
            apca035        LIKE apca_t.apca035,
            apca035_desc   LIKE type_t.chr80,
            apca036        LIKE apca_t.apca036,
            apca036_desc   LIKE type_t.chr80,
            apca046        LIKE apca_t.apca046,
            apca054        LIKE apca_t.apca054,
            apca054_desc   LIKE type_t.chr80,
            apca055        LIKE apca_t.apca055,
            apca055_desc   LIKE type_t.chr80,
            apca056        LIKE apca_t.apca056,
            apca058        LIKE apca_t.apca058,
            apca058_desc   LIKE type_t.chr80,
            apca060        LIKE apca_t.apca060,
            apca100        LIKE apca_t.apca100,
            apca101        LIKE apca_t.apca101,
            apca121        LIKE apca_t.apca121,
            apca131        LIKE apca_t.apca131
                       END RECORD
   DEFINE lc_param2        RECORD
         type           LIKE type_t.chr1,       #類型
         apca004        LIKE apca_t.apca004,
         sfin2009       LIKE type_t.chr1        #汇率基本    
         END RECORD
   #DEFINE l_apga    RECORD LIKE apga_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apga  RECORD  #信用狀申請單主檔
          apgaent   LIKE apga_t.apgaent, #企業編號
          apgaownid LIKE apga_t.apgaownid, #資料所有者
          apgaowndp LIKE apga_t.apgaowndp, #資料所屬部門
          apgacrtid LIKE apga_t.apgacrtid, #資料建立者
          apgacrtdp LIKE apga_t.apgacrtdp, #資料建立部門
          apgacrtdt LIKE apga_t.apgacrtdt, #資料創建日
          apgamodid LIKE apga_t.apgamodid, #資料修改者
          apgamoddt LIKE apga_t.apgamoddt, #最近修改日
          apgacnfid LIKE apga_t.apgacnfid, #資料確認者
          apgacnfdt LIKE apga_t.apgacnfdt, #資料確認日
          apgapstid LIKE apga_t.apgapstid, #資料過帳者
          apgapstdt LIKE apga_t.apgapstdt, #資料過帳日
          apgastus  LIKE apga_t.apgastus, #狀態碼
          apgacomp  LIKE apga_t.apgacomp, #法人
          apgadocno LIKE apga_t.apgadocno, #申請單號
          apgadocdt LIKE apga_t.apgadocdt, #申請日期
          apga001   LIKE apga_t.apga001, #L/C NO
          apga002   LIKE apga_t.apga002, #版次
          apga003   LIKE apga_t.apga003, #開狀日期
          apga004   LIKE apga_t.apga004, #供應商(受益人)
          apga005   LIKE apga_t.apga005, #業務人員
          apga006   LIKE apga_t.apga006, #付款類型
          apga007   LIKE apga_t.apga007, #開狀銀行
          apga008   LIKE apga_t.apga008, #信用狀類別
          apga009   LIKE apga_t.apga009, #保兌信用狀否
          apga010   LIKE apga_t.apga010, #信用狀有效日期
          apga011   LIKE apga_t.apga011, #許可證號
          apga012   LIKE apga_t.apga012, #承兌日期
          apga013   LIKE apga_t.apga013, #保兌費用支付方
          apga014   LIKE apga_t.apga014, #可否分批交運
          apga015   LIKE apga_t.apga015, #自備款比率
          apga016   LIKE apga_t.apga016, #融資利率
          apga017   LIKE apga_t.apga017, #融資天數
          apga018   LIKE apga_t.apga018, #融資合約編號
          apga019   LIKE apga_t.apga019, #最後裝運日
          apga020   LIKE apga_t.apga020, #運送方式
          apga021   LIKE apga_t.apga021, #裝載港/機場
          apga022   LIKE apga_t.apga022, #卸載港/機場
          apga023   LIKE apga_t.apga023, #E.T.D
          apga024   LIKE apga_t.apga024, #E.T.A
          apga025   LIKE apga_t.apga025, #備註
          apga026   LIKE apga_t.apga026, #開狀時支付自備款
          apga027   LIKE apga_t.apga027, #NO USE
          apga028   LIKE apga_t.apga028, #帳務單號
          apga029   LIKE apga_t.apga029, #結案否
          apga030   LIKE apga_t.apga030, #通知銀行
          apga031   LIKE apga_t.apga031, #開狀時支付自備款
          apga100   LIKE apga_t.apga100, #幣別
          apga101   LIKE apga_t.apga101, #開狀匯率
          apga103   LIKE apga_t.apga103, #開狀原幣金額
          apga104   LIKE apga_t.apga104, #自備款原幣金額
          apga105   LIKE apga_t.apga105, #融資原幣金額
          apga106   LIKE apga_t.apga106, #到單原幣金額
          apga107   LIKE apga_t.apga107, #到貨原幣金額
          apga108   LIKE apga_t.apga108, #保證金原幣金額
          apga113   LIKE apga_t.apga113, #開狀本幣金額
          apga114   LIKE apga_t.apga114, #自備款本幣金額
          apga115   LIKE apga_t.apga115, #融資本幣金額
          apgaud001 LIKE apga_t.apgaud001, #自定義欄位(文字)001
          apgaud002 LIKE apga_t.apgaud002, #自定義欄位(文字)002
          apgaud003 LIKE apga_t.apgaud003, #自定義欄位(文字)003
          apgaud004 LIKE apga_t.apgaud004, #自定義欄位(文字)004
          apgaud005 LIKE apga_t.apgaud005, #自定義欄位(文字)005
          apgaud006 LIKE apga_t.apgaud006, #自定義欄位(文字)006
          apgaud007 LIKE apga_t.apgaud007, #自定義欄位(文字)007
          apgaud008 LIKE apga_t.apgaud008, #自定義欄位(文字)008
          apgaud009 LIKE apga_t.apgaud009, #自定義欄位(文字)009
          apgaud010 LIKE apga_t.apgaud010, #自定義欄位(文字)010
          apgaud011 LIKE apga_t.apgaud011, #自定義欄位(數字)011
          apgaud012 LIKE apga_t.apgaud012, #自定義欄位(數字)012
          apgaud013 LIKE apga_t.apgaud013, #自定義欄位(數字)013
          apgaud014 LIKE apga_t.apgaud014, #自定義欄位(數字)014
          apgaud015 LIKE apga_t.apgaud015, #自定義欄位(數字)015
          apgaud016 LIKE apga_t.apgaud016, #自定義欄位(數字)016
          apgaud017 LIKE apga_t.apgaud017, #自定義欄位(數字)017
          apgaud018 LIKE apga_t.apgaud018, #自定義欄位(數字)018
          apgaud019 LIKE apga_t.apgaud019, #自定義欄位(數字)019
          apgaud020 LIKE apga_t.apgaud020, #自定義欄位(數字)020
          apgaud021 LIKE apga_t.apgaud021, #自定義欄位(日期時間)021
          apgaud022 LIKE apga_t.apgaud022, #自定義欄位(日期時間)022
          apgaud023 LIKE apga_t.apgaud023, #自定義欄位(日期時間)023
          apgaud024 LIKE apga_t.apgaud024, #自定義欄位(日期時間)024
          apgaud025 LIKE apga_t.apgaud025, #自定義欄位(日期時間)025
          apgaud026 LIKE apga_t.apgaud026, #自定義欄位(日期時間)026
          apgaud027 LIKE apga_t.apgaud027, #自定義欄位(日期時間)027
          apgaud028 LIKE apga_t.apgaud028, #自定義欄位(日期時間)028
          apgaud029 LIKE apga_t.apgaud029, #自定義欄位(日期時間)029
          apgaud030 LIKE apga_t.apgaud030, #自定義欄位(日期時間)030
          apga102   LIKE apga_t.apga102, #預付款原幣金額
          apga109   LIKE apga_t.apga109, #初開狀原幣金額
          apga112   LIKE apga_t.apga112, #預付款本幣金額
          apga117   LIKE apga_t.apga117, #到貨本幣金額
          apga118   LIKE apga_t.apga118, #保證金本幣金額
          apga032   LIKE apga_t.apga032, #保證金待抵單號
          apga033   LIKE apga_t.apga033, #預付款待抵單號
          apga034   LIKE apga_t.apga034, #保證金存提碼
          apga035   LIKE apga_t.apga035, #保證金現變碼
          apga040   LIKE apga_t.apga040, #支付帳戶
          apga041   LIKE apga_t.apga041, #多幣別採購單
          apga036   LIKE apga_t.apga036, #自備款存提碼
          apga037   LIKE apga_t.apga037, #自備款現變碼
          apga038   LIKE apga_t.apga038, #預付款存提碼
          apga039   LIKE apga_t.apga039  #預付款現變碼
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_success LIKE type_t.num5
   #DEFINE l_apgc    RECORD LIKE apgc_t.* #161104-00024#5 mark
   #DEFINE l_apcb    RECORD LIKE apcb_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgc  RECORD  #信用狀相關費用明細檔
          apgcent   LIKE apgc_t.apgcent, #企業編號
          apgccomp  LIKE apgc_t.apgccomp, #法人
          apgcdocno LIKE apgc_t.apgcdocno, #申請單號
          apgcseq   LIKE apgc_t.apgcseq, #項次
          apgc900   LIKE apgc_t.apgc900, #變更序
          apgcorga  LIKE apgc_t.apgcorga, #來源組織
          apgc001   LIKE apgc_t.apgc001, #費用編號
          apgc002   LIKE apgc_t.apgc002, #付款對象
          apgc003   LIKE apgc_t.apgc003, #付款條件
          apgc004   LIKE apgc_t.apgc004, #費用科目
          apgc005   LIKE apgc_t.apgc005, #帳款類別
          apgc006   LIKE apgc_t.apgc006, #稅別
          apgc007   LIKE apgc_t.apgc007, #發票類型
          apgc008   LIKE apgc_t.apgc008, #發票編號
          apgc009   LIKE apgc_t.apgc009, #發票號碼
          apgc010   LIKE apgc_t.apgc010, #發票日期
          apgc011   LIKE apgc_t.apgc011, #可扣抵編號
          apgc012   LIKE apgc_t.apgc012, #應付單號
          apgc013   LIKE apgc_t.apgc013, #費用來源
          apgc014   LIKE apgc_t.apgc014, #付款帳戶
          apgc015   LIKE apgc_t.apgc015, #存提碼
          apgc016   LIKE apgc_t.apgc016, #現金變動碼
          apgc100   LIKE apgc_t.apgc100, #幣別
          apgc101   LIKE apgc_t.apgc101, #匯率
          apgc103   LIKE apgc_t.apgc103, #原幣未稅金額
          apgc104   LIKE apgc_t.apgc104, #稅額
          apgc105   LIKE apgc_t.apgc105, #原幣含稅金額
          apgc113   LIKE apgc_t.apgc113, #本幣未稅金額
          apgc114   LIKE apgc_t.apgc114, #本幣稅額
          apgc115   LIKE apgc_t.apgc115, #本幣含稅金額
          apgcud001 LIKE apgc_t.apgcud001, #自定義欄位(文字)001
          apgcud002 LIKE apgc_t.apgcud002, #自定義欄位(文字)002
          apgcud003 LIKE apgc_t.apgcud003, #自定義欄位(文字)003
          apgcud004 LIKE apgc_t.apgcud004, #自定義欄位(文字)004
          apgcud005 LIKE apgc_t.apgcud005, #自定義欄位(文字)005
          apgcud006 LIKE apgc_t.apgcud006, #自定義欄位(文字)006
          apgcud007 LIKE apgc_t.apgcud007, #自定義欄位(文字)007
          apgcud008 LIKE apgc_t.apgcud008, #自定義欄位(文字)008
          apgcud009 LIKE apgc_t.apgcud009, #自定義欄位(文字)009
          apgcud010 LIKE apgc_t.apgcud010, #自定義欄位(文字)010
          apgcud011 LIKE apgc_t.apgcud011, #自定義欄位(數字)011
          apgcud012 LIKE apgc_t.apgcud012, #自定義欄位(數字)012
          apgcud013 LIKE apgc_t.apgcud013, #自定義欄位(數字)013
          apgcud014 LIKE apgc_t.apgcud014, #自定義欄位(數字)014
          apgcud015 LIKE apgc_t.apgcud015, #自定義欄位(數字)015
          apgcud016 LIKE apgc_t.apgcud016, #自定義欄位(數字)016
          apgcud017 LIKE apgc_t.apgcud017, #自定義欄位(數字)017
          apgcud018 LIKE apgc_t.apgcud018, #自定義欄位(數字)018
          apgcud019 LIKE apgc_t.apgcud019, #自定義欄位(數字)019
          apgcud020 LIKE apgc_t.apgcud020, #自定義欄位(數字)020
          apgcud021 LIKE apgc_t.apgcud021, #自定義欄位(日期時間)021
          apgcud022 LIKE apgc_t.apgcud022, #自定義欄位(日期時間)022
          apgcud023 LIKE apgc_t.apgcud023, #自定義欄位(日期時間)023
          apgcud024 LIKE apgc_t.apgcud024, #自定義欄位(日期時間)024
          apgcud025 LIKE apgc_t.apgcud025, #自定義欄位(日期時間)025
          apgcud026 LIKE apgc_t.apgcud026, #自定義欄位(日期時間)026
          apgcud027 LIKE apgc_t.apgcud027, #自定義欄位(日期時間)027
          apgcud028 LIKE apgc_t.apgcud028, #自定義欄位(日期時間)028
          apgcud029 LIKE apgc_t.apgcud029, #自定義欄位(日期時間)029
          apgcud030 LIKE apgc_t.apgcud030  #自定義欄位(日期時間)030
              END RECORD
   DEFINE l_apcb  RECORD  #應付憑單單身
          apcbent   LIKE apcb_t.apcbent, #企業編號
          apcbld    LIKE apcb_t.apcbld, #帳套
          apcblegl  LIKE apcb_t.apcblegl, #核算組織
          apcborga  LIKE apcb_t.apcborga, #帳務歸屬組織(來源組織)
          apcbsite  LIKE apcb_t.apcbsite, #應付帳務組織
          apcbdocno LIKE apcb_t.apcbdocno, #單號
          apcbseq   LIKE apcb_t.apcbseq, #項次
          apcb001   LIKE apcb_t.apcb001, #來源類型
          apcb002   LIKE apcb_t.apcb002, #來源業務單據號碼
          apcb003   LIKE apcb_t.apcb003, #來源業務單據項次
          apcb004   LIKE apcb_t.apcb004, #產品編號
          apcb005   LIKE apcb_t.apcb005, #品名規格
          apcb006   LIKE apcb_t.apcb006, #單位
          apcb007   LIKE apcb_t.apcb007, #計價數量
          apcb008   LIKE apcb_t.apcb008, #參考單據號碼
          apcb009   LIKE apcb_t.apcb009, #參考單據項次
          apcb010   LIKE apcb_t.apcb010, #業務部門
          apcb011   LIKE apcb_t.apcb011, #責任中心
          apcb012   LIKE apcb_t.apcb012, #產品類別
          apcb013   LIKE apcb_t.apcb013, #搭贈
          apcb014   LIKE apcb_t.apcb014, #理由碼
          apcb015   LIKE apcb_t.apcb015, #專案編號
          apcb016   LIKE apcb_t.apcb016, #WBS編號
          apcb017   LIKE apcb_t.apcb017, #預算細項
          apcb018   LIKE apcb_t.apcb018, #专柜编号
          apcb019   LIKE apcb_t.apcb019, #開票性質
          apcb020   LIKE apcb_t.apcb020, #稅別
          apcb021   LIKE apcb_t.apcb021, #費用會計科目
          apcb022   LIKE apcb_t.apcb022, #正負值
          apcb023   LIKE apcb_t.apcb023, #沖暫估單否
          apcb024   LIKE apcb_t.apcb024, #區域
          apcb025   LIKE apcb_t.apcb025, #傳票號碼
          apcb026   LIKE apcb_t.apcb026, #傳票項次
          apcb027   LIKE apcb_t.apcb027, #發票編號
          apcb028   LIKE apcb_t.apcb028, #發票號碼
          apcb029   LIKE apcb_t.apcb029, #應付帳款科目
          apcb030   LIKE apcb_t.apcb030, #付款條件
          apcb032   LIKE apcb_t.apcb032, #訂金序次
          apcb033   LIKE apcb_t.apcb033, #經營方式
          apcb034   LIKE apcb_t.apcb034, #通路
          apcb035   LIKE apcb_t.apcb035, #品牌
          apcb036   LIKE apcb_t.apcb036, #客群
          apcb037   LIKE apcb_t.apcb037, #自由核算項一
          apcb038   LIKE apcb_t.apcb038, #自由核算項二
          apcb039   LIKE apcb_t.apcb039, #自由核算項三
          apcb040   LIKE apcb_t.apcb040, #自由核算項四
          apcb041   LIKE apcb_t.apcb041, #自由核算項五
          apcb042   LIKE apcb_t.apcb042, #自由核算項六
          apcb043   LIKE apcb_t.apcb043, #自由核算項七
          apcb044   LIKE apcb_t.apcb044, #自由核算項八
          apcb045   LIKE apcb_t.apcb045, #自由核算項九
          apcb046   LIKE apcb_t.apcb046, #自由核算項十
          apcb047   LIKE apcb_t.apcb047, #摘要
          apcb048   LIKE apcb_t.apcb048, #來源訂購單號
          apcb049   LIKE apcb_t.apcb049, #開票單號
          apcb050   LIKE apcb_t.apcb050, #開票項次
          apcb051   LIKE apcb_t.apcb051, #業務人員
          apcb100   LIKE apcb_t.apcb100, #交易原幣
          apcb101   LIKE apcb_t.apcb101, #交易原幣單價
          apcb102   LIKE apcb_t.apcb102, #原幣匯率
          apcb103   LIKE apcb_t.apcb103, #交易原幣未稅金額
          apcb104   LIKE apcb_t.apcb104, #交易原幣稅額
          apcb105   LIKE apcb_t.apcb105, #交易原幣含稅金額
          apcb106   LIKE apcb_t.apcb106, #交易幣標準成本金額
          apcb107   LIKE apcb_t.apcb107, #入庫單單價
          apcb108   LIKE apcb_t.apcb108, #交易原幣成本認列金額
          apcb111   LIKE apcb_t.apcb111, #本幣單價
          apcb113   LIKE apcb_t.apcb113, #本幣未稅金額
          apcb114   LIKE apcb_t.apcb114, #本幣稅額
          apcb115   LIKE apcb_t.apcb115, #本幣含稅金額
          apcb116   LIKE apcb_t.apcb116, #本幣標準成本金額
          apcb117   LIKE apcb_t.apcb117, #NO USE
          apcb118   LIKE apcb_t.apcb118, #本幣成本認列金額
          apcb119   LIKE apcb_t.apcb119, #應開發票含稅金額
          apcb121   LIKE apcb_t.apcb121, #本位幣二匯率
          apcb123   LIKE apcb_t.apcb123, #本位幣二未稅金額
          apcb124   LIKE apcb_t.apcb124, #本位幣二稅額
          apcb125   LIKE apcb_t.apcb125, #本位幣二含稅金額
          apcb126   LIKE apcb_t.apcb126, #本幣二標準成本金額
          apcb127   LIKE apcb_t.apcb127, #NO USE
          apcb128   LIKE apcb_t.apcb128, #本位幣二成本認列金額
          apcb131   LIKE apcb_t.apcb131, #本位幣三匯率
          apcb133   LIKE apcb_t.apcb133, #本位幣三未稅金額
          apcb134   LIKE apcb_t.apcb134, #本位幣三稅額
          apcb135   LIKE apcb_t.apcb135, #本位幣三含稅金額
          apcb136   LIKE apcb_t.apcb136, #本幣三標準成本金額
          apcb137   LIKE apcb_t.apcb137, #NO USE
          apcb138   LIKE apcb_t.apcb138, #本位幣三成本認列金額
          apcbud001 LIKE apcb_t.apcbud001, #自定義欄位(文字)001
          apcbud002 LIKE apcb_t.apcbud002, #自定義欄位(文字)002
          apcbud003 LIKE apcb_t.apcbud003, #自定義欄位(文字)003
          apcbud004 LIKE apcb_t.apcbud004, #自定義欄位(文字)004
          apcbud005 LIKE apcb_t.apcbud005, #自定義欄位(文字)005
          apcbud006 LIKE apcb_t.apcbud006, #自定義欄位(文字)006
          apcbud007 LIKE apcb_t.apcbud007, #自定義欄位(文字)007
          apcbud008 LIKE apcb_t.apcbud008, #自定義欄位(文字)008
          apcbud009 LIKE apcb_t.apcbud009, #自定義欄位(文字)009
          apcbud010 LIKE apcb_t.apcbud010, #自定義欄位(文字)010
          apcbud011 LIKE apcb_t.apcbud011, #自定義欄位(數字)011
          apcbud012 LIKE apcb_t.apcbud012, #自定義欄位(數字)012
          apcbud013 LIKE apcb_t.apcbud013, #自定義欄位(數字)013
          apcbud014 LIKE apcb_t.apcbud014, #自定義欄位(數字)014
          apcbud015 LIKE apcb_t.apcbud015, #自定義欄位(數字)015
          apcbud016 LIKE apcb_t.apcbud016, #自定義欄位(數字)016
          apcbud017 LIKE apcb_t.apcbud017, #自定義欄位(數字)017
          apcbud018 LIKE apcb_t.apcbud018, #自定義欄位(數字)018
          apcbud019 LIKE apcb_t.apcbud019, #自定義欄位(數字)019
          apcbud020 LIKE apcb_t.apcbud020, #自定義欄位(數字)020
          apcbud021 LIKE apcb_t.apcbud021, #自定義欄位(日期時間)021
          apcbud022 LIKE apcb_t.apcbud022, #自定義欄位(日期時間)022
          apcbud023 LIKE apcb_t.apcbud023, #自定義欄位(日期時間)023
          apcbud024 LIKE apcb_t.apcbud024, #自定義欄位(日期時間)024
          apcbud025 LIKE apcb_t.apcbud025, #自定義欄位(日期時間)025
          apcbud026 LIKE apcb_t.apcbud026, #自定義欄位(日期時間)026
          apcbud027 LIKE apcb_t.apcbud027, #自定義欄位(日期時間)027
          apcbud028 LIKE apcb_t.apcbud028, #自定義欄位(日期時間)028
          apcbud029 LIKE apcb_t.apcbud029, #自定義欄位(日期時間)029
          apcbud030 LIKE apcb_t.apcbud030, #自定義欄位(日期時間)030
          apcb052   LIKE apcb_t.apcb052, #稅額
          apcb053   LIKE apcb_t.apcb053, #含稅金額
          apcb054   LIKE apcb_t.apcb054, #帳款對象
          apcb055   LIKE apcb_t.apcb055  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sql     STRING
   #DEFINE l_isam    RECORD LIKE isam_t.* #161104-00024#5 mark.#161104-00024#5-add(s)
   DEFINE l_isam  RECORD  #進項發票主檔
          isament   LIKE isam_t.isament, #企業編號
          isamownid LIKE isam_t.isamownid, #資料所有者
          isamowndp LIKE isam_t.isamowndp, #資料所屬部門
          isamcrtid LIKE isam_t.isamcrtid, #資料建立者
          isamcrtdp LIKE isam_t.isamcrtdp, #資料建立部門
          isamcrtdt LIKE isam_t.isamcrtdt, #資料創建日
          isammodid LIKE isam_t.isammodid, #資料修改者
          isammoddt LIKE isam_t.isammoddt, #最近修改日
          isamcnfid LIKE isam_t.isamcnfid, #資料確認者
          isamcnfdt LIKE isam_t.isamcnfdt, #資料確認日
          isamstus  LIKE isam_t.isamstus, #狀態碼
          isamcomp  LIKE isam_t.isamcomp, #法人
          isamdocno LIKE isam_t.isamdocno, #收票單號
          isamseq   LIKE isam_t.isamseq, #項次
          isam001   LIKE isam_t.isam001, #發票來源
          isam002   LIKE isam_t.isam002, #開發票人
          isam004   LIKE isam_t.isam004, #帳務中心(業務組織)
          isam006   LIKE isam_t.isam006, #業務部門(登錄部門)
          isam008   LIKE isam_t.isam008, #發票類型
          isam009   LIKE isam_t.isam009, #銷方發票編號
          isam010   LIKE isam_t.isam010, #發票號碼
          isam011   LIKE isam_t.isam011, #發票日期
          isam012   LIKE isam_t.isam012, #稅別
          isam0121  LIKE isam_t.isam0121, #含稅否
          isam013   LIKE isam_t.isam013, #稅率
          isam014   LIKE isam_t.isam014, #幣別
          isam015   LIKE isam_t.isam015, #匯率
          isam016   LIKE isam_t.isam016, #購貨方名稱
          isam017   LIKE isam_t.isam017, #購貨方統一編號
          isam018   LIKE isam_t.isam018, #購貨方地址
          isam019   LIKE isam_t.isam019, #購貨方電話
          isam020   LIKE isam_t.isam020, #購貨方開戶銀行
          isam021   LIKE isam_t.isam021, #購貨方帳戶編碼
          isam022   LIKE isam_t.isam022, #銷方銀行帳戶編碼
          isam023   LIKE isam_t.isam023, #發票原幣未稅金額
          isam024   LIKE isam_t.isam024, #發票原幣稅額
          isam025   LIKE isam_t.isam025, #發票原幣含稅金額
          isam026   LIKE isam_t.isam026, #發票本幣未稅金額
          isam027   LIKE isam_t.isam027, #發票本幣稅額
          isam028   LIKE isam_t.isam028, #發票本幣含稅金額
          isam029   LIKE isam_t.isam029, #銷貨方名稱
          isam030   LIKE isam_t.isam030, #統一編號
          isam031   LIKE isam_t.isam031, #銷貨方地址
          isam032   LIKE isam_t.isam032, #銷貨方電話
          isam033   LIKE isam_t.isam033, #銷貨方開戶銀行
          isam034   LIKE isam_t.isam034, #銷貨方帳號
          isam035   LIKE isam_t.isam035, #申報數量
          isam036   LIKE isam_t.isam036, #異動狀態
          isam037   LIKE isam_t.isam037, #可扣抵編號
          isam038   LIKE isam_t.isam038, #作廢(註銷)理由碼
          isam039   LIKE isam_t.isam039, #作廢日期
          isam040   LIKE isam_t.isam040, #作廢時間
          isam041   LIKE isam_t.isam041, #作廢人員
          isam042   LIKE isam_t.isam042, #專案作廢核准文號
          isam043   LIKE isam_t.isam043, #通關方式註記
          isam044   LIKE isam_t.isam044, #列印次數
          isam045   LIKE isam_t.isam045, #支付工具卡號1
          isam046   LIKE isam_t.isam046, #支付工具卡號2
          isam047   LIKE isam_t.isam047, #支付工具卡號3
          isam048   LIKE isam_t.isam048, #通關註記
          isam049   LIKE isam_t.isam049, #備註說明
          isam050   LIKE isam_t.isam050, #立帳單號
          isam107   LIKE isam_t.isam107, #發票原幣已折金額
          isam108   LIKE isam_t.isam108, #發票原幣已折稅額
          isam117   LIKE isam_t.isam117, #發票本幣已折金額
          isam118   LIKE isam_t.isam118, #發票本幣已折稅額
          isam200   LIKE isam_t.isam200, #電子發票否
          isam201   LIKE isam_t.isam201, #愛心碼
          isam202   LIKE isam_t.isam202, #載具類別號碼
          isam203   LIKE isam_t.isam203, #載具顯碼 ID
          isam204   LIKE isam_t.isam204, #載具隱碼 ID
          isam205   LIKE isam_t.isam205, #電子發票匯出狀態
          isam206   LIKE isam_t.isam206, #電子發票匯出序號
          isam207   LIKE isam_t.isam207, #電子發票領取方式
          isam208   LIKE isam_t.isam208, #申報年度
          isam209   LIKE isam_t.isam209, #申報月份
          isam210   LIKE isam_t.isam210, #申報據點
          isamud001 LIKE isam_t.isamud001, #自定義欄位(文字)001
          isamud002 LIKE isam_t.isamud002, #自定義欄位(文字)002
          isamud003 LIKE isam_t.isamud003, #自定義欄位(文字)003
          isamud004 LIKE isam_t.isamud004, #自定義欄位(文字)004
          isamud005 LIKE isam_t.isamud005, #自定義欄位(文字)005
          isamud006 LIKE isam_t.isamud006, #自定義欄位(文字)006
          isamud007 LIKE isam_t.isamud007, #自定義欄位(文字)007
          isamud008 LIKE isam_t.isamud008, #自定義欄位(文字)008
          isamud009 LIKE isam_t.isamud009, #自定義欄位(文字)009
          isamud010 LIKE isam_t.isamud010, #自定義欄位(文字)010
          isamud011 LIKE isam_t.isamud011, #自定義欄位(數字)011
          isamud012 LIKE isam_t.isamud012, #自定義欄位(數字)012
          isamud013 LIKE isam_t.isamud013, #自定義欄位(數字)013
          isamud014 LIKE isam_t.isamud014, #自定義欄位(數字)014
          isamud015 LIKE isam_t.isamud015, #自定義欄位(數字)015
          isamud016 LIKE isam_t.isamud016, #自定義欄位(數字)016
          isamud017 LIKE isam_t.isamud017, #自定義欄位(數字)017
          isamud018 LIKE isam_t.isamud018, #自定義欄位(數字)018
          isamud019 LIKE isam_t.isamud019, #自定義欄位(數字)019
          isamud020 LIKE isam_t.isamud020, #自定義欄位(數字)020
          isamud021 LIKE isam_t.isamud021, #自定義欄位(日期時間)021
          isamud022 LIKE isam_t.isamud022, #自定義欄位(日期時間)022
          isamud023 LIKE isam_t.isamud023, #自定義欄位(日期時間)023
          isamud024 LIKE isam_t.isamud024, #自定義欄位(日期時間)024
          isamud025 LIKE isam_t.isamud025, #自定義欄位(日期時間)025
          isamud026 LIKE isam_t.isamud026, #自定義欄位(日期時間)026
          isamud027 LIKE isam_t.isamud027, #自定義欄位(日期時間)027
          isamud028 LIKE isam_t.isamud028, #自定義欄位(日期時間)028
          isamud029 LIKE isam_t.isamud029, #自定義欄位(日期時間)029
          isamud030 LIKE isam_t.isamud030, #自定義欄位(日期時間)030
          isam051   LIKE isam_t.isam051  #認證否
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_ooef002     LIKE ooef_t.ooef002
   DEFINE l_ooefl006    LIKE ooefl_t.ooefl006
   DEFINE l_pmaal003    LIKE pmaal_t.pmaal003
   DEFINE l_isao001     LIKE isao_t.isao001
   DEFINE l_dummy1      LIKE type_t.num20_6
   #DEFINE l_apde        RECORD LIKE apde_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apde RECORD  #付款及差異處理明細檔
          apdeent   LIKE apde_t.apdeent, #企業編號
          apdecomp  LIKE apde_t.apdecomp, #法人
          apdeld    LIKE apde_t.apdeld, #帳套
          apdedocno LIKE apde_t.apdedocno, #沖銷單單號
          apdeseq   LIKE apde_t.apdeseq, #項次
          apdesite  LIKE apde_t.apdesite, #帳務中心
          apdeorga  LIKE apde_t.apdeorga, #帳務歸屬組織
          apde001   LIKE apde_t.apde001, #來源作業
          apde002   LIKE apde_t.apde002, #沖銷帳款類型
          apde003   LIKE apde_t.apde003, #已付款單號
          apde004   LIKE apde_t.apde004, #沖銷單項次
          apde006   LIKE apde_t.apde006, #款別編號
          apde008   LIKE apde_t.apde008, #帳戶/票券號碼
          apde009   LIKE apde_t.apde009, #已轉資料
          apde010   LIKE apde_t.apde010, #摘要說明
          apde011   LIKE apde_t.apde011, #銀行存提碼
          apde012   LIKE apde_t.apde012, #現金變動碼
          apde013   LIKE apde_t.apde013, #轉入客商碼
          apde014   LIKE apde_t.apde014, #轉入帳款單編號
          apde015   LIKE apde_t.apde015, #沖銷加減項
          apde016   LIKE apde_t.apde016, #沖銷會科
          apde017   LIKE apde_t.apde017, #業務人員
          apde018   LIKE apde_t.apde018, #業務部門
          apde019   LIKE apde_t.apde019, #責任中心
          apde020   LIKE apde_t.apde020, #產品類別
          apde021   LIKE apde_t.apde021, #票據類型
          apde022   LIKE apde_t.apde022, #專案編號
          apde023   LIKE apde_t.apde023, #WBS編號
          apde024   LIKE apde_t.apde024, #票據號碼
          apde028   LIKE apde_t.apde028, #產生方式
          apde029   LIKE apde_t.apde029, #傳票號碼
          apde030   LIKE apde_t.apde030, #傳票項次
          apde032   LIKE apde_t.apde032, #付款日
          apde035   LIKE apde_t.apde035, #區域
          apde036   LIKE apde_t.apde036, #客群
          apde038   LIKE apde_t.apde038, #對象
          apde039   LIKE apde_t.apde039, #受款銀行
          apde040   LIKE apde_t.apde040, #受款帳號
          apde041   LIKE apde_t.apde041, #受款人全名
          apde042   LIKE apde_t.apde042, #經營方式
          apde043   LIKE apde_t.apde043, #通路
          apde044   LIKE apde_t.apde044, #品牌
          apde045   LIKE apde_t.apde045, #摘要
          apde046   LIKE apde_t.apde046, #付款申請單
          apde047   LIKE apde_t.apde047, #付款申請單項次
          apde051   LIKE apde_t.apde051, #自由核算項一
          apde052   LIKE apde_t.apde052, #自由核算項二
          apde053   LIKE apde_t.apde053, #自由核算項三
          apde054   LIKE apde_t.apde054, #自由核算項四
          apde055   LIKE apde_t.apde055, #自由核算項五
          apde056   LIKE apde_t.apde056, #自由核算項六
          apde057   LIKE apde_t.apde057, #自由核算項七
          apde058   LIKE apde_t.apde058, #自由核算項八
          apde059   LIKE apde_t.apde059, #自由核算項九
          apde060   LIKE apde_t.apde060, #自由核算項十
          apde100   LIKE apde_t.apde100, #幣別
          apde101   LIKE apde_t.apde101, #匯率
          apde104   LIKE apde_t.apde104, #原幣應稅折抵稅額
          apde109   LIKE apde_t.apde109, #原幣沖帳金額
          apde119   LIKE apde_t.apde119, #本幣沖帳金額
          apde120   LIKE apde_t.apde120, #本位幣二幣別
          apde121   LIKE apde_t.apde121, #本位幣二匯率
          apde129   LIKE apde_t.apde129, #本位幣二沖帳金額
          apde130   LIKE apde_t.apde130, #本位幣三幣別
          apde131   LIKE apde_t.apde131, #本位幣三匯率
          apde139   LIKE apde_t.apde139, #本位幣三沖帳金額
          apdeud001 LIKE apde_t.apdeud001, #自定義欄位(文字)001
          apdeud002 LIKE apde_t.apdeud002, #自定義欄位(文字)002
          apdeud003 LIKE apde_t.apdeud003, #自定義欄位(文字)003
          apdeud004 LIKE apde_t.apdeud004, #自定義欄位(文字)004
          apdeud005 LIKE apde_t.apdeud005, #自定義欄位(文字)005
          apdeud006 LIKE apde_t.apdeud006, #自定義欄位(文字)006
          apdeud007 LIKE apde_t.apdeud007, #自定義欄位(文字)007
          apdeud008 LIKE apde_t.apdeud008, #自定義欄位(文字)008
          apdeud009 LIKE apde_t.apdeud009, #自定義欄位(文字)009
          apdeud010 LIKE apde_t.apdeud010, #自定義欄位(文字)010
          apdeud011 LIKE apde_t.apdeud011, #自定義欄位(數字)011
          apdeud012 LIKE apde_t.apdeud012, #自定義欄位(數字)012
          apdeud013 LIKE apde_t.apdeud013, #自定義欄位(數字)013
          apdeud014 LIKE apde_t.apdeud014, #自定義欄位(數字)014
          apdeud015 LIKE apde_t.apdeud015, #自定義欄位(數字)015
          apdeud016 LIKE apde_t.apdeud016, #自定義欄位(數字)016
          apdeud017 LIKE apde_t.apdeud017, #自定義欄位(數字)017
          apdeud018 LIKE apde_t.apdeud018, #自定義欄位(數字)018
          apdeud019 LIKE apde_t.apdeud019, #自定義欄位(數字)019
          apdeud020 LIKE apde_t.apdeud020, #自定義欄位(數字)020
          apdeud021 LIKE apde_t.apdeud021, #自定義欄位(日期時間)021
          apdeud022 LIKE apde_t.apdeud022, #自定義欄位(日期時間)022
          apdeud023 LIKE apde_t.apdeud023, #自定義欄位(日期時間)023
          apdeud024 LIKE apde_t.apdeud024, #自定義欄位(日期時間)024
          apdeud025 LIKE apde_t.apdeud025, #自定義欄位(日期時間)025
          apdeud026 LIKE apde_t.apdeud026, #自定義欄位(日期時間)026
          apdeud027 LIKE apde_t.apdeud027, #自定義欄位(日期時間)027
          apdeud028 LIKE apde_t.apdeud028, #自定義欄位(日期時間)028
          apdeud029 LIKE apde_t.apdeud029, #自定義欄位(日期時間)029
          apdeud030 LIKE apde_t.apdeud030, #自定義欄位(日期時間)030
          apde061   LIKE apde_t.apde061  #應付來源
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_pmab055     LIKE pmab_t.pmab055
   DEFINE l_glaa121     LIKE glaa_t.glaa121
   DEFINE l_glaa016     LIKE glaa_t.glaa016
   DEFINE l_glaa020     LIKE glaa_t.glaa020
   DEFINE l_glaa019     LIKE glaa_t.glaa019
   DEFINE l_glaa015     LIKE glaa_t.glaa015
   DEFINE l_glaa001     LIKE glaa_t.glaa001
   #DEFINE l_apgd        RECORD LIKE apgd_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgd  RECORD  #信用狀修改申請單主檔
          apgdent   LIKE apgd_t.apgdent, #企業編號
          apgdownid LIKE apgd_t.apgdownid, #資料所有者
          apgdowndp LIKE apgd_t.apgdowndp, #資料所屬部門
          apgdcrtid LIKE apgd_t.apgdcrtid, #資料建立者
          apgdcrtdp LIKE apgd_t.apgdcrtdp, #資料建立部門
          apgdcrtdt LIKE apgd_t.apgdcrtdt, #資料創建日
          apgdmodid LIKE apgd_t.apgdmodid, #資料修改者
          apgdmoddt LIKE apgd_t.apgdmoddt, #最近修改日
          apgdcnfid LIKE apgd_t.apgdcnfid, #資料確認者
          apgdcnfdt LIKE apgd_t.apgdcnfdt, #資料確認日
          apgdpstid LIKE apgd_t.apgdpstid, #資料過帳者
          apgdpstdt LIKE apgd_t.apgdpstdt, #資料過帳日
          apgdstus  LIKE apgd_t.apgdstus, #狀態碼
          apgdcomp  LIKE apgd_t.apgdcomp, #法人
          apgddocno LIKE apgd_t.apgddocno, #變更單號
          apgddocdt LIKE apgd_t.apgddocdt, #變更日期
          apgd001   LIKE apgd_t.apgd001, #L/C NO
          apgd002   LIKE apgd_t.apgd002, #版次
          apgd003   LIKE apgd_t.apgd003, #開狀日期
          apgd004   LIKE apgd_t.apgd004, #受益人
          apgd005   LIKE apgd_t.apgd005, #業務人員
          apgd006   LIKE apgd_t.apgd006, #付款類別
          apgd007   LIKE apgd_t.apgd007, #開狀銀行
          apgd008   LIKE apgd_t.apgd008, #信用狀類別
          apgd009   LIKE apgd_t.apgd009, #保兌信用狀否
          apgd010   LIKE apgd_t.apgd010, #信用狀有效日期
          apgd011   LIKE apgd_t.apgd011, #許可證號
          apgd012   LIKE apgd_t.apgd012, #承兌日期
          apgd013   LIKE apgd_t.apgd013, #保兌費用支付方
          apgd014   LIKE apgd_t.apgd014, #可否分批交運
          apgd015   LIKE apgd_t.apgd015, #自備款比率
          apgd016   LIKE apgd_t.apgd016, #融資利率
          apgd017   LIKE apgd_t.apgd017, #融資天數
          apgd018   LIKE apgd_t.apgd018, #融資合約編號
          apgd019   LIKE apgd_t.apgd019, #最後裝運日
          apgd020   LIKE apgd_t.apgd020, #運送方式
          apgd021   LIKE apgd_t.apgd021, #裝載港/機場
          apgd022   LIKE apgd_t.apgd022, #卸載港/機場
          apgd023   LIKE apgd_t.apgd023, #E.T.D
          apgd024   LIKE apgd_t.apgd024, #E.T.A
          apgd025   LIKE apgd_t.apgd025, #備註
          apgd026   LIKE apgd_t.apgd026, #開狀時支付自備款否
          apgd027   LIKE apgd_t.apgd027, #自備款差額轉待抵單
          apgd028   LIKE apgd_t.apgd028, #開狀費用應付憑單號
          apgd029   LIKE apgd_t.apgd029, #結案否
          apgd030   LIKE apgd_t.apgd030, #通知銀行
          apgd100   LIKE apgd_t.apgd100, #幣別
          apgd101   LIKE apgd_t.apgd101, #開狀匯率
          apgd103   LIKE apgd_t.apgd103, #開狀原幣金額
          apgd104   LIKE apgd_t.apgd104, #自備款原幣金額
          apgd108   LIKE apgd_t.apgd108, #保證金原幣金額
          apgd105   LIKE apgd_t.apgd105, #融資原幣金額
          apgd113   LIKE apgd_t.apgd113, #開狀本幣金額
          apgd114   LIKE apgd_t.apgd114, #自備款本幣金額
          apgd115   LIKE apgd_t.apgd115, #融資本幣金額
          apgd900   LIKE apgd_t.apgd900, #變更序
          apgdud001 LIKE apgd_t.apgdud001, #自定義欄位(文字)001
          apgdud002 LIKE apgd_t.apgdud002, #自定義欄位(文字)002
          apgdud003 LIKE apgd_t.apgdud003, #自定義欄位(文字)003
          apgdud004 LIKE apgd_t.apgdud004, #自定義欄位(文字)004
          apgdud005 LIKE apgd_t.apgdud005, #自定義欄位(文字)005
          apgdud006 LIKE apgd_t.apgdud006, #自定義欄位(文字)006
          apgdud007 LIKE apgd_t.apgdud007, #自定義欄位(文字)007
          apgdud008 LIKE apgd_t.apgdud008, #自定義欄位(文字)008
          apgdud009 LIKE apgd_t.apgdud009, #自定義欄位(文字)009
          apgdud010 LIKE apgd_t.apgdud010, #自定義欄位(文字)010
          apgdud011 LIKE apgd_t.apgdud011, #自定義欄位(數字)011
          apgdud012 LIKE apgd_t.apgdud012, #自定義欄位(數字)012
          apgdud013 LIKE apgd_t.apgdud013, #自定義欄位(數字)013
          apgdud014 LIKE apgd_t.apgdud014, #自定義欄位(數字)014
          apgdud015 LIKE apgd_t.apgdud015, #自定義欄位(數字)015
          apgdud016 LIKE apgd_t.apgdud016, #自定義欄位(數字)016
          apgdud017 LIKE apgd_t.apgdud017, #自定義欄位(數字)017
          apgdud018 LIKE apgd_t.apgdud018, #自定義欄位(數字)018
          apgdud019 LIKE apgd_t.apgdud019, #自定義欄位(數字)019
          apgdud020 LIKE apgd_t.apgdud020, #自定義欄位(數字)020
          apgdud021 LIKE apgd_t.apgdud021, #自定義欄位(日期時間)021
          apgdud022 LIKE apgd_t.apgdud022, #自定義欄位(日期時間)022
          apgdud023 LIKE apgd_t.apgdud023, #自定義欄位(日期時間)023
          apgdud024 LIKE apgd_t.apgdud024, #自定義欄位(日期時間)024
          apgdud025 LIKE apgd_t.apgdud025, #自定義欄位(日期時間)025
          apgdud026 LIKE apgd_t.apgdud026, #自定義欄位(日期時間)026
          apgdud027 LIKE apgd_t.apgdud027, #自定義欄位(日期時間)027
          apgdud028 LIKE apgd_t.apgdud028, #自定義欄位(日期時間)028
          apgdud029 LIKE apgd_t.apgdud029, #自定義欄位(日期時間)029
          apgdud030 LIKE apgd_t.apgdud030, #自定義欄位(日期時間)030
          apgd031   LIKE apgd_t.apgd031, #NO USE
          apgd102   LIKE apgd_t.apgd102, #預付款原幣金額
          apgd109   LIKE apgd_t.apgd109, #初開狀原幣金額
          apgd117   LIKE apgd_t.apgd117, #到貨本幣金額
          apgd118   LIKE apgd_t.apgd118, #保證金本幣金額
          apgd106   LIKE apgd_t.apgd106, #到單原幣金額
          apgd107   LIKE apgd_t.apgd107, #到貨原幣金額
          apgd032   LIKE apgd_t.apgd032, #保證金待抵單號
          apgd033   LIKE apgd_t.apgd033, #預付款待抵單號
          apgd034   LIKE apgd_t.apgd034, #保證金存提碼
          apgd035   LIKE apgd_t.apgd035, #保證金現變碼
          apgd036   LIKE apgd_t.apgd036, #自備款存提碼
          apgd037   LIKE apgd_t.apgd037, #自備款現變碼
          apgd038   LIKE apgd_t.apgd038, #預付款存提碼
          apgd039   LIKE apgd_t.apgd039, #預付款現變碼
          apgd040   LIKE apgd_t.apgd040, #支付帳戶
          apgd041   LIKE apgd_t.apgd041, #多幣別採購單
          apgd112   LIKE apgd_t.apgd112  #預付款本幣金額
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_docno       LIKE apca_t.apcadocno
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   DEFINE l_apcb113sum  LIKE type_t.num20_6
   DEFINE l_apcb114sum  LIKE type_t.num20_6
   DEFINE l_apcb115sum  LIKE type_t.num20_6
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   DEFINE l_oodb004     LIKE oodb_t.oodb004
   DEFINE l_apca013     LIKE apca_t.apca013
   DEFINE l_apca012     LIKE apca_t.apca012
   DEFINE l_oodb011     LIKE oodb_t.oodb011
   DEFINE l_date        DATETIME YEAR TO SECOND
   DEFINE l_count       LIKE type_t.num10     #160824-00049#7
   DEFINE l_xrcd009     LIKE xrcd_t.xrcd009
   DEFINE l_ooef011     LIKE ooef_t.ooef011 #161129-00042#1-add
   DEFINE l_isac004     LIKE isac_t.isac004 #161230-00036#1-add
   DEFINE l_isac008     LIKE isac_t.isac008 #161230-00036#1-add
   DEFINE l_vat_id      STRING              #161230-00036#1-add
   WHENEVER ERROR CONTINUE
   
   LET r_success = TRUE
   LET r_docno = NULL
   INITIALIZE l_apga.* TO NULL
   #SELECT * INTO l_apga.* FROM apga_t WHERE apgaent = g_enterprise AND apgacomp = g_apcacomp AND apgadocno = g_apca_m.apca018   #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgaent,apgaownid,apgaowndp,apgacrtid,apgacrtdp,
          apgacrtdt,apgamodid,apgamoddt,apgacnfid,apgacnfdt,
          apgapstid,apgapstdt,apgastus,apgacomp,apgadocno,
          apgadocdt,apga001,apga002,apga003,apga004,
          apga005,apga006,apga007,apga008,apga009,
          apga010,apga011,apga012,apga013,apga014,
          apga015,apga016,apga017,apga018,apga019,
          apga020,apga021,apga022,apga023,apga024,
          apga025,apga026,apga027,apga028,apga029,
          apga030,apga031,apga100,apga101,apga103,
          apga104,apga105,apga106,apga107,apga108,
          apga113,apga114,apga115,apgaud001,apgaud002,
          apgaud003,apgaud004,apgaud005,apgaud006,apgaud007,
          apgaud008,apgaud009,apgaud010,apgaud011,apgaud012,
          apgaud013,apgaud014,apgaud015,apgaud016,apgaud017,
          apgaud018,apgaud019,apgaud020,apgaud021,apgaud022,
          apgaud023,apgaud024,apgaud025,apgaud026,apgaud027,
          apgaud028,apgaud029,apgaud030,apga102,apga109,
          apga112,apga117,apga118,apga032,apga033,
          apga034,apga035,apga040,apga041,apga036,
          apga037,apga038,apga039 
     INTO l_apga.* 
     FROM apga_t 
    WHERE apgaent = g_enterprise 
      AND apgacomp = g_apcacomp 
      AND apgadocno = g_apca_m.apca018
   #161208-00026#13-add(e)
   #SELECT * INTO l_apgd.* FROM apgd_t WHERE apgdent = g_enterprise AND apgdcomp = g_apcacomp AND apgddocno = g_apca_m.apca018 AND apgd900 = g_apca_m.apca064 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgdent,apgdownid,apgdowndp,apgdcrtid,apgdcrtdp,
          apgdcrtdt,apgdmodid,apgdmoddt,apgdcnfid,apgdcnfdt,
          apgdpstid,apgdpstdt,apgdstus,apgdcomp,apgddocno,
          apgddocdt,apgd001,apgd002,apgd003,apgd004,
          apgd005,apgd006,apgd007,apgd008,apgd009,
          apgd010,apgd011,apgd012,apgd013,apgd014,
          apgd015,apgd016,apgd017,apgd018,apgd019,
          apgd020,apgd021,apgd022,apgd023,apgd024,
          apgd025,apgd026,apgd027,apgd028,apgd029,
          apgd030,apgd100,apgd101,apgd103,apgd104,
          apgd108,apgd105,apgd113,apgd114,apgd115,
          apgd900,apgdud001,apgdud002,apgdud003,apgdud004,
          apgdud005,apgdud006,apgdud007,apgdud008,apgdud009,
          apgdud010,apgdud011,apgdud012,apgdud013,apgdud014,
          apgdud015,apgdud016,apgdud017,apgdud018,apgdud019,
          apgdud020,apgdud021,apgdud022,apgdud023,apgdud024,
          apgdud025,apgdud026,apgdud027,apgdud028,apgdud029,
          apgdud030,apgd031,apgd102,apgd109,apgd117,
          apgd118,apgd106,apgd107,apgd032,apgd033,
          apgd034,apgd035,apgd036,apgd037,apgd038,
          apgd039,apgd040,apgd041,apgd112 
     INTO l_apgd.* 
     FROM apgd_t 
    WHERE apgdent = g_enterprise 
      AND apgdcomp = g_apcacomp 
      AND apgddocno = g_apca_m.apca018 
      AND apgd900 = g_apca_m.apca064
   #161208-00026#13-add(e)
   
   INITIALIZE l_apca.* TO NULL
   LET l_apca.apcaent = g_enterprise
   LET l_apca.apcacomp = l_apgd.apgdcomp
   LET l_apca.apcald = NULL
   SELECT glaald,glaa001,glaa016,glaa020
     INTO l_apca.apcald,l_apca.apca100,l_apca.apca120,l_apca.apca130
     FROM glaa_t
    WHERE glaaent  = g_enterprise
      AND glaacomp = l_apgd.apgdcomp    #160824-00049#7
      AND glaa014  = 'Y'
   LET l_apca.apcadocdt = g_apca_m.apcadocdt
   LET l_apca.apca003   = g_apca_m.apca003
   LET l_apca.apca016   = g_apca_m.apca016
   LET l_apca.apca018   = g_apca_m.apca018
   LET l_apca.apcadocno = g_apca_m.apcadocno
   CALL s_aooi200_fin_gen_docno(l_apca.apcald,'','',l_apca.apcadocno,l_apca.apcadocdt,'aapt560') 
      RETURNING g_sub_success,l_apca.apcadocno                                            
   IF NOT g_sub_success THEN
      LET r_success = FALSE
      RETURN r_success,r_docno
   END IF
   LET l_apca.apcastus  = 'N' # 狀態碼 
   LET l_apca.apcasite = l_apca.apcacomp   # 帳務中心                            apcasite   = apgccomp                                                    
   LET l_apca.apca001 =  s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3001')
   LET l_apca.apca003 = g_user # 帳務人員                            apca003    = g_user                                                      
   LET l_apca.apca004 = l_apgd.apgd004 # 帳款對象編號                        apca004    = 廠商(受益人)apga004   
   CALL s_apmm100_sel_pmac002(l_apca.apca004,'1') RETURNING l_apca.apca005,l_desc
   IF cl_null(l_apca.apca005)THEN LET l_apca.apca005 = l_apca.apca004 END IF
   SELECT pmaa080,pmaa047 INTO l_apca.apca006,l_apca.apca046
     FROM pmaa_t
    WHERE pmaaent = g_enterprise AND pmaa001 = l_apca.apca004
   LET lc_param_apca.apcald   = l_apca.apcald
   LET lc_param_apca.apcacomp = l_apca.apcacomp
   LET lc_param_apca.apcasite = l_apca.apcasite
   LET lc_param_apca.apcadocdt= l_apca.apcadocdt
   LET lc_param_apca.apca001  = '19' #l_apca.apca001
   LET lc_param_apca.apca004  = l_apca.apca004
   SELECT ooef019 INTO lc_param_apca.ooef019 FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = l_apca.apcacomp
   LET ls_js = util.JSON.stringify(lc_param_apca)
   CALL s_aapt300_get_apca004_info(ls_js) RETURNING ls_js
   CALL util.JSON.parse(ls_js,lc_param_info)
   LET l_apca.apca006 = lc_param_info.apca006  
   LET l_apca.apca007 = lc_param_info.apca007   # 帳款類別           apca007    = 廠商慣用條件
   LET l_apca.apca008 = lc_param_info.apca008   # 付款條件編號       apca008    = 取交易對象慣用付款條件
   LET l_apca.apca009 = lc_param_info.apca009   # 應付款日/應扣抵日  apca009    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca010 = lc_param_info.apca010   # 容許票據到期日     apca010    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca011 = lc_param_info.apca011   # 稅別               apca011    = 取交易對象慣用稅別,實際稅別在單身呈現
   LET l_apca.apca012 = lc_param_info.apca012   # 稅率               apca012    = 依稅別串 oodb006
   LET l_apca.apca013 = lc_param_info.apca013   # 含稅否             apca013    = 依稅別串 oodb005                   
   LET l_apca.apca014 = l_apgd.apgd005          # 人員編號           apca014    = apga005
   LET l_apca.apca015 = NULL                    # 部門編號           apca015    = apga005 所屬部門
   SELECT ooag003 INTO l_apca.apca015 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apca.apca014 
   LET l_apca.apca034 = lc_param_info.apca034   # 責任中心                            apca034    = 依 aapt300原則帶出      
   LET l_apca.apca035 = lc_param_info.apca035   # 應付(貸方)科目編號                  apca035    = 依帳款類別帶出           
   LET l_apca.apca036 = lc_param_info.apca036   # 費用(借方)科目編號                  apca036    = 依帳款類別帶出     
   LET l_apca.apca046 = lc_param_info.apca046       
   LET l_apca.apca054 = lc_param_info.apca054   # 多帳期設定                          apca054    = 依付款條件取出 
   LET l_apca.apca055 = lc_param_info.apca055   # 繳款優惠條件                        apca055    = 依付款條件取出 
   LET l_apca.apca058 = lc_param_info.apca058
   LET l_apca.apca060 = lc_param_info.apca060
   LET l_apca.apca016 = '32'
   LET l_apca.apca017 = '1'
   LET l_apca.apca018 = l_apgd.apgddocno
   LET l_apca.apca020 = 'N'         # 信用狀付款否 
   LET l_apca.apca026 = 0
   LET l_apca.apca027 = 0
   LET l_apca.apca028 = 0
   LET l_apca.apca029 = 0
   LET l_apca.apca037 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-0030')# 產生傳票否                          apca037    = 取單別參數D-FIN-0030    
   LET l_apca.apca064 = g_apca_m.apca064
   LET l_apca.apca067 = l_apga.apgadocno
   LET l_apca.apca101 = 1
   LET l_apca.apca103 = 0
   LET l_apca.apca104 = 0
   LET l_apca.apca106 = 0 
   LET l_apca.apca107 = 0
   LET l_apca.apca108 = 0 
   LET l_apca.apca113 = 0
   LET l_apca.apca114 = 0 
   LET l_apca.apca116 = 0
   LEt l_apca.apca117 = 0 
   LET l_apca.apca118 = 0 
   LET lc_param2.apca004 = l_apca.apca004
   CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-3009') RETURNING lc_param2.sfin2009
   LET ls_js = util.JSON.stringify(lc_param2)   
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apca.apca100,ls_js)
        RETURNING l_apca.apca101,l_apca.apca121,l_apca.apca131
   LET l_apca.apca123 = 0
   LET l_apca.apca124 = 0
   LET l_apca.apca126 = 0 
   LET l_apca.apca127 = 0 
   LET l_apca.apca128 = 0
   LET l_apca.apca133 = 0 
   LET l_apca.apca134 = 0 
   LET l_apca.apca136 = 0 
   LET l_apca.apca137 = 0
   LET l_apca.apca138 = 0 
   LET l_apca.apca071 = 0
   LET l_apca.apca072 = 0
   #albireo 160624-----s
   LEt l_apca.apca073 = l_apga.apga001
   LET l_apca.apcaownid = g_user
   LET l_apca.apcaowndp = g_dept
   LET l_apca.apcacrtid = g_user
   LET l_apca.apcacrtdp = g_dept
   LET l_date = cl_get_current()
   LET l_apca.apcacrtdt = l_date
   #albireo 160624-----e
   #INSERT INTO apca_t VALUES(l_apca.*) #161108-00017#4 mark
   #161108-00017#4 add ------
   INSERT INTO apca_t (apcaent,apcaownid,apcaowndp,apcacrtid,apcacrtdp,
                       apcacrtdt,apcamodid,apcamoddt,apcacnfid,apcacnfdt,
                       apcapstid,apcapstdt,apcastus,apcald,apcacomp,
                       apcadocno,apcadocdt,apcasite,
                       apca001,apca003,apca004,apca005,apca006,
                       apca007,apca008,apca009,apca010,apca011,
                       apca012,apca013,apca014,apca015,apca016,
                       apca017,apca018,apca019,apca020,apca021,
                       apca022,apca025,apca026,apca027,apca028,
                       apca029,apca030,apca031,apca032,apca033,
                       apca034,apca035,apca036,apca037,apca038,
                       apca039,apca040,apca041,apca042,apca043,
                       apca044,apca045,apca046,apca047,apca048,
                       apca049,apca050,apca051,apca052,apca053,
                       apca054,apca055,apca056,apca057,apca058,
                       apca059,apca060,apca061,apca062,apca063,
                       apca064,apca065,apca066,apca100,apca101,
                       apca103,apca104,apca106,apca107,apca108,
                       apca113,apca114,apca116,apca117,apca118,
                       apca120,apca121,apca123,apca124,apca126,
                       apca127,apca128,apca130,apca131,apca133,
                       apca134,apca136,apca137,apca138,
                       apcaud001,apcaud002,apcaud003,apcaud004,apcaud005,
                       apcaud006,apcaud007,apcaud008,apcaud009,apcaud010,
                       apcaud011,apcaud012,apcaud013,apcaud014,apcaud015,
                       apcaud016,apcaud017,apcaud018,apcaud019,apcaud020,
                       apcaud021,apcaud022,apcaud023,apcaud024,apcaud025,
                       apcaud026,apcaud027,apcaud028,apcaud029,apcaud030,
                       apca067,apca068,apca069,apca070,apca071,
                       apca072,apca073
                      )
   VALUES (l_apca.apcaent,l_apca.apcaownid,l_apca.apcaowndp,l_apca.apcacrtid,l_apca.apcacrtdp,
           l_apca.apcacrtdt,l_apca.apcamodid,l_apca.apcamoddt,l_apca.apcacnfid,l_apca.apcacnfdt,
           l_apca.apcapstid,l_apca.apcapstdt,l_apca.apcastus,l_apca.apcald,l_apca.apcacomp,
           l_apca.apcadocno,l_apca.apcadocdt,l_apca.apcasite,
           l_apca.apca001,l_apca.apca003,l_apca.apca004,l_apca.apca005,l_apca.apca006,
           l_apca.apca007,l_apca.apca008,l_apca.apca009,l_apca.apca010,l_apca.apca011,
           l_apca.apca012,l_apca.apca013,l_apca.apca014,l_apca.apca015,l_apca.apca016,
           l_apca.apca017,l_apca.apca018,l_apca.apca019,l_apca.apca020,l_apca.apca021,
           l_apca.apca022,l_apca.apca025,l_apca.apca026,l_apca.apca027,l_apca.apca028,
           l_apca.apca029,l_apca.apca030,l_apca.apca031,l_apca.apca032,l_apca.apca033,
           l_apca.apca034,l_apca.apca035,l_apca.apca036,l_apca.apca037,l_apca.apca038,
           l_apca.apca039,l_apca.apca040,l_apca.apca041,l_apca.apca042,l_apca.apca043,
           l_apca.apca044,l_apca.apca045,l_apca.apca046,l_apca.apca047,l_apca.apca048,
           l_apca.apca049,l_apca.apca050,l_apca.apca051,l_apca.apca052,l_apca.apca053,
           l_apca.apca054,l_apca.apca055,l_apca.apca056,l_apca.apca057,l_apca.apca058,
           l_apca.apca059,l_apca.apca060,l_apca.apca061,l_apca.apca062,l_apca.apca063,
           l_apca.apca064,l_apca.apca065,l_apca.apca066,l_apca.apca100,l_apca.apca101,
           l_apca.apca103,l_apca.apca104,l_apca.apca106,l_apca.apca107,l_apca.apca108,
           l_apca.apca113,l_apca.apca114,l_apca.apca116,l_apca.apca117,l_apca.apca118,
           l_apca.apca120,l_apca.apca121,l_apca.apca123,l_apca.apca124,l_apca.apca126,
           l_apca.apca127,l_apca.apca128,l_apca.apca130,l_apca.apca131,l_apca.apca133,
           l_apca.apca134,l_apca.apca136,l_apca.apca137,l_apca.apca138,
           l_apca.apcaud001,l_apca.apcaud002,l_apca.apcaud003,l_apca.apcaud004,l_apca.apcaud005,
           l_apca.apcaud006,l_apca.apcaud007,l_apca.apcaud008,l_apca.apcaud009,l_apca.apcaud010,
           l_apca.apcaud011,l_apca.apcaud012,l_apca.apcaud013,l_apca.apcaud014,l_apca.apcaud015,
           l_apca.apcaud016,l_apca.apcaud017,l_apca.apcaud018,l_apca.apcaud019,l_apca.apcaud020,
           l_apca.apcaud021,l_apca.apcaud022,l_apca.apcaud023,l_apca.apcaud024,l_apca.apcaud025,
           l_apca.apcaud026,l_apca.apcaud027,l_apca.apcaud028,l_apca.apcaud029,l_apca.apcaud030,
           l_apca.apca067,l_apca.apca068,l_apca.apca069,l_apca.apca070,l_apca.apca071,
           l_apca.apca072,l_apca.apca073
          )
   #161108-00017#4 add end---
   
   #apgc產生 apcb xrcd_t
   #LET l_sql = "SELECT * FROM apgc_t ",   #161208-00026#13 mark
   #161208-00026#13-add(s)
   LET l_sql = "SELECT apgcent,apgccomp,apgcdocno,apgcseq,apgc900,
                       apgcorga,apgc001,apgc002,apgc003,apgc004,
                       apgc005,apgc006,apgc007,apgc008,apgc009,
                       apgc010,apgc011,apgc012,apgc013,apgc014,
                       apgc015,apgc016,apgc100,apgc101,apgc103,
                       apgc104,apgc105,apgc113,apgc114,apgc115,
                       apgcud001,apgcud002,apgcud003,apgcud004,apgcud005,
                       apgcud006,apgcud007,apgcud008,apgcud009,apgcud010,
                       apgcud011,apgcud012,apgcud013,apgcud014,apgcud015,
                       apgcud016,apgcud017,apgcud018,apgcud019,apgcud020,
                       apgcud021,apgcud022,apgcud023,apgcud024,apgcud025,
                       apgcud026,apgcud027,apgcud028,apgcud029,apgcud030  
                  FROM apgc_t ",
   #161208-00026#13-add(e)
               " WHERE apgcent = ",g_enterprise," ",
               "   AND apgccomp = '",l_apga.apgacomp,"' ",
               "   AND apgcdocno = '",l_apga.apgadocno,"' ",
               "   AND apgc900 = ? "
   PREPARE sel_apgcp2 FROM l_sql
   DECLARE sel_apgcc2 CURSOR FOR sel_apgcp2
   
   #FOREACH sel_apgcc2 USING g_apca_m.apca064 INTO l_apgc.* #161208-00026#13 mark
   #161208-00026#13-add(s)
   FOREACH sel_apgcc2 USING g_apca_m.apca064 INTO l_apgc.apgcent,l_apgc.apgccomp,l_apgc.apgcdocno,l_apgc.apgcseq,l_apgc.apgc900,
                                                  l_apgc.apgcorga,l_apgc.apgc001,l_apgc.apgc002,l_apgc.apgc003,l_apgc.apgc004,
                                                  l_apgc.apgc005,l_apgc.apgc006,l_apgc.apgc007,l_apgc.apgc008,l_apgc.apgc009,
                                                  l_apgc.apgc010,l_apgc.apgc011,l_apgc.apgc012,l_apgc.apgc013,l_apgc.apgc014,
                                                  l_apgc.apgc015,l_apgc.apgc016,l_apgc.apgc100,l_apgc.apgc101,l_apgc.apgc103,
                                                  l_apgc.apgc104,l_apgc.apgc105,l_apgc.apgc113,l_apgc.apgc114,l_apgc.apgc115,
                                                  l_apgc.apgcud001,l_apgc.apgcud002,l_apgc.apgcud003,l_apgc.apgcud004,l_apgc.apgcud005,
                                                  l_apgc.apgcud006,l_apgc.apgcud007,l_apgc.apgcud008,l_apgc.apgcud009,l_apgc.apgcud010,
                                                  l_apgc.apgcud011,l_apgc.apgcud012,l_apgc.apgcud013,l_apgc.apgcud014,l_apgc.apgcud015,
                                                  l_apgc.apgcud016,l_apgc.apgcud017,l_apgc.apgcud018,l_apgc.apgcud019,l_apgc.apgcud020,
                                                  l_apgc.apgcud021,l_apgc.apgcud022,l_apgc.apgcud023,l_apgc.apgcud024,l_apgc.apgcud025,
                                                  l_apgc.apgcud026,l_apgc.apgcud027,l_apgc.apgcud028,l_apgc.apgcud029,l_apgc.apgcud030
   #161208-00026#13-add(e)
      IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
      #r2.產生apcb-----s
      INITIALIZE l_apcb.* TO NULL
      LET l_apcb.apcbent   = g_enterprise
      LET l_apcb.apcbld    = l_apca.apcald
      LET l_apcb.apcblegl  = l_apca.apcacomp
      LET l_apcb.apcbsite  = l_apca.apcasite
      LET l_apcb.apcbdocno = l_apca.apcadocno
      LET l_apcb.apcbseq   = NULL
      SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
       WHERE apcbent   = g_enterprise
         AND apcbld    = l_apcb.apcbld
         AND apcbdocno = l_apcb.apcbdocno
      IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
      LET l_apcb.apcb001 = '54'
      LET l_apcb.apcb002 = l_apgc.apgcdocno
      LET l_apcb.apcb003 = l_apgc.apgcseq
      LET l_apcb.apcb014 = l_apgc.apgc001 #160428-00001#8       
      LET l_apcb.apcb005 = s_desc_get_acc_desc('3117',l_apgc.apgc001)
      LET l_apcb.apcb006 = ' '
      LET l_apcb.apcb007 = 1
      LET l_apcb.apcb010 = l_apca.apca015
      CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                       RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
      LET l_apcb.apcb020 = l_apgc.apgc006
      LET l_apcb.apcb021 = l_apgc.apgc004
      LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')   #albireo 160624 add
      LET l_apcb.apcb023 = 'N'
      LET l_apcb.apcb027 = l_apgc.apgc008
      LET l_apcb.apcb028 = l_apgc.apgc009
      LET l_apcb.apcb029 = l_apca.apca035
      LET l_apcb.apcb030 = l_apca.apca008
      LET l_apcb.apcb051 = l_apca.apca014
      LET l_apcb.apcb100 = l_apgc.apgc100
      LET l_apcb.apcb101 = l_apgc.apgc105   #albireo 160623 add
      LET l_apcb.apcb102 = l_apgc.apgc101
      LET l_apcb.apcb103 = l_apgc.apgc103
      LET l_apcb.apcb104 = l_apgc.apgc104
      LET l_apcb.apcb105 = l_apgc.apgc105
      LET l_apcb.apcb108 = l_apcb.apcb103
      LET l_apcb.apcb111 = l_apgc.apgc115   #albireo 160623 add
      LET l_apcb.apcb113 = l_apgc.apgc113
      LET l_apcb.apcb114 = l_apgc.apgc114
      LET l_apcb.apcb115 = l_apgc.apgc115
      LET l_apcb.apcborga = l_apgc.apgcorga
      CALL s_tax_chk(l_apca.apcacomp,l_apcb.apcb020) RETURNING g_sub_success,l_oodb004,l_apca013,l_apca012,l_oodb011
      IF l_apca013 = 'Y' THEN
         LET l_apcb.apcb105 = l_apcb.apcb105
      ELSE
         LET l_apcb.apcb105 = l_apcb.apcb103
      END IF
      CALL s_tax_ins(l_apca.apcadocno,l_apcb.apcbseq,'0',l_apcb.apcborga,l_apcb.apcb105,
                l_apcb.apcb020,l_apcb.apcb007,l_apcb.apcb100,l_apcb.apcb102,l_apca.apcald,l_apca.apca121,l_apca.apca131)   #albireo 160630
          RETURNING l_apcb.apcb103,l_apcb.apcb104,l_apcb.apcb105,
                    l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,
                    l_apcb.apcb123,l_apcb.apcb124,l_apcb.apcb125,
                    l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         EXIT FOREACH
         LET r_success = FALSE
      END IF
      #r2.產生apcb-----e
      
      #r3.產生直接付款apde-----s
      INITIALIZE l_apde.* TO NULL
      LET l_apde.apdeent  =l_apca.apcaent
      LET l_apde.apdeld =l_apca.apcald
      LET l_apde.apdecomp =l_apca.apcacomp
      LET l_apde.apdeorga =l_apca.apcacomp
      LET l_apde.apdesite =l_apca.apcasite
      LET l_apde.apdedocno =l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
      IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
      LET l_apde.apdeseq = l_apde.apdeseq + 1
      LET l_apde.apde001 = 'aapt560'
      LET l_apde.apde009 = 'Y'
      LET l_apde.apde028 = '0'
      LET l_apde.apde002 = '10'
      LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'3')
      #以判斷完匯兌損失/匯兌收益,將金額轉正顯示
      LET l_apde.apde109 =  l_apgc.apgc105
      LET l_apde.apde119 =  l_apgc.apgc115
      LET l_apde.apde006 = '10'   
      #銀行存提碼
      LET l_apde.apde011 = l_apgc.apgc015
      #現金變動碼
      LET l_apde.apde012 = l_apgc.apgc016
      LET l_apde.apde013 = ''
      LET l_apde.apde014 = ''
      LET l_apde.apde016 = ''
      LET l_apde.apde100 = l_apgc.apgc100
      LET l_apde.apde101 = l_apgc.apgc101
      LET l_apde.apde039 = l_apga.apga007
      LET l_apde.apde041 = NULL
      SELECT nmabl003 INTO l_apde.apde041
        FROM nmabl_t
       WHERE nmablent = g_enterprise
         AND nmabl001 = l_apde.apde039
         AND nmabl002 = g_dlang
      IF cl_null(l_apde.apde101) THEN LET l_apde.apde101 = 1 END IF
      LET l_apde.apde032 = l_apca.apcadocdt
      LET l_apde.apde061 = '54'
      #LET l_apde.apde016 = l_apgc.apgc004   #160824-00049#7 mark
      LET l_apde.apde008 = l_apgc.apgc014
      #160824-00049#7-----s
       CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016
      #160824-00049#7-----e
      INSERT INTO apde_t(apdeent,
                         apdeld,apdecomp,apdesite,apdedocno,apdeseq,
                         apde001,apde009,apde028,apde002,apde015,
                         apde003,apde004,apdeorga,apde006,apde011,
                         apde012,apde013,apde014,apde016,apde017,
                         apde018,apde021,apde032,apde100,apde101,
                         apde039,apde040,apde041,
                         apde008,
                         apde109,apde119,apde061)
             VALUES(l_apde.apdeent,
                    l_apde.apdeld,l_apde.apdecomp,l_apde.apdesite,l_apde.apdedocno,l_apde.apdeseq,
                    l_apde.apde001,l_apde.apde009,l_apde.apde028,l_apde.apde002,l_apde.apde015,
                    l_apde.apde003,l_apde.apde004,l_apde.apdeorga,l_apde.apde006,l_apde.apde011,
                    l_apde.apde012,l_apde.apde013,l_apde.apde014,l_apde.apde016,l_apde.apde017,
                    l_apde.apde018,l_apde.apde021,l_apde.apde032,l_apde.apde100,l_apde.apde101,
                    l_apde.apde039,l_apde.apde040,l_apde.apde041,
                    l_apde.apde008,
                    l_apde.apde109,l_apde.apde119,l_apde.apde061)
      IF SQLCA.SQLCODE THEN LET r_success = FALSE EXIT FOREACH END IF
      #r3.產生直接付款apde-----e
      
      #INSERT isam
      INITIALIZE l_isam.* TO NULL
      LET l_isam.isament = l_apca.apcaent
      LET l_isam.isamdocno = l_apca.apcadocno
      SELECT MAX(isamseq)+1 INTO l_isam.isamseq
        FROM isam_t
       WHERE isament = g_enterprise
         AND isamdocno = l_apca.apcadocno
         AND isam001 = 'aapt560'
      IF cl_null(l_isam.isamseq)THEN LET l_isam.isamseq = 1 END IF
      LET l_isam.isam001 = 'aapt560'
      LET l_isam.isam002 = l_apca.apca004                           
      LET l_isam.isam008 = l_apgc.apgc007                           
      LET l_isam.isam009 = l_apgc.apgc008                           
      LET l_isam.isam010 = l_apgc.apgc009                           
      LET l_isam.isam011 = l_apgc.apgc010                           
      LET l_isam.isam012 = l_apgc.apgc006        
      LET l_isam.isam0121= l_apca.apca013                  
      LET l_isam.isam013 = l_apca.apca012
      LET l_isam.isam014 = l_apgc.apgc100                           
      LET l_isam.isam015 = l_apgc.apgc101                           
      LET l_isam.isam016 = l_ooefl006
      LET l_isam.isam017 = l_ooef002
      CALL s_aapp320_buy_info(l_apca.apcacomp)RETURNING l_pmaal003,l_isao001,      
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021
      LET l_isam.isam023 = l_apgc.apgc103                           
      LET l_isam.isam024 = l_apgc.apgc104                           
      LET l_isam.isam025 = l_apgc.apgc105                           
      LET l_isam.isam026 = l_apgc.apgc113                           
      LET l_isam.isam027 = l_apgc.apgc114                           
      LET l_isam.isam028 = l_apgc.apgc115                           
      LET l_isam.isam029 = s_desc_get_trading_partner_abbr_desc(l_apca.apca004)  

      SELECT isak008,isak009,isak010,isak011,isak012
        INTO l_isam.isam030,l_isam.isam031,l_isam.isam032,
             l_isam.isam033,l_isam.isam034
        FROM isak_t
       WHERE isakent = g_enterprise
         AND isak001 = l_apca.apca004
         AND isak002 = lc_param_apca.ooef019
      #161129-00042#1-add(s) #161230-00036#1  mark(s)
      #LET l_ooef011 = ' '
      #SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
      #IF l_ooef011 = 'TW' THEN
      #   #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
      #   CALL s_rule_chk_vat_id_string(l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET r_success = FALSE
      #      RETURN r_success,r_docno
      #   END IF  
      #   #檢查營利事業統一編號邏輯，錯了下方提示不控卡
      #   CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET l_isam.isam030 = l_isam.isam030
      #   END IF
      #END IF
      #161129-00042#1-add(e) #161230-00036#1  mark(e)  
      LET l_isam.isam035 = '1'                                 
      LET l_isam.isam036 = '11'                                
      LET l_isam.isam037 = l_apgc.apgc011                           
      LET l_isam.isam050 = l_apca.apcadocno                         
      LET l_isam.isam107    = 0                                 
      LET l_isam.isam108    = 0                                 
      LET l_isam.isam117    = 0                                 
      LET l_isam.isam118    = 0
      IF NOT cl_null(l_isam.isam010)THEN
         #161230-00036#1 add(s)
         LET l_isac004 = ''
         LET l_isac008 = ''
         SELECT isac004,isac008 INTO l_isac004,l_isac008 FROM isac_t WHERE isacent = g_enterprise 
            AND isac002 = l_isam.isam008 AND isac001 = lc_param_apca.ooef019
         #IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) THEN                                              #170218-00012#1 mark
         IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) AND l_isac004 != '28' AND l_isac004 != '29' THEN   #170218-00012#1 add
            #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
            LET l_ooef011 = ' '
            SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
            IF l_ooef011 = 'TW' THEN
               IF NOT cl_null(l_isam.isam030) THEN   #170218-00012#1 add
                  LET l_vat_id = l_isam.isam030
                  IF l_vat_id.getLength() <> 8  THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF         
                  IF NOT cl_chk_num(l_isam.isam030,'N') THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF
                  #檢查營利事業統一編號邏輯，錯了下方提示不控卡
                  CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
                  IF NOT g_sub_success THEN
                     LET l_isam.isam030 = l_isam.isam030
                  END IF
               END IF   #170218-00012#1 add
            END IF
         END IF            
         #161230-00036#1 add(e)
         #INSERT INTO isam_t VALUES(l_isam.*)  #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO isam_t (isament,isamownid,isamowndp,isamcrtid,isamcrtdp,
                             isamcrtdt,isammodid,isammoddt,isamcnfid,isamcnfdt,
                             isamstus,isamcomp,isamdocno,isamseq,
                             isam001,isam002,isam004,isam006,isam008,
                             isam009,isam010,isam011,isam012,isam0121,
                             isam013,isam014,isam015,isam016,isam017,
                             isam018,isam019,isam020,isam021,isam022,
                             isam023,isam024,isam025,isam026,isam027,
                             isam028,isam029,isam030,isam031,isam032,
                             isam033,isam034,isam035,isam036,isam037,
                             isam038,isam039,isam040,isam041,isam042,
                             isam043,isam044,isam045,isam046,isam047,
                             isam048,isam049,isam050,isam107,isam108,
                             isam117,isam118,isam200,isam201,isam202,
                             isam203,isam204,isam205,isam206,isam207,
                             isam208,isam209,isam210,
                             isamud001,isamud002,isamud003,isamud004,isamud005,
                             isamud006,isamud007,isamud008,isamud009,isamud010,
                             isamud011,isamud012,isamud013,isamud014,isamud015,
                             isamud016,isamud017,isamud018,isamud019,isamud020,
                             isamud021,isamud022,isamud023,isamud024,isamud025,
                             isamud026,isamud027,isamud028,isamud029,isamud030,
                             isam051
                            )
         VALUES (l_isam.isament,l_isam.isamownid,l_isam.isamowndp,l_isam.isamcrtid,l_isam.isamcrtdp,
                 l_isam.isamcrtdt,l_isam.isammodid,l_isam.isammoddt,l_isam.isamcnfid,l_isam.isamcnfdt,
                 l_isam.isamstus,l_isam.isamcomp,l_isam.isamdocno,l_isam.isamseq,
                 l_isam.isam001,l_isam.isam002,l_isam.isam004,l_isam.isam006,l_isam.isam008,
                 l_isam.isam009,l_isam.isam010,l_isam.isam011,l_isam.isam012,l_isam.isam0121,
                 l_isam.isam013,l_isam.isam014,l_isam.isam015,l_isam.isam016,l_isam.isam017,
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021,l_isam.isam022,
                 l_isam.isam023,l_isam.isam024,l_isam.isam025,l_isam.isam026,l_isam.isam027,
                 l_isam.isam028,l_isam.isam029,l_isam.isam030,l_isam.isam031,l_isam.isam032,
                 l_isam.isam033,l_isam.isam034,l_isam.isam035,l_isam.isam036,l_isam.isam037,
                 l_isam.isam038,l_isam.isam039,l_isam.isam040,l_isam.isam041,l_isam.isam042,
                 l_isam.isam043,l_isam.isam044,l_isam.isam045,l_isam.isam046,l_isam.isam047,
                 l_isam.isam048,l_isam.isam049,l_isam.isam050,l_isam.isam107,l_isam.isam108,
                 l_isam.isam117,l_isam.isam118,l_isam.isam200,l_isam.isam201,l_isam.isam202,
                 l_isam.isam203,l_isam.isam204,l_isam.isam205,l_isam.isam206,l_isam.isam207,
                 l_isam.isam208,l_isam.isam209,l_isam.isam210,
                 l_isam.isamud001,l_isam.isamud002,l_isam.isamud003,l_isam.isamud004,l_isam.isamud005,
                 l_isam.isamud006,l_isam.isamud007,l_isam.isamud008,l_isam.isamud009,l_isam.isamud010,
                 l_isam.isamud011,l_isam.isamud012,l_isam.isamud013,l_isam.isamud014,l_isam.isamud015,
                 l_isam.isamud016,l_isam.isamud017,l_isam.isamud018,l_isam.isamud019,l_isam.isamud020,
                 l_isam.isamud021,l_isam.isamud022,l_isam.isamud023,l_isam.isamud024,l_isam.isamud025,
                 l_isam.isamud026,l_isam.isamud027,l_isam.isamud028,l_isam.isamud029,l_isam.isamud030,
                 l_isam.isam051
                )
         #161108-00017#4 add end---      
      END IF  
   END FOREACH
   
   #161004-00019#1-----s
   CALL s_fin_get_account(l_apca.apcald,'13',l_apca.apca007,'8504_04') RETURNING g_sub_success,l_xrcd009,g_errno
   UPDATE xrcd_t SET xrcd009 = l_xrcd009
    WHERE xrcdent= g_enterprise
      AND xrcdld = l_apca.apcald AND xrcddocno = l_apca.apcadocno
      AND xrcd009 IS NULL
   #161004-00019#1-----e
   
   LET l_pmab055 = NULL
   SELECT pmab055 INTO l_pmab055 FROM pmab_t
    WHERE pmabsite = l_apca.apcacomp
      AND pmab001 = l_apca.apca004
      AND pmabent = g_enterprise
   
   #自備款-----s
   IF l_apga.apga026 = 'Y' THEN   #albireo 160711 add
      LET l_apga.apga104 = NULL
      SELECT (apgh005-apgh004) INTO l_apga.apga104 FROM apgh_t
       WHERE apghent = g_enterprise
         AND apghcomp = l_apga.apgacomp
         AND apghdocno = l_apga.apgadocno
         AND apghseq = 0
         AND apgh001 = l_apgd.apgd900
         AND apgh002 = 'apga104'
      IF cl_null(l_apga.apga104) THEN LET l_apga.apga104 = 0 END IF
      #160824-00049#7-----s
      LET l_apga.apga114 = NULL
      SELECT (apgh005-apgh004) INTO l_apga.apga114 FROM apgh_t
       WHERE apghent = g_enterprise
         AND apghcomp = l_apga.apgacomp
         AND apghdocno = l_apga.apgadocno
         AND apghseq = 0
         AND apgh001 = l_apgd.apgd900
         AND apgh002 = 'apga114'
      IF cl_null(l_apga.apga114) THEN LET l_apga.apga114 = 0 END IF
      #160824-00049#7-----e

      LET l_glaa121 = NULL LET l_glaa016 = NULL
      LET l_glaa020 = NULL LET l_glaa019 = NULL
      LET l_glaa015 = NULL
      SELECT glaa121,glaa016,glaa020 ,
             glaa015,glaa019,
             glaa001  #161228-00062#1 add
        INTO l_glaa121,l_glaa016,l_glaa020,
             l_glaa015,l_glaa019,
             l_glaa001  #161228-00062#1 add
        FROM glaa_t
       WHERE glaaent = g_enterprise
         AND glaald = l_apca.apcald
      
      
      INITIALIZE l_apde.* TO NULL
      LET l_apde.apdeent   = g_enterprise
      LET l_apde.apdecomp  = l_apca.apcacomp
      LET l_apde.apdeld    = l_apca.apcald
      LET l_apde.apdedocno = l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
      #albireo 160624-----s
      IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
      LET l_apde.apdeseq = l_apde.apdeseq + 1
      #albireo 160624-----e
      LET l_apde.apdesite  = l_apca.apcasite
      LET l_apde.apdeorga  = l_apca.apcasite
      LET l_apde.apde001   = 'aapt560'
      LET l_apde.apde002   = '23'
      LET l_apde.apde006   = '10'
      LET l_apde.apde008   = l_apga.apga040
      LET l_apde.apde009 = 'Y'
      LET l_apde.apde011 = l_apga.apga036
      LET l_apde.apde012 = l_apga.apga037
      LET l_apde.apde014 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
      LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
      LET l_apde.apde016 = NULL
      #SELECT glab005 INTO l_apde.apde016 FROM glab_t
      # WHERE glabent = g_enterprise
      #   AND glabld = l_apde.apdeld
      #   AND glab001 = '13'
      #   AND glab002 = l_pmab055
      #   AND glab003 = '8504_31'
      CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
         RETURNING l_apde.apde016   #albireo 160630 add
      LET l_apde.apde017 = l_apga.apga005
      LET l_apde.apde018 = NULL
      SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
       WHERE ooagent = g_enterprise
         AND ooag001 = l_apde.apde017
      #LET l_apde.apde019 =          
      CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
                 RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
      LET l_apde.apde028 = '2'
      LET l_apde.apde032 = l_apga.apga003
      LET l_apde.apde038 = l_apca.apca004
      LET l_apde.apde039 = l_apga.apga007
      SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
       WHERE nmablent = g_enterprise
         AND nmabl001 = l_apde.apde039
         AND nmabl002 = g_dlang
      LET l_apde.apde100 = l_apga.apga100
      LET l_apde.apde101 = l_apga.apga101
      LET l_apde.apde104 = 0 
      LET l_apde.apde109 = l_apga.apga104
      LET l_apde.apde119 = l_apga.apga114   #160824-00049#7
      #s_curr_round
      CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
      LET lc_param2.apca004 = l_apca.apca004
      LET ls_js = util.JSON.stringify(lc_param2)
      CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
           RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
      #s_curr_round
      LET l_apde.apde101 = l_apga.apga101
      LET l_apde.apde120 = l_apca.apca120
      
      IF l_glaa015 = 'Y' THEN
         LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
         CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
      END IF
      
      LET l_apde.apde130 = l_apca.apca130
      IF l_glaa019 = 'Y' THEN
         LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
         CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
      END IF
      LET l_apde.apde061 = '51'
      IF l_apde.apde109 > 0 THEN
         #INSERT INTO apde_t VALUES(l_apde.*) #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                             apdesite,apdeorga,
                             apde001,apde002,apde003,apde004,apde006,
                             apde008,apde009,apde010,apde011,apde012,
                             apde013,apde014,apde015,apde016,apde017,
                             apde018,apde019,apde020,apde021,apde022,
                             apde023,apde024,apde028,apde029,apde030,
                             apde032,apde035,apde036,apde038,apde039,
                             apde040,apde041,apde042,apde043,apde044,
                             apde045,apde046,apde047,apde051,apde052,
                             apde053,apde054,apde055,apde056,apde057,
                             apde058,apde059,apde060,apde100,apde101,
                             apde104,apde109,apde119,apde120,apde121,
                             apde129,apde130,apde131,apde139,
                             apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                             apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                             apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                             apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                             apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                             apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                             apde061
                            )
         VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
                 l_apde.apdesite,l_apde.apdeorga,
                 l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
                 l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
                 l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
                 l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
                 l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
                 l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
                 l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
                 l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
                 l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
                 l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
                 l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
                 l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
                 l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
                 l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
                 l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
                 l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
                 l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
                 l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
                 l_apde.apde061
                )
         #161108-00017#4 add end---
      END IF
      
      INITIALIZE l_apcb.* TO NULL
      LET l_apcb.apcbent   = g_enterprise
      LET l_apcb.apcbld    = l_apca.apcald
      LET l_apcb.apcblegl  = l_apca.apcacomp
      LET l_apcb.apcbsite  = l_apca.apcasite
      LET l_apcb.apcbdocno = l_apca.apcadocno
      LET l_apcb.apcbseq   = NULL
      SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
       WHERE apcbent   = g_enterprise
         AND apcbld    = l_apcb.apcbld
         AND apcbdocno = l_apcb.apcbdocno
      IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
      LET l_apcb.apcb001 = '51'
      LET l_apcb.apcb002 = l_apga.apgadocno
      LET l_apcb.apcb003 = 0
      
      LET l_apcb.apcb006 = ' '
      LET l_apcb.apcb007 = 1
      LET l_apcb.apcb010 = l_apca.apca015
      CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                       RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
      LET l_apcb.apcb020 = ''
      #LET l_apcb.apcb021 = l_apgc.apgc004
      SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
       WHERE glabent = g_enterprise
         AND glabld = l_apde.apdeld
         AND glab001 = '15'
         AND glab002 = '3117'
         AND glab003 = '8504_31'
      LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
      LET l_apcb.apcb023 = 'N'
      #LET l_apcb.apcb027 = l_apgc.apgc008
      #LET l_apcb.apcb028 = l_apgc.apgc009
      LET l_apcb.apcb029 = l_apca.apca035
      LET l_apcb.apcb030 = l_apca.apca008
      LET l_apcb.apcb051 = l_apca.apca014
      LET l_apcb.apcb100 = l_apga.apga100   #albireo 160630
      LET l_apcb.apcb101 = l_apga.apga104   #albireo 160624
      LET l_apcb.apcb102 = l_apga.apga101   #albireo 160630
      LET l_apcb.apcb103 = l_apga.apga104
      LET l_apcb.apcb104 = 0
      
      LET l_apcb.apcb105 = l_apga.apga104
      LET l_apcb.apcb108 = l_apga.apga104
      LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
      LET l_apcb.apcb113 = l_apga.apga114
      LET l_apcb.apcb114 = 0
      LET l_apcb.apcb115 = l_apga.apga114
  LET l_apcb.apcborga = l_apca.apcacomp
      LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
      LET l_apcb.apcb124 = 0
      LET l_apcb.apcb125 = l_apcb.apcb125
      LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
      LET l_apcb.apcb134 = 0
      LET l_apcb.apcb135 = l_apcb.apcb135
      IF l_apcb.apcb115 > 0 THEN
         #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                             apcbdocno,apcbseq,
                             apcb001,apcb002,apcb003,apcb004,apcb005,
                             apcb006,apcb007,apcb008,apcb009,apcb010,
                             apcb011,apcb012,apcb013,apcb014,apcb015,
                             apcb016,apcb017,apcb018,apcb019,apcb020,
                             apcb021,apcb022,apcb023,apcb024,apcb025,
                             apcb026,apcb027,apcb028,apcb029,apcb030,
                             apcb032,apcb033,apcb034,apcb035,apcb036,
                             apcb037,apcb038,apcb039,apcb040,apcb041,
                             apcb042,apcb043,apcb044,apcb045,apcb046,
                             apcb047,apcb048,apcb049,apcb050,apcb051,
                             apcb100,apcb101,apcb102,apcb103,apcb104,
                             apcb105,apcb106,apcb107,apcb108,apcb111,
                             apcb113,apcb114,apcb115,apcb116,apcb117,
                             apcb118,apcb119,apcb121,apcb123,apcb124,
                             apcb125,apcb126,apcb127,apcb128,apcb131,
                             apcb133,apcb134,apcb135,apcb136,apcb137,
                             apcb138,
                             apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                             apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                             apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                             apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                             apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                             apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                             apcb052,apcb053,apcb054,apcb055
                            )
         VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
                 l_apcb.apcbdocno,l_apcb.apcbseq,
                 l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
                 l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
                 l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
                 l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
                 l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
                 l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
                 l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
                 l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
                 l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
                 l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
                 l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
                 l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
                 l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
                 l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
                 l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
                 l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
                 l_apcb.apcb138,
                 l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
                 l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
                 l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
                 l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
                 l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
                 l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
                 l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
                )
         #161108-00017#4 add end---
         IF SQLCA.SQLCODE THEN
            LET r_success = FALSE
         END IF
      END IF
   END IF
   #自備款-----e
   
   #保證金-----s
   LET l_apga.apga108 = NULL
   SELECT (apgh005-apgh004) INTO l_apga.apga108 FROM apgh_t
    WHERE apghent = g_enterprise
      AND apghcomp = l_apga.apgacomp
      AND apghdocno = l_apga.apgadocno
      AND apghseq = 0
      AND apgh001 = l_apgd.apgd900
      AND apgh002 = 'apga108'
   IF cl_null(l_apga.apga108) THEN LET l_apga.apga108 = 0 END IF
   #160824-00049#7-----s
   LET l_apga.apga118 = NULL
   SELECT (apgh005-apgh004) INTO l_apga.apga118 FROM apgh_t
    WHERE apghent = g_enterprise
      AND apghcomp = l_apga.apgacomp
      AND apghdocno = l_apga.apgadocno
      AND apghseq = 0
      AND apgh001 = l_apgd.apgd900
      AND apgh002 = 'apga118'
   IF cl_null(l_apga.apga118) THEN LET l_apga.apga118 = 0 END IF   
   #160824-00049#7-----e
   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
   SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
    WHERE apdeent   = l_apde.apdeent
      AND apdeld    = l_apde.apdeld
      AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '23'
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apga.apga034    #albireo 160630
   LET l_apde.apde012 = l_apga.apga035    #albireo 160630
   LET l_apde.apde014 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '13'
   #   AND glab002 = l_pmab055
   #   AND glab003 = '8504_32'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang   #albireo 160729 add
   LET l_apde.apde100 = l_apga.apga100
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apga.apga108   #160824-00049#7 
   LET l_apde.apde119 = l_apga.apga118   #160824-00049#7
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '52'
   IF l_apde.apde109 > 0 THEN
      #INSERT INTO apde_t VALUES(l_apde.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF
   
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '52'
   LET l_apcb.apcb002 = l_apga.apgadocno
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
    WHERE glabent = g_enterprise
      AND glabld = l_apde.apdeld
      AND glab001 = '15'
      AND glab002 = '3117'
      AND glab003 = '8504_32'
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apga.apga100   #albireo 160630
   LET l_apcb.apcb101 = l_apga.apga108   #160624 albireo
   LET l_apcb.apcb102 = l_apga.apga101   #albireo 160630
   LET l_apcb.apcb103 = l_apga.apga108
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apga.apga108
   LET l_apcb.apcb108 = l_apga.apga108
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apga.apga118
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apga.apga118
  LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   LET l_apcb.apcb124 = 0
   LET l_apcb.apcb125 = l_apcb.apcb125
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   LET l_apcb.apcb134 = 0
   LET l_apcb.apcb135 = l_apcb.apcb135
   IF l_apcb.apcb115 > 0 THEN
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF
   #保證金-----e
   
   #預付款-----s
   LET l_apga.apga102 = NULL
   SELECT (apgh005-apgh004) INTO l_apga.apga102 FROM apgh_t
    WHERE apghent = g_enterprise
      AND apghcomp = l_apga.apgacomp
      AND apghdocno = l_apga.apgadocno
      AND apghseq = 0
      AND apgh001 = l_apgd.apgd900
      AND apgh002 = 'apga102'
   IF cl_null(l_apga.apga102) THEN LET l_apga.apga102 = 0 END IF
   #160824-00049#7-----s
   LET l_apga.apga112 = NULL
   SELECT (apgh005-apgh004) INTO l_apga.apga112 FROM apgh_t
    WHERE apghent = g_enterprise
      AND apghcomp = l_apga.apgacomp
      AND apghdocno = l_apga.apgadocno
      AND apghseq = 0
      AND apgh001 = l_apgd.apgd900
      AND apgh002 = 'apga112'
   IF cl_null(l_apga.apga112) THEN LET l_apga.apga112 = 0 END IF   
   #160824-00049#7-----e
   
   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
   SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
    WHERE apdeent   = l_apde.apdeent
      AND apdeld    = l_apde.apdeld
      AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '23'
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apga.apga038    #albireo 160630
   LET l_apde.apde012 = l_apga.apga039    #albireo 160630
   LET l_apde.apde014 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '13'
   #   AND glab002 = l_pmab055
   #   AND glab003 = '8504_33'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang   #albireo 160729 add
   LET l_apde.apde100 = l_apga.apga100
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apga.apga102
   LET l_apde.apde119 = l_apga.apga112   #160824-00049#7
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '53'
   IF l_apde.apde109 > 0 THEN
      #INSERT INTO apde_t VALUES(l_apde.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF
   
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '53'
   LET l_apcb.apcb002 = l_apga.apgadocno
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
    WHERE glabent = g_enterprise
      AND glabld = l_apde.apdeld
      AND glab001 = '15'
      AND glab002 = '3117'
      AND glab003 = '8504_33'
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apga.apga100   #albireo 160630
   LET l_apcb.apcb101 = l_apga.apga102   #albireo 160624 add
   LET l_apcb.apcb102 = l_apga.apga101   #albireo 160630
   LET l_apcb.apcb103 = l_apga.apga102
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apga.apga102
   LET l_apcb.apcb108 = l_apga.apga102
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apga.apga112
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apga.apga112
  LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   LET l_apcb.apcb124 = 0
   LET l_apcb.apcb125 = l_apcb.apcb125
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   LET l_apcb.apcb134 = 0
   LET l_apcb.apcb135 = l_apcb.apcb135
   IF l_apcb.apcb113 > 0 THEN
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF
   #預付款-----e
   
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
      
   LET l_apcb113sum = NULL   LET l_apcb114sum = NULL   LET l_apcb115sum = NULL
   SELECT SUM(apcb113),SUM(apcb114),SUM(apcb115)
     INTO l_apcb113sum,l_apcb114sum,l_apcb115sum
     FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbld  = l_apca.apcald
      AND apcbdocno = l_apca.apcadocno
   IF cl_null(l_apcb113sum)THEN LET l_apcb113sum = 0 END IF
   IF cl_null(l_apcb114sum)THEN LET l_apcb114sum = 0 END IF
   IF cl_null(l_apcb115sum)THEN LET l_apcb115sum = 0 END IF
   
   UPDATE apca_t SET apca103 = l_apcb113sum,
                     apca104 = l_apcb114sum,
                     apca108 = l_apcb115sum,
                     apca113 = l_apcb113sum,
                     apca114 = l_apcb114sum,
                     apca118 = l_apcb115sum,
                     #160824-00049#7-----s
                     apca107 = l_apcb115sum,
                     apca117 = l_apcb115sum
                     #160824-00049#7-----e
    WHERE apcaent = g_enterprise
      AND apcald  = l_apca.apcald
      AND apcadocno = l_apca.apcadocno

   CALL s_aap_multi_bill_period(l_apca.apcald,l_apca.apcadocno) RETURNING g_sub_success,g_errno

   UPDATE apcc_t SET apcc109 = apcc108 ,apcc119 = apcc118
    WHERE apccent = g_enterprise
      AND apccdocno = l_apca.apcadocno
      AND apccld    = l_apca.apcald
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e

   CALL s_pre_voucher_ins('AP','P10',l_apca.apcald,l_apca.apcadocno,l_apca.apcadocdt,'1')
                       RETURNING g_sub_success
   IF NOT g_sub_success THEN
      LET r_success = FALSE
   END IF   
   
   #160824-00049#7-----s
   LET l_count = NULL
   SELECT COUNT(*) INTO l_count FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbdocno = l_apca.apcadocno
      AND apcbld = l_apca.apcald
   IF cl_null(l_count)THEN LET l_count = 0 END IF
   
   IF l_count = 0 THEN
      LET r_success = FALSE
      INITIALIZE g_errparam.* TO NULL
      LET g_errparam.code = 'agl-00167'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
   END IF
   #160824-00049#7-----e
   
   
   UPDATE apgd_t SET apgd028 = l_apca.apcadocno
    WHERE apgdent = g_enterprise
      AND apgdcomp = l_apca.apcacomp
      AND apgddocno = g_apca_m.apca018
      AND apgd900   = g_apca_m.apca064
   LET r_docno = l_apca.apcadocno
   RETURN r_success,r_docno
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_ins_ap_3()
#DEFINE l_apca   RECORD LIKE apca_t.* #161104-00024#5 mark
#161104-00024#5-add(s)
DEFINE l_apca  RECORD  #應付憑單單頭
       apcaent   LIKE apca_t.apcaent, #企業編號
       apcaownid LIKE apca_t.apcaownid, #資料所有者
       apcaowndp LIKE apca_t.apcaowndp, #資料所有部門
       apcacrtid LIKE apca_t.apcacrtid, #資料建立者
       apcacrtdp LIKE apca_t.apcacrtdp, #資料建立部門
       apcacrtdt LIKE apca_t.apcacrtdt, #資料創建日
       apcamodid LIKE apca_t.apcamodid, #資料修改者
       apcamoddt LIKE apca_t.apcamoddt, #最近修改日
       apcacnfid LIKE apca_t.apcacnfid, #資料確認者
       apcacnfdt LIKE apca_t.apcacnfdt, #資料確認日
       apcapstid LIKE apca_t.apcapstid, #資料過帳者
       apcapstdt LIKE apca_t.apcapstdt, #資料過帳日
       apcastus  LIKE apca_t.apcastus, #狀態碼
       apcald    LIKE apca_t.apcald, #帳套
       apcacomp  LIKE apca_t.apcacomp, #法人
       apcadocno LIKE apca_t.apcadocno, #應付帳款單號碼
       apcadocdt LIKE apca_t.apcadocdt, #帳款日期
       apcasite  LIKE apca_t.apcasite, #帳務中心
       apca001   LIKE apca_t.apca001, #帳款單性質
       apca003   LIKE apca_t.apca003, #帳務人員
       apca004   LIKE apca_t.apca004, #帳款對象編號
       apca005   LIKE apca_t.apca005, #付款對象
       apca006   LIKE apca_t.apca006, #供應商分類
       apca007   LIKE apca_t.apca007, #帳款類別
       apca008   LIKE apca_t.apca008, #付款條件編號
       apca009   LIKE apca_t.apca009, #應付款日/應扣抵日
       apca010   LIKE apca_t.apca010, #容許票據到期日
       apca011   LIKE apca_t.apca011, #稅別
       apca012   LIKE apca_t.apca012, #稅率
       apca013   LIKE apca_t.apca013, #含稅否
       apca014   LIKE apca_t.apca014, #人員編號
       apca015   LIKE apca_t.apca015, #部門編號
       apca016   LIKE apca_t.apca016, #來源作業類型
       apca017   LIKE apca_t.apca017, #產生方式
       apca018   LIKE apca_t.apca018, #來源參考單號
       apca019   LIKE apca_t.apca019, #系統產生對應單號(待抵帳款-預付)
       apca020   LIKE apca_t.apca020, #信用狀付款否
       apca021   LIKE apca_t.apca021, #商業發票號碼(IV no.)
       apca022   LIKE apca_t.apca022, #進口報單號碼
       apca025   LIKE apca_t.apca025, #差異處理(發票與帳款差異)
       apca026   LIKE apca_t.apca026, #原幣未稅差異
       apca027   LIKE apca_t.apca027, #原幣稅額差異
       apca028   LIKE apca_t.apca028, #本幣未稅差異
       apca029   LIKE apca_t.apca029, #本幣幣稅額差異
       apca030   LIKE apca_t.apca030, #差異科目
       apca031   LIKE apca_t.apca031, #產生之差異折讓單號
       apca032   LIKE apca_t.apca032, #發票類型
       apca033   LIKE apca_t.apca033, #專案編號
       apca034   LIKE apca_t.apca034, #責任中心
       apca035   LIKE apca_t.apca035, #應付(貸方)科目編號
       apca036   LIKE apca_t.apca036, #費用(借方)科目編號
       apca037   LIKE apca_t.apca037, #產生傳票否
       apca038   LIKE apca_t.apca038, #拋轉傳票號碼
       apca039   LIKE apca_t.apca039, #會計檢核附件份數
       apca040   LIKE apca_t.apca040, #留置否
       apca041   LIKE apca_t.apca041, #留置理由碼
       apca042   LIKE apca_t.apca042, #留置設定日期
       apca043   LIKE apca_t.apca043, #留置解除日期
       apca044   LIKE apca_t.apca044, #留置原幣金額
       apca045   LIKE apca_t.apca045, #留置說明
       apca046   LIKE apca_t.apca046, #關係人否
       apca047   LIKE apca_t.apca047, #多角序號
       apca048   LIKE apca_t.apca048, #集團代付/代付單號
       apca049   LIKE apca_t.apca049, #來源營運中心編號
       apca050   LIKE apca_t.apca050, #交易原始單據份數
       apca051   LIKE apca_t.apca051, #作廢理由碼
       apca052   LIKE apca_t.apca052, #列印次數
       apca053   LIKE apca_t.apca053, #備註
       apca054   LIKE apca_t.apca054, #多帳期設定
       apca055   LIKE apca_t.apca055, #繳款優惠條件
       apca056   LIKE apca_t.apca056, #會計檢核附件狀態
       apca057   LIKE apca_t.apca057, #交易對象識別碼
       apca058   LIKE apca_t.apca058, #稅別交易類型
       apca059   LIKE apca_t.apca059, #預算編號
       apca060   LIKE apca_t.apca060, #發票開立方式
       apca061   LIKE apca_t.apca061, #預開發票基準日
       apca062   LIKE apca_t.apca062, #多角性質
       apca063   LIKE apca_t.apca063, #整帳批序號
       apca064   LIKE apca_t.apca064, #訂金序次
       apca065   LIKE apca_t.apca065, #發票編號
       apca066   LIKE apca_t.apca066, #發票號碼
       apca100   LIKE apca_t.apca100, #交易原幣別
       apca101   LIKE apca_t.apca101, #原幣匯率
       apca103   LIKE apca_t.apca103, #原幣未稅金額
       apca104   LIKE apca_t.apca104, #原幣稅額
       apca106   LIKE apca_t.apca106, #原幣應稅折抵合計金額
       apca107   LIKE apca_t.apca107, #原幣直接沖帳(調整)合計金額
       apca108   LIKE apca_t.apca108, #原幣應付金額
       apca113   LIKE apca_t.apca113, #本幣未稅金額
       apca114   LIKE apca_t.apca114, #本幣稅額
       apca116   LIKE apca_t.apca116, #本幣應稅折抵合計金額
       apca117   LIKE apca_t.apca117, #NO USE
       apca118   LIKE apca_t.apca118, #本幣應付金額
       apca120   LIKE apca_t.apca120, #本位幣二幣別
       apca121   LIKE apca_t.apca121, #本位幣二匯率
       apca123   LIKE apca_t.apca123, #本位幣二未稅金額
       apca124   LIKE apca_t.apca124, #本位幣二稅額
       apca126   LIKE apca_t.apca126, #本位幣二應稅折抵合計金額
       apca127   LIKE apca_t.apca127, #NO USE
       apca128   LIKE apca_t.apca128, #本位幣二應付金額
       apca130   LIKE apca_t.apca130, #本位幣三幣別
       apca131   LIKE apca_t.apca131, #本位幣三匯率
       apca133   LIKE apca_t.apca133, #本位幣三未稅金額
       apca134   LIKE apca_t.apca134, #本位幣三稅額
       apca136   LIKE apca_t.apca136, #本位幣三應稅折抵合計金額
       apca137   LIKE apca_t.apca137, #NO USE
       apca138   LIKE apca_t.apca138, #本位幣三應付金額
       apcaud001 LIKE apca_t.apcaud001, #自定義欄位(文字)001
       apcaud002 LIKE apca_t.apcaud002, #自定義欄位(文字)002
       apcaud003 LIKE apca_t.apcaud003, #自定義欄位(文字)003
       apcaud004 LIKE apca_t.apcaud004, #自定義欄位(文字)004
       apcaud005 LIKE apca_t.apcaud005, #自定義欄位(文字)005
       apcaud006 LIKE apca_t.apcaud006, #自定義欄位(文字)006
       apcaud007 LIKE apca_t.apcaud007, #自定義欄位(文字)007
       apcaud008 LIKE apca_t.apcaud008, #自定義欄位(文字)008
       apcaud009 LIKE apca_t.apcaud009, #自定義欄位(文字)009
       apcaud010 LIKE apca_t.apcaud010, #自定義欄位(文字)010
       apcaud011 LIKE apca_t.apcaud011, #自定義欄位(數字)011
       apcaud012 LIKE apca_t.apcaud012, #自定義欄位(數字)012
       apcaud013 LIKE apca_t.apcaud013, #自定義欄位(數字)013
       apcaud014 LIKE apca_t.apcaud014, #自定義欄位(數字)014
       apcaud015 LIKE apca_t.apcaud015, #自定義欄位(數字)015
       apcaud016 LIKE apca_t.apcaud016, #自定義欄位(數字)016
       apcaud017 LIKE apca_t.apcaud017, #自定義欄位(數字)017
       apcaud018 LIKE apca_t.apcaud018, #自定義欄位(數字)018
       apcaud019 LIKE apca_t.apcaud019, #自定義欄位(數字)019
       apcaud020 LIKE apca_t.apcaud020, #自定義欄位(數字)020
       apcaud021 LIKE apca_t.apcaud021, #自定義欄位(日期時間)021
       apcaud022 LIKE apca_t.apcaud022, #自定義欄位(日期時間)022
       apcaud023 LIKE apca_t.apcaud023, #自定義欄位(日期時間)023
       apcaud024 LIKE apca_t.apcaud024, #自定義欄位(日期時間)024
       apcaud025 LIKE apca_t.apcaud025, #自定義欄位(日期時間)025
       apcaud026 LIKE apca_t.apcaud026, #自定義欄位(日期時間)026
       apcaud027 LIKE apca_t.apcaud027, #自定義欄位(日期時間)027
       apcaud028 LIKE apca_t.apcaud028, #自定義欄位(日期時間)028
       apcaud029 LIKE apca_t.apcaud029, #自定義欄位(日期時間)029
       apcaud030 LIKE apca_t.apcaud030, #自定義欄位(日期時間)030
       apca067   LIKE apca_t.apca067, #管理品類
       apca068   LIKE apca_t.apca068, #經營方式
       apca069   LIKE apca_t.apca069, #no use
       apca070   LIKE apca_t.apca070, #no use
       apca071   LIKE apca_t.apca071, #no use
       apca072   LIKE apca_t.apca072, #no use
       apca073   LIKE apca_t.apca073  #L/C No.
           END RECORD
#161104-00024#5-add(e)
DEFINE l_desc   LIKE type_t.chr1000
DEFINE ls_js            STRING   
DEFINE lc_param_apca    RECORD
         apcald         LIKE apca_t.apcald,
         apcacomp       LIKE apca_t.apcacomp,
         apcasite       LIKE apca_t.apcasite,
         apcadocdt      LIKE apca_t.apcadocdt,
         apca001        LIKE apca_t.apca001,
         apca004        LIKE apca_t.apca004,
         ooef019        LIKE ooef_t.ooef019
                        END RECORD
DEFINE lc_param_info    RECORD
            apca005        LIKE apca_t.apca005,
            apca005_desc   LIKE type_t.chr80,
            apca006        LIKE apca_t.apca006,    #供應商分類
            apca007        LIKE apca_t.apca007,
            apca007_desc   LIKE type_t.chr80,
            apca008        LIKE apca_t.apca008,
            apca008_desc   LIKE type_t.chr80,
            apca009        LIKE apca_t.apca009,
            apca010        LIKE apca_t.apca010,
            apca011        LIKE apca_t.apca011,
            apca011_desc   LIKE type_t.chr80,
            apca012        LIKE apca_t.apca012,
            apca013        LIKE apca_t.apca013,
            apca014        LIKE apca_t.apca014,
            apca014_desc   LIKE type_t.chr80,
            apca015        LIKE apca_t.apca015,
            apca015_desc   LIKE type_t.chr80,
            apca034        LIKE apca_t.apca034,
            apca034_desc   LIKE type_t.chr80,
            apca035        LIKE apca_t.apca035,
            apca035_desc   LIKE type_t.chr80,
            apca036        LIKE apca_t.apca036,
            apca036_desc   LIKE type_t.chr80,
            apca046        LIKE apca_t.apca046,
            apca054        LIKE apca_t.apca054,
            apca054_desc   LIKE type_t.chr80,
            apca055        LIKE apca_t.apca055,
            apca055_desc   LIKE type_t.chr80,
            apca056        LIKE apca_t.apca056,
            apca058        LIKE apca_t.apca058,
            apca058_desc   LIKE type_t.chr80,
            apca060        LIKE apca_t.apca060,
            apca100        LIKE apca_t.apca100,
            apca101        LIKE apca_t.apca101,
            apca121        LIKE apca_t.apca121,
            apca131        LIKE apca_t.apca131
                       END RECORD
   DEFINE lc_param2        RECORD
         type           LIKE type_t.chr1,       #類型
         apca004        LIKE apca_t.apca004,
         sfin2009       LIKE type_t.chr1        #汇率基本    
         END RECORD
   #DEFINE l_apga    RECORD LIKE apga_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apga  RECORD  #信用狀申請單主檔
          apgaent   LIKE apga_t.apgaent, #企業編號
          apgaownid LIKE apga_t.apgaownid, #資料所有者
          apgaowndp LIKE apga_t.apgaowndp, #資料所屬部門
          apgacrtid LIKE apga_t.apgacrtid, #資料建立者
          apgacrtdp LIKE apga_t.apgacrtdp, #資料建立部門
          apgacrtdt LIKE apga_t.apgacrtdt, #資料創建日
          apgamodid LIKE apga_t.apgamodid, #資料修改者
          apgamoddt LIKE apga_t.apgamoddt, #最近修改日
          apgacnfid LIKE apga_t.apgacnfid, #資料確認者
          apgacnfdt LIKE apga_t.apgacnfdt, #資料確認日
          apgapstid LIKE apga_t.apgapstid, #資料過帳者
          apgapstdt LIKE apga_t.apgapstdt, #資料過帳日
          apgastus  LIKE apga_t.apgastus, #狀態碼
          apgacomp  LIKE apga_t.apgacomp, #法人
          apgadocno LIKE apga_t.apgadocno, #申請單號
          apgadocdt LIKE apga_t.apgadocdt, #申請日期
          apga001   LIKE apga_t.apga001, #L/C NO
          apga002   LIKE apga_t.apga002, #版次
          apga003   LIKE apga_t.apga003, #開狀日期
          apga004   LIKE apga_t.apga004, #供應商(受益人)
          apga005   LIKE apga_t.apga005, #業務人員
          apga006   LIKE apga_t.apga006, #付款類型
          apga007   LIKE apga_t.apga007, #開狀銀行
          apga008   LIKE apga_t.apga008, #信用狀類別
          apga009   LIKE apga_t.apga009, #保兌信用狀否
          apga010   LIKE apga_t.apga010, #信用狀有效日期
          apga011   LIKE apga_t.apga011, #許可證號
          apga012   LIKE apga_t.apga012, #承兌日期
          apga013   LIKE apga_t.apga013, #保兌費用支付方
          apga014   LIKE apga_t.apga014, #可否分批交運
          apga015   LIKE apga_t.apga015, #自備款比率
          apga016   LIKE apga_t.apga016, #融資利率
          apga017   LIKE apga_t.apga017, #融資天數
          apga018   LIKE apga_t.apga018, #融資合約編號
          apga019   LIKE apga_t.apga019, #最後裝運日
          apga020   LIKE apga_t.apga020, #運送方式
          apga021   LIKE apga_t.apga021, #裝載港/機場
          apga022   LIKE apga_t.apga022, #卸載港/機場
          apga023   LIKE apga_t.apga023, #E.T.D
          apga024   LIKE apga_t.apga024, #E.T.A
          apga025   LIKE apga_t.apga025, #備註
          apga026   LIKE apga_t.apga026, #開狀時支付自備款
          apga027   LIKE apga_t.apga027, #NO USE
          apga028   LIKE apga_t.apga028, #帳務單號
          apga029   LIKE apga_t.apga029, #結案否
          apga030   LIKE apga_t.apga030, #通知銀行
          apga031   LIKE apga_t.apga031, #開狀時支付自備款
          apga100   LIKE apga_t.apga100, #幣別
          apga101   LIKE apga_t.apga101, #開狀匯率
          apga103   LIKE apga_t.apga103, #開狀原幣金額
          apga104   LIKE apga_t.apga104, #自備款原幣金額
          apga105   LIKE apga_t.apga105, #融資原幣金額
          apga106   LIKE apga_t.apga106, #到單原幣金額
          apga107   LIKE apga_t.apga107, #到貨原幣金額
          apga108   LIKE apga_t.apga108, #保證金原幣金額
          apga113   LIKE apga_t.apga113, #開狀本幣金額
          apga114   LIKE apga_t.apga114, #自備款本幣金額
          apga115   LIKE apga_t.apga115, #融資本幣金額
          apgaud001 LIKE apga_t.apgaud001, #自定義欄位(文字)001
          apgaud002 LIKE apga_t.apgaud002, #自定義欄位(文字)002
          apgaud003 LIKE apga_t.apgaud003, #自定義欄位(文字)003
          apgaud004 LIKE apga_t.apgaud004, #自定義欄位(文字)004
          apgaud005 LIKE apga_t.apgaud005, #自定義欄位(文字)005
          apgaud006 LIKE apga_t.apgaud006, #自定義欄位(文字)006
          apgaud007 LIKE apga_t.apgaud007, #自定義欄位(文字)007
          apgaud008 LIKE apga_t.apgaud008, #自定義欄位(文字)008
          apgaud009 LIKE apga_t.apgaud009, #自定義欄位(文字)009
          apgaud010 LIKE apga_t.apgaud010, #自定義欄位(文字)010
          apgaud011 LIKE apga_t.apgaud011, #自定義欄位(數字)011
          apgaud012 LIKE apga_t.apgaud012, #自定義欄位(數字)012
          apgaud013 LIKE apga_t.apgaud013, #自定義欄位(數字)013
          apgaud014 LIKE apga_t.apgaud014, #自定義欄位(數字)014
          apgaud015 LIKE apga_t.apgaud015, #自定義欄位(數字)015
          apgaud016 LIKE apga_t.apgaud016, #自定義欄位(數字)016
          apgaud017 LIKE apga_t.apgaud017, #自定義欄位(數字)017
          apgaud018 LIKE apga_t.apgaud018, #自定義欄位(數字)018
          apgaud019 LIKE apga_t.apgaud019, #自定義欄位(數字)019
          apgaud020 LIKE apga_t.apgaud020, #自定義欄位(數字)020
          apgaud021 LIKE apga_t.apgaud021, #自定義欄位(日期時間)021
          apgaud022 LIKE apga_t.apgaud022, #自定義欄位(日期時間)022
          apgaud023 LIKE apga_t.apgaud023, #自定義欄位(日期時間)023
          apgaud024 LIKE apga_t.apgaud024, #自定義欄位(日期時間)024
          apgaud025 LIKE apga_t.apgaud025, #自定義欄位(日期時間)025
          apgaud026 LIKE apga_t.apgaud026, #自定義欄位(日期時間)026
          apgaud027 LIKE apga_t.apgaud027, #自定義欄位(日期時間)027
          apgaud028 LIKE apga_t.apgaud028, #自定義欄位(日期時間)028
          apgaud029 LIKE apga_t.apgaud029, #自定義欄位(日期時間)029
          apgaud030 LIKE apga_t.apgaud030, #自定義欄位(日期時間)030
          apga102   LIKE apga_t.apga102, #預付款原幣金額
          apga109   LIKE apga_t.apga109, #初開狀原幣金額
          apga112   LIKE apga_t.apga112, #預付款本幣金額
          apga117   LIKE apga_t.apga117, #到貨本幣金額
          apga118   LIKE apga_t.apga118, #保證金本幣金額
          apga032   LIKE apga_t.apga032, #保證金待抵單號
          apga033   LIKE apga_t.apga033, #預付款待抵單號
          apga034   LIKE apga_t.apga034, #保證金存提碼
          apga035   LIKE apga_t.apga035, #保證金現變碼
          apga040   LIKE apga_t.apga040, #支付帳戶
          apga041   LIKE apga_t.apga041, #多幣別採購單
          apga036   LIKE apga_t.apga036, #自備款存提碼
          apga037   LIKE apga_t.apga037, #自備款現變碼
          apga038   LIKE apga_t.apga038, #預付款存提碼
          apga039   LIKE apga_t.apga039  #預付款現變碼
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_success LIKE type_t.num5
   #DEFINE l_apgc    RECORD LIKE apgc_t.* #161104-00024#5 mark
   #DEFINE l_apcb    RECORD LIKE apcb_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgc  RECORD  #信用狀相關費用明細檔
          apgcent   LIKE apgc_t.apgcent, #企業編號
          apgccomp  LIKE apgc_t.apgccomp, #法人
          apgcdocno LIKE apgc_t.apgcdocno, #申請單號
          apgcseq   LIKE apgc_t.apgcseq, #項次
          apgc900   LIKE apgc_t.apgc900, #變更序
          apgcorga  LIKE apgc_t.apgcorga, #來源組織
          apgc001   LIKE apgc_t.apgc001, #費用編號
          apgc002   LIKE apgc_t.apgc002, #付款對象
          apgc003   LIKE apgc_t.apgc003, #付款條件
          apgc004   LIKE apgc_t.apgc004, #費用科目
          apgc005   LIKE apgc_t.apgc005, #帳款類別
          apgc006   LIKE apgc_t.apgc006, #稅別
          apgc007   LIKE apgc_t.apgc007, #發票類型
          apgc008   LIKE apgc_t.apgc008, #發票編號
          apgc009   LIKE apgc_t.apgc009, #發票號碼
          apgc010   LIKE apgc_t.apgc010, #發票日期
          apgc011   LIKE apgc_t.apgc011, #可扣抵編號
          apgc012   LIKE apgc_t.apgc012, #應付單號
          apgc013   LIKE apgc_t.apgc013, #費用來源
          apgc014   LIKE apgc_t.apgc014, #付款帳戶
          apgc015   LIKE apgc_t.apgc015, #存提碼
          apgc016   LIKE apgc_t.apgc016, #現金變動碼
          apgc100   LIKE apgc_t.apgc100, #幣別
          apgc101   LIKE apgc_t.apgc101, #匯率
          apgc103   LIKE apgc_t.apgc103, #原幣未稅金額
          apgc104   LIKE apgc_t.apgc104, #稅額
          apgc105   LIKE apgc_t.apgc105, #原幣含稅金額
          apgc113   LIKE apgc_t.apgc113, #本幣未稅金額
          apgc114   LIKE apgc_t.apgc114, #本幣稅額
          apgc115   LIKE apgc_t.apgc115, #本幣含稅金額
          apgcud001 LIKE apgc_t.apgcud001, #自定義欄位(文字)001
          apgcud002 LIKE apgc_t.apgcud002, #自定義欄位(文字)002
          apgcud003 LIKE apgc_t.apgcud003, #自定義欄位(文字)003
          apgcud004 LIKE apgc_t.apgcud004, #自定義欄位(文字)004
          apgcud005 LIKE apgc_t.apgcud005, #自定義欄位(文字)005
          apgcud006 LIKE apgc_t.apgcud006, #自定義欄位(文字)006
          apgcud007 LIKE apgc_t.apgcud007, #自定義欄位(文字)007
          apgcud008 LIKE apgc_t.apgcud008, #自定義欄位(文字)008
          apgcud009 LIKE apgc_t.apgcud009, #自定義欄位(文字)009
          apgcud010 LIKE apgc_t.apgcud010, #自定義欄位(文字)010
          apgcud011 LIKE apgc_t.apgcud011, #自定義欄位(數字)011
          apgcud012 LIKE apgc_t.apgcud012, #自定義欄位(數字)012
          apgcud013 LIKE apgc_t.apgcud013, #自定義欄位(數字)013
          apgcud014 LIKE apgc_t.apgcud014, #自定義欄位(數字)014
          apgcud015 LIKE apgc_t.apgcud015, #自定義欄位(數字)015
          apgcud016 LIKE apgc_t.apgcud016, #自定義欄位(數字)016
          apgcud017 LIKE apgc_t.apgcud017, #自定義欄位(數字)017
          apgcud018 LIKE apgc_t.apgcud018, #自定義欄位(數字)018
          apgcud019 LIKE apgc_t.apgcud019, #自定義欄位(數字)019
          apgcud020 LIKE apgc_t.apgcud020, #自定義欄位(數字)020
          apgcud021 LIKE apgc_t.apgcud021, #自定義欄位(日期時間)021
          apgcud022 LIKE apgc_t.apgcud022, #自定義欄位(日期時間)022
          apgcud023 LIKE apgc_t.apgcud023, #自定義欄位(日期時間)023
          apgcud024 LIKE apgc_t.apgcud024, #自定義欄位(日期時間)024
          apgcud025 LIKE apgc_t.apgcud025, #自定義欄位(日期時間)025
          apgcud026 LIKE apgc_t.apgcud026, #自定義欄位(日期時間)026
          apgcud027 LIKE apgc_t.apgcud027, #自定義欄位(日期時間)027
          apgcud028 LIKE apgc_t.apgcud028, #自定義欄位(日期時間)028
          apgcud029 LIKE apgc_t.apgcud029, #自定義欄位(日期時間)029
          apgcud030 LIKE apgc_t.apgcud030  #自定義欄位(日期時間)030
              END RECORD
   DEFINE l_apcb  RECORD  #應付憑單單身
          apcbent   LIKE apcb_t.apcbent, #企業編號
          apcbld    LIKE apcb_t.apcbld, #帳套
          apcblegl  LIKE apcb_t.apcblegl, #核算組織
          apcborga  LIKE apcb_t.apcborga, #帳務歸屬組織(來源組織)
          apcbsite  LIKE apcb_t.apcbsite, #應付帳務組織
          apcbdocno LIKE apcb_t.apcbdocno, #單號
          apcbseq   LIKE apcb_t.apcbseq, #項次
          apcb001   LIKE apcb_t.apcb001, #來源類型
          apcb002   LIKE apcb_t.apcb002, #來源業務單據號碼
          apcb003   LIKE apcb_t.apcb003, #來源業務單據項次
          apcb004   LIKE apcb_t.apcb004, #產品編號
          apcb005   LIKE apcb_t.apcb005, #品名規格
          apcb006   LIKE apcb_t.apcb006, #單位
          apcb007   LIKE apcb_t.apcb007, #計價數量
          apcb008   LIKE apcb_t.apcb008, #參考單據號碼
          apcb009   LIKE apcb_t.apcb009, #參考單據項次
          apcb010   LIKE apcb_t.apcb010, #業務部門
          apcb011   LIKE apcb_t.apcb011, #責任中心
          apcb012   LIKE apcb_t.apcb012, #產品類別
          apcb013   LIKE apcb_t.apcb013, #搭贈
          apcb014   LIKE apcb_t.apcb014, #理由碼
          apcb015   LIKE apcb_t.apcb015, #專案編號
          apcb016   LIKE apcb_t.apcb016, #WBS編號
          apcb017   LIKE apcb_t.apcb017, #預算細項
          apcb018   LIKE apcb_t.apcb018, #专柜编号
          apcb019   LIKE apcb_t.apcb019, #開票性質
          apcb020   LIKE apcb_t.apcb020, #稅別
          apcb021   LIKE apcb_t.apcb021, #費用會計科目
          apcb022   LIKE apcb_t.apcb022, #正負值
          apcb023   LIKE apcb_t.apcb023, #沖暫估單否
          apcb024   LIKE apcb_t.apcb024, #區域
          apcb025   LIKE apcb_t.apcb025, #傳票號碼
          apcb026   LIKE apcb_t.apcb026, #傳票項次
          apcb027   LIKE apcb_t.apcb027, #發票編號
          apcb028   LIKE apcb_t.apcb028, #發票號碼
          apcb029   LIKE apcb_t.apcb029, #應付帳款科目
          apcb030   LIKE apcb_t.apcb030, #付款條件
          apcb032   LIKE apcb_t.apcb032, #訂金序次
          apcb033   LIKE apcb_t.apcb033, #經營方式
          apcb034   LIKE apcb_t.apcb034, #通路
          apcb035   LIKE apcb_t.apcb035, #品牌
          apcb036   LIKE apcb_t.apcb036, #客群
          apcb037   LIKE apcb_t.apcb037, #自由核算項一
          apcb038   LIKE apcb_t.apcb038, #自由核算項二
          apcb039   LIKE apcb_t.apcb039, #自由核算項三
          apcb040   LIKE apcb_t.apcb040, #自由核算項四
          apcb041   LIKE apcb_t.apcb041, #自由核算項五
          apcb042   LIKE apcb_t.apcb042, #自由核算項六
          apcb043   LIKE apcb_t.apcb043, #自由核算項七
          apcb044   LIKE apcb_t.apcb044, #自由核算項八
          apcb045   LIKE apcb_t.apcb045, #自由核算項九
          apcb046   LIKE apcb_t.apcb046, #自由核算項十
          apcb047   LIKE apcb_t.apcb047, #摘要
          apcb048   LIKE apcb_t.apcb048, #來源訂購單號
          apcb049   LIKE apcb_t.apcb049, #開票單號
          apcb050   LIKE apcb_t.apcb050, #開票項次
          apcb051   LIKE apcb_t.apcb051, #業務人員
          apcb100   LIKE apcb_t.apcb100, #交易原幣
          apcb101   LIKE apcb_t.apcb101, #交易原幣單價
          apcb102   LIKE apcb_t.apcb102, #原幣匯率
          apcb103   LIKE apcb_t.apcb103, #交易原幣未稅金額
          apcb104   LIKE apcb_t.apcb104, #交易原幣稅額
          apcb105   LIKE apcb_t.apcb105, #交易原幣含稅金額
          apcb106   LIKE apcb_t.apcb106, #交易幣標準成本金額
          apcb107   LIKE apcb_t.apcb107, #入庫單單價
          apcb108   LIKE apcb_t.apcb108, #交易原幣成本認列金額
          apcb111   LIKE apcb_t.apcb111, #本幣單價
          apcb113   LIKE apcb_t.apcb113, #本幣未稅金額
          apcb114   LIKE apcb_t.apcb114, #本幣稅額
          apcb115   LIKE apcb_t.apcb115, #本幣含稅金額
          apcb116   LIKE apcb_t.apcb116, #本幣標準成本金額
          apcb117   LIKE apcb_t.apcb117, #NO USE
          apcb118   LIKE apcb_t.apcb118, #本幣成本認列金額
          apcb119   LIKE apcb_t.apcb119, #應開發票含稅金額
          apcb121   LIKE apcb_t.apcb121, #本位幣二匯率
          apcb123   LIKE apcb_t.apcb123, #本位幣二未稅金額
          apcb124   LIKE apcb_t.apcb124, #本位幣二稅額
          apcb125   LIKE apcb_t.apcb125, #本位幣二含稅金額
          apcb126   LIKE apcb_t.apcb126, #本幣二標準成本金額
          apcb127   LIKE apcb_t.apcb127, #NO USE
          apcb128   LIKE apcb_t.apcb128, #本位幣二成本認列金額
          apcb131   LIKE apcb_t.apcb131, #本位幣三匯率
          apcb133   LIKE apcb_t.apcb133, #本位幣三未稅金額
          apcb134   LIKE apcb_t.apcb134, #本位幣三稅額
          apcb135   LIKE apcb_t.apcb135, #本位幣三含稅金額
          apcb136   LIKE apcb_t.apcb136, #本幣三標準成本金額
          apcb137   LIKE apcb_t.apcb137, #NO USE
          apcb138   LIKE apcb_t.apcb138, #本位幣三成本認列金額
          apcbud001 LIKE apcb_t.apcbud001, #自定義欄位(文字)001
          apcbud002 LIKE apcb_t.apcbud002, #自定義欄位(文字)002
          apcbud003 LIKE apcb_t.apcbud003, #自定義欄位(文字)003
          apcbud004 LIKE apcb_t.apcbud004, #自定義欄位(文字)004
          apcbud005 LIKE apcb_t.apcbud005, #自定義欄位(文字)005
          apcbud006 LIKE apcb_t.apcbud006, #自定義欄位(文字)006
          apcbud007 LIKE apcb_t.apcbud007, #自定義欄位(文字)007
          apcbud008 LIKE apcb_t.apcbud008, #自定義欄位(文字)008
          apcbud009 LIKE apcb_t.apcbud009, #自定義欄位(文字)009
          apcbud010 LIKE apcb_t.apcbud010, #自定義欄位(文字)010
          apcbud011 LIKE apcb_t.apcbud011, #自定義欄位(數字)011
          apcbud012 LIKE apcb_t.apcbud012, #自定義欄位(數字)012
          apcbud013 LIKE apcb_t.apcbud013, #自定義欄位(數字)013
          apcbud014 LIKE apcb_t.apcbud014, #自定義欄位(數字)014
          apcbud015 LIKE apcb_t.apcbud015, #自定義欄位(數字)015
          apcbud016 LIKE apcb_t.apcbud016, #自定義欄位(數字)016
          apcbud017 LIKE apcb_t.apcbud017, #自定義欄位(數字)017
          apcbud018 LIKE apcb_t.apcbud018, #自定義欄位(數字)018
          apcbud019 LIKE apcb_t.apcbud019, #自定義欄位(數字)019
          apcbud020 LIKE apcb_t.apcbud020, #自定義欄位(數字)020
          apcbud021 LIKE apcb_t.apcbud021, #自定義欄位(日期時間)021
          apcbud022 LIKE apcb_t.apcbud022, #自定義欄位(日期時間)022
          apcbud023 LIKE apcb_t.apcbud023, #自定義欄位(日期時間)023
          apcbud024 LIKE apcb_t.apcbud024, #自定義欄位(日期時間)024
          apcbud025 LIKE apcb_t.apcbud025, #自定義欄位(日期時間)025
          apcbud026 LIKE apcb_t.apcbud026, #自定義欄位(日期時間)026
          apcbud027 LIKE apcb_t.apcbud027, #自定義欄位(日期時間)027
          apcbud028 LIKE apcb_t.apcbud028, #自定義欄位(日期時間)028
          apcbud029 LIKE apcb_t.apcbud029, #自定義欄位(日期時間)029
          apcbud030 LIKE apcb_t.apcbud030, #自定義欄位(日期時間)030
          apcb052   LIKE apcb_t.apcb052, #稅額
          apcb053   LIKE apcb_t.apcb053, #含稅金額
          apcb054   LIKE apcb_t.apcb054, #帳款對象
          apcb055   LIKE apcb_t.apcb055  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sql     STRING
   #DEFINE l_isam    RECORD LIKE isam_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_isam  RECORD  #進項發票主檔
          isament   LIKE isam_t.isament, #企業編號
          isamownid LIKE isam_t.isamownid, #資料所有者
          isamowndp LIKE isam_t.isamowndp, #資料所屬部門
          isamcrtid LIKE isam_t.isamcrtid, #資料建立者
          isamcrtdp LIKE isam_t.isamcrtdp, #資料建立部門
          isamcrtdt LIKE isam_t.isamcrtdt, #資料創建日
          isammodid LIKE isam_t.isammodid, #資料修改者
          isammoddt LIKE isam_t.isammoddt, #最近修改日
          isamcnfid LIKE isam_t.isamcnfid, #資料確認者
          isamcnfdt LIKE isam_t.isamcnfdt, #資料確認日
          isamstus  LIKE isam_t.isamstus, #狀態碼
          isamcomp  LIKE isam_t.isamcomp, #法人
          isamdocno LIKE isam_t.isamdocno, #收票單號
          isamseq   LIKE isam_t.isamseq, #項次
          isam001   LIKE isam_t.isam001, #發票來源
          isam002   LIKE isam_t.isam002, #開發票人
          isam004   LIKE isam_t.isam004, #帳務中心(業務組織)
          isam006   LIKE isam_t.isam006, #業務部門(登錄部門)
          isam008   LIKE isam_t.isam008, #發票類型
          isam009   LIKE isam_t.isam009, #銷方發票編號
          isam010   LIKE isam_t.isam010, #發票號碼
          isam011   LIKE isam_t.isam011, #發票日期
          isam012   LIKE isam_t.isam012, #稅別
          isam0121  LIKE isam_t.isam0121, #含稅否
          isam013   LIKE isam_t.isam013, #稅率
          isam014   LIKE isam_t.isam014, #幣別
          isam015   LIKE isam_t.isam015, #匯率
          isam016   LIKE isam_t.isam016, #購貨方名稱
          isam017   LIKE isam_t.isam017, #購貨方統一編號
          isam018   LIKE isam_t.isam018, #購貨方地址
          isam019   LIKE isam_t.isam019, #購貨方電話
          isam020   LIKE isam_t.isam020, #購貨方開戶銀行
          isam021   LIKE isam_t.isam021, #購貨方帳戶編碼
          isam022   LIKE isam_t.isam022, #銷方銀行帳戶編碼
          isam023   LIKE isam_t.isam023, #發票原幣未稅金額
          isam024   LIKE isam_t.isam024, #發票原幣稅額
          isam025   LIKE isam_t.isam025, #發票原幣含稅金額
          isam026   LIKE isam_t.isam026, #發票本幣未稅金額
          isam027   LIKE isam_t.isam027, #發票本幣稅額
          isam028   LIKE isam_t.isam028, #發票本幣含稅金額
          isam029   LIKE isam_t.isam029, #銷貨方名稱
          isam030   LIKE isam_t.isam030, #統一編號
          isam031   LIKE isam_t.isam031, #銷貨方地址
          isam032   LIKE isam_t.isam032, #銷貨方電話
          isam033   LIKE isam_t.isam033, #銷貨方開戶銀行
          isam034   LIKE isam_t.isam034, #銷貨方帳號
          isam035   LIKE isam_t.isam035, #申報數量
          isam036   LIKE isam_t.isam036, #異動狀態
          isam037   LIKE isam_t.isam037, #可扣抵編號
          isam038   LIKE isam_t.isam038, #作廢(註銷)理由碼
          isam039   LIKE isam_t.isam039, #作廢日期
          isam040   LIKE isam_t.isam040, #作廢時間
          isam041   LIKE isam_t.isam041, #作廢人員
          isam042   LIKE isam_t.isam042, #專案作廢核准文號
          isam043   LIKE isam_t.isam043, #通關方式註記
          isam044   LIKE isam_t.isam044, #列印次數
          isam045   LIKE isam_t.isam045, #支付工具卡號1
          isam046   LIKE isam_t.isam046, #支付工具卡號2
          isam047   LIKE isam_t.isam047, #支付工具卡號3
          isam048   LIKE isam_t.isam048, #通關註記
          isam049   LIKE isam_t.isam049, #備註說明
          isam050   LIKE isam_t.isam050, #立帳單號
          isam107   LIKE isam_t.isam107, #發票原幣已折金額
          isam108   LIKE isam_t.isam108, #發票原幣已折稅額
          isam117   LIKE isam_t.isam117, #發票本幣已折金額
          isam118   LIKE isam_t.isam118, #發票本幣已折稅額
          isam200   LIKE isam_t.isam200, #電子發票否
          isam201   LIKE isam_t.isam201, #愛心碼
          isam202   LIKE isam_t.isam202, #載具類別號碼
          isam203   LIKE isam_t.isam203, #載具顯碼 ID
          isam204   LIKE isam_t.isam204, #載具隱碼 ID
          isam205   LIKE isam_t.isam205, #電子發票匯出狀態
          isam206   LIKE isam_t.isam206, #電子發票匯出序號
          isam207   LIKE isam_t.isam207, #電子發票領取方式
          isam208   LIKE isam_t.isam208, #申報年度
          isam209   LIKE isam_t.isam209, #申報月份
          isam210   LIKE isam_t.isam210, #申報據點
          isamud001 LIKE isam_t.isamud001, #自定義欄位(文字)001
          isamud002 LIKE isam_t.isamud002, #自定義欄位(文字)002
          isamud003 LIKE isam_t.isamud003, #自定義欄位(文字)003
          isamud004 LIKE isam_t.isamud004, #自定義欄位(文字)004
          isamud005 LIKE isam_t.isamud005, #自定義欄位(文字)005
          isamud006 LIKE isam_t.isamud006, #自定義欄位(文字)006
          isamud007 LIKE isam_t.isamud007, #自定義欄位(文字)007
          isamud008 LIKE isam_t.isamud008, #自定義欄位(文字)008
          isamud009 LIKE isam_t.isamud009, #自定義欄位(文字)009
          isamud010 LIKE isam_t.isamud010, #自定義欄位(文字)010
          isamud011 LIKE isam_t.isamud011, #自定義欄位(數字)011
          isamud012 LIKE isam_t.isamud012, #自定義欄位(數字)012
          isamud013 LIKE isam_t.isamud013, #自定義欄位(數字)013
          isamud014 LIKE isam_t.isamud014, #自定義欄位(數字)014
          isamud015 LIKE isam_t.isamud015, #自定義欄位(數字)015
          isamud016 LIKE isam_t.isamud016, #自定義欄位(數字)016
          isamud017 LIKE isam_t.isamud017, #自定義欄位(數字)017
          isamud018 LIKE isam_t.isamud018, #自定義欄位(數字)018
          isamud019 LIKE isam_t.isamud019, #自定義欄位(數字)019
          isamud020 LIKE isam_t.isamud020, #自定義欄位(數字)020
          isamud021 LIKE isam_t.isamud021, #自定義欄位(日期時間)021
          isamud022 LIKE isam_t.isamud022, #自定義欄位(日期時間)022
          isamud023 LIKE isam_t.isamud023, #自定義欄位(日期時間)023
          isamud024 LIKE isam_t.isamud024, #自定義欄位(日期時間)024
          isamud025 LIKE isam_t.isamud025, #自定義欄位(日期時間)025
          isamud026 LIKE isam_t.isamud026, #自定義欄位(日期時間)026
          isamud027 LIKE isam_t.isamud027, #自定義欄位(日期時間)027
          isamud028 LIKE isam_t.isamud028, #自定義欄位(日期時間)028
          isamud029 LIKE isam_t.isamud029, #自定義欄位(日期時間)029
          isamud030 LIKE isam_t.isamud030, #自定義欄位(日期時間)030
          isam051   LIKE isam_t.isam051  #認證否
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_ooef002     LIKE ooef_t.ooef002
   DEFINE l_ooefl006    LIKE ooefl_t.ooefl006
   DEFINE l_pmaal003    LIKE pmaal_t.pmaal003
   DEFINE l_isao001     LIKE isao_t.isao001
   DEFINE l_dummy1      LIKE type_t.num20_6
   #DEFINE l_apde        RECORD LIKE apde_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apde RECORD  #付款及差異處理明細檔
          apdeent   LIKE apde_t.apdeent, #企業編號
          apdecomp  LIKE apde_t.apdecomp, #法人
          apdeld    LIKE apde_t.apdeld, #帳套
          apdedocno LIKE apde_t.apdedocno, #沖銷單單號
          apdeseq   LIKE apde_t.apdeseq, #項次
          apdesite  LIKE apde_t.apdesite, #帳務中心
          apdeorga  LIKE apde_t.apdeorga, #帳務歸屬組織
          apde001   LIKE apde_t.apde001, #來源作業
          apde002   LIKE apde_t.apde002, #沖銷帳款類型
          apde003   LIKE apde_t.apde003, #已付款單號
          apde004   LIKE apde_t.apde004, #沖銷單項次
          apde006   LIKE apde_t.apde006, #款別編號
          apde008   LIKE apde_t.apde008, #帳戶/票券號碼
          apde009   LIKE apde_t.apde009, #已轉資料
          apde010   LIKE apde_t.apde010, #摘要說明
          apde011   LIKE apde_t.apde011, #銀行存提碼
          apde012   LIKE apde_t.apde012, #現金變動碼
          apde013   LIKE apde_t.apde013, #轉入客商碼
          apde014   LIKE apde_t.apde014, #轉入帳款單編號
          apde015   LIKE apde_t.apde015, #沖銷加減項
          apde016   LIKE apde_t.apde016, #沖銷會科
          apde017   LIKE apde_t.apde017, #業務人員
          apde018   LIKE apde_t.apde018, #業務部門
          apde019   LIKE apde_t.apde019, #責任中心
          apde020   LIKE apde_t.apde020, #產品類別
          apde021   LIKE apde_t.apde021, #票據類型
          apde022   LIKE apde_t.apde022, #專案編號
          apde023   LIKE apde_t.apde023, #WBS編號
          apde024   LIKE apde_t.apde024, #票據號碼
          apde028   LIKE apde_t.apde028, #產生方式
          apde029   LIKE apde_t.apde029, #傳票號碼
          apde030   LIKE apde_t.apde030, #傳票項次
          apde032   LIKE apde_t.apde032, #付款日
          apde035   LIKE apde_t.apde035, #區域
          apde036   LIKE apde_t.apde036, #客群
          apde038   LIKE apde_t.apde038, #對象
          apde039   LIKE apde_t.apde039, #受款銀行
          apde040   LIKE apde_t.apde040, #受款帳號
          apde041   LIKE apde_t.apde041, #受款人全名
          apde042   LIKE apde_t.apde042, #經營方式
          apde043   LIKE apde_t.apde043, #通路
          apde044   LIKE apde_t.apde044, #品牌
          apde045   LIKE apde_t.apde045, #摘要
          apde046   LIKE apde_t.apde046, #付款申請單
          apde047   LIKE apde_t.apde047, #付款申請單項次
          apde051   LIKE apde_t.apde051, #自由核算項一
          apde052   LIKE apde_t.apde052, #自由核算項二
          apde053   LIKE apde_t.apde053, #自由核算項三
          apde054   LIKE apde_t.apde054, #自由核算項四
          apde055   LIKE apde_t.apde055, #自由核算項五
          apde056   LIKE apde_t.apde056, #自由核算項六
          apde057   LIKE apde_t.apde057, #自由核算項七
          apde058   LIKE apde_t.apde058, #自由核算項八
          apde059   LIKE apde_t.apde059, #自由核算項九
          apde060   LIKE apde_t.apde060, #自由核算項十
          apde100   LIKE apde_t.apde100, #幣別
          apde101   LIKE apde_t.apde101, #匯率
          apde104   LIKE apde_t.apde104, #原幣應稅折抵稅額
          apde109   LIKE apde_t.apde109, #原幣沖帳金額
          apde119   LIKE apde_t.apde119, #本幣沖帳金額
          apde120   LIKE apde_t.apde120, #本位幣二幣別
          apde121   LIKE apde_t.apde121, #本位幣二匯率
          apde129   LIKE apde_t.apde129, #本位幣二沖帳金額
          apde130   LIKE apde_t.apde130, #本位幣三幣別
          apde131   LIKE apde_t.apde131, #本位幣三匯率
          apde139   LIKE apde_t.apde139, #本位幣三沖帳金額
          apdeud001 LIKE apde_t.apdeud001, #自定義欄位(文字)001
          apdeud002 LIKE apde_t.apdeud002, #自定義欄位(文字)002
          apdeud003 LIKE apde_t.apdeud003, #自定義欄位(文字)003
          apdeud004 LIKE apde_t.apdeud004, #自定義欄位(文字)004
          apdeud005 LIKE apde_t.apdeud005, #自定義欄位(文字)005
          apdeud006 LIKE apde_t.apdeud006, #自定義欄位(文字)006
          apdeud007 LIKE apde_t.apdeud007, #自定義欄位(文字)007
          apdeud008 LIKE apde_t.apdeud008, #自定義欄位(文字)008
          apdeud009 LIKE apde_t.apdeud009, #自定義欄位(文字)009
          apdeud010 LIKE apde_t.apdeud010, #自定義欄位(文字)010
          apdeud011 LIKE apde_t.apdeud011, #自定義欄位(數字)011
          apdeud012 LIKE apde_t.apdeud012, #自定義欄位(數字)012
          apdeud013 LIKE apde_t.apdeud013, #自定義欄位(數字)013
          apdeud014 LIKE apde_t.apdeud014, #自定義欄位(數字)014
          apdeud015 LIKE apde_t.apdeud015, #自定義欄位(數字)015
          apdeud016 LIKE apde_t.apdeud016, #自定義欄位(數字)016
          apdeud017 LIKE apde_t.apdeud017, #自定義欄位(數字)017
          apdeud018 LIKE apde_t.apdeud018, #自定義欄位(數字)018
          apdeud019 LIKE apde_t.apdeud019, #自定義欄位(數字)019
          apdeud020 LIKE apde_t.apdeud020, #自定義欄位(數字)020
          apdeud021 LIKE apde_t.apdeud021, #自定義欄位(日期時間)021
          apdeud022 LIKE apde_t.apdeud022, #自定義欄位(日期時間)022
          apdeud023 LIKE apde_t.apdeud023, #自定義欄位(日期時間)023
          apdeud024 LIKE apde_t.apdeud024, #自定義欄位(日期時間)024
          apdeud025 LIKE apde_t.apdeud025, #自定義欄位(日期時間)025
          apdeud026 LIKE apde_t.apdeud026, #自定義欄位(日期時間)026
          apdeud027 LIKE apde_t.apdeud027, #自定義欄位(日期時間)027
          apdeud028 LIKE apde_t.apdeud028, #自定義欄位(日期時間)028
          apdeud029 LIKE apde_t.apdeud029, #自定義欄位(日期時間)029
          apdeud030 LIKE apde_t.apdeud030, #自定義欄位(日期時間)030
          apde061   LIKE apde_t.apde061  #應付來源
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_pmab055     LIKE pmab_t.pmab055
   DEFINE l_glaa121     LIKE glaa_t.glaa121
   DEFINE l_glaa016     LIKE glaa_t.glaa016
   DEFINE l_glaa020     LIKE glaa_t.glaa020
   DEFINE l_glaa019     LIKE glaa_t.glaa019
   DEFINE l_glaa015     LIKE glaa_t.glaa015
   DEFINE l_glaa001     LIKE glaa_t.glaa001
   #DEFINE l_apgi        RECORD LIKE apgi_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgi  RECORD  #裝船通知單主檔
          apgient   LIKE apgi_t.apgient, #企業編號
          apgicomp  LIKE apgi_t.apgicomp, #法人
          apgidocno LIKE apgi_t.apgidocno, #通知單號
          apgidocdt LIKE apgi_t.apgidocdt, #通知日期
          apgi001   LIKE apgi_t.apgi001, #供應商編號
          apgi002   LIKE apgi_t.apgi002, #申請單號
          apgi003   LIKE apgi_t.apgi003, #L/C NO
          apgi004   LIKE apgi_t.apgi004, #業務人員
          apgi005   LIKE apgi_t.apgi005, #運送方式
          apgi006   LIKE apgi_t.apgi006, #裝運(結關)日期
          apgi007   LIKE apgi_t.apgi007, #S/O NO.(裝運單號)
          apgi008   LIKE apgi_t.apgi008, #船名/航次
          apgi009   LIKE apgi_t.apgi009, #運輸公司
          apgi010   LIKE apgi_t.apgi010, #結關地
          apgi011   LIKE apgi_t.apgi011, #目的地
          apgi012   LIKE apgi_t.apgi012, #開航日期
          apgi013   LIKE apgi_t.apgi013, #預計抵達日
          apgi014   LIKE apgi_t.apgi014, #領櫃地點
          apgi015   LIKE apgi_t.apgi015, #領櫃編號
          apgi016   LIKE apgi_t.apgi016, #交櫃地點
          apgi017   LIKE apgi_t.apgi017, #櫃量
          apgi018   LIKE apgi_t.apgi018, #備註
          apgiownid LIKE apgi_t.apgiownid, #資料所有者
          apgiowndp LIKE apgi_t.apgiowndp, #資料所屬部門
          apgicrtid LIKE apgi_t.apgicrtid, #資料建立者
          apgicrtdp LIKE apgi_t.apgicrtdp, #資料建立部門
          apgicrtdt LIKE apgi_t.apgicrtdt, #資料創建日
          apgimodid LIKE apgi_t.apgimodid, #資料修改者
          apgimoddt LIKE apgi_t.apgimoddt, #最近修改日
          apgicnfid LIKE apgi_t.apgicnfid, #資料確認者
          apgicnfdt LIKE apgi_t.apgicnfdt, #資料確認日
          apgipstid LIKE apgi_t.apgipstid, #資料過帳者
          apgipstdt LIKE apgi_t.apgipstdt, #資料過帳日
          apgistus  LIKE apgi_t.apgistus, #狀態碼
          apgiud001 LIKE apgi_t.apgiud001, #自定義欄位(文字)001
          apgiud002 LIKE apgi_t.apgiud002, #自定義欄位(文字)002
          apgiud003 LIKE apgi_t.apgiud003, #自定義欄位(文字)003
          apgiud004 LIKE apgi_t.apgiud004, #自定義欄位(文字)004
          apgiud005 LIKE apgi_t.apgiud005, #自定義欄位(文字)005
          apgiud006 LIKE apgi_t.apgiud006, #自定義欄位(文字)006
          apgiud007 LIKE apgi_t.apgiud007, #自定義欄位(文字)007
          apgiud008 LIKE apgi_t.apgiud008, #自定義欄位(文字)008
          apgiud009 LIKE apgi_t.apgiud009, #自定義欄位(文字)009
          apgiud010 LIKE apgi_t.apgiud010, #自定義欄位(文字)010
          apgiud011 LIKE apgi_t.apgiud011, #自定義欄位(數字)011
          apgiud012 LIKE apgi_t.apgiud012, #自定義欄位(數字)012
          apgiud013 LIKE apgi_t.apgiud013, #自定義欄位(數字)013
          apgiud014 LIKE apgi_t.apgiud014, #自定義欄位(數字)014
          apgiud015 LIKE apgi_t.apgiud015, #自定義欄位(數字)015
          apgiud016 LIKE apgi_t.apgiud016, #自定義欄位(數字)016
          apgiud017 LIKE apgi_t.apgiud017, #自定義欄位(數字)017
          apgiud018 LIKE apgi_t.apgiud018, #自定義欄位(數字)018
          apgiud019 LIKE apgi_t.apgiud019, #自定義欄位(數字)019
          apgiud020 LIKE apgi_t.apgiud020, #自定義欄位(數字)020
          apgiud021 LIKE apgi_t.apgiud021, #自定義欄位(日期時間)021
          apgiud022 LIKE apgi_t.apgiud022, #自定義欄位(日期時間)022
          apgiud023 LIKE apgi_t.apgiud023, #自定義欄位(日期時間)023
          apgiud024 LIKE apgi_t.apgiud024, #自定義欄位(日期時間)024
          apgiud025 LIKE apgi_t.apgiud025, #自定義欄位(日期時間)025
          apgiud026 LIKE apgi_t.apgiud026, #自定義欄位(日期時間)026
          apgiud027 LIKE apgi_t.apgiud027, #自定義欄位(日期時間)027
          apgiud028 LIKE apgi_t.apgiud028, #自定義欄位(日期時間)028
          apgiud029 LIKE apgi_t.apgiud029, #自定義欄位(日期時間)029
          apgiud030 LIKE apgi_t.apgiud030, #自定義欄位(日期時間)030
          apgi019   LIKE apgi_t.apgi019  #帳務單號
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_docno       LIKE apga_t.apgadocno
   DEFINE l_date        DATETIME YEAR TO SECOND
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   DEFINE l_apcb113sum  LIKE type_t.num20_6
   DEFINE l_apcb114sum  LIKE type_t.num20_6
   DEFINE l_apcb115sum  LIKE type_t.num20_6
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   DEFINE l_oodb004     LIKE oodb_t.oodb004
   DEFINE l_apca013     LIKE apca_t.apca013
   DEFINE l_apca012     LIKE apca_t.apca012
   DEFINE l_oodb011     LIKE oodb_t.oodb011
   #160824-00049#7-----s
   #GROUP BY apgc對象
   DEFINE l_apca004     LIKE apca_t.apca004
   #160824-00049#7-----e
   DEFINE l_xrcd009     LIKE xrcd_t.xrcd009
   DEFINE l_ooef011     LIKE ooef_t.ooef011 #161129-00042#1-add
   DEFINE l_isac004     LIKE isac_t.isac004 #161230-00036#1-add
   DEFINE l_isac008     LIKE isac_t.isac008 #161230-00036#1-add
   DEFINE l_vat_id      STRING              #161230-00036#1-add
   WHENEVER ERROR CONTINUE
   
   LET r_success = TRUE
   LET r_docno = NULL
   INITIALIZE l_apgi.* TO NULL
   #SELECT * INTO l_apgi.* FROM apgi_t WHERE apgient = g_enterprise AND apgicomp = g_apcacomp AND apgidocno = g_apca_m.apca018 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgient,apgicomp,apgidocno,apgidocdt,apgi001,
          apgi002,apgi003,apgi004,apgi005,apgi006,
          apgi007,apgi008,apgi009,apgi010,apgi011,
          apgi012,apgi013,apgi014,apgi015,apgi016,
          apgi017,apgi018,apgiownid,apgiowndp,apgicrtid,
          apgicrtdp,apgicrtdt,apgimodid,apgimoddt,apgicnfid,
          apgicnfdt,apgipstid,apgipstdt,apgistus,apgiud001,
          apgiud002,apgiud003,apgiud004,apgiud005,apgiud006,
          apgiud007,apgiud008,apgiud009,apgiud010,apgiud011,
          apgiud012,apgiud013,apgiud014,apgiud015,apgiud016,
          apgiud017,apgiud018,apgiud019,apgiud020,apgiud021,
          apgiud022,apgiud023,apgiud024,apgiud025,apgiud026,
          apgiud027,apgiud028,apgiud029,apgiud030,apgi019 
     INTO l_apgi.* 
     FROM apgi_t 
    WHERE apgient = g_enterprise 
      AND apgicomp = g_apcacomp 
      AND apgidocno = g_apca_m.apca018
   #161208-00026#13-add(e)
   INITIALIZE l_apga.* TO NULL
   #SELECT * INTO l_apga.* FROM apga_t WHERE apgaent = g_enterprise AND apgacomp = g_apcacomp AND apgadocno = l_apgi.apgi002 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgaent,apgaownid,apgaowndp,apgacrtid,apgacrtdp,
          apgacrtdt,apgamodid,apgamoddt,apgacnfid,apgacnfdt,
          apgapstid,apgapstdt,apgastus,apgacomp,apgadocno,
          apgadocdt,apga001,apga002,apga003,apga004,
          apga005,apga006,apga007,apga008,apga009,
          apga010,apga011,apga012,apga013,apga014,
          apga015,apga016,apga017,apga018,apga019,
          apga020,apga021,apga022,apga023,apga024,
          apga025,apga026,apga027,apga028,apga029,
          apga030,apga031,apga100,apga101,apga103,
          apga104,apga105,apga106,apga107,apga108,
          apga113,apga114,apga115,apgaud001,apgaud002,
          apgaud003,apgaud004,apgaud005,apgaud006,apgaud007,
          apgaud008,apgaud009,apgaud010,apgaud011,apgaud012,
          apgaud013,apgaud014,apgaud015,apgaud016,apgaud017,
          apgaud018,apgaud019,apgaud020,apgaud021,apgaud022,
          apgaud023,apgaud024,apgaud025,apgaud026,apgaud027,
          apgaud028,apgaud029,apgaud030,apga102,apga109,
          apga112,apga117,apga118,apga032,apga033,
          apga034,apga035,apga040,apga041,apga036,
          apga037,apga038,apga039 
     INTO l_apga.* 
     FROM apga_t 
    WHERE apgaent = g_enterprise 
      AND apgacomp = g_apcacomp 
      AND apgadocno = l_apgi.apgi002
   #161208-00026#13-add(e)
   
   #160824-00049#7-----s
   LET l_sql = "SELECT DISTINCT apgc002 FROM apgc_t ",
               " WHERE apgcent = ",g_enterprise," ",
               "   AND apgccomp = '",g_apcacomp,"' ",
               "   AND apgcdocno = '",g_apca_m.apca018,"' ",
               "   AND apgc900 = 0 "
   PREPARE sel_apgcp31 FROM l_sql
   DECLARE sel_apgcc31 CURSOR FOR sel_apgcp31
   FOREACH sel_apgcc31 INTO l_apca004
      IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
      INITIALIZE l_apca.* TO NULL
      LET l_apca.apcaent = g_enterprise
      LET l_apca.apcacomp = l_apga.apgacomp
      LET l_apca.apcald = NULL
      SELECT glaald,glaa001,glaa016,glaa020
        INTO l_apca.apcald,l_apca.apca100,l_apca.apca120,l_apca.apca130
        FROM glaa_t
       WHERE glaaent  = g_enterprise
         AND glaacomp = l_apca.apcacomp
         AND glaa014  = 'Y'
      LET l_apca.apcadocdt = g_apca_m.apcadocdt
      LET l_apca.apca003   = g_apca_m.apca003
      LET l_apca.apca016   = g_apca_m.apca016
      LET l_apca.apca018   = g_apca_m.apca018
      LET l_apca.apcadocno = g_apca_m.apcadocno
      CALL s_aooi200_fin_gen_docno(l_apca.apcald,'','',l_apca.apcadocno,l_apca.apcadocdt,'aapt560') 
         RETURNING g_sub_success,l_apca.apcadocno                                            
      IF NOT g_sub_success THEN
         LET r_success = FALSE
         RETURN r_success,r_docno
      END IF
      LET l_apca.apcastus  = 'N' # 狀態碼 
      LET l_apca.apcasite = l_apca.apcacomp   # 帳務中心                            apcasite   = apgccomp                                                    
      LET l_apca.apca001 =  s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3001')
      LET l_apca.apca003 = g_user # 帳務人員                            apca003    = g_user                                                      
      LET l_apca.apca004 = l_apca004 # 帳款對象編號 廠商(受益人)apga004 
      CALL s_apmm100_sel_pmac002(l_apca.apca004,'1') RETURNING l_apca.apca005,l_desc
      IF cl_null(l_apca.apca005)THEN LET l_apca.apca005 = l_apca.apca004 END IF
      SELECT pmaa080,pmaa047 INTO l_apca.apca006,l_apca.apca046
        FROM pmaa_t
       WHERE pmaaent = g_enterprise AND pmaa001 = l_apca.apca004
      LET lc_param_apca.apcald   = l_apca.apcald
      LET lc_param_apca.apcacomp = l_apca.apcacomp
      LET lc_param_apca.apcasite = l_apca.apcasite
      LET lc_param_apca.apcadocdt= l_apca.apcadocdt
      LET lc_param_apca.apca001  = '19'   #l_apca.apca001
      LET lc_param_apca.apca004  = l_apca.apca004
      SELECT ooef019 INTO lc_param_apca.ooef019 FROM ooef_t
       WHERE ooefent = g_enterprise
         AND ooef001 = l_apca.apcacomp
      LET ls_js = util.JSON.stringify(lc_param_apca)
      CALL s_aapt300_get_apca004_info(ls_js) RETURNING ls_js
      CALL util.JSON.parse(ls_js,lc_param_info)
      LET l_apca.apca006 = lc_param_info.apca006  
      LET l_apca.apca007 = lc_param_info.apca007   # 帳款類別           apca007    = 廠商慣用條件
      LET l_apca.apca008 = lc_param_info.apca008   # 付款條件編號       apca008    = 取交易對象慣用付款條件
      LET l_apca.apca009 = lc_param_info.apca009   # 應付款日/應扣抵日  apca009    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
      LET l_apca.apca010 = lc_param_info.apca010   # 容許票據到期日     apca010    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
      LET l_apca.apca011 = lc_param_info.apca011   # 稅別               apca011    = 取交易對象慣用稅別,實際稅別在單身呈現
      LET l_apca.apca012 = lc_param_info.apca012   # 稅率               apca012    = 依稅別串 oodb006
      LET l_apca.apca013 = lc_param_info.apca013   # 含稅否             apca013    = 依稅別串 oodb005                   
      LET l_apca.apca014 = l_apga.apga005          # 人員編號           apca014    = apga005
      LET l_apca.apca015 = NULL                    # 部門編號           apca015    = apga005 所屬部門
      SELECT ooag003 INTO l_apca.apca015 FROM ooag_t
       WHERE ooagent = g_enterprise
         AND ooag001 = l_apca.apca014 
      LET l_apca.apca034 = lc_param_info.apca034   # 責任中心                            apca034    = 依 aapt300原則帶出      
      LET l_apca.apca035 = lc_param_info.apca035   # 應付(貸方)科目編號                  apca035    = 依帳款類別帶出           
      LET l_apca.apca036 = lc_param_info.apca036   # 費用(借方)科目編號                  apca036    = 依帳款類別帶出     
      LET l_apca.apca046 = lc_param_info.apca046       
      LET l_apca.apca054 = lc_param_info.apca054   # 多帳期設定                          apca054    = 依付款條件取出 
      LET l_apca.apca055 = lc_param_info.apca055   # 繳款優惠條件                        apca055    = 依付款條件取出 
      LET l_apca.apca058 = lc_param_info.apca058
      LET l_apca.apca060 = lc_param_info.apca060
      LET l_apca.apca016 = '33'
      LET l_apca.apca017 = '1'
      LET l_apca.apca018 = l_apgi.apgidocno
      LET l_apca.apca020 = 'N'         # 信用狀付款否 
      LET l_apca.apca026 = 0
      LET l_apca.apca027 = 0
      LET l_apca.apca028 = 0
      LET l_apca.apca029 = 0
      LET l_apca.apca037 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-0030')# 產生傳票否                          apca037    = 取單別參數D-FIN-0030    
      LET l_apca.apca067 = l_apga.apgadocno
      LET l_apca.apca101 = 1
      LET l_apca.apca103 = 0
      LET l_apca.apca104 = 0
      LET l_apca.apca106 = 0 
      LET l_apca.apca107 = 0
      LET l_apca.apca108 = 0 
      LET l_apca.apca113 = 0
      LET l_apca.apca114 = 0 
      LET l_apca.apca116 = 0
      LEt l_apca.apca117 = 0 
      LET l_apca.apca118 = 0 
      LET lc_param2.apca004 = l_apca.apca004
      CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-3009') RETURNING lc_param2.sfin2009
      LET ls_js = util.JSON.stringify(lc_param2)   
      CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apca.apca100,ls_js)
           RETURNING l_apca.apca101,l_apca.apca121,l_apca.apca131
      LET l_apca.apca123 = 0
      LET l_apca.apca124 = 0
      LET l_apca.apca126 = 0 
      LET l_apca.apca127 = 0 
      LET l_apca.apca128 = 0
      LET l_apca.apca133 = 0 
      LET l_apca.apca134 = 0 
      LET l_apca.apca136 = 0 
      LET l_apca.apca137 = 0
      LET l_apca.apca138 = 0 
      LET l_apca.apca071 = 0
      LET l_apca.apca072 = 0
      #albireo 160624-----s
      LEt l_apca.apca073 = l_apga.apga001
      LET l_apca.apcaownid = g_user
      LET l_apca.apcaowndp = g_dept
      LET l_apca.apcacrtid = g_user
      LET l_apca.apcacrtdp = g_dept
      LET l_date = cl_get_current()
      LET l_apca.apcacrtdt = l_date
      #albireo 160624-----e
      #INSERT INTO apca_t VALUES(l_apca.*)  #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apca_t (apcaent,apcaownid,apcaowndp,apcacrtid,apcacrtdp,
                          apcacrtdt,apcamodid,apcamoddt,apcacnfid,apcacnfdt,
                          apcapstid,apcapstdt,apcastus,apcald,apcacomp,
                          apcadocno,apcadocdt,apcasite,
                          apca001,apca003,apca004,apca005,apca006,
                          apca007,apca008,apca009,apca010,apca011,
                          apca012,apca013,apca014,apca015,apca016,
                          apca017,apca018,apca019,apca020,apca021,
                          apca022,apca025,apca026,apca027,apca028,
                          apca029,apca030,apca031,apca032,apca033,
                          apca034,apca035,apca036,apca037,apca038,
                          apca039,apca040,apca041,apca042,apca043,
                          apca044,apca045,apca046,apca047,apca048,
                          apca049,apca050,apca051,apca052,apca053,
                          apca054,apca055,apca056,apca057,apca058,
                          apca059,apca060,apca061,apca062,apca063,
                          apca064,apca065,apca066,apca100,apca101,
                          apca103,apca104,apca106,apca107,apca108,
                          apca113,apca114,apca116,apca117,apca118,
                          apca120,apca121,apca123,apca124,apca126,
                          apca127,apca128,apca130,apca131,apca133,
                          apca134,apca136,apca137,apca138,
                          apcaud001,apcaud002,apcaud003,apcaud004,apcaud005,
                          apcaud006,apcaud007,apcaud008,apcaud009,apcaud010,
                          apcaud011,apcaud012,apcaud013,apcaud014,apcaud015,
                          apcaud016,apcaud017,apcaud018,apcaud019,apcaud020,
                          apcaud021,apcaud022,apcaud023,apcaud024,apcaud025,
                          apcaud026,apcaud027,apcaud028,apcaud029,apcaud030,
                          apca067,apca068,apca069,apca070,apca071,
                          apca072,apca073
                         )
      VALUES (l_apca.apcaent,l_apca.apcaownid,l_apca.apcaowndp,l_apca.apcacrtid,l_apca.apcacrtdp,
              l_apca.apcacrtdt,l_apca.apcamodid,l_apca.apcamoddt,l_apca.apcacnfid,l_apca.apcacnfdt,
              l_apca.apcapstid,l_apca.apcapstdt,l_apca.apcastus,l_apca.apcald,l_apca.apcacomp,
              l_apca.apcadocno,l_apca.apcadocdt,l_apca.apcasite,
              l_apca.apca001,l_apca.apca003,l_apca.apca004,l_apca.apca005,l_apca.apca006,
              l_apca.apca007,l_apca.apca008,l_apca.apca009,l_apca.apca010,l_apca.apca011,
              l_apca.apca012,l_apca.apca013,l_apca.apca014,l_apca.apca015,l_apca.apca016,
              l_apca.apca017,l_apca.apca018,l_apca.apca019,l_apca.apca020,l_apca.apca021,
              l_apca.apca022,l_apca.apca025,l_apca.apca026,l_apca.apca027,l_apca.apca028,
              l_apca.apca029,l_apca.apca030,l_apca.apca031,l_apca.apca032,l_apca.apca033,
              l_apca.apca034,l_apca.apca035,l_apca.apca036,l_apca.apca037,l_apca.apca038,
              l_apca.apca039,l_apca.apca040,l_apca.apca041,l_apca.apca042,l_apca.apca043,
              l_apca.apca044,l_apca.apca045,l_apca.apca046,l_apca.apca047,l_apca.apca048,
              l_apca.apca049,l_apca.apca050,l_apca.apca051,l_apca.apca052,l_apca.apca053,
              l_apca.apca054,l_apca.apca055,l_apca.apca056,l_apca.apca057,l_apca.apca058,
              l_apca.apca059,l_apca.apca060,l_apca.apca061,l_apca.apca062,l_apca.apca063,
              l_apca.apca064,l_apca.apca065,l_apca.apca066,l_apca.apca100,l_apca.apca101,
              l_apca.apca103,l_apca.apca104,l_apca.apca106,l_apca.apca107,l_apca.apca108,
              l_apca.apca113,l_apca.apca114,l_apca.apca116,l_apca.apca117,l_apca.apca118,
              l_apca.apca120,l_apca.apca121,l_apca.apca123,l_apca.apca124,l_apca.apca126,
              l_apca.apca127,l_apca.apca128,l_apca.apca130,l_apca.apca131,l_apca.apca133,
              l_apca.apca134,l_apca.apca136,l_apca.apca137,l_apca.apca138,
              l_apca.apcaud001,l_apca.apcaud002,l_apca.apcaud003,l_apca.apcaud004,l_apca.apcaud005,
              l_apca.apcaud006,l_apca.apcaud007,l_apca.apcaud008,l_apca.apcaud009,l_apca.apcaud010,
              l_apca.apcaud011,l_apca.apcaud012,l_apca.apcaud013,l_apca.apcaud014,l_apca.apcaud015,
              l_apca.apcaud016,l_apca.apcaud017,l_apca.apcaud018,l_apca.apcaud019,l_apca.apcaud020,
              l_apca.apcaud021,l_apca.apcaud022,l_apca.apcaud023,l_apca.apcaud024,l_apca.apcaud025,
              l_apca.apcaud026,l_apca.apcaud027,l_apca.apcaud028,l_apca.apcaud029,l_apca.apcaud030,
              l_apca.apca067,l_apca.apca068,l_apca.apca069,l_apca.apca070,l_apca.apca071,
              l_apca.apca072,l_apca.apca073
             )
      #161108-00017#4 add end---

      #apgc產生 apcb xrcd_t
      #LET l_sql = "SELECT * FROM apgc_t ",   #161208-00026#13 mark
      #161208-00026#13-add(s)
      LET l_sql = "SELECT apgcent,apgccomp,apgcdocno,apgcseq,apgc900,
                          apgcorga,apgc001,apgc002,apgc003,apgc004,
                          apgc005,apgc006,apgc007,apgc008,apgc009,
                          apgc010,apgc011,apgc012,apgc013,apgc014,
                          apgc015,apgc016,apgc100,apgc101,apgc103,
                          apgc104,apgc105,apgc113,apgc114,apgc115,
                          apgcud001,apgcud002,apgcud003,apgcud004,apgcud005,
                          apgcud006,apgcud007,apgcud008,apgcud009,apgcud010,
                          apgcud011,apgcud012,apgcud013,apgcud014,apgcud015,
                          apgcud016,apgcud017,apgcud018,apgcud019,apgcud020,
                          apgcud021,apgcud022,apgcud023,apgcud024,apgcud025,
                          apgcud026,apgcud027,apgcud028,apgcud029,apgcud030  
                     FROM apgc_t ",
      #161208-00026#13-add(e)
                  " WHERE apgcent = ",g_enterprise," ",
                  "   AND apgccomp = '",l_apgi.apgicomp,"' ",
                  "   AND apgcdocno = '",l_apgi.apgidocno,"' ",
                  "   AND apgc900 = '0' ",
                  "   AND apgc002 = '",l_apca004,"' "
      PREPARE sel_apgcp32 FROM l_sql
      DECLARE sel_apgcc32 CURSOR FOR sel_apgcp32
      
      #FOREACH sel_apgcc32 INTO l_apgc.*   #161208-00026#13 mark
      #161208-00026#13-add(s)
      FOREACH sel_apgcc32 INTO l_apgc.apgcent,l_apgc.apgccomp,l_apgc.apgcdocno,l_apgc.apgcseq,l_apgc.apgc900,
                               l_apgc.apgcorga,l_apgc.apgc001,l_apgc.apgc002,l_apgc.apgc003,l_apgc.apgc004,
                               l_apgc.apgc005,l_apgc.apgc006,l_apgc.apgc007,l_apgc.apgc008,l_apgc.apgc009,
                               l_apgc.apgc010,l_apgc.apgc011,l_apgc.apgc012,l_apgc.apgc013,l_apgc.apgc014,
                               l_apgc.apgc015,l_apgc.apgc016,l_apgc.apgc100,l_apgc.apgc101,l_apgc.apgc103,
                               l_apgc.apgc104,l_apgc.apgc105,l_apgc.apgc113,l_apgc.apgc114,l_apgc.apgc115,
                               l_apgc.apgcud001,l_apgc.apgcud002,l_apgc.apgcud003,l_apgc.apgcud004,l_apgc.apgcud005,
                               l_apgc.apgcud006,l_apgc.apgcud007,l_apgc.apgcud008,l_apgc.apgcud009,l_apgc.apgcud010,
                               l_apgc.apgcud011,l_apgc.apgcud012,l_apgc.apgcud013,l_apgc.apgcud014,l_apgc.apgcud015,
                               l_apgc.apgcud016,l_apgc.apgcud017,l_apgc.apgcud018,l_apgc.apgcud019,l_apgc.apgcud020,
                               l_apgc.apgcud021,l_apgc.apgcud022,l_apgc.apgcud023,l_apgc.apgcud024,l_apgc.apgcud025,
                               l_apgc.apgcud026,l_apgc.apgcud027,l_apgc.apgcud028,l_apgc.apgcud029,l_apgc.apgcud030
      #161208-00026#13-add(e)
         IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
         #r2.產生apcb-----s
         INITIALIZE l_apcb.* TO NULL
         LET l_apcb.apcbent   = g_enterprise
         LET l_apcb.apcbld    = l_apca.apcald
         LET l_apcb.apcblegl  = l_apca.apcacomp
         LET l_apcb.apcbsite  = l_apca.apcasite
         LET l_apcb.apcbdocno = l_apca.apcadocno
         LET l_apcb.apcbseq   = NULL
         SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
          WHERE apcbent   = g_enterprise
            AND apcbld    = l_apcb.apcbld
            AND apcbdocno = l_apcb.apcbdocno
         IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
         LET l_apcb.apcb001 = '54'
         LET l_apcb.apcb002 = l_apgc.apgcdocno
         LET l_apcb.apcb003 = l_apgc.apgcseq
         LET l_apcb.apcb014 = l_apgc.apgc001 #160428-00001#8          
         LET l_apcb.apcb005 = s_desc_get_acc_desc('3117',l_apgc.apgc001)
         LET l_apcb.apcb006 = ' '
         LET l_apcb.apcb007 = 1
         LET l_apcb.apcb010 = l_apca.apca015
         CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                          RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
         LET l_apcb.apcb020 = l_apgc.apgc006
         LET l_apcb.apcb021 = l_apgc.apgc004
         LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')   #albireo 160624 add
         LET l_apcb.apcb023 = 'N'
         LET l_apcb.apcb027 = l_apgc.apgc008
         LET l_apcb.apcb028 = l_apgc.apgc009
         LET l_apcb.apcb029 = l_apca.apca035
         LET l_apcb.apcb030 = l_apca.apca008
         LET l_apcb.apcb051 = l_apca.apca014
         LET l_apcb.apcb100 = l_apgc.apgc100
         LET l_apcb.apcb101 = l_apgc.apgc105   #albireo 160623 add
         LET l_apcb.apcb102 = l_apgc.apgc101
         LET l_apcb.apcb103 = l_apgc.apgc103
         LET l_apcb.apcb104 = l_apgc.apgc104
         LET l_apcb.apcb105 = l_apgc.apgc105
         LET l_apcb.apcb108 = l_apcb.apcb103
         LET l_apcb.apcb111 = l_apgc.apgc115   #albireo 160623 add
         LET l_apcb.apcb113 = l_apgc.apgc113
         LET l_apcb.apcb114 = l_apgc.apgc114
         LET l_apcb.apcb115 = l_apgc.apgc115
         LET l_apcb.apcborga = l_apgc.apgcorga
         CALL s_tax_chk(l_apca.apcacomp,l_apcb.apcb020) RETURNING g_sub_success,l_oodb004,l_apca013,l_apca012,l_oodb011
         IF l_apca013 = 'Y' THEN
            LET l_apcb.apcb105 = l_apcb.apcb105
         ELSE
            LET l_apcb.apcb105 = l_apcb.apcb103
         END IF
         CALL s_tax_ins(l_apca.apcadocno,l_apcb.apcbseq,'0',l_apcb.apcborga,l_apcb.apcb105,
                   l_apcb.apcb020,l_apcb.apcb007,l_apcb.apcb100,l_apcb.apcb102,l_apca.apcald,l_apca.apca121,l_apca.apca131)   #albireo 160630
             RETURNING l_apcb.apcb103,l_apcb.apcb104,l_apcb.apcb105,
                       l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,
                       l_apcb.apcb123,l_apcb.apcb124,l_apcb.apcb125,
                       l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135
         #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                             apcbdocno,apcbseq,
                             apcb001,apcb002,apcb003,apcb004,apcb005,
                             apcb006,apcb007,apcb008,apcb009,apcb010,
                             apcb011,apcb012,apcb013,apcb014,apcb015,
                             apcb016,apcb017,apcb018,apcb019,apcb020,
                             apcb021,apcb022,apcb023,apcb024,apcb025,
                             apcb026,apcb027,apcb028,apcb029,apcb030,
                             apcb032,apcb033,apcb034,apcb035,apcb036,
                             apcb037,apcb038,apcb039,apcb040,apcb041,
                             apcb042,apcb043,apcb044,apcb045,apcb046,
                             apcb047,apcb048,apcb049,apcb050,apcb051,
                             apcb100,apcb101,apcb102,apcb103,apcb104,
                             apcb105,apcb106,apcb107,apcb108,apcb111,
                             apcb113,apcb114,apcb115,apcb116,apcb117,
                             apcb118,apcb119,apcb121,apcb123,apcb124,
                             apcb125,apcb126,apcb127,apcb128,apcb131,
                             apcb133,apcb134,apcb135,apcb136,apcb137,
                             apcb138,
                             apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                             apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                             apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                             apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                             apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                             apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                             apcb052,apcb053,apcb054,apcb055
                            )
         VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
                 l_apcb.apcbdocno,l_apcb.apcbseq,
                 l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
                 l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
                 l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
                 l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
                 l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
                 l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
                 l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
                 l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
                 l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
                 l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
                 l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
                 l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
                 l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
                 l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
                 l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
                 l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
                 l_apcb.apcb138,
                 l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
                 l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
                 l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
                 l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
                 l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
                 l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
                 l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
                )
         #161108-00017#4 add end---
         IF SQLCA.SQLCODE THEN
            EXIT FOREACH
            LET r_success = FALSE
         END IF
         #r2.產生apcb-----e
         
         #r3.產生直接付款apde-----s
         INITIALIZE l_apde.* TO NULL
         LET l_apde.apdeent  =l_apca.apcaent
         LET l_apde.apdeld =l_apca.apcald
         LET l_apde.apdecomp =l_apca.apcacomp
         LET l_apde.apdeorga =l_apca.apcacomp
         LET l_apde.apdesite =l_apca.apcasite
         LET l_apde.apdedocno =l_apca.apcadocno
         SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
          WHERE apdeent   = l_apde.apdeent
            AND apdeld    = l_apde.apdeld
            AND apdedocno = l_apde.apdedocno
         IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
         LET l_apde.apdeseq = l_apde.apdeseq + 1
         LET l_apde.apde001 = 'aapt560'
         LET l_apde.apde009 = 'Y'
         LET l_apde.apde028 = '0'
         LET l_apde.apde002 = '10'
         LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'3')
         #以判斷完匯兌損失/匯兌收益,將金額轉正顯示
         LET l_apde.apde109 =  l_apgc.apgc105
         LET l_apde.apde119 =  l_apgc.apgc115
         LET l_apde.apde006 = '10'   
         #銀行存提碼
         LET l_apde.apde011 = l_apgc.apgc015
         #現金變動碼
         LET l_apde.apde012 = l_apgc.apgc016
         LET l_apde.apde013 = ''
         LET l_apde.apde014 = ''
         LET l_apde.apde016 = ''
         LET l_apde.apde100 = l_apgc.apgc100
         LET l_apde.apde101 = l_apgc.apgc101
         LET l_apde.apde039 = l_apga.apga007
         LET l_apde.apde041 = NULL
         SELECT nmabl003 INTO l_apde.apde041
           FROM nmabl_t
          WHERE nmablent = g_enterprise
            AND nmabl001 = l_apde.apde039
            AND nmabl002 = g_dlang
         IF cl_null(l_apde.apde101) THEN LET l_apde.apde101 = 1 END IF
         LET l_apde.apde032 = l_apca.apcadocdt
         LET l_apde.apde061 = '54'
         LET l_apde.apde016 = l_apgc.apgc004
         LET l_apde.apde008 = l_apgc.apgc014
         #160824-00049#7-----s
         CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
            RETURNING l_apde.apde016
         #160824-00049#7-----e
         INSERT INTO apde_t(apdeent,
                            apdeld,apdecomp,apdesite,apdedocno,apdeseq,
                            apde001,apde009,apde028,apde002,apde015,
                            apde003,apde004,apdeorga,apde006,apde011,
                            apde012,apde013,apde014,apde016,apde017,
                            apde018,apde021,apde032,apde100,apde101,
                            apde039,apde040,apde041,
                            apde008,
                            apde109,apde119,apde061)
                VALUES(l_apde.apdeent,
                       l_apde.apdeld,l_apde.apdecomp,l_apde.apdesite,l_apde.apdedocno,l_apde.apdeseq,
                       l_apde.apde001,l_apde.apde009,l_apde.apde028,l_apde.apde002,l_apde.apde015,
                       l_apde.apde003,l_apde.apde004,l_apde.apdeorga,l_apde.apde006,l_apde.apde011,
                       l_apde.apde012,l_apde.apde013,l_apde.apde014,l_apde.apde016,l_apde.apde017,
                       l_apde.apde018,l_apde.apde021,l_apde.apde032,l_apde.apde100,l_apde.apde101,
                       l_apde.apde039,l_apde.apde040,l_apde.apde041,
                       l_apde.apde008,
                       l_apde.apde109,l_apde.apde119,l_apde.apde061)
         IF SQLCA.SQLCODE THEN LET r_success = FALSE EXIT FOREACH END IF
         #r3.產生直接付款apde-----e
         
         #INSERT isam
         INITIALIZE l_isam.* TO NULL
         LET l_isam.isament = l_apca.apcaent
         LET l_isam.isamdocno = l_apca.apcadocno
         SELECT MAX(isamseq)+1 INTO l_isam.isamseq
           FROM isam_t
          WHERE isament = g_enterprise
            AND isamdocno = l_apca.apcadocno
            AND isam001 = 'aapt560'
         IF cl_null(l_isam.isamseq)THEN LET l_isam.isamseq = 1 END IF
         LET l_isam.isam001 = 'aapt560'
         LET l_isam.isam002 = l_apca.apca004                           
         LET l_isam.isam008 = l_apgc.apgc007                           
         LET l_isam.isam009 = l_apgc.apgc008                           
         LET l_isam.isam010 = l_apgc.apgc009                           
         LET l_isam.isam011 = l_apgc.apgc010                           
         LET l_isam.isam012 = l_apgc.apgc006        
         LET l_isam.isam0121= l_apca.apca013                  
         LET l_isam.isam013 = l_apca.apca012
         LET l_isam.isam014 = l_apgc.apgc100                           
         LET l_isam.isam015 = l_apgc.apgc101                           
         LET l_isam.isam016 = l_ooefl006
         LET l_isam.isam017 = l_ooef002
         CALL s_aapp320_buy_info(l_apca.apcacomp)RETURNING l_pmaal003,l_isao001,      
                    l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021
         LET l_isam.isam023 = l_apgc.apgc103                           
         LET l_isam.isam024 = l_apgc.apgc104                           
         LET l_isam.isam025 = l_apgc.apgc105                           
         LET l_isam.isam026 = l_apgc.apgc113                           
         LET l_isam.isam027 = l_apgc.apgc114                           
         LET l_isam.isam028 = l_apgc.apgc115                           
         LET l_isam.isam029 = s_desc_get_trading_partner_abbr_desc(l_apca.apca004)  
      
         SELECT isak008,isak009,isak010,isak011,isak012
           INTO l_isam.isam030,l_isam.isam031,l_isam.isam032,
                l_isam.isam033,l_isam.isam034
           FROM isak_t
          WHERE isakent = g_enterprise
            AND isak001 = l_apca.apca004
            AND isak002 = lc_param_apca.ooef019
         #161129-00042#1-add(s) #161230-00036#1  mark(s)
         #LET l_ooef011 = ' '
         #SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
         #IF l_ooef011 = 'TW' THEN
         #   #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
         #   CALL s_rule_chk_vat_id_string(l_isam.isam030) RETURNING g_sub_success
         #   IF NOT g_sub_success THEN
         #      LET r_success = FALSE
         #      RETURN r_success,r_docno
         #   END IF  
         #   #檢查營利事業統一編號邏輯，錯了下方提示不控卡
         #   CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
         #   IF NOT g_sub_success THEN
         #      LET l_isam.isam030 = l_isam.isam030
         #   END IF
         #END IF
         #161129-00042#1-add(e) #161230-00036#1  mark(e) 
         LET l_isam.isam035 = '1'                                 
         LET l_isam.isam036 = '11'                                
         LET l_isam.isam037 = l_apgc.apgc011                           
         LET l_isam.isam050 = l_apca.apcadocno                         
         LET l_isam.isam107    = 0                                 
         LET l_isam.isam108    = 0                                 
         LET l_isam.isam117    = 0                                 
         LET l_isam.isam118    = 0
         IF NOT cl_null(l_isam.isam010)THEN
            #161230-00036#1 add(s)
            LET l_isac004 = ''
            LET l_isac008 = ''
            SELECT isac004,isac008 INTO l_isac004,l_isac008 FROM isac_t WHERE isacent = g_enterprise 
               AND isac002 = l_isam.isam008 AND isac001 = lc_param_apca.ooef019
            #IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) THEN                                              #170218-00012#1 mark
            IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) AND l_isac004 != '28' AND l_isac004 != '29' THEN   #170218-00012#1 add
               #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
               LET l_ooef011 = ' '
               SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
               IF l_ooef011 = 'TW' THEN
                  IF NOT cl_null(l_isam.isam030) THEN   #170218-00012#1 add
                     LET l_vat_id = l_isam.isam030
                     IF l_vat_id.getLength() <> 8  THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'sub-001388'
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        CALL cl_err()
                        LET l_isam.isam030 = ''
                        LET r_success = FALSE
                        RETURN r_success,r_docno
                     END IF         
                     IF NOT cl_chk_num(l_isam.isam030,'N') THEN
                        INITIALIZE g_errparam TO NULL
                        LET g_errparam.code = 'sub-001388'
                        LET g_errparam.extend = ''
                        LET g_errparam.popup = TRUE
                        CALL cl_err()
                        LET l_isam.isam030 = ''
                        LET r_success = FALSE
                        RETURN r_success,r_docno
                     END IF
                     #檢查營利事業統一編號邏輯，錯了下方提示不控卡
                     CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
                     IF NOT g_sub_success THEN
                        LET l_isam.isam030 = l_isam.isam030
                     END IF
                  END IF   #170218-00012#1 add
               END IF
            END IF            
            #161230-00036#1 add(e)
            #INSERT INTO isam_t VALUES(l_isam.*)  #161108-00017#4 mark
            #161108-00017#4 add ------
            INSERT INTO isam_t (isament,isamownid,isamowndp,isamcrtid,isamcrtdp,
                                isamcrtdt,isammodid,isammoddt,isamcnfid,isamcnfdt,
                                isamstus,isamcomp,isamdocno,isamseq,
                                isam001,isam002,isam004,isam006,isam008,
                                isam009,isam010,isam011,isam012,isam0121,
                                isam013,isam014,isam015,isam016,isam017,
                                isam018,isam019,isam020,isam021,isam022,
                                isam023,isam024,isam025,isam026,isam027,
                                isam028,isam029,isam030,isam031,isam032,
                                isam033,isam034,isam035,isam036,isam037,
                                isam038,isam039,isam040,isam041,isam042,
                                isam043,isam044,isam045,isam046,isam047,
                                isam048,isam049,isam050,isam107,isam108,
                                isam117,isam118,isam200,isam201,isam202,
                                isam203,isam204,isam205,isam206,isam207,
                                isam208,isam209,isam210,
                                isamud001,isamud002,isamud003,isamud004,isamud005,
                                isamud006,isamud007,isamud008,isamud009,isamud010,
                                isamud011,isamud012,isamud013,isamud014,isamud015,
                                isamud016,isamud017,isamud018,isamud019,isamud020,
                                isamud021,isamud022,isamud023,isamud024,isamud025,
                                isamud026,isamud027,isamud028,isamud029,isamud030,
                                isam051
                               )
            VALUES (l_isam.isament,l_isam.isamownid,l_isam.isamowndp,l_isam.isamcrtid,l_isam.isamcrtdp,
                    l_isam.isamcrtdt,l_isam.isammodid,l_isam.isammoddt,l_isam.isamcnfid,l_isam.isamcnfdt,
                    l_isam.isamstus,l_isam.isamcomp,l_isam.isamdocno,l_isam.isamseq,
                    l_isam.isam001,l_isam.isam002,l_isam.isam004,l_isam.isam006,l_isam.isam008,
                    l_isam.isam009,l_isam.isam010,l_isam.isam011,l_isam.isam012,l_isam.isam0121,
                    l_isam.isam013,l_isam.isam014,l_isam.isam015,l_isam.isam016,l_isam.isam017,
                    l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021,l_isam.isam022,
                    l_isam.isam023,l_isam.isam024,l_isam.isam025,l_isam.isam026,l_isam.isam027,
                    l_isam.isam028,l_isam.isam029,l_isam.isam030,l_isam.isam031,l_isam.isam032,
                    l_isam.isam033,l_isam.isam034,l_isam.isam035,l_isam.isam036,l_isam.isam037,
                    l_isam.isam038,l_isam.isam039,l_isam.isam040,l_isam.isam041,l_isam.isam042,
                    l_isam.isam043,l_isam.isam044,l_isam.isam045,l_isam.isam046,l_isam.isam047,
                    l_isam.isam048,l_isam.isam049,l_isam.isam050,l_isam.isam107,l_isam.isam108,
                    l_isam.isam117,l_isam.isam118,l_isam.isam200,l_isam.isam201,l_isam.isam202,
                    l_isam.isam203,l_isam.isam204,l_isam.isam205,l_isam.isam206,l_isam.isam207,
                    l_isam.isam208,l_isam.isam209,l_isam.isam210,
                    l_isam.isamud001,l_isam.isamud002,l_isam.isamud003,l_isam.isamud004,l_isam.isamud005,
                    l_isam.isamud006,l_isam.isamud007,l_isam.isamud008,l_isam.isamud009,l_isam.isamud010,
                    l_isam.isamud011,l_isam.isamud012,l_isam.isamud013,l_isam.isamud014,l_isam.isamud015,
                    l_isam.isamud016,l_isam.isamud017,l_isam.isamud018,l_isam.isamud019,l_isam.isamud020,
                    l_isam.isamud021,l_isam.isamud022,l_isam.isamud023,l_isam.isamud024,l_isam.isamud025,
                    l_isam.isamud026,l_isam.isamud027,l_isam.isamud028,l_isam.isamud029,l_isam.isamud030,
                    l_isam.isam051
                   )
            #161108-00017#4 add end---
         END IF 
      END FOREACH  
      
      #161004-00019#1-----s
      CALL s_fin_get_account(l_apca.apcald,'13',l_apca.apca007,'8504_04') RETURNING g_sub_success,l_xrcd009,g_errno
      UPDATE xrcd_t SET xrcd009 = l_xrcd009
       WHERE xrcdent= g_enterprise
         AND xrcdld = l_apca.apcald AND xrcddocno = l_apca.apcadocno
         AND xrcd009 IS NULL
      #161004-00019#1-----e
      LET l_apcb113sum = NULL   LET l_apcb114sum = NULL   LET l_apcb115sum = NULL
      SELECT SUM(apcb113),SUM(apcb114),SUM(apcb115)
        INTO l_apcb113sum,l_apcb114sum,l_apcb115sum
        FROM apcb_t
       WHERE apcbent = g_enterprise
         AND apcbld  = l_apca.apcald
         AND apcbdocno = l_apca.apcadocno
      IF cl_null(l_apcb113sum)THEN LET l_apcb113sum = 0 END IF
      IF cl_null(l_apcb114sum)THEN LET l_apcb114sum = 0 END IF
      IF cl_null(l_apcb115sum)THEN LET l_apcb115sum = 0 END IF
      
      UPDATE apca_t SET apca103 = l_apcb113sum,
                        apca104 = l_apcb114sum,
                        apca108 = l_apcb115sum,
                        apca113 = l_apcb113sum,
                        apca114 = l_apcb114sum,
                        apca118 = l_apcb115sum,
                        #160824-00049#7-----s
                        apca107 = l_apcb115sum,
                        apca117 = l_apcb115sum
                        #160824-00049#7-----e
       WHERE apcaent = g_enterprise
         AND apcald  = l_apca.apcald
         AND apcadocno = l_apca.apcadocno
      
      CALL s_aap_multi_bill_period(l_apca.apcald,l_apca.apcadocno) RETURNING g_sub_success,g_errno
      
      UPDATE apcc_t SET apcc109 = apcc108 ,apcc119 = apcc118
       WHERE apccent = g_enterprise
         AND apccdocno = l_apca.apcadocno
         AND apccld    = l_apca.apcald
      #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
      CALL s_pre_voucher_ins('AP','P10',l_apca.apcald,l_apca.apcadocno,l_apca.apcadocdt,'1')
                          RETURNING g_sub_success
      IF NOT g_sub_success THEN
         LET r_success = FALSE
      END IF   

      UPDATE apgc_t SET apgc012 = l_apca.apcadocno
       WHERE apgcent = g_enterprise
         AND apgccomp = l_apgi.apgicomp
         AND apgcdocno = l_apgi.apgidocno
         AND apgc900 = '0'
         AND apgc002 = l_apca004
   END FOREACH
   
   
   LET r_docno = l_apca.apcadocno
   RETURN r_success,r_docno
   #160824-00049#7-----e
   
   
   ##160824-00049#7 mark-----s
   #INITIALIZE l_apca.* TO NULL
   #LET l_apca.apcaent = g_enterprise
   #LET l_apca.apcacomp = l_apga.apgacomp
   #LET l_apca.apcald = NULL
   #SELECT glaald,glaa001,glaa016,glaa020
   #  INTO l_apca.apcald,l_apca.apca100,l_apca.apca120,l_apca.apca130
   #  FROM glaa_t
   # WHERE glaaent  = g_enterprise
   #   AND glaacomp = l_apca.apcacomp
   #   AND glaa014  = 'Y'
   #LET l_apca.apcadocdt = g_apca_m.apcadocdt
   #LET l_apca.apca003   = g_apca_m.apca003
   #LET l_apca.apca016   = g_apca_m.apca016
   #LET l_apca.apca018   = g_apca_m.apca018
   #LET l_apca.apcadocno = g_apca_m.apcadocno
   #CALL s_aooi200_fin_gen_docno(l_apca.apcald,'','',l_apca.apcadocno,l_apca.apcadocdt,'aapt560') 
   #   RETURNING g_sub_success,l_apca.apcadocno                                            
   #IF NOT g_sub_success THEN
   #   LET r_success = FALSE
   #   RETURN r_success,r_docno
   #END IF
   #LET l_apca.apcastus  = 'N' # 狀態碼 
   #LET l_apca.apcasite = l_apca.apcacomp   # 帳務中心                            apcasite   = apgccomp                                                    
   #LET l_apca.apca001 =  s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3001')
   #LET l_apca.apca003 = g_user # 帳務人員                            apca003    = g_user                                                      
   #LET l_apca.apca004 = l_apga.apga004 # 帳款對象編號                        apca004    = 廠商(受益人)apga004   
   #CALL s_apmm100_sel_pmac002(l_apca.apca004,'1') RETURNING l_apca.apca005,l_desc
   #IF cl_null(l_apca.apca005)THEN LET l_apca.apca005 = l_apca.apca004 END IF
   #SELECT pmaa080,pmaa047 INTO l_apca.apca006,l_apca.apca046
   #  FROM pmaa_t
   # WHERE pmaaent = g_enterprise AND pmaa001 = l_apca.apca004
   #LET lc_param_apca.apcald   = l_apca.apcald
   #LET lc_param_apca.apcacomp = l_apca.apcacomp
   #LET lc_param_apca.apcasite = l_apca.apcasite
   #LET lc_param_apca.apcadocdt= l_apca.apcadocdt
   #LET lc_param_apca.apca001  = '19'   #l_apca.apca001
   #LET lc_param_apca.apca004  = l_apca.apca004
   #SELECT ooef019 INTO lc_param_apca.ooef019 FROM ooef_t
   # WHERE ooefent = g_enterprise
   #   AND ooef001 = l_apca.apcacomp
   #LET ls_js = util.JSON.stringify(lc_param_apca)
   #CALL s_aapt300_get_apca004_info(ls_js) RETURNING ls_js
   #CALL util.JSON.parse(ls_js,lc_param_info)
   #LET l_apca.apca006 = lc_param_info.apca006  
   #LET l_apca.apca007 = lc_param_info.apca007   # 帳款類別           apca007    = 廠商慣用條件
   #LET l_apca.apca008 = lc_param_info.apca008   # 付款條件編號       apca008    = 取交易對象慣用付款條件
   #LET l_apca.apca009 = lc_param_info.apca009   # 應付款日/應扣抵日  apca009    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   #LET l_apca.apca010 = lc_param_info.apca010   # 容許票據到期日     apca010    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   #LET l_apca.apca011 = lc_param_info.apca011   # 稅別               apca011    = 取交易對象慣用稅別,實際稅別在單身呈現
   #LET l_apca.apca012 = lc_param_info.apca012   # 稅率               apca012    = 依稅別串 oodb006
   #LET l_apca.apca013 = lc_param_info.apca013   # 含稅否             apca013    = 依稅別串 oodb005                   
   #LET l_apca.apca014 = l_apga.apga005          # 人員編號           apca014    = apga005
   #LET l_apca.apca015 = NULL                    # 部門編號           apca015    = apga005 所屬部門
   #SELECT ooag003 INTO l_apca.apca015 FROM ooag_t
   # WHERE ooagent = g_enterprise
   #   AND ooag001 = l_apca.apca014 
   #LET l_apca.apca034 = lc_param_info.apca034   # 責任中心                            apca034    = 依 aapt300原則帶出      
   #LET l_apca.apca035 = lc_param_info.apca035   # 應付(貸方)科目編號                  apca035    = 依帳款類別帶出           
   #LET l_apca.apca036 = lc_param_info.apca036   # 費用(借方)科目編號                  apca036    = 依帳款類別帶出     
   #LET l_apca.apca046 = lc_param_info.apca046       
   #LET l_apca.apca054 = lc_param_info.apca054   # 多帳期設定                          apca054    = 依付款條件取出 
   #LET l_apca.apca055 = lc_param_info.apca055   # 繳款優惠條件                        apca055    = 依付款條件取出 
   #LET l_apca.apca058 = lc_param_info.apca058
   #LET l_apca.apca060 = lc_param_info.apca060
   #LET l_apca.apca016 = '33'
   #LET l_apca.apca017 = '1'
   #LET l_apca.apca018 = l_apgi.apgidocno
   #LET l_apca.apca020 = 'N'         # 信用狀付款否 
   #LET l_apca.apca026 = 0
   #LET l_apca.apca027 = 0
   #LET l_apca.apca028 = 0
   #LET l_apca.apca029 = 0
   #LET l_apca.apca037 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-0030')# 產生傳票否                          apca037    = 取單別參數D-FIN-0030    
   #LET l_apca.apca067 = l_apga.apgadocno
   #LET l_apca.apca101 = 1
   #LET l_apca.apca103 = 0
   #LET l_apca.apca104 = 0
   #LET l_apca.apca106 = 0 
   #LET l_apca.apca107 = 0
   #LET l_apca.apca108 = 0 
   #LET l_apca.apca113 = 0
   #LET l_apca.apca114 = 0 
   #LET l_apca.apca116 = 0
   #LEt l_apca.apca117 = 0 
   #LET l_apca.apca118 = 0 
   #LET lc_param2.apca004 = l_apca.apca004
   #CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-3009') RETURNING lc_param2.sfin2009
   #LET ls_js = util.JSON.stringify(lc_param2)   
   #CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apca.apca100,ls_js)
   #     RETURNING l_apca.apca101,l_apca.apca121,l_apca.apca131
   #LET l_apca.apca123 = 0
   #LET l_apca.apca124 = 0
   #LET l_apca.apca126 = 0 
   #LET l_apca.apca127 = 0 
   #LET l_apca.apca128 = 0
   #LET l_apca.apca133 = 0 
   #LET l_apca.apca134 = 0 
   #LET l_apca.apca136 = 0 
   #LET l_apca.apca137 = 0
   #LET l_apca.apca138 = 0 
   #LET l_apca.apca071 = 0
   #LET l_apca.apca072 = 0
   ##albireo 160624-----s
   #LEt l_apca.apca073 = l_apga.apga001
   #LET l_apca.apcaownid = g_user
   #LET l_apca.apcaowndp = g_dept
   #LET l_apca.apcacrtid = g_user
   #LET l_apca.apcacrtdp = g_dept
   #LET l_date = cl_get_current()
   #LET l_apca.apcacrtdt = l_date
   ##albireo 160624-----e
   #INSERT INTO apca_t VALUES(l_apca.*)
   #
   ##apgc產生 apcb xrcd_t
   #LET l_sql = "SELECT * FROM apgc_t ",
   #            " WHERE apgcent = ",g_enterprise," ",
   #            "   AND apgccomp = '",l_apgi.apgicomp,"' ",
   #            "   AND apgcdocno = '",l_apgi.apgidocno,"' ",
   #            "   AND apgc900 = '0' "
   #PREPARE sel_apgcp3 FROM l_sql
   #DECLARE sel_apgcc3 CURSOR FOR sel_apgcp3
   #
   #FOREACH sel_apgcc3 INTO l_apgc.*
   #   IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
   #   #r2.產生apcb-----s
   #   INITIALIZE l_apcb.* TO NULL
   #   LET l_apcb.apcbent   = g_enterprise
   #   LET l_apcb.apcbld    = l_apca.apcald
   #   LET l_apcb.apcblegl  = l_apca.apcacomp
   #   LET l_apcb.apcbsite  = l_apca.apcasite
   #   LET l_apcb.apcbdocno = l_apca.apcadocno
   #   LET l_apcb.apcbseq   = NULL
   #   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
   #    WHERE apcbent   = g_enterprise
   #      AND apcbld    = l_apcb.apcbld
   #      AND apcbdocno = l_apcb.apcbdocno
   #   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   #   LET l_apcb.apcb001 = '54'
   #   LET l_apcb.apcb002 = l_apgc.apgcdocno
   #   LET l_apcb.apcb003 = l_apgc.apgcseq
   #   LET l_apcb.apcb005 = s_desc_get_acc_desc('3117',l_apgc.apgc001)
   #   LET l_apcb.apcb006 = ' '
   #   LET l_apcb.apcb007 = 1
   #   LET l_apcb.apcb010 = l_apca.apca015
   #   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
   #                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   #   LET l_apcb.apcb020 = l_apgc.apgc006
   #   LET l_apcb.apcb021 = l_apgc.apgc004
   #   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')   #albireo 160624 add
   #   LET l_apcb.apcb023 = 'N'
   #   LET l_apcb.apcb027 = l_apgc.apgc008
   #   LET l_apcb.apcb028 = l_apgc.apgc009
   #   LET l_apcb.apcb029 = l_apca.apca035
   #   LET l_apcb.apcb030 = l_apca.apca008
   #   LET l_apcb.apcb051 = l_apca.apca014
   #   LET l_apcb.apcb100 = l_apgc.apgc100
   #   LET l_apcb.apcb101 = l_apgc.apgc105   #albireo 160623 add
   #   LET l_apcb.apcb102 = l_apgc.apgc101
   #   LET l_apcb.apcb103 = l_apgc.apgc103
   #   LET l_apcb.apcb104 = l_apgc.apgc104
   #   LET l_apcb.apcb105 = l_apgc.apgc105
   #   LET l_apcb.apcb108 = l_apcb.apcb103
   #   LET l_apcb.apcb111 = l_apgc.apgc115   #albireo 160623 add
   #   LET l_apcb.apcb113 = l_apgc.apgc113
   #   LET l_apcb.apcb114 = l_apgc.apgc114
   #   LET l_apcb.apcb115 = l_apgc.apgc115
   #   LET l_apcb.apcborga = l_apgc.apgcorga
   #   CALL s_tax_chk(l_apca.apcacomp,l_apcb.apcb020) RETURNING g_sub_success,l_oodb004,l_apca013,l_apca012,l_oodb011
   #   IF l_apca013 = 'Y' THEN
   #      LET l_apcb.apcb105 = l_apcb.apcb105
   #   ELSE
   #      LET l_apcb.apcb105 = l_apcb.apcb103
   #   END IF
   #   CALL s_tax_ins(l_apca.apcadocno,l_apcb.apcbseq,'0',l_apcb.apcborga,l_apcb.apcb105,
   #             l_apcb.apcb020,l_apcb.apcb007,l_apcb.apcb100,l_apcb.apcb102,l_apca.apcald,l_apca.apca121,l_apca.apca131)   #albireo 160630
   #       RETURNING l_apcb.apcb103,l_apcb.apcb104,l_apcb.apcb105,
   #                 l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,
   #                 l_apcb.apcb123,l_apcb.apcb124,l_apcb.apcb125,
   #                 l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135
   #   INSERT INTO apcb_t VALUES(l_apcb.*)
   #   IF SQLCA.SQLCODE THEN
   #      EXIT FOREACH
   #      LET r_success = FALSE
   #   END IF
   #   #r2.產生apcb-----e
   #   
   #   #r3.產生直接付款apde-----s
   #   INITIALIZE l_apde.* TO NULL
   #   LET l_apde.apdeent  =l_apca.apcaent
   #   LET l_apde.apdeld =l_apca.apcald
   #   LET l_apde.apdecomp =l_apca.apcacomp
   #   LET l_apde.apdeorga =l_apca.apcacomp
   #   LET l_apde.apdesite =l_apca.apcasite
   #   LET l_apde.apdedocno =l_apca.apcadocno
   #   SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
   #    WHERE apdeent   = l_apde.apdeent
   #      AND apdeld    = l_apde.apdeld
   #      AND apdedocno = l_apde.apdedocno
   #   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   #   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #   LET l_apde.apde001 = 'aapt560'
   #   LET l_apde.apde009 = 'N'
   #   LET l_apde.apde028 = '0'
   #   LET l_apde.apde002 = '10'
   #   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'3')
   #   #以判斷完匯兌損失/匯兌收益,將金額轉正顯示
   #   LET l_apde.apde109 =  l_apgc.apgc105
   #   LET l_apde.apde119 =  l_apgc.apgc115
   #   LET l_apde.apde006 = '10'   
   #   #銀行存提碼
   #   LET l_apde.apde011 = l_apgc.apgc015
   #   #現金變動碼
   #   LET l_apde.apde012 = l_apgc.apgc016
   #   LET l_apde.apde013 = ''
   #   LET l_apde.apde014 = ''
   #   LET l_apde.apde016 = ''
   #   LET l_apde.apde100 = l_apgc.apgc100
   #   LET l_apde.apde101 = l_apgc.apgc101
   #   LET l_apde.apde039 = l_apga.apga007
   #   LET l_apde.apde041 = NULL
   #   SELECT nmabl003 INTO l_apde.apde041
   #     FROM nmabl_t
   #    WHERE nmablent = g_enterprise
   #      AND nmabl001 = l_apde.apde039
   #      AND nmabl002 = g_dlang
   #   IF cl_null(l_apde.apde101) THEN LET l_apde.apde101 = 1 END IF
   #   LET l_apde.apde032 = l_apca.apcadocdt
   #   LET l_apde.apde061 = '54'
   #   LET l_apde.apde016 = l_apgc.apgc004
   #   LET l_apde.apde008 = l_apgc.apgc014
   #   INSERT INTO apde_t(apdeent,
   #                      apdeld,apdecomp,apdesite,apdedocno,apdeseq,
   #                      apde001,apde009,apde028,apde002,apde015,
   #                      apde003,apde004,apdeorga,apde006,apde011,
   #                      apde012,apde013,apde014,apde016,apde017,
   #                      apde018,apde021,apde032,apde100,apde101,
   #                      apde039,apde040,apde041,
   #                      apde008,
   #                      apde109,apde119,apde061)
   #          VALUES(l_apde.apdeent,
   #                 l_apde.apdeld,l_apde.apdecomp,l_apde.apdesite,l_apde.apdedocno,l_apde.apdeseq,
   #                 l_apde.apde001,l_apde.apde009,l_apde.apde028,l_apde.apde002,l_apde.apde015,
   #                 l_apde.apde003,l_apde.apde004,l_apde.apdeorga,l_apde.apde006,l_apde.apde011,
   #                 l_apde.apde012,l_apde.apde013,l_apde.apde014,l_apde.apde016,l_apde.apde017,
   #                 l_apde.apde018,l_apde.apde021,l_apde.apde032,l_apde.apde100,l_apde.apde101,
   #                 l_apde.apde039,l_apde.apde040,l_apde.apde041,
   #                 l_apde.apde008,
   #                 l_apde.apde109,l_apde.apde119,l_apde.apde061)
   #   IF SQLCA.SQLCODE THEN LET r_success = FALSE EXIT FOREACH END IF
   #   #r3.產生直接付款apde-----e
   #   
   #   #INSERT isam
   #   INITIALIZE l_isam.* TO NULL
   #   LET l_isam.isament = l_apca.apcaent
   #   LET l_isam.isamdocno = l_apca.apcadocno
   #   SELECT MAX(isamseq)+1 INTO l_isam.isamseq
   #     FROM isam_t
   #    WHERE isament = g_enterprise
   #      AND isamdocno = l_apca.apcadocno
   #      AND isam001 = 'aapt560'
   #   IF cl_null(l_isam.isamseq)THEN LET l_isam.isamseq = 1 END IF
   #   LET l_isam.isam001 = 'aapt560'
   #   LET l_isam.isam002 = l_apca.apca004                           
   #   LET l_isam.isam008 = l_apgc.apgc007                           
   #   LET l_isam.isam009 = l_apgc.apgc008                           
   #   LET l_isam.isam010 = l_apgc.apgc009                           
   #   LET l_isam.isam011 = l_apgc.apgc010                           
   #   LET l_isam.isam012 = l_apgc.apgc006        
   #   LET l_isam.isam0121= l_apca.apca013                  
   #   LET l_isam.isam013 = l_apca.apca012
   #   LET l_isam.isam014 = l_apgc.apgc100                           
   #   LET l_isam.isam015 = l_apgc.apgc101                           
   #   LET l_isam.isam016 = l_ooefl006
   #   LET l_isam.isam017 = l_ooef002
   #   CALL s_aapp320_buy_info(l_apca.apcacomp)RETURNING l_pmaal003,l_isao001,      
   #              l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021
   #   LET l_isam.isam023 = l_apgc.apgc103                           
   #   LET l_isam.isam024 = l_apgc.apgc104                           
   #   LET l_isam.isam025 = l_apgc.apgc105                           
   #   LET l_isam.isam026 = l_apgc.apgc113                           
   #   LET l_isam.isam027 = l_apgc.apgc114                           
   #   LET l_isam.isam028 = l_apgc.apgc115                           
   #   LET l_isam.isam029 = s_desc_get_trading_partner_abbr_desc(l_apca.apca004)  
   #
   #   SELECT isak008,isak009,isak010,isak011,isak012
   #     INTO l_isam.isam030,l_isam.isam031,l_isam.isam032,
   #          l_isam.isam033,l_isam.isam034
   #     FROM isak_t
   #    WHERE isakent = g_enterprise
   #      AND isak001 = l_apca.apca004
   #      AND isak002 = lc_param_apca.ooef019
   #     
   #   LET l_isam.isam035 = '1'                                 
   #   LET l_isam.isam036 = '11'                                
   #   LET l_isam.isam037 = l_apgc.apgc011                           
   #   LET l_isam.isam050 = l_apca.apcadocno                         
   #   LET l_isam.isam107    = 0                                 
   #   LET l_isam.isam108    = 0                                 
   #   LET l_isam.isam117    = 0                                 
   #   LET l_isam.isam118    = 0
   #   IF NOT cl_null(l_isam.isam010)THEN
   #      INSERT INTO isam_t VALUES(l_isam.*)      
   #   END IF 
   #END FOREACH  
   ##albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   #   
   #LET l_apcb113sum = NULL   LET l_apcb114sum = NULL   LET l_apcb115sum = NULL
   #SELECT SUM(apcb113),SUM(apcb114),SUM(apcb115)
   #  INTO l_apcb113sum,l_apcb114sum,l_apcb115sum
   #  FROM apcb_t
   # WHERE apcbent = g_enterprise
   #   AND apcbld  = l_apca.apcald
   #   AND apcbdocno = l_apca.apcadocno
   #IF cl_null(l_apcb113sum)THEN LET l_apcb113sum = 0 END IF
   #IF cl_null(l_apcb114sum)THEN LET l_apcb114sum = 0 END IF
   #IF cl_null(l_apcb115sum)THEN LET l_apcb115sum = 0 END IF
   #
   #UPDATE apca_t SET apca103 = l_apcb113sum,
   #                  apca104 = l_apcb114sum,
   #                  apca108 = l_apcb115sum,
   #                  apca113 = l_apcb113sum,
   #                  apca114 = l_apcb114sum,
   #                  apca118 = l_apcb115sum
   # WHERE apcaent = g_enterprise
   #   AND apcald  = l_apca.apcald
   #   AND apcadocno = l_apca.apcadocno
   #
   #CALL s_aap_multi_bill_period(l_apca.apcald,l_apca.apcadocno) RETURNING g_sub_success,g_errno
   #
   #UPDATE apcc_t SET apcc109 = apcc108 ,apcc119 = apcc118
   # WHERE apccent = g_enterprise
   #   AND apccdocno = l_apca.apcadocno
   #   AND apccld    = l_apca.apcald
   ##albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   #CALL s_pre_voucher_ins('AP','P10',l_apca.apcald,l_apca.apcadocno,l_apca.apcadocdt,'1')
   #                    RETURNING g_sub_success
   #IF NOT g_sub_success THEN
   #   LET r_success = FALSE
   #END IF      
   #
   #UPDATE apgi_t SET apgi019 = l_apca.apcadocno
   # WHERE apgient = g_enterprise
   #   AND apgicomp = l_apca.apcacomp
   #   AND apgidocno = g_apca_m.apca018
   #LET r_docno = l_apca.apcadocno
   #RETURN r_success,r_docno
   #160824-00049#7 mark-----e
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_ins_ap_4()
#DEFINE l_apca   RECORD LIKE apca_t.* #161104-00024#5 mark
#161104-00024#5-add(s)
DEFINE l_apca  RECORD  #應付憑單單頭
       apcaent   LIKE apca_t.apcaent, #企業編號
       apcaownid LIKE apca_t.apcaownid, #資料所有者
       apcaowndp LIKE apca_t.apcaowndp, #資料所有部門
       apcacrtid LIKE apca_t.apcacrtid, #資料建立者
       apcacrtdp LIKE apca_t.apcacrtdp, #資料建立部門
       apcacrtdt LIKE apca_t.apcacrtdt, #資料創建日
       apcamodid LIKE apca_t.apcamodid, #資料修改者
       apcamoddt LIKE apca_t.apcamoddt, #最近修改日
       apcacnfid LIKE apca_t.apcacnfid, #資料確認者
       apcacnfdt LIKE apca_t.apcacnfdt, #資料確認日
       apcapstid LIKE apca_t.apcapstid, #資料過帳者
       apcapstdt LIKE apca_t.apcapstdt, #資料過帳日
       apcastus  LIKE apca_t.apcastus, #狀態碼
       apcald    LIKE apca_t.apcald, #帳套
       apcacomp  LIKE apca_t.apcacomp, #法人
       apcadocno LIKE apca_t.apcadocno, #應付帳款單號碼
       apcadocdt LIKE apca_t.apcadocdt, #帳款日期
       apcasite  LIKE apca_t.apcasite, #帳務中心
       apca001   LIKE apca_t.apca001, #帳款單性質
       apca003   LIKE apca_t.apca003, #帳務人員
       apca004   LIKE apca_t.apca004, #帳款對象編號
       apca005   LIKE apca_t.apca005, #付款對象
       apca006   LIKE apca_t.apca006, #供應商分類
       apca007   LIKE apca_t.apca007, #帳款類別
       apca008   LIKE apca_t.apca008, #付款條件編號
       apca009   LIKE apca_t.apca009, #應付款日/應扣抵日
       apca010   LIKE apca_t.apca010, #容許票據到期日
       apca011   LIKE apca_t.apca011, #稅別
       apca012   LIKE apca_t.apca012, #稅率
       apca013   LIKE apca_t.apca013, #含稅否
       apca014   LIKE apca_t.apca014, #人員編號
       apca015   LIKE apca_t.apca015, #部門編號
       apca016   LIKE apca_t.apca016, #來源作業類型
       apca017   LIKE apca_t.apca017, #產生方式
       apca018   LIKE apca_t.apca018, #來源參考單號
       apca019   LIKE apca_t.apca019, #系統產生對應單號(待抵帳款-預付)
       apca020   LIKE apca_t.apca020, #信用狀付款否
       apca021   LIKE apca_t.apca021, #商業發票號碼(IV no.)
       apca022   LIKE apca_t.apca022, #進口報單號碼
       apca025   LIKE apca_t.apca025, #差異處理(發票與帳款差異)
       apca026   LIKE apca_t.apca026, #原幣未稅差異
       apca027   LIKE apca_t.apca027, #原幣稅額差異
       apca028   LIKE apca_t.apca028, #本幣未稅差異
       apca029   LIKE apca_t.apca029, #本幣幣稅額差異
       apca030   LIKE apca_t.apca030, #差異科目
       apca031   LIKE apca_t.apca031, #產生之差異折讓單號
       apca032   LIKE apca_t.apca032, #發票類型
       apca033   LIKE apca_t.apca033, #專案編號
       apca034   LIKE apca_t.apca034, #責任中心
       apca035   LIKE apca_t.apca035, #應付(貸方)科目編號
       apca036   LIKE apca_t.apca036, #費用(借方)科目編號
       apca037   LIKE apca_t.apca037, #產生傳票否
       apca038   LIKE apca_t.apca038, #拋轉傳票號碼
       apca039   LIKE apca_t.apca039, #會計檢核附件份數
       apca040   LIKE apca_t.apca040, #留置否
       apca041   LIKE apca_t.apca041, #留置理由碼
       apca042   LIKE apca_t.apca042, #留置設定日期
       apca043   LIKE apca_t.apca043, #留置解除日期
       apca044   LIKE apca_t.apca044, #留置原幣金額
       apca045   LIKE apca_t.apca045, #留置說明
       apca046   LIKE apca_t.apca046, #關係人否
       apca047   LIKE apca_t.apca047, #多角序號
       apca048   LIKE apca_t.apca048, #集團代付/代付單號
       apca049   LIKE apca_t.apca049, #來源營運中心編號
       apca050   LIKE apca_t.apca050, #交易原始單據份數
       apca051   LIKE apca_t.apca051, #作廢理由碼
       apca052   LIKE apca_t.apca052, #列印次數
       apca053   LIKE apca_t.apca053, #備註
       apca054   LIKE apca_t.apca054, #多帳期設定
       apca055   LIKE apca_t.apca055, #繳款優惠條件
       apca056   LIKE apca_t.apca056, #會計檢核附件狀態
       apca057   LIKE apca_t.apca057, #交易對象識別碼
       apca058   LIKE apca_t.apca058, #稅別交易類型
       apca059   LIKE apca_t.apca059, #預算編號
       apca060   LIKE apca_t.apca060, #發票開立方式
       apca061   LIKE apca_t.apca061, #預開發票基準日
       apca062   LIKE apca_t.apca062, #多角性質
       apca063   LIKE apca_t.apca063, #整帳批序號
       apca064   LIKE apca_t.apca064, #訂金序次
       apca065   LIKE apca_t.apca065, #發票編號
       apca066   LIKE apca_t.apca066, #發票號碼
       apca100   LIKE apca_t.apca100, #交易原幣別
       apca101   LIKE apca_t.apca101, #原幣匯率
       apca103   LIKE apca_t.apca103, #原幣未稅金額
       apca104   LIKE apca_t.apca104, #原幣稅額
       apca106   LIKE apca_t.apca106, #原幣應稅折抵合計金額
       apca107   LIKE apca_t.apca107, #原幣直接沖帳(調整)合計金額
       apca108   LIKE apca_t.apca108, #原幣應付金額
       apca113   LIKE apca_t.apca113, #本幣未稅金額
       apca114   LIKE apca_t.apca114, #本幣稅額
       apca116   LIKE apca_t.apca116, #本幣應稅折抵合計金額
       apca117   LIKE apca_t.apca117, #NO USE
       apca118   LIKE apca_t.apca118, #本幣應付金額
       apca120   LIKE apca_t.apca120, #本位幣二幣別
       apca121   LIKE apca_t.apca121, #本位幣二匯率
       apca123   LIKE apca_t.apca123, #本位幣二未稅金額
       apca124   LIKE apca_t.apca124, #本位幣二稅額
       apca126   LIKE apca_t.apca126, #本位幣二應稅折抵合計金額
       apca127   LIKE apca_t.apca127, #NO USE
       apca128   LIKE apca_t.apca128, #本位幣二應付金額
       apca130   LIKE apca_t.apca130, #本位幣三幣別
       apca131   LIKE apca_t.apca131, #本位幣三匯率
       apca133   LIKE apca_t.apca133, #本位幣三未稅金額
       apca134   LIKE apca_t.apca134, #本位幣三稅額
       apca136   LIKE apca_t.apca136, #本位幣三應稅折抵合計金額
       apca137   LIKE apca_t.apca137, #NO USE
       apca138   LIKE apca_t.apca138, #本位幣三應付金額
       apcaud001 LIKE apca_t.apcaud001, #自定義欄位(文字)001
       apcaud002 LIKE apca_t.apcaud002, #自定義欄位(文字)002
       apcaud003 LIKE apca_t.apcaud003, #自定義欄位(文字)003
       apcaud004 LIKE apca_t.apcaud004, #自定義欄位(文字)004
       apcaud005 LIKE apca_t.apcaud005, #自定義欄位(文字)005
       apcaud006 LIKE apca_t.apcaud006, #自定義欄位(文字)006
       apcaud007 LIKE apca_t.apcaud007, #自定義欄位(文字)007
       apcaud008 LIKE apca_t.apcaud008, #自定義欄位(文字)008
       apcaud009 LIKE apca_t.apcaud009, #自定義欄位(文字)009
       apcaud010 LIKE apca_t.apcaud010, #自定義欄位(文字)010
       apcaud011 LIKE apca_t.apcaud011, #自定義欄位(數字)011
       apcaud012 LIKE apca_t.apcaud012, #自定義欄位(數字)012
       apcaud013 LIKE apca_t.apcaud013, #自定義欄位(數字)013
       apcaud014 LIKE apca_t.apcaud014, #自定義欄位(數字)014
       apcaud015 LIKE apca_t.apcaud015, #自定義欄位(數字)015
       apcaud016 LIKE apca_t.apcaud016, #自定義欄位(數字)016
       apcaud017 LIKE apca_t.apcaud017, #自定義欄位(數字)017
       apcaud018 LIKE apca_t.apcaud018, #自定義欄位(數字)018
       apcaud019 LIKE apca_t.apcaud019, #自定義欄位(數字)019
       apcaud020 LIKE apca_t.apcaud020, #自定義欄位(數字)020
       apcaud021 LIKE apca_t.apcaud021, #自定義欄位(日期時間)021
       apcaud022 LIKE apca_t.apcaud022, #自定義欄位(日期時間)022
       apcaud023 LIKE apca_t.apcaud023, #自定義欄位(日期時間)023
       apcaud024 LIKE apca_t.apcaud024, #自定義欄位(日期時間)024
       apcaud025 LIKE apca_t.apcaud025, #自定義欄位(日期時間)025
       apcaud026 LIKE apca_t.apcaud026, #自定義欄位(日期時間)026
       apcaud027 LIKE apca_t.apcaud027, #自定義欄位(日期時間)027
       apcaud028 LIKE apca_t.apcaud028, #自定義欄位(日期時間)028
       apcaud029 LIKE apca_t.apcaud029, #自定義欄位(日期時間)029
       apcaud030 LIKE apca_t.apcaud030, #自定義欄位(日期時間)030
       apca067   LIKE apca_t.apca067, #管理品類
       apca068   LIKE apca_t.apca068, #經營方式
       apca069   LIKE apca_t.apca069, #no use
       apca070   LIKE apca_t.apca070, #no use
       apca071   LIKE apca_t.apca071, #no use
       apca072   LIKE apca_t.apca072, #no use
       apca073   LIKE apca_t.apca073  #L/C No.
           END RECORD
#161104-00024#5-add(e)
DEFINE l_desc   LIKE type_t.chr1000
DEFINE ls_js            STRING   
DEFINE lc_param_apca    RECORD
         apcald         LIKE apca_t.apcald,
         apcacomp       LIKE apca_t.apcacomp,
         apcasite       LIKE apca_t.apcasite,
         apcadocdt      LIKE apca_t.apcadocdt,
         apca001        LIKE apca_t.apca001,
         apca004        LIKE apca_t.apca004,
         ooef019        LIKE ooef_t.ooef019
                        END RECORD
DEFINE lc_param_info    RECORD
            apca005        LIKE apca_t.apca005,
            apca005_desc   LIKE type_t.chr80,
            apca006        LIKE apca_t.apca006,    #供應商分類
            apca007        LIKE apca_t.apca007,
            apca007_desc   LIKE type_t.chr80,
            apca008        LIKE apca_t.apca008,
            apca008_desc   LIKE type_t.chr80,
            apca009        LIKE apca_t.apca009,
            apca010        LIKE apca_t.apca010,
            apca011        LIKE apca_t.apca011,
            apca011_desc   LIKE type_t.chr80,
            apca012        LIKE apca_t.apca012,
            apca013        LIKE apca_t.apca013,
            apca014        LIKE apca_t.apca014,
            apca014_desc   LIKE type_t.chr80,
            apca015        LIKE apca_t.apca015,
            apca015_desc   LIKE type_t.chr80,
            apca034        LIKE apca_t.apca034,
            apca034_desc   LIKE type_t.chr80,
            apca035        LIKE apca_t.apca035,
            apca035_desc   LIKE type_t.chr80,
            apca036        LIKE apca_t.apca036,
            apca036_desc   LIKE type_t.chr80,
            apca046        LIKE apca_t.apca046,
            apca054        LIKE apca_t.apca054,
            apca054_desc   LIKE type_t.chr80,
            apca055        LIKE apca_t.apca055,
            apca055_desc   LIKE type_t.chr80,
            apca056        LIKE apca_t.apca056,
            apca058        LIKE apca_t.apca058,
            apca058_desc   LIKE type_t.chr80,
            apca060        LIKE apca_t.apca060,
            apca100        LIKE apca_t.apca100,
            apca101        LIKE apca_t.apca101,
            apca121        LIKE apca_t.apca121,
            apca131        LIKE apca_t.apca131
                       END RECORD
   DEFINE lc_param2        RECORD
         type           LIKE type_t.chr1,       #類型
         apca004        LIKE apca_t.apca004,
         sfin2009       LIKE type_t.chr1        #汇率基本    
         END RECORD
   #DEFINE l_apga    RECORD LIKE apga_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apga  RECORD  #信用狀申請單主檔
          apgaent   LIKE apga_t.apgaent, #企業編號
          apgaownid LIKE apga_t.apgaownid, #資料所有者
          apgaowndp LIKE apga_t.apgaowndp, #資料所屬部門
          apgacrtid LIKE apga_t.apgacrtid, #資料建立者
          apgacrtdp LIKE apga_t.apgacrtdp, #資料建立部門
          apgacrtdt LIKE apga_t.apgacrtdt, #資料創建日
          apgamodid LIKE apga_t.apgamodid, #資料修改者
          apgamoddt LIKE apga_t.apgamoddt, #最近修改日
          apgacnfid LIKE apga_t.apgacnfid, #資料確認者
          apgacnfdt LIKE apga_t.apgacnfdt, #資料確認日
          apgapstid LIKE apga_t.apgapstid, #資料過帳者
          apgapstdt LIKE apga_t.apgapstdt, #資料過帳日
          apgastus  LIKE apga_t.apgastus, #狀態碼
          apgacomp  LIKE apga_t.apgacomp, #法人
          apgadocno LIKE apga_t.apgadocno, #申請單號
          apgadocdt LIKE apga_t.apgadocdt, #申請日期
          apga001   LIKE apga_t.apga001, #L/C NO
          apga002   LIKE apga_t.apga002, #版次
          apga003   LIKE apga_t.apga003, #開狀日期
          apga004   LIKE apga_t.apga004, #供應商(受益人)
          apga005   LIKE apga_t.apga005, #業務人員
          apga006   LIKE apga_t.apga006, #付款類型
          apga007   LIKE apga_t.apga007, #開狀銀行
          apga008   LIKE apga_t.apga008, #信用狀類別
          apga009   LIKE apga_t.apga009, #保兌信用狀否
          apga010   LIKE apga_t.apga010, #信用狀有效日期
          apga011   LIKE apga_t.apga011, #許可證號
          apga012   LIKE apga_t.apga012, #承兌日期
          apga013   LIKE apga_t.apga013, #保兌費用支付方
          apga014   LIKE apga_t.apga014, #可否分批交運
          apga015   LIKE apga_t.apga015, #自備款比率
          apga016   LIKE apga_t.apga016, #融資利率
          apga017   LIKE apga_t.apga017, #融資天數
          apga018   LIKE apga_t.apga018, #融資合約編號
          apga019   LIKE apga_t.apga019, #最後裝運日
          apga020   LIKE apga_t.apga020, #運送方式
          apga021   LIKE apga_t.apga021, #裝載港/機場
          apga022   LIKE apga_t.apga022, #卸載港/機場
          apga023   LIKE apga_t.apga023, #E.T.D
          apga024   LIKE apga_t.apga024, #E.T.A
          apga025   LIKE apga_t.apga025, #備註
          apga026   LIKE apga_t.apga026, #開狀時支付自備款
          apga027   LIKE apga_t.apga027, #NO USE
          apga028   LIKE apga_t.apga028, #帳務單號
          apga029   LIKE apga_t.apga029, #結案否
          apga030   LIKE apga_t.apga030, #通知銀行
          apga031   LIKE apga_t.apga031, #開狀時支付自備款
          apga100   LIKE apga_t.apga100, #幣別
          apga101   LIKE apga_t.apga101, #開狀匯率
          apga103   LIKE apga_t.apga103, #開狀原幣金額
          apga104   LIKE apga_t.apga104, #自備款原幣金額
          apga105   LIKE apga_t.apga105, #融資原幣金額
          apga106   LIKE apga_t.apga106, #到單原幣金額
          apga107   LIKE apga_t.apga107, #到貨原幣金額
          apga108   LIKE apga_t.apga108, #保證金原幣金額
          apga113   LIKE apga_t.apga113, #開狀本幣金額
          apga114   LIKE apga_t.apga114, #自備款本幣金額
          apga115   LIKE apga_t.apga115, #融資本幣金額
          apgaud001 LIKE apga_t.apgaud001, #自定義欄位(文字)001
          apgaud002 LIKE apga_t.apgaud002, #自定義欄位(文字)002
          apgaud003 LIKE apga_t.apgaud003, #自定義欄位(文字)003
          apgaud004 LIKE apga_t.apgaud004, #自定義欄位(文字)004
          apgaud005 LIKE apga_t.apgaud005, #自定義欄位(文字)005
          apgaud006 LIKE apga_t.apgaud006, #自定義欄位(文字)006
          apgaud007 LIKE apga_t.apgaud007, #自定義欄位(文字)007
          apgaud008 LIKE apga_t.apgaud008, #自定義欄位(文字)008
          apgaud009 LIKE apga_t.apgaud009, #自定義欄位(文字)009
          apgaud010 LIKE apga_t.apgaud010, #自定義欄位(文字)010
          apgaud011 LIKE apga_t.apgaud011, #自定義欄位(數字)011
          apgaud012 LIKE apga_t.apgaud012, #自定義欄位(數字)012
          apgaud013 LIKE apga_t.apgaud013, #自定義欄位(數字)013
          apgaud014 LIKE apga_t.apgaud014, #自定義欄位(數字)014
          apgaud015 LIKE apga_t.apgaud015, #自定義欄位(數字)015
          apgaud016 LIKE apga_t.apgaud016, #自定義欄位(數字)016
          apgaud017 LIKE apga_t.apgaud017, #自定義欄位(數字)017
          apgaud018 LIKE apga_t.apgaud018, #自定義欄位(數字)018
          apgaud019 LIKE apga_t.apgaud019, #自定義欄位(數字)019
          apgaud020 LIKE apga_t.apgaud020, #自定義欄位(數字)020
          apgaud021 LIKE apga_t.apgaud021, #自定義欄位(日期時間)021
          apgaud022 LIKE apga_t.apgaud022, #自定義欄位(日期時間)022
          apgaud023 LIKE apga_t.apgaud023, #自定義欄位(日期時間)023
          apgaud024 LIKE apga_t.apgaud024, #自定義欄位(日期時間)024
          apgaud025 LIKE apga_t.apgaud025, #自定義欄位(日期時間)025
          apgaud026 LIKE apga_t.apgaud026, #自定義欄位(日期時間)026
          apgaud027 LIKE apga_t.apgaud027, #自定義欄位(日期時間)027
          apgaud028 LIKE apga_t.apgaud028, #自定義欄位(日期時間)028
          apgaud029 LIKE apga_t.apgaud029, #自定義欄位(日期時間)029
          apgaud030 LIKE apga_t.apgaud030, #自定義欄位(日期時間)030
          apga102   LIKE apga_t.apga102, #預付款原幣金額
          apga109   LIKE apga_t.apga109, #初開狀原幣金額
          apga112   LIKE apga_t.apga112, #預付款本幣金額
          apga117   LIKE apga_t.apga117, #到貨本幣金額
          apga118   LIKE apga_t.apga118, #保證金本幣金額
          apga032   LIKE apga_t.apga032, #保證金待抵單號
          apga033   LIKE apga_t.apga033, #預付款待抵單號
          apga034   LIKE apga_t.apga034, #保證金存提碼
          apga035   LIKE apga_t.apga035, #保證金現變碼
          apga040   LIKE apga_t.apga040, #支付帳戶
          apga041   LIKE apga_t.apga041, #多幣別採購單
          apga036   LIKE apga_t.apga036, #自備款存提碼
          apga037   LIKE apga_t.apga037, #自備款現變碼
          apga038   LIKE apga_t.apga038, #預付款存提碼
          apga039   LIKE apga_t.apga039  #預付款現變碼
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_success LIKE type_t.num5
   #DEFINE l_apgc    RECORD LIKE apgc_t.* #161104-00024#5 mark
   #DEFINE l_apcb    RECORD LIKE apcb_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgc  RECORD  #信用狀相關費用明細檔
          apgcent   LIKE apgc_t.apgcent, #企業編號
          apgccomp  LIKE apgc_t.apgccomp, #法人
          apgcdocno LIKE apgc_t.apgcdocno, #申請單號
          apgcseq   LIKE apgc_t.apgcseq, #項次
          apgc900   LIKE apgc_t.apgc900, #變更序
          apgcorga  LIKE apgc_t.apgcorga, #來源組織
          apgc001   LIKE apgc_t.apgc001, #費用編號
          apgc002   LIKE apgc_t.apgc002, #付款對象
          apgc003   LIKE apgc_t.apgc003, #付款條件
          apgc004   LIKE apgc_t.apgc004, #費用科目
          apgc005   LIKE apgc_t.apgc005, #帳款類別
          apgc006   LIKE apgc_t.apgc006, #稅別
          apgc007   LIKE apgc_t.apgc007, #發票類型
          apgc008   LIKE apgc_t.apgc008, #發票編號
          apgc009   LIKE apgc_t.apgc009, #發票號碼
          apgc010   LIKE apgc_t.apgc010, #發票日期
          apgc011   LIKE apgc_t.apgc011, #可扣抵編號
          apgc012   LIKE apgc_t.apgc012, #應付單號
          apgc013   LIKE apgc_t.apgc013, #費用來源
          apgc014   LIKE apgc_t.apgc014, #付款帳戶
          apgc015   LIKE apgc_t.apgc015, #存提碼
          apgc016   LIKE apgc_t.apgc016, #現金變動碼
          apgc100   LIKE apgc_t.apgc100, #幣別
          apgc101   LIKE apgc_t.apgc101, #匯率
          apgc103   LIKE apgc_t.apgc103, #原幣未稅金額
          apgc104   LIKE apgc_t.apgc104, #稅額
          apgc105   LIKE apgc_t.apgc105, #原幣含稅金額
          apgc113   LIKE apgc_t.apgc113, #本幣未稅金額
          apgc114   LIKE apgc_t.apgc114, #本幣稅額
          apgc115   LIKE apgc_t.apgc115, #本幣含稅金額
          apgcud001 LIKE apgc_t.apgcud001, #自定義欄位(文字)001
          apgcud002 LIKE apgc_t.apgcud002, #自定義欄位(文字)002
          apgcud003 LIKE apgc_t.apgcud003, #自定義欄位(文字)003
          apgcud004 LIKE apgc_t.apgcud004, #自定義欄位(文字)004
          apgcud005 LIKE apgc_t.apgcud005, #自定義欄位(文字)005
          apgcud006 LIKE apgc_t.apgcud006, #自定義欄位(文字)006
          apgcud007 LIKE apgc_t.apgcud007, #自定義欄位(文字)007
          apgcud008 LIKE apgc_t.apgcud008, #自定義欄位(文字)008
          apgcud009 LIKE apgc_t.apgcud009, #自定義欄位(文字)009
          apgcud010 LIKE apgc_t.apgcud010, #自定義欄位(文字)010
          apgcud011 LIKE apgc_t.apgcud011, #自定義欄位(數字)011
          apgcud012 LIKE apgc_t.apgcud012, #自定義欄位(數字)012
          apgcud013 LIKE apgc_t.apgcud013, #自定義欄位(數字)013
          apgcud014 LIKE apgc_t.apgcud014, #自定義欄位(數字)014
          apgcud015 LIKE apgc_t.apgcud015, #自定義欄位(數字)015
          apgcud016 LIKE apgc_t.apgcud016, #自定義欄位(數字)016
          apgcud017 LIKE apgc_t.apgcud017, #自定義欄位(數字)017
          apgcud018 LIKE apgc_t.apgcud018, #自定義欄位(數字)018
          apgcud019 LIKE apgc_t.apgcud019, #自定義欄位(數字)019
          apgcud020 LIKE apgc_t.apgcud020, #自定義欄位(數字)020
          apgcud021 LIKE apgc_t.apgcud021, #自定義欄位(日期時間)021
          apgcud022 LIKE apgc_t.apgcud022, #自定義欄位(日期時間)022
          apgcud023 LIKE apgc_t.apgcud023, #自定義欄位(日期時間)023
          apgcud024 LIKE apgc_t.apgcud024, #自定義欄位(日期時間)024
          apgcud025 LIKE apgc_t.apgcud025, #自定義欄位(日期時間)025
          apgcud026 LIKE apgc_t.apgcud026, #自定義欄位(日期時間)026
          apgcud027 LIKE apgc_t.apgcud027, #自定義欄位(日期時間)027
          apgcud028 LIKE apgc_t.apgcud028, #自定義欄位(日期時間)028
          apgcud029 LIKE apgc_t.apgcud029, #自定義欄位(日期時間)029
          apgcud030 LIKE apgc_t.apgcud030  #自定義欄位(日期時間)030
              END RECORD
   DEFINE l_apcb  RECORD  #應付憑單單身
          apcbent   LIKE apcb_t.apcbent, #企業編號
          apcbld    LIKE apcb_t.apcbld, #帳套
          apcblegl  LIKE apcb_t.apcblegl, #核算組織
          apcborga  LIKE apcb_t.apcborga, #帳務歸屬組織(來源組織)
          apcbsite  LIKE apcb_t.apcbsite, #應付帳務組織
          apcbdocno LIKE apcb_t.apcbdocno, #單號
          apcbseq   LIKE apcb_t.apcbseq, #項次
          apcb001   LIKE apcb_t.apcb001, #來源類型
          apcb002   LIKE apcb_t.apcb002, #來源業務單據號碼
          apcb003   LIKE apcb_t.apcb003, #來源業務單據項次
          apcb004   LIKE apcb_t.apcb004, #產品編號
          apcb005   LIKE apcb_t.apcb005, #品名規格
          apcb006   LIKE apcb_t.apcb006, #單位
          apcb007   LIKE apcb_t.apcb007, #計價數量
          apcb008   LIKE apcb_t.apcb008, #參考單據號碼
          apcb009   LIKE apcb_t.apcb009, #參考單據項次
          apcb010   LIKE apcb_t.apcb010, #業務部門
          apcb011   LIKE apcb_t.apcb011, #責任中心
          apcb012   LIKE apcb_t.apcb012, #產品類別
          apcb013   LIKE apcb_t.apcb013, #搭贈
          apcb014   LIKE apcb_t.apcb014, #理由碼
          apcb015   LIKE apcb_t.apcb015, #專案編號
          apcb016   LIKE apcb_t.apcb016, #WBS編號
          apcb017   LIKE apcb_t.apcb017, #預算細項
          apcb018   LIKE apcb_t.apcb018, #专柜编号
          apcb019   LIKE apcb_t.apcb019, #開票性質
          apcb020   LIKE apcb_t.apcb020, #稅別
          apcb021   LIKE apcb_t.apcb021, #費用會計科目
          apcb022   LIKE apcb_t.apcb022, #正負值
          apcb023   LIKE apcb_t.apcb023, #沖暫估單否
          apcb024   LIKE apcb_t.apcb024, #區域
          apcb025   LIKE apcb_t.apcb025, #傳票號碼
          apcb026   LIKE apcb_t.apcb026, #傳票項次
          apcb027   LIKE apcb_t.apcb027, #發票編號
          apcb028   LIKE apcb_t.apcb028, #發票號碼
          apcb029   LIKE apcb_t.apcb029, #應付帳款科目
          apcb030   LIKE apcb_t.apcb030, #付款條件
          apcb032   LIKE apcb_t.apcb032, #訂金序次
          apcb033   LIKE apcb_t.apcb033, #經營方式
          apcb034   LIKE apcb_t.apcb034, #通路
          apcb035   LIKE apcb_t.apcb035, #品牌
          apcb036   LIKE apcb_t.apcb036, #客群
          apcb037   LIKE apcb_t.apcb037, #自由核算項一
          apcb038   LIKE apcb_t.apcb038, #自由核算項二
          apcb039   LIKE apcb_t.apcb039, #自由核算項三
          apcb040   LIKE apcb_t.apcb040, #自由核算項四
          apcb041   LIKE apcb_t.apcb041, #自由核算項五
          apcb042   LIKE apcb_t.apcb042, #自由核算項六
          apcb043   LIKE apcb_t.apcb043, #自由核算項七
          apcb044   LIKE apcb_t.apcb044, #自由核算項八
          apcb045   LIKE apcb_t.apcb045, #自由核算項九
          apcb046   LIKE apcb_t.apcb046, #自由核算項十
          apcb047   LIKE apcb_t.apcb047, #摘要
          apcb048   LIKE apcb_t.apcb048, #來源訂購單號
          apcb049   LIKE apcb_t.apcb049, #開票單號
          apcb050   LIKE apcb_t.apcb050, #開票項次
          apcb051   LIKE apcb_t.apcb051, #業務人員
          apcb100   LIKE apcb_t.apcb100, #交易原幣
          apcb101   LIKE apcb_t.apcb101, #交易原幣單價
          apcb102   LIKE apcb_t.apcb102, #原幣匯率
          apcb103   LIKE apcb_t.apcb103, #交易原幣未稅金額
          apcb104   LIKE apcb_t.apcb104, #交易原幣稅額
          apcb105   LIKE apcb_t.apcb105, #交易原幣含稅金額
          apcb106   LIKE apcb_t.apcb106, #交易幣標準成本金額
          apcb107   LIKE apcb_t.apcb107, #入庫單單價
          apcb108   LIKE apcb_t.apcb108, #交易原幣成本認列金額
          apcb111   LIKE apcb_t.apcb111, #本幣單價
          apcb113   LIKE apcb_t.apcb113, #本幣未稅金額
          apcb114   LIKE apcb_t.apcb114, #本幣稅額
          apcb115   LIKE apcb_t.apcb115, #本幣含稅金額
          apcb116   LIKE apcb_t.apcb116, #本幣標準成本金額
          apcb117   LIKE apcb_t.apcb117, #NO USE
          apcb118   LIKE apcb_t.apcb118, #本幣成本認列金額
          apcb119   LIKE apcb_t.apcb119, #應開發票含稅金額
          apcb121   LIKE apcb_t.apcb121, #本位幣二匯率
          apcb123   LIKE apcb_t.apcb123, #本位幣二未稅金額
          apcb124   LIKE apcb_t.apcb124, #本位幣二稅額
          apcb125   LIKE apcb_t.apcb125, #本位幣二含稅金額
          apcb126   LIKE apcb_t.apcb126, #本幣二標準成本金額
          apcb127   LIKE apcb_t.apcb127, #NO USE
          apcb128   LIKE apcb_t.apcb128, #本位幣二成本認列金額
          apcb131   LIKE apcb_t.apcb131, #本位幣三匯率
          apcb133   LIKE apcb_t.apcb133, #本位幣三未稅金額
          apcb134   LIKE apcb_t.apcb134, #本位幣三稅額
          apcb135   LIKE apcb_t.apcb135, #本位幣三含稅金額
          apcb136   LIKE apcb_t.apcb136, #本幣三標準成本金額
          apcb137   LIKE apcb_t.apcb137, #NO USE
          apcb138   LIKE apcb_t.apcb138, #本位幣三成本認列金額
          apcbud001 LIKE apcb_t.apcbud001, #自定義欄位(文字)001
          apcbud002 LIKE apcb_t.apcbud002, #自定義欄位(文字)002
          apcbud003 LIKE apcb_t.apcbud003, #自定義欄位(文字)003
          apcbud004 LIKE apcb_t.apcbud004, #自定義欄位(文字)004
          apcbud005 LIKE apcb_t.apcbud005, #自定義欄位(文字)005
          apcbud006 LIKE apcb_t.apcbud006, #自定義欄位(文字)006
          apcbud007 LIKE apcb_t.apcbud007, #自定義欄位(文字)007
          apcbud008 LIKE apcb_t.apcbud008, #自定義欄位(文字)008
          apcbud009 LIKE apcb_t.apcbud009, #自定義欄位(文字)009
          apcbud010 LIKE apcb_t.apcbud010, #自定義欄位(文字)010
          apcbud011 LIKE apcb_t.apcbud011, #自定義欄位(數字)011
          apcbud012 LIKE apcb_t.apcbud012, #自定義欄位(數字)012
          apcbud013 LIKE apcb_t.apcbud013, #自定義欄位(數字)013
          apcbud014 LIKE apcb_t.apcbud014, #自定義欄位(數字)014
          apcbud015 LIKE apcb_t.apcbud015, #自定義欄位(數字)015
          apcbud016 LIKE apcb_t.apcbud016, #自定義欄位(數字)016
          apcbud017 LIKE apcb_t.apcbud017, #自定義欄位(數字)017
          apcbud018 LIKE apcb_t.apcbud018, #自定義欄位(數字)018
          apcbud019 LIKE apcb_t.apcbud019, #自定義欄位(數字)019
          apcbud020 LIKE apcb_t.apcbud020, #自定義欄位(數字)020
          apcbud021 LIKE apcb_t.apcbud021, #自定義欄位(日期時間)021
          apcbud022 LIKE apcb_t.apcbud022, #自定義欄位(日期時間)022
          apcbud023 LIKE apcb_t.apcbud023, #自定義欄位(日期時間)023
          apcbud024 LIKE apcb_t.apcbud024, #自定義欄位(日期時間)024
          apcbud025 LIKE apcb_t.apcbud025, #自定義欄位(日期時間)025
          apcbud026 LIKE apcb_t.apcbud026, #自定義欄位(日期時間)026
          apcbud027 LIKE apcb_t.apcbud027, #自定義欄位(日期時間)027
          apcbud028 LIKE apcb_t.apcbud028, #自定義欄位(日期時間)028
          apcbud029 LIKE apcb_t.apcbud029, #自定義欄位(日期時間)029
          apcbud030 LIKE apcb_t.apcbud030, #自定義欄位(日期時間)030
          apcb052   LIKE apcb_t.apcb052, #稅額
          apcb053   LIKE apcb_t.apcb053, #含稅金額
          apcb054   LIKE apcb_t.apcb054, #帳款對象
          apcb055   LIKE apcb_t.apcb055  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sql     STRING
   #DEFINE l_isam    RECORD LIKE isam_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_isam  RECORD  #進項發票主檔
          isament   LIKE isam_t.isament, #企業編號
          isamownid LIKE isam_t.isamownid, #資料所有者
          isamowndp LIKE isam_t.isamowndp, #資料所屬部門
          isamcrtid LIKE isam_t.isamcrtid, #資料建立者
          isamcrtdp LIKE isam_t.isamcrtdp, #資料建立部門
          isamcrtdt LIKE isam_t.isamcrtdt, #資料創建日
          isammodid LIKE isam_t.isammodid, #資料修改者
          isammoddt LIKE isam_t.isammoddt, #最近修改日
          isamcnfid LIKE isam_t.isamcnfid, #資料確認者
          isamcnfdt LIKE isam_t.isamcnfdt, #資料確認日
          isamstus  LIKE isam_t.isamstus, #狀態碼
          isamcomp  LIKE isam_t.isamcomp, #法人
          isamdocno LIKE isam_t.isamdocno, #收票單號
          isamseq   LIKE isam_t.isamseq, #項次
          isam001   LIKE isam_t.isam001, #發票來源
          isam002   LIKE isam_t.isam002, #開發票人
          isam004   LIKE isam_t.isam004, #帳務中心(業務組織)
          isam006   LIKE isam_t.isam006, #業務部門(登錄部門)
          isam008   LIKE isam_t.isam008, #發票類型
          isam009   LIKE isam_t.isam009, #銷方發票編號
          isam010   LIKE isam_t.isam010, #發票號碼
          isam011   LIKE isam_t.isam011, #發票日期
          isam012   LIKE isam_t.isam012, #稅別
          isam0121  LIKE isam_t.isam0121, #含稅否
          isam013   LIKE isam_t.isam013, #稅率
          isam014   LIKE isam_t.isam014, #幣別
          isam015   LIKE isam_t.isam015, #匯率
          isam016   LIKE isam_t.isam016, #購貨方名稱
          isam017   LIKE isam_t.isam017, #購貨方統一編號
          isam018   LIKE isam_t.isam018, #購貨方地址
          isam019   LIKE isam_t.isam019, #購貨方電話
          isam020   LIKE isam_t.isam020, #購貨方開戶銀行
          isam021   LIKE isam_t.isam021, #購貨方帳戶編碼
          isam022   LIKE isam_t.isam022, #銷方銀行帳戶編碼
          isam023   LIKE isam_t.isam023, #發票原幣未稅金額
          isam024   LIKE isam_t.isam024, #發票原幣稅額
          isam025   LIKE isam_t.isam025, #發票原幣含稅金額
          isam026   LIKE isam_t.isam026, #發票本幣未稅金額
          isam027   LIKE isam_t.isam027, #發票本幣稅額
          isam028   LIKE isam_t.isam028, #發票本幣含稅金額
          isam029   LIKE isam_t.isam029, #銷貨方名稱
          isam030   LIKE isam_t.isam030, #統一編號
          isam031   LIKE isam_t.isam031, #銷貨方地址
          isam032   LIKE isam_t.isam032, #銷貨方電話
          isam033   LIKE isam_t.isam033, #銷貨方開戶銀行
          isam034   LIKE isam_t.isam034, #銷貨方帳號
          isam035   LIKE isam_t.isam035, #申報數量
          isam036   LIKE isam_t.isam036, #異動狀態
          isam037   LIKE isam_t.isam037, #可扣抵編號
          isam038   LIKE isam_t.isam038, #作廢(註銷)理由碼
          isam039   LIKE isam_t.isam039, #作廢日期
          isam040   LIKE isam_t.isam040, #作廢時間
          isam041   LIKE isam_t.isam041, #作廢人員
          isam042   LIKE isam_t.isam042, #專案作廢核准文號
          isam043   LIKE isam_t.isam043, #通關方式註記
          isam044   LIKE isam_t.isam044, #列印次數
          isam045   LIKE isam_t.isam045, #支付工具卡號1
          isam046   LIKE isam_t.isam046, #支付工具卡號2
          isam047   LIKE isam_t.isam047, #支付工具卡號3
          isam048   LIKE isam_t.isam048, #通關註記
          isam049   LIKE isam_t.isam049, #備註說明
          isam050   LIKE isam_t.isam050, #立帳單號
          isam107   LIKE isam_t.isam107, #發票原幣已折金額
          isam108   LIKE isam_t.isam108, #發票原幣已折稅額
          isam117   LIKE isam_t.isam117, #發票本幣已折金額
          isam118   LIKE isam_t.isam118, #發票本幣已折稅額
          isam200   LIKE isam_t.isam200, #電子發票否
          isam201   LIKE isam_t.isam201, #愛心碼
          isam202   LIKE isam_t.isam202, #載具類別號碼
          isam203   LIKE isam_t.isam203, #載具顯碼 ID
          isam204   LIKE isam_t.isam204, #載具隱碼 ID
          isam205   LIKE isam_t.isam205, #電子發票匯出狀態
          isam206   LIKE isam_t.isam206, #電子發票匯出序號
          isam207   LIKE isam_t.isam207, #電子發票領取方式
          isam208   LIKE isam_t.isam208, #申報年度
          isam209   LIKE isam_t.isam209, #申報月份
          isam210   LIKE isam_t.isam210, #申報據點
          isamud001 LIKE isam_t.isamud001, #自定義欄位(文字)001
          isamud002 LIKE isam_t.isamud002, #自定義欄位(文字)002
          isamud003 LIKE isam_t.isamud003, #自定義欄位(文字)003
          isamud004 LIKE isam_t.isamud004, #自定義欄位(文字)004
          isamud005 LIKE isam_t.isamud005, #自定義欄位(文字)005
          isamud006 LIKE isam_t.isamud006, #自定義欄位(文字)006
          isamud007 LIKE isam_t.isamud007, #自定義欄位(文字)007
          isamud008 LIKE isam_t.isamud008, #自定義欄位(文字)008
          isamud009 LIKE isam_t.isamud009, #自定義欄位(文字)009
          isamud010 LIKE isam_t.isamud010, #自定義欄位(文字)010
          isamud011 LIKE isam_t.isamud011, #自定義欄位(數字)011
          isamud012 LIKE isam_t.isamud012, #自定義欄位(數字)012
          isamud013 LIKE isam_t.isamud013, #自定義欄位(數字)013
          isamud014 LIKE isam_t.isamud014, #自定義欄位(數字)014
          isamud015 LIKE isam_t.isamud015, #自定義欄位(數字)015
          isamud016 LIKE isam_t.isamud016, #自定義欄位(數字)016
          isamud017 LIKE isam_t.isamud017, #自定義欄位(數字)017
          isamud018 LIKE isam_t.isamud018, #自定義欄位(數字)018
          isamud019 LIKE isam_t.isamud019, #自定義欄位(數字)019
          isamud020 LIKE isam_t.isamud020, #自定義欄位(數字)020
          isamud021 LIKE isam_t.isamud021, #自定義欄位(日期時間)021
          isamud022 LIKE isam_t.isamud022, #自定義欄位(日期時間)022
          isamud023 LIKE isam_t.isamud023, #自定義欄位(日期時間)023
          isamud024 LIKE isam_t.isamud024, #自定義欄位(日期時間)024
          isamud025 LIKE isam_t.isamud025, #自定義欄位(日期時間)025
          isamud026 LIKE isam_t.isamud026, #自定義欄位(日期時間)026
          isamud027 LIKE isam_t.isamud027, #自定義欄位(日期時間)027
          isamud028 LIKE isam_t.isamud028, #自定義欄位(日期時間)028
          isamud029 LIKE isam_t.isamud029, #自定義欄位(日期時間)029
          isamud030 LIKE isam_t.isamud030, #自定義欄位(日期時間)030
          isam051   LIKE isam_t.isam051  #認證否
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_ooef002     LIKE ooef_t.ooef002
   DEFINE l_ooefl006    LIKE ooefl_t.ooefl006
   DEFINE l_pmaal003    LIKE pmaal_t.pmaal003
   DEFINE l_isao001     LIKE isao_t.isao001
   DEFINE l_dummy1      LIKE type_t.num20_6
   #DEFINE l_apde        RECORD LIKE apde_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apde RECORD  #付款及差異處理明細檔
          apdeent   LIKE apde_t.apdeent, #企業編號
          apdecomp  LIKE apde_t.apdecomp, #法人
          apdeld    LIKE apde_t.apdeld, #帳套
          apdedocno LIKE apde_t.apdedocno, #沖銷單單號
          apdeseq   LIKE apde_t.apdeseq, #項次
          apdesite  LIKE apde_t.apdesite, #帳務中心
          apdeorga  LIKE apde_t.apdeorga, #帳務歸屬組織
          apde001   LIKE apde_t.apde001, #來源作業
          apde002   LIKE apde_t.apde002, #沖銷帳款類型
          apde003   LIKE apde_t.apde003, #已付款單號
          apde004   LIKE apde_t.apde004, #沖銷單項次
          apde006   LIKE apde_t.apde006, #款別編號
          apde008   LIKE apde_t.apde008, #帳戶/票券號碼
          apde009   LIKE apde_t.apde009, #已轉資料
          apde010   LIKE apde_t.apde010, #摘要說明
          apde011   LIKE apde_t.apde011, #銀行存提碼
          apde012   LIKE apde_t.apde012, #現金變動碼
          apde013   LIKE apde_t.apde013, #轉入客商碼
          apde014   LIKE apde_t.apde014, #轉入帳款單編號
          apde015   LIKE apde_t.apde015, #沖銷加減項
          apde016   LIKE apde_t.apde016, #沖銷會科
          apde017   LIKE apde_t.apde017, #業務人員
          apde018   LIKE apde_t.apde018, #業務部門
          apde019   LIKE apde_t.apde019, #責任中心
          apde020   LIKE apde_t.apde020, #產品類別
          apde021   LIKE apde_t.apde021, #票據類型
          apde022   LIKE apde_t.apde022, #專案編號
          apde023   LIKE apde_t.apde023, #WBS編號
          apde024   LIKE apde_t.apde024, #票據號碼
          apde028   LIKE apde_t.apde028, #產生方式
          apde029   LIKE apde_t.apde029, #傳票號碼
          apde030   LIKE apde_t.apde030, #傳票項次
          apde032   LIKE apde_t.apde032, #付款日
          apde035   LIKE apde_t.apde035, #區域
          apde036   LIKE apde_t.apde036, #客群
          apde038   LIKE apde_t.apde038, #對象
          apde039   LIKE apde_t.apde039, #受款銀行
          apde040   LIKE apde_t.apde040, #受款帳號
          apde041   LIKE apde_t.apde041, #受款人全名
          apde042   LIKE apde_t.apde042, #經營方式
          apde043   LIKE apde_t.apde043, #通路
          apde044   LIKE apde_t.apde044, #品牌
          apde045   LIKE apde_t.apde045, #摘要
          apde046   LIKE apde_t.apde046, #付款申請單
          apde047   LIKE apde_t.apde047, #付款申請單項次
          apde051   LIKE apde_t.apde051, #自由核算項一
          apde052   LIKE apde_t.apde052, #自由核算項二
          apde053   LIKE apde_t.apde053, #自由核算項三
          apde054   LIKE apde_t.apde054, #自由核算項四
          apde055   LIKE apde_t.apde055, #自由核算項五
          apde056   LIKE apde_t.apde056, #自由核算項六
          apde057   LIKE apde_t.apde057, #自由核算項七
          apde058   LIKE apde_t.apde058, #自由核算項八
          apde059   LIKE apde_t.apde059, #自由核算項九
          apde060   LIKE apde_t.apde060, #自由核算項十
          apde100   LIKE apde_t.apde100, #幣別
          apde101   LIKE apde_t.apde101, #匯率
          apde104   LIKE apde_t.apde104, #原幣應稅折抵稅額
          apde109   LIKE apde_t.apde109, #原幣沖帳金額
          apde119   LIKE apde_t.apde119, #本幣沖帳金額
          apde120   LIKE apde_t.apde120, #本位幣二幣別
          apde121   LIKE apde_t.apde121, #本位幣二匯率
          apde129   LIKE apde_t.apde129, #本位幣二沖帳金額
          apde130   LIKE apde_t.apde130, #本位幣三幣別
          apde131   LIKE apde_t.apde131, #本位幣三匯率
          apde139   LIKE apde_t.apde139, #本位幣三沖帳金額
          apdeud001 LIKE apde_t.apdeud001, #自定義欄位(文字)001
          apdeud002 LIKE apde_t.apdeud002, #自定義欄位(文字)002
          apdeud003 LIKE apde_t.apdeud003, #自定義欄位(文字)003
          apdeud004 LIKE apde_t.apdeud004, #自定義欄位(文字)004
          apdeud005 LIKE apde_t.apdeud005, #自定義欄位(文字)005
          apdeud006 LIKE apde_t.apdeud006, #自定義欄位(文字)006
          apdeud007 LIKE apde_t.apdeud007, #自定義欄位(文字)007
          apdeud008 LIKE apde_t.apdeud008, #自定義欄位(文字)008
          apdeud009 LIKE apde_t.apdeud009, #自定義欄位(文字)009
          apdeud010 LIKE apde_t.apdeud010, #自定義欄位(文字)010
          apdeud011 LIKE apde_t.apdeud011, #自定義欄位(數字)011
          apdeud012 LIKE apde_t.apdeud012, #自定義欄位(數字)012
          apdeud013 LIKE apde_t.apdeud013, #自定義欄位(數字)013
          apdeud014 LIKE apde_t.apdeud014, #自定義欄位(數字)014
          apdeud015 LIKE apde_t.apdeud015, #自定義欄位(數字)015
          apdeud016 LIKE apde_t.apdeud016, #自定義欄位(數字)016
          apdeud017 LIKE apde_t.apdeud017, #自定義欄位(數字)017
          apdeud018 LIKE apde_t.apdeud018, #自定義欄位(數字)018
          apdeud019 LIKE apde_t.apdeud019, #自定義欄位(數字)019
          apdeud020 LIKE apde_t.apdeud020, #自定義欄位(數字)020
          apdeud021 LIKE apde_t.apdeud021, #自定義欄位(日期時間)021
          apdeud022 LIKE apde_t.apdeud022, #自定義欄位(日期時間)022
          apdeud023 LIKE apde_t.apdeud023, #自定義欄位(日期時間)023
          apdeud024 LIKE apde_t.apdeud024, #自定義欄位(日期時間)024
          apdeud025 LIKE apde_t.apdeud025, #自定義欄位(日期時間)025
          apdeud026 LIKE apde_t.apdeud026, #自定義欄位(日期時間)026
          apdeud027 LIKE apde_t.apdeud027, #自定義欄位(日期時間)027
          apdeud028 LIKE apde_t.apdeud028, #自定義欄位(日期時間)028
          apdeud029 LIKE apde_t.apdeud029, #自定義欄位(日期時間)029
          apdeud030 LIKE apde_t.apdeud030, #自定義欄位(日期時間)030
          apde061   LIKE apde_t.apde061  #應付來源
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_pmab055     LIKE pmab_t.pmab055
   DEFINE l_glaa121     LIKE glaa_t.glaa121
   DEFINE l_glaa016     LIKE glaa_t.glaa016
   DEFINE l_glaa020     LIKE glaa_t.glaa020
   DEFINE l_glaa019     LIKE glaa_t.glaa019
   DEFINE l_glaa015     LIKE glaa_t.glaa015
   DEFINE l_glaa001     LIKE glaa_t.glaa001
   #DEFINE l_apgk        RECORD LIKE apgk_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgk  RECORD  #外購到單主檔
          apgkent   LIKE apgk_t.apgkent, #企業編號
          apgkownid LIKE apgk_t.apgkownid, #資料所有者
          apgkowndp LIKE apgk_t.apgkowndp, #資料所屬部門
          apgkcrtid LIKE apgk_t.apgkcrtid, #資料建立者
          apgkcrtdp LIKE apgk_t.apgkcrtdp, #資料建立部門
          apgkcrtdt LIKE apgk_t.apgkcrtdt, #資料創建日
          apgkmodid LIKE apgk_t.apgkmodid, #資料修改者
          apgkmoddt LIKE apgk_t.apgkmoddt, #最近修改日
          apgkcnfid LIKE apgk_t.apgkcnfid, #資料確認者
          apgkcnfdt LIKE apgk_t.apgkcnfdt, #資料確認日
          apgkpstid LIKE apgk_t.apgkpstid, #資料過帳者
          apgkpstdt LIKE apgk_t.apgkpstdt, #資料過帳日
          apgkstus  LIKE apgk_t.apgkstus, #狀態碼
          apgkcomp  LIKE apgk_t.apgkcomp, #法人
          apgkdocno LIKE apgk_t.apgkdocno, #到單單號
          apgkdocdt LIKE apgk_t.apgkdocdt, #到單日期
          apgk001   LIKE apgk_t.apgk001, #供應商編號
          apgk002   LIKE apgk_t.apgk002, #付款類型
          apgk003   LIKE apgk_t.apgk003, #L/C NO
          apgk004   LIKE apgk_t.apgk004, #業務人員
          apgk005   LIKE apgk_t.apgk005, #申請單號
          apgk006   LIKE apgk_t.apgk006, #押匯日期
          apgk007   LIKE apgk_t.apgk007, #融資天數
          apgk008   LIKE apgk_t.apgk008, #融資應還款日期
          apgk009   LIKE apgk_t.apgk009, #融資合約編號
          apgk010   LIKE apgk_t.apgk010, #融資到帳單號
          apgk011   LIKE apgk_t.apgk011, #自備款應付到期日
          apgk012   LIKE apgk_t.apgk012, #應付待抵單號
          apgk013   LIKE apgk_t.apgk013, #裝運單號
          apgk014   LIKE apgk_t.apgk014, #到貨單號
          apgk015   LIKE apgk_t.apgk015, #到單核銷
          apgk100   LIKE apgk_t.apgk100, #幣別
          apgk101   LIKE apgk_t.apgk101, #還款匯率
          apgk103   LIKE apgk_t.apgk103, #押匯原幣金額
          apgk113   LIKE apgk_t.apgk113, #押匯本幣金額
          apgk114   LIKE apgk_t.apgk114, #應攤還自備款本幣
          apgkud001 LIKE apgk_t.apgkud001, #自定義欄位(文字)001
          apgkud002 LIKE apgk_t.apgkud002, #自定義欄位(文字)002
          apgkud003 LIKE apgk_t.apgkud003, #自定義欄位(文字)003
          apgkud004 LIKE apgk_t.apgkud004, #自定義欄位(文字)004
          apgkud005 LIKE apgk_t.apgkud005, #自定義欄位(文字)005
          apgkud006 LIKE apgk_t.apgkud006, #自定義欄位(文字)006
          apgkud007 LIKE apgk_t.apgkud007, #自定義欄位(文字)007
          apgkud008 LIKE apgk_t.apgkud008, #自定義欄位(文字)008
          apgkud009 LIKE apgk_t.apgkud009, #自定義欄位(文字)009
          apgkud010 LIKE apgk_t.apgkud010, #自定義欄位(文字)010
          apgkud011 LIKE apgk_t.apgkud011, #自定義欄位(數字)011
          apgkud012 LIKE apgk_t.apgkud012, #自定義欄位(數字)012
          apgkud013 LIKE apgk_t.apgkud013, #自定義欄位(數字)013
          apgkud014 LIKE apgk_t.apgkud014, #自定義欄位(數字)014
          apgkud015 LIKE apgk_t.apgkud015, #自定義欄位(數字)015
          apgkud016 LIKE apgk_t.apgkud016, #自定義欄位(數字)016
          apgkud017 LIKE apgk_t.apgkud017, #自定義欄位(數字)017
          apgkud018 LIKE apgk_t.apgkud018, #自定義欄位(數字)018
          apgkud019 LIKE apgk_t.apgkud019, #自定義欄位(數字)019
          apgkud020 LIKE apgk_t.apgkud020, #自定義欄位(數字)020
          apgkud021 LIKE apgk_t.apgkud021, #自定義欄位(日期時間)021
          apgkud022 LIKE apgk_t.apgkud022, #自定義欄位(日期時間)022
          apgkud023 LIKE apgk_t.apgkud023, #自定義欄位(日期時間)023
          apgkud024 LIKE apgk_t.apgkud024, #自定義欄位(日期時間)024
          apgkud025 LIKE apgk_t.apgkud025, #自定義欄位(日期時間)025
          apgkud026 LIKE apgk_t.apgkud026, #自定義欄位(日期時間)026
          apgkud027 LIKE apgk_t.apgkud027, #自定義欄位(日期時間)027
          apgkud028 LIKE apgk_t.apgkud028, #自定義欄位(日期時間)028
          apgkud029 LIKE apgk_t.apgkud029, #自定義欄位(日期時間)029
          apgkud030 LIKE apgk_t.apgkud030, #自定義欄位(日期時間)030
          apgk104   LIKE apgk_t.apgk104, #應攤還自備款原幣金額
          apgk016   LIKE apgk_t.apgk016, #支付帳戶
          apgk017   LIKE apgk_t.apgk017, #存提碼
          apgk018   LIKE apgk_t.apgk018, #現金變動碼
          apgk019   LIKE apgk_t.apgk019  #融資還款單號
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_docno       LIKE apga_t.apgadocno
   DEFINE l_date        DATETIME YEAR TO SECOND
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   DEFINE l_apcb113sum  LIKE type_t.num20_6
   DEFINE l_apcb114sum  LIKE type_t.num20_6
   DEFINE l_apcb115sum  LIKE type_t.num20_6
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   DEFINE l_oodb004     LIKE oodb_t.oodb004
   DEFINE l_apca013     LIKE apca_t.apca013
   DEFINE l_apca012     LIKE apca_t.apca012
   DEFINE l_oodb011     LIKE oodb_t.oodb011
   DEFINE l_count       LIKE type_t.num10
   DEFINE l_xrcd009     LIKE xrcd_t.xrcd009
   DEFINE l_ooef011     LIKE ooef_t.ooef011 #161129-00042#1-add
   DEFINE l_isac004     LIKE isac_t.isac004 #161230-00036#1-add
   DEFINE l_isac008     LIKE isac_t.isac008 #161230-00036#1-add
   DEFINE l_vat_id      STRING              #161230-00036#1-add
   WHENEVER ERROR CONTINUE
   
   LET r_success = TRUE
   LET r_docno   = NULL
   INITIALIZE l_apgk.* TO NULL
   #SELECT * INTO l_apgk.* FROM apgk_t WHERE apgkent = g_enterprise AND apgkcomp = g_apcacomp AND apgkdocno = g_apca_m.apca018 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgkent,apgkownid,apgkowndp,apgkcrtid,apgkcrtdp,
          apgkcrtdt,apgkmodid,apgkmoddt,apgkcnfid,apgkcnfdt,
          apgkpstid,apgkpstdt,apgkstus,apgkcomp,apgkdocno,
          apgkdocdt,apgk001,apgk002,apgk003,apgk004,
          apgk005,apgk006,apgk007,apgk008,apgk009,
          apgk010,apgk011,apgk012,apgk013,apgk014,
          apgk015,apgk100,apgk101,apgk103,apgk113,
          apgk114,apgkud001,apgkud002,apgkud003,apgkud004,
          apgkud005,apgkud006,apgkud007,apgkud008,apgkud009,
          apgkud010,apgkud011,apgkud012,apgkud013,apgkud014,
          apgkud015,apgkud016,apgkud017,apgkud018,apgkud019,
          apgkud020,apgkud021,apgkud022,apgkud023,apgkud024,
          apgkud025,apgkud026,apgkud027,apgkud028,apgkud029,
          apgkud030,apgk104,apgk016,apgk017,apgk018,
          apgk019 
     INTO l_apgk.* 
     FROM apgk_t 
    WHERE apgkent = g_enterprise
      AND apgkcomp = g_apcacomp 
      AND apgkdocno = g_apca_m.apca018
   #161208-00026#13-add(e)
   INITIALIZE l_apga.* TO NULL
   #SELECT * INTO l_apga.* FROM apga_t WHERE apgaent = g_enterprise AND apgacomp = g_apcacomp AND apgadocno = l_apgk.apgk005 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgaent,apgaownid,apgaowndp,apgacrtid,apgacrtdp,
          apgacrtdt,apgamodid,apgamoddt,apgacnfid,apgacnfdt,
          apgapstid,apgapstdt,apgastus,apgacomp,apgadocno,
          apgadocdt,apga001,apga002,apga003,apga004,
          apga005,apga006,apga007,apga008,apga009,
          apga010,apga011,apga012,apga013,apga014,
          apga015,apga016,apga017,apga018,apga019,
          apga020,apga021,apga022,apga023,apga024,
          apga025,apga026,apga027,apga028,apga029,
          apga030,apga031,apga100,apga101,apga103,
          apga104,apga105,apga106,apga107,apga108,
          apga113,apga114,apga115,apgaud001,apgaud002,
          apgaud003,apgaud004,apgaud005,apgaud006,apgaud007,
          apgaud008,apgaud009,apgaud010,apgaud011,apgaud012,
          apgaud013,apgaud014,apgaud015,apgaud016,apgaud017,
          apgaud018,apgaud019,apgaud020,apgaud021,apgaud022,
          apgaud023,apgaud024,apgaud025,apgaud026,apgaud027,
          apgaud028,apgaud029,apgaud030,apga102,apga109,
          apga112,apga117,apga118,apga032,apga033,
          apga034,apga035,apga040,apga041,apga036,
          apga037,apga038,apga039 
     INTO l_apga.* 
     FROM apga_t 
    WHERE apgaent = g_enterprise 
      AND apgacomp = g_apcacomp 
      AND apgadocno = l_apgk.apgk005
   #161208-00026#13-add(e)
   INITIALIZE l_apca.* TO NULL
   LET l_apca.apcaent = g_enterprise
   LET l_apca.apcacomp = l_apga.apgacomp
   LET l_apca.apcald = NULL
   SELECT glaald,glaa001,glaa016,glaa020
     INTO l_apca.apcald,l_apca.apca100,l_apca.apca120,l_apca.apca130
     FROM glaa_t
    WHERE glaaent  = g_enterprise
      AND glaacomp = l_apca.apcacomp
      AND glaa014  = 'Y'
   LET l_apca.apcadocdt = g_apca_m.apcadocdt
   LET l_apca.apca003   = g_apca_m.apca003
   LET l_apca.apca016   = g_apca_m.apca016
   LET l_apca.apca018   = g_apca_m.apca018
   LET l_apca.apcadocno = g_apca_m.apcadocno
   CALL s_aooi200_fin_gen_docno(l_apca.apcald,'','',l_apca.apcadocno,l_apca.apcadocdt,'aapt560') 
      RETURNING g_sub_success,l_apca.apcadocno                                            
   IF NOT g_sub_success THEN
      LET r_success = FALSE
      RETURN r_success,r_docno
   END IF
   LET l_apca.apcastus  = 'N' # 狀態碼 
   LET l_apca.apcasite = l_apca.apcacomp   # 帳務中心                            apcasite   = apgccomp                                                    
   LET l_apca.apca001 =  '31'   #s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3001')
   LET l_apca.apca003 = g_user # 帳務人員                            apca003    = g_user                                                      
   LET l_apca.apca004 = l_apga.apga004 # 帳款對象編號                        apca004    = 廠商(受益人)apga004   
   CALL s_apmm100_sel_pmac002(l_apca.apca004,'1') RETURNING l_apca.apca005,l_desc
   IF cl_null(l_apca.apca005)THEN LET l_apca.apca005 = l_apca.apca004 END IF
   SELECT pmaa080,pmaa047 INTO l_apca.apca006,l_apca.apca046
     FROM pmaa_t
    WHERE pmaaent = g_enterprise AND pmaa001 = l_apca.apca004
   LET lc_param_apca.apcald   = l_apca.apcald
   LET lc_param_apca.apcacomp = l_apca.apcacomp
   LET lc_param_apca.apcasite = l_apca.apcasite
   LET lc_param_apca.apcadocdt= l_apca.apcadocdt
   LET lc_param_apca.apca001  = '19' #l_apca.apca001
   LET lc_param_apca.apca004  = l_apca.apca004
   SELECT ooef019 INTO lc_param_apca.ooef019 FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = l_apca.apcacomp
   LET ls_js = util.JSON.stringify(lc_param_apca)
   CALL s_aapt300_get_apca004_info(ls_js) RETURNING ls_js
   CALL util.JSON.parse(ls_js,lc_param_info)
   LET l_apca.apca006 = lc_param_info.apca006  
   LET l_apca.apca007 = lc_param_info.apca007   # 帳款類別           apca007    = 廠商慣用條件
   LET l_apca.apca008 = lc_param_info.apca008   # 付款條件編號       apca008    = 取交易對象慣用付款條件
   LET l_apca.apca009 = lc_param_info.apca009   # 應付款日/應扣抵日  apca009    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca010 = lc_param_info.apca010   # 容許票據到期日     apca010    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca011 = lc_param_info.apca011   # 稅別               apca011    = 取交易對象慣用稅別,實際稅別在單身呈現
   LET l_apca.apca012 = lc_param_info.apca012   # 稅率               apca012    = 依稅別串 oodb006
   LET l_apca.apca013 = lc_param_info.apca013   # 含稅否             apca013    = 依稅別串 oodb005                   
   LET l_apca.apca014 = l_apga.apga005          # 人員編號           apca014    = apga005
   LET l_apca.apca015 = NULL                    # 部門編號           apca015    = apga005 所屬部門
   SELECT ooag003 INTO l_apca.apca015 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apca.apca014 
   LET l_apca.apca034 = lc_param_info.apca034   # 責任中心                            apca034    = 依 aapt300原則帶出      
   LET l_apca.apca035 = lc_param_info.apca035   # 應付(貸方)科目編號                  apca035    = 依帳款類別帶出           
   LET l_apca.apca036 = lc_param_info.apca036   # 費用(借方)科目編號                  apca036    = 依帳款類別帶出     
   LET l_apca.apca046 = lc_param_info.apca046       
   LET l_apca.apca054 = lc_param_info.apca054   # 多帳期設定                          apca054    = 依付款條件取出 
   LET l_apca.apca055 = lc_param_info.apca055   # 繳款優惠條件                        apca055    = 依付款條件取出 
   LET l_apca.apca058 = lc_param_info.apca058
   LET l_apca.apca060 = lc_param_info.apca060
   LET l_apca.apca016 = '34'
   LET l_apca.apca017 = '1'
   LET l_apca.apca018 = l_apgk.apgkdocno   ##160824-00049#7 modify
   LET l_apca.apca020 = 'N'         # 信用狀付款否 
   LET l_apca.apca026 = 0
   LET l_apca.apca027 = 0
   LET l_apca.apca028 = 0
   LET l_apca.apca029 = 0
   LET l_apca.apca037 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-0030')# 產生傳票否                          apca037    = 取單別參數D-FIN-0030    
   LET l_apca.apca067 = l_apgk.apgkdocno
   LET l_apca.apca101 = 1
   LET l_apca.apca103 = 0
   LET l_apca.apca104 = 0
   LET l_apca.apca106 = 0 
   LET l_apca.apca107 = 0
   LET l_apca.apca108 = 0 
   LET l_apca.apca113 = 0
   LET l_apca.apca114 = 0 
   LET l_apca.apca116 = 0
   LEt l_apca.apca117 = 0 
   LET l_apca.apca118 = 0 
   LET lc_param2.apca004 = l_apca.apca004
   CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-3009') RETURNING lc_param2.sfin2009
   LET ls_js = util.JSON.stringify(lc_param2)   
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apca.apca100,ls_js)
        RETURNING l_apca.apca101,l_apca.apca121,l_apca.apca131
   LET l_apca.apca123 = 0
   LET l_apca.apca124 = 0
   LET l_apca.apca126 = 0 
   LET l_apca.apca127 = 0 
   LET l_apca.apca128 = 0
   LET l_apca.apca133 = 0 
   LET l_apca.apca134 = 0 
   LET l_apca.apca136 = 0 
   LET l_apca.apca137 = 0
   LET l_apca.apca138 = 0 
   LET l_apca.apca071 = 0
   LET l_apca.apca072 = 0
   #albireo 160624-----s
   LEt l_apca.apca073 = l_apga.apga001
   LET l_apca.apcaownid = g_user
   LET l_apca.apcaowndp = g_dept
   LET l_apca.apcacrtid = g_user
   LET l_apca.apcacrtdp = g_dept
   LET l_date = cl_get_current()
   LET l_apca.apcacrtdt = l_date
   #albireo 160624-----e
   #INSERT INTO apca_t VALUES(l_apca.*) #161108-00017#4 mark
   #161108-00017#4 add ------
   INSERT INTO apca_t (apcaent,apcaownid,apcaowndp,apcacrtid,apcacrtdp,
                       apcacrtdt,apcamodid,apcamoddt,apcacnfid,apcacnfdt,
                       apcapstid,apcapstdt,apcastus,apcald,apcacomp,
                       apcadocno,apcadocdt,apcasite,
                       apca001,apca003,apca004,apca005,apca006,
                       apca007,apca008,apca009,apca010,apca011,
                       apca012,apca013,apca014,apca015,apca016,
                       apca017,apca018,apca019,apca020,apca021,
                       apca022,apca025,apca026,apca027,apca028,
                       apca029,apca030,apca031,apca032,apca033,
                       apca034,apca035,apca036,apca037,apca038,
                       apca039,apca040,apca041,apca042,apca043,
                       apca044,apca045,apca046,apca047,apca048,
                       apca049,apca050,apca051,apca052,apca053,
                       apca054,apca055,apca056,apca057,apca058,
                       apca059,apca060,apca061,apca062,apca063,
                       apca064,apca065,apca066,apca100,apca101,
                       apca103,apca104,apca106,apca107,apca108,
                       apca113,apca114,apca116,apca117,apca118,
                       apca120,apca121,apca123,apca124,apca126,
                       apca127,apca128,apca130,apca131,apca133,
                       apca134,apca136,apca137,apca138,
                       apcaud001,apcaud002,apcaud003,apcaud004,apcaud005,
                       apcaud006,apcaud007,apcaud008,apcaud009,apcaud010,
                       apcaud011,apcaud012,apcaud013,apcaud014,apcaud015,
                       apcaud016,apcaud017,apcaud018,apcaud019,apcaud020,
                       apcaud021,apcaud022,apcaud023,apcaud024,apcaud025,
                       apcaud026,apcaud027,apcaud028,apcaud029,apcaud030,
                       apca067,apca068,apca069,apca070,apca071,
                       apca072,apca073
                      )
   VALUES (l_apca.apcaent,l_apca.apcaownid,l_apca.apcaowndp,l_apca.apcacrtid,l_apca.apcacrtdp,
           l_apca.apcacrtdt,l_apca.apcamodid,l_apca.apcamoddt,l_apca.apcacnfid,l_apca.apcacnfdt,
           l_apca.apcapstid,l_apca.apcapstdt,l_apca.apcastus,l_apca.apcald,l_apca.apcacomp,
           l_apca.apcadocno,l_apca.apcadocdt,l_apca.apcasite,
           l_apca.apca001,l_apca.apca003,l_apca.apca004,l_apca.apca005,l_apca.apca006,
           l_apca.apca007,l_apca.apca008,l_apca.apca009,l_apca.apca010,l_apca.apca011,
           l_apca.apca012,l_apca.apca013,l_apca.apca014,l_apca.apca015,l_apca.apca016,
           l_apca.apca017,l_apca.apca018,l_apca.apca019,l_apca.apca020,l_apca.apca021,
           l_apca.apca022,l_apca.apca025,l_apca.apca026,l_apca.apca027,l_apca.apca028,
           l_apca.apca029,l_apca.apca030,l_apca.apca031,l_apca.apca032,l_apca.apca033,
           l_apca.apca034,l_apca.apca035,l_apca.apca036,l_apca.apca037,l_apca.apca038,
           l_apca.apca039,l_apca.apca040,l_apca.apca041,l_apca.apca042,l_apca.apca043,
           l_apca.apca044,l_apca.apca045,l_apca.apca046,l_apca.apca047,l_apca.apca048,
           l_apca.apca049,l_apca.apca050,l_apca.apca051,l_apca.apca052,l_apca.apca053,
           l_apca.apca054,l_apca.apca055,l_apca.apca056,l_apca.apca057,l_apca.apca058,
           l_apca.apca059,l_apca.apca060,l_apca.apca061,l_apca.apca062,l_apca.apca063,
           l_apca.apca064,l_apca.apca065,l_apca.apca066,l_apca.apca100,l_apca.apca101,
           l_apca.apca103,l_apca.apca104,l_apca.apca106,l_apca.apca107,l_apca.apca108,
           l_apca.apca113,l_apca.apca114,l_apca.apca116,l_apca.apca117,l_apca.apca118,
           l_apca.apca120,l_apca.apca121,l_apca.apca123,l_apca.apca124,l_apca.apca126,
           l_apca.apca127,l_apca.apca128,l_apca.apca130,l_apca.apca131,l_apca.apca133,
           l_apca.apca134,l_apca.apca136,l_apca.apca137,l_apca.apca138,
           l_apca.apcaud001,l_apca.apcaud002,l_apca.apcaud003,l_apca.apcaud004,l_apca.apcaud005,
           l_apca.apcaud006,l_apca.apcaud007,l_apca.apcaud008,l_apca.apcaud009,l_apca.apcaud010,
           l_apca.apcaud011,l_apca.apcaud012,l_apca.apcaud013,l_apca.apcaud014,l_apca.apcaud015,
           l_apca.apcaud016,l_apca.apcaud017,l_apca.apcaud018,l_apca.apcaud019,l_apca.apcaud020,
           l_apca.apcaud021,l_apca.apcaud022,l_apca.apcaud023,l_apca.apcaud024,l_apca.apcaud025,
           l_apca.apcaud026,l_apca.apcaud027,l_apca.apcaud028,l_apca.apcaud029,l_apca.apcaud030,
           l_apca.apca067,l_apca.apca068,l_apca.apca069,l_apca.apca070,l_apca.apca071,
           l_apca.apca072,l_apca.apca073
          )
   #161108-00017#4 add end---
   
   #apgc產生 apcb xrcd_t
   #LET l_sql = "SELECT * FROM apgc_t ",   #161208-00026#13 mark
   #161208-00026#13-add(s)
   LET l_sql = "SELECT apgcent,apgccomp,apgcdocno,apgcseq,apgc900,
                       apgcorga,apgc001,apgc002,apgc003,apgc004,
                       apgc005,apgc006,apgc007,apgc008,apgc009,
                       apgc010,apgc011,apgc012,apgc013,apgc014,
                       apgc015,apgc016,apgc100,apgc101,apgc103,
                       apgc104,apgc105,apgc113,apgc114,apgc115,
                       apgcud001,apgcud002,apgcud003,apgcud004,apgcud005,
                       apgcud006,apgcud007,apgcud008,apgcud009,apgcud010,
                       apgcud011,apgcud012,apgcud013,apgcud014,apgcud015,
                       apgcud016,apgcud017,apgcud018,apgcud019,apgcud020,
                       apgcud021,apgcud022,apgcud023,apgcud024,apgcud025,
                       apgcud026,apgcud027,apgcud028,apgcud029,apgcud030 
                  FROM apgc_t ",
   #161208-00026#13-add(e)
               " WHERE apgcent = ",g_enterprise," ",
               "   AND apgccomp = '",l_apgk.apgkcomp,"' ",
               "   AND apgcdocno = '",l_apgk.apgkdocno,"' ",
               "   AND apgc900 = '0' "
   PREPARE sel_apgcp4 FROM l_sql
   DECLARE sel_apgcc4 CURSOR FOR sel_apgcp4
   
   #FOREACH sel_apgcc4 INTO l_apgc.*  #161208-00026#13 mark
   #161208-00026#13-add(s)
   FOREACH sel_apgcc4 INTO l_apgc.apgcent,l_apgc.apgccomp,l_apgc.apgcdocno,l_apgc.apgcseq,l_apgc.apgc900,
                           l_apgc.apgcorga,l_apgc.apgc001,l_apgc.apgc002,l_apgc.apgc003,l_apgc.apgc004,
                           l_apgc.apgc005,l_apgc.apgc006,l_apgc.apgc007,l_apgc.apgc008,l_apgc.apgc009,
                           l_apgc.apgc010,l_apgc.apgc011,l_apgc.apgc012,l_apgc.apgc013,l_apgc.apgc014,
                           l_apgc.apgc015,l_apgc.apgc016,l_apgc.apgc100,l_apgc.apgc101,l_apgc.apgc103,
                           l_apgc.apgc104,l_apgc.apgc105,l_apgc.apgc113,l_apgc.apgc114,l_apgc.apgc115,
                           l_apgc.apgcud001,l_apgc.apgcud002,l_apgc.apgcud003,l_apgc.apgcud004,l_apgc.apgcud005,
                           l_apgc.apgcud006,l_apgc.apgcud007,l_apgc.apgcud008,l_apgc.apgcud009,l_apgc.apgcud010,
                           l_apgc.apgcud011,l_apgc.apgcud012,l_apgc.apgcud013,l_apgc.apgcud014,l_apgc.apgcud015,
                           l_apgc.apgcud016,l_apgc.apgcud017,l_apgc.apgcud018,l_apgc.apgcud019,l_apgc.apgcud020,
                           l_apgc.apgcud021,l_apgc.apgcud022,l_apgc.apgcud023,l_apgc.apgcud024,l_apgc.apgcud025,
                           l_apgc.apgcud026,l_apgc.apgcud027,l_apgc.apgcud028,l_apgc.apgcud029,l_apgc.apgcud030 
   #161208-00026#13-add(e)
      IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
      #r2.產生apcb-----s
      INITIALIZE l_apcb.* TO NULL
      LET l_apcb.apcbent   = g_enterprise
      LET l_apcb.apcbld    = l_apca.apcald
      LET l_apcb.apcblegl  = l_apca.apcacomp
      LET l_apcb.apcbsite  = l_apca.apcasite
      LET l_apcb.apcbdocno = l_apca.apcadocno
      LET l_apcb.apcbseq   = NULL
      SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
       WHERE apcbent   = g_enterprise
         AND apcbld    = l_apcb.apcbld
         AND apcbdocno = l_apcb.apcbdocno
      IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
      LET l_apcb.apcb001 = '54'
      LET l_apcb.apcb002 = l_apgc.apgcdocno
      LET l_apcb.apcb003 = l_apgc.apgcseq
      LET l_apcb.apcb014 = l_apgc.apgc001 #160428-00001#8       
      LET l_apcb.apcb005 = s_desc_get_acc_desc('3117',l_apgc.apgc001)
      LET l_apcb.apcb006 = ' '
      LET l_apcb.apcb007 = 1
      LET l_apcb.apcb010 = l_apca.apca015
      CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                       RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
      LET l_apcb.apcb020 = l_apgc.apgc006
      LET l_apcb.apcb021 = l_apgc.apgc004
      LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')   #albireo 160624 add
      LET l_apcb.apcb023 = 'N'
      LET l_apcb.apcb027 = l_apgc.apgc008
      LET l_apcb.apcb028 = l_apgc.apgc009
      LET l_apcb.apcb029 = l_apca.apca035
      LET l_apcb.apcb030 = l_apca.apca008
      LET l_apcb.apcb051 = l_apca.apca014
      LET l_apcb.apcb100 = l_apgc.apgc100
      LET l_apcb.apcb101 = l_apgc.apgc105   #albireo 160623 add
      LET l_apcb.apcb102 = l_apgc.apgc101
      LET l_apcb.apcb103 = l_apgc.apgc103
      LET l_apcb.apcb104 = l_apgc.apgc104
      LET l_apcb.apcb105 = l_apgc.apgc105
      LET l_apcb.apcb108 = l_apcb.apcb103
      LET l_apcb.apcb111 = l_apgc.apgc115   #albireo 160623 add
      LET l_apcb.apcb113 = l_apgc.apgc113
      LET l_apcb.apcb114 = l_apgc.apgc114
      LET l_apcb.apcb115 = l_apgc.apgc115
      LET l_apcb.apcborga = l_apgc.apgcorga
      CALL s_tax_chk(l_apca.apcacomp,l_apcb.apcb020) RETURNING g_sub_success,l_oodb004,l_apca013,l_apca012,l_oodb011
      IF l_apca013 = 'Y' THEN
         LET l_apcb.apcb105 = l_apcb.apcb105
      ELSE
         LET l_apcb.apcb105 = l_apcb.apcb103
      END IF
      CALL s_tax_ins(l_apca.apcadocno,l_apcb.apcbseq,'0',l_apcb.apcborga,l_apcb.apcb105,
                l_apcb.apcb020,l_apcb.apcb007,l_apcb.apcb100,l_apcb.apcb102,l_apca.apcald,l_apca.apca121,l_apca.apca131)   #albireo 160630
          RETURNING l_apcb.apcb103,l_apcb.apcb104,l_apcb.apcb105,
                    l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,
                    l_apcb.apcb123,l_apcb.apcb124,l_apcb.apcb125,
                    l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         EXIT FOREACH
         LET r_success = FALSE
      END IF
      #r2.產生apcb-----e
      
      #r3.產生直接付款apde-----s
      INITIALIZE l_apde.* TO NULL
      LET l_apde.apdeent  =l_apca.apcaent
      LET l_apde.apdeld =l_apca.apcald
      LET l_apde.apdecomp =l_apca.apcacomp
      LET l_apde.apdeorga =l_apca.apcacomp
      LET l_apde.apdesite =l_apca.apcasite
      LET l_apde.apdedocno =l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
      IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
      LET l_apde.apdeseq = l_apde.apdeseq + 1
      LET l_apde.apde001 = 'aapt560'
      LET l_apde.apde009 = 'Y'
      LET l_apde.apde028 = '0'
      LET l_apde.apde002 = '10'
      LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'3')
      #以判斷完匯兌損失/匯兌收益,將金額轉正顯示
      LET l_apde.apde109 =  l_apgc.apgc105
      LET l_apde.apde119 =  l_apgc.apgc115
      LET l_apde.apde006 = '10'   
      #銀行存提碼
      LET l_apde.apde011 = l_apgc.apgc015
      #現金變動碼
      LET l_apde.apde012 = l_apgc.apgc016
      LET l_apde.apde013 = ''
      LET l_apde.apde014 = ''
      LET l_apde.apde016 = ''
      LET l_apde.apde100 = l_apgc.apgc100
      LET l_apde.apde101 = l_apgc.apgc101
      LET l_apde.apde039 = l_apga.apga007
      LET l_apde.apde041 = NULL
      SELECT nmabl003 INTO l_apde.apde041
        FROM nmabl_t
       WHERE nmablent = g_enterprise
         AND nmabl001 = l_apde.apde039
         AND nmabl002 = g_dlang
      IF cl_null(l_apde.apde101) THEN LET l_apde.apde101 = 1 END IF
      LET l_apde.apde032 = l_apca.apcadocdt
      LET l_apde.apde061 = '54'
      #LET l_apde.apde016 = l_apgc.apgc004   #160824-00049#7 mark
      LET l_apde.apde008 = l_apgc.apgc014
      CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
         RETURNING l_apde.apde016   #160824-00049#7 add
      INSERT INTO apde_t(apdeent,
                         apdeld,apdecomp,apdesite,apdedocno,apdeseq,
                         apde001,apde009,apde028,apde002,apde015,
                         apde003,apde004,apdeorga,apde006,apde011,
                         apde012,apde013,apde014,apde016,apde017,
                         apde018,apde021,apde032,apde100,apde101,
                         apde039,apde040,apde041,
                         apde008,
                         apde109,apde119,apde061)
             VALUES(l_apde.apdeent,
                    l_apde.apdeld,l_apde.apdecomp,l_apde.apdesite,l_apde.apdedocno,l_apde.apdeseq,
                    l_apde.apde001,l_apde.apde009,l_apde.apde028,l_apde.apde002,l_apde.apde015,
                    l_apde.apde003,l_apde.apde004,l_apde.apdeorga,l_apde.apde006,l_apde.apde011,
                    l_apde.apde012,l_apde.apde013,l_apde.apde014,l_apde.apde016,l_apde.apde017,
                    l_apde.apde018,l_apde.apde021,l_apde.apde032,l_apde.apde100,l_apde.apde101,
                    l_apde.apde039,l_apde.apde040,l_apde.apde041,
                    l_apde.apde008,
                    l_apde.apde109,l_apde.apde119,l_apde.apde061)
      IF SQLCA.SQLCODE THEN LET r_success = FALSE EXIT FOREACH END IF
      #r3.產生直接付款apde-----e
      
      #INSERT isam
      INITIALIZE l_isam.* TO NULL
      LET l_isam.isament = l_apca.apcaent
      LET l_isam.isamdocno = l_apca.apcadocno
      SELECT MAX(isamseq)+1 INTO l_isam.isamseq
        FROM isam_t
       WHERE isament = g_enterprise
         AND isamdocno = l_apca.apcadocno
         AND isam001 = 'aapt560'
      IF cl_null(l_isam.isamseq)THEN LET l_isam.isamseq = 1 END IF
      LET l_isam.isam001 = 'aapt560'
      LET l_isam.isam002 = l_apca.apca004                           
      LET l_isam.isam008 = l_apgc.apgc007                           
      LET l_isam.isam009 = l_apgc.apgc008                           
      LET l_isam.isam010 = l_apgc.apgc009                           
      LET l_isam.isam011 = l_apgc.apgc010                           
      LET l_isam.isam012 = l_apgc.apgc006        
      LET l_isam.isam0121= l_apca.apca013                  
      LET l_isam.isam013 = l_apca.apca012
      LET l_isam.isam014 = l_apgc.apgc100                           
      LET l_isam.isam015 = l_apgc.apgc101                           
      LET l_isam.isam016 = l_ooefl006
      LET l_isam.isam017 = l_ooef002
      CALL s_aapp320_buy_info(l_apca.apcacomp)RETURNING l_pmaal003,l_isao001,      
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021
      LET l_isam.isam023 = l_apgc.apgc103                           
      LET l_isam.isam024 = l_apgc.apgc104                           
      LET l_isam.isam025 = l_apgc.apgc105                           
      LET l_isam.isam026 = l_apgc.apgc113                           
      LET l_isam.isam027 = l_apgc.apgc114                           
      LET l_isam.isam028 = l_apgc.apgc115                           
      LET l_isam.isam029 = s_desc_get_trading_partner_abbr_desc(l_apca.apca004)  

      SELECT isak008,isak009,isak010,isak011,isak012
        INTO l_isam.isam030,l_isam.isam031,l_isam.isam032,
             l_isam.isam033,l_isam.isam034
        FROM isak_t
       WHERE isakent = g_enterprise
         AND isak001 = l_apca.apca004
         AND isak002 = lc_param_apca.ooef019
      #161129-00042#1-add(s) #161230-00036#1  mark(s)
      #LET l_ooef011 = ' '
      #SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
      #IF l_ooef011 = 'TW' THEN
      #   #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
      #   CALL s_rule_chk_vat_id_string(l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET r_success = FALSE
      #      RETURN r_success,r_docno
      #   END IF  
      #   #檢查營利事業統一編號邏輯，錯了下方提示不控卡
      #   CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET l_isam.isam030 = l_isam.isam030
      #   END IF
      #END IF
      #161129-00042#1-add(e) #161230-00036#1  mark(e)    
      LET l_isam.isam035 = '1'                                 
      LET l_isam.isam036 = '11'                                
      LET l_isam.isam037 = l_apgc.apgc011                           
      LET l_isam.isam050 = l_apca.apcadocno                         
      LET l_isam.isam107    = 0                                 
      LET l_isam.isam108    = 0                                 
      LET l_isam.isam117    = 0                                 
      LET l_isam.isam118    = 0
      IF NOT cl_null(l_isam.isam010)THEN
         #161230-00036#1 add(s)
         LET l_isac004 = ''
         LET l_isac008 = ''
         SELECT isac004,isac008 INTO l_isac004,l_isac008 FROM isac_t WHERE isacent = g_enterprise 
            AND isac002 = l_isam.isam008 AND isac001 = lc_param_apca.ooef019
         #IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) THEN                                              #170218-00012#1 mark
         IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) AND l_isac004 != '28' AND l_isac004 != '29' THEN   #170218-00012#1 add
            #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
            LET l_ooef011 = ' '
            SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
            IF l_ooef011 = 'TW' THEN
               IF NOT cl_null(l_isam.isam030) THEN   #170218-00012#1 add
                  LET l_vat_id = l_isam.isam030
                  IF l_vat_id.getLength() <> 8  THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF         
                  IF NOT cl_chk_num(l_isam.isam030,'N') THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF 
                  #檢查營利事業統一編號邏輯，錯了下方提示不控卡
                  CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
                  IF NOT g_sub_success THEN
                     LET l_isam.isam030 = l_isam.isam030
                  END IF
               END IF   #170218-00012#1 add
            END IF
         END IF            
         #161230-00036#1 add(e)
         #INSERT INTO isam_t VALUES(l_isam.*) #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO isam_t (isament,isamownid,isamowndp,isamcrtid,isamcrtdp,
                             isamcrtdt,isammodid,isammoddt,isamcnfid,isamcnfdt,
                             isamstus,isamcomp,isamdocno,isamseq,
                             isam001,isam002,isam004,isam006,isam008,
                             isam009,isam010,isam011,isam012,isam0121,
                             isam013,isam014,isam015,isam016,isam017,
                             isam018,isam019,isam020,isam021,isam022,
                             isam023,isam024,isam025,isam026,isam027,
                             isam028,isam029,isam030,isam031,isam032,
                             isam033,isam034,isam035,isam036,isam037,
                             isam038,isam039,isam040,isam041,isam042,
                             isam043,isam044,isam045,isam046,isam047,
                             isam048,isam049,isam050,isam107,isam108,
                             isam117,isam118,isam200,isam201,isam202,
                             isam203,isam204,isam205,isam206,isam207,
                             isam208,isam209,isam210,
                             isamud001,isamud002,isamud003,isamud004,isamud005,
                             isamud006,isamud007,isamud008,isamud009,isamud010,
                             isamud011,isamud012,isamud013,isamud014,isamud015,
                             isamud016,isamud017,isamud018,isamud019,isamud020,
                             isamud021,isamud022,isamud023,isamud024,isamud025,
                             isamud026,isamud027,isamud028,isamud029,isamud030,
                             isam051
                            )
         VALUES (l_isam.isament,l_isam.isamownid,l_isam.isamowndp,l_isam.isamcrtid,l_isam.isamcrtdp,
                 l_isam.isamcrtdt,l_isam.isammodid,l_isam.isammoddt,l_isam.isamcnfid,l_isam.isamcnfdt,
                 l_isam.isamstus,l_isam.isamcomp,l_isam.isamdocno,l_isam.isamseq,
                 l_isam.isam001,l_isam.isam002,l_isam.isam004,l_isam.isam006,l_isam.isam008,
                 l_isam.isam009,l_isam.isam010,l_isam.isam011,l_isam.isam012,l_isam.isam0121,
                 l_isam.isam013,l_isam.isam014,l_isam.isam015,l_isam.isam016,l_isam.isam017,
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021,l_isam.isam022,
                 l_isam.isam023,l_isam.isam024,l_isam.isam025,l_isam.isam026,l_isam.isam027,
                 l_isam.isam028,l_isam.isam029,l_isam.isam030,l_isam.isam031,l_isam.isam032,
                 l_isam.isam033,l_isam.isam034,l_isam.isam035,l_isam.isam036,l_isam.isam037,
                 l_isam.isam038,l_isam.isam039,l_isam.isam040,l_isam.isam041,l_isam.isam042,
                 l_isam.isam043,l_isam.isam044,l_isam.isam045,l_isam.isam046,l_isam.isam047,
                 l_isam.isam048,l_isam.isam049,l_isam.isam050,l_isam.isam107,l_isam.isam108,
                 l_isam.isam117,l_isam.isam118,l_isam.isam200,l_isam.isam201,l_isam.isam202,
                 l_isam.isam203,l_isam.isam204,l_isam.isam205,l_isam.isam206,l_isam.isam207,
                 l_isam.isam208,l_isam.isam209,l_isam.isam210,
                 l_isam.isamud001,l_isam.isamud002,l_isam.isamud003,l_isam.isamud004,l_isam.isamud005,
                 l_isam.isamud006,l_isam.isamud007,l_isam.isamud008,l_isam.isamud009,l_isam.isamud010,
                 l_isam.isamud011,l_isam.isamud012,l_isam.isamud013,l_isam.isamud014,l_isam.isamud015,
                 l_isam.isamud016,l_isam.isamud017,l_isam.isamud018,l_isam.isamud019,l_isam.isamud020,
                 l_isam.isamud021,l_isam.isamud022,l_isam.isamud023,l_isam.isamud024,l_isam.isamud025,
                 l_isam.isamud026,l_isam.isamud027,l_isam.isamud028,l_isam.isamud029,l_isam.isamud030,
                 l_isam.isam051
                )
         #161108-00017#4 add end---
      END IF   
   END FOREACH
   
   #161004-00019#1-----s
   CALL s_fin_get_account(l_apca.apcald,'13',l_apca.apca007,'8504_04') RETURNING g_sub_success,l_xrcd009,g_errno
   UPDATE xrcd_t SET xrcd009 = l_xrcd009
    WHERE xrcdent= g_enterprise
      AND xrcdld = l_apca.apcald AND xrcddocno = l_apca.apcadocno
      AND xrcd009 IS NULL
   #161004-00019#1-----e
   
   LET l_pmab055 = NULL
   SELECT pmab055 INTO l_pmab055 FROM pmab_t
    WHERE pmabsite = l_apca.apcacomp
      AND pmab001 = l_apca.apca004
      AND pmabent = g_enterprise
   
   #自備款-----s
   LET l_glaa121 = NULL LET l_glaa016 = NULL
   LET l_glaa020 = NULL LET l_glaa019 = NULL
   LET l_glaa015 = NULL
   SELECT glaa121,glaa016,glaa020 ,
          glaa015,glaa019,
          glaa001  #161228-00062#1 add
     INTO l_glaa121,l_glaa016,l_glaa020,
          l_glaa015,l_glaa019,
          l_glaa001 #161228-00062#1 add
     FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = l_apca.apcald
   
   
   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
   SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
    WHERE apdeent   = l_apde.apdeent
      AND apdeld    = l_apde.apdeld
      AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '23'
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apga.apga036
   LET l_apde.apde012 = l_apga.apga037
   LET l_apde.apde014 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '13'
   #   AND glab002 = l_pmab055
   #   AND glab003 = '8504_31'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang   #albireo 160729 add
   LET l_apde.apde100 = l_apgk.apgk100
   LET l_apde.apde101 = l_apgk.apgk101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apgk.apgk104
   LET l_apde.apde119 = l_apde.apde109 * l_apde.apde101
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   #LET l_apde.apde101 = l_apga.apga101  #161226-00052#1 mark
   LET l_apde.apde101 = l_apgk.apgk101  #161226-00052#1 add 修正汇率抓取错误
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '51'
   IF l_apde.apde109 > 0 THEN
      #INSERT INTO apde_t VALUES(l_apde.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF
   
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '51'
   LET l_apcb.apcb002 = l_apgk.apgkdocno   #160824-00049#7
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
    WHERE glabent = g_enterprise
      AND glabld = l_apde.apdeld
      AND glab001 = '15'
      AND glab002 = '3117'
      AND glab003 = '8504_31'
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apgk.apgk100   #albireo 160630
   LET l_apcb.apcb101 = l_apgk.apgk104   #albireo 160624 
   LET l_apcb.apcb102 = l_apgk.apgk101   #albireo 160630
   LET l_apcb.apcb103 = l_apgk.apgk104
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apgk.apgk104
   LET l_apcb.apcb108 = l_apgk.apgk104
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apgk.apgk104 * l_apgk.apgk101
   CALL s_curr_round_ld('1',l_apca.apcald,l_apca.apca100,l_apcb.apcb113,2) RETURNING g_sub_success,g_errno,l_apcb.apcb113   #161018-00036#1 add
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apgk.apgk104 * l_apgk.apgk101
   CALL s_curr_round_ld('1',l_apca.apcald,l_apca.apca100,l_apcb.apcb115,2) RETURNING g_sub_success,g_errno,l_apcb.apcb115   #161018-00036#1 add
  LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   CALL s_curr_round_ld('1',l_apca.apcald,l_apca.apca100,l_apcb.apcb123,2) RETURNING g_sub_success,g_errno,l_apcb.apcb123   #161018-00036#1 add
   LET l_apcb.apcb124 = 0
   #LET l_apcb.apcb125 = l_apcb.apcb125   #161018-00036#1 mark
   LET l_apcb.apcb125 = l_apcb.apcb123    #161018-00036#1 add
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   CALL s_curr_round_ld('1',l_apca.apcald,l_apca.apca100,l_apcb.apcb133,2) RETURNING g_sub_success,g_errno,l_apcb.apcb133   #161018-00036#1 add
   LET l_apcb.apcb134 = 0
   #LET l_apcb.apcb135 = l_apcb.apcb135   #161018-00036#1 mark
   LET l_apcb.apcb135 = l_apcb.apcb133    #161018-00036#1 add
   IF l_apcb.apcb115 > 0 THEN
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF
   #自備款-----e
#albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
      
   LET l_apcb113sum = NULL   LET l_apcb114sum = NULL   LET l_apcb115sum = NULL
   SELECT SUM(apcb113),SUM(apcb114),SUM(apcb115)
     INTO l_apcb113sum,l_apcb114sum,l_apcb115sum
     FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbld  = l_apca.apcald
      AND apcbdocno = l_apca.apcadocno
   IF cl_null(l_apcb113sum)THEN LET l_apcb113sum = 0 END IF
   IF cl_null(l_apcb114sum)THEN LET l_apcb114sum = 0 END IF
   IF cl_null(l_apcb115sum)THEN LET l_apcb115sum = 0 END IF
   
   UPDATE apca_t SET apca103 = l_apcb113sum,
                     apca104 = l_apcb114sum,
                     apca108 = l_apcb115sum,
                     apca113 = l_apcb113sum,
                     apca114 = l_apcb114sum,
                     apca118 = l_apcb115sum,
                     apca107 = l_apcb115sum,   #160824-00049#7
                     apca117 = l_apcb115sum    #160824-00049#7
    WHERE apcaent = g_enterprise
      AND apcald  = l_apca.apcald
      AND apcadocno = l_apca.apcadocno

   CALL s_aap_multi_bill_period(l_apca.apcald,l_apca.apcadocno) RETURNING g_sub_success,g_errno

   UPDATE apcc_t SET apcc109 = apcc108 ,apcc119 = apcc118
    WHERE apccent = g_enterprise
      AND apccdocno = l_apca.apcadocno
      AND apccld    = l_apca.apcald
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   CALL s_pre_voucher_ins('AP','P10',l_apca.apcald,l_apca.apcadocno,l_apca.apcadocdt,'1')
                       RETURNING g_sub_success
   IF NOT g_sub_success THEN
      LET r_success = FALSE
   END IF  
   
   #160824-00049#7-----s
   LET l_count = NULL
   SELECT COUNT(*) INTO l_count FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbdocno = l_apca.apcadocno
      AND apcbld = l_apca.apcald
   IF cl_null(l_count)THEN LET l_count = 0 END IF
   
   IF l_count = 0 THEN
      LET r_success = FALSE
      INITIALIZE g_errparam.* TO NULL
      LET g_errparam.code = 'agl-00167'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
   END IF
   #160824-00049#7-----e

   UPDATE apgk_t SET apgk015 = l_apca.apcadocno
    WHERE apgkent = g_enterprise
      AND apgkcomp = l_apca.apcacomp
      AND apgkdocno = g_apca_m.apca018
   LET r_docno = l_apca.apcadocno
   RETURN r_success,r_docno
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_ins_ap_5()
#DEFINE l_apca   RECORD LIKE apca_t.* #161104-00024#5 mark
#161104-00024#5-add(s)
DEFINE l_apca  RECORD  #應付憑單單頭
       apcaent   LIKE apca_t.apcaent, #企業編號
       apcaownid LIKE apca_t.apcaownid, #資料所有者
       apcaowndp LIKE apca_t.apcaowndp, #資料所有部門
       apcacrtid LIKE apca_t.apcacrtid, #資料建立者
       apcacrtdp LIKE apca_t.apcacrtdp, #資料建立部門
       apcacrtdt LIKE apca_t.apcacrtdt, #資料創建日
       apcamodid LIKE apca_t.apcamodid, #資料修改者
       apcamoddt LIKE apca_t.apcamoddt, #最近修改日
       apcacnfid LIKE apca_t.apcacnfid, #資料確認者
       apcacnfdt LIKE apca_t.apcacnfdt, #資料確認日
       apcapstid LIKE apca_t.apcapstid, #資料過帳者
       apcapstdt LIKE apca_t.apcapstdt, #資料過帳日
       apcastus  LIKE apca_t.apcastus, #狀態碼
       apcald    LIKE apca_t.apcald, #帳套
       apcacomp  LIKE apca_t.apcacomp, #法人
       apcadocno LIKE apca_t.apcadocno, #應付帳款單號碼
       apcadocdt LIKE apca_t.apcadocdt, #帳款日期
       apcasite  LIKE apca_t.apcasite, #帳務中心
       apca001   LIKE apca_t.apca001, #帳款單性質
       apca003   LIKE apca_t.apca003, #帳務人員
       apca004   LIKE apca_t.apca004, #帳款對象編號
       apca005   LIKE apca_t.apca005, #付款對象
       apca006   LIKE apca_t.apca006, #供應商分類
       apca007   LIKE apca_t.apca007, #帳款類別
       apca008   LIKE apca_t.apca008, #付款條件編號
       apca009   LIKE apca_t.apca009, #應付款日/應扣抵日
       apca010   LIKE apca_t.apca010, #容許票據到期日
       apca011   LIKE apca_t.apca011, #稅別
       apca012   LIKE apca_t.apca012, #稅率
       apca013   LIKE apca_t.apca013, #含稅否
       apca014   LIKE apca_t.apca014, #人員編號
       apca015   LIKE apca_t.apca015, #部門編號
       apca016   LIKE apca_t.apca016, #來源作業類型
       apca017   LIKE apca_t.apca017, #產生方式
       apca018   LIKE apca_t.apca018, #來源參考單號
       apca019   LIKE apca_t.apca019, #系統產生對應單號(待抵帳款-預付)
       apca020   LIKE apca_t.apca020, #信用狀付款否
       apca021   LIKE apca_t.apca021, #商業發票號碼(IV no.)
       apca022   LIKE apca_t.apca022, #進口報單號碼
       apca025   LIKE apca_t.apca025, #差異處理(發票與帳款差異)
       apca026   LIKE apca_t.apca026, #原幣未稅差異
       apca027   LIKE apca_t.apca027, #原幣稅額差異
       apca028   LIKE apca_t.apca028, #本幣未稅差異
       apca029   LIKE apca_t.apca029, #本幣幣稅額差異
       apca030   LIKE apca_t.apca030, #差異科目
       apca031   LIKE apca_t.apca031, #產生之差異折讓單號
       apca032   LIKE apca_t.apca032, #發票類型
       apca033   LIKE apca_t.apca033, #專案編號
       apca034   LIKE apca_t.apca034, #責任中心
       apca035   LIKE apca_t.apca035, #應付(貸方)科目編號
       apca036   LIKE apca_t.apca036, #費用(借方)科目編號
       apca037   LIKE apca_t.apca037, #產生傳票否
       apca038   LIKE apca_t.apca038, #拋轉傳票號碼
       apca039   LIKE apca_t.apca039, #會計檢核附件份數
       apca040   LIKE apca_t.apca040, #留置否
       apca041   LIKE apca_t.apca041, #留置理由碼
       apca042   LIKE apca_t.apca042, #留置設定日期
       apca043   LIKE apca_t.apca043, #留置解除日期
       apca044   LIKE apca_t.apca044, #留置原幣金額
       apca045   LIKE apca_t.apca045, #留置說明
       apca046   LIKE apca_t.apca046, #關係人否
       apca047   LIKE apca_t.apca047, #多角序號
       apca048   LIKE apca_t.apca048, #集團代付/代付單號
       apca049   LIKE apca_t.apca049, #來源營運中心編號
       apca050   LIKE apca_t.apca050, #交易原始單據份數
       apca051   LIKE apca_t.apca051, #作廢理由碼
       apca052   LIKE apca_t.apca052, #列印次數
       apca053   LIKE apca_t.apca053, #備註
       apca054   LIKE apca_t.apca054, #多帳期設定
       apca055   LIKE apca_t.apca055, #繳款優惠條件
       apca056   LIKE apca_t.apca056, #會計檢核附件狀態
       apca057   LIKE apca_t.apca057, #交易對象識別碼
       apca058   LIKE apca_t.apca058, #稅別交易類型
       apca059   LIKE apca_t.apca059, #預算編號
       apca060   LIKE apca_t.apca060, #發票開立方式
       apca061   LIKE apca_t.apca061, #預開發票基準日
       apca062   LIKE apca_t.apca062, #多角性質
       apca063   LIKE apca_t.apca063, #整帳批序號
       apca064   LIKE apca_t.apca064, #訂金序次
       apca065   LIKE apca_t.apca065, #發票編號
       apca066   LIKE apca_t.apca066, #發票號碼
       apca100   LIKE apca_t.apca100, #交易原幣別
       apca101   LIKE apca_t.apca101, #原幣匯率
       apca103   LIKE apca_t.apca103, #原幣未稅金額
       apca104   LIKE apca_t.apca104, #原幣稅額
       apca106   LIKE apca_t.apca106, #原幣應稅折抵合計金額
       apca107   LIKE apca_t.apca107, #原幣直接沖帳(調整)合計金額
       apca108   LIKE apca_t.apca108, #原幣應付金額
       apca113   LIKE apca_t.apca113, #本幣未稅金額
       apca114   LIKE apca_t.apca114, #本幣稅額
       apca116   LIKE apca_t.apca116, #本幣應稅折抵合計金額
       apca117   LIKE apca_t.apca117, #NO USE
       apca118   LIKE apca_t.apca118, #本幣應付金額
       apca120   LIKE apca_t.apca120, #本位幣二幣別
       apca121   LIKE apca_t.apca121, #本位幣二匯率
       apca123   LIKE apca_t.apca123, #本位幣二未稅金額
       apca124   LIKE apca_t.apca124, #本位幣二稅額
       apca126   LIKE apca_t.apca126, #本位幣二應稅折抵合計金額
       apca127   LIKE apca_t.apca127, #NO USE
       apca128   LIKE apca_t.apca128, #本位幣二應付金額
       apca130   LIKE apca_t.apca130, #本位幣三幣別
       apca131   LIKE apca_t.apca131, #本位幣三匯率
       apca133   LIKE apca_t.apca133, #本位幣三未稅金額
       apca134   LIKE apca_t.apca134, #本位幣三稅額
       apca136   LIKE apca_t.apca136, #本位幣三應稅折抵合計金額
       apca137   LIKE apca_t.apca137, #NO USE
       apca138   LIKE apca_t.apca138, #本位幣三應付金額
       apcaud001 LIKE apca_t.apcaud001, #自定義欄位(文字)001
       apcaud002 LIKE apca_t.apcaud002, #自定義欄位(文字)002
       apcaud003 LIKE apca_t.apcaud003, #自定義欄位(文字)003
       apcaud004 LIKE apca_t.apcaud004, #自定義欄位(文字)004
       apcaud005 LIKE apca_t.apcaud005, #自定義欄位(文字)005
       apcaud006 LIKE apca_t.apcaud006, #自定義欄位(文字)006
       apcaud007 LIKE apca_t.apcaud007, #自定義欄位(文字)007
       apcaud008 LIKE apca_t.apcaud008, #自定義欄位(文字)008
       apcaud009 LIKE apca_t.apcaud009, #自定義欄位(文字)009
       apcaud010 LIKE apca_t.apcaud010, #自定義欄位(文字)010
       apcaud011 LIKE apca_t.apcaud011, #自定義欄位(數字)011
       apcaud012 LIKE apca_t.apcaud012, #自定義欄位(數字)012
       apcaud013 LIKE apca_t.apcaud013, #自定義欄位(數字)013
       apcaud014 LIKE apca_t.apcaud014, #自定義欄位(數字)014
       apcaud015 LIKE apca_t.apcaud015, #自定義欄位(數字)015
       apcaud016 LIKE apca_t.apcaud016, #自定義欄位(數字)016
       apcaud017 LIKE apca_t.apcaud017, #自定義欄位(數字)017
       apcaud018 LIKE apca_t.apcaud018, #自定義欄位(數字)018
       apcaud019 LIKE apca_t.apcaud019, #自定義欄位(數字)019
       apcaud020 LIKE apca_t.apcaud020, #自定義欄位(數字)020
       apcaud021 LIKE apca_t.apcaud021, #自定義欄位(日期時間)021
       apcaud022 LIKE apca_t.apcaud022, #自定義欄位(日期時間)022
       apcaud023 LIKE apca_t.apcaud023, #自定義欄位(日期時間)023
       apcaud024 LIKE apca_t.apcaud024, #自定義欄位(日期時間)024
       apcaud025 LIKE apca_t.apcaud025, #自定義欄位(日期時間)025
       apcaud026 LIKE apca_t.apcaud026, #自定義欄位(日期時間)026
       apcaud027 LIKE apca_t.apcaud027, #自定義欄位(日期時間)027
       apcaud028 LIKE apca_t.apcaud028, #自定義欄位(日期時間)028
       apcaud029 LIKE apca_t.apcaud029, #自定義欄位(日期時間)029
       apcaud030 LIKE apca_t.apcaud030, #自定義欄位(日期時間)030
       apca067   LIKE apca_t.apca067, #管理品類
       apca068   LIKE apca_t.apca068, #經營方式
       apca069   LIKE apca_t.apca069, #no use
       apca070   LIKE apca_t.apca070, #no use
       apca071   LIKE apca_t.apca071, #no use
       apca072   LIKE apca_t.apca072, #no use
       apca073   LIKE apca_t.apca073  #L/C No.
           END RECORD
#161104-00024#5-add(e)
DEFINE l_desc   LIKE type_t.chr1000
DEFINE ls_js            STRING   
DEFINE lc_param_apca    RECORD
         apcald         LIKE apca_t.apcald,
         apcacomp       LIKE apca_t.apcacomp,
         apcasite       LIKE apca_t.apcasite,
         apcadocdt      LIKE apca_t.apcadocdt,
         apca001        LIKE apca_t.apca001,
         apca004        LIKE apca_t.apca004,
         ooef019        LIKE ooef_t.ooef019
                        END RECORD
DEFINE lc_param_info    RECORD
            apca005        LIKE apca_t.apca005,
            apca005_desc   LIKE type_t.chr80,
            apca006        LIKE apca_t.apca006,    #供應商分類
            apca007        LIKE apca_t.apca007,
            apca007_desc   LIKE type_t.chr80,
            apca008        LIKE apca_t.apca008,
            apca008_desc   LIKE type_t.chr80,
            apca009        LIKE apca_t.apca009,
            apca010        LIKE apca_t.apca010,
            apca011        LIKE apca_t.apca011,
            apca011_desc   LIKE type_t.chr80,
            apca012        LIKE apca_t.apca012,
            apca013        LIKE apca_t.apca013,
            apca014        LIKE apca_t.apca014,
            apca014_desc   LIKE type_t.chr80,
            apca015        LIKE apca_t.apca015,
            apca015_desc   LIKE type_t.chr80,
            apca034        LIKE apca_t.apca034,
            apca034_desc   LIKE type_t.chr80,
            apca035        LIKE apca_t.apca035,
            apca035_desc   LIKE type_t.chr80,
            apca036        LIKE apca_t.apca036,
            apca036_desc   LIKE type_t.chr80,
            apca046        LIKE apca_t.apca046,
            apca054        LIKE apca_t.apca054,
            apca054_desc   LIKE type_t.chr80,
            apca055        LIKE apca_t.apca055,
            apca055_desc   LIKE type_t.chr80,
            apca056        LIKE apca_t.apca056,
            apca058        LIKE apca_t.apca058,
            apca058_desc   LIKE type_t.chr80,
            apca060        LIKE apca_t.apca060,
            apca100        LIKE apca_t.apca100,
            apca101        LIKE apca_t.apca101,
            apca121        LIKE apca_t.apca121,
            apca131        LIKE apca_t.apca131
                       END RECORD
   DEFINE lc_param2        RECORD
         type           LIKE type_t.chr1,       #類型
         apca004        LIKE apca_t.apca004,
         sfin2009       LIKE type_t.chr1        #汇率基本    
         END RECORD
   #DEFINE l_apga    RECORD LIKE apga_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apga  RECORD  #信用狀申請單主檔
          apgaent   LIKE apga_t.apgaent, #企業編號
          apgaownid LIKE apga_t.apgaownid, #資料所有者
          apgaowndp LIKE apga_t.apgaowndp, #資料所屬部門
          apgacrtid LIKE apga_t.apgacrtid, #資料建立者
          apgacrtdp LIKE apga_t.apgacrtdp, #資料建立部門
          apgacrtdt LIKE apga_t.apgacrtdt, #資料創建日
          apgamodid LIKE apga_t.apgamodid, #資料修改者
          apgamoddt LIKE apga_t.apgamoddt, #最近修改日
          apgacnfid LIKE apga_t.apgacnfid, #資料確認者
          apgacnfdt LIKE apga_t.apgacnfdt, #資料確認日
          apgapstid LIKE apga_t.apgapstid, #資料過帳者
          apgapstdt LIKE apga_t.apgapstdt, #資料過帳日
          apgastus  LIKE apga_t.apgastus, #狀態碼
          apgacomp  LIKE apga_t.apgacomp, #法人
          apgadocno LIKE apga_t.apgadocno, #申請單號
          apgadocdt LIKE apga_t.apgadocdt, #申請日期
          apga001   LIKE apga_t.apga001, #L/C NO
          apga002   LIKE apga_t.apga002, #版次
          apga003   LIKE apga_t.apga003, #開狀日期
          apga004   LIKE apga_t.apga004, #供應商(受益人)
          apga005   LIKE apga_t.apga005, #業務人員
          apga006   LIKE apga_t.apga006, #付款類型
          apga007   LIKE apga_t.apga007, #開狀銀行
          apga008   LIKE apga_t.apga008, #信用狀類別
          apga009   LIKE apga_t.apga009, #保兌信用狀否
          apga010   LIKE apga_t.apga010, #信用狀有效日期
          apga011   LIKE apga_t.apga011, #許可證號
          apga012   LIKE apga_t.apga012, #承兌日期
          apga013   LIKE apga_t.apga013, #保兌費用支付方
          apga014   LIKE apga_t.apga014, #可否分批交運
          apga015   LIKE apga_t.apga015, #自備款比率
          apga016   LIKE apga_t.apga016, #融資利率
          apga017   LIKE apga_t.apga017, #融資天數
          apga018   LIKE apga_t.apga018, #融資合約編號
          apga019   LIKE apga_t.apga019, #最後裝運日
          apga020   LIKE apga_t.apga020, #運送方式
          apga021   LIKE apga_t.apga021, #裝載港/機場
          apga022   LIKE apga_t.apga022, #卸載港/機場
          apga023   LIKE apga_t.apga023, #E.T.D
          apga024   LIKE apga_t.apga024, #E.T.A
          apga025   LIKE apga_t.apga025, #備註
          apga026   LIKE apga_t.apga026, #開狀時支付自備款
          apga027   LIKE apga_t.apga027, #NO USE
          apga028   LIKE apga_t.apga028, #帳務單號
          apga029   LIKE apga_t.apga029, #結案否
          apga030   LIKE apga_t.apga030, #通知銀行
          apga031   LIKE apga_t.apga031, #開狀時支付自備款
          apga100   LIKE apga_t.apga100, #幣別
          apga101   LIKE apga_t.apga101, #開狀匯率
          apga103   LIKE apga_t.apga103, #開狀原幣金額
          apga104   LIKE apga_t.apga104, #自備款原幣金額
          apga105   LIKE apga_t.apga105, #融資原幣金額
          apga106   LIKE apga_t.apga106, #到單原幣金額
          apga107   LIKE apga_t.apga107, #到貨原幣金額
          apga108   LIKE apga_t.apga108, #保證金原幣金額
          apga113   LIKE apga_t.apga113, #開狀本幣金額
          apga114   LIKE apga_t.apga114, #自備款本幣金額
          apga115   LIKE apga_t.apga115, #融資本幣金額
          apgaud001 LIKE apga_t.apgaud001, #自定義欄位(文字)001
          apgaud002 LIKE apga_t.apgaud002, #自定義欄位(文字)002
          apgaud003 LIKE apga_t.apgaud003, #自定義欄位(文字)003
          apgaud004 LIKE apga_t.apgaud004, #自定義欄位(文字)004
          apgaud005 LIKE apga_t.apgaud005, #自定義欄位(文字)005
          apgaud006 LIKE apga_t.apgaud006, #自定義欄位(文字)006
          apgaud007 LIKE apga_t.apgaud007, #自定義欄位(文字)007
          apgaud008 LIKE apga_t.apgaud008, #自定義欄位(文字)008
          apgaud009 LIKE apga_t.apgaud009, #自定義欄位(文字)009
          apgaud010 LIKE apga_t.apgaud010, #自定義欄位(文字)010
          apgaud011 LIKE apga_t.apgaud011, #自定義欄位(數字)011
          apgaud012 LIKE apga_t.apgaud012, #自定義欄位(數字)012
          apgaud013 LIKE apga_t.apgaud013, #自定義欄位(數字)013
          apgaud014 LIKE apga_t.apgaud014, #自定義欄位(數字)014
          apgaud015 LIKE apga_t.apgaud015, #自定義欄位(數字)015
          apgaud016 LIKE apga_t.apgaud016, #自定義欄位(數字)016
          apgaud017 LIKE apga_t.apgaud017, #自定義欄位(數字)017
          apgaud018 LIKE apga_t.apgaud018, #自定義欄位(數字)018
          apgaud019 LIKE apga_t.apgaud019, #自定義欄位(數字)019
          apgaud020 LIKE apga_t.apgaud020, #自定義欄位(數字)020
          apgaud021 LIKE apga_t.apgaud021, #自定義欄位(日期時間)021
          apgaud022 LIKE apga_t.apgaud022, #自定義欄位(日期時間)022
          apgaud023 LIKE apga_t.apgaud023, #自定義欄位(日期時間)023
          apgaud024 LIKE apga_t.apgaud024, #自定義欄位(日期時間)024
          apgaud025 LIKE apga_t.apgaud025, #自定義欄位(日期時間)025
          apgaud026 LIKE apga_t.apgaud026, #自定義欄位(日期時間)026
          apgaud027 LIKE apga_t.apgaud027, #自定義欄位(日期時間)027
          apgaud028 LIKE apga_t.apgaud028, #自定義欄位(日期時間)028
          apgaud029 LIKE apga_t.apgaud029, #自定義欄位(日期時間)029
          apgaud030 LIKE apga_t.apgaud030, #自定義欄位(日期時間)030
          apga102   LIKE apga_t.apga102, #預付款原幣金額
          apga109   LIKE apga_t.apga109, #初開狀原幣金額
          apga112   LIKE apga_t.apga112, #預付款本幣金額
          apga117   LIKE apga_t.apga117, #到貨本幣金額
          apga118   LIKE apga_t.apga118, #保證金本幣金額
          apga032   LIKE apga_t.apga032, #保證金待抵單號
          apga033   LIKE apga_t.apga033, #預付款待抵單號
          apga034   LIKE apga_t.apga034, #保證金存提碼
          apga035   LIKE apga_t.apga035, #保證金現變碼
          apga040   LIKE apga_t.apga040, #支付帳戶
          apga041   LIKE apga_t.apga041, #多幣別採購單
          apga036   LIKE apga_t.apga036, #自備款存提碼
          apga037   LIKE apga_t.apga037, #自備款現變碼
          apga038   LIKE apga_t.apga038, #預付款存提碼
          apga039   LIKE apga_t.apga039  #預付款現變碼
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_success LIKE type_t.num5
   #DEFINE l_apgc    RECORD LIKE apgc_t.* #161104-00024#5 mark
   #DEFINE l_apcb    RECORD LIKE apcb_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgc  RECORD  #信用狀相關費用明細檔
          apgcent   LIKE apgc_t.apgcent, #企業編號
          apgccomp  LIKE apgc_t.apgccomp, #法人
          apgcdocno LIKE apgc_t.apgcdocno, #申請單號
          apgcseq   LIKE apgc_t.apgcseq, #項次
          apgc900   LIKE apgc_t.apgc900, #變更序
          apgcorga  LIKE apgc_t.apgcorga, #來源組織
          apgc001   LIKE apgc_t.apgc001, #費用編號
          apgc002   LIKE apgc_t.apgc002, #付款對象
          apgc003   LIKE apgc_t.apgc003, #付款條件
          apgc004   LIKE apgc_t.apgc004, #費用科目
          apgc005   LIKE apgc_t.apgc005, #帳款類別
          apgc006   LIKE apgc_t.apgc006, #稅別
          apgc007   LIKE apgc_t.apgc007, #發票類型
          apgc008   LIKE apgc_t.apgc008, #發票編號
          apgc009   LIKE apgc_t.apgc009, #發票號碼
          apgc010   LIKE apgc_t.apgc010, #發票日期
          apgc011   LIKE apgc_t.apgc011, #可扣抵編號
          apgc012   LIKE apgc_t.apgc012, #應付單號
          apgc013   LIKE apgc_t.apgc013, #費用來源
          apgc014   LIKE apgc_t.apgc014, #付款帳戶
          apgc015   LIKE apgc_t.apgc015, #存提碼
          apgc016   LIKE apgc_t.apgc016, #現金變動碼
          apgc100   LIKE apgc_t.apgc100, #幣別
          apgc101   LIKE apgc_t.apgc101, #匯率
          apgc103   LIKE apgc_t.apgc103, #原幣未稅金額
          apgc104   LIKE apgc_t.apgc104, #稅額
          apgc105   LIKE apgc_t.apgc105, #原幣含稅金額
          apgc113   LIKE apgc_t.apgc113, #本幣未稅金額
          apgc114   LIKE apgc_t.apgc114, #本幣稅額
          apgc115   LIKE apgc_t.apgc115, #本幣含稅金額
          apgcud001 LIKE apgc_t.apgcud001, #自定義欄位(文字)001
          apgcud002 LIKE apgc_t.apgcud002, #自定義欄位(文字)002
          apgcud003 LIKE apgc_t.apgcud003, #自定義欄位(文字)003
          apgcud004 LIKE apgc_t.apgcud004, #自定義欄位(文字)004
          apgcud005 LIKE apgc_t.apgcud005, #自定義欄位(文字)005
          apgcud006 LIKE apgc_t.apgcud006, #自定義欄位(文字)006
          apgcud007 LIKE apgc_t.apgcud007, #自定義欄位(文字)007
          apgcud008 LIKE apgc_t.apgcud008, #自定義欄位(文字)008
          apgcud009 LIKE apgc_t.apgcud009, #自定義欄位(文字)009
          apgcud010 LIKE apgc_t.apgcud010, #自定義欄位(文字)010
          apgcud011 LIKE apgc_t.apgcud011, #自定義欄位(數字)011
          apgcud012 LIKE apgc_t.apgcud012, #自定義欄位(數字)012
          apgcud013 LIKE apgc_t.apgcud013, #自定義欄位(數字)013
          apgcud014 LIKE apgc_t.apgcud014, #自定義欄位(數字)014
          apgcud015 LIKE apgc_t.apgcud015, #自定義欄位(數字)015
          apgcud016 LIKE apgc_t.apgcud016, #自定義欄位(數字)016
          apgcud017 LIKE apgc_t.apgcud017, #自定義欄位(數字)017
          apgcud018 LIKE apgc_t.apgcud018, #自定義欄位(數字)018
          apgcud019 LIKE apgc_t.apgcud019, #自定義欄位(數字)019
          apgcud020 LIKE apgc_t.apgcud020, #自定義欄位(數字)020
          apgcud021 LIKE apgc_t.apgcud021, #自定義欄位(日期時間)021
          apgcud022 LIKE apgc_t.apgcud022, #自定義欄位(日期時間)022
          apgcud023 LIKE apgc_t.apgcud023, #自定義欄位(日期時間)023
          apgcud024 LIKE apgc_t.apgcud024, #自定義欄位(日期時間)024
          apgcud025 LIKE apgc_t.apgcud025, #自定義欄位(日期時間)025
          apgcud026 LIKE apgc_t.apgcud026, #自定義欄位(日期時間)026
          apgcud027 LIKE apgc_t.apgcud027, #自定義欄位(日期時間)027
          apgcud028 LIKE apgc_t.apgcud028, #自定義欄位(日期時間)028
          apgcud029 LIKE apgc_t.apgcud029, #自定義欄位(日期時間)029
          apgcud030 LIKE apgc_t.apgcud030  #自定義欄位(日期時間)030
              END RECORD
   DEFINE l_apcb  RECORD  #應付憑單單身
          apcbent   LIKE apcb_t.apcbent, #企業編號
          apcbld    LIKE apcb_t.apcbld, #帳套
          apcblegl  LIKE apcb_t.apcblegl, #核算組織
          apcborga  LIKE apcb_t.apcborga, #帳務歸屬組織(來源組織)
          apcbsite  LIKE apcb_t.apcbsite, #應付帳務組織
          apcbdocno LIKE apcb_t.apcbdocno, #單號
          apcbseq   LIKE apcb_t.apcbseq, #項次
          apcb001   LIKE apcb_t.apcb001, #來源類型
          apcb002   LIKE apcb_t.apcb002, #來源業務單據號碼
          apcb003   LIKE apcb_t.apcb003, #來源業務單據項次
          apcb004   LIKE apcb_t.apcb004, #產品編號
          apcb005   LIKE apcb_t.apcb005, #品名規格
          apcb006   LIKE apcb_t.apcb006, #單位
          apcb007   LIKE apcb_t.apcb007, #計價數量
          apcb008   LIKE apcb_t.apcb008, #參考單據號碼
          apcb009   LIKE apcb_t.apcb009, #參考單據項次
          apcb010   LIKE apcb_t.apcb010, #業務部門
          apcb011   LIKE apcb_t.apcb011, #責任中心
          apcb012   LIKE apcb_t.apcb012, #產品類別
          apcb013   LIKE apcb_t.apcb013, #搭贈
          apcb014   LIKE apcb_t.apcb014, #理由碼
          apcb015   LIKE apcb_t.apcb015, #專案編號
          apcb016   LIKE apcb_t.apcb016, #WBS編號
          apcb017   LIKE apcb_t.apcb017, #預算細項
          apcb018   LIKE apcb_t.apcb018, #专柜编号
          apcb019   LIKE apcb_t.apcb019, #開票性質
          apcb020   LIKE apcb_t.apcb020, #稅別
          apcb021   LIKE apcb_t.apcb021, #費用會計科目
          apcb022   LIKE apcb_t.apcb022, #正負值
          apcb023   LIKE apcb_t.apcb023, #沖暫估單否
          apcb024   LIKE apcb_t.apcb024, #區域
          apcb025   LIKE apcb_t.apcb025, #傳票號碼
          apcb026   LIKE apcb_t.apcb026, #傳票項次
          apcb027   LIKE apcb_t.apcb027, #發票編號
          apcb028   LIKE apcb_t.apcb028, #發票號碼
          apcb029   LIKE apcb_t.apcb029, #應付帳款科目
          apcb030   LIKE apcb_t.apcb030, #付款條件
          apcb032   LIKE apcb_t.apcb032, #訂金序次
          apcb033   LIKE apcb_t.apcb033, #經營方式
          apcb034   LIKE apcb_t.apcb034, #通路
          apcb035   LIKE apcb_t.apcb035, #品牌
          apcb036   LIKE apcb_t.apcb036, #客群
          apcb037   LIKE apcb_t.apcb037, #自由核算項一
          apcb038   LIKE apcb_t.apcb038, #自由核算項二
          apcb039   LIKE apcb_t.apcb039, #自由核算項三
          apcb040   LIKE apcb_t.apcb040, #自由核算項四
          apcb041   LIKE apcb_t.apcb041, #自由核算項五
          apcb042   LIKE apcb_t.apcb042, #自由核算項六
          apcb043   LIKE apcb_t.apcb043, #自由核算項七
          apcb044   LIKE apcb_t.apcb044, #自由核算項八
          apcb045   LIKE apcb_t.apcb045, #自由核算項九
          apcb046   LIKE apcb_t.apcb046, #自由核算項十
          apcb047   LIKE apcb_t.apcb047, #摘要
          apcb048   LIKE apcb_t.apcb048, #來源訂購單號
          apcb049   LIKE apcb_t.apcb049, #開票單號
          apcb050   LIKE apcb_t.apcb050, #開票項次
          apcb051   LIKE apcb_t.apcb051, #業務人員
          apcb100   LIKE apcb_t.apcb100, #交易原幣
          apcb101   LIKE apcb_t.apcb101, #交易原幣單價
          apcb102   LIKE apcb_t.apcb102, #原幣匯率
          apcb103   LIKE apcb_t.apcb103, #交易原幣未稅金額
          apcb104   LIKE apcb_t.apcb104, #交易原幣稅額
          apcb105   LIKE apcb_t.apcb105, #交易原幣含稅金額
          apcb106   LIKE apcb_t.apcb106, #交易幣標準成本金額
          apcb107   LIKE apcb_t.apcb107, #入庫單單價
          apcb108   LIKE apcb_t.apcb108, #交易原幣成本認列金額
          apcb111   LIKE apcb_t.apcb111, #本幣單價
          apcb113   LIKE apcb_t.apcb113, #本幣未稅金額
          apcb114   LIKE apcb_t.apcb114, #本幣稅額
          apcb115   LIKE apcb_t.apcb115, #本幣含稅金額
          apcb116   LIKE apcb_t.apcb116, #本幣標準成本金額
          apcb117   LIKE apcb_t.apcb117, #NO USE
          apcb118   LIKE apcb_t.apcb118, #本幣成本認列金額
          apcb119   LIKE apcb_t.apcb119, #應開發票含稅金額
          apcb121   LIKE apcb_t.apcb121, #本位幣二匯率
          apcb123   LIKE apcb_t.apcb123, #本位幣二未稅金額
          apcb124   LIKE apcb_t.apcb124, #本位幣二稅額
          apcb125   LIKE apcb_t.apcb125, #本位幣二含稅金額
          apcb126   LIKE apcb_t.apcb126, #本幣二標準成本金額
          apcb127   LIKE apcb_t.apcb127, #NO USE
          apcb128   LIKE apcb_t.apcb128, #本位幣二成本認列金額
          apcb131   LIKE apcb_t.apcb131, #本位幣三匯率
          apcb133   LIKE apcb_t.apcb133, #本位幣三未稅金額
          apcb134   LIKE apcb_t.apcb134, #本位幣三稅額
          apcb135   LIKE apcb_t.apcb135, #本位幣三含稅金額
          apcb136   LIKE apcb_t.apcb136, #本幣三標準成本金額
          apcb137   LIKE apcb_t.apcb137, #NO USE
          apcb138   LIKE apcb_t.apcb138, #本位幣三成本認列金額
          apcbud001 LIKE apcb_t.apcbud001, #自定義欄位(文字)001
          apcbud002 LIKE apcb_t.apcbud002, #自定義欄位(文字)002
          apcbud003 LIKE apcb_t.apcbud003, #自定義欄位(文字)003
          apcbud004 LIKE apcb_t.apcbud004, #自定義欄位(文字)004
          apcbud005 LIKE apcb_t.apcbud005, #自定義欄位(文字)005
          apcbud006 LIKE apcb_t.apcbud006, #自定義欄位(文字)006
          apcbud007 LIKE apcb_t.apcbud007, #自定義欄位(文字)007
          apcbud008 LIKE apcb_t.apcbud008, #自定義欄位(文字)008
          apcbud009 LIKE apcb_t.apcbud009, #自定義欄位(文字)009
          apcbud010 LIKE apcb_t.apcbud010, #自定義欄位(文字)010
          apcbud011 LIKE apcb_t.apcbud011, #自定義欄位(數字)011
          apcbud012 LIKE apcb_t.apcbud012, #自定義欄位(數字)012
          apcbud013 LIKE apcb_t.apcbud013, #自定義欄位(數字)013
          apcbud014 LIKE apcb_t.apcbud014, #自定義欄位(數字)014
          apcbud015 LIKE apcb_t.apcbud015, #自定義欄位(數字)015
          apcbud016 LIKE apcb_t.apcbud016, #自定義欄位(數字)016
          apcbud017 LIKE apcb_t.apcbud017, #自定義欄位(數字)017
          apcbud018 LIKE apcb_t.apcbud018, #自定義欄位(數字)018
          apcbud019 LIKE apcb_t.apcbud019, #自定義欄位(數字)019
          apcbud020 LIKE apcb_t.apcbud020, #自定義欄位(數字)020
          apcbud021 LIKE apcb_t.apcbud021, #自定義欄位(日期時間)021
          apcbud022 LIKE apcb_t.apcbud022, #自定義欄位(日期時間)022
          apcbud023 LIKE apcb_t.apcbud023, #自定義欄位(日期時間)023
          apcbud024 LIKE apcb_t.apcbud024, #自定義欄位(日期時間)024
          apcbud025 LIKE apcb_t.apcbud025, #自定義欄位(日期時間)025
          apcbud026 LIKE apcb_t.apcbud026, #自定義欄位(日期時間)026
          apcbud027 LIKE apcb_t.apcbud027, #自定義欄位(日期時間)027
          apcbud028 LIKE apcb_t.apcbud028, #自定義欄位(日期時間)028
          apcbud029 LIKE apcb_t.apcbud029, #自定義欄位(日期時間)029
          apcbud030 LIKE apcb_t.apcbud030, #自定義欄位(日期時間)030
          apcb052   LIKE apcb_t.apcb052, #稅額
          apcb053   LIKE apcb_t.apcb053, #含稅金額
          apcb054   LIKE apcb_t.apcb054, #帳款對象
          apcb055   LIKE apcb_t.apcb055  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sql     STRING
   #DEFINE l_isam    RECORD LIKE isam_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_isam  RECORD  #進項發票主檔
          isament   LIKE isam_t.isament, #企業編號
          isamownid LIKE isam_t.isamownid, #資料所有者
          isamowndp LIKE isam_t.isamowndp, #資料所屬部門
          isamcrtid LIKE isam_t.isamcrtid, #資料建立者
          isamcrtdp LIKE isam_t.isamcrtdp, #資料建立部門
          isamcrtdt LIKE isam_t.isamcrtdt, #資料創建日
          isammodid LIKE isam_t.isammodid, #資料修改者
          isammoddt LIKE isam_t.isammoddt, #最近修改日
          isamcnfid LIKE isam_t.isamcnfid, #資料確認者
          isamcnfdt LIKE isam_t.isamcnfdt, #資料確認日
          isamstus  LIKE isam_t.isamstus, #狀態碼
          isamcomp  LIKE isam_t.isamcomp, #法人
          isamdocno LIKE isam_t.isamdocno, #收票單號
          isamseq   LIKE isam_t.isamseq, #項次
          isam001   LIKE isam_t.isam001, #發票來源
          isam002   LIKE isam_t.isam002, #開發票人
          isam004   LIKE isam_t.isam004, #帳務中心(業務組織)
          isam006   LIKE isam_t.isam006, #業務部門(登錄部門)
          isam008   LIKE isam_t.isam008, #發票類型
          isam009   LIKE isam_t.isam009, #銷方發票編號
          isam010   LIKE isam_t.isam010, #發票號碼
          isam011   LIKE isam_t.isam011, #發票日期
          isam012   LIKE isam_t.isam012, #稅別
          isam0121  LIKE isam_t.isam0121, #含稅否
          isam013   LIKE isam_t.isam013, #稅率
          isam014   LIKE isam_t.isam014, #幣別
          isam015   LIKE isam_t.isam015, #匯率
          isam016   LIKE isam_t.isam016, #購貨方名稱
          isam017   LIKE isam_t.isam017, #購貨方統一編號
          isam018   LIKE isam_t.isam018, #購貨方地址
          isam019   LIKE isam_t.isam019, #購貨方電話
          isam020   LIKE isam_t.isam020, #購貨方開戶銀行
          isam021   LIKE isam_t.isam021, #購貨方帳戶編碼
          isam022   LIKE isam_t.isam022, #銷方銀行帳戶編碼
          isam023   LIKE isam_t.isam023, #發票原幣未稅金額
          isam024   LIKE isam_t.isam024, #發票原幣稅額
          isam025   LIKE isam_t.isam025, #發票原幣含稅金額
          isam026   LIKE isam_t.isam026, #發票本幣未稅金額
          isam027   LIKE isam_t.isam027, #發票本幣稅額
          isam028   LIKE isam_t.isam028, #發票本幣含稅金額
          isam029   LIKE isam_t.isam029, #銷貨方名稱
          isam030   LIKE isam_t.isam030, #統一編號
          isam031   LIKE isam_t.isam031, #銷貨方地址
          isam032   LIKE isam_t.isam032, #銷貨方電話
          isam033   LIKE isam_t.isam033, #銷貨方開戶銀行
          isam034   LIKE isam_t.isam034, #銷貨方帳號
          isam035   LIKE isam_t.isam035, #申報數量
          isam036   LIKE isam_t.isam036, #異動狀態
          isam037   LIKE isam_t.isam037, #可扣抵編號
          isam038   LIKE isam_t.isam038, #作廢(註銷)理由碼
          isam039   LIKE isam_t.isam039, #作廢日期
          isam040   LIKE isam_t.isam040, #作廢時間
          isam041   LIKE isam_t.isam041, #作廢人員
          isam042   LIKE isam_t.isam042, #專案作廢核准文號
          isam043   LIKE isam_t.isam043, #通關方式註記
          isam044   LIKE isam_t.isam044, #列印次數
          isam045   LIKE isam_t.isam045, #支付工具卡號1
          isam046   LIKE isam_t.isam046, #支付工具卡號2
          isam047   LIKE isam_t.isam047, #支付工具卡號3
          isam048   LIKE isam_t.isam048, #通關註記
          isam049   LIKE isam_t.isam049, #備註說明
          isam050   LIKE isam_t.isam050, #立帳單號
          isam107   LIKE isam_t.isam107, #發票原幣已折金額
          isam108   LIKE isam_t.isam108, #發票原幣已折稅額
          isam117   LIKE isam_t.isam117, #發票本幣已折金額
          isam118   LIKE isam_t.isam118, #發票本幣已折稅額
          isam200   LIKE isam_t.isam200, #電子發票否
          isam201   LIKE isam_t.isam201, #愛心碼
          isam202   LIKE isam_t.isam202, #載具類別號碼
          isam203   LIKE isam_t.isam203, #載具顯碼 ID
          isam204   LIKE isam_t.isam204, #載具隱碼 ID
          isam205   LIKE isam_t.isam205, #電子發票匯出狀態
          isam206   LIKE isam_t.isam206, #電子發票匯出序號
          isam207   LIKE isam_t.isam207, #電子發票領取方式
          isam208   LIKE isam_t.isam208, #申報年度
          isam209   LIKE isam_t.isam209, #申報月份
          isam210   LIKE isam_t.isam210, #申報據點
          isamud001 LIKE isam_t.isamud001, #自定義欄位(文字)001
          isamud002 LIKE isam_t.isamud002, #自定義欄位(文字)002
          isamud003 LIKE isam_t.isamud003, #自定義欄位(文字)003
          isamud004 LIKE isam_t.isamud004, #自定義欄位(文字)004
          isamud005 LIKE isam_t.isamud005, #自定義欄位(文字)005
          isamud006 LIKE isam_t.isamud006, #自定義欄位(文字)006
          isamud007 LIKE isam_t.isamud007, #自定義欄位(文字)007
          isamud008 LIKE isam_t.isamud008, #自定義欄位(文字)008
          isamud009 LIKE isam_t.isamud009, #自定義欄位(文字)009
          isamud010 LIKE isam_t.isamud010, #自定義欄位(文字)010
          isamud011 LIKE isam_t.isamud011, #自定義欄位(數字)011
          isamud012 LIKE isam_t.isamud012, #自定義欄位(數字)012
          isamud013 LIKE isam_t.isamud013, #自定義欄位(數字)013
          isamud014 LIKE isam_t.isamud014, #自定義欄位(數字)014
          isamud015 LIKE isam_t.isamud015, #自定義欄位(數字)015
          isamud016 LIKE isam_t.isamud016, #自定義欄位(數字)016
          isamud017 LIKE isam_t.isamud017, #自定義欄位(數字)017
          isamud018 LIKE isam_t.isamud018, #自定義欄位(數字)018
          isamud019 LIKE isam_t.isamud019, #自定義欄位(數字)019
          isamud020 LIKE isam_t.isamud020, #自定義欄位(數字)020
          isamud021 LIKE isam_t.isamud021, #自定義欄位(日期時間)021
          isamud022 LIKE isam_t.isamud022, #自定義欄位(日期時間)022
          isamud023 LIKE isam_t.isamud023, #自定義欄位(日期時間)023
          isamud024 LIKE isam_t.isamud024, #自定義欄位(日期時間)024
          isamud025 LIKE isam_t.isamud025, #自定義欄位(日期時間)025
          isamud026 LIKE isam_t.isamud026, #自定義欄位(日期時間)026
          isamud027 LIKE isam_t.isamud027, #自定義欄位(日期時間)027
          isamud028 LIKE isam_t.isamud028, #自定義欄位(日期時間)028
          isamud029 LIKE isam_t.isamud029, #自定義欄位(日期時間)029
          isamud030 LIKE isam_t.isamud030, #自定義欄位(日期時間)030
          isam051   LIKE isam_t.isam051  #認證否
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_ooef002     LIKE ooef_t.ooef002
   DEFINE l_ooefl006    LIKE ooefl_t.ooefl006
   DEFINE l_pmaal003    LIKE pmaal_t.pmaal003
   DEFINE l_isao001     LIKE isao_t.isao001
   DEFINE l_dummy1      LIKE type_t.num20_6
   #DEFINE l_apde        RECORD LIKE apde_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apde RECORD  #付款及差異處理明細檔
          apdeent   LIKE apde_t.apdeent, #企業編號
          apdecomp  LIKE apde_t.apdecomp, #法人
          apdeld    LIKE apde_t.apdeld, #帳套
          apdedocno LIKE apde_t.apdedocno, #沖銷單單號
          apdeseq   LIKE apde_t.apdeseq, #項次
          apdesite  LIKE apde_t.apdesite, #帳務中心
          apdeorga  LIKE apde_t.apdeorga, #帳務歸屬組織
          apde001   LIKE apde_t.apde001, #來源作業
          apde002   LIKE apde_t.apde002, #沖銷帳款類型
          apde003   LIKE apde_t.apde003, #已付款單號
          apde004   LIKE apde_t.apde004, #沖銷單項次
          apde006   LIKE apde_t.apde006, #款別編號
          apde008   LIKE apde_t.apde008, #帳戶/票券號碼
          apde009   LIKE apde_t.apde009, #已轉資料
          apde010   LIKE apde_t.apde010, #摘要說明
          apde011   LIKE apde_t.apde011, #銀行存提碼
          apde012   LIKE apde_t.apde012, #現金變動碼
          apde013   LIKE apde_t.apde013, #轉入客商碼
          apde014   LIKE apde_t.apde014, #轉入帳款單編號
          apde015   LIKE apde_t.apde015, #沖銷加減項
          apde016   LIKE apde_t.apde016, #沖銷會科
          apde017   LIKE apde_t.apde017, #業務人員
          apde018   LIKE apde_t.apde018, #業務部門
          apde019   LIKE apde_t.apde019, #責任中心
          apde020   LIKE apde_t.apde020, #產品類別
          apde021   LIKE apde_t.apde021, #票據類型
          apde022   LIKE apde_t.apde022, #專案編號
          apde023   LIKE apde_t.apde023, #WBS編號
          apde024   LIKE apde_t.apde024, #票據號碼
          apde028   LIKE apde_t.apde028, #產生方式
          apde029   LIKE apde_t.apde029, #傳票號碼
          apde030   LIKE apde_t.apde030, #傳票項次
          apde032   LIKE apde_t.apde032, #付款日
          apde035   LIKE apde_t.apde035, #區域
          apde036   LIKE apde_t.apde036, #客群
          apde038   LIKE apde_t.apde038, #對象
          apde039   LIKE apde_t.apde039, #受款銀行
          apde040   LIKE apde_t.apde040, #受款帳號
          apde041   LIKE apde_t.apde041, #受款人全名
          apde042   LIKE apde_t.apde042, #經營方式
          apde043   LIKE apde_t.apde043, #通路
          apde044   LIKE apde_t.apde044, #品牌
          apde045   LIKE apde_t.apde045, #摘要
          apde046   LIKE apde_t.apde046, #付款申請單
          apde047   LIKE apde_t.apde047, #付款申請單項次
          apde051   LIKE apde_t.apde051, #自由核算項一
          apde052   LIKE apde_t.apde052, #自由核算項二
          apde053   LIKE apde_t.apde053, #自由核算項三
          apde054   LIKE apde_t.apde054, #自由核算項四
          apde055   LIKE apde_t.apde055, #自由核算項五
          apde056   LIKE apde_t.apde056, #自由核算項六
          apde057   LIKE apde_t.apde057, #自由核算項七
          apde058   LIKE apde_t.apde058, #自由核算項八
          apde059   LIKE apde_t.apde059, #自由核算項九
          apde060   LIKE apde_t.apde060, #自由核算項十
          apde100   LIKE apde_t.apde100, #幣別
          apde101   LIKE apde_t.apde101, #匯率
          apde104   LIKE apde_t.apde104, #原幣應稅折抵稅額
          apde109   LIKE apde_t.apde109, #原幣沖帳金額
          apde119   LIKE apde_t.apde119, #本幣沖帳金額
          apde120   LIKE apde_t.apde120, #本位幣二幣別
          apde121   LIKE apde_t.apde121, #本位幣二匯率
          apde129   LIKE apde_t.apde129, #本位幣二沖帳金額
          apde130   LIKE apde_t.apde130, #本位幣三幣別
          apde131   LIKE apde_t.apde131, #本位幣三匯率
          apde139   LIKE apde_t.apde139, #本位幣三沖帳金額
          apdeud001 LIKE apde_t.apdeud001, #自定義欄位(文字)001
          apdeud002 LIKE apde_t.apdeud002, #自定義欄位(文字)002
          apdeud003 LIKE apde_t.apdeud003, #自定義欄位(文字)003
          apdeud004 LIKE apde_t.apdeud004, #自定義欄位(文字)004
          apdeud005 LIKE apde_t.apdeud005, #自定義欄位(文字)005
          apdeud006 LIKE apde_t.apdeud006, #自定義欄位(文字)006
          apdeud007 LIKE apde_t.apdeud007, #自定義欄位(文字)007
          apdeud008 LIKE apde_t.apdeud008, #自定義欄位(文字)008
          apdeud009 LIKE apde_t.apdeud009, #自定義欄位(文字)009
          apdeud010 LIKE apde_t.apdeud010, #自定義欄位(文字)010
          apdeud011 LIKE apde_t.apdeud011, #自定義欄位(數字)011
          apdeud012 LIKE apde_t.apdeud012, #自定義欄位(數字)012
          apdeud013 LIKE apde_t.apdeud013, #自定義欄位(數字)013
          apdeud014 LIKE apde_t.apdeud014, #自定義欄位(數字)014
          apdeud015 LIKE apde_t.apdeud015, #自定義欄位(數字)015
          apdeud016 LIKE apde_t.apdeud016, #自定義欄位(數字)016
          apdeud017 LIKE apde_t.apdeud017, #自定義欄位(數字)017
          apdeud018 LIKE apde_t.apdeud018, #自定義欄位(數字)018
          apdeud019 LIKE apde_t.apdeud019, #自定義欄位(數字)019
          apdeud020 LIKE apde_t.apdeud020, #自定義欄位(數字)020
          apdeud021 LIKE apde_t.apdeud021, #自定義欄位(日期時間)021
          apdeud022 LIKE apde_t.apdeud022, #自定義欄位(日期時間)022
          apdeud023 LIKE apde_t.apdeud023, #自定義欄位(日期時間)023
          apdeud024 LIKE apde_t.apdeud024, #自定義欄位(日期時間)024
          apdeud025 LIKE apde_t.apdeud025, #自定義欄位(日期時間)025
          apdeud026 LIKE apde_t.apdeud026, #自定義欄位(日期時間)026
          apdeud027 LIKE apde_t.apdeud027, #自定義欄位(日期時間)027
          apdeud028 LIKE apde_t.apdeud028, #自定義欄位(日期時間)028
          apdeud029 LIKE apde_t.apdeud029, #自定義欄位(日期時間)029
          apdeud030 LIKE apde_t.apdeud030, #自定義欄位(日期時間)030
          apde061   LIKE apde_t.apde061  #應付來源
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_pmab055     LIKE pmab_t.pmab055
   DEFINE l_glaa121     LIKE glaa_t.glaa121
   DEFINE l_glaa016     LIKE glaa_t.glaa016
   DEFINE l_glaa020     LIKE glaa_t.glaa020
   DEFINE l_glaa019     LIKE glaa_t.glaa019
   DEFINE l_glaa015     LIKE glaa_t.glaa015
   DEFINE l_glaa001     LIKE glaa_t.glaa001
   DEFINE r_docno       LIKE apga_t.apgadocno
   DEFINE l_date        DATETIME YEAR TO SECOND
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   DEFINE l_apcb113sum  LIKE type_t.num20_6
   DEFINE l_apcb114sum  LIKE type_t.num20_6
   DEFINE l_apcb115sum  LIKE type_t.num20_6
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   DEFINE l_oodb004     LIKE oodb_t.oodb004
   DEFINE l_apca013     LIKE apca_t.apca013
   DEFINE l_apca012     LIKE apca_t.apca012
   DEFINE l_oodb011     LIKE oodb_t.oodb011
   #albireo 1606301-----s
   #DEFINE l_apce        RECORD LIKE apce_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apce  RECORD  #應付沖帳明細
          apceent   LIKE apce_t.apceent, #企業編號
          apcecomp  LIKE apce_t.apcecomp, #法人
          apcelegl  LIKE apce_t.apcelegl, #核算組織
          apcesite  LIKE apce_t.apcesite, #帳務組織
          apceld    LIKE apce_t.apceld, #帳套
          apceorga  LIKE apce_t.apceorga, #帳務歸屬組織
          apcedocno LIKE apce_t.apcedocno, #沖銷單單號
          apceseq   LIKE apce_t.apceseq, #項次
          apce001   LIKE apce_t.apce001, #來源作業
          apce002   LIKE apce_t.apce002, #沖銷類型
          apce003   LIKE apce_t.apce003, #沖銷帳款單單號
          apce004   LIKE apce_t.apce004, #沖銷帳款單項次
          apce005   LIKE apce_t.apce005, #分期帳款序
          apce006   LIKE apce_t.apce006, #no use
          apce007   LIKE apce_t.apce007, #no use
          apce008   LIKE apce_t.apce008, #票據號碼/ 現金銀存帳戶
          apce009   LIKE apce_t.apce009, #no use
          apce010   LIKE apce_t.apce010, #摘要說明
          apce011   LIKE apce_t.apce011, #理由碼
          apce012   LIKE apce_t.apce012, #銀存存提碼
          apce013   LIKE apce_t.apce013, #現金異動碼
          apce014   LIKE apce_t.apce014, #no use
          apce015   LIKE apce_t.apce015, #沖銷加減項
          apce016   LIKE apce_t.apce016, #沖銷科目
          apce017   LIKE apce_t.apce017, #業務人員
          apce018   LIKE apce_t.apce018, #業務部門
          apce019   LIKE apce_t.apce019, #責任中心
          apce020   LIKE apce_t.apce020, #產品類別
          apce021   LIKE apce_t.apce021, #no use
          apce022   LIKE apce_t.apce022, #專案編號
          apce023   LIKE apce_t.apce023, #WBS編號
          apce024   LIKE apce_t.apce024, #第二參考單號
          apce025   LIKE apce_t.apce025, #第二參考單號項次
          apce026   LIKE apce_t.apce026, #no use
          apce027   LIKE apce_t.apce027, #應稅折抵否
          apce028   LIKE apce_t.apce028, #產生方式
          apce029   LIKE apce_t.apce029, #傳票號碼
          apce030   LIKE apce_t.apce030, #傳票項次
          apce031   LIKE apce_t.apce031, #付款(票)到期日
          apce032   LIKE apce_t.apce032, #應付款日
          apce033   LIKE apce_t.apce033, #no use
          apce034   LIKE apce_t.apce034, #no use
          apce035   LIKE apce_t.apce035, #區域
          apce036   LIKE apce_t.apce036, #客戶分類
          apce037   LIKE apce_t.apce037, #no use
          apce038   LIKE apce_t.apce038, #帳款對象
          apce039   LIKE apce_t.apce039, #no use
          apce040   LIKE apce_t.apce040, #no use
          apce041   LIKE apce_t.apce041, #no use
          apce042   LIKE apce_t.apce042, #no use
          apce043   LIKE apce_t.apce043, #no use
          apce044   LIKE apce_t.apce044, #經營方式
          apce045   LIKE apce_t.apce045, #通路
          apce046   LIKE apce_t.apce046, #品牌
          apce047   LIKE apce_t.apce047, #發票編號
          apce048   LIKE apce_t.apce048, #發票號碼
          apce049   LIKE apce_t.apce049, #付款申請單號碼
          apce050   LIKE apce_t.apce050, #付款申請單項次
          apce051   LIKE apce_t.apce051, #自由核算項一
          apce052   LIKE apce_t.apce052, #自由核算項二
          apce053   LIKE apce_t.apce053, #自由核算項三
          apce054   LIKE apce_t.apce054, #自由核算項四
          apce055   LIKE apce_t.apce055, #自由核算項五
          apce056   LIKE apce_t.apce056, #自由核算項六
          apce057   LIKE apce_t.apce057, #自由核算項七
          apce058   LIKE apce_t.apce058, #自由核算項八
          apce059   LIKE apce_t.apce059, #自由核算項九
          apce060   LIKE apce_t.apce060, #自由核算項十
          apce100   LIKE apce_t.apce100, #幣別
          apce101   LIKE apce_t.apce101, #匯率
          apce104   LIKE apce_t.apce104, #原幣應稅折抵稅額
          apce109   LIKE apce_t.apce109, #原幣沖帳金額
          apce114   LIKE apce_t.apce114, #本幣應稅折抵稅額
          apce119   LIKE apce_t.apce119, #本幣沖帳金額
          apce120   LIKE apce_t.apce120, #本位幣二幣別
          apce124   LIKE apce_t.apce124, #本位幣二應稅折抵稅額
          apce121   LIKE apce_t.apce121, #本位幣二匯率
          apce129   LIKE apce_t.apce129, #本位幣二沖帳金額
          apce130   LIKE apce_t.apce130, #本位幣三幣別
          apce131   LIKE apce_t.apce131, #本位幣三匯率
          apce134   LIKE apce_t.apce134, #本位幣三應稅折抵稅額
          apce139   LIKE apce_t.apce139, #本位幣三沖帳金額
          apceud001 LIKE apce_t.apceud001, #自定義欄位(文字)001
          apceud002 LIKE apce_t.apceud002, #自定義欄位(文字)002
          apceud003 LIKE apce_t.apceud003, #自定義欄位(文字)003
          apceud004 LIKE apce_t.apceud004, #自定義欄位(文字)004
          apceud005 LIKE apce_t.apceud005, #自定義欄位(文字)005
          apceud006 LIKE apce_t.apceud006, #自定義欄位(文字)006
          apceud007 LIKE apce_t.apceud007, #自定義欄位(文字)007
          apceud008 LIKE apce_t.apceud008, #自定義欄位(文字)008
          apceud009 LIKE apce_t.apceud009, #自定義欄位(文字)009
          apceud010 LIKE apce_t.apceud010, #自定義欄位(文字)010
          apceud011 LIKE apce_t.apceud011, #自定義欄位(數字)011
          apceud012 LIKE apce_t.apceud012, #自定義欄位(數字)012
          apceud013 LIKE apce_t.apceud013, #自定義欄位(數字)013
          apceud014 LIKE apce_t.apceud014, #自定義欄位(數字)014
          apceud015 LIKE apce_t.apceud015, #自定義欄位(數字)015
          apceud016 LIKE apce_t.apceud016, #自定義欄位(數字)016
          apceud017 LIKE apce_t.apceud017, #自定義欄位(數字)017
          apceud018 LIKE apce_t.apceud018, #自定義欄位(數字)018
          apceud019 LIKE apce_t.apceud019, #自定義欄位(數字)019
          apceud020 LIKE apce_t.apceud020, #自定義欄位(數字)020
          apceud021 LIKE apce_t.apceud021, #自定義欄位(日期時間)021
          apceud022 LIKE apce_t.apceud022, #自定義欄位(日期時間)022
          apceud023 LIKE apce_t.apceud023, #自定義欄位(日期時間)023
          apceud024 LIKE apce_t.apceud024, #自定義欄位(日期時間)024
          apceud025 LIKE apce_t.apceud025, #自定義欄位(日期時間)025
          apceud026 LIKE apce_t.apceud026, #自定義欄位(日期時間)026
          apceud027 LIKE apce_t.apceud027, #自定義欄位(日期時間)027
          apceud028 LIKE apce_t.apceud028, #自定義欄位(日期時間)028
          apceud029 LIKE apce_t.apceud029, #自定義欄位(日期時間)029
          apceud030 LIKE apce_t.apceud030, #自定義欄位(日期時間)030
          apce103   LIKE apce_t.apce103, #原幣未稅沖銷額
          apce113   LIKE apce_t.apce113, #本位未稅沖銷額
          apce123   LIKE apce_t.apce123, #本位幣二未稅沖銷額
          apce133   LIKE apce_t.apce133, #本位幣三未稅沖銷額
          apce061   LIKE apce_t.apce061  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sfin2002    LIKE type_t.chr10
   #albireo 1606301-----e
   #DEFINE l_apgl        RECORD LIKE apgl_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgl  RECORD  #外購到貨主檔
          apglent   LIKE apgl_t.apglent, #企業編號
          apglcomp  LIKE apgl_t.apglcomp, #法人
          apgldocno LIKE apgl_t.apgldocno, #到貨單號
          apgldocdt LIKE apgl_t.apgldocdt, #到貨日期
          apgl001   LIKE apgl_t.apgl001, #報關日期
          apgl002   LIKE apgl_t.apgl002, #供應商編號
          apgl003   LIKE apgl_t.apgl003, #L/C NO
          apgl004   LIKE apgl_t.apgl004, #申請單號
          apgl005   LIKE apgl_t.apgl005, #業務人員
          apgl006   LIKE apgl_t.apgl006, #報關行
          apgl007   LIKE apgl_t.apgl007, #裝運通知單號
          apgl008   LIKE apgl_t.apgl008, #運送方式
          apgl009   LIKE apgl_t.apgl009, #大提單單號
          apgl010   LIKE apgl_t.apgl010, #小提單單號
          apgl011   LIKE apgl_t.apgl011, #提單日期
          apgl012   LIKE apgl_t.apgl012, #起運日期
          apgl013   LIKE apgl_t.apgl013, #預計抵達日期
          apgl014   LIKE apgl_t.apgl014, #裝運公司
          apgl015   LIKE apgl_t.apgl015, #船名/航次
          apgl016   LIKE apgl_t.apgl016, #海關手冊
          apgl017   LIKE apgl_t.apgl017, #領櫃地點
          apgl018   LIKE apgl_t.apgl018, #領櫃編號
          apgl019   LIKE apgl_t.apgl019, #交櫃地點
          apgl020   LIKE apgl_t.apgl020, #櫃量
          apgl021   LIKE apgl_t.apgl021, #免費倉租日期
          apgl022   LIKE apgl_t.apgl022, #報單號碼
          apgl023   LIKE apgl_t.apgl023, #到單單號
          apgl024   LIKE apgl_t.apgl024, #稅款繳納證號
          apgl025   LIKE apgl_t.apgl025, #營業稅率
          apgl026   LIKE apgl_t.apgl026, #扣抵編號
          apgl027   LIKE apgl_t.apgl027, #本幣營業稅稅基
          apgl028   LIKE apgl_t.apgl028, #本幣稅費合計
          apgl029   LIKE apgl_t.apgl029, #收貨/入庫單號
          apgl030   LIKE apgl_t.apgl030, #到貨費用應付憑單
          apgl100   LIKE apgl_t.apgl100, #幣別
          apgl101   LIKE apgl_t.apgl101, #報單匯率
          apgl103   LIKE apgl_t.apgl103, #到貨原幣金額
          apglownid LIKE apgl_t.apglownid, #資料所有者
          apglowndp LIKE apgl_t.apglowndp, #資料所屬部門
          apglcrtid LIKE apgl_t.apglcrtid, #資料建立者
          apglcrtdp LIKE apgl_t.apglcrtdp, #資料建立部門
          apglcrtdt LIKE apgl_t.apglcrtdt, #資料創建日
          apglmodid LIKE apgl_t.apglmodid, #資料修改者
          apglmoddt LIKE apgl_t.apglmoddt, #最近修改日
          apglcnfid LIKE apgl_t.apglcnfid, #資料確認者
          apglcnfdt LIKE apgl_t.apglcnfdt, #資料確認日
          apglstus  LIKE apgl_t.apglstus, #狀態碼
          apglud001 LIKE apgl_t.apglud001, #自定義欄位(文字)001
          apglud002 LIKE apgl_t.apglud002, #自定義欄位(文字)002
          apglud003 LIKE apgl_t.apglud003, #自定義欄位(文字)003
          apglud004 LIKE apgl_t.apglud004, #自定義欄位(文字)004
          apglud005 LIKE apgl_t.apglud005, #自定義欄位(文字)005
          apglud006 LIKE apgl_t.apglud006, #自定義欄位(文字)006
          apglud007 LIKE apgl_t.apglud007, #自定義欄位(文字)007
          apglud008 LIKE apgl_t.apglud008, #自定義欄位(文字)008
          apglud009 LIKE apgl_t.apglud009, #自定義欄位(文字)009
          apglud010 LIKE apgl_t.apglud010, #自定義欄位(文字)010
          apglud011 LIKE apgl_t.apglud011, #自定義欄位(數字)011
          apglud012 LIKE apgl_t.apglud012, #自定義欄位(數字)012
          apglud013 LIKE apgl_t.apglud013, #自定義欄位(數字)013
          apglud014 LIKE apgl_t.apglud014, #自定義欄位(數字)014
          apglud015 LIKE apgl_t.apglud015, #自定義欄位(數字)015
          apglud016 LIKE apgl_t.apglud016, #自定義欄位(數字)016
          apglud017 LIKE apgl_t.apglud017, #自定義欄位(數字)017
          apglud018 LIKE apgl_t.apglud018, #自定義欄位(數字)018
          apglud019 LIKE apgl_t.apglud019, #自定義欄位(數字)019
          apglud020 LIKE apgl_t.apglud020, #自定義欄位(數字)020
          apglud021 LIKE apgl_t.apglud021, #自定義欄位(日期時間)021
          apglud022 LIKE apgl_t.apglud022, #自定義欄位(日期時間)022
          apglud023 LIKE apgl_t.apglud023, #自定義欄位(日期時間)023
          apglud024 LIKE apgl_t.apglud024, #自定義欄位(日期時間)024
          apglud025 LIKE apgl_t.apglud025, #自定義欄位(日期時間)025
          apglud026 LIKE apgl_t.apglud026, #自定義欄位(日期時間)026
          apglud027 LIKE apgl_t.apglud027, #自定義欄位(日期時間)027
          apglud028 LIKE apgl_t.apglud028, #自定義欄位(日期時間)028
          apglud029 LIKE apgl_t.apglud029, #自定義欄位(日期時間)029
          apglud030 LIKE apgl_t.apglud030, #自定義欄位(日期時間)030
          apgl113   LIKE apgl_t.apgl113  #到貨本幣金額
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_count       LIKE type_t.num10
   DEFINE l_xrcd009     LIKE xrcd_t.xrcd009
   DEFINE l_ooef011     LIKE ooef_t.ooef011 #161129-00042#1-add
   DEFINE l_isac004     LIKE isac_t.isac004 #161230-00036#1-add
   DEFINE l_isac008     LIKE isac_t.isac008 #161230-00036#1-add
   DEFINE l_vat_id      STRING              #161230-00036#1-add
   WHENEVER ERROR CONTINUE
   
   #補報關行預支待抵沖銷    160622 albireo
   
   LET r_success = TRUE
   LET r_docno   = NULL
   INITIALIZE l_apgl.* TO NULL
   #SELECT * INTO l_apgl.* FROM apgl_t WHERE apglent = g_enterprise AND apglcomp = g_apcacomp AND apgldocno = g_apca_m.apca018 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apglent,apglcomp,apgldocno,apgldocdt,apgl001,
          apgl002,apgl003,apgl004,apgl005,apgl006,
          apgl007,apgl008,apgl009,apgl010,apgl011,
          apgl012,apgl013,apgl014,apgl015,apgl016,
          apgl017,apgl018,apgl019,apgl020,apgl021,
          apgl022,apgl023,apgl024,apgl025,apgl026,
          apgl027,apgl028,apgl029,apgl030,apgl100,
          apgl101,apgl103,apglownid,apglowndp,apglcrtid,
          apglcrtdp,apglcrtdt,apglmodid,apglmoddt,apglcnfid,
          apglcnfdt,apglstus,apglud001,apglud002,apglud003,
          apglud004,apglud005,apglud006,apglud007,apglud008,
          apglud009,apglud010,apglud011,apglud012,apglud013,
          apglud014,apglud015,apglud016,apglud017,apglud018,
          apglud019,apglud020,apglud021,apglud022,apglud023,
          apglud024,apglud025,apglud026,apglud027,apglud028,
          apglud029,apglud030,apgl113
     INTO l_apgl.* 
     FROM apgl_t 
    WHERE apglent = g_enterprise 
      AND apglcomp = g_apcacomp 
      AND apgldocno = g_apca_m.apca018
   #161208-00026#13-add(e)
   INITIALIZE l_apga.* TO NULL
   #SELECT * INTO l_apga.* FROM apga_t WHERE apgaent = g_enterprise AND apgacomp = g_apcacomp AND apgadocno = l_apgl.apgl004 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgaent,apgaownid,apgaowndp,apgacrtid,apgacrtdp,
          apgacrtdt,apgamodid,apgamoddt,apgacnfid,apgacnfdt,
          apgapstid,apgapstdt,apgastus,apgacomp,apgadocno,
          apgadocdt,apga001,apga002,apga003,apga004,
          apga005,apga006,apga007,apga008,apga009,
          apga010,apga011,apga012,apga013,apga014,
          apga015,apga016,apga017,apga018,apga019,
          apga020,apga021,apga022,apga023,apga024,
          apga025,apga026,apga027,apga028,apga029,
          apga030,apga031,apga100,apga101,apga103,
          apga104,apga105,apga106,apga107,apga108,
          apga113,apga114,apga115,apgaud001,apgaud002,
          apgaud003,apgaud004,apgaud005,apgaud006,apgaud007,
          apgaud008,apgaud009,apgaud010,apgaud011,apgaud012,
          apgaud013,apgaud014,apgaud015,apgaud016,apgaud017,
          apgaud018,apgaud019,apgaud020,apgaud021,apgaud022,
          apgaud023,apgaud024,apgaud025,apgaud026,apgaud027,
          apgaud028,apgaud029,apgaud030,apga102,apga109,
          apga112,apga117,apga118,apga032,apga033,
          apga034,apga035,apga040,apga041,apga036,
          apga037,apga038,apga039 
     INTO l_apga.* 
     FROM apga_t 
    WHERE apgaent = g_enterprise
      AND apgacomp = g_apcacomp 
      AND apgadocno = l_apgl.apgl004
   #161208-00026#13-add(e)
   
   INITIALIZE l_apca.* TO NULL
   LET l_apca.apcaent = g_enterprise
   LET l_apca.apcacomp = l_apga.apgacomp
   LET l_apca.apcald = NULL
   SELECT glaald,glaa001,glaa016,glaa020
     INTO l_apca.apcald,l_apca.apca100,l_apca.apca120,l_apca.apca130
     FROM glaa_t
    WHERE glaaent  = g_enterprise
      AND glaacomp = l_apca.apcacomp
      AND glaa014  = 'Y'
   LET l_apca.apcadocdt = g_apca_m.apcadocdt
   LET l_apca.apca003   = g_apca_m.apca003
   LET l_apca.apca016   = g_apca_m.apca016
   LET l_apca.apca018   = g_apca_m.apca018
   LET l_apca.apcadocno = g_apca_m.apcadocno
   CALL s_aooi200_fin_gen_docno(l_apca.apcald,'','',l_apca.apcadocno,l_apca.apcadocdt,'aapt560') 
      RETURNING g_sub_success,l_apca.apcadocno                                            
   IF NOT g_sub_success THEN
      LET r_success = FALSE
      RETURN r_success,r_docno
   END IF
   LET l_apca.apcastus  = 'N' # 狀態碼 
   LET l_apca.apcasite = l_apca.apcacomp   # 帳務中心                            apcasite   = apgccomp                                                    
   LET l_apca.apca001 =  '31'    #s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3001')
   LET l_apca.apca003 = g_user # 帳務人員                            apca003    = g_user                                                      
   LET l_apca.apca004 = l_apgl.apgl006 # 帳款對象編號                        apca004    = 廠商(受益人)apga004   
   CALL s_apmm100_sel_pmac002(l_apca.apca004,'1') RETURNING l_apca.apca005,l_desc
   IF cl_null(l_apca.apca005)THEN LET l_apca.apca005 = l_apca.apca004 END IF
   SELECT pmaa080,pmaa047 INTO l_apca.apca006,l_apca.apca046
     FROM pmaa_t
    WHERE pmaaent = g_enterprise AND pmaa001 = l_apca.apca004
   LET lc_param_apca.apcald   = l_apca.apcald
   LET lc_param_apca.apcacomp = l_apca.apcacomp
   LET lc_param_apca.apcasite = l_apca.apcasite
   LET lc_param_apca.apcadocdt= l_apca.apcadocdt
   LET lc_param_apca.apca001  = '19'   #l_apca.apca001
   LET lc_param_apca.apca004  = l_apca.apca004
   SELECT ooef019 INTO lc_param_apca.ooef019 FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = l_apca.apcacomp
   LET ls_js = util.JSON.stringify(lc_param_apca)
   CALL s_aapt300_get_apca004_info(ls_js) RETURNING ls_js
   CALL util.JSON.parse(ls_js,lc_param_info)
   LET l_apca.apca006 = lc_param_info.apca006  
   LET l_apca.apca007 = lc_param_info.apca007   # 帳款類別           apca007    = 廠商慣用條件
   LET l_apca.apca008 = lc_param_info.apca008   # 付款條件編號       apca008    = 取交易對象慣用付款條件
   LET l_apca.apca009 = lc_param_info.apca009   # 應付款日/應扣抵日  apca009    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca010 = lc_param_info.apca010   # 容許票據到期日     apca010    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca011 = lc_param_info.apca011   # 稅別               apca011    = 取交易對象慣用稅別,實際稅別在單身呈現
   LET l_apca.apca012 = lc_param_info.apca012   # 稅率               apca012    = 依稅別串 oodb006
   LET l_apca.apca013 = lc_param_info.apca013   # 含稅否             apca013    = 依稅別串 oodb005                   
   LET l_apca.apca014 = l_apga.apga005          # 人員編號           apca014    = apga005
   LET l_apca.apca015 = NULL                    # 部門編號           apca015    = apga005 所屬部門
   SELECT ooag003 INTO l_apca.apca015 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apca.apca014 
   LET l_apca.apca034 = lc_param_info.apca034   # 責任中心                            apca034    = 依 aapt300原則帶出      
   LET l_apca.apca035 = lc_param_info.apca035   # 應付(貸方)科目編號                  apca035    = 依帳款類別帶出           
   LET l_apca.apca036 = lc_param_info.apca036   # 費用(借方)科目編號                  apca036    = 依帳款類別帶出     
   LET l_apca.apca046 = lc_param_info.apca046       
   LET l_apca.apca054 = lc_param_info.apca054   # 多帳期設定                          apca054    = 依付款條件取出 
   LET l_apca.apca055 = lc_param_info.apca055   # 繳款優惠條件                        apca055    = 依付款條件取出 
   LET l_apca.apca058 = lc_param_info.apca058
   LET l_apca.apca060 = lc_param_info.apca060
   LET l_apca.apca016 = '35'
   LET l_apca.apca017 = '1'
   #LET l_apca.apca018 = l_apga.apgadocno   #160824-00049#7 mark
   LET l_apca.apca020 = 'N'         # 信用狀付款否 
   LET l_apca.apca026 = 0
   LET l_apca.apca027 = 0
   LET l_apca.apca028 = 0
   LET l_apca.apca029 = 0
   LET l_apca.apca037 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-0030')# 產生傳票否                          apca037    = 取單別參數D-FIN-0030    
   LET l_apca.apca067 = l_apga.apgadocno
   LET l_apca.apca101 = 1
   LET l_apca.apca103 = 0
   LET l_apca.apca104 = 0
   LET l_apca.apca106 = 0 
   LET l_apca.apca107 = 0
   LET l_apca.apca108 = 0 
   LET l_apca.apca113 = 0
   LET l_apca.apca114 = 0 
   LET l_apca.apca116 = 0
   LEt l_apca.apca117 = 0 
   LET l_apca.apca118 = 0 
   LET lc_param2.apca004 = l_apca.apca004
   CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-3009') RETURNING lc_param2.sfin2009
   LET ls_js = util.JSON.stringify(lc_param2)   
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apca.apca100,ls_js)
        RETURNING l_apca.apca101,l_apca.apca121,l_apca.apca131
   LET l_apca.apca123 = 0
   LET l_apca.apca124 = 0
   LET l_apca.apca126 = 0 
   LET l_apca.apca127 = 0 
   LET l_apca.apca128 = 0
   LET l_apca.apca133 = 0 
   LET l_apca.apca134 = 0 
   LET l_apca.apca136 = 0 
   LET l_apca.apca137 = 0
   LET l_apca.apca138 = 0 
   LET l_apca.apca071 = 0
   LET l_apca.apca072 = 0
   #albireo 160624-----s
   LEt l_apca.apca073 = l_apga.apga001
   LET l_apca.apcaownid = g_user
   LET l_apca.apcaowndp = g_dept
   LET l_apca.apcacrtid = g_user
   LET l_apca.apcacrtdp = g_dept
   LET l_date = cl_get_current()
   LET l_apca.apcacrtdt = l_date
   #albireo 160624-----e
   #INSERT INTO apca_t VALUES(l_apca.*) #161108-00017#4 mark
   #161108-00017#4 add ------
   INSERT INTO apca_t (apcaent,apcaownid,apcaowndp,apcacrtid,apcacrtdp,
                       apcacrtdt,apcamodid,apcamoddt,apcacnfid,apcacnfdt,
                       apcapstid,apcapstdt,apcastus,apcald,apcacomp,
                       apcadocno,apcadocdt,apcasite,
                       apca001,apca003,apca004,apca005,apca006,
                       apca007,apca008,apca009,apca010,apca011,
                       apca012,apca013,apca014,apca015,apca016,
                       apca017,apca018,apca019,apca020,apca021,
                       apca022,apca025,apca026,apca027,apca028,
                       apca029,apca030,apca031,apca032,apca033,
                       apca034,apca035,apca036,apca037,apca038,
                       apca039,apca040,apca041,apca042,apca043,
                       apca044,apca045,apca046,apca047,apca048,
                       apca049,apca050,apca051,apca052,apca053,
                       apca054,apca055,apca056,apca057,apca058,
                       apca059,apca060,apca061,apca062,apca063,
                       apca064,apca065,apca066,apca100,apca101,
                       apca103,apca104,apca106,apca107,apca108,
                       apca113,apca114,apca116,apca117,apca118,
                       apca120,apca121,apca123,apca124,apca126,
                       apca127,apca128,apca130,apca131,apca133,
                       apca134,apca136,apca137,apca138,
                       apcaud001,apcaud002,apcaud003,apcaud004,apcaud005,
                       apcaud006,apcaud007,apcaud008,apcaud009,apcaud010,
                       apcaud011,apcaud012,apcaud013,apcaud014,apcaud015,
                       apcaud016,apcaud017,apcaud018,apcaud019,apcaud020,
                       apcaud021,apcaud022,apcaud023,apcaud024,apcaud025,
                       apcaud026,apcaud027,apcaud028,apcaud029,apcaud030,
                       apca067,apca068,apca069,apca070,apca071,
                       apca072,apca073
                      )
   VALUES (l_apca.apcaent,l_apca.apcaownid,l_apca.apcaowndp,l_apca.apcacrtid,l_apca.apcacrtdp,
           l_apca.apcacrtdt,l_apca.apcamodid,l_apca.apcamoddt,l_apca.apcacnfid,l_apca.apcacnfdt,
           l_apca.apcapstid,l_apca.apcapstdt,l_apca.apcastus,l_apca.apcald,l_apca.apcacomp,
           l_apca.apcadocno,l_apca.apcadocdt,l_apca.apcasite,
           l_apca.apca001,l_apca.apca003,l_apca.apca004,l_apca.apca005,l_apca.apca006,
           l_apca.apca007,l_apca.apca008,l_apca.apca009,l_apca.apca010,l_apca.apca011,
           l_apca.apca012,l_apca.apca013,l_apca.apca014,l_apca.apca015,l_apca.apca016,
           l_apca.apca017,l_apca.apca018,l_apca.apca019,l_apca.apca020,l_apca.apca021,
           l_apca.apca022,l_apca.apca025,l_apca.apca026,l_apca.apca027,l_apca.apca028,
           l_apca.apca029,l_apca.apca030,l_apca.apca031,l_apca.apca032,l_apca.apca033,
           l_apca.apca034,l_apca.apca035,l_apca.apca036,l_apca.apca037,l_apca.apca038,
           l_apca.apca039,l_apca.apca040,l_apca.apca041,l_apca.apca042,l_apca.apca043,
           l_apca.apca044,l_apca.apca045,l_apca.apca046,l_apca.apca047,l_apca.apca048,
           l_apca.apca049,l_apca.apca050,l_apca.apca051,l_apca.apca052,l_apca.apca053,
           l_apca.apca054,l_apca.apca055,l_apca.apca056,l_apca.apca057,l_apca.apca058,
           l_apca.apca059,l_apca.apca060,l_apca.apca061,l_apca.apca062,l_apca.apca063,
           l_apca.apca064,l_apca.apca065,l_apca.apca066,l_apca.apca100,l_apca.apca101,
           l_apca.apca103,l_apca.apca104,l_apca.apca106,l_apca.apca107,l_apca.apca108,
           l_apca.apca113,l_apca.apca114,l_apca.apca116,l_apca.apca117,l_apca.apca118,
           l_apca.apca120,l_apca.apca121,l_apca.apca123,l_apca.apca124,l_apca.apca126,
           l_apca.apca127,l_apca.apca128,l_apca.apca130,l_apca.apca131,l_apca.apca133,
           l_apca.apca134,l_apca.apca136,l_apca.apca137,l_apca.apca138,
           l_apca.apcaud001,l_apca.apcaud002,l_apca.apcaud003,l_apca.apcaud004,l_apca.apcaud005,
           l_apca.apcaud006,l_apca.apcaud007,l_apca.apcaud008,l_apca.apcaud009,l_apca.apcaud010,
           l_apca.apcaud011,l_apca.apcaud012,l_apca.apcaud013,l_apca.apcaud014,l_apca.apcaud015,
           l_apca.apcaud016,l_apca.apcaud017,l_apca.apcaud018,l_apca.apcaud019,l_apca.apcaud020,
           l_apca.apcaud021,l_apca.apcaud022,l_apca.apcaud023,l_apca.apcaud024,l_apca.apcaud025,
           l_apca.apcaud026,l_apca.apcaud027,l_apca.apcaud028,l_apca.apcaud029,l_apca.apcaud030,
           l_apca.apca067,l_apca.apca068,l_apca.apca069,l_apca.apca070,l_apca.apca071,
           l_apca.apca072,l_apca.apca073
          )
   #161108-00017#4 add end---
   
   #apgc產生 apcb xrcd_t
   #LET l_sql = "SELECT * FROM apgc_t ", #161208-00026#13 mark
   #161208-00026#13-add(s)
   LET l_sql = "SELECT apgcent,apgccomp,apgcdocno,apgcseq,apgc900,
                       apgcorga,apgc001,apgc002,apgc003,apgc004,
                       apgc005,apgc006,apgc007,apgc008,apgc009,
                       apgc010,apgc011,apgc012,apgc013,apgc014,
                       apgc015,apgc016,apgc100,apgc101,apgc103,
                       apgc104,apgc105,apgc113,apgc114,apgc115,
                       apgcud001,apgcud002,apgcud003,apgcud004,apgcud005,
                       apgcud006,apgcud007,apgcud008,apgcud009,apgcud010,
                       apgcud011,apgcud012,apgcud013,apgcud014,apgcud015,
                       apgcud016,apgcud017,apgcud018,apgcud019,apgcud020,
                       apgcud021,apgcud022,apgcud023,apgcud024,apgcud025,
                       apgcud026,apgcud027,apgcud028,apgcud029,apgcud030 
                  FROM apgc_t ",
   #161208-00026#13-add(e)
               " WHERE apgcent = ",g_enterprise," ",
               "   AND apgccomp = '",l_apga.apgacomp,"' ",
               "   AND apgcdocno = '",l_apgl.apgldocno,"' ",
               "   AND apgc900 = '0' "
   PREPARE sel_apgcp5 FROM l_sql
   DECLARE sel_apgcc5 CURSOR FOR sel_apgcp5
   
   #FOREACH sel_apgcc5 INTO l_apgc.*  #161208-00026#13 mark
   #161208-00026#13-add(s)
   FOREACH sel_apgcc5 INTO l_apgc.apgcent,l_apgc.apgccomp,l_apgc.apgcdocno,l_apgc.apgcseq,l_apgc.apgc900,
                           l_apgc.apgcorga,l_apgc.apgc001,l_apgc.apgc002,l_apgc.apgc003,l_apgc.apgc004,
                           l_apgc.apgc005,l_apgc.apgc006,l_apgc.apgc007,l_apgc.apgc008,l_apgc.apgc009,
                           l_apgc.apgc010,l_apgc.apgc011,l_apgc.apgc012,l_apgc.apgc013,l_apgc.apgc014,
                           l_apgc.apgc015,l_apgc.apgc016,l_apgc.apgc100,l_apgc.apgc101,l_apgc.apgc103,
                           l_apgc.apgc104,l_apgc.apgc105,l_apgc.apgc113,l_apgc.apgc114,l_apgc.apgc115,
                           l_apgc.apgcud001,l_apgc.apgcud002,l_apgc.apgcud003,l_apgc.apgcud004,l_apgc.apgcud005,
                           l_apgc.apgcud006,l_apgc.apgcud007,l_apgc.apgcud008,l_apgc.apgcud009,l_apgc.apgcud010,
                           l_apgc.apgcud011,l_apgc.apgcud012,l_apgc.apgcud013,l_apgc.apgcud014,l_apgc.apgcud015,
                           l_apgc.apgcud016,l_apgc.apgcud017,l_apgc.apgcud018,l_apgc.apgcud019,l_apgc.apgcud020,
                           l_apgc.apgcud021,l_apgc.apgcud022,l_apgc.apgcud023,l_apgc.apgcud024,l_apgc.apgcud025,
                           l_apgc.apgcud026,l_apgc.apgcud027,l_apgc.apgcud028,l_apgc.apgcud029,l_apgc.apgcud030  
   #161208-00026#13-add(e)
      IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
      #r2.產生apcb-----s
      INITIALIZE l_apcb.* TO NULL
      LET l_apcb.apcbent   = g_enterprise
      LET l_apcb.apcbld    = l_apca.apcald
      LET l_apcb.apcblegl  = l_apca.apcacomp
      LET l_apcb.apcbsite  = l_apca.apcasite
      LET l_apcb.apcbdocno = l_apca.apcadocno
      LET l_apcb.apcbseq   = NULL
      SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
       WHERE apcbent   = g_enterprise
         AND apcbld    = l_apcb.apcbld
         AND apcbdocno = l_apcb.apcbdocno
      IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
      LET l_apcb.apcb001 = '54'
      LET l_apcb.apcb002 = l_apgc.apgcdocno
      LET l_apcb.apcb003 = l_apgc.apgcseq
      LET l_apcb.apcb014 = l_apgc.apgc001 #160428-00001#8       
      LET l_apcb.apcb005 = s_desc_get_acc_desc('3117',l_apgc.apgc001)
      LET l_apcb.apcb006 = ' '
      LET l_apcb.apcb007 = 1
      LET l_apcb.apcb010 = l_apca.apca015
      CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                       RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
      LET l_apcb.apcb020 = l_apgc.apgc006
      LET l_apcb.apcb021 = l_apgc.apgc004
      LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')   #albireo 160624 add
      LET l_apcb.apcb023 = 'N'
      LET l_apcb.apcb027 = l_apgc.apgc008
      LET l_apcb.apcb028 = l_apgc.apgc009
      LET l_apcb.apcb029 = l_apca.apca035
      LET l_apcb.apcb030 = l_apca.apca008
      LET l_apcb.apcb051 = l_apca.apca014
      LET l_apcb.apcb100 = l_apgc.apgc100
      LET l_apcb.apcb101 = l_apgc.apgc105   #albireo 160623 add
      LET l_apcb.apcb102 = l_apgc.apgc101
      LET l_apcb.apcb103 = l_apgc.apgc103
      LET l_apcb.apcb104 = l_apgc.apgc104
      LET l_apcb.apcb105 = l_apgc.apgc105
      LET l_apcb.apcb108 = l_apcb.apcb103
      LET l_apcb.apcb111 = l_apgc.apgc115   #albireo 160623 add
      LET l_apcb.apcb113 = l_apgc.apgc113
      LET l_apcb.apcb114 = l_apgc.apgc114
      LET l_apcb.apcb115 = l_apgc.apgc115
      LET l_apcb.apcborga = l_apgc.apgcorga
      CALL s_tax_chk(l_apca.apcacomp,l_apcb.apcb020) RETURNING g_sub_success,l_oodb004,l_apca013,l_apca012,l_oodb011
      IF l_apca013 = 'Y' THEN
         LET l_apcb.apcb105 = l_apcb.apcb105
      ELSE
         LET l_apcb.apcb105 = l_apcb.apcb103
      END IF
      CALL s_tax_ins(l_apca.apcadocno,l_apcb.apcbseq,'0',l_apcb.apcborga,l_apcb.apcb105,
                l_apcb.apcb020,l_apcb.apcb007,l_apcb.apcb100,l_apcb.apcb102,l_apca.apcald,l_apca.apca121,l_apca.apca131)   #albireo 160630
          RETURNING l_apcb.apcb103,l_apcb.apcb104,l_apcb.apcb105,
                    l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,
                    l_apcb.apcb123,l_apcb.apcb124,l_apcb.apcb125,
                    l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         EXIT FOREACH
         LET r_success = FALSE
      END IF
      #r2.產生apcb-----e
      
      #r3.產生直接付款apde-----s
      INITIALIZE l_apde.* TO NULL
      LET l_apde.apdeent  =l_apca.apcaent
      LET l_apde.apdeld =l_apca.apcald
      LET l_apde.apdecomp =l_apca.apcacomp
      LET l_apde.apdeorga =l_apca.apcacomp
      LET l_apde.apdesite =l_apca.apcasite
      LET l_apde.apdedocno =l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
      IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
      LET l_apde.apdeseq = l_apde.apdeseq + 1
      LET l_apde.apde001 = 'aapt560'
      LET l_apde.apde009 = 'Y'
      LET l_apde.apde028 = '0'
      LET l_apde.apde002 = '10'
      LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'3')
      #以判斷完匯兌損失/匯兌收益,將金額轉正顯示
      LET l_apde.apde109 =  l_apgc.apgc105
      LET l_apde.apde119 =  l_apgc.apgc115
      LET l_apde.apde006 = '10'   
      #銀行存提碼
      LET l_apde.apde011 = l_apgc.apgc015
      #現金變動碼
      LET l_apde.apde012 = l_apgc.apgc016
      LET l_apde.apde013 = ''
      LET l_apde.apde014 = ''
      LET l_apde.apde016 = ''
      LET l_apde.apde100 = l_apgc.apgc100
      LET l_apde.apde101 = l_apgc.apgc101
      LET l_apde.apde039 = l_apga.apga007
      LET l_apde.apde041 = NULL
      SELECT nmabl003 INTO l_apde.apde041
        FROM nmabl_t
       WHERE nmablent = g_enterprise
         AND nmabl001 = l_apde.apde039
         AND nmabl002 = g_dlang
      IF cl_null(l_apde.apde101) THEN LET l_apde.apde101 = 1 END IF
      LET l_apde.apde032 = l_apca.apcadocdt
      LET l_apde.apde061 = '54'
      #LET l_apde.apde016 = l_apgc.apgc004
      LET l_apde.apde008 = l_apgc.apgc014
      CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
         RETURNING l_apde.apde016   #albireo 160630 add
      INSERT INTO apde_t(apdeent,
                         apdeld,apdecomp,apdesite,apdedocno,apdeseq,
                         apde001,apde009,apde028,apde002,apde015,
                         apde003,apde004,apdeorga,apde006,apde011,
                         apde012,apde013,apde014,apde016,apde017,
                         apde018,apde021,apde032,apde100,apde101,
                         apde039,apde040,apde041,
                         apde008,
                         apde109,apde119,apde061)
             VALUES(l_apde.apdeent,
                    l_apde.apdeld,l_apde.apdecomp,l_apde.apdesite,l_apde.apdedocno,l_apde.apdeseq,
                    l_apde.apde001,l_apde.apde009,l_apde.apde028,l_apde.apde002,l_apde.apde015,
                    l_apde.apde003,l_apde.apde004,l_apde.apdeorga,l_apde.apde006,l_apde.apde011,
                    l_apde.apde012,l_apde.apde013,l_apde.apde014,l_apde.apde016,l_apde.apde017,
                    l_apde.apde018,l_apde.apde021,l_apde.apde032,l_apde.apde100,l_apde.apde101,
                    l_apde.apde039,l_apde.apde040,l_apde.apde041,
                    l_apde.apde008,
                    l_apde.apde109,l_apde.apde119,l_apde.apde061)
      IF SQLCA.SQLCODE THEN LET r_success = FALSE EXIT FOREACH END IF
      #r3.產生直接付款apde-----e
      
      #INSERT isam
      INITIALIZE l_isam.* TO NULL
      LET l_isam.isament = l_apca.apcaent
      LET l_isam.isamdocno = l_apca.apcadocno
      SELECT MAX(isamseq)+1 INTO l_isam.isamseq
        FROM isam_t
       WHERE isament = g_enterprise
         AND isamdocno = l_apca.apcadocno
         AND isam001 = 'aapt560'
      IF cl_null(l_isam.isamseq)THEN LET l_isam.isamseq = 1 END IF
      LET l_isam.isam001 = 'aapt560'
      LET l_isam.isam002 = l_apca.apca004                           
      LET l_isam.isam008 = l_apgc.apgc007                           
      LET l_isam.isam009 = l_apgc.apgc008                           
      LET l_isam.isam010 = l_apgc.apgc009                           
      LET l_isam.isam011 = l_apgc.apgc010                           
      LET l_isam.isam012 = l_apgc.apgc006        
      LET l_isam.isam0121= l_apca.apca013                  
      LET l_isam.isam013 = l_apca.apca012
      LET l_isam.isam014 = l_apgc.apgc100                           
      LET l_isam.isam015 = l_apgc.apgc101                           
      LET l_isam.isam016 = l_ooefl006
      LET l_isam.isam017 = l_ooef002
      CALL s_aapp320_buy_info(l_apca.apcacomp)RETURNING l_pmaal003,l_isao001,      
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021
      LET l_isam.isam023 = l_apgc.apgc103                           
      LET l_isam.isam024 = l_apgc.apgc104                           
      LET l_isam.isam025 = l_apgc.apgc105                           
      LET l_isam.isam026 = l_apgc.apgc113                           
      LET l_isam.isam027 = l_apgc.apgc114                           
      LET l_isam.isam028 = l_apgc.apgc115                           
      LET l_isam.isam029 = s_desc_get_trading_partner_abbr_desc(l_apca.apca004)  

      SELECT isak008,isak009,isak010,isak011,isak012
        INTO l_isam.isam030,l_isam.isam031,l_isam.isam032,
             l_isam.isam033,l_isam.isam034
        FROM isak_t
       WHERE isakent = g_enterprise
         AND isak001 = l_apca.apca004
         AND isak002 = lc_param_apca.ooef019
      #161129-00042#1-add(s) #161230-00036#1  mark(s)
      #LET l_ooef011 = ' '
      #SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
      #IF l_ooef011 = 'TW' THEN
      #   #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
      #   CALL s_rule_chk_vat_id_string(l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET r_success = FALSE
      #      RETURN r_success,r_docno
      #   END IF  
      #   #檢查營利事業統一編號邏輯，錯了下方提示不控卡
      #   CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET l_isam.isam030 = l_isam.isam030
      #   END IF
      #END IF
      #161129-00042#1-add(e) #161230-00036#1  mark(e)
      LET l_isam.isam035 = '1'                                 
      LET l_isam.isam036 = '11'                                
      LET l_isam.isam037 = l_apgc.apgc011                           
      LET l_isam.isam050 = l_apca.apcadocno                         
      LET l_isam.isam107    = 0                                 
      LET l_isam.isam108    = 0                                 
      LET l_isam.isam117    = 0                                 
      LET l_isam.isam118    = 0
      IF NOT cl_null(l_isam.isam010)THEN
         #161230-00036#1 add(s)
         LET l_isac004 = ''
         LET l_isac008 = ''
         SELECT isac004,isac008 INTO l_isac004,l_isac008 FROM isac_t WHERE isacent = g_enterprise 
            AND isac002 = l_isam.isam008 AND isac001 = lc_param_apca.ooef019
         #IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) THEN                                              #170218-00012#1 mark
         IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) AND l_isac004 != '28' AND l_isac004 != '29' THEN   #170218-00012#1 add
            #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
            LET l_ooef011 = ' '
            SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
            IF l_ooef011 = 'TW' THEN
               IF NOT cl_null(l_isam.isam030) THEN   #170218-00012#1 add
                  LET l_vat_id = l_isam.isam030
                  IF l_vat_id.getLength() <> 8  THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF         
                  IF NOT cl_chk_num(l_isam.isam030,'N') THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF
                  #檢查營利事業統一編號邏輯，錯了下方提示不控卡
                  CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
                  IF NOT g_sub_success THEN
                     LET l_isam.isam030 = l_isam.isam030
                  END IF
               END IF   #170218-00012#1 add
            END IF
         END IF            
         #161230-00036#1 add(e)
         #INSERT INTO isam_t VALUES(l_isam.*)  #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO isam_t (isament,isamownid,isamowndp,isamcrtid,isamcrtdp,
                             isamcrtdt,isammodid,isammoddt,isamcnfid,isamcnfdt,
                             isamstus,isamcomp,isamdocno,isamseq,
                             isam001,isam002,isam004,isam006,isam008,
                             isam009,isam010,isam011,isam012,isam0121,
                             isam013,isam014,isam015,isam016,isam017,
                             isam018,isam019,isam020,isam021,isam022,
                             isam023,isam024,isam025,isam026,isam027,
                             isam028,isam029,isam030,isam031,isam032,
                             isam033,isam034,isam035,isam036,isam037,
                             isam038,isam039,isam040,isam041,isam042,
                             isam043,isam044,isam045,isam046,isam047,
                             isam048,isam049,isam050,isam107,isam108,
                             isam117,isam118,isam200,isam201,isam202,
                             isam203,isam204,isam205,isam206,isam207,
                             isam208,isam209,isam210,
                             isamud001,isamud002,isamud003,isamud004,isamud005,
                             isamud006,isamud007,isamud008,isamud009,isamud010,
                             isamud011,isamud012,isamud013,isamud014,isamud015,
                             isamud016,isamud017,isamud018,isamud019,isamud020,
                             isamud021,isamud022,isamud023,isamud024,isamud025,
                             isamud026,isamud027,isamud028,isamud029,isamud030,
                             isam051
                            )
         VALUES (l_isam.isament,l_isam.isamownid,l_isam.isamowndp,l_isam.isamcrtid,l_isam.isamcrtdp,
                 l_isam.isamcrtdt,l_isam.isammodid,l_isam.isammoddt,l_isam.isamcnfid,l_isam.isamcnfdt,
                 l_isam.isamstus,l_isam.isamcomp,l_isam.isamdocno,l_isam.isamseq,
                 l_isam.isam001,l_isam.isam002,l_isam.isam004,l_isam.isam006,l_isam.isam008,
                 l_isam.isam009,l_isam.isam010,l_isam.isam011,l_isam.isam012,l_isam.isam0121,
                 l_isam.isam013,l_isam.isam014,l_isam.isam015,l_isam.isam016,l_isam.isam017,
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021,l_isam.isam022,
                 l_isam.isam023,l_isam.isam024,l_isam.isam025,l_isam.isam026,l_isam.isam027,
                 l_isam.isam028,l_isam.isam029,l_isam.isam030,l_isam.isam031,l_isam.isam032,
                 l_isam.isam033,l_isam.isam034,l_isam.isam035,l_isam.isam036,l_isam.isam037,
                 l_isam.isam038,l_isam.isam039,l_isam.isam040,l_isam.isam041,l_isam.isam042,
                 l_isam.isam043,l_isam.isam044,l_isam.isam045,l_isam.isam046,l_isam.isam047,
                 l_isam.isam048,l_isam.isam049,l_isam.isam050,l_isam.isam107,l_isam.isam108,
                 l_isam.isam117,l_isam.isam118,l_isam.isam200,l_isam.isam201,l_isam.isam202,
                 l_isam.isam203,l_isam.isam204,l_isam.isam205,l_isam.isam206,l_isam.isam207,
                 l_isam.isam208,l_isam.isam209,l_isam.isam210,
                 l_isam.isamud001,l_isam.isamud002,l_isam.isamud003,l_isam.isamud004,l_isam.isamud005,
                 l_isam.isamud006,l_isam.isamud007,l_isam.isamud008,l_isam.isamud009,l_isam.isamud010,
                 l_isam.isamud011,l_isam.isamud012,l_isam.isamud013,l_isam.isamud014,l_isam.isamud015,
                 l_isam.isamud016,l_isam.isamud017,l_isam.isamud018,l_isam.isamud019,l_isam.isamud020,
                 l_isam.isamud021,l_isam.isamud022,l_isam.isamud023,l_isam.isamud024,l_isam.isamud025,
                 l_isam.isamud026,l_isam.isamud027,l_isam.isamud028,l_isam.isamud029,l_isam.isamud030,
                 l_isam.isam051
                )
         #161108-00017#4 add end---
      END IF 
   END FOREACH
   
   #161004-00019#1-----s
   CALL s_fin_get_account(l_apca.apcald,'13',l_apca.apca007,'8504_04') RETURNING g_sub_success,l_xrcd009,g_errno
   UPDATE xrcd_t SET xrcd009 = l_xrcd009
    WHERE xrcdent= g_enterprise
      AND xrcdld = l_apca.apcald AND xrcddocno = l_apca.apcadocno
      AND xrcd009 IS NULL
   #161004-00019#1-----e
   
   #albireo 160630-----s

   #LET l_sql = " SELECT apccld,apccdocno,apccseq,apcc001 FROM apcc_t,apca_t ",
   #            "  WHERE apcaent = apccent ",
   #            "    AND apcald  = apccld ",
   #            "    AND apcadocno = apccdocno ",
   #            "    AND apcastus = 'Y' ",
   #            "    AND apcaent = ",g_enterprise," ",
   #            "    AND apca004 = '",l_apgl.apgl006,"' ",
   #            "    AND apca001 IN ('21','23','25') ",
   #            "    AND apcald = '",l_apca.apcald,"' ",
   #            "    AND (apcc108 - apcc109) > 0 "
   #PREPARE sel_apccp1 FROM l_sql
   #DECLARE sel_apccc1 CURSOR FOR sel_apccp1
   #FOREACH sel_apccc1 INTO l_apccld,l_apccdocno,l_apccseq,l_apcc001
   #   IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
   #   #apce_t
   #   INITIALIZE l_apce.* TO NULL
   #   LET l_apce.apceent = g_enterprise
   #   LET l_apce.apceld  = l_apca.apcald
   #   LET l_apce.apceld = l_apca.apcald
   #   LET l_apce.apcedocno = l_apca.apcadocno            
   #   LET l_apce.apce001 = 'aapt560'
   #
   #   #帶出借貸別(正負值)
   #   LET l_apce.apce015 = s_fin_get_scc_value('8506',l_apce.apce002,'3')              
   #   LET l_apce.apcecomp = l_apca.apcacomp
   #   LET l_apce.apcesite = l_apca.apcasite   
   #   LET l_apce.apceorga = l_apca.apcacomp 
   #   #取得來源組織所屬法人        
   #   LET l_apce.apce027 = 'N'
   #   LET l_apce.apceseq = NULL
   #   SELECT MAX(apceseq)+1 INTO l_apce.apceseq FROM apce_t
   #    WHERE apceent = g_enterprise
   #      AND apcedocno = l_apca.apcadocno
   #   IF cl_null(l_apce.apceseq)THEN LET l_apce.apceseq = 1 END IF
   #   LET l_apce.apce002 = "41"
   #   LET l_apce.apce
   #END FOREACH
   CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-2002') RETURNING l_sfin2002
   LET l_sql = " apca004 = '",l_apgl.apgl006,"' AND apcastus = 'Y' "
   CALL aapt560_03_ins_apce(l_apca.apcald,l_apca.apcadocno,l_sql,l_sfin2002,'4')   

   #albireo 160630-----e
   
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   
   LET l_apcb113sum = NULL   LET l_apcb114sum = NULL   LET l_apcb115sum = NULL
   SELECT SUM(apcb113),SUM(apcb114),SUM(apcb115)
     INTO l_apcb113sum,l_apcb114sum,l_apcb115sum
     FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbld  = l_apca.apcald
      AND apcbdocno = l_apca.apcadocno
   IF cl_null(l_apcb113sum)THEN LET l_apcb113sum = 0 END IF
   IF cl_null(l_apcb114sum)THEN LET l_apcb114sum = 0 END IF
   IF cl_null(l_apcb115sum)THEN LET l_apcb115sum = 0 END IF
   
   UPDATE apca_t SET apca103 = l_apcb113sum,
                     apca104 = l_apcb114sum,
                     apca108 = l_apcb115sum,
                     apca113 = l_apcb113sum,
                     apca114 = l_apcb114sum,
                     apca118 = l_apcb115sum,
                     apca107 = l_apcb115sum,    #160824-00049#7
                     apca117 = l_apcb115sum     #160824-00049#7
    WHERE apcaent = g_enterprise
      AND apcald  = l_apca.apcald
      AND apcadocno = l_apca.apcadocno

   CALL s_aap_multi_bill_period(l_apca.apcald,l_apca.apcadocno) RETURNING g_sub_success,g_errno

   UPDATE apcc_t SET apcc109 = apcc108 ,apcc119 = apcc118
    WHERE apccent = g_enterprise
      AND apccdocno = l_apca.apcadocno
      AND apccld    = l_apca.apcald
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   CALL s_pre_voucher_ins('AP','P10',l_apca.apcald,l_apca.apcadocno,l_apca.apcadocdt,'1')
                       RETURNING g_sub_success
   IF NOT g_sub_success THEN
      LET r_success = FALSE
   END IF    

   #160824-00049#7-----s
   LET l_count = NULL
   SELECT COUNT(*) INTO l_count FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbdocno = l_apca.apcadocno
      AND apcbld = l_apca.apcald
   IF cl_null(l_count)THEN LET l_count = 0 END IF
   
   IF l_count = 0 THEN
      LET r_success = FALSE
      INITIALIZE g_errparam.* TO NULL
      LET g_errparam.code = 'agl-00167'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
   END IF
   #160824-00049#7-----e
   
   UPDATE apgl_t SET apgl030 = l_apca.apcadocno
    WHERE apglent = g_enterprise
      AND apglcomp = l_apca.apcacomp
      AND apgldocno = g_apca_m.apca018
   LET r_docno = l_apca.apcadocno
   RETURN r_success,r_docno
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_ins_ap_6()
#DEFINE l_apca   RECORD LIKE apca_t.* #161104-00024#5 mark
#161104-00024#5-add(s)
DEFINE l_apca  RECORD  #應付憑單單頭
       apcaent   LIKE apca_t.apcaent, #企業編號
       apcaownid LIKE apca_t.apcaownid, #資料所有者
       apcaowndp LIKE apca_t.apcaowndp, #資料所有部門
       apcacrtid LIKE apca_t.apcacrtid, #資料建立者
       apcacrtdp LIKE apca_t.apcacrtdp, #資料建立部門
       apcacrtdt LIKE apca_t.apcacrtdt, #資料創建日
       apcamodid LIKE apca_t.apcamodid, #資料修改者
       apcamoddt LIKE apca_t.apcamoddt, #最近修改日
       apcacnfid LIKE apca_t.apcacnfid, #資料確認者
       apcacnfdt LIKE apca_t.apcacnfdt, #資料確認日
       apcapstid LIKE apca_t.apcapstid, #資料過帳者
       apcapstdt LIKE apca_t.apcapstdt, #資料過帳日
       apcastus  LIKE apca_t.apcastus, #狀態碼
       apcald    LIKE apca_t.apcald, #帳套
       apcacomp  LIKE apca_t.apcacomp, #法人
       apcadocno LIKE apca_t.apcadocno, #應付帳款單號碼
       apcadocdt LIKE apca_t.apcadocdt, #帳款日期
       apcasite  LIKE apca_t.apcasite, #帳務中心
       apca001   LIKE apca_t.apca001, #帳款單性質
       apca003   LIKE apca_t.apca003, #帳務人員
       apca004   LIKE apca_t.apca004, #帳款對象編號
       apca005   LIKE apca_t.apca005, #付款對象
       apca006   LIKE apca_t.apca006, #供應商分類
       apca007   LIKE apca_t.apca007, #帳款類別
       apca008   LIKE apca_t.apca008, #付款條件編號
       apca009   LIKE apca_t.apca009, #應付款日/應扣抵日
       apca010   LIKE apca_t.apca010, #容許票據到期日
       apca011   LIKE apca_t.apca011, #稅別
       apca012   LIKE apca_t.apca012, #稅率
       apca013   LIKE apca_t.apca013, #含稅否
       apca014   LIKE apca_t.apca014, #人員編號
       apca015   LIKE apca_t.apca015, #部門編號
       apca016   LIKE apca_t.apca016, #來源作業類型
       apca017   LIKE apca_t.apca017, #產生方式
       apca018   LIKE apca_t.apca018, #來源參考單號
       apca019   LIKE apca_t.apca019, #系統產生對應單號(待抵帳款-預付)
       apca020   LIKE apca_t.apca020, #信用狀付款否
       apca021   LIKE apca_t.apca021, #商業發票號碼(IV no.)
       apca022   LIKE apca_t.apca022, #進口報單號碼
       apca025   LIKE apca_t.apca025, #差異處理(發票與帳款差異)
       apca026   LIKE apca_t.apca026, #原幣未稅差異
       apca027   LIKE apca_t.apca027, #原幣稅額差異
       apca028   LIKE apca_t.apca028, #本幣未稅差異
       apca029   LIKE apca_t.apca029, #本幣幣稅額差異
       apca030   LIKE apca_t.apca030, #差異科目
       apca031   LIKE apca_t.apca031, #產生之差異折讓單號
       apca032   LIKE apca_t.apca032, #發票類型
       apca033   LIKE apca_t.apca033, #專案編號
       apca034   LIKE apca_t.apca034, #責任中心
       apca035   LIKE apca_t.apca035, #應付(貸方)科目編號
       apca036   LIKE apca_t.apca036, #費用(借方)科目編號
       apca037   LIKE apca_t.apca037, #產生傳票否
       apca038   LIKE apca_t.apca038, #拋轉傳票號碼
       apca039   LIKE apca_t.apca039, #會計檢核附件份數
       apca040   LIKE apca_t.apca040, #留置否
       apca041   LIKE apca_t.apca041, #留置理由碼
       apca042   LIKE apca_t.apca042, #留置設定日期
       apca043   LIKE apca_t.apca043, #留置解除日期
       apca044   LIKE apca_t.apca044, #留置原幣金額
       apca045   LIKE apca_t.apca045, #留置說明
       apca046   LIKE apca_t.apca046, #關係人否
       apca047   LIKE apca_t.apca047, #多角序號
       apca048   LIKE apca_t.apca048, #集團代付/代付單號
       apca049   LIKE apca_t.apca049, #來源營運中心編號
       apca050   LIKE apca_t.apca050, #交易原始單據份數
       apca051   LIKE apca_t.apca051, #作廢理由碼
       apca052   LIKE apca_t.apca052, #列印次數
       apca053   LIKE apca_t.apca053, #備註
       apca054   LIKE apca_t.apca054, #多帳期設定
       apca055   LIKE apca_t.apca055, #繳款優惠條件
       apca056   LIKE apca_t.apca056, #會計檢核附件狀態
       apca057   LIKE apca_t.apca057, #交易對象識別碼
       apca058   LIKE apca_t.apca058, #稅別交易類型
       apca059   LIKE apca_t.apca059, #預算編號
       apca060   LIKE apca_t.apca060, #發票開立方式
       apca061   LIKE apca_t.apca061, #預開發票基準日
       apca062   LIKE apca_t.apca062, #多角性質
       apca063   LIKE apca_t.apca063, #整帳批序號
       apca064   LIKE apca_t.apca064, #訂金序次
       apca065   LIKE apca_t.apca065, #發票編號
       apca066   LIKE apca_t.apca066, #發票號碼
       apca100   LIKE apca_t.apca100, #交易原幣別
       apca101   LIKE apca_t.apca101, #原幣匯率
       apca103   LIKE apca_t.apca103, #原幣未稅金額
       apca104   LIKE apca_t.apca104, #原幣稅額
       apca106   LIKE apca_t.apca106, #原幣應稅折抵合計金額
       apca107   LIKE apca_t.apca107, #原幣直接沖帳(調整)合計金額
       apca108   LIKE apca_t.apca108, #原幣應付金額
       apca113   LIKE apca_t.apca113, #本幣未稅金額
       apca114   LIKE apca_t.apca114, #本幣稅額
       apca116   LIKE apca_t.apca116, #本幣應稅折抵合計金額
       apca117   LIKE apca_t.apca117, #NO USE
       apca118   LIKE apca_t.apca118, #本幣應付金額
       apca120   LIKE apca_t.apca120, #本位幣二幣別
       apca121   LIKE apca_t.apca121, #本位幣二匯率
       apca123   LIKE apca_t.apca123, #本位幣二未稅金額
       apca124   LIKE apca_t.apca124, #本位幣二稅額
       apca126   LIKE apca_t.apca126, #本位幣二應稅折抵合計金額
       apca127   LIKE apca_t.apca127, #NO USE
       apca128   LIKE apca_t.apca128, #本位幣二應付金額
       apca130   LIKE apca_t.apca130, #本位幣三幣別
       apca131   LIKE apca_t.apca131, #本位幣三匯率
       apca133   LIKE apca_t.apca133, #本位幣三未稅金額
       apca134   LIKE apca_t.apca134, #本位幣三稅額
       apca136   LIKE apca_t.apca136, #本位幣三應稅折抵合計金額
       apca137   LIKE apca_t.apca137, #NO USE
       apca138   LIKE apca_t.apca138, #本位幣三應付金額
       apcaud001 LIKE apca_t.apcaud001, #自定義欄位(文字)001
       apcaud002 LIKE apca_t.apcaud002, #自定義欄位(文字)002
       apcaud003 LIKE apca_t.apcaud003, #自定義欄位(文字)003
       apcaud004 LIKE apca_t.apcaud004, #自定義欄位(文字)004
       apcaud005 LIKE apca_t.apcaud005, #自定義欄位(文字)005
       apcaud006 LIKE apca_t.apcaud006, #自定義欄位(文字)006
       apcaud007 LIKE apca_t.apcaud007, #自定義欄位(文字)007
       apcaud008 LIKE apca_t.apcaud008, #自定義欄位(文字)008
       apcaud009 LIKE apca_t.apcaud009, #自定義欄位(文字)009
       apcaud010 LIKE apca_t.apcaud010, #自定義欄位(文字)010
       apcaud011 LIKE apca_t.apcaud011, #自定義欄位(數字)011
       apcaud012 LIKE apca_t.apcaud012, #自定義欄位(數字)012
       apcaud013 LIKE apca_t.apcaud013, #自定義欄位(數字)013
       apcaud014 LIKE apca_t.apcaud014, #自定義欄位(數字)014
       apcaud015 LIKE apca_t.apcaud015, #自定義欄位(數字)015
       apcaud016 LIKE apca_t.apcaud016, #自定義欄位(數字)016
       apcaud017 LIKE apca_t.apcaud017, #自定義欄位(數字)017
       apcaud018 LIKE apca_t.apcaud018, #自定義欄位(數字)018
       apcaud019 LIKE apca_t.apcaud019, #自定義欄位(數字)019
       apcaud020 LIKE apca_t.apcaud020, #自定義欄位(數字)020
       apcaud021 LIKE apca_t.apcaud021, #自定義欄位(日期時間)021
       apcaud022 LIKE apca_t.apcaud022, #自定義欄位(日期時間)022
       apcaud023 LIKE apca_t.apcaud023, #自定義欄位(日期時間)023
       apcaud024 LIKE apca_t.apcaud024, #自定義欄位(日期時間)024
       apcaud025 LIKE apca_t.apcaud025, #自定義欄位(日期時間)025
       apcaud026 LIKE apca_t.apcaud026, #自定義欄位(日期時間)026
       apcaud027 LIKE apca_t.apcaud027, #自定義欄位(日期時間)027
       apcaud028 LIKE apca_t.apcaud028, #自定義欄位(日期時間)028
       apcaud029 LIKE apca_t.apcaud029, #自定義欄位(日期時間)029
       apcaud030 LIKE apca_t.apcaud030, #自定義欄位(日期時間)030
       apca067   LIKE apca_t.apca067, #管理品類
       apca068   LIKE apca_t.apca068, #經營方式
       apca069   LIKE apca_t.apca069, #no use
       apca070   LIKE apca_t.apca070, #no use
       apca071   LIKE apca_t.apca071, #no use
       apca072   LIKE apca_t.apca072, #no use
       apca073   LIKE apca_t.apca073  #L/C No.
           END RECORD
#161104-00024#5-add(e)
DEFINE l_desc   LIKE type_t.chr1000
DEFINE ls_js            STRING   
DEFINE lc_param_apca    RECORD
         apcald         LIKE apca_t.apcald,
         apcacomp       LIKE apca_t.apcacomp,
         apcasite       LIKE apca_t.apcasite,
         apcadocdt      LIKE apca_t.apcadocdt,
         apca001        LIKE apca_t.apca001,
         apca004        LIKE apca_t.apca004,
         ooef019        LIKE ooef_t.ooef019
                        END RECORD
DEFINE lc_param_info    RECORD
            apca005        LIKE apca_t.apca005,
            apca005_desc   LIKE type_t.chr80,
            apca006        LIKE apca_t.apca006,    #供應商分類
            apca007        LIKE apca_t.apca007,
            apca007_desc   LIKE type_t.chr80,
            apca008        LIKE apca_t.apca008,
            apca008_desc   LIKE type_t.chr80,
            apca009        LIKE apca_t.apca009,
            apca010        LIKE apca_t.apca010,
            apca011        LIKE apca_t.apca011,
            apca011_desc   LIKE type_t.chr80,
            apca012        LIKE apca_t.apca012,
            apca013        LIKE apca_t.apca013,
            apca014        LIKE apca_t.apca014,
            apca014_desc   LIKE type_t.chr80,
            apca015        LIKE apca_t.apca015,
            apca015_desc   LIKE type_t.chr80,
            apca034        LIKE apca_t.apca034,
            apca034_desc   LIKE type_t.chr80,
            apca035        LIKE apca_t.apca035,
            apca035_desc   LIKE type_t.chr80,
            apca036        LIKE apca_t.apca036,
            apca036_desc   LIKE type_t.chr80,
            apca046        LIKE apca_t.apca046,
            apca054        LIKE apca_t.apca054,
            apca054_desc   LIKE type_t.chr80,
            apca055        LIKE apca_t.apca055,
            apca055_desc   LIKE type_t.chr80,
            apca056        LIKE apca_t.apca056,
            apca058        LIKE apca_t.apca058,
            apca058_desc   LIKE type_t.chr80,
            apca060        LIKE apca_t.apca060,
            apca100        LIKE apca_t.apca100,
            apca101        LIKE apca_t.apca101,
            apca121        LIKE apca_t.apca121,
            apca131        LIKE apca_t.apca131
                       END RECORD
   DEFINE lc_param2        RECORD
         type           LIKE type_t.chr1,       #類型
         apca004        LIKE apca_t.apca004,
         sfin2009       LIKE type_t.chr1        #汇率基本    
         END RECORD
   #DEFINE l_apga    RECORD LIKE apga_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apga  RECORD  #信用狀申請單主檔
          apgaent   LIKE apga_t.apgaent, #企業編號
          apgaownid LIKE apga_t.apgaownid, #資料所有者
          apgaowndp LIKE apga_t.apgaowndp, #資料所屬部門
          apgacrtid LIKE apga_t.apgacrtid, #資料建立者
          apgacrtdp LIKE apga_t.apgacrtdp, #資料建立部門
          apgacrtdt LIKE apga_t.apgacrtdt, #資料創建日
          apgamodid LIKE apga_t.apgamodid, #資料修改者
          apgamoddt LIKE apga_t.apgamoddt, #最近修改日
          apgacnfid LIKE apga_t.apgacnfid, #資料確認者
          apgacnfdt LIKE apga_t.apgacnfdt, #資料確認日
          apgapstid LIKE apga_t.apgapstid, #資料過帳者
          apgapstdt LIKE apga_t.apgapstdt, #資料過帳日
          apgastus  LIKE apga_t.apgastus, #狀態碼
          apgacomp  LIKE apga_t.apgacomp, #法人
          apgadocno LIKE apga_t.apgadocno, #申請單號
          apgadocdt LIKE apga_t.apgadocdt, #申請日期
          apga001   LIKE apga_t.apga001, #L/C NO
          apga002   LIKE apga_t.apga002, #版次
          apga003   LIKE apga_t.apga003, #開狀日期
          apga004   LIKE apga_t.apga004, #供應商(受益人)
          apga005   LIKE apga_t.apga005, #業務人員
          apga006   LIKE apga_t.apga006, #付款類型
          apga007   LIKE apga_t.apga007, #開狀銀行
          apga008   LIKE apga_t.apga008, #信用狀類別
          apga009   LIKE apga_t.apga009, #保兌信用狀否
          apga010   LIKE apga_t.apga010, #信用狀有效日期
          apga011   LIKE apga_t.apga011, #許可證號
          apga012   LIKE apga_t.apga012, #承兌日期
          apga013   LIKE apga_t.apga013, #保兌費用支付方
          apga014   LIKE apga_t.apga014, #可否分批交運
          apga015   LIKE apga_t.apga015, #自備款比率
          apga016   LIKE apga_t.apga016, #融資利率
          apga017   LIKE apga_t.apga017, #融資天數
          apga018   LIKE apga_t.apga018, #融資合約編號
          apga019   LIKE apga_t.apga019, #最後裝運日
          apga020   LIKE apga_t.apga020, #運送方式
          apga021   LIKE apga_t.apga021, #裝載港/機場
          apga022   LIKE apga_t.apga022, #卸載港/機場
          apga023   LIKE apga_t.apga023, #E.T.D
          apga024   LIKE apga_t.apga024, #E.T.A
          apga025   LIKE apga_t.apga025, #備註
          apga026   LIKE apga_t.apga026, #開狀時支付自備款
          apga027   LIKE apga_t.apga027, #NO USE
          apga028   LIKE apga_t.apga028, #帳務單號
          apga029   LIKE apga_t.apga029, #結案否
          apga030   LIKE apga_t.apga030, #通知銀行
          apga031   LIKE apga_t.apga031, #開狀時支付自備款
          apga100   LIKE apga_t.apga100, #幣別
          apga101   LIKE apga_t.apga101, #開狀匯率
          apga103   LIKE apga_t.apga103, #開狀原幣金額
          apga104   LIKE apga_t.apga104, #自備款原幣金額
          apga105   LIKE apga_t.apga105, #融資原幣金額
          apga106   LIKE apga_t.apga106, #到單原幣金額
          apga107   LIKE apga_t.apga107, #到貨原幣金額
          apga108   LIKE apga_t.apga108, #保證金原幣金額
          apga113   LIKE apga_t.apga113, #開狀本幣金額
          apga114   LIKE apga_t.apga114, #自備款本幣金額
          apga115   LIKE apga_t.apga115, #融資本幣金額
          apgaud001 LIKE apga_t.apgaud001, #自定義欄位(文字)001
          apgaud002 LIKE apga_t.apgaud002, #自定義欄位(文字)002
          apgaud003 LIKE apga_t.apgaud003, #自定義欄位(文字)003
          apgaud004 LIKE apga_t.apgaud004, #自定義欄位(文字)004
          apgaud005 LIKE apga_t.apgaud005, #自定義欄位(文字)005
          apgaud006 LIKE apga_t.apgaud006, #自定義欄位(文字)006
          apgaud007 LIKE apga_t.apgaud007, #自定義欄位(文字)007
          apgaud008 LIKE apga_t.apgaud008, #自定義欄位(文字)008
          apgaud009 LIKE apga_t.apgaud009, #自定義欄位(文字)009
          apgaud010 LIKE apga_t.apgaud010, #自定義欄位(文字)010
          apgaud011 LIKE apga_t.apgaud011, #自定義欄位(數字)011
          apgaud012 LIKE apga_t.apgaud012, #自定義欄位(數字)012
          apgaud013 LIKE apga_t.apgaud013, #自定義欄位(數字)013
          apgaud014 LIKE apga_t.apgaud014, #自定義欄位(數字)014
          apgaud015 LIKE apga_t.apgaud015, #自定義欄位(數字)015
          apgaud016 LIKE apga_t.apgaud016, #自定義欄位(數字)016
          apgaud017 LIKE apga_t.apgaud017, #自定義欄位(數字)017
          apgaud018 LIKE apga_t.apgaud018, #自定義欄位(數字)018
          apgaud019 LIKE apga_t.apgaud019, #自定義欄位(數字)019
          apgaud020 LIKE apga_t.apgaud020, #自定義欄位(數字)020
          apgaud021 LIKE apga_t.apgaud021, #自定義欄位(日期時間)021
          apgaud022 LIKE apga_t.apgaud022, #自定義欄位(日期時間)022
          apgaud023 LIKE apga_t.apgaud023, #自定義欄位(日期時間)023
          apgaud024 LIKE apga_t.apgaud024, #自定義欄位(日期時間)024
          apgaud025 LIKE apga_t.apgaud025, #自定義欄位(日期時間)025
          apgaud026 LIKE apga_t.apgaud026, #自定義欄位(日期時間)026
          apgaud027 LIKE apga_t.apgaud027, #自定義欄位(日期時間)027
          apgaud028 LIKE apga_t.apgaud028, #自定義欄位(日期時間)028
          apgaud029 LIKE apga_t.apgaud029, #自定義欄位(日期時間)029
          apgaud030 LIKE apga_t.apgaud030, #自定義欄位(日期時間)030
          apga102   LIKE apga_t.apga102, #預付款原幣金額
          apga109   LIKE apga_t.apga109, #初開狀原幣金額
          apga112   LIKE apga_t.apga112, #預付款本幣金額
          apga117   LIKE apga_t.apga117, #到貨本幣金額
          apga118   LIKE apga_t.apga118, #保證金本幣金額
          apga032   LIKE apga_t.apga032, #保證金待抵單號
          apga033   LIKE apga_t.apga033, #預付款待抵單號
          apga034   LIKE apga_t.apga034, #保證金存提碼
          apga035   LIKE apga_t.apga035, #保證金現變碼
          apga040   LIKE apga_t.apga040, #支付帳戶
          apga041   LIKE apga_t.apga041, #多幣別採購單
          apga036   LIKE apga_t.apga036, #自備款存提碼
          apga037   LIKE apga_t.apga037, #自備款現變碼
          apga038   LIKE apga_t.apga038, #預付款存提碼
          apga039   LIKE apga_t.apga039  #預付款現變碼
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_success LIKE type_t.num5
   #DEFINE l_apgc    RECORD LIKE apgc_t.* #161104-00024#5 mark
   #DEFINE l_apcb    RECORD LIKE apcb_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgc  RECORD  #信用狀相關費用明細檔
          apgcent   LIKE apgc_t.apgcent, #企業編號
          apgccomp  LIKE apgc_t.apgccomp, #法人
          apgcdocno LIKE apgc_t.apgcdocno, #申請單號
          apgcseq   LIKE apgc_t.apgcseq, #項次
          apgc900   LIKE apgc_t.apgc900, #變更序
          apgcorga  LIKE apgc_t.apgcorga, #來源組織
          apgc001   LIKE apgc_t.apgc001, #費用編號
          apgc002   LIKE apgc_t.apgc002, #付款對象
          apgc003   LIKE apgc_t.apgc003, #付款條件
          apgc004   LIKE apgc_t.apgc004, #費用科目
          apgc005   LIKE apgc_t.apgc005, #帳款類別
          apgc006   LIKE apgc_t.apgc006, #稅別
          apgc007   LIKE apgc_t.apgc007, #發票類型
          apgc008   LIKE apgc_t.apgc008, #發票編號
          apgc009   LIKE apgc_t.apgc009, #發票號碼
          apgc010   LIKE apgc_t.apgc010, #發票日期
          apgc011   LIKE apgc_t.apgc011, #可扣抵編號
          apgc012   LIKE apgc_t.apgc012, #應付單號
          apgc013   LIKE apgc_t.apgc013, #費用來源
          apgc014   LIKE apgc_t.apgc014, #付款帳戶
          apgc015   LIKE apgc_t.apgc015, #存提碼
          apgc016   LIKE apgc_t.apgc016, #現金變動碼
          apgc100   LIKE apgc_t.apgc100, #幣別
          apgc101   LIKE apgc_t.apgc101, #匯率
          apgc103   LIKE apgc_t.apgc103, #原幣未稅金額
          apgc104   LIKE apgc_t.apgc104, #稅額
          apgc105   LIKE apgc_t.apgc105, #原幣含稅金額
          apgc113   LIKE apgc_t.apgc113, #本幣未稅金額
          apgc114   LIKE apgc_t.apgc114, #本幣稅額
          apgc115   LIKE apgc_t.apgc115, #本幣含稅金額
          apgcud001 LIKE apgc_t.apgcud001, #自定義欄位(文字)001
          apgcud002 LIKE apgc_t.apgcud002, #自定義欄位(文字)002
          apgcud003 LIKE apgc_t.apgcud003, #自定義欄位(文字)003
          apgcud004 LIKE apgc_t.apgcud004, #自定義欄位(文字)004
          apgcud005 LIKE apgc_t.apgcud005, #自定義欄位(文字)005
          apgcud006 LIKE apgc_t.apgcud006, #自定義欄位(文字)006
          apgcud007 LIKE apgc_t.apgcud007, #自定義欄位(文字)007
          apgcud008 LIKE apgc_t.apgcud008, #自定義欄位(文字)008
          apgcud009 LIKE apgc_t.apgcud009, #自定義欄位(文字)009
          apgcud010 LIKE apgc_t.apgcud010, #自定義欄位(文字)010
          apgcud011 LIKE apgc_t.apgcud011, #自定義欄位(數字)011
          apgcud012 LIKE apgc_t.apgcud012, #自定義欄位(數字)012
          apgcud013 LIKE apgc_t.apgcud013, #自定義欄位(數字)013
          apgcud014 LIKE apgc_t.apgcud014, #自定義欄位(數字)014
          apgcud015 LIKE apgc_t.apgcud015, #自定義欄位(數字)015
          apgcud016 LIKE apgc_t.apgcud016, #自定義欄位(數字)016
          apgcud017 LIKE apgc_t.apgcud017, #自定義欄位(數字)017
          apgcud018 LIKE apgc_t.apgcud018, #自定義欄位(數字)018
          apgcud019 LIKE apgc_t.apgcud019, #自定義欄位(數字)019
          apgcud020 LIKE apgc_t.apgcud020, #自定義欄位(數字)020
          apgcud021 LIKE apgc_t.apgcud021, #自定義欄位(日期時間)021
          apgcud022 LIKE apgc_t.apgcud022, #自定義欄位(日期時間)022
          apgcud023 LIKE apgc_t.apgcud023, #自定義欄位(日期時間)023
          apgcud024 LIKE apgc_t.apgcud024, #自定義欄位(日期時間)024
          apgcud025 LIKE apgc_t.apgcud025, #自定義欄位(日期時間)025
          apgcud026 LIKE apgc_t.apgcud026, #自定義欄位(日期時間)026
          apgcud027 LIKE apgc_t.apgcud027, #自定義欄位(日期時間)027
          apgcud028 LIKE apgc_t.apgcud028, #自定義欄位(日期時間)028
          apgcud029 LIKE apgc_t.apgcud029, #自定義欄位(日期時間)029
          apgcud030 LIKE apgc_t.apgcud030  #自定義欄位(日期時間)030
              END RECORD
   DEFINE l_apcb  RECORD  #應付憑單單身
          apcbent   LIKE apcb_t.apcbent, #企業編號
          apcbld    LIKE apcb_t.apcbld, #帳套
          apcblegl  LIKE apcb_t.apcblegl, #核算組織
          apcborga  LIKE apcb_t.apcborga, #帳務歸屬組織(來源組織)
          apcbsite  LIKE apcb_t.apcbsite, #應付帳務組織
          apcbdocno LIKE apcb_t.apcbdocno, #單號
          apcbseq   LIKE apcb_t.apcbseq, #項次
          apcb001   LIKE apcb_t.apcb001, #來源類型
          apcb002   LIKE apcb_t.apcb002, #來源業務單據號碼
          apcb003   LIKE apcb_t.apcb003, #來源業務單據項次
          apcb004   LIKE apcb_t.apcb004, #產品編號
          apcb005   LIKE apcb_t.apcb005, #品名規格
          apcb006   LIKE apcb_t.apcb006, #單位
          apcb007   LIKE apcb_t.apcb007, #計價數量
          apcb008   LIKE apcb_t.apcb008, #參考單據號碼
          apcb009   LIKE apcb_t.apcb009, #參考單據項次
          apcb010   LIKE apcb_t.apcb010, #業務部門
          apcb011   LIKE apcb_t.apcb011, #責任中心
          apcb012   LIKE apcb_t.apcb012, #產品類別
          apcb013   LIKE apcb_t.apcb013, #搭贈
          apcb014   LIKE apcb_t.apcb014, #理由碼
          apcb015   LIKE apcb_t.apcb015, #專案編號
          apcb016   LIKE apcb_t.apcb016, #WBS編號
          apcb017   LIKE apcb_t.apcb017, #預算細項
          apcb018   LIKE apcb_t.apcb018, #专柜编号
          apcb019   LIKE apcb_t.apcb019, #開票性質
          apcb020   LIKE apcb_t.apcb020, #稅別
          apcb021   LIKE apcb_t.apcb021, #費用會計科目
          apcb022   LIKE apcb_t.apcb022, #正負值
          apcb023   LIKE apcb_t.apcb023, #沖暫估單否
          apcb024   LIKE apcb_t.apcb024, #區域
          apcb025   LIKE apcb_t.apcb025, #傳票號碼
          apcb026   LIKE apcb_t.apcb026, #傳票項次
          apcb027   LIKE apcb_t.apcb027, #發票編號
          apcb028   LIKE apcb_t.apcb028, #發票號碼
          apcb029   LIKE apcb_t.apcb029, #應付帳款科目
          apcb030   LIKE apcb_t.apcb030, #付款條件
          apcb032   LIKE apcb_t.apcb032, #訂金序次
          apcb033   LIKE apcb_t.apcb033, #經營方式
          apcb034   LIKE apcb_t.apcb034, #通路
          apcb035   LIKE apcb_t.apcb035, #品牌
          apcb036   LIKE apcb_t.apcb036, #客群
          apcb037   LIKE apcb_t.apcb037, #自由核算項一
          apcb038   LIKE apcb_t.apcb038, #自由核算項二
          apcb039   LIKE apcb_t.apcb039, #自由核算項三
          apcb040   LIKE apcb_t.apcb040, #自由核算項四
          apcb041   LIKE apcb_t.apcb041, #自由核算項五
          apcb042   LIKE apcb_t.apcb042, #自由核算項六
          apcb043   LIKE apcb_t.apcb043, #自由核算項七
          apcb044   LIKE apcb_t.apcb044, #自由核算項八
          apcb045   LIKE apcb_t.apcb045, #自由核算項九
          apcb046   LIKE apcb_t.apcb046, #自由核算項十
          apcb047   LIKE apcb_t.apcb047, #摘要
          apcb048   LIKE apcb_t.apcb048, #來源訂購單號
          apcb049   LIKE apcb_t.apcb049, #開票單號
          apcb050   LIKE apcb_t.apcb050, #開票項次
          apcb051   LIKE apcb_t.apcb051, #業務人員
          apcb100   LIKE apcb_t.apcb100, #交易原幣
          apcb101   LIKE apcb_t.apcb101, #交易原幣單價
          apcb102   LIKE apcb_t.apcb102, #原幣匯率
          apcb103   LIKE apcb_t.apcb103, #交易原幣未稅金額
          apcb104   LIKE apcb_t.apcb104, #交易原幣稅額
          apcb105   LIKE apcb_t.apcb105, #交易原幣含稅金額
          apcb106   LIKE apcb_t.apcb106, #交易幣標準成本金額
          apcb107   LIKE apcb_t.apcb107, #入庫單單價
          apcb108   LIKE apcb_t.apcb108, #交易原幣成本認列金額
          apcb111   LIKE apcb_t.apcb111, #本幣單價
          apcb113   LIKE apcb_t.apcb113, #本幣未稅金額
          apcb114   LIKE apcb_t.apcb114, #本幣稅額
          apcb115   LIKE apcb_t.apcb115, #本幣含稅金額
          apcb116   LIKE apcb_t.apcb116, #本幣標準成本金額
          apcb117   LIKE apcb_t.apcb117, #NO USE
          apcb118   LIKE apcb_t.apcb118, #本幣成本認列金額
          apcb119   LIKE apcb_t.apcb119, #應開發票含稅金額
          apcb121   LIKE apcb_t.apcb121, #本位幣二匯率
          apcb123   LIKE apcb_t.apcb123, #本位幣二未稅金額
          apcb124   LIKE apcb_t.apcb124, #本位幣二稅額
          apcb125   LIKE apcb_t.apcb125, #本位幣二含稅金額
          apcb126   LIKE apcb_t.apcb126, #本幣二標準成本金額
          apcb127   LIKE apcb_t.apcb127, #NO USE
          apcb128   LIKE apcb_t.apcb128, #本位幣二成本認列金額
          apcb131   LIKE apcb_t.apcb131, #本位幣三匯率
          apcb133   LIKE apcb_t.apcb133, #本位幣三未稅金額
          apcb134   LIKE apcb_t.apcb134, #本位幣三稅額
          apcb135   LIKE apcb_t.apcb135, #本位幣三含稅金額
          apcb136   LIKE apcb_t.apcb136, #本幣三標準成本金額
          apcb137   LIKE apcb_t.apcb137, #NO USE
          apcb138   LIKE apcb_t.apcb138, #本位幣三成本認列金額
          apcbud001 LIKE apcb_t.apcbud001, #自定義欄位(文字)001
          apcbud002 LIKE apcb_t.apcbud002, #自定義欄位(文字)002
          apcbud003 LIKE apcb_t.apcbud003, #自定義欄位(文字)003
          apcbud004 LIKE apcb_t.apcbud004, #自定義欄位(文字)004
          apcbud005 LIKE apcb_t.apcbud005, #自定義欄位(文字)005
          apcbud006 LIKE apcb_t.apcbud006, #自定義欄位(文字)006
          apcbud007 LIKE apcb_t.apcbud007, #自定義欄位(文字)007
          apcbud008 LIKE apcb_t.apcbud008, #自定義欄位(文字)008
          apcbud009 LIKE apcb_t.apcbud009, #自定義欄位(文字)009
          apcbud010 LIKE apcb_t.apcbud010, #自定義欄位(文字)010
          apcbud011 LIKE apcb_t.apcbud011, #自定義欄位(數字)011
          apcbud012 LIKE apcb_t.apcbud012, #自定義欄位(數字)012
          apcbud013 LIKE apcb_t.apcbud013, #自定義欄位(數字)013
          apcbud014 LIKE apcb_t.apcbud014, #自定義欄位(數字)014
          apcbud015 LIKE apcb_t.apcbud015, #自定義欄位(數字)015
          apcbud016 LIKE apcb_t.apcbud016, #自定義欄位(數字)016
          apcbud017 LIKE apcb_t.apcbud017, #自定義欄位(數字)017
          apcbud018 LIKE apcb_t.apcbud018, #自定義欄位(數字)018
          apcbud019 LIKE apcb_t.apcbud019, #自定義欄位(數字)019
          apcbud020 LIKE apcb_t.apcbud020, #自定義欄位(數字)020
          apcbud021 LIKE apcb_t.apcbud021, #自定義欄位(日期時間)021
          apcbud022 LIKE apcb_t.apcbud022, #自定義欄位(日期時間)022
          apcbud023 LIKE apcb_t.apcbud023, #自定義欄位(日期時間)023
          apcbud024 LIKE apcb_t.apcbud024, #自定義欄位(日期時間)024
          apcbud025 LIKE apcb_t.apcbud025, #自定義欄位(日期時間)025
          apcbud026 LIKE apcb_t.apcbud026, #自定義欄位(日期時間)026
          apcbud027 LIKE apcb_t.apcbud027, #自定義欄位(日期時間)027
          apcbud028 LIKE apcb_t.apcbud028, #自定義欄位(日期時間)028
          apcbud029 LIKE apcb_t.apcbud029, #自定義欄位(日期時間)029
          apcbud030 LIKE apcb_t.apcbud030, #自定義欄位(日期時間)030
          apcb052   LIKE apcb_t.apcb052, #稅額
          apcb053   LIKE apcb_t.apcb053, #含稅金額
          apcb054   LIKE apcb_t.apcb054, #帳款對象
          apcb055   LIKE apcb_t.apcb055  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sql     STRING
   #DEFINE l_isam    RECORD LIKE isam_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_isam  RECORD  #進項發票主檔
          isament   LIKE isam_t.isament, #企業編號
          isamownid LIKE isam_t.isamownid, #資料所有者
          isamowndp LIKE isam_t.isamowndp, #資料所屬部門
          isamcrtid LIKE isam_t.isamcrtid, #資料建立者
          isamcrtdp LIKE isam_t.isamcrtdp, #資料建立部門
          isamcrtdt LIKE isam_t.isamcrtdt, #資料創建日
          isammodid LIKE isam_t.isammodid, #資料修改者
          isammoddt LIKE isam_t.isammoddt, #最近修改日
          isamcnfid LIKE isam_t.isamcnfid, #資料確認者
          isamcnfdt LIKE isam_t.isamcnfdt, #資料確認日
          isamstus  LIKE isam_t.isamstus, #狀態碼
          isamcomp  LIKE isam_t.isamcomp, #法人
          isamdocno LIKE isam_t.isamdocno, #收票單號
          isamseq   LIKE isam_t.isamseq, #項次
          isam001   LIKE isam_t.isam001, #發票來源
          isam002   LIKE isam_t.isam002, #開發票人
          isam004   LIKE isam_t.isam004, #帳務中心(業務組織)
          isam006   LIKE isam_t.isam006, #業務部門(登錄部門)
          isam008   LIKE isam_t.isam008, #發票類型
          isam009   LIKE isam_t.isam009, #銷方發票編號
          isam010   LIKE isam_t.isam010, #發票號碼
          isam011   LIKE isam_t.isam011, #發票日期
          isam012   LIKE isam_t.isam012, #稅別
          isam0121  LIKE isam_t.isam0121, #含稅否
          isam013   LIKE isam_t.isam013, #稅率
          isam014   LIKE isam_t.isam014, #幣別
          isam015   LIKE isam_t.isam015, #匯率
          isam016   LIKE isam_t.isam016, #購貨方名稱
          isam017   LIKE isam_t.isam017, #購貨方統一編號
          isam018   LIKE isam_t.isam018, #購貨方地址
          isam019   LIKE isam_t.isam019, #購貨方電話
          isam020   LIKE isam_t.isam020, #購貨方開戶銀行
          isam021   LIKE isam_t.isam021, #購貨方帳戶編碼
          isam022   LIKE isam_t.isam022, #銷方銀行帳戶編碼
          isam023   LIKE isam_t.isam023, #發票原幣未稅金額
          isam024   LIKE isam_t.isam024, #發票原幣稅額
          isam025   LIKE isam_t.isam025, #發票原幣含稅金額
          isam026   LIKE isam_t.isam026, #發票本幣未稅金額
          isam027   LIKE isam_t.isam027, #發票本幣稅額
          isam028   LIKE isam_t.isam028, #發票本幣含稅金額
          isam029   LIKE isam_t.isam029, #銷貨方名稱
          isam030   LIKE isam_t.isam030, #統一編號
          isam031   LIKE isam_t.isam031, #銷貨方地址
          isam032   LIKE isam_t.isam032, #銷貨方電話
          isam033   LIKE isam_t.isam033, #銷貨方開戶銀行
          isam034   LIKE isam_t.isam034, #銷貨方帳號
          isam035   LIKE isam_t.isam035, #申報數量
          isam036   LIKE isam_t.isam036, #異動狀態
          isam037   LIKE isam_t.isam037, #可扣抵編號
          isam038   LIKE isam_t.isam038, #作廢(註銷)理由碼
          isam039   LIKE isam_t.isam039, #作廢日期
          isam040   LIKE isam_t.isam040, #作廢時間
          isam041   LIKE isam_t.isam041, #作廢人員
          isam042   LIKE isam_t.isam042, #專案作廢核准文號
          isam043   LIKE isam_t.isam043, #通關方式註記
          isam044   LIKE isam_t.isam044, #列印次數
          isam045   LIKE isam_t.isam045, #支付工具卡號1
          isam046   LIKE isam_t.isam046, #支付工具卡號2
          isam047   LIKE isam_t.isam047, #支付工具卡號3
          isam048   LIKE isam_t.isam048, #通關註記
          isam049   LIKE isam_t.isam049, #備註說明
          isam050   LIKE isam_t.isam050, #立帳單號
          isam107   LIKE isam_t.isam107, #發票原幣已折金額
          isam108   LIKE isam_t.isam108, #發票原幣已折稅額
          isam117   LIKE isam_t.isam117, #發票本幣已折金額
          isam118   LIKE isam_t.isam118, #發票本幣已折稅額
          isam200   LIKE isam_t.isam200, #電子發票否
          isam201   LIKE isam_t.isam201, #愛心碼
          isam202   LIKE isam_t.isam202, #載具類別號碼
          isam203   LIKE isam_t.isam203, #載具顯碼 ID
          isam204   LIKE isam_t.isam204, #載具隱碼 ID
          isam205   LIKE isam_t.isam205, #電子發票匯出狀態
          isam206   LIKE isam_t.isam206, #電子發票匯出序號
          isam207   LIKE isam_t.isam207, #電子發票領取方式
          isam208   LIKE isam_t.isam208, #申報年度
          isam209   LIKE isam_t.isam209, #申報月份
          isam210   LIKE isam_t.isam210, #申報據點
          isamud001 LIKE isam_t.isamud001, #自定義欄位(文字)001
          isamud002 LIKE isam_t.isamud002, #自定義欄位(文字)002
          isamud003 LIKE isam_t.isamud003, #自定義欄位(文字)003
          isamud004 LIKE isam_t.isamud004, #自定義欄位(文字)004
          isamud005 LIKE isam_t.isamud005, #自定義欄位(文字)005
          isamud006 LIKE isam_t.isamud006, #自定義欄位(文字)006
          isamud007 LIKE isam_t.isamud007, #自定義欄位(文字)007
          isamud008 LIKE isam_t.isamud008, #自定義欄位(文字)008
          isamud009 LIKE isam_t.isamud009, #自定義欄位(文字)009
          isamud010 LIKE isam_t.isamud010, #自定義欄位(文字)010
          isamud011 LIKE isam_t.isamud011, #自定義欄位(數字)011
          isamud012 LIKE isam_t.isamud012, #自定義欄位(數字)012
          isamud013 LIKE isam_t.isamud013, #自定義欄位(數字)013
          isamud014 LIKE isam_t.isamud014, #自定義欄位(數字)014
          isamud015 LIKE isam_t.isamud015, #自定義欄位(數字)015
          isamud016 LIKE isam_t.isamud016, #自定義欄位(數字)016
          isamud017 LIKE isam_t.isamud017, #自定義欄位(數字)017
          isamud018 LIKE isam_t.isamud018, #自定義欄位(數字)018
          isamud019 LIKE isam_t.isamud019, #自定義欄位(數字)019
          isamud020 LIKE isam_t.isamud020, #自定義欄位(數字)020
          isamud021 LIKE isam_t.isamud021, #自定義欄位(日期時間)021
          isamud022 LIKE isam_t.isamud022, #自定義欄位(日期時間)022
          isamud023 LIKE isam_t.isamud023, #自定義欄位(日期時間)023
          isamud024 LIKE isam_t.isamud024, #自定義欄位(日期時間)024
          isamud025 LIKE isam_t.isamud025, #自定義欄位(日期時間)025
          isamud026 LIKE isam_t.isamud026, #自定義欄位(日期時間)026
          isamud027 LIKE isam_t.isamud027, #自定義欄位(日期時間)027
          isamud028 LIKE isam_t.isamud028, #自定義欄位(日期時間)028
          isamud029 LIKE isam_t.isamud029, #自定義欄位(日期時間)029
          isamud030 LIKE isam_t.isamud030, #自定義欄位(日期時間)030
          isam051   LIKE isam_t.isam051  #認證否
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_ooef002     LIKE ooef_t.ooef002
   DEFINE l_ooefl006    LIKE ooefl_t.ooefl006
   DEFINE l_pmaal003    LIKE pmaal_t.pmaal003
   DEFINE l_isao001     LIKE isao_t.isao001
   DEFINE l_dummy1      LIKE type_t.num20_6
   #DEFINE l_apde        RECORD LIKE apde_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apde RECORD  #付款及差異處理明細檔
          apdeent   LIKE apde_t.apdeent, #企業編號
          apdecomp  LIKE apde_t.apdecomp, #法人
          apdeld    LIKE apde_t.apdeld, #帳套
          apdedocno LIKE apde_t.apdedocno, #沖銷單單號
          apdeseq   LIKE apde_t.apdeseq, #項次
          apdesite  LIKE apde_t.apdesite, #帳務中心
          apdeorga  LIKE apde_t.apdeorga, #帳務歸屬組織
          apde001   LIKE apde_t.apde001, #來源作業
          apde002   LIKE apde_t.apde002, #沖銷帳款類型
          apde003   LIKE apde_t.apde003, #已付款單號
          apde004   LIKE apde_t.apde004, #沖銷單項次
          apde006   LIKE apde_t.apde006, #款別編號
          apde008   LIKE apde_t.apde008, #帳戶/票券號碼
          apde009   LIKE apde_t.apde009, #已轉資料
          apde010   LIKE apde_t.apde010, #摘要說明
          apde011   LIKE apde_t.apde011, #銀行存提碼
          apde012   LIKE apde_t.apde012, #現金變動碼
          apde013   LIKE apde_t.apde013, #轉入客商碼
          apde014   LIKE apde_t.apde014, #轉入帳款單編號
          apde015   LIKE apde_t.apde015, #沖銷加減項
          apde016   LIKE apde_t.apde016, #沖銷會科
          apde017   LIKE apde_t.apde017, #業務人員
          apde018   LIKE apde_t.apde018, #業務部門
          apde019   LIKE apde_t.apde019, #責任中心
          apde020   LIKE apde_t.apde020, #產品類別
          apde021   LIKE apde_t.apde021, #票據類型
          apde022   LIKE apde_t.apde022, #專案編號
          apde023   LIKE apde_t.apde023, #WBS編號
          apde024   LIKE apde_t.apde024, #票據號碼
          apde028   LIKE apde_t.apde028, #產生方式
          apde029   LIKE apde_t.apde029, #傳票號碼
          apde030   LIKE apde_t.apde030, #傳票項次
          apde032   LIKE apde_t.apde032, #付款日
          apde035   LIKE apde_t.apde035, #區域
          apde036   LIKE apde_t.apde036, #客群
          apde038   LIKE apde_t.apde038, #對象
          apde039   LIKE apde_t.apde039, #受款銀行
          apde040   LIKE apde_t.apde040, #受款帳號
          apde041   LIKE apde_t.apde041, #受款人全名
          apde042   LIKE apde_t.apde042, #經營方式
          apde043   LIKE apde_t.apde043, #通路
          apde044   LIKE apde_t.apde044, #品牌
          apde045   LIKE apde_t.apde045, #摘要
          apde046   LIKE apde_t.apde046, #付款申請單
          apde047   LIKE apde_t.apde047, #付款申請單項次
          apde051   LIKE apde_t.apde051, #自由核算項一
          apde052   LIKE apde_t.apde052, #自由核算項二
          apde053   LIKE apde_t.apde053, #自由核算項三
          apde054   LIKE apde_t.apde054, #自由核算項四
          apde055   LIKE apde_t.apde055, #自由核算項五
          apde056   LIKE apde_t.apde056, #自由核算項六
          apde057   LIKE apde_t.apde057, #自由核算項七
          apde058   LIKE apde_t.apde058, #自由核算項八
          apde059   LIKE apde_t.apde059, #自由核算項九
          apde060   LIKE apde_t.apde060, #自由核算項十
          apde100   LIKE apde_t.apde100, #幣別
          apde101   LIKE apde_t.apde101, #匯率
          apde104   LIKE apde_t.apde104, #原幣應稅折抵稅額
          apde109   LIKE apde_t.apde109, #原幣沖帳金額
          apde119   LIKE apde_t.apde119, #本幣沖帳金額
          apde120   LIKE apde_t.apde120, #本位幣二幣別
          apde121   LIKE apde_t.apde121, #本位幣二匯率
          apde129   LIKE apde_t.apde129, #本位幣二沖帳金額
          apde130   LIKE apde_t.apde130, #本位幣三幣別
          apde131   LIKE apde_t.apde131, #本位幣三匯率
          apde139   LIKE apde_t.apde139, #本位幣三沖帳金額
          apdeud001 LIKE apde_t.apdeud001, #自定義欄位(文字)001
          apdeud002 LIKE apde_t.apdeud002, #自定義欄位(文字)002
          apdeud003 LIKE apde_t.apdeud003, #自定義欄位(文字)003
          apdeud004 LIKE apde_t.apdeud004, #自定義欄位(文字)004
          apdeud005 LIKE apde_t.apdeud005, #自定義欄位(文字)005
          apdeud006 LIKE apde_t.apdeud006, #自定義欄位(文字)006
          apdeud007 LIKE apde_t.apdeud007, #自定義欄位(文字)007
          apdeud008 LIKE apde_t.apdeud008, #自定義欄位(文字)008
          apdeud009 LIKE apde_t.apdeud009, #自定義欄位(文字)009
          apdeud010 LIKE apde_t.apdeud010, #自定義欄位(文字)010
          apdeud011 LIKE apde_t.apdeud011, #自定義欄位(數字)011
          apdeud012 LIKE apde_t.apdeud012, #自定義欄位(數字)012
          apdeud013 LIKE apde_t.apdeud013, #自定義欄位(數字)013
          apdeud014 LIKE apde_t.apdeud014, #自定義欄位(數字)014
          apdeud015 LIKE apde_t.apdeud015, #自定義欄位(數字)015
          apdeud016 LIKE apde_t.apdeud016, #自定義欄位(數字)016
          apdeud017 LIKE apde_t.apdeud017, #自定義欄位(數字)017
          apdeud018 LIKE apde_t.apdeud018, #自定義欄位(數字)018
          apdeud019 LIKE apde_t.apdeud019, #自定義欄位(數字)019
          apdeud020 LIKE apde_t.apdeud020, #自定義欄位(數字)020
          apdeud021 LIKE apde_t.apdeud021, #自定義欄位(日期時間)021
          apdeud022 LIKE apde_t.apdeud022, #自定義欄位(日期時間)022
          apdeud023 LIKE apde_t.apdeud023, #自定義欄位(日期時間)023
          apdeud024 LIKE apde_t.apdeud024, #自定義欄位(日期時間)024
          apdeud025 LIKE apde_t.apdeud025, #自定義欄位(日期時間)025
          apdeud026 LIKE apde_t.apdeud026, #自定義欄位(日期時間)026
          apdeud027 LIKE apde_t.apdeud027, #自定義欄位(日期時間)027
          apdeud028 LIKE apde_t.apdeud028, #自定義欄位(日期時間)028
          apdeud029 LIKE apde_t.apdeud029, #自定義欄位(日期時間)029
          apdeud030 LIKE apde_t.apdeud030, #自定義欄位(日期時間)030
          apde061   LIKE apde_t.apde061  #應付來源
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_pmab055     LIKE pmab_t.pmab055
   DEFINE l_glaa121     LIKE glaa_t.glaa121
   DEFINE l_glaa016     LIKE glaa_t.glaa016
   DEFINE l_glaa020     LIKE glaa_t.glaa020
   DEFINE l_glaa019     LIKE glaa_t.glaa019
   DEFINE l_glaa015     LIKE glaa_t.glaa015
   DEFINE l_glaa001     LIKE glaa_t.glaa001
   #DEFINE l_apgn        RECORD LIKE apgn_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apgn  RECORD  #外購信用狀結案檔
          apgnent   LIKE apgn_t.apgnent, #企業編號
          apgnownid LIKE apgn_t.apgnownid, #資料所有者
          apgnowndp LIKE apgn_t.apgnowndp, #資料所屬部門
          apgncrtid LIKE apgn_t.apgncrtid, #資料建立者
          apgncrtdp LIKE apgn_t.apgncrtdp, #資料建立部門
          apgncrtdt LIKE apgn_t.apgncrtdt, #資料創建日
          apgnmodid LIKE apgn_t.apgnmodid, #資料修改者
          apgnmoddt LIKE apgn_t.apgnmoddt, #最近修改日
          apgncnfid LIKE apgn_t.apgncnfid, #資料確認者
          apgncnfdt LIKE apgn_t.apgncnfdt, #資料確認日
          apgnstus  LIKE apgn_t.apgnstus, #狀態碼
          apgncomp  LIKE apgn_t.apgncomp, #法人
          apgndocno LIKE apgn_t.apgndocno, #結案單號
          apgndocdt LIKE apgn_t.apgndocdt, #結案日期
          apgn001   LIKE apgn_t.apgn001, #結案人員
          apgn002   LIKE apgn_t.apgn002, #退款沖銷單號
          apgn003   LIKE apgn_t.apgn003, #結案應付憑單號
          apgn004   LIKE apgn_t.apgn004, #預付轉費用金額
          apgn005   LIKE apgn_t.apgn005, #費用編號
          apgn100   LIKE apgn_t.apgn100, #幣別
          apgn101   LIKE apgn_t.apgn101, #結案匯率
          apgn103   LIKE apgn_t.apgn103, #開狀金額
          apgn104   LIKE apgn_t.apgn104, #到單金額
          apgn105   LIKE apgn_t.apgn105, #到貨金額
          apgn106   LIKE apgn_t.apgn106, #融資到帳金額
          apgn107   LIKE apgn_t.apgn107, #已付自備款金額
          apgn108   LIKE apgn_t.apgn108, #退還自備款金額
          apgn109   LIKE apgn_t.apgn109, #退還保證金金額
          apgnud001 LIKE apgn_t.apgnud001, #自定義欄位(文字)001
          apgnud002 LIKE apgn_t.apgnud002, #自定義欄位(文字)002
          apgnud003 LIKE apgn_t.apgnud003, #自定義欄位(文字)003
          apgnud004 LIKE apgn_t.apgnud004, #自定義欄位(文字)004
          apgnud005 LIKE apgn_t.apgnud005, #自定義欄位(文字)005
          apgnud006 LIKE apgn_t.apgnud006, #自定義欄位(文字)006
          apgnud007 LIKE apgn_t.apgnud007, #自定義欄位(文字)007
          apgnud008 LIKE apgn_t.apgnud008, #自定義欄位(文字)008
          apgnud009 LIKE apgn_t.apgnud009, #自定義欄位(文字)009
          apgnud010 LIKE apgn_t.apgnud010, #自定義欄位(文字)010
          apgnud011 LIKE apgn_t.apgnud011, #自定義欄位(數字)011
          apgnud012 LIKE apgn_t.apgnud012, #自定義欄位(數字)012
          apgnud013 LIKE apgn_t.apgnud013, #自定義欄位(數字)013
          apgnud014 LIKE apgn_t.apgnud014, #自定義欄位(數字)014
          apgnud015 LIKE apgn_t.apgnud015, #自定義欄位(數字)015
          apgnud016 LIKE apgn_t.apgnud016, #自定義欄位(數字)016
          apgnud017 LIKE apgn_t.apgnud017, #自定義欄位(數字)017
          apgnud018 LIKE apgn_t.apgnud018, #自定義欄位(數字)018
          apgnud019 LIKE apgn_t.apgnud019, #自定義欄位(數字)019
          apgnud020 LIKE apgn_t.apgnud020, #自定義欄位(數字)020
          apgnud021 LIKE apgn_t.apgnud021, #自定義欄位(日期時間)021
          apgnud022 LIKE apgn_t.apgnud022, #自定義欄位(日期時間)022
          apgnud023 LIKE apgn_t.apgnud023, #自定義欄位(日期時間)023
          apgnud024 LIKE apgn_t.apgnud024, #自定義欄位(日期時間)024
          apgnud025 LIKE apgn_t.apgnud025, #自定義欄位(日期時間)025
          apgnud026 LIKE apgn_t.apgnud026, #自定義欄位(日期時間)026
          apgnud027 LIKE apgn_t.apgnud027, #自定義欄位(日期時間)027
          apgnud028 LIKE apgn_t.apgnud028, #自定義欄位(日期時間)028
          apgnud029 LIKE apgn_t.apgnud029, #自定義欄位(日期時間)029
          apgnud030 LIKE apgn_t.apgnud030, #自定義欄位(日期時間)030
          apgn006   LIKE apgn_t.apgn006, #退還自備款存提碼
          apgn007   LIKE apgn_t.apgn007, #退還自備款現金變動碼
          apgn008   LIKE apgn_t.apgn008, #退還保證金存提碼
          apgn009   LIKE apgn_t.apgn009, #退還保證金現金變動碼
          apgn010   LIKE apgn_t.apgn010, #退還預付款存提碼
          apgn011   LIKE apgn_t.apgn011, #退還預付款現金變動碼
          apgn102   LIKE apgn_t.apgn102, #退還預付款原幣金額
          apgn112   LIKE apgn_t.apgn112, #退還預付款本幣金額
          apgn118   LIKE apgn_t.apgn118, #退還自備款本幣金額
          apgn119   LIKE apgn_t.apgn119, #退還保證金本幣金額
          apgn012   LIKE apgn_t.apgn012, #受款帳戶
          apgn013   LIKE apgn_t.apgn013  #申請單號
              END RECORD
   #161104-00024#5-add(e)
   DEFINE r_docno       LIKE apga_t.apgadocno
   
   DEFINE l_oodb004     LIKE oodb_t.oodb004
   DEFINE l_apca013     LIKE apca_t.apca013
   DEFINE l_apca012     LIKE apca_t.apca012
   DEFINE l_oodb011     LIKE oodb_t.oodb011
   DEFINE l_date        DATETIME YEAR TO SECOND
   DEFINE l_count       LIKE type_t.num10
#albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
   DEFINE l_apcb113sum  LIKE type_t.num20_6
   DEFINE l_apcb114sum  LIKE type_t.num20_6
   DEFINE l_apcb115sum  LIKE type_t.num20_6
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   #albireo 1606301-----s
   #DEFINE l_apce        RECORD LIKE apce_t.* #161104-00024#5 mark
   #161104-00024#5-add(s)
   DEFINE l_apce  RECORD  #應付沖帳明細
          apceent   LIKE apce_t.apceent, #企業編號
          apcecomp  LIKE apce_t.apcecomp, #法人
          apcelegl  LIKE apce_t.apcelegl, #核算組織
          apcesite  LIKE apce_t.apcesite, #帳務組織
          apceld    LIKE apce_t.apceld, #帳套
          apceorga  LIKE apce_t.apceorga, #帳務歸屬組織
          apcedocno LIKE apce_t.apcedocno, #沖銷單單號
          apceseq   LIKE apce_t.apceseq, #項次
          apce001   LIKE apce_t.apce001, #來源作業
          apce002   LIKE apce_t.apce002, #沖銷類型
          apce003   LIKE apce_t.apce003, #沖銷帳款單單號
          apce004   LIKE apce_t.apce004, #沖銷帳款單項次
          apce005   LIKE apce_t.apce005, #分期帳款序
          apce006   LIKE apce_t.apce006, #no use
          apce007   LIKE apce_t.apce007, #no use
          apce008   LIKE apce_t.apce008, #票據號碼/ 現金銀存帳戶
          apce009   LIKE apce_t.apce009, #no use
          apce010   LIKE apce_t.apce010, #摘要說明
          apce011   LIKE apce_t.apce011, #理由碼
          apce012   LIKE apce_t.apce012, #銀存存提碼
          apce013   LIKE apce_t.apce013, #現金異動碼
          apce014   LIKE apce_t.apce014, #no use
          apce015   LIKE apce_t.apce015, #沖銷加減項
          apce016   LIKE apce_t.apce016, #沖銷科目
          apce017   LIKE apce_t.apce017, #業務人員
          apce018   LIKE apce_t.apce018, #業務部門
          apce019   LIKE apce_t.apce019, #責任中心
          apce020   LIKE apce_t.apce020, #產品類別
          apce021   LIKE apce_t.apce021, #no use
          apce022   LIKE apce_t.apce022, #專案編號
          apce023   LIKE apce_t.apce023, #WBS編號
          apce024   LIKE apce_t.apce024, #第二參考單號
          apce025   LIKE apce_t.apce025, #第二參考單號項次
          apce026   LIKE apce_t.apce026, #no use
          apce027   LIKE apce_t.apce027, #應稅折抵否
          apce028   LIKE apce_t.apce028, #產生方式
          apce029   LIKE apce_t.apce029, #傳票號碼
          apce030   LIKE apce_t.apce030, #傳票項次
          apce031   LIKE apce_t.apce031, #付款(票)到期日
          apce032   LIKE apce_t.apce032, #應付款日
          apce033   LIKE apce_t.apce033, #no use
          apce034   LIKE apce_t.apce034, #no use
          apce035   LIKE apce_t.apce035, #區域
          apce036   LIKE apce_t.apce036, #客戶分類
          apce037   LIKE apce_t.apce037, #no use
          apce038   LIKE apce_t.apce038, #帳款對象
          apce039   LIKE apce_t.apce039, #no use
          apce040   LIKE apce_t.apce040, #no use
          apce041   LIKE apce_t.apce041, #no use
          apce042   LIKE apce_t.apce042, #no use
          apce043   LIKE apce_t.apce043, #no use
          apce044   LIKE apce_t.apce044, #經營方式
          apce045   LIKE apce_t.apce045, #通路
          apce046   LIKE apce_t.apce046, #品牌
          apce047   LIKE apce_t.apce047, #發票編號
          apce048   LIKE apce_t.apce048, #發票號碼
          apce049   LIKE apce_t.apce049, #付款申請單號碼
          apce050   LIKE apce_t.apce050, #付款申請單項次
          apce051   LIKE apce_t.apce051, #自由核算項一
          apce052   LIKE apce_t.apce052, #自由核算項二
          apce053   LIKE apce_t.apce053, #自由核算項三
          apce054   LIKE apce_t.apce054, #自由核算項四
          apce055   LIKE apce_t.apce055, #自由核算項五
          apce056   LIKE apce_t.apce056, #自由核算項六
          apce057   LIKE apce_t.apce057, #自由核算項七
          apce058   LIKE apce_t.apce058, #自由核算項八
          apce059   LIKE apce_t.apce059, #自由核算項九
          apce060   LIKE apce_t.apce060, #自由核算項十
          apce100   LIKE apce_t.apce100, #幣別
          apce101   LIKE apce_t.apce101, #匯率
          apce104   LIKE apce_t.apce104, #原幣應稅折抵稅額
          apce109   LIKE apce_t.apce109, #原幣沖帳金額
          apce114   LIKE apce_t.apce114, #本幣應稅折抵稅額
          apce119   LIKE apce_t.apce119, #本幣沖帳金額
          apce120   LIKE apce_t.apce120, #本位幣二幣別
          apce124   LIKE apce_t.apce124, #本位幣二應稅折抵稅額
          apce121   LIKE apce_t.apce121, #本位幣二匯率
          apce129   LIKE apce_t.apce129, #本位幣二沖帳金額
          apce130   LIKE apce_t.apce130, #本位幣三幣別
          apce131   LIKE apce_t.apce131, #本位幣三匯率
          apce134   LIKE apce_t.apce134, #本位幣三應稅折抵稅額
          apce139   LIKE apce_t.apce139, #本位幣三沖帳金額
          apceud001 LIKE apce_t.apceud001, #自定義欄位(文字)001
          apceud002 LIKE apce_t.apceud002, #自定義欄位(文字)002
          apceud003 LIKE apce_t.apceud003, #自定義欄位(文字)003
          apceud004 LIKE apce_t.apceud004, #自定義欄位(文字)004
          apceud005 LIKE apce_t.apceud005, #自定義欄位(文字)005
          apceud006 LIKE apce_t.apceud006, #自定義欄位(文字)006
          apceud007 LIKE apce_t.apceud007, #自定義欄位(文字)007
          apceud008 LIKE apce_t.apceud008, #自定義欄位(文字)008
          apceud009 LIKE apce_t.apceud009, #自定義欄位(文字)009
          apceud010 LIKE apce_t.apceud010, #自定義欄位(文字)010
          apceud011 LIKE apce_t.apceud011, #自定義欄位(數字)011
          apceud012 LIKE apce_t.apceud012, #自定義欄位(數字)012
          apceud013 LIKE apce_t.apceud013, #自定義欄位(數字)013
          apceud014 LIKE apce_t.apceud014, #自定義欄位(數字)014
          apceud015 LIKE apce_t.apceud015, #自定義欄位(數字)015
          apceud016 LIKE apce_t.apceud016, #自定義欄位(數字)016
          apceud017 LIKE apce_t.apceud017, #自定義欄位(數字)017
          apceud018 LIKE apce_t.apceud018, #自定義欄位(數字)018
          apceud019 LIKE apce_t.apceud019, #自定義欄位(數字)019
          apceud020 LIKE apce_t.apceud020, #自定義欄位(數字)020
          apceud021 LIKE apce_t.apceud021, #自定義欄位(日期時間)021
          apceud022 LIKE apce_t.apceud022, #自定義欄位(日期時間)022
          apceud023 LIKE apce_t.apceud023, #自定義欄位(日期時間)023
          apceud024 LIKE apce_t.apceud024, #自定義欄位(日期時間)024
          apceud025 LIKE apce_t.apceud025, #自定義欄位(日期時間)025
          apceud026 LIKE apce_t.apceud026, #自定義欄位(日期時間)026
          apceud027 LIKE apce_t.apceud027, #自定義欄位(日期時間)027
          apceud028 LIKE apce_t.apceud028, #自定義欄位(日期時間)028
          apceud029 LIKE apce_t.apceud029, #自定義欄位(日期時間)029
          apceud030 LIKE apce_t.apceud030, #自定義欄位(日期時間)030
          apce103   LIKE apce_t.apce103, #原幣未稅沖銷額
          apce113   LIKE apce_t.apce113, #本位未稅沖銷額
          apce123   LIKE apce_t.apce123, #本位幣二未稅沖銷額
          apce133   LIKE apce_t.apce133, #本位幣三未稅沖銷額
          apce061   LIKE apce_t.apce061  #付款對象
              END RECORD
   #161104-00024#5-add(e)
   DEFINE l_sfin2002    LIKE type_t.chr10
   #albireo 1606301-----e
   DEFINE l_xrcd009     LIKE xrcd_t.xrcd009
   DEFINE l_ooef011     LIKE ooef_t.ooef011 #161129-00042#1-add
   DEFINE l_isac004     LIKE isac_t.isac004 #161230-00036#1-add
   DEFINE l_isac008     LIKE isac_t.isac008 #161230-00036#1-add
   DEFINE l_vat_id      STRING              #161230-00036#1-add
   WHENEVER ERROR CONTINUE
   
   LET r_success = TRUE
   LET r_docno   = NULL
   INITIALIZE l_apgn.* TO NULL
   #SELECT * INTO l_apgn.* FROM apgn_t WHERE apgnent = g_enterprise AND apgncomp = g_apcacomp AND apgndocno = g_apca_m.apca018 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgnent,apgnownid,apgnowndp,apgncrtid,apgncrtdp,
          apgncrtdt,apgnmodid,apgnmoddt,apgncnfid,apgncnfdt,
          apgnstus,apgncomp,apgndocno,apgndocdt,apgn001,
          apgn002,apgn003,apgn004,apgn005,apgn100,
          apgn101,apgn103,apgn104,apgn105,apgn106,
          apgn107,apgn108,apgn109,apgnud001,apgnud002,
          apgnud003,apgnud004,apgnud005,apgnud006,apgnud007,
          apgnud008,apgnud009,apgnud010,apgnud011,apgnud012,
          apgnud013,apgnud014,apgnud015,apgnud016,apgnud017,
          apgnud018,apgnud019,apgnud020,apgnud021,apgnud022,
          apgnud023,apgnud024,apgnud025,apgnud026,apgnud027,
          apgnud028,apgnud029,apgnud030,apgn006,apgn007,
          apgn008,apgn009,apgn010,apgn011,apgn102,
          apgn112,apgn118,apgn119,apgn012,apgn013 
     INTO l_apgn.* 
     FROM apgn_t 
    WHERE apgnent = g_enterprise 
      AND apgncomp = g_apcacomp 
      AND apgndocno = g_apca_m.apca018 
   #161208-00026#13-add(e)
   INITIALIZE l_apga.* TO NULL
   #SELECT * INTO l_apga.* FROM apga_t WHERE apgaent = g_enterprise AND apgacomp = g_apcacomp AND apgadocno = l_apgn.apgn013 #161208-00026#13 mark
   #161208-00026#13-add(s)
   SELECT apgaent,apgaownid,apgaowndp,apgacrtid,apgacrtdp,
          apgacrtdt,apgamodid,apgamoddt,apgacnfid,apgacnfdt,
          apgapstid,apgapstdt,apgastus,apgacomp,apgadocno,
          apgadocdt,apga001,apga002,apga003,apga004,
          apga005,apga006,apga007,apga008,apga009,
          apga010,apga011,apga012,apga013,apga014,
          apga015,apga016,apga017,apga018,apga019,
          apga020,apga021,apga022,apga023,apga024,
          apga025,apga026,apga027,apga028,apga029,
          apga030,apga031,apga100,apga101,apga103,
          apga104,apga105,apga106,apga107,apga108,
          apga113,apga114,apga115,apgaud001,apgaud002,
          apgaud003,apgaud004,apgaud005,apgaud006,apgaud007,
          apgaud008,apgaud009,apgaud010,apgaud011,apgaud012,
          apgaud013,apgaud014,apgaud015,apgaud016,apgaud017,
          apgaud018,apgaud019,apgaud020,apgaud021,apgaud022,
          apgaud023,apgaud024,apgaud025,apgaud026,apgaud027,
          apgaud028,apgaud029,apgaud030,apga102,apga109,
          apga112,apga117,apga118,apga032,apga033,
          apga034,apga035,apga040,apga041,apga036,
          apga037,apga038,apga039 
     INTO l_apga.* 
     FROM apga_t 
    WHERE apgaent = g_enterprise
      AND apgacomp = g_apcacomp 
      AND apgadocno = l_apgn.apgn013
   #161208-00026#13-add(e)
   
   INITIALIZE l_apca.* TO NULL
   LET l_apca.apcaent = g_enterprise
   LET l_apca.apcacomp = l_apga.apgacomp
   LET l_apca.apcald = NULL
   SELECT glaald,glaa001,glaa016,glaa020
     INTO l_apca.apcald,l_apca.apca100,l_apca.apca120,l_apca.apca130
     FROM glaa_t
    WHERE glaaent  = g_enterprise
      AND glaacomp = l_apca.apcacomp
      AND glaa014  = 'Y'
   LET l_apca.apcadocdt = g_apca_m.apcadocdt
   LET l_apca.apca003   = g_apca_m.apca003
   LET l_apca.apca016   = g_apca_m.apca016
   LET l_apca.apca018   = g_apca_m.apca018
   LET l_apca.apcadocno = g_apca_m.apcadocno
   CALL s_aooi200_fin_gen_docno(l_apca.apcald,'','',l_apca.apcadocno,l_apca.apcadocdt,'aapt560') 
      RETURNING g_sub_success,l_apca.apcadocno                                            
   IF NOT g_sub_success THEN
      LET r_success = FALSE
      RETURN r_success,r_docno
   END IF
   LET l_apca.apcastus  = 'N' # 狀態碼 
   LET l_apca.apcasite = l_apca.apcacomp   # 帳務中心                            apcasite   = apgccomp                                                    
   LET l_apca.apca001 =  '31'    #s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3001')
   LET l_apca.apca003 = g_user # 帳務人員                            apca003    = g_user                                                      
   LET l_apca.apca004 = l_apga.apga004 # 帳款對象編號                        apca004    = 廠商(受益人)apga004   
   CALL s_apmm100_sel_pmac002(l_apca.apca004,'1') RETURNING l_apca.apca005,l_desc
   IF cl_null(l_apca.apca005)THEN LET l_apca.apca005 = l_apca.apca004 END IF
   SELECT pmaa080,pmaa047 INTO l_apca.apca006,l_apca.apca046
     FROM pmaa_t
    WHERE pmaaent = g_enterprise AND pmaa001 = l_apca.apca004
   LET lc_param_apca.apcald   = l_apca.apcald
   LET lc_param_apca.apcacomp = l_apca.apcacomp
   LET lc_param_apca.apcasite = l_apca.apcasite
   LET lc_param_apca.apcadocdt= l_apca.apcadocdt
   LET lc_param_apca.apca001  = '19'    #l_apca.apca001   ##160824-00049#7 modify
   LET lc_param_apca.apca004  = l_apca.apca004
   SELECT ooef019 INTO lc_param_apca.ooef019 FROM ooef_t
    WHERE ooefent = g_enterprise
      AND ooef001 = l_apca.apcacomp
   LET ls_js = util.JSON.stringify(lc_param_apca)
   CALL s_aapt300_get_apca004_info(ls_js) RETURNING ls_js
   CALL util.JSON.parse(ls_js,lc_param_info)
   LET l_apca.apca006 = lc_param_info.apca006  
   LET l_apca.apca007 = lc_param_info.apca007   # 帳款類別           apca007    = 廠商慣用條件
   LET l_apca.apca008 = lc_param_info.apca008   # 付款條件編號       apca008    = 取交易對象慣用付款條件
   LET l_apca.apca009 = lc_param_info.apca009   # 應付款日/應扣抵日  apca009    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca010 = lc_param_info.apca010   # 容許票據到期日     apca010    = 不依付款條件推算,開狀日期支付銀行,故=開狀日期
   LET l_apca.apca011 = lc_param_info.apca011   # 稅別               apca011    = 取交易對象慣用稅別,實際稅別在單身呈現
   LET l_apca.apca012 = lc_param_info.apca012   # 稅率               apca012    = 依稅別串 oodb006
   LET l_apca.apca013 = lc_param_info.apca013   # 含稅否             apca013    = 依稅別串 oodb005                   
   LET l_apca.apca014 = l_apga.apga005          # 人員編號           apca014    = apga005
   LET l_apca.apca015 = NULL                    # 部門編號           apca015    = apga005 所屬部門
   SELECT ooag003 INTO l_apca.apca015 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apca.apca014 
   LET l_apca.apca034 = lc_param_info.apca034   # 責任中心                            apca034    = 依 aapt300原則帶出      
   LET l_apca.apca035 = lc_param_info.apca035   # 應付(貸方)科目編號                  apca035    = 依帳款類別帶出           
   LET l_apca.apca036 = lc_param_info.apca036   # 費用(借方)科目編號                  apca036    = 依帳款類別帶出     
   LET l_apca.apca046 = lc_param_info.apca046       
   LET l_apca.apca054 = lc_param_info.apca054   # 多帳期設定                          apca054    = 依付款條件取出 
   LET l_apca.apca055 = lc_param_info.apca055   # 繳款優惠條件                        apca055    = 依付款條件取出 
   LET l_apca.apca058 = lc_param_info.apca058
   LET l_apca.apca060 = lc_param_info.apca060
   LET l_apca.apca016 = '36'
   LET l_apca.apca017 = '1'
   LET l_apca.apca018 = l_apgn.apgndocno
   LET l_apca.apca020 = 'N'         # 信用狀付款否 
   LET l_apca.apca026 = 0
   LET l_apca.apca027 = 0
   LET l_apca.apca028 = 0
   LET l_apca.apca029 = 0
   LET l_apca.apca037 = s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-0030')# 產生傳票否                          apca037    = 取單別參數D-FIN-0030    
   LET l_apca.apca067 = l_apga.apgadocno
   LET l_apca.apca101 = 1
   LET l_apca.apca103 = 0
   LET l_apca.apca104 = 0
   LET l_apca.apca106 = 0 
   LET l_apca.apca107 = 0
   LET l_apca.apca108 = 0 
   LET l_apca.apca113 = 0
   LET l_apca.apca114 = 0 
   LET l_apca.apca116 = 0
   LEt l_apca.apca117 = 0 
   LET l_apca.apca118 = 0 
   LET lc_param2.apca004 = l_apca.apca004
   CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-3009') RETURNING lc_param2.sfin2009
   LET ls_js = util.JSON.stringify(lc_param2)   
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apca.apca100,ls_js)
        RETURNING l_apca.apca101,l_apca.apca121,l_apca.apca131
   LET l_apca.apca123 = 0
   LET l_apca.apca124 = 0
   LET l_apca.apca126 = 0 
   LET l_apca.apca127 = 0 
   LET l_apca.apca128 = 0
   LET l_apca.apca133 = 0 
   LET l_apca.apca134 = 0 
   LET l_apca.apca136 = 0 
   LET l_apca.apca137 = 0
   LET l_apca.apca138 = 0 
   LET l_apca.apca071 = 0
   LET l_apca.apca072 = 0
   #160824-00049#7-----s
   LET l_apca.apca073 = l_apga.apga001
   LET l_apca.apcaownid = g_user
   LET l_apca.apcaowndp = g_dept
   LET l_apca.apcacrtid = g_user
   LET l_apca.apcacrtdp = g_dept
   LET l_date = cl_get_current()
   LET l_apca.apcacrtdt = l_date
   #160824-00049#7-----e
   #INSERT INTO apca_t VALUES(l_apca.*) #161108-00017#4 mark
   #161108-00017#4 add ------
   INSERT INTO apca_t (apcaent,apcaownid,apcaowndp,apcacrtid,apcacrtdp,
                       apcacrtdt,apcamodid,apcamoddt,apcacnfid,apcacnfdt,
                       apcapstid,apcapstdt,apcastus,apcald,apcacomp,
                       apcadocno,apcadocdt,apcasite,
                       apca001,apca003,apca004,apca005,apca006,
                       apca007,apca008,apca009,apca010,apca011,
                       apca012,apca013,apca014,apca015,apca016,
                       apca017,apca018,apca019,apca020,apca021,
                       apca022,apca025,apca026,apca027,apca028,
                       apca029,apca030,apca031,apca032,apca033,
                       apca034,apca035,apca036,apca037,apca038,
                       apca039,apca040,apca041,apca042,apca043,
                       apca044,apca045,apca046,apca047,apca048,
                       apca049,apca050,apca051,apca052,apca053,
                       apca054,apca055,apca056,apca057,apca058,
                       apca059,apca060,apca061,apca062,apca063,
                       apca064,apca065,apca066,apca100,apca101,
                       apca103,apca104,apca106,apca107,apca108,
                       apca113,apca114,apca116,apca117,apca118,
                       apca120,apca121,apca123,apca124,apca126,
                       apca127,apca128,apca130,apca131,apca133,
                       apca134,apca136,apca137,apca138,
                       apcaud001,apcaud002,apcaud003,apcaud004,apcaud005,
                       apcaud006,apcaud007,apcaud008,apcaud009,apcaud010,
                       apcaud011,apcaud012,apcaud013,apcaud014,apcaud015,
                       apcaud016,apcaud017,apcaud018,apcaud019,apcaud020,
                       apcaud021,apcaud022,apcaud023,apcaud024,apcaud025,
                       apcaud026,apcaud027,apcaud028,apcaud029,apcaud030,
                       apca067,apca068,apca069,apca070,apca071,
                       apca072,apca073
                      )
   VALUES (l_apca.apcaent,l_apca.apcaownid,l_apca.apcaowndp,l_apca.apcacrtid,l_apca.apcacrtdp,
           l_apca.apcacrtdt,l_apca.apcamodid,l_apca.apcamoddt,l_apca.apcacnfid,l_apca.apcacnfdt,
           l_apca.apcapstid,l_apca.apcapstdt,l_apca.apcastus,l_apca.apcald,l_apca.apcacomp,
           l_apca.apcadocno,l_apca.apcadocdt,l_apca.apcasite,
           l_apca.apca001,l_apca.apca003,l_apca.apca004,l_apca.apca005,l_apca.apca006,
           l_apca.apca007,l_apca.apca008,l_apca.apca009,l_apca.apca010,l_apca.apca011,
           l_apca.apca012,l_apca.apca013,l_apca.apca014,l_apca.apca015,l_apca.apca016,
           l_apca.apca017,l_apca.apca018,l_apca.apca019,l_apca.apca020,l_apca.apca021,
           l_apca.apca022,l_apca.apca025,l_apca.apca026,l_apca.apca027,l_apca.apca028,
           l_apca.apca029,l_apca.apca030,l_apca.apca031,l_apca.apca032,l_apca.apca033,
           l_apca.apca034,l_apca.apca035,l_apca.apca036,l_apca.apca037,l_apca.apca038,
           l_apca.apca039,l_apca.apca040,l_apca.apca041,l_apca.apca042,l_apca.apca043,
           l_apca.apca044,l_apca.apca045,l_apca.apca046,l_apca.apca047,l_apca.apca048,
           l_apca.apca049,l_apca.apca050,l_apca.apca051,l_apca.apca052,l_apca.apca053,
           l_apca.apca054,l_apca.apca055,l_apca.apca056,l_apca.apca057,l_apca.apca058,
           l_apca.apca059,l_apca.apca060,l_apca.apca061,l_apca.apca062,l_apca.apca063,
           l_apca.apca064,l_apca.apca065,l_apca.apca066,l_apca.apca100,l_apca.apca101,
           l_apca.apca103,l_apca.apca104,l_apca.apca106,l_apca.apca107,l_apca.apca108,
           l_apca.apca113,l_apca.apca114,l_apca.apca116,l_apca.apca117,l_apca.apca118,
           l_apca.apca120,l_apca.apca121,l_apca.apca123,l_apca.apca124,l_apca.apca126,
           l_apca.apca127,l_apca.apca128,l_apca.apca130,l_apca.apca131,l_apca.apca133,
           l_apca.apca134,l_apca.apca136,l_apca.apca137,l_apca.apca138,
           l_apca.apcaud001,l_apca.apcaud002,l_apca.apcaud003,l_apca.apcaud004,l_apca.apcaud005,
           l_apca.apcaud006,l_apca.apcaud007,l_apca.apcaud008,l_apca.apcaud009,l_apca.apcaud010,
           l_apca.apcaud011,l_apca.apcaud012,l_apca.apcaud013,l_apca.apcaud014,l_apca.apcaud015,
           l_apca.apcaud016,l_apca.apcaud017,l_apca.apcaud018,l_apca.apcaud019,l_apca.apcaud020,
           l_apca.apcaud021,l_apca.apcaud022,l_apca.apcaud023,l_apca.apcaud024,l_apca.apcaud025,
           l_apca.apcaud026,l_apca.apcaud027,l_apca.apcaud028,l_apca.apcaud029,l_apca.apcaud030,
           l_apca.apca067,l_apca.apca068,l_apca.apca069,l_apca.apca070,l_apca.apca071,
           l_apca.apca072,l_apca.apca073
          )
   #161108-00017#4 add end---
   
   #apgc產生 apcb xrcd_t
   #LET l_sql = "SELECT * FROM apgc_t ",   #161208-00026#13 mark
   #161208-00026#13-add(s)
   LET l_sql = "SELECT apgcent,apgccomp,apgcdocno,apgcseq,apgc900,
                       apgcorga,apgc001,apgc002,apgc003,apgc004,
                       apgc005,apgc006,apgc007,apgc008,apgc009,
                       apgc010,apgc011,apgc012,apgc013,apgc014,
                       apgc015,apgc016,apgc100,apgc101,apgc103,
                       apgc104,apgc105,apgc113,apgc114,apgc115,
                       apgcud001,apgcud002,apgcud003,apgcud004,apgcud005,
                       apgcud006,apgcud007,apgcud008,apgcud009,apgcud010,
                       apgcud011,apgcud012,apgcud013,apgcud014,apgcud015,
                       apgcud016,apgcud017,apgcud018,apgcud019,apgcud020,
                       apgcud021,apgcud022,apgcud023,apgcud024,apgcud025,
                       apgcud026,apgcud027,apgcud028,apgcud029,apgcud030 
                  FROM apgc_t ",
   #161208-00026#13-add(e)
               " WHERE apgcent = ",g_enterprise," ",
               "   AND apgccomp = '",l_apgn.apgncomp,"' ",
               "   AND apgcdocno = '",l_apgn.apgndocno,"' ",
               "   AND apgc900 = '0' "
   PREPARE sel_apgcp6 FROM l_sql
   DECLARE sel_apgcc6 CURSOR FOR sel_apgcp6
   
   #FOREACH sel_apgcc6 INTO l_apgc.*   #161208-00026#13 mark
   #161208-00026#13-add(s)
   FOREACH sel_apgcc6 INTO l_apgc.apgcent,l_apgc.apgccomp,l_apgc.apgcdocno,l_apgc.apgcseq,l_apgc.apgc900,
                           l_apgc.apgcorga,l_apgc.apgc001,l_apgc.apgc002,l_apgc.apgc003,l_apgc.apgc004,
                           l_apgc.apgc005,l_apgc.apgc006,l_apgc.apgc007,l_apgc.apgc008,l_apgc.apgc009,
                           l_apgc.apgc010,l_apgc.apgc011,l_apgc.apgc012,l_apgc.apgc013,l_apgc.apgc014,
                           l_apgc.apgc015,l_apgc.apgc016,l_apgc.apgc100,l_apgc.apgc101,l_apgc.apgc103,
                           l_apgc.apgc104,l_apgc.apgc105,l_apgc.apgc113,l_apgc.apgc114,l_apgc.apgc115,
                           l_apgc.apgcud001,l_apgc.apgcud002,l_apgc.apgcud003,l_apgc.apgcud004,l_apgc.apgcud005,
                           l_apgc.apgcud006,l_apgc.apgcud007,l_apgc.apgcud008,l_apgc.apgcud009,l_apgc.apgcud010,
                           l_apgc.apgcud011,l_apgc.apgcud012,l_apgc.apgcud013,l_apgc.apgcud014,l_apgc.apgcud015,
                           l_apgc.apgcud016,l_apgc.apgcud017,l_apgc.apgcud018,l_apgc.apgcud019,l_apgc.apgcud020,
                           l_apgc.apgcud021,l_apgc.apgcud022,l_apgc.apgcud023,l_apgc.apgcud024,l_apgc.apgcud025,
                           l_apgc.apgcud026,l_apgc.apgcud027,l_apgc.apgcud028,l_apgc.apgcud029,l_apgc.apgcud030  
   #161208-00026#13-add(e)
      IF SQLCA.SQLCODE THEN EXIT FOREACH END IF
      #r2.產生apcb-----s
      INITIALIZE l_apcb.* TO NULL
      LET l_apcb.apcbent   = g_enterprise
      LET l_apcb.apcbld    = l_apca.apcald
      LET l_apcb.apcblegl  = l_apca.apcacomp
      LET l_apcb.apcbsite  = l_apca.apcasite
      LET l_apcb.apcbdocno = l_apca.apcadocno
      LET l_apcb.apcbseq   = NULL
      SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
       WHERE apcbent   = g_enterprise
         AND apcbld    = l_apcb.apcbld
         AND apcbdocno = l_apcb.apcbdocno
      IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
      LET l_apcb.apcb001 = '54'
      LET l_apcb.apcb002 = l_apgc.apgcdocno
      LET l_apcb.apcb003 = l_apgc.apgcseq
      LET l_apcb.apcb014 = l_apgc.apgc001 #160428-00001#8       
      LET l_apcb.apcb005 = s_desc_get_acc_desc('3117',l_apgc.apgc001)
      LET l_apcb.apcb006 = ' '
      LET l_apcb.apcb007 = 1
      LET l_apcb.apcb010 = l_apca.apca015
      CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                       RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
      LET l_apcb.apcb020 = l_apgc.apgc006
      LET l_apcb.apcb021 = l_apgc.apgc004
      LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')   #albireo 160624 add
      LET l_apcb.apcb023 = 'N'
      LET l_apcb.apcb027 = l_apgc.apgc008
      LET l_apcb.apcb028 = l_apgc.apgc009
      LET l_apcb.apcb029 = l_apca.apca035
      LET l_apcb.apcb030 = l_apca.apca008
      LET l_apcb.apcb051 = l_apca.apca014
      LET l_apcb.apcb100 = l_apgc.apgc100
      LET l_apcb.apcb101 = l_apgc.apgc105   #albireo 160623 add
      LET l_apcb.apcb102 = l_apgc.apgc101
      LET l_apcb.apcb103 = l_apgc.apgc103
      LET l_apcb.apcb104 = l_apgc.apgc104
      LET l_apcb.apcb105 = l_apgc.apgc105
      LET l_apcb.apcb108 = l_apcb.apcb103
      LET l_apcb.apcb111 = l_apgc.apgc115   #albireo 160623 add
      LET l_apcb.apcb113 = l_apgc.apgc113
      LET l_apcb.apcb114 = l_apgc.apgc114
      LET l_apcb.apcb115 = l_apgc.apgc115
      LET l_apcb.apcborga = l_apgc.apgcorga
      CALL s_tax_chk(l_apca.apcacomp,l_apcb.apcb020) RETURNING g_sub_success,l_oodb004,l_apca013,l_apca012,l_oodb011
      IF l_apca013 = 'Y' THEN
         LET l_apcb.apcb105 = l_apcb.apcb105
      ELSE
         LET l_apcb.apcb105 = l_apcb.apcb103
      END IF
      CALL s_tax_ins(l_apca.apcadocno,l_apcb.apcbseq,'0',l_apcb.apcborga,l_apcb.apcb105,
                l_apcb.apcb020,l_apcb.apcb007,l_apcb.apcb100,l_apcb.apcb102,l_apca.apcald,l_apca.apca121,l_apca.apca131)   #albireo 160630
          RETURNING l_apcb.apcb103,l_apcb.apcb104,l_apcb.apcb105,
                    l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,
                    l_apcb.apcb123,l_apcb.apcb124,l_apcb.apcb125,
                    l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         EXIT FOREACH
         LET r_success = FALSE
      END IF
      #r2.產生apcb-----e
      
      #r3.產生直接付款apde-----s
      INITIALIZE l_apde.* TO NULL
      LET l_apde.apdeent  =l_apca.apcaent
      LET l_apde.apdeld =l_apca.apcald
      LET l_apde.apdecomp =l_apca.apcacomp
      LET l_apde.apdeorga =l_apca.apcacomp
      LET l_apde.apdesite =l_apca.apcasite
      LET l_apde.apdedocno =l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
      IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
      LET l_apde.apdeseq = l_apde.apdeseq + 1
      LET l_apde.apde001 = 'aapt560'
      LET l_apde.apde009 = 'Y'
      LET l_apde.apde028 = '0'
      LET l_apde.apde002 = '10'
      LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'3')
      #以判斷完匯兌損失/匯兌收益,將金額轉正顯示
      LET l_apde.apde109 =  l_apgc.apgc105
      LET l_apde.apde119 =  l_apgc.apgc115
      LET l_apde.apde006 = '10'   
      #銀行存提碼
      LET l_apde.apde011 = l_apgc.apgc015
      #現金變動碼
      LET l_apde.apde012 = l_apgc.apgc016
      LET l_apde.apde013 = ''
      LET l_apde.apde014 = ''
      LET l_apde.apde016 = ''
      LET l_apde.apde100 = l_apgc.apgc100
      LET l_apde.apde101 = l_apgc.apgc101
      LET l_apde.apde039 = l_apga.apga007
      LET l_apde.apde041 = NULL
      SELECT nmabl003 INTO l_apde.apde041
        FROM nmabl_t
       WHERE nmablent = g_enterprise
         AND nmabl001 = l_apde.apde039
         AND nmabl002 = g_dlang
      IF cl_null(l_apde.apde101) THEN LET l_apde.apde101 = 1 END IF
      LET l_apde.apde032 = l_apca.apcadocdt
      LET l_apde.apde061 = '54'
      #LET l_apde.apde016 = l_apgc.apgc004
      LET l_apde.apde008 = l_apgc.apgc014
      CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
         RETURNING l_apde.apde016   #160824-00049#7
      INSERT INTO apde_t(apdeent,
                         apdeld,apdecomp,apdesite,apdedocno,apdeseq,
                         apde001,apde009,apde028,apde002,apde015,
                         apde003,apde004,apdeorga,apde006,apde011,
                         apde012,apde013,apde014,apde016,apde017,
                         apde018,apde021,apde032,apde100,apde101,
                         apde039,apde040,apde041,
                         apde008,
                         apde109,apde119,apde061)
             VALUES(l_apde.apdeent,
                    l_apde.apdeld,l_apde.apdecomp,l_apde.apdesite,l_apde.apdedocno,l_apde.apdeseq,
                    l_apde.apde001,l_apde.apde009,l_apde.apde028,l_apde.apde002,l_apde.apde015,
                    l_apde.apde003,l_apde.apde004,l_apde.apdeorga,l_apde.apde006,l_apde.apde011,
                    l_apde.apde012,l_apde.apde013,l_apde.apde014,l_apde.apde016,l_apde.apde017,
                    l_apde.apde018,l_apde.apde021,l_apde.apde032,l_apde.apde100,l_apde.apde101,
                    l_apde.apde039,l_apde.apde040,l_apde.apde041,
                    l_apde.apde008,
                    l_apde.apde109,l_apde.apde119,l_apde.apde061)
      IF SQLCA.SQLCODE THEN LET r_success = FALSE EXIT FOREACH END IF
      #r3.產生直接付款apde-----e
      
      #INSERT isam
      INITIALIZE l_isam.* TO NULL
      LET l_isam.isament = l_apca.apcaent
      LET l_isam.isamdocno = l_apca.apcadocno
      SELECT MAX(isamseq)+1 INTO l_isam.isamseq
        FROM isam_t
       WHERE isament = g_enterprise
         AND isamdocno = l_apca.apcadocno
         AND isam001 = 'aapt560'
      IF cl_null(l_isam.isamseq)THEN LET l_isam.isamseq = 1 END IF
      LET l_isam.isam001 = 'aapt560'
      LET l_isam.isam002 = l_apca.apca004                           
      LET l_isam.isam008 = l_apgc.apgc007                           
      LET l_isam.isam009 = l_apgc.apgc008                           
      LET l_isam.isam010 = l_apgc.apgc009                           
      LET l_isam.isam011 = l_apgc.apgc010                           
      LET l_isam.isam012 = l_apgc.apgc006        
      LET l_isam.isam0121= l_apca.apca013                  
      LET l_isam.isam013 = l_apca.apca012
      LET l_isam.isam014 = l_apgc.apgc100                           
      LET l_isam.isam015 = l_apgc.apgc101                           
      LET l_isam.isam016 = l_ooefl006
      LET l_isam.isam017 = l_ooef002
      CALL s_aapp320_buy_info(l_apca.apcacomp)RETURNING l_pmaal003,l_isao001,      
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021
      LET l_isam.isam023 = l_apgc.apgc103                           
      LET l_isam.isam024 = l_apgc.apgc104                           
      LET l_isam.isam025 = l_apgc.apgc105                           
      LET l_isam.isam026 = l_apgc.apgc113                           
      LET l_isam.isam027 = l_apgc.apgc114                           
      LET l_isam.isam028 = l_apgc.apgc115                           
      LET l_isam.isam029 = s_desc_get_trading_partner_abbr_desc(l_apca.apca004)  

      SELECT isak008,isak009,isak010,isak011,isak012
        INTO l_isam.isam030,l_isam.isam031,l_isam.isam032,
             l_isam.isam033,l_isam.isam034
        FROM isak_t
       WHERE isakent = g_enterprise
         AND isak001 = l_apca.apca004
         AND isak002 = lc_param_apca.ooef019
      #161129-00042#1-add(s) #161230-00036#1  mark(s)
      #LET l_ooef011 = ' '
      #SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
      #IF l_ooef011 = 'TW' THEN
      #   #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
      #   CALL s_rule_chk_vat_id_string(l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET r_success = FALSE
      #      RETURN r_success,r_docno
      #   END IF  
      #   #檢查營利事業統一編號邏輯，錯了下方提示不控卡
      #   CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
      #   IF NOT g_sub_success THEN
      #      LET l_isam.isam030 = l_isam.isam030
      #   END IF
      #END IF
      #161129-00042#1-add(e)  #161230-00036#1  mark(e)
      LET l_isam.isam035 = '1'                                 
      LET l_isam.isam036 = '11'                                
      LET l_isam.isam037 = l_apgc.apgc011                           
      LET l_isam.isam050 = l_apca.apcadocno                         
      LET l_isam.isam107    = 0                                 
      LET l_isam.isam108    = 0                                 
      LET l_isam.isam117    = 0                                 
      LET l_isam.isam118    = 0
      IF NOT cl_null(l_isam.isam010)THEN
         #161230-00036#1 add(s)
         LET l_isac004 = ''
         LET l_isac008 = ''
         SELECT isac004,isac008 INTO l_isac004,l_isac008 FROM isac_t WHERE isacent = g_enterprise 
            AND isac002 = l_isam.isam008 AND isac001 = lc_param_apca.ooef019
         #IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) THEN                                              #170218-00012#1 mark
         IF l_isac008 NOT MATCHES '[4]' AND NOT cl_null(l_isac004) AND l_isac004 != '28' AND l_isac004 != '29' THEN   #170218-00012#1 add
            #先檢查輸入的營利事業統一編號是否為8碼或都為數字，錯了要控卡
            LET l_ooef011 = ' '
            SELECT ooef011 INTO l_ooef011 FROM ooef_t WHERE ooefent = g_enterprise AND ooef001 = l_apca.apcacomp
            IF l_ooef011 = 'TW' THEN
               IF NOT cl_null(l_isam.isam030) THEN   #170218-00012#1 add
                  LET l_vat_id = l_isam.isam030
                  IF l_vat_id.getLength() <> 8  THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF         
                  IF NOT cl_chk_num(l_isam.isam030,'N') THEN
                     INITIALIZE g_errparam TO NULL
                     LET g_errparam.code = 'sub-001388'
                     LET g_errparam.extend = ''
                     LET g_errparam.popup = TRUE
                     CALL cl_err()
                     LET l_isam.isam030 = ''
                     LET r_success = FALSE
                     RETURN r_success,r_docno
                  END IF
                  #檢查營利事業統一編號邏輯，錯了下方提示不控卡
                  CALL s_rule_chk_vat_id(l_ooef011,l_isam.isam030) RETURNING g_sub_success
                  IF NOT g_sub_success THEN
                     LET l_isam.isam030 = l_isam.isam030
                  END IF
               END IF   #170218-00012#1 add
            END IF
         END IF            
         #161230-00036#1 add(e)
         #INSERT INTO isam_t VALUES(l_isam.*) #161108-00017#4 mark
         #161108-00017#4 add ------
         INSERT INTO isam_t (isament,isamownid,isamowndp,isamcrtid,isamcrtdp,
                             isamcrtdt,isammodid,isammoddt,isamcnfid,isamcnfdt,
                             isamstus,isamcomp,isamdocno,isamseq,
                             isam001,isam002,isam004,isam006,isam008,
                             isam009,isam010,isam011,isam012,isam0121,
                             isam013,isam014,isam015,isam016,isam017,
                             isam018,isam019,isam020,isam021,isam022,
                             isam023,isam024,isam025,isam026,isam027,
                             isam028,isam029,isam030,isam031,isam032,
                             isam033,isam034,isam035,isam036,isam037,
                             isam038,isam039,isam040,isam041,isam042,
                             isam043,isam044,isam045,isam046,isam047,
                             isam048,isam049,isam050,isam107,isam108,
                             isam117,isam118,isam200,isam201,isam202,
                             isam203,isam204,isam205,isam206,isam207,
                             isam208,isam209,isam210,
                             isamud001,isamud002,isamud003,isamud004,isamud005,
                             isamud006,isamud007,isamud008,isamud009,isamud010,
                             isamud011,isamud012,isamud013,isamud014,isamud015,
                             isamud016,isamud017,isamud018,isamud019,isamud020,
                             isamud021,isamud022,isamud023,isamud024,isamud025,
                             isamud026,isamud027,isamud028,isamud029,isamud030,
                             isam051
                            )
         VALUES (l_isam.isament,l_isam.isamownid,l_isam.isamowndp,l_isam.isamcrtid,l_isam.isamcrtdp,
                 l_isam.isamcrtdt,l_isam.isammodid,l_isam.isammoddt,l_isam.isamcnfid,l_isam.isamcnfdt,
                 l_isam.isamstus,l_isam.isamcomp,l_isam.isamdocno,l_isam.isamseq,
                 l_isam.isam001,l_isam.isam002,l_isam.isam004,l_isam.isam006,l_isam.isam008,
                 l_isam.isam009,l_isam.isam010,l_isam.isam011,l_isam.isam012,l_isam.isam0121,
                 l_isam.isam013,l_isam.isam014,l_isam.isam015,l_isam.isam016,l_isam.isam017,
                 l_isam.isam018,l_isam.isam019,l_isam.isam020,l_isam.isam021,l_isam.isam022,
                 l_isam.isam023,l_isam.isam024,l_isam.isam025,l_isam.isam026,l_isam.isam027,
                 l_isam.isam028,l_isam.isam029,l_isam.isam030,l_isam.isam031,l_isam.isam032,
                 l_isam.isam033,l_isam.isam034,l_isam.isam035,l_isam.isam036,l_isam.isam037,
                 l_isam.isam038,l_isam.isam039,l_isam.isam040,l_isam.isam041,l_isam.isam042,
                 l_isam.isam043,l_isam.isam044,l_isam.isam045,l_isam.isam046,l_isam.isam047,
                 l_isam.isam048,l_isam.isam049,l_isam.isam050,l_isam.isam107,l_isam.isam108,
                 l_isam.isam117,l_isam.isam118,l_isam.isam200,l_isam.isam201,l_isam.isam202,
                 l_isam.isam203,l_isam.isam204,l_isam.isam205,l_isam.isam206,l_isam.isam207,
                 l_isam.isam208,l_isam.isam209,l_isam.isam210,
                 l_isam.isamud001,l_isam.isamud002,l_isam.isamud003,l_isam.isamud004,l_isam.isamud005,
                 l_isam.isamud006,l_isam.isamud007,l_isam.isamud008,l_isam.isamud009,l_isam.isamud010,
                 l_isam.isamud011,l_isam.isamud012,l_isam.isamud013,l_isam.isamud014,l_isam.isamud015,
                 l_isam.isamud016,l_isam.isamud017,l_isam.isamud018,l_isam.isamud019,l_isam.isamud020,
                 l_isam.isamud021,l_isam.isamud022,l_isam.isamud023,l_isam.isamud024,l_isam.isamud025,
                 l_isam.isamud026,l_isam.isamud027,l_isam.isamud028,l_isam.isamud029,l_isam.isamud030,
                 l_isam.isam051
                )
         #161108-00017#4 add end---
      END IF   
   END FOREACH
   
   #161004-00019#1-----s
   CALL s_fin_get_account(l_apca.apcald,'13',l_apca.apca007,'8504_04') RETURNING g_sub_success,l_xrcd009,g_errno
   UPDATE xrcd_t SET xrcd009 = l_xrcd009
    WHERE xrcdent= g_enterprise
      AND xrcdld = l_apca.apcald AND xrcddocno = l_apca.apcadocno
      AND xrcd009 IS NULL
   #161004-00019#1-----e
   
   LET l_pmab055 = NULL
   SELECT pmab055 INTO l_pmab055 FROM pmab_t
    WHERE pmabsite = l_apca.apcacomp
      AND pmab001 = l_apca.apca004
      AND pmabent = g_enterprise
   
   #自備款-----s
   LET l_glaa121 = NULL LET l_glaa016 = NULL
   LET l_glaa020 = NULL LET l_glaa019 = NULL
   LET l_glaa015 = NULL
   SELECT glaa121,glaa016,glaa020 ,
          glaa015,glaa019,
          glaa001   #161228-00062#1 add
     INTO l_glaa121,l_glaa016,l_glaa020,
          l_glaa015,l_glaa019,
          l_glaa001  #161228-00062#1 add
     FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = l_apca.apcald

   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
   SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
    WHERE apdeent   = l_apde.apdeent
      AND apdeld    = l_apde.apdeld
      AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '18'   #160824-00049#7
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apgn.apgn006
   LET l_apde.apde012 = l_apgn.apgn007
   LET l_apde.apde014 = ''   #s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '13'
   #   AND glab002 = l_pmab055
   #   AND glab003 = '8504_34'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang   #albireo 160729 add
   LET l_apde.apde100 = l_apga.apga100
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apgn.apgn108
   #LET l_apde.apde119 = l_apde.apde109 * l_apde.apde101
   LET l_apde.apde119 = l_apgn.apgn118   #160824-00049#7 add
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '61'
   IF l_apde.apde109 > 0 THEN   #160824-00049#7
      #INSERT INTO apde_t VALUES(l_apde.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF   #160824-00049#7
    
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '61'   #160824-00049#7
   LET l_apcb.apcb002 = l_apgn.apgndocno   #160824-00049#7
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   #SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '15'
   #   AND glab002 = '3117'
   #   AND glab003 = '8504_34'
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apgn.apgn100
   LET l_apcb.apcb101 = l_apgn.apgn108   #albireo 160624
   LET l_apcb.apcb102 = l_apgn.apgn101
   LET l_apcb.apcb103 = l_apgn.apgn108
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apgn.apgn108
   LET l_apcb.apcb108 = l_apgn.apgn108
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apgn.apgn118
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apgn.apgn118
  LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   LET l_apcb.apcb124 = 0
   LET l_apcb.apcb125 = l_apcb.apcb125
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   LET l_apcb.apcb134 = 0
   LET l_apcb.apcb135 = l_apcb.apcb135
   
   IF l_apcb.apcb115 > 0 THEN   #160824-00049#7
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF   #160824-00049#7
   #自備款-----e
   
   #保證金-----s
   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '18'   #160824-00049#7
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apgn.apgn008
   LET l_apde.apde012 = l_apgn.apgn009
   LET l_apde.apde014 = '' #s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '13'
   #   AND glab002 = l_pmab055
   #   AND glab003 = '8504_37'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang   #albireo 160729 add
   LET l_apde.apde100 = l_apga.apga100
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apgn.apgn109
   #LET l_apde.apde119 = l_apde.apde109 * l_apde.apde101
   LET l_apde.apde119 = l_apgn.apgn119   #160824-00049#7
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '62'
   IF l_apde.apde109 > 0 THEN   #160824-00049#7
      #INSERT INTO apde_t VALUES(l_apde.*)   #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF   #160824-00049#7
   
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '62'   #160824-00049#7
   LET l_apcb.apcb002 = l_apgn.apgndocno   #160824-00049#7
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   #SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '15'
   #   AND glab002 = '3117'
   #   AND glab003 = '8504_37'
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apgn.apgn100
   LET l_apcb.apcb101 = l_apgn.apgn109
   LET l_apcb.apcb102 = l_apgn.apgn101
   LET l_apcb.apcb103 = l_apgn.apgn109
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apgn.apgn109
   LET l_apcb.apcb108 = l_apgn.apgn109
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apgn.apgn119
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apgn.apgn119
  LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   LET l_apcb.apcb124 = 0
   LET l_apcb.apcb125 = l_apcb.apcb125
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   LET l_apcb.apcb134 = 0
   LET l_apcb.apcb135 = l_apcb.apcb135
   
   IF l_apcb.apcb115 > 0 THEN   #160824-00049#7
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF   #160824-00049#7
   #保證金-----e
   
   #預付款-----s
   INITIALIZE l_apde.* TO NULL
   LET l_apde.apdeent   = g_enterprise
   LET l_apde.apdecomp  = l_apca.apcacomp
   LET l_apde.apdeld    = l_apca.apcald
   LET l_apde.apdedocno = l_apca.apcadocno
      SELECT MAX(apdeseq) INTO l_apde.apdeseq FROM apde_t
       WHERE apdeent   = l_apde.apdeent
         AND apdeld    = l_apde.apdeld
         AND apdedocno = l_apde.apdedocno
   #albireo 160624-----s
   IF cl_null(l_apde.apdeseq)THEN LET l_apde.apdeseq = 0 END IF
   LET l_apde.apdeseq = l_apde.apdeseq + 1
   #albireo 160624-----e
   LET l_apde.apdesite  = l_apca.apcasite
   LET l_apde.apdeorga  = l_apca.apcasite
   LET l_apde.apde001   = 'aapt560'
   LET l_apde.apde002   = '18'    #160824-00049#7
   LET l_apde.apde006   = '10'
   LET l_apde.apde008   = l_apga.apga040
   LET l_apde.apde009 = 'Y'
   LET l_apde.apde011 = l_apgn.apgn010
   LET l_apde.apde012 = l_apgn.apgn011
   LET l_apde.apde014 = ''  #s_fin_get_doc_para(l_apca.apcald,l_apca.apcacomp,g_apca_m.apcadocno,'D-FIN-3004') #albireo 160630
   LET l_apde.apde015 = s_fin_get_scc_value('8506',l_apde.apde002,'1')
   LET l_apde.apde016 = NULL
   #SELECT glab005 INTO l_apde.apde016 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '13'
   #   AND glab002 = l_pmab055
   #   AND glab003 = '8504_33'
   CALL s_aapt420_bring_acc_code2(l_apca.apcald,l_apca.apcasite,l_apca.apca004,'10','10',l_apde.apde008)
      RETURNING l_apde.apde016   #albireo 160630 add
   LET l_apde.apde017 = l_apga.apga005
   LET l_apde.apde018 = NULL
   SELECT ooag003 INTO l_apde.apde018 FROM ooag_t
    WHERE ooagent = g_enterprise
      AND ooag001 = l_apde.apde017
   #LET l_apde.apde019 =          
   CALL s_department_get_respon_center(l_apde.apde018,l_apca.apcadocdt)
              RETURNING g_sub_success,g_errno,l_apde.apde019,l_dummy1
   LET l_apde.apde028 = '2'
   LET l_apde.apde032 = l_apga.apga003
   LET l_apde.apde038 = l_apca.apca004
   LET l_apde.apde039 = l_apga.apga007
   SELECT nmabl004 INTO l_apde.apde041 FROM nmabl_t
    WHERE nmablent = g_enterprise
      AND nmabl001 = l_apde.apde039
      AND nmabl002 = g_dlang   #albireo 160729 add
   LET l_apde.apde100 = l_apga.apga100
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde104 = 0 
   LET l_apde.apde109 = l_apgn.apgn102
   LET l_apde.apde119 = l_apde.apde109 * l_apde.apde101
   #s_curr_round
   CALL s_curr_round_ld('1',l_apca.apcald,l_glaa001,l_apde.apde119,2) RETURNING g_sub_success,g_errno,l_apde.apde119
   LET lc_param2.apca004 = l_apca.apca004
   LET ls_js = util.JSON.stringify(lc_param2)
   CALL s_fin_get_curr_rate(l_apca.apcacomp,l_apca.apcald,l_apca.apcadocdt,l_apde.apde100,ls_js)
        RETURNING l_apde.apde101,l_apde.apde121,l_apde.apde131
   #s_curr_round
   LET l_apde.apde101 = l_apga.apga101
   LET l_apde.apde120 = l_apca.apca120
   
   IF l_glaa015 = 'Y' THEN
      LET l_apde.apde129 = l_apde.apde109 * l_apde.apde121
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde120,l_apde.apde129,2) RETURNING g_sub_success,g_errno,l_apde.apde129
   END IF
   
   LET l_apde.apde130 = l_apca.apca130
   IF l_glaa019 = 'Y' THEN
      LET l_apde.apde139 = l_apde.apde109 * l_apde.apde131
      CALL s_curr_round_ld('1',l_apca.apcald,l_apde.apde130,l_apde.apde139,2) RETURNING g_sub_success,g_errno,l_apde.apde139
   END IF
   LET l_apde.apde061 = '63'
   IF l_apde.apde109 > 0 THEN    #160824-00049#7
      #INSERT INTO apde_t VALUES(l_apde.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apde_t (apdeent,apdecomp,apdeld,apdedocno,apdeseq,
                          apdesite,apdeorga,
                          apde001,apde002,apde003,apde004,apde006,
                          apde008,apde009,apde010,apde011,apde012,
                          apde013,apde014,apde015,apde016,apde017,
                          apde018,apde019,apde020,apde021,apde022,
                          apde023,apde024,apde028,apde029,apde030,
                          apde032,apde035,apde036,apde038,apde039,
                          apde040,apde041,apde042,apde043,apde044,
                          apde045,apde046,apde047,apde051,apde052,
                          apde053,apde054,apde055,apde056,apde057,
                          apde058,apde059,apde060,apde100,apde101,
                          apde104,apde109,apde119,apde120,apde121,
                          apde129,apde130,apde131,apde139,
                          apdeud001,apdeud002,apdeud003,apdeud004,apdeud005,
                          apdeud006,apdeud007,apdeud008,apdeud009,apdeud010,
                          apdeud011,apdeud012,apdeud013,apdeud014,apdeud015,
                          apdeud016,apdeud017,apdeud018,apdeud019,apdeud020,
                          apdeud021,apdeud022,apdeud023,apdeud024,apdeud025,
                          apdeud026,apdeud027,apdeud028,apdeud029,apdeud030,
                          apde061
                         )
      VALUES (l_apde.apdeent,l_apde.apdecomp,l_apde.apdeld,l_apde.apdedocno,l_apde.apdeseq,
              l_apde.apdesite,l_apde.apdeorga,
              l_apde.apde001,l_apde.apde002,l_apde.apde003,l_apde.apde004,l_apde.apde006,
              l_apde.apde008,l_apde.apde009,l_apde.apde010,l_apde.apde011,l_apde.apde012,
              l_apde.apde013,l_apde.apde014,l_apde.apde015,l_apde.apde016,l_apde.apde017,
              l_apde.apde018,l_apde.apde019,l_apde.apde020,l_apde.apde021,l_apde.apde022,
              l_apde.apde023,l_apde.apde024,l_apde.apde028,l_apde.apde029,l_apde.apde030,
              l_apde.apde032,l_apde.apde035,l_apde.apde036,l_apde.apde038,l_apde.apde039,
              l_apde.apde040,l_apde.apde041,l_apde.apde042,l_apde.apde043,l_apde.apde044,
              l_apde.apde045,l_apde.apde046,l_apde.apde047,l_apde.apde051,l_apde.apde052,
              l_apde.apde053,l_apde.apde054,l_apde.apde055,l_apde.apde056,l_apde.apde057,
              l_apde.apde058,l_apde.apde059,l_apde.apde060,l_apde.apde100,l_apde.apde101,
              l_apde.apde104,l_apde.apde109,l_apde.apde119,l_apde.apde120,l_apde.apde121,
              l_apde.apde129,l_apde.apde130,l_apde.apde131,l_apde.apde139,
              l_apde.apdeud001,l_apde.apdeud002,l_apde.apdeud003,l_apde.apdeud004,l_apde.apdeud005,
              l_apde.apdeud006,l_apde.apdeud007,l_apde.apdeud008,l_apde.apdeud009,l_apde.apdeud010,
              l_apde.apdeud011,l_apde.apdeud012,l_apde.apdeud013,l_apde.apdeud014,l_apde.apdeud015,
              l_apde.apdeud016,l_apde.apdeud017,l_apde.apdeud018,l_apde.apdeud019,l_apde.apdeud020,
              l_apde.apdeud021,l_apde.apdeud022,l_apde.apdeud023,l_apde.apdeud024,l_apde.apdeud025,
              l_apde.apdeud026,l_apde.apdeud027,l_apde.apdeud028,l_apde.apdeud029,l_apde.apdeud030,
              l_apde.apde061
             )
      #161108-00017#4 add end---
   END IF   #160824-00049#7
   
   INITIALIZE l_apcb.* TO NULL
   LET l_apcb.apcbent   = g_enterprise
   LET l_apcb.apcbld    = l_apca.apcald
   LET l_apcb.apcblegl  = l_apca.apcacomp
   LET l_apcb.apcbsite  = l_apca.apcasite
   LET l_apcb.apcbdocno = l_apca.apcadocno
   LET l_apcb.apcbseq   = NULL
   SELECT MAX(apcbseq)+1 INTO l_apcb.apcbseq FROM apcb_t
    WHERE apcbent   = g_enterprise
      AND apcbld    = l_apcb.apcbld
      AND apcbdocno = l_apcb.apcbdocno
   IF cl_null(l_apcb.apcbseq)THEN LET l_apcb.apcbseq = 1 END IF
   LET l_apcb.apcb001 = '63'    #160824-00049#7
   LET l_apcb.apcb002 = l_apgn.apgndocno   #160824-00049#7
   LET l_apcb.apcb003 = 0
   
   LET l_apcb.apcb006 = ' '
   LET l_apcb.apcb007 = 1
   LET l_apcb.apcb010 = l_apca.apca015
   CALL s_department_get_respon_center(l_apcb.apcb010,l_apca.apcadocdt)
                    RETURNING g_sub_success,g_errno,l_apcb.apcb011,l_dummy1
   LET l_apcb.apcb020 = ''
   #LET l_apcb.apcb021 = l_apgc.apgc004
   #SELECT glab005 INTO l_apcb.apcb021 FROM glab_t
   # WHERE glabent = g_enterprise
   #   AND glabld = l_apde.apdeld
   #   AND glab001 = '15'
   #   AND glab002 = '3117'
   #   AND glab003 = '8504_38'
   LET l_apcb.apcb022 = 1 #s_fin_get_scc_value('8540',l_apcb.apcb001,'4')
   LET l_apcb.apcb023 = 'N'
   #LET l_apcb.apcb027 = l_apgc.apgc008
   #LET l_apcb.apcb028 = l_apgc.apgc009
   LET l_apcb.apcb029 = l_apca.apca035
   LET l_apcb.apcb030 = l_apca.apca008
   LET l_apcb.apcb051 = l_apca.apca014
   LET l_apcb.apcb100 = l_apgn.apgn100
   LET l_apcb.apcb102 = l_apgn.apgn101
   LET l_apcb.apcb101 = l_apgn.apgn102
   LET l_apcb.apcb103 = l_apgn.apgn102
   LET l_apcb.apcb104 = 0
   LET l_apcb.apcb105 = l_apgn.apgn102
   LET l_apcb.apcb108 = l_apgn.apgn102
   LET l_apcb.apcb111 = l_apcb.apcb101 * l_apcb.apcb102
   LET l_apcb.apcb113 = l_apgn.apgn112
   LET l_apcb.apcb114 = 0
   LET l_apcb.apcb115 = l_apgn.apgn112
  LET l_apcb.apcborga = l_apca.apcacomp
   LET l_apcb.apcb123 = l_apcb.apcb103 * l_apca.apca121
   LET l_apcb.apcb124 = 0
   LET l_apcb.apcb125 = l_apcb.apcb125
   LET l_apcb.apcb133 = l_apcb.apcb103 * l_apca.apca131
   LET l_apcb.apcb134 = 0
   LET l_apcb.apcb135 = l_apcb.apcb135
   IF l_apcb.apcb113 > 0 THEN   #160824-00049#7
      #INSERT INTO apcb_t VALUES(l_apcb.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apcb_t (apcbent,apcbld,apcblegl,apcborga,apcbsite,
                          apcbdocno,apcbseq,
                          apcb001,apcb002,apcb003,apcb004,apcb005,
                          apcb006,apcb007,apcb008,apcb009,apcb010,
                          apcb011,apcb012,apcb013,apcb014,apcb015,
                          apcb016,apcb017,apcb018,apcb019,apcb020,
                          apcb021,apcb022,apcb023,apcb024,apcb025,
                          apcb026,apcb027,apcb028,apcb029,apcb030,
                          apcb032,apcb033,apcb034,apcb035,apcb036,
                          apcb037,apcb038,apcb039,apcb040,apcb041,
                          apcb042,apcb043,apcb044,apcb045,apcb046,
                          apcb047,apcb048,apcb049,apcb050,apcb051,
                          apcb100,apcb101,apcb102,apcb103,apcb104,
                          apcb105,apcb106,apcb107,apcb108,apcb111,
                          apcb113,apcb114,apcb115,apcb116,apcb117,
                          apcb118,apcb119,apcb121,apcb123,apcb124,
                          apcb125,apcb126,apcb127,apcb128,apcb131,
                          apcb133,apcb134,apcb135,apcb136,apcb137,
                          apcb138,
                          apcbud001,apcbud002,apcbud003,apcbud004,apcbud005,
                          apcbud006,apcbud007,apcbud008,apcbud009,apcbud010,
                          apcbud011,apcbud012,apcbud013,apcbud014,apcbud015,
                          apcbud016,apcbud017,apcbud018,apcbud019,apcbud020,
                          apcbud021,apcbud022,apcbud023,apcbud024,apcbud025,
                          apcbud026,apcbud027,apcbud028,apcbud029,apcbud030,
                          apcb052,apcb053,apcb054,apcb055
                         )
      VALUES (l_apcb.apcbent,l_apcb.apcbld,l_apcb.apcblegl,l_apcb.apcborga,l_apcb.apcbsite,
              l_apcb.apcbdocno,l_apcb.apcbseq,
              l_apcb.apcb001,l_apcb.apcb002,l_apcb.apcb003,l_apcb.apcb004,l_apcb.apcb005,
              l_apcb.apcb006,l_apcb.apcb007,l_apcb.apcb008,l_apcb.apcb009,l_apcb.apcb010,
              l_apcb.apcb011,l_apcb.apcb012,l_apcb.apcb013,l_apcb.apcb014,l_apcb.apcb015,
              l_apcb.apcb016,l_apcb.apcb017,l_apcb.apcb018,l_apcb.apcb019,l_apcb.apcb020,
              l_apcb.apcb021,l_apcb.apcb022,l_apcb.apcb023,l_apcb.apcb024,l_apcb.apcb025,
              l_apcb.apcb026,l_apcb.apcb027,l_apcb.apcb028,l_apcb.apcb029,l_apcb.apcb030,
              l_apcb.apcb032,l_apcb.apcb033,l_apcb.apcb034,l_apcb.apcb035,l_apcb.apcb036,
              l_apcb.apcb037,l_apcb.apcb038,l_apcb.apcb039,l_apcb.apcb040,l_apcb.apcb041,
              l_apcb.apcb042,l_apcb.apcb043,l_apcb.apcb044,l_apcb.apcb045,l_apcb.apcb046,
              l_apcb.apcb047,l_apcb.apcb048,l_apcb.apcb049,l_apcb.apcb050,l_apcb.apcb051,
              l_apcb.apcb100,l_apcb.apcb101,l_apcb.apcb102,l_apcb.apcb103,l_apcb.apcb104,
              l_apcb.apcb105,l_apcb.apcb106,l_apcb.apcb107,l_apcb.apcb108,l_apcb.apcb111,
              l_apcb.apcb113,l_apcb.apcb114,l_apcb.apcb115,l_apcb.apcb116,l_apcb.apcb117,
              l_apcb.apcb118,l_apcb.apcb119,l_apcb.apcb121,l_apcb.apcb123,l_apcb.apcb124,
              l_apcb.apcb125,l_apcb.apcb126,l_apcb.apcb127,l_apcb.apcb128,l_apcb.apcb131,
              l_apcb.apcb133,l_apcb.apcb134,l_apcb.apcb135,l_apcb.apcb136,l_apcb.apcb137,
              l_apcb.apcb138,
              l_apcb.apcbud001,l_apcb.apcbud002,l_apcb.apcbud003,l_apcb.apcbud004,l_apcb.apcbud005,
              l_apcb.apcbud006,l_apcb.apcbud007,l_apcb.apcbud008,l_apcb.apcbud009,l_apcb.apcbud010,
              l_apcb.apcbud011,l_apcb.apcbud012,l_apcb.apcbud013,l_apcb.apcbud014,l_apcb.apcbud015,
              l_apcb.apcbud016,l_apcb.apcbud017,l_apcb.apcbud018,l_apcb.apcbud019,l_apcb.apcbud020,
              l_apcb.apcbud021,l_apcb.apcbud022,l_apcb.apcbud023,l_apcb.apcbud024,l_apcb.apcbud025,
              l_apcb.apcbud026,l_apcb.apcbud027,l_apcb.apcbud028,l_apcb.apcbud029,l_apcb.apcbud030,
              l_apcb.apcb052,l_apcb.apcb053,l_apcb.apcb054,l_apcb.apcb055
             )
      #161108-00017#4 add end---
      IF SQLCA.SQLCODE THEN
         LET r_success = FALSE
      END IF
   END IF   #160824-00049#7
   #預付款-----e
   
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----s
      
   LET l_apcb113sum = NULL   LET l_apcb114sum = NULL   LET l_apcb115sum = NULL
   SELECT SUM(apcb113),SUM(apcb114),SUM(apcb115)
     INTO l_apcb113sum,l_apcb114sum,l_apcb115sum
     FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbld  = l_apca.apcald
      AND apcbdocno = l_apca.apcadocno
   IF cl_null(l_apcb113sum)THEN LET l_apcb113sum = 0 END IF
   IF cl_null(l_apcb114sum)THEN LET l_apcb114sum = 0 END IF
   IF cl_null(l_apcb115sum)THEN LET l_apcb115sum = 0 END IF
   
   UPDATE apca_t SET apca103 = l_apcb113sum,
                     apca104 = l_apcb114sum,
                     apca108 = l_apcb115sum,
                     apca113 = l_apcb113sum,
                     apca114 = l_apcb114sum,
                     apca118 = l_apcb115sum
    WHERE apcaent = g_enterprise
      AND apcald  = l_apca.apcald
      AND apcadocno = l_apca.apcadocno

   CALL s_aap_multi_bill_period(l_apca.apcald,l_apca.apcadocno) RETURNING g_sub_success,g_errno

   CALL cl_get_para(g_enterprise,l_apca.apcacomp,'S-FIN-2002') RETURNING l_sfin2002
   LET l_sql = " apca073 = '",l_apca.apca073,"' AND apca001 IN ('21','23','25') AND apcastus = 'Y' "
   CALL aapt560_03_ins_apce(l_apca.apcald,l_apca.apcadocno,l_sql,l_sfin2002,'4')   

   UPDATE apca_t SET apca103 = l_apcb113sum,
                     apca104 = l_apcb114sum,
                     apca108 = l_apcb115sum,
                     apca113 = l_apcb113sum,
                     apca114 = l_apcb114sum,
                     apca118 = l_apcb115sum,
                     apca107 = l_apcb115sum,
                     apca117 = l_apcb115sum
    WHERE apcaent = g_enterprise
      AND apcald  = l_apca.apcald
      AND apcadocno = l_apca.apcadocno


   UPDATE apcc_t SET apcc109 = apcc108 ,apcc119 = apcc118
    WHERE apccent   = g_enterprise
      AND apccdocno = l_apca.apcadocno
      AND apccld    = l_apca.apcald
   #albireo 160627 kris改規格  sum單身總本幣金額後產生apcc並回寫單頭總金額-----e
   
   CALL s_pre_voucher_ins('AP','P10',l_apca.apcald,l_apca.apcadocno,l_apca.apcadocdt,'1')
                       RETURNING g_sub_success
   IF NOT g_sub_success THEN
      LET r_success = FALSE
   END IF
   
   #160824-00049#7-----s
   LET l_count = NULL
   SELECT COUNT(*) INTO l_count FROM apcb_t
    WHERE apcbent = g_enterprise
      AND apcbdocno = l_apca.apcadocno
      AND apcbld = l_apca.apcald
   IF cl_null(l_count)THEN LET l_count = 0 END IF
   
   IF l_count = 0 THEN
      LET r_success = FALSE
      INITIALIZE g_errparam.* TO NULL
      LET g_errparam.code = 'agl-00167'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
   END IF
   #160824-00049#7-----e
   
   UPDATE apgn_t SET apgn003 = l_apca.apcadocno
    WHERE apgnent = g_enterprise
      AND apgncomp = l_apca.apcacomp
      AND apgndocno = g_apca_m.apca018
   LET r_docno = l_apca.apcadocno
   RETURN r_success,r_docno
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_apca018_chk()
   DEFINE r_success   LIKE type_t.num5
   DEFINE r_errno     LIKE gzze_t.gzze001
   DEFINE l_stus      LIKE type_t.chr10
   DEFINE l_count     LIKE type_t.num5
   LET r_success = TRUE
   LET r_errno = NULL
   CASE
      WHEN g_apca_m.apca016 = '31'
         LET l_stus = NULL
         SELECT apgastus INTO l_stus FROM apga_t
          WHERE apgaent = g_enterprise
            AND apgacomp = g_apca_m.apcacomp
            AND apgadocno = g_apca_m.apca018
            
         CASE
            WHEN SQLCA.SQLCODE = 100
               LET r_success = FALSE
               LET r_errno  = 'asf-00154'
            WHEN l_stus <> 'Y'
               LET r_success = FALSE
               LET r_errno  = 'aap-00017'
         END CASE
      WHEN g_apca_m.apca016 = '32'
         LET l_stus = NULL
         SELECT apgdstus INTO l_stus FROM apgd_t
          WHERE apgdent = g_enterprise
            AND apgdcomp = g_apca_m.apcacomp
            AND apgddocno = g_apca_m.apca018
            AND apgd900   = g_apca_m.apca064
         CASE
            WHEN SQLCA.SQLCODE = 100
               LET r_success = FALSE
               LET r_errno  = 'asf-00154'
            WHEN l_stus <> 'Y'
               LET r_success = FALSE
               LET r_errno  = 'aap-00017'
         END CASE      
      WHEN g_apca_m.apca016 = '33'
         LET l_stus = NULL
         SELECT apgistus INTO l_stus FROM apgi_t
          WHERE apgient = g_enterprise
            AND apgicomp = g_apca_m.apcacomp
            AND apgidocno = g_apca_m.apca018
         CASE
            WHEN SQLCA.SQLCODE = 100
               LET r_success = FALSE
               LET r_errno  = 'asf-00154'
            WHEN l_stus <> 'Y'
               LET r_success = FALSE
               LET r_errno  = 'aap-00017'
         END CASE            
      WHEN g_apca_m.apca016 = '34'
         LET l_stus = NULL
         SELECT apgkstus INTO l_stus FROM apgk_t
          WHERE apgkent = g_enterprise
            AND apgkcomp = g_apca_m.apcacomp
            AND apgkdocno = g_apca_m.apca018
         CASE
            WHEN SQLCA.SQLCODE = 100
               LET r_success = FALSE
               LET r_errno  = 'asf-00154'
            WHEN l_stus <> 'Y'
               LET r_success = FALSE
               LET r_errno  = 'aap-00017'
         END CASE 
      WHEN g_apca_m.apca016 = '35'
         LET l_stus = NULL
         SELECT apglstus INTO l_stus FROM apgl_t
          WHERE apglent = g_enterprise
            AND apglcomp = g_apca_m.apcacomp
            AND apgldocno = g_apca_m.apca018
         CASE
            WHEN SQLCA.SQLCODE = 100
               LET r_success = FALSE
               LET r_errno  = 'asf-00154'
            WHEN l_stus <> 'Y'
               LET r_success = FALSE
               LET r_errno  = 'aap-00017'
         END CASE       
      WHEN g_apca_m.apca016 = '36'
         LET l_stus = NULL
         SELECT apgnstus INTO l_stus FROM apgn_t
          WHERE apgnent = g_enterprise
            AND apgncomp = g_apca_m.apcacomp
            AND apgndocno = g_apca_m.apca018
         CASE
            WHEN SQLCA.SQLCODE = 100
               LET r_success = FALSE
               LET r_errno  = 'asf-00154'
            WHEN l_stus <> 'Y'
               LET r_success = FALSE
               LET r_errno  = 'aap-00017'
         END CASE    
   END CASE

   IF NOT r_success THEN RETURN r_success,r_errno END IF
   
   IF g_apca_m.apca016 = '32' THEN
      LET l_count = NULL
      SELECT COUNT(*) INTO l_count FROM apca_t
       WHERE apcaent = g_enterprise
         AND apca016 = g_apca_m.apca016
         AND apca018 = g_apca_m.apca018
         AND apca064 = g_apca_m.apca064
         AND apcastus <> 'X'
      IF cl_null(l_count)THEN LET l_count = 0 END IF
      
      IF l_count > 0 THEN
         LET r_success = FALSE
         LET r_errno  = 'afm-00119'
      END IF
   ELSE
      LET l_count = NULL
      SELECT COUNT(*) INTO l_count FROM apca_t
       WHERE apcaent = g_enterprise
         AND apca016 = g_apca_m.apca016
         AND apca018 = g_apca_m.apca018
         AND apcastus <> 'X'
      IF cl_null(l_count)THEN LET l_count = 0 END IF
      
      IF l_count > 0 THEN
         LET r_success = FALSE
         LET r_errno  = 'afm-00119'
      END IF
   END IF
   
   
   RETURN r_success,r_errno
END FUNCTION

################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL s_aooi150_ins (传入参数)
#                  RETURNING 回传参数
# Input parameter: 传入参数变量1   传入参数变量说明1
#                : 传入参数变量2   传入参数变量说明2
# Return code....: 回传参数变量1   回传参数变量说明1
#                : 回传参数变量2   回传参数变量说明2
# Date & Author..: 日期 By 作者
# Modify.........:
################################################################################
PRIVATE FUNCTION aapt560_03_ins_apce(p_ld,p_docno,p_wc,p_sfin2002,p_type)
DEFINE p_ld          LIKE apca_t.apcald      #帳別
DEFINE p_docno       LIKE apcb_t.apcbdocno   #立帳單據
DEFINE p_apca004     LIKE apca_t.apca004     #交易對象
DEFINE p_apca005     LIKE apca_t.apca004     #付款對象
DEFINE p_wc          STRING
DEFINE p_sfin2002    LIKE type_t.chr1        #沖銷參數(S-FIN-2002)
DEFINE p_type        LIKE type_t.chr1        #1.訂單待抵優先 2.帳款對象+付款對象 3.帳款對象
DEFINE l_apcacomp    LIKE apca_t.apcacomp
DEFINE l_apcadocdt   LIKE apca_t.apcadocdt
DEFINE l_apca0041    LIKE apca_t.apca004
DEFINE l_apca0051    LIKE apca_t.apca005
DEFINE l_apca1001    LIKE apca_t.apca100
DEFINE l_apcc109sum  LIKE apcc_t.apcc109     #立帳付款金額(合計
DEFINE l_apce109sum  LIKE apce_t.apce109     #沖帳金額    (合計
DEFINE l_apce109     LIKE apce_t.apce109     #可沖帳金額
DEFINE l_glaa017     LIKE glaa_t.glaa017     #本位幣二 換算基準
DEFINE l_glaa021     LIKE glaa_t.glaa021     #本位幣三 換算基準
DEFINE l_apca001     LIKE apca_t.apca001
DEFINE l_apca014     LIKE apca_t.apca014
DEFINE l_apca015     LIKE apca_t.apca015
DEFINE l_apca033     LIKE apca_t.apca033
DEFINE l_apca034     LIKE apca_t.apca034
DEFINE l_apca035     LIKE apca_t.apca035
DEFINE l_apca059     LIKE apca_t.apca059
DEFINE l_apcccomp    LIKE apcc_t.apcccomp
DEFINE l_apccsite    LIKE apcc_t.apccsite
DEFINE l_apccdocno   LIKE apcc_t.apccdocno
DEFINE l_apccseq     LIKE apcc_t.apccseq
DEFINE l_apcc001     LIKE apcc_t.apcc001
DEFINE l_apcc100     LIKE apcc_t.apcc100
DEFINE l_apcc121     LIKE apcc_t.apcc121
DEFINE l_apcc131     LIKE apcc_t.apcc131
DEFINE l_apcc101     LIKE apcc_t.apcc101
DEFINE l_apcc102     LIKE apcc_t.apcc102
DEFINE l_apcc108     LIKE apcc_t.apcc108
DEFINE l_apcc118     LIKE apcc_t.apcc118
DEFINE l_apcc128     LIKE apcc_t.apcc128
DEFINE l_apcc138     LIKE apcc_t.apcc138
DEFINE l_apcc109     LIKE apcc_t.apcc109
DEFINE l_apcc119     LIKE apcc_t.apcc119
DEFINE l_apcc129     LIKE apcc_t.apcc129
DEFINE l_apcc139     LIKE apcc_t.apcc139
#DEFINE l_apce        RECORD LIKE apce_t.* #161104-00024#5 mark
#161104-00024#5-add(s)
   DEFINE l_apce  RECORD  #應付沖帳明細
          apceent   LIKE apce_t.apceent, #企業編號
          apcecomp  LIKE apce_t.apcecomp, #法人
          apcelegl  LIKE apce_t.apcelegl, #核算組織
          apcesite  LIKE apce_t.apcesite, #帳務組織
          apceld    LIKE apce_t.apceld, #帳套
          apceorga  LIKE apce_t.apceorga, #帳務歸屬組織
          apcedocno LIKE apce_t.apcedocno, #沖銷單單號
          apceseq   LIKE apce_t.apceseq, #項次
          apce001   LIKE apce_t.apce001, #來源作業
          apce002   LIKE apce_t.apce002, #沖銷類型
          apce003   LIKE apce_t.apce003, #沖銷帳款單單號
          apce004   LIKE apce_t.apce004, #沖銷帳款單項次
          apce005   LIKE apce_t.apce005, #分期帳款序
          apce006   LIKE apce_t.apce006, #no use
          apce007   LIKE apce_t.apce007, #no use
          apce008   LIKE apce_t.apce008, #票據號碼/ 現金銀存帳戶
          apce009   LIKE apce_t.apce009, #no use
          apce010   LIKE apce_t.apce010, #摘要說明
          apce011   LIKE apce_t.apce011, #理由碼
          apce012   LIKE apce_t.apce012, #銀存存提碼
          apce013   LIKE apce_t.apce013, #現金異動碼
          apce014   LIKE apce_t.apce014, #no use
          apce015   LIKE apce_t.apce015, #沖銷加減項
          apce016   LIKE apce_t.apce016, #沖銷科目
          apce017   LIKE apce_t.apce017, #業務人員
          apce018   LIKE apce_t.apce018, #業務部門
          apce019   LIKE apce_t.apce019, #責任中心
          apce020   LIKE apce_t.apce020, #產品類別
          apce021   LIKE apce_t.apce021, #no use
          apce022   LIKE apce_t.apce022, #專案編號
          apce023   LIKE apce_t.apce023, #WBS編號
          apce024   LIKE apce_t.apce024, #第二參考單號
          apce025   LIKE apce_t.apce025, #第二參考單號項次
          apce026   LIKE apce_t.apce026, #no use
          apce027   LIKE apce_t.apce027, #應稅折抵否
          apce028   LIKE apce_t.apce028, #產生方式
          apce029   LIKE apce_t.apce029, #傳票號碼
          apce030   LIKE apce_t.apce030, #傳票項次
          apce031   LIKE apce_t.apce031, #付款(票)到期日
          apce032   LIKE apce_t.apce032, #應付款日
          apce033   LIKE apce_t.apce033, #no use
          apce034   LIKE apce_t.apce034, #no use
          apce035   LIKE apce_t.apce035, #區域
          apce036   LIKE apce_t.apce036, #客戶分類
          apce037   LIKE apce_t.apce037, #no use
          apce038   LIKE apce_t.apce038, #帳款對象
          apce039   LIKE apce_t.apce039, #no use
          apce040   LIKE apce_t.apce040, #no use
          apce041   LIKE apce_t.apce041, #no use
          apce042   LIKE apce_t.apce042, #no use
          apce043   LIKE apce_t.apce043, #no use
          apce044   LIKE apce_t.apce044, #經營方式
          apce045   LIKE apce_t.apce045, #通路
          apce046   LIKE apce_t.apce046, #品牌
          apce047   LIKE apce_t.apce047, #發票編號
          apce048   LIKE apce_t.apce048, #發票號碼
          apce049   LIKE apce_t.apce049, #付款申請單號碼
          apce050   LIKE apce_t.apce050, #付款申請單項次
          apce051   LIKE apce_t.apce051, #自由核算項一
          apce052   LIKE apce_t.apce052, #自由核算項二
          apce053   LIKE apce_t.apce053, #自由核算項三
          apce054   LIKE apce_t.apce054, #自由核算項四
          apce055   LIKE apce_t.apce055, #自由核算項五
          apce056   LIKE apce_t.apce056, #自由核算項六
          apce057   LIKE apce_t.apce057, #自由核算項七
          apce058   LIKE apce_t.apce058, #自由核算項八
          apce059   LIKE apce_t.apce059, #自由核算項九
          apce060   LIKE apce_t.apce060, #自由核算項十
          apce100   LIKE apce_t.apce100, #幣別
          apce101   LIKE apce_t.apce101, #匯率
          apce104   LIKE apce_t.apce104, #原幣應稅折抵稅額
          apce109   LIKE apce_t.apce109, #原幣沖帳金額
          apce114   LIKE apce_t.apce114, #本幣應稅折抵稅額
          apce119   LIKE apce_t.apce119, #本幣沖帳金額
          apce120   LIKE apce_t.apce120, #本位幣二幣別
          apce124   LIKE apce_t.apce124, #本位幣二應稅折抵稅額
          apce121   LIKE apce_t.apce121, #本位幣二匯率
          apce129   LIKE apce_t.apce129, #本位幣二沖帳金額
          apce130   LIKE apce_t.apce130, #本位幣三幣別
          apce131   LIKE apce_t.apce131, #本位幣三匯率
          apce134   LIKE apce_t.apce134, #本位幣三應稅折抵稅額
          apce139   LIKE apce_t.apce139, #本位幣三沖帳金額
          apceud001 LIKE apce_t.apceud001, #自定義欄位(文字)001
          apceud002 LIKE apce_t.apceud002, #自定義欄位(文字)002
          apceud003 LIKE apce_t.apceud003, #自定義欄位(文字)003
          apceud004 LIKE apce_t.apceud004, #自定義欄位(文字)004
          apceud005 LIKE apce_t.apceud005, #自定義欄位(文字)005
          apceud006 LIKE apce_t.apceud006, #自定義欄位(文字)006
          apceud007 LIKE apce_t.apceud007, #自定義欄位(文字)007
          apceud008 LIKE apce_t.apceud008, #自定義欄位(文字)008
          apceud009 LIKE apce_t.apceud009, #自定義欄位(文字)009
          apceud010 LIKE apce_t.apceud010, #自定義欄位(文字)010
          apceud011 LIKE apce_t.apceud011, #自定義欄位(數字)011
          apceud012 LIKE apce_t.apceud012, #自定義欄位(數字)012
          apceud013 LIKE apce_t.apceud013, #自定義欄位(數字)013
          apceud014 LIKE apce_t.apceud014, #自定義欄位(數字)014
          apceud015 LIKE apce_t.apceud015, #自定義欄位(數字)015
          apceud016 LIKE apce_t.apceud016, #自定義欄位(數字)016
          apceud017 LIKE apce_t.apceud017, #自定義欄位(數字)017
          apceud018 LIKE apce_t.apceud018, #自定義欄位(數字)018
          apceud019 LIKE apce_t.apceud019, #自定義欄位(數字)019
          apceud020 LIKE apce_t.apceud020, #自定義欄位(數字)020
          apceud021 LIKE apce_t.apceud021, #自定義欄位(日期時間)021
          apceud022 LIKE apce_t.apceud022, #自定義欄位(日期時間)022
          apceud023 LIKE apce_t.apceud023, #自定義欄位(日期時間)023
          apceud024 LIKE apce_t.apceud024, #自定義欄位(日期時間)024
          apceud025 LIKE apce_t.apceud025, #自定義欄位(日期時間)025
          apceud026 LIKE apce_t.apceud026, #自定義欄位(日期時間)026
          apceud027 LIKE apce_t.apceud027, #自定義欄位(日期時間)027
          apceud028 LIKE apce_t.apceud028, #自定義欄位(日期時間)028
          apceud029 LIKE apce_t.apceud029, #自定義欄位(日期時間)029
          apceud030 LIKE apce_t.apceud030, #自定義欄位(日期時間)030
          apce103   LIKE apce_t.apce103, #原幣未稅沖銷額
          apce113   LIKE apce_t.apce113, #本位未稅沖銷額
          apce123   LIKE apce_t.apce123, #本位幣二未稅沖銷額
          apce133   LIKE apce_t.apce133, #本位幣三未稅沖銷額
          apce061   LIKE apce_t.apce061  #付款對象
              END RECORD
   #161104-00024#5-add(e)
DEFINE l_sql         STRING
DEFINE l_cnt         LIKE type_t.num5
DEFINE l_apcbseq     LIKE apcb_t.apcbseq
DEFINE l_apcb008     LIKE apcb_t.apcb008
DEFINE l_str         STRING
DEFINE l_glaa001     LIKE glaa_t.glaa001  #140806-00012#12
DEFINE l_glaa016     LIKE glaa_t.glaa016  #140806-00012#12
DEFINE l_glaa020     LIKE glaa_t.glaa020  #140806-00012#12
#150316apo--(s)
DEFINE  l_apcc_left  RECORD
                     apce109    LIKE type_t.num20_6,
                     apce119    LIKE type_t.num20_6,
                     apce129    LIKE type_t.num20_6,
                     apce139    LIKE type_t.num20_6
                     END RECORD
#150316apo--(e)
DEFINE l_sfin3020    LIKE type_t.chr1     #151130-00015#4
DEFINE l_glaacomp    LIKE glaa_t.glaacomp #151130-00015#4
DEFINE l_apca018     LIKE apca_t.apca018  #151130-00015#4
#160705-00035#3-s
DEFINE l_apba103     LIKE apba_t.apba103
DEFINE l_apba113     LIKE apba_t.apba113
#160705-00035#3-e
#160825-00031#1 Add  ---(S)---
DEFINE r_apce_w      RECORD
       apce103       LIKE apce_t.apce103,
       apce104       LIKE apce_t.apce104,
       apce109       LIKE apce_t.apce109,
       apce113       LIKE apce_t.apce113,
       apce114       LIKE apce_t.apce114,
       apce119       LIKE apce_t.apce119,
       apce123       LIKE apce_t.apce123,
       apce124       LIKE apce_t.apce124,
       apce129       LIKE apce_t.apce129,
       apce133       LIKE apce_t.apce133,
       apce134       LIKE apce_t.apce134,
       apce139       LIKE apce_t.apce139
       END RECORD
#DEFINE l_apca011     LIKE apca_t.apca011  #160705-00035#5 mark
DEFINE l_apca012     LIKE apca_t.apca012   #160705-00035#5
#160825-00031#1 Add  ---(S)---



   WHENEVER ERROR CONTINUE
   
   IF cl_null(p_wc) THEN RETURN END IF
   #21:訂金待抵       #對應41:應付款單
   #22:倉退待抵       #對應41:應付款單
   #23:預付待抵       #對應41:應付款單
   #24:沖銷溢付待抵   #對應41:應付款單
   #25:押金待底       #對應42:應付待抵款單
   #29:其他待抵       #對應41:應付款單
   #151130-00015#4--(S)
   SELECT glaacomp INTO l_glaacomp
     FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = p_ld
   CALL cl_get_para(g_enterprise,l_glaacomp,'S-FIN-3020') RETURNING l_sfin3020 
   IF cl_null(l_sfin3020) THEN
      LET l_sfin3020 = 'N'
   END IF
   #151130-00015#4--(E)

   #160705-00035#3-s
   #屬於0類則表示aapt110的待底要先沖
   IF p_type = '0' THEN
      LET l_sql = " SELECT DISTINCT apba005 FROM apba_t",
                  "   LEFT JOIN apca_t ON apbaent=apcaent AND apbadocno=apca018",
                  "  WHERE apcaent = '",g_enterprise,"' ",
                  "    AND apcald = '",p_ld,"' ",
                  "    AND apcadocno = '",p_docno,"' ",
                  "    AND apba004 = '27'",
                  "  ORDER BY apba005"
      PREPARE aapt560_sel_apba_p FROM l_sql
      DECLARE aapt560_sel_apba_c CURSOR FOR aapt560_sel_apba_p
      FOREACH aapt560_sel_apba_c INTO l_apcb008
      IF cl_null(l_str)THEN
         LET l_str = l_apcb008 CLIPPED
      ELSE
         LET l_str = l_str CLIPPED,",",l_apcb008 CLIPPED
      END IF
      END FOREACH
      CALL s_fin_get_wc_str(l_str) RETURNING l_str
   END IF
   #屬於1/2類訂單待抵優先,卻未勾選21:訂金待抵者/23:預付待抵/25:押金待底,則不進入此類處理
   IF p_type = '1' OR p_type = '2' THEN
      IF s_chr_get_index_of(p_wc,'21',1) = 0 AND s_chr_get_index_of(p_wc,'23',1) = 0 AND s_chr_get_index_of(p_wc,'25',1) = 0THEN
         RETURN
      END IF
      IF p_type = '1' THEN
         #1類須撈取本張立帳單關聯的採購單號(apcb008)串sql條件
         LET l_sql = " SELECT DISTINCT apcbseq,apcb008 FROM apca_t,apcb_t ",
                     "  WHERE apcaent = apcbent " ,
                     "    AND apcald = apcbld ",
                     "    AND apcadocno = apcbdocno ",
                     "    AND apcaent = '",g_enterprise,"' ",
                     "    AND apcald = '",p_ld,"' ",
                     "    AND apcadocno = '",p_docno,"' ",
                     "  ORDER BY apcbseq "
         PREPARE aapt560_sel_apcb_p FROM l_sql
         DECLARE aapt560_sel_apcb_c CURSOR FOR aapt560_sel_apcb_p
         FOREACH aapt560_sel_apcb_c INTO l_apcbseq,l_apcb008
            IF cl_null(l_str)THEN
               LET l_str = l_apcb008 CLIPPED
            ELSE
               LET l_str = l_str CLIPPED,",",l_apcb008 CLIPPED
            END IF
         END FOREACH
         CALL s_fin_get_wc_str(l_str) RETURNING l_str
      END IF
   END IF
   
   CALL s_ld_sel_glaa(p_ld,'glaa017|glaa021|glaa001|glaa016|glaa020')
       RETURNING  g_sub_success,l_glaa017,l_glaa021,l_glaa001,l_glaa016,l_glaa020
   
   #此次單據
   SELECT apca004,apca005,apca100,apcacomp,apcadocdt
     INTO l_apca0041,l_apca0051,l_apca1001,l_apcacomp,l_apcadocdt
     FROM apca_t
    WHERE apcaent = g_enterprise AND apcald = p_ld
      AND apcadocno = p_docno
   
   #待抵範圍
   LET l_sql = " SELECT apca001,apca014,apca015,apca033,apca034, ",
               "        apca035,apca059,",
               "        apcccomp,apccsite,apccdocno,apccseq,",
               "        apcc001,apcc100,apcc121,apcc131,",  
               "        apcc101,apcc102,",
               "        apcc108,apcc118,apcc128,apcc138  ,",
               "        apcc109,apcc119,apcc129,apcc139  ,",
               "        apca018 ",                            
               "   FROM apca_t,apcc_t ",
               "  WHERE apcaent = apccent AND apcald = apccld AND apcadocno = apccdocno  ",
               "    AND apcaent = ",g_enterprise,"  AND apcald ='",p_ld,"'",
               "    AND apcc108-apcc109 <> 0        AND apca100='",l_apca1001,"'",
               "    AND apcastus = 'Y'"
   CASE p_type
      WHEN '0'   #aapt110的27:其他待抵單
         LET l_sql = l_sql," AND apcadocno IN ",l_str
      WHEN '1'   #1.21:訂單待抵/23:預付待抵/25:押金待抵優先+同採購單
         LET l_sql = l_sql," AND apca001 IN (",p_wc,") AND apca001 IN ('21','23','25')",
                           " AND apcadocno IN ( SELECT apcbdocno FROM apcb_t ",
                           "                     WHERE apcbent = apcaent AND apcbld = apcald ",
                           "                       AND apcb002 IN ",l_str,") "
      WHEN '2'   #2.21:訂單待抵/23:預付待抵/25:押金待抵優先+帳款對象+付款對象
         LET l_sql = l_sql," AND apca004 ='",l_apca0041,"' AND apca005='",l_apca0051,"'",
                           " AND apca001 IN (",p_wc,") AND apca001 IN ('21','23','25') "
      WHEN '3'   #3.帳款對象+付款對象
         LET l_sql = l_sql," AND apca004 ='",l_apca0041,"' AND apca005='",l_apca0051,"'",
                           " AND apca001 IN (",p_wc,") "
      WHEN '4'
         LET l_sql = l_sql," AND apca001 IN ('21','23','25') AND ",p_wc CLIPPED
   END CASE
   LET l_sql = l_sql,"  ORDER BY apcc004,apcadocno,apcc001,apccseq"
   PREPARE aapt560_ins_apce_p FROM l_sql
   DECLARE aapt560_ins_apce_c CURSOR FOR aapt560_ins_apce_p
   FOREACH aapt560_ins_apce_c INTO l_apca001,l_apca014,l_apca015,l_apca033,l_apca034,
                                     l_apca035,l_apca059,
                                     l_apcccomp,l_apccsite,l_apccdocno,l_apccseq,
                                     l_apcc001,l_apcc100,l_apcc121,l_apcc131,
                                     l_apcc101,l_apcc102,
                                     l_apcc108,l_apcc118,l_apcc128,l_apcc138,
                                     l_apcc109,l_apcc119,l_apcc129,l_apcc139,
                                     l_apca018          #151130-00015#4
      
      #未付款的单据审核后生成的待抵单，在没有付款前不允许在进行冲抵。
      SELECT COUNT(apcadocno) INTO l_cnt
        FROM apca_t,apcc_t
       WHERE apcaent = apccent 
         AND apcald = apccld AND apcadocno = apccdocno
         AND apcastus = 'Y'  AND apcc108 - apcc109 > 0
         AND apcaent = g_enterprise
         AND apcald  = p_ld  AND apca019 = l_apccdocno
      IF l_cnt > 0 THEN
         CONTINUE FOREACH
      END IF

      IF l_apca001 = '21' AND l_sfin3020 = 'Y' AND NOT cl_null(l_apca018) THEN
         SELECT COUNT(*) INTO l_cnt
           FROM apcb_t,pmdt_t
          WHERE apcbent = g_enterprise 
            AND apcbld  = p_ld AND apcbdocno = p_docno
            AND apcbent = pmdtent AND apcb001 = '11'  
            AND apcb002 = pmdtdocno AND apcb003 = pmdtseq
            AND pmdt001 IN (SELECT DISTINCT apcb002 FROM apcb_t WHERE apcbent = g_enterprise AND apcbld = p_ld AND apcbdocno = l_apca018 AND apcb001 = '10')
         IF l_cnt = 0 THEN CONTINUE FOREACH END IF
      END IF

      IF p_type = '0' THEN
         #直接撈aapt110的錢進來沖即可
         SELECT apba105,apba115 INTO l_apba103,l_apba113 
           FROM apba_t
           LEFT JOIN apca_t ON apbaent=apcaent AND apbadocno=apca018
          WHERE apcaent = g_enterprise
            AND apcald = p_ld
            AND apcadocno = p_docno
            AND apba005 = l_apccdocno
            AND apba006 = l_apccseq
            AND apba020 = l_apcc001
         IF cl_null(l_apba103) THEN LET l_apba103 = 0 END IF
         IF cl_null(l_apba113) THEN LET l_apba113 = 0 END IF
         IF l_apba103 = 0 THEN CONTINUE FOREACH END IF
      ELSE
         #取得待抵單號+項次+帳期剩餘可沖銷金額
         CALL s_aapt420_apcc_used_num('41',p_ld,p_ld,l_apccdocno,l_apccseq,l_apcc001,p_docno,' ','1')
              RETURNING g_sub_success,g_errno,l_apcc_left.apce109,l_apcc_left.apce119,l_apcc_left.apce129,l_apcc_left.apce139      
         IF l_apcc_left.apce109 = 0 THEN CONTINUE FOREACH END IF
         #判斷是否已存在於同一張應付單據中的直接沖帳檔,若已存在則跳過此筆
         LET l_cnt = 0 
         SELECT COUNT(*) INTO l_cnt FROM apce_t
          WHERE apceent = g_enterprise
            AND apceld = p_ld
            AND apcedocno = p_docno     #本張應付單據
            AND apce003 = l_apccdocno   #沖銷帳款單號
            AND apce004 = l_apccseq     #沖銷帳款項次
         IF l_cnt > 0 THEN
            CONTINUE FOREACH
         END IF
      END IF #160705-00035#3
      
      #防止本次立帳單被超沖check-s
      #立帳單未付金額
      SELECT SUM(apcc108 - apcc109) INTO l_apcc109sum
        FROM apcc_t
       WHERE apccent = g_enterprise
         AND apccld  = p_ld AND apccdocno = p_docno
      #目前直接沖帳金額
      SELECT SUM(apce109) INTO l_apce109sum
        FROM apca_t,apce_t   #150316apo add apca_t
       WHERE apceent = g_enterprise
         AND apceld  = p_ld AND apcedocno = p_docno
         AND apcaent = apceent
         AND apcald  = apceld
         AND apcadocno = apcedocno
         AND apcastus NOT IN ('X')
         AND apce001 <> 'aapt430'  #150212
      IF cl_null(l_apcc109sum) THEN LET l_apcc109sum = 0 END IF
      IF cl_null(l_apce109sum) THEN LET l_apce109sum = 0 END IF
      IF l_apcc109sum <= l_apce109sum THEN
         EXIT FOREACH
      END IF
      #尚可沖帳金額
      LET l_apce109 = l_apcc109sum - l_apce109sum
      IF l_apce109 > l_apcc_left.apce109 THEN
         LET l_apce109 = l_apcc_left.apce109
      END IF
      #防止本次立帳單被超沖check-e
      
      INITIALIZE l_apce.* TO NULL
      LET l_apce.apceent = g_enterprise
      LET l_apce.apcecomp= l_apcccomp
      LET l_apce.apcelegl= ''
      LET l_apce.apcesite= l_apccsite
      LET l_apce.apceld  = p_ld
      LET l_apce.apcedocno=p_docno
      SELECT MAX(apceseq)+1 INTO l_apce.apceseq
        FROM apce_t
       WHERE apceent = g_enterprise AND apceld = p_ld
         AND apcedocno = p_docno
      IF cl_null(l_apce.apceseq) THEN LET l_apce.apceseq = 1 END IF
      LET l_apce.apce001 = 'aapt300'
      IF p_sfin2002 MATCHES '[12]' THEN 
         LET l_apce.apceorga= l_apcccomp
         LET l_apce.apce018 = l_apca015
         LET l_apce.apce019 = l_apca034
         LET l_apce.apce021 = l_apca059
         LET l_apce.apce022 = l_apca033
      ELSE
         SELECT apcborga,apcb002,apcb003,apcb010,apcb011,
                apcb012 ,apcb017,apcb015,apcb016
           INTO l_apce.apceorga,l_apce.apce024,l_apce.apce025,l_apce.apce018,l_apce.apce019,
                l_apce.apce020 ,l_apce.apce021,l_apce.apce022,l_apce.apce023
           FROM apcb_t
          WHERE apcbent  = g_enterprise     AND apcbld = p_ld
            AND apcbdocno= l_apccdocno AND apcbseq= l_apccseq
      END IF
      IF l_apca001 = '25' THEN
         LET l_apce.apce002 = '42'
      ELSE
         LET l_apce.apce002 = '41'
      END IF
      LET l_apce.apce003 = l_apccdocno
      LET l_apce.apce004 = l_apccseq
      LET l_apce.apce005 = l_apcc001
      
      LET l_apce.apce007 = 0
      LET l_apce.apce009 = 'N'
      LET l_apce.apce015 = s_fin_get_scc_value('8506',l_apce.apce002,'3')
      LET l_apce.apce016 = l_apca035
      LET l_apce.apce017 = l_apca014
      #應稅折抵否
      LET l_apce.apce027 = s_aapp131_get_apce027(l_apce.apce003)  #150316apo 
      LET l_apce.apce028 = 'N'
      LET l_apce.apce038 = l_apca0041   #150415apo
      
      LET l_apce.apce100 = l_apcc100
      LET l_apce.apce101 = l_apcc102
      LET l_apce.apce104 = 0
      LET l_apce.apce114 = 0
      LET l_apce.apce121 = l_apcc121
      LET l_apce.apce124 = 0
      LET l_apce.apce131 = l_apcc131
      LET l_apce.apce134 = 0

      IF (l_apcc108 - l_apcc109) > l_apce109 THEN
         LET l_apce.apce109 = l_apce109
         LET l_apce.apce119 = l_apce109 * l_apcc101
         IF l_glaa017 = '1' THEN
            LET l_apce.apce129 = l_apce.apce109 * l_apcc121
         ELSE
            LET l_apce.apce129 = l_apce.apce119 * l_apcc121
         END IF
         IF l_glaa021 = '1' THEN
            LET l_apce.apce139 = l_apce.apce109 * l_apcc131
         ELSE
            LET l_apce.apce139 = l_apce.apce119 * l_apcc131
         END IF
      ELSE
         #如果是aapt110，只有部份沖，就寫入部份沖的錢
         IF p_type = '0' AND (l_apcc108 - l_apcc109) > l_apba103 THEN
            LET l_apce.apce109 = l_apba103
            LET l_apce.apce119 = l_apba113
            LET l_apce.apce129 = l_apba103 * l_apcc121
            LET l_apce.apce139 = l_apba103 * l_apcc131
         ELSE
            LET l_apce.apce109 = l_apcc108 - l_apcc109
            LET l_apce.apce119 = l_apcc118 - l_apcc119
            LET l_apce.apce129 = l_apcc128 - l_apcc129
            LET l_apce.apce139 = l_apcc138 - l_apcc139
         END IF  
      END IF

      CALL s_curr_round_ld('1',p_ld,l_apce.apce100,l_apce.apce109,2) RETURNING g_sub_success,g_errno,l_apce.apce109

      LET l_apca012 = 0 
      SELECT apca012 INTO l_apca012 FROM apca_t WHERE apcaent = g_enterprise 
         AND apcadocno = l_apce.apce003
         AND apcald    = p_ld
      IF cl_null(l_apca012) THEN LET l_apca012 = 0 END IF 
      LET l_apce.apce103 = l_apce.apce109 /  (1 + l_apca012 / 100) 
      CALL s_curr_round_ld('1',p_ld,l_apce.apce100,l_apce.apce103,2) RETURNING g_sub_success,g_errno,l_apce.apce103
      LET l_apce.apce104 = l_apce.apce109 - l_apce.apce103

      CALL s_curr_round_ld('1',p_ld,l_glaa001,l_apce.apce119,2) RETURNING g_sub_success,g_errno,l_apce.apce119

      LET l_apce.apce113 = l_apce.apce119 /  (1 + l_apca012 / 100) 
      CALL s_curr_round_ld('1',p_ld,l_glaa001,l_apce.apce113,2) RETURNING g_sub_success,g_errno,l_apce.apce113
      LET l_apce.apce114 = l_apce.apce119 - l_apce.apce113
      CALL s_curr_round_ld('1',p_ld,l_glaa016,l_apce.apce129,2) RETURNING g_sub_success,g_errno,l_apce.apce129
      LET l_apce.apce123 = l_apce.apce129 /  (1 + l_apca012 / 100) 
      CALL s_curr_round_ld('1',p_ld,l_glaa016,l_apce.apce123,2) RETURNING g_sub_success,g_errno,l_apce.apce123
      LET l_apce.apce124 = l_apce.apce129 - l_apce.apce123
      CALL s_curr_round_ld('1',p_ld,l_glaa020,l_apce.apce139,2) RETURNING g_sub_success,g_errno,l_apce.apce139
      LET l_apce.apce133 = l_apce.apce139 /  (1 + l_apca012 / 100) 
      CALL s_curr_round_ld('1',p_ld,l_glaa020,l_apce.apce133,2) RETURNING g_sub_success,g_errno,l_apce.apce133
      LET l_apce.apce134 = l_apce.apce139 - l_apce.apce133
      #INSERT INTO apce_t VALUES(l_apce.*) #161108-00017#4 mark
      #161108-00017#4 add ------
      INSERT INTO apce_t (apceent,apcecomp,apcelegl,apcesite,apceld,
                          apceorga,apcedocno,apceseq,
                          apce001,apce002,apce003,apce004,apce005,
                          apce006,apce007,apce008,apce009,apce010,
                          apce011,apce012,apce013,apce014,apce015,
                          apce016,apce017,apce018,apce019,apce020,
                          apce021,apce022,apce023,apce024,apce025,
                          apce026,apce027,apce028,apce029,apce030,
                          apce031,apce032,apce033,apce034,apce035,
                          apce036,apce037,apce038,apce039,apce040,
                          apce041,apce042,apce043,apce044,apce045,
                          apce046,apce047,apce048,apce049,apce050,
                          apce051,apce052,apce053,apce054,apce055,
                          apce056,apce057,apce058,apce059,apce060,
                          apce100,apce101,apce104,apce109,apce114,
                          apce119,apce120,apce124,apce121,apce129,
                          apce130,apce131,apce134,apce139,
                          apceud001,apceud002,apceud003,apceud004,apceud005,
                          apceud006,apceud007,apceud008,apceud009,apceud010,
                          apceud011,apceud012,apceud013,apceud014,apceud015,
                          apceud016,apceud017,apceud018,apceud019,apceud020,
                          apceud021,apceud022,apceud023,apceud024,apceud025,
                          apceud026,apceud027,apceud028,apceud029,apceud030,
                          apce103,apce113,apce123,apce133,apce061
                         )
      VALUES (l_apce.apceent,l_apce.apcecomp,l_apce.apcelegl,l_apce.apcesite,l_apce.apceld,
              l_apce.apceorga,l_apce.apcedocno,l_apce.apceseq,
              l_apce.apce001,l_apce.apce002,l_apce.apce003,l_apce.apce004,l_apce.apce005,
              l_apce.apce006,l_apce.apce007,l_apce.apce008,l_apce.apce009,l_apce.apce010,
              l_apce.apce011,l_apce.apce012,l_apce.apce013,l_apce.apce014,l_apce.apce015,
              l_apce.apce016,l_apce.apce017,l_apce.apce018,l_apce.apce019,l_apce.apce020,
              l_apce.apce021,l_apce.apce022,l_apce.apce023,l_apce.apce024,l_apce.apce025,
              l_apce.apce026,l_apce.apce027,l_apce.apce028,l_apce.apce029,l_apce.apce030,
              l_apce.apce031,l_apce.apce032,l_apce.apce033,l_apce.apce034,l_apce.apce035,
              l_apce.apce036,l_apce.apce037,l_apce.apce038,l_apce.apce039,l_apce.apce040,
              l_apce.apce041,l_apce.apce042,l_apce.apce043,l_apce.apce044,l_apce.apce045,
              l_apce.apce046,l_apce.apce047,l_apce.apce048,l_apce.apce049,l_apce.apce050,
              l_apce.apce051,l_apce.apce052,l_apce.apce053,l_apce.apce054,l_apce.apce055,
              l_apce.apce056,l_apce.apce057,l_apce.apce058,l_apce.apce059,l_apce.apce060,
              l_apce.apce100,l_apce.apce101,l_apce.apce104,l_apce.apce109,l_apce.apce114,
              l_apce.apce119,l_apce.apce120,l_apce.apce124,l_apce.apce121,l_apce.apce129,
              l_apce.apce130,l_apce.apce131,l_apce.apce134,l_apce.apce139,
              l_apce.apceud001,l_apce.apceud002,l_apce.apceud003,l_apce.apceud004,l_apce.apceud005,
              l_apce.apceud006,l_apce.apceud007,l_apce.apceud008,l_apce.apceud009,l_apce.apceud010,
              l_apce.apceud011,l_apce.apceud012,l_apce.apceud013,l_apce.apceud014,l_apce.apceud015,
              l_apce.apceud016,l_apce.apceud017,l_apce.apceud018,l_apce.apceud019,l_apce.apceud020,
              l_apce.apceud021,l_apce.apceud022,l_apce.apceud023,l_apce.apceud024,l_apce.apceud025,
              l_apce.apceud026,l_apce.apceud027,l_apce.apceud028,l_apce.apceud029,l_apce.apceud030,
              l_apce.apce103,l_apce.apce113,l_apce.apce123,l_apce.apce133,l_apce.apce061
             )
      #161108-00017#4 add end---
   END FOREACH

END FUNCTION

 
{</section>}
 
