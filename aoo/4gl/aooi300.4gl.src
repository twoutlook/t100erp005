#該程式未解開Section, 採用最新樣板產出!
{<section id="aooi300.description" >}
#應用 a00 樣板自動產生(Version:3)
#+ Standard Version.....: SD版次:0011(2014-12-04 14:02:50), PR版次:0011(2016-12-13 14:22:24)
#+ Customerized Version.: SD版次:0000(1900-01-01 00:00:00), PR版次:0000(1900-01-01 00:00:00)
#+ Build......: 000429
#+ Filename...: aooi300
#+ Description: 應用分類碼維護作業(樹狀)
#+ Creator....: 02299(2013-07-01 00:00:00)
#+ Modifier...: 02295 -SD/PR- 08734
 
{</section>}
 
{<section id="aooi300.global" >}
#應用 i05 樣板自動產生(Version:37)
#add-point:填寫註解說明
#160318-00005#31  2016/03/26  By 07900       重复错误信息修改
#160412-00009#1   2016/04/21  By 03297       第一次新增节点，说明未带出
#160905-00007#9   2016/09/05  By 01531       调整系统中无ENT的SQL条件增加ent
#160809-00047#2   2016/10/11  By shiun       刪除前先判斷s_azzi610_check
#161124-00048#7   2016/12/13  By 08734       星号整批调整
#end add-point
#add-point:填寫註解說明(客製用)

#end add-point
 
IMPORT os
IMPORT util
#add-point:增加匯入項目 name="global.import"

#end add-point
  
SCHEMA ds 
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔 name="global.inc"

#end add-point
 
#單頭 type 宣告
PRIVATE type type_g_oocq_m RECORD
   oocq001 LIKE oocq_t.oocq001, 
   oocq001_desc LIKE type_t.chr80, 
   oocq002 LIKE oocq_t.oocq002, 
   oocql004 LIKE oocql_t.oocql004, 
   oocql005 LIKE oocql_t.oocql005, 
   oocq003 LIKE oocq_t.oocq003, 
   oocq003_desc LIKE type_t.chr80, 
   oocqstus LIKE oocq_t.oocqstus, 
   oocq004 LIKE oocq_t.oocq004, 
   oocq004_desc LIKE type_t.chr80, 
   oocq005 LIKE oocq_t.oocq005, 
   oocq005_desc LIKE type_t.chr80, 
   oocq006 LIKE oocq_t.oocq006, 
   oocq006_desc LIKE type_t.chr80, 
   oocq007 LIKE oocq_t.oocq007, 
   oocq007_desc LIKE type_t.chr80, 
   oocq008 LIKE oocq_t.oocq008, 
   oocq008_desc LIKE type_t.chr80, 
   oocq009 LIKE oocq_t.oocq009, 
   oocq010 LIKE oocq_t.oocq010, 
   oocq011 LIKE oocq_t.oocq011, 
   oocq012 LIKE oocq_t.oocq012, 
   oocq013 LIKE oocq_t.oocq013, 
   oocq014 LIKE oocq_t.oocq014, 
   oocq015 LIKE oocq_t.oocq015, 
   oocq016 LIKE oocq_t.oocq016, 
   oocq017 LIKE oocq_t.oocq017, 
   oocq018 LIKE oocq_t.oocq018, 
   oocq019 LIKE oocq_t.oocq019, 
   oocq020 LIKE oocq_t.oocq020, 
   oocq021 LIKE oocq_t.oocq021, 
   oocq022 LIKE oocq_t.oocq022, 
   oocq023 LIKE oocq_t.oocq023, 
   oocq024 LIKE oocq_t.oocq024, 
   oocq024_desc LIKE type_t.chr80, 
   oocq025 LIKE oocq_t.oocq025, 
   oocq025_desc LIKE type_t.chr80, 
   oocq026 LIKE oocq_t.oocq026, 
   oocq026_desc LIKE type_t.chr80, 
   oocq027 LIKE oocq_t.oocq027, 
   oocq027_desc LIKE type_t.chr80, 
   oocq028 LIKE oocq_t.oocq028, 
   oocq028_desc LIKE type_t.chr80, 
   oocq029 LIKE oocq_t.oocq029, 
   oocq030 LIKE oocq_t.oocq030, 
   oocq031 LIKE oocq_t.oocq031, 
   oocq032 LIKE oocq_t.oocq032, 
   oocq033 LIKE oocq_t.oocq033, 
   oocq034 LIKE oocq_t.oocq034, 
   oocq035 LIKE oocq_t.oocq035, 
   oocq036 LIKE oocq_t.oocq036, 
   oocq037 LIKE oocq_t.oocq037, 
   oocq038 LIKE oocq_t.oocq038, 
   oocq039 LIKE oocq_t.oocq039, 
   oocq040 LIKE oocq_t.oocq040, 
   oocq041 LIKE oocq_t.oocq041, 
   oocq042 LIKE oocq_t.oocq042, 
   oocq043 LIKE oocq_t.oocq043, 
   oocqownid LIKE oocq_t.oocqownid, 
   oocqownid_desc LIKE type_t.chr80, 
   oocqowndp LIKE oocq_t.oocqowndp, 
   oocqowndp_desc LIKE type_t.chr80, 
   oocqcrtid LIKE oocq_t.oocqcrtid, 
   oocqcrtid_desc LIKE type_t.chr80, 
   oocqcrtdt LIKE oocq_t.oocqcrtdt, 
   oocqcrtdp LIKE oocq_t.oocqcrtdp, 
   oocqcrtdp_desc LIKE type_t.chr80, 
   oocqmodid LIKE oocq_t.oocqmodid, 
   oocqmodid_desc LIKE type_t.chr80, 
   oocqmoddt LIKE oocq_t.oocqmoddt
                                  END RECORD
 
#add-point:自定義模組變數(Module Variable)(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="global.variable"
DEFINE g_oocq001_p           LIKE oocq_t.oocq001
DEFINE g_chk                 LIKE type_t.num5 #151221-00018#2-add
#end add-point
                                  
#模組變數(Module Variables)
DEFINE g_oocq_m          type_g_oocq_m
DEFINE g_oocq_m_t        type_g_oocq_m
DEFINE g_oocq_m_o        type_g_oocq_m
 
   DEFINE g_oocq001_t LIKE oocq_t.oocq001
DEFINE g_oocq002_t LIKE oocq_t.oocq002
 
 
#DEFINE g_oocq002_t        LIKE oocq_t.oocq002
DEFINE g_oocq003_t        LIKE oocq_t.oocq003
#DEFINE g_oocq001_t      LIKE oocq_t.oocq001
 
DEFINE g_browser    DYNAMIC ARRAY OF RECORD    #資料瀏覽之欄位
       b_show          LIKE type_t.chr100,    #外顯欄位
       b_pid           LIKE type_t.chr100,    #父節點id
       b_id            LIKE type_t.chr100,    #本身節點id
       b_exp           LIKE type_t.chr100,    #是否展開
       b_hasC          LIKE type_t.num5,      #是否有子節點
       b_isExp         LIKE type_t.num5,      #是否已展開
       b_expcode       LIKE type_t.num5,      #展開值
       #tree自定義欄位
          b_oocq001 LIKE oocq_t.oocq001,
      b_oocq003 LIKE oocq_t.oocq003,
      b_oocq002 LIKE oocq_t.oocq002,
      b_oocqstus LIKE oocq_t.oocqstus,
      b_oocq004 LIKE oocq_t.oocq004,
      b_oocq005 LIKE oocq_t.oocq005,
      b_oocq006 LIKE oocq_t.oocq006,
      b_oocq007 LIKE oocq_t.oocq007,
      b_oocq008 LIKE oocq_t.oocq008,
      b_oocq009 LIKE oocq_t.oocq009,
      b_oocq010 LIKE oocq_t.oocq010,
      b_oocq011 LIKE oocq_t.oocq011,
      b_oocq012 LIKE oocq_t.oocq012,
      b_oocq013 LIKE oocq_t.oocq013,
      b_oocq014 LIKE oocq_t.oocq014,
      b_oocq015 LIKE oocq_t.oocq015,
      b_oocq016 LIKE oocq_t.oocq016,
      b_oocq017 LIKE oocq_t.oocq017,
      b_oocq018 LIKE oocq_t.oocq018,
      b_oocq019 LIKE oocq_t.oocq019,
      b_oocq020 LIKE oocq_t.oocq020,
      b_oocq021 LIKE oocq_t.oocq021,
      b_oocq022 LIKE oocq_t.oocq022,
      b_oocq023 LIKE oocq_t.oocq023,
      b_oocq024 LIKE oocq_t.oocq024,
      b_oocq025 LIKE oocq_t.oocq025,
      b_oocq026 LIKE oocq_t.oocq026,
      b_oocq027 LIKE oocq_t.oocq027,
      b_oocq028 LIKE oocq_t.oocq028,
      b_oocq029 LIKE oocq_t.oocq029,
      b_oocq030 LIKE oocq_t.oocq030,
      b_oocq031 LIKE oocq_t.oocq031,
      b_oocq032 LIKE oocq_t.oocq032,
      b_oocq033 LIKE oocq_t.oocq033,
      b_oocq034 LIKE oocq_t.oocq034,
      b_oocq035 LIKE oocq_t.oocq035,
      b_oocq036 LIKE oocq_t.oocq036,
      b_oocq037 LIKE oocq_t.oocq037,
      b_oocq038 LIKE oocq_t.oocq038,
      b_oocq039 LIKE oocq_t.oocq039,
      b_oocq040 LIKE oocq_t.oocq040,
      b_oocq041 LIKE oocq_t.oocq041,
      b_oocq042 LIKE oocq_t.oocq042,
      b_oocq043 LIKE oocq_t.oocq043
                   END RECORD
 
DEFINE g_browser_root  DYNAMIC ARRAY OF INTEGER    #root資料所在
       
#多table用變數
DEFINE g_master_multi_table_t    RECORD
      oocql001 LIKE oocql_t.oocql001,
      oocql002 LIKE oocql_t.oocql002,
      oocql004 LIKE oocql_t.oocql004,
      oocql005 LIKE oocql_t.oocql005
      END RECORD
 
DEFINE g_wc                  STRING
DEFINE g_sql                 STRING
DEFINE g_forupd_sql          STRING
DEFINE g_cnt                 LIKE type_t.num10
DEFINE g_current_idx         LIKE type_t.num10
DEFINE g_jump                LIKE type_t.num10
DEFINE g_no_ask              LIKE type_t.num5
DEFINE g_rec_b               LIKE type_t.num10
DEFINE l_ac                  LIKE type_t.num10
DEFINE g_curr_diag           ui.Dialog                #Current Dialog
 
DEFINE g_pagestart           LIKE type_t.num10         
DEFINE gwin_curr             ui.Window                #Current Window
DEFINE gfrm_curr             ui.Form                  #Current Form
DEFINE g_page_action         STRING                   #page action
DEFINE g_header_hidden       LIKE type_t.num5         #隱藏單頭
DEFINE g_worksheet_hidden    LIKE type_t.num5         #隱藏工作Panel
DEFINE g_browser_cnt         LIKE type_t.num10        #total count
DEFINE g_page                STRING                   #第幾頁
DEFINE g_current_row         LIKE type_t.num10        #Browser所在筆數
DEFINE g_current_sw          LIKE type_t.num10        #Browser所在筆數用開關
 
DEFINE g_searchcol           LIKE type_t.chr200
DEFINE g_searchstr           LIKE type_t.chr200
DEFINE g_searchtype          LIKE type_t.chr200
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_row_index           LIKE type_t.num10
DEFINE g_root_search         BOOLEAN
DEFINE g_first               LIKE type_t.num5  #標示是否要啟動s_browse重查
DEFINE g_aw                  STRING            #確定當下點擊的單身
DEFINE g_log1                STRING            #log用
DEFINE g_log2                STRING            #log用
DEFINE g_add_browse          STRING            #新增填充用WC
DEFINE g_add_idx             LIKE type_t.num5  #新增資料指標
 
#add-point:自定義客戶專用模組變數(Module Variable) name="global.variable_customerization"

#end add-point
 
#add-point:傳入參數說明(global.argv) name="global.argv"

#end add-point
 
{</section>}
 
{<section id="aooi300.main" >}
#應用 a26 樣板自動產生(Version:7)
#+ 作業開始(主程式類型)
MAIN
   #add-point:main段define(客製用) name="main.define_customerization"
   
   #end add-point   
   #add-point:main段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="main.define"
   DEFINE l_gzaastus LIKE gzaa_t.gzaastus
   DEFINE l_count LIKE type_t.num5
   #end add-point   
   
   OPTIONS
   INPUT NO WRAP
   DEFER INTERRUPT
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
       
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("aoo","")
 
   #add-point:作業初始化 name="main.init"
   LET g_argv[1] = cl_replace_str(g_argv[1], '\"', '')
   LET g_oocq001_p = g_argv[1]
   IF cl_null(g_argv[1]) THEN 
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'aoo-00084'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()

      CLOSE WINDOW w_aooi300
      CALL cl_ap_exitprogram("0")
   ELSE 
      SELECT COUNT(*) INTO l_count FROM gzaa_t WHERE gzaa001 = g_oocq001_p 
      SELECT gzaastus INTO l_gzaastus FROM gzaa_t WHERE gzaa001 = g_oocq001_p 
      IF l_gzaastus = 'Y' THEN
         
      ELSE
         IF l_count = 0 THEN 
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aoo-00086'
            LET g_errparam.extend = g_argv[1]
            LET g_errparam.popup = TRUE
            CALL cl_err()

         ELSE
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aoo-00087'
            LET g_errparam.extend = g_argv[1]
            LET g_errparam.popup = TRUE
            CALL cl_err()

         END IF 
         CLOSE WINDOW w_aooi300
         CALL cl_ap_exitprogram("0")
      END IF 
   END IF 
   LET g_chk = TRUE #151221-00018#2-add
   #end add-point
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define name="main.define_sql"
   
   #end add-point
   LET g_forupd_sql = " SELECT oocq001,'',oocq002,'','',oocq003,'',oocqstus,oocq004,'',oocq005,'',oocq006, 
       '',oocq007,'',oocq008,'',oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016,oocq017, 
       oocq018,oocq019,oocq020,oocq021,oocq022,oocq023,oocq024,'',oocq025,'',oocq026,'',oocq027,'',oocq028, 
       '',oocq029,oocq030,oocq031,oocq032,oocq033,oocq034,oocq035,oocq036,oocq037,oocq038,oocq039,oocq040, 
       oocq041,oocq042,oocq043,oocqownid,'',oocqowndp,'',oocqcrtid,'',oocqcrtdt,oocqcrtdp,'',oocqmodid, 
       '',oocqmoddt", 
                      " FROM oocq_t",
                      " WHERE oocqent= ? AND oocq001=? AND oocq002=? FOR UPDATE"
   #add-point:SQL_define name="main.after_define_sql"
   
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)                #轉換不同資料庫語法
   LET g_forupd_sql = cl_sql_add_mask(g_forupd_sql)              #遮蔽特定資料
   DECLARE aooi300_cl CURSOR FROM g_forupd_sql                 # LOCK CURSOR
 
   LET g_sql = " SELECT DISTINCT t0.oocq001,t0.oocq002,t0.oocq003,t0.oocqstus,t0.oocq004,t0.oocq005, 
       t0.oocq006,t0.oocq007,t0.oocq008,t0.oocq009,t0.oocq010,t0.oocq011,t0.oocq012,t0.oocq013,t0.oocq014, 
       t0.oocq015,t0.oocq016,t0.oocq017,t0.oocq018,t0.oocq019,t0.oocq020,t0.oocq021,t0.oocq022,t0.oocq023, 
       t0.oocq024,t0.oocq025,t0.oocq026,t0.oocq027,t0.oocq028,t0.oocq029,t0.oocq030,t0.oocq031,t0.oocq032, 
       t0.oocq033,t0.oocq034,t0.oocq035,t0.oocq036,t0.oocq037,t0.oocq038,t0.oocq039,t0.oocq040,t0.oocq041, 
       t0.oocq042,t0.oocq043,t0.oocqownid,t0.oocqowndp,t0.oocqcrtid,t0.oocqcrtdt,t0.oocqcrtdp,t0.oocqmodid, 
       t0.oocqmoddt,t1.gzaal003 ,t2.oocql004 ,t3.ooag011 ,t4.ooefl003 ,t5.ooag011 ,t6.ooefl003 ,t7.ooag011", 
 
               " FROM oocq_t t0",
                              " LEFT JOIN gzaal_t t1 ON t1.gzaal001=oocq001 AND t1.gzaal002='"||g_lang||"' ",
               " LEFT JOIN oocql_t t2 ON t2.oocqlent="||g_enterprise||" AND t2.oocql001=oocq001 AND t2.oocql002=oocq003 AND t2.oocql003='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t3 ON t3.ooagent="||g_enterprise||" AND t3.ooag001=oocqownid  ",
               " LEFT JOIN ooefl_t t4 ON t4.ooeflent="||g_enterprise||" AND t4.ooefl001=oocqowndp AND t4.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t5 ON t5.ooagent="||g_enterprise||" AND t5.ooag001=oocqcrtid  ",
               " LEFT JOIN ooefl_t t6 ON t6.ooeflent="||g_enterprise||" AND t6.ooefl001=oocqcrtdp AND t6.ooefl002='"||g_dlang||"' ",
               " LEFT JOIN ooag_t t7 ON t7.ooagent="||g_enterprise||" AND t7.ooag001=oocqmodid  ",
 
               " WHERE t0.oocqent = " ||g_enterprise|| " AND t0.oocq001 = ? AND t0.oocq002 = ?"
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   #add-point:SQL_define name="main.after_refresh_sql"
   
   #end add-point
   PREPARE aooi300_master_referesh FROM g_sql
 
    
 
   
   IF g_bgjob = "Y" THEN
      #add-point:Service Call name="main.servicecall"
      
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_aooi300 WITH FORM cl_ap_formpath("aoo",g_code)
   
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
   
      #程式初始化
      CALL aooi300_init()   
 
      #進入選單 Menu (="N")
      CALL aooi300_ui_dialog() 
      
      #add-point:畫面關閉前 name="main.before_close"
      
      #end add-point
 
      #畫面關閉
      CLOSE WINDOW w_aooi300
      
   END IF 
   
   CLOSE aooi300_cl
   
   
 
   #add-point:作業離開前 name="main.exit"
   
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
END MAIN
 
 
 
 
{</section>}
 
{<section id="aooi300.init" >}
#+ 瀏覽頁簽資料初始化
PRIVATE FUNCTION aooi300_init()
   #add-point:init段define name="init.define_customerization"
   
   #end add-point
   #add-point:init段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="init.define"
   
   #end add-point 
   
   #add-point:Function前置處理  name="init.pre_function"
   
   #end add-point
   
      CALL cl_set_combo_scc_part('oocqstus','17','N,Y')
 
   
   LET g_add_idx = 1
   LET g_current_idx = 1
    
   #add-point:畫面資料初始化 name="init.init"
   CALL aooi300_set_title_visible(g_argv[1])
   CALL aooi300_set_title_visible2(g_argv[1])
   #end add-point
   
   CALL aooi300_default_search()
    
END FUNCTION
 
{</section>}
 
{<section id="aooi300.ui_dialog" >}
#+ 選單功能實際執行處
PRIVATE FUNCTION aooi300_ui_dialog()
   #add-point:ui_dialog段define name="ui_dialog.define_customerization"
   
   #end add-point
   DEFINE li_exit      LIKE type_t.num5    #判別是否為離開作業
   DEFINE la_param  RECORD
          prog       STRING,
          actionid   STRING,
          background LIKE type_t.chr1,
          param      DYNAMIC ARRAY OF STRING
                    END RECORD
   DEFINE l_cmd_token           base.StringTokenizer   #報表作業cmdrun使用 
   DEFINE l_cmd_next            STRING                 #報表作業cmdrun使用
   DEFINE l_cmd_cnt             LIKE type_t.num5       #報表作業cmdrun使用
   DEFINE l_cmd_prog_arg        STRING                 #報表作業cmdrun使用
   DEFINE l_cmd_arg             STRING                 #報表作業cmdrun使用
   #add-point:ui_dialog段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="ui_dialog.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="ui_dialog.pre_function"
   
   #end add-point
   
   LET li_exit = FALSE
   LET gwin_curr = ui.Window.getCurrent()
   LET gfrm_curr = gwin_curr.getForm() 
 
   #add-point:ui_dialog段before dialog  name="ui_dialog.before_dialog"
   CALL cl_set_combo_scc_part('b_oocqstus','17','N,Y')
   #end add-point
   
   WHILE li_exit = FALSE
 
      IF g_action_choice = "logistics" THEN
         #清除畫面及相關資料
         CLEAR FORM
         CALL g_browser.clear()       
         INITIALIZE g_oocq_m.* TO NULL
         LET g_wc  = ' 1=2'
         LET g_action_choice = ""
         LET g_first = 1
         CALL aooi300_init()
      END IF
 
      #當瀏覽頁簽被設定關閉時,使用MENU (開啟時使用DIALOG)
      IF g_worksheet_hidden = 1 THEN
 
         LET g_current_sw = FALSE
 
         #回歸舊筆數位置 (回到當時異動的筆數)
         LET g_current_idx = g_current_row
         LET g_current_sw = TRUE
         CALL cl_show_fld_cont() 
         IF g_current_idx > 0 THEN
         CALL aooi300_fetch("")    #當每次點任一筆資料都會需要用到
         END IF
 
         MENU
            #add-point:ui_dialog段其他頁簽的 display array(in menu) name="ui_dialog.more_displayarray_in_menu"
            
            #end add-point
            
            ON ACTION statechange
               LET g_action_choice = "statechange"
               CALL aooi300_statechange()
            
            #ACTION表單列
            ON ACTION first
               LET g_current_idx = 1
               CALL aooi300_fetch("")
               LET g_current_row = g_current_idx
            
            ON ACTION next
               LET g_current_idx = g_current_idx + 1
               CALL aooi300_fetch("")
               LET g_current_row = g_current_idx
 
            ON ACTION jump
               CALL aooi300_fetch("/")
               LET g_current_row = g_current_idx
 
            ON ACTION previous
               LET g_current_idx = g_current_idx - 1
               CALL aooi300_fetch("")
               LET g_current_row = g_current_idx
 
            ON ACTION last 
               LET g_current_idx = g_browser_cnt
               CALL aooi300_fetch("") 
               LET g_current_row = g_current_idx
 
            ON ACTION exit
               LET g_action_choice="exit"
               LET INT_FLAG = FALSE
               LET li_exit = TRUE
               EXIT MENU 
 
            ON ACTION close
               LET li_exit = TRUE
               EXIT MENU
 
            ON ACTION mainhidden       #主頁摺疊
               IF g_main_hidden THEN
                  CALL gfrm_curr.setElementHidden("mainlayout",0)
                  CALL gfrm_curr.setElementImage("mainhidden","16/worksheethidden.png")
                  LET g_main_hidden = 0
               ELSE
                  CALL gfrm_curr.setElementHidden("mainlayout",1)
                  CALL gfrm_curr.setElementImage("mainhidden","16/worksheethidden.png")
                  LET g_main_hidden = 1
               END IF
               EXIT MENU
         
            ON ACTION worksheethidden   #瀏覽頁折疊
               IF g_worksheet_hidden THEN
                  CALL gfrm_curr.setElementHidden("worksheet",0)
                  CALL gfrm_curr.setElementImage("worksheethidden","16/mainhidden.png")
                  LET g_worksheet_hidden = 0
               ELSE
                  CALL gfrm_curr.setElementHidden("worksheet",1)
                  CALL gfrm_curr.setElementImage("worksheethidden","16/mainhidden.png")
                  LET g_worksheet_hidden = 1
               END IF
               EXIT MENU
         
            ON ACTION controls      #單頭摺疊，可利用hot key "Alt-s"開啟/關閉單頭
               IF g_header_hidden THEN
                  CALL gfrm_curr.setElementHidden("vb_master",0)
                  CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
                  LET g_header_hidden = 0     #visible
               ELSE
                  CALL gfrm_curr.setElementHidden("vb_master",1)
                  CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
                  LET g_header_hidden = 1     #hidden
               END IF
 
            
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL aooi300_modify()
               #add-point:ON ACTION modify name="menu2.modify"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL aooi300_delete(DIALOG)
               #add-point:ON ACTION delete name="menu2.delete"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL aooi300_insert(DIALOG)
               #add-point:ON ACTION insert name="menu2.insert"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output name="menu2.output"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION quickprint
            LET g_action_choice="quickprint"
            IF cl_auth_chk_act("quickprint") THEN
               
               #add-point:ON ACTION quickprint name="menu2.quickprint"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION reproduce
            LET g_action_choice="reproduce"
            IF cl_auth_chk_act("reproduce") THEN
               CALL aooi300_reproduce(DIALOG)
               #add-point:ON ACTION reproduce name="menu2.reproduce"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL aooi300_query()
               #add-point:ON ACTION query name="menu2.query"
               
               #END add-point
               
            END IF
 
 
 
 
 
            
 
            #應用 a46 樣板自動產生(Version:3)
         #新增相關文件
         ON ACTION related_document
            CALL aooi300_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document name="ui_dialog.menu.related_document"
               
               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL aooi300_set_pk_array()
            #add-point:ON ACTION agendum name="ui_dialog.menu.agendum"
            
            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL aooi300_set_pk_array()
            #add-point:ON ACTION followup name="ui_dialog.menu.followup"
            
            #END add-point
            CALL cl_user_overview_follow('')
 
 
 
            
            &include "main_menu_exit_menu.4gl"
            &include "relating_action.4gl"
            #交談指令共用ACTION
            &include "common_action.4gl"
 
         END MENU
 
      ELSE
         #第一次進入程式, 或啟動重新查詢
         IF g_first = 0 THEN 
            CALL aooi300_browser_fill(g_wc,g_searchtype)
            LET g_first = 1
         END IF
      
         DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
         
            INPUT g_searchstr,g_searchcol,g_searchtype FROM formonly.searchstr,formonly.cbo_searchcol, 
                formonly.rdo_searchtype
               BEFORE INPUT
            END INPUT
            
            #左側瀏覽頁簽
            DISPLAY ARRAY g_browser TO s_browse.* ATTRIBUTE(COUNT=g_rec_b)
 
               BEFORE DISPLAY
                  CALL DIALOG.setSelectionMode("s_browse",1) #設定為單選
 
               BEFORE ROW
                  #add-point:ui_dialog段before row1 name="ui_dialog.before_row1"
                  
                  #end add-point
                  #回歸舊筆數位置 (回到當時異動的筆數)
                  LET g_current_idx = DIALOG.getCurrentRow("s_browse")
                  IF g_current_row > 1 AND g_current_sw = FALSE THEN
                     CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                     LET g_current_idx = g_current_row
                  END IF
                  #add-point:ui_dialog段before row2 name="ui_dialog.before_row2"
                  
                  #end add-point
                  LET g_current_row = g_current_idx #目前指標
                  LET g_current_sw = TRUE
                  CALL cl_show_fld_cont() 
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
 
                  CALL aooi300_fetch("")  #當每次點任一筆資料都會需要用到
 
               ON EXPAND (g_row_index)
                  #樹展開
                  CALL aooi300_browser_expand(g_row_index)
                  LET g_browser[g_row_index].b_isExp = 1
 
               ON COLLAPSE (g_row_index)
                  #樹關閉
                  
               #add-point:ui_dialog段action name="ui_dialog.tree_action"
               
               #end add-point
 
            END DISPLAY
 
            #add-point:ui_dialog段其他頁簽的 display array name="ui_dialog.more_displayarray"
            
            #end add-point
 
            BEFORE DIALOG
               #action default動作(判定是否要先執行特定動作)
               #應用 a42 樣板自動產生(Version:3)
   #進入程式時預設執行的動作
   CASE g_actdefault
      WHEN "insert"
         LET g_action_choice="insert"
         LET g_actdefault = ""
         IF cl_auth_chk_act("insert") THEN
            CALL aooi300_insert(DIALOG)
            #add-point:ON ACTION insert name="menu.default.insert"
            
            #END add-point
         END IF
 
      #add-point:action default自訂 name="ui_dialog.action_default"
      
      #end add-point
      OTHERWISE
   END CASE
 
 
 
               LET g_curr_diag = ui.DIALOG.getCurrent()
               LET g_current_sw = FALSE
 
               #add-point:ui_dialog,before dialog1 name="ui_dialog.b_dialog1"
               
               #end add-point
               #回歸舊筆數位置 (回到當時異動的筆數)
               LET g_current_idx = DIALOG.getCurrentRow("s_browse")
               IF g_current_row > 1 AND g_current_sw = FALSE THEN
                  IF g_current_row > g_browser.getLength() THEN
                     LET g_current_row = g_browser.getLength()
                  END IF 
                  CALL DIALOG.setCurrentRow("s_browse",g_current_row)
                  LET g_current_idx = g_current_row
               END IF
               #add-point:ui_dialog,before dialog2 name="ui_dialog.b_dialog2"
               
               #end add-point
               LET g_current_row = g_current_idx #目前指標
               LET g_current_sw = TRUE
               CALL cl_show_fld_cont() 
               CALL DIALOG.setCurrentRow("s_browse",g_current_row)
               IF g_current_idx > 0 THEN
               CALL aooi300_fetch("")            #當每次點任一筆資料都會需要用到
               END IF
               #add-point:ui_dialog,before dialog name="ui_dialog.b_dialog"
               
               #end add-point
 
            AFTER DIALOG 
               #add-point:ui_dialog,after dialog name="ui_dialog.a_dialog"
               
               #end add-point
 
            ON ACTION statechange
               LET g_action_choice = "statechange"
               CALL aooi300_statechange()
 
            #一般搜尋
            ON ACTION searchdata
               LET g_searchstr = GET_FLDBUF(searchstr)
               LET g_searchcol = GET_FLDBUF(cbo_searchcol)
               #若無輸入關鍵字則查找出所有資料
               IF g_searchcol="0" AND NOT cl_null(g_searchstr) THEN
                  INITIALIZE g_errparam TO NULL 
                  LET g_errparam.extend = "searchcol:" 
                  LET g_errparam.code = "std-00001" 
                  LET g_errparam.popup = FALSE 
                  CALL cl_err()
                  CONTINUE DIALOG
               END IF 
               IF NOT cl_null(g_searchstr) THEN
                  LET g_wc = " lower(", g_searchcol, ") LIKE '%", g_searchstr, "%'"
                  LET g_wc = g_wc.toLowerCase()
               ELSE
                  LET g_wc = " 1=1 "
               END IF
               LET g_first = 0 #啟動重查
               EXIT DIALOG
 
            #進階搜尋
            #ON ACTION advancesearch
 
            ON ACTION exit
               LET g_action_choice="exit"
               LET INT_FLAG = FALSE
               LET li_exit = TRUE
               EXIT DIALOG 
            
            ON ACTION close
               LET li_exit = TRUE
               EXIT DIALOG
            
            ON ACTION mainhidden       #主頁摺疊
               IF g_main_hidden THEN
                  CALL gfrm_curr.setElementHidden("mainlayout",0)
                  CALL gfrm_curr.setElementImage("mainhidden","16/worksheethidden.png")
                  LET g_main_hidden = 0
               ELSE
                  CALL gfrm_curr.setElementHidden("mainlayout",1)
                  CALL gfrm_curr.setElementImage("mainhidden","16/mainhidden.png")
                  LET g_main_hidden = 1
               END IF
               EXIT DIALOG
 
            ON ACTION worksheethidden   #瀏覽頁折疊
               IF g_worksheet_hidden THEN
                  CALL gfrm_curr.setElementHidden("worksheet",0)
                  CALL gfrm_curr.setElementImage("worksheethidden","16/worksheethidden.png")
                  LET g_worksheet_hidden = 0
               ELSE
                  CALL gfrm_curr.setElementHidden("worksheet",1)
                  CALL gfrm_curr.setElementImage("worksheethidden","16/worksheethidden.png")
                  LET g_worksheet_hidden = 1
               END IF
               EXIT DIALOG
 
            ON ACTION controls      #單頭摺疊，可利用hot key "Alt-s"開啟/關閉單頭
               IF g_header_hidden THEN
                  CALL gfrm_curr.setElementHidden("vb_master",0)
                  CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
                  LET g_header_hidden = 0     #visible
               ELSE
                  CALL gfrm_curr.setElementHidden("vb_master",1)
                  CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
                  LET g_header_hidden = 1     #hidden
               END IF
 
            
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION modify
            LET g_action_choice="modify"
            IF cl_auth_chk_act("modify") THEN
               LET g_aw = ''
               CALL aooi300_modify()
               #add-point:ON ACTION modify name="menu.modify"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION delete
            LET g_action_choice="delete"
            IF cl_auth_chk_act("delete") THEN
               CALL aooi300_delete(DIALOG)
               #add-point:ON ACTION delete name="menu.delete"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION insert
            LET g_action_choice="insert"
            IF cl_auth_chk_act("insert") THEN
               CALL aooi300_insert(DIALOG)
               #add-point:ON ACTION insert name="menu.insert"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN
               
               #add-point:ON ACTION output name="menu.output"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION quickprint
            LET g_action_choice="quickprint"
            IF cl_auth_chk_act("quickprint") THEN
               
               #add-point:ON ACTION quickprint name="menu.quickprint"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION reproduce
            LET g_action_choice="reproduce"
            IF cl_auth_chk_act("reproduce") THEN
               CALL aooi300_reproduce(DIALOG)
               #add-point:ON ACTION reproduce name="menu.reproduce"
               
               #END add-point
               
            END IF
 
 
 
 
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION query
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN
               CALL aooi300_query()
               #add-point:ON ACTION query name="menu.query"
               
               #END add-point
               
            END IF
 
 
 
 
 
            
            
            #應用 a46 樣板自動產生(Version:3)
         #新增相關文件
         ON ACTION related_document
            CALL aooi300_set_pk_array()
            IF cl_auth_chk_act("related_document") THEN
               #add-point:ON ACTION related_document name="ui_dialog.dialog.related_document"
               
               #END add-point
               CALL cl_doc()
            END IF
            
         ON ACTION agendum
            CALL aooi300_set_pk_array()
            #add-point:ON ACTION agendum name="ui_dialog.dialog.agendum"
            
            #END add-point
            CALL cl_user_overview()
            CALL cl_user_overview_set_follow_pic()
         
         ON ACTION followup
            CALL aooi300_set_pk_array()
            #add-point:ON ACTION followup name="ui_dialog.dialog.followup"
            
            #END add-point
            CALL cl_user_overview_follow('')
 
 
 
            
            &include "main_menu_exit_dialog.4gl"
            #交談指令共用ACTION
            &include "common_action.4gl"
            
         END DIALOG 
      
      END IF
      
   END WHILE
 
END FUNCTION 
 
{</section>}
 
{<section id="aooi300.browser_fill" >}
#+ 瀏覽頁簽where條件組成
PRIVATE FUNCTION aooi300_browser_fill(p_wc,p_type)
   #add-point:browser_fill段define name="browser_fill.define_customerization"
   
   #end add-point
   DEFINE p_wc       STRING 
   DEFINE p_type     LIKE type_t.chr10
   DEFINE l_cnt      LIKE type_t.num10
   DEFINE l_cnt2     LIKE type_t.num10   
   #add-point:browser_fill段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="browser_fill.define"
   DEFINE l_gzaa005  LIKE gzaa_t.gzaa005 #151221-00018#2-add
   #end add-point
   
   #add-point:Function前置處理  name="browser_fill.before_fill"
   LET p_wc = p_wc," AND oocq001 = '",g_oocq001_p,"'"
   #151221-00018#2-add----(S)
   IF g_chk THEN
      LET l_gzaa005 = ''
      SELECT gzaa005 INTO l_gzaa005
        FROM gzaa_t
       WHERE gzaa001 = g_oocq001_p
      IF cl_null(l_gzaa005) OR l_gzaa005 = 'N' THEN
         RETURN
      END IF
   END IF
   #151221-00018#2-add----(E)
   #end add-point
 
   CALL g_browser.clear()
   CLEAR FORM
   LET l_cnt = 0
   LET l_cnt2 = 0
   
   DROP TABLE aooi300_tmp
   
   #Create temp table
   CREATE TEMP TABLE aooi300_tmp
   (
         oocq001 VARCHAR(500),
   oocq003 VARCHAR(500),
   oocq002 VARCHAR(500),
   oocqstus VARCHAR(500),
   oocq004 VARCHAR(500),
   oocq005 VARCHAR(500),
   oocq006 VARCHAR(500),
   oocq007 VARCHAR(500),
   oocq008 VARCHAR(500),
   oocq009 VARCHAR(500),
   oocq010 VARCHAR(500),
   oocq011 VARCHAR(500),
   oocq012 VARCHAR(500),
   oocq013 VARCHAR(500),
   oocq014 VARCHAR(500),
   oocq015 VARCHAR(500),
   oocq016 VARCHAR(500),
   oocq017 VARCHAR(500),
   oocq018 VARCHAR(500),
   oocq019 VARCHAR(500),
   oocq020 VARCHAR(500),
   oocq021 VARCHAR(500),
   oocq022 VARCHAR(500),
   oocq023 VARCHAR(500),
   oocq024 VARCHAR(500),
   oocq025 VARCHAR(500),
   oocq026 VARCHAR(500),
   oocq027 VARCHAR(500),
   oocq028 VARCHAR(500),
   oocq029 VARCHAR(500),
   oocq030 VARCHAR(500),
   oocq031 VARCHAR(500),
   oocq032 VARCHAR(500),
   oocq033 VARCHAR(500),
   oocq034 VARCHAR(500),
   oocq035 VARCHAR(500),
   oocq036 VARCHAR(500),
   oocq037 VARCHAR(500),
   oocq038 VARCHAR(500),
   oocq039 VARCHAR(500),
   oocq040 VARCHAR(500),
   oocq041 VARCHAR(500),
   oocq042 VARCHAR(500),
   oocq043 VARCHAR(500),
      #僅含browser的欄位
      exp_code  VARCHAR(5)
   );
 
   #先確定搜尋範圍(若無條件搜尋則只找root出來)
   SELECT COUNT(1) INTO l_cnt FROM oocq_t WHERE oocqent = g_enterprise AND 1=1
   
   #取得符合p_wc的所有資料
   LET g_sql = "SELECT COUNT(1)",
               " FROM oocq_t ",
               "  LEFT JOIN oocql_t ON oocqlent = "||g_enterprise||" AND oocq001 = oocql001 AND oocq002 = oocql002 AND oocql003 = '",g_dlang,"' ",
               " WHERE oocqent = " ||g_enterprise|| " AND ",p_wc ,cl_sql_add_filter("oocq_t")
   #add-point:browser_fill段cnt wc name="browser_fill.cnt_wc"
   
   #end add-point
              
   PREPARE master_cnt FROM g_sql
   DECLARE master_cntcur CURSOR FOR master_cnt
   OPEN master_cntcur
   IF SQLCA.SQLCODE THEN   #(ver:36)
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN master_cntcur:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:36)
      LET g_errparam.popup = TRUE 
      CALL cl_err()
      RETURN
   END IF
 
   FETCH master_cntcur INTO l_cnt2
   LET g_root_search = FALSE
   
   IF l_cnt2 = 0 THEN
      #INITIALIZE g_errparam TO NULL 
      #LET g_errparam.extend = "" 
      #LET g_errparam.code = "-100" 
      #LET g_errparam.popup = TRUE 
      #CALL cl_err()
      RETURN
   END IF
   
   IF l_cnt = l_cnt2 THEN
      #未輸入條件時則只查找root節點
      LET p_wc = " oocq002 = oocq003 "
      LET g_root_search = TRUE
   END IF
 
   #取得符合p_wc的所有資料
   LET g_sql = "SELECT oocq001,oocq003,oocq002,oocqstus,oocq004,oocq005,oocq006,oocq007,oocq008,oocq009, 
       oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016,oocq017,oocq018,oocq019,oocq020,oocq021, 
       oocq022,oocq023,oocq024,oocq025,oocq026,oocq027,oocq028,oocq029,oocq030,oocq031,oocq032,oocq033, 
       oocq034,oocq035,oocq036,oocq037,oocq038,oocq039,oocq040,oocq041,oocq042,oocq043 ",
               " FROM oocq_t",
               "  LEFT JOIN oocql_t ON oocqlent = "||g_enterprise||" AND oocq001 = oocql001 AND oocq002 = oocql002 AND oocql003 = '",g_dlang,"' ",
               " WHERE oocqent = " ||g_enterprise|| " AND ",p_wc ,cl_sql_add_filter("oocq_t")
   #add-point:browser_fill段sql wc name="browser_fill.sql_wc"
   
   #end add-point
   #LET g_sql = cl_sql_add_tabid(g_sql,"oocq_t")             #WC重組
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料           
   PREPARE master_ext FROM g_sql
   DECLARE master_extcur CURSOR FOR master_ext
   
   #單筆update
   #LET g_sql = "SELECT '','','','','','','',oocq001,oocq003,oocq002,oocqstus,oocq004,oocq005,oocq006, 
   #    oocq007,oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016,oocq017,oocq018, 
   #    oocq019,oocq020,oocq021,oocq022,oocq023,oocq024,oocq025,oocq026,oocq027,oocq028,oocq029,oocq030, 
   #    oocq031,oocq032,oocq033,oocq034,oocq035,oocq036,oocq037,oocq038,oocq039,oocq040,oocq041,oocq042, 
   #    oocq043 ",
   #            " FROM oocq_t",
   #            "  LEFT JOIN oocql_t ON oocqlent = "||g_enterprise||" AND oocq001 = oocql001 AND oocq002 = oocql002 AND oocql003 = '",g_dlang,"' ",
   #            " WHERE oocqent = " ||g_enterprise|| " AND ",
   #            " oocq001 = ?"
   #            ," oocq002 = ?"
 
                
   LET g_sql = " SELECT t0.oocq001,t0.oocq003,t0.oocq002,t0.oocqstus,t0.oocq004,t0.oocq005,t0.oocq006, 
       t0.oocq007,t0.oocq008,t0.oocq009,t0.oocq010,t0.oocq011,t0.oocq012,t0.oocq013,t0.oocq014,t0.oocq015, 
       t0.oocq016,t0.oocq017,t0.oocq018,t0.oocq019,t0.oocq020,t0.oocq021,t0.oocq022,t0.oocq023,t0.oocq024, 
       t0.oocq025,t0.oocq026,t0.oocq027,t0.oocq028,t0.oocq029,t0.oocq030,t0.oocq031,t0.oocq032,t0.oocq033, 
       t0.oocq034,t0.oocq035,t0.oocq036,t0.oocq037,t0.oocq038,t0.oocq039,t0.oocq040,t0.oocq041,t0.oocq042, 
       t0.oocq043 ",
               " FROM oocq_t t0",
               "  ",
               
               " WHERE oocqent = " ||g_enterprise|| " AND ",
               " oocq001 = ?"
               ," AND oocq002 = ?"
 
 
               
   #add-point:browser_fill段sql wc name="browser_fill.refresh"
   
   #end add-point
   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料           
   PREPARE master_refresh FROM g_sql
   DECLARE master_refreshcur CURSOR FOR master_refresh
 
   #搜尋建構樹所需的節點
   CASE p_type
      WHEN "1" #上推
         CALL aooi300_match_node(p_wc,p_type) 
      WHEN "2" #下展
         #CALL aooi300_find_speed_tbl(p_wc,p_type) 
         CALL aooi300_match_node(p_wc,p_type) 
      WHEN "3" #全部
         CALL aooi300_match_node(p_wc,p_type) 
   END CASE
 
   CALL aooi300_browser_create(p_type)
     
END FUNCTION
 
{</section>}
 
{<section id="aooi300.match_node" >}
PRIVATE FUNCTION aooi300_match_node(p_wc,p_type)
   #add-point:match_node段define name="match_node.define_customerization"
   
   #end add-point
   DEFINE p_wc         LIKE type_t.chr200
   DEFINE p_type       LIKE type_t.chr10
   DEFINE ls_code      LIKE type_t.chr50
   DEFINE ls_code2     LIKE type_t.chr50
   DEFINE l_bstmp      RECORD    #body欄位
             oocq001 VARCHAR(500),
   oocq003 VARCHAR(500),
   oocq002 VARCHAR(500),
   oocqstus VARCHAR(500),
   oocq004 VARCHAR(500),
   oocq005 VARCHAR(500),
   oocq006 VARCHAR(500),
   oocq007 VARCHAR(500),
   oocq008 VARCHAR(500),
   oocq009 VARCHAR(500),
   oocq010 VARCHAR(500),
   oocq011 VARCHAR(500),
   oocq012 VARCHAR(500),
   oocq013 VARCHAR(500),
   oocq014 VARCHAR(500),
   oocq015 VARCHAR(500),
   oocq016 VARCHAR(500),
   oocq017 VARCHAR(500),
   oocq018 VARCHAR(500),
   oocq019 VARCHAR(500),
   oocq020 VARCHAR(500),
   oocq021 VARCHAR(500),
   oocq022 VARCHAR(500),
   oocq023 VARCHAR(500),
   oocq024 VARCHAR(500),
   oocq025 VARCHAR(500),
   oocq026 VARCHAR(500),
   oocq027 VARCHAR(500),
   oocq028 VARCHAR(500),
   oocq029 VARCHAR(500),
   oocq030 VARCHAR(500),
   oocq031 VARCHAR(500),
   oocq032 VARCHAR(500),
   oocq033 VARCHAR(500),
   oocq034 VARCHAR(500),
   oocq035 VARCHAR(500),
   oocq036 VARCHAR(500),
   oocq037 VARCHAR(500),
   oocq038 VARCHAR(500),
   oocq039 VARCHAR(500),
   oocq040 VARCHAR(500),
   oocq041 VARCHAR(500),
   oocq042 VARCHAR(500),
   oocq043 VARCHAR(500)
          #僅含單身table的欄位
   END RECORD 
   DEFINE l_child_list DYNAMIC ARRAY OF RECORD    #body欄位
             oocq001 VARCHAR(500),
   oocq003 VARCHAR(500),
   oocq002 VARCHAR(500),
   oocqstus VARCHAR(500),
   oocq004 VARCHAR(500),
   oocq005 VARCHAR(500),
   oocq006 VARCHAR(500),
   oocq007 VARCHAR(500),
   oocq008 VARCHAR(500),
   oocq009 VARCHAR(500),
   oocq010 VARCHAR(500),
   oocq011 VARCHAR(500),
   oocq012 VARCHAR(500),
   oocq013 VARCHAR(500),
   oocq014 VARCHAR(500),
   oocq015 VARCHAR(500),
   oocq016 VARCHAR(500),
   oocq017 VARCHAR(500),
   oocq018 VARCHAR(500),
   oocq019 VARCHAR(500),
   oocq020 VARCHAR(500),
   oocq021 VARCHAR(500),
   oocq022 VARCHAR(500),
   oocq023 VARCHAR(500),
   oocq024 VARCHAR(500),
   oocq025 VARCHAR(500),
   oocq026 VARCHAR(500),
   oocq027 VARCHAR(500),
   oocq028 VARCHAR(500),
   oocq029 VARCHAR(500),
   oocq030 VARCHAR(500),
   oocq031 VARCHAR(500),
   oocq032 VARCHAR(500),
   oocq033 VARCHAR(500),
   oocq034 VARCHAR(500),
   oocq035 VARCHAR(500),
   oocq036 VARCHAR(500),
   oocq037 VARCHAR(500),
   oocq038 VARCHAR(500),
   oocq039 VARCHAR(500),
   oocq040 VARCHAR(500),
   oocq041 VARCHAR(500),
   oocq042 VARCHAR(500),
   oocq043 VARCHAR(500)
          #僅含單身table的欄位
   END RECORD
   DEFINE li_cnt       LIKE type_t.num10   #(ver:35) add
   #add-point:match_node段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="match_node.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="match_node.pre_function"
   
   #end add-point
   
   #先找出符合條件的節點並給予展開值
   CASE p_type
      WHEN 1
         LET ls_code = "0" #展開值0則無法展開
      WHEN 2
         LET ls_code = "2"
      WHEN 3
         LET ls_code = "2"
   END CASE
   
   IF cl_null("oocq003") THEN
      LET ls_code = "0"
   END IF 
   
   CALL s_transaction_begin()
 
   LET g_sql = " INSERT INTO aooi300_tmp (oocq001,oocq003,oocq002,oocqstus,oocq004,oocq005,oocq006,oocq007, 
       oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016,oocq017,oocq018,oocq019, 
       oocq020,oocq021,oocq022,oocq023,oocq024,oocq025,oocq026,oocq027,oocq028,oocq029,oocq030,oocq031, 
       oocq032,oocq033,oocq034,oocq035,oocq036,oocq037,oocq038,oocq039,oocq040,oocq041,oocq042,oocq043, 
       exp_code) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?, 
       ?,?,?,?,?,?,?)"
   PREPARE master_tmp FROM g_sql
   
   IF g_root_search THEN
      #DECLARE master_tmp_cur CURSOR FOR master_tmp
      #OPEN master_tmp_cur
      FOREACH master_extcur INTO l_bstmp.*
         EXECUTE master_tmp USING l_bstmp.*,ls_code
         #PUT master_tmp_cur FROM l_bstmp.*,ls_code
      END FOREACH
      #FLUSH master_tmp_cur
      CALL s_transaction_end("Y","0")
      RETURN
   END IF
 
   #(ver:35) ---modify start---
   FOREACH master_extcur INTO l_bstmp.*
      #(ver:35) add oocq003
      IF aooi300_tmp_tbl_chk(l_bstmp.oocq002,l_bstmp.oocq003,ls_code   #(ver:35) add oocq003
                  ,l_bstmp.oocq001
                  ) THEN
         EXECUTE master_tmp USING l_bstmp.*,ls_code
      END IF
 
      LET l_child_list[l_child_list.getLength()+1].* = l_bstmp.*
   END FOREACH
 
   #找出符合條件的節點的所有祖先並給予展開值
   CASE p_type
      WHEN 1
         LET ls_code2 = "1"
      WHEN 2
         LET ls_code2 = "-1"
      WHEN 3
         LET ls_code2 = "1"
   END CASE
 
   WHILE TRUE
      IF l_child_list.getLength() <= 0 THEN
         EXIT WHILE
      END IF
 
      #若pid欄位存在才進行後續處理
      #擷取該節點的所有父節點
      IF cl_null(l_child_list[1].oocq002) THEN
         IF l_child_list.getLength() = 1 THEN
            EXIT WHILE
         ELSE
            CALL l_child_list.deleteElement(1)
            CONTINUE WHILE
         END IF
      END IF
 
      #確認是否有父節點
      LET g_sql = " SELECT COUNT(1) ",
                  " FROM oocq_t t0",
                  " WHERE oocqent = " ||g_enterprise|| " AND oocq002 = ? ",
                  " AND oocq001 = ? ",
                  cl_sql_add_filter("gzwe_t")
      PREPARE master_getparent_cnt FROM g_sql
      EXECUTE master_getparent_cnt USING l_child_list[1].oocq003 INTO li_cnt
      IF li_cnt <= 0 THEN
         CALL l_child_list.deleteElement(1)
         CONTINUE WHILE
      END IF
 
      #擷取該節點的父節點到temp table中
      LET g_sql = " SELECT oocq001,oocq003,oocq002,oocqstus,oocq004,oocq005,oocq006,oocq007,oocq008, 
          oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016,oocq017,oocq018,oocq019,oocq020, 
          oocq021,oocq022,oocq023,oocq024,oocq025,oocq026,oocq027,oocq028,oocq029,oocq030,oocq031,oocq032, 
          oocq033,oocq034,oocq035,oocq036,oocq037,oocq038,oocq039,oocq040,oocq041,oocq042,oocq043 ", 
 
                  " FROM oocq_t t0",
                  " WHERE oocqent = " ||g_enterprise|| " AND oocq002 = ? ",
                  " AND oocq001 = ? ",
                  cl_sql_add_filter("oocq_t")
      PREPARE master_getparent_up FROM g_sql
      DECLARE master_getparent_up_cur CURSOR FOR master_getparent_up
      
   #  EXECUTE master_getparent_up USING l_child_list[1].oocq003
   #                                    ,l_child_list[1].oocq001
   #                                    INTO l_bstmp.*
      FOREACH master_getparent_up_cur USING l_child_list[1].oocq003
                                        INTO l_bstmp.*
 
         IF SQLCA.SQLCODE THEN
            FREE master_getparent_up
            EXIT WHILE
         END IF
         #FREE master_getparent_up
      
         #確定該節點是否存在於temp table中
         IF STATUS = 0 AND aooi300_tmp_tbl_chk(l_bstmp.oocq002,l_bstmp.oocq003,ls_code2
                     ,l_bstmp.oocq001
                     ) THEN
            EXECUTE master_tmp USING l_bstmp.*,ls_code2
 
            #若已找到root，表示已到根結點
            IF l_bstmp.oocq002 = l_bstmp.oocq003 THEN
               CALL l_child_list.deleteElement(1)
               CONTINUE WHILE
            END IF
 
            LET l_child_list[l_child_list.getLength()+1].* = l_bstmp.*
         END IF
      END FOREACH
      CALL l_child_list.deleteElement(1)
   END WHILE
   #(ver:35) --- modify end ---
 
   CLOSE master_tmp
   
   CALL s_transaction_end("Y","0")
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.tmp_tbl_chk" >}
#+ TEMP TABLE CHK
#PRIVATE FUNCTION aooi300_tmp_tbl_chk(ps_id,pi_code,ps_type)
PRIVATE FUNCTION aooi300_tmp_tbl_chk(ps_id,ps_pid,pi_code,ps_type)   #(ver:35) modify
   #add-point:tmp_tbl_chk段define name="tmp_tbl_chk.define_customerization"
   
   #end add-point
   DEFINE ps_id       STRING
   DEFINE ps_pid      STRING   #(ver:35) add
   DEFINE pi_code     LIKE type_t.num10
   DEFINE ps_type     STRING
   DEFINE ls_id       LIKE type_t.chr500
   DEFINE ls_pid      LIKE type_t.chr500   #(ver:35) add
   DEFINE ls_search   LIKE type_t.chr500
   DEFINE ls_type     LIKE type_t.chr500
   DEFINE li_cnt      LIKE type_t.num10
   DEFINE li_code     LIKE type_t.num10   
   #add-point:tmp_tbl_chk段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="tmp_tbl_chk.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="tmp_tbl_chk.pre_function"
   
   #end add-point
   
   LET ls_id = ps_id
   LET ls_pid = ps_pid   #(ver:35) add
   LET ls_type = ps_type
  
   IF cl_null(ls_id) THEN
      RETURN TRUE
   END IF
   
   LET g_sql = " SELECT COUNT(1) FROM aooi300_tmp ", 
               " WHERE oocq002 = ? ",
                 " AND oocq003 = ? "   #(ver:35) add
                ," AND oocq001 = ? "
 
   PREPARE aooi300_get_cnt FROM g_sql
   EXECUTE aooi300_get_cnt USING ls_id ,ls_pid   #(ver:35) add ls_pid
                                           ,ls_type
                                     INTO li_cnt
   FREE aooi300_get_cnt
 
   IF li_cnt = 0 OR SQLCA.SQLCODE THEN
      RETURN TRUE
   ELSE
      #資料已存在, 確定是否需要更新展開值
      LET g_sql = " SELECT exp_code FROM aooi300_tmp ",
                  " WHERE oocq002 = ? ",
                    " AND oocq003 = ? "   #(ver:35) add
                   ," AND oocq001 = ? "
 
      PREPARE aooi300_chk_exp FROM g_sql
      EXECUTE aooi300_chk_exp USING ls_id ,ls_pid   #(ver;35) add ls_pid
                                              ,ls_type
                                        INTO li_code
      FREE aooi300_chk_exp
      
      #若新展開值>原展開值則做更新
      IF pi_code > li_code THEN
         LET g_sql = " UPDATE aooi300_tmp SET (exp_code) = ('",pi_code,"') ",
                     " WHERE oocq002 = ? ",
                       " AND oocq003 = ? "   #(ver:35) add
                      ," AND oocq001 = ? "
         PREPARE aooi300_upd_exp FROM g_sql
         EXECUTE aooi300_upd_exp USING ls_id ,ls_pid   #(ver:35) add ls_pid
                                                 ,ls_type
         FREE aooi300_upd_exp
      END IF
      
      RETURN FALSE
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.browser_expand" >}
#+ Tree子節點展開
PRIVATE FUNCTION aooi300_browser_expand(p_id)
   #add-point:browser_expand段define name="browser_expand.define_customerization"
   
   #end add-point
   DEFINE p_id          LIKE type_t.num10
   DEFINE l_id          LIKE type_t.num10
   DEFINE l_cnt         LIKE type_t.num10
   DEFINE l_keyvalue    LIKE type_t.chr50
   DEFINE l_typevalue   LIKE type_t.chr50
   DEFINE l_type        LIKE type_t.chr50
   DEFINE l_sql         STRING
   DEFINE ls_source     LIKE type_t.chr500
   DEFINE ls_exp_code   LIKE type_t.chr500
   DEFINE l_return      LIKE type_t.num5
   DEFINE ls_ent_wc     LIKE type_t.chr500
   #add-point:browser_expand段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="browser_expand.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="browser_expand.pre_function"
   
   #end add-point
   
   #若已經展開
   IF g_browser[p_id].b_isExp = 1 THEN
      RETURN
   END IF
   
   LET l_return = FALSE
 
   LET l_keyvalue = g_browser[p_id].b_oocq002
   LET l_typevalue = g_browser[p_id].b_oocq001
   
   CASE g_browser[p_id].b_expcode
      WHEN -1
         CALL g_browser.deleteElement(p_id)
      WHEN 0
         RETURN
      WHEN 1
         LET ls_source = "aooi300_tmp"
         LET ls_exp_code = "exp_code"
      WHEN 2
         LET ls_source = "oocq_t"
         LET ls_exp_code = "'2'"
         LET ls_ent_wc = " oocqent = " ||g_enterprise|| " AND "
   END CASE
    
   LET l_sql = " SELECT DISTINCT '','','','FALSE','','',",ls_exp_code,",oocq001,oocq003,oocq002,oocqstus, 
       oocq004,oocq005,oocq006,oocq007,oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015, 
       oocq016,oocq017,oocq018,oocq019,oocq020,oocq021,oocq022,oocq023,oocq024,oocq025,oocq026,oocq027, 
       oocq028,oocq029,oocq030,oocq031,oocq032,oocq033,oocq034,oocq035,oocq036,oocq037,oocq038,oocq039, 
       oocq040,oocq041,oocq042,oocq043 ",
               " FROM ",ls_source,
               
               " WHERE ",ls_ent_wc,"oocq003 = '", l_keyvalue,
               "' AND oocq002 <> oocq003",
               " AND oocq001 = '", l_typevalue,"'", 
               " ORDER BY oocq002"
   
   #add-point:browser_expand段before_pre name="browser_expand.before_pre"
   
   #end add-point
   
   LET l_sql = cl_sql_add_mask(l_sql)              #遮蔽特定資料
   PREPARE tree_expand FROM l_sql
   DECLARE tree_ex_cur CURSOR FOR tree_expand
  
   LET l_id = p_id + 1
   LET g_cnt = p_id + 1
   CALL g_browser.insertElement(l_id)
   LET l_cnt = 1
   FOREACH tree_ex_cur INTO g_browser[l_id].* 
      #pid=父節點id
      LET g_browser[l_id].b_pid = g_browser[p_id].b_id
      #id=本身節點id(採流水號遞增)
      LET g_browser[l_id].b_id = g_browser[p_id].b_id||"."||l_cnt
      #hasC=確認該節點是否有子孫
      CALL aooi300_desc_show(l_id)
      LET g_browser[l_id].b_hasC = aooi300_chk_hasC(l_id)
      LET l_id = l_id + 1
      LET g_cnt = l_id
      CALL g_browser.insertElement(l_id)
      LET l_cnt = l_cnt + 1
      LET l_return = TRUE
   END FOREACH
   
   #刪除空資料
   CALL g_browser.deleteElement(l_id)
   DISPLAY g_browser.getLength() TO FORMONLY.h_count 
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.browser_create" >}
PRIVATE FUNCTION aooi300_browser_create(p_type)
   #add-point:browser_create name="browser_create.define_customerization"
   
   #end add-point
   DEFINE p_type   LIKE type_t.chr50
   DEFINE l_pid    LIKE type_t.chr50
   #add-point:browser_create(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="browser_create.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="browser_create.pre_function"
   
   #end add-point
   
   #先找出所有的帳別資料
   LET g_sql = " SELECT DISTINCT oocq001 FROM aooi300_tmp ORDER BY oocq001"
   PREPARE master_type FROM g_sql
   DECLARE master_typecur CURSOR FOR master_type
   INITIALIZE g_browser_root TO NULL
   
   LET l_ac = 1
   FOREACH master_typecur INTO g_browser[l_ac].b_oocq001
      #確定root節點所在
      LET g_browser_root[g_browser_root.getLength()+1] = l_ac
      #此處為帳別部分(LV-1)
      LET g_browser[l_ac].b_oocq002  = g_browser[l_ac].b_oocq001
      LET g_browser[l_ac].b_oocq001 = g_browser[l_ac].b_oocq001
      LET g_browser[l_ac].b_pid = "0" CLIPPED
      LET g_browser[l_ac].b_id = l_ac USING "<<<"
      LET g_browser[l_ac].b_exp = TRUE
      LET g_browser[l_ac].b_hasC = TRUE
      LET l_pid = g_browser[l_ac].b_id CLIPPED
      LET l_ac = l_ac + 1
      
      #抓出LV2的所有資料
      #LET g_sql = " SELECT DISTINCT t0.oocq001,t0.oocq003,t0.oocq002,t0.oocqstus,t0.oocq004,t0.oocq005, 
      #    t0.oocq006,t0.oocq007,t0.oocq008,t0.oocq009,t0.oocq010,t0.oocq011,t0.oocq012,t0.oocq013,t0.oocq014, 
      #    t0.oocq015,t0.oocq016,t0.oocq017,t0.oocq018,t0.oocq019,t0.oocq020,t0.oocq021,t0.oocq022,t0.oocq023, 
      #    t0.oocq024,t0.oocq025,t0.oocq026,t0.oocq027,t0.oocq028,t0.oocq029,t0.oocq030,t0.oocq031,t0.oocq032, 
      #    t0.oocq033,t0.oocq034,t0.oocq035,t0.oocq036,t0.oocq037,t0.oocq038,t0.oocq039,t0.oocq040,t0.oocq041, 
      #    t0.oocq042,t0.oocq043,exp_code FROM aooi300_tmp a ",
      LET g_sql = " SELECT DISTINCT '','','','FALSE','','',exp_code,oocq001,oocq003,oocq002,oocqstus, 
          oocq004,oocq005,oocq006,oocq007,oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015, 
          oocq016,oocq017,oocq018,oocq019,oocq020,oocq021,oocq022,oocq023,oocq024,oocq025,oocq026,oocq027, 
          oocq028,oocq029,oocq030,oocq031,oocq032,oocq033,oocq034,oocq035,oocq036,oocq037,oocq038,oocq039, 
          oocq040,oocq041,oocq042,oocq043 FROM aooi300_tmp a ",
                  
                  " WHERE ",
                  "a.oocq001 = ? ",
                  " AND ",
                  " (( SELECT COUNT(1) FROM aooi300_tmp b WHERE a.oocq003 = b.oocq002 ", 
                  " AND a.oocq001 = b.oocq001",
                  ") = 0 OR ", 
                  " a.oocq002 = a.oocq003 )", 
                  " ORDER BY a.oocq002"
      #add-point:browser_create.before_pre name="browser_create.before_pre"
      
      #end add-point
 
      PREPARE master_getLV2 FROM g_sql
      DECLARE master_getLV2cur CURSOR FOR master_getLV2
      
      #以下為一般資料root(LV-2)
      #OPEN master_getLV2cur USING g_browser[l_ac-1].b_oocq001   #(ver:36)
 
      LET g_cnt = l_ac
      FOREACH master_getLV2cur   #(ver:36) #(ver:37)
         USING g_browser[l_ac-1].b_oocq001   #(ver:36)
         INTO g_browser[g_cnt].*    #(ver:36)
         #(ver:36) ---add start---
         IF SQLCA.SQLCODE THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend = "Browser Create FOREACH ERROR"
            LET g_errparam.code = SQLCA.SQLCODE
            LET g_errparam.popup = TRUE
            CALL cl_err()
            RETURN
         END IF
         #(ver:36) --- add end ---
 
         #去除多餘空白
         #LET g_browser[g_cnt].b_oocq002 = g_browser[g_cnt].b_oocq002 CLIPPED
         LET g_browser[g_cnt].b_pid = l_pid
         LET g_browser[g_cnt].b_id  = l_pid,".",g_cnt USING "<<<"
         LET g_browser[g_cnt].b_exp = FALSE
         #(ver:35) ---modify start---
         #LET g_browser[g_cnt].b_expcode = 2
         CASE g_browser[g_cnt].b_expcode
            WHEN 2
               LET g_browser[g_cnt].b_hasC = aooi300_chk_hasC(g_cnt)
            WHEN 1
               LET g_browser[g_cnt].b_hasC = aooi300_chk_hasC(g_cnt)
            WHEN 0
               LET g_browser[g_cnt].b_hasC = FALSE
            WHEN -1
               #向下查找到展開值不等於-1得節點(temp table中查找)
               LET g_cnt = aooi300_find_node(g_cnt)
         END CASE
         #(ver:35) --- modify end ---
         IF cl_null("oocq003") THEN
            LET g_browser[g_cnt].b_hasC = FALSE
         ELSE
            LET g_browser[g_cnt].b_hasC = TRUE
         END IF
 
         LET g_cnt = g_cnt + 1
      END FOREACH
      LET l_ac = g_browser.getLength()
 
   END FOREACH
   
   #組合描述欄位&刪除多於資料
   FOR l_ac = 1 TO g_browser.getLength()
      IF cl_null(g_browser[l_ac].b_oocq002) THEN
         CALL g_browser.deleteElement(l_ac)
         LET l_ac = l_ac - 1
      ELSE
         CALL aooi300_desc_show(l_ac)
      END IF
   END FOR
   CALL g_browser.deleteElement(l_ac)
 
   LET g_browser_cnt = g_browser.getLength() - g_browser_root.getLength()
 
   FREE tree_expand
   FREE master_getLV2
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.desc_show" >}
#+ 組合顯示在畫面上的資訊
PRIVATE FUNCTION aooi300_desc_show(pi_ac)
   #add-point:desc_show段define name="desc_show.define_customerization"
   
   #end add-point
   DEFINE pi_ac   LIKE type_t.num10
   DEFINE li_tmp  LIKE type_t.num10   
   #add-point:desc_show段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="desc_show.define"
   DEFINE l_str   LIKE type_t.chr300
   #end add-point
   
   #add-point:Function前置處理  name="desc_show.pre_function"
   
   #end add-point
   
   LET li_tmp = l_ac
   LET l_ac = pi_ac
   
   
   #add-point:browser_create段desc處理 name="desc_show.show"
   IF cl_null(g_browser[l_ac].b_oocq001) THEN LET g_browser[l_ac].b_oocq001 = g_oocq001_p END IF   #160412-00009#1
   IF cl_null(g_browser[l_ac].b_oocq003) THEN 
      SELECT gzaal003 INTO l_str FROM gzaal_t
       WHERE gzaal001 = g_browser[l_ac].b_oocq001 AND gzaal002 = g_lang
   ELSE
      SELECT oocql004 INTO l_str FROM oocql_t
       WHERE oocqlent = g_enterprise AND oocql001 = g_browser[l_ac].b_oocq001 
         AND oocql002 = g_browser[l_ac].b_oocq002 
      SELECT oocqstus INTO g_browser[l_ac].b_oocqstus FROM oocq_t
       WHERE oocqent = g_enterprise AND oocq001 = g_browser[l_ac].b_oocq001 
         AND oocq002 = g_browser[l_ac].b_oocq002
   END IF 
   
   LET g_browser[l_ac].b_show = 
           g_browser[l_ac].b_oocq002,
             '(',l_str,')'
   #end add-point
 
   LET l_ac = li_tmp
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.find_node" >}
#+ 尋找符合條件的節點
PRIVATE FUNCTION aooi300_find_node(pi_ac)
   #add-point:find_node段define name="find_node.define_customerization"
   
   #end add-point
   DEFINE pi_ac   LIKE type_t.num10
   DEFINE li_idx  LIKE type_t.num10
   DEFINE li_tmp  LIKE type_t.num10
   DEFINE ls_pid  STRING
   #add-point:find_node段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="find_node.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="find_node.pre_function"
   
   #end add-point
   
   LET ls_pid = g_browser[pi_ac].b_pid
   
   LET g_sql = " SELECT DISTINCT '','','','FALSE','','',exp_code,oocq001,oocq003,oocq002,oocqstus,oocq004, 
       oocq005,oocq006,oocq007,oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016, 
       oocq017,oocq018,oocq019,oocq020,oocq021,oocq022,oocq023,oocq024,oocq025,oocq026,oocq027,oocq028, 
       oocq029,oocq030,oocq031,oocq032,oocq033,oocq034,oocq035,oocq036,oocq037,oocq038,oocq039,oocq040, 
       oocq041,oocq042,oocq043 ",
               " FROM aooi300_tmp ",
               " WHERE oocq003 = ? AND oocq003 <> oocq002",
               " ORDER BY oocq002"
   PREPARE master_getNode FROM g_sql
   DECLARE master_getNodecur CURSOR FOR master_getNode
   
   LET li_idx = pi_ac
   WHILE li_idx <= g_browser.getLength()
      IF g_browser[li_idx].b_expcode = -1 THEN
      #  OPEN master_getNodecur USING g_browser[li_idx].b_oocq002   #(ver:36)
         FOREACH master_getNodecur USING g_browser[li_idx].b_oocq002 INTO g_browser[g_browser.getLength()+1].*  
               #(ver:36)
 
            #(ver:36) ---start---
            IF SQLCA.SQLCODE THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "FOREACH ",SQLERRMESSAGE
               LET g_errparam.code = SQLCA.SQLCODE
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               RETURN
            END IF
            #(ver:36) --- end ---
            CALL aooi300_desc_show(g_browser.getLength())
            LET g_browser[g_browser.getLength()].b_pid = ls_pid
            LET g_browser[g_browser.getLength()].b_id = g_browser.getLength()
            LET g_browser[g_browser.getLength()].b_hasC = aooi300_chk_hasC(g_browser.getLength())
         END FOREACH
         CALL g_browser.deleteElement(li_idx)
         CALL g_browser.deleteElement(g_browser.getLength())
      ELSE
         LET li_idx = li_idx + 1
      END IF
   
   END WHILE
   
   FREE master_getNode
   
   RETURN g_browser.getLength()
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.chk_hasC" >}
#+ QBE資料查詢
PRIVATE FUNCTION aooi300_chk_hasC(pi_id)
   #add-point:chk_hasC段define name="chk_hasC.define_customerization"
   
   #end add-point
   DEFINE pi_id    LIKE type_t.num10
   DEFINE li_cnt   LIKE type_t.num10
   #add-point:chk_hasC段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="chk_hasC.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="chk_hasC.pre_function"
   
   #end add-point
   
   LET g_sql = "SELECT COUNT(oocq003) FROM aooi300_tmp ",
               " WHERE ",
                "oocq003 = ? AND ",
                "exp_code <> '-1' AND oocq002 <> oocq003 "
                 ," AND ",
                "oocq001 = ?"
 
   PREPARE aooi300_temp_chk FROM g_sql
 
   LET g_sql = "SELECT COUNT(1) FROM oocq_t ",
               " WHERE oocqent = " ||g_enterprise|| " AND ", 
               "oocq002 <> oocq003 AND ",
               "oocq003 = ? ",
                " AND ",
               "oocq001 = ?",
               cl_sql_add_filter("oocq_t")
   
   PREPARE aooi300_master_chk FROM g_sql
   
   CASE g_browser[pi_id].b_expcode 
      WHEN -1
         RETURN FALSE
      WHEN 0
         RETURN FALSE
      WHEN 1
         EXECUTE aooi300_temp_chk 
           USING g_browser[pi_id].b_oocq002
                 ,g_browser[pi_id].b_oocq001
            INTO li_cnt
         FREE aooi300_temp_chk
      WHEN 2 
         EXECUTE aooi300_master_chk 
           USING g_browser[pi_id].b_oocq002
                 ,g_browser[pi_id].b_oocq001
            INTO li_cnt
         FREE aooi300_master_chk
   END CASE
    
   IF li_cnt > 0 THEN
      RETURN TRUE
   ELSE
      RETURN FALSE
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.construct" >}
#+ QBE資料查詢
PRIVATE FUNCTION aooi300_construct()
   #add-point:cs段define name="cs.define_customerization"
   
   #end add-point
   DEFINE ls_wc       STRING
   DEFINE ls_return   STRING
   DEFINE ls_result   STRING 
   #add-point:cs段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="cs.define"
   DEFINE l_return    STRING
   #end add-point
   
   #add-point:Function前置處理  name="cs.pre_function"
   
   #end add-point
   
   #清除畫面
   CLEAR FORM
   INITIALIZE g_oocq_m.* TO NULL
   INITIALIZE g_wc TO NULL
   LET g_qryparam.state = "c"
    
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      CONSTRUCT BY NAME g_wc ON oocq002,oocql004,oocql005,oocq003,oocqstus,oocq004,oocq005,oocq006,oocq007, 
          oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016,oocq017,oocq018,oocq019, 
          oocq020,oocq021,oocq022,oocq023,oocq024,oocq024_desc,oocq025,oocq025_desc,oocq026,oocq026_desc, 
          oocq027,oocq027_desc,oocq028,oocq028_desc,oocq029,oocq030,oocq031,oocq032,oocq033,oocq034, 
          oocq035,oocq036,oocq037,oocq038,oocq039,oocq040,oocq041,oocq042,oocq043,oocqownid,oocqowndp, 
          oocqcrtid,oocqcrtdt,oocqcrtdp,oocqmodid,oocqmoddt 
      
         BEFORE CONSTRUCT
            #add-point:cs段more_construct name="cs.before_construct"
            DISPLAY g_argv[1] TO oocq001
            #end add-point 
            
         #應用 a11 樣板自動產生(Version:3)
         #共用欄位查詢處理  
         ##----<<oocqcrtdt>>----
         AFTER FIELD oocqcrtdt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
 
         #----<<oocqmoddt>>----
         AFTER FIELD oocqmoddt
            CALL FGL_DIALOG_GETBUFFER() RETURNING ls_result
            IF NOT cl_null(ls_result) THEN
               IF NOT cl_chk_date_symbol(ls_result) THEN
                  LET ls_result = cl_add_date_extra_cond(ls_result)
               END IF
            END IF
            CALL FGL_DIALOG_SETBUFFER(ls_result)
         
         #----<<oocqcnfdt>>----
         
         #----<<oocqpstdt>>----
 
 
 
 
                  #Ctrlp:construct.c.oocq002
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq002
            #add-point:ON ACTION controlp INFIELD oocq002 name="construct.c.oocq002"
#此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE 
            LET g_qryparam.arg1 = g_argv[1]
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO oocq002  #顯示到畫面上 

            NEXT FIELD oocq002                     #返回原欄位
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq002
            #add-point:BEFORE FIELD oocq002 name="construct.b.oocq002"
            DISPLAY g_argv[1] TO oocq001
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq002
            
            #add-point:AFTER FIELD oocq002 name="construct.a.oocq002"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocql004
            #add-point:BEFORE FIELD oocql004 name="construct.b.oocql004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocql004
            
            #add-point:AFTER FIELD oocql004 name="construct.a.oocql004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocql004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocql004
            #add-point:ON ACTION controlp INFIELD oocql004 name="construct.c.oocql004"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocql005
            #add-point:BEFORE FIELD oocql005 name="construct.b.oocql005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocql005
            
            #add-point:AFTER FIELD oocql005 name="construct.a.oocql005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocql005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocql005
            #add-point:ON ACTION controlp INFIELD oocql005 name="construct.c.oocql005"
            
            #END add-point
 
 
         #Ctrlp:construct.c.oocq003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq003
            #add-point:ON ACTION controlp INFIELD oocq003 name="construct.c.oocq003"
#此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.arg1 = g_argv[1]
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO oocq003  #顯示到畫面上 

            NEXT FIELD oocq003                     #返回原欄位
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq003
            #add-point:BEFORE FIELD oocq003 name="construct.b.oocq003"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq003
            
            #add-point:AFTER FIELD oocq003 name="construct.a.oocq003"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqstus
            #add-point:BEFORE FIELD oocqstus name="construct.b.oocqstus"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocqstus
            
            #add-point:AFTER FIELD oocqstus name="construct.a.oocqstus"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocqstus
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocqstus
            #add-point:ON ACTION controlp INFIELD oocqstus name="construct.c.oocqstus"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq004
            #add-point:BEFORE FIELD oocq004 name="construct.b.oocq004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq004
            
            #add-point:AFTER FIELD oocq004 name="construct.a.oocq004"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq004
            #add-point:ON ACTION controlp INFIELD oocq004 name="construct.c.oocq004"
            CALL aooi300_open_qry('1',g_oocq_m.oocq001,g_oocq_m.oocq004) RETURNING l_return    
            DISPLAY l_return TO oocq004
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq005
            #add-point:BEFORE FIELD oocq005 name="construct.b.oocq005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq005
            
            #add-point:AFTER FIELD oocq005 name="construct.a.oocq005"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq005
            #add-point:ON ACTION controlp INFIELD oocq005 name="construct.c.oocq005"
            CALL aooi300_open_qry('2',g_oocq_m.oocq001,g_oocq_m.oocq005) RETURNING l_return    
            DISPLAY l_return TO oocq005
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq006
            #add-point:BEFORE FIELD oocq006 name="construct.b.oocq006"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq006
            
            #add-point:AFTER FIELD oocq006 name="construct.a.oocq006"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq006
            #add-point:ON ACTION controlp INFIELD oocq006 name="construct.c.oocq006"
            CALL aooi300_open_qry('3',g_oocq_m.oocq001,g_oocq_m.oocq006) RETURNING l_return    
            DISPLAY l_return TO oocq006
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq007
            #add-point:BEFORE FIELD oocq007 name="construct.b.oocq007"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq007
            
            #add-point:AFTER FIELD oocq007 name="construct.a.oocq007"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq007
            #add-point:ON ACTION controlp INFIELD oocq007 name="construct.c.oocq007"
            CALL aooi300_open_qry('4',g_oocq_m.oocq001,g_oocq_m.oocq007) RETURNING l_return    
            DISPLAY l_return TO oocq007
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq008
            #add-point:BEFORE FIELD oocq008 name="construct.b.oocq008"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq008
            
            #add-point:AFTER FIELD oocq008 name="construct.a.oocq008"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq008
            #add-point:ON ACTION controlp INFIELD oocq008 name="construct.c.oocq008"
            CALL aooi300_open_qry('5',g_oocq_m.oocq001,g_oocq_m.oocq008) RETURNING l_return    
            DISPLAY l_return TO oocq008
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq009
            #add-point:BEFORE FIELD oocq009 name="construct.b.oocq009"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq009
            
            #add-point:AFTER FIELD oocq009 name="construct.a.oocq009"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq009
            #add-point:ON ACTION controlp INFIELD oocq009 name="construct.c.oocq009"
            CALL aooi300_open_qry('6',g_oocq_m.oocq001,g_oocq_m.oocq009) RETURNING l_return    
            DISPLAY l_return TO oocq009
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq010
            #add-point:BEFORE FIELD oocq010 name="construct.b.oocq010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq010
            
            #add-point:AFTER FIELD oocq010 name="construct.a.oocq010"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq010
            #add-point:ON ACTION controlp INFIELD oocq010 name="construct.c.oocq010"
            CALL aooi300_open_qry('7',g_oocq_m.oocq001,g_oocq_m.oocq010) RETURNING l_return    
            DISPLAY l_return TO oocq010
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq011
            #add-point:BEFORE FIELD oocq011 name="construct.b.oocq011"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq011
            
            #add-point:AFTER FIELD oocq011 name="construct.a.oocq011"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq011
            #add-point:ON ACTION controlp INFIELD oocq011 name="construct.c.oocq011"
            CALL aooi300_open_qry('8',g_oocq_m.oocq001,g_oocq_m.oocq011) RETURNING l_return    
            DISPLAY l_return TO oocq011
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq012
            #add-point:BEFORE FIELD oocq012 name="construct.b.oocq012"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq012
            
            #add-point:AFTER FIELD oocq012 name="construct.a.oocq012"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq012
            #add-point:ON ACTION controlp INFIELD oocq012 name="construct.c.oocq012"
            CALL aooi300_open_qry('9',g_oocq_m.oocq001,g_oocq_m.oocq012) RETURNING l_return    
            DISPLAY l_return TO oocq012
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq013
            #add-point:BEFORE FIELD oocq013 name="construct.b.oocq013"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq013
            
            #add-point:AFTER FIELD oocq013 name="construct.a.oocq013"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq013
            #add-point:ON ACTION controlp INFIELD oocq013 name="construct.c.oocq013"
            CALL aooi300_open_qry('10',g_oocq_m.oocq001,g_oocq_m.oocq013) RETURNING l_return    
            DISPLAY l_return TO oocq013
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq014
            #add-point:BEFORE FIELD oocq014 name="construct.b.oocq014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq014
            
            #add-point:AFTER FIELD oocq014 name="construct.a.oocq014"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq014
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq014
            #add-point:ON ACTION controlp INFIELD oocq014 name="construct.c.oocq014"
            CALL aooi300_open_qry('11',g_oocq_m.oocq001,g_oocq_m.oocq014) RETURNING l_return    
            DISPLAY l_return TO oocq014
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq015
            #add-point:BEFORE FIELD oocq015 name="construct.b.oocq015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq015
            
            #add-point:AFTER FIELD oocq015 name="construct.a.oocq015"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq015
            #add-point:ON ACTION controlp INFIELD oocq015 name="construct.c.oocq015"
            CALL aooi300_open_qry('12',g_oocq_m.oocq001,g_oocq_m.oocq015) RETURNING l_return    
            DISPLAY l_return TO oocq015
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq016
            #add-point:BEFORE FIELD oocq016 name="construct.b.oocq016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq016
            
            #add-point:AFTER FIELD oocq016 name="construct.a.oocq016"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq016
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq016
            #add-point:ON ACTION controlp INFIELD oocq016 name="construct.c.oocq016"
            CALL aooi300_open_qry('13',g_oocq_m.oocq001,g_oocq_m.oocq016) RETURNING l_return    
            DISPLAY l_return TO oocq016
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq017
            #add-point:BEFORE FIELD oocq017 name="construct.b.oocq017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq017
            
            #add-point:AFTER FIELD oocq017 name="construct.a.oocq017"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq017
            #add-point:ON ACTION controlp INFIELD oocq017 name="construct.c.oocq017"
            CALL aooi300_open_qry('14',g_oocq_m.oocq001,g_oocq_m.oocq017) RETURNING l_return    
            DISPLAY l_return TO oocq017
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq018
            #add-point:BEFORE FIELD oocq018 name="construct.b.oocq018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq018
            
            #add-point:AFTER FIELD oocq018 name="construct.a.oocq018"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq018
            #add-point:ON ACTION controlp INFIELD oocq018 name="construct.c.oocq018"
            CALL aooi300_open_qry('15',g_oocq_m.oocq001,g_oocq_m.oocq018) RETURNING l_return    
            DISPLAY l_return TO oocq018
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq019
            #add-point:BEFORE FIELD oocq019 name="construct.b.oocq019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq019
            
            #add-point:AFTER FIELD oocq019 name="construct.a.oocq019"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq019
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq019
            #add-point:ON ACTION controlp INFIELD oocq019 name="construct.c.oocq019"
            CALL aooi300_open_qry('16',g_oocq_m.oocq001,g_oocq_m.oocq019) RETURNING l_return    
            DISPLAY l_return TO oocq019
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq020
            #add-point:BEFORE FIELD oocq020 name="construct.b.oocq020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq020
            
            #add-point:AFTER FIELD oocq020 name="construct.a.oocq020"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq020
            #add-point:ON ACTION controlp INFIELD oocq020 name="construct.c.oocq020"
            CALL aooi300_open_qry('17',g_oocq_m.oocq001,g_oocq_m.oocq020) RETURNING l_return    
            DISPLAY l_return TO oocq020
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq021
            #add-point:BEFORE FIELD oocq021 name="construct.b.oocq021"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq021
            
            #add-point:AFTER FIELD oocq021 name="construct.a.oocq021"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq021
            #add-point:ON ACTION controlp INFIELD oocq021 name="construct.c.oocq021"
            CALL aooi300_open_qry('18',g_oocq_m.oocq001,g_oocq_m.oocq021) RETURNING l_return    
            DISPLAY l_return TO oocq021
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq022
            #add-point:BEFORE FIELD oocq022 name="construct.b.oocq022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq022
            
            #add-point:AFTER FIELD oocq022 name="construct.a.oocq022"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq022
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq022
            #add-point:ON ACTION controlp INFIELD oocq022 name="construct.c.oocq022"
            CALL aooi300_open_qry('19',g_oocq_m.oocq001,g_oocq_m.oocq022) RETURNING l_return    
            DISPLAY l_return TO oocq022
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq023
            #add-point:BEFORE FIELD oocq023 name="construct.b.oocq023"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq023
            
            #add-point:AFTER FIELD oocq023 name="construct.a.oocq023"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq023
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq023
            #add-point:ON ACTION controlp INFIELD oocq023 name="construct.c.oocq023"
            CALL aooi300_open_qry('20',g_oocq_m.oocq001,g_oocq_m.oocq023) RETURNING l_return    
            DISPLAY l_return TO oocq023
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq024
            #add-point:BEFORE FIELD oocq024 name="construct.b.oocq024"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq024
            
            #add-point:AFTER FIELD oocq024 name="construct.a.oocq024"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq024
            #add-point:ON ACTION controlp INFIELD oocq024 name="construct.c.oocq024"
            CALL aooi300_open_qry2('1',g_oocq_m.oocq001,g_oocq_m.oocq024) RETURNING l_return    
            DISPLAY l_return TO oocq024
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq024_desc
            #add-point:BEFORE FIELD oocq024_desc name="construct.b.oocq024_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq024_desc
            
            #add-point:AFTER FIELD oocq024_desc name="construct.a.oocq024_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq024_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq024_desc
            #add-point:ON ACTION controlp INFIELD oocq024_desc name="construct.c.oocq024_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq025
            #add-point:BEFORE FIELD oocq025 name="construct.b.oocq025"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq025
            
            #add-point:AFTER FIELD oocq025 name="construct.a.oocq025"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq025
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq025
            #add-point:ON ACTION controlp INFIELD oocq025 name="construct.c.oocq025"
            CALL aooi300_open_qry2('2',g_oocq_m.oocq001,g_oocq_m.oocq025) RETURNING l_return    
            DISPLAY l_return TO oocq025
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq025_desc
            #add-point:BEFORE FIELD oocq025_desc name="construct.b.oocq025_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq025_desc
            
            #add-point:AFTER FIELD oocq025_desc name="construct.a.oocq025_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq025_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq025_desc
            #add-point:ON ACTION controlp INFIELD oocq025_desc name="construct.c.oocq025_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq026
            #add-point:BEFORE FIELD oocq026 name="construct.b.oocq026"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq026
            
            #add-point:AFTER FIELD oocq026 name="construct.a.oocq026"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq026
            #add-point:ON ACTION controlp INFIELD oocq026 name="construct.c.oocq026"
            CALL aooi300_open_qry2('3',g_oocq_m.oocq001,g_oocq_m.oocq026) RETURNING l_return    
            DISPLAY l_return TO oocq026
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq026_desc
            #add-point:BEFORE FIELD oocq026_desc name="construct.b.oocq026_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq026_desc
            
            #add-point:AFTER FIELD oocq026_desc name="construct.a.oocq026_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq026_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq026_desc
            #add-point:ON ACTION controlp INFIELD oocq026_desc name="construct.c.oocq026_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq027
            #add-point:BEFORE FIELD oocq027 name="construct.b.oocq027"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq027
            
            #add-point:AFTER FIELD oocq027 name="construct.a.oocq027"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq027
            #add-point:ON ACTION controlp INFIELD oocq027 name="construct.c.oocq027"
            CALL aooi300_open_qry2('4',g_oocq_m.oocq001,g_oocq_m.oocq027) RETURNING l_return    
            DISPLAY l_return TO oocq027
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq027_desc
            #add-point:BEFORE FIELD oocq027_desc name="construct.b.oocq027_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq027_desc
            
            #add-point:AFTER FIELD oocq027_desc name="construct.a.oocq027_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq027_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq027_desc
            #add-point:ON ACTION controlp INFIELD oocq027_desc name="construct.c.oocq027_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq028
            #add-point:BEFORE FIELD oocq028 name="construct.b.oocq028"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq028
            
            #add-point:AFTER FIELD oocq028 name="construct.a.oocq028"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq028
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq028
            #add-point:ON ACTION controlp INFIELD oocq028 name="construct.c.oocq028"
            CALL aooi300_open_qry2('5',g_oocq_m.oocq001,g_oocq_m.oocq028) RETURNING l_return    
            DISPLAY l_return TO oocq028
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq028_desc
            #add-point:BEFORE FIELD oocq028_desc name="construct.b.oocq028_desc"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq028_desc
            
            #add-point:AFTER FIELD oocq028_desc name="construct.a.oocq028_desc"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq028_desc
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq028_desc
            #add-point:ON ACTION controlp INFIELD oocq028_desc name="construct.c.oocq028_desc"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq029
            #add-point:BEFORE FIELD oocq029 name="construct.b.oocq029"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq029
            
            #add-point:AFTER FIELD oocq029 name="construct.a.oocq029"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq029
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq029
            #add-point:ON ACTION controlp INFIELD oocq029 name="construct.c.oocq029"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq030
            #add-point:BEFORE FIELD oocq030 name="construct.b.oocq030"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq030
            
            #add-point:AFTER FIELD oocq030 name="construct.a.oocq030"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq030
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq030
            #add-point:ON ACTION controlp INFIELD oocq030 name="construct.c.oocq030"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq031
            #add-point:BEFORE FIELD oocq031 name="construct.b.oocq031"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq031
            
            #add-point:AFTER FIELD oocq031 name="construct.a.oocq031"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq031
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq031
            #add-point:ON ACTION controlp INFIELD oocq031 name="construct.c.oocq031"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq032
            #add-point:BEFORE FIELD oocq032 name="construct.b.oocq032"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq032
            
            #add-point:AFTER FIELD oocq032 name="construct.a.oocq032"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq032
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq032
            #add-point:ON ACTION controlp INFIELD oocq032 name="construct.c.oocq032"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq033
            #add-point:BEFORE FIELD oocq033 name="construct.b.oocq033"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq033
            
            #add-point:AFTER FIELD oocq033 name="construct.a.oocq033"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq033
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq033
            #add-point:ON ACTION controlp INFIELD oocq033 name="construct.c.oocq033"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq034
            #add-point:BEFORE FIELD oocq034 name="construct.b.oocq034"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq034
            
            #add-point:AFTER FIELD oocq034 name="construct.a.oocq034"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq034
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq034
            #add-point:ON ACTION controlp INFIELD oocq034 name="construct.c.oocq034"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq035
            #add-point:BEFORE FIELD oocq035 name="construct.b.oocq035"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq035
            
            #add-point:AFTER FIELD oocq035 name="construct.a.oocq035"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq035
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq035
            #add-point:ON ACTION controlp INFIELD oocq035 name="construct.c.oocq035"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq036
            #add-point:BEFORE FIELD oocq036 name="construct.b.oocq036"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq036
            
            #add-point:AFTER FIELD oocq036 name="construct.a.oocq036"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq036
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq036
            #add-point:ON ACTION controlp INFIELD oocq036 name="construct.c.oocq036"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq037
            #add-point:BEFORE FIELD oocq037 name="construct.b.oocq037"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq037
            
            #add-point:AFTER FIELD oocq037 name="construct.a.oocq037"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq037
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq037
            #add-point:ON ACTION controlp INFIELD oocq037 name="construct.c.oocq037"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq038
            #add-point:BEFORE FIELD oocq038 name="construct.b.oocq038"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq038
            
            #add-point:AFTER FIELD oocq038 name="construct.a.oocq038"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq038
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq038
            #add-point:ON ACTION controlp INFIELD oocq038 name="construct.c.oocq038"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq039
            #add-point:BEFORE FIELD oocq039 name="construct.b.oocq039"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq039
            
            #add-point:AFTER FIELD oocq039 name="construct.a.oocq039"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq039
            #add-point:ON ACTION controlp INFIELD oocq039 name="construct.c.oocq039"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq040
            #add-point:BEFORE FIELD oocq040 name="construct.b.oocq040"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq040
            
            #add-point:AFTER FIELD oocq040 name="construct.a.oocq040"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq040
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq040
            #add-point:ON ACTION controlp INFIELD oocq040 name="construct.c.oocq040"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq041
            #add-point:BEFORE FIELD oocq041 name="construct.b.oocq041"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq041
            
            #add-point:AFTER FIELD oocq041 name="construct.a.oocq041"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq041
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq041
            #add-point:ON ACTION controlp INFIELD oocq041 name="construct.c.oocq041"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq042
            #add-point:BEFORE FIELD oocq042 name="construct.b.oocq042"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq042
            
            #add-point:AFTER FIELD oocq042 name="construct.a.oocq042"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq042
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq042
            #add-point:ON ACTION controlp INFIELD oocq042 name="construct.c.oocq042"
            
            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq043
            #add-point:BEFORE FIELD oocq043 name="construct.b.oocq043"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq043
            
            #add-point:AFTER FIELD oocq043 name="construct.a.oocq043"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocq043
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq043
            #add-point:ON ACTION controlp INFIELD oocq043 name="construct.c.oocq043"
            
            #END add-point
 
 
         #Ctrlp:construct.c.oocqownid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocqownid
            #add-point:ON ACTION controlp INFIELD oocqownid name="construct.c.oocqownid"
            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO oocqownid  #顯示到畫面上

            NEXT FIELD oocqownid                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqownid
            #add-point:BEFORE FIELD oocqownid name="construct.b.oocqownid"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocqownid
            
            #add-point:AFTER FIELD oocqownid name="construct.a.oocqownid"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocqowndp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocqowndp
            #add-point:ON ACTION controlp INFIELD oocqowndp name="construct.c.oocqowndp"
            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO oocqowndp  #顯示到畫面上

            NEXT FIELD oocqowndp                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqowndp
            #add-point:BEFORE FIELD oocqowndp name="construct.b.oocqowndp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocqowndp
            
            #add-point:AFTER FIELD oocqowndp name="construct.a.oocqowndp"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocqcrtid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocqcrtid
            #add-point:ON ACTION controlp INFIELD oocqcrtid name="construct.c.oocqcrtid"
            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO oocqcrtid  #顯示到畫面上

            NEXT FIELD oocqcrtid                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqcrtid
            #add-point:BEFORE FIELD oocqcrtid name="construct.b.oocqcrtid"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocqcrtid
            
            #add-point:AFTER FIELD oocqcrtid name="construct.a.oocqcrtid"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqcrtdt
            #add-point:BEFORE FIELD oocqcrtdt name="construct.b.oocqcrtdt"
            
            #END add-point
 
 
         #Ctrlp:construct.c.oocqcrtdp
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocqcrtdp
            #add-point:ON ACTION controlp INFIELD oocqcrtdp name="construct.c.oocqcrtdp"
            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooeg001_9()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO oocqcrtdp  #顯示到畫面上

            NEXT FIELD oocqcrtdp                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqcrtdp
            #add-point:BEFORE FIELD oocqcrtdp name="construct.b.oocqcrtdp"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocqcrtdp
            
            #add-point:AFTER FIELD oocqcrtdp name="construct.a.oocqcrtdp"
            
            #END add-point
            
 
 
         #Ctrlp:construct.c.oocqmodid
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocqmodid
            #add-point:ON ACTION controlp INFIELD oocqmodid name="construct.c.oocqmodid"
            #此段落由子樣板a08產生
            #開窗c段
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO oocqmodid  #顯示到畫面上

            NEXT FIELD oocqmodid                     #返回原欄位


            #END add-point
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqmodid
            #add-point:BEFORE FIELD oocqmodid name="construct.b.oocqmodid"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocqmodid
            
            #add-point:AFTER FIELD oocqmodid name="construct.a.oocqmodid"
            
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqmoddt
            #add-point:BEFORE FIELD oocqmoddt name="construct.b.oocqmoddt"
            
            #END add-point
 
 
 
       
      END CONSTRUCT
  
      #add-point:cs段more_construct name="cs.more_construct"
 
      #end add-point
         
      BEFORE DIALOG
         CALL cl_qbe_init()
         #add-point:cs段before dialog name="cs.before_dialog"
         
         #end add-point
      
      ON ACTION qbe_select     #條件查詢
         CALL cl_qbe_list('m') RETURNING ls_wc
      
      ON ACTION qbe_save       #條件儲存
         CALL cl_qbe_save()
 
      ON ACTION accept
         ACCEPT DIALOG
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl"
      CONTINUE DIALOG
 
   END DIALOG
 
   #add-point:cs段after_construct name="cs.after_construct"
 
   #end add-point
   
   IF INT_FLAG THEN
      RETURN
   END IF
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.query" >}
#+ 資料查詢QBE功能準備
PRIVATE FUNCTION aooi300_query()
   #add-point:query段define name="query.define_customerization"
   
   #end add-point
   DEFINE ls_wc STRING
   #add-point:query段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="query.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="query.before_query"
   LET g_chk = FALSE #151221-00018#2-add
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
   
   LET INT_FLAG = 0
   LET ls_wc = g_wc
 
   #CLEAR FORM
   #CALL g_browser.clear()
 
   DISPLAY " " TO FORMONLY.h_count
 
   CALL aooi300_construct()
 
   IF INT_FLAG THEN
      #取消查詢
      LET INT_FLAG = 0
      #LET g_wc = ls_wc
      LET g_wc = " 1=2"
      #add-point:query段取消 name="query.cancel"
      
      #end add-point
      #CALL aooi300_browser_fill(g_wc,g_searchtype)
      CALL aooi300_fetch("")
      RETURN
   ELSE
      LET g_current_row = 1
      LET g_browser_cnt = 0
      LET g_current_idx = 1
      CALL g_browser.clear()
      LET g_first = 0  #設定重新查詢資料後顯示
   END IF
 
   LET g_searchtype = "3"
   LET g_searchcol = "0"
   CALL aooi300_browser_fill(g_wc,g_searchtype)
   
   IF g_browser_cnt > 0 THEN
      CALL aooi300_fetch("")
   ELSE
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "-100" 
      LET g_errparam.popup = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #第一層模糊搜尋
   #IF g_browser_cnt = 0 THEN
   #   LET g_wc = cl_wc_parser(g_wc)
   #   CALL aooi300_browser_fill(g_wc,g_searchtype)
   #END IF
   
   #第二層速記碼搜尋
   #IF g_browser_cnt = 0 THEN
   #   INITIALIZE g_errparam TO NULL 
   #   LET g_errparam.extend = "" 
   #   LET g_errparam.code = "-100" 
   #   LET g_errparam.popup = TRUE 
   #   CALL cl_err()
   #END IF
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.fetch" >}
#+ 指定PK後抓取單頭其他資料
PRIVATE FUNCTION aooi300_fetch(p_flag)
   #add-point:fetch段define name="fetch.define_customerization"
   
   #end add-point
   DEFINE p_flag     LIKE type_t.chr1
   DEFINE ls_msg     STRING
   DEFINE ls_chk     STRING
   DEFINE li_idx     LIKE type_t.num10
   #add-point:fetch段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="fetch.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="fetch.befroe_fetch"
   
   #end add-point 
 
   LET ls_chk = g_browser[g_current_idx].b_id 
   IF ls_chk.getIndexOf(".",1) = 0 THEN
      INITIALIZE g_oocq_m.* TO NULL
      DISPLAY BY NAME g_oocq_m.*
      CALL cl_set_act_visible("statechange,modify,delete,reproduce", FALSE)
   #   DISPLAY "" TO FORMONLY.h_index
      RETURN
   END IF
 
   #瀏覽頁筆數顯示
   LET li_idx = 1
   FOR li_idx = 1 TO g_browser_root.getLength()
      IF g_browser_root[li_idx] > g_current_idx THEN
       EXIT FOR
      END IF
   END FOR
   LET li_idx = g_current_idx - li_idx + 1
   #DISPLAY li_idx TO FORMONLY.h_index   #當下筆數
 
   IF p_flag = "/" THEN
      IF (NOT g_no_ask) THEN      
         CALL cl_getmsg("fetch",g_lang) RETURNING ls_msg
         LET INT_FLAG = 0
 
         PROMPT ls_msg CLIPPED,": " FOR g_jump
            #交談指令共用ACTION
            &include "common_action.4gl" 
         END PROMPT
 
         IF INT_FLAG THEN
            LET INT_FLAG = 0
         ELSE
            IF g_jump > 0 AND g_jump <= g_browser.getLength() THEN
               LET g_current_idx = g_jump
            END IF
            LET g_no_ask = FALSE  
         END IF           
      END IF
   END IF    
   
   #若無資料則離開
   IF g_current_idx = 0 THEN
      RETURN
   END IF
 
   LET g_oocq_m.oocq002 = g_browser[g_current_idx].b_oocq002
   LET g_oocq_m.oocq003 = g_browser[g_current_idx].b_oocq003
   LET g_oocq_m.oocq001 = g_browser[g_current_idx].b_oocq001
    
   #add-point:fetch段refresh前 name="fetch.before_refresh"
   
   #end add-point
    
   #重讀DB,因TEMP有不被更新特性
   EXECUTE aooi300_master_referesh USING g_oocq_m.oocq001,g_oocq_m.oocq002 INTO g_oocq_m.oocq001,g_oocq_m.oocq002, 
       g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007, 
       g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013, 
       g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019, 
       g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025, 
       g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031, 
       g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037, 
       g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043, 
       g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp, 
       g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt,g_oocq_m.oocq001_desc,g_oocq_m.oocq003_desc,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid_desc  
 
   
   IF SQLCA.SQLCODE THEN
       INITIALIZE g_errparam TO NULL 
       LET g_errparam.extend = "oocq_t:",SQLERRMESSAGE 
       LET g_errparam.code = SQLCA.SQLCODE 
       LET g_errparam.popup = TRUE 
       CALL cl_err()
       INITIALIZE g_oocq_m.* TO NULL
       RETURN
   END IF
   
   #若無資料則關閉相關功能
   IF g_browser.getLength() = 0 THEN
      CALL cl_set_act_visible("statechange,modify,delete,reproduce", FALSE)
   ELSE
      CALL cl_set_act_visible("statechange,modify,delete,reproduce", TRUE)
   END IF
   
   #add-point:fetch段after_fetch name="fetch.after_fetch"
   
   #end add-point
 
   
   
   #保存單頭舊值
   LET g_oocq_m_t.* = g_oocq_m.*
   LET g_oocq_m_o.* = g_oocq_m.*
   
   #重新顯示
   CALL aooi300_show()
   CALL cl_navigator_setting(g_current_idx, g_browser_cnt)
   DISPLAY g_browser.getLength() TO FORMONLY.h_count 
 
   
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.insert" >}
#+ 資料新增
PRIVATE FUNCTION aooi300_insert(l_dialog)
   #add-point:insert段define name="insert.define_customerization"
   
   #end add-point
   DEFINE l_dialog   ui.DIALOG
   DEFINE li_addpos  LIKE type_t.num10 #新增節點時產出的畫面實際位置
   DEFINE li_idx     LIKE type_t.num10
   DEFINE li_cnt     LIKE type_t.num10
   #add-point:insert段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="insert.define"
   DEFINE l_gzaa003 LIKE gzaa_t.gzaa003
   #end add-point
   
   #add-point:Function前置處理  name="insert.pre_function"
   
   #end add-point
   
   LET g_oocq001_t = g_oocq_m.oocq001
   LET g_oocq002_t = g_oocq_m.oocq002
 
   LET g_oocq002_t = g_oocq_m.oocq002
   LET g_oocq001_t = g_oocq_m.oocq001
 
   #清畫面欄位內容
   CLEAR g_oocq_m.*
 
 
   #add-point:單頭預設值 name="insert.before_insert"
   
   #end add-point 
 
   INITIALIZE g_oocq_m.* LIKE oocq_t.*
   DISPLAY BY NAME g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
       g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
       g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
       g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
       g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
       g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
       g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
       g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
       g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdt, 
       g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc,g_oocq_m.oocqmoddt 
 
   CALL s_transaction_begin()
 
   #其他table資料備份(確定是否更改用)
   LET g_master_multi_table_t.oocql001 = g_oocq_m.oocq001
LET g_master_multi_table_t.oocql002 = g_oocq_m.oocq002
LET g_master_multi_table_t.oocql004 = g_oocq_m.oocql004
LET g_master_multi_table_t.oocql005 = g_oocq_m.oocql005
 
 
   WHILE TRUE
      #給予pid,type預設值
      LET g_oocq_m.oocq003 = g_oocq002_t
      LET g_oocq_m.oocq001 = g_oocq001_t
      #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_oocq_m.oocqownid = g_user
      LET g_oocq_m.oocqowndp = g_dept
      LET g_oocq_m.oocqcrtid = g_user
      LET g_oocq_m.oocqcrtdp = g_dept 
      LET g_oocq_m.oocqcrtdt = cl_get_current()
      LET g_oocq_m.oocqmodid = g_user
      LET g_oocq_m.oocqmoddt = cl_get_current()
      LET g_oocq_m.oocqstus = 'Y'
 
 
 
      
      CALL gfrm_curr.setElementImage("statechange", "authstatus/valid.png")
  
      
      
      #單頭預設值
      
     
      #add-point:單頭預設值 name="insert.default"
      LET g_oocq_m.oocqstus = "Y" 
      LET g_oocq_m.oocq001 = g_oocq001_p 
      CALL aooi300_oocq001_ref()
      SELECT gzaa003 INTO l_gzaa003 FROM gzaa_t
       WHERE gzaa001 = g_oocq001_p
      IF l_gzaa003 = 'Y' THEN 
         IF g_current_idx = 0 THEN
            LET g_oocq_m.oocq003 = g_oocq001_p
         ELSE
            IF cl_null(g_browser[g_current_idx].b_oocq002) THEN
               LET g_oocq_m.oocq003 = g_oocq001_p
            ELSE
               LET g_oocq_m.oocq003 = g_browser[g_current_idx].b_oocq002
            END IF 
         END IF 
      ELSE
         LET g_oocq_m.oocq003 = g_oocq001_p
      END IF 
      CALL aooi300_def_oocq_t(g_oocq001_p)
      CALL aooi300_oocq003_ref()
      #end add-point 
 
      CALL aooi300_input("a")
      
      #add-point:單頭輸入後 name="insert.after_insert"
      
      #end add-point
      
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_oocq_m.* = g_oocq_m_t.*
         CALL aooi300_show()
         INITIALIZE g_errparam TO NULL
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code = 9001 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
         EXIT WHILE
      ELSE
         #分兩種狀況-1.根節點, 2.非根節點
         IF g_oocq_m.oocq003 = g_oocq_m.oocq002 THEN
            #為根節點
            LET li_addpos = g_browser.getLength() + 1
            LET g_browser[li_addpos].b_oocq003 = g_oocq_m.oocq003
            LET g_browser[li_addpos].b_oocq002 = g_oocq_m.oocq002
            LET g_browser[li_addpos].b_exp  = FALSE
            LET g_browser[li_addpos].b_hasC = FALSE
            LET g_browser[li_addpos].b_id  = '0.add',g_add_idx USING "<<<"
            LET g_browser[li_addpos].b_pid = '0',g_add_idx USING "<<<"
            LET g_add_idx = g_add_idx + 1
            CALL aooi300_desc_show(li_addpos)
            LET g_current_idx = li_addpos
         ELSE
            #非根節點, 開始搜尋其父節點(已展開才做處理)
            LET li_cnt = g_cnt
            IF g_browser.getLength() > 0 THEN
               FOR li_idx = 1 TO g_browser.getLength()
                  IF g_browser[li_idx].b_oocq002 = g_oocq_m.oocq003 THEN
                     LET li_addpos = l_dialog.appendNode("s_browse",li_idx)
                     LET g_cnt = li_addpos
                     LET g_browser[li_addpos].b_oocq003 = g_oocq_m.oocq003
                     LET g_browser[li_addpos].b_oocq002 = g_oocq_m.oocq002
                     EXECUTE master_refreshcur USING g_browser[li_addpos].b_oocq001
                                                     ,g_browser[li_addpos].b_oocq002
 
                                                INTO g_browser[g_cnt].b_oocq001,g_browser[g_cnt].b_oocq003, 
                                                    g_browser[g_cnt].b_oocq002,g_browser[g_cnt].b_oocqstus, 
                                                    g_browser[g_cnt].b_oocq004,g_browser[g_cnt].b_oocq005, 
                                                    g_browser[g_cnt].b_oocq006,g_browser[g_cnt].b_oocq007, 
                                                    g_browser[g_cnt].b_oocq008,g_browser[g_cnt].b_oocq009, 
                                                    g_browser[g_cnt].b_oocq010,g_browser[g_cnt].b_oocq011, 
                                                    g_browser[g_cnt].b_oocq012,g_browser[g_cnt].b_oocq013, 
                                                    g_browser[g_cnt].b_oocq014,g_browser[g_cnt].b_oocq015, 
                                                    g_browser[g_cnt].b_oocq016,g_browser[g_cnt].b_oocq017, 
                                                    g_browser[g_cnt].b_oocq018,g_browser[g_cnt].b_oocq019, 
                                                    g_browser[g_cnt].b_oocq020,g_browser[g_cnt].b_oocq021, 
                                                    g_browser[g_cnt].b_oocq022,g_browser[g_cnt].b_oocq023, 
                                                    g_browser[g_cnt].b_oocq024,g_browser[g_cnt].b_oocq025, 
                                                    g_browser[g_cnt].b_oocq026,g_browser[g_cnt].b_oocq027, 
                                                    g_browser[g_cnt].b_oocq028,g_browser[g_cnt].b_oocq029, 
                                                    g_browser[g_cnt].b_oocq030,g_browser[g_cnt].b_oocq031, 
                                                    g_browser[g_cnt].b_oocq032,g_browser[g_cnt].b_oocq033, 
                                                    g_browser[g_cnt].b_oocq034,g_browser[g_cnt].b_oocq035, 
                                                    g_browser[g_cnt].b_oocq036,g_browser[g_cnt].b_oocq037, 
                                                    g_browser[g_cnt].b_oocq038,g_browser[g_cnt].b_oocq039, 
                                                    g_browser[g_cnt].b_oocq040,g_browser[g_cnt].b_oocq041, 
                                                    g_browser[g_cnt].b_oocq042,g_browser[g_cnt].b_oocq043 
 
                     LET g_browser[li_addpos].b_exp  = FALSE
                     LET g_browser[li_addpos].b_hasC = FALSE
                     LET g_browser[li_addpos].b_id  = g_browser[li_idx].b_id, '.add',g_add_idx USING "<<<"
                     LET g_browser[li_addpos].b_pid = g_browser[li_idx].b_id
                     LET g_add_idx = g_add_idx + 1
                     CALL aooi300_desc_show(li_addpos)
                     #打開父節點
                     LET g_browser[li_idx].b_hasC = TRUE
                     LET g_browser[li_idx].b_exp = TRUE
                     LET g_current_idx = li_addpos
                     EXIT FOR
                  END IF
               END FOR
            END IF
            LET g_cnt = li_cnt
         END IF
      END IF
      
      LET g_rec_b = 0
      EXIT WHILE
   END WHILE
   
   #撈取異動後的資料(主要是帶出reference)
   EXECUTE aooi300_master_referesh USING g_oocq_m.oocq001,g_oocq_m.oocq002 INTO g_oocq_m.oocq001,g_oocq_m.oocq002, 
       g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007, 
       g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013, 
       g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019, 
       g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025, 
       g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031, 
       g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037, 
       g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043, 
       g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp, 
       g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt,g_oocq_m.oocq001_desc,g_oocq_m.oocq003_desc,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid_desc 
 
   
   #將資料顯示到畫面上
   DISPLAY BY NAME g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
       g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
       g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
       g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
       g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
       g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
       g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
       g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
       g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdt, 
       g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc,g_oocq_m.oocqmoddt 
 
   
   #功能已完成,通報訊息中心
   CALL aooi300_msgcentre_notify('insert')
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.modify" >}
#+ 資料修改
PRIVATE FUNCTION aooi300_modify()
   #add-point:modify段define name="modify.define_customerization"
   
   #end add-point
   #add-point:modify段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="modify.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="modify.pre_function"
   
   #end add-point
   
   IF g_oocq_m.oocq001 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF 
   
   EXECUTE aooi300_master_referesh USING g_oocq_m.oocq001,g_oocq_m.oocq002 INTO g_oocq_m.oocq001,g_oocq_m.oocq002, 
       g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007, 
       g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013, 
       g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019, 
       g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025, 
       g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031, 
       g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037, 
       g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043, 
       g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp, 
       g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt,g_oocq_m.oocq001_desc,g_oocq_m.oocq003_desc,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid_desc 
 
 
   #檢查是否允許此動作
   IF NOT aooi300_action_chk() THEN
      RETURN
   END IF
  
   LET g_oocq001_t = g_oocq_m.oocq001
   LET g_oocq002_t = g_oocq_m.oocq002
 
   
   CALL s_transaction_begin()
   
   OPEN aooi300_cl USING g_enterprise,g_oocq_m.oocq001,g_oocq_m.oocq002
   IF SQLCA.SQLCODE THEN   #(ver:36)
      CLOSE aooi300_cl
      CALL s_transaction_end("N","0")
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN aooi300_cl:" 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:36)
      LET g_errparam.popup = TRUE 
      CALL cl_err()
      RETURN
   END IF
 
   #鎖住將被更改或取消的資料
   FETCH aooi300_cl INTO g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
       g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
       g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
       g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
       g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
       g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
       g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
       g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
       g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdt, 
       g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc,g_oocq_m.oocqmoddt 
 
 
   #資料被他人LOCK, 或是sql執行時出現錯誤
   IF SQLCA.SQLCODE THEN
      CLOSE aooi300_cl
      CALL s_transaction_end("N","0")
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_oocq_m.oocq002,":",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
   #其他table資料備份(確定是否更改用)
   LET g_master_multi_table_t.oocql001 = g_oocq_m.oocq001
LET g_master_multi_table_t.oocql002 = g_oocq_m.oocq002
LET g_master_multi_table_t.oocql004 = g_oocq_m.oocql004
LET g_master_multi_table_t.oocql005 = g_oocq_m.oocql005
 
 
   CALL aooi300_show()
   WHILE TRUE
      LET g_oocq_m.oocq001 = g_oocq001_t
      LET g_oocq_m.oocq002 = g_oocq002_t
 
      
      #寫入修改者/修改日期資訊
      LET g_oocq_m.oocqmodid = g_user 
LET g_oocq_m.oocqmoddt = cl_get_current()
LET g_oocq_m.oocqmodid_desc = cl_get_username(g_oocq_m.oocqmodid)
 
      #add-point:modify段修改前 name="modify.before_input"
      
      #end add-point
      
      CALL aooi300_input("u")     #欄位更改
 
      #add-point:modify段修改後 name="modify.after_input"
      
      #end add-point
      
      IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_oocq_m.* = g_oocq_m_t.*
         CALL aooi300_show()
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code = 9001 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
 
         EXIT WHILE
      END IF
 
      #若有modid跟moddt則進行update
      UPDATE oocq_t SET (oocqmodid,oocqmoddt) = (g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt)
       WHERE oocqent = g_enterprise AND oocq001 = g_oocq001_t
         AND oocq002 = g_oocq002_t
 
      
      EXIT WHILE
  
   END WHILE
 
   CLOSE aooi300_cl
   CALL s_transaction_end("Y","0")
 
   #功能已完成,通報訊息中心
   CALL aooi300_msgcentre_notify('modify')
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.check" >}
#+ 避免資料錯誤
PRIVATE FUNCTION aooi300_check(ps_id,ps_pid ,ps_type)
   #add-point:check段define name="check.define_customerization"
   
   #end add-point
   DEFINE ps_id       STRING
   DEFINE ps_pid      STRING
   DEFINE ps_type     STRING
   DEFINE ls_pid      LIKE type_t.chr100
   DEFINE ls_id       LIKE type_t.chr100
   DEFINE ls_type     LIKE type_t.chr100
   DEFINE ls_return   LIKE type_t.num5
   DEFINE ls_sql      STRING
   DEFINE li_cnt      LIKE type_t.num10
   #add-point:check段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="check.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="check.pre_function"
   
   #end add-point
   
   #從該節點往上檢查, 若出現ID重複的狀況代表會導致無限迴圈
   LET ls_sql = " SELECT oocq002,oocq003 FROM ",
                " (SELECT oocq002,oocq003 FROM oocq_t WHERE oocqent = " ||g_enterprise|| " AND oocq002<>oocq003)", 
 
                " WHERE oocq002 = '",ps_id,"' OR oocq003 = '",ps_id,"'",
                " START WITH oocq002='",ps_pid,"'",
                " CONNECT BY PRIOR oocq003=oocq002 "
 
   PREPARE check_cnt FROM ls_sql
   DECLARE check_cntcur CURSOR FOR check_cnt
   OPEN check_cntcur
   IF SQLCA.SQLCODE THEN   #(ver:36)
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN check_cntcur:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:36)
      LET g_errparam.popup = TRUE 
      CALL cl_err()
      RETURN FALSE
   END IF
 
   FETCH check_cntcur INTO li_cnt
 
   IF li_cnt > 0 THEN
      LET ls_return = TRUE
   ELSE
      LET ls_return = FALSE
   END IF
   
   RETURN ls_return 
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.reproduce" >}
#+ 資料複製
PRIVATE FUNCTION aooi300_reproduce(l_dialog)
   #add-point:reproduce段define name="reproduce.define_customerization"
   
   #end add-point   
   DEFINE l_dialog      ui.DIALOG
   DEFINE li_addpos     LIKE type_t.num10
   DEFINE l_newno           LIKE oocq_t.oocq001 
   DEFINE l_oldno           LIKE oocq_t.oocq001 
   DEFINE l_newno02     LIKE oocq_t.oocq002 
   DEFINE l_oldno02     LIKE oocq_t.oocq002 
 
   DEFINE l_master          RECORD LIKE oocq_t.*
   DEFINE l_cnt             LIKE type_t.num10  
   DEFINE li_idx            LIKE type_t.num10  
   DEFINE li_cnt            LIKE type_t.num10  
   #add-point:reproduce段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="reproduce.define"
   #DEFINE l_oocql      RECORD LIKE oocql_t.*  #161124-00048#7   2016/12/13 By 08734 mark
   #161124-00048#7   2016/12/13 By 08734 add(S)
   DEFINE l_oocql RECORD  #應用分類碼多語言檔
       oocqlent LIKE oocql_t.oocqlent, #企业编号
       oocql001 LIKE oocql_t.oocql001, #应用分类
       oocql002 LIKE oocql_t.oocql002, #应用分类码
       oocql003 LIKE oocql_t.oocql003, #语言别
       oocql004 LIKE oocql_t.oocql004, #说明
       oocql005 LIKE oocql_t.oocql005 #助记码
END RECORD
#161124-00048#7   2016/12/13 By 08734 add(E)
   #end add-point
   
   #add-point:Function前置處理  name="reproduce.before_reproduce"
   
   #end add-point
 
   #檢查PK欄位是否均有值,若全部為NULL時退出
   IF g_oocq_m.oocq001 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF 
 
   EXECUTE aooi300_master_referesh USING g_oocq_m.oocq001,g_oocq_m.oocq002 INTO g_oocq_m.oocq001,g_oocq_m.oocq002, 
       g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007, 
       g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013, 
       g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019, 
       g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025, 
       g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031, 
       g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037, 
       g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043, 
       g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp, 
       g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt,g_oocq_m.oocq001_desc,g_oocq_m.oocq003_desc,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid_desc 
 
 
   #檢查如果有子節點(hasC=1)則顯示錯誤訊息後退出
 
   ERROR ""
 
   CALL cl_set_head_visible("","YES")
 
      LET g_oocq_m.oocq001_desc = ''
   DISPLAY BY NAME g_oocq_m.oocq001_desc
 
 
   LET g_oocq_m.oocq001 = ""
   LET g_oocq_m.oocq002 = ""
 
   #應用 a14 樣板自動產生(Version:5)    
      #公用欄位新增給值  
      LET g_oocq_m.oocqownid = g_user
      LET g_oocq_m.oocqowndp = g_dept
      LET g_oocq_m.oocqcrtid = g_user
      LET g_oocq_m.oocqcrtdp = g_dept 
      LET g_oocq_m.oocqcrtdt = cl_get_current()
      LET g_oocq_m.oocqmodid = g_user
      LET g_oocq_m.oocqmoddt = cl_get_current()
      LET g_oocq_m.oocqstus = 'Y'
 
 
 
   
   CALL s_transaction_begin()
   
   #其他table資料備份(確定是否更改用)
   LET g_master_multi_table_t.oocql001 = g_oocq_m.oocq001
LET g_master_multi_table_t.oocql002 = g_oocq_m.oocq002
LET g_master_multi_table_t.oocql004 = g_oocq_m.oocql004
LET g_master_multi_table_t.oocql005 = g_oocq_m.oocql005
 
 
   #add-point:複製輸入前 name="reproduce.head.b_input"
   LET g_oocq_m.oocq001 = g_oocq001_p
   #end add-point
   
   #直接呼叫輸入
   CALL aooi300_input("r")
 
   #add-point:完成複製段落後 name="reproduce.after_reproduce"
   
   #end add-point
 
   IF INT_FLAG THEN
         LET INT_FLAG = 0
         LET g_oocq_m.* = g_oocq_m_t.*
         CALL aooi300_show()
         INITIALIZE g_errparam TO NULL
         INITIALIZE g_errparam TO NULL 
         LET g_errparam.extend = "" 
         LET g_errparam.code = 9001 
         LET g_errparam.popup = FALSE 
         CALL cl_err()
      ELSE
         #分兩種狀況-1.根節點, 2.非根節點
         IF g_oocq_m.oocq003 = g_oocq_m.oocq002 THEN
            #為根節點
            LET li_addpos = g_browser.getLength() + 1
            LET g_browser[li_addpos].b_oocq003 = g_oocq_m.oocq003
            LET g_browser[li_addpos].b_oocq002 = g_oocq_m.oocq002
            LET g_browser[li_addpos].b_exp  = FALSE
            LET g_browser[li_addpos].b_hasC = FALSE
            LET g_browser[li_addpos].b_id  = '0.add',g_add_idx USING "<<<"
            LET g_browser[li_addpos].b_pid = '0',g_add_idx USING "<<<"
            LET g_add_idx = g_add_idx + 1
            CALL aooi300_desc_show(li_addpos)
            LET g_current_idx = li_addpos
         ELSE
            #非根節點, 開始搜尋其父節點(已展開才做處理)
            LET li_cnt = g_cnt
            IF g_browser.getLength() > 0 THEN
               FOR li_idx = 1 TO g_browser.getLength()
                  IF g_browser[li_idx].b_oocq002 = g_oocq_m.oocq003 THEN
                     LET li_addpos = l_dialog.appendNode("s_browse",li_idx)
                     LET g_cnt = li_addpos
                     LET g_browser[li_addpos].b_oocq003 = g_oocq_m.oocq003
                     LET g_browser[li_addpos].b_oocq002 = g_oocq_m.oocq002
                     EXECUTE master_refreshcur USING g_browser[li_addpos].b_oocq001
                                                     ,g_browser[li_addpos].b_oocq002
 
                                                INTO g_browser[g_cnt].b_oocq001,g_browser[g_cnt].b_oocq003, 
                                                    g_browser[g_cnt].b_oocq002,g_browser[g_cnt].b_oocqstus, 
                                                    g_browser[g_cnt].b_oocq004,g_browser[g_cnt].b_oocq005, 
                                                    g_browser[g_cnt].b_oocq006,g_browser[g_cnt].b_oocq007, 
                                                    g_browser[g_cnt].b_oocq008,g_browser[g_cnt].b_oocq009, 
                                                    g_browser[g_cnt].b_oocq010,g_browser[g_cnt].b_oocq011, 
                                                    g_browser[g_cnt].b_oocq012,g_browser[g_cnt].b_oocq013, 
                                                    g_browser[g_cnt].b_oocq014,g_browser[g_cnt].b_oocq015, 
                                                    g_browser[g_cnt].b_oocq016,g_browser[g_cnt].b_oocq017, 
                                                    g_browser[g_cnt].b_oocq018,g_browser[g_cnt].b_oocq019, 
                                                    g_browser[g_cnt].b_oocq020,g_browser[g_cnt].b_oocq021, 
                                                    g_browser[g_cnt].b_oocq022,g_browser[g_cnt].b_oocq023, 
                                                    g_browser[g_cnt].b_oocq024,g_browser[g_cnt].b_oocq025, 
                                                    g_browser[g_cnt].b_oocq026,g_browser[g_cnt].b_oocq027, 
                                                    g_browser[g_cnt].b_oocq028,g_browser[g_cnt].b_oocq029, 
                                                    g_browser[g_cnt].b_oocq030,g_browser[g_cnt].b_oocq031, 
                                                    g_browser[g_cnt].b_oocq032,g_browser[g_cnt].b_oocq033, 
                                                    g_browser[g_cnt].b_oocq034,g_browser[g_cnt].b_oocq035, 
                                                    g_browser[g_cnt].b_oocq036,g_browser[g_cnt].b_oocq037, 
                                                    g_browser[g_cnt].b_oocq038,g_browser[g_cnt].b_oocq039, 
                                                    g_browser[g_cnt].b_oocq040,g_browser[g_cnt].b_oocq041, 
                                                    g_browser[g_cnt].b_oocq042,g_browser[g_cnt].b_oocq043 
 
                     LET g_browser[li_addpos].b_exp  = FALSE
                     LET g_browser[li_addpos].b_hasC = FALSE
                     LET g_browser[li_addpos].b_id  = g_browser[li_idx].b_id, '.add',g_add_idx USING "<<<"
                     LET g_browser[li_addpos].b_pid = g_browser[li_idx].b_id
                     LET g_add_idx = g_add_idx + 1
                     CALL aooi300_desc_show(li_addpos)
                     #打開父節點
                     LET g_browser[li_idx].b_hasC = TRUE
                     LET g_browser[li_idx].b_exp = TRUE
                     LET g_current_idx = li_addpos
                     EXIT FOR
                  END IF
               END FOR
            END IF
            LET g_cnt = li_cnt 
         END IF
      END IF
 
   #功能已完成,通報訊息中心
   CALL aooi300_msgcentre_notify('reproduce')
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.input" >}
#+ 資料輸入
PRIVATE FUNCTION aooi300_input(p_cmd)
   #add-point:input段define name="input.define_customerization"
   
   #end add-point
   DEFINE p_cmd           LIKE type_t.chr1
   DEFINE l_cmd_t         LIKE type_t.chr1
   DEFINE l_ac_t          LIKE type_t.num10       #未取消的ARRAY CNT 
   DEFINE l_n             LIKE type_t.num10       #檢查重複用
   DEFINE l_cnt           LIKE type_t.num10       #檢查重複用
   DEFINE l_lock_sw       LIKE type_t.chr1        #單身鎖住否
   DEFINE l_allow_insert  LIKE type_t.num5        #可新增否 
   DEFINE l_allow_delete  LIKE type_t.num5        #可刪除否
   DEFINE l_count         LIKE type_t.num10
   DEFINE l_i             LIKE type_t.num10
   DEFINE l_insert        LIKE type_t.num10
   DEFINE ls_return       STRING
   DEFINE l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak  DYNAMIC ARRAY OF STRING
   DEFINE l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE l_vars          DYNAMIC ARRAY OF STRING
   DEFINE l_fields        DYNAMIC ARRAY OF STRING
   #add-point:input段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="input.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="input.pre_function"
   
   #end add-point
   
   #切換畫面
   IF g_main_hidden THEN
      CALL gfrm_curr.setElementHidden("mainlayout",0)
      CALL gfrm_curr.setElementHidden("worksheet",1)
      LET g_main_hidden = 0
   END IF
 
   #將資料輸出到畫面上
   DISPLAY BY NAME g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
       g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
       g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
       g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
       g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
       g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
       g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
       g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
       g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdt, 
       g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc,g_oocq_m.oocqmoddt 
 
 
   #先做狀態判定
   IF p_cmd = 'r' THEN
      LET l_cmd_t = 'r' 
      LET p_cmd   = 'a'
   ELSE
      LET l_cmd_t = p_cmd
   END IF  
   
   CALL cl_set_head_visible("","YES")
 
   LET l_insert = FALSE
   LET g_action_choice = ""
   LET g_qryparam.state = "i"
   
   #控制key欄位可否輸入
   CALL aooi300_set_entry(p_cmd)
   #add-point:set_entry後 name="input.after_set_entry"
   
   #end add-point
   CALL aooi300_set_no_entry(p_cmd)
   #add-point:set_no_entry後 name="input.after_set_no_entry"
   
   #end add-point
 
   DISPLAY BY NAME g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005,g_oocq_m.oocq003,g_oocq_m.oocqstus, 
       g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007,g_oocq_m.oocq008,g_oocq_m.oocq009, 
       g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015, 
       g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021, 
       g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025,g_oocq_m.oocq026,g_oocq_m.oocq027, 
       g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043
   
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
   
      #單頭段
      INPUT BY NAME g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005,g_oocq_m.oocq003,g_oocq_m.oocqstus, 
          g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007,g_oocq_m.oocq008,g_oocq_m.oocq009, 
          g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015, 
          g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021, 
          g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025,g_oocq_m.oocq026,g_oocq_m.oocq027, 
          g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
          g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
          g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043 
         ATTRIBUTE(WITHOUT DEFAULTS)
         
         #自訂單頭ACTION
         
         #應用 a43 樣板自動產生(Version:4)
         ON ACTION update_item
            LET g_action_choice="update_item"
            IF cl_auth_chk_act("update_item") THEN
               
               #add-point:ON ACTION update_item name="input.master_input.update_item"
               IF NOT cl_null(g_oocq_m.oocq001) AND NOT cl_null(g_oocq_m.oocq002) THEN
                  CALL n_oocql(g_oocq_m.oocq001,g_oocq_m.oocq002)    # n_glacl:對應多語言表格 。 g_glac_m.glac002: 對應值
                  INITIALIZE g_ref_fields TO NULL
                  LET g_ref_fields[1] = g_oocq_m.oocq001
                  LET g_ref_fields[2] = g_oocq_m.oocq002
                  CALL ap_ref_array2(g_ref_fields," SELECT oocql004,oocql005 FROM oocql_t WHERE oocqlent = '"
                      ||g_enterprise||"' AND oocql001 = ? AND oocql002 = ? AND oocql003 = '"||g_dlang||"'","") RETURNING g_rtn_fields
                  LET g_oocq_m.oocql004= g_rtn_fields[1]
                  LET g_oocq_m.oocql005= g_rtn_fields[2]
                  
                  DISPLAY BY NAME g_oocq_m.oocql004
                  DISPLAY BY NAME g_oocq_m.oocql005
               END IF
               #END add-point
            END IF
 
 
 
 
         
         BEFORE INPUT
            IF s_transaction_chk("N",0) THEN
               CALL s_transaction_begin()
            END IF
            
            #add-point:input段define name="input.action"
            CALL aooi300_arg_entry(g_argv[1])
            DISPLAY g_argv[1] TO oocq001
            #end add-point
          
                  #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq002
            #add-point:BEFORE FIELD oocq002 name="input.b.oocq002"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq002
            
            #add-point:AFTER FIELD oocq002 name="input.a.oocq002"
            #此段落由子樣板a05產生
            
            IF NOT aooi300_oocq002_chk(p_cmd,g_oocq_m.oocq001,g_oocq_m.oocq002) THEN
               IF p_cmd = 'a' THEN
                  LET g_oocq_m.oocq002 = ''
               ELSE
                  LET g_oocq_m.oocq002 = g_oocq_m_t.oocq002
               END IF 
               NEXT FIELD oocq002
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq002
            #add-point:ON CHANGE oocq002 name="input.g.oocq002"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocql004
            #add-point:BEFORE FIELD oocql004 name="input.b.oocql004"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocql004
            
            #add-point:AFTER FIELD oocql004 name="input.a.oocql004"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocql004
            #add-point:ON CHANGE oocql004 name="input.g.oocql004"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocql005
            #add-point:BEFORE FIELD oocql005 name="input.b.oocql005"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocql005
            
            #add-point:AFTER FIELD oocql005 name="input.a.oocql005"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocql005
            #add-point:ON CHANGE oocql005 name="input.g.oocql005"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq003
            
            #add-point:AFTER FIELD oocq003 name="input.a.oocq003"
            DISPLAY ' ' TO oocq003_desc          
            IF NOT aooi300_oocq003_chk(p_cmd,g_oocq_m.oocq001,g_oocq_m.oocq002,g_oocq_m.oocq003) THEN
               IF p_cmd = 'a' THEN
                  LET g_oocq_m.oocq003 = ''
                  CALL aooi300_oocq003_ref()
               ELSE
                  LET g_oocq_m.oocq003 = g_oocq_m_t.oocq003 
                  CALL aooi300_oocq003_ref()
               END IF 
               NEXT FIELD oocq003
            END IF 
            CALL aooi300_oocq003_ref()
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq003
            #add-point:BEFORE FIELD oocq003 name="input.b.oocq003"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq003
            #add-point:ON CHANGE oocq003 name="input.g.oocq003"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocqstus
            #add-point:BEFORE FIELD oocqstus name="input.b.oocqstus"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocqstus
            
            #add-point:AFTER FIELD oocqstus name="input.a.oocqstus"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocqstus
            #add-point:ON CHANGE oocqstus name="input.g.oocqstus"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq004
            
            #add-point:AFTER FIELD oocq004 name="input.a.oocq004"
            DISPLAY ' ' TO oocq004_desc  
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,1,g_oocq_m.oocq004) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq004 = '' 
                  CALL aooi300_cklw_ref(g_oocq_m.oocq004,g_oocq_m.oocq001,1) 
                     RETURNING g_oocq_m.oocq004_desc
                  DISPLAY BY NAME g_oocq_m.oocq004_desc
               ELSE 
                  LET g_oocq_m.oocq004 = g_oocq_m_t.oocq004 
                  CALL aooi300_cklw_ref(g_oocq_m.oocq004,g_oocq_m.oocq001,1) 
                     RETURNING g_oocq_m.oocq004_desc
                  DISPLAY BY NAME g_oocq_m.oocq004_desc
               END IF 
               NEXT FIELD oocq004
            END IF 
            CALL aooi300_cklw_ref(g_oocq_m.oocq004,g_oocq_m.oocq001,1) 
               RETURNING g_oocq_m.oocq004_desc
            DISPLAY BY NAME g_oocq_m.oocq004_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq004
            #add-point:BEFORE FIELD oocq004 name="input.b.oocq004"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq004
            #add-point:ON CHANGE oocq004 name="input.g.oocq004"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq005
            
            #add-point:AFTER FIELD oocq005 name="input.a.oocq005"
            DISPLAY ' ' TO oocq005_desc
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,2,g_oocq_m.oocq005) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq005 = ''
               ELSE 
                  LET g_oocq_m.oocq005 = g_oocq_m_t.oocq005
               END IF 
               CALL aooi300_cklw_ref(g_oocq_m.oocq005,g_oocq_m.oocq001,2) 
                     RETURNING g_oocq_m.oocq005_desc
               DISPLAY BY NAME g_oocq_m.oocq005_desc
               NEXT FIELD oocq005
            END IF 
            CALL aooi300_cklw_ref(g_oocq_m.oocq005,g_oocq_m.oocq001,2) 
               RETURNING g_oocq_m.oocq005_desc
            DISPLAY BY NAME g_oocq_m.oocq005_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq005
            #add-point:BEFORE FIELD oocq005 name="input.b.oocq005"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq005
            #add-point:ON CHANGE oocq005 name="input.g.oocq005"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq006
            
            #add-point:AFTER FIELD oocq006 name="input.a.oocq006"
            DISPLAY ' ' TO oocq006_desc
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,3,g_oocq_m.oocq006) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq006 = ''
               ELSE 
                  LET g_oocq_m.oocq006 = g_oocq_m_t.oocq006
               END IF 
               CALL aooi300_cklw_ref(g_oocq_m.oocq006,g_oocq_m.oocq001,3) 
                  RETURNING g_oocq_m.oocq006_desc
               DISPLAY BY NAME g_oocq_m.oocq006_desc
               NEXT FIELD oocq006
            END IF 
            CALL aooi300_cklw_ref(g_oocq_m.oocq006,g_oocq_m.oocq001,3) 
               RETURNING g_oocq_m.oocq006_desc
            DISPLAY BY NAME g_oocq_m.oocq006_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq006
            #add-point:BEFORE FIELD oocq006 name="input.b.oocq006"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq006
            #add-point:ON CHANGE oocq006 name="input.g.oocq006"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq007
            
            #add-point:AFTER FIELD oocq007 name="input.a.oocq007"
            DISPLAY ' ' TO oocq007_desc
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,4,g_oocq_m.oocq007) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq007 = ''
               ELSE 
                  LET g_oocq_m.oocq007 = g_oocq_m_t.oocq007
               END IF 
               CALL aooi300_cklw_ref(g_oocq_m.oocq007,g_oocq_m.oocq001,4) 
                  RETURNING g_oocq_m.oocq007_desc
               DISPLAY BY NAME g_oocq_m.oocq007_desc

               NEXT FIELD oocq007
            END IF 
            CALL aooi300_cklw_ref(g_oocq_m.oocq007,g_oocq_m.oocq001,4) 
               RETURNING g_oocq_m.oocq007_desc
            DISPLAY BY NAME g_oocq_m.oocq007_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq007
            #add-point:BEFORE FIELD oocq007 name="input.b.oocq007"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq007
            #add-point:ON CHANGE oocq007 name="input.g.oocq007"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq008
            
            #add-point:AFTER FIELD oocq008 name="input.a.oocq008"
            DISPLAY ' ' TO oocq008_desc
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,5,g_oocq_m.oocq008) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq008 = ''
               ELSE 
                  LET g_oocq_m.oocq008 = g_oocq_m_t.oocq008
               END IF 
               CALL aooi300_cklw_ref(g_oocq_m.oocq008,g_oocq_m.oocq001,5) 
                  RETURNING g_oocq_m.oocq008_desc
               DISPLAY BY NAME g_oocq_m.oocq008_desc

               NEXT FIELD oocq008
            END IF 
            CALL aooi300_cklw_ref(g_oocq_m.oocq008,g_oocq_m.oocq001,5) 
               RETURNING g_oocq_m.oocq008_desc
            DISPLAY BY NAME g_oocq_m.oocq008_desc
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq008
            #add-point:BEFORE FIELD oocq008 name="input.b.oocq008"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq008
            #add-point:ON CHANGE oocq008 name="input.g.oocq008"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq009
            #add-point:BEFORE FIELD oocq009 name="input.b.oocq009"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq009
            
            #add-point:AFTER FIELD oocq009 name="input.a.oocq009"
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,6,g_oocq_m.oocq009) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq009 = ''
               ELSE 
                  LET g_oocq_m.oocq009 = g_oocq_m_t.oocq009
               END IF 


               NEXT FIELD oocq009
            END IF 

            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq009
            #add-point:ON CHANGE oocq009 name="input.g.oocq009"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq010
            #add-point:BEFORE FIELD oocq010 name="input.b.oocq010"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq010
            
            #add-point:AFTER FIELD oocq010 name="input.a.oocq010"
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,7,g_oocq_m.oocq010) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq010 = ''
               ELSE 
                  LET g_oocq_m.oocq010 = g_oocq_m_t.oocq010
               END IF 

               NEXT FIELD oocq010
            END IF 
 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq010
            #add-point:ON CHANGE oocq010 name="input.g.oocq010"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq011
            #add-point:BEFORE FIELD oocq011 name="input.b.oocq011"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq011
            
            #add-point:AFTER FIELD oocq011 name="input.a.oocq011"
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,8,g_oocq_m.oocq011) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq011 = ''
               ELSE 
                  LET g_oocq_m.oocq011 = g_oocq_m_t.oocq011
               END IF 

               NEXT FIELD oocq011
            END IF 

            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq011
            #add-point:ON CHANGE oocq011 name="input.g.oocq011"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq012
            #add-point:BEFORE FIELD oocq012 name="input.b.oocq012"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq012
            
            #add-point:AFTER FIELD oocq012 name="input.a.oocq012"
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,9,g_oocq_m.oocq012) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq012 = ''
               ELSE 
                  LET g_oocq_m.oocq012 = g_oocq_m_t.oocq012
               END IF 


               NEXT FIELD oocq012
            END IF 

            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq012
            #add-point:ON CHANGE oocq012 name="input.g.oocq012"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq013
            #add-point:BEFORE FIELD oocq013 name="input.b.oocq013"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq013
            
            #add-point:AFTER FIELD oocq013 name="input.a.oocq013"
            IF NOT aooi300_chklw_chk(g_oocq_m.oocq001,10,g_oocq_m.oocq013) THEN 
               IF p_cmd = 'a' THEN 
                  LET g_oocq_m.oocq013 = ''
               ELSE 
                  LET g_oocq_m.oocq013 = g_oocq_m_t.oocq013
               END IF 
              

               NEXT FIELD oocq013
            END IF 
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq013
            #add-point:ON CHANGE oocq013 name="input.g.oocq013"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq014
            #add-point:BEFORE FIELD oocq014 name="input.b.oocq014"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq014
            
            #add-point:AFTER FIELD oocq014 name="input.a.oocq014"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq014
            #add-point:ON CHANGE oocq014 name="input.g.oocq014"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq015
            #add-point:BEFORE FIELD oocq015 name="input.b.oocq015"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq015
            
            #add-point:AFTER FIELD oocq015 name="input.a.oocq015"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq015
            #add-point:ON CHANGE oocq015 name="input.g.oocq015"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq016
            #add-point:BEFORE FIELD oocq016 name="input.b.oocq016"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq016
            
            #add-point:AFTER FIELD oocq016 name="input.a.oocq016"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq016
            #add-point:ON CHANGE oocq016 name="input.g.oocq016"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq017
            #add-point:BEFORE FIELD oocq017 name="input.b.oocq017"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq017
            
            #add-point:AFTER FIELD oocq017 name="input.a.oocq017"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq017
            #add-point:ON CHANGE oocq017 name="input.g.oocq017"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq018
            #add-point:BEFORE FIELD oocq018 name="input.b.oocq018"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq018
            
            #add-point:AFTER FIELD oocq018 name="input.a.oocq018"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq018
            #add-point:ON CHANGE oocq018 name="input.g.oocq018"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq019
            #add-point:BEFORE FIELD oocq019 name="input.b.oocq019"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq019
            
            #add-point:AFTER FIELD oocq019 name="input.a.oocq019"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq019
            #add-point:ON CHANGE oocq019 name="input.g.oocq019"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq020
            #add-point:BEFORE FIELD oocq020 name="input.b.oocq020"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq020
            
            #add-point:AFTER FIELD oocq020 name="input.a.oocq020"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq020
            #add-point:ON CHANGE oocq020 name="input.g.oocq020"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq021
            #add-point:BEFORE FIELD oocq021 name="input.b.oocq021"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq021
            
            #add-point:AFTER FIELD oocq021 name="input.a.oocq021"
           
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq021
            #add-point:ON CHANGE oocq021 name="input.g.oocq021"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq022
            #add-point:BEFORE FIELD oocq022 name="input.b.oocq022"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq022
            
            #add-point:AFTER FIELD oocq022 name="input.a.oocq022"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq022
            #add-point:ON CHANGE oocq022 name="input.g.oocq022"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq023
            #add-point:BEFORE FIELD oocq023 name="input.b.oocq023"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq023
            
            #add-point:AFTER FIELD oocq023 name="input.a.oocq023"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq023
            #add-point:ON CHANGE oocq023 name="input.g.oocq023"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq024
            
            #add-point:AFTER FIELD oocq024 name="input.a.oocq024"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,1,g_oocq_m.oocq024) THEN 
               LET g_oocq_m.oocq024 = g_oocq_m_t.oocq024
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq024
            #add-point:BEFORE FIELD oocq024 name="input.b.oocq024"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq024
            #add-point:ON CHANGE oocq024 name="input.g.oocq024"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq025
            
            #add-point:AFTER FIELD oocq025 name="input.a.oocq025"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,2,g_oocq_m.oocq025) THEN 
               LET g_oocq_m.oocq025 = g_oocq_m_t.oocq025
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq025
            #add-point:BEFORE FIELD oocq025 name="input.b.oocq025"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq025
            #add-point:ON CHANGE oocq025 name="input.g.oocq025"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq026
            
            #add-point:AFTER FIELD oocq026 name="input.a.oocq026"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,3,g_oocq_m.oocq026) THEN 
               LET g_oocq_m.oocq026 = g_oocq_m_t.oocq026
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq026
            #add-point:BEFORE FIELD oocq026 name="input.b.oocq026"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq026
            #add-point:ON CHANGE oocq026 name="input.g.oocq026"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq027
            
            #add-point:AFTER FIELD oocq027 name="input.a.oocq027"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,4,g_oocq_m.oocq027) THEN 
               LET g_oocq_m.oocq027 = g_oocq_m_t.oocq027
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq027
            #add-point:BEFORE FIELD oocq027 name="input.b.oocq027"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq027
            #add-point:ON CHANGE oocq027 name="input.g.oocq027"
            
            #END add-point 
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq028
            
            #add-point:AFTER FIELD oocq028 name="input.a.oocq028"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,5,g_oocq_m.oocq028) THEN 
               LET g_oocq_m.oocq028 = g_oocq_m_t.oocq028
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq028
            #add-point:BEFORE FIELD oocq028 name="input.b.oocq028"
            
            #END add-point
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq028
            #add-point:ON CHANGE oocq028 name="input.g.oocq028"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq029
            #add-point:BEFORE FIELD oocq029 name="input.b.oocq029"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq029
            
            #add-point:AFTER FIELD oocq029 name="input.a.oocq029"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,6,g_oocq_m.oocq029) THEN 
               LET g_oocq_m.oocq029 = g_oocq_m_t.oocq029
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq029
            #add-point:ON CHANGE oocq029 name="input.g.oocq029"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq030
            #add-point:BEFORE FIELD oocq030 name="input.b.oocq030"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq030
            
            #add-point:AFTER FIELD oocq030 name="input.a.oocq030"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,7,g_oocq_m.oocq030) THEN 
               LET g_oocq_m.oocq030 = g_oocq_m_t.oocq030
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq030
            #add-point:ON CHANGE oocq030 name="input.g.oocq030"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq031
            #add-point:BEFORE FIELD oocq031 name="input.b.oocq031"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq031
            
            #add-point:AFTER FIELD oocq031 name="input.a.oocq031"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,8,g_oocq_m.oocq031) THEN 
               LET g_oocq_m.oocq031 = g_oocq_m_t.oocq031
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq031
            #add-point:ON CHANGE oocq031 name="input.g.oocq031"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq032
            #add-point:BEFORE FIELD oocq032 name="input.b.oocq032"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq032
            
            #add-point:AFTER FIELD oocq032 name="input.a.oocq032"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,9,g_oocq_m.oocq032) THEN 
               LET g_oocq_m.oocq032 = g_oocq_m_t.oocq032
               NEXT FIELD CURRENT
            END IF 
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq032
            #add-point:ON CHANGE oocq032 name="input.g.oocq032"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq033
            #add-point:BEFORE FIELD oocq033 name="input.b.oocq033"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq033
            
            #add-point:AFTER FIELD oocq033 name="input.a.oocq033"
            IF NOT aooi300_chklw_chk2(g_oocq_m.oocq001,10,g_oocq_m.oocq033) THEN 
               LET g_oocq_m.oocq033 = g_oocq_m_t.oocq033
               NEXT FIELD CURRENT
            END IF
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq033
            #add-point:ON CHANGE oocq033 name="input.g.oocq033"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq034
            #add-point:BEFORE FIELD oocq034 name="input.b.oocq034"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq034
            
            #add-point:AFTER FIELD oocq034 name="input.a.oocq034"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq034
            #add-point:ON CHANGE oocq034 name="input.g.oocq034"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq035
            #add-point:BEFORE FIELD oocq035 name="input.b.oocq035"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq035
            
            #add-point:AFTER FIELD oocq035 name="input.a.oocq035"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq035
            #add-point:ON CHANGE oocq035 name="input.g.oocq035"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq036
            #add-point:BEFORE FIELD oocq036 name="input.b.oocq036"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq036
            
            #add-point:AFTER FIELD oocq036 name="input.a.oocq036"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq036
            #add-point:ON CHANGE oocq036 name="input.g.oocq036"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq037
            #add-point:BEFORE FIELD oocq037 name="input.b.oocq037"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq037
            
            #add-point:AFTER FIELD oocq037 name="input.a.oocq037"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq037
            #add-point:ON CHANGE oocq037 name="input.g.oocq037"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq038
            #add-point:BEFORE FIELD oocq038 name="input.b.oocq038"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq038
            
            #add-point:AFTER FIELD oocq038 name="input.a.oocq038"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq038
            #add-point:ON CHANGE oocq038 name="input.g.oocq038"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq039
            #add-point:BEFORE FIELD oocq039 name="input.b.oocq039"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq039
            
            #add-point:AFTER FIELD oocq039 name="input.a.oocq039"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq039
            #add-point:ON CHANGE oocq039 name="input.g.oocq039"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq040
            #add-point:BEFORE FIELD oocq040 name="input.b.oocq040"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq040
            
            #add-point:AFTER FIELD oocq040 name="input.a.oocq040"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq040
            #add-point:ON CHANGE oocq040 name="input.g.oocq040"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq041
            #add-point:BEFORE FIELD oocq041 name="input.b.oocq041"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq041
            
            #add-point:AFTER FIELD oocq041 name="input.a.oocq041"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq041
            #add-point:ON CHANGE oocq041 name="input.g.oocq041"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq042
            #add-point:BEFORE FIELD oocq042 name="input.b.oocq042"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq042
            
            #add-point:AFTER FIELD oocq042 name="input.a.oocq042"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq042
            #add-point:ON CHANGE oocq042 name="input.g.oocq042"
            
            #END add-point 
 
 
         #應用 a01 樣板自動產生(Version:2)
         BEFORE FIELD oocq043
            #add-point:BEFORE FIELD oocq043 name="input.b.oocq043"
            
            #END add-point
 
 
         #應用 a02 樣板自動產生(Version:2)
         AFTER FIELD oocq043
            
            #add-point:AFTER FIELD oocq043 name="input.a.oocq043"
            
            #END add-point
            
 
 
         #應用 a04 樣板自動產生(Version:3)
         ON CHANGE oocq043
            #add-point:ON CHANGE oocq043 name="input.g.oocq043"
            
            #END add-point 
 
 
 #欄位檢查
                  #Ctrlp:input.c.oocq002
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq002
            #add-point:ON ACTION controlp INFIELD oocq002 name="input.c.oocq002"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocql004
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocql004
            #add-point:ON ACTION controlp INFIELD oocql004 name="input.c.oocql004"
 
            #END add-point
 
 
         #Ctrlp:input.c.oocql005
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocql005
            #add-point:ON ACTION controlp INFIELD oocql005 name="input.c.oocql005"
 
            #END add-point
 
 
         #Ctrlp:input.c.oocq003
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq003
            #add-point:ON ACTION controlp INFIELD oocq003 name="input.c.oocq003"
            LET g_qryparam.reqry = FALSE 
            LET g_qryparam.default1 = g_oocq_m.oocq003
            LET g_qryparam.arg1 = g_argv[1] 
            CALL q_oocq002()                           #呼叫開窗
            LET g_oocq_m.oocq003 = g_qryparam.return1 #顯示到畫面上
            DISPLAY g_oocq_m.oocq003 TO oocq003 
            CALL aooi300_oocq003_ref()
            NEXT FIELD oocq003
            #END add-point
 
 
         #Ctrlp:input.c.oocqstus
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocqstus
            #add-point:ON ACTION controlp INFIELD oocqstus name="input.c.oocqstus"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq004
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq004
            #add-point:ON ACTION controlp INFIELD oocq004 name="input.c.oocq004"
            CALL aooi300_open_qry('1',g_oocq_m.oocq001,g_oocq_m.oocq004) RETURNING g_oocq_m.oocq004
            DISPLAY BY NAME g_oocq_m.oocq004
            CALL aooi300_cklw_ref(g_oocq_m.oocq004,g_oocq_m.oocq001,1)
               RETURNING g_oocq_m.oocq004_desc
            DISPLAY BY NAME g_oocq_m.oocq004_desc
            NEXT FIELD oocq004
            #END add-point
 
 
         #Ctrlp:input.c.oocq005
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq005
            #add-point:ON ACTION controlp INFIELD oocq005 name="input.c.oocq005"
            CALL aooi300_open_qry('2',g_oocq_m.oocq001,g_oocq_m.oocq005) RETURNING g_oocq_m.oocq005
            DISPLAY BY NAME g_oocq_m.oocq005 
            CALL aooi300_cklw_ref(g_oocq_m.oocq005,g_oocq_m.oocq001,2)
               RETURNING g_oocq_m.oocq005_desc
            DISPLAY BY NAME g_oocq_m.oocq005_desc
            NEXT FIELD oocq005
            #END add-point
 
 
         #Ctrlp:input.c.oocq006
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq006
            #add-point:ON ACTION controlp INFIELD oocq006 name="input.c.oocq006"
            CALL aooi300_open_qry('3',g_oocq_m.oocq001,g_oocq_m.oocq006) RETURNING g_oocq_m.oocq006
            DISPLAY BY NAME g_oocq_m.oocq006
            CALL aooi300_cklw_ref(g_oocq_m.oocq006,g_oocq_m.oocq001,3)
               RETURNING g_oocq_m.oocq006_desc
            DISPLAY BY NAME g_oocq_m.oocq006_desc
            NEXT FIELD oocq006
            #END add-point
 
 
         #Ctrlp:input.c.oocq007
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq007
            #add-point:ON ACTION controlp INFIELD oocq007 name="input.c.oocq007"
            CALL aooi300_open_qry('4',g_oocq_m.oocq001,g_oocq_m.oocq007) RETURNING g_oocq_m.oocq007
            DISPLAY BY NAME g_oocq_m.oocq007
            CALL aooi300_cklw_ref(g_oocq_m.oocq007,g_oocq_m.oocq001,4)
               RETURNING g_oocq_m.oocq007_desc
            DISPLAY BY NAME g_oocq_m.oocq007_desc
            NEXT FIELD oocq007
            #END add-point
 
 
         #Ctrlp:input.c.oocq008
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq008
            #add-point:ON ACTION controlp INFIELD oocq008 name="input.c.oocq008"
            CALL aooi300_open_qry('5',g_oocq_m.oocq001,g_oocq_m.oocq008) RETURNING g_oocq_m.oocq008
            DISPLAY BY NAME g_oocq_m.oocq008
            CALL aooi300_cklw_ref(g_oocq_m.oocq008,g_oocq_m.oocq001,5)
               RETURNING g_oocq_m.oocq008_desc
            DISPLAY BY NAME g_oocq_m.oocq008_desc
            NEXT FIELD oocq008
            #END add-point
 
 
         #Ctrlp:input.c.oocq009
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq009
            #add-point:ON ACTION controlp INFIELD oocq009 name="input.c.oocq009"
            CALL aooi300_open_qry('6',g_oocq_m.oocq001,g_oocq_m.oocq009) RETURNING g_oocq_m.oocq009
            DISPLAY BY NAME g_oocq_m.oocq009

            NEXT FIELD oocq009
            #END add-point
 
 
         #Ctrlp:input.c.oocq010
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq010
            #add-point:ON ACTION controlp INFIELD oocq010 name="input.c.oocq010"
            CALL aooi300_open_qry('7',g_oocq_m.oocq001,g_oocq_m.oocq010) RETURNING g_oocq_m.oocq010
            DISPLAY BY NAME g_oocq_m.oocq010

            NEXT FIELD oocq010
            #END add-point
 
 
         #Ctrlp:input.c.oocq011
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq011
            #add-point:ON ACTION controlp INFIELD oocq011 name="input.c.oocq011"
            CALL aooi300_open_qry('8',g_oocq_m.oocq001,g_oocq_m.oocq011) RETURNING g_oocq_m.oocq011
            DISPLAY BY NAME g_oocq_m.oocq011 

            NEXT FIELD oocq011
            #END add-point
 
 
         #Ctrlp:input.c.oocq012
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq012
            #add-point:ON ACTION controlp INFIELD oocq012 name="input.c.oocq012"
            CALL aooi300_open_qry('9',g_oocq_m.oocq001,g_oocq_m.oocq012) RETURNING g_oocq_m.oocq012
            DISPLAY BY NAME g_oocq_m.oocq012

            NEXT FIELD oocq012
            #END add-point
 
 
         #Ctrlp:input.c.oocq013
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq013
            #add-point:ON ACTION controlp INFIELD oocq013 name="input.c.oocq013"
            CALL aooi300_open_qry('10',g_oocq_m.oocq001,g_oocq_m.oocq013) RETURNING g_oocq_m.oocq013
            DISPLAY BY NAME g_oocq_m.oocq013

            NEXT FIELD oocq013
            #END add-point
 
 
         #Ctrlp:input.c.oocq014
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq014
            #add-point:ON ACTION controlp INFIELD oocq014 name="input.c.oocq014"
            CALL aooi300_open_qry('11',g_oocq_m.oocq001,g_oocq_m.oocq014) RETURNING g_oocq_m.oocq014
            DISPLAY BY NAME g_oocq_m.oocq014

            NEXT FIELD oocq014
            #END add-point
 
 
         #Ctrlp:input.c.oocq015
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq015
            #add-point:ON ACTION controlp INFIELD oocq015 name="input.c.oocq015"
            CALL aooi300_open_qry('12',g_oocq_m.oocq001,g_oocq_m.oocq015) RETURNING g_oocq_m.oocq015
            DISPLAY BY NAME g_oocq_m.oocq015

            NEXT FIELD oocq015
            #END add-point
 
 
         #Ctrlp:input.c.oocq016
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq016
            #add-point:ON ACTION controlp INFIELD oocq016 name="input.c.oocq016"
            CALL aooi300_open_qry('13',g_oocq_m.oocq001,g_oocq_m.oocq016) RETURNING g_oocq_m.oocq016
            DISPLAY BY NAME g_oocq_m.oocq016

            NEXT FIELD oocq016
            #END add-point
 
 
         #Ctrlp:input.c.oocq017
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq017
            #add-point:ON ACTION controlp INFIELD oocq017 name="input.c.oocq017"
            CALL aooi300_open_qry('14',g_oocq_m.oocq001,g_oocq_m.oocq017) RETURNING g_oocq_m.oocq017
            DISPLAY BY NAME g_oocq_m.oocq017

            NEXT FIELD oocq017
            #END add-point
 
 
         #Ctrlp:input.c.oocq018
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq018
            #add-point:ON ACTION controlp INFIELD oocq018 name="input.c.oocq018"
            CALL aooi300_open_qry('15',g_oocq_m.oocq001,g_oocq_m.oocq018) RETURNING g_oocq_m.oocq018
            DISPLAY BY NAME g_oocq_m.oocq018

            NEXT FIELD oocq018
            #END add-point
 
 
         #Ctrlp:input.c.oocq019
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq019
            #add-point:ON ACTION controlp INFIELD oocq019 name="input.c.oocq019"
            CALL aooi300_open_qry('16',g_oocq_m.oocq001,g_oocq_m.oocq019) RETURNING g_oocq_m.oocq019
            DISPLAY BY NAME g_oocq_m.oocq019

            NEXT FIELD oocq019
            #END add-point
 
 
         #Ctrlp:input.c.oocq020
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq020
            #add-point:ON ACTION controlp INFIELD oocq020 name="input.c.oocq020"
            CALL aooi300_open_qry('17',g_oocq_m.oocq001,g_oocq_m.oocq020) RETURNING g_oocq_m.oocq020
            DISPLAY BY NAME g_oocq_m.oocq020
  
            NEXT FIELD oocq020
            #END add-point
 
 
         #Ctrlp:input.c.oocq021
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq021
            #add-point:ON ACTION controlp INFIELD oocq021 name="input.c.oocq021"
            CALL aooi300_open_qry('18',g_oocq_m.oocq001,g_oocq_m.oocq021) RETURNING g_oocq_m.oocq021
            DISPLAY BY NAME g_oocq_m.oocq021

            NEXT FIELD oocq021
            #END add-point
 
 
         #Ctrlp:input.c.oocq022
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq022
            #add-point:ON ACTION controlp INFIELD oocq022 name="input.c.oocq022"
            CALL aooi300_open_qry('19',g_oocq_m.oocq001,g_oocq_m.oocq022) RETURNING g_oocq_m.oocq022
            DISPLAY BY NAME g_oocq_m.oocq022

            NEXT FIELD oocq022
            #END add-point
 
 
         #Ctrlp:input.c.oocq023
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq023
            #add-point:ON ACTION controlp INFIELD oocq023 name="input.c.oocq023"
            CALL aooi300_open_qry('20',g_oocq_m.oocq001,g_oocq_m.oocq023) RETURNING g_oocq_m.oocq023
            DISPLAY BY NAME g_oocq_m.oocq023

            NEXT FIELD oocq023
            #END add-point
 
 
         #Ctrlp:input.c.oocq024
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq024
            #add-point:ON ACTION controlp INFIELD oocq024 name="input.c.oocq024"
            CALL aooi300_open_qry2('1',g_oocq_m.oocq001,g_oocq_m.oocq024) RETURNING g_oocq_m.oocq024
            DISPLAY BY NAME g_oocq_m.oocq024
            CALL aooi300_cklw_ref2(g_oocq_m.oocq024,g_oocq_m.oocq001,1)
               RETURNING g_oocq_m.oocq024_desc
            DISPLAY BY NAME g_oocq_m.oocq024_desc
            NEXT FIELD CURRENT
            #END add-point
 
 
         #Ctrlp:input.c.oocq025
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq025
            #add-point:ON ACTION controlp INFIELD oocq025 name="input.c.oocq025"
            CALL aooi300_open_qry2('2',g_oocq_m.oocq001,g_oocq_m.oocq025) RETURNING g_oocq_m.oocq025
            DISPLAY BY NAME g_oocq_m.oocq025
            CALL aooi300_cklw_ref2(g_oocq_m.oocq025,g_oocq_m.oocq001,2)
               RETURNING g_oocq_m.oocq025_desc
            DISPLAY BY NAME g_oocq_m.oocq025_desc
            NEXT FIELD CURRENT
            #END add-point
 
 
         #Ctrlp:input.c.oocq026
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq026
            #add-point:ON ACTION controlp INFIELD oocq026 name="input.c.oocq026"
            CALL aooi300_open_qry2('3',g_oocq_m.oocq001,g_oocq_m.oocq026) RETURNING g_oocq_m.oocq026
            DISPLAY BY NAME g_oocq_m.oocq026
            CALL aooi300_cklw_ref2(g_oocq_m.oocq026,g_oocq_m.oocq001,3)
               RETURNING g_oocq_m.oocq026_desc
            DISPLAY BY NAME g_oocq_m.oocq026_desc
            NEXT FIELD CURRENT
            #END add-point
 
 
         #Ctrlp:input.c.oocq027
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq027
            #add-point:ON ACTION controlp INFIELD oocq027 name="input.c.oocq027"
            CALL aooi300_open_qry2('4',g_oocq_m.oocq001,g_oocq_m.oocq027) RETURNING g_oocq_m.oocq027
            DISPLAY BY NAME g_oocq_m.oocq027
            CALL aooi300_cklw_ref2(g_oocq_m.oocq027,g_oocq_m.oocq001,4)
               RETURNING g_oocq_m.oocq027_desc
            DISPLAY BY NAME g_oocq_m.oocq027_desc
            NEXT FIELD CURRENT
            #END add-point
 
 
         #Ctrlp:input.c.oocq028
         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq028
            #add-point:ON ACTION controlp INFIELD oocq028 name="input.c.oocq028"
            CALL aooi300_open_qry2('5',g_oocq_m.oocq001,g_oocq_m.oocq028) RETURNING g_oocq_m.oocq028
            DISPLAY BY NAME g_oocq_m.oocq028
            CALL aooi300_cklw_ref2(g_oocq_m.oocq028,g_oocq_m.oocq001,5)
               RETURNING g_oocq_m.oocq028_desc
            DISPLAY BY NAME g_oocq_m.oocq028_desc
            NEXT FIELD CURRENT
            #END add-point
 
 
         #Ctrlp:input.c.oocq029
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq029
            #add-point:ON ACTION controlp INFIELD oocq029 name="input.c.oocq029"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq030
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq030
            #add-point:ON ACTION controlp INFIELD oocq030 name="input.c.oocq030"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq031
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq031
            #add-point:ON ACTION controlp INFIELD oocq031 name="input.c.oocq031"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq032
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq032
            #add-point:ON ACTION controlp INFIELD oocq032 name="input.c.oocq032"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq033
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq033
            #add-point:ON ACTION controlp INFIELD oocq033 name="input.c.oocq033"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq034
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq034
            #add-point:ON ACTION controlp INFIELD oocq034 name="input.c.oocq034"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq035
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq035
            #add-point:ON ACTION controlp INFIELD oocq035 name="input.c.oocq035"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq036
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq036
            #add-point:ON ACTION controlp INFIELD oocq036 name="input.c.oocq036"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq037
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq037
            #add-point:ON ACTION controlp INFIELD oocq037 name="input.c.oocq037"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq038
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq038
            #add-point:ON ACTION controlp INFIELD oocq038 name="input.c.oocq038"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq039
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq039
            #add-point:ON ACTION controlp INFIELD oocq039 name="input.c.oocq039"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq040
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq040
            #add-point:ON ACTION controlp INFIELD oocq040 name="input.c.oocq040"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq041
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq041
            #add-point:ON ACTION controlp INFIELD oocq041 name="input.c.oocq041"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq042
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq042
            #add-point:ON ACTION controlp INFIELD oocq042 name="input.c.oocq042"
            
            #END add-point
 
 
         #Ctrlp:input.c.oocq043
#         #應用 a03 樣板自動產生(Version:3)
         ON ACTION controlp INFIELD oocq043
            #add-point:ON ACTION controlp INFIELD oocq043 name="input.c.oocq043"
            
            #END add-point
 
 
 #欄位開窗
 
         AFTER INPUT
            IF INT_FLAG THEN
               EXIT DIALOG
            END IF
 
            #避免資料錯誤的檢查
            IF aooi300_check(g_oocq_m.oocq002,g_oocq_m.oocq003
               ,g_oocq_m.oocq001
               ) THEN
               INITIALIZE g_errparam TO NULL 
               LET g_errparam.extend = "" 
               LET g_errparam.code = "std-00020" 
               LET g_errparam.popup = TRUE 
               CALL cl_err()
               NEXT FIELD CURRENT
            END IF
 
            #CALL cl_err_collect_show()   #錯誤訊息統整顯示
            #CALL cl_showmsg()
            DISPLAY BY NAME g_oocq_m.oocq002
 
            #實體新增/修改/複製段落的處理
            CASE
               WHEN p_cmd = "a" OR p_cmd = "r"
                  LET l_count = 1
 
                  SELECT COUNT(1) INTO l_count FROM oocq_t
                   WHERE oocqent = g_enterprise AND oocq001 = g_oocq_m.oocq001
                     AND oocq002 = g_oocq_m.oocq002
 
                         #
                  IF l_count = 0 THEN
                     #add-point:單頭新增前 name="input.head.b_insert"
                     
                     #end add-point
 
                     INSERT INTO oocq_t (oocqent,oocq001,oocq002,oocq003,oocqstus,oocq004,oocq005,oocq006, 
                         oocq007,oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016, 
                         oocq017,oocq018,oocq019,oocq020,oocq021,oocq022,oocq023,oocq024,oocq025,oocq026, 
                         oocq027,oocq028,oocq029,oocq030,oocq031,oocq032,oocq033,oocq034,oocq035,oocq036, 
                         oocq037,oocq038,oocq039,oocq040,oocq041,oocq042,oocq043,oocqownid,oocqowndp, 
                         oocqcrtid,oocqcrtdt,oocqcrtdp,oocqmodid,oocqmoddt)
                     VALUES (g_enterprise,g_oocq_m.oocq001,g_oocq_m.oocq002,g_oocq_m.oocq003,g_oocq_m.oocqstus, 
                         g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007,g_oocq_m.oocq008, 
                         g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013, 
                         g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018, 
                         g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023, 
                         g_oocq_m.oocq024,g_oocq_m.oocq025,g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028, 
                         g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
                         g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038, 
                         g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043, 
                         g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt, 
                         g_oocq_m.oocqcrtdp,g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt) 
 
                     #add-point:單頭新增中 name="input.head.m_insert"
                     
                     #end add-point
 
                     IF SQLCA.SQLCODE THEN
                        INITIALIZE g_errparam TO NULL 
                        LET g_errparam.extend = "g_oocq_m:",SQLERRMESSAGE 
                        LET g_errparam.code = SQLCA.SQLCODE 
                        LET g_errparam.popup = TRUE 
                        CALL cl_err()
                        CONTINUE DIALOG
                     END IF
                  
                     #提速檔資料建置
                     IF g_oocq_m.oocq002 <> g_oocq_m.oocq003 THEN
                        #CALL n_oocqs_generate_child(g_oocq_m.oocq002,g_oocq_m.oocq003)
                     END IF
                     
                     #add-point:單頭新增後 name="input.head.a_insert"
                     
                     #end add-point
                     
                     #資料多語言用-增/改
                              INITIALIZE l_var_keys TO NULL 
         INITIALIZE l_field_keys TO NULL 
         INITIALIZE l_vars TO NULL 
         INITIALIZE l_fields TO NULL 
         IF g_oocq_m.oocq001 = g_master_multi_table_t.oocql001 AND
         g_oocq_m.oocq002 = g_master_multi_table_t.oocql002 AND
         g_oocq_m.oocql004 = g_master_multi_table_t.oocql004 AND 
         g_oocq_m.oocql005 = g_master_multi_table_t.oocql005  THEN
         ELSE 
            LET l_var_keys[01] = g_enterprise
            LET l_field_keys[01] = 'oocqlent'
            LET l_var_keys_bak[01] = g_enterprise
            LET l_var_keys[02] = g_oocq_m.oocq001
            LET l_field_keys[02] = 'oocql001'
            LET l_var_keys_bak[02] = g_master_multi_table_t.oocql001
            LET l_var_keys[03] = g_oocq_m.oocq002
            LET l_field_keys[03] = 'oocql002'
            LET l_var_keys_bak[03] = g_master_multi_table_t.oocql002
            LET l_var_keys[04] = g_dlang
            LET l_field_keys[04] = 'oocql003'
            LET l_var_keys_bak[04] = g_dlang
            LET l_vars[01] = g_oocq_m.oocql004
            LET l_fields[01] = 'oocql004'
            LET l_vars[02] = g_oocq_m.oocql005
            LET l_fields[02] = 'oocql005'
            CALL cl_multitable(l_var_keys,l_field_keys,l_vars,l_fields,l_var_keys_bak,'oocql_t')
         END IF 
 
                     CALL s_transaction_end("Y","0")
                  ELSE
                     CALL s_transaction_end("N","0")
                     INITIALIZE g_errparam TO NULL 
                     LET g_errparam.extend =  g_oocq_m.oocq002 
                     LET g_errparam.code =  "std-00006" 
                     LET g_errparam.popup = TRUE 
                     CALL cl_err()
                  END IF 
 
               #修改段落
               WHEN p_cmd = "u"  
                  #add-point:單頭修改前 name="input.head.b_update"
                  
                  #end add-point
                  UPDATE oocq_t SET (oocq001,oocq002,oocq003,oocqstus,oocq004,oocq005,oocq006,oocq007, 
                      oocq008,oocq009,oocq010,oocq011,oocq012,oocq013,oocq014,oocq015,oocq016,oocq017, 
                      oocq018,oocq019,oocq020,oocq021,oocq022,oocq023,oocq024,oocq025,oocq026,oocq027, 
                      oocq028,oocq029,oocq030,oocq031,oocq032,oocq033,oocq034,oocq035,oocq036,oocq037, 
                      oocq038,oocq039,oocq040,oocq041,oocq042,oocq043,oocqownid,oocqowndp,oocqcrtid, 
                      oocqcrtdt,oocqcrtdp,oocqmodid,oocqmoddt) = (g_oocq_m.oocq001,g_oocq_m.oocq002, 
                      g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006, 
                      g_oocq_m.oocq007,g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011, 
                      g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
                      g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021, 
                      g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025,g_oocq_m.oocq026, 
                      g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031, 
                      g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036, 
                      g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041, 
                      g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid, 
                      g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp,g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt)
                   WHERE oocqent = g_enterprise AND oocq001 = g_oocq001_t #
                     AND oocq002 = g_oocq002_t
 
                  #add-point:單頭修改中 name="input.head.m_update"
                  
                  #end add-point
                  CASE
                     WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
                        CALL s_transaction_end('N','0')
                        INITIALIZE g_errparam TO NULL 
                        LET g_errparam.extend = "oocq_t" 
                        LET g_errparam.code = "std-00009" 
                        LET g_errparam.popup = TRUE 
                        CALL cl_err()
                        
                     WHEN SQLCA.SQLCODE #其他錯誤
                        INITIALIZE g_errparam TO NULL 
                        LET g_errparam.extend = "oocq_t:",SQLERRMESSAGE 
                        LET g_errparam.code = SQLCA.SQLCODE 
                        LET g_errparam.popup = TRUE 
                        CALL s_transaction_end('N','0')
                        CALL cl_err()
                        
                     OTHERWISE
                        #add-point:單頭修改後 name="input.head.a_update"
                        
                        #end add-point
    
                        #資料多語言用-增/改
                                 INITIALIZE l_var_keys TO NULL 
         INITIALIZE l_field_keys TO NULL 
         INITIALIZE l_vars TO NULL 
         INITIALIZE l_fields TO NULL 
         IF g_oocq_m.oocq001 = g_master_multi_table_t.oocql001 AND
         g_oocq_m.oocq002 = g_master_multi_table_t.oocql002 AND
         g_oocq_m.oocql004 = g_master_multi_table_t.oocql004 AND 
         g_oocq_m.oocql005 = g_master_multi_table_t.oocql005  THEN
         ELSE 
            LET l_var_keys[01] = g_enterprise
            LET l_field_keys[01] = 'oocqlent'
            LET l_var_keys_bak[01] = g_enterprise
            LET l_var_keys[02] = g_oocq_m.oocq001
            LET l_field_keys[02] = 'oocql001'
            LET l_var_keys_bak[02] = g_master_multi_table_t.oocql001
            LET l_var_keys[03] = g_oocq_m.oocq002
            LET l_field_keys[03] = 'oocql002'
            LET l_var_keys_bak[03] = g_master_multi_table_t.oocql002
            LET l_var_keys[04] = g_dlang
            LET l_field_keys[04] = 'oocql003'
            LET l_var_keys_bak[04] = g_dlang
            LET l_vars[01] = g_oocq_m.oocql004
            LET l_fields[01] = 'oocql004'
            LET l_vars[02] = g_oocq_m.oocql005
            LET l_fields[02] = 'oocql005'
            CALL cl_multitable(l_var_keys,l_field_keys,l_vars,l_fields,l_var_keys_bak,'oocql_t')
         END IF 
 
                        LET g_log1 = util.JSON.stringify(g_oocq_m_t)
                        LET g_log2 = util.JSON.stringify(g_oocq_m)
                        IF NOT cl_log_modified_record(g_log1,g_log2) THEN 
                           CALL s_transaction_end('N','0')
                        ELSE
                           CALL s_transaction_end('Y','0')
                        END IF
                  END CASE
 
               OTHERWISE 
            END CASE
 
           #controlp
      END INPUT
      
      #add-point:input段more input  name="input.more_input"
      
      #end add-point
      
      BEFORE DIALOG
         #CALL cl_err_collect_init()    
         #add-point:before dialog name="input.before_dialog"
         
         #end add-point
          
      ON ACTION controlf
         CALL cl_set_focus_form(ui.Interface.getRootNode()) RETURNING g_fld_name,g_frm_name
         CALL cl_fldhelp(g_frm_name, g_fld_name, g_lang)
 
      ON ACTION controlr
         CALL cl_show_req_fields()
 
      ON ACTION controls
         IF g_header_hidden THEN
            CALL gfrm_curr.setElementHidden("vb_master",0)
            CALL gfrm_curr.setElementImage("controls","small/arr-u.png")
            LET g_header_hidden = 0     #visible
         ELSE
            CALL gfrm_curr.setElementHidden("vb_master",1)
            CALL gfrm_curr.setElementImage("controls","small/arr-d.png")
            LET g_header_hidden = 1     #hidden
         END IF
 
      ON ACTION accept
         ACCEPT DIALOG
        
      #在dialog button (放棄)
      ON ACTION cancel
         LET g_action_choice=""
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #在dialog 右上角 (X)
      ON ACTION close       
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      #toolbar 離開
      ON ACTION exit
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 
           
   END DIALOG
   
   #add-point:input段after input  name="input.after_input"
   
   #end add-point
    
END FUNCTION
 
{</section>}
 
{<section id="aooi300.show" >}
#+ 單頭資料重新顯示及單身資料重抓
PRIVATE FUNCTION aooi300_show()
   #add-point:show段define name="show.define_customerization"
   
   #end add-point
   #add-point:show段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="show.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="show.before"
   
   #end add-point
   
       
   
   #帶出公用欄位reference值
   #應用 a12 樣板自動產生(Version:4)
 
 
 
 
   #顯示followup圖示
   #應用 a48 樣板自動產生(Version:3)
   CALL aooi300_set_pk_array()
   #add-point:ON ACTION agendum name="show.follow_pic"
   
   #END add-point
   CALL cl_user_overview_set_follow_pic()
  
 
 
 
   
   #讀入ref值(單頭)
   #add-point:reference段之後 name="show.head.reference"
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocq001
   LET g_ref_fields[2] = g_oocq_m.oocq002
   CALL ap_ref_array2(g_ref_fields," SELECT oocql004,oocql005 FROM oocql_t WHERE oocqlent = '"||g_enterprise||"' AND oocql001 = ? AND oocql002 = ? AND oocql003 = '"||g_dlang||"'","") RETURNING g_rtn_fields 
   LET g_oocq_m.oocql004 = g_rtn_fields[1] 
   LET g_oocq_m.oocql005 = g_rtn_fields[2] 
   DISPLAY BY NAME g_oocq_m.oocql004
   DISPLAY BY NAME g_oocq_m.oocql005
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocq001
   CALL ap_ref_array2(g_ref_fields,"SELECT gzaal003 FROM gzaal_t WHERE gzaal001=? AND gzaal002='"||g_lang||"'","") RETURNING g_rtn_fields
   LET g_oocq_m.oocq001_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocq001_desc

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocq001
   LET g_ref_fields[2] = g_oocq_m.oocq003
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_oocq_m.oocq003_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocq003_desc

   CALL aooi300_cklw_ref(g_oocq_m.oocq004,g_oocq_m.oocq001,'1') RETURNING g_oocq_m.oocq004_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq005,g_oocq_m.oocq001,'2') RETURNING g_oocq_m.oocq005_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq006,g_oocq_m.oocq001,'3') RETURNING g_oocq_m.oocq006_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq007,g_oocq_m.oocq001,'4') RETURNING g_oocq_m.oocq007_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq008,g_oocq_m.oocq001,'5') RETURNING g_oocq_m.oocq008_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq009,g_oocq_m.oocq001,'6') RETURNING g_oocq_m.oocq009_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq010,g_oocq_m.oocq001,'7') RETURNING g_oocq_m.oocq010_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq011,g_oocq_m.oocq001,'8') RETURNING g_oocq_m.oocq011_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq012,g_oocq_m.oocq001,'9') RETURNING g_oocq_m.oocq012_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq013,g_oocq_m.oocq001,'10') RETURNING g_oocq_m.oocq013_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq014,g_oocq_m.oocq001,'11') RETURNING g_oocq_m.oocq014_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq015,g_oocq_m.oocq001,'12') RETURNING g_oocq_m.oocq015_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq016,g_oocq_m.oocq001,'13') RETURNING g_oocq_m.oocq016_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq017,g_oocq_m.oocq001,'14') RETURNING g_oocq_m.oocq017_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq018,g_oocq_m.oocq001,'15') RETURNING g_oocq_m.oocq018_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq019,g_oocq_m.oocq001,'16') RETURNING g_oocq_m.oocq019_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq020,g_oocq_m.oocq001,'17') RETURNING g_oocq_m.oocq020_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq021,g_oocq_m.oocq001,'18') RETURNING g_oocq_m.oocq021_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq022,g_oocq_m.oocq001,'19') RETURNING g_oocq_m.oocq022_desc
   #CALL aooi300_cklw_ref(g_oocq_m.oocq023,g_oocq_m.oocq001,'20') RETURNING g_oocq_m.oocq023_desc 
   DISPLAY g_oocq_m.oocq004_desc TO oocq004_desc
   DISPLAY g_oocq_m.oocq005_desc TO oocq005_desc
   DISPLAY g_oocq_m.oocq006_desc TO oocq006_desc
   DISPLAY g_oocq_m.oocq007_desc TO oocq007_desc
   DISPLAY g_oocq_m.oocq008_desc TO oocq008_desc
  # DISPLAY g_oocq_m.oocq009_desc TO oocq009_desc
  # DISPLAY g_oocq_m.oocq010_desc TO oocq010_desc
  # DISPLAY g_oocq_m.oocq011_desc TO oocq011_desc
  # DISPLAY g_oocq_m.oocq012_desc TO oocq012_desc
  # DISPLAY g_oocq_m.oocq013_desc TO oocq013_desc
  # DISPLAY g_oocq_m.oocq014_desc TO oocq014_desc
  # DISPLAY g_oocq_m.oocq015_desc TO oocq015_desc
  # DISPLAY g_oocq_m.oocq016_desc TO oocq016_desc
  # DISPLAY g_oocq_m.oocq017_desc TO oocq017_desc
  # DISPLAY g_oocq_m.oocq018_desc TO oocq018_desc
  # DISPLAY g_oocq_m.oocq019_desc TO oocq019_desc
  # DISPLAY g_oocq_m.oocq020_desc TO oocq020_desc
  # DISPLAY g_oocq_m.oocq021_desc TO oocq021_desc
  # DISPLAY g_oocq_m.oocq022_desc TO oocq022_desc
  # DISPLAY g_oocq_m.oocq023_desc TO oocq023_desc
  
   CALL aooi300_cklw_ref2(g_oocq_m.oocq024,g_oocq_m.oocq001,'1') RETURNING g_oocq_m.oocq024_desc
   CALL aooi300_cklw_ref2(g_oocq_m.oocq025,g_oocq_m.oocq001,'2') RETURNING g_oocq_m.oocq025_desc
   CALL aooi300_cklw_ref2(g_oocq_m.oocq026,g_oocq_m.oocq001,'3') RETURNING g_oocq_m.oocq026_desc
   CALL aooi300_cklw_ref2(g_oocq_m.oocq027,g_oocq_m.oocq001,'4') RETURNING g_oocq_m.oocq027_desc
   CALL aooi300_cklw_ref2(g_oocq_m.oocq028,g_oocq_m.oocq001,'5') RETURNING g_oocq_m.oocq028_desc

   DISPLAY g_oocq_m.oocq024_desc TO oocq024_desc
   DISPLAY g_oocq_m.oocq025_desc TO oocq025_desc
   DISPLAY g_oocq_m.oocq026_desc TO oocq026_desc
   DISPLAY g_oocq_m.oocq027_desc TO oocq027_desc
   DISPLAY g_oocq_m.oocq028_desc TO oocq028_desc

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocqmodid
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET g_oocq_m.oocqmodid_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocqmodid_desc

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocqownid
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET g_oocq_m.oocqownid_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocqownid_desc

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocqowndp
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_oocq_m.oocqowndp_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocqowndp_desc

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocqcrtdp
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_oocq_m.oocqcrtdp_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocqcrtdp_desc

   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocqcrtid
   CALL ap_ref_array2(g_ref_fields,"SELECT ooag011 FROM ooag_t WHERE ooagent='"||g_enterprise||"' AND ooag001=? ","") RETURNING g_rtn_fields
   LET g_oocq_m.oocqcrtid_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocqcrtid_desc

   #end add-point
   
   #將資料輸出到畫面上
   DISPLAY BY NAME g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
       g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
       g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
       g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
       g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
       g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
       g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
       g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
       g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdt, 
       g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc,g_oocq_m.oocqmoddt 
 
 
   #顯示狀態(stus)圖片
         #應用 a21 樣板自動產生(Version:3)
	  #根據當下狀態碼顯示圖片
      CASE g_oocq_m.oocqstus 
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/inactive.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/active.png")
         
      END CASE
 
 
 
 
   #顯示有特殊格式設定的欄位或說明
   CALL cl_show_fld_cont()   
 
   #add-point:show段之後 name="show.after"
   
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.delete" >}
#+ 資料刪除
PRIVATE FUNCTION aooi300_delete(l_dialog)
   #add-point:delete段define name="delete.define_customerization"
   
   #end add-point
   DEFINE l_var_keys      DYNAMIC ARRAY OF STRING
   DEFINE l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE l_vars          DYNAMIC ARRAY OF STRING
   DEFINE l_fields        DYNAMIC ARRAY OF STRING
   DEFINE l_var_keys_bak  DYNAMIC ARRAY OF STRING
   DEFINE l_dialog        ui.DIALOG
   DEFINE li_status       LIKE type_t.num5  #SQL實體資料刪除狀態
   DEFINE li_cnt          LIKE type_t.num10 #查看本階是否有兄弟資料
   #add-point:delete段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="delete.define"
   #add--160809-00047#2 By shiun--(S)
   DEFINE  l_success             LIKE type_t.num5
   DEFINE  l_use                 LIKE type_t.num5
   DEFINE  l_sql                 STRING
   DEFINE  l_oocq002             LIKE oocq_t.oocq002
   #add--160809-00047#2 By shiun--(E)
   #end add-point
   
   #add-point:Function前置處理  name="delete.pre_function"
   
   #end add-point
   
   IF g_oocq_m.oocq001 IS NULL
 
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code = "std-00003" 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
   
   #add-point:delete段before_delete name="delete.before_delete"
   
   #end add-point
 
   EXECUTE aooi300_master_referesh USING g_oocq_m.oocq001,g_oocq_m.oocq002 INTO g_oocq_m.oocq001,g_oocq_m.oocq002, 
       g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007, 
       g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013, 
       g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019, 
       g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025, 
       g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031, 
       g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037, 
       g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043, 
       g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp, 
       g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt,g_oocq_m.oocq001_desc,g_oocq_m.oocq003_desc,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid_desc 
 
    
   #檢查是否允許此動作
   IF NOT aooi300_action_chk() THEN
      RETURN
   END IF
    
   CALL aooi300_show()
   
   #Transaction開始
   CALL s_transaction_begin()
   
   LET g_master_multi_table_t.oocql001 = g_oocq_m.oocq001
LET g_master_multi_table_t.oocql002 = g_oocq_m.oocq002
LET g_master_multi_table_t.oocql004 = g_oocq_m.oocql004
LET g_master_multi_table_t.oocql005 = g_oocq_m.oocql005
 
 
   OPEN aooi300_cl USING g_enterprise,g_oocq_m.oocq001,g_oocq_m.oocq002
   IF SQLCA.SQLCODE THEN   #(ver:36)
      CLOSE aooi300_cl
      CALL s_transaction_end("N","0")
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN aooi300_cl:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE   #(ver:36)
      LET g_errparam.popup = TRUE 
      CALL cl_err()
      RETURN
   END IF
 
   #鎖住將被更改或取消的資料
   FETCH aooi300_cl INTO g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
       g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
       g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
       g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
       g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
       g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
       g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
       g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
       g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdt, 
       g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc,g_oocq_m.oocqmoddt 
 
   IF SQLCA.SQLCODE THEN
      CALL s_transaction_end("N","0")
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = g_oocq_m.oocq002,":",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   #add-point:delete段before_delete name="delete.before_delete_ask"
   #add--160809-00047#2 By shiun--(S)
   LET li_status = TRUE
   CALL s_azzi610_check('4',g_browser[g_current_idx].b_oocq002,g_site) RETURNING l_success,l_use
   IF l_use THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = 'azz-01159'
      LET g_errparam.extend = ''
      LET g_errparam.popup = TRUE
      CALL cl_err()
      LET li_status = FALSE
   END IF
   IF li_status THEN
      LET l_sql = " SELECT oocq002 FROM ",
                  " (SELECT oocq002,oocq003 FROM oocq_t WHERE oocqent = " ||g_enterprise|| " AND oocq002<>oocq003)", 
                   
                  " START WITH oocq003='",g_browser[g_current_idx].b_oocq002,"'",
                  " CONNECT BY PRIOR oocq002 = oocq003"
      PREPARE aooi300_b_del_p FROM l_sql 
      DECLARE aooi300_b_del_c CURSOR FOR aooi300_b_del_p 
      FOREACH aooi300_b_del_c INTO l_oocq002
         CALL s_azzi610_check('4',l_oocq002,g_site) RETURNING l_success,l_use
         IF l_use THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'azz-01159'
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()
            LET li_status = FALSE
            EXIT FOREACH
         END IF
      END FOREACH   
   END IF
   IF NOT li_status THEN
      CALL s_transaction_end("N","0")
      CLOSE aooi300_cl
      RETURN
   END IF
   #add--160809-00047#2 By shiun--(E)
   #end add-point
 
   #(ver:35) ---modify start---
   #(ver:35) 為避免刪除全部子節點可能會對其他節點造成影響，現改為只刪除當下節點
   #先判斷是否有子節點(hasC) 詢問是否砍除全部
#  IF g_browser[g_current_idx].b_hasC THEN
#     IF cl_ask_delete_all_node() THEN
#        LET li_status = aooi300_sql_delete(TRUE)
#     ELSE
#        LET li_status = FALSE
#     END IF
#  ELSE
      #如果沒有子節點,詢問是否刪除本筆資料
      IF cl_ask_delete() THEN
         LET li_status = aooi300_sql_delete(FALSE)
      ELSE
         LET li_status = FALSE
      END IF
#  END IF
   #(ver:35) --- modify end ---
 
   #檢查實體砍除是否發生意外中止
   IF NOT li_status THEN
      CALL s_transaction_end("N","0")
      CLOSE aooi300_cl
      RETURN
   END IF
 
   #刪除節點與資料內容
   CALL l_dialog.deleteNode("s_browse",g_current_idx)  #deleteNode會順便幫忙做deleteElement
 
   #確認這一階還有沒有兄弟 (有:不異動上階屬性/否:上階hasC及exp設定成0)
   #SELECT COUNT(1) INTO li_cnt
   #  FROM oocq_t
   # WHERE oocq003 = g_oocq_m.oocq003
   #IF g_current_idx > 1 THEN
   #   IF li_cnt = 0  THEN
   #      LET g_browser[g_current_idx - 1].b_hasC = 0
   #      LET g_browser[g_current_idx - 1].b_exp = 0
   #   END IF
   #END IF
 
   #add-point:單頭刪除後 name="delete.head.a_delete"
   
   #end add-point
   
   IF g_current_idx > 1 THEN
      LET g_current_idx = g_current_idx - 1
   END IF
   
   IF g_browser.getLength() > 0 THEN
      CALL aooi300_fetch("")
   END IF
 
   LET g_log1 = util.JSON.stringify(g_oocq_m)   #(ver:36)
   IF NOT cl_log_modified_record(g_log1,'') THEN   #(ver:36)
      CLOSE aooi300_cl
      CALL s_transaction_end('N','0')
   ELSE
      CLOSE aooi300_cl
      CALL s_transaction_end('Y','0')
   END IF
 
   #功能已完成,通報訊息中心
   CALL aooi300_msgcentre_notify('delete')
    
END FUNCTION
 
{</section>}
 
{<section id="aooi300.sql_delete" >}
#+ 實體刪除FUNCTION 
PRIVATE FUNCTION aooi300_sql_delete(li_node)
   #add-point:sql_delete段define name="sql_delet.define_customerization"
   
   #end add-point
   DEFINE li_node         LIKE type_t.num5  #TRUE:砍除Node Tree/FALSE:砍除Single Node
   DEFINE li_return       LIKE type_t.num5
   DEFINE l_var_keys_bak  DYNAMIC ARRAY OF STRING
   DEFINE l_field_keys    DYNAMIC ARRAY OF STRING
   DEFINE ls_sql          STRING
   DEFINE li_cnt          LIKE type_t.num10   #(ver:35) add
   #add-point:sql_delete段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="sql_delet.define"
 
   #end add-point
   
   #add-point:Function前置處理  name="sql_delet.pre_function"
   
   #end add-point
   
   LET li_return = TRUE
 
   #應用 a47 樣板自動產生(Version:4)
      #刪除相關文件
      CALL aooi300_set_pk_array()
      #add-point:相關文件刪除前 name="delete.befroe.related_document_remove"
      
      #end add-point   
      CALL cl_doc_remove()  
 
 
 
 
 
   #add-point:單頭刪除前 name="delete.head.b_delete"
 
   #end add-point
   
   IF li_node = TRUE THEN
      #砍除該節點以下所有節點
      LET ls_sql = " SELECT oocq002,oocq003 FROM ",
                   " (SELECT oocq002,oocq003 FROM oocq_t WHERE oocqent = " ||g_enterprise|| " AND oocq002<>oocq003)", 
 
                   " START WITH oocq003='",g_oocq_m.oocq003,"'",
                   " CONNECT BY PRIOR oocq002 = oocq003"
 
   ELSE 
   
   END IF
 
   #刪除當下節點
   DELETE FROM oocq_t
    WHERE oocqent = g_enterprise AND oocq001 = g_oocq_m.oocq001
      AND oocq002 = g_oocq_m.oocq002
 
 
   #add-point:單頭刪除中 name="delete.head.m_delete"
   
   #end add-point
 
   IF SQLCA.SQLCODE THEN
      CALL s_transaction_end("N","0")
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "oocq_t:",SQLERRMESSAGE 
      LET g_errparam.code = SQLCA.SQLCODE 
      LET g_errparam.popup = FALSE 
      CALL cl_err()
   END IF
 
   #(ver:35) ---modify start---
   # 若此節點還有存在在其他節點下，則多語言資料不可刪除
   LET li_cnt = 0
   LET ls_sql = " SELECT COUNT(1) FROM oocq_t",
                 " WHERE oocqent = " ||g_enterprise|| " AND oocq002 = '",g_oocq_m.oocq002,"'"
 
   PREPARE master_chk_node_exist FROM ls_sql
   EXECUTE master_chk_node_exist INTO li_cnt
   IF li_cnt <= 0 THEN
      INITIALIZE l_var_keys_bak TO NULL 
   INITIALIZE l_field_keys   TO NULL 
   LET l_var_keys_bak[01] = g_enterprise
   LET l_field_keys[01] = 'oocqlent'
   LET l_var_keys_bak[02] = g_master_multi_table_t.oocql001
   LET l_field_keys[02] = 'oocql001'
   LET l_var_keys_bak[03] = g_master_multi_table_t.oocql002
   LET l_field_keys[03] = 'oocql002'
   CALL cl_multitable_delete(l_field_keys,l_var_keys_bak,'oocql_t')
 
   END IF
   #(ver:35) --- modify end ---
 
   RETURN li_return
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.set_entry" >}
#+ 單頭欄位開啟設定
PRIVATE FUNCTION aooi300_set_entry(p_cmd)
   #add-point:set_entry段define name="set_entry.define_customerization"
   
   #end add-point
   DEFINE p_cmd   LIKE type_t.chr1 
   #add-point:set_entry段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_entry.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="set_entry.pre_function"
   
   #end add-point
   
   IF p_cmd = "a" THEN
      CALL cl_set_comp_entry("oocq001,oocq002",TRUE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,TRUE)
      END IF
      #add-point:set_entry段欄位控制 name="set_entry.field_control"
      CALL cl_set_comp_entry("oocq001",FALSE)
      #end add-point 
   END IF
   
   #add-point:set_entry段欄位控制後 name="set_entry.after_control"
   
   #end add-point 
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.set_no_entry" >}
#+ 單頭欄位關閉設定
PRIVATE FUNCTION aooi300_set_no_entry(p_cmd)
   #add-point:set_no_entry段define name="set_no_entry.define_customerization"
   
   #end add-point
   DEFINE p_cmd   LIKE type_t.chr1
   #add-point:set_no_entry段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_no_entry.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="set_no_entry.pre_function"
   
   #end add-point
   
   IF p_cmd = 'u' AND g_chkey = 'N' THEN
      CALL cl_set_comp_entry("oocq001,oocq002",FALSE)
      #根據azzi850使用者身分開關特定欄位
      IF NOT cl_null(g_no_entry) THEN
         CALL cl_set_comp_entry(g_no_entry,FALSE)
      END IF
      #add-point:set_no_entry段欄位控制 name="set_no_entry.field_control"
      
      #end add-point 
   END IF
   
   #add-point:set_no_entry段欄位控制後 name="set_no_entry.after_control"
   
   #end add-point
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.default_search" >}
#+ 外部參數預設搜尋
PRIVATE FUNCTION aooi300_default_search()
   #add-point:default_search段define name="default_search.define_customerization"
   
   #end add-point
   DEFINE li_idx  LIKE type_t.num10
   DEFINE li_cnt  LIKE type_t.num10
   DEFINE ls_wc   STRING
   #add-point:default_search段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="default_search.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="default_search.before"
   
   #end add-point  
   
   IF g_searchtype = 0 OR cl_null(g_searchtype) THEN
      LET g_searchtype = 3
   END IF 
   
   IF NOT cl_null(g_argv[01]) THEN
      LET ls_wc = ls_wc, " oocq001 = '", g_argv[01], "' AND "
   END IF
   
   IF NOT cl_null(g_argv[02]) THEN
      LET ls_wc = ls_wc, " oocq002 = '", g_argv[02], "' AND "
   END IF
 
   
   #add-point:default_search段after sql name="default_search.after_sql"
   
   #end add-point  
   
   IF NOT cl_null(ls_wc) THEN
      LET ls_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_wc = ls_wc
   ELSE
      IF cl_null(g_wc) THEN
         LET g_wc = " 1=2"
      END IF
   END IF
   
   #CALL aooi300_browser_fill(g_wc,g_searchtype)
 
   #add-point:default_search段結束前 name="default_search.after"
   
   #end add-point
 
END FUNCTION
 
{</section>}
 
{<section id="aooi300.state_change" >}
   #應用 a09 樣板自動產生(Version:17)
#+ 確認碼變更 
PRIVATE FUNCTION aooi300_statechange()
   #add-point:statechange段define(客製用) name="statechange.define_customerization"
   
   #end add-point  
   DEFINE lc_state LIKE type_t.chr5
   #add-point:statechange段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="statechange.define"
   
   #end add-point  
   
   #add-point:Function前置處理 name="statechange.before"
   
   #end add-point  
   
   ERROR ""     #清空畫面右下側ERROR區塊
 
   IF g_oocq_m.oocq001 IS NULL
      OR g_oocq_m.oocq002 IS NULL
   THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = "std-00003" 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
      RETURN
   END IF
 
   CALL s_transaction_begin()
   
   OPEN aooi300_cl USING g_enterprise,g_oocq_m.oocq001,g_oocq_m.oocq002
   IF STATUS THEN
      CLOSE aooi300_cl
      CALL s_transaction_end('N','0')
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "OPEN aooi300_cl:" 
      LET g_errparam.code   = STATUS 
      LET g_errparam.popup  = TRUE 
      CALL cl_err()
      RETURN
   END IF
   
   #顯示最新的資料
   EXECUTE aooi300_master_referesh USING g_oocq_m.oocq001,g_oocq_m.oocq002 INTO g_oocq_m.oocq001,g_oocq_m.oocq002, 
       g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006,g_oocq_m.oocq007, 
       g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013, 
       g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019, 
       g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq025, 
       g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031, 
       g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037, 
       g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043, 
       g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp, 
       g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt,g_oocq_m.oocq001_desc,g_oocq_m.oocq003_desc,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid_desc 
 
   
 
   #檢查是否允許此動作
   IF NOT aooi300_action_chk() THEN
      CLOSE aooi300_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
 
   #將資料顯示到畫面上
   DISPLAY BY NAME g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
       g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
       g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
       g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
       g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
       g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
       g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
       g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
       g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033, 
       g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039, 
       g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqownid_desc, 
       g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdt, 
       g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc,g_oocq_m.oocqmoddt 
 
 
   CASE g_oocq_m.oocqstus
      WHEN "N"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/inactive.png")
      WHEN "Y"
         CALL gfrm_curr.setElementImage("statechange", "stus/32/active.png")
      
   END CASE
 
   #add-point:資料刷新後 name="statechange.after_refresh"
   
   #end add-point
 
   MENU "" ATTRIBUTES (STYLE="popup")
      BEFORE MENU
         HIDE OPTION "approved"
         HIDE OPTION "rejection"
         CASE g_oocq_m.oocqstus
            
            WHEN "N"
               HIDE OPTION "inactive"
            WHEN "Y"
               HIDE OPTION "active"
         END CASE
     
      #add-point:menu前 name="statechange.before_menu"
      
      #end add-point
      
      
	  
      ON ACTION inactive
         IF cl_auth_chk_act("inactive") THEN
            LET lc_state = "N"
            #add-point:action控制 name="statechange.inactive"
            
            #end add-point
         END IF
         EXIT MENU
      ON ACTION active
         IF cl_auth_chk_act("active") THEN
            LET lc_state = "Y"
            #add-point:action控制 name="statechange.active"
            
            #end add-point
         END IF
         EXIT MENU
 
      #add-point:stus控制 name="statechange.more_control"
      
      #end add-point
      
   END MENU
   
   #確認被選取的狀態碼在清單中
   IF (lc_state <> "N" 
      AND lc_state <> "Y"
      ) OR 
      g_oocq_m.oocqstus = lc_state OR cl_null(lc_state) THEN
      CLOSE aooi300_cl
      CALL s_transaction_end('N','0')
      RETURN
   END IF
   
   #add-point:stus修改前 name="statechange.b_update"
   
   #end add-point
   
   LET g_oocq_m.oocqmodid = g_user
   LET g_oocq_m.oocqmoddt = cl_get_current()
   LET g_oocq_m.oocqstus = lc_state
   
   #異動狀態碼欄位/修改人/修改日期
   UPDATE oocq_t 
      SET (oocqstus,oocqmodid,oocqmoddt) 
        = (g_oocq_m.oocqstus,g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt)     
    WHERE oocqent = g_enterprise AND oocq001 = g_oocq_m.oocq001
      AND oocq002 = g_oocq_m.oocq002
    
   IF SQLCA.sqlcode THEN
      INITIALIZE g_errparam TO NULL 
      LET g_errparam.extend = "" 
      LET g_errparam.code   = SQLCA.sqlcode 
      LET g_errparam.popup  = FALSE 
      CALL cl_err()
   ELSE
      CASE lc_state
         WHEN "N"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/inactive.png")
         WHEN "Y"
            CALL gfrm_curr.setElementImage("statechange", "stus/32/active.png")
         
      END CASE
    
      #撈取異動後的資料
      EXECUTE aooi300_master_referesh USING g_oocq_m.oocq001,g_oocq_m.oocq002 INTO g_oocq_m.oocq001, 
          g_oocq_m.oocq002,g_oocq_m.oocq003,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq005,g_oocq_m.oocq006, 
          g_oocq_m.oocq007,g_oocq_m.oocq008,g_oocq_m.oocq009,g_oocq_m.oocq010,g_oocq_m.oocq011,g_oocq_m.oocq012, 
          g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016,g_oocq_m.oocq017,g_oocq_m.oocq018, 
          g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022,g_oocq_m.oocq023,g_oocq_m.oocq024, 
          g_oocq_m.oocq025,g_oocq_m.oocq026,g_oocq_m.oocq027,g_oocq_m.oocq028,g_oocq_m.oocq029,g_oocq_m.oocq030, 
          g_oocq_m.oocq031,g_oocq_m.oocq032,g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036, 
          g_oocq_m.oocq037,g_oocq_m.oocq038,g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042, 
          g_oocq_m.oocq043,g_oocq_m.oocqownid,g_oocq_m.oocqowndp,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtdt, 
          g_oocq_m.oocqcrtdp,g_oocq_m.oocqmodid,g_oocq_m.oocqmoddt,g_oocq_m.oocq001_desc,g_oocq_m.oocq003_desc, 
          g_oocq_m.oocqownid_desc,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid_desc,g_oocq_m.oocqcrtdp_desc, 
          g_oocq_m.oocqmodid_desc
      
      #將資料顯示到畫面上
      DISPLAY BY NAME g_oocq_m.oocq001,g_oocq_m.oocq001_desc,g_oocq_m.oocq002,g_oocq_m.oocql004,g_oocq_m.oocql005, 
          g_oocq_m.oocq003,g_oocq_m.oocq003_desc,g_oocq_m.oocqstus,g_oocq_m.oocq004,g_oocq_m.oocq004_desc, 
          g_oocq_m.oocq005,g_oocq_m.oocq005_desc,g_oocq_m.oocq006,g_oocq_m.oocq006_desc,g_oocq_m.oocq007, 
          g_oocq_m.oocq007_desc,g_oocq_m.oocq008,g_oocq_m.oocq008_desc,g_oocq_m.oocq009,g_oocq_m.oocq010, 
          g_oocq_m.oocq011,g_oocq_m.oocq012,g_oocq_m.oocq013,g_oocq_m.oocq014,g_oocq_m.oocq015,g_oocq_m.oocq016, 
          g_oocq_m.oocq017,g_oocq_m.oocq018,g_oocq_m.oocq019,g_oocq_m.oocq020,g_oocq_m.oocq021,g_oocq_m.oocq022, 
          g_oocq_m.oocq023,g_oocq_m.oocq024,g_oocq_m.oocq024_desc,g_oocq_m.oocq025,g_oocq_m.oocq025_desc, 
          g_oocq_m.oocq026,g_oocq_m.oocq026_desc,g_oocq_m.oocq027,g_oocq_m.oocq027_desc,g_oocq_m.oocq028, 
          g_oocq_m.oocq028_desc,g_oocq_m.oocq029,g_oocq_m.oocq030,g_oocq_m.oocq031,g_oocq_m.oocq032, 
          g_oocq_m.oocq033,g_oocq_m.oocq034,g_oocq_m.oocq035,g_oocq_m.oocq036,g_oocq_m.oocq037,g_oocq_m.oocq038, 
          g_oocq_m.oocq039,g_oocq_m.oocq040,g_oocq_m.oocq041,g_oocq_m.oocq042,g_oocq_m.oocq043,g_oocq_m.oocqownid, 
          g_oocq_m.oocqownid_desc,g_oocq_m.oocqowndp,g_oocq_m.oocqowndp_desc,g_oocq_m.oocqcrtid,g_oocq_m.oocqcrtid_desc, 
          g_oocq_m.oocqcrtdt,g_oocq_m.oocqcrtdp,g_oocq_m.oocqcrtdp_desc,g_oocq_m.oocqmodid,g_oocq_m.oocqmodid_desc, 
          g_oocq_m.oocqmoddt
   END IF
 
   #add-point:stus修改後 name="statechange.a_update"
   
   #end add-point
 
   #add-point:statechange段結束前 name="statechange.after"
   
   #end add-point  
 
   CLOSE aooi300_cl
   CALL s_transaction_end('Y','0')
 
   #功能已完成,通報訊息中心
   CALL aooi300_msgcentre_notify('statechange:'||lc_state)
   
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="aooi300.set_pk_array" >}
   #應用 a51 樣板自動產生(Version:8)
#+ 給予pk_array內容
PRIVATE FUNCTION aooi300_set_pk_array()
   #add-point:set_pk_array段define name="set_pk_array.define_customerization"
   
   #end add-point
   #add-point:set_pk_array段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="set_pk_array.define"
   
   #end add-point
   
   #add-point:Function前置處理 name="set_pk_array.before"
   
   #end add-point  
   
   #若l_ac<=0代表沒有資料
   IF l_ac <= 0 THEN
      RETURN
   END IF
   
   CALL g_pk_array.clear()
   LET g_pk_array[1].values = g_oocq_m.oocq001
   LET g_pk_array[1].column = 'oocq001'
   LET g_pk_array[2].values = g_oocq_m.oocq002
   LET g_pk_array[2].column = 'oocq002'
   
   #add-point:set_pk_array段之後 name="set_pk_array.after"
   
   #end add-point  
   
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="aooi300.msgcentre_notify" >}
#應用 a66 樣板自動產生(Version:6)
PRIVATE FUNCTION aooi300_msgcentre_notify(lc_state)
   #add-point:msgcentre_notify段define name="msgcentre_notify.define_customerization"
   
   #end add-point   
   DEFINE lc_state LIKE type_t.chr80
   #add-point:msgcentre_notify段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="msgcentre_notify.define"
   
   #end add-point
   
   #add-point:Function前置處理  name="msgcentre_notify.pre_function"
   
   #end add-point
   
   INITIALIZE g_msgparam TO NULL
 
   #action-id與狀態填寫
   LET g_msgparam.state = lc_state
 
   #PK資料填寫
   CALL aooi300_set_pk_array()
   #單頭資料填寫
   LET g_msgparam.data[1] = util.JSON.stringify(g_oocq_m)
 
   #add-point:msgcentre其他通知 name="msgcentre_notify.process"
   
   #end add-point
 
   #呼叫訊息中心傳遞本關完成訊息
   CALL cl_msgcentre_notify()
 
END FUNCTION
 
 
 
 
{</section>}
 
{<section id="aooi300.action_chk" >}
PRIVATE FUNCTION aooi300_action_chk()
   #add-point:action_chk段define(客製用) name="action_chk.define_customerization"
   
   #end add-point
   #add-point:action_chk段define(請盡量不要在客製環境修改此段落內容, 否則將後續patch的調整需人工處理) name="action_chk.define"
   
   #end add-point
   
   #add-point:action_chk段action_chk name="action_chk.action_chk"
   
   #end add-point
   
   RETURN TRUE
   
END FUNCTION
 
{</section>}
 
{<section id="aooi300.other_function" readonly="Y" >}
# 根據傳入的參數來設置參考欄位一到二十的名稱，顯示否
PRIVATE FUNCTION aooi300_set_title_visible(p_gzac001)
DEFINE p_gzac001 LIKE gzac_t.gzac001
   DEFINE l_sql     STRING 
   #DEFINE l_gzac    RECORD LIKE gzac_t.*  #161124-00048#7  2016/12/13 By 08734 mark
   #161124-00048#7  2016/12/13 By 08734 add(S)
   DEFINE l_gzac RECORD  #應用分類參考欄位畫面設定檔
       gzac001 LIKE gzac_t.gzac001, #应用分类
       gzac002 LIKE gzac_t.gzac002, #语言别
       gzac003 LIKE gzac_t.gzac003, #参考字段一
       gzac004 LIKE gzac_t.gzac004, #参考字段二
       gzac005 LIKE gzac_t.gzac005, #参考字段三
       gzac006 LIKE gzac_t.gzac006, #参考字段四
       gzac007 LIKE gzac_t.gzac007, #参考字段五
       gzac008 LIKE gzac_t.gzac008, #参考字段六
       gzac009 LIKE gzac_t.gzac009, #参考字段七
       gzac010 LIKE gzac_t.gzac010, #参考字段八
       gzac011 LIKE gzac_t.gzac011, #参考字段九
       gzac012 LIKE gzac_t.gzac012, #参考字段十
       gzac013 LIKE gzac_t.gzac013, #参考字段十一
       gzac014 LIKE gzac_t.gzac014, #参考字段十二
       gzac015 LIKE gzac_t.gzac015, #参考字段十三
       gzac016 LIKE gzac_t.gzac016, #参考字段十四
       gzac017 LIKE gzac_t.gzac017, #参考字段十五
       gzac018 LIKE gzac_t.gzac018, #参考字段十六
       gzac019 LIKE gzac_t.gzac019, #参考字段十七
       gzac020 LIKE gzac_t.gzac020, #参考字段十八
       gzac021 LIKE gzac_t.gzac021, #参考字段十九
       gzac022 LIKE gzac_t.gzac022, #参考字段二十
       gzac023 LIKE gzac_t.gzac023, #应用分类码
       gzac024 LIKE gzac_t.gzac024 #上层应用分类码
END RECORD
#161124-00048#7  2016/12/13 By 08734 add(E)
   DEFINE l_str_field LIKE type_t.chr7
   DEFINE l_str_field_bef LIKE type_t.chr3
   DEFINE l_cnt    LIKE type_t.num5
   DEFINE l_gzad   RECORD
                   gzad001 LIKE gzad_t.gzad001,
                   gzad002 LIKE gzad_t.gzad002,
                   gzad003 LIKE gzad_t.gzad003,
                   gzad004 LIKE gzad_t.gzad004,
                   gzad006 LIKE gzad_t.gzad006
                   END RECORD 
   LET l_cnt = 0
   SELECT COUNT(*) INTO l_cnt FROM gzad_t
    WHERE gzad001 = p_gzac001
      AND gzad003 = 'Y'
   IF l_cnt = 0 THEN 
      RETURN
   END IF
   CALL cl_set_comp_visible("page_2",TRUE) 
     
   #SELECT * INTO l_gzac.* FROM gzac_t  #161124-00048#7  2016/12/13 By 08734 mark
   SELECT gzac001,gzac002,gzac003,gzac004,gzac005,gzac006,gzac007,gzac008,gzac009,gzac010,gzac011,gzac012,gzac013,gzac014,gzac015,gzac016,gzac017,gzac018,gzac019,gzac020,gzac021,gzac022,gzac023,gzac024 
      INTO l_gzac.* FROM gzac_t  #161124-00048#7  2016/12/13 By 08734 add
    WHERE gzac001 = p_gzac001 AND gzac002 = g_dlang
  #對標題賦值
   CALL cl_set_comp_att_text('lbl_oocq004',l_gzac.gzac003)
   CALL cl_set_comp_att_text('lbl_oocq005',l_gzac.gzac004)
   CALL cl_set_comp_att_text('lbl_oocq006',l_gzac.gzac005)
   CALL cl_set_comp_att_text('lbl_oocq007',l_gzac.gzac006)
   CALL cl_set_comp_att_text('lbl_oocq008',l_gzac.gzac007)
   CALL cl_set_comp_att_text('lbl_oocq009',l_gzac.gzac008)
   CALL cl_set_comp_att_text('lbl_oocq010',l_gzac.gzac009)
   CALL cl_set_comp_att_text('lbl_oocq011',l_gzac.gzac010)
   CALL cl_set_comp_att_text('lbl_oocq012',l_gzac.gzac011)
   CALL cl_set_comp_att_text('lbl_oocq013',l_gzac.gzac012)
   CALL aooi300_set_comp_att_text('oocq014',l_gzac.gzac013)
   CALL aooi300_set_comp_att_text('oocq015',l_gzac.gzac014)
   CALL aooi300_set_comp_att_text('oocq016',l_gzac.gzac015)
   CALL aooi300_set_comp_att_text('oocq017',l_gzac.gzac016)
   CALL aooi300_set_comp_att_text('oocq018',l_gzac.gzac017)
   CALL cl_set_comp_att_text('lbl_oocq019',l_gzac.gzac018)
   CALL cl_set_comp_att_text('lbl_oocq020',l_gzac.gzac019)
   CALL cl_set_comp_att_text('lbl_oocq021',l_gzac.gzac020)
   CALL cl_set_comp_att_text('lbl_oocq022',l_gzac.gzac021)
   CALL cl_set_comp_att_text('lbl_oocq023',l_gzac.gzac022) 
   CALL cl_set_comp_att_text('lbl_oocq002',l_gzac.gzac023)
   CALL cl_set_comp_att_text('lbl_oocq003',l_gzac.gzac024) 
   
   CALL cl_set_comp_att_text('b_oocq004',l_gzac.gzac003)
   CALL cl_set_comp_att_text('b_oocq005',l_gzac.gzac004)
   CALL cl_set_comp_att_text('b_oocq006',l_gzac.gzac005)
   CALL cl_set_comp_att_text('b_oocq007',l_gzac.gzac006)
   CALL cl_set_comp_att_text('b_oocq008',l_gzac.gzac007)
   CALL cl_set_comp_att_text('b_oocq009',l_gzac.gzac008)
   CALL cl_set_comp_att_text('b_oocq010',l_gzac.gzac009)
   CALL cl_set_comp_att_text('b_oocq011',l_gzac.gzac010)
   CALL cl_set_comp_att_text('b_oocq012',l_gzac.gzac011)
   CALL cl_set_comp_att_text('b_oocq013',l_gzac.gzac012)
   CALL cl_set_comp_att_text('b_oocq014',l_gzac.gzac013)
   CALL cl_set_comp_att_text('b_oocq015',l_gzac.gzac014)
   CALL cl_set_comp_att_text('b_oocq016',l_gzac.gzac015)
   CALL cl_set_comp_att_text('b_oocq017',l_gzac.gzac016)
   CALL cl_set_comp_att_text('b_oocq018',l_gzac.gzac017)
   CALL cl_set_comp_att_text('b_oocq019',l_gzac.gzac018)
   CALL cl_set_comp_att_text('b_oocq020',l_gzac.gzac019)
   CALL cl_set_comp_att_text('b_oocq021',l_gzac.gzac020)
   CALL cl_set_comp_att_text('b_oocq022',l_gzac.gzac021)
   CALL cl_set_comp_att_text('b_oocq023',l_gzac.gzac022)
  #查看顯示否和是否為必要欄位
   LET l_sql = " SELECT gzad001,gzad002,gzad003,gzad004,gzad006 ",
               "   FROM gzad_t ",
               "  WHERE gzad001 = '",p_gzac001,"'"
   PREPARE aooi300_title_pre FROM l_sql 
   DECLARE aooi300_title_cur CURSOR FOR aooi300_title_pre 
  #抓取gzad_t的資料，然後根據資料來設定欄位是否可見 
   FOREACH  aooi300_title_cur INTO l_gzad.*
     #對應到oocq中的欄位數值= 參考欄位編號+3
      LET l_gzad.gzad002 = l_gzad.gzad002+3 
      LET l_str_field_bef = l_gzad.gzad002 USING '&&&'
      LET l_str_field = 'oocq' CLIPPED,l_str_field_bef CLIPPED 
     #根據gzad003來判斷欄位是否顯示
      IF l_gzad.gzad003 = 'Y' THEN
         CALL cl_set_comp_visible(l_str_field,TRUE) 
         CALL cl_set_comp_visible("b_"||l_str_field,TRUE)
         CALL cl_set_comp_visible('lbl_'||l_str_field,TRUE) 
         CALL cl_set_comp_visible(l_str_field||'_desc',TRUE)         
        #根據gzad004來判斷欄位是否required
         IF l_gzad.gzad004 = 'Y' THEN
            CALL cl_set_comp_required(l_str_field,FALSE)
         ELSE
            CALL cl_set_comp_required(l_str_field,TRUE)
         END IF 
         IF l_gzad.gzad002 >= 19 AND l_gzad.gzad002 <= 21 THEN
            CALL cl_set_combo_scc(l_str_field,l_gzad.gzad006)
         END IF
      ELSE
         CALL cl_set_comp_visible('lbl_'||l_str_field,FALSE)
         CALL cl_set_comp_visible(l_str_field,FALSE) 
         CALL cl_set_comp_visible(l_str_field||'_desc',FALSE) 
         CALL cl_set_comp_visible('b_'||l_str_field,FALSE)
      END IF 
   END FOREACH
END FUNCTION

PRIVATE FUNCTION aooi300_oocq003_ref()
INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocq001
   LET g_ref_fields[2] = g_oocq_m.oocq002
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_oocq_m.oocq003_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocq003_desc
END FUNCTION
# 參考欄位開窗統一functionn
PRIVATE FUNCTION aooi300_open_qry(p_gzad002,p_gzad001,p_oocq_def)
DEFINE p_gzad002 LIKE gzad_t.gzad002
   DEFINE p_gzad001 LIKE gzad_t.gzad001
   DEFINE p_oocq_def LIKE oocq_t.oocq004
   DEFINE r_return  STRING
   DEFINE l_gzad005 LIKE gzad_t.gzad005 
   DEFINE l_gzad006 LIKE gzad_t.gzad006
   DEFINE l_gzad007 LIKE gzad_t.gzad007
   IF cl_null(p_gzad001) THEN LET p_gzad001 = g_argv[1] END IF
   SELECT gzad005,gzad006,gzad007 INTO l_gzad005,l_gzad006,l_gzad007 FROM gzad_t 
    WHERE gzad001 = p_gzad001 AND gzad002 = p_gzad002
   IF p_gzad002 >6 THEN RETURN p_oocq_def END IF 
   IF cl_null(l_gzad005) OR cl_null(l_gzad007) THEN
      RETURN p_oocq_def 
   ELSE 
      IF l_gzad005 = 1 THEN
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = p_oocq_def #給予default值
         LET g_qryparam.arg1 = l_gzad006#給予arg 
        
         CALL q_gzcb001()                                 #呼叫開窗
         LET r_return = g_qryparam.return1  #將開窗取得的值回傳到變數
         RETURN r_return
      END IF 
      IF l_gzad005 = 2 THEN
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = p_oocq_def #給予default值
        #給予arg
         #CALL q_total(l_gzad007)           #呼叫開窗
         CALL q_azzi650(l_gzad007)
         LET r_return = g_qryparam.return1  #將開窗取得的值回傳到變數
         RETURN r_return
      END IF 
      IF l_gzad005 = 4 THEN
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = p_oocq_def #給予default值
        #給予arg 
         LET g_qryparam.arg1 = l_gzad006
         #CALL q_total(l_gzad007)           #呼叫開窗
         CALL q_oocq002()
         LET r_return = g_qryparam.return1  #將開窗取得的值回傳到變數
         RETURN r_return
      END IF 
   END IF 
   RETURN p_oocq_def
END FUNCTION
#+
PRIVATE FUNCTION aooi300_set_comp_att_text(ps_fields,ps_att_value)
   DEFINE   ps_fields          STRING,
            ps_att_value       STRING
   DEFINE   lst_fields         base.StringTokenizer,
            lst_string         base.StringTokenizer,
            ls_field_name      STRING,
            ls_field_value     STRING,
            ls_win_name        STRING
   DEFINE   lnode_root         om.DomNode,
            lnode_win          om.DomNode,
            lnode_pre          om.DomNode,
            llst_items         om.NodeList,
            lnode_list         om.NodeList,  
            li_i               LIKE type_t.num5,             
            lnode_item         om.DomNode,
            ls_item_name       STRING,
            lnode_item_child   om.DomNode,
            ls_item_pre_tag    STRING,
            ls_item_tag_name   STRING
   DEFINE   g_chg              DYNAMIC ARRAY OF RECORD
               item            STRING,
               value           STRING
                               END RECORD
   DEFINE   lwin_curr          ui.Window
   DEFINE   ls_btn_name        STRING                           
   DEFINE l_str STRING
   DEFINE l_cnt SMALLINT
   DEFINE   lnode_p            om.DomNode,            
            ls_item_tag_name_p STRING,                
            ls_item_name_p     STRING,                   
            ls_str_p           LIKE type_t.chr100  

   IF g_bgjob = 'Y' AND g_gui_type NOT MATCHES "[13]"  THEN   
 
      RETURN
   END IF

          
   IF (ps_fields IS NULL) THEN
      RETURN
   ELSE
      LET ps_fields = ps_fields.toLowerCase()
   END IF
  
   LET lwin_curr = ui.Window.getCurrent()
   LET lnode_win = lwin_curr.getNode()
   LET ls_win_name = lnode_win.getAttribute("name")
 
   LET llst_items = lnode_win.selectByPath("//Form//*")    
   LET lst_fields = base.StringTokenizer.create(ps_fields, ",")
   LET lst_string = base.StringTokenizer.create(ps_att_value,",")
   WHILE lst_fields.hasMoreTokens() AND lst_string.hasMoreTokens()
      LET ls_field_name = lst_fields.nextToken()
      LET ls_field_value = lst_string.nextToken()
      LET ls_field_name = ls_field_name.trim()
 
      IF ls_field_name.equals(ls_win_name) THEN
         CALL lnode_win.setAttribute("text",ls_field_value)
      END IF
 
      FOR li_i = 1 TO llst_items.getLength()
         LET lnode_item = llst_items.item(li_i)
         LET ls_item_name = lnode_item.getAttribute("colName")
 
         IF (ls_item_name IS NULL) THEN
            LET ls_item_name = lnode_item.getAttribute("name")

            LET ls_item_tag_name = lnode_item.getTagName()
            IF ls_item_tag_name.equals("Item") THEN
               IF (ls_item_name IS NOT NULL) THEN
            	    LET lnode_p = lnode_item.getParent()   #取父結點
                  LET ls_item_tag_name_p = lnode_p.getTagName()   #父結點類型
                  IF ls_item_tag_name_p.equals("RadioGroup") OR ls_item_tag_name_p.equals("ComboBox") THEN
                  	 LET ls_item_name_p = lnode_p.getAttribute("comment")  #取comment因為裡面一定會有[***]
                  	 LET ls_str_p = ls_item_name_p     
                  	 #取[]之間的東西
                  	 select substr(ls_str_p,instr(ls_str_p,'[',1)+1,length(ls_str_p)-instr(ls_str_p,'[',1)-1) INTO ls_str_p from dual
                  	 LET ls_item_name = ls_str_p CLIPPED || '_' || ls_item_name
                  END IF
               END IF
            END IF  

            IF (ls_item_name IS NULL) THEN
               CONTINUE FOR
            END IF
         END IF
      
         IF (ls_item_name.equals(ls_field_name)) THEN
            LET ls_item_tag_name = lnode_item.getTagName()
            LET lnode_list = lnode_item.selectByTagName("CheckBox")
            LET l_cnt = lnode_list.getlength()
            IF ls_item_tag_name.equals("TableColumn") OR
               ls_item_tag_name.equals("Page") OR     
               ls_item_tag_name.equals("Item") OR   
               ls_item_tag_name.equals("Group") OR      
               ls_item_tag_name.equals("Label") OR    
               ls_item_tag_name.equals("Window")OR
               ls_item_tag_name.equals("Button") THEN   
               CALL lnode_item.setAttribute("text",ls_field_value.trim())  
            ELSE
               IF l_cnt > 0 THEN
                  LET lnode_item_child = lnode_item.getFirstChild()
                  CALL lnode_item_child.setAttribute("text",ls_field_value.trim())
               ELSE
                  LET lnode_pre = lnode_item.getPrevious()
                  LET ls_item_pre_tag = lnode_pre.getTagName()
                  IF ls_item_pre_tag.equals("Label") THEN
                     CALL lnode_pre.setAttribute("text",ls_field_value.trim()) 
                  ELSE
                     IF ls_item_pre_tag.equals("Button") THEN
                        LET ls_btn_name = lnode_pre.getAttribute("name")
                        IF ls_btn_name.subString(1,4) = "btn_" THEN
                           LET lnode_pre = lnode_pre.getPrevious()
                           LET ls_item_pre_tag = lnode_pre.getTagName()
                           IF ls_item_pre_tag.equals("Label") THEN
                              CALL lnode_pre.setAttribute("text",ls_field_value.trim())
                           END IF
                        END IF
                     END IF
                  END IF
              END IF 
            END IF
            EXIT FOR
         END IF
      END FOR
   END WHILE
END FUNCTION
# 根據傳入的參數來判斷oocq003是否開放
# 手工關閉oocq001欄位
PRIVATE FUNCTION aooi300_arg_entry(p_gzaa001)
DEFINE p_gzaa001 LIKE gzaa_t.gzaa001
   DEFINE l_gzaa003 LIKE gzaa_t.gzaa003
   
   SELECT gzaa003 INTO l_gzaa003 FROM gzaa_t WHERE gzaa001 = p_gzaa001
   IF l_gzaa003 = 'Y' THEN
      CALL cl_set_comp_entry('oocq003',TRUE)
   ELSE
      CALL cl_set_comp_entry('oocq003',FALSE)
   END IF
   CALL cl_set_comp_entry('oocq001',FALSE)
END FUNCTION

PRIVATE FUNCTION aooi300_oocq001_ref()
INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_oocq_m.oocq001
   CALL ap_ref_array2(g_ref_fields,"SELECT gzaal003 FROM gzaal_t WHERE gzaal001=? AND gzaal002='"||g_lang||"'","") RETURNING g_rtn_fields
   LET g_oocq_m.oocq001_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_oocq_m.oocq001_desc
END FUNCTION

PRIVATE FUNCTION aooi300_oocq002_chk(p_cmd,p_oocq001,p_oocq002)
DEFINE p_cmd LIKE type_t.chr1
   DEFINE p_oocq001 LIKE oocq_t.oocq001
   DEFINE p_oocq002 LIKE oocq_t.oocq002
   IF NOT cl_null(p_oocq001) AND NOT cl_null(p_oocq002) THEN 
      IF p_cmd = 'a' OR ( p_cmd = 'u' AND ( p_cmd = 'u' AND (p_oocq001 != g_oocq001_t  OR p_oocq002 != g_oocq002_t ))) THEN 
         IF NOT ap_chk_notDup(p_oocq002,"SELECT COUNT(*) FROM oocq_t WHERE "||"oocqent = '" 
	    ||g_enterprise|| "' AND "||"oocq001 = '"||p_oocq001 ||"' AND "|| "oocq002 = '"||p_oocq002 ||"'",'std-00004',0) THEN 
            RETURN FALSE
         END IF
      END IF
   END IF
   RETURN TRUE
END FUNCTION

PRIVATE FUNCTION aooi300_oocq003_chk(p_cmd,p_oocq001,p_oocq002,p_oocq003)
DEFINE p_cmd LIKE type_t.chr1
   DEFINE p_oocq001 LIKE oocq_t.oocq001
   DEFINE p_oocq002 LIKE oocq_t.oocq002
   DEFINE p_oocq003 LIKE oocq_t.oocq003 
   IF p_oocq003 <> p_oocq002 AND p_oocq001 <> p_oocq003 THEN 
      IF NOT ap_chk_isExist(p_oocq003,"SELECT COUNT(*) FROM oocq_t WHERE oocqent = " ||g_enterprise|| " AND oocq002 = ?  AND oocq001 = '"||p_oocq001||"'",'aoo-00099',1)  THEN  #160905-00007#9 add oocqent = " ||g_enterprise|| " AND
         RETURN FALSE
      END IF
      IF NOT ap_chk_isExist(p_oocq003,"SELECT COUNT(*) FROM oocq_t WHERE oocqent = " ||g_enterprise|| " AND oocq002 = ?  AND oocqstus = 'Y' AND oocq001 = '"||p_oocq001||"'",'sub-01302',"azzi650")  THEN   #aoo-00100 #160318-00005#30 by 07900 --mod #160905-00007#9 add oocqent = " ||g_enterprise|| " AND
         RETURN FALSE
      END IF
   END IF
   RETURN TRUE
END FUNCTION
#+
PRIVATE FUNCTION aooi300_make_sql(p_gzad015,p_gzad016,p_gzad017,p_field_str)
DEFINE p_gzad015 LIKE gzad_t.gzad015
   DEFINE p_gzad016 LIKE gzad_t.gzad016
   DEFINE p_gzad017 LIKE gzad_t.gzad017
   DEFINE p_field_str LIKE oocq_t.oocq004
   DEFINE l_dzeb002 LIKE dzeb_t.dzeb002
   DEFINE l_dzeb006 LIKE dzeb_t.dzeb006
   DEFINE l_sql     STRING
   DEFINE r_sql     STRING

   LET r_sql = " SELECT ",p_gzad016," FROM ",p_gzad015,
               "  WHERE ",p_gzad017," = ? "
   LET l_sql = "SELECT dzeb002,dzeb006 FROM dzeb_t ",
               " WHERE dzeb001 = '",p_gzad015,"'",
               "   AND dzeb004 = 'Y' AND dzeb003 !='",p_gzad017,"'"
   PREPARE aooi301_make_sql_pre FROM l_sql
   DECLARE aooi301_make_sql_cs CURSOR FOR aooi301_make_sql_pre
   FOREACH aooi301_make_sql_cs INTO l_dzeb002,l_dzeb006
      IF l_dzeb006 = 'N802' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_enterprise,"' "

      END IF
      IF l_dzeb006 = 'C800' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_dlang,"' "

      END IF
   END FOREACH
   RETURN r_sql
END FUNCTION
# 參考欄位一到二十的chk
PRIVATE FUNCTION aooi300_chklw_chk(p_gzaa001,p_gzad002,p_field)
DEFINE p_gzaa001 LIKE gzaa_t.gzaa001
   DEFINE p_gzad002 LIKE gzad_t.gzad002
   DEFINE p_field LIKE type_t.chr50
   DEFINE l_min_type    LIKE type_t.chr1
   DEFINE l_max_type    LIKE type_t.chr1
   DEFINE l_gzad005 LIKE gzad_t.gzad005
   DEFINE l_gzad006 LIKE gzad_t.gzad006
   DEFINE l_gzad008 LIKE gzad_t.gzad008
   DEFINE l_gzad009 LIKE gzad_t.gzad009
   DEFINE l_gzad010 LIKE gzad_t.gzad010
   DEFINE l_gzad011 LIKE gzad_t.gzad011
   DEFINE l_gzad012 LIKE gzad_t.gzad012
   DEFINE l_gzad013 LIKE gzad_t.gzad013
   DEFINE r_success LIKE type_t.num5

  #空值判斷
   IF cl_null(p_gzaa001) OR cl_null(p_gzad002) OR cl_null(p_field) THEN
      RETURN TRUE
   END IF 
   IF p_gzad002 >10 THEN RETURN TRUE END IF 
   SELECT gzad005,gzad006,gzad008,gzad009,gzad010,gzad011,gzad012,gzad013
     INTO l_gzad005,l_gzad006,l_gzad008,l_gzad009,l_gzad010,
          l_gzad011,l_gzad012,l_gzad013 
     FROM gzad_t
    WHERE gzad001 = p_gzaa001 AND gzad002 = p_gzad002
  #1.系統分類碼
   IF l_gzad005 = '1' THEN
      IF cl_null(l_gzad006) OR cl_null(l_gzad008) THEN
         RETURN TRUE
      ELSE
        #資料檢查
        INITIALIZE g_chkparam.* TO NULL

        #設定g_chkparam.*的參數
        LET g_chkparam.arg1 = l_gzad006
        LET g_chkparam.arg2 = p_field
        #呼叫檢查存在並帶值的library
        IF cl_chk_exist(l_gzad008) THEN
           #檢查成功時後續處理
           RETURN TRUE 
        ELSE
           #檢查失敗時後續處理
           RETURN FALSE 
        END IF
      END IF 
      
   END IF 
  #2.建檔開窗
   IF l_gzad005 = '2' THEN 
      IF cl_null(l_gzad008) THEN
         RETURN TRUE
      ELSE
        #資料檢查
        INITIALIZE g_chkparam.* TO NULL

        #設定g_chkparam.*的參數
        LET g_chkparam.arg1 = p_field
        #呼叫檢查存在並帶值的library
        IF cl_chk_exist(l_gzad008) THEN
           #檢查成功時後續處理
           RETURN TRUE 
        ELSE
           #檢查失敗時後續處理
           RETURN FALSE 
        END IF
      END IF 
   END IF 
  #3.自行輸入
   IF l_gzad005 = '3' THEN 
      IF l_gzad009 = '2' THEN
         CALL s_num_isnum(p_field) RETURNING r_success
         IF r_success = FALSE THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aoo-00266'
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()

         END IF

         IF (NOT cl_null(l_gzad010) AND NOT cl_null(l_gzad011)) OR
            (NOT cl_null(l_gzad012) AND NOT cl_null(l_gzad013)) THEN 
            LET l_min_type = 0
            IF l_gzad010 = '>=' THEN LET l_min_type = 1 END IF 
            LET l_max_type = 0
            IF l_gzad012 = '<=' THEN LET l_max_type = 1 END IF 
            IF NOT cl_ap_chk_Range(p_field,l_gzad011,l_min_type,l_gzad013,l_max_type,'-3420',1) THEN
               RETURN FALSE
            END IF 
         END IF 
      END IF 
   END IF  
   #4.應用分類碼
   IF l_gzad005 = '4' THEN
      IF cl_null(l_gzad006) OR cl_null(l_gzad008) THEN
         RETURN TRUE
      ELSE
        #資料檢查
        INITIALIZE g_chkparam.* TO NULL

        #設定g_chkparam.*的參數
        LET g_chkparam.arg1 = l_gzad006
        LET g_chkparam.arg2 = p_field
        #呼叫檢查存在並帶值的library
        IF cl_chk_exist_and_ref_val("v_oocq002") THEN
           #檢查成功時後續處理
           IF g_chkparam.return1 = 'N' THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'sub-01302' #aoo-00100  #160318-00005#30 by 07900 --mod
              LET g_errparam.extend = ''
              #160318-00005#31  By 07900 --add-str
              LET g_errparam.replace[1] ='azzi650'
              LET g_errparam.replace[2] = cl_get_progname("azzi650",g_lang,"2")
              LET g_errparam.exeprog ='azzi650'
              #160318-00005#31  By 07900 --add-end
              LET g_errparam.popup = TRUE
              CALL cl_err()

              RETURN FALSE
           ELSE            
              #檢查成功時後續處理
              RETURN TRUE 
           END IF 
        ELSE
           #檢查失敗時後續處理
           RETURN FALSE 
        END IF
      END IF 
      
   END IF 
   RETURN TRUE
END FUNCTION
# 參考欄位的ref
PRIVATE FUNCTION aooi300_cklw_ref(p_oocq_cklw,p_gzad001,p_gzad002)
DEFINE p_oocq_cklw LIKE oocq_t.oocq004
   DEFINE p_gzad001   LIKE gzad_t.gzad001
   DEFINE p_gzad002   LIKE gzad_t.gzad002
   DEFINE r_gzcal003  LIKE gzcal_t.gzcal003
   DEFINE l_gzad005   LIKE gzad_t.gzad005 
   DEFINE l_gzad006   LIKE gzad_t.gzad006
   DEFINE l_sql       STRING
   DEFINE l_gzad015   LIKE gzad_t.gzad015
   DEFINE l_gzad016   LIKE gzad_t.gzad016
   DEFINE l_gzad017   LIKE gzad_t.gzad017
   LET l_gzad005 = ''
   LET l_gzad006 = ''
   LET r_gzcal003 = ' '
   
   SELECT gzad005,gzad006 INTO l_gzad005,l_gzad006 FROM gzad_t 
    WHERE gzad001 = p_gzad001 AND gzad002 = p_gzad002
   IF l_gzad005 = '1' THEN 
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = l_gzad006
      LET g_ref_fields[2] = p_oocq_cklw 
      CALL ap_ref_array2(g_ref_fields,"SELECT gzcbl004 FROM gzcbl_t WHERE gzcbl001=? AND gzcbl002 = ? AND gzcbl003='"||g_lang||"'","") RETURNING g_rtn_fields
      LET r_gzcal003 = g_rtn_fields[1]
      RETURN r_gzcal003
   END IF 
   IF l_gzad005 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = p_oocq_cklw
      LET l_gzad015 = ''
      LET l_gzad016 = ''
      LET l_gzad017 = ''
      SELECT gzad015,gzad016,gzad017 INTO l_gzad015,l_gzad016,l_gzad017 FROM gzad_t
       WHERE gzad001 = p_gzad001 AND gzad002 = p_gzad002
      CALL aooi300_make_sql(l_gzad015,l_gzad016,l_gzad017,p_oocq_cklw) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET r_gzcal003 =g_rtn_fields[1]
      RETURN r_gzcal003
   END IF
   
   IF l_gzad005 = '4' THEN 
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = l_gzad006
      LET g_ref_fields[2] = p_oocq_cklw 
      CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent = '"
          ||g_enterprise||"' AND oocql001=? AND oocql002 = ? AND oocql003='"||g_lang||"'","") RETURNING g_rtn_fields 
      LET r_gzcal003 = g_rtn_fields[1]
      RETURN r_gzcal003
   END IF 
   RETURN ' '
END FUNCTION

PRIVATE FUNCTION aooi300_def_oocq_t(p_gzad001)
DEFINE p_gzad001 LIKE gzad_t.gzad001
DEFINE l_sql     STRING 


   LET l_sql = " SELECT gzad014 FROM gzad_t ",
               "  WHERE gzad001 = '",p_gzad001,"' AND gzad002 = ? "
   PREPARE aooi300_gzad014_pre FROM l_sql
   EXECUTE aooi300_gzad014_pre USING '1' INTO g_oocq_m.oocq004
   EXECUTE aooi300_gzad014_pre USING '2' INTO g_oocq_m.oocq005
   EXECUTE aooi300_gzad014_pre USING '3' INTO g_oocq_m.oocq006
   EXECUTE aooi300_gzad014_pre USING '4' INTO g_oocq_m.oocq007
   EXECUTE aooi300_gzad014_pre USING '5' INTO g_oocq_m.oocq008
   EXECUTE aooi300_gzad014_pre USING '6' INTO g_oocq_m.oocq009
   EXECUTE aooi300_gzad014_pre USING '7' INTO g_oocq_m.oocq010
   EXECUTE aooi300_gzad014_pre USING '8' INTO g_oocq_m.oocq011
   EXECUTE aooi300_gzad014_pre USING '9' INTO g_oocq_m.oocq012
   EXECUTE aooi300_gzad014_pre USING '10' INTO g_oocq_m.oocq013
   EXECUTE aooi300_gzad014_pre USING '11' INTO g_oocq_m.oocq014
   EXECUTE aooi300_gzad014_pre USING '12' INTO g_oocq_m.oocq015
   EXECUTE aooi300_gzad014_pre USING '13' INTO g_oocq_m.oocq016
   EXECUTE aooi300_gzad014_pre USING '14' INTO g_oocq_m.oocq017
   EXECUTE aooi300_gzad014_pre USING '15' INTO g_oocq_m.oocq018
   EXECUTE aooi300_gzad014_pre USING '16' INTO g_oocq_m.oocq019
   EXECUTE aooi300_gzad014_pre USING '17' INTO g_oocq_m.oocq020
   EXECUTE aooi300_gzad014_pre USING '18' INTO g_oocq_m.oocq021
   EXECUTE aooi300_gzad014_pre USING '19' INTO g_oocq_m.oocq022
   EXECUTE aooi300_gzad014_pre USING '20' INTO g_oocq_m.oocq023 
   CALL aooi300_cklw_ref(g_oocq_m.oocq004,p_gzad001,'1') RETURNING g_oocq_m.oocq004_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq005,p_gzad001,'2') RETURNING g_oocq_m.oocq005_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq006,p_gzad001,'3') RETURNING g_oocq_m.oocq006_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq007,p_gzad001,'4') RETURNING g_oocq_m.oocq007_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq008,p_gzad001,'5') RETURNING g_oocq_m.oocq008_desc

   DISPLAY g_oocq_m.oocq004_desc TO oocq004_desc
   DISPLAY g_oocq_m.oocq005_desc TO oocq005_desc
   DISPLAY g_oocq_m.oocq006_desc TO oocq006_desc
   DISPLAY g_oocq_m.oocq007_desc TO oocq007_desc
   DISPLAY g_oocq_m.oocq008_desc TO oocq008_desc
   
   -------------------------------------------------------------------------------------
   
   LET l_sql = " SELECT gzaj014 FROM gzaj_t ",
               "  WHERE gzaj001 = '",p_gzad001,"' AND gzaj002 = ? "
   PREPARE aooi300_gzaj014_pre FROM l_sql
   EXECUTE aooi300_gzaj014_pre USING '1' INTO g_oocq_m.oocq024
   EXECUTE aooi300_gzaj014_pre USING '2' INTO g_oocq_m.oocq025
   EXECUTE aooi300_gzaj014_pre USING '3' INTO g_oocq_m.oocq026
   EXECUTE aooi300_gzaj014_pre USING '4' INTO g_oocq_m.oocq027
   EXECUTE aooi300_gzaj014_pre USING '5' INTO g_oocq_m.oocq028
   EXECUTE aooi300_gzaj014_pre USING '6' INTO g_oocq_m.oocq029
   EXECUTE aooi300_gzaj014_pre USING '7' INTO g_oocq_m.oocq030
   EXECUTE aooi300_gzaj014_pre USING '8' INTO g_oocq_m.oocq031
   EXECUTE aooi300_gzaj014_pre USING '9' INTO g_oocq_m.oocq032
   EXECUTE aooi300_gzaj014_pre USING '10' INTO g_oocq_m.oocq033
   EXECUTE aooi300_gzaj014_pre USING '11' INTO g_oocq_m.oocq034
   EXECUTE aooi300_gzaj014_pre USING '12' INTO g_oocq_m.oocq035
   EXECUTE aooi300_gzaj014_pre USING '13' INTO g_oocq_m.oocq036
   EXECUTE aooi300_gzaj014_pre USING '14' INTO g_oocq_m.oocq037
   EXECUTE aooi300_gzaj014_pre USING '15' INTO g_oocq_m.oocq038
   EXECUTE aooi300_gzaj014_pre USING '16' INTO g_oocq_m.oocq039
   EXECUTE aooi300_gzaj014_pre USING '17' INTO g_oocq_m.oocq040
   EXECUTE aooi300_gzaj014_pre USING '18' INTO g_oocq_m.oocq041
   EXECUTE aooi300_gzaj014_pre USING '19' INTO g_oocq_m.oocq042
   EXECUTE aooi300_gzaj014_pre USING '20' INTO g_oocq_m.oocq043 
   CALL aooi300_cklw_ref(g_oocq_m.oocq024,p_gzad001,'1') RETURNING g_oocq_m.oocq024_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq025,p_gzad001,'2') RETURNING g_oocq_m.oocq025_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq026,p_gzad001,'3') RETURNING g_oocq_m.oocq026_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq027,p_gzad001,'4') RETURNING g_oocq_m.oocq027_desc
   CALL aooi300_cklw_ref(g_oocq_m.oocq028,p_gzad001,'5') RETURNING g_oocq_m.oocq028_desc

   DISPLAY BY NAME g_oocq_m.oocq024_desc
   DISPLAY BY NAME g_oocq_m.oocq025_desc
   DISPLAY BY NAME g_oocq_m.oocq026_desc
   DISPLAY BY NAME g_oocq_m.oocq027_desc
   DISPLAY BY NAME g_oocq_m.oocq028_desc   

END FUNCTION

PRIVATE FUNCTION aooi300_cklw_ref2(p_oocq_cklw,p_gzaj001,p_gzaj002)
DEFINE p_oocq_cklw LIKE oocq_t.oocq004
DEFINE p_gzaj001   LIKE gzaj_t.gzaj001
DEFINE p_gzaj002   LIKE gzaj_t.gzaj002
DEFINE r_gzcal003  LIKE gzcal_t.gzcal003
DEFINE l_gzaj005   LIKE gzaj_t.gzaj005 
DEFINE l_gzaj006   LIKE gzaj_t.gzaj006
DEFINE l_sql       STRING
DEFINE l_gzaj015   LIKE gzaj_t.gzaj015
DEFINE l_gzaj016   LIKE gzaj_t.gzaj016
DEFINE l_gzaj017   LIKE gzaj_t.gzaj017

   LET l_gzaj005 = ''
   LET l_gzaj006 = ''
   LET r_gzcal003 = ' '
   
   SELECT gzaj005,gzaj006 INTO l_gzaj005,l_gzaj006 FROM gzaj_t 
    WHERE gzaj001 = p_gzaj001 AND gzaj002 = p_gzaj002
   IF l_gzaj005 = '1' THEN 
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = l_gzaj006
      LET g_ref_fields[2] = p_oocq_cklw 
      CALL ap_ref_array2(g_ref_fields,"SELECT gzcbl004 FROM gzcbl_t WHERE gzcbl001=? AND gzcbl002 = ? AND gzcbl003='"||g_lang||"'","") RETURNING g_rtn_fields
      LET r_gzcal003 = g_rtn_fields[1]
      RETURN r_gzcal003
   END IF 
   IF l_gzaj005 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = p_oocq_cklw
      LET l_gzaj015 = ''
      LET l_gzaj016 = ''
      LET l_gzaj017 = ''
      SELECT gzaj015,gzaj016,gzaj017 INTO l_gzaj015,l_gzaj016,l_gzaj017 FROM gzaj_t
       WHERE gzaj001 = p_gzaj001 AND gzaj002 = p_gzaj002
      CALL aooi300_make_sql2(l_gzaj015,l_gzaj016,l_gzaj017,p_oocq_cklw) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET r_gzcal003 =g_rtn_fields[1]
      RETURN r_gzcal003
   END IF
   
   IF l_gzaj005 = '4' THEN 
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = l_gzaj006
      LET g_ref_fields[2] = p_oocq_cklw 
      CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent = '"
          ||g_enterprise||"' AND oocql001=? AND oocql002 = ? AND oocql003='"||g_lang||"'","") RETURNING g_rtn_fields 
      LET r_gzcal003 = g_rtn_fields[1]
      RETURN r_gzcal003
   END IF 
   RETURN ' '
END FUNCTION

PRIVATE FUNCTION aooi300_make_sql2(p_gzaj015,p_gzaj016,p_gzaj017,p_field_str)
DEFINE p_gzaj015 LIKE gzaj_t.gzaj015
DEFINE p_gzaj016 LIKE gzaj_t.gzaj016
DEFINE p_gzaj017 LIKE gzaj_t.gzaj017
DEFINE p_field_str LIKE oocq_t.oocq004
DEFINE l_dzeb002 LIKE dzeb_t.dzeb002
DEFINE l_dzeb006 LIKE dzeb_t.dzeb006
DEFINE l_sql     STRING
DEFINE r_sql     STRING

   LET r_sql = " SELECT ",p_gzaj016," FROM ",p_gzaj015,
               "  WHERE ",p_gzaj017," = ? "
   LET l_sql = "SELECT dzeb002,dzeb006 FROM dzeb_t ",
               " WHERE dzeb001 = '",p_gzaj015,"'",
               "   AND dzeb004 = 'Y' AND dzeb003 !='",p_gzaj017,"'"
   PREPARE aooi301_make_sql_pre2 FROM l_sql
   DECLARE aooi301_make_sql_cs2 CURSOR FOR aooi301_make_sql_pre2
   FOREACH aooi301_make_sql_cs2 INTO l_dzeb002,l_dzeb006
      IF l_dzeb006 = 'N802' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_enterprise,"' "

      END IF
      IF l_dzeb006 = 'C800' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_dlang,"' "

      END IF
   END FOREACH
   RETURN r_sql
END FUNCTION

PRIVATE FUNCTION aooi300_chklw_chk2(p_gzaa001,p_gzaj002,p_field)
DEFINE p_gzaa001 LIKE gzaa_t.gzaa001
DEFINE p_gzaj002 LIKE gzaj_t.gzaj002
DEFINE p_field LIKE type_t.chr50
DEFINE l_min_type    LIKE type_t.chr1
DEFINE l_max_type    LIKE type_t.chr1
DEFINE l_gzaj005 LIKE gzaj_t.gzaj005
DEFINE l_gzaj006 LIKE gzaj_t.gzaj006
DEFINE l_gzaj008 LIKE gzaj_t.gzaj008
DEFINE l_gzaj009 LIKE gzaj_t.gzaj009
DEFINE l_gzaj010 LIKE gzaj_t.gzaj010
DEFINE l_gzaj011 LIKE gzaj_t.gzaj011
DEFINE l_gzaj012 LIKE gzaj_t.gzaj012
DEFINE l_gzaj013 LIKE gzaj_t.gzaj013
DEFINE r_success LIKE type_t.num5

  #空值判斷
   IF cl_null(p_gzaa001) OR cl_null(p_gzaj002) OR cl_null(p_field) THEN
      RETURN TRUE
   END IF 
   IF p_gzaj002 >10 THEN RETURN TRUE END IF 
   SELECT gzaj005,gzaj006,gzaj008,gzaj009,gzaj010,gzaj011,gzaj012,gzaj013
     INTO l_gzaj005,l_gzaj006,l_gzaj008,l_gzaj009,l_gzaj010,
          l_gzaj011,l_gzaj012,l_gzaj013 
     FROM gzaj_t
    WHERE gzaj001 = p_gzaa001 AND gzaj002 = p_gzaj002
  #1.系統分類碼
   IF l_gzaj005 = '1' THEN
      IF cl_null(l_gzaj006) OR cl_null(l_gzaj008) THEN
         RETURN TRUE
      ELSE
        #資料檢查
        INITIALIZE g_chkparam.* TO NULL

        #設定g_chkparam.*的參數
        LET g_chkparam.arg1 = l_gzaj006
        LET g_chkparam.arg2 = p_field
        #呼叫檢查存在並帶值的library
        IF cl_chk_exist(l_gzaj008) THEN
           #檢查成功時後續處理
           RETURN TRUE 
        ELSE
           #檢查失敗時後續處理
           RETURN FALSE 
        END IF
      END IF 
      
   END IF 
  #2.建檔開窗
   IF l_gzaj005 = '2' THEN 
      IF cl_null(l_gzaj008) THEN
         RETURN TRUE
      ELSE
        #資料檢查
        INITIALIZE g_chkparam.* TO NULL

        #設定g_chkparam.*的參數
        LET g_chkparam.arg1 = p_field
        #呼叫檢查存在並帶值的library
        IF cl_chk_exist(l_gzaj008) THEN
           #檢查成功時後續處理
           RETURN TRUE 
        ELSE
           #檢查失敗時後續處理
           RETURN FALSE 
        END IF
      END IF 
   END IF 
  #3.自行輸入
   IF l_gzaj005 = '3' THEN 
      IF l_gzaj009 = '2' THEN
         CALL s_num_isnum(p_field) RETURNING r_success
         IF r_success = FALSE THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'aoo-00266'
            LET g_errparam.extend = ''
            LET g_errparam.popup = TRUE
            CALL cl_err()

         END IF

         IF (NOT cl_null(l_gzaj010) AND NOT cl_null(l_gzaj011)) OR
            (NOT cl_null(l_gzaj012) AND NOT cl_null(l_gzaj013)) THEN 
            LET l_min_type = 0
            IF l_gzaj010 = '>=' THEN LET l_min_type = 1 END IF 
            LET l_max_type = 0
            IF l_gzaj012 = '<=' THEN LET l_max_type = 1 END IF 
            IF NOT cl_ap_chk_Range(p_field,l_gzaj011,l_min_type,l_gzaj013,l_max_type,'-3420',1) THEN
               RETURN FALSE
            END IF 
         END IF 
      END IF 
   END IF  
   #4.應用分類碼
   IF l_gzaj005 = '4' THEN
      IF cl_null(l_gzaj006) OR cl_null(l_gzaj008) THEN
         RETURN TRUE
      ELSE
        #資料檢查
        INITIALIZE g_chkparam.* TO NULL

        #設定g_chkparam.*的參數
        LET g_chkparam.arg1 = l_gzaj006
        LET g_chkparam.arg2 = p_field
        #呼叫檢查存在並帶值的library
        IF cl_chk_exist_and_ref_val("v_oocq002") THEN
           #檢查成功時後續處理
           IF g_chkparam.return1 = 'N' THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 'sub-01302'  #aoo-00100  #160318-00005#30 by 07900 --mod
              LET g_errparam.extend = ''
              #160318-00005#31  By 07900 --add-str
              LET g_errparam.replace[1] ='azzi650'
              LET g_errparam.replace[2] = cl_get_progname("azzi650",g_lang,"2")
              LET g_errparam.exeprog ='azzi650'
              #160318-00005#31  By 07900 --add-end
              LET g_errparam.popup = TRUE
              CALL cl_err()

              RETURN FALSE
           ELSE            
              #檢查成功時後續處理
              RETURN TRUE 
           END IF 
        ELSE
           #檢查失敗時後續處理
           RETURN FALSE 
        END IF
      END IF 
      
   END IF 
   RETURN TRUE
END FUNCTION

PRIVATE FUNCTION aooi300_open_qry2(p_gzaj002,p_gzaj001,p_oocq_def)
DEFINE p_gzaj002 LIKE gzaj_t.gzaj002
DEFINE p_gzaj001 LIKE gzaj_t.gzaj001
DEFINE p_oocq_def LIKE oocq_t.oocq004
DEFINE r_return  STRING
DEFINE l_gzaj005 LIKE gzaj_t.gzaj005 
DEFINE l_gzaj006 LIKE gzaj_t.gzaj006
DEFINE l_gzaj007 LIKE gzaj_t.gzaj007

   IF cl_null(p_gzaj001) THEN LET p_gzaj001 = g_argv[1] END IF
   SELECT gzaj005,gzaj006,gzaj007 INTO l_gzaj005,l_gzaj006,l_gzaj007 FROM gzaj_t 
    WHERE gzaj001 = p_gzaj001 AND gzaj002 = p_gzaj002
   IF p_gzaj002 >6 THEN RETURN p_oocq_def END IF 
   IF cl_null(l_gzaj005) OR cl_null(l_gzaj007) THEN
      RETURN p_oocq_def 
   ELSE 
      IF l_gzaj005 = 1 THEN
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = p_oocq_def #給予default值
         LET g_qryparam.arg1 = l_gzaj006#給予arg 
        
         CALL q_gzcb001()                                 #呼叫開窗
         LET r_return = g_qryparam.return1  #將開窗取得的值回傳到變數
         RETURN r_return
      END IF 
      IF l_gzaj005 = 2 THEN
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = p_oocq_def #給予default值
        #給予arg
         #CALL q_total(l_gzaj007)           #呼叫開窗
         CALL q_azzi650(l_gzaj007)
         LET r_return = g_qryparam.return1  #將開窗取得的值回傳到變數
         RETURN r_return
      END IF 
      IF l_gzaj005 = 4 THEN
         LET g_qryparam.reqry = FALSE
         LET g_qryparam.default1 = p_oocq_def #給予default值
        #給予arg 
         LET g_qryparam.arg1 = l_gzaj006
         #CALL q_total(l_gzad007)           #呼叫開窗
         CALL q_oocq002()
         LET r_return = g_qryparam.return1  #將開窗取得的值回傳到變數
         RETURN r_return
      END IF 
   END IF 
   RETURN p_oocq_def
END FUNCTION

PRIVATE FUNCTION aooi300_set_title_visible2(p_gzai001)
DEFINE p_gzai001 LIKE gzai_t.gzai001
DEFINE l_sql     STRING 
#DEFINE l_gzai    RECORD LIKE gzai_t.*  #161124-00048#7  2016/12/13 By 08734 mark
#161124-00048#7  2016/12/13 By 08734 add(S)
DEFINE l_gzai RECORD  #應用分類客製參考欄位畫面設定檔
       gzai001 LIKE gzai_t.gzai001, #应用分类
       gzai002 LIKE gzai_t.gzai002, #语言别
       gzai003 LIKE gzai_t.gzai003, #客制参考字段一
       gzai004 LIKE gzai_t.gzai004, #客制参考字段二
       gzai005 LIKE gzai_t.gzai005, #客制参考字段三
       gzai006 LIKE gzai_t.gzai006, #客制参考字段四
       gzai007 LIKE gzai_t.gzai007, #客制参考字段五
       gzai008 LIKE gzai_t.gzai008, #客制参考字段六
       gzai009 LIKE gzai_t.gzai009, #客制参考字段七
       gzai010 LIKE gzai_t.gzai010, #客制参考字段八
       gzai011 LIKE gzai_t.gzai011, #客制参考字段九
       gzai012 LIKE gzai_t.gzai012, #客制参考字段十
       gzai013 LIKE gzai_t.gzai013, #客制参考字段十一
       gzai014 LIKE gzai_t.gzai014, #客制参考字段十二
       gzai015 LIKE gzai_t.gzai015, #客制参考字段十三
       gzai016 LIKE gzai_t.gzai016, #客制参考字段十四
       gzai017 LIKE gzai_t.gzai017, #客制参考字段十五
       gzai018 LIKE gzai_t.gzai018, #客制参考字段十六
       gzai019 LIKE gzai_t.gzai019, #客制参考字段十七
       gzai020 LIKE gzai_t.gzai020, #客制参考字段十八
       gzai021 LIKE gzai_t.gzai021, #客制参考字段十九
       gzai022 LIKE gzai_t.gzai022 #客制参考字段二十
END RECORD
#161124-00048#7  2016/12/13 By 08734 add(E)
DEFINE l_str_field LIKE type_t.chr7
DEFINE l_str_field_bef LIKE type_t.chr3
DEFINE l_cnt    LIKE type_t.num5
DEFINE l_gzaj   RECORD
         gzaj001 LIKE gzaj_t.gzaj001,
         gzaj002 LIKE gzaj_t.gzaj002,
         gzaj003 LIKE gzaj_t.gzaj003,
         gzaj004 LIKE gzaj_t.gzaj004,
         gzaj006 LIKE gzaj_t.gzaj006
         END RECORD 
   
   LET l_cnt = 0
   SELECT COUNT(*) INTO l_cnt FROM gzaj_t
    WHERE gzaj001 = p_gzai001
      AND gzaj003 = 'Y'
   IF l_cnt = 0 THEN 
      RETURN
   END IF
   
   CALL cl_set_comp_visible("page_3",TRUE)
   
   #SELECT * INTO l_gzai.* FROM gzai_t  #161124-00048#7  2016/12/13 By 08734 mark
   SELECT gzai001,gzai002,gzai003,gzai004,gzai005,gzai006,gzai007,gzai008,gzai009,gzai010,gzai011,gzai012,gzai013,gzai014,gzai015,gzai016,gzai017,gzai018,gzai019,gzai020,gzai021,gzai022 
      INTO l_gzai.* FROM gzai_t  #161124-00048#7  2016/12/13 By 08734 add
    WHERE gzai001 = p_gzai001 AND gzai002 = g_dlang
  #對標題賦值
   CALL cl_set_comp_att_text('lbl_oocq024',l_gzai.gzai003)
   CALL cl_set_comp_att_text('lbl_oocq025',l_gzai.gzai004)
   CALL cl_set_comp_att_text('lbl_oocq026',l_gzai.gzai005)
   CALL cl_set_comp_att_text('lbl_oocq027',l_gzai.gzai006)
   CALL cl_set_comp_att_text('lbl_oocq028',l_gzai.gzai007)
   CALL cl_set_comp_att_text('lbl_oocq029',l_gzai.gzai008)
   CALL cl_set_comp_att_text('lbl_oocq030',l_gzai.gzai009)
   CALL cl_set_comp_att_text('lbl_oocq031',l_gzai.gzai010)
   CALL cl_set_comp_att_text('lbl_oocq032',l_gzai.gzai011)
   CALL cl_set_comp_att_text('lbl_oocq033',l_gzai.gzai012)
   CALL aooi300_set_comp_att_text('oocq034',l_gzai.gzai013)
   CALL aooi300_set_comp_att_text('oocq035',l_gzai.gzai014)
   CALL aooi300_set_comp_att_text('oocq036',l_gzai.gzai015)
   CALL aooi300_set_comp_att_text('oocq037',l_gzai.gzai016)
   CALL aooi300_set_comp_att_text('oocq038',l_gzai.gzai017)
   CALL cl_set_comp_att_text('lbl_oocq039',l_gzai.gzai018)
   CALL cl_set_comp_att_text('lbl_oocq040',l_gzai.gzai019)
   CALL cl_set_comp_att_text('lbl_oocq041',l_gzai.gzai020)
   CALL cl_set_comp_att_text('lbl_oocq042',l_gzai.gzai021)
   CALL cl_set_comp_att_text('lbl_oocq043',l_gzai.gzai022) 
   
   CALL cl_set_comp_att_text('b_oocq024',l_gzai.gzai003)
   CALL cl_set_comp_att_text('b_oocq025',l_gzai.gzai004)
   CALL cl_set_comp_att_text('b_oocq026',l_gzai.gzai005)
   CALL cl_set_comp_att_text('b_oocq027',l_gzai.gzai006)
   CALL cl_set_comp_att_text('b_oocq028',l_gzai.gzai007)
   CALL cl_set_comp_att_text('b_oocq029',l_gzai.gzai008)
   CALL cl_set_comp_att_text('b_oocq030',l_gzai.gzai009)
   CALL cl_set_comp_att_text('b_oocq031',l_gzai.gzai010)
   CALL cl_set_comp_att_text('b_oocq032',l_gzai.gzai011)
   CALL cl_set_comp_att_text('b_oocq033',l_gzai.gzai012)
   CALL cl_set_comp_att_text('b_oocq034',l_gzai.gzai013)
   CALL cl_set_comp_att_text('b_oocq035',l_gzai.gzai014)
   CALL cl_set_comp_att_text('b_oocq036',l_gzai.gzai015)
   CALL cl_set_comp_att_text('b_oocq037',l_gzai.gzai016)
   CALL cl_set_comp_att_text('b_oocq038',l_gzai.gzai017)
   CALL cl_set_comp_att_text('b_oocq039',l_gzai.gzai018)
   CALL cl_set_comp_att_text('b_oocq040',l_gzai.gzai019)
   CALL cl_set_comp_att_text('b_oocq041',l_gzai.gzai020)
   CALL cl_set_comp_att_text('b_oocq042',l_gzai.gzai021)
   CALL cl_set_comp_att_text('b_oocq043',l_gzai.gzai022)
  #查看顯示否和是否為必要欄位
   LET l_sql = " SELECT gzaj001,gzaj002,gzaj003,gzaj004,gzaj006 ",
               "   FROM gzaj_t ",
               "  WHERE gzaj001 = '",p_gzai001,"'"
   PREPARE aooi300_title_pre2 FROM l_sql 
   DECLARE aooi300_title_cur2 CURSOR FOR aooi300_title_pre2 
  #抓取gzaj_t的資料，然後根據資料來設定欄位是否可見 
   FOREACH  aooi300_title_cur2 INTO l_gzaj.*
      #對應到oocq中的欄位數值= 參考欄位編號+3
      LET l_gzaj.gzaj002 = l_gzaj.gzaj002+23 
      LET l_str_field_bef = l_gzaj.gzaj002 USING '&&&'
      LET l_str_field = 'oocq' CLIPPED,l_str_field_bef CLIPPED 
     #根據gzaj003來判斷欄位是否顯示
      IF l_gzaj.gzaj003 = 'Y' THEN
         CALL cl_set_comp_visible(l_str_field,TRUE) 
         CALL cl_set_comp_visible("b_"||l_str_field,TRUE) 
        #根據gzaj004來判斷欄位是否required
         IF l_gzaj.gzaj004 = 'Y' THEN
            CALL cl_set_comp_required(l_str_field,FALSE)
         ELSE
            CALL cl_set_comp_required(l_str_field,TRUE)
         END IF 
         IF l_gzaj.gzaj002 >= 39 AND l_gzaj.gzaj002 <= 41 THEN
            CALL cl_set_combo_scc(l_str_field,l_gzaj.gzaj006)
         END IF
      ELSE
         CALL cl_set_comp_visible('lbl_'||l_str_field,FALSE)
         CALL cl_set_comp_visible(l_str_field,FALSE) 
         CALL cl_set_comp_visible(l_str_field||'_desc',FALSE) 
         CALL cl_set_comp_visible('b_'||l_str_field,FALSE)
      END IF 
   END FOREACH
END FUNCTION

 
{</section>}
 
