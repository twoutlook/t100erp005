<?xml version="1.0" encoding="UTF-8"?>
<add_points env="s" ver="1.0" prog="aooi016" std_prog="aooi016" module="aoo" native="N" >
          <point name="global.memo"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="global.import"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="global.variable" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="main.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="main.init" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="main.servicecall"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="main.exit"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="init.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="init.init" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[
]]>

          </point>
          <point name="ui_dialog.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="ui_dialog.more_displayarray" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.query"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.modify"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.insert"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.delete"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.reproduce"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.db_auto_import_rate"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.db_cross_rate_calculate"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="menu.db_aooq001_query"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="browser_search.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="browser_fill.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="browser_fill.reference" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="ui_headershow.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="ui_detailshow.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="ui_detailshow.before" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="ui_detailshow.after" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="ui_browser_refresh.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="cs.define" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[
]]>

          </point>
          <point name="construct.c.ooan001"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooan001()
            DISPLAY g_qryparam.return1 TO ooan001
            NEXT FIELD ooan001
]]>

          </point>
          <point name="construct.c.ooan002"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooan002()
            DISPLAY g_qryparam.return1 TO ooan002
            NEXT FIELD ooan002
]]>

          </point>
          <point name="construct.c.ooan003"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooan003()
            DISPLAY g_qryparam.return1 TO ooan003
            NEXT FIELD ooan003
]]>

          </point>
          <point name="construct.c.page1.ooanstus"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="construct.c.page1.ooan004"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="construct.c.page1.ooan005"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="construct.c.page1.ooan006"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="construct.c.page1.ooan007"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="construct.c.page1.ooan008"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="construct.c.page1.ooan009"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="cs.more_construct" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="cs.before_dialog" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="query.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="fetch.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="insert.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="insert.default" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[      LET g_ooan_m_t.* = g_ooan_m.*]]>

          </point>
          <point name="modify.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="modify.b_key_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="modify.a_key_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.define" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[   DEFINE l_stus           LIKE type_t.chr1
   DEFINE l_result         LIKE type_t.chr1
   DEFINE l_parameter      LIKE type_t.chr1]]>

          </point>
          <point name="input.a.ooan001"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF  NOT cl_null(g_ooan_m.ooan001) AND NOT cl_null(g_ooan_m.ooan002) AND NOT cl_null(g_ooan_m.ooan003)  THEN 
               IF  p_cmd = 'a'  OR ( p_cmd = 'u' AND (g_ooan_m.ooan001 != g_ooan001_t  OR g_ooan_m.ooan002 != g_ooan002_t  OR g_ooan_m.ooan003 != g_ooan003_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM ooan_t WHERE "||"ooanent = '" ||g_enterprise|| "' AND "||"ooan001 = '"||g_ooan_m.ooan001 ||"' AND "|| "ooan002 = '"||g_ooan_m.ooan002 ||"' AND "|| "ooan003 = '"||g_ooan_m.ooan003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD ooan001
                  END IF
               END IF
            END IF
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_ooan_m.ooan001
            CALL ap_ref_array2(g_ref_fields,"SELECT ooam004 FROM ooam_t WHERE ooament='"||g_enterprise||"' AND ooam001='1' AND ooam002=? AND ooam003='"||g_lang||"'","") RETURNING g_rtn_fields
            LET g_ooan_m.ooan001_desc = g_rtn_fields[1]
            DISPLAY BY NAME g_ooan_m.ooan001_desc
            
            #校驗帶值
            IF NOT cl_null(g_ooan_m.ooan001) THEN
               LET l_stus = NULL
               SELECT ooalstus INTO l_stus FROM ooal_t
                WHERE ooalent = g_enterprise
                  AND ooal001 = '1'
                  AND ooal002 = g_ooan_m.ooan001
               CASE
                  WHEN SQLCA.sqlcode = 100
                       #若不存在時，開窗詢問是否新增此參照表號到基本資料內
                       IF cl_ask_confirm('aoop-00006') THEN
                          LET g_intrans = 'Y'
                          CALL s_ins_aooi006('1',g_ooan_m.ooan001) RETURNING l_result
                          IF (NOT l_result) THEN
                             LET g_ooan_m.ooan001 = g_ooan_m_t.ooan001
                             DISPLAY BY NAME g_ooan_m.ooan001
                             NEXT FIELD ooan001
                          END IF
                          LET g_intrans = 'N'
                       ELSE
                          LET g_ooan_m.ooan001 = g_ooan_m_t.ooan001
                          DISPLAY BY NAME g_ooan_m.ooan001
                          NEXT FIELD ooan001
                       END IF
                  WHEN l_stus = 'N'
                       CALL cl_err(g_ooan_m.ooan001,'aoo-00004',1)
                       LET g_ooan_m.ooan001 = g_ooan_m_t.ooan001
                       DISPLAY BY NAME g_ooan_m.ooan001
                       NEXT FIELD ooan001
               END CASE
            END IF]]>

          </point>
          <point name="input.b.ooan001"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.ooan001"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.ooan002"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF  NOT cl_null(g_ooan_m.ooan001) AND NOT cl_null(g_ooan_m.ooan002) AND NOT cl_null(g_ooan_m.ooan003)  THEN 
               IF  p_cmd = 'a'  OR ( p_cmd = 'u' AND (g_ooan_m.ooan001 != g_ooan001_t  OR g_ooan_m.ooan002 != g_ooan002_t  OR g_ooan_m.ooan003 != g_ooan003_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM ooan_t WHERE "||"ooanent = '" ||g_enterprise|| "' AND "||"ooan001 = '"||g_ooan_m.ooan001 ||"' AND "|| "ooan002 = '"||g_ooan_m.ooan002 ||"' AND "|| "ooan003 = '"||g_ooan_m.ooan003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD ooan002
                  END IF
               END IF
            END IF

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_ooan_m.ooan002
            CALL ap_ref_array2(g_ref_fields,"SELECT ooaj003 FROM ooaj_t WHERE ooajent='"||g_enterprise||"' AND ooaj001=? AND ooaj002='"||g_lang||"'","") RETURNING g_rtn_fields
            LET g_ooan_m.ooan002_desc = g_rtn_fields[1]
            DISPLAY BY NAME g_ooan_m.ooan002_desc
            
            #校驗帶值
            IF NOT cl_null(g_ooan_m.ooan002) THEN
               LET l_stus = NULL
               SELECT ooaistus INTO l_stus FROM ooai_t
                WHERE ooaient = g_enterprise
                  AND ooai001 = g_ooan_m.ooan002
               CASE
                  WHEN SQLCA.sqlcode = 100
                       CALL cl_err(g_ooan_m.ooan002,'aoo-00028',1)
                       LET g_ooan_m.ooan002 = g_ooan_m_t.ooan002
                       DISPLAY BY NAME g_ooan_m.ooan002
                       NEXT FIELD ooan002
                  WHEN l_stus = 'N'
                       CALL cl_err(g_ooan_m.ooan002,'aoo-00004',1)
                       LET g_ooan_m.ooan002 = g_ooan_m_t.ooan002
                       DISPLAY BY NAME g_ooan_m.ooan002
                       NEXT FIELD ooan002
               END CASE
            END IF]]>

          </point>
          <point name="input.b.ooan002"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.ooan002"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.ooan003"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF  NOT cl_null(g_ooan_m.ooan001) AND NOT cl_null(g_ooan_m.ooan002) AND NOT cl_null(g_ooan_m.ooan003)  THEN 
               IF  p_cmd = 'a'  OR ( p_cmd = 'u' AND (g_ooan_m.ooan001 != g_ooan001_t  OR g_ooan_m.ooan002 != g_ooan002_t  OR g_ooan_m.ooan003 != g_ooan003_t )) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM ooan_t WHERE "||"ooanent = '" ||g_enterprise|| "' AND "||"ooan001 = '"||g_ooan_m.ooan001 ||"' AND "|| "ooan002 = '"||g_ooan_m.ooan002 ||"' AND "|| "ooan003 = '"||g_ooan_m.ooan003 ||"'",'std-00004',0) THEN 
                     NEXT FIELD ooan003
                  END IF
               END IF
            END IF
            
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_ooan_m.ooan003
            CALL ap_ref_array2(g_ref_fields,"SELECT ooaj003 FROM ooaj_t WHERE ooajent='"||g_enterprise||"' AND ooaj001=? AND ooaj002='"||g_lang||"'","") RETURNING g_rtn_fields
            LET g_ooan_m.ooan003_desc = g_rtn_fields[1]
            DISPLAY BY NAME g_ooan_m.ooan003_desc
            
            #校驗帶值
            IF NOT cl_null(g_ooan_m.ooan003) THEN
               LET l_stus = NULL
               SELECT ooaistus INTO l_stus FROM ooai_t
                WHERE ooaient = g_enterprise
                  AND ooai001 = g_ooan_m.ooan003
               CASE
                  WHEN SQLCA.sqlcode = 100
                       CALL cl_err(g_ooan_m.ooan003,'aoo-00028',1)
                       LET g_ooan_m.ooan003 = g_ooan_m_t.ooan003
                       DISPLAY BY NAME g_ooan_m.ooan003
                       NEXT FIELD ooan003
                  WHEN l_stus = 'N'
                       CALL cl_err(g_ooan_m.ooan003,'aoo-00004',1)
                       LET g_ooan_m.ooan003 = g_ooan_m_t.ooan003
                       DISPLAY BY NAME g_ooan_m.ooan003
                       NEXT FIELD ooan003
               END CASE
            END IF]]>

          </point>
          <point name="input.b.ooan003"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.ooan003"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.ooan001"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_ooan_m.ooan001
            CALL q_ooal002_3()
            LET g_ooan_m.ooan001 = g_qryparam.return1
            DISPLAY BY NAME g_ooan_m.ooan001
            NEXT FIELD ooan001
]]>

          </point>
          <point name="input.c.ooan002"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_ooan_m.ooan002
            CALL q_ooai001_1()
            LET g_ooan_m.ooan002 = g_qryparam.return1
            DISPLAY BY NAME g_ooan_m.ooan002
            NEXT FIELD ooan002
]]>

          </point>
          <point name="input.c.ooan003"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.default1 = g_ooan_m.ooan003
            CALL q_ooai001_1()
            LET g_ooan_m.ooan003 = g_qryparam.return1
            DISPLAY BY NAME g_ooan_m.ooan003
               NEXT FIELD ooan003
]]>

          </point>
          <point name="input.head.b_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.head.a_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.before_row" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.before_insert" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.b_insert" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.a_insert" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.after_insert" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.b_delete" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.a_delete" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.after_delete" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooanstus"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooanstus"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooanstus"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooan004"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF cl_ask_confirm2('',"因參數尚未設定，請選擇要何匯率？Y：月匯率，N：日匯率") THEN
               LET l_parameter = '1'
            ELSE
               LET l_parameter = '2'
            END IF
            LET g_today = cl_get_current()
            #若參數為月匯率時，預設當月第一天
            #若參數為日匯率時，預設g_today
            IF p_cmd = 'a' AND cl_null(g_ooan_d[l_ac].ooan004) THEN
               IF l_parameter = '1' THEN
                  LET g_ooan_d[l_ac].ooan004 = MDY(MONTH(g_today),1,YEAR(g_today))
               ELSE
                  LET g_ooan_d[l_ac].ooan004 = g_today
               END IF
               DISPLAY BY NAME g_ooan_d[l_ac].ooan004
            END IF]]>

          </point>
          <point name="input.a.page1.ooan004"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            #若參數為月匯率，日期皆改為輸入日期同年月的第一天
            IF l_parameter = '1' THEN
               LET g_ooan_d[l_ac].ooan004 = MDY(MONTH(g_ooan_d[l_ac].ooan004),1,YEAR(g_ooan_d[l_ac].ooan004))
               DISPLAY BY NAME g_ooan_d[l_ac].ooan004
            END IF
            
            IF  NOT cl_null(g_ooan_m.ooan001) AND NOT cl_null(g_ooan_m.ooan002) AND NOT cl_null(g_ooan_m.ooan003) AND NOT cl_null(g_ooan_d[l_ac].ooan004)  THEN 
               IF  p_cmd = 'a'  OR ( p_cmd = 'u' AND (g_ooan_m.ooan001 != g_ooan001_t  OR g_ooan_m.ooan002 != g_ooan002_t  OR g_ooan_m.ooan003 != g_ooan003_t  OR g_ooan_d[l_ac].ooan004 != g_ooan_d_t.ooan004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM ooan_t WHERE "||"ooanent = '" ||g_enterprise|| "' AND "||"ooan001 = '"||g_ooan_m.ooan001 ||"' AND "|| "ooan002 = '"||g_ooan_m.ooan002 ||"' AND "|| "ooan003 = '"||g_ooan_m.ooan003 ||"' AND "|| "ooan004 = '"||g_ooan_d[l_ac].ooan004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD ooan004
                  END IF
               END IF
            END IF]]>

          </point>
          <point name="input.g.page1.ooan004"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooan005"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF NOT cl_null(g_ooan_d[l_ac].ooan005) THEN 
               IF NOT ap_chk_inRange(g_ooan_d[l_ac].ooan005,"0.000","","aoo-00005",1) THEN 
                  NEXT FIELD ooan005
               END IF
            END IF
            
            #當新值不等於舊值時，銀行中價匯率=(銀行買入匯率+銀行賣出匯率)/2
            IF NOT cl_null(g_ooan_d[l_ac].ooan005) AND 
               (g_ooan_d[l_ac].ooan005 <> g_ooan_d_t.ooan005 OR 
                g_ooan_d_t.ooan005 IS NULL) THEN
               CALL aooi016_get_ooan007()
            END IF]]>

          </point>
          <point name="input.b.page1.ooan005"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooan005"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooan006"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF NOT cl_null(g_ooan_d[l_ac].ooan006) THEN 
               IF NOT ap_chk_inRange(g_ooan_d[l_ac].ooan006,"0.000","","aoo-00005",1) THEN 
                  NEXT FIELD ooan006
               END IF
            END IF
            
            #當新值不等於舊值時，銀行中價匯率=(銀行買入匯率+銀行賣出匯率)/2
            IF NOT cl_null(g_ooan_d[l_ac].ooan006) AND 
               (g_ooan_d[l_ac].ooan006 <> g_ooan_d_t.ooan006 OR 
                g_ooan_d_t.ooan006 IS NULL) THEN
               CALL aooi016_get_ooan007()
            END IF]]>

          </point>
          <point name="input.b.page1.ooan006"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooan006"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooan007"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF NOT cl_null(g_ooan_d[l_ac].ooan007) THEN 
               IF NOT ap_chk_inRange(g_ooan_d[l_ac].ooan007,"0.000","","aoo-00005",1) THEN 
                  NEXT FIELD ooan007
               END IF
            END IF]]>

          </point>
          <point name="input.b.page1.ooan007"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooan007"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooan008"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF NOT cl_null(g_ooan_d[l_ac].ooan008) THEN 
               IF NOT ap_chk_inRange(g_ooan_d[l_ac].ooan008,"0.000","","aoo-00005",1) THEN 
                  NEXT FIELD ooan008
               END IF
            END IF]]>

          </point>
          <point name="input.b.page1.ooan008"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooan008"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooan009"  ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[            IF NOT cl_null(g_ooan_d[l_ac].ooan009) THEN 
               IF NOT ap_chk_inRange(g_ooan_d[l_ac].ooan009,"0.000","","aoo-00005",1) THEN 
                  NEXT FIELD ooan009
               END IF
            END IF]]>

          </point>
          <point name="input.b.page1.ooan009"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooan009"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooanmodu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooanmodu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooanmodu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooandate"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooandate"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooandate"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooanoriu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooanoriu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooanoriu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooanorid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooanorid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooanorid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooanuser"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooanuser"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooanuser"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooandept"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooandept"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooandept"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.b.page1.ooanbuid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.a.page1.ooanbuid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.g.page1.ooanbuid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooanstus"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooan004"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooan005"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooan006"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooan007"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooan008"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooan009"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooanmodu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooandate"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooanoriu"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooanorid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooanuser"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooandept"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.c.page1.ooanbuid"  ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.b_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.a_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="input.body.after_input" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="show.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="show.before" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="show.after" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[   CALL aooi016_order_ooan004()]]>

          </point>
          <point name="ref_show.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="ref_show.head.reference" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ooan_m.ooan001
    CALL ap_ref_array2(g_ref_fields,"SELECT ooall004 FROM ooall_t WHERE ooall001='1' AND ooall002=? AND ooall003='"||g_lang||"'","") RETURNING g_rtn_fields
    LET g_ooan_m.ooan001_desc = g_rtn_fields[1]
    DISPLAY BY NAME g_ooan_m.ooan001_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ooan_m.ooan002
   CALL ap_ref_array2(g_ref_fields,"SELECT ooail003 FROM ooail_t WHERE ooail001=? AND ooail002='"||g_lang||"'","") RETURNING g_rtn_fields
   LET g_ooan_m.ooan002_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_ooan_m.ooan002_desc
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_ooan_m.ooan003
   CALL ap_ref_array2(g_ref_fields,"SELECT ooail003 FROM ooail_t WHERE ooail001=? AND ooail002='"||g_lang||"'","") RETURNING g_rtn_fields
   LET g_ooan_m.ooan003_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_ooan_m.ooan003_desc
]]>

          </point>
          <point name="ref_show.body.reference" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="reproduce.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="reproduce.body.b_insert" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="reproduce.body.a_insert" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="delete.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="delete.body.b_delete" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="delete.body.a_delete" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="b_fill.define" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[
   IF cl_null(p_wc2) THEN LET p_wc2 = " 1=1" END IF
   LET p_wc2 = p_wc2 CLIPPED," ORDER BY ooan004 DESC"]]>

          </point>
          <point name="b_fill.fill" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="bfill.foreach" ver="1.0" status="" src="s" cite_std="N" >
<![CDATA[      IF l_ac > 31 THEN
         EXIT FOREACH
      END IF]]>

          </point>
          <point name="before_delete.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="delete.body.b_single_delete" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="delete.body.a_single_delete" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="delete_b.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="set_entry.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="set_no_entry.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="set_entry_b.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="set_no_entry_b.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="default_search.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="default_search.before" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="default_search.after" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="statechange.define" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="statechange.before" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="statechange.b_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="statechange.a_update" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="statechange.after" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="other.function" ver="1.0" status="" src="s" cite_std="N"/>
          <point name="function.aooi016_aooq001_query" ver="1.0" status="" src="s" cite_std="N">
<![CDATA[# 歷史匯率查詢
PRIVATE FUNCTION aooi016_aooq001_query()
   DEFINE l_cmd STRING
   
   #判斷畫面上面是否有資料被選定
   #如果有則開啟aooq001
   IF cl_null(g_ooan_m.ooan001) OR cl_null(g_ooan_m.ooan002) OR cl_null(g_ooan_m.ooan003) THEN
      RETURN
   ELSE
      LET l_cmd = "aooq001 '",g_ooan_m.ooan001,"' '",g_ooan_m.ooan002,"' '",g_ooan_m.ooan003,"'"
      CALL cl_cmdrun(l_cmd)
   END IF
END FUNCTION]]>
</point>          <point name="function.aooi016_get_ooan007" ver="1.0" status="" src="s" cite_std="N">
<![CDATA[# 計算銀行中價匯率=(銀行買入匯率+銀行賣出匯率)/2
PRIVATE FUNCTION aooi016_get_ooan007()
   LET g_ooan_d[l_ac].ooan007 = (g_ooan_d[l_ac].ooan005+g_ooan_d[l_ac].ooan006)/2
END FUNCTION]]>
</point>          <point name="function.aooi016_order_ooan004" ver="1.0" status="" src="s" cite_std="N">
<![CDATA[# 重排日期
PRIVATE FUNCTION aooi016_order_ooan004()
   DEFINE i       LIKE type_t.num5
   DEFINE l_ooan  type_g_ooan_d
   
   FOR i = 1 TO g_rec_b/2
      LET l_ooan.* = g_ooan_d[i].*
      LET g_ooan_d[i].* = g_ooan_d[g_rec_b+1-i].*
      LET g_ooan_d[g_rec_b+1-i].* = l_ooan.*
   END FOR
END FUNCTION]]>
</point></add_points>

