<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="ainq900" std_prog="ainq900" erpver="1.0" module="AIN" ver="2" env="s" zone="t10prd" booking="Y" type="M" identity="s" section_flag="N" designer_ver="1.0">
  <other>
    <code_template value="Q" status="u"/>
    <free_style value="Y" status="u"/>
    <start_arg value="" status="u"/>
  </other>
  <point name="function.ainq900_init" order="1" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_init()
   DEFINE l_success     LIKE type_t.num5 #150308-00001#3 150309 pomelo add
   
   LET g_wc_filter   = " 1=1"
   LET g_wc_filter_t = " 1=1"
   LET g_error_show  = 1
   CALL cl_set_combo_scc('l_inaa102','6200')
   CALL cl_set_combo_scc('l_inaa102_1','6200')
   CALL s_aooi500_create_temp() RETURNING l_success   #150308-00001#3 150309 pomelo add
   CALL ainq900_default_search()
END FUNCTION]]>
  </point>
  <point name="function.ainq900_default_search" order="2" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_default_search()

   IF NOT cl_null(g_argv[01]) THEN
      LET g_wc = g_wc, " inagsite = '", g_argv[01], "' AND "
   END IF

   IF NOT cl_null(g_argv[02]) THEN
      LET g_wc = g_wc, " inag001 = '", g_argv[02], "' AND "
   END IF
   IF NOT cl_null(g_argv[03]) THEN
      LET g_wc = g_wc, " inag002 = '", g_argv[03], "' AND "
   END IF
   IF NOT cl_null(g_argv[04]) THEN
      LET g_wc = g_wc, " inag003 = '", g_argv[04], "' AND "
   END IF
   IF NOT cl_null(g_argv[05]) THEN
      LET g_wc = g_wc, " inag004 = '", g_argv[05], "' AND "
   END IF
   IF NOT cl_null(g_argv[06]) THEN
      LET g_wc = g_wc, " inag005 = '", g_argv[06], "' AND "
   END IF
   IF NOT cl_null(g_argv[07]) THEN
      LET g_wc = g_wc, " inag006 = '", g_argv[07], "' AND "
   END IF
   IF NOT cl_null(g_argv[08]) THEN
      LET g_wc = g_wc, " inag007 = '", g_argv[08], "' AND "
   END IF

   IF NOT cl_null(g_wc) THEN
      LET g_wc = g_wc.subString(1,g_wc.getLength()-5)
   ELSE
      LET g_wc = " 1=2"
   END IF

END FUNCTION]]>
  </point>
  <point name="function.ainq900_ui_dialog" order="3" ver="2" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_ui_dialog()
   DEFINE li_exit   LIKE type_t.num5    #判別是否為離開作業
   DEFINE li_idx    LIKE type_t.num5
   DEFINE ls_result STRING
   DEFINE ls_wc     STRING
   DEFINE lc_action_choice_old   STRING

   CALL cl_set_act_visible("accept,cancel", FALSE)

   LET li_exit = FALSE
   LET gwin_curr = ui.Window.getCurrent()
   LET gfrm_curr = gwin_curr.getForm()
   LET g_current_row = 0
   LET g_current_idx = 1
   LET g_action_choice = " "
   LET lc_action_choice_old = ""
   LET l_ac = 1
   
   CALL ainq900_b_fill()

   WHILE li_exit = FALSE
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
         CONSTRUCT BY NAME g_wc ON inagsite,inag001,inag002,inag003,inag004
            BEFORE CONSTRUCT
         
            ON ACTION controlp INFIELD inagsite
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
               LET g_qryparam.reqry = FALSE
               LET g_qryparam.where = s_aooi500_q_where(g_prog,'inagsite',g_site,'c') #150308-00001#3 150309 pomelo add 'c'
               CALL q_ooef001_24()
               DISPLAY g_qryparam.return1 TO inagsite  #顯示到畫面上         
               NEXT FIELD inagsite                     #返回原欄位
                        
            ON ACTION controlp INFIELD inag001          
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
               LET g_qryparam.reqry = FALSE
               CALL q_inag001()                           #呼叫開窗
               DISPLAY g_qryparam.return1 TO inag001      #顯示到畫面上
               NEXT FIELD inag001                         #返回原欄位
               
            ON ACTION controlp INFIELD inag002          
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
               LET g_qryparam.reqry = FALSE
               CALL q_inag002()                           #呼叫開窗
               DISPLAY g_qryparam.return1 TO inag002      #顯示到畫面上
               NEXT FIELD inag002                         #返回原欄位
               
            ON ACTION controlp INFIELD inag003          
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
               LET g_qryparam.reqry = FALSE
               CALL q_inag003()                           #呼叫開窗
               DISPLAY g_qryparam.return1 TO inag003      #顯示到畫面上
               NEXT FIELD inag003                         #返回原欄位
               
            ON ACTION controlp INFIELD inag004          
               INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
               LET g_qryparam.reqry = FALSE
               CALL q_inag004_11()                           #呼叫開窗
               DISPLAY g_qryparam.return1 TO inag004      #顯示到畫面上
               NEXT FIELD inag004                         #返回原欄位
                       
         END CONSTRUCT  
         
         CONSTRUCT g_wc2 ON imaa009,imaa126 FROM l_imaa009,l_imaa126
            BEFORE CONSTRUCT
            
            ON ACTION controlp INFIELD l_imaa009
		   	   INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
		   	   LET g_qryparam.reqry = FALSE
               CALL q_rtax001()                         #呼叫開窗
               DISPLAY g_qryparam.return1 TO l_imaa009  #顯示到畫面上         
               NEXT FIELD l_imaa009                     #返回原欄位
            ON ACTION controlp INFIELD l_imaa126
		   	   INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
		   	   LET g_qryparam.reqry = FALSE
		   	   LET g_qryparam.arg1 = '2002'
               CALL q_oocq002()                         #呼叫開窗
               DISPLAY g_qryparam.return1 TO l_imaa126  #顯示到畫面上         
               NEXT FIELD l_imaa126                     #返回原欄位 
         END CONSTRUCT
         
         CONSTRUCT g_wc3 ON inad010 FROM l_inad010
            BEFORE CONSTRUCT
            
            ON ACTION controlp INFIELD l_inad010
		   	   INITIALIZE g_qryparam.* TO NULL
               LET g_qryparam.state = 'c'
		   	   LET g_qryparam.reqry = FALSE
               CALL q_pmaa001_3()                       #呼叫開窗
               DISPLAY g_qryparam.return1 TO l_inad010  #顯示到畫面上         
               NEXT FIELD l_inad010                     #返回原欄位
               
         END CONSTRUCT
         INPUT tm.l_qty_flag,tm.l_inag012,tm.l_inag010,
               tm2.inagsite,tm2.inag001,tm2.inag002,tm2.inag004,tm2.inag005,
               tm2.inag006 ,tm2.imaa009,tm2.inag003,tm2.inag007,tm2.inad011,
               tm2.inad010 ,tm2.imaa126
          FROM l_qty_flag,l_inag012,l_inag010,
               l_inagsite,l_inag001,l_inag002,l_inag004,l_inag005,
               l_inag006,l_imaa009_1,l_inag003,l_inag007,l_inad011,
               l_inad010_1,l_imaa126_1
            BEFORE INPUT 

            AFTER INPUT
         
         END INPUT 
         
         DISPLAY ARRAY g_inag_d TO s_detail1.* ATTRIBUTE(COUNT=g_detail_cnt)

            BEFORE DISPLAY
               LET g_current_page = 1

            BEFORE ROW
               LET g_detail_idx = DIALOG.getCurrentRow("s_detail1")
               LET l_ac = g_detail_idx
               DISPLAY g_detail_idx TO FORMONLY.h_index
               DISPLAY g_inag_d.getLength() TO FORMONLY.h_count
               LET g_master_idx = l_ac
               CALL ainq900_b_fill2()

         END DISPLAY
         
         DISPLAY ARRAY g_inag2_d TO s_detail2.* ATTRIBUTE(COUNT=g_detail_cnt2)

            BEFORE DISPLAY
               LET g_current_page = 2

            BEFORE ROW
               LET g_detail_idx2 = DIALOG.getCurrentRow("s_detail2")
               LET l_ac = g_detail_idx2
               DISPLAY g_detail_idx2 TO FORMONLY.h_index
               DISPLAY g_inag2_d.getLength() TO FORMONLY.h_count

         END DISPLAY

         BEFORE DIALOG
            CALL DIALOG.setSelectionMode("s_detail1", 1)
            #給預設值
            LET tm.l_inag012 = 'ALL'
            LET tm.l_inag010 = 'ALL'
            LET tm.l_qty_flag = 'Y'
            LET tm2.inagsite = 'Y'
            LET tm2.inag001 = 'N'
            LET tm2.inag002 = 'N'
            LET tm2.inag004 = 'N'
            LET tm2.inag005 = 'N'
            LET tm2.inag006 = 'N'
            LET tm2.imaa009 = 'N'
            LET tm2.inag003 = 'N'
            LET tm2.inag007 = 'N'
            LET tm2.inad011 = 'N'  
            LET tm2.inad010 = 'N'
            LET tm2.imaa126 = 'N'
            DISPLAY tm.l_qty_flag,
                    tm2.inagsite,tm2.inag001,tm2.inag002,tm2.inag004,tm2.inag005,
                    tm2.inag006 ,tm2.imaa009,tm2.inag003,tm2.inag007,tm2.inad011,
                    tm2.inad010 ,tm2.imaa126
                 TO l_qty_flag,
                    l_inagsite,l_inag001,l_inag002,l_inag004,l_inag005,
                    l_inag006,l_imaa009_1,l_inag003,l_inag007,l_inad011,
                    l_inad010_1,l_imaa126_1
            CALL ainq900_comp_visible()        
            NEXT FIELD inagsite

         AFTER DIALOG

         ON ACTION exit
            LET g_action_choice="exit"
            LET INT_FLAG = FALSE
            LET li_exit = TRUE
            EXIT DIALOG

         ON ACTION close
            LET INT_FLAG=FALSE
            LET li_exit = TRUE
            EXIT DIALOG

         ON ACTION accept
            INITIALIZE g_wc_filter TO NULL
            IF cl_null(g_wc) THEN
               LET g_wc = " 1=1"
            END IF
            IF cl_null(g_wc2) THEN
               LET g_wc2 = " 1=1"
            END IF 
            CALL ainq900_comp_visible()
            CALL ainq900_b_fill()
            NEXT FIELD sel


         ON ACTION agendum   # 待辦事項
            CALL cl_user_overview()

         ON ACTION exporttoexcel   #匯出excel
            LET g_action_choice="exporttoexcel"
            IF cl_auth_chk_act("exporttoexcel") THEN
               CALL g_export_node.clear()
               LET g_export_node[1] = base.typeInfo.create(g_inag_d)
               LET g_export_id[1]   = "s_detail1"
               LET g_export_node[2] = base.typeInfo.create(g_inag2_d)
               LET g_export_id[2]   = "s_detail2"
               CALL cl_export_to_excel_getpage()
               CALL cl_export_to_excel()
            END IF

         ON ACTION datarefresh   # 重新整理
            CALL ainq900_b_fill()
            NEXT FIELD sel

         #ON ACTION qbehidden     #qbe頁籤折疊
         #   IF g_qbe_hidden THEN
         #      CALL gfrm_curr.setElementHidden("qbe",0)
         #      CALL gfrm_curr.setElementImage("qbehidden","16/mainhidden.png")
         #      LET g_qbe_hidden = 0     #visible
         #   ELSE
         #      CALL gfrm_curr.setElementHidden("qbe",1)
         #      CALL gfrm_curr.setElementImage("qbehidden","16/worksheethidden.png")
         #      LET g_qbe_hidden = 1     #hidden
         #   END IF

        ##有關於sel欄位選取的action段落
        ##選擇全部
        #ON ACTION selall
        #   CALL DIALOG.setSelectionRange("s_detail1", 1, -1, 1)
        #   FOR li_idx = 1 TO g_inag_d.getLength()
        #      LET g_inag_d[li_idx].sel = "Y"
        #   END FOR

        ##取消全部
        #ON ACTION selnone
        #   CALL DIALOG.setSelectionRange("s_detail1", 1, -1, 0)
        #   FOR li_idx = 1 TO g_inag_d.getLength()
        #      LET g_inag_d[li_idx].sel = "N"
        #   END FOR

        ##勾選所選資料
        #ON ACTION sel
        #   FOR li_idx = 1 TO g_inag_d.getLength()
        #      IF DIALOG.isRowSelected("s_detail1", li_idx) THEN
        #         LET g_inag_d[li_idx].sel = "Y"
        #      END IF
        #   END FOR

        ##取消所選資料
        #ON ACTION unsel
        #   FOR li_idx = 1 TO g_inag_d.getLength()
        #      IF DIALOG.isRowSelected("s_detail1", li_idx) THEN
        #         LET g_inag_d[li_idx].sel = "N"
        #      END IF
        #   END FOR
        
         #應用 qs16 樣板自動產生(Version:2)
         ON ACTION filter
            LET g_action_choice="filter"
            CALL ainq900_filter()
            CALL ainq900_b_fill()
            NEXT FIELD sel

        ##應用 a43 樣板自動產生(Version:2)
        #ON ACTION insert
        #   LET g_action_choice="insert"
        #   IF cl_auth_chk_act("insert") THEN
        #      EXIT DIALOG
        #   END IF



         #應用 a43 樣板自動產生(Version:2)
         ON ACTION output
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN

               EXIT DIALOG
            END IF

        ##應用 a43 樣板自動產生(Version:2)
        #ON ACTION query
        #   LET g_action_choice="query"
        #   IF cl_auth_chk_act("query") THEN
        #
        #   END IF

         #應用 a43 樣板自動產生(Version:2)
         ON ACTION datainfo
            LET g_action_choice="datainfo"
            IF cl_auth_chk_act("datainfo") THEN

               EXIT DIALOG
            END IF

         #主選單用ACTION
         &include "main_menu.4gl"
         &include "relating_action.4gl"
         #交談指令共用ACTION
         &include "common_action.4gl"

         ON ACTION qbeclear   # 條件清除
            CLEAR FORM

      END DIALOG

   END WHILE

END FUNCTION]]>
  </point>
  <point name="function.ainq900_b_fill" order="4" ver="2" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_b_fill()
   DEFINE ls_wc           STRING
   DEFINE l_pid           LIKE type_t.chr50
   
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
  
   
   IF cl_null(g_wc_filter) THEN
      LET g_wc_filter = " 1=1"
   END IF
   
   IF cl_null(g_wc) THEN
      LET g_wc = s_aooi500_sql_where(g_prog,'inagsite')
   ELSE 
      LET g_wc = g_wc," AND ",s_aooi500_sql_where(g_prog,'inagsite')
   END IF
   
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   
   IF cl_null(g_wc3) THEN
      LET g_wc3 = " 1=1"
   END IF
   
   LET ls_wc = g_wc, " AND ", g_wc2, " AND ", g_wc_filter, " AND ",g_wc3

   CALL g_inag_d.clear()
   CALL g_inag2_d.clear()

   LET g_cnt = l_ac
   LET l_ac = 1

   # b_fill段sql組成及FOREACH撰寫
   LET g_d1_sql        = ''   
   LET g_d1_sql_order  = ''   
   LET g_d2_sql        = ''   
   LET g_d2_sql_order  = ''   
   LET g_d2_sql_group  = ''   
   #150204-00013#7 150306 pomelo add(s)
   LET g_d1_join = ''
   LET g_d2_join = ''
   LET g_d1_imaa = ''
   LET g_d2_imaa = ''
   LET g_d2_inad = ''
   #150204-00013#7 150306 pomelo add(e)
   
   LET g_d1_sql = "SELECT UNIQUE "
   LET g_d2_sql = "SELECT UNIQUE "
   
   #---1---營運組織
   IF tm2.inagsite = 'Y' THEN
      #LET g_d1_sql = g_d1_sql," '',inagsite,''"          #150204-00013#7 150306 pomelo mark
      LET g_d1_sql = g_d1_sql," '',inagsite,t1.ooefl003"  #150204-00013#7 150306 pomelo add
      LET g_d2_sql = g_d2_sql," '',''"
      #150204-00013#7 150306 pomelo add(s)
      LET g_d1_join = g_d1_join," LEFT OUTER JOIN ooefl_t t1 ON t1.ooeflent = inagent",
                                "                           AND t1.ooefl001 = inagsite",
                                "                           AND t1.ooefl002 = '",g_dlang,"'"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inagsite"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inagsite"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql," '','',''"
      #LET g_d2_sql = g_d2_sql," inagsite,''"          #150204-00013#7 150306 pomelo mark
      LET g_d2_sql = g_d2_sql," inagsite,t1.ooefl003"  #150204-00013#7 150306 pomelo add
      #150204-00013#7 150306 pomelo add(s)
      LET g_d2_join = g_d2_join," LEFT OUTER JOIN ooefl_t t1 ON t1.ooeflent = inagent",
                                "                           AND t1.ooefl001 = inagsite",
                                "                           AND t1.ooefl002 = '",g_dlang,"'"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inagsite"
         #LET g_d2_sql_group = "inagsite"              #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = "inagsite,t1.ooefl003"   #150204-00013#7 150306 pomelo add
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inagsite"
         #LET g_d2_sql_group = g_d2_sql_group,",inagsite"            #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = g_d2_sql_group,",inagsite,t1.ooefl003" #150204-00013#7 150306 pomelo add
      END IF
   END IF
   
   #---2---商品編號
   IF tm2.inag001 = 'Y' THEN
      #LET g_d1_sql = g_d1_sql,",inag001,'',''"                  #150204-00013#7 150306 pomelo mark
      LET g_d1_sql = g_d1_sql,",inag001,t2.imaal003,t2.imaal004" #150204-00013#7 150306 pomelo add
      LET g_d2_sql = g_d2_sql,",'','',''"
      #150204-00013#7 150306 pomelo add(s)
      LET g_d1_join = g_d1_join," LEFT OUTER JOIN imaal_t t2 ON t2.imaalent = inagent",
                                "                           AND t2.imaal001 = inag001",
                                "                           AND t2.imaal002 = '",g_dlang,"'"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inag001"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inag001"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",'','',''"
      #LET g_d2_sql = g_d2_sql,",inag001,'',''"                  #150204-00013#7 150306 pomelo mark
      LET g_d2_sql = g_d2_sql,",inag001,t2.imaal003,t2.imaal004" #150204-00013#7 150306 pomelo add
      #150204-00013#7 150306 pomelo add(s)
      LET g_d2_join = g_d2_join," LEFT OUTER JOIN imaal_t t2 ON t2.imaalent = inagent",
                                "                           AND t2.imaal001 = inag001",
                                "                           AND t2.imaal002 = '",g_dlang,"'"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inag001"
         #LET g_d2_sql_group = "inag001"                         #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = "inag001,t2.imaal003,t2.imaal004" #150204-00013#7 150306 pomelo add
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inag001"
         #LET g_d2_sql_group = g_d2_sql_group,",inag001"                        #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = g_d2_sql_group,",inag001,t2.imaal003,t2.imaal004" #150204-00013#7 150306 pomelo add
      END IF
   END IF
   #---2.1---品牌
   IF tm2.imaa126 = 'Y' THEN
      LET g_d1_sql = g_d1_sql,",imaa126,t8.oocql004"
      LET g_d2_sql = g_d2_sql,",'',''"
      LET g_d1_imaa = g_d1_imaa," LEFT OUTER JOIN oocql_t t8 ON t8.oocqlent = imaaent",
                                "                           AND t8.oocql001 = '2002'",
                                "                           AND t8.oocql002 = imaa126",
                                "                           AND t8.oocql003 = '",g_dlang,"'"
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "imaa126"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",imaa126"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",'',''"
      LET g_d2_sql = g_d2_sql,",imaa126,t8.oocql004"
      LET g_d2_imaa = g_d2_imaa," LEFT OUTER JOIN oocql_t t8 ON t8.oocqlent = imaaent",
                                "                           AND t8.oocql001 = '2002'",
                                "                           AND t8.oocql002 = imaa126",
                                "                           AND t8.oocql003 = '",g_dlang,"'"
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "imaa126"
         LET g_d2_sql_group = "imaa126,t8.oocql004"
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",imaa126"
         LET g_d2_sql_group = g_d2_sql_group,",imaa126,t8.oocql004"
      END IF
   END IF
   
   #---3---產品特徵
   IF tm2.inag002 = 'Y' THEN
      LET g_d1_sql = g_d1_sql,",inag002,''"
      LET g_d2_sql = g_d2_sql,",'',''"
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inag002"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inag002"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",'',''"
      LET g_d2_sql = g_d2_sql,",inag002,''"

      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inag002"
         LET g_d2_sql_group = "inag002"
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inag002"
         LET g_d2_sql_group = g_d2_sql_group,",inag002"
      END IF
   END IF


   
   #---4---庫位
   IF tm2.inag004 = 'Y' THEN
      #150204-00013#7 150306 pomelo mark(s)
      #LET g_d1_sql = g_d1_sql,",inag004,''"
      #LET g_d2_sql = g_d2_sql,",'',''"
      #150204-00013#7 150306 pomelo mark(e)
      #150204-00013#7 150306 pomelo add(s)
      LET g_d1_sql = g_d1_sql,",inag004,t3.inayl003,t4.inaa102,t4.inaa120,''"
      LET g_d2_sql = g_d2_sql,",'','','','',''"
      LET g_d1_join = g_d1_join," LEFT OUTER JOIN inayl_t t3 ON t3.inaylent = inagent",
                                "                           AND t3.inayl001 = inag004",
                                "                           AND t3.inayl002 = '",g_dlang,"'",
                                " LEFT OUTER JOIN inaa_t  t4 ON t4.inaaent = inagent",
                                "                           AND t4.inaasite = inagsite",
                                "                           AND t4.inaa001 = inag004"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inag004"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inag004"
      END IF
   ELSE
      #150204-00013#7 150306 pomelo mark(s)
      #LET g_d1_sql = g_d1_sql,",'',''"
      #LET g_d2_sql = g_d2_sql,",inag004,''"
      #150204-00013#7 150306 pomelo mark(e)
      #150204-00013#7 150306 pomelo add(s)
      LET g_d1_sql = g_d1_sql,",'','','','',''"
      LET g_d2_sql = g_d2_sql,",inag004,t3.inayl003,t4.inaa102,t4.inaa120,''"
      LET g_d2_join = g_d2_join," LEFT OUTER JOIN inayl_t t3 ON t3.inaylent = inagent",
                                "                           AND t3.inayl001 = inag004",
                                "                           AND t3.inayl002 = '",g_dlang,"'",
                                " LEFT OUTER JOIN inaa_t  t4 ON t4.inaaent = inagent",
                                "                           AND t4.inaasite = inagsite",
                                "                           AND t4.inaa001 = inag004"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inag004"
         #LET g_d2_sql_group = "inag004" #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = "inag004,t3.inayl003,t4.inaa102,t4.inaa120" #150204-00013#7 150306 pomelo add
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inag004"
         #LET g_d2_sql_group = g_d2_sql_group,",inag004" #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = g_d2_sql_group,",inag004,t3.inayl003,t4.inaa102,t4.inaa120" #150204-00013#7 150306 pomelo add
      END IF
   END IF

   #150204-00013#7 150306 pomelo add(s)
   #---5---產品分類
   IF tm2.imaa009 = 'Y' THEN
      LET g_d1_sql = g_d1_sql,",imaa009,t7.rtaxl003"
      LET g_d2_sql = g_d2_sql,",'',''"
      LET g_d1_imaa = g_d1_imaa," LEFT OUTER JOIN rtaxl_t t7 ON t7.rtaxlent = imaaent",
                                "                           AND t7.rtaxl001 = imaa009",
                                "                           AND t7.rtaxl002 = '",g_dlang,"'"
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "imaa009"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",imaa009"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",'',''"
      LET g_d2_sql = g_d2_sql,",imaa009,t7.rtaxl003"
      LET g_d2_imaa = g_d2_imaa," LEFT OUTER JOIN rtaxl_t t7 ON t7.rtaxlent = imaaent",
                                "                           AND t7.rtaxl001 = imaa009",
                                "                           AND t7.rtaxl002 = '",g_dlang,"'"
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "imaa009"
         LET g_d2_sql_group = "imaa009,t7.rtaxl003"
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",imaa009"
         LET g_d2_sql_group = g_d2_sql_group,",imaa009,t7.rtaxl003"
      END IF
   END IF
   #150204-00013#7 150306 pomelo add(e)
   
   #---6---儲位
   IF tm2.inag005 = 'Y' THEN
      #LET g_d1_sql = g_d1_sql,",inag005,''"          #150204-00013#7 150306 pomelo mark
      LET g_d1_sql = g_d1_sql,",inag005,t5.inab003"   #150204-00013#7 150306 pomelo add
      LET g_d2_sql = g_d2_sql,",'',''"
      #150204-00013#7 150306 pomelo add(s)
      LET g_d1_join = g_d1_join," LEFT OUTER JOIN inab_t t5 ON t5.inabent = inagent",
                                "                          AND t5.inabsite = inagsite",
                                "                          AND t5.inab001 = inag004",
                                "                          AND t5.inab002 = inag005"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inag005"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inag005"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",'',''"
      #LET g_d2_sql = g_d2_sql,",inag005,''"         #150204-00013#7 150306 pomelo mark
      LET g_d2_sql = g_d2_sql,",inag005,t5.inab003"  #150204-00013#7 150306 pomelo add
      #150204-00013#7 150306 pomelo add(s)
      LET g_d2_join = g_d2_join," LEFT OUTER JOIN inab_t t5 ON t5.inabent = inagent",
                                "                          AND t5.inabsite = inagsite",
                                "                          AND t5.inab001 = inag004",
                                "                          AND t5.inab002 = inag005"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inag005"
         #LET g_d2_sql_group = "inag005"            #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = "inag005,t5.inab003"  #150204-00013#7 150306 pomelo add
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inag005"
         #LET g_d2_sql_group = g_d2_sql_group,",inag005"           #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = g_d2_sql_group,",inag005,t5.inab003" #150204-00013#7 150306 pomelo add
      END IF
   END IF
   
   #---7---批號
   IF tm2.inag006 = 'Y' THEN
      LET g_d1_sql = g_d1_sql,",inag006"
      LET g_d2_sql = g_d2_sql,",''"
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inag006"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inag006"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",''"
      LET g_d2_sql = g_d2_sql,",inag006"

      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inag006"
         LET g_d2_sql_group = "inag006"
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inag006"
         LET g_d2_sql_group = g_d2_sql_group,",inag006"
      END IF
   END IF
   
   #---8---庫存管理特徵
   IF tm2.inag003 = 'Y' THEN
      LET g_d1_sql = g_d1_sql,",inag003"
      LET g_d2_sql = g_d2_sql,",''"
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inag003"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inag003"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",''"
      LET g_d2_sql = g_d2_sql,",inag003"
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inag003"
         LET g_d2_sql_group = "inag003"
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inag003"
         LET g_d2_sql_group = g_d2_sql_group,",inag003"
      END IF
   END IF
   
   #---9---庫存單位
   IF tm2.inag007 = 'Y' THEN
      #LET g_d1_sql = g_d1_sql,",inag007,''"           #150204-00013#7 150306 pomelo mark
      LET g_d1_sql = g_d1_sql,",inag007,t6.oocal003"   #150204-00013#7 150306 pomelo add
      LET g_d2_sql = g_d2_sql,",'',''"
      #150204-00013#7 150306 pomelo add(s)
      LET g_d1_join = g_d1_join," LEFT OUTER JOIN oocal_t t6 ON t6.oocalent = inagent",
                                "                           AND t6.oocal001 = inag007",
                                "                           AND t6.oocal002 = '",g_dlang,"'"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inag007"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inag007"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",'',''"
      #LET g_d2_sql = g_d2_sql,",inag007,''"           #150204-00013#7 150306 pomelo mark
      LET g_d2_sql = g_d2_sql,",inag007,t6.oocal003"   #150204-00013#7 150306 pomelo add
      #150204-00013#7 150306 pomelo add(s)
      LET g_d2_join = g_d2_join," LEFT OUTER JOIN oocal_t t6 ON t6.oocalent = inagent",
                                "                           AND t6.oocal001 = inag007",
                                "                           AND t6.oocal002 = '",g_dlang,"'"
      #150204-00013#7 150306 pomelo add(e)
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inag007"
         #LET g_d2_sql_group = "inag007"              #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = "inag007,t6.oocal003"   #150204-00013#7 150306 pomelo add
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inag007"
         #LET g_d2_sql_group = g_d2_sql_group,",inag007"              #150204-00013#7 150306 pomelo mark
         LET g_d2_sql_group = g_d2_sql_group,",inag007,t6.oocal003"   #150204-00013#7 150306 pomelo add
      END IF
   END IF
   
   #150204-00013#7 150306 pomelo add(s)
   #---10---有效日期
   IF tm2.inad010 = 'Y' OR tm2.inad011 = 'Y' THEN
     #LET g_d1_sql = g_d1_sql,",inad011"
     #LET g_d2_sql = g_d2_sql,",''"   
      LET g_d1_join = g_d1_join," LEFT OUTER JOIN (SELECT inadent,inadsite,inad001,inad002,inad003,inad010,pmaal004,inad011,inad012 ",
                                "                    FROM inad_t LEFT OUTER JOIN pmaal_t ON inadent = pmaalent AND  ",
                                "                                                              inad010 = pmaal001 AND  ",
                                "                                                              pmaal002 = '",g_dlang,"')",                                                              
                                "              ON inadent = inagent",
                                "             AND inadsite = inagsite",
                                "             AND inad001 = inag001",
                                "             AND inad002 = inag002",
                                "             AND inad003 = inag006"
      LET g_d2_inad = " LEFT OUTER JOIN (SELECT inadent,inadsite,inad001,inad002,inad003,inad010,pmaal004,inad011,inad012 ",
                      "                    FROM inad_t LEFT OUTER JOIN pmaal_t ON inadent = pmaalent AND  ",
                      "                                                              inad010 = pmaal001 AND  ",
                      "                                                              pmaal002 = '",g_dlang,"')",                                                              
                      "              ON inadent = inagent",
                      "             AND inadsite = inagsite",
                      "             AND inad001 = inag001",
                      "             AND inad002 = inag002",
                      "             AND inad003 = inag006"
                   
     #IF cl_null(g_d1_sql_order) THEN
     #   LET g_d1_sql_order = "inad011"
     #ELSE
     #   LET g_d1_sql_order = g_d1_sql_order,",inad011"
     #END IF
   ELSE
     #LET g_d1_sql = g_d1_sql,",''"
     #LET g_d2_sql = g_d2_sql,",inad011"
     LET g_d2_join = g_d2_join," LEFT OUTER JOIN (SELECT inadent,inadsite,inad001,inad002,inad003,inad010,pmaal004,inad011,inad012 ",
                                "                    FROM inad_t LEFT OUTER JOIN pmaal_t ON inadent = pmaalent AND  ",
                                "                                                              inad010 = pmaal001 AND  ",
                                "                                                              pmaal002 = '",g_dlang,"')",                                                              
                                "              ON inadent = inagent",
                                "             AND inadsite = inagsite",
                                "             AND inad001 = inag001",
                                "             AND inad002 = inag002",
                                "             AND inad003 = inag006"
     #IF cl_null(g_d2_sql_order) THEN
     #   LET g_d2_sql_order = "inad011"
     #   LET g_d2_sql_group = "inad011"
     #ELSE
     #   LET g_d2_sql_order = g_d2_sql_order,",inad011"
     #   LET g_d2_sql_group = g_d2_sql_group,",inad011"
     #END IF
   END IF
   #150204-00013#7 150306 pomelo add(e)
   
   IF tm2.inad011 = 'Y' THEN
      LET g_d1_sql = g_d1_sql,",inad011"
      LET g_d2_sql = g_d2_sql,",''" 
      
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inad011"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inad011"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",''"
      LET g_d2_sql = g_d2_sql,",inad011"
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inad011"
         LET g_d2_sql_group = "inad011"
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inad011"
         LET g_d2_sql_group = g_d2_sql_group,",inad011"
      END IF   
   END IF
   
   IF tm2.inad010 = 'Y' THEN
      LET g_d1_sql = g_d1_sql,",inad010,pmaal004"
      LET g_d2_sql = g_d2_sql,",'',''" 
      
      IF cl_null(g_d1_sql_order) THEN
         LET g_d1_sql_order = "inad010"
      ELSE
         LET g_d1_sql_order = g_d1_sql_order,",inad010"
      END IF
   ELSE
      LET g_d1_sql = g_d1_sql,",'',''"
      LET g_d2_sql = g_d2_sql,",inad010,pmaal004"
      IF cl_null(g_d2_sql_order) THEN
         LET g_d2_sql_order = "inad010"
         LET g_d2_sql_group = "inad010,pmaal004"
      ELSE
         LET g_d2_sql_order = g_d2_sql_order,",inad010"
         LET g_d2_sql_group = g_d2_sql_group,",inad010,pmaal004"
      END IF   
   END IF
   
   
   LET g_sql = g_d1_sql, 
              #"  FROM inag_t,imaa_t",  #150204-00013#7 150306 pomelo mark
              #150204-00013#7 150306 pomelo add(s)
              "  FROM inag_t",
              g_d1_join," ,imaa_t ",g_d1_imaa
              #150204-00013#7 150306 pomelo add(e)
              
   IF tm2.inad010 = 'N' AND tm2.inad011 = 'N' AND g_wc3 != " 1=1" THEN
      LET g_sql = g_sql ,",inad_t "
   END IF
              
   LET g_sql = g_sql,
              " WHERE inagent= ? AND inagent = imaaent AND inag001 = imaa001 AND ", ls_wc
              
   IF tm2.inad010 = 'N' AND tm2.inad011 = 'N' AND g_wc3 != ' 1=1' THEN
      LET g_sql = g_sql , " AND inadent = inagent AND inadsite = inagsite",
                          " AND inad001 = inag001 AND inad002 = inag002",
                          " AND inad003 = inag006 "
   END IF           
              
   IF tm.l_inag012 != 'ALL' THEN
      LET g_sql = g_sql," AND inag012 ='",tm.l_inag012,"'"
   END IF
   
   IF tm.l_inag010 != 'ALL' THEN
      LET g_sql = g_sql," AND inag010 ='",tm.l_inag010,"'"
   END IF
    
   IF tm.l_qty_flag = 'Y' THEN
      LET g_sql = g_sql," AND inag008 != 0"
   END IF

   LET g_sql = g_sql, cl_sql_add_filter("inag_t") 
   
   IF NOT cl_null(g_d1_sql_order) THEN
      LET g_sql = g_sql," ORDER BY ",g_d1_sql_order
   END IF

   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   PREPARE ainq900_pb FROM g_sql
   DECLARE b_fill_curs CURSOR FOR ainq900_pb

   OPEN b_fill_curs USING g_enterprise

   FOREACH b_fill_curs INTO g_inag_d[l_ac].sel,g_inag_d[l_ac].inagsite,g_inag_d[l_ac].inagsite_desc,
                            g_inag_d[l_ac].inag001,g_inag_d[l_ac].inag001_desc,g_inag_d[l_ac].inag001_desc_desc,
                            g_inag_d[l_ac].imaa126,g_inag_d[l_ac].imaa126_desc,  
                            g_inag_d[l_ac].inag002,g_inag_d[l_ac].inag002_desc,                            
                            g_inag_d[l_ac].inag004,g_inag_d[l_ac].inag004_desc,
                            #150204-00013#7 150306 pomelo add(s)
                            g_inag_d[l_ac].inaa102,g_inag_d[l_ac].inaa120,g_inag_d[l_ac].inaa120_desc,
                            g_inag_d[l_ac].imaa009,g_inag_d[l_ac].imaa009_desc,
                            #150204-00013#7 150306 pomelo add(e)
                            g_inag_d[l_ac].inag005,g_inag_d[l_ac].inag005_desc,
                            g_inag_d[l_ac].inag006,g_inag_d[l_ac].inag003,
                            g_inag_d[l_ac].inag007,g_inag_d[l_ac].inag007_desc,
                            g_inag_d[l_ac].inad011,         #150204-00013#7 150306 pomelo add
                            g_inag_d[l_ac].inad010,g_inag_d[l_ac].inad010_desc
      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.code   = SQLCA.sqlcode
         LET g_errparam.popup  = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      CALL ainq900_detail_show("'1'")

      IF l_ac > g_max_rec THEN
         IF g_error_show = 1 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend =  ""
            LET g_errparam.code   =  9035
            LET g_errparam.popup  = TRUE
            CALL cl_err()

         END IF
         EXIT FOREACH
      END IF
      LET l_ac = l_ac + 1

   END FOREACH

   CALL g_inag_d.deleteElement(g_inag_d.getLength())

   LET g_error_show = 0

   LET g_detail_cnt = g_inag_d.getLength()
   DISPLAY g_detail_cnt TO FORMONLY.h_count
   LET g_detail_idx = 1
   DISPLAY g_detail_idx TO FORMONLY.h_index
   LET l_ac = g_cnt
   LET g_cnt = 0

   #應用 qs06 樣板自動產生(Version:2)
   #+ b_fill段CURSOR釋放
   CLOSE b_fill_curs
   FREE ainq900_pb

   LET l_ac = 1
   CALL ainq900_b_fill2()

   CALL ainq900_filter_show('inagsite','b_inagsite')
   CALL ainq900_filter_show('inag001','b_inag001')
   CALL ainq900_filter_show('inag002','b_inag002')
   CALL ainq900_filter_show('inag004','b_inag004')
   CALL ainq900_filter_show('inag005','b_inag005')
   CALL ainq900_filter_show('inag006','b_inag006')
   CALL ainq900_filter_show('inag003','b_inag003')
   CALL ainq900_filter_show('inag007','b_inag007')
   
END FUNCTION]]>
  </point>
  <point name="function.ainq900_b_fill2" order="5" ver="2" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_b_fill2()
   DEFINE li_ac           LIKE type_t.num5
   DEFINE ls_wc           STRING
   DEFINE l_sql_group     STRING
   
   
   LET ls_wc = g_wc, " AND ", g_wc2, " AND ", g_wc_filter, " AND ",g_wc3
   
   LET li_ac = l_ac
   DISPLAY li_ac TO FORMONLY.cnt
   LET g_detail_idx2 = 1
   DISPLAY g_detail_idx2 TO FORMONLY.idx
   CALL g_inag2_d.clear()
   #150204-00013#7 150306 pomelo mark(s)
   #LET g_sql = g_d2_sql,",SUM(COALESCE(inag008,0)),inag016,inag015,inag014,inag012,inag010",
               #"  FROM inag_t,imaa_t",
   #150204-00013#7 150306 pomelo mark(e)
   #150204-00013#7 150306 pomelo add(s)
   LET g_sql = g_d2_sql,",SUM(COALESCE(inag008,0)),inag016,inag015,inag014,inag012,inag010,inad012",
               "  FROM inag_t",
               g_d2_join,g_d2_inad," ,imaa_t ",g_d2_imaa,
   #150204-00013#7 150306 pomelo add(e)
               " WHERE inagent = ? ",
               "   AND inagent = imaaent ",
               "   AND inag001 = imaa001 AND ",ls_wc
               
   IF tm.l_inag012 != 'ALL' THEN
      LET g_sql = g_sql," AND inag012 ='",tm.l_inag012,"'"
   END IF 
   
   IF tm.l_inag010 != 'ALL' THEN
      LET g_sql = g_sql," AND inag010 ='",tm.l_inag010,"'"
   END IF   
   
   IF tm.l_qty_flag = 'Y' THEN
      LET g_sql = g_sql," AND inag008 != 0"
   END IF
   
   #---1---營運組織
   IF tm2.inagsite = 'Y' THEN
      LET g_sql = g_sql ," AND inagsite = '",g_inag_d[g_detail_idx].inagsite CLIPPED,"'"
   END IF
   
   #---2---商品編號
   IF tm2.inag001 = 'Y' THEN
      LET g_sql = g_sql ," AND inag001 = '",g_inag_d[g_detail_idx].inag001 CLIPPED,"'"
   END IF
   #---2.1---品牌
   IF tm2.imaa126 = 'Y' THEN
      LET g_sql = g_sql ," AND imaa126 = '",g_inag_d[g_detail_idx].imaa126 CLIPPED,"'"
   END IF
   #---3---產品特徵
   IF tm2.inag002 = 'Y' THEN
      IF cl_null(g_inag_d[g_detail_idx].inag002) THEN
         LET g_sql = g_sql ," AND inag002 = ' '"
      ELSE
         LET g_sql = g_sql ," AND inag002 = '",g_inag_d[g_detail_idx].inag002 CLIPPED,"'"
      END IF
   END IF
   
   #---4---庫存管理特徵
   IF tm2.inag003 = 'Y' THEN
      IF cl_null(g_inag_d[g_detail_idx].inag003) THEN
         LET g_sql = g_sql ," AND inag003 = ' '"
      ELSE
         LET g_sql = g_sql ," AND inag003 = '",g_inag_d[g_detail_idx].inag003 CLIPPED,"'"
      END IF 
   END IF
   
   #---5---庫位編號
   IF tm2.inag004 = 'Y' THEN
      LET g_sql = g_sql ," AND inag004 = '",g_inag_d[g_detail_idx].inag004 CLIPPED,"'"
   END IF
   
   #150204-00013#7 150306 pomelo add(s)
   #---6---產品分類
   IF tm2.imaa009 = 'Y' THEN
      LET g_sql = g_sql ," AND imaa009 = '",g_inag_d[g_detail_idx].imaa009 CLIPPED,"'"
   END IF
   
   #150204-00013#7 150306 pomelo add(e)
   
   #---7---儲位編號
   IF tm2.inag005 = 'Y' THEN
      IF cl_null(g_inag_d[g_detail_idx].inag005) THEN
         LET g_sql = g_sql ," AND inag005 = ' '"
      ELSE
         LET g_sql = g_sql ," AND inag005 = '",g_inag_d[g_detail_idx].inag005 CLIPPED,"'"
      END IF
   END IF
   
   #---8---批號
   IF tm2.inag006 = 'Y' THEN
      IF cl_null(g_inag_d[g_detail_idx].inag006) THEN
         LET g_sql = g_sql ," AND inag006 = ' '"
      ELSE
         LET g_sql = g_sql ," AND inag006 = '",g_inag_d[g_detail_idx].inag006 CLIPPED,"'"
      END IF
   END IF
   
   #---9---庫存單位
   IF tm2.inag007 = 'Y' THEN
      LET g_sql = g_sql ," AND inag007 = '",g_inag_d[g_detail_idx].inag007 CLIPPED,"'"
   END IF
   
   #150204-00013#7 150306 pomelo add(s)
   #---10---有效日期
   IF tm2.inad011 = 'Y' THEN
      IF cl_null(g_inag_d[g_detail_idx].inad011) THEN
         LET g_sql = g_sql ," AND inad011 IS NULL"
      ELSE
         LET g_sql = g_sql ," AND inad011 = '",g_inag_d[g_detail_idx].inad011 CLIPPED,"'"
      END IF
   END IF
   #150204-00013#7 150306 pomelo add(e)
   
   #---11---供應商
   
   IF tm2.inad010 = 'Y' THEN
      IF cl_null(g_inag_d[g_detail_idx].inad010) THEN
         LET g_sql = g_sql ," AND inad010 IS NULL"
      ELSE
         LET g_sql = g_sql ," AND inad010 = '",g_inag_d[g_detail_idx].inad010 CLIPPED,"'"
      END IF
   END IF
   
   LET g_sql = g_sql, cl_sql_add_filter("inag_t") 

   IF cl_null(g_d2_sql_group) THEN
      LET l_sql_group = " GROUP BY inag016,inag015,inag014,inag012,inag010,inad012"
   ELSE
      LET l_sql_group = " GROUP BY ",g_d2_sql_group,",inag016,inag015,inag014,inag012,inag010,inad012"
   END IF

   LET g_sql = g_sql," ",l_sql_group
   
   IF NOT cl_null(g_d2_sql_order) THEN
      LET g_sql = g_sql," ORDER BY ",g_d2_sql_order
   END IF

   LET g_sql = cl_sql_add_mask(g_sql)              #遮蔽特定資料
   PREPARE ainq900_pb2 FROM g_sql
   DECLARE b_fill_curs2 CURSOR FOR ainq900_pb2

   OPEN b_fill_curs2 USING g_enterprise

   LET l_ac = 1
   FOREACH b_fill_curs2 INTO g_inag2_d[l_ac].inagsite,g_inag2_d[l_ac].inagsite_desc,
                             g_inag2_d[l_ac].inag001, g_inag2_d[l_ac].inag001_desc,g_inag2_d[l_ac].inag001_desc_desc,
                             g_inag2_d[l_ac].imaa126, g_inag2_d[l_ac].imaa126_desc,
                             g_inag2_d[l_ac].inag002, g_inag2_d[l_ac].inag002_desc,
                             g_inag2_d[l_ac].inag004, g_inag2_d[l_ac].inag004_desc,
                             #150204-00013#7 150306 pomelo add(s)
                             g_inag2_d[l_ac].inaa102,g_inag2_d[l_ac].inaa120,g_inag2_d[l_ac].inaa120_desc,
                             g_inag2_d[l_ac].imaa009,g_inag2_d[l_ac].imaa009_desc,
                             #150204-00013#7 150306 pomelo add(e)
                             g_inag2_d[l_ac].inag005, g_inag2_d[l_ac].inag005_desc,
                             g_inag2_d[l_ac].inag006, g_inag2_d[l_ac].inag003,
                             g_inag2_d[l_ac].inag007, g_inag2_d[l_ac].inag007_desc,
                             g_inag2_d[l_ac].inad011,    #150204-00013#7 150306 pomelo add
                             g_inag2_d[l_ac].inad010, g_inag2_d[l_ac].inad010_desc,
                             g_inag2_d[l_ac].inag008, g_inag2_d[l_ac].inag016, g_inag2_d[l_ac].inag015,
                             g_inag2_d[l_ac].inag014, g_inag2_d[l_ac].inag012, g_inag2_d[l_ac].inag010,
                             g_inag2_d[l_ac].inad012     #150204-00013#7 150306 pomelo add

      IF SQLCA.sqlcode THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.extend = "FOREACH:"
         LET g_errparam.code   = SQLCA.sqlcode
         LET g_errparam.popup  = TRUE
         CALL cl_err()

         EXIT FOREACH
      END IF

      CALL ainq900_detail_show("'2'")

      IF l_ac > g_max_rec THEN
         IF g_error_show = 1 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.extend =  ""
            LET g_errparam.code   =  9035
            LET g_errparam.popup  = TRUE
            CALL cl_err()

         END IF
         EXIT FOREACH
      END IF
      LET l_ac = l_ac + 1

   END FOREACH
   
   CALL g_inag2_d.deleteElement(g_inag2_d.getLength())

   LET g_error_show = 0

   LET g_detail_cnt2 = g_inag2_d.getLength()
   LET g_detail_idx2 = 1
   CLOSE b_fill_curs2
   FREE ainq900_pb2
   
   LET l_ac = li_ac

END FUNCTION]]>
  </point>
  <point name="function.ainq900_detail_show" order="6" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_detail_show(ps_page)
   DEFINE ps_page    STRING
   DEFINE ls_sql     STRING
   DEFINE l_success  LIKE type_t.num5

   #讀入ref值
   IF ps_page.getIndexOf("'1'",1) > 0 THEN
      #150204-00013#7 150306 pomelo mark(s)
      ##營運組織
      #CALL s_desc_get_department_desc(g_inag_d[l_ac].inagsite) 
      # RETURNING g_inag_d[l_ac].inagsite_desc
      #
      ##商品編號
      #CALL s_desc_get_item_desc(g_inag_d[l_ac].inag001)
      # RETURNING g_inag_d[l_ac].inag001_desc,g_inag_d[l_ac].inag001_desc_desc
      #150204-00013#7 150306 pomelo mark(e)
      
      #產品特徵
      IF NOT cl_null(g_inag_d[l_ac].inag001) AND NOT cl_null( g_inag_d[l_ac].inag002) THEN
         CALL s_feature_description(g_inag_d[l_ac].inag001,g_inag_d[l_ac].inag002)
          RETURNING l_success,g_inag_d[l_ac].inag002_desc
      END IF
      #150204-00013#7 150306 pomelo mark(s)
      ##庫位
      #CALL s_desc_get_stock_desc(g_inag_d[l_ac].inagsite,g_inag_d[l_ac].inag004)
      # RETURNING g_inag_d[l_ac].inag004_desc
      #
      ##庫區類別、專櫃編號
      #SELECT inaa102,inaa120 INTO g_inag_d[l_ac].inaa102,g_inag_d[l_ac].inaa120
      # FROM inaa_t
      # WHERE inaaent = g_enterprise
      #   AND inaasite = g_inag_d[l_ac].inagsite
      #   AND inaa001 = g_inag_d[l_ac].inag004
      #
      ##商品品類
      #SELECT imaa009 INTO g_inag_d[l_ac].imaa009 FROM imaa_t
      # WHERE imaaent = g_enterprise
      #   AND imaa001 = g_inag_d[l_ac].inag001
      #
      #CALL s_desc_get_rtaxl003_desc(g_inag_d[l_ac].imaa009)
      # RETURNING g_inag_d[l_ac].imaa009_desc
      #
      ##儲位
      #CALL s_desc_get_locator_desc(g_inag_d[l_ac].inagsite,g_inag_d[l_ac].inag004,g_inag_d[l_ac].inag005)
      # RETURNING g_inag_d[l_ac].inag005_desc
      # 
      ##庫存單位
      #CALL s_desc_get_unit_desc(g_inag_d[l_ac].inag007)
      # RETURNING g_inag_d[l_ac].inag007_desc
      #
      #SELECT inad011 INTO g_inag_d[l_ac].inad011 FROM inad_t
      # WHERE inadent = g_enterprise
      #   AND inadsite = g_inag_d[l_ac].inagsite
      #   AND inad001 = g_inag_d[l_ac].inag001
      #   AND inad002 = g_inag_d[l_ac].inag002
      #   AND inad003 = g_inag_d[l_ac].inag006        
      #150204-00013#7 150306 pomelo mark(e)
      
      ##供應商
      #CALL s_desc_get_trading_partner_abbr_desc(g_inag_d[l_ac].inad010)
      # RETURNING g_inag_d[l_ac].inad010_desc
   END IF
   
   IF ps_page.getIndexOf("'2'",1) > 0 THEN
      #150204-00013#7 150306 pomelo mark(s)
      ##營運組織
      #CALL s_desc_get_department_desc(g_inag2_d[l_ac].inagsite) 
      # RETURNING g_inag2_d[l_ac].inagsite_desc
      #
      ##商品編號
      #CALL s_desc_get_item_desc(g_inag2_d[l_ac].inag001)
      # RETURNING g_inag2_d[l_ac].inag001_desc,g_inag2_d[l_ac].inag001_desc_desc
      #150204-00013#7 150306 pomelo mark(e)
      
      #產品特徵
      IF NOT cl_null(g_inag2_d[l_ac].inag001) AND NOT cl_null( g_inag2_d[l_ac].inag002) THEN
         CALL s_feature_description(g_inag2_d[l_ac].inag001,g_inag2_d[l_ac].inag002)
          RETURNING l_success,g_inag2_d[l_ac].inag002_desc          
      END IF
      
      #150204-00013#7 150306 pomelo mark(s)
      ##庫位
      #CALL s_desc_get_stock_desc(g_inag2_d[l_ac].inagsite,g_inag2_d[l_ac].inag004)
      # RETURNING g_inag2_d[l_ac].inag004_desc
      #
      ##庫區類別、專櫃編號
      #SELECT inaa102,inaa120 INTO g_inag2_d[l_ac].inaa102,g_inag2_d[l_ac].inaa120
      # FROM inaa_t
      # WHERE inaaent = g_enterprise
      #   AND inaasite = g_inag2_d[l_ac].inagsite
      #   AND inaa001 = g_inag2_d[l_ac].inag004
      #
      ##商品品類
      #SELECT imaa009 INTO g_inag2_d[l_ac].imaa009 FROM imaa_t
      # WHERE imaaent = g_enterprise
      #   AND imaa001 = g_inag2_d[l_ac].inag001
      #
      #CALL s_desc_get_rtaxl003_desc(g_inag2_d[l_ac].imaa009)
      # RETURNING g_inag2_d[l_ac].imaa009_desc
      #
      ##儲位
      #CALL s_desc_get_locator_desc(g_inag2_d[l_ac].inagsite,g_inag2_d[l_ac].inag004,g_inag2_d[l_ac].inag005)
      # RETURNING g_inag2_d[l_ac].inag005_desc
      # 
      ##庫存單位
      #CALL s_desc_get_unit_desc(g_inag2_d[l_ac].inag007)
      # RETURNING g_inag2_d[l_ac].inag007_desc
      #
      #SELECT inad011,inad012 INTO g_inag2_d[l_ac].inad011,g_inag2_d[l_ac].inad012 FROM inad_t
      # WHERE inadent = g_enterprise
      #   AND inadsite = g_inag2_d[l_ac].inagsite
      #   AND inad001 = g_inag2_d[l_ac].inag001
      #   AND inad002 = g_inag2_d[l_ac].inag002
      #   AND inad003 = g_inag2_d[l_ac].inag006        
      #150204-00013#7 150306 pomelo mark(e)
      
      ##供應商
      #CALL s_desc_get_trading_partner_abbr_desc(g_inag2_d[l_ac].inad010)
      # RETURNING g_inag2_d[l_ac].inad010_desc
   END IF
   
   
END FUNCTION]]>
  </point>
  <point name="function.ainq900_filter" order="7" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_filter()

   LET INT_FLAG = 0

   LET g_qryparam.state = 'c'
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1

   LET g_wc_filter_t = g_wc_filter
   LET g_wc_t = g_wc

   #CALL gfrm_curr.setFieldHidden("formonly.sel", TRUE)
   #CALL gfrm_curr.setFieldHidden("formonly.b_statepic", TRUE)

   IF g_wc_filter != " 1=1" THEN
      LET g_wc = cl_replace_str(g_wc, g_wc_filter, '')
   END IF

   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   #應用 qs08 樣板自動產生(Version:3)
   #+ filter段DIALOG段的組成
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)

      #單頭
      CONSTRUCT g_wc_filter ON inagsite,inag001,inag002,inag004,inag005,inag006,inag003,inag007
                          FROM s_detail1[1].b_inagsite,s_detail1[1].b_inag001,s_detail1[1].b_inag002,
                              s_detail1[1].b_inag004,s_detail1[1].b_inag005,s_detail1[1].b_inag006,s_detail1[1].b_inag003,
                              s_detail1[1].b_inag007

         BEFORE CONSTRUCT
            DISPLAY ainq900_filter_parser('inagsite') TO s_detail1[1].b_inagsite
            DISPLAY ainq900_filter_parser('inag001') TO s_detail1[1].b_inag001
            DISPLAY ainq900_filter_parser('inag002') TO s_detail1[1].b_inag002
            DISPLAY ainq900_filter_parser('inag004') TO s_detail1[1].b_inag004
            DISPLAY ainq900_filter_parser('inag005') TO s_detail1[1].b_inag005
            DISPLAY ainq900_filter_parser('inag006') TO s_detail1[1].b_inag006
            DISPLAY ainq900_filter_parser('inag003') TO s_detail1[1].b_inag003
            DISPLAY ainq900_filter_parser('inag007') TO s_detail1[1].b_inag007

         ON ACTION controlp INFIELD b_inagsite
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.where = s_aooi500_q_where(g_prog,'inagsite',g_site,'c') #150308-00001#3 150309 pomelo add 'c'
            CALL q_ooef001_24() 
            DISPLAY g_qryparam.return1 TO b_inagsite  #顯示到畫面上         
            NEXT FIELD b_inagsite                     #返回原欄位
                     
         ON ACTION controlp INFIELD b_inag001          
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_inag001()                             #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag001      #顯示到畫面上
            NEXT FIELD b_inag001                         #返回原欄位
            
         ON ACTION controlp INFIELD b_inag002          
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_inag002()                             #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag002      #顯示到畫面上
            NEXT FIELD b_inag002                         #返回原欄位
            
         ON ACTION controlp INFIELD b_inag003          
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_inag003()                             #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag003      #顯示到畫面上
            NEXT FIELD b_inag003                         #返回原欄位
            
         ON ACTION controlp INFIELD b_inag004          
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_inag004_11()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag004      #顯示到畫面上
            NEXT FIELD b_inag004                         #返回原欄位
            
         ON ACTION controlp INFIELD b_inag005          
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_inag005_12()                          #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag005      #顯示到畫面上
            NEXT FIELD b_inag005                         #返回原欄位 
            
         ON ACTION controlp INFIELD b_inag007          
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooca001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag007      #顯示到畫面上
            NEXT FIELD b_inag007                         #返回原欄位
            
            
      END CONSTRUCT

      #add-point:filter段add_cs

      #end add-point

      BEFORE DIALOG
         #add-point:filter段b_dialog

         #end add-point

      ON ACTION accept
         ACCEPT DIALOG

      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG

      #交談指令共用ACTION
      &include "common_action.4gl"
         CONTINUE DIALOG

   END DIALOG

   IF NOT INT_FLAG THEN
      LET g_wc_filter = g_wc_filter, " "
   ELSE
      LET g_wc_filter = g_wc_filter_t
   END IF

   CALL ainq900_filter_show('inagsite','b_inagsite')
   CALL ainq900_filter_show('inag001','b_inag001')
   CALL ainq900_filter_show('inag002','b_inag002')
   CALL ainq900_filter_show('inag004','b_inag004')
   CALL ainq900_filter_show('inag005','b_inag005')
   CALL ainq900_filter_show('inag006','b_inag006')
   CALL ainq900_filter_show('inag003','b_inag003')
   CALL ainq900_filter_show('inag007','b_inag007')

  #CALL gfrm_curr.setFieldHidden("formonly.sel", FALSE)
  #CALL gfrm_curr.setFieldHidden("formonly.b_statepic", FALSE)

END FUNCTION]]>
  </point>
  <point name="function.ainq900_filter_parser" order="8" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_filter_parser(ps_field)
   {<Local define>}
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num5
   DEFINE li_tmp2    LIKE type_t.num5
   DEFINE ls_var     STRING
   {</Local define>}

   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF

   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF

   RETURN ls_var

END FUNCTION]]>
  </point>
  <point name="function.ainq900_filter_show" order="9" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION ainq900_filter_show(ps_field,ps_object)
   DEFINE ps_field         STRING
   DEFINE ps_object        STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING

   LET ls_name = "formonly.", ps_object

   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LET ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF

   #顯示資料組合
   LET ls_condition = ainq900_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF

   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)

END FUNCTION]]>
  </point>
  <point name="function.ainq900_comp_visible" order="10" ver="2" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[#控制欄位的顯示
PRIVATE FUNCTION ainq900_comp_visible()
   CALL cl_set_comp_visible("b_inagsite,b_inagsite_desc",TRUE)
   CALL cl_set_comp_visible("b_inagsite_1,b_inagsite_1_desc",TRUE)
   IF tm2.inagsite = 'Y' THEN
      CALL cl_set_comp_visible("b_inagsite_1,b_inagsite_1_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inagsite,b_inagsite_desc",FALSE)
   END IF

   CALL cl_set_comp_visible("b_inag001,b_inag001_desc,b_inag001_desc_desc",TRUE)
   CALL cl_set_comp_visible("b_inag001_1,b_inag001_1_desc,b_inag001_1_desc_desc",TRUE)
   IF tm2.inag001 = 'Y' THEN
      CALL cl_set_comp_visible("b_inag001_1,b_inag001_1_desc,b_inag001_1_desc_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inag001,b_inag001_desc,b_inag001_desc_desc",FALSE)
   END IF

   CALL cl_set_comp_visible("b_inag002,b_inag002_desc",TRUE)
   CALL cl_set_comp_visible("b_inag002_1,b_inag002_1_desc",TRUE)
   IF tm2.inag002 = 'Y' THEN
      CALL cl_set_comp_visible("b_inag002_1,b_inag002_1_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inag002,b_inag002_desc",FALSE)
   END IF

   CALL cl_set_comp_visible("b_inag003",TRUE)
   CALL cl_set_comp_visible("b_inag003_1",TRUE)
   IF tm2.inag003 = 'Y' THEN
      CALL cl_set_comp_visible("b_inag003_1",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inag003",FALSE)
   END IF

   CALL cl_set_comp_visible("b_inag004_1,b_inag004_1_desc,l_inaa102_1,l_inaa120_1,l_inaa120_1_desc",TRUE)
   CALL cl_set_comp_visible("b_inag004,b_inag004_desc,l_inaa102,l_inaa120,l_inaa120_desc",TRUE)
   IF tm2.inag004 = 'Y' THEN
      CALL cl_set_comp_visible("b_inag004_1,b_inag004_1_desc,l_inaa102_1,l_inaa120_1,l_inaa120_1_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inag004,b_inag004_desc,l_inaa102,l_inaa120,l_inaa120_desc",FALSE)
   END IF

   CALL cl_set_comp_visible("b_inag005,b_inag005_desc",TRUE)
   CALL cl_set_comp_visible("b_inag005_1,b_inag005_1_desc",TRUE)
   IF tm2.inag005 = 'Y' THEN
      CALL cl_set_comp_visible("b_inag005_1,b_inag005_1_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inag005,b_inag005_desc",FALSE)
   END IF

   CALL cl_set_comp_visible("b_inag006",TRUE)
   CALL cl_set_comp_visible("b_inag006_1",TRUE)
   IF tm2.inag006 = 'Y' THEN
      CALL cl_set_comp_visible("b_inag006_1",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inag006",FALSE)
   END IF

   CALL cl_set_comp_visible("b_inag007,b_inag007_desc",TRUE)
   CALL cl_set_comp_visible("b_inag007_1,b_inag007_1_desc",TRUE)
   IF tm2.inag007 = 'Y' THEN
      CALL cl_set_comp_visible("b_inag007_1,b_inag007_1_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("b_inag007,b_inag007_desc",FALSE)
   END IF

   CALL cl_set_comp_visible("l_inad011_d1",TRUE)
   CALL cl_set_comp_visible("l_inad011_d2",TRUE)
   IF tm2.inad011 = 'Y' THEN
      CALL cl_set_comp_visible("l_inad011_d2",FALSE)
   ELSE
      CALL cl_set_comp_visible("l_inad011_d1",FALSE)
   END IF

   CALL cl_set_comp_visible("l_imaa009_d1,l_imaa009_d1_desc",TRUE)
   CALL cl_set_comp_visible("l_imaa009_d2,l_imaa009_d2_desc",TRUE)
   IF tm2.imaa009 = 'Y' THEN
      CALL cl_set_comp_visible("l_imaa009_d2,l_imaa009_d2_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("l_imaa009_d1,l_imaa009_d1_desc",FALSE)
   END IF
   
   CALL cl_set_comp_visible("l_inad010_d1,l_inad010_d1_desc",TRUE)
   CALL cl_set_comp_visible("l_inad010_d2,l_inad010_d2_desc",TRUE)
   IF tm2.inad010 = 'Y' THEN
      CALL cl_set_comp_visible("l_inad010_d2,l_inad010_d2_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("l_inad010_d1,l_inad010_d1_desc",FALSE)
   END IF
   
   CALL cl_set_comp_visible("l_imaa126_d1,l_imaa126_d1_desc",TRUE)
   CALL cl_set_comp_visible("l_imaa126_d2,l_imaa126_d2_desc",TRUE)
   IF tm2.imaa126 = 'Y' THEN
      CALL cl_set_comp_visible("l_imaa126_d2,l_imaa126_d2_desc",FALSE)
   ELSE
      CALL cl_set_comp_visible("l_imaa126_d1,l_imaa126_d1_desc",FALSE)
   END IF
END FUNCTION]]>
  </point>
  <point name="construct.c.page1.b_inag001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_imaf001_7()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag001  #顯示到畫面上
            NEXT FIELD b_inag001                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.b_inag002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_inag002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag002  #顯示到畫面上
            NEXT FIELD b_inag002                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.b_inag003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_inag003()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag003  #顯示到畫面上
            NEXT FIELD b_inag003                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.b_inag005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_inag005_5()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag005  #顯示到畫面上
            NEXT FIELD b_inag005                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.b_inag006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_inag006_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag006  #顯示到畫面上
            NEXT FIELD b_inag006                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.b_inag007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_inag007()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inag007  #顯示到畫面上
            NEXT FIELD b_inag007                     #返回原欄位
    

]]>
  </point>
  <point name="construct.c.page1.b_inagsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a08 樣板自動產生(Version:2)
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c' 
            LET g_qryparam.reqry = FALSE
            CALL q_inagsite()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_inagsite  #顯示到畫面上
            NEXT FIELD b_inagsite                     #返回原欄位
    

]]>
  </point>
  <point name="detail_show.body.reference" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_inag_d[l_ac].inag001
            LET ls_sql = "SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'"
            LET ls_sql = cl_sql_add_mask(ls_sql)              #遮蔽特定資料
            CALL ap_ref_array2(g_ref_fields,ls_sql,"") RETURNING g_rtn_fields
            LET g_inag_d[l_ac].inag001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_inag_d[l_ac].inag001_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_inag_d[l_ac].inag001_desc
            LET ls_sql = "SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'"
            LET ls_sql = cl_sql_add_mask(ls_sql)              #遮蔽特定資料
            CALL ap_ref_array2(g_ref_fields,ls_sql,"") RETURNING g_rtn_fields
            LET g_inag_d[l_ac].inag001_desc_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_inag_d[l_ac].inag001_desc_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_inag_d[l_ac].inag004
            LET ls_sql = "SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaa001=? "
            LET ls_sql = cl_sql_add_mask(ls_sql)              #遮蔽特定資料
            CALL ap_ref_array2(g_ref_fields,ls_sql,"") RETURNING g_rtn_fields
            LET g_inag_d[l_ac].inag004_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_inag_d[l_ac].inag004_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_inag_d[l_ac].inag004
            LET g_ref_fields[2] = g_inag_d[l_ac].inag005
            LET ls_sql = "SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inab001=? AND inab002=? "
            LET ls_sql = cl_sql_add_mask(ls_sql)              #遮蔽特定資料
            CALL ap_ref_array2(g_ref_fields,ls_sql,"") RETURNING g_rtn_fields
            LET g_inag_d[l_ac].inag005_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_inag_d[l_ac].inag005_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_inag_d[l_ac].inag007
            LET ls_sql = "SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'"
            LET ls_sql = cl_sql_add_mask(ls_sql)              #遮蔽特定資料
            CALL ap_ref_array2(g_ref_fields,ls_sql,"") RETURNING g_rtn_fields
            LET g_inag_d[l_ac].inag007_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_inag_d[l_ac].inag007_desc
]]>
  </point>
  <point name="free_style.variable" order="" ver="2" cite_std="N" new="N" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[DEFINE g_wc      STRING   #存放inag_t相關欄位的construct欄位
DEFINE g_wc_t    STRING   #存放inag_t相關欄位的construct欄位
DEFINE g_wc2     STRING   #存放imaa_t相關欄位的construct欄位
DEFINE g_wc2_t   STRING   #存放imaa_t相關欄位的construct欄位
DEFINE g_wc3     STRING   #存放inad_t相關欄位的construct欄位
DEFINE g_wc3_t   STRING   #存放inad_t相關欄位的construct欄位
DEFINE tm        RECORD   #存放條件選項
         l_inag012  LIKE type_t.chr10,
         l_inag010  LIKE type_t.chr10,
         l_qty_flag LIKE type_t.chr1
                 END RECORD
DEFINE tm2        RECORD  #存放單頭顯示內容的flag 
         inagsite   LIKE type_t.chr1,
         inag001    LIKE type_t.chr1,
         imaa126    LIKE type_t.chr1,
         inag002    LIKE type_t.chr1,
         inad010    LIKE type_t.chr1,
         inag004    LIKE type_t.chr1,
         inag005    LIKE type_t.chr1,
         inag006    LIKE type_t.chr1,
         imaa009    LIKE type_t.chr1,
         inag003    LIKE type_t.chr1,
         inag007    LIKE type_t.chr1,
         inad011    LIKE type_t.chr1         
                 END RECORD
TYPE type_g_inag_d RECORD
       sel                LIKE type_t.chr1,
       inagsite           LIKE inag_t.inagsite,
       inagsite_desc      LIKE type_t.chr500,
       inag001            LIKE inag_t.inag001,
       inag001_desc       LIKE type_t.chr500,    
       inag001_desc_desc  LIKE type_t.chr500,
       imaa126            LIKE imaa_t.imaa126,
       imaa126_desc       LIKE type_t.chr500,   
       inag002            LIKE inag_t.inag002,
       inag002_desc       LIKE type_t.chr500,
       inad010            LIKE inad_t.inad010,
       inad010_desc       LIKE type_t.chr500,
       inag004            LIKE inag_t.inag004,
       inag004_desc       LIKE type_t.chr500,
       inaa102            LIKE inaa_t.inaa102,
       imaa009            LIKE imaa_t.imaa009,
       imaa009_desc       LIKE type_t.chr500,
       inaa120            LIKE inaa_t.inaa120,
       inaa120_desc       LIKE type_t.chr500,
       inag005            LIKE inag_t.inag005,
       inag005_desc       LIKE type_t.chr500,
       inag006            LIKE inag_t.inag006,
       inag003            LIKE inag_t.inag003,
       inag007            LIKE inag_t.inag007,
       inag007_desc       LIKE type_t.chr500,
       inad011            LIKE inad_t.inad011
                  END RECORD
TYPE type_g_inag2_d RECORD
       inagsite           LIKE inag_t.inagsite,
       inagsite_desc      LIKE type_t.chr500,
       inag001            LIKE inag_t.inag001,
       inag001_desc       LIKE type_t.chr500,
       inag001_desc_desc  LIKE type_t.chr500,
       imaa126            LIKE imaa_t.imaa126,
       imaa126_desc       LIKE type_t.chr500,   
       inag002            LIKE inag_t.inag002,
       inag002_desc       LIKE type_t.chr500,
       inad010            LIKE inad_t.inad010,
       inad010_desc       LIKE type_t.chr500,
       inag004            LIKE inag_t.inag004,
       inag004_desc       LIKE type_t.chr500,
       inaa102            LIKE inaa_t.inaa102,
       imaa009            LIKE imaa_t.imaa009,
       imaa009_desc       LIKE type_t.chr500,
       inaa120            LIKE inaa_t.inaa120,
       inaa120_desc       LIKE type_t.chr500,
       inag005            LIKE inag_t.inag005,
       inag005_desc       LIKE type_t.chr500,
       inag006            LIKE inag_t.inag006,
       inag003            LIKE inag_t.inag003,
       inag007            LIKE inag_t.inag007,
       inag007_desc       LIKE type_t.chr500,
       inad011            LIKE inad_t.inad011,
       inag008            LIKE inag_t.inag008,
       inag016            LIKE inag_t.inag016,
       inag015            LIKE inag_t.inag015,
       inag014            LIKE inag_t.inag014,
       inag012            LIKE inag_t.inag012,
       inag010            LIKE inag_t.inag010,
       inad012            LIKE inad_t.inad012
                  END RECORD
DEFINE g_inag_d   DYNAMIC ARRAY OF type_g_inag_d
DEFINE g_inag2_d   DYNAMIC ARRAY OF type_g_inag2_d
DEFINE g_wc_filter           STRING
DEFINE g_wc_filter_t         STRING
DEFINE g_sql                 STRING                        #組 sql 用 
DEFINE g_forupd_sql          STRING                        #SELECT ... FOR UPDATE  SQL    
DEFINE g_cnt                 LIKE type_t.num10
DEFINE l_ac                  LIKE type_t.num5              #目前處理的ARRAY CNT 
DEFINE g_curr_diag           ui.Dialog                     #Current Dialog     
DEFINE gwin_curr             ui.Window                     #Current Window
DEFINE gfrm_curr             ui.Form                       #Current Form
DEFINE g_current_page        LIKE type_t.num5              #目前所在頁數
DEFINE g_current_row         LIKE type_t.num5              #目前所在筆數
DEFINE g_current_idx         LIKE type_t.num5
DEFINE g_detail_cnt          LIKE type_t.num5              #單身 總筆數(所有資料)
DEFINE g_page                STRING                        #第幾頁
DEFINE g_ch                  base.Channel                  #外串程式用
DEFINE g_ref_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars            DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields          DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_error_show          LIKE type_t.num5
DEFINE g_master_idx          LIKE type_t.num5
DEFINE g_detail_idx          LIKE type_t.num5              #單身 所在筆數(所有資料)
DEFINE g_detail_idx2         LIKE type_t.num5
DEFINE g_detail_cnt2         LIKE type_t.num5              #單身 總筆數(所有資料)
DEFINE g_d1_sql              STRING
#150204-00013#7 150306 pomelo add(s)
DEFINE g_d1_join             STRING
DEFINE g_d1_imaa             STRING
#150204-00013#7 150306 pomelo add(e)
DEFINE g_d1_sql_order        STRING
DEFINE g_d2_sql              STRING
#150204-00013#7 150306 pomelo add(s)
DEFINE g_d2_join             STRING
DEFINE g_d2_imaa             STRING
DEFINE g_d2_inad             STRING
#150204-00013#7 150306 pomelo add(e)
DEFINE g_d2_sql_order        STRING
DEFINE g_d2_sql_group        STRING]]>
  </point>
  <point name="input.a.page1.inag001" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.inag002" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.inag003" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.inag004" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.inag005" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.inag006" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.inag007" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page1.inagsite" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #應用 a05 樣板自動產生(Version:2)
            #確認資料無重複
            IF  g_inag_d[g_detail_idx].inagsite IS NOT NULL AND g_inag_d[g_detail_idx].inag001 IS NOT NULL AND g_inag_d[g_detail_idx].inag002 IS NOT NULL AND g_inag_d[g_detail_idx].inag003 IS NOT NULL AND g_inag_d[g_detail_idx].inag004 IS NOT NULL AND g_inag_d[g_detail_idx].inag005 IS NOT NULL AND g_inag_d[g_detail_idx].inag006 IS NOT NULL AND g_inag_d[g_detail_idx].inag007 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_inag_d[g_detail_idx].inagsite != g_inag_d_t.inagsite OR g_inag_d[g_detail_idx].inag001 != g_inag_d_t.inag001 OR g_inag_d[g_detail_idx].inag002 != g_inag_d_t.inag002 OR g_inag_d[g_detail_idx].inag003 != g_inag_d_t.inag003 OR g_inag_d[g_detail_idx].inag004 != g_inag_d_t.inag004 OR g_inag_d[g_detail_idx].inag005 != g_inag_d_t.inag005 OR g_inag_d[g_detail_idx].inag006 != g_inag_d_t.inag006 OR g_inag_d[g_detail_idx].inag007 != g_inag_d_t.inag007)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM inag_t WHERE "||"inagent = '" ||g_enterprise|| "' AND "||"inagsite = '"||g_inag_d[g_detail_idx].inagsite ||"' AND "|| "inag001 = '"||g_inag_d[g_detail_idx].inag001 ||"' AND "|| "inag002 = '"||g_inag_d[g_detail_idx].inag002 ||"' AND "|| "inag003 = '"||g_inag_d[g_detail_idx].inag003 ||"' AND "|| "inag004 = '"||g_inag_d[g_detail_idx].inag004 ||"' AND "|| "inag005 = '"||g_inag_d[g_detail_idx].inag005 ||"' AND "|| "inag006 = '"||g_inag_d[g_detail_idx].inag006 ||"' AND "|| "inag007 = '"||g_inag_d[g_detail_idx].inag007 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="main.define" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   DEFINE l_success     LIKE type_t.num5 #150308-00001#3 150309 pomelo add]]>
  </point>
  <point name="main.define_sql" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   LET g_forupd_sql = " "]]>
  </point>
  <point name="main.exit" order="" ver="1" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[   CALL s_aooi500_drop_temp() RETURNING l_success   #150308-00001#3 150309 pomelo add]]>
  </point>
  <section id="ainq900.description" ver="1" status="" src="s" readonly="">
    <![CDATA[#應用 a00 樣板自動產生(Version:1)
#+ Version..: T100-ERP-1.00.00(SD版次:2,PR版次:2) Build-000019
#+ 
#+ Filename...: ainq900
#+ Description: 庫存明細查詢作業
#+ Creator....: 01752(2015-02-10 17:10:27)
#+ Modifier...: 01752(2015-07-08 14:33:13) -SD/PR-
]]>
  </section>
  <section id="ainq900.global" ver="3" status="" src="s" readonly="">
    <![CDATA[#應用 i00 樣板自動產生(Version:3)
{<point name="global.memo" />}
 
IMPORT os
IMPORT FGL lib_cl_dlg
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:free_style模組變數(Module Variable)
{<point name="free_style.variable"/>}
#end add-point
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable" edit="s"/>}
#end add-point
 
#add-point:自定義客戶專用模組變數(Module Variable)
{<point name="global.variable_customerization" edit="c"/>}
#end add-point
]]>
  </section>
  <section id="ainq900.main" ver="3" status="" src="s" readonly="">
    <![CDATA[#+ 作業開始
MAIN
   #add-point:main段define (標準程式用)
   {<point name="main.define" edit="s"/>}
   #end add-point    
   #add-point:main段define (客製程式用)
   {<point name="main.define_customerization" edit="c"/>}
   #end add-point
 
   #定義在其他link的程式則無效
   WHENEVER ERROR CALL cl_err_msg_log
 
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("ain","")
 
   #add-point:作業初始化
   {<point name="main.init"/>}
   #end add-point
 
   #add-point:SQL_define
   {<point name="main.define_sql" />}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)    #轉換不同資料庫語法
   DECLARE ainq900_cl CURSOR FROM g_forupd_sql 
   
   IF g_bgjob = "Y" THEN
 
      #add-point:Service Call
      {<point name="main.servicecall" />}
      #end add-point
   ELSE
      #畫面開啟 (identifier)
      OPEN WINDOW w_ainq900 WITH FORM cl_ap_formpath("ain",g_code)
 
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
 
      #程式初始化
      CALL ainq900_init()
 
      #進入選單 Menu (='N')
      CALL ainq900_ui_dialog()
   
      #畫面關閉
      CLOSE WINDOW w_ainq900
   END IF
 
   #add-point:作業離開前
   {<point name="main.exit" />}
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
 
END MAIN
]]>
  </section>
  <section id="ainq900.other_function" ver="2" status="" src="s" readonly="">
    <![CDATA[#add-point:自定義元件(Function)
{<point name="other.function"/>}
#end add-point
]]>
  </section>
</add_points>
