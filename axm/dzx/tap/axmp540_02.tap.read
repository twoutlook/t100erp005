<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<add_points prog="axmp540_02" std_prog="axmp540_02" erpver="1.0" module="AXM" ver="6" env="s" zone="t10prd" booking="N" type="S" identity="s" section_flag="N" designer_ver="1.0">
  <other>
    <code_template value="F" status=""/>
    <free_style value="Y" status=""/>
    <start_arg value="" status=""/>
  </other>
  <point name="dialog.axmp540_02_display01" order="1" ver="2" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
DIALOG axmp540_02_display01()

   DISPLAY ARRAY g_xmdk_d TO s_detail1_axmp540_02.* ATTRIBUTE(COUNT=g_detail_02_cnt)
         
      BEFORE DISPLAY
         CALL axmp540_02_fetch()

      BEFORE ROW  
         LET l_ac = DIALOG.getCurrentRow("s_detail1_axmp540_02")   
         LET g_detail_02_idx = l_ac
         CALL axmp540_02_fetch()  
                
       
   END DISPLAY    
END DIALOG]]>
  </point>
  <point name="function.axmp540_02" order="1" ver="6" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[
PUBLIC FUNCTION axmp540_02(--)
   #add-point:input段變數傳入

   #end add-point
   )
   DEFINE l_sql      STRING
   DEFINE l_linkno   LIKE type_t.num10
   DEFINE i          LIKE type_t.num10
   DEFINE l_xmdk_d   RECORD   
                     linkno         LIKE type_t.num10,        #暫時單號
                     source         LIKE type_t.chr10,        #來源單據1訂單2出通單
                     xmdk007        LIKE xmdk_t.xmdk007,      #客戶
                     xmdk010        LIKE xmdk_t.xmdk010,      #收款條件
                     xmdk011        LIKE xmdk_t.xmdk011,      #交易條件
                     xmdk012        LIKE xmdk_t.xmdk012,      #稅別
                     xmdk016        LIKE xmdk_t.xmdk016,      #幣別
                     xmdk017        LIKE xmdk_t.xmdk017,      #匯率
                     xmdk009        LIKE xmdk_t.xmdk009,      #收貨客戶
                     xmdk008        LIKE xmdk_t.xmdk008,      #收款客戶
                     xmdk015        LIKE xmdk_t.xmdk015,      #發票類型
                     xmdk002        LIKE xmdk_t.xmdk002,      #訂單/出通單性質
                     xmdk028        LIKE xmdk_t.xmdk028,      #包裝單製作
                     xmdk029        LIKE xmdk_t.xmdk029,      #Invoice製作
                     xmdkdocno      LIKE xmdk_t.xmdkdocno,    #出貨單號                     
                     result         LIKE type_t.chr500        #執行結果
                     END RECORD 
  
   DEFINE l_tmp_d   RECORD                     
                     docno   LIKE xmdl_t.xmdldocno,
                     seq     LIKE xmdl_t.xmdlseq,
                     xmdl005 LIKE xmdl_t.xmdl005,
                     xmdl006 LIKE xmdl_t.xmdl006,
                     xmdl008 LIKE xmdl_t.xmdl008,
                     xmdl014 LIKE xmdl_t.xmdl014,
                     xmdl015 LIKE xmdl_t.xmdl015,
                     xmdl016 LIKE xmdl_t.xmdl016,
                     xmdl052 LIKE xmdl_t.xmdl052
                    END RECORD                     

   DEFINE l_xmdl_d  RECORD
                     linkno  LIKE type_t.num5,
                     source  LIKE type_t.chr10,
                     xmdldocno LIKE xmdl_t.xmdldocno,
                     xmdlseq LIKE xmdl_t.xmdlseq,
                     xmdl001 LIKE xmdl_t.xmdl001,
                     xmdl002 LIKE xmdl_t.xmdl002,
                     xmdl003 LIKE xmdl_t.xmdl003,
                     xmdl004 LIKE xmdl_t.xmdl004,
                     xmdl005 LIKE xmdl_t.xmdl005,
                     xmdl006 LIKE xmdl_t.xmdl006,
                     xmdl007 LIKE xmdl_t.xmdl007,
                     xmdl008 LIKE xmdl_t.xmdl008,
                     xmdl009 LIKE xmdl_t.xmdl009,
                     xmdl010 LIKE xmdl_t.xmdl010,
                     xmdl011 LIKE xmdl_t.xmdl011,
                     xmdl012 LIKE xmdl_t.xmdl012,
                     xmdl013 LIKE xmdl_t.xmdl013,
                     xmdl014 LIKE xmdl_t.xmdl014,
                     xmdl015 LIKE xmdl_t.xmdl015,
                     xmdl016 LIKE xmdl_t.xmdl016,
                     xmdl017 LIKE xmdl_t.xmdl017,
                     xmdl018 LIKE xmdl_t.xmdl018,
                     xmdl019 LIKE xmdl_t.xmdl019,
                     xmdl020 LIKE xmdl_t.xmdl020,
                     xmdl021 LIKE xmdl_t.xmdl021,
                     xmdl022 LIKE xmdl_t.xmdl022,
                     xmdl023 LIKE xmdl_t.xmdl023,
                     xmdl024 LIKE xmdl_t.xmdl024,
                     xmdl025 LIKE xmdl_t.xmdl025,
                     xmdl026 LIKE xmdl_t.xmdl026,
                     xmdl027 LIKE xmdl_t.xmdl027,
                     xmdl028 LIKE xmdl_t.xmdl028,
                     xmdl029 LIKE xmdl_t.xmdl029,
                     xmdl030 LIKE xmdl_t.xmdl030,
                     xmdl031 LIKE xmdl_t.xmdl031,
                     xmdl032 LIKE xmdl_t.xmdl032,
                     xmdl033 LIKE xmdl_t.xmdl033,
                     xmdl034 LIKE xmdl_t.xmdl034, 
                     xmdl035 LIKE xmdl_t.xmdl035,
                     xmdl036 LIKE xmdl_t.xmdl036,
                     xmdl037 LIKE xmdl_t.xmdl037,
                     xmdl038 LIKE xmdl_t.xmdl038,
                     xmdl039 LIKE xmdl_t.xmdl039,
                     xmdl040 LIKE xmdl_t.xmdl040,
                     xmdl041 LIKE xmdl_t.xmdl041,
                     xmdl042 LIKE xmdl_t.xmdl042,
                     xmdl043 LIKE xmdl_t.xmdl043,
                     xmdl044 LIKE xmdl_t.xmdl044,
                     xmdl045 LIKE xmdl_t.xmdl045,
                     xmdl046 LIKE xmdl_t.xmdl046,
                     xmdl047 LIKE xmdl_t.xmdl047,
                     xmdl048 LIKE xmdl_t.xmdl048,
                     xmdl049 LIKE xmdl_t.xmdl049,
                     xmdl050 LIKE xmdl_t.xmdl050,
                     xmdl051 LIKE xmdl_t.xmdl051,
                     xmdl052 LIKE xmdl_t.xmdl052,
                     xmdl087 LIKE xmdl_t.xmdl087,
                     xmdl088 LIKE xmdl_t.xmdl088 
                    END RECORD  
   DEFINE l_success  LIKE type_t.num5
   DEFINE l_oodbl004 LIKE oodbL_t.oodbl004
   DEFINE l_oodb005  LIKE oodb_t.oodb005
   DEFINE l_oodb006  LIKE oodb_t.oodb006
   DEFINE l_oodb011  LIKE oodb_t.oodb011  
   DEFINE l_docno    LIKE xmdl_t.xmdldocno   #來源單號   #20141021 by stellar add
   DEFINE l_seq      LIKE xmdl_t.xmdlseq     #項次       #20141021 by stellar add
   DEFINE l_ref_unit LIKE type_t.chr1        #20141024 by stellar add

   #20141021 stellar add ----------------(S)
   #匯總方式為空時，預設1.依客戶匯總
   IF cl_null(g_gather) THEN
      LET g_gather = 1
   END IF
   
   #判斷據點參數若不使用參考單位時，則參考單位、數量不可給值
   CALL cl_get_para(g_enterprise,g_site,'S-BAS-0028') RETURNING l_ref_unit
   #20141021 stellar add ----------------(E)
   
   #清空tmptable
   DELETE FROM p540_02_xmdk_temp
   DELETE FROM p540_02_xmdl_temp
   DELETE FROM p540_02_xmdm_temp
 
   LET l_linkno = ''
   SELECT MAX(linkno) INTO l_linkno
     FROM p540_02_xmdk_temp
   IF cl_null(l_linkno) THEN
      LET l_linkno = 1
   ELSE 
      LET l_linkno = l_linkno + 1   
   END IF  
   
   #抓取已選取單據來源為【訂單】的資料做匯總
   #依客戶、收款條件、交易條件、稅別、幣別、匯率、收貨客戶、收款客戶、發票類型、訂單性質，條件做匯總  
   INITIALIZE l_xmdk_d.* TO NULL
 
   
   #20141021 by stellar modify ----------------- (S)
#   LET l_sql = "SELECT a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015, ",
#               "       a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005 ",
#               "  FROM xmda_t a,p540_01_tmp b",
#               " WHERE a.xmdaent = '",g_enterprise,"' ",
#               "   AND a.xmdasite = '",g_site,"' ",
#               "   AND a.xmdadocno = b.docno ",
#               "   AND b.source = '1' ",              #來源單據：訂單
#               " GROUP BY a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015,a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005 ",
#               " ORDER BY a.xmda004 "
   #依不同的匯總方式進行匯總
   CASE g_gather
      WHEN '1'   #依客戶匯總
           LET l_sql = "SELECT a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015, ",
                       "       a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005, ",
                       "       '','' ",
                       "  FROM xmda_t a,p540_01_tmp b",
                       " WHERE a.xmdaent = '",g_enterprise,"' ",
                       "   AND a.xmdasite = '",g_site,"' ",
                       "   AND a.xmdadocno = b.docno ",
                       "   AND b.source = '1' ",              #來源單據：訂單
                       " GROUP BY a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015,a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005 ",
                       " ORDER BY a.xmda004 "
      WHEN '2'   #依來源單號匯總
           LET l_sql = "SELECT a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015, ",
                       "       a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005, ",
                       "       b.docno,'' ",
                       "  FROM xmda_t a,p540_01_tmp b",
                       " WHERE a.xmdaent = '",g_enterprise,"' ",
                       "   AND a.xmdasite = '",g_site,"' ",
                       "   AND a.xmdadocno = b.docno ",
                       "   AND b.source = '1' ",              #來源單據：訂單
                       " GROUP BY a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015,a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005,b.docno ",
                       " ORDER BY a.xmda004 "
      WHEN '3'   #依來源單號+項次匯總
           LET l_sql = "SELECT a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015, ",
                       "       a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005, ",
                       "       b.docno,b.seq ",
                       "  FROM xmda_t a,p540_01_tmp b",
                       " WHERE a.xmdaent = '",g_enterprise,"' ",
                       "   AND a.xmdasite = '",g_site,"' ",
                       "   AND a.xmdadocno = b.docno ",
                       "   AND b.source = '1' ",              #來源單據：訂單
                       " GROUP BY a.xmda004,a.xmda009,a.xmda010,a.xmda011,a.xmda015,a.xmda016,a.xmda022,a.xmda021,a.xmda035,a.xmda005,b.docno,b.seq ",
                       " ORDER BY a.xmda004 "
   END CASE
   #20141021 by stellar modify ----------------- (E)
               
   PREPARE p540_02_xmda_pr FROM l_sql
   DECLARE p540_02_xmda_cs CURSOR FOR p540_02_xmda_pr
    
   #20141021 by stellar modify ----------------- (S)
#   LET l_sql = "SELECT  a.docno,     a.seq,a.xmdl005,a.xmdl006,a.xmdl008, ",
#               "       a.xmdl014,a.xmdl015,a.xmdl016,a.xmdl052 ",
#               "  FROM p540_01_tmp a,xmda_t b ",
#               " WHERE b.xmdaent = '",g_enterprise,"' ",
#               "   AND b.xmdasite = '",g_site,"' ",
#               "   AND a.docno = b.xmdadocno ",
#               "   AND a.source = '1' ",          #來源單據：訂單
#               "   AND b.xmda004 = ? ",
#               "   AND b.xmda009 = ? ",
#               "   AND b.xmda010 = ? ",
#               "   AND b.xmda011 = ? ",
#               "   AND b.xmda015 = ? ",
#               "   AND b.xmda016 = ? ",
#               "   AND b.xmda022 = ? ",
#               "   AND b.xmda021 = ? ",
#               "   AND b.xmda035 = ? ",
#               "   AND b.xmda005 = ? ",
#               " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 "  
   #依不同方式進行匯總
   CASE g_gather
      WHEN '1'   #依客戶匯總
           LET l_sql = "SELECT  a.docno,     a.seq,a.xmdl005,a.xmdl006,a.xmdl008, ",
                       "       a.xmdl014,a.xmdl015,a.xmdl016,a.xmdl052 ",
                       "  FROM p540_01_tmp a,xmda_t b ",
                       " WHERE b.xmdaent = '",g_enterprise,"' ",
                       "   AND b.xmdasite = '",g_site,"' ",
                       "   AND a.docno = b.xmdadocno ",
                       "   AND a.source = '1' ",          #來源單據：訂單
                       "   AND b.xmda004 = ? ",
                       "   AND b.xmda009 = ? ",
                       "   AND b.xmda010 = ? ",
                       "   AND b.xmda011 = ? ",
                       "   AND b.xmda015 = ? ",
                       "   AND b.xmda016 = ? ",
                       "   AND b.xmda022 = ? ",
                       "   AND b.xmda021 = ? ",
                       "   AND b.xmda035 = ? ",
                       "   AND b.xmda005 = ? ",
                       " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 "  
      WHEN '2'   #依來源單號匯總
           LET l_sql = "SELECT  a.docno,     a.seq,a.xmdl005,a.xmdl006,a.xmdl008, ",
                       "       a.xmdl014,a.xmdl015,a.xmdl016,a.xmdl052 ",
                       "  FROM p540_01_tmp a,xmda_t b ",
                       " WHERE b.xmdaent = '",g_enterprise,"' ",
                       "   AND b.xmdasite = '",g_site,"' ",
                       "   AND a.docno = b.xmdadocno ",
                       "   AND a.source = '1' ",          #來源單據：訂單
                       "   AND a.docno = ? ",
                       " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 "  
      WHEN '3'   #依來源單號+項次匯總
           LET l_sql = "SELECT  a.docno,     a.seq,a.xmdl005,a.xmdl006,a.xmdl008, ",
                       "       a.xmdl014,a.xmdl015,a.xmdl016,a.xmdl052 ",
                       "  FROM p540_01_tmp a,xmda_t b ",
                       " WHERE b.xmdaent = '",g_enterprise,"' ",
                       "   AND b.xmdasite = '",g_site,"' ",
                       "   AND a.docno = b.xmdadocno ",
                       "   AND a.source = '1' ",          #來源單據：訂單
                       "   AND a.docno = ? ",
                       "   AND a.seq = ? ",
                       " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 "  
   END CASE
   #20141021 by stellar modify ----------------- (E) 
                
   PREPARE p540_02_tmp_pr FROM l_sql
   DECLARE p540_02_tmp_cs CURSOR FOR p540_02_tmp_pr                
   
    
   FOREACH p540_02_xmda_cs INTO l_xmdk_d.xmdk007,l_xmdk_d.xmdk010,l_xmdk_d.xmdk011,l_xmdk_d.xmdk012,l_xmdk_d.xmdk016,
                                l_xmdk_d.xmdk017,l_xmdk_d.xmdk009,l_xmdk_d.xmdk008,l_xmdk_d.xmdk015,l_xmdk_d.xmdk002,
                                l_docno,l_seq   #20141021 by stellar add
      
      LET l_xmdk_d.linkno = l_linkno
      LET l_xmdk_d.source = '1'
      INSERT INTO p540_02_xmdk_temp VALUES (l_xmdk_d.*)
      LET i = 1   
      #將訂單單身寫入
      #20141021 by stellar modify ----------------- (S) 
#      FOREACH p540_02_tmp_cs USING l_xmdk_d.xmdk007,l_xmdk_d.xmdk010,l_xmdk_d.xmdk011,l_xmdk_d.xmdk012,l_xmdk_d.xmdk016,
#                                   l_xmdk_d.xmdk017,l_xmdk_d.xmdk009,l_xmdk_d.xmdk008,l_xmdk_d.xmdk015,l_xmdk_d.xmdk002
#                              INTO l_tmp_d.*
      #依不同方式進行匯總
      CASE g_gather
         WHEN '1'   #依客戶匯總
              OPEN p540_02_tmp_cs USING l_xmdk_d.xmdk007,l_xmdk_d.xmdk010,l_xmdk_d.xmdk011,l_xmdk_d.xmdk012,l_xmdk_d.xmdk016,
                                        l_xmdk_d.xmdk017,l_xmdk_d.xmdk009,l_xmdk_d.xmdk008,l_xmdk_d.xmdk015,l_xmdk_d.xmdk002
         WHEN '2'   #依來源單號匯總
              OPEN p540_02_tmp_cs USING l_docno
         WHEN '3'   #依來源單號+項次匯總
              OPEN p540_02_tmp_cs USING l_docno,l_seq
      END CASE
      INITIALIZE l_tmp_d.* TO NULL        
      FOREACH p540_02_tmp_cs INTO l_tmp_d.*
      #20141021 by stellar modify ----------------- (E) 
         INITIALIZE l_xmdl_d.* TO NULL
         SELECT xmdddocno,xmddseq,xmddseq1,xmddseq2,xmdd003,
                  xmdd001,xmdd002, xmdc003, xmdc004,xmdc005,
                  xmdd004,xmdd024, xmdd026, xmdc052,xmdc015,
                  xmdd019,xmdc036, xmdc037, xmdc038,xmdc027,
                  xmdd008, xmdc021, xmdc040,xmdc041,xmdc042,
                  xmdc043, xmdc044, xmdc049,xmdc050
           INTO l_xmdl_d.xmdl003,l_xmdl_d.xmdl004,l_xmdl_d.xmdl005,l_xmdl_d.xmdl006,l_xmdl_d.xmdl007,
                l_xmdl_d.xmdl008,l_xmdl_d.xmdl009,l_xmdl_d.xmdl010,l_xmdl_d.xmdl011,l_xmdl_d.xmdl012,
                l_xmdl_d.xmdl017,l_xmdl_d.xmdl019,l_xmdl_d.xmdl021,l_xmdl_d.xmdl023,l_xmdl_d.xmdl024,
                l_xmdl_d.xmdl025,l_xmdl_d.xmdl030,l_xmdl_d.xmdl031,l_xmdl_d.xmdl032,l_xmdl_d.xmdl033,
                l_xmdl_d.xmdl034,l_xmdl_d.xmdl041,l_xmdl_d.xmdl042,l_xmdl_d.xmdl043,l_xmdl_d.xmdl044,
                l_xmdl_d.xmdl045,l_xmdl_d.xmdl046,l_xmdl_d.xmdl050,l_xmdl_d.xmdl051
           FROM xmdc_t,xmdd_t
          WHERE xmdcent = g_enterprise
            AND xmdcsite = g_site
            AND xmdcent = xmddent
            AND xmdcsite = xmddsite
            AND xmdcdocno = xmdddocno
            AND xmdcseq = xmddseq
            AND xmdddocno = l_tmp_d.docno
            AND xmddseq = l_tmp_d.seq
            AND xmddseq1 = l_tmp_d.xmdl005
            AND xmddseq2 = l_tmp_d.xmdl006
            
         LET l_xmdl_d.linkno = l_xmdk_d.linkno 
         LET l_xmdl_d.source = l_xmdk_d.source          
         LET l_xmdl_d.xmdlseq = i                       #項次         
         LET l_xmdl_d.xmdl001 = ''                      #出通單單號                  
         LET l_xmdl_d.xmdl002 = ''                      #出通單項次                  
         LET l_xmdl_d.xmdl013 = 'N'                     #多庫儲批出貨 
         IF cl_null(l_tmp_d.xmdl014) THEN
            #抓取預設庫儲
            SELECT imaf091,imaf092 
              INTO l_xmdl_d.xmdl014,l_xmdl_d.xmdl015
              FROM imaf_t
             WHERE imafent = g_enterprise
               AND imafsite = g_site
               AND imaf001 = l_xmdl_d.xmdl008            
         ELSE         
            LET l_xmdl_d.xmdl014 = l_tmp_d.xmdl014         #庫位         
            LET l_xmdl_d.xmdl015 = l_tmp_d.xmdl015         #儲位         
            LET l_xmdl_d.xmdl016 = l_tmp_d.xmdl016         #批號    
         END IF
         LET l_xmdl_d.xmdl052 = l_tmp_d.xmdl052         #庫存管理特徵
         LET l_xmdl_d.xmdl018 = l_tmp_d.xmdl008         #出貨數量

         #推算參考數量             
         IF l_ref_unit = 'Y' THEN
            IF NOT cl_null(l_xmdl_d.xmdl019) THEN          
               CALL s_aooi250_convert_qty(l_xmdl_d.xmdl008,l_xmdl_d.xmdl017,l_xmdl_d.xmdl019,l_xmdl_d.xmdl018)
                 RETURNING l_success,l_xmdl_d.xmdl020
            END IF
         ELSE
            LET l_xmdl_d.xmdl019 = ''
            LET l_xmdl_d.xmdl020 = ''
         END IF
         
         #若料號有使用銷售計價單位時，自動推算計價數量
         IF NOT cl_null(l_xmdl_d.xmdl021) THEN          
            CALL s_aooi250_convert_qty(l_xmdl_d.xmdl008,l_xmdl_d.xmdl017,l_xmdl_d.xmdl021,l_xmdl_d.xmdl018)
              RETURNING l_success,l_xmdl_d.xmdl022
         END IF

         #稅率
         LET l_oodb006 = ''
         CALL s_tax_chk(g_site,l_xmdl_d.xmdl025)
           RETURNING l_success,l_oodbl004,l_oodb005,l_oodb006,l_oodb011
         IF l_success THEN
            LET l_xmdl_d.xmdl026 = l_oodb006
         END IF         

         #金額都預設給零，等真正單號產生時，在算金額
         LET l_xmdl_d.xmdl027 = 0    #未稅金額
         LET l_xmdl_d.xmdl028 = 0    #含稅金額
         LET l_xmdl_d.xmdl029 = 0    #稅額        
                       
         LET l_xmdl_d.xmdl035 = 0    #已簽收量
         LET l_xmdl_d.xmdl036 = 0    #已簽退量
         LET l_xmdl_d.xmdl037 = 0    #已銷退量 
         LET l_xmdl_d.xmdl038 = 0    #主帳套已立帳數量
         LET l_xmdl_d.xmdl039 = 0    #帳套二已立帳數量
         LET l_xmdl_d.xmdl040 = 0    #帳套三已立帳數量
         LET l_xmdl_d.xmdl087 = 'Y'  #需自立應收否          
         #帶出訂單多角流程代碼xmda050
         SELECT xmda050
           INTO l_xmdl_d.xmdl088
           FROM xmda_t
          WHERE xmdaent = g_enterprise
            AND xmdasite = g_site
            AND xmdadocno = l_xmdl_d.xmdl003 
            
         INSERT INTO p540_02_xmdl_temp VALUES (l_xmdl_d.*)   
 
         #2014/10/24 by stellar add -----------------------(S)
         #有指定庫儲批，先新增一筆多庫儲批明細
         IF NOT cl_null(l_xmdl_d.xmdl014) THEN
            CALL axmp540_03_xmdm_modify('1',l_xmdl_d.xmdlseq,g_site,l_xmdl_d.linkno,l_xmdl_d.xmdlseq,
                                        l_xmdl_d.xmdl008,l_xmdl_d.xmdl009,l_xmdl_d.xmdl011,l_xmdl_d.xmdl012,
                                        l_xmdl_d.xmdl014,l_xmdl_d.xmdl015,l_xmdl_d.xmdl016,l_xmdl_d.xmdl052,
                                        l_xmdl_d.xmdl017,l_xmdl_d.xmdl018,l_xmdl_d.xmdl019,l_xmdl_d.xmdl020,
                                        '','') RETURNING l_success
         END IF
         #2014/10/24 by stellar add -----------------------(E)

         LET i = i + 1
      END FOREACH                                  
      LET l_linkno = l_linkno + 1                                
   END FOREACH   
        
   CLOSE p540_02_xmda_cs
   FREE p540_02_xmda_pr
   CLOSE p540_02_tmp_cs
   FREE p540_02_tmp_pr 
    
    
   #抓取已選取單據來源為【出通單】的資料做匯總
   #依客戶、收款條件、交易條件、稅別、幣別、匯率、收貨客戶、收款客戶、發票類型、出通性質、包裝單製作、Invoice製作，條件做匯總        
   INITIALIZE l_xmdk_d.* TO NULL
   
   #20141021 by stellar modify ----------------- (S)
#   LET l_sql = "SELECT a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014, ",
#               "       a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001, ",
#               "       a.xmdg024,a.xmdg025 ",
#               "  FROM xmdg_t a,p540_01_tmp b ",
#               " WHERE a.xmdgent = '",g_enterprise,"' ",
#               "   AND a.xmdgsite = '",g_site,"' ",
#               "   AND a.xmdgdocno = b.docno ",
#               "   AND b.source = '2' ",                   #來源單據：出貨通知單                          
#               " GROUP BY a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014,a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001,a.xmdg024,a.xmdg025 ",
#               " ORDER BY a.xmdg005 "
   #依不同的匯總方式進行匯總
   CASE g_gather
      WHEN '1'   #依客戶匯總
           LET l_sql = "SELECT a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014, ",
                       "       a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001, ",
                       "       a.xmdg024,a.xmdg025,'','' ",
                       "  FROM xmdg_t a,p540_01_tmp b ",
                       " WHERE a.xmdgent = '",g_enterprise,"' ",
                       "   AND a.xmdgsite = '",g_site,"' ",
                       "   AND a.xmdgdocno = b.docno ",
                       "   AND b.source = '2' ",                   #來源單據：出貨通知單                          
                       " GROUP BY a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014,a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001,a.xmdg024,a.xmdg025 ",
                       " ORDER BY a.xmdg005 "
      WHEN '2'   #依來源單號匯總
           LET l_sql = "SELECT a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014, ",
                       "       a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001, ",
                       "       a.xmdg024,a.xmdg025,b.docno,'' ",
                       "  FROM xmdg_t a,p540_01_tmp b ",
                       " WHERE a.xmdgent = '",g_enterprise,"' ",
                       "   AND a.xmdgsite = '",g_site,"' ",
                       "   AND a.xmdgdocno = b.docno ",
                       "   AND b.source = '2' ",                   #來源單據：出貨通知單                          
                       " GROUP BY a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014,a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001,a.xmdg024,a.xmdg025,b.docno ",
                       " ORDER BY a.xmdg005 "
      WHEN '3'   #依來源單號+項次匯總
           LET l_sql = "SELECT a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014, ",
                       "       a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001, ",
                       "       a.xmdg024,a.xmdg025,b.docno,b.seq ",
                       "  FROM xmdg_t a,p540_01_tmp b ",
                       " WHERE a.xmdgent = '",g_enterprise,"' ",
                       "   AND a.xmdgsite = '",g_site,"' ",
                       "   AND a.xmdgdocno = b.docno ",
                       "   AND b.source = '2' ",                   #來源單據：出貨通知單                          
                       " GROUP BY a.xmdg005,a.xmdg008,a.xmdg009,a.xmdg010,a.xmdg014,a.xmdg015,a.xmdg007,a.xmdg006,a.xmdg013,a.xmdg001,a.xmdg024,a.xmdg025,b.docno,b.seq ",
                       " ORDER BY a.xmdg005 "
   END CASE
   #20141021 by stellar modify ----------------- (E)
               
   PREPARE p540_02_xmdg_pr FROM l_sql
   DECLARE p540_02_xmdg_cs CURSOR FOR p540_02_xmdg_pr
   
   #20141021 by stellar modify ----------------- (S)
#   LET l_sql = "SELECT a.docno,a.seq,a.xmdl005,a.xmdl006 ",
#               "  FROM p540_01_tmp a,xmdg_t b ",
#               " WHERE b.xmdgent = '",g_enterprise,"' ",
#               "   AND b.xmdgsite = '",g_site,"' ",
#               "   AND a.docno = b.xmdgdocno ",
#               "   AND a.source = '2' ",                #來源單據：出貨通知單
#               "   AND b.xmdg005 = ? ",
#               "   AND b.xmdg008 = ? ",
#               "   AND b.xmdg009 = ? ",
#               "   AND b.xmdg010 = ? ",
#               "   AND b.xmdg014 = ? ",
#               "   AND b.xmdg015 = ? ",
#               "   AND b.xmdg007 = ? ",
#               "   AND b.xmdg006 = ? ",
#               "   AND b.xmdg013 = ? ",
#               "   AND b.xmdg001 = ? ",
#               "   AND b.xmdg024 = ? ",
#               "   AND b.xmdg025 = ? ",
#               " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 "   
   #依不同的匯總方式進行匯總
   CASE g_gather
      WHEN '1'   #依客戶匯總
           LET l_sql = "SELECT a.docno,a.seq,a.xmdl005,a.xmdl006 ",
                       "  FROM p540_01_tmp a,xmdg_t b ",
                       " WHERE b.xmdgent = '",g_enterprise,"' ",
                       "   AND b.xmdgsite = '",g_site,"' ",
                       "   AND a.docno = b.xmdgdocno ",
                       "   AND a.source = '2' ",                #來源單據：出貨通知單
                       "   AND b.xmdg005 = ? ",
                       "   AND b.xmdg008 = ? ",
                       "   AND b.xmdg009 = ? ",
                       "   AND b.xmdg010 = ? ",
                       "   AND b.xmdg014 = ? ",
                       "   AND b.xmdg015 = ? ",
                       "   AND b.xmdg007 = ? ",
                       "   AND b.xmdg006 = ? ",
                       "   AND b.xmdg013 = ? ",
                       "   AND b.xmdg001 = ? ",
                       "   AND b.xmdg024 = ? ",
                       "   AND b.xmdg025 = ? ",
                       " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 " 
      WHEN '2'   #依來源單號匯總
           LET l_sql = "SELECT a.docno,a.seq,a.xmdl005,a.xmdl006 ",
                       "  FROM p540_01_tmp a,xmdg_t b ",
                       " WHERE b.xmdgent = '",g_enterprise,"' ",
                       "   AND b.xmdgsite = '",g_site,"' ",
                       "   AND a.docno = b.xmdgdocno ",
                       "   AND a.source = '2' ",                #來源單據：出貨通知單
                       "   AND a.docno = ? ",
                       " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 " 
      WHEN '3'   #依來源單號+項次匯總
           LET l_sql = "SELECT a.docno,a.seq,a.xmdl005,a.xmdl006 ",
                       "  FROM p540_01_tmp a,xmdg_t b ",
                       " WHERE b.xmdgent = '",g_enterprise,"' ",
                       "   AND b.xmdgsite = '",g_site,"' ",
                       "   AND a.docno = b.xmdgdocno ",
                       "   AND a.source = '2' ",                #來源單據：出貨通知單
                       "   AND a.docno = ? ",
                       "   AND a.seq = ? ",
                       " ORDER BY a.docno,a.seq,a.xmdl005,a.xmdl006 " 
   END CASE
   #20141021 by stellar modify ----------------- (E)
                
   PREPARE p540_02_tmp2_pr FROM l_sql
   DECLARE p540_02_tmp2_cs CURSOR FOR p540_02_tmp2_pr      
  
   LET l_linkno = ''
   SELECT MAX(linkno) INTO l_linkno
     FROM p540_02_xmdk_temp
   IF cl_null(l_linkno) THEN
      LET l_linkno = 1
   ELSE 
      LET l_linkno = l_linkno + 1   
   END IF 
   LET i = 1 
   FOREACH p540_02_xmdg_cs INTO l_xmdk_d.xmdk007,l_xmdk_d.xmdk010,l_xmdk_d.xmdk011,l_xmdk_d.xmdk012,l_xmdk_d.xmdk016,
                                l_xmdk_d.xmdk017,l_xmdk_d.xmdk009,l_xmdk_d.xmdk008,l_xmdk_d.xmdk015,l_xmdk_d.xmdk002,
                                l_xmdk_d.xmdk028,l_xmdk_d.xmdk029,l_docno,l_seq
      LET l_xmdk_d.linkno = l_linkno
      LET l_xmdk_d.source = '2'
      INSERT INTO p540_02_xmdk_temp VALUES (l_xmdk_d.*)
      #將出通單單身寫入
      #20141021 by stellar modify ----------------- (S)
#      FOREACH p540_02_tmp2_cs USING l_xmdk_d.xmdk007,l_xmdk_d.xmdk010,l_xmdk_d.xmdk011,l_xmdk_d.xmdk012,l_xmdk_d.xmdk016,
#                                    l_xmdk_d.xmdk017,l_xmdk_d.xmdk009,l_xmdk_d.xmdk008,l_xmdk_d.xmdk015,l_xmdk_d.xmdk002,
#                                    l_xmdk_d.xmdk028,l_xmdk_d.xmdk029
#                              INTO l_tmp_d.*
      #依不同的匯總方式進行匯總
      CASE g_gather
         WHEN '1'   #依客戶匯總
              OPEN p540_02_tmp2_cs USING l_xmdk_d.xmdk007,l_xmdk_d.xmdk010,l_xmdk_d.xmdk011,l_xmdk_d.xmdk012,l_xmdk_d.xmdk016,
                                         l_xmdk_d.xmdk017,l_xmdk_d.xmdk009,l_xmdk_d.xmdk008,l_xmdk_d.xmdk015,l_xmdk_d.xmdk002,
                                         l_xmdk_d.xmdk028,l_xmdk_d.xmdk029
         WHEN '2'   #依來源單號匯總
              OPEN p540_02_tmp2_cs USING l_docno
         WHEN '3'   #依來源單號+項次匯總
              OPEN p540_02_tmp2_cs USING l_docno,l_seq
      END CASE
   
      INITIALIZE l_tmp_d.* TO NULL      
      FOREACH p540_02_tmp2_cs INTO l_tmp_d.*
         INITIALIZE l_xmdl_d.* TO NULL
      #20141021 by stellar modify ----------------- (E)
         SELECT xmdhdocno,xmdhseq,xmdh001,xmdh002,xmdh003,
                  xmdh004,xmdh005,xmdh006,xmdh007,xmdh008,
                  xmdh009,xmdh010,xmdh011,xmdh012,xmdh013,
                  xmdh014,xmdh015,xmdh018,xmdh019,xmdh020,
                  xmdh021,xmdh022,xmdh023,xmdh025,xmdh026,
                  xmdh027,xmdh028,xmdh031,xmdh032,xmdh033,
                  xmdh034,xmdh035,xmdh036,xmdc040,xmdc041,
                  xmdc042,xmdc043,xmdc044,xmdc049,xmdh050                  
           INTO l_xmdl_d.xmdl001,l_xmdl_d.xmdl002,l_xmdl_d.xmdl003,l_xmdl_d.xmdl004,l_xmdl_d.xmdl005,
                l_xmdl_d.xmdl006,l_xmdl_d.xmdl007,l_xmdl_d.xmdl008,l_xmdl_d.xmdl009,l_xmdl_d.xmdl010,
                l_xmdl_d.xmdl011,l_xmdl_d.xmdl012,l_xmdl_d.xmdl013,l_xmdl_d.xmdl014,l_xmdl_d.xmdl015,
                l_xmdl_d.xmdl016,l_xmdl_d.xmdl017,l_xmdl_d.xmdl019,l_xmdl_d.xmdl020,l_xmdl_d.xmdl021,
                l_xmdl_d.xmdl022,l_xmdl_d.xmdl023,l_xmdl_d.xmdl024,l_xmdl_d.xmdl026,l_xmdl_d.xmdl027,
                l_xmdl_d.xmdl028,l_xmdl_d.xmdl029,l_xmdl_d.xmdl030,l_xmdl_d.xmdl031,l_xmdl_d.xmdl032,
                l_xmdl_d.xmdl033,l_xmdl_d.xmdl034,l_xmdl_d.xmdl041,l_xmdl_d.xmdl042,l_xmdl_d.xmdl043,
                l_xmdl_d.xmdl044,l_xmdl_d.xmdl045,l_xmdl_d.xmdl046,l_xmdl_d.xmdl050,l_xmdl_d.xmdl051 
                
           FROM xmdh_t,xmdc_t
          WHERE xmdhent = g_enterprise
            AND xmdhsite = g_site
            AND xmdhent = xmdcent
            AND xmdhsite = xmdcsite
            AND xmdh001 = xmdcdocno
            AND xmdh002 = xmdcseq
            AND xmdhdocno = l_tmp_d.docno
            AND xmdhseq = l_tmp_d.seq            
            
         LET l_xmdl_d.linkno = l_xmdk_d.linkno  
         LET l_xmdl_d.source = l_xmdk_d.source          
         LET l_xmdl_d.xmdlseq = i                            #項次 
         LET l_xmdl_d.xmdl018 = l_tmp_d.xmdl008              #出貨數量
         IF cl_null(l_xmdl_d.xmdl013) THEN LET l_xmdl_d.xmdl013 = 'N' END IF   
         IF cl_null(l_tmp_d.xmdl014) THEN
            #抓取預設庫儲
            SELECT imaf091,imaf092 
              INTO l_xmdl_d.xmdl014,l_xmdl_d.xmdl015
              FROM imaf_t
             WHERE imafent = g_enterprise
               AND imafsite = g_site
               AND imaf001 = l_xmdl_d.xmdl008            
         ELSE         
            LET l_xmdl_d.xmdl014 = l_tmp_d.xmdl014         #庫位         
            LET l_xmdl_d.xmdl015 = l_tmp_d.xmdl015         #儲位         
            LET l_xmdl_d.xmdl016 = l_tmp_d.xmdl016         #批號    
         END IF

         #推算參考數量                  
         IF NOT cl_null(l_xmdl_d.xmdl019) THEN          
            CALL s_aooi250_convert_qty(l_xmdl_d.xmdl008,l_xmdl_d.xmdl017,l_xmdl_d.xmdl019,l_xmdl_d.xmdl018)
              RETURNING l_success,l_xmdl_d.xmdl020
         END IF
         
         #若料號有使用銷售計價單位時，自動推算計價數量
         IF NOT cl_null(l_xmdl_d.xmdl021) THEN          
            CALL s_aooi250_convert_qty(l_xmdl_d.xmdl008,l_xmdl_d.xmdl017,l_xmdl_d.xmdl021,l_xmdl_d.xmdl018)
              RETURNING l_success,l_xmdl_d.xmdl022
         END IF
         #稅率
         LET l_oodb006 = ''
         CALL s_tax_chk(g_site,l_xmdl_d.xmdl025)
           RETURNING l_success,l_oodbl004,l_oodb005,l_oodb006,l_oodb011
         IF l_success THEN
            LET l_xmdl_d.xmdl026 = l_oodb006
         END IF           

         #金額都預設給零，等真正單號產生時，在算金額
         LET l_xmdl_d.xmdl027 = 0    #未稅金額
         LET l_xmdl_d.xmdl028 = 0    #含稅金額
         LET l_xmdl_d.xmdl029 = 0    #稅額
         
         LET l_xmdl_d.xmdl035 = 0    #已簽收量
         LET l_xmdl_d.xmdl036 = 0    #已簽退量
         LET l_xmdl_d.xmdl037 = 0    #已銷退量 
         LET l_xmdl_d.xmdl038 = 0    #主帳套已立帳數量
         LET l_xmdl_d.xmdl039 = 0    #帳套二已立帳數量
         LET l_xmdl_d.xmdl040 = 0    #帳套三已立帳數量
         LET l_xmdl_d.xmdl087 = 'Y'  #需自立應收否          

         #帶出訂單多角流程代碼xmda050
         SELECT xmda050
           INTO l_xmdl_d.xmdl088
           FROM xmda_t
          WHERE xmdaent = g_enterprise
            AND xmdasite = g_site
            AND xmdadocno = l_xmdl_d.xmdl003         

         INSERT INTO p540_02_xmdl_temp VALUES (l_xmdl_d.*)                                   
         LET i = i + 1

      END FOREACH                              
      LET l_linkno = l_linkno + 1
   END FOREACH   
   CLOSE p540_02_xmdg_cs
   FREE p540_02_xmdg_pr
   CLOSE p540_02_tmp2_cs
   FREE p540_02_tmp2_pr      
   
END FUNCTION]]>
  </point>
  <point name="dialog.axmp540_02_display02" order="2" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
DIALOG axmp540_02_display02()
   DISPLAY ARRAY g_xmdk2_d TO s_detail2_axmp540_02.* ATTRIBUTES(COUNT = g_detail2_02_cnt)
      BEFORE DISPLAY
         
   END DISPLAY
END DIALOG]]>
  </point>
  <point name="function.axmp540_02_create_temp_table" order="2" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PUBLIC FUNCTION axmp540_02_create_temp_table()
  DEFINE r_success         LIKE type_t.num5 
  
   WHENEVER ERROR CONTINUE

   LET r_success = TRUE  
      
   CREATE TEMP TABLE p540_02_xmdk_temp(
                   linkno         LIKE type_t.num10,        #暫時單號
                   source         LIKE type_t.chr10,        #來源單據1訂單2出通單
                   xmdk007        LIKE xmdk_t.xmdk007,      #客戶
                   xmdk010        LIKE xmdk_t.xmdk010,      #收款條件
                   xmdk011        LIKE xmdk_t.xmdk011,      #交易條件
                   xmdk012        LIKE xmdk_t.xmdk012,      #稅別
                   xmdk016        LIKE xmdk_t.xmdk016,      #幣別
                   xmdk017        LIKE xmdk_t.xmdk017,      #匯率
                   xmdk009        LIKE xmdk_t.xmdk009,      #收貨客戶
                   xmdk008        LIKE xmdk_t.xmdk008,      #收款客戶
                   xmdk015        LIKE xmdk_t.xmdk015,      #發票類型
                   xmdk002        LIKE xmdk_t.xmdk002,      #訂單/出通單性質
                   xmdk028        LIKE xmdk_t.xmdk028,      #包裝單製作
                   xmdk029        LIKE xmdk_t.xmdk029,      #Invoice製作
                   xmdkdocno      LIKE xmdk_t.xmdkdocno,    #出貨單號
                   result         LIKE type_t.chr500        #執行結果
                   )  
                   
   IF SQLCA.sqlcode != 0 THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'create p540_02_xmdk_temp'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF                   
 
   CREATE TEMP TABLE p540_02_xmdl_temp( 
                   linkno    LIKE type_t.num5, 
                   source    LIKE type_t.chr10,                 
                   xmdldocno LIKE xmdl_t.xmdldocno,                   
                   xmdlseq LIKE xmdl_t.xmdlseq,
                   xmdl001 LIKE xmdl_t.xmdl001,
                   xmdl002 LIKE xmdl_t.xmdl002,
                   xmdl003 LIKE xmdl_t.xmdl003,
                   xmdl004 LIKE xmdl_t.xmdl004,
                   xmdl005 LIKE xmdl_t.xmdl005,
                   xmdl006 LIKE xmdl_t.xmdl006,
                   xmdl007 LIKE xmdl_t.xmdl007,
                   xmdl008 LIKE xmdl_t.xmdl008,
                   xmdl009 LIKE xmdl_t.xmdl009,
                   xmdl010 LIKE xmdl_t.xmdl010,
                   xmdl011 LIKE xmdl_t.xmdl011,
                   xmdl012 LIKE xmdl_t.xmdl012,
                   xmdl013 LIKE xmdl_t.xmdl013,
                   xmdl014 LIKE xmdl_t.xmdl014,
                   xmdl015 LIKE xmdl_t.xmdl015,
                   xmdl016 LIKE xmdl_t.xmdl016,
                   xmdl017 LIKE xmdl_t.xmdl017,
                   xmdl018 LIKE xmdl_t.xmdl018,
                   xmdl019 LIKE xmdl_t.xmdl019,
                   xmdl020 LIKE xmdl_t.xmdl020,
                   xmdl021 LIKE xmdl_t.xmdl021,
                   xmdl022 LIKE xmdl_t.xmdl022,
                   xmdl023 LIKE xmdl_t.xmdl023,
                   xmdl024 LIKE xmdl_t.xmdl024,
                   xmdl025 LIKE xmdl_t.xmdl025,
                   xmdl026 LIKE xmdl_t.xmdl026,
                   xmdl027 LIKE xmdl_t.xmdl027,
                   xmdl028 LIKE xmdl_t.xmdl028,
                   xmdl029 LIKE xmdl_t.xmdl029,
                   xmdl030 LIKE xmdl_t.xmdl030,
                   xmdl031 LIKE xmdl_t.xmdl031,
                   xmdl032 LIKE xmdl_t.xmdl032,
                   xmdl033 LIKE xmdl_t.xmdl033,
                   xmdl034 LIKE xmdl_t.xmdl034, 
                   xmdl035 LIKE xmdl_t.xmdl035,
                   xmdl036 LIKE xmdl_t.xmdl036,
                   xmdl037 LIKE xmdl_t.xmdl037,
                   xmdl038 LIKE xmdl_t.xmdl038,
                   xmdl039 LIKE xmdl_t.xmdl039,
                   xmdl040 LIKE xmdl_t.xmdl040,
                   xmdl041 LIKE xmdl_t.xmdl041,
                   xmdl042 LIKE xmdl_t.xmdl042,
                   xmdl043 LIKE xmdl_t.xmdl043,
                   xmdl044 LIKE xmdl_t.xmdl044,
                   xmdl045 LIKE xmdl_t.xmdl045,
                   xmdl046 LIKE xmdl_t.xmdl046,
                   xmdl047 LIKE xmdl_t.xmdl047,
                   xmdl048 LIKE xmdl_t.xmdl048,
                   xmdl049 LIKE xmdl_t.xmdl049,
                   xmdl050 LIKE xmdl_t.xmdl050,
                   xmdl051 LIKE xmdl_t.xmdl051,
                   xmdl052 LIKE xmdl_t.xmdl052,
                   xmdl087 LIKE xmdl_t.xmdl087,
                   xmdl088 LIKE xmdl_t.xmdl088 
                   ) 
                   
    IF SQLCA.sqlcode != 0 THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'create p540_02_xmdl_temp'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF       

   CREATE TEMP TABLE p540_02_xmdm_temp(
      linkno         LIKE type_t.num5,
      xmdmseq        LIKE xmdm_t.xmdmseq,
      xmdmseq1       LIKE xmdm_t.xmdmseq1,
      xmdm001        LIKE xmdm_t.xmdm001,
      xmdm002        LIKE xmdm_t.xmdm002,
      xmdm003        LIKE xmdm_t.xmdm003,
      xmdm004        LIKE xmdm_t.xmdm004,
      xmdm005        LIKE xmdm_t.xmdm005,
      xmdm006        LIKE xmdm_t.xmdm006,
      xmdm007        LIKE xmdm_t.xmdm007,
      xmdm008        LIKE xmdm_t.xmdm008,
      xmdm009        LIKE xmdm_t.xmdm009,
      xmdm010        LIKE xmdm_t.xmdm010,
      xmdm011        LIKE xmdm_t.xmdm011,
      xmdm012        LIKE xmdm_t.xmdm012,
      xmdm013        LIKE xmdm_t.xmdm013,
      xmdm014        LIKE xmdm_t.xmdm014,
      xmdm031        LIKE xmdm_t.xmdm031,
      xmdm032        LIKE xmdm_t.xmdm032,
      xmdm033        LIKE xmdm_t.xmdm033
      )    
    IF SQLCA.sqlcode != 0 THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'create p540_02_xmdm_temp'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF   
   
   RETURN r_success                

END FUNCTION]]>
  </point>
  <point name="dialog.axmp540_02_display03" order="3" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
DIALOG axmp540_02_display03()
  DISPLAY ARRAY g_xmdk3_d TO s_detail3_axmp540_02.* ATTRIBUTES(COUNT = g_detail3_02_cnt)
     BEFORE DISPLAY
        
  END DISPLAY
END DIALOG]]>
  </point>
  <point name="function.axmp540_02_drop_temp_table" order="3" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PUBLIC FUNCTION axmp540_02_drop_temp_table()
   DEFINE r_success          LIKE type_t.num5

   WHENEVER ERROR CONTINUE

   LET r_success = TRUE
    
   DROP TABLE p540_02_xmdk_temp;
   IF NOT (SQLCA.sqlcode = 0 OR SQLCA.sqlcode = -206) THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'drop p540_02_xmdk_temp'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF
   
   DROP TABLE p540_02_xmdl_temp;
   IF NOT (SQLCA.sqlcode = 0 OR SQLCA.sqlcode = -206) THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'drop p540_02_xmdl_temp'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF  
   
   DROP TABLE p540_02_xmdm_temp;
   IF NOT (SQLCA.sqlcode = 0 OR SQLCA.sqlcode = -206) THEN
      INITIALIZE g_errparam TO NULL
      LET g_errparam.code = SQLCA.sqlcode
      LET g_errparam.extend = 'drop p540_02_xmdm_temp'
      LET g_errparam.popup = TRUE
      CALL cl_err()

      LET r_success = FALSE
      RETURN r_success
   END IF 
   RETURN r_success   
END FUNCTION]]>
  </point>
  <point name="dialog.axmp540_02_display04" order="4" ver="1" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
DIALOG axmp540_02_display04()
  DISPLAY ARRAY g_xmdk4_d TO s_detail4_axmp540_02.* ATTRIBUTES(COUNT = g_detail4_02_cnt)
     BEFORE DISPLAY
        
  END DISPLAY
END DIALOG]]>
  </point>
  <point name="function.axmp540_02_b_fill" order="4" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PUBLIC FUNCTION axmp540_02_b_fill()
   DEFINE l_sql          STRING
   DEFINE l_ac_t         LIKE type_t.num5
   DEFINE i              LIKE type_t.num5
   
    LET l_sql = "SELECT source,xmdk002,xmdk007,xmdk010,xmdk011, ",
                "       xmdk012,xmdk016,xmdk017,xmdk008,xmdk009, ",
                "       xmdk015,result,xmdkdocno,linkno ",
                "  FROM p540_02_xmdk_temp ",
                " ORDER BY source,xmdk002,xmdk007 "
                
    PREPARE axmp540_sel_xmdk_pr FROM l_sql
    DECLARE axmp540_sel_xmdk_cs CURSOR FOR axmp540_sel_xmdk_pr
    
    LET g_detail_02_idx = 1
    LET l_ac_t = l_ac
    LET l_ac = 1
   
    CALL g_xmdk_d.clear()
    FOREACH axmp540_sel_xmdk_cs INTO g_xmdk_d[l_ac].source,g_xmdk_d[l_ac].xmdk002,g_xmdk_d[l_ac].xmdk007,g_xmdk_d[l_ac].xmdk010,g_xmdk_d[l_ac].xmdk011,
                                     g_xmdk_d[l_ac].xmdk012,g_xmdk_d[l_ac].xmdk016,g_xmdk_d[l_ac].xmdk017,g_xmdk_d[l_ac].xmdk008,g_xmdk_d[l_ac].xmdk009,
                                     g_xmdk_d[l_ac].xmdk015,g_xmdk_d[l_ac].result,g_xmdk_d[l_ac].docno,g_xmdk_d[l_ac].linkno
                                     
        CALL axmp540_02_detail_show("'1'")  
        
        LET l_ac = l_ac + 1
    END FOREACH   
    CALL g_xmdk_d.deleteElement(l_ac)
    LET l_ac = l_ac_t
    LET g_detail_02_cnt = l_ac - 1
    CLOSE axmp540_sel_xmdk_cs
    FREE axmp540_sel_xmdk_pr  

    IF l_ac > 0 THEN
       LET g_detail_02_idx = l_ac
    END IF
END FUNCTION]]>
  </point>
  <point name="dialog.axmp540_02_input" order="5" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
DIALOG axmp540_02_input()
   DEFINE l_success   LIKE type_t.num5
   DEFINE l_rollback  LIKE type_t.num5
   DEFINE l_xmdl014   LIKE xmdl_t.xmdl014
   DEFINE l_xmdl015   LIKE xmdl_t.xmdl015
   DEFINE l_xmdl016   LIKE xmdl_t.xmdl016
   DEFINE l_xmdl052   LIKE xmdl_t.xmdl052
   DEFINE l_docno     LIKE xmdl_t.xmdldocno
   DEFINE l_seq       LIKE xmdl_t.xmdlseq
   

   INPUT ARRAY g_xmdk2_d FROM s_detail2_axmp540_02.*
         ATTRIBUTE(COUNT = g_detail2_02_cnt,MAXCOUNT = g_max_rec,WITHOUT DEFAULTS,
                   INSERT ROW = FALSE,
                   DELETE ROW = FALSE,
                   APPEND ROW = FALSE)
         BEFORE INPUT

         BEFORE ROW
           LET l_ac = ARR_CURR()
           LET g_xmdk2_d_t.* = g_xmdk2_d[l_ac].*
           LET g_xmdk2_d_o.* = g_xmdk2_d[l_ac].*
           IF g_xmdk2_d[l_ac].source_02  = '1' THEN     #訂單
              LET l_docno = ''
              LET l_seq = ''
           ELSE
              LET l_docno = g_xmdk2_d[l_ac].xmdl001_02
              LET l_seq = g_xmdk2_d[l_ac].xmdl002_02
           END IF
           CALL axmp540_02_set_entry_b()
           CALL axmp540_02_set_no_entry_b()

         AFTER FIELD xmdl018_02
           IF NOT cl_ap_chk_Range(g_xmdk2_d[l_ac].xmdl018_02,"0","0","","","azz-00079",1) THEN
              NEXT FIELD xmdl018_02
           END IF         
           IF g_xmdk2_d[l_ac].xmdl018_02 != g_xmdk2_d_t.xmdl018_02 OR g_xmdk2_d_t.xmdl018_02 IS NULL THEN
              IF NOT axmp540_02_xmdl018_chk() THEN
                 LET g_xmdk2_d[l_ac].xmdl018_02 = g_xmdk2_d_t.xmdl018_02
                 DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl018_02
                 NEXT FIELD CURRENT
              END IF
              #對出貨數量進行取位
              CALL s_aooi250_take_decimals(g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02)
                RETURNING l_success,g_xmdk2_d[l_ac].xmdl018_02  
              #若料號有設置使用參考單位時且出貨單位與參考單位有設置換算率時，則應自動推算參考數量
              IF NOT cl_null(g_xmdk2_d[l_ac].xmdl019_02) THEN
                 CALL s_aooi250_convert_qty(g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl019_02,g_xmdk2_d[l_ac].xmdl018_02)
                   RETURNING l_success,g_xmdk2_d[l_ac].xmdl020_02
                 #對參考數量進行取位
                 CALL s_aooi250_take_decimals(g_xmdk2_d[l_ac].xmdl019_02,g_xmdk2_d[l_ac].xmdl020_02)
                   RETURNING l_success,g_xmdk2_d[l_ac].xmdl020_02                 
              END IF
              #若料號有使用銷售計價單位時，則輸入[C:出貨數量]時則應自動推算計價數量
              IF NOT cl_null(g_xmdk2_d[l_ac].xmdl021_02) THEN
                 CALL s_aooi250_convert_qty(g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl021_02,g_xmdk2_d[l_ac].xmdl018_02)
                   RETURNING l_success,g_xmdk2_d[l_ac].xmdl022_02
                 #對計價數量進行取位
                 CALL s_aooi250_take_decimals(g_xmdk2_d[l_ac].xmdl021_02,g_xmdk2_d[l_ac].xmdl022_02)
                   RETURNING l_success,g_xmdk2_d[l_ac].xmdl022_02                                      
                 #重新計算[C:未稅金額]、[C:含稅金額]、[稅額] 
                 CALL axmp540_02_get_amount(g_xmdk2_d[l_ac].linkno_02,g_xmdk2_d[l_ac].xmdl022_02,g_xmdk4_d[l_ac].xmdl024_04,g_xmdk4_d[l_ac].xmdl025_04)
                   RETURNING g_xmdk4_d[l_ac].xmdl027_04,g_xmdk4_d[l_ac].xmdl028_04,g_xmdk4_d[l_ac].xmdl029_04
              END IF  
             
           END IF
           LET g_xmdk2_d_t.xmdl018_02 = g_xmdk2_d[l_ac].xmdl018_02
          
        AFTER FIELD xmdl020_02
           IF NOT cl_ap_chk_Range(g_xmdk2_d[l_ac].xmdl020_02,"0.000","0","","","azz-00079",1) THEN
              NEXT FIELD xmdl020_02
           END IF
           #對參考數量進行取位
           CALL s_aooi250_take_decimals(g_xmdk2_d[l_ac].xmdl019_02,g_xmdk2_d[l_ac].xmdl020_02)
             RETURNING l_success,g_xmdk2_d[l_ac].xmdl020_02 

        AFTER FIELD xmdl022_02
           IF NOT cl_ap_chk_Range(g_xmdk2_d[l_ac].xmdl022_02,"0.000","0","","","azz-00079",1) THEN
              NEXT FIELD xmdl020_02
           END IF
           IF g_xmdk2_d[l_ac].xmdl022_02 != g_xmdk2_d_t.xmdl022_02 OR g_xmdk2_d_t.xmdl022_02 IS NULL THEN
              #對計價數量進行取位
              CALL s_aooi250_take_decimals(g_xmdk2_d[l_ac].xmdl021_02,g_xmdk2_d[l_ac].xmdl022_02)
                RETURNING l_success,g_xmdk2_d[l_ac].xmdl022_02 
              #重新計算[C:未稅金額]、[C:含稅金額]、[稅額] 
              CALL axmp540_02_get_amount(g_xmdk2_d[l_ac].linkno_02,g_xmdk2_d[l_ac].xmdl022_02,g_xmdk4_d[l_ac].xmdl024_04,g_xmdk4_d[l_ac].xmdl025_04)                
                RETURNING g_xmdk4_d[l_ac].xmdl027_04,g_xmdk4_d[l_ac].xmdl028_04,g_xmdk4_d[l_ac].xmdl029_04
           END IF
           
        ON CHANGE xmdl013_02
           IF g_xmdk2_d[l_ac].xmdl013_02 = 'Y' THEN
              CALL axmp540_03('1',g_site,'',g_xmdk2_d[l_ac].linkno_02,g_xmdk_m.xmdkdocno,
                              g_xmdk2_d[l_ac].xmdlseq_02,g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02,
                              g_xmdk2_d[l_ac].xmdl011_02,g_xmdk2_d[l_ac].xmdl012_02,
                              g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02,'',
                              g_xmdk2_d[l_ac].xmdl019_02,g_xmdk2_d[l_ac].xmdl020_02,'',
                              g_xmdk2_d[l_ac].xmdl001_02,g_xmdk2_d[l_ac].xmdl002_02,
                              g_xmdk2_d[l_ac].xmdl003_02,g_xmdk2_d[l_ac].xmdl004_02)
                   RETURNING l_success,l_rollback,l_xmdl014,l_xmdl015,l_xmdl016,l_xmdl052
              IF l_rollback THEN   #多庫儲批資料錯誤必須rollback
                 EXIT DIALOG
              END IF
              
              IF l_success THEN
                 IF NOT cl_null(l_xmdl014) THEN
                    LET g_xmdk2_d[l_ac].xmdl013_02 = 'N'
                    LET g_xmdk2_d[l_ac].xmdl014_02 = l_xmdl014
                    LET g_xmdk2_d[l_ac].xmdl015_02 = l_xmdl015
                    LET g_xmdk2_d[l_ac].xmdl016_02 = l_xmdl016
                    LET g_xmdk2_d[l_ac].xmdl052_02 = l_xmdl052
                 ELSE
                    LET g_xmdk2_d[l_ac].xmdl013_02 = 'Y'
                    LET g_xmdk2_d[l_ac].xmdl014_02 = ' '
                    LET g_xmdk2_d[l_ac].xmdl015_02 = ' '
                    LET g_xmdk2_d[l_ac].xmdl016_02 = ' '
                    LET g_xmdk2_d[l_ac].xmdl052_02 = ' '
                 END IF
                 
                 CALL s_desc_get_stock_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02) 
                      RETURNING g_xmdk2_d[l_ac].xmdl014_02_desc
                 CALL s_desc_get_locator_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02)
                      RETURNING g_xmdk2_d[l_ac].xmdl015_02_desc

               ELSE
                  LET g_xmdk2_d[l_ac].xmdl013_02 = g_xmdk2_d_o.xmdl013_02

                  NEXT FIELD CURRENT
               END IF

            ELSE
               #檢查是否可多庫儲批若為"N"刪除舊值
               IF NOT axmp540_03_xmdm_delete('1',g_xmdk2_d[l_ac].linkno_02,g_xmdk2_d[l_ac].xmdlseq_02,'Y') THEN
                  LET g_xmdk2_d[l_ac].xmdl013_02 = g_xmdk2_d_o.xmdl013_02
                  NEXT FIELD CURRENT
               END IF

            END IF
            CALL axmp540_02_fetch_xmdm()
            LET g_xmdk2_d_o.xmdl013_02 = g_xmdk2_d[l_ac].xmdl013_02
            CALL axmp540_02_set_entry_b()
            CALL axmp540_02_set_no_entry_b()

        AFTER FIELD xmdl014_02
           CALL s_desc_get_stock_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02) RETURNING g_xmdk2_d[l_ac].xmdl014_02_desc
           IF NOT cl_null(g_xmdk2_d[l_ac].xmdl014_02) THEN
              IF g_xmdk2_d[l_ac].xmdl014_02 != g_xmdk2_d_t.xmdl014_02 OR g_xmdk2_d_t.xmdl014_02 IS NULL THEN
                 #庫位check
                 IF NOT s_axmt540_xmdl014_chk(g_xmdk2_d[l_ac].xmdl013_02,l_docno,l_seq,g_xmdk2_d[l_ac].xmdl014_02) THEN
                    LET g_xmdk2_d[l_ac].xmdl014_02 = g_xmdk2_d_t.xmdl014_02
                    CALL s_desc_get_stock_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02) RETURNING g_xmdk2_d[l_ac].xmdl014_02_desc
                    NEXT FIELD CURRENT
                 END IF
                 #在揀量check
                 IF NOT axmp540_01_inan_chk(g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02,g_xmdk2_d[l_ac].xmdl014_02,
                                            g_xmdk2_d[l_ac].xmdl015_02,g_xmdk2_d[l_ac].xmdl016_02,g_xmdk2_d[l_ac].xmdl052_02,
                                            g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02) THEN
                    LET g_xmdk2_d[l_ac].xmdl014_02 = g_xmdk2_d_t.xmdl014_02
                    CALL s_desc_get_stock_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02) RETURNING g_xmdk2_d[l_ac].xmdl014_02_desc
                    NEXT FIELD CURRENT
                 END IF                 
              END IF
           END IF
           LET g_xmdk2_d_t.xmdl014_02 = g_xmdk2_d[l_ac].xmdl014_02
        
        AFTER FIELD xmdl015_02
           CALL s_desc_get_locator_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02) 
             RETURNING g_xmdk2_d[l_ac].xmdl015_02_desc
           IF NOT cl_null(g_xmdk2_d[l_ac].xmdl015_02) THEN
              IF g_xmdk2_d[l_ac].xmdl015_02 != g_xmdk2_d_t.xmdl015_02 OR g_xmdk2_d_t.xmdl015_02 IS NULL THEN
                 #儲位檢查
                 IF NOT s_axmt540_xmdl015_chk(g_xmdk2_d[l_ac].xmdl013_02,l_docno,l_seq,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02) THEN
                    LET g_xmdk2_d[l_ac].xmdl015_02 = g_xmdk2_d_t.xmdl015_02
                    CALL s_desc_get_locator_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02) 
                      RETURNING g_xmdk2_d[l_ac].xmdl015_02_desc
                    NEXT FIELD CURRENT
                 END IF
                 #在揀量檢查
                 IF NOT axmp540_01_inan_chk(g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02,g_xmdk2_d[l_ac].xmdl014_02,
                                            g_xmdk2_d[l_ac].xmdl015_02,g_xmdk2_d[l_ac].xmdl016_02,g_xmdk2_d[l_ac].xmdl052_02,
                                            g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02) THEN
                    LET g_xmdk2_d[l_ac].xmdl015_02 = g_xmdk2_d_t.xmdl015_02
                    CALL s_desc_get_locator_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02) 
                      RETURNING g_xmdk2_d[l_ac].xmdl015_02_desc
                    NEXT FIELD CURRENT
                 END IF                  
              END IF
           END IF            
           LET g_xmdk2_d_t.xmdl015_02 = g_xmdk2_d[l_ac].xmdl015_02
        
        AFTER FIELD xmdl016_02
           IF NOT cl_null(g_xmdk2_d[l_ac].xmdl016_02) THEN
              #批號檢查
              IF g_xmdk2_d[l_ac].xmdl016_02 != g_xmdk2_d_t.xmdl016_02 OR g_xmdk2_d_t.xmdl016_02 IS NULL THEN 
                 IF NOT s_axmt540_xmdl016_chk(g_xmdk2_d[l_ac].xmdl013_02,l_docno,l_seq,g_xmdk2_d[l_ac].xmdl014_02,
                                              g_xmdk2_d[l_ac].xmdl015_02,g_xmdk2_d[l_ac].xmdl016_02) THEN                                                
                    LET g_xmdk2_d[l_ac].xmdl016_02 = g_xmdk2_d_t.xmdl016_02
                    NEXT FIELD CURRENT                                              
                 END IF
                 #在揀量檢查
                 IF NOT axmp540_01_inan_chk(g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02,g_xmdk2_d[l_ac].xmdl014_02,
                                            g_xmdk2_d[l_ac].xmdl015_02,g_xmdk2_d[l_ac].xmdl016_02,g_xmdk2_d[l_ac].xmdl052_02,
                                            g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02) THEN
                    LET g_xmdk2_d[l_ac].xmdl016_02 = g_xmdk2_d_t.xmdl016_02
                    NEXT FIELD CURRENT  
                 END IF                 
              END IF
           END IF
           LET g_xmdk2_d_t.xmdl016_02 = g_xmdk2_d[l_ac].xmdl016_02
           
        AFTER FIELD xmdl052_02
           IF NOT cl_null(g_xmdk2_d[l_ac].xmdl052_02) THEN
              IF g_xmdk2_d[l_ac].xmdl052_02 != g_xmdk2_d_t.xmdl052_02 OR g_xmdk2_d_t.xmdl052_02 IS NULL THEN 
                 IF NOT s_axmt540_xmdl052_chk(g_xmdk2_d[l_ac].xmdl013_02,l_docno,l_seq,g_xmdk2_d[l_ac].xmdl052_02) THEN                                                
                    LET g_xmdk2_d[l_ac].xmdl052_02 = g_xmdk2_d_t.xmdl052_02
                    NEXT FIELD CURRENT                                              
                 END IF
                 #在揀量檢查
                 IF NOT axmp540_01_inan_chk(g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02,g_xmdk2_d[l_ac].xmdl014_02,
                                            g_xmdk2_d[l_ac].xmdl015_02,g_xmdk2_d[l_ac].xmdl016_02,g_xmdk2_d[l_ac].xmdl052_02,
                                            g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02) THEN
                    LET g_xmdk2_d[l_ac].xmdl052_02 = g_xmdk2_d_t.xmdl052_02
                    NEXT FIELD CURRENT
                 END IF                 
              END IF
           END IF
           LET g_xmdk2_d_t.xmdl052_02 = g_xmdk2_d[l_ac].xmdl052_02  

        
        
        ON ROW CHANGE
           IF INT_FLAG THEN
              INITIALIZE g_errparam TO NULL
              LET g_errparam.code = 9001
              LET g_errparam.extend = ''
              LET g_errparam.popup = FALSE
              CALL cl_err()
              LET INT_FLAG = 0
              LET g_xmdk2_d[l_ac].* = g_xmdk2_d_t.*
              EXIT DIALOG
           ELSE
              UPDATE  p540_02_xmdl_temp
                 SET  xmdl018 = g_xmdk2_d[l_ac].xmdl018_02,
                      xmdl020 = g_xmdk2_d[l_ac].xmdl020_02,
                      xmdl022 = g_xmdk2_d[l_ac].xmdl022_02,
                      xmdl013 = g_xmdk2_d[l_ac].xmdl013_02,
                      xmdl014 = g_xmdk2_d[l_ac].xmdl014_02,
                      xmdl015 = g_xmdk2_d[l_ac].xmdl015_02,
                      xmdl016 = g_xmdk2_d[l_ac].xmdl016_02 
               WHERE  linkno =  g_xmdk2_d[l_ac].linkno_02
                 AND  xmdlseq = g_xmdk2_d[l_ac].xmdlseq_02                  


              #2014/10/24 by stellar add ----------------------(S)
              CALL axmp540_03_xmdm_modify('1',g_xmdk2_d[l_ac].xmdlseq_02,g_site,g_xmdk2_d[l_ac].linkno_02,g_xmdk2_d[l_ac].xmdlseq_02,
                                          g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02,g_xmdk2_d[l_ac].xmdl011_02,g_xmdk2_d[l_ac].xmdl012_02,
                                          g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02,g_xmdk2_d[l_ac].xmdl016_02,g_xmdk2_d[l_ac].xmdl052_02,
                                          g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02,g_xmdk2_d[l_ac].xmdl019_02,g_xmdk2_d[l_ac].xmdl020_02,
                                          '','') RETURNING l_success
              CALL axmp540_02_fetch_xmdm()
              #2014/10/24 by stellar add ----------------------(E)
                                          
           END IF

        ON ACTION controlp INFIELD xmdl014_02
           INITIALIZE g_qryparam.* TO NULL
           LET g_qryparam.state = 'i'
           LET g_qryparam.reqry = FALSE  
           LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl014_02             #給予default值
           LET g_qryparam.default2 = g_xmdk2_d[l_ac].xmdl015_02
           LET g_qryparam.default3 = g_xmdk2_d[l_ac].xmdl016_02
           LET g_qryparam.default4 = g_xmdk2_d[l_ac].xmdl052_02                
           IF NOT cl_null(g_xmdk2_d[l_ac].xmdl001_02) AND NOT cl_null(g_xmdk2_d[l_ac].xmdl002_02) THEN
              IF g_xmdk2_d[l_ac].xmdl013_02 = 'Y' THEN
                 LET g_qryparam.arg1 = g_xmdk2_d[l_ac].xmdl001_02                   #出通單單號
                 LET g_qryparam.arg2 = g_xmdk2_d[l_ac].xmdl002_02                   #出通單項次 
                 CALL q_xmdi005()                                                   #呼叫開窗              
              END IF
           ELSE
              LET g_qryparam.arg1 = g_xmdk2_d[l_ac].xmdl008_02                      #料件
              LET g_qryparam.arg2 = g_xmdk2_d[l_ac].xmdl009_02                      #產品特徵
              CALL q_inag004_13()               
           END IF
           LET g_xmdk2_d[l_ac].xmdl014_02 = g_qryparam.return1                      #將開窗取得的值回傳到變數
           LET g_xmdk2_d[l_ac].xmdl015_02 = g_qryparam.return2
           LET g_xmdk2_d[l_ac].xmdl016_02 = g_qryparam.return3
           LET g_xmdk2_d[l_ac].xmdl052_02 = g_qryparam.return4                 
           DISPLAY g_xmdk2_d[l_ac].xmdl014_02 TO xmdl014_02                         #顯示到畫面上
           DISPLAY g_xmdk2_d[l_ac].xmdl015_02 TO xmdl015_02
           DISPLAY g_xmdk2_d[l_ac].xmdl016_02 TO xmdl016_02
           DISPLAY g_xmdk2_d[l_ac].xmdl052_02 TO xmdl052_02           
           CALL s_desc_get_stock_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02) RETURNING g_xmdk2_d[l_ac].xmdl014_02_desc
           CALL s_desc_get_locator_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02) RETURNING g_xmdk2_d[l_ac].xmdl015_02_desc
           NEXT FIELD xmdl014_02 

        ON ACTION controlp INFIELD xmdl015_02
           INITIALIZE g_qryparam.* TO NULL
           LET g_qryparam.state = 'i'
           LET g_qryparam.reqry = FALSE  
           LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl014_02             #給予default值
           LET g_qryparam.default2 = g_xmdk2_d[l_ac].xmdl015_02
           LET g_qryparam.default3 = g_xmdk2_d[l_ac].xmdl016_02
           LET g_qryparam.default4 = g_xmdk2_d[l_ac].xmdl052_02                
           IF NOT cl_null(g_xmdk2_d[l_ac].xmdl001_02) AND NOT cl_null(g_xmdk2_d[l_ac].xmdl002_02) THEN
              IF g_xmdk2_d[l_ac].xmdl013_02 = 'Y' THEN
                 LET g_qryparam.arg1 = g_xmdk2_d[l_ac].xmdl001_02                   #出通單單號
                 LET g_qryparam.arg2 = g_xmdk2_d[l_ac].xmdl002_02                   #出通單項次 
                 CALL q_xmdi005()                                                   #呼叫開窗              
              END IF
           ELSE
              LET g_qryparam.arg1 = g_xmdk2_d[l_ac].xmdl008_02                      #料件
              LET g_qryparam.arg2 = g_xmdk2_d[l_ac].xmdl009_02                      #產品特徵
              CALL q_inag004_13()               
           END IF
           LET g_xmdk2_d[l_ac].xmdl014_02 = g_qryparam.return1                      #將開窗取得的值回傳到變數
           LET g_xmdk2_d[l_ac].xmdl015_02 = g_qryparam.return2
           LET g_xmdk2_d[l_ac].xmdl016_02 = g_qryparam.return3
           LET g_xmdk2_d[l_ac].xmdl052_02 = g_qryparam.return4                 
           DISPLAY g_xmdk2_d[l_ac].xmdl014_02 TO xmdl014_02                         #顯示到畫面上
           DISPLAY g_xmdk2_d[l_ac].xmdl015_02 TO xmdl015_02
           DISPLAY g_xmdk2_d[l_ac].xmdl016_02 TO xmdl016_02
           DISPLAY g_xmdk2_d[l_ac].xmdl052_02 TO xmdl052_02           
           CALL s_desc_get_stock_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02) RETURNING g_xmdk2_d[l_ac].xmdl014_02_desc
           CALL s_desc_get_locator_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02) RETURNING g_xmdk2_d[l_ac].xmdl015_02_desc
           NEXT FIELD xmdl015_02 

        
   END INPUT
   
END DIALOG]]>
  </point>
  <point name="function.axmp540_02_init" order="5" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#畫面初始設定
PUBLIC FUNCTION axmp540_02_init()
     CALL cl_set_combo_scc("source","3020") 
     CALL cl_set_combo_scc("xmdk002","2063") 
     CALL cl_set_combo_scc("xmdl007_02","2055")
     CALL cl_set_combo_scc("xmdl007_04","2055")
     
   #2014/10/24 by stellar add ----------------(S)
   #判斷據點參數若不使用產品特徵時，則產品特徵需隱藏不可以維護(據點參數:S-BAS-0036)
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0036') = 'N' THEN
      CALL cl_set_comp_visible("xmdl009_02,xmdl009_02_desc",FALSE)
      CALL cl_set_comp_visible("xmdm002_03,xmdm002_03_desc",FALSE)
      CALL cl_set_comp_visible("xmdl009_04,xmdl009_04_desc",FALSE)
   END IF

   #判斷據點參數若不使用參考單位時，則參考單位、數量需隱藏不可以維護(據點參數:S-BAS-0028)
   IF cl_get_para(g_enterprise,g_site,'S-BAS-0028') = 'N' THEN
      CALL cl_set_comp_visible("xmdl019_02,xmdl019_02_desc,xmdl020_02",FALSE)
      CALL cl_set_comp_visible("xmdm010_03,xmdm010_03_desc,xmdm011_03",FALSE)
   END IF
   #2014/10/24 by stellar add ----------------(E)
END FUNCTION]]>
  </point>
  <point name="dialog.axmp540_02_input05" order="6" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 於第二頁資料調整的最上面增加一個欄位"匯總方式"
# Memo...........:
# Usage..........: SUBDIALOG axm_axmp540_01.axmp540_01_input
#                  
# Input parameter: 
# Return code....: 
# Date & Author..: 2014/10/21 By stellar
# Modify.........:
################################################################################
DIALOG axmp540_02_input05()

   INPUT g_gather FROM l_gather ATTRIBUTE(WITHOUT DEFAULTS)
      ON CHANGE l_gather
         #匯總資料時，錯誤訊息先匯總後再顯示
         CALL cl_err_collect_init()
         
         CALL axmp540_02()
         CALL axmp540_02_b_fill()
         CALL axmp540_02_fetch()
         
         #匯總資料時，錯誤訊息先匯總後再顯示
         CALL cl_err_collect_show()
   END INPUT
END DIALOG]]>
  </point>
  <point name="function.axmp540_02_fetch" order="6" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#單身陣列填充
PUBLIC FUNCTION axmp540_02_fetch()
  DEFINE l_sql     STRING
  DEFINE l_ac_t    LIKE type_t.num5

    IF cl_null(g_detail_02_idx) OR g_detail_02_idx <=0 THEN
       RETURN
    END IF
    
    IF g_detail_02_idx > g_xmdk_d.getLength() THEN
       LET g_detail_02_idx = g_xmdk_d.getLength()
    END IF
   
    INITIALIZE g_xmdk2_d TO NULL
    INITIALIZE g_xmdk4_d TO NULL
    LET l_sql = "SELECT xmdldocno,xmdlseq,xmdl001,xmdl002,xmdl003, ",
                "       xmdl004,xmdl005,xmdl006,xmdl007,xmdl008, ",
                "       xmdl009,xmdl011,xmdl012,xmdl017,xmdl018, ",
                "       xmdl019,xmdl020,xmdl013,xmdl014,xmdl015, ",
                "       xmdl016,xmdl052,xmdl021,xmdl022,xmdl023,xmdl024, ",
                "       xmdl025,xmdl026,xmdl027,xmdl028,xmdl029, ",
                "       xmdl042,xmdl043,xmdl044,xmdl045,xmdl046, ",
                "       linkno,source ",
                "  FROM p540_02_xmdl_temp ",
                " WHERE linkno = '",g_xmdk_d[g_detail_02_idx].linkno,"'" ,
                " ORDER BY xmdldocno,xmdlseq,xmdl001,xmdl002,xmdl003 "
    PREPARE axmp540_sel_xmdl_pr FROM l_sql
    DECLARE axmp540_sel_xmdl_cs CURSOR FOR axmp540_sel_xmdl_pr 
    LET l_ac_t = l_ac
    LET l_ac = 1
    
    CALL g_xmdk2_d.clear()
    CALL g_xmdk4_d.clear()
    FOREACH  axmp540_sel_xmdl_cs INTO g_xmdk2_d[l_ac].docno_02,g_xmdk2_d[l_ac].xmdlseq_02,g_xmdk2_d[l_ac].xmdl001_02,g_xmdk2_d[l_ac].xmdl002_02,g_xmdk2_d[l_ac].xmdl003_02,
                                      g_xmdk2_d[l_ac].xmdl004_02,g_xmdk2_d[l_ac].xmdl005_02,g_xmdk2_d[l_ac].xmdl006_02,g_xmdk2_d[l_ac].xmdl007_02,g_xmdk2_d[l_ac].xmdl008_02,
                                      g_xmdk2_d[l_ac].xmdl009_02,g_xmdk2_d[l_ac].xmdl011_02,g_xmdk2_d[l_ac].xmdl012_02,g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02,
                                      g_xmdk2_d[l_ac].xmdl019_02,g_xmdk2_d[l_ac].xmdl020_02,g_xmdk2_d[l_ac].xmdl013_02,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02,
                                      g_xmdk2_d[l_ac].xmdl016_02,g_xmdk2_d[l_ac].xmdl052_02,g_xmdk2_d[l_ac].xmdl021_02,g_xmdk2_d[l_ac].xmdl022_02,g_xmdk2_d[l_ac].xmdl023_02,g_xmdk4_d[l_ac].xmdl024_04,
                                      g_xmdk4_d[l_ac].xmdl025_04,g_xmdk4_d[l_ac].xmdl026_04,g_xmdk4_d[l_ac].xmdl027_04,g_xmdk4_d[l_ac].xmdl028_04,g_xmdk4_d[l_ac].xmdl029_04,
                                      g_xmdk4_d[l_ac].xmdl042_04,g_xmdk4_d[l_ac].xmdl043_04,g_xmdk4_d[l_ac].xmdl044_04,g_xmdk4_d[l_ac].xmdl045_04,g_xmdk4_d[l_ac].xmdl046_04,
                                      g_xmdk2_d[l_ac].linkno_02,g_xmdk2_d[l_ac].source_02                                      
       
       CALL axmp540_02_detail_show("'2'")
       LET g_xmdk4_d[l_ac].xmdlseq_04 = g_xmdk2_d[l_ac].xmdlseq_02
       LET g_xmdk4_d[l_ac].xmdl007_04 = g_xmdk2_d[l_ac].xmdl007_02
       LET g_xmdk4_d[l_ac].xmdl008_04 = g_xmdk2_d[l_ac].xmdl008_02
       LET g_xmdk4_d[l_ac].xmdl008_04_desc = g_xmdk2_d[l_ac].xmdl008_02_desc
       LET g_xmdk4_d[l_ac].imaal004_04 = g_xmdk2_d[l_ac].imaal004_02       
       LET g_xmdk4_d[l_ac].xmdl009_04 = g_xmdk2_d[l_ac].xmdl009_02
       LET g_xmdk4_d[l_ac].xmdl009_04_desc = g_xmdk2_d[l_ac].xmdl009_02_desc
       LET g_xmdk4_d[l_ac].xmdl011_04 = g_xmdk2_d[l_ac].xmdl011_02 
       LET g_xmdk4_d[l_ac].xmdl011_04_desc = g_xmdk2_d[l_ac].xmdl011_02_desc
       LET g_xmdk4_d[l_ac].xmdl012_04 = g_xmdk2_d[l_ac].xmdl012_02
       LET g_xmdk4_d[l_ac].xmdl017_04 = g_xmdk2_d[l_ac].xmdl017_02
       LET g_xmdk4_d[l_ac].xmdl017_04_desc = g_xmdk2_d[l_ac].xmdl017_02_desc
       LET g_xmdk4_d[l_ac].xmdl018_04 = g_xmdk2_d[l_ac].xmdl018_02
       LET g_xmdk4_d[l_ac].xmdl021_04 = g_xmdk2_d[l_ac].xmdl021_02 
       LET g_xmdk4_d[l_ac].xmdl021_04_desc = g_xmdk2_d[l_ac].xmdl021_02_desc 
       LET g_xmdk4_d[l_ac].xmdl022_04 = g_xmdk2_d[l_ac].xmdl022_02         

       
       LET l_ac = l_ac + 1
    END FOREACH
    CALL g_xmdk2_d.deleteElement(l_ac)
    CALL g_xmdk4_d.deleteElement(l_ac)
    LET l_ac = l_ac_t
    LET g_detail2_02_cnt = l_ac - 1 
    LET g_detail4_02_cnt = l_ac - 1    
    CLOSE axmp540_sel_xmdl_cs
    FREE axmp540_sel_xmdl_pr
    
    #多庫儲批明細
    CALL axmp540_02_fetch_xmdm()
    
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_ins_xmdk" order="7" ver="5" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 產生出通單單單頭檔
# Memo...........: 
# Usage..........: CALL axmp540_02_ins_xmdk()
#                  
# Input parameter:  
#                :  
# Return code....:  
#                :   
# Date & Author..: 2014/06/30 By Polly
# Modify.........:
################################################################################
PUBLIC FUNCTION axmp540_02_ins_xmdk()
  DEFINE  l_source       LIKE type_t.num5          #來源單據1訂單2出通單
  DEFINE  l_linkno       LIKE type_t.num5
  DEFINE  l_no           LIKE type_t.num5
  DEFINE  l_cnt          LIKE type_t.num5
  DEFINE  l_xmdk         RECORD LIKE xmdk_t.*
  DEFINE  l_sql          STRING
  DEFINE  l_errno        LIKE type_t.chr10          #錯誤訊息代碼 
  DEFINE  l_ooef019      LIKE ooef_t.ooef019
  DEFINE  l_success      LIKE type_t.num5
  DEFINE  l_oodbl004     LIKE oodbl_t.oodbl004  #稅別名稱
  DEFINE  l_oodb005      LIKE oodb_t.oodb005    #含稅否
  DEFINE  l_oodb006      LIKE oodb_t.oodb006    #稅率
  DEFINE  l_oodb011      LIKE oodb_t.oodb011    #取得稅別類型1:正常稅率2:依料件設定
  DEFINE  l_xmdk003      LIKE xmdk_t.xmdk003
  DEFINE  l_xmdk004      LIKE xmdk_t.xmdk004
  DEFINE  l_pmaa027      LIKE pmaa_t.pmaa027    #150623-00017#1

   
  LET l_linkno = ''
  SELECT MAX(linkno) INTO l_linkno
    FROM p540_02_xmdk_temp

  
  #獲得當前營運據點的所屬稅區
  LET l_ooef019 = ''
  SELECT ooef019 INTO l_ooef019
    FROM ooef_t
   WHERE ooefent = g_enterprise
     AND ooef001 = g_site  


 
  FOR l_no = 1 TO l_linkno
      INITIALIZE l_xmdk.* TO NULL
      LET g_success = 'Y' 
      
      SELECT  source,xmdk007,xmdk010,xmdk011,xmdk012,
             xmdk016,xmdk017,xmdk009,xmdk008,xmdk015,
             xmdk002,xmdk028,xmdk029
        INTO       l_source,l_xmdk.xmdk007,l_xmdk.xmdk010,l_xmdk.xmdk011,l_xmdk.xmdk012,
             l_xmdk.xmdk016,l_xmdk.xmdk017,l_xmdk.xmdk009,l_xmdk.xmdk008,l_xmdk.xmdk015,
             l_xmdk.xmdk002,l_xmdk.xmdk028,l_xmdk.xmdk029
        FROM p540_02_xmdk_temp
       WHERE linkno = l_no

      LET g_result_str = ''
      CALL s_transaction_begin() 
 
      #公用欄位給值
      LET l_xmdk.xmdkownid = g_user
      LET l_xmdk.xmdkowndp = g_grup
      LET l_xmdk.xmdkcrtid = g_user
      LET l_xmdk.xmdkcrtdp = g_grup
      LET l_xmdk.xmdkcrtdt = cl_get_current()
      LET l_xmdk.xmdkmodid = ''
      LET l_xmdk.xmdkmoddt = ''

      #一般欄位給值
      LET l_xmdk.xmdk000 = "1"              #單據性質：1出貨單
      IF cl_null(g_xmdk_m.xmdkdocdt) THEN   #單據日期/出貨日期/扣帳日期
         LET l_xmdk.xmdkdocdt = g_today  
         LET l_xmdk.xmdk026 = g_today       
         LET l_xmdk.xmdk001 = g_today             
      ELSE
         LET l_xmdk.xmdkdocdt = g_xmdk_m.xmdkdocdt 
         LET l_xmdk.xmdk026 = g_xmdk_m.xmdkdocdt       
         LET l_xmdk.xmdk001 = g_xmdk_m.xmdkdocdt         
      END IF         
      LET l_xmdk.xmdk032 = g_today          #結關日期      
      LET l_xmdk.xmdk083 = 'N'              #多角貿易已拋轉   
      LET l_xmdk.xmdk028 = 'N'              #包裝單製作
      LET l_xmdk.xmdk029 = 'N'              #Invoice製作  
      LET l_xmdk.xmdk045 = '1'              #多角性質

      #--20150408--POLLY--ADD--業務人員抓INPUT條件--(S)
      IF NOT cl_null(g_xmdk_m.xmdk003) THEN     #業務人員/業務部門
         LET l_xmdk.xmdk003 = g_xmdk_m.xmdk003
         SELECT ooag003 INTO l_xmdk.xmdk004
           FROM ooag_t
          WHERE ooagent = g_enterprise
            AND ooag001 = l_xmdk.xmdk003         
      END IF    
      #--20150408--POLLY--ADD--業務人員抓INPUT條件--(E)
      
     #回寫單頭出通單OR出貨單單號
      LET l_cnt = 0 
      LET l_xmdk.xmdk005 = ''
      LET l_xmdk.xmdk006 = ''

      CASE l_source
        WHEN '1'               #訂單
          SELECT COUNT(DISTINCT(xmdl003)) INTO l_cnt
            FROM p540_02_xmdl_temp
           WHERE linkno = l_no
          IF NOT cl_null(l_cnt) AND l_cnt = 1 THEN
             SELECT DISTINCT xmdl003 INTO l_xmdk.xmdk006  #訂單單號 
               FROM p540_02_xmdl_temp
              WHERE linkno = l_no    
             #--20150408--POLLY--ADD--業務人員回抓原單據--(S)
             IF cl_null(l_xmdk.xmdk003) THEN
                SELECT xmda002,xmda003 
                  INTO l_xmdk.xmdk003,l_xmdk.xmdk004
                  FROM xmda_t
                 WHERE xmdaent = g_enterprise
                   AND xmdadocno = l_xmdk.xmdk006               
             END IF
             #--20150408--POLLY--ADD--業務人員回抓原單據--(E)              
          END IF

        WHEN '2'               #出通單
          SELECT COUNT(DISTINCT(xmdl001)) INTO l_cnt
            FROM p540_02_xmdl_temp
           WHERE linkno = l_no
          IF NOT cl_null(l_cnt) AND l_cnt = 1 THEN
             SELECT DISTINCT xmdl001 INTO l_xmdk.xmdk005  #出通單單號 
               FROM p540_02_xmdl_temp
              WHERE linkno = l_no   
             #--20150408--POLLY--ADD--業務人員回抓原單據--(S)
             IF cl_null(l_xmdk.xmdk003) THEN
                SELECT xmdg002,xmdg003 
                  INTO l_xmdk.xmdk003,l_xmdk.xmdk004
                  FROM xmdg_t
                 WHERE xmdgent = g_enterprise
                   AND xmdgdocno = l_xmdk.xmdk005                 
             END IF
             #--20150408--POLLY--ADD--業務人員回抓原單據--(E)                
          END IF
      END CASE        
      #取得稅別、單價含稅否
      CALL s_tax_chk(g_site,l_xmdk.xmdk012)
        RETURNING l_success,l_oodbl004,l_oodb005,l_oodb006,l_oodb011
      LET l_xmdk.xmdk013 = l_oodb006
      LET l_xmdk.xmdk014 = l_oodb005
     
      #依客戶帶出取價方式、運輸方式、交運起點、交運終點、銷售通路、銷售分類、內外銷、取匯率方式、業務人員、業務部門    
      CALL axmp540_02_xmdk007_default(l_xmdk.xmdk003,l_xmdk.xmdk004,l_xmdk.xmdk007)
        RETURNING l_xmdk003,l_xmdk004,l_xmdk.xmdk018,l_xmdk.xmdk022,l_xmdk.xmdk023,
                  l_xmdk.xmdk024,l_xmdk.xmdk030,l_xmdk.xmdk031,l_xmdk.xmdk042,l_xmdk.xmdk043     
      #--20150408--POLLY--ADD--業務人員依客戶帶出預設--(S)                  
      IF cl_null(l_xmdk.xmdk003) THEN
         IF NOT cl_null(l_xmdk003) THEN
            LET l_xmdk.xmdk003 = l_xmdk003
            LET l_xmdk.xmdk004 = l_xmdk004         
         ELSE
            LET l_xmdk.xmdk003 = g_user
            LET l_xmdk.xmdk004 = g_dept        
         END IF
      END IF
      #--20150408--POLLY--ADD--業務人員依客戶帶出預設--(E)                  
      LET l_xmdk.xmdkent  = g_enterprise
      LET l_xmdk.xmdksite  = g_site
      LET l_xmdk.xmdkstus = 'N'      
      #送货地址    ------#150623-00017#1--ADD--b
      IF cl_null(l_xmdk.xmdk021) THEN
         CALL s_axmt500_get_pmaa027(l_xmdk.xmdk009) RETURNING l_pmaa027
          DECLARE axmp540_02_cs SCROLL CURSOR FOR
           SELECT oofb019 FROM oofb_t
            WHERE oofbent  = g_enterprise
              AND oofb002  = l_pmaa027
      #       AND oofb008  = '6'
              AND oofbstus = 'Y'
            ORDER BY oofb010 DESC
          OPEN axmp540_02_cs
          FETCH FIRST axmp540_02_cs INTO l_xmdk.xmdk021
      END IF
      ------#150623-00017#1--ADD----e      
      #取單號
      CALL s_aooi200_gen_docno(g_site,g_xmdk_m.xmdkdocno,g_today,'axmt540') RETURNING l_success,l_xmdk.xmdkdocno
      IF NOT l_success THEN
         LET g_success = 'N'
         LET l_errno = 'apm-00003'
         LET g_result_str = g_result_str,",",cl_getmsg(l_errno,g_lang)
      END IF   
      IF g_success = 'Y' THEN
         #寫入單頭檔
         INSERT INTO xmdk_t (xmdkent,xmdk000,xmdksite,xmdkdocno,xmdkdocdt,xmdk001,xmdk003,xmdk004,
             xmdkstus,xmdk005,xmdk006,xmdk007,xmdk009,xmdk008,xmdk002,xmdk032,xmdk030,xmdk028,
             xmdk029,xmdk037,xmdk034,xmdk054,xmdk039,xmdk040,xmdk021,xmdk022,xmdk023,xmdk024,xmdk020,
             xmdk025,xmdk026,xmdk027,xmdk038,xmdk010,xmdk011,xmdk012,xmdk013,xmdk014,xmdk015,xmdk016,
             xmdk042,xmdk043,   #150623-00017#1
             xmdk017,xmdk018,xmdk019,xmdk031,xmdk033,xmdk035,xmdk036,xmdk083,xmdk045,xmdkownid,
             xmdkowndp,xmdkcrtid,xmdkcrtdp,xmdkcrtdt,xmdkcnfid,xmdkcnfdt,xmdkpstid,xmdkpstdt)
         VALUES (g_enterprise,l_xmdk.xmdk000,l_xmdk.xmdksite,l_xmdk.xmdkdocno,l_xmdk.xmdkdocdt,
             l_xmdk.xmdk001,l_xmdk.xmdk003,l_xmdk.xmdk004,l_xmdk.xmdkstus,l_xmdk.xmdk005,
             l_xmdk.xmdk006,l_xmdk.xmdk007,l_xmdk.xmdk009,l_xmdk.xmdk008,l_xmdk.xmdk002,
             l_xmdk.xmdk032,l_xmdk.xmdk030,l_xmdk.xmdk028,l_xmdk.xmdk029,l_xmdk.xmdk037,
             l_xmdk.xmdk034,l_xmdk.xmdk054,l_xmdk.xmdk039,l_xmdk.xmdk040,l_xmdk.xmdk021,
             l_xmdk.xmdk022,l_xmdk.xmdk023,l_xmdk.xmdk024,l_xmdk.xmdk020,l_xmdk.xmdk025,
             l_xmdk.xmdk026,l_xmdk.xmdk027,l_xmdk.xmdk038,l_xmdk.xmdk010,l_xmdk.xmdk011,
             l_xmdk.xmdk012,l_xmdk.xmdk013,l_xmdk.xmdk014,l_xmdk.xmdk015,l_xmdk.xmdk016,
             l_xmdk.xmdk042,l_xmdk.xmdk043, #150623-00017#1
             l_xmdk.xmdk017,l_xmdk.xmdk018,l_xmdk.xmdk019,l_xmdk.xmdk031,l_xmdk.xmdk033,
             l_xmdk.xmdk035,l_xmdk.xmdk036,l_xmdk.xmdk083,l_xmdk.xmdk045,l_xmdk.xmdkownid,
             l_xmdk.xmdkowndp,l_xmdk.xmdkcrtid,l_xmdk.xmdkcrtdp,l_xmdk.xmdkcrtdt,l_xmdk.xmdkcnfid,
             l_xmdk.xmdkcnfdt,l_xmdk.xmdkpstid,l_xmdk.xmdkpstdt)
         IF SQLCA.sqlcode THEN
             LET l_errno = SQLCA.sqlcode
             LET g_result_str = g_result_str,",INSERT INTO xmdk_t",cl_getmsg(l_errno,g_lang)
             LET g_success = 'N'
         END IF         
      END IF
      IF g_success = 'Y' THEN
         #寫入單身檔
          CALL axmp540_02_ins_xmdl(l_no,l_xmdk.xmdkdocno)               
      END IF
      IF g_success = 'Y' THEN
         #寫入多庫儲批  
          CALL axmp540_02_ins_xmdm(l_no,l_xmdk.xmdkdocno)  
      END IF
      IF g_success = 'Y' THEN
         CALL s_transaction_end('Y','0')
         LET g_result_str = cl_getmsg('apm-00538',g_lang)        #建立成功   
      ELSE
         CALL s_transaction_end('N','0')
         #因為執行失敗 所以不給予單號 
          LET l_xmdk.xmdkdocno = ''        
      END IF
      #寫入顯示結果是成功或錯誤訊息
      UPDATE p540_02_xmdk_temp
         SET xmdkdocno = l_xmdk.xmdkdocno,
             result = g_result_str
       WHERE linkno = l_no        
               
  END FOR  
      
      
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_xmdk007_default" order="8" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[################################################################################
# Descriptions...: 客戶編號帶值
# Memo...........: 自動帶出客戶預設資料
# Usage..........: CALL axmp540_02_xmdk007_default(p_xmdk003,p_xmdk004,p_xmdk007)
#                  
# Input parameter:  p_xmdk003    業務人員
#                :  p_xmdk004    業務部門
#                :  p_xmdk007    訂單客戶
# Return code....:  r_xmdk003    業務人員
#                :  r_xmdk004    業務部門
#                :  r_xmdk018    取價方式 
#                :  r_xmdk022    運輸方式
#                :  r_xmdk023    交運起點
#                :  r_xmdk024    交運終點
#                :  r_xmdk030    銷售通路
#                :  r_xmdk031    銷售分類
#                : 
# Date & Author..: 2014/06/30 By Polly
# Modify.........:
################################################################################
PRIVATE FUNCTION axmp540_02_xmdk007_default(p_xmdk003,p_xmdk004,p_xmdk007)
   DEFINE p_xmdk003 LIKE xmdk_t.xmdk003
   DEFINE p_xmdk004 LIKE xmdk_t.xmdk004
   DEFINE p_xmdk007 LIKE xmdk_t.xmdk007
   DEFINE r_xmdk       RECORD
      xmdk003             LIKE xmdk_t.xmdk003,   #業務人員   
      xmdk004             LIKE xmdk_t.xmdk004,   #業務部門   
      xmdk010             LIKE xmdk_t.xmdk010,   #收款條件
      xmdk011             LIKE xmdk_t.xmdk011,   #交易條件
      xmdk012             LIKE xmdk_t.xmdk012,   #稅別
      xmdk015             LIKE xmdk_t.xmdk015,   #發票類型
      xmdk016             LIKE xmdk_t.xmdk016,   #幣別
      xmdk018             LIKE xmdk_t.xmdk018,   #取價方式
      xmdk022             LIKE xmdk_t.xmdk022,   #運輸方式
      xmdk023             LIKE xmdk_t.xmdk023,   #交運起點
      xmdk024             LIKE xmdk_t.xmdk024,   #交運終點
      xmdk030             LIKE xmdk_t.xmdk030,   #銷售通路
      xmdk031             LIKE xmdk_t.xmdk031,   #銷售分類
      xmdk042             LIKE xmdk_t.xmdk042,   #內外銷
      xmdk043             LIKE xmdk_t.xmdk043    #取匯率方式      
                       END RECORD              
                       
   IF NOT cl_null(p_xmdk007) THEN
      CALL s_axmt540_client_default(p_xmdk007,p_xmdk003,p_xmdk004) RETURNING r_xmdk.*                       
   END IF
  
   RETURN r_xmdk.xmdk003,r_xmdk.xmdk004,r_xmdk.xmdk018,r_xmdk.xmdk022,r_xmdk.xmdk023,
          r_xmdk.xmdk024,r_xmdk.xmdk030,r_xmdk.xmdk031,r_xmdk.xmdk042,r_xmdk.xmdk043
   
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_ins_xmdl" order="9" ver="6" cite_std="N" new="Y" status="u" src="s" readonly="" mark_hard="N">
    <![CDATA[#寫入出貨/簽收/銷退單單身明細檔
PRIVATE FUNCTION axmp540_02_ins_xmdl(p_no,p_xmdkdocno)
   DEFINE p_no         LIKE type_t.num10
   DEFINE p_xmdkdocno  LIKE xmdk_t.xmdkdocno
   DEFINE l_xmdl_d     type_g_xmdl_d
   DEFINE l_xmdk016    LIKE xmdk_t.xmdk016
   DEFINE l_xmdk017    LIKE xmdk_t.xmdk017
   DEFINE l_sql        STRING

   IF cl_null(p_no) OR cl_null(p_xmdkdocno) THEN
   END IF
   
   #幣別、匯率
   SELECT xmdk016,xmdk017
     INTO l_xmdk016,l_xmdk017
     FROM xmdk_t
    WHERE xmdkent = g_enterprise
      AND xmdkdocno = p_xmdkdocno
      


   LET l_sql = "   SELECT xmdlseq,xmdl001, ",
               "          xmdl002, xmdl003,xmdl004,xmdl005,xmdl006, ",
               "          xmdl007, xmdl008,xmdl009,xmdl010,xmdl011, ",
               "          xmdl012, xmdl013,xmdl014,xmdl015,xmdl016, ",
               "          xmdl017, xmdl018,xmdl019,xmdl020,xmdl021, ",
               "          xmdl022, xmdl023,xmdl024,xmdl025,xmdl026, ",
               "          xmdl027, xmdl028,xmdl029,xmdl030,xmdl031, ",
               "          xmdl032, xmdl033,xmdl034,xmdl035,xmdl036, ",
               "          xmdl037, xmdl038,xmdl039,xmdl040,xmdl041, ",
               "          xmdl042, xmdl043,xmdl044,xmdl045,xmdl046, ",
               "          xmdl048,xmdl049,xmdl050,xmdl051, ",
               "          xmdl052, xmdl087,xmdl088 ",
               "     FROM p540_02_xmdl_temp ",
               "    WHERE linkno = '",p_no,"' ",
               "    ORDER BY xmdlseq "               
               
               
   PREPARE p540_02_xmdl_pr FROM l_sql
   DECLARE p540_02_xmdl_cs CURSOR FOR p540_02_xmdl_pr
   
   FOREACH p540_02_xmdl_cs INTO l_xmdl_d.xmdlseq,l_xmdl_d.xmdl001,
                                l_xmdl_d.xmdl002, l_xmdl_d.xmdl003,l_xmdl_d.xmdl004,l_xmdl_d.xmdl005,l_xmdl_d.xmdl006,
                                l_xmdl_d.xmdl007, l_xmdl_d.xmdl008,l_xmdl_d.xmdl009,l_xmdl_d.xmdl010,l_xmdl_d.xmdl011,
                                l_xmdl_d.xmdl012, l_xmdl_d.xmdl013,l_xmdl_d.xmdl014,l_xmdl_d.xmdl015,l_xmdl_d.xmdl016,
                                l_xmdl_d.xmdl017, l_xmdl_d.xmdl018,l_xmdl_d.xmdl019,l_xmdl_d.xmdl020,l_xmdl_d.xmdl021,
                                l_xmdl_d.xmdl022, l_xmdl_d.xmdl023,l_xmdl_d.xmdl024,l_xmdl_d.xmdl025,l_xmdl_d.xmdl026,
                                l_xmdl_d.xmdl027, l_xmdl_d.xmdl028,l_xmdl_d.xmdl029,l_xmdl_d.xmdl030,l_xmdl_d.xmdl031,
                                l_xmdl_d.xmdl032, l_xmdl_d.xmdl033,l_xmdl_d.xmdl034,l_xmdl_d.xmdl035,l_xmdl_d.xmdl036,
                                l_xmdl_d.xmdl037, l_xmdl_d.xmdl038,l_xmdl_d.xmdl039,l_xmdl_d.xmdl040,l_xmdl_d.xmdl041,
                                l_xmdl_d.xmdl042, l_xmdl_d.xmdl043,l_xmdl_d.xmdl044,l_xmdl_d.xmdl045,l_xmdl_d.xmdl046,
                                l_xmdl_d.xmdl048,l_xmdl_d.xmdl049,l_xmdl_d.xmdl050,l_xmdl_d.xmdl051,
                                l_xmdl_d.xmdl052, l_xmdl_d.xmdl087,l_xmdl_d.xmdl088 

        
        LET l_xmdl_d.xmdldocno = p_xmdkdocno      #給予真正的單號
      
        #稅額計算
        CALL s_axmt540_tax_count('',l_xmdl_d.xmdldocno,l_xmdl_d.xmdlseq,g_site,l_xmdl_d.xmdl025,l_xmdl_d.xmdl022,l_xmdl_d.xmdl024,l_xmdk016,l_xmdk017,
                                 l_xmdl_d.xmdl003,l_xmdl_d.xmdl004,l_xmdl_d.xmdl018)
          RETURNING l_xmdl_d.xmdl027,l_xmdl_d.xmdl028,l_xmdl_d.xmdl029         
        
        #寫入xmdl_t中
        IF g_success = 'Y' THEN
           INSERT INTO xmdl_t(xmdlent,xmdlsite,xmdldocno,xmdlseq,xmdl001,
                              xmdl002, xmdl003,  xmdl004,xmdl005,xmdl006,
                              xmdl007, xmdl008,  xmdl009,xmdl010,xmdl011,
                              xmdl012, xmdl013,  xmdl014,xmdl015,xmdl016,
                              xmdl017, xmdl018,  xmdl019,xmdl020,xmdl021,
                              xmdl022, xmdl023,  xmdl024,xmdl025,xmdl026,
                              xmdl027, xmdl028,  xmdl029,xmdl030,xmdl031,
                              xmdl032, xmdl033,  xmdl034,xmdl035,xmdl036,
                              xmdl037, xmdl038,  xmdl039,xmdl040,xmdl041,
                              xmdl042, xmdl043,  xmdl044,xmdl045,xmdl046,
                              xmdl048,  xmdl049,xmdl050,xmdl051,
                              xmdl052, xmdl087,  xmdl088)
                VALUES (g_enterprise    ,g_site          ,l_xmdl_d.xmdldocno,l_xmdl_d.xmdlseq,l_xmdl_d.xmdl001,
                        l_xmdl_d.xmdl002,l_xmdl_d.xmdl003,l_xmdl_d.xmdl004  ,l_xmdl_d.xmdl005,l_xmdl_d.xmdl006,
                        l_xmdl_d.xmdl007,l_xmdl_d.xmdl008,l_xmdl_d.xmdl009  ,l_xmdl_d.xmdl010,l_xmdl_d.xmdl011,
                        l_xmdl_d.xmdl012,l_xmdl_d.xmdl013,l_xmdl_d.xmdl014  ,l_xmdl_d.xmdl015,l_xmdl_d.xmdl016,
                        l_xmdl_d.xmdl017,l_xmdl_d.xmdl018,l_xmdl_d.xmdl019  ,l_xmdl_d.xmdl020,l_xmdl_d.xmdl021,
                        l_xmdl_d.xmdl022,l_xmdl_d.xmdl023,l_xmdl_d.xmdl024  ,l_xmdl_d.xmdl025,l_xmdl_d.xmdl026,
                        l_xmdl_d.xmdl027,l_xmdl_d.xmdl028,l_xmdl_d.xmdl029  ,l_xmdl_d.xmdl030,l_xmdl_d.xmdl031,
                        l_xmdl_d.xmdl032,l_xmdl_d.xmdl033,l_xmdl_d.xmdl034  ,l_xmdl_d.xmdl035,l_xmdl_d.xmdl036,
                        l_xmdl_d.xmdl037,l_xmdl_d.xmdl038,l_xmdl_d.xmdl039  ,l_xmdl_d.xmdl040,l_xmdl_d.xmdl041,
                        l_xmdl_d.xmdl042,l_xmdl_d.xmdl043,l_xmdl_d.xmdl044  ,l_xmdl_d.xmdl045,l_xmdl_d.xmdl046,
                        l_xmdl_d.xmdl048,l_xmdl_d.xmdl049,l_xmdl_d.xmdl050  ,l_xmdl_d.xmdl051,
                        l_xmdl_d.xmdl052,l_xmdl_d.xmdl087,l_xmdl_d.xmdl088)    
           IF SQLCA.sqlcode THEN
              LET g_result_str = g_result_str,",INSERT INTO xmdl_t",cl_getmsg(SQLCA.sqlcode,g_lang)
              LET g_success = 'N'         
           END IF
           
        END IF    
   END FOREACH
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_detail_show" order="10" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[#欄位說明顯示
PRIVATE FUNCTION axmp540_02_detail_show(p_page)
   DEFINE p_page      STRING
   DEFINE l_success   LIKE type_t.num5
   DEFINE l_oodbl004 LIKE oodbL_t.oodbl004
   DEFINE l_oodb005  LIKE oodb_t.oodb005
   DEFINE l_oodb006  LIKE oodb_t.oodb006
   DEFINE l_oodb011  LIKE oodb_t.oodb011
   
      IF p_page.getIndexOf("'1'",1) > 0 THEN
         #客戶
         CALL s_desc_get_trading_partner_abbr_desc(g_xmdk_d[l_ac].xmdk007)   
           RETURNING g_xmdk_d[l_ac].xmdk007_desc
        ##收款客戶
        #CALL s_desc_get_trading_partner_abbr_desc(g_xmdk_d[l_ac].xmdk008)   
        #  RETURNING g_xmdk_d[l_ac].xmdk008_desc
        ##收貨客戶
        #CALL s_desc_get_trading_partner_abbr_desc(g_xmdk_d[l_ac].xmdk009)   
        #  RETURNING g_xmdk_d[l_ac].xmdk009_desc           
         #付款條件
         CALL s_desc_get_ooib002_desc(g_xmdk_d[l_ac].xmdk010)   
           RETURNING g_xmdk_d[l_ac].xmdk010_desc  

         #稅別
         CALL s_desc_get_tax_desc1(g_site,g_xmdk_d[l_ac].xmdk012)
           RETURNING g_xmdk_d[l_ac].xmdk012_desc
         #稅率、含稅否
         CALL s_tax_chk(g_site,g_xmdk_d[l_ac].xmdk012)
           RETURNING l_success,l_oodbl004,l_oodb005,l_oodb006,l_oodb011
         IF l_success THEN
           LET g_xmdk_d[l_ac].xmdk013 = l_oodb006
           LET g_xmdk_d[l_ac].xmdk014 = l_oodb005 
         END IF
         #交易條件
         CALL s_desc_get_acc_desc('238',g_xmdk_d[l_ac].xmdk011) 
           RETURNING g_xmdk_d[l_ac].xmdk011_desc
           
        #發票類別
        #CALL s_desc_get_invoice_type_desc1(g_site,g_xmdk_d[l_ac].xmdk015) 
        #  RETURNING g_xmdk_d[l_ac].xmdk015_desc
        
        #幣別
        CALL s_desc_get_currency_desc(g_xmdk_d[l_ac].xmdk016) 
          RETURNING g_xmdk_d[l_ac].xmdk016_desc        
      END IF

   IF p_page.getIndexOf("'2'",1) > 0 THEN
      #品名、規格
      CALL s_desc_get_item_desc(g_xmdk2_d[l_ac].xmdl008_02)      
        RETURNING g_xmdk2_d[l_ac].xmdl008_02_desc,g_xmdk2_d[l_ac].imaal004_02
      #產品特徵
      CALL s_feature_description(g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02)
           RETURNING l_success,g_xmdk2_d[l_ac].xmdl009_02_desc
      #作業編號
      CALL s_desc_get_acc_desc('221',g_xmdk2_d[l_ac].xmdl011_02)
        RETURNING g_xmdk2_d[l_ac].xmdl011_02_desc      
      #出貨單位、參考單位、計價單位
      CALL s_desc_get_unit_desc(g_xmdk2_d[l_ac].xmdl017_02)   
        RETURNING g_xmdk2_d[l_ac].xmdl017_02_desc
      CALL s_desc_get_unit_desc(g_xmdk2_d[l_ac].xmdl019_02)   
        RETURNING g_xmdk2_d[l_ac].xmdl019_02_desc
      CALL s_desc_get_unit_desc(g_xmdk2_d[l_ac].xmdl021_02)   
        RETURNING g_xmdk2_d[l_ac].xmdl021_02_desc        
      #庫位
      CALL s_desc_get_stock_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02)  #庫位
        RETURNING g_xmdk2_d[l_ac].xmdl014_02_desc
      #儲位     
      CALL s_desc_get_locator_desc(g_site,g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02) #儲位
        RETURNING g_xmdk2_d[l_ac].xmdl015_02_desc              
      #稅別
      CALL s_desc_get_tax_desc1(g_site,g_xmdk4_d[l_ac].xmdl025_04)
        RETURNING g_xmdk4_d[l_ac].xmdl025_04_desc  
   END IF

   IF p_page.getIndexOf("'3'",1) > 0 THEN
      #品名、規格
      CALL s_desc_get_item_desc(g_xmdk3_d[l_ac].xmdm001_03)      
        RETURNING g_xmdk3_d[l_ac].xmdm001_03_desc,g_xmdk3_d[l_ac].imaal004_03
      #產品特徵
      CALL s_feature_description(g_xmdk3_d[l_ac].xmdm001_03,g_xmdk3_d[l_ac].xmdm002_03)
           RETURNING l_success,g_xmdk3_d[l_ac].xmdm002_03_desc
      #作業編號
      CALL s_desc_get_acc_desc('221',g_xmdk3_d[l_ac].xmdm003_03)
        RETURNING g_xmdk3_d[l_ac].xmdm003_03_desc      
      #單位、參考單位
      CALL s_desc_get_unit_desc(g_xmdk3_d[l_ac].xmdm008_03)   
        RETURNING g_xmdk3_d[l_ac].xmdm008_03_desc
      CALL s_desc_get_unit_desc(g_xmdk3_d[l_ac].xmdm010_03)   
        RETURNING g_xmdk3_d[l_ac].xmdm010_03_desc      
      #庫位
      CALL s_desc_get_stock_desc(g_site,g_xmdk3_d[l_ac].xmdm005_03)  #庫位
        RETURNING g_xmdk3_d[l_ac].xmdm005_03_desc
      #儲位     
      CALL s_desc_get_locator_desc(g_site,g_xmdk3_d[l_ac].xmdm005_03,g_xmdk3_d[l_ac].xmdm006_03) #儲位
        RETURNING g_xmdk3_d[l_ac].xmdm006_03_desc              
   END IF
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_set_entry_b" order="11" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION axmp540_02_set_entry_b()
    CALL cl_set_comp_entry("xmdl018_02,xmdl020_02,xmdl022_02",TRUE)                #出貨數量、參考數量、計價數量
    CALL cl_set_comp_entry("xmdl013_02,xmdl014_02,xmdl015_02,xmdl016_02,xmdl052_02",TRUE)     #多倉儲批、庫位、儲位、批號、庫存管理特徵
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_set_no_entry_b" order="12" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION axmp540_02_set_no_entry_b()
DEFINE l_flag      LIKE type_t.chr1        #是否可分批出貨
DEFINE l_xmdl013   LIKE xmdl_t.xmdl013
DEFINE l_xmdl014   LIKE xmdl_t.xmdl014
DEFINE l_xmdl015   LIKE xmdl_t.xmdl015
DEFINE l_xmdl016   LIKE xmdl_t.xmdl016
DEFINE l_xmdl052   LIKE xmdl_t.xmdl052
DEFINE l_imaf015   LIKE imaf_t.imaf015
DEFINE l_imaf061   LIKE imaf_t.imaf061
DEFINE l_imaf113   LIKE imaf_t.imaf113
DEFINE l_imaf055   LIKE imaf_t.imaf055

    LET l_flag = ''
    LET l_xmdl013 = ''
    LET l_xmdl014 = '' 
    LET l_xmdl015 = '' 
    LET l_xmdl016 = ''     

    IF g_xmdk2_d[l_ac].source_02 = '1'  THEN    #單據來源：訂單
       CALL axmp540_01_get_xmdc_xmdh('1',g_xmdk2_d[l_ac].xmdl003_02,g_xmdk2_d[l_ac].xmdl004_02)
         RETURNING l_flag,l_xmdl013,l_xmdl014,l_xmdl015,l_xmdl016,l_xmdl052
       #不允許部分交貨，則不能修改數量  
       IF l_flag = 'N' THEN                                         
          CALL cl_set_comp_entry("xmdl018_02",FALSE)
       END IF
       #訂單已經有指定出貨的庫儲批時，則出貨單就不能再勾選多庫儲批出貨
       #是否已有限定庫儲批   
       IF NOT cl_null(l_xmdl013) THEN
          CALL cl_set_comp_entry("xmdl013_02,xmdl014_02",FALSE)
          IF NOT cl_null(l_xmdl014) THEN
             CALL cl_set_comp_entry("xmdl015_02",FALSE)
             IF NOT cl_null(l_xmdl015) THEN
                CALL cl_set_comp_entry("xmdl016_02",FALSE)
             END IF
          END IF
       END IF
       IF NOT cl_null(l_xmdl052) THEN
          CALL cl_set_comp_entry("xmdl052_02",FALSE)
       END IF
    ELSE                                        #單據來源：出通單
       CALL axmp540_01_get_xmdc_xmdh('2',g_xmdk2_d[l_ac].xmdl001_02,g_xmdk2_d[l_ac].xmdl002_02)
         RETURNING l_flag,l_xmdl013,l_xmdl014,l_xmdl015,l_xmdl016,l_xmdl052
       #出貨單控管為"一對一"，則不能修改數量  
       IF l_flag = 'N' THEN                             
           CALL cl_set_comp_entry("xmdl018_02",FALSE)
       END IF      
       #若使用多倉儲批，不能限定庫儲批       
       IF l_xmdl013 = 'Y' THEN                         
          CALL cl_set_comp_entry("xmdl014_02,xmdl015_02,xmdl016_02",FALSE)    
       END IF 
       #是否已有限定庫儲批   
       IF NOT cl_null(l_xmdl013) THEN
          CALL cl_set_comp_entry("xmdl014_02",FALSE)
          IF NOT cl_null(l_xmdl014) THEN
             CALL cl_set_comp_entry("xmdl015_02",FALSE)
             IF NOT cl_null(l_xmdl015) THEN
                CALL cl_set_comp_entry("xmdl016_02",FALSE)
             END IF
          END IF
       END IF 
       IF NOT cl_null(l_xmdl052) THEN
          CALL cl_set_comp_entry("xmdl052_02",FALSE)
       END IF      
    END IF

    #若為多庫儲批出貨
    IF g_xmdk2_d[l_ac].xmdl013_02 = 'Y' THEN
       CALL cl_set_comp_entry("xmdl014_02,xmdl015_02,xmdl016_02,xmdl052_02",FALSE)
    END IF
    
    CALL axmp540_01_get_imaf(g_xmdk2_d[l_ac].xmdl008_02)     
      RETURNING l_imaf015,l_imaf061,l_imaf113,l_imaf055
      
    #[T:料件據點進銷存檔].[C:批號控管]=1或3時才可輸入
    IF l_imaf061 NOT MATCHES '[13]' THEN
       LET g_xmdk2_d[l_ac].xmdl016_02 = ' '
       CALL cl_set_comp_entry("xmdl016_02",FALSE)
    END IF      
    #[T:料件據點進銷存檔]未設參考單位，參考數量不允許輸入
    IF cl_null(l_imaf015) THEN
       CALL cl_set_comp_entry("xmdl020_02",FALSE)
    END IF
    #[T:料件據點進銷存檔]未設計價單位，計價數量不允許輸入
    IF cl_null(l_imaf113) THEN
       CALL cl_set_comp_entry("xmdl022_02",FALSE)
    END IF    

    IF l_imaf055 = '2' THEN
       CALL cl_set_comp_entry("xmdl052_02",FALSE)
    END IF
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_xmdl018_chk" order="13" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION axmp540_02_xmdl018_chk()
  DEFINE r_success       LIKE type_t.num5
  DEFINE l_xmdl018       LIKE xmdl_t.xmdl018   #待出貨數量
  DEFINE l_ship          LIKE xmdl_t.xmdl018   #未出貨數量

  WHENEVER ERROR CONTINUE
  LET r_success = TRUE
  
  LET l_xmdl018 = 0     #待出貨數量
  LET l_ship = 0        #未出貨數量
  IF g_xmdk2_d[l_ac].source_02 = '2' THEN             #來源為出通單
     CALL s_axmt540_get_max_ship_qty('1','','',g_xmdk2_d[l_ac].xmdl001_02,g_xmdk2_d[l_ac].xmdl002_02,'','')
        RETURNING l_ship,l_xmdl018     
  ELSE                                                                                            #來源為訂單
     CALL s_axmt540_get_max_ship_qty('2','','',g_xmdk2_d[l_ac].xmdl003_02,g_xmdk2_d[l_ac].xmdl004_02,g_xmdk2_d[l_ac].xmdl005_02,g_xmdk2_d[l_ac].xmdl006_02)
       RETURNING l_ship,l_xmdl018    
  END IF
  IF cl_null(l_xmdl018) THEN LET l_xmdl018 = 0 END IF
  IF g_xmdk2_d[l_ac].xmdl018_02 > l_xmdl018 THEN
     INITIALIZE g_errparam TO NULL
     LET g_errparam.code = 'axm-00364'
     LET g_errparam.extend = g_xmdk2_d[l_ac].xmdl018_02 USING '<<<<<<<<<<','>',l_xmdl018 USING '<<<<<<<<<<'
     LET g_errparam.popup = TRUE
     CALL cl_err()

     LET r_success = FALSE  
  END IF
  
  RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_get_amount" order="14" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 取得未稅金額、含稅金額、稅額
# Memo...........: 
# Usage..........: CALL axmp540_02_get_amount(p_linkno,p_xmdl022,p_xmdl024,p_xmdl025)
# Input parameter:  p_linkno                       
#                :  p_xmdl022    計價數量
#                :  p_xmdl024    單價
#                :  p_xmdl025    稅別
# Return code....:  r_xmdl027    未稅金額 
#                :  r_xmdl028    含稅金額
#                :  r_xmdl029    稅額
# Date & Author..: 2014/06/30 By Polly
# Modify.........:
################################################################################
PRIVATE FUNCTION axmp540_02_get_amount(p_linkno,p_xmdl022,p_xmdl024,p_xmdl025)
DEFINE p_linkno          LIKE type_t.num10      #暫時單號
DEFINE p_xmdl022         LIKE xmdl_t.xmdl022
DEFINE p_xmdl024         LIKE xmdl_t.xmdl024
DEFINE p_xmdl025         LIKE xmdl_t.xmdl025
DEFINE r_xmdl027         LIKE xmdl_t.xmdl027
DEFINE r_xmdl028         LIKE xmdl_t.xmdl028
DEFINE r_xmdl029         LIKE xmdl_t.xmdl029
DEFINE l_money           LIKE xrcd_t.xrcd113
DEFINE l_xmdk016         LIKE xmdk_t.xmdk016    #幣別
DEFINE l_xmdk017         LIKE xmdk_t.xmdk017    #匯率
DEFINE l_xrcd113         LIKE xrcd_t.xrcd113
DEFINE l_xrcd114         LIKE xrcd_t.xrcd114
DEFINE l_xrcd115         LIKE xrcd_t.xrcd115

   LET r_xmdl027 = 0
   LET r_xmdl028 = 0
   LET r_xmdl029 = 0
   
   IF cl_null(p_linkno) OR cl_null(p_xmdl022) OR cl_null(p_xmdl024) OR cl_null(p_xmdl025) THEN
      RETURN r_xmdl027,r_xmdl028,r_xmdl029
   END IF   
      
   #抓取幣別、匯率
   SELECT xmdk016,xmdk017 INTO l_xmdk016,l_xmdk017
     FROM p540_02_xmdk_temp
    WHERE linkno = p_linkno
    
   LET l_money = p_xmdl022 * p_xmdl024
   
   CALL s_tax_count(g_site,p_xmdl025,l_money,p_xmdl022,l_xmdk016,l_xmdk017)
     RETURNING r_xmdl027,r_xmdl029,r_xmdl028,l_xrcd113,l_xrcd114,l_xrcd115

   IF cl_null(r_xmdl027) THEN LET r_xmdl027 = 0 END IF
   IF cl_null(r_xmdl028) THEN LET r_xmdl028 = 0 END IF
   IF cl_null(r_xmdl029) THEN LET r_xmdl029 = 0 END IF  

   RETURN r_xmdl027,r_xmdl028,r_xmdl029
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_set_required_b" order="15" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION axmp540_02_set_required_b()
DEFINE l_imaf015   LIKE imaf_t.imaf015
DEFINE l_imaf061   LIKE imaf_t.imaf061
DEFINE l_imaf113   LIKE imaf_t.imaf113
DEFINE l_imaf055   LIKE imaf_t.imaf055

   CALL axmp540_01_get_imaf(g_xmdk2_d[l_ac].xmdl008_02)     
      RETURNING l_imaf015,l_imaf061,l_imaf113,l_imaf055
   IF l_imaf055 = '1' THEN
      CALL cl_set_comp_required("xmdl052_02",TRUE)
   END IF
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_set_no_required_b" order="16" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION axmp540_02_set_no_required_b()
   CALL cl_set_comp_required("xmdl052_02",FALSE)
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_fetch_xmdm" order="17" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
PRIVATE FUNCTION axmp540_02_fetch_xmdm()
DEFINE l_sql     STRING
DEFINE l_ac_t    LIKE type_t.num5
  
   INITIALIZE g_xmdk3_d TO NULL
   LET l_sql = "SELECT xmdmseq,xmdmseq1, ",
               "       xmdm001,xmdm002,xmdm003,xmdm004,xmdm005, ",
               "       xmdm006,xmdm007,xmdm008,xmdm009,xmdm010, ",
               "       xmdm011,xmdm033 ",
               "  FROM p540_02_xmdm_temp ",
               " WHERE linkno = '",g_xmdk_d[g_detail_02_idx].linkno,"'",
               " ORDER BY xmdmseq,xmdmseq1 "
   PREPARE axmp540_sel_xmdm_pr FROM l_sql
   DECLARE axmp540_sel_xmdm_cs CURSOR FOR axmp540_sel_xmdm_pr
   LET l_ac_t = l_ac
   LET l_ac = 1
    
   CALL g_xmdk3_d.clear()
   FOREACH axmp540_sel_xmdm_cs INTO g_xmdk3_d[l_ac].xmdmseq_03,g_xmdk3_d[l_ac].xmdmseq1_03,
                                    g_xmdk3_d[l_ac].xmdm001_03,g_xmdk3_d[l_ac].xmdm002_03,g_xmdk3_d[l_ac].xmdm003_03,g_xmdk3_d[l_ac].xmdm004_03,g_xmdk3_d[l_ac].xmdm005_03,
                                    g_xmdk3_d[l_ac].xmdm006_03,g_xmdk3_d[l_ac].xmdm007_03,g_xmdk3_d[l_ac].xmdm008_03,g_xmdk3_d[l_ac].xmdm009_03,g_xmdk3_d[l_ac].xmdm010_03,
                                    g_xmdk3_d[l_ac].xmdm011_03,g_xmdk3_d[l_ac].xmdm033_03
      CALL axmp540_02_detail_show("'3'")   
      
      LET l_ac = l_ac + 1
   END FOREACH
   CALL g_xmdk3_d.deleteElement(l_ac)
   LET l_ac = l_ac_t
   LET g_detail3_02_cnt = l_ac - 1
   CLOSE axmp540_sel_xmdm_cs
   FREE axmp540_sel_xmdm_pr
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_check_field" order="18" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 完成時，檢查欄位是否都有輸入
# Memo...........:
# Usage..........: CALL axmp540_02_check_field()
#                  RETURNING r_success
# Input parameter: 
# Return code....: r_success      TRUE/FALSE
# Date & Author..: 2014/10/24 By stellar
# Modify.........:
################################################################################
PUBLIC FUNCTION axmp540_02_check_field()
DEFINE r_success        LIKE type_t.num5
DEFINE l_xmdl_d         type_g_xmdk2_d
DEFINE l_xmdm009        LIKE xmdm_t.xmdm009
DEFINE l_n              LIKE type_t.num5

   LET r_success = TRUE
   
   #先更新目前筆的資料
   UPDATE p540_02_xmdl_temp
      SET xmdl018 = g_xmdk2_d[l_ac].xmdl018_02,
          xmdl020 = g_xmdk2_d[l_ac].xmdl020_02,
          xmdl022 = g_xmdk2_d[l_ac].xmdl022_02,
          xmdl013 = g_xmdk2_d[l_ac].xmdl013_02,
          xmdl014 = g_xmdk2_d[l_ac].xmdl014_02,
          xmdl015 = g_xmdk2_d[l_ac].xmdl015_02,
          xmdl016 = g_xmdk2_d[l_ac].xmdl016_02 
    WHERE linkno =  g_xmdk2_d[l_ac].linkno_02
      AND xmdlseq = g_xmdk2_d[l_ac].xmdlseq_02                  

   CALL axmp540_03_xmdm_modify('1',g_xmdk2_d[l_ac].xmdlseq_02,g_site,g_xmdk2_d[l_ac].linkno_02,g_xmdk2_d[l_ac].xmdlseq_02,
                               g_xmdk2_d[l_ac].xmdl008_02,g_xmdk2_d[l_ac].xmdl009_02,g_xmdk2_d[l_ac].xmdl011_02,g_xmdk2_d[l_ac].xmdl012_02,
                               g_xmdk2_d[l_ac].xmdl014_02,g_xmdk2_d[l_ac].xmdl015_02,g_xmdk2_d[l_ac].xmdl016_02,g_xmdk2_d[l_ac].xmdl052_02,
                               g_xmdk2_d[l_ac].xmdl017_02,g_xmdk2_d[l_ac].xmdl018_02,g_xmdk2_d[l_ac].xmdl019_02,g_xmdk2_d[l_ac].xmdl020_02,
                               '','') RETURNING r_success
   IF NOT r_success THEN
      RETURN r_success
   END IF
   
   CALL cl_err_collect_init()
   
   DECLARE axmp540_02_check_field_cs CURSOR FOR
    SELECT linkno,xmdlseq,xmdl013,xmdl014,xmdl018,xmdl020,xmdl022
      FROM p540_02_xmdl_temp
     ORDER BY linkno,xmdlseq
   
   FOREACH axmp540_02_check_field_cs INTO l_xmdl_d.linkno_02,l_xmdl_d.xmdlseq_02,l_xmdl_d.xmdl013_02,l_xmdl_d.xmdl014_02,
                                          l_xmdl_d.xmdl018_02,l_xmdl_d.xmdl020_02,l_xmdl_d.xmdl022_02
      #庫位
      IF l_xmdl_d.xmdl013_02 = 'Y' THEN
         LET l_n = 0
         SELECT COUNT(*) INTO l_n 
           FROM p540_02_xmdm_temp
          WHERE linkno = l_xmdl_d.linkno_02
            AND xmdmseq = l_xmdl_d.xmdlseq_02
         IF cl_null(l_n) OR l_n <= 0 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'axm-00493'
            LET g_errparam.extend = l_xmdl_d.xmdlseq_02
            LET g_errparam.popup = TRUE
            CALL cl_err()
            
            LET r_success = FALSE
            CONTINUE FOREACH
         END IF
      ELSE
         IF cl_null(l_xmdl_d.xmdl014_02) THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'sub-00126'
            LET g_errparam.extend = l_xmdl_d.xmdlseq_02
            LET g_errparam.popup = TRUE
            CALL cl_err()
            
            LET r_success = FALSE
            CONTINUE FOREACH
         END IF
      END IF
      
      #數量
      IF cl_null(l_xmdl_d.xmdl018_02) THEN
         INITIALIZE g_errparam TO NULL
         LET g_errparam.code = 'axm-00200'
         LET g_errparam.extend = l_xmdl_d.xmdlseq_02
         LET g_errparam.popup = TRUE
         CALL cl_err()
         
         LET r_success = FALSE
         CONTINUE FOREACH
      ELSE
         LET l_xmdm009 = 0
         SELECT SUM(xmdm009) INTO l_xmdm009 
           FROM p540_02_xmdm_temp
          WHERE linkno = l_xmdl_d.linkno_02
            AND xmdmseq = l_xmdl_d.xmdlseq_02
         IF cl_null(l_xmdm009) THEN LET l_xmdm009 = 0 END IF
         
         IF l_xmdl_d.xmdl018_02 <> l_xmdm009 THEN
            INITIALIZE g_errparam TO NULL
            LET g_errparam.code = 'axm-00492'
            LET g_errparam.extend = l_xmdl_d.xmdlseq_02
            LET g_errparam.popup = TRUE
            CALL cl_err()
            
            LET r_success = FALSE
            CONTINUE FOREACH
         END IF
      END IF
      
   END FOREACH
   
   CALL cl_err_collect_show()
   RETURN r_success
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_ins_xmdm" order="19" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL axmp540_02_ins_xmdm(p_no,p_xmdkdocno)
#                  
# Input parameter: p_no           暫存檔之key
#                : p_xmdkdocno    出貨單單號
# Return code....: 
# Date & Author..: 2014/10/24 By stellar
# Modify.........:
################################################################################
PRIVATE FUNCTION axmp540_02_ins_xmdm(p_no,p_xmdkdocno)
   DEFINE p_no         LIKE type_t.num10
   DEFINE p_xmdkdocno  LIKE xmdk_t.xmdkdocno
   DEFINE l_sql        STRING
   DEFINE l_xmdm       RECORD LIKE xmdm_t.*

   IF cl_null(p_no) OR cl_null(p_xmdkdocno) THEN
      RETURN 
   END IF

   LET l_sql = " SELECT xmdmseq,xmdmseq1, ",
               "        xmdm001,xmdm002,xmdm003,xmdm004,xmdm005, ",
               "        xmdm006,xmdm007,xmdm008,xmdm009,xmdm010, ",
               "        xmdm011,xmdm012,xmdm013,xmdm014, ",
               "        xmdm031,xmdm032,xmdm033 ",
               "   FROM p540_02_xmdm_temp ",
               "  WHERE linkno = ",p_no,
               "  ORDER BY xmdmseq,xmdmseq1 "          
   PREPARE p540_02_xmdm_pr FROM l_sql
   DECLARE p540_02_xmdm_cs CURSOR FOR p540_02_xmdm_pr
   
   FOREACH p540_02_xmdm_cs INTO l_xmdm.xmdmseq,l_xmdm.xmdmseq1,
                                l_xmdm.xmdm001,l_xmdm.xmdm002,l_xmdm.xmdm003,l_xmdm.xmdm004,l_xmdm.xmdm005,
                                l_xmdm.xmdm006,l_xmdm.xmdm007,l_xmdm.xmdm008,l_xmdm.xmdm009,l_xmdm.xmdm010,
                                l_xmdm.xmdm011,l_xmdm.xmdm012,l_xmdm.xmdm013,l_xmdm.xmdm014,
                                l_xmdm.xmdm031,l_xmdm.xmdm032,l_xmdm.xmdm033
      LET l_xmdm.xmdment = g_enterprise
      LET l_xmdm.xmdmsite = g_site
      LET l_xmdm.xmdmdocno = p_xmdkdocno

      INSERT INTO xmdm_t(xmdment,xmdmsite,xmdmdocno,xmdmseq,xmdmseq1,
                         xmdm001,xmdm002,xmdm003,xmdm004,xmdm005,
                         xmdm006,xmdm007,xmdm008,xmdm009,xmdm010,
                         xmdm011,xmdm012,xmdm013,xmdm014,
                         xmdm031,xmdm032,xmdm033)
         VALUES(l_xmdm.xmdment,l_xmdm.xmdmsite,l_xmdm.xmdmdocno,l_xmdm.xmdmseq,l_xmdm.xmdmseq1,
                l_xmdm.xmdm001,l_xmdm.xmdm002,l_xmdm.xmdm003,l_xmdm.xmdm004,l_xmdm.xmdm005,
                l_xmdm.xmdm006,l_xmdm.xmdm007,l_xmdm.xmdm008,l_xmdm.xmdm009,l_xmdm.xmdm010,
                l_xmdm.xmdm011,l_xmdm.xmdm012,l_xmdm.xmdm013,l_xmdm.xmdm014,
                l_xmdm.xmdm031,l_xmdm.xmdm032,l_xmdm.xmdm033) 
      IF SQLCA.sqlcode THEN
         LET g_result_str = g_result_str,",INSERT INTO xmdl_t",cl_getmsg(SQLCA.sqlcode,g_lang)
         LET g_success = 'N'         
         EXIT FOREACH
      END IF   
   END FOREACH
END FUNCTION]]>
  </point>
  <point name="function.axmp540_02_open_axmt540" order="20" ver="3" cite_std="N" new="Y" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
################################################################################
# Descriptions...: 自動帶所有此次產生的出貨單資料
# Memo...........:
# Usage..........: CALL axmp540_02_open_axmt540()
#                  
# Input parameter: 
# Return code....: 
# Date & Author..: 20150115 By Polly
# Modify.........:
################################################################################
PUBLIC FUNCTION axmp540_02_open_axmt540()
   DEFINE la_param  RECORD
                       prog   STRING,
                       param  DYNAMIC ARRAY OF STRING
                    END RECORD
   DEFINE i         LIKE type_t.num5
   DEFINE ls_js     STRING
   DEFINE l_str     STRING
   
   LET l_str = ''

   FOR i = 1 TO g_xmdk_d.getLength()
       IF cl_null(l_str) THEN
          LET l_str = g_xmdk_d[i].docno,"','"
       ELSE
          LET l_str = l_str,g_xmdk_d[i].docno,"','"
       END IF
   END FOR

   LET l_str = l_str.subString(1,l_str.getLength()-3)

   IF NOT cl_null(l_str) THEN
      LET la_param.prog = 'axmt540'
      LET la_param.param[1] = l_str
      LET ls_js = util.JSON.stringify( la_param )
      CALL cl_cmdrun(ls_js)
   END IF


END FUNCTION]]>
  </point>
  <point name="free_style.variable" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[ TYPE type_g_xmdk_d        RECORD
   linkno       LIKE type_t.num10,         
   docno        LIKE xmdk_t.xmdkdocno,
   source       LIKE type_t.chr10,         #來源單據1訂單2出貨通知單
   xmdk002      LIKE xmdk_t.xmdk002, 
   xmdk007      LIKE xmdk_t.xmdk007, 
   xmdk007_desc LIKE type_t.chr500, 
   xmdk010      LIKE xmdk_t.xmdk010, 
   xmdk010_desc LIKE type_t.chr500, 
   xmdk011      LIKE xmdk_t.xmdk011, 
   xmdk011_desc LIKE type_t.chr500, 
   xmdk012      LIKE xmdk_t.xmdk012, 
   xmdk012_desc LIKE type_t.chr500, 
   xmdk013      LIKE xmdk_t.xmdk013, 
   xmdk014      LIKE xmdk_t.xmdk014, 
   xmdk015      LIKE xmdk_t.xmdk015,
   xmdk016      LIKE xmdk_t.xmdk016, 
   xmdk016_desc LIKE type_t.chr500, 
   xmdk017      LIKE xmdk_t.xmdk017, 
   xmdk008      LIKE xmdk_t.xmdk008,
   xmdk009      LIKE xmdk_t.xmdk009,
   result       LIKE type_t.chr500 
       END RECORD
 TYPE type_g_xmdk2_d RECORD
   linkno_02       LIKE type_t.num10, 
   source_02       LIKE type_t.chr10,         #來源單據1訂單2出貨通知單
   docno_02        LIKE xmdl_t.xmdldocno,
   xmdlseq_02      LIKE xmdl_t.xmdlseq, 
   xmdl001_02      LIKE xmdl_t.xmdl001, 
   xmdl002_02      LIKE xmdl_t.xmdl002, 
   xmdl003_02      LIKE xmdl_t.xmdl003, 
   xmdl004_02      LIKE xmdl_t.xmdl004, 
   xmdl005_02      LIKE xmdl_t.xmdl005, 
   xmdl006_02      LIKE xmdl_t.xmdl006, 
   xmdl007_02      LIKE xmdl_t.xmdl007, 
   xmdl008_02      LIKE xmdl_t.xmdl008, 
   xmdl008_02_desc LIKE type_t.chr500,
   imaal004_02     LIKE imaal_t.imaal004, 
   xmdl009_02      LIKE xmdl_t.xmdl009, 
   xmdl009_02_desc LIKE type_t.chr500,
   xmdl011_02      LIKE xmdl_t.xmdl011, 
   xmdl011_02_desc LIKE type_t.chr500, 
   xmdl012_02      LIKE xmdl_t.xmdl012, 
   xmdl017_02      LIKE xmdl_t.xmdl017, 
   xmdl017_02_desc LIKE type_t.chr500, 
   xmdl018_02      LIKE xmdl_t.xmdl018, 
   xmdl019_02      LIKE xmdl_t.xmdl019, 
   xmdl019_02_desc LIKE type_t.chr500, 
   xmdl020_02      LIKE xmdl_t.xmdl020, 
   xmdl013_02      LIKE xmdl_t.xmdl013, 
   xmdl014_02      LIKE xmdl_t.xmdl014, 
   xmdl014_02_desc LIKE type_t.chr500, 
   xmdl015_02      LIKE xmdl_t.xmdl015, 
   xmdl015_02_desc LIKE type_t.chr500, 
   xmdl016_02      LIKE xmdl_t.xmdl016, 
   xmdl052_02      LIKE xmdl_t.xmdl052,
   xmdl021_02      LIKE xmdl_t.xmdl021, 
   xmdl021_02_desc LIKE type_t.chr500, 
   xmdl022_02      LIKE xmdl_t.xmdl022, 
   xmdl023_02      LIKE xmdl_t.xmdl023
       END RECORD
 TYPE type_g_xmdk3_d RECORD
   xmdmseq_03 LIKE xmdm_t.xmdmseq, 
   xmdmseq1_03 LIKE xmdm_t.xmdmseq1, 
   xmdm001_03 LIKE xmdm_t.xmdm001, 
   xmdm001_03_desc LIKE type_t.chr500, 
   imaal004_03  LIKE imaal_t.imaal004,
   xmdm002_03 LIKE xmdm_t.xmdm002, 
   xmdm002_03_desc LIKE type_t.chr500,
   xmdm003_03 LIKE xmdm_t.xmdm003, 
   xmdm003_03_desc LIKE type_t.chr500,
   xmdm004_03 LIKE xmdm_t.xmdm004, 
   xmdm005_03 LIKE xmdm_t.xmdm005, 
   xmdm005_03_desc LIKE type_t.chr500, 
   xmdm006_03 LIKE xmdm_t.xmdm006, 
   xmdm006_03_desc LIKE type_t.chr500, 
   xmdm007_03 LIKE xmdm_t.xmdm007, 
   xmdm033_03 LIKE xmdm_t.xmdm033,
   xmdm008_03 LIKE xmdm_t.xmdm008, 
   xmdm008_03_desc LIKE type_t.chr500, 
   xmdm009_03 LIKE xmdm_t.xmdm009, 
   xmdm010_03 LIKE xmdm_t.xmdm010, 
   xmdm010_03_desc LIKE type_t.chr500, 
   xmdm011_03 LIKE xmdm_t.xmdm011
       END RECORD
 TYPE type_g_xmdk4_d RECORD
   xmdlseq_04 LIKE xmdl_t.xmdlseq,  
   xmdl007_04 LIKE xmdl_t.xmdl007, 
   xmdl008_04 LIKE xmdl_t.xmdl008, 
   xmdl008_04_desc LIKE type_t.chr500,
   imaal004_04  LIKE imaal_t.imaal004,
   xmdl009_04 LIKE xmdl_t.xmdl009,
   xmdl009_04_desc LIKE type_t.chr500,
   xmdl011_04 LIKE xmdl_t.xmdl011, 
   xmdl011_04_desc LIKE type_t.chr500, 
   xmdl012_04 LIKE xmdl_t.xmdl012, 
   xmdl017_04 LIKE xmdl_t.xmdl017, 
   xmdl017_04_desc LIKE type_t.chr500, 
   xmdl018_04 LIKE xmdl_t.xmdl018, 
   xmdl021_04 LIKE xmdl_t.xmdl021, 
   xmdl021_04_desc LIKE type_t.chr500, 
   xmdl022_04 LIKE xmdl_t.xmdl022,        
   xmdl024_04 LIKE xmdl_t.xmdl024, 
   xmdl025_04 LIKE xmdl_t.xmdl025, 
   xmdl025_04_desc LIKE type_t.chr500, 
   xmdl026_04 LIKE xmdl_t.xmdl026, 
   xmdl027_04 LIKE xmdl_t.xmdl027, 
   xmdl028_04 LIKE xmdl_t.xmdl028, 
   xmdl029_04 LIKE xmdl_t.xmdl029, 
   xmdl042_04 LIKE xmdl_t.xmdl042, 
   xmdl043_04 LIKE xmdl_t.xmdl043, 
   xmdl044_04 LIKE xmdl_t.xmdl044, 
   xmdl045_04 LIKE xmdl_t.xmdl045, 
   xmdl046_04 LIKE xmdl_t.xmdl046
       END RECORD
 TYPE type_g_xmdl_d  RECORD
   xmdlent LIKE xmdl_t.xmdlent,
   xmdlsite LIKE xmdl_t.xmdlsite,
   xmdldocno LIKE xmdl_t.xmdldocno,
   xmdlseq LIKE xmdl_t.xmdlseq,
   xmdl001 LIKE xmdl_t.xmdl001,
   xmdl002 LIKE xmdl_t.xmdl002,
   xmdl003 LIKE xmdl_t.xmdl003,
   xmdl004 LIKE xmdl_t.xmdl004,
   xmdl005 LIKE xmdl_t.xmdl005,
   xmdl006 LIKE xmdl_t.xmdl006,
   xmdl007 LIKE xmdl_t.xmdl007,
   xmdl008 LIKE xmdl_t.xmdl008,
   xmdl009 LIKE xmdl_t.xmdl009,
   xmdl010 LIKE xmdl_t.xmdl010,
   xmdl011 LIKE xmdl_t.xmdl011,
   xmdl012 LIKE xmdl_t.xmdl012,
   xmdl013 LIKE xmdl_t.xmdl013,
   xmdl014 LIKE xmdl_t.xmdl014,
   xmdl015 LIKE xmdl_t.xmdl015,
   xmdl016 LIKE xmdl_t.xmdl016,
   xmdl017 LIKE xmdl_t.xmdl017,
   xmdl018 LIKE xmdl_t.xmdl018,
   xmdl019 LIKE xmdl_t.xmdl019,
   xmdl020 LIKE xmdl_t.xmdl020,
   xmdl021 LIKE xmdl_t.xmdl021,
   xmdl022 LIKE xmdl_t.xmdl022,
   xmdl023 LIKE xmdl_t.xmdl023,
   xmdl024 LIKE xmdl_t.xmdl024,
   xmdl025 LIKE xmdl_t.xmdl025,
   xmdl026 LIKE xmdl_t.xmdl026,
   xmdl027 LIKE xmdl_t.xmdl027,
   xmdl028 LIKE xmdl_t.xmdl028,
   xmdl029 LIKE xmdl_t.xmdl029,
   xmdl030 LIKE xmdl_t.xmdl030,
   xmdl031 LIKE xmdl_t.xmdl031,
   xmdl032 LIKE xmdl_t.xmdl032,
   xmdl033 LIKE xmdl_t.xmdl033,
   xmdl034 LIKE xmdl_t.xmdl034, 
   xmdl035 LIKE xmdl_t.xmdl035,
   xmdl036 LIKE xmdl_t.xmdl036,
   xmdl037 LIKE xmdl_t.xmdl037,
   xmdl038 LIKE xmdl_t.xmdl038,
   xmdl039 LIKE xmdl_t.xmdl039,
   xmdl040 LIKE xmdl_t.xmdl040,
   xmdl041 LIKE xmdl_t.xmdl041,
   xmdl042 LIKE xmdl_t.xmdl042,
   xmdl043 LIKE xmdl_t.xmdl043,
   xmdl044 LIKE xmdl_t.xmdl044,
   xmdl045 LIKE xmdl_t.xmdl045,
   xmdl046 LIKE xmdl_t.xmdl046,
   xmdl047 LIKE xmdl_t.xmdl047,
   xmdl048 LIKE xmdl_t.xmdl048,
   xmdl049 LIKE xmdl_t.xmdl049,
   xmdl050 LIKE xmdl_t.xmdl050,
   xmdl051 LIKE xmdl_t.xmdl051,
   xmdl052 LIKE xmdl_t.xmdl052,
   xmdl087 LIKE xmdl_t.xmdl087,
   xmdl088 LIKE xmdl_t.xmdl088 
       END RECORD  
DEFINE l_ac        LIKE type_t.num5 
DEFINE g_xmdk_d    DYNAMIC ARRAY OF type_g_xmdk_d
DEFINE g_xmdk_d_t  type_g_xmdk_d
DEFINE g_xmdk2_d   DYNAMIC ARRAY OF type_g_xmdk2_d
DEFINE g_xmdk2_d_t type_g_xmdk2_d
DEFINE g_xmdk2_d_o type_g_xmdk2_d
DEFINE g_xmdk3_d   DYNAMIC ARRAY OF type_g_xmdk3_d
DEFINE g_xmdk3_d_t type_g_xmdk3_d
DEFINE g_xmdk4_d   DYNAMIC ARRAY OF type_g_xmdk4_d
DEFINE g_xmdk4_d_t type_g_xmdk4_d
DEFINE g_result_str LIKE type_t.chr1000        #執行結果
DEFINE g_gather     LIKE type_t.chr1]]>
  </point>
  <point name="global.inc" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[GLOBALS "../../axm/4gl/axmp540_01.inc"
GLOBALS "../../axm/4gl/axmp540_02.inc"]]>
  </point>
  <point name="global.variable" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[]]>
  </point>
  <point name="input.a.page1.xmdk007" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk_d[l_ac].xmdk007) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_pmaa001_3") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk007
            CALL ap_ref_array2(g_ref_fields,"SELECT pmaal003 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk007_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk007_desc

]]>
  </point>
  <point name="input.a.page1.xmdk010" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk_d[l_ac].xmdk010) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_pmad002_2") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk010
            CALL ap_ref_array2(g_ref_fields,"SELECT ooibl004 FROM ooibl_t WHERE ooiblent='"||g_enterprise||"' AND ooibl002=? AND ooibl003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk010_desc

]]>
  </point>
  <point name="input.a.page1.xmdk011" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk_d[l_ac].xmdk011) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_oocq002_238") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk011
            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='238' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk011_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk011_desc

]]>
  </point>
  <point name="input.a.page1.xmdk012" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk_d[l_ac].xmdk012) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_oodb002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk012
            CALL ap_ref_array2(g_ref_fields,"SELECT oodbl004 FROM oodbl_t WHERE oodblent='"||g_enterprise||"' AND oodbl002=? AND oodbl003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk012_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk012_desc

]]>
  </point>
  <point name="input.a.page1.xmdk013" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk_d[l_ac].xmdk013) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page1.xmdk016" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk_d[l_ac].xmdk016) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_ooaj002") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk016
            CALL ap_ref_array2(g_ref_fields,"SELECT ooail003 FROM ooail_t WHERE ooailent='"||g_enterprise||"' AND ooail001=? AND ooail002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk016_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk016_desc

]]>
  </point>
  <point name="input.a.page1.xmdk018" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk_d[l_ac].xmdk018) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_pmam001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk018
            CALL ap_ref_array2(g_ref_fields,"SELECT xmahl003 FROM xmahl_t WHERE xmahlent='"||g_enterprise||"' AND xmahl001=? AND xmahl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk018_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk018_desc

]]>
  </point>
  <point name="input.a.page1.xmdkdocno" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdkdocno
            CALL ap_ref_array2(g_ref_fields,"SELECT oobal004 FROM oobal_t WHERE oobalent='"||g_enterprise||"' AND oobal002=? AND oobal003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdkdocno_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdkdocno_desc


            #此段落由子樣板a05產生
            IF  g_xmdk_d[g_detail_idx].xmdkdocno IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xmdk_d[g_detail_idx].xmdkdocno != g_xmdk_d_t.xmdkdocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xmdk_t WHERE "||"xmdkent = '" ||g_enterprise|| "' AND "||"xmdkdocno = '"||g_xmdk_d[g_detail_idx].xmdkdocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page2.xmdkdocno" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  g_xmdk2_d[g_detail_idx].xmdkdocno IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xmdk2_d[g_detail_idx].xmdkdocno != g_xmdk2_d_t.xmdkdocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xmdl_t WHERE "||"xmdlent = '" ||g_enterprise|| "' AND "||"xmdkdocno = '"||g_xmdk2_d[g_detail_idx].xmdkdocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page2.xmdl001" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl001) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_xmdgdocno") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl002" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl002) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_xmdhseq") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl003" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl003) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_xmdadocno_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl004" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl004) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = 
               LET g_chkparam.arg4 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_xmddseq2") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl005" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl005) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = 
               LET g_chkparam.arg4 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_xmddseq2") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl006" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl006) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = 
               LET g_chkparam.arg4 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_xmddseq2") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl008" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl008) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_imaa001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl008
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl008_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl008_desc

]]>
  </point>
  <point name="input.a.page2.xmdl011" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl011) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_oocq002_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl011
            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='221' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl011_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl011_desc

]]>
  </point>
  <point name="input.a.page2.xmdl014" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl014) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = 
               LET g_chkparam.arg4 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_inag004_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdlsite
            LET g_ref_fields[2] = g_xmdk2_d[l_ac].xmdl014
            CALL ap_ref_array2(g_ref_fields,"SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaasite=? AND inaa001=? ","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl014_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl014_desc

]]>
  </point>
  <point name="input.a.page2.xmdl015" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl015) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = 
               LET g_chkparam.arg4 = 
               LET g_chkparam.arg5 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_inag005_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdlsite
            LET g_ref_fields[2] = g_xmdk2_d[l_ac].xmdl014
            LET g_ref_fields[3] = g_xmdk2_d[l_ac].xmdl015
            CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inabsite=? AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl015_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl015_desc

]]>
  </point>
  <point name="input.a.page2.xmdl016" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl016) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = 
               LET g_chkparam.arg4 = 
               LET g_chkparam.arg5 = 
               LET g_chkparam.arg6 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_inag006_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl017" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl017) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_ooca001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl017
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl017_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl017_desc

]]>
  </point>
  <point name="input.a.page2.xmdl018" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl018) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl019" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl019) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_ooca001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl019
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl019_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl019_desc

]]>
  </point>
  <point name="input.a.page2.xmdl020" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl020) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdl021" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl021) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數

                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_ooca001") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl021
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl021_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl021_desc

]]>
  </point>
  <point name="input.a.page2.xmdl022" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdl022) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page2.xmdlseq" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk2_d[l_ac].xmdlseq) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page3.xmdkdocno" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  g_xmdk3_d[g_detail_idx].xmdkdocno IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xmdk3_d[g_detail_idx].xmdkdocno != g_xmdk3_d_t.xmdkdocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xmdm_t WHERE "||"xmdment = '" ||g_enterprise|| "' AND "||"xmdkdocno = '"||g_xmdk3_d[g_detail_idx].xmdkdocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page3.xmdm001" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdm_t.xmdm001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm001_desc

]]>
  </point>
  <point name="input.a.page3.xmdm005" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk3_d[l_ac].xmdm005) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = g_xmdk2_d[l_ac].imaal004
               LET g_chkparam.arg4 = 
               LET g_chkparam.arg5 = 
               LET g_chkparam.arg6 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_inag006_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdmsite
            LET g_ref_fields[2] = g_xmdk3_d[l_ac].xmdm005
            CALL ap_ref_array2(g_ref_fields,"SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaasite=? AND inaa001=? ","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm005_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm005_desc

]]>
  </point>
  <point name="input.a.page3.xmdm006" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk3_d[l_ac].xmdm006) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = g_xmdk2_d[l_ac].imaal004
               LET g_chkparam.arg4 = 
               LET g_chkparam.arg5 = 
               LET g_chkparam.arg6 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_inag006_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdmsite
            LET g_ref_fields[2] = g_xmdk3_d[l_ac].xmdm005
            LET g_ref_fields[3] = g_xmdk3_d[l_ac].xmdm006
            CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inabsite=? AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm006_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm006_desc

]]>
  </point>
  <point name="input.a.page3.xmdm007" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk3_d[l_ac].xmdm007) THEN 
#此段落由子樣板a19產生
               #設定g_chkparam.*的參數前，先將其初始化，避免之前設定遺留的參數值造成影響。
               INITIALIZE g_chkparam.* TO NULL
               
               #設定g_chkparam.*的參數
               LET g_chkparam.arg2 = '參數2'
               LET g_chkparam.arg3 = g_xmdk2_d[l_ac].imaal004
               LET g_chkparam.arg4 = 
               LET g_chkparam.arg5 = 
               LET g_chkparam.arg6 = 
                  
               #呼叫檢查存在並帶值的library
               IF cl_chk_exist_and_ref_val("v_inag006_1") THEN
                  #檢查成功時後續處理
                  #LET  = g_chkparam.return1
                  #DISPLAY BY NAME 
               ELSE
                  #檢查失敗時後續處理
                  NEXT FIELD CURRENT
               END IF
            

            END IF 

]]>
  </point>
  <point name="input.a.page3.xmdm008" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdm_t.xmdm008
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm008_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm008_desc

]]>
  </point>
  <point name="input.a.page3.xmdm009" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk3_d[l_ac].xmdm009) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page3.xmdm010" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdm_t.xmdm010
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm010_desc

]]>
  </point>
  <point name="input.a.page3.xmdm011" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk3_d[l_ac].xmdm011) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page3.xmdmseq" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk3_d[l_ac].xmdmseq) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page3.xmdmseq1" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk3_d[l_ac].xmdmseq1) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page4.xmdkdocno_4" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a05產生
            IF  g_xmdk4_d[g_detail_idx].xmdkdocno IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_xmdk4_d[g_detail_idx].xmdkdocno != g_xmdk4_d_t.xmdkdocno)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM xmdl_t WHERE "||"xmdlent = '" ||g_enterprise|| "' AND "||"xmdkdocno = '"||g_xmdk4_d[g_detail_idx].xmdkdocno ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
  </point>
  <point name="input.a.page4.xmdl024" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk4_d[l_ac].xmdl024) THEN 
            END IF 

]]>
  </point>
  <point name="input.a.page4.xmdl025" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk4_d[l_ac].xmdl_t.xmdl025
            CALL ap_ref_array2(g_ref_fields,"SELECT oodbl004 FROM oodbl_t WHERE oodblent='"||g_enterprise||"' AND oodbl002=? AND oodbl003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk4_d[l_ac].xmdl025_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk4_d[l_ac].xmdl025_desc

]]>
  </point>
  <point name="input.a.page4.xmdl026" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            IF NOT cl_null(g_xmdk4_d[l_ac].xmdl026) THEN 
            END IF 

]]>
  </point>
  <point name="input.c.page1.xmdk007" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk_d[l_ac].xmdk007             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_pmaa001_6()                                #呼叫開窗

            LET g_xmdk_d[l_ac].xmdk007 = g_qryparam.return1              

            DISPLAY g_xmdk_d[l_ac].xmdk007 TO xmdk007              #

            NEXT FIELD xmdk007                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.xmdk010" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk_d[l_ac].xmdk010             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_pmad002_3()                                #呼叫開窗

            LET g_xmdk_d[l_ac].xmdk010 = g_qryparam.return1              

            DISPLAY g_xmdk_d[l_ac].xmdk010 TO xmdk010              #

            NEXT FIELD xmdk010                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.xmdk011" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk_d[l_ac].xmdk011             #給予default值
            LET g_qryparam.default2 = "" #g_xmdk_d[l_ac].oocq002 #應用分類碼
            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_oocq002()                                #呼叫開窗

            LET g_xmdk_d[l_ac].xmdk011 = g_qryparam.return1              
            #LET g_xmdk_d[l_ac].oocq002 = g_qryparam.return2 
            DISPLAY g_xmdk_d[l_ac].xmdk011 TO xmdk011              #
            #DISPLAY g_xmdk_d[l_ac].oocq002 TO oocq002 #應用分類碼
            NEXT FIELD xmdk011                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.xmdk012" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk_d[l_ac].xmdk012             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_oodb002_2()                                #呼叫開窗

            LET g_xmdk_d[l_ac].xmdk012 = g_qryparam.return1              

            DISPLAY g_xmdk_d[l_ac].xmdk012 TO xmdk012              #

            NEXT FIELD xmdk012                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.xmdk016" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk_d[l_ac].xmdk016             #給予default值
            LET g_qryparam.default2 = "" #g_xmdk_d[l_ac].ooail003 #說明
            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_ooai001_1()                                #呼叫開窗

            LET g_xmdk_d[l_ac].xmdk016 = g_qryparam.return1              
            #LET g_xmdk_d[l_ac].ooail003 = g_qryparam.return2 
            DISPLAY g_xmdk_d[l_ac].xmdk016 TO xmdk016              #
            #DISPLAY g_xmdk_d[l_ac].ooail003 TO ooail003 #說明
            NEXT FIELD xmdk016                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.xmdk018" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk_d[l_ac].xmdk018             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_pmam001()                                #呼叫開窗

            LET g_xmdk_d[l_ac].xmdk018 = g_qryparam.return1              

            DISPLAY g_xmdk_d[l_ac].xmdk018 TO xmdk018              #

            NEXT FIELD xmdk018                          #返回原欄位

]]>
  </point>
  <point name="input.c.page1.xmdkdocno" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk_d[l_ac].xmdkdocno             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #
            LET g_qryparam.arg2 = "" #
            
            CALL q_ooba002_1()                                #呼叫開窗

            LET g_xmdk_d[l_ac].xmdkdocno = g_qryparam.return1              

            DISPLAY g_xmdk_d[l_ac].xmdkdocno TO xmdkdocno              #

            NEXT FIELD xmdkdocno                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl001" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl001             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_xmdgdocno()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl001 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl001 TO xmdl001              #

            NEXT FIELD xmdl001                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl003" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl003             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_xmdadocno_2()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl003 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl003 TO xmdl003              #

            NEXT FIELD xmdl003                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl008" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl008             #給予default值
            LET g_qryparam.default2 = "" #g_xmdk2_d[l_ac].imaal003 #品名
            LET g_qryparam.default3 = "" #g_xmdk2_d[l_ac].imaal004 #規格
            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_imaa001()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl008 = g_qryparam.return1              
            #LET g_xmdk2_d[l_ac].imaal003 = g_qryparam.return2 
            #LET g_xmdk2_d[l_ac].imaal004 = g_qryparam.return3 
            DISPLAY g_xmdk2_d[l_ac].xmdl008 TO xmdl008              #
            #DISPLAY g_xmdk2_d[l_ac].imaal003 TO imaal003 #品名
            #DISPLAY g_xmdk2_d[l_ac].imaal004 TO imaal004 #規格
            NEXT FIELD xmdl008                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl011" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl011             #給予default值
            LET g_qryparam.default2 = "" #g_xmdk2_d[l_ac].oocq002 #應用分類碼
            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_oocq002()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl011 = g_qryparam.return1              
            #LET g_xmdk2_d[l_ac].oocq002 = g_qryparam.return2 
            DISPLAY g_xmdk2_d[l_ac].xmdl011 TO xmdl011              #
            #DISPLAY g_xmdk2_d[l_ac].oocq002 TO oocq002 #應用分類碼
            NEXT FIELD xmdl011                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl014" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl014             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_inaa001_4()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl014 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl014 TO xmdl014              #

            NEXT FIELD xmdl014                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl015" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl015             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #
            LET g_qryparam.arg2 = "" #
            
            CALL q_inab002_8()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl015 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl015 TO xmdl015              #

            NEXT FIELD xmdl015                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl016" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl016             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_inag006()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl016 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl016 TO xmdl016              #

            NEXT FIELD xmdl016                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl017" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl017             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_ooca001_1()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl017 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl017 TO xmdl017              #

            NEXT FIELD xmdl017                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl019" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl019             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_ooca001_1()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl019 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl019 TO xmdl019              #

            NEXT FIELD xmdl019                          #返回原欄位

]]>
  </point>
  <point name="input.c.page2.xmdl021" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk2_d[l_ac].xmdl021             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_ooca001_1()                                #呼叫開窗

            LET g_xmdk2_d[l_ac].xmdl021 = g_qryparam.return1              

            DISPLAY g_xmdk2_d[l_ac].xmdl021 TO xmdl021              #

            NEXT FIELD xmdl021                          #返回原欄位

]]>
  </point>
  <point name="input.c.page3.xmdm005" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk3_d[l_ac].xmdm005             #給予default值
            LET g_qryparam.default2 = "" #g_xmdk3_d[l_ac].inag005 #儲位編號
            LET g_qryparam.default3 = "" #g_xmdk3_d[l_ac].inag006 #批號
            #給予arg
            LET g_qryparam.arg1 = "" #
            LET g_qryparam.arg2 = "" #
            
            CALL q_inag004_1()                                #呼叫開窗

            LET g_xmdk3_d[l_ac].xmdm005 = g_qryparam.return1              
            #LET g_xmdk3_d[l_ac].inag005 = g_qryparam.return2 
            #LET g_xmdk3_d[l_ac].inag006 = g_qryparam.return3 
            DISPLAY g_xmdk3_d[l_ac].xmdm005 TO xmdm005              #
            #DISPLAY g_xmdk3_d[l_ac].inag005 TO inag005 #儲位編號
            #DISPLAY g_xmdk3_d[l_ac].inag006 TO inag006 #批號
            NEXT FIELD xmdm005                          #返回原欄位

]]>
  </point>
  <point name="input.c.page3.xmdm006" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk3_d[l_ac].xmdm006             #給予default值
            LET g_qryparam.default2 = "" #g_xmdk3_d[l_ac].inag005 #儲位編號
            LET g_qryparam.default3 = "" #g_xmdk3_d[l_ac].inag006 #批號
            #給予arg
            LET g_qryparam.arg1 = "" #
            LET g_qryparam.arg2 = "" #
            
            CALL q_inag004_1()                                #呼叫開窗

            LET g_xmdk3_d[l_ac].xmdm006 = g_qryparam.return1              
            #LET g_xmdk3_d[l_ac].inag005 = g_qryparam.return2 
            #LET g_xmdk3_d[l_ac].inag006 = g_qryparam.return3 
            DISPLAY g_xmdk3_d[l_ac].xmdm006 TO xmdm006              #
            #DISPLAY g_xmdk3_d[l_ac].inag005 TO inag005 #儲位編號
            #DISPLAY g_xmdk3_d[l_ac].inag006 TO inag006 #批號
            NEXT FIELD xmdm006                          #返回原欄位

]]>
  </point>
  <point name="input.c.page3.xmdm007" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk3_d[l_ac].xmdm007             #給予default值
            LET g_qryparam.default2 = "" #g_xmdk3_d[l_ac].inag005 #儲位編號
            LET g_qryparam.default3 = "" #g_xmdk3_d[l_ac].inag006 #批號
            #給予arg
            LET g_qryparam.arg1 = "" #
            LET g_qryparam.arg2 = "" #
            
            CALL q_inag004_1()                                #呼叫開窗

            LET g_xmdk3_d[l_ac].xmdm007 = g_qryparam.return1              
            #LET g_xmdk3_d[l_ac].inag005 = g_qryparam.return2 
            #LET g_xmdk3_d[l_ac].inag006 = g_qryparam.return3 
            DISPLAY g_xmdk3_d[l_ac].xmdm007 TO xmdm007              #
            #DISPLAY g_xmdk3_d[l_ac].inag005 TO inag005 #儲位編號
            #DISPLAY g_xmdk3_d[l_ac].inag006 TO inag006 #批號
            NEXT FIELD xmdm007                          #返回原欄位

]]>
  </point>
  <point name="input.c.page4.xmdl025" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[            #此段落由子樣板a07產生            
            #開窗i段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
            LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_xmdk4_d[l_ac].xmdl025             #給予default值

            #給予arg
            LET g_qryparam.arg1 = "" #

            
            CALL q_oodb002_3()                                #呼叫開窗

            LET g_xmdk4_d[l_ac].xmdl025 = g_qryparam.return1              

            DISPLAY g_xmdk4_d[l_ac].xmdl025 TO xmdl025              #

            NEXT FIELD xmdl025                          #返回原欄位

]]>
  </point>
  <point name="main.import" order="" ver="3" cite_std="N" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[IMPORT util]]>
  </point>
  <point name="show.body.reference" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdkdocno
            CALL ap_ref_array2(g_ref_fields,"SELECT oobal004 FROM oobal_t WHERE oobalent='"||g_enterprise||"' AND oobal002=? AND oobal003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdkdocno_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdkdocno_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk007
            CALL ap_ref_array2(g_ref_fields,"SELECT pmaal003 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk007_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk007_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk010
            CALL ap_ref_array2(g_ref_fields,"SELECT ooibl004 FROM ooibl_t WHERE ooiblent='"||g_enterprise||"' AND ooibl002=? AND ooibl003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk010_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk011
            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='238' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk011_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk011_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk012
            CALL ap_ref_array2(g_ref_fields,"SELECT oodbl004 FROM oodbl_t WHERE oodblent='"||g_enterprise||"' AND oodbl002=? AND oodbl003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk012_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk012_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk016
            CALL ap_ref_array2(g_ref_fields,"SELECT ooail003 FROM ooail_t WHERE ooailent='"||g_enterprise||"' AND ooail001=? AND ooail002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk016_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk016_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk_d[l_ac].xmdk_t.xmdk018
            CALL ap_ref_array2(g_ref_fields,"SELECT xmahl003 FROM xmahl_t WHERE xmahlent='"||g_enterprise||"' AND xmahl001=? AND xmahl002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk_d[l_ac].xmdk018_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk_d[l_ac].xmdk018_desc
]]>
  </point>
  <point name="show.body2.reference" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl008
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl008_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl008_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl011
            CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001='221' AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl011_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl011_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl017
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl017_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl017_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl019
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl019_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl019_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdlsite
            LET g_ref_fields[2] = g_xmdk2_d[l_ac].xmdl014
            CALL ap_ref_array2(g_ref_fields,"SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaasite=? AND inaa001=? ","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl014_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl014_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdlsite
            LET g_ref_fields[2] = g_xmdk2_d[l_ac].xmdl014
            LET g_ref_fields[3] = g_xmdk2_d[l_ac].xmdl015
            CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inabsite=? AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl015_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl015_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk2_d[l_ac].xmdl_t.xmdl021
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk2_d[l_ac].xmdl021_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk2_d[l_ac].xmdl021_desc
]]>
  </point>
  <point name="show.body3.reference" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdm_t.xmdm001
            CALL ap_ref_array2(g_ref_fields,"SELECT imaal003 FROM imaal_t WHERE imaalent='"||g_enterprise||"' AND imaal001=? AND imaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm001_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm001_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdmsite
            LET g_ref_fields[2] = g_xmdk3_d[l_ac].xmdm005
            CALL ap_ref_array2(g_ref_fields,"SELECT inaa002 FROM inaa_t WHERE inaaent='"||g_enterprise||"' AND inaasite=? AND inaa001=? ","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm005_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm005_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdmsite
            LET g_ref_fields[2] = g_xmdk3_d[l_ac].xmdm005
            LET g_ref_fields[3] = g_xmdk3_d[l_ac].xmdm006
            CALL ap_ref_array2(g_ref_fields,"SELECT inab003 FROM inab_t WHERE inabent='"||g_enterprise||"' AND inabsite=? AND inab001=? AND inab002=? ","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm006_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm006_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdm_t.xmdm008
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm008_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm008_desc

            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk3_d[l_ac].xmdm_t.xmdm010
            CALL ap_ref_array2(g_ref_fields,"SELECT oocal003 FROM oocal_t WHERE oocalent='"||g_enterprise||"' AND oocal001=? AND oocal002='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk3_d[l_ac].xmdm010_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk3_d[l_ac].xmdm010_desc
]]>
  </point>
  <point name="show.body4.reference" order="" ver="1" cite_std="" new="N" status="" src="s" readonly="" mark_hard="N">
    <![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_xmdk4_d[l_ac].xmdl_t.xmdl025
            CALL ap_ref_array2(g_ref_fields,"SELECT oodbl004 FROM oodbl_t WHERE oodblent='"||g_enterprise||"' AND oodbl002=? AND oodbl003='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_xmdk4_d[l_ac].xmdl025_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_xmdk4_d[l_ac].xmdl025_desc
]]>
  </point>
  <section id="axmp540_02.description" ver="1" status="" src="s" readonly="">
    <![CDATA[#應用 a00 樣板自動產生(Version:1)
#+ Version..: T100-ERP-1.00.00(SD版次:6,PR版次:6) Build-000187
#+ 
#+ Filename...: axmp540_02
#+ Description: 出貨調整
#+ Creator....: 02040(2014-06-09 11:19:48)
#+ Modifier...: 02040(2015-01-15 16:11:52) -SD/PR-
]]>
  </section>
  <section id="axmp540_02.free_style_variable" ver="1" status="" src="s" readonly="">
    <![CDATA[#add-point:free_style模組變數(Module Variable)
{<point name="free_style.variable"/>}
#end add-point
]]>
  </section>
  <section id="axmp540_02.global" ver="3" status="" src="s" readonly="">
    <![CDATA[#應用 p00 樣板自動產生(Version:2)
#add-point:註解編寫項目
{<point name="main.memo" />}
#end add-point
 
IMPORT os
#add-point:增加匯入項目
{<point name="main.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
#add-point:增加匯入變數檔
{<point name="global.inc" />}
#end add-point
]]>
  </section>
  <section id="axmp540_02.global_variable" ver="1" status="" src="s" readonly="">
    <![CDATA[#add-point:自定義模組變數(Module Variable)
{<point name="global.variable"/>}
#end add-point
]]>
  </section>
  <section id="axmp540_02.other_dialog" ver="1" status="" src="s" readonly="">
    <![CDATA[{<point name="other.dialog"/>}
]]>
  </section>
  <section id="axmp540_02.other_function" ver="1" status="" src="s" readonly="">
    <![CDATA[{<point name="other.function"/>}
]]>
  </section>
</add_points>
