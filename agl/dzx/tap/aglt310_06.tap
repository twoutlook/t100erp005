<add_points prog="aglt310_06" std_prog="aglt310_06" erpver="1.0" module="AGL" ver="1" env="s" zone="t10dev" booking="Y">
  <point name="construct.c.page1.glax005" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooai001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glax005  #顯示到畫面上

            NEXT FIELD glax005                     #返回原欄位

]]>
</point>
  <point name="construct.c.page1.glaxdocno" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_glaxdocno()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glaxdocno  #顯示到畫面上

            NEXT FIELD glaxdocno                     #返回原欄位

]]>
</point>
  <point name="detail_show.body.reference" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_glax_d[l_ac].glaxld
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_glax_d[l_ac].glaxld_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_glax_d[l_ac].glaxld_desc
]]>
</point>
  <point name="detail_show.reference" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_glax_d[l_ac].glaxld
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_glax_d[l_ac].glaxld_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_glax_d[l_ac].glaxld_desc
]]>
</point>
  <point name="free_style.variable" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[{<Module define>}

#單身 type 宣告
 TYPE type_g_glax_d RECORD
   chk LIKE type_t.chr1,
   glaxdocno LIKE glax_t.glaxdocno,
   glaxseq LIKE glax_t.glaxseq,
   glax008 LIKE glax_t.glax008,
   glax008_1 LIKE type_t.num20_6,
   glax008_2 LIKE type_t.num20_6,
   glax005 LIKE glax_t.glax005,
   glax010 LIKE glax_t.glax010,
   glax010_1 LIKE type_t.num20_6,
   glax010_2 LIKE type_t.num20_6,
   glax003 LIKE glax_t.glax003,
   glax003_1 LIKE type_t.num20_6,
   glax003_2 LIKE type_t.num20_6,
   glax051 LIKE glax_t.glax051,
   glax052 LIKE glax_t.glax052,
   glax053 LIKE glax_t.glax053,
   glax054 LIKE glax_t.glax054,
   glax055 LIKE glax_t.glax055,
   glax056 LIKE glax_t.glax056,
   glax057 LIKE glax_t.glax057,
   glax058 LIKE glax_t.glax058,
   glax048 LIKE glax_t.glax048
       END RECORD


#無單身append欄位定義

#模組變數(Module Variables)
DEFINE g_glax_d          DYNAMIC ARRAY OF type_g_glax_d
DEFINE g_glax_d_t        type_g_glax_d


DEFINE g_wc2                STRING
DEFINE g_sql                STRING
DEFINE g_forupd_sql         STRING                        #SELECT ... FOR UPDATE SQL
DEFINE g_before_input_done  LIKE type_t.num5
DEFINE g_cnt                LIKE type_t.num10
DEFINE l_ac                 LIKE type_t.num5              #目前處理的ARRAY CNT
DEFINE g_curr_diag          ui.Dialog                     #Current Dialog
DEFINE gwin_curr            ui.Window                     #Current Window
DEFINE gfrm_curr            ui.Form                       #Current Form
DEFINE g_temp_idx           LIKE type_t.num5              #單身 所在筆數(暫存用)
DEFINE g_detail_idx         LIKE type_t.num5              #單身 所在筆數(所有資料)
DEFINE g_detail_cnt         LIKE type_t.num5              #單身 總筆數(所有資料)
DEFINE g_ref_fields         DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields         DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars           DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys              DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak          DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_insert             LIKE type_t.chr5              #是否導到其他page
DEFINE g_error_show         LIKE type_t.num5
DEFINE g_chk                BOOLEAN

#多table用wc
DEFINE g_wc_table           STRING

{</Module define>}]]>
</point>
  <point name="input.a.page1.glaxdocno" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_glax_d[g_detail_idx].glaxld IS NOT NULL AND g_glax_d[g_detail_idx].glaxdocno IS NOT NULL AND g_glax_d[g_detail_idx].glaxseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glax_d[g_detail_idx].glaxld != g_glax_d_t.glaxld OR g_glax_d[g_detail_idx].glaxdocno != g_glax_d_t.glaxdocno OR g_glax_d[g_detail_idx].glaxseq != g_glax_d_t.glaxseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glax_t WHERE "||"glaxent = '" ||g_enterprise|| "' AND "||"glaxld = '"||g_glax_d[g_detail_idx].glaxld ||"' AND "|| "glaxdocno = '"||g_glax_d[g_detail_idx].glaxdocno ||"' AND "|| "glaxseq = '"||g_glax_d[g_detail_idx].glaxseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page1.glaxld" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[
            INITIALIZE g_ref_fields TO NULL
            LET g_ref_fields[1] = g_glax_d[l_ac].glaxld
            CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
            LET g_glax_d[l_ac].glaxld_desc = '', g_rtn_fields[1] , ''
            DISPLAY BY NAME g_glax_d[l_ac].glaxld_desc

            #此段落由子樣板a05產生
            IF  g_glax_d[g_detail_idx].glaxld IS NOT NULL AND g_glax_d[g_detail_idx].glaxdocno IS NOT NULL AND g_glax_d[g_detail_idx].glaxseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glax_d[g_detail_idx].glaxld != g_glax_d_t.glaxld OR g_glax_d[g_detail_idx].glaxdocno != g_glax_d_t.glaxdocno OR g_glax_d[g_detail_idx].glaxseq != g_glax_d_t.glaxseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glax_t WHERE "||"glaxent = '" ||g_enterprise|| "' AND "||"glaxld = '"||g_glax_d[g_detail_idx].glaxld ||"' AND "|| "glaxdocno = '"||g_glax_d[g_detail_idx].glaxdocno ||"' AND "|| "glaxseq = '"||g_glax_d[g_detail_idx].glaxseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page1.glaxseq" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_glax_d[g_detail_idx].glaxld IS NOT NULL AND g_glax_d[g_detail_idx].glaxdocno IS NOT NULL AND g_glax_d[g_detail_idx].glaxseq IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glax_d[g_detail_idx].glaxld != g_glax_d_t.glaxld OR g_glax_d[g_detail_idx].glaxdocno != g_glax_d_t.glaxdocno OR g_glax_d[g_detail_idx].glaxseq != g_glax_d_t.glaxseq)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glax_t WHERE "||"glaxent = '" ||g_enterprise|| "' AND "||"glaxld = '"||g_glax_d[g_detail_idx].glaxld ||"' AND "|| "glaxdocno = '"||g_glax_d[g_detail_idx].glaxdocno ||"' AND "|| "glaxseq = '"||g_glax_d[g_detail_idx].glaxseq ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.c.page1.glax005" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_glax_d[l_ac].glax005             #給予default值

            #給予arg

            CALL q_ooai001()                                #呼叫開窗

            LET g_glax_d[l_ac].glax005 = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_glax_d[l_ac].glax005 TO glax005              #顯示到畫面上

            NEXT FIELD glax005                          #返回原欄位

]]>
</point>
  <point name="input.c.page1.glaxdocno" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="0" mark_hard="N">
<![CDATA[#此段落由子樣板a07產生            
            #開窗i段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'i'
			LET g_qryparam.reqry = FALSE

            LET g_qryparam.default1 = g_glax_d[l_ac].glaxdocno             #給予default值

            #給予arg

            CALL q_ooba002_4()                                #呼叫開窗

            LET g_glax_d[l_ac].glaxdocno = g_qryparam.return1              #將開窗取得的值回傳到變數

            DISPLAY g_glax_d[l_ac].glaxdocno TO glaxdocno              #顯示到畫面上

            NEXT FIELD glaxdocno                          #返回原欄位

]]>
</point>
  <point name="function.aglt310_06" cite_std="N" status="u" ver="1" src="s" new="Y" cite_ver="" order="1" mark_hard="N">
<![CDATA[
PUBLIC FUNCTION aglt310_06(--)
   #add-point:main段變數傳入
   p_glaxld,p_glax002,p_glapdocno,p_glaqseq
   #end add-point
   )
   #add-point:main段define
   DEFINE p_glaxld     LIKE glax_t.glaxld
   DEFINE p_glax002    LIKE glax_t.glax002
   DEFINE p_glapdocno  LIKE glap_t.glapdocno
   DEFINE p_glaqseq    LIKE glaq_t.glaqseq
   DEFINE l_sql        STRING
   DEFINE l_cnt        LIKE type_t.num5
   #end add-point

   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log

   #add-point:作業初始化
   #判斷是否有匹配的立帳資料，如果沒有則返回
   CALL aglt310_06_mark_sql(p_glaxld,p_glax002) RETURNING l_sql
   LET g_sql = "SELECT COUNT(*) FROM glax_t,glaq_t",
               " WHERE glaxent=",g_enterprise," AND glaxstus='Y' ",
               "   AND glaxld=glaqld AND glaxent=glaqent AND glax002=glaq002",
               "   AND glaqdocno='",p_glapdocno,"' AND glaqseq=",p_glaqseq,
               "   AND glaxld='",p_glaxld,"' AND glax002='",p_glax002,"' AND ",l_sql

   PREPARE aglt310_06_count_pr FROM g_sql
   EXECUTE aglt310_06_count_pr INTO l_cnt
   IF l_cnt=0 THEN
      RETURN TRUE
   END IF
   #end add-point



   #LOCK CURSOR (identifier)
   #add-point:SQL_define
   
   #end add-point
   LET g_forupd_sql = ""
   #add-point:SQL_define
   
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)   #轉換不同資料庫語法
   DECLARE aglt310_06_cl CURSOR FROM g_forupd_sql     # LOCK CURSOR


   #畫面開啟 (identifier)
   OPEN WINDOW w_aglt310_06 WITH FORM cl_ap_formpath("agl","aglt310_06")

   #瀏覽頁簽資料初始化
   CALL cl_ui_init()
   
   LET g_glaxld=p_glaxld
   LET g_glax002=p_glax002
   LET g_glapdocno=p_glapdocno
   LET g_glaqseq=p_glaqseq
   LET g_flag=TRUE
   
   #程式初始化
   CALL aglt310_06_init()
   CALL aglt310_06_b_fill(g_wc2)
   CALL aglt310_06_insert()

   #畫面關閉
   CLOSE WINDOW w_aglt310_06

   CLOSE aglt310_06_cl
   
   RETURN g_flag
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_init" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="2" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aglt310_06_init()
   #add-point:init段define
   
   #end add-point



   LET g_error_show = 1

   #add-point:畫面資料初始化
   CALL g_glax_d.clear()
   CALL aglt310_06_set_comp_entry("glax008_2,glax010_2,glax003_2,glax054,glax058",FALSE)
   
   SELECT glad005 INTO g_glad005 FROM glad_t 
    WHERE gladent=g_enterprise AND gladld=g_glaxld 
      AND glad001=g_glax002
   IF g_glad005='Y' THEN
      CALL cl_set_comp_visible("glax008,glax008_1,glax008_2",TRUE)
   ELSE
      CALL cl_set_comp_visible("glax008,glax008_1,glax008_2",FALSE)
   END IF
   
   SELECT glaacomp,glaa001,glaa015,glaa016,glaa017,glaa019,glaa020,glaa021,glaa026
     INTO g_glaacomp,g_glaa001,g_glaa015,g_glaa016,g_glaa017,g_glaa019,g_glaa020,g_glaa021,g_glaa026
    FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = g_glaxld  
   #取本幣的金额小數位數
   CALL s_curr_sel_ooaj004(g_glaa026,g_glaa001) RETURNING g_ooaj004
   IF g_glaa015='Y' THEN
      CALL cl_set_comp_visible("glax051,glax052,glax053,glax054",TRUE)
      #取本位幣二的金额小數位數
      CALL s_curr_sel_ooaj004(g_glaa026,g_glaa016) RETURNING g_ooaj004_2
   ELSE
      CALL cl_set_comp_visible("glax051,glax052,glax053,glax054",FALSE)
   END IF
   IF g_glaa019='Y' THEN
      CALL cl_set_comp_visible("glax055,glax056,glax057,glax058",TRUE)
      #取本位幣三的金额小數位數
      CALL s_curr_sel_ooaj004(g_glaa026,g_glaa020) RETURNING g_ooaj004_3
   ELSE
      CALL cl_set_comp_visible("glax055,glax056,glax057,glax058",FALSE)
   END IF
   #end add-point

   CALL aglt310_06_default_search()

END FUNCTION]]>
</point>
  <point name="function.aglt310_06_query" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="3" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aglt310_06_query()
   {<Local define>}
   DEFINE ls_wc      LIKE type_t.chr500
   DEFINE ls_return  STRING
   DEFINE ls_result  STRING
   {</Local define>}
   #add-point:query段define
   
   #end add-point

   LET INT_FLAG = 0
   CLEAR FORM
   CALL g_glax_d.clear()

   LET g_qryparam.state = "c"
   
   #wc備份
   LET ls_wc = g_wc2

   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)

      CONSTRUCT g_wc2 ON glaxdocno,glaxseq,glax008,glax005,glax010,glax003,glax052,glax056,glax048

         FROM s_detail1[1].glaxdocno,s_detail1[1].glaxseq,s_detail1[1].glax008,
              s_detail1[1].glax005,s_detail1[1].glax010,s_detail1[1].glax003,
              s_detail1[1].glax052,s_detail1[1].glax056,s_detail1[1].glax048



         #---------------------<  Detail: page1  >---------------------
         #----<<glaxdocno>>----
         #Ctrlp:construct.c.page1.glaxdocno
         ON ACTION controlp INFIELD glaxdocno
            #add-point:ON ACTION controlp INFIELD glaxdocno
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
			LET g_qryparam.where = " glaxld='",g_glaxld,"' AND glax002='",g_glax002,"' "
            CALL q_glaxdocno()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glaxdocno  #顯示到畫面上

            NEXT FIELD glaxdocno                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD glaxdocno
            #add-point:BEFORE FIELD glaxdocno
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glaxdocno

            #add-point:AFTER FIELD glaxdocno
            
            #END add-point


         #----<<glaxseq>>----
         #此段落由子樣板a01產生
         BEFORE FIELD glaxseq
            #add-point:BEFORE FIELD glaxseq
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glaxseq

            #add-point:AFTER FIELD glaxseq
            
            #END add-point


         #Ctrlp:query.c.page1.glaxseq
#         ON ACTION controlp INFIELD glaxseq
            #add-point:ON ACTION controlp INFIELD glaxseq
            
            #END add-point

         #----<<glax008>>----
         #此段落由子樣板a01產生
         BEFORE FIELD glax008
            #add-point:BEFORE FIELD glax008
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glax008

            #add-point:AFTER FIELD glax008
            
            #END add-point


         #Ctrlp:query.c.page1.glax008
#         ON ACTION controlp INFIELD glax008
            #add-point:ON ACTION controlp INFIELD glax008
            
            #END add-point

         #----<<glax005>>----
         #Ctrlp:construct.c.page1.glax005
         ON ACTION controlp INFIELD glax005
            #add-point:ON ACTION controlp INFIELD glax005
            #此段落由子樣板a08產生
            #開窗c段
			INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
			LET g_qryparam.reqry = FALSE
            CALL q_ooai001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glax005  #顯示到畫面上

            NEXT FIELD glax005                     #返回原欄位

          {#ADP版次:1#}
            #END add-point

         #此段落由子樣板a01產生
         BEFORE FIELD glax005
            #add-point:BEFORE FIELD glax005
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glax005

            #add-point:AFTER FIELD glax005
            
            #END add-point


         #----<<glax010>>----
         #此段落由子樣板a01產生
         BEFORE FIELD glax010
            #add-point:BEFORE FIELD glax010
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glax010

            #add-point:AFTER FIELD glax010
            
            #END add-point


         #Ctrlp:query.c.page1.glax010
#         ON ACTION controlp INFIELD glax010
            #add-point:ON ACTION controlp INFIELD glax010
            
            #END add-point

         #----<<glax003>>----
         #此段落由子樣板a01產生
         BEFORE FIELD glax003
            #add-point:BEFORE FIELD glax003
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glax003

            #add-point:AFTER FIELD glax003
            
            #END add-point


         #Ctrlp:query.c.page1.glax003
#         ON ACTION controlp INFIELD glax003
            #add-point:ON ACTION controlp INFIELD glax003
            
            #END add-point
            
         #----<<glax052>>----
         #此段落由子樣板a01產生
         BEFORE FIELD glax052
            #add-point:BEFORE FIELD glax052
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glax052

            #add-point:AFTER FIELD glax052
            
            #END add-point


         #Ctrlp:query.c.page1.glax052
#         ON ACTION controlp INFIELD glax052
            #add-point:ON ACTION controlp INFIELD glax052
            
            #END add-point    
             
         #----<<glax056>>----
         #此段落由子樣板a01產生
         BEFORE FIELD glax056
            #add-point:BEFORE FIELD glax056
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glax056

            #add-point:AFTER FIELD glax056
            
            #END add-point


         #Ctrlp:query.c.page1.glax056
#         ON ACTION controlp INFIELD glax056
            #add-point:ON ACTION controlp INFIELD glax056
            
            #END add-point

         #----<<glax048>>----
         #此段落由子樣板a01產生
         BEFORE FIELD glax048
            #add-point:BEFORE FIELD glax048
            
            #END add-point

         #此段落由子樣板a02產生
         AFTER FIELD glax048

            #add-point:AFTER FIELD glax048
            
            #END add-point


         #Ctrlp:query.c.page1.glax048
#         ON ACTION controlp INFIELD glax048
            #add-point:ON ACTION controlp INFIELD glax048
            
            #END add-point


         BEFORE CONSTRUCT
            CALL cl_qbe_init()
            #add-point:cs段more_construct
            
            #end add-point

         ON ACTION qbe_select
#            CALL cl_qbe_select()

         ON ACTION qbe_save
            CALL cl_qbe_save()

      END CONSTRUCT

      #add-point:query段more_construct
      
      #end add-point

      ON ACTION accept
         ACCEPT DIALOG

      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG

      #交談指令共用ACTION
      &include "common_action.4gl"
         CONTINUE DIALOG
   END DIALOG

   #add-point:query段after_construct
   
   #end add-point

   #LET g_wc2 = g_wc2 CLIPPED, cl_get_extra_cond("", "")

   IF INT_FLAG THEN
      LET INT_FLAG = 0
      #還原
      LET g_wc2 = ls_wc
   END IF
   LET g_wc2=g_wc2," AND ",ls_wc
   LET g_error_show = 1
   CALL aglt310_06_b_fill(g_wc2)
   CALL aglt310_06_insert()
   
   IF g_detail_cnt = 0 AND NOT INT_FLAG THEN
      CALL cl_err("",-100,1)
   END IF

   LET INT_FLAG = FALSE

END FUNCTION]]>
</point>
  <point name="function.aglt310_06_insert" cite_std="N" status="u" ver="1" src="s" new="Y" cite_ver="" order="4" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aglt310_06_insert()
   DEFINE li_ac       LIKE type_t.num5
   DEFINE l_sum       LIKE glaq_t.glaq003
   DEFINE l_amt       LIKE glaq_t.glaq003
   DEFINE li_idx      LIKE type_t.num5
   #輸入前動作
   LET li_ac = l_ac
   LET l_ac = 1
   LET l_sum=0

   SELECT glaq003+glaq004 INTO l_sum FROM glaq_t
   WHERE glaqent=g_enterprise AND glaqld=g_glaxld
     AND glaqdocno=g_glapdocno AND glaqseq=g_glaqseq
   
   #資料輸入
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
      INPUT ARRAY g_glax_d FROM s_detail1.*
         ATTRIBUTE(COUNT = g_rec_b,MAXCOUNT = g_rec_b,WITHOUT DEFAULTS, 
                  INSERT ROW = FALSE,
                  DELETE ROW = FALSE,
                  APPEND ROW = FALSE)
         BEFORE INPUT
            IF g_rec_b != 0 THEN
               CALL fgl_set_arr_curr(l_ac)
            END IF
                     
         BEFORE ROW
            LET g_detail_idx = DIALOG.getCurrentRow("s_detail1")
            LET l_ac = ARR_CURR()
            DISPLAY l_ac TO FORMONLY.idx
            IF g_glax_d[l_ac].chk='Y' THEN
               CALL aglt310_06_set_comp_entry("glax008_2,glax010_2,glax003_2,glax054,glax058",TRUE)
            ELSE
               CALL aglt310_06_set_comp_entry("glax008_2,glax010_2,glax003_2,glax054,glax058",FALSE)
            END IF
            #取原幣的金额小數位數
            CALL s_curr_sel_ooaj004(g_glaa026,g_glax_d[l_ac].glax005) RETURNING g_ooaj004_o                     
            CALL aglt310_06_show()
            
         ON CHANGE chk
            IF g_glax_d[l_ac].chk NOT MATCHES'[YN]' THEN
               NEXT FIELD chk
            END IF
            IF g_glax_d[l_ac].chk='Y' THEN
               CALL aglt310_06_set_comp_entry("glax008_2,glax010_2,glax003_2,glax054,glax058",TRUE)
            ELSE
               CALL aglt310_06_set_comp_entry("glax008_2,glax010_2,glax003_2,glax054,glax058",FALSE)
            END IF
                        
         AFTER FIELD glax008_2
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_glax_d[l_ac].glax008_2,"0","1","","","azz-00079",1) THEN
               NEXT FIELD glax008_2
            END IF
            
            #原幣開帳金額=數量*單價
            IF g_glax_d[l_ac].glax008_2>g_glax_d[l_ac].glax008_1 THEN
               CALL cl_err('','agl-00200',0)
               LET g_glax_d[l_ac].glax008_2=g_glax_d[l_ac].glax008_1
               NEXT FIELD glax008_2
            END IF 
                       
            
         AFTER FIELD glax010_2
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_glax_d[l_ac].glax010_2,"0","1","","","azz-00079",1) THEN
               NEXT FIELD glax010_2
            END IF
 
            IF g_glax_d[l_ac].glax010_2>g_glax_d[l_ac].glax010_1 THEN         
               CALL cl_err('','agl-00201',0)
               LET g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1
               NEXT FIELD glax010_2
            END IF 

            IF g_glad005='Y' AND  g_glax_d[l_ac].glax008_1=g_glax_d[l_ac].glax008_2 AND
               g_glax_d[l_ac].glax010_2<>g_glax_d[l_ac].glax010_1 THEN
               CALL cl_err('','agl-00203',0)
               LET g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1
               NEXT FIELD glax010_2
            END IF
            #本幣金額
            LET g_glax_d[l_ac].glax003_2=g_glax_d[l_ac].glax010_2*g_glax.glax006
            #本位幣二金額
            IF g_glaa015='Y' THEN
               IF g_glaa017='1' THEN
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax010_2*g_glax_d[l_ac].glax051
               ELSE
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax003_2*g_glax_d[l_ac].glax051
               END IF
               CALL s_num_round('1',g_glax_d[l_ac].glax054,g_ooaj004_2) RETURNING g_glax_d[l_ac].glax054
            END IF
            #本位幣三金額
            IF g_glaa019='Y' THEN
               IF g_glaa021='1' THEN
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax010_2*g_glax_d[l_ac].glax055
               ELSE
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax003_2*g_glax_d[l_ac].glax055
               END IF
               CALL s_num_round('1',g_glax_d[l_ac].glax058,g_ooaj004_3) RETURNING g_glax_d[l_ac].glax058
            END IF
            CALL s_num_round('1',g_glax_d[l_ac].glax010_2,g_ooaj004_o) RETURNING g_glax_d[l_ac].glax010_2
            CALL s_num_round('1',g_glax_d[l_ac].glax003_2,g_ooaj004) RETURNING g_glax_d[l_ac].glax003_2
            DISPLAY BY NAME g_glax_d[l_ac].glax003_2,g_glax_d[l_ac].glax054,g_glax_d[l_ac].glax058
     
         AFTER FIELD glax003_2
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_glax_d[l_ac].glax003_2,"0","1","","","azz-00079",1) THEN
               NEXT FIELD glax003_2
            END IF

            IF g_glax_d[l_ac].glax003_2>g_glax_d[l_ac].glax003_1 THEN
               CALL cl_err('','agl-00202',0)
               LET g_glax_d[l_ac].glax003_2=g_glax_d[l_ac].glax003_1
               NEXT FIELD glax003_2            
            END IF 
            
            #本幣金額
            LET g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax003_2/g_glax.glax006
            #本位幣二金額
            IF g_glaa015='Y' THEN
               IF g_glaa017='1' THEN
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax010_2*g_glax_d[l_ac].glax051
               ELSE
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax003_2*g_glax_d[l_ac].glax051
               END IF
               CALL s_num_round('1',g_glax_d[l_ac].glax054,g_ooaj004_2) RETURNING g_glax_d[l_ac].glax054
            END IF
            #本位幣三金額
            IF g_glaa019='Y' THEN
               IF g_glaa021='1' THEN
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax010_2*g_glax_d[l_ac].glax055
               ELSE
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax003_2*g_glax_d[l_ac].glax055
               END IF
               CALL s_num_round('1',g_glax_d[l_ac].glax058,g_ooaj004_3) RETURNING g_glax_d[l_ac].glax058
            END IF
            CALL s_num_round('1',g_glax_d[l_ac].glax010_2,g_ooaj004_o) RETURNING g_glax_d[l_ac].glax010_2
            CALL s_num_round('1',g_glax_d[l_ac].glax003_2,g_ooaj004) RETURNING g_glax_d[l_ac].glax003_2
            
            IF g_glad005='Y' THEN
               IF g_glax_d[l_ac].glax008_1=g_glax_d[l_ac].glax008_2 AND
                  g_glax_d[l_ac].glax003_2<>g_glax_d[l_ac].glax003_1 THEN
                  CALL cl_err('','agl-00203',0)
                  LET g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1
                  LET g_glax_d[l_ac].glax003_2=g_glax_d[l_ac].glax003_1
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax053
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax057
                  NEXT FIELD glax003_2 
               END IF
            ELSE
               IF g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1 AND
                  g_glax_d[l_ac].glax003_2<>g_glax_d[l_ac].glax003_1 THEN
                  CALL cl_err('','agl-00204',0)
                  LET g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1
                  LET g_glax_d[l_ac].glax003_2=g_glax_d[l_ac].glax003_1
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax053
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax057
                  NEXT FIELD glax003_2 
               END IF
            END IF
            DISPLAY BY NAME g_glax_d[l_ac].glax010_2,g_glax_d[l_ac].glax054,g_glax_d[l_ac].glax058
            
         AFTER FIELD glax054
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_glax_d[l_ac].glax054,"0","1","","","azz-00079",1) THEN
               NEXT FIELD glax054
            END IF

            IF g_glax_d[l_ac].glax054>g_glax_d[l_ac].glax053 THEN
               CALL cl_err('','agl-00202',0)
               LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax053
               NEXT FIELD glax054            
            END IF 
            
            IF g_glad005='Y' THEN
               IF g_glax_d[l_ac].glax008_1=g_glax_d[l_ac].glax008_2 AND
                  g_glax_d[l_ac].glax054<>g_glax_d[l_ac].glax053 THEN
                  CALL cl_err('','agl-00203',0)
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax053
                  NEXT FIELD glax054 
               END IF
            ELSE
               IF g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1 AND
                  g_glax_d[l_ac].glax054<>g_glax_d[l_ac].glax053 THEN
                  CALL cl_err('','agl-00204',0)
                  LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax053
                  NEXT FIELD glax054 
               END IF
            END IF
            CALL s_num_round('1',g_glax_d[l_ac].glax054,g_ooaj004_2) RETURNING g_glax_d[l_ac].glax054
            
         AFTER FIELD glax058
            #此段落由子樣板a15產生
            IF NOT cl_ap_chk_Range(g_glax_d[l_ac].glax058,"0","1","","","azz-00079",1) THEN
               NEXT FIELD glax058
            END IF

            IF g_glax_d[l_ac].glax058>g_glax_d[l_ac].glax057 THEN
               CALL cl_err('','agl-00202',0)
               LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax057
               NEXT FIELD glax058            
            END IF 
            
            IF g_glad005='Y' THEN
               IF g_glax_d[l_ac].glax008_1=g_glax_d[l_ac].glax008_2 AND
                  g_glax_d[l_ac].glax058<>g_glax_d[l_ac].glax057 THEN
                  CALL cl_err('','agl-00203',0)
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax057
                  NEXT FIELD glax058 
               END IF
            ELSE
               IF g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1 AND
                  g_glax_d[l_ac].glax058<>g_glax_d[l_ac].glax057 THEN
                  CALL cl_err('','agl-00204',0)
                  LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax057
                  NEXT FIELD glax058 
               END IF
            END IF
            CALL s_num_round('1',g_glax_d[l_ac].glax058,g_ooaj004_3) RETURNING g_glax_d[l_ac].glax058
            
         AFTER ROW
            
            
         AFTER INPUT
            LET l_amt=0
            FOR li_idx = 1 TO g_glax_d.getLength()
                IF g_glax_d[li_idx].chk='Y' THEN
                   LET l_amt=l_amt+g_glax_d[li_idx].glax003_2
                END IF
            END FOR
            IF l_sum<>l_amt THEN
               CALL cl_err('','agl-00232',0)
               NEXT FIELD glax003_2
            END IF
            
      END INPUT

      BEFORE DIALOG
      
      #重新整理
      ON ACTION refresh
         CALL aglt310_06_b_fill(g_wc2)
         CALL aglt310_06_insert()
         EXIT DIALOG
         
      #重新查詢
      ON ACTION reconstruct
         CALL aglt310_06_query()
         EXIT DIALOG
         
      #全部選取
      ON ACTION selectall
         # 連未選擇的頁面都必須選擇
         CALL aglt310_06_sel_all("selectall") 
         
      #全部取消選取
      ON ACTION selectnone
         CALL aglt310_06_sel_all("selectnone") 
         
      ON ACTION accept
         ACCEPT DIALOG
        
      ON ACTION cancel
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION close
         LET INT_FLAG = TRUE 
         EXIT DIALOG
 
      ON ACTION exit
         LET INT_FLAG = TRUE 
         EXIT DIALOG
   
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG 

   END DIALOG

   #輸入後動作
   IF INT_FLAG THEN
      CALL cl_err("",9001,0)
      LET INT_FLAG = 0
      RETURN
   END IF
   
   #更新glax_t的沖帳資料，并產生一筆沖帳資料到glaq_t
   CALL aglt310_06_update()
  

END FUNCTION]]>
</point>
  <point name="function.aglt310_06_b_fill" cite_std="N" status="u" ver="1" src="s" new="Y" cite_ver="" order="5" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aglt310_06_b_fill(p_wc2)
              #BODY FILL UP
   {<Local define>}
   DEFINE p_wc2           STRING
   DEFINE l_sql           STRING
   {</Local define>}
   #add-point:b_fill段define
   
   #end add-point

   IF cl_null(p_wc2) THEN
      LET p_wc2 = " 1=1"
   END IF

   #add-point:b_fill段sql之前
   CALL aglt310_06_mark_sql(g_glaxld,g_glax002) RETURNING l_sql
   #end add-point

   LET g_sql = "SELECT UNIQUE 'N',glaxdocno,glaxseq,glax008,0,0,glax005,glax010,0,0,glax003,0,0,",
               "               glax051,glax052,0,0,glax055,glax056,0,0,glax048 ",
               "  FROM glax_t,glaq_t",
               " WHERE glaxent= ?  ",
               "   AND glaxld=glaqld   AND glaxent=glaqent AND glax002=glaq002",
               "   AND glaqdocno='",g_glapdocno,"' AND glaqseq=",g_glaqseq,
               "   AND ", p_wc2," AND ",l_sql

   LET g_sql = g_sql, " ORDER BY glax_t.glaxdocno,glax_t.glaxseq"

   #add-point:b_fill段sql之後
   
   #end add-point

   PREPARE aglt310_06_pb FROM g_sql
   DECLARE b_fill_curs CURSOR FOR aglt310_06_pb

   OPEN b_fill_curs USING g_enterprise

   CALL g_glax_d.clear()


   LET g_cnt = l_ac
   LET l_ac = 1
   ERROR "Searching!"

   FOREACH b_fill_curs INTO g_glax_d[l_ac].chk,g_glax_d[l_ac].glaxdocno,g_glax_d[l_ac].glaxseq,
                            g_glax_d[l_ac].glax008,g_glax_d[l_ac].glax008_1,g_glax_d[l_ac].glax008_2,
                            g_glax_d[l_ac].glax005,g_glax_d[l_ac].glax010,g_glax_d[l_ac].glax010_1,
                            g_glax_d[l_ac].glax010_2,g_glax_d[l_ac].glax003,g_glax_d[l_ac].glax003_1,
                            g_glax_d[l_ac].glax003_2,g_glax_d[l_ac].glax051,g_glax_d[l_ac].glax052,
                            g_glax_d[l_ac].glax053,g_glax_d[l_ac].glax054,g_glax_d[l_ac].glax055,
                            g_glax_d[l_ac].glax056,g_glax_d[l_ac].glax057,g_glax_d[l_ac].glax058,
                            g_glax_d[l_ac].glax048
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF

      #add-point:b_fill段資料填充
      
      #end add-point

      CALL aglt310_06_detail_show()

      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         EXIT FOREACH
      END IF

   END FOREACH

   IF l_ac > g_max_rec AND g_error_show = 1 THEN
      CALL cl_err("glax_t",9035,1)
   END IF
   LET g_error_show = 0




   CALL g_glax_d.deleteElement(g_glax_d.getLength())


   #將key欄位填到每個page
   FOR l_ac = 1 TO g_glax_d.getLength()

   END FOR

   #add-point:b_fill段資料填充(其他單身)
   
   #end add-point

   LET g_detail_cnt = l_ac - 1
   DISPLAY g_detail_cnt TO FORMONLY.cnt
   LET l_ac = g_cnt
   LET g_cnt = 0
   LET g_rec_b=g_detail_cnt
   
   CLOSE b_fill_curs
   FREE aglt310_06_pb

END FUNCTION]]>
</point>
  <point name="function.aglt310_06_detail_show" cite_std="N" status="u" ver="1" src="s" new="Y" cite_ver="" order="6" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aglt310_06_detail_show()
   #add-point:show段define
   DEFINE l_glax041       LIKE glax_t.glax041
   DEFINE l_glax042       LIKE glax_t.glax042
   DEFINE l_glax043       LIKE glax_t.glax043
   DEFINE l_glax044       LIKE glax_t.glax044
   DEFINE l_glax045       LIKE glax_t.glax045
   DEFINE l_glax046       LIKE glax_t.glax046
   DEFINE l_glax053       LIKE glax_t.glax053
   DEFINE l_glax054       LIKE glax_t.glax054
   DEFINE l_glax057       LIKE glax_t.glax057
   DEFINE l_glax058       LIKE glax_t.glax058
   DEFINE l_glay003       LIKE glay_t.glay003
   DEFINE l_glay008       LIKE glay_t.glay008
   DEFINE l_glay010       LIKE glay_t.glay010
   DEFINE l_glay052       LIKE glay_t.glay052
   DEFINE l_glay054       LIKE glay_t.glay054
   #end add-point

   #add-point:detail_show段之前
   
   #end add-point



   #帶出公用欄位reference值page1




   #讀入ref值
   #add-point:show段單身reference
   #判斷是否該筆傳票已沖抵過該筆立帳資料，如果存在加入以沖抵的金額
   SELECT glay003,glay008,glay010,glay052,glay054 
     INTO l_glay003,l_glay008,l_glay010,l_glay052,l_glay054 
     FROM glay_t
    WHERE glayent=g_enterprise AND glayld=g_glaxld
      AND glaydocno=g_glapdocno AND glayseq=g_glaqseq
      AND glay041=g_glax_d[l_ac].glaxdocno
      AND glay042=g_glax_d[l_ac].glaxseq
   IF cl_null(l_glay003) THEN LET l_glay003=0 END IF
   IF cl_null(l_glay008) THEN LET l_glay008=0 END IF
   IF cl_null(l_glay010) THEN LET l_glay010=0 END IF
   IF cl_null(l_glay052) THEN LET l_glay052=0 END IF
   IF cl_null(l_glay054) THEN LET l_glay054=0 END IF
   IF SQLCA.sqlcode <> 100 THEN
      LET g_glax_d[l_ac].chk='Y'
   END IF
   SELECT glax041,glax042,glax043,glax044,glax045,glax046,glax053,glax054,glax057,glax058
     INTO l_glax041,l_glax042,l_glax043,l_glax044,l_glax045,l_glax046,l_glax053,l_glax054,l_glax057,l_glax058
     FROM glax_t
    WHERE glaxent=g_enterprise AND glaxld=g_glaxld
      AND glaxdocno=g_glax_d[l_ac].glaxdocno
      AND glaxseq=g_glax_d[l_ac].glaxseq
   IF cl_null(l_glax041) THEN LET l_glax041=0 END IF
   IF cl_null(l_glax042) THEN LET l_glax042=0 END IF
   IF cl_null(l_glax043) THEN LET l_glax043=0 END IF
   IF cl_null(l_glax044) THEN LET l_glax044=0 END IF
   IF cl_null(l_glax045) THEN LET l_glax045=0 END IF
   IF cl_null(l_glax046) THEN LET l_glax046=0 END IF
   IF cl_null(l_glax053) THEN LET l_glax053=0 END IF
   IF cl_null(l_glax054) THEN LET l_glax054=0 END IF
   IF cl_null(l_glax057) THEN LET l_glax057=0 END IF
   IF cl_null(l_glax058) THEN LET l_glax058=0 END IF
   #未沖數量
   IF g_glad005='Y' THEN
      LET g_glax_d[l_ac].glax008_1=g_glax_d[l_ac].glax008-l_glax043-l_glax044+l_glay008
      IF g_glax_d[l_ac].chk='Y' THEN
         LET g_glax_d[l_ac].glax008_2=l_glay008
      ELSE
         LET g_glax_d[l_ac].glax008_2=g_glax_d[l_ac].glax008_1
      END IF  
   END IF  
   #未沖本幣金額
   LET g_glax_d[l_ac].glax003_1=g_glax_d[l_ac].glax003-l_glax041-l_glax042+l_glay003
   #未沖原幣金額
   LET g_glax_d[l_ac].glax010_1=g_glax_d[l_ac].glax010-l_glax045-l_glax046+l_glay010
   IF g_glax_d[l_ac].chk='Y' THEN
      LET g_glax_d[l_ac].glax003_2=l_glay003
      LET g_glax_d[l_ac].glax010_2=l_glay010
   ELSE
      LET g_glax_d[l_ac].glax003_2=g_glax_d[l_ac].glax003_1
      LET g_glax_d[l_ac].glax010_2=g_glax_d[l_ac].glax010_1
   END IF
   #本位幣二
   IF g_glaa015='Y' THEN
      LET g_glax_d[l_ac].glax053= g_glax_d[l_ac].glax052-l_glax053-l_glax054+l_glay052
      IF g_glax_d[l_ac].chk='Y' THEN
         LET g_glax_d[l_ac].glax054=l_glay052
      ELSE
         LET g_glax_d[l_ac].glax054=g_glax_d[l_ac].glax053
      END IF
   END IF
   #本位幣三
   IF g_glaa019='Y' THEN
      LET g_glax_d[l_ac].glax057= g_glax_d[l_ac].glax056-l_glax057-l_glax058+l_glay054
      IF g_glax_d[l_ac].chk='Y' THEN
         LET g_glax_d[l_ac].glax058=l_glay054
      ELSE
         LET g_glax_d[l_ac].glax058=g_glax_d[l_ac].glax057
      END IF
   END IF  
       {#ADP版次:1#}
   #end add-point


   #add-point:detail_show段之後
   
   #end add-point

END FUNCTION]]>
</point>
  <point name="function.aglt310_06_default_search" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="7" mark_hard="N">
<![CDATA[
PRIVATE FUNCTION aglt310_06_default_search()
   {<Local define>}
   DEFINE li_idx  LIKE type_t.num5
   DEFINE li_cnt  LIKE type_t.num5
   DEFINE ls_wc   STRING
   {</Local define>}
   #add-point:default_search段define
   
   #end add-point

   LET ls_wc= " glaxstus='Y' AND "
   IF NOT cl_null(g_glaxld) THEN
      LET ls_wc = ls_wc, " glaxld = '", g_glaxld, "' AND "
   END IF

   IF NOT cl_null(g_glax002) THEN
      LET ls_wc = ls_wc, " glax002 = '", g_glax002, "' AND "
   END IF

   IF NOT cl_null(ls_wc) THEN
      LET ls_wc = ls_wc.subString(1,ls_wc.getLength()-5)
      LET g_wc2 = ls_wc
   ELSE
      LET g_wc2 = " 1=1"
   END IF

END FUNCTION]]>
</point>
  <point name="function.aglt310_06_show" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="8" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 描述说明
# Memo...........: 顯示帳款明細資料和核算項資料
# Usage..........: CALL aglt310_06_show()
# Date & Author..: 14/01/17 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_show()
   
   #立帳資料明細
   SELECT glax017,glax018,glax019,glax020,glax021,glax022,
          glax023,glax024,glax025,glax026,glax027,glax028,
          glax005,glax006,glax007,glax008,glax009,glax010,
          glax011,glax012,glax013,glax014,glax015,glax016
     INTO g_glax.glax017,g_glax.glax018,g_glax.glax019,g_glax.glax020,g_glax.glax021,g_glax.glax022, 
          g_glax.glax023,g_glax.glax024,g_glax.glax025,g_glax.glax026,g_glax.glax027,g_glax.glax028,
          g_glax.glax005,g_glax.glax006,g_glax.glax007,g_glax.glax008,g_glax.glax009,g_glax.glax010,
          g_glax.glax011,g_glax.glax012,g_glax.glax013,g_glax.glax014,g_glax.glax015,g_glax.glax016
     FROM glax_t
    WHERE glaxent=g_enterprise AND glaxld=g_glaxld 
      AND glaxdocno=g_glax_d[l_ac].glaxdocno 
      AND glaxseq=g_glax_d[l_ac].glaxseq
      
   DISPLAY BY NAME g_glax.glax017,g_glax.glax018,g_glax.glax019,g_glax.glax020,g_glax.glax021,g_glax.glax022, 
                   g_glax.glax023,g_glax.glax024,g_glax.glax025,g_glax.glax026,g_glax.glax027,g_glax.glax028,
                   g_glax.glax005,g_glax.glax006,g_glax.glax007,g_glax.glax008,g_glax.glax009,g_glax.glax010,
                   g_glax.glax011,g_glax.glax012,g_glax.glax013,g_glax.glax014,g_glax.glax015,g_glax.glax016
   
   #营运据点
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glax.glax017
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax017_desc =  g_rtn_fields[1] 
   DISPLAY BY NAME g_glax.glax017_desc
   #部门
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glax.glax018
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax018_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax018_desc
   #成本利润中心
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glax.glax019
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax019_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax019_desc
   #区域 
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = '287'
   LET g_ref_fields[2] = g_glax.glax020
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax020_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax020_desc 

   #交易客商
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glax.glax021
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax021_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax021_desc
   #帐款客商
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glax.glax022
   CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax022_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax022_desc
   #客群
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = '281'
   LET g_ref_fields[2] = g_glax.glax023
   CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax023_desc =  g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax023_desc 
   
   #产品分类
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glax.glax024
   CALL ap_ref_array2(g_ref_fields,"SELECT rtaxl003 FROM rtaxl_t WHERE rtaxlent='"||g_enterprise||"' AND rtaxl001=? AND rtaxl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax024_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax024_desc
   
   #人员
   LET  g_glax.glax025_desc = ''
   SELECT oofa011 INTO g_glax.glax025_desc FROM oofa_t
    WHERE oofaent = g_enterprise
      AND oofa001 IN (SELECT ooag002 FROM ooag_t
                        WHERE ooagent = g_enterprise
                          AND ooag001 = g_glax.glax025)
   DISPLAY BY NAME g_glax.glax025_desc
   
   #预算编号
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glax.glax026
   CALL ap_ref_array2(g_ref_fields,"SELECT bgaal003 FROM bgaal_t WHERE bgaalent='"||g_enterprise||"' AND bgaal001=? AND bgaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glax.glax026_desc = g_rtn_fields[1]
   DISPLAY BY NAME g_glax.glax026_desc 
   
   #專案編號
   
   #WBS編號
   
   #申請人
   LET  g_glax.glax013_desc = ''
   SELECT oofa011 INTO g_glax.glax013_desc FROM oofa_t
    WHERE oofaent = g_enterprise
      AND oofa001 IN (SELECT ooag002 FROM ooag_t
                        WHERE ooagent = g_enterprise
                          AND ooag001 = g_glax.glax013)
   DISPLAY BY NAME g_glax.glax013_desc
   
   #自由核算項
   CALL aglt310_06_free_account()
   
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_free_account" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="9" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 描述说明
# Memo...........: 顯示自由核算項
# Usage..........: CALL aglt310_06_free_account()
# Date & Author..: 14/01/27 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_free_account()
   DEFINE l_glae002     LIKE glae_t.glae002     #资料来源
   DEFINE l_sql         STRING                  #组的抓取资料的sql
   #是否做自由科目核算项管理
   DEFINE l_glad017        LIKE glad_t.glad017  
   DEFINE l_glad018        LIKE glad_t.glad018
   DEFINE l_glad019        LIKE glad_t.glad019
   DEFINE l_glad020        LIKE glad_t.glad020
   DEFINE l_glad021        LIKE glad_t.glad021
   DEFINE l_glad022        LIKE glad_t.glad022
   DEFINE l_glad023        LIKE glad_t.glad023
   DEFINE l_glad024        LIKE glad_t.glad024
   DEFINE l_glad025        LIKE glad_t.glad025
   DEFINE l_glad026        LIKE glad_t.glad026
   DEFINE l_glad0171       LIKE glad_t.glad0171  
   DEFINE l_glad0181       LIKE glad_t.glad0181
   DEFINE l_glad0191       LIKE glad_t.glad0191
   DEFINE l_glad0201       LIKE glad_t.glad0201
   DEFINE l_glad0211       LIKE glad_t.glad0211
   DEFINE l_glad0221       LIKE glad_t.glad0221
   DEFINE l_glad0231       LIKE glad_t.glad0231
   DEFINE l_glad0241       LIKE glad_t.glad0241
   DEFINE l_glad0251       LIKE glad_t.glad0251
   DEFINE l_glad0261       LIKE glad_t.glad0261
   
   SELECT glax029,glax030,glax031,glax032,glax033,
          glax034,glax035,glax036,glax037,glax038
     INTO g_glax_c.glax029,g_glax_c.glax030,g_glax_c.glax031,
          g_glax_c.glax032,g_glax_c.glax033,
          g_glax_c.glax034,g_glax_c.glax035,g_glax_c.glax036,
          g_glax_c.glax037,g_glax_c.glax038
     FROM glax_t
    WHERE glaxent=g_enterprise AND glaxld=g_glaxld
      AND glaxdocno=g_glax_d[l_ac].glaxdocno
      AND glaxseq=g_glax_d[l_ac].glaxseq
  

   SELECT glad017,glad0171,glad018,glad0181,
          glad019,glad0191,glad020,glad0201,
          glad021,glad0211,glad022,glad0221,
          glad023,glad0231,glad024,glad0221,
          glad025,glad0251,glad026,glad0261
    INTO  l_glad017,l_glad0171,l_glad018,l_glad0181,
          l_glad019,l_glad0191,l_glad020,l_glad0201,
          l_glad021,l_glad0211,l_glad022,l_glad0221,
          l_glad023,l_glad0231,l_glad024,l_glad0241,
          l_glad025,l_glad0251,l_glad026,l_glad0261
    FROM  glad_t
    WHERE gladent = g_enterprise
      AND gladld  = g_glaxld
      AND glad001 = g_glax002
   
   #核算项一
   IF l_glad017 = 'Y'  THEN
      CALL cl_set_comp_visible('glax029,glax029_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax029,glax029_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0171
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0171
      LET g_ref_fields[2] =g_glax_c.glax029
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax029_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax029
      CALL aglt310_06_make_sql_desc(l_glad0171) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax029_desc= g_rtn_fields[1]
   END IF 
   #核算项二
   IF l_glad018 = 'Y'  THEN
      CALL cl_set_comp_visible('glax030,glax030_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax030,glax030_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0181
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0181
      LET g_ref_fields[2] =g_glax_c.glax030     
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax030_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax030
      CALL aglt310_06_make_sql_desc(l_glad0181) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax030_desc= g_rtn_fields[1]
   END IF       
   #核算项三
   IF l_glad019 = 'Y'  THEN
      CALL cl_set_comp_visible('glax031,glax031_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax031,glax031_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0191
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0191
      LET g_ref_fields[2] =g_glax_c.glax031
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax031_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax031
      CALL aglt310_06_make_sql_desc(l_glad0191) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax031_desc= g_rtn_fields[1]   
   END IF      
   #核算项四
   IF l_glad020 = 'Y'  THEN
      CALL cl_set_comp_visible('glax032,glax032_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax032,glax032_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0201
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0201
      LET g_ref_fields[2] =g_glax_c.glax032
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax032_desc= g_rtn_fields[1]
    ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax032
      CALL aglt310_06_make_sql_desc(l_glad0201) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax032_desc= g_rtn_fields[1]   
   END IF        
   #核算项五
   IF l_glad021 = 'Y'  THEN
      CALL cl_set_comp_visible('glax033,glax033_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax033,glax033_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0211
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0211
      LET g_ref_fields[2] =g_glax_c.glax033
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax033_desc= g_rtn_fields[1]  
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax033
      CALL aglt310_06_make_sql_desc(l_glad0211) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax033_desc= g_rtn_fields[1]   
   END IF        
   #核算项六
   IF l_glad022 = 'Y'  THEN
      CALL cl_set_comp_visible('glax034,glax034_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax034,glax034_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0221
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0221
      LET g_ref_fields[2] =g_glax_c.glax034
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax034_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax034
      CALL aglt310_06_make_sql_desc(l_glad0221) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax034_desc= g_rtn_fields[1]   
   END IF        
   #核算项七
   IF l_glad023 = 'Y'  THEN
      CALL cl_set_comp_visible('glax035,glax035_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax035,glax035_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0231
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0231
      LET g_ref_fields[2] =g_glax_c.glax035
      CALL aglt310_06_make_sql_desc(l_glad0231) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax035_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax035
      CALL aglt310_06_make_sql_desc(l_glad0231) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax035_desc= g_rtn_fields[1]   
   END IF           
   #核算项八
   IF l_glad024 = 'Y'  THEN
      CALL cl_set_comp_visible('glax036,glax036_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax036,glax036_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0241
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0241
      LET g_ref_fields[2] =g_glax_c.glax036
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax036_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax036
      CALL aglt310_06_make_sql_desc(l_glad0241) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax036_desc= g_rtn_fields[1]   
   END IF        
   #核算项九
   IF l_glad025 = 'Y'  THEN
      CALL cl_set_comp_visible('glax037,glax037_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax037,glax037_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0251
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0251
      LET g_ref_fields[2] =g_glax_c.glax037
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax037_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax037
      CALL aglt310_06_make_sql_desc(l_glad0251) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax037_desc= g_rtn_fields[1]   
   END IF        
   #核算项十
   IF l_glad026 = 'Y'  THEN
      CALL cl_set_comp_visible('glax038,glax038_desc',TRUE)
   ELSE
      CALL cl_set_comp_visible('glax038,glax038_desc',FALSE)
   END IF
   LET l_glae002 = ''
   LET l_sql = ''
   SELECT glae002 INTO l_glae002 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = l_glad0261
   IF l_glae002 = '2' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =l_glad0261
      LET g_ref_fields[2] =g_glax_c.glax038
      CALL ap_ref_array2(g_ref_fields,"SELECT glafl004 FROM glafl_t WHERE glaflent='"||g_enterprise||"' AND glafl001=? AND glafl002=? AND glafl003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glax_c.glax038_desc= g_rtn_fields[1]
   ELSE
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glax_c.glax038
      CALL aglt310_06_make_sql_desc(l_glad0261) RETURNING l_sql
      CALL ap_ref_array2(g_ref_fields,l_sql,"") RETURNING g_rtn_fields
      LET g_glax_c.glax038_desc= g_rtn_fields[1]   
   END IF        
   
   DISPLAY BY NAME g_glax_c.glax029,g_glax_c.glax029_desc,g_glax_c.glax030,g_glax_c.glax030_desc,
                   g_glax_c.glax031,g_glax_c.glax031_desc,g_glax_c.glax032,g_glax_c.glax032_desc,
                   g_glax_c.glax033,g_glax_c.glax033_desc,g_glax_c.glax034,g_glax_c.glax034_desc,
                   g_glax_c.glax035,g_glax_c.glax035_desc,g_glax_c.glax036,g_glax_c.glax036_desc,
                   g_glax_c.glax037,g_glax_c.glax037_desc,g_glax_c.glax038,g_glax_c.glax038_desc
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_sel_all" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="10" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 描述说明
# Memo...........: 全選/全不選
# Usage..........: CALL aglt310_06_sel_all(p_action)
# Input parameter: p_action   操作
# Date & Author..: 14/01/27 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_sel_all(p_action)
   DEFINE p_action     LIKE type_t.chr80
   DEFINE li_i          LIKE type_t.num5
   DEFINE l_cnt        LIKE type_t.num5
   DEFINE ls_sql       STRING
   DEFINE ls_where     STRING
   
   CASE
      WHEN p_action = "selectall" 
         FOR li_i = 1 TO g_glax_d.getlength()
             LET g_glax_d[li_i].chk = "Y"
         END FOR
         CALL g_glax_d.deleteElement(li_i)
             
      #全部取消選取
      WHEN p_action = "selectnone"
         FOR li_i = 1 TO g_glax_d.getlength()
            LET g_glax_d[li_i].chk = "N"
         END FOR
         CALL g_glax_d.deleteElement(li_i)
   END CASE    
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_update" cite_std="N" status="u" ver="1" src="s" new="Y" cite_ver="" order="11" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 描述说明
# Memo...........: 更新glax_t并產更一筆沖帳資料glaq_t
# Usage..........: CALL aglt310_06_update()
# Date & Author..: 14/01/28 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_update()
   DEFINE li_idx       LIKE type_t.num10
   DEFINE l_flag       LIKE type_t.num5
   DEFINE l_cnt        LIKE type_t.num5
   
   CALL cl_showmsg_init()
   LET g_success = 'Y'  

   #获取传票是否采用外币
   SELECT glap014 INTO g_glap014 FROM glap_t
   WHERE glapent=g_enterprise AND glapld=g_glaxld
   AND glapdocno=g_glapdocno
   
   LET l_flag=TRUE    
   FOR li_idx = 1 TO g_glax_d.getLength()
      IF g_glax_d[li_idx].chk='Y' THEN
         CALL s_num_round('1',g_glax_d[l_ac].glax054,g_ooaj004_2) RETURNING g_glax_d[l_ac].glax054
         CALL s_num_round('1',g_glax_d[l_ac].glax058,g_ooaj004_3) RETURNING g_glax_d[l_ac].glax058
         CALL s_num_round('1',g_glax_d[l_ac].glax010_2,g_ooaj004_o) RETURNING g_glax_d[l_ac].glax010_2
         CALL s_num_round('1',g_glax_d[l_ac].glax003_2,g_ooaj004) RETURNING g_glax_d[l_ac].glax003_2
         IF l_flag=TRUE THEN
            #判斷是否該筆傳票已存在沖帳資料，如果存在更新立帳資料
            SELECT COUNT(*) INTO l_cnt FROM glay_t
             WHERE glayent=g_enterprise AND glayld=g_glaxld
               AND glaydocno=g_glapdocno AND glayseq=g_glaqseq
            IF l_cnt>0 THEN 
               #在刪除細項沖帳資料前更新想對應的細項立帳預沖金額
               CALL aglt310_06_update_glax()
               
               #刪除已存在的細項沖帳資料
               DELETE FROM glay_t
                WHERE glayent=g_enterprise AND glayld=g_glaxld
                  AND glaydocno=g_glapdocno AND glayseq=g_glaqseq
            END IF
            LET l_flag=FALSE
         END IF
         CALL aglt310_06_insert_glay(li_idx,g_glaqseq)
         
         #更新glax_t立帳資料
         UPDATE glax_t 
            SET glax041=glax041+g_glax_d[li_idx].glax003_2,
                glax043=glax043+g_glax_d[li_idx].glax008_2,
                glax045=glax045+g_glax_d[li_idx].glax010_2,
                glax053=glax053+g_glax_d[li_idx].glax054,
                glax057=glax057+g_glax_d[li_idx].glax058
          WHERE glaxent=g_enterprise AND glaxld=g_glaxld
            AND glaxdocno=g_glax_d[li_idx].glaxdocno
            AND glaxseq=g_glax_d[li_idx].glaxseq
         CASE
            WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
               LET g_success='N'
               CALL cl_errmsg(g_glax_d[li_idx].glaxseq,g_glax_d[li_idx].glaxdocno,"","std-00009",1)
            WHEN SQLCA.sqlcode #其他錯誤
               LET g_success='N'
               CALL cl_errmsg(g_glax_d[li_idx].glaxseq,g_glax_d[li_idx].glaxdocno,"",SQLCA.sqlcode,1)
            OTHERWISE
         END CASE
      END IF
   END FOR
   
#   IF g_success='Y' THEN 
#      #新增憑證傳票單身資料
#      CALL aglt310_06_insert_glaq()
#   END IF
   
   CALL cl_err_showmsg()
   IF g_success='N' THEN
      LET g_flag=FALSE  #未產生沖抵資料
   END IF
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_insert_glaq" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="12" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 描述说明
# Memo...........: 新增一筆憑證傳票單身資料glaq_t
# Usage..........: CALL aglt310_06_insert_glaq()
# Date & Author..: 14/02/07 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_insert_glaq()
   DEFINE l_glaq        RECORD LIKE glaq_t.*
   DEFINE l_glay        RECORD LIKE glay_t.*
   DEFINE l_glad004     LIKE glad_t.glad004
   DEFINE l_sql         STRING
   
   #刪除已存在的憑證單身資料
   DELETE FROM glaq_t
   WHERE glaqent=g_enterprise AND glaqld=g_glaxld
     AND glaqdocno=g_glapdocno AND glaqseq=g_glaqseq
     
   LET l_sql="SELECT glayent,glayld,glaycomp,glaydocno,glayseq,",
             "       glay001,glay002,glay003,glay005,glay006,glay007,glay008,glay009,glay010,",
             "       glay011,glay012,glay013,glay014,glay015,glay016,glay017,glay018,glay019,glay020,",
             "       glay021,glay022,glay023,glay024,glay025,glay026,glay027,glay028,glay029,glay030,",
             "       glay031,glay032,glay033,glay034,glay035,glay036,glay037,glay038,glay051,glay052,",
             "       glay053,glay054 ",
             "  FROM glay_t",
             " WHERE glayent='",g_enterprise,"'  AND glayld='",g_glaxld,"'",
             "   AND glaydocno='",g_glapdocno,"' AND glay002='",g_glax002,"' ",
             " ORDER BY glay_t.glayseq "
   PREPARE aglt310_06_pr1 FROM l_sql
   DECLARE aglt310_06_cs1 CURSOR FOR aglt310_06_pr1
   
   FOREACH aglt310_06_cs1 INTO l_glay.glayent,l_glay.glayld,l_glay.glaycomp,l_glay.glaydocno,l_glay.glayseq,
                               l_glay.glay001,l_glay.glay002,l_glay.glay003,l_glay.glay005,
                               l_glay.glay006,l_glay.glay007,l_glay.glay008,l_glay.glay009,l_glay.glay010,
                               l_glay.glay011,l_glay.glay012,l_glay.glay013,l_glay.glay014,l_glay.glay015,
                               l_glay.glay016,l_glay.glay017,l_glay.glay018,l_glay.glay019,l_glay.glay020,
                               l_glay.glay021,l_glay.glay022,l_glay.glay023,l_glay.glay024,l_glay.glay025,
                               l_glay.glay026,l_glay.glay027,l_glay.glay028,l_glay.glay029,l_glay.glay030,
                               l_glay.glay031,l_glay.glay032,l_glay.glay033,l_glay.glay034,l_glay.glay035,
                               l_glay.glay036,l_glay.glay037,l_glay.glay038,l_glay.glay051,l_glay.glay052,
                               l_glay.glay053,l_glay.glay054
      IF SQLCA.sqlcode THEN
         LET g_success='N'
         CALL cl_errmsg(l_glay.glayseq,l_glay.glaydocno,'',SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF 
      LET l_glaq.glaqent=g_enterprise 
      LET l_glaq.glaqcomp=g_glaacomp
      LET l_glaq.glaqld=g_glaxld
      LET l_glaq.glaqdocno=g_glapdocno
      LET l_glaq.glaqseq=l_glay.glayseq
      
      LET l_glaq.glaq001=l_glay.glay001 #摘要
      LET l_glaq.glaq002=g_glax002 #科目
      
      SELECT glad004 INTO l_glad004 FROM glad_t
      WHERE gladent=g_enterprise AND gladld=g_glaxld
        AND glad001=g_glax002
      IF l_glad004='1' THEN #借方立帳
         LET l_glaq.glaq003=0              #借方金額
         LET l_glaq.glaq004=l_glay.glay003 #貸方金額
         LET l_glaq.glaq040=0              #借方金額(本位幣二)
         LET l_glaq.glaq041=l_glay.glay052 #貸方金額(本位幣二)
         LET l_glaq.glaq043=0              #借方金額(本位幣三)
         LET l_glaq.glaq044=l_glay.glay054 #貸方金額(本位幣三)
      ELSE
         LET l_glaq.glaq003=l_glay.glay003 #借方金額
         LET l_glaq.glaq004=0              #貸方金額
         LET l_glaq.glaq040=l_glay.glay052 #借方金額(本位幣二)
         LET l_glaq.glaq041=0              #貸方金額(本位幣二)
         LET l_glaq.glaq043=l_glay.glay054 #借方金額(本位幣三)
         LET l_glaq.glaq044=0              #貸方金額(本位幣三)
      END IF
      LET l_glaq.glaq039=l_glay.glay051 #匯率(本位幣二)
      LET l_glaq.glaq042=l_glay.glay053 #匯率(本位幣三)
      LET l_glaq.glaq008=l_glay.glay008    #數量
      LET l_glaq.glaq010=l_glay.glay010    #原幣金額
      
      LET l_glaq.glaq005=l_glay.glay005
      LET l_glaq.glaq006=l_glay.glay006
      LET l_glaq.glaq007=l_glay.glay007
      LET l_glaq.glaq009=l_glay.glay009
   
      LET l_glaq.glaq011=l_glay.glay011
      LET l_glaq.glaq012=l_glay.glay012
      LET l_glaq.glaq013=l_glay.glay013
      LET l_glaq.glaq014=l_glay.glay014
      LET l_glaq.glaq015=l_glay.glay015
      LET l_glaq.glaq016=l_glay.glay016
      LET l_glaq.glaq017=l_glay.glay017
      LET l_glaq.glaq018=l_glay.glay018
      LET l_glaq.glaq019=l_glay.glay019
      LET l_glaq.glaq020=l_glay.glay020
   
      LET l_glaq.glaq021=l_glay.glay021
      LET l_glaq.glaq022=l_glay.glay022
      LET l_glaq.glaq023=l_glay.glay023
      LET l_glaq.glaq024=l_glay.glay024
      LET l_glaq.glaq025=l_glay.glay025
      LET l_glaq.glaq026=l_glay.glay026
      LET l_glaq.glaq027=l_glay.glay027
      LET l_glaq.glaq028=l_glay.glay028
      #自由核算項
      LET l_glaq.glaq029=l_glay.glay029
      LET l_glaq.glaq030=l_glay.glay030   
      LET l_glaq.glaq031=l_glay.glay031
      LET l_glaq.glaq032=l_glay.glay032
      LET l_glaq.glaq033=l_glay.glay033
      LET l_glaq.glaq034=l_glay.glay034
      LET l_glaq.glaq035=l_glay.glay035
      LET l_glaq.glaq036=l_glay.glay036
      LET l_glaq.glaq037=l_glay.glay037
      LET l_glaq.glaq038=l_glay.glay038
      
      INSERT INTO glaq_t(
      glaqent,glaqcomp,glaqld,glaqdocno,glaqseq,
      glaq001,glaq002,glaq003,glaq004,glaq005,
      glaq006,glaq007,glaq008,glaq009,glaq010,
      glaq011,glaq012,glaq013,glaq014,glaq015,
      glaq016,glaq017,glaq018,glaq019,glaq020,
      glaq021,glaq022,glaq023,glaq024,glaq025,
      glaq026,glaq027,glaq028,glaq029,glaq030,
      glaq031,glaq032,glaq033,glaq034,glaq035,
      glaq036,glaq037,glaq038,glaq039,glaq040,
      glaq041,glaq042,glaq043,glaq044) 
      VALUES (
      l_glaq.glaqent,l_glaq.glaqcomp,l_glaq.glaqld,l_glaq.glaqdocno,l_glaq.glaqseq,
      l_glaq.glaq001,l_glaq.glaq002,l_glaq.glaq003,l_glaq.glaq004,l_glaq.glaq005,
      l_glaq.glaq006,l_glaq.glaq007,l_glaq.glaq008,l_glaq.glaq009,l_glaq.glaq010,
      l_glaq.glaq011,l_glaq.glaq012,l_glaq.glaq013,l_glaq.glaq014,l_glaq.glaq015,
      l_glaq.glaq016,l_glaq.glaq017,l_glaq.glaq018,l_glaq.glaq019,l_glaq.glaq020,
      l_glaq.glaq021,l_glaq.glaq022,l_glaq.glaq023,l_glaq.glaq024,l_glaq.glaq025,
      l_glaq.glaq026,l_glaq.glaq027,l_glaq.glaq028,l_glaq.glaq029,l_glaq.glaq030,
      l_glaq.glaq031,l_glaq.glaq032,l_glaq.glaq033,l_glaq.glaq034,l_glaq.glaq035,
      l_glaq.glaq036,l_glaq.glaq037,l_glaq.glaq038,l_glaq.glaq039,l_glaq.glaq040,
      l_glaq.glaq041,l_glaq.glaq042,l_glaq.glaq043,l_glaq.glaq044)
      IF SQLCA.sqlcode THEN
         LET g_success='N'
         CALL cl_errmsg(l_glaq.glaqseq,l_glaq.glaqdocno,'',SQLCA.sqlcode,1)
      END IF
   END FOREACH
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_insert_glay" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="13" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 描述说明
# Memo...........: 新增一筆傳票項次沖帳異動檔glay_t
# Usage..........: CALL aglt310_06_insert_glay(p_id,p_seq)
# Input parameter: p_id   數組序號
#                : p_seq  憑證單身項次
# Date & Author..: 14/02/07 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_insert_glay(p_id,p_seq)
   DEFINE p_id        LIKE type_t.num10
   DEFINE p_seq       LIKE glay_t.glayseq
   DEFINE l_glapdocdt LIKE glap_t.glapdocdt
   DEFINE l_glap002   LIKE glap_t.glap002
   DEFINE l_glap004   LIKE glap_t.glap004
   DEFINE l_glay      RECORD LIKE glay_t.*
   DEFINE l_glax      RECORD LIKE glax_t.*
   DEFINE l_glaqseq   LIKE glaq_t.glaqseq
   DEFINE l_glayseq1  LIKE glay_t.glayseq1
   DEFINE l_glad004   LIKE glad_t.glad004
   DEFINE l_glaq003   LIKE glaq_t.glaq003
   DEFINE l_glaq004   LIKE glaq_t.glaq004
   DEFINE l_glaq040   LIKE glaq_t.glaq040
   DEFINE l_glaq041   LIKE glaq_t.glaq041
   DEFINE l_glaq043   LIKE glaq_t.glaq043
   DEFINE l_glaq044   LIKE glaq_t.glaq044

   LET l_glay.glayent=g_enterprise
   LET l_glay.glayld=g_glaxld
   LET l_glay.glaycomp=g_glaacomp
   LET l_glay.glaydocno=g_glapdocno
   #傳票項次
   IF NOT cl_null(p_seq) THEN 
      LET l_glay.glayseq=p_seq
   ELSE
      SELECT MAX(glaqseq)+1 INTO l_glaqseq 
        FROM glaq_t
       WHERE glaqent = g_enterprise
         AND glaqld = g_glaxld
         AND glaqdocno = g_glapdocno
      LET l_glay.glayseq=l_glaqseq
   END IF
   SELECT glapdocdt,glap002,glap004 
     INTO l_glapdocdt,l_glap002,l_glap004
     FROM glap_t 
    WHERE glapent=g_enterprise AND glapld=g_glaxld 
      AND glapdocno=g_glapdocno
   LET l_glay.glaydocdt=l_glapdocdt #沖帳傳票日期
   LET l_glay.glay049=l_glap002     #會計年度
   LET l_glay.glay050=l_glap004     #會計期別
   #序號
   SELECT MAX(glayseq1)+1 INTO l_glayseq1 FROM glay_t
    WHERE glayent=g_enterprise  AND glayld=g_glaxld 
      AND glaydocno=l_glay.glaydocno
      AND glayseq=l_glay.glayseq    
   IF cl_null(l_glayseq1) OR l_glayseq1=0 THEN 
      LET l_glayseq1=1 
   END IF
   LET l_glay.glayseq1=l_glayseq1
   
   LET l_glay.glay003=g_glax_d[p_id].glax003_2    #本幣沖帳金額
   LET l_glay.glay008=g_glax_d[p_id].glax008_2    #沖帳數量
   IF cl_null(l_glay.glay003) THEN LET l_glay.glay003=0 END IF
   IF cl_null(l_glay.glay008) THEN LET l_glay.glay008=0 END IF
   
   #本位幣二
   IF g_glaa015='Y' THEN
      LET l_glay.glay051=g_glax_d[p_id].glax051
      LET l_glay.glay052=g_glax_d[p_id].glax054
   ELSE
      LET l_glay.glay051=0
      LET l_glay.glay052=0
   END IF
   #本位幣三
   IF g_glaa019='Y' THEN
      LET l_glay.glay053=g_glax_d[p_id].glax055
      LET l_glay.glay054=g_glax_d[p_id].glax058
   ELSE
      LET l_glay.glay053=0
      LET l_glay.glay054=0
   END IF
   SELECT glax_t.* INTO l_glax.* FROM glax_t
    WHERE glaxent=g_enterprise AND glaxld=g_glaxld
      AND glaxdocno=g_glax_d[p_id].glaxdocno
      AND glaxseq=g_glax_d[p_id].glaxseq
   LET l_glay.glay001=l_glax.glax001 
   LET l_glay.glay002=g_glax002
   IF g_glap014='Y' THEN
      LET l_glay.glay005=l_glax.glax005
      LET l_glay.glay006=l_glax.glax006
      LET l_glay.glay010=g_glax_d[p_id].glax010_2    #原幣沖帳金額
      IF cl_null(l_glay.glay010) THEN LET l_glay.glay010=0 END IF
   ELSE
      LET l_glay.glay005=g_glaa001 #本位幣一
      LET l_glay.glay006=1
      LET l_glay.glay010=l_glay.glay003
      IF g_glaa015='Y' THEN
         LET l_glay.glay051=l_glay.glay052/l_glay.glay003
      END IF
      IF g_glaa019='Y' THEN
         LET l_glay.glay053=l_glay.glay054/l_glay.glay003
      END IF
   END IF
   LET l_glay.glay007=l_glax.glax007
   LET l_glay.glay009=l_glax.glax009
   
   LET l_glay.glay011=l_glax.glax011
   LET l_glay.glay012=l_glax.glax012
   LET l_glay.glay013=l_glax.glax013
   LET l_glay.glay014=l_glax.glax014
   LET l_glay.glay015=l_glax.glax015
   LET l_glay.glay016=l_glax.glax016
   LET l_glay.glay017=l_glax.glax017
   LET l_glay.glay018=l_glax.glax018
   LET l_glay.glay019=l_glax.glax019
   LET l_glay.glay020=l_glax.glax020
   
   LET l_glay.glay021=l_glax.glax021
   LET l_glay.glay022=l_glax.glax022
   LET l_glay.glay023=l_glax.glax023
   LET l_glay.glay024=l_glax.glax024
   LET l_glay.glay025=l_glax.glax025
   LET l_glay.glay026=l_glax.glax026
   LET l_glay.glay027=l_glax.glax027
   LET l_glay.glay028=l_glax.glax028
   LET l_glay.glay029=l_glax.glax029
   LET l_glay.glay030=l_glax.glax030
   
   LET l_glay.glay031=l_glax.glax031
   LET l_glay.glay032=l_glax.glax032
   LET l_glay.glay033=l_glax.glax033
   LET l_glay.glay034=l_glax.glax034
   LET l_glay.glay035=l_glax.glax035
   LET l_glay.glay036=l_glax.glax036
   LET l_glay.glay037=l_glax.glax037
   LET l_glay.glay038=l_glax.glax038
   
   LET l_glay.glay041=l_glax.glaxdocno
   LET l_glay.glay042=l_glax.glaxseq
   #異動諮詢
   LET l_glay.glayownid=g_user
   LET l_glay.glayowndp=g_dept
   LET l_glay.glaycrtid=g_user
   LET l_glay.glaycrtdp=g_dept
   LET l_glay.glaycrtdt=cl_get_current()
   LET l_glay.glaystus='N'
   
   INSERT INTO glay_t(
   glayent,glayld,glaycomp,glaydocno,glayseq,glaydocdt,glayseq1,
   glay001,glay002,glay003,glay005,glay006,glay007,glay008,glay009,glay010,
   glay011,glay012,glay013,glay014,glay015,glay016,glay017,glay018,glay019,glay020,
   glay021,glay022,glay023,glay024,glay025,glay026,glay027,glay028,glay029,glay030,
   glay031,glay032,glay033,glay034,glay035,glay036,glay037,glay038,
   glay041,glay042,glay049,glay050,glay051,glay052,glay053,glay054,
   glayownid,glayowndp,glaycrtid,glaycrtdp,glaycrtdt,glaystus
   ) 
   VALUES (
   l_glay.glayent,l_glay.glayld,   l_glay.glaycomp,l_glay.glaydocno,
   l_glay.glayseq,l_glay.glaydocdt,l_glay.glayseq1,
   l_glay.glay001,l_glay.glay002,l_glay.glay003,l_glay.glay005,
   l_glay.glay006,l_glay.glay007,l_glay.glay008,l_glay.glay009,l_glay.glay010,
   l_glay.glay011,l_glay.glay012,l_glay.glay013,l_glay.glay014,l_glay.glay015,
   l_glay.glay016,l_glay.glay017,l_glay.glay018,l_glay.glay019,l_glay.glay020,
   l_glay.glay021,l_glay.glay022,l_glay.glay023,l_glay.glay024,l_glay.glay025,
   l_glay.glay026,l_glay.glay027,l_glay.glay028,l_glay.glay029,l_glay.glay030,
   l_glay.glay031,l_glay.glay032,l_glay.glay033,l_glay.glay034,l_glay.glay035,
   l_glay.glay036,l_glay.glay037,l_glay.glay038,
   l_glay.glay041,l_glay.glay042,l_glay.glay049,l_glay.glay050,
   l_glay.glay051,l_glay.glay052,l_glay.glay053,l_glay.glay054,
   l_glay.glayownid,l_glay.glayowndp,l_glay.glaycrtid,l_glay.glaycrtdp,
   l_glay.glaycrtdt,l_glay.glaystus
   )
   IF SQLCA.sqlcode THEN
      LET g_success='N'
      CALL cl_errmsg(l_glay.glayseq,l_glay.glaydocno,'',SQLCA.sqlcode,1)
   END IF
   
#   #同時插入一筆傳票單身資料
#   SELECT glad004 INTO l_glad004 FROM glad_t
#    WHERE gladent=g_enterprise AND gladld=g_glaxld
#      AND glad001=g_glax002
#   IF l_glad004='1' THEN #借方立帳
#      LET l_glaq003=0              #借方金額
#      LET l_glaq004=l_glay.glay003 #貸方金額
#      LET l_glaq040=0              #借方金額(本位幣二)
#      LET l_glaq041=l_glay.glay052 #貸方金額(本位幣二)
#      LET l_glaq043=0              #借方金額(本位幣三)
#      LET l_glaq044=l_glay.glay054 #貸方金額(本位幣三)
#   ELSE
#      LET l_glaq003=l_glay.glay003 #借方金額
#      LET l_glaq004=0              #貸方金額
#      LET l_glaq040=l_glay.glay052 #借方金額(本位幣二)
#      LET l_glaq041=0              #貸方金額(本位幣二)
#      LET l_glaq043=l_glay.glay054 #借方金額(本位幣三)
#      LET l_glaq044=0              #貸方金額(本位幣三)      
#   END IF
#   INSERT INTO glaq_t(
#      glaqent,glaqcomp,glaqld,glaqdocno,glaqseq,
#      glaq001,glaq002,glaq003,glaq004,glaq005,
#      glaq006,glaq007,glaq008,glaq009,glaq010,
#      glaq011,glaq012,glaq013,glaq014,glaq015,
#      glaq016,glaq017,glaq018,glaq019,glaq020,
#      glaq021,glaq022,glaq023,glaq024,glaq025,
#      glaq026,glaq027,glaq028,glaq029,glaq030,
#      glaq031,glaq032,glaq033,glaq034,glaq035,
#      glaq036,glaq037,glaq038,glaq039,glaq040,
#      glaq041,glaq042,glaq043,glaq044) 
#      VALUES (
#      l_glay.glayent,l_glay.glaycomp,l_glay.glayld,l_glay.glaydocno,l_glay.glayseq,
#      l_glay.glay001,l_glay.glay002,l_glaq003,l_glaq004,l_glay.glay005,
#      l_glay.glay006,l_glay.glay007,l_glay.glay008,l_glay.glay009,l_glay.glay010,
#      l_glay.glay011,l_glay.glay012,l_glay.glay013,l_glay.glay014,l_glay.glay015,
#      l_glay.glay016,l_glay.glay017,l_glay.glay018,l_glay.glay019,l_glay.glay020,
#      l_glay.glay021,l_glay.glay022,l_glay.glay023,l_glay.glay024,l_glay.glay025,
#      l_glay.glay026,l_glay.glay027,l_glay.glay028,l_glay.glay029,l_glay.glay030,
#      l_glay.glay031,l_glay.glay032,l_glay.glay033,l_glay.glay034,l_glay.glay035,
#      l_glay.glay036,l_glay.glay037,l_glay.glay038,l_glay.glay051,l_glaq040,
#      l_glaq041,l_glay.glay053,l_glaq043,l_glaq044)
#      IF SQLCA.sqlcode THEN
#         LET g_success='N'
#         CALL cl_errmsg(l_glay.glayseq,l_glay.glaydocno,'',SQLCA.sqlcode,1)
#      END IF
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_mark_sql" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="14" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 獲取該科目啟用的核算項組合的SQL語句
# Memo...........:
# Usage..........: CALL aglt310_06_mark_sql(p_glaqld,p_glaq002)
#                  RETURNING r_sql
# Input parameter: p_glaqld       帳套
#                : p_glaq002      科目編號
# Return code....: r_sql          組合后SQL語句
# Date & Author..: 2014/04/15 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_mark_sql(p_glaqld,p_glaq002)
   DEFINE p_glaqld         LIKE glaq_t.glaqld
   DEFINE p_glaq002        LIKE glaq_t.glaq002
   DEFINE l_glaa004        LIKE glaa_t.glaa004
   #科目固定核算项
   DEFINE l_glad007       LIKE glad_t.glad007
   DEFINE l_glad008       LIKE glad_t.glad008
   DEFINE l_glad009       LIKE glad_t.glad009
   DEFINE l_glad010       LIKE glad_t.glad010
   DEFINE l_glad027       LIKE glad_t.glad027
   DEFINE l_glad011       LIKE glad_t.glad011
   DEFINE l_glad012       LIKE glad_t.glad012
   DEFINE l_glad013       LIKE glad_t.glad013
   DEFINE l_glad014       LIKE glad_t.glad014
   DEFINE l_glad015       LIKE glad_t.glad015
   DEFINE l_glad016       LIKE glad_t.glad016
   #科目自由核算項
   DEFINE l_glad017        LIKE glad_t.glad017  
   DEFINE l_glad018        LIKE glad_t.glad018
   DEFINE l_glad019        LIKE glad_t.glad019
   DEFINE l_glad020        LIKE glad_t.glad020
   DEFINE l_glad021        LIKE glad_t.glad021
   DEFINE l_glad022        LIKE glad_t.glad022
   DEFINE l_glad023        LIKE glad_t.glad023
   DEFINE l_glad024        LIKE glad_t.glad024
   DEFINE l_glad025        LIKE glad_t.glad025
   DEFINE l_glad026        LIKE glad_t.glad026  
   DEFINE r_sql            STRING
   
   SELECT glaa004 INTO l_glaa004 FROM glaa_t
   WHERE glaaent=g_enterprise AND glaald=p_glaqld
   CALL s_voucher_fix_acc_open_chk(p_glaqld,p_glaq002,l_glaa004)
   RETURNING l_glad007,l_glad008,l_glad009,l_glad010,l_glad027,l_glad011,
             l_glad012,l_glad013,l_glad014,l_glad015,l_glad016
   LET r_sql=" glax017=glaq017 "
   
   IF l_glad007='Y' THEN
      LET r_sql=r_sql," AND glax018=glaq018 "
   ELSE
      LET r_sql=r_sql," AND glax018 IS NULL AND glaq018 IS NULL"
   END IF
   
   IF l_glad008='Y' THEN
      LET r_sql=r_sql," AND glax019=glaq019 "
   ELSE
      LET r_sql=r_sql," AND glax019 IS NULL AND glaq019 IS NULL"
   END IF
   
   IF l_glad009='Y' THEN
      LET r_sql=r_sql," AND glax020=glaq020 "
   ELSE
      LET r_sql=r_sql," AND glax020 IS NULL AND glaq020 IS NULL"
   END IF
   
   IF l_glad010='Y' THEN
      LET r_sql=r_sql," AND glax021=glaq021 "
   ELSE
      LET r_sql=r_sql," AND glax021 IS NULL AND glaq021 IS NULL"
   END IF
   
   IF l_glad027='Y' THEN
      LET r_sql=r_sql," AND glax022=glaq022"
   ELSE
      LET r_sql=r_sql," AND glax022 IS NULL AND glaq022 IS NULL"
   END IF
   
   IF l_glad011='Y' THEN
      LET r_sql=r_sql," AND glax023=glaq023 "
   ELSE
      LET r_sql=r_sql," AND glax023 IS NULL AND glaq023 IS NULL"
   END IF
   
   IF l_glad012='Y' THEN
      LET r_sql=r_sql," AND glax024=glaq024 "
   ELSE
      LET r_sql=r_sql," AND glax024 IS NULL AND glaq024 IS NULL"
   END IF
   
   IF l_glad013='Y' THEN
      LET r_sql=r_sql," AND glax025=glaq025 "
   ELSE
      LET r_sql=r_sql," AND glax025 IS NULL AND glaq025 IS NULL"
   END IF
   
   IF l_glad014='Y' THEN
      LET r_sql=r_sql," AND glax026=glaq026 "
   ELSE
      LET r_sql=r_sql," AND glax026 IS NULL AND glaq026 IS NULL"
   END IF
   
   IF l_glad015='Y' THEN
      LET r_sql=r_sql," AND glax027=glaq027 "
   ELSE
      LET r_sql=r_sql," AND glax027 IS NULL AND glaq027 IS NULL"
   END IF
   
   IF l_glad016='Y' THEN
      LET r_sql=r_sql," AND glax028=glaq028 "
   ELSE
      LET r_sql=r_sql," AND glax028 IS NULL AND glaq028 IS NULL"
   END IF
   #是否啟用自由核算項
   SELECT glad017,glad018,glad019,glad020,glad021,
          glad022,glad023,glad024,glad025,glad026
     INTO l_glad017,l_glad018,l_glad019,l_glad020,l_glad021,
          l_glad022,l_glad023,l_glad024,l_glad025,l_glad026
     FROM glad_t
    WHERE gladent = g_enterprise
      AND gladld  = p_glaqld
      AND glad001 = p_glaq002
      
   IF l_glad017='Y' THEN
      LET r_sql=r_sql," AND glax029=glaq029 "
   ELSE
      LET r_sql=r_sql," AND glax029 IS NULL AND glaq029 IS NULL"
   END IF
   
   IF l_glad018='Y' THEN
      LET r_sql=r_sql," AND glax030=glaq030 "
   ELSE
      LET r_sql=r_sql," AND glax030 IS NULL AND glaq030 IS NULL"
   END IF
   
   IF l_glad019='Y' THEN
      LET r_sql=r_sql," AND glax031=glaq031 "
   ELSE
      LET r_sql=r_sql," AND glax031 IS NULL AND glaq031 IS NULL"
   END IF
   
   IF l_glad020='Y' THEN
      LET r_sql=r_sql," AND glax032=glaq032 "
   ELSE
      LET r_sql=r_sql," AND glax032 IS NULL AND glaq032 IS NULL"
   END IF
   
   IF l_glad021='Y' THEN
      LET r_sql=r_sql," AND glax033=glaq033 "
   ELSE
      LET r_sql=r_sql," AND glax033 IS NULL AND glaq033 IS NULL"
   END IF
   
   IF l_glad022='Y' THEN
      LET r_sql=r_sql," AND glax034=glaq034 "
   ELSE
      LET r_sql=r_sql," AND glax034 IS NULL AND glaq034 IS NULL"
   END IF
   
   IF l_glad023='Y' THEN
      LET r_sql=r_sql," AND glax035=glaq035 "
   ELSE
      LET r_sql=r_sql," AND glax035 IS NULL AND glaq035 IS NULL"
   END IF
   
   IF l_glad024='Y' THEN
      LET r_sql=r_sql," AND glax036=glaq036 "
   ELSE
      LET r_sql=r_sql," AND glax036 IS NULL AND glaq036 IS NULL"
   END IF
   
   IF l_glad025='Y' THEN
      LET r_sql=r_sql," AND glax037=glaq037 "
   ELSE
      LET r_sql=r_sql," AND glax037 IS NULL AND glaq037 IS NULL"
   END IF
   
   IF l_glad026='Y' THEN
      LET r_sql=r_sql," AND glax038=glaq038 "
   ELSE
      LET r_sql=r_sql," AND glax038 IS NULL AND glaq038 IS NULL"
   END IF
   
   RETURN r_sql
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_make_sql_desc" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="15" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 描述说明
# Memo...........: 組合sql語句
# Usage..........: CALL aglt310_06_make_sql_desc(p_glae001)
#                  RETURNING r_sql
# Input parameter: p_glae001   核算項類型
# Return code....: r_sql       sql語句
# Date & Author..: 14/01/28 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_make_sql_desc(p_glae001)
   DEFINE p_glae001   LIKE glae_t.glae001   #核算项类型
   DEFINE r_sql       STRING
   DEFINE l_glae003   LIKE glae_t.glae003   #来源档案
   DEFINE l_glae004   LIKE glae_t.glae004   #来源编号栏位
   DEFINE l_glae005   LIKE glae_t.glae005   #来源说明档案
   DEFINE l_glae006   LIKE glae_t.glae006   #来源说明栏位  
   DEFINE l_dzeb002   LIKE dzeb_t.dzeb002   #栏位代号
   DEFINE l_dzeb006   LIKE dzeb_t.dzeb002   #栏位属性    
   DEFINE l_sql     STRING
   DEFINE li_sql1   STRING    #抓主档表的key
   DEFINE li_sql2   STRING    #抓对应多语言表的key 
   #抓取主表的key放入数组
   DEFINE li_main    DYNAMIC ARRAY OF RECORD
          dzeb002    LIKE dzeb_t.dzeb002       
   END RECORD 
   #抓取多语言表的key放入数组
   DEFINE li_dlang    DYNAMIC ARRAY OF RECORD
          dzeb002    LIKE dzeb_t.dzeb002       
   END RECORD 
   DEFINE l_where   STRING    #组出的对应的抓取说明的where条件    
   DEFINE l_i,l_i2,l_i3       LIKE type_t.num5
    
   #初始化
   CALL li_main.clear()
   CALL li_dlang.clear()
   
   #抓取来源档案，来源说明档案，来源说明栏位
   SELECT glae003,glae004,glae005,glae006 INTO l_glae003,l_glae004,l_glae005,l_glae006 FROM glae_t
    WHERE glaeent = g_enterprise
      AND glae001 = p_glae001
      
   #抓取主档key
   LET l_i = 1
   LET li_sql1 = " SELECT dzeb002 FROM dzeb_t ",
                 "  WHERE dzeb001 = '",l_glae003,"'",
                 "    AND dzeb004 = 'Y'", 
                 "  ORDER BY dzeb021 " 
   PREPARE aglt310_pr FROM li_sql1
   DECLARE aglt310_cs CURSOR FOR aglt310_pr
   FOREACH aglt310_cs INTO li_main[l_i].dzeb002
       LET l_i = l_i +1
   END FOREACH
   #真实数组长度
   LET l_i = l_i -1  
   
   #抓取多语言档key
   LET l_i2 = 1
   LET li_sql2 = " SELECT dzeb002 FROM dzeb_t ",
                 " WHERE dzeb001 = '",l_glae005,"'" ,
                  "  AND dzeb004 = 'Y'",
                 " ORDER BY dzeb021 "
   PREPARE aglt310_pr2 FROM li_sql2
   DECLARE aglt310_cs2 CURSOR FOR aglt310_pr2
   FOREACH aglt310_cs2 INTO li_dlang[l_i2].dzeb002
       LET l_i2 = l_i2 +1
   END FOREACH
   #真实数组长度
   LET l_i2 = l_i2 -1  

   
   #组合where条件 
   LET l_where = '1=1'
   FOR  l_i3 = 1 TO  l_i 
       LET l_where = l_where," AND ", li_main[l_i3].dzeb002, " = " ,li_dlang[l_i3].dzeb002
   END FOR    
   
   #组出的基础sql   
   LET r_sql = " SELECT ", l_glae006 ," FROM ",l_glae005 ,',',l_glae003,
               " WHERE " , l_glae004," = ?",
               "   AND " ,l_where
   #组sql               
   LET l_sql = "SELECT dzeb002,dzeb006 FROM dzeb_t ",
               " WHERE dzeb001 = '",l_glae005,"'",
               "   AND dzeb004 = 'Y'"
   PREPARE aglt310_make_sql_pre1 FROM l_sql
   DECLARE aglt310_make_sql_cs1 CURSOR FOR aglt310_make_sql_pre1
   FOREACH aglt310_make_sql_cs1 INTO l_dzeb002,l_dzeb006
      #判断是否有ent栏位
      IF l_dzeb006 = 'N802' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_enterprise,"' "
      END IF 
      
      IF l_dzeb006 = 'C800' THEN
         LET r_sql = r_sql CLIPPED," AND ",l_dzeb002 ," ='",g_dlang,"' "
      END IF

   END FOREACH
   RETURN r_sql
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_update_glax" cite_std="N" status="u" ver="1" src="s" new="Y" cite_ver="" order="16" mark_hard="N">
<![CDATA[################################################################################
# Descriptions...: 當刪除細項沖帳資料時更新對應立帳預沖金額
# Memo...........:
# Usage..........: CALL aglt310_06_update_glax()
# Date & Author..: 14/02/19 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_update_glax()
   DEFINE l_glay003    LIKE glay_t.glay003
   DEFINE l_glay005    LIKE glay_t.glay005
   DEFINE l_glay008    LIKE glay_t.glay008
   DEFINE l_glay010    LIKE glay_t.glay010
   DEFINE l_glay041    LIKE glay_t.glay041
   DEFINE l_glay042    LIKE glay_t.glay042
   DEFINE l_glay052    LIKE glay_t.glay052
   DEFINE l_glay054    LIKE glay_t.glay054
   DEFINE l_glax005    LIKE glax_t.glax005
   DEFINE l_glax006    LIKE glax_t.glax006
   DEFINE l_ooaj004_o  LIKE ooaj_t.ooaj004
   DEFINE l_sql        STRING
   
   LET l_sql="SELECT glay003,glay005,glay008,glay010,glay041,glay042,glay052,glay054 FROM glay_t ",
             " WHERE glayent='",g_enterprise,"' ",
             "   AND glayld='",g_glaxld,"' ",
             "   AND glaydocno='",g_glapdocno,"' ",
             "   AND glayseq=",g_glaqseq
   PREPARE aglt310_06_upd_pr1 FROM l_sql
   DECLARE aglt310_06_upd_cs1 CURSOR FOR aglt310_06_upd_pr1
   
   FOREACH aglt310_06_upd_cs1 INTO l_glay003,l_glay005,l_glay008,l_glay010,l_glay041,l_glay042,l_glay052,l_glay054 
      IF SQLCA.sqlcode THEN
         CALL cl_err('FOREACH',SQLCA.sqlcode ,0)
         LET g_success=FALSE
         EXIT FOREACH
      END IF
      
      #當立帳幣別與沖帳幣別不同時，通過本幣金額換算原幣金額   
      SELECT glax005,glax006 INTO l_glax005,l_glax006 FROM glax_t
       WHERE glaxent=g_enterprise AND glaxld=g_glaxld
         AND glaxdocno=l_glay041
         AND glaxseq=l_glay042
      IF l_glay005<>l_glax005 THEN
         LET l_glay010=l_glay003/l_glax006
         #取原幣的金额小數位數
         CALL s_curr_sel_ooaj004(g_glaa026,l_glax005) RETURNING l_ooaj004_o 
         CALL s_num_round('1',l_glay010,l_ooaj004_o) RETURNING l_glay010
      END IF
      
      UPDATE glax_t 
         SET glax041=glax041-l_glay003,
             glax043=glax043-l_glay008,
             glax045=glax045-l_glay010,
             glax053=glax053-l_glay052,
             glax057=glax057-l_glay054
       WHERE glaxent=g_enterprise AND glaxld=g_glaxld
         AND glaxdocno=l_glay041
         AND glaxseq=l_glay042
      CASE
         WHEN SQLCA.sqlerrd[3] = 0  #更新不到的處理
            LET g_success='N'
            CALL cl_errmsg(l_glay042,l_glay041,"","std-00009",1)
         WHEN SQLCA.sqlcode #其他錯誤
            LET g_success='N'
            CALL cl_errmsg(l_glay042,l_glay041,"",SQLCA.sqlcode,1)
         OTHERWISE
      END CASE
   END FOREACH  
END FUNCTION]]>
</point>
  <point name="function.aglt310_06_set_comp_entry" cite_std="N" status="" ver="1" src="s" new="Y" cite_ver="" order="17" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 動態設定元件是否需輸入值
# Memo...........:
# Usage..........: CALL aglt310_06_set_comp_entry(ps_fields,pi_entry)
# Input parameter: ps_fields   欄位名稱
#                : pi_entry    是否進入欄位
# Date & Author..: 2014/04/10 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglt310_06_set_comp_entry(ps_fields,pi_entry)
   DEFINE ps_fields STRING,
          pi_entry  LIKE type_t.num5           
   DEFINE lst_fields base.StringTokenizer,
          ls_field_name STRING
   DEFINE lwin_curr     ui.Window
   DEFINE lnode_win     om.DomNode,
          llst_items    om.NodeList,
          li_i          LIKE type_t.num5,        
          lnode_item    om.DomNode,
          ls_item_name  STRING
 
   IF g_bgjob = 'Y' AND g_gui_type NOT MATCHES "[13]"  THEN  
      RETURN
   END IF
 
   IF (ps_fields IS NULL) THEN
      RETURN
   END IF
 
   LET ps_fields = ps_fields.toLowerCase()
 
   LET lst_fields = base.StringTokenizer.create(ps_fields, ",")
 
   LET lwin_curr = ui.Window.getCurrent()
   LET lnode_win = lwin_curr.getNode()
 
   LET llst_items = lnode_win.selectByPath("//Form//*")
 
   WHILE lst_fields.hasMoreTokens()
     LET ls_field_name = lst_fields.nextToken()
     LET ls_field_name = ls_field_name.trim()
 
     IF (ls_field_name.getLength() > 0) THEN
        FOR li_i = 1 TO llst_items.getLength()
            LET lnode_item = llst_items.item(li_i)
            LET ls_item_name = lnode_item.getAttribute("colName")
 
            IF (ls_item_name IS NULL) THEN
               LET ls_item_name = lnode_item.getAttribute("name")
 
               IF (ls_item_name IS NULL) THEN
                  CONTINUE FOR
               END IF
            END IF
 
            LET ls_item_name = ls_item_name.trim()
 
            IF (ls_item_name.equals(ls_field_name)) THEN
               IF (pi_entry) THEN
                  CALL lnode_item.setAttribute("noEntry", "0")
                  CALL lnode_item.setAttribute("active", "1")
               ELSE
                  CALL lnode_item.setAttribute("noEntry", "1")
                  CALL lnode_item.setAttribute("active", "0")
               END IF
 
               EXIT FOR
            END IF
        END FOR
     END IF
   END WHILE
END FUNCTION]]>
</point>
  <point name="b_fill.others.fill" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="b_fill.sql_after" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="b_fill.sql_before" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="cs.before_construct" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="default_search.define" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="detail_show.after" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="detail_show.before" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="global.variable" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[DEFINE g_glaxld             LIKE glax_t.glaxld
DEFINE g_glax002            LIKE glax_t.glax002
DEFINE g_glapdocno          LIKE glap_t.glapdocno
DEFINE g_glaqseq            LIKE glaq_t.glaqseq
DEFINE g_glad005            LIKE glad_t.glad005
DEFINE g_glaacomp           LIKE glaa_t.glaacomp
DEFINE g_glaa001            LIKE glaa_t.glaa001
DEFINE g_glaa015            LIKE glaa_t.glaa015
DEFINE g_glaa016            LIKE glaa_t.glaa016
DEFINE g_glaa017            LIKE glaa_t.glaa017
DEFINE g_glaa019            LIKE glaa_t.glaa019
DEFINE g_glaa020            LIKE glaa_t.glaa020
DEFINE g_glaa021            LIKE glaa_t.glaa021
DEFINE g_glaa026            LIKE glaa_t.glaa026
DEFINE g_ooaj004_o          LIKE ooaj_t.ooaj004
DEFINE g_ooaj004            LIKE ooaj_t.ooaj004
DEFINE g_ooaj004_2          LIKE ooaj_t.ooaj004
DEFINE g_ooaj004_3          LIKE ooaj_t.ooaj004
DEFINE g_glap014            LIKE glap_t.glap014
DEFINE g_flag               LIKE type_t.num5       #判斷是否產生沖抵資料
DEFINE g_rec_b              LIKE type_t.num10
DEFINE g_glax        RECORD
   glax017      LIKE glax_t.glax017,
   glax017_desc LIKE type_t.chr80, 
   glax018      LIKE glax_t.glax018,
   glax018_desc LIKE type_t.chr80, 
   glax019      LIKE glax_t.glax019,
   glax019_desc LIKE type_t.chr80, 
   glax020      LIKE glax_t.glax020,
   glax020_desc LIKE type_t.chr80, 
   glax021      LIKE glax_t.glax021,
   glax021_desc LIKE type_t.chr80, 
   glax022      LIKE glax_t.glax021,
   glax022_desc LIKE type_t.chr80, 
   glax023      LIKE glax_t.glax023,
   glax023_desc LIKE type_t.chr80, 
   glax024      LIKE glax_t.glax024,
   glax024_desc LIKE type_t.chr80, 
   glax025      LIKE glax_t.glax025,
   glax025_desc LIKE type_t.chr80, 
   glax026      LIKE glax_t.glax026,
   glax026_desc LIKE type_t.chr80, 
   glax027      LIKE glax_t.glax027,
   glax027_desc LIKE type_t.chr80, 
   glax028      LIKE glax_t.glax028,
   glax028_desc LIKE type_t.chr80, 
   glax005      LIKE glax_t.glax005,
   glax006      LIKE glax_t.glax006,
   glax007      LIKE glax_t.glax007,
   glax008      LIKE glax_t.glax008,
   glax009      LIKE glax_t.glax009,
   glax010      LIKE glax_t.glax010,
   glax011      LIKE glax_t.glax011,
   glax012      LIKE glax_t.glax012,
   glax013      LIKE glax_t.glax013,
   glax013_desc LIKE type_t.chr80,  
   glax014      LIKE glax_t.glax014,
   glax015      LIKE glax_t.glax015,
   glax016      LIKE glax_t.glax016
END RECORD

DEFINE g_glax_c     RECORD
   glax029      LIKE glax_t.glax029,
   glax029_desc LIKE type_t.chr80, 
   glax030      LIKE glax_t.glax030,
   glax030_desc LIKE type_t.chr80, 
   glax031      LIKE glax_t.glax031,
   glax031_desc LIKE type_t.chr80, 
   glax032      LIKE glax_t.glax032,
   glax032_desc LIKE type_t.chr80, 
   glax033      LIKE glax_t.glax033,
   glax033_desc LIKE type_t.chr80, 
   glax034      LIKE glax_t.glax034,
   glax034_desc LIKE type_t.chr80, 
   glax035      LIKE glax_t.glax035,
   glax035_desc LIKE type_t.chr80, 
   glax036      LIKE glax_t.glax036,
   glax036_desc LIKE type_t.chr80, 
   glax037      LIKE glax_t.glax037,
   glax037_desc LIKE type_t.chr80,
   glax038      LIKE glax_t.glax038,
   glax038_desc LIKE type_t.chr80   
END RECORD]]>
</point>
  <point name="main.after_define_sql" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="main.define_sql" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="main.init" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="query.a.page1.glax003" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glax005" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glax008" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glax010" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glax048" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glax052" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glax056" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glaxdocno" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.a.page1.glaxseq" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.after_construct" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="query.b.page1.glax003" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glax005" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glax008" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glax010" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glax048" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glax052" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glax056" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glaxdocno" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.b.page1.glaxseq" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.c.page1.glax003" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.c.page1.glax008" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.c.page1.glax010" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.c.page1.glax048" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.c.page1.glax052" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.c.page1.glax056" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.c.page1.glaxseq" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[            ]]>
</point>
  <point name="query.define" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[   ]]>
</point>
  <point name="query.more_construct" cite_std="N" status="" ver="1" src="s" new="N" cite_ver="" order="" mark_hard="N">
<![CDATA[      ]]>
</point>
  <point name="main.memo" cite_std="N" status="" ver="" src="s" new="Y" cite_ver="">
<![CDATA[]]>
</point>
  <point name="main.import" cite_std="N" status="" ver="" src="s" new="Y" cite_ver="">
<![CDATA[]]>
</point>
  <point name="global.inc" cite_std="N" status="" ver="" src="s" new="Y" cite_ver="">
<![CDATA[]]>
</point>
  <section id="aglt310_06.description" ver="64" status="" src="s">
<![CDATA[#+ Version..: T100-ERP-1.00.00(SD版次:1,PD版次:1) Build-000173
#+ 
#+ Filename...: aglt310_06
#+ Description: ...
#+ Creator....: 02298(2014/01/09)
#+ Modifier...: 02599(2014/04/18)
#+ Buildtype..: 應用 p00 樣板自動產生
#+ 以上段落由子樣板a00產生
]]>
</section>
  <section id="aglt310_06.free_style_function" ver="1" status="" src="s">
<![CDATA[#add-point:free_style
{<point name="free_style.function"/>}
#end add-point
]]>
</section>
  <section id="aglt310_06.free_style_variable" ver="2" status="" src="s">
<![CDATA[#add-point:free_style模組變數(Module Variable)
{<point name="free_style.variable"/>}
#end add-point
]]>
</section>
  <section id="aglt310_06.global" ver="2" status="" src="s">
<![CDATA[#add-point:註解編寫項目
{<point name="main.memo" />}
#end add-point
 
IMPORT os
#add-point:增加匯入項目
{<point name="main.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
#add-point:增加匯入變數檔
{<point name="global.inc" />}
#end add-point
]]>
</section>
  <section id="aglt310_06.global_variable" ver="1" status="" src="s">
<![CDATA[#add-point:自定義模組變數(Module Variable)
{<point name="global.variable"/>}
#end add-point
]]>
</section>
  <section id="aglt310_06.other_dialog" ver="1" status="" src="s">
<![CDATA[{<point name="other.dialog"/>}
]]>
</section>
  <section id="aglt310_06.other_function" ver="1" status="" src="s">
<![CDATA[{<point name="other.function"/>}
]]>
</section>
</add_points>