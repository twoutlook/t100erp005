<add_points prog="aglq750" std_prog="aglq750" erpver="1.0" module="AGL" ver="1" env="s" zone="t10dev" booking="Y">
  <point name="construct.c.page1.b_glar001" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            LET g_qryparam.where = "glac001 = '",g_glaa004,"' AND glac006 = '1'"
            CALL aglt310_04()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar001  #顯示到畫面上
            NEXT FIELD b_glar001                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar014" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar014  #顯示到畫面上
            NEXT FIELD b_glar014                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar015" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar015  #顯示到畫面上
            NEXT FIELD b_glar015                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar016" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar016  #顯示到畫面上
            NEXT FIELD b_glar016                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar017" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar017  #顯示到畫面上
            NEXT FIELD b_glar017                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar018" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar018  #顯示到畫面上
            NEXT FIELD b_glar018                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar019" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_rtax001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar019  #顯示到畫面上
            NEXT FIELD b_glar019                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar020" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar020  #顯示到畫面上
            NEXT FIELD b_glar020                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.b_glar021" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_bgaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO b_glar021  #顯示到畫面上
            NEXT FIELD b_glar021                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar001" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL aglt310_04()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar001  #顯示到畫面上
            NEXT FIELD glar001                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar014" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooeg001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar014  #顯示到畫面上
            NEXT FIELD glar014                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar015" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar015  #顯示到畫面上
            NEXT FIELD glar015                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar016" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar016  #顯示到畫面上
            NEXT FIELD glar016                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar017" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_pmaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar017  #顯示到畫面上
            NEXT FIELD glar017                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar018" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_oocq002()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar018  #顯示到畫面上
            NEXT FIELD glar018                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar019" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_rtax001_1()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar019  #顯示到畫面上
            NEXT FIELD glar019                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar020" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_ooag001_2()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar020  #顯示到畫面上
            NEXT FIELD glar020                     #返回原欄位
    

]]>
</point>
  <point name="construct.c.page1.glar021" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a08產生
            #開窗c段
            INITIALIZE g_qryparam.* TO NULL
            LET g_qryparam.state = 'c'
            LET g_qryparam.reqry = FALSE
            CALL q_bgaa001()                           #呼叫開窗
            DISPLAY g_qryparam.return1 TO glar021  #顯示到畫面上
            NEXT FIELD glar021                     #返回原欄位
    

]]>
</point>
  <point name="input.a.page1.glar001" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_glar_d[g_detail_idx].glarld IS NOT NULL AND g_glar_d[g_detail_idx].glar001 IS NOT NULL AND g_glar_d[g_detail_idx].glar002 IS NOT NULL AND g_glar_d[g_detail_idx].glar003 IS NOT NULL AND g_glar_d[g_detail_idx].glar004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glar_d[g_detail_idx].glarld != g_glar_d_t.glarld OR g_glar_d[g_detail_idx].glar001 != g_glar_d_t.glar001 OR g_glar_d[g_detail_idx].glar002 != g_glar_d_t.glar002 OR g_glar_d[g_detail_idx].glar003 != g_glar_d_t.glar003 OR g_glar_d[g_detail_idx].glar004 != g_glar_d_t.glar004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glar_t WHERE "||"glarent = '" ||g_enterprise|| "' AND "||"glarld = '"||g_glar_d[g_detail_idx].glarld ||"' AND "|| "glar001 = '"||g_glar_d[g_detail_idx].glar001 ||"' AND "|| "glar002 = '"||g_glar_d[g_detail_idx].glar002 ||"' AND "|| "glar003 = '"||g_glar_d[g_detail_idx].glar003 ||"' AND "|| "glar004 = '"||g_glar_d[g_detail_idx].glar004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page1.glar002" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_glar_d[g_detail_idx].glarld IS NOT NULL AND g_glar_d[g_detail_idx].glar001 IS NOT NULL AND g_glar_d[g_detail_idx].glar002 IS NOT NULL AND g_glar_d[g_detail_idx].glar003 IS NOT NULL AND g_glar_d[g_detail_idx].glar004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glar_d[g_detail_idx].glarld != g_glar_d_t.glarld OR g_glar_d[g_detail_idx].glar001 != g_glar_d_t.glar001 OR g_glar_d[g_detail_idx].glar002 != g_glar_d_t.glar002 OR g_glar_d[g_detail_idx].glar003 != g_glar_d_t.glar003 OR g_glar_d[g_detail_idx].glar004 != g_glar_d_t.glar004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glar_t WHERE "||"glarent = '" ||g_enterprise|| "' AND "||"glarld = '"||g_glar_d[g_detail_idx].glarld ||"' AND "|| "glar001 = '"||g_glar_d[g_detail_idx].glar001 ||"' AND "|| "glar002 = '"||g_glar_d[g_detail_idx].glar002 ||"' AND "|| "glar003 = '"||g_glar_d[g_detail_idx].glar003 ||"' AND "|| "glar004 = '"||g_glar_d[g_detail_idx].glar004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page1.glar003" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_glar_d[g_detail_idx].glarld IS NOT NULL AND g_glar_d[g_detail_idx].glar001 IS NOT NULL AND g_glar_d[g_detail_idx].glar002 IS NOT NULL AND g_glar_d[g_detail_idx].glar003 IS NOT NULL AND g_glar_d[g_detail_idx].glar004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glar_d[g_detail_idx].glarld != g_glar_d_t.glarld OR g_glar_d[g_detail_idx].glar001 != g_glar_d_t.glar001 OR g_glar_d[g_detail_idx].glar002 != g_glar_d_t.glar002 OR g_glar_d[g_detail_idx].glar003 != g_glar_d_t.glar003 OR g_glar_d[g_detail_idx].glar004 != g_glar_d_t.glar004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glar_t WHERE "||"glarent = '" ||g_enterprise|| "' AND "||"glarld = '"||g_glar_d[g_detail_idx].glarld ||"' AND "|| "glar001 = '"||g_glar_d[g_detail_idx].glar001 ||"' AND "|| "glar002 = '"||g_glar_d[g_detail_idx].glar002 ||"' AND "|| "glar003 = '"||g_glar_d[g_detail_idx].glar003 ||"' AND "|| "glar004 = '"||g_glar_d[g_detail_idx].glar004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page1.glar004" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_glar_d[g_detail_idx].glarld IS NOT NULL AND g_glar_d[g_detail_idx].glar001 IS NOT NULL AND g_glar_d[g_detail_idx].glar002 IS NOT NULL AND g_glar_d[g_detail_idx].glar003 IS NOT NULL AND g_glar_d[g_detail_idx].glar004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glar_d[g_detail_idx].glarld != g_glar_d_t.glarld OR g_glar_d[g_detail_idx].glar001 != g_glar_d_t.glar001 OR g_glar_d[g_detail_idx].glar002 != g_glar_d_t.glar002 OR g_glar_d[g_detail_idx].glar003 != g_glar_d_t.glar003 OR g_glar_d[g_detail_idx].glar004 != g_glar_d_t.glar004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glar_t WHERE "||"glarent = '" ||g_enterprise|| "' AND "||"glarld = '"||g_glar_d[g_detail_idx].glarld ||"' AND "|| "glar001 = '"||g_glar_d[g_detail_idx].glar001 ||"' AND "|| "glar002 = '"||g_glar_d[g_detail_idx].glar002 ||"' AND "|| "glar003 = '"||g_glar_d[g_detail_idx].glar003 ||"' AND "|| "glar004 = '"||g_glar_d[g_detail_idx].glar004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="input.a.page1.glarld" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #此段落由子樣板a05產生
            IF  g_glar_d[g_detail_idx].glarld IS NOT NULL AND g_glar_d[g_detail_idx].glar001 IS NOT NULL AND g_glar_d[g_detail_idx].glar002 IS NOT NULL AND g_glar_d[g_detail_idx].glar003 IS NOT NULL AND g_glar_d[g_detail_idx].glar004 IS NOT NULL THEN 
               IF l_cmd = 'a' OR ( l_cmd = 'u' AND (g_glar_d[g_detail_idx].glarld != g_glar_d_t.glarld OR g_glar_d[g_detail_idx].glar001 != g_glar_d_t.glar001 OR g_glar_d[g_detail_idx].glar002 != g_glar_d_t.glar002 OR g_glar_d[g_detail_idx].glar003 != g_glar_d_t.glar003 OR g_glar_d[g_detail_idx].glar004 != g_glar_d_t.glar004)) THEN 
                  IF NOT ap_chk_notDup("","SELECT COUNT(*) FROM glar_t WHERE "||"glarent = '" ||g_enterprise|| "' AND "||"glarld = '"||g_glar_d[g_detail_idx].glarld ||"' AND "|| "glar001 = '"||g_glar_d[g_detail_idx].glar001 ||"' AND "|| "glar002 = '"||g_glar_d[g_detail_idx].glar002 ||"' AND "|| "glar003 = '"||g_glar_d[g_detail_idx].glar003 ||"' AND "|| "glar004 = '"||g_glar_d[g_detail_idx].glar004 ||"'",'std-00004',0) THEN 
                     NEXT FIELD CURRENT
                  END IF
               END IF
            END IF

]]>
</point>
  <point name="function.aglq750_create_temp_table" cite_std="N" status="" ver="1" src="s" new="Y" order="1" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 創建臨時表
# Memo...........:
# Usage..........: CALL aglq750_create_temp_table()
# Date & Author..: 2014/03/27 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_create_temp_table()
   DROP TABLE aglq750_tmp
   CREATE TEMP TABLE aglq750_tmp(
   seq          DECIMAL(10,0),
   glar001      VARCHAR(24),
   glar012      VARCHAR(10),
   glar013      VARCHAR(10),
   glar014      VARCHAR(10),
   glar015      VARCHAR(10),
   glar016      VARCHAR(10),
   glar017      VARCHAR(10),
   glar018      VARCHAR(10),
   glar019      VARCHAR(10),
   glar020      VARCHAR(10),
   glar021      VARCHAR(10),
   glar022      VARCHAR(10),
   glar023      VARCHAR(30),
   glar003      DECIMAL(5,0),
   style        VARCHAR(80), 
   glar005      DECIMAL(20,6), 
   glar006      DECIMAL(20,6), 
   glar034      DECIMAL(20,6), 
   glar035      DECIMAL(20,6), 
   glar036      DECIMAL(20,6), 
   glar037      DECIMAL(20,6), 
   state        VARCHAR(1), 
   amt1         DECIMAL(20,6),
   amt2         DECIMAL(20,6),
   amt3         DECIMAL(20,6))
END FUNCTION]]>
</point>
  <point name="function.aglq750_set_curr_show" cite_std="N" status="" ver="1" src="s" new="Y" order="2" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 設置本位幣二、別你幣三顯示否
# Memo...........:
# Usage..........: CALL aglq750_set_curr_show()
# Date & Author..: 2014/03/13 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_set_curr_show()
   #顯示本位幣二
   IF tm.ctype='1' THEN
      CALL cl_set_comp_visible("glar034,glar035,amt2",TRUE)
   ELSE
      CALL cl_set_comp_visible("glar034,glar035,amt2",FALSE)
   END IF
   #顯示本位幣三
   IF tm.ctype='2' THEN
      CALL cl_set_comp_visible("glar036,glar037,amt3",TRUE)
   ELSE
      CALL cl_set_comp_visible("glar036,glar037,amt3",FALSE)
   END IF
   #全部
   IF tm.ctype='3' THEN
      CALL cl_set_comp_visible("glar034,glar035,glar036,glar037,amt2,amt3",TRUE)
      CALL cl_set_comp_visible("glar034,glar035,glar036,glar037,amt2,amt3",TRUE)
   END IF
END FUNCTION]]>
</point>
  <point name="function.aglq750_glaald_desc" cite_std="N" status="" ver="1" src="s" new="Y" order="3" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 獲取帳套相關資料
# Memo...........:
# Usage..........: CALL aglq750_glaald_desc(p_glaald)
# Input parameter: p_glaald   帳套
# Date & Author..: 2014/03/10 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_glaald_desc(p_glaald)
   DEFINE  p_glaald    LIKE glaa_t.glaald
   
    INITIALIZE g_ref_fields TO NULL
    LET g_ref_fields[1] = p_glaald 
    CALL ap_ref_array2(g_ref_fields,"SELECT glaal002 FROM glaal_t WHERE glaalent='"||g_enterprise||"' AND glaalld=? AND glaal001='"||g_dlang||"'","") RETURNING g_rtn_fields
    LET g_glaald_desc=g_rtn_fields[1]
    #依据对应的主账套编码，抓取对应法人，币别，汇率参照编号，会计科目参照编号,关账日期
   SELECT glaacomp,glaa001,glaa002,glaa003,glaa004,glaa013,
          glaa015,glaa016,glaa017,glaa018,glaa019,glaa020,
          glaa021,glaa022
     INTO g_glaacomp,g_glaa001,g_glaa002,g_glaa003,g_glaa004,g_glaa013,
          g_glaa015,g_glaa016,g_glaa017,g_glaa018,g_glaa019,g_glaa020,
          g_glaa021,g_glaa022
     FROM glaa_t
    WHERE glaaent = g_enterprise
      AND glaald = p_glaald 
   
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glaacomp
   CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glaacomp_desc= g_rtn_fields[1]
   
   #本位幣二
   IF g_glaa015='Y' THEN
      CALL cl_set_comp_visible("glaa016",TRUE)
   ELSE
      CALL cl_set_comp_visible("glaa016",FALSE)
   END IF
   #本位幣三
   IF g_glaa019='Y' THEN
      CALL cl_set_comp_visible("glaa020",TRUE)
   ELSE
      CALL cl_set_comp_visible("glaa020",FALSE)
   END IF 
   #多本位幣
   CALL cl_set_comp_visible("ctype",TRUE)
   CASE
      WHEN g_glaa015<>'Y' AND g_glaa019<>'Y' 
         CALL cl_set_comp_visible("ctype",FALSE)
         LET tm.ctype=''
      WHEN g_glaa015='Y' AND g_glaa019<>'Y' 
         CALL cl_set_combo_scc_part('ctype','9921','1')
         LET tm.ctype='1'
      WHEN g_glaa015<>'Y' AND g_glaa019='Y' 
         CALL cl_set_combo_scc_part('ctype','9921','2')
         LET tm.ctype='2'  
      WHEN g_glaa015='Y' AND g_glaa019='Y' 
         CALL cl_set_combo_scc_part('ctype','9921','1,2,3')
         LET tm.ctype='3'
   END CASE
   CALL aglq750_set_curr_show() #顯示本位幣二、本位幣三
   
END FUNCTION]]>
</point>
  <point name="function.aglq750_fetch1" cite_std="N" status="" ver="1" src="s" new="Y" order="4" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 抓取下一筆資料
# Memo...........:
# Usage..........: CALL aglq750_fetch1(p_flag)
# Input parameter: p_flag            
# Date & Author..: 2014/3/17 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_fetch1(p_flag)
   DEFINE p_flag   LIKE type_t.chr1
   DEFINE ls_msg     STRING
   
   IF g_header_cnt = 0 THEN
      RETURN
   END IF
   
   CASE p_flag
      WHEN 'F' LET g_current_idx = 1
      WHEN 'L' LET g_current_idx = g_header_cnt        
      WHEN 'P'
         IF g_current_idx > 1 THEN               
            LET g_current_idx = g_current_idx - 1
         END IF 
      WHEN 'N'
         IF g_current_idx < g_header_cnt THEN
            LET g_current_idx =  g_current_idx + 1
         END IF        
      WHEN '/'
         IF (NOT g_no_ask) THEN    
            CALL cl_set_act_visible("accept,cancel", TRUE)    
            CALL cl_getmsg('fetch',g_lang) RETURNING ls_msg
            LET INT_FLAG = 0
 
            PROMPT ls_msg CLIPPED,':' FOR g_jump
               #交談指令共用ACTION
               &include "common_action.4gl" 
            END PROMPT
 
            CALL cl_set_act_visible("accept,cancel", FALSE)    
            IF INT_FLAG THEN
                LET INT_FLAG = 0
                EXIT CASE  
            END IF           
         END IF
         
         IF g_jump > 0 AND g_jump <= g_glar_s.getLength() THEN
             LET g_current_idx = g_jump
         END IF
         
         LET g_no_ask = FALSE  
   END CASE 
   
   #代表沒有資料
   IF g_current_idx = 0 OR g_glar_s.getLength() = 0 THEN
      RETURN
   END IF
   
   #超出範圍
   IF g_current_idx > g_glar_s.getLength() THEN
      LET g_current_idx = g_glar_s.getLength()
   END IF
   
   DISPLAY g_current_idx TO FORMONLY.h_index
   LET g_glar001 = g_glar_s[g_current_idx].glar001
   CALL aglq750_b_fill1() 
END FUNCTION]]>
</point>
  <point name="function.aglq750_get_data" cite_std="N" status="u" ver="1" src="s" new="Y" order="5" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 抓取數據
# Memo...........:
# Usage..........: CALL aglq750_get_data()
# Date & Author..: 2014/03/10 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_get_data()
   DEFINE l_sql,l_sql1,l_sql2   STRING
   DEFINE l_sql3,l_sql4,l_sql5  STRING
   DEFINE l_wc                  STRING 
   DEFINE l_glar001        LIKE glar_t.glar001
   DEFINE l_glar012        LIKE glar_t.glar012
   DEFINE l_glar013        LIKE glar_t.glar013
   DEFINE l_glar014        LIKE glar_t.glar014
   DEFINE l_glar015        LIKE glar_t.glar015
   DEFINE l_glar016        LIKE glar_t.glar016
   DEFINE l_glar017        LIKE glar_t.glar017
   DEFINE l_glar018        LIKE glar_t.glar018
   DEFINE l_glar019        LIKE glar_t.glar019
   DEFINE l_glar020        LIKE glar_t.glar020
   DEFINE l_glar021        LIKE glar_t.glar021
   DEFINE l_glar022        LIKE glar_t.glar022
   DEFINE l_glar023        LIKE glar_t.glar023
   DEFINE l_glar003        LIKE glar_t.glar003
   DEFINE l_desc           LIKE type_t.num5
   DEFINE l_glar005        LIKE glar_t.glar005
   DEFINE l_glar006        LIKE glar_t.glar006
   DEFINE l_glar034        LIKE glar_t.glar034
   DEFINE l_glar035        LIKE glar_t.glar035
   DEFINE l_glar036        LIKE glar_t.glar036
   DEFINE l_glar037        LIKE glar_t.glar037
   DEFINE l_state          LIKE type_t.num5
   DEFINE l_amt1           LIKE type_t.num20_6 
   DEFINE l_amt2           LIKE type_t.num20_6 
   DEFINE l_amt3           LIKE type_t.num20_6 
   DEFINE l_amt4           LIKE type_t.num20_6 
   DEFINE l_amt5           LIKE type_t.num20_6 
   DEFINE l_amt6           LIKE type_t.num20_6 
   DEFINE l_sum1           LIKE type_t.num20_6 
   DEFINE l_sum2           LIKE type_t.num20_6
   DEFINE l_sum3           LIKE type_t.num20_6
   DEFINE l_period         LIKE glap_t.glap004
   DEFINE l_success        LIKE type_t.num5
   DEFINE l_str,l_str1,l_str2  STRING
   DEFINE l_seq            LIKE type_t.num10
   DEFINE l_glar           DYNAMIC ARRAY OF RECORD
          glar001          LIKE glar_t.glar001,
          glar012          LIKE glar_t.glar012,
          glar013          LIKE glar_t.glar013,
          glar014          LIKE glar_t.glar014,
          glar015          LIKE glar_t.glar015,
          glar016          LIKE glar_t.glar016,
          glar017          LIKE glar_t.glar017,
          glar018          LIKE glar_t.glar018,
          glar019          LIKE glar_t.glar019,
          glar020          LIKE glar_t.glar020,
          glar021          LIKE glar_t.glar021,
          glar022          LIKE glar_t.glar022,
          glar023          LIKE glar_t.glar023         
          END RECORD
   DEFINE l_i              LIKE type_t.num10
   DEFINE l_glaq003        LIKE glaq_t.glaq003
   DEFINE l_glaq004        LIKE glaq_t.glaq004
   DEFINE l_glaq040        LIKE glaq_t.glaq040
   DEFINE l_glaq041        LIKE glaq_t.glaq041
   DEFINE l_glaq043        LIKE glaq_t.glaq043
   DEFINE l_glaq044        LIKE glaq_t.glaq044
   
   #刪除臨時表中資料
   DELETE FROM aglq750_tmp

   #核算項條件篩選
   LET l_wc=cl_replace_str(g_wc,'glar001','glaq002')
   LET l_wc=cl_replace_str(l_wc,'glar012','glaq017')
   LET l_wc=cl_replace_str(l_wc,'glar013','glaq018')
   LET l_wc=cl_replace_str(l_wc,'glar014','glaq019')
   LET l_wc=cl_replace_str(l_wc,'glar015','glaq020')
   LET l_wc=cl_replace_str(l_wc,'glar016','glaq021')
   LET l_wc=cl_replace_str(l_wc,'glar017','glaq022')
   LET l_wc=cl_replace_str(l_wc,'glar018','glaq023')
   LET l_wc=cl_replace_str(l_wc,'glar019','glaq024')
   LET l_wc=cl_replace_str(l_wc,'glar020','glaq025')
   LET l_wc=cl_replace_str(l_wc,'glar021','glaq026')
   LET l_wc=cl_replace_str(l_wc,'glar022','glaq027')
   LET l_wc=cl_replace_str(l_wc,'glar023','glaq028')
   #顯示統制科目否
   IF tm.show_acc<>'Y' THEN
      LET l_sql1=l_sql1," AND glac003<>'1' "
   END IF
   #科目層級
   IF NOT cl_null(tm.glac005) THEN
      LET l_sql1=l_sql1," AND glac005<=",tm.glac005
   END IF
   #含內部管理科目否
   IF tm.glac009<>'Y' THEN
      LET l_sql1=l_sql1," AND glac009<>'Y' "
   END IF
   #顯示月結CE憑證否
   IF tm.show_ce<>'Y' THEN
      LET l_sql2=l_sql2," AND glap007<>'CE' "
      LET l_sql3="'CE'"
   END IF
   #顯示年結YE憑證否
   IF tm.show_ye<>'Y' THEN
      LET l_sql2=l_sql2," AND glap007<>'YE' "
      IF NOT cl_null(l_sql3) THEN
         LET l_sql3=l_sql3,",'YE'"
      ELSE
         LET l_sql3="'YE'" 
      END IF
   END IF
   IF NOT cl_null(l_sql3) THEN
      LET l_sql3=" AND glap007 IN (",l_sql3,")"
   END IF   
   #單據狀態
   CASE
      WHEN tm.stus='2'
         LET l_sql4=l_sql4," AND glapstus IN ('Y') "
      WHEN tm.stus='3'
         LET l_sql4=l_sql4," AND glapstus IN ('Y','N') "
   END CASE
   #核算項
   CALL aglq750_fix_acc_get_sql() RETURNING l_str,l_str1,l_str2
   
   LET l_sql5="(SELECT DISTINCT glar001",l_str,
             "   FROM glar_t",
             "   LEFT OUTER JOIN glac_t ON glacent=glarent AND glac002=glar001 AND glac001='",g_glaa004,"'",
             "  WHERE glarent=",g_enterprise," AND glarld='",g_glaald,"' ",
             "    AND glar002=",tm.year,
             "    AND glar003 BETWEEN ",tm.speriod," AND ",tm.eperiod,
             l_sql1," AND ",g_wc," )"
   #單據狀態      
   IF tm.stus MATCHES '[23]' THEN
      LET l_sql5=l_sql5,
                " UNION ALL ",
                "(SELECT DISTINCT glaq002 glar001 ",l_str2,
                "   FROM glaq_t",
                "  INNER JOIN glap_t ON glapld = glaqld AND glapdocno = glaqdocno ",
                "   LEFT OUTER JOIN glac_t ON glacent=glaqent AND glac002=glaq002 AND glac001='",g_glaa004,"'",
                "  WHERE glaqent=",g_enterprise," AND glaqld='",g_glaald,"' ",
                "    AND glap002=",tm.year,
                "    AND glap004 BETWEEN ",tm.speriod," AND ",tm.eperiod,l_sql4,
                l_sql1,l_sql2," AND ",l_wc," )"
   END IF
   LET l_sql5="SELECT DISTINCT glar001",l_str,
              "  FROM (",l_sql5,")",
              " ORDER BY glar001",l_str
   
   PREPARE aglq750_sel_pr FROM l_sql5
   DECLARE aglq750_sel_cr CURSOR FOR aglq750_sel_pr
   
   CALL cl_showmsg_init()
   LET l_success = TRUE
   LET l_i=1
   CALL l_glar.clear()
   FOREACH aglq750_sel_cr INTO l_glar[l_i].glar001,l_glar[l_i].glar012,l_glar[l_i].glar013,
                               l_glar[l_i].glar014,l_glar[l_i].glar015,l_glar[l_i].glar016,
                               l_glar[l_i].glar017,l_glar[l_i].glar018,l_glar[l_i].glar019,
                               l_glar[l_i].glar020,l_glar[l_i].glar021,l_glar[l_i].glar022,
                               l_glar[l_i].glar023
      IF SQLCA.sqlcode THEN
         CALL cl_errmsg('','FOREACH aglq750_sel_cr','',SQLCA.sqlcode,1)
         LET l_success = FALSE
         EXIT FOREACH
      END IF
      LET l_i=l_i+1
   END FOREACH
   LET l_i=l_i-1
   CALL l_glar.deleteElement(l_glar.getLength()) 
   LET l_seq=1
   
   FOR l_i=1 TO l_glar.getLength()
      LET l_glar001=l_glar[l_i].glar001
      LET l_glar012=l_glar[l_i].glar012
      LET l_glar013=l_glar[l_i].glar013
      LET l_glar014=l_glar[l_i].glar014
      LET l_glar015=l_glar[l_i].glar015
      LET l_glar016=l_glar[l_i].glar016
      LET l_glar017=l_glar[l_i].glar017
      LET l_glar018=l_glar[l_i].glar018
      LET l_glar019=l_glar[l_i].glar019
      LET l_glar020=l_glar[l_i].glar020
      LET l_glar021=l_glar[l_i].glar021
      LET l_glar022=l_glar[l_i].glar022
      LET l_glar023=l_glar[l_i].glar023
      #核算项
      CALL aglq750_fix_acc_sql(l_glar012,l_glar013,l_glar014,l_glar015,l_glar016,l_glar017,
                               l_glar018,l_glar019,l_glar020,l_glar021,l_glar022,l_glar022)
      RETURNING l_str,l_str1
      
      #期初餘額、本年累計
      LET l_sql="SELECT SUM(glar005-glar006),SUM(glar034-glar035),SUM(glar036-glar037) FROM glar_t",    
                " WHERE glarent=",g_enterprise," AND glarld='",g_glaald,"' ",
                "   AND glar001=? AND glar002=",tm.year," AND glar003<=? ",
                l_str
      PREPARE aglq750_sel_pr1 FROM l_sql
      #本期合計
      LET l_sql="(SELECT SUM(glar005) glar005,SUM(glar006) glar006,SUM(glar034) glar034,",
                "        SUM(glar035) glar035,SUM(glar036) glar036,SUM(glar037) glar037",
                "   FROM glar_t",
                "   LEFT OUTER JOIN glac_t ON glacent=glarent AND glac002=glar001 AND glac001='",g_glaa004,"'",
                "  WHERE glarent=",g_enterprise," AND glarld='",g_glaald,"' ",
                "    AND glar001=? ",
                "    AND glar002=",tm.year,
                "    AND glar003=? ",l_str,
                l_sql1," AND ",g_wc," )"  
      #單據狀態      
      IF tm.stus MATCHES '[23]' THEN
         LET l_sql=l_sql,
                   " UNION ALL ",
                   "(SELECT SUM(glaq003) glar005,SUM(glaq004) glar006,SUM(glaq040) glar034,",
                   "        SUM(glaq041) glar035,SUM(glaq043) glar036,SUM(glaq044) glar037",
                   "   FROM glaq_t",
                   "  INNER JOIN glap_t ON glapld = glaqld AND glapdocno = glaqdocno ",
                   "   LEFT OUTER JOIN glac_t ON glacent=glaqent AND glac002=glaq002 AND glac001='",g_glaa004,"'",
                   "  WHERE glaqent=",g_enterprise," AND glaqld='",g_glaald,"' ",
                   "    AND glaq002=? ",
                   "    AND glap002=",tm.year,
                   "    AND glap004=? ",l_sql4,l_str1,
                   l_sql1,l_sql2," AND ",l_wc," )"
      END IF
      LET l_sql="SELECT SUM(glar005),SUM(glar006),SUM(glar034),SUM(glar035),",
                "       SUM(glar036),SUM(glar037)",
                "  FROM (",l_sql,")"
      PREPARE aglq750_sel_pr5 FROM l_sql
      
      LET l_sql="SELECT SUM(glaq003-glaq004),SUM(glaq040-glaq041),",
                "       SUM(glaq043-glaq044) ",
                "  FROM glaq_t INNER JOIN glap_t ON glapld = glaqld AND glapdocno = glaqdocno ",
                " WHERE glaqent=",g_enterprise," AND glaqld='",g_glaald,"' ",
                "   AND glaq002=? ",
                "   AND glap002=",tm.year,
                "   AND glap004<=?",l_str1,
                "   AND ",l_wc,l_sql2,l_sql4
      PREPARE aglq750_sel_pr2 FROM l_sql
      #抓取CE或YE傳票金額
      LET l_sql="SELECT SUM(glaq003-glaq004),SUM(glaq040-glaq041),",
                "       SUM(glaq043-glaq044) ",
                "  FROM glaq_t INNER JOIN glap_t ON glapld = glaqld AND glapdocno = glaqdocno ",
                " WHERE glaqent=",g_enterprise," AND glaqld='",g_glaald,"' ",
                "   AND glaq002=? ",
                "   AND glap002=",tm.year,
                "   AND glapstus='S'",
                "   AND glap004<=?",l_str1,
                "   AND ",l_wc,l_sql3
      PREPARE aglq750_sel_pr3 FROM l_sql
      
      LET l_sql="SELECT SUM(glaq003),SUM(glaq004),SUM(glaq040),SUM(glaq041),",
                "       SUM(glaq043),SUM(glaq044) ",
                "  FROM glaq_t INNER JOIN glap_t ON glapld = glaqld AND glapdocno = glaqdocno ",
                " WHERE glaqent=",g_enterprise," AND glaqld='",g_glaald,"' ",
                "   AND glaq002=? ",
                "   AND glap002=",tm.year,
                "   AND glapstus='S'",
                "   AND glap004=?",l_str1,
                "   AND ",l_wc,l_sql3       
      PREPARE aglq750_sel_pr4 FROM l_sql
      
      LET l_amt1=0
      LET l_amt2=0
      LET l_amt3=0      
      LET l_state=NULL
      #期初餘額
      LET l_period=tm.speriod-1
      EXECUTE aglq750_sel_pr1 USING l_glar001,l_period INTO l_amt1,l_amt2,l_amt3
      IF SQLCA.sqlcode THEN
         CALL cl_errmsg('','aglq750_sel_pr1','',SQLCA.sqlcode,1)
         LET l_success = FALSE
      END IF
      IF cl_null(l_amt1) THEN LET l_amt1=0 END IF
      IF cl_null(l_amt2) THEN LET l_amt2=0 END IF
      IF cl_null(l_amt3) THEN LET l_amt3=0 END IF
      IF tm.stus MATCHES '[23]' THEN
         EXECUTE aglq750_sel_pr2 USING l_glar001,l_period INTO l_sum1,l_sum2,l_sum3
         IF SQLCA.sqlcode THEN
            CALL cl_errmsg('','aglq750_sel_pr2','',SQLCA.sqlcode,1)
            LET l_success = FALSE
         END IF
         IF cl_null(l_sum1) THEN LET l_sum1=0 END IF
         IF cl_null(l_sum2) THEN LET l_sum2=0 END IF
         IF cl_null(l_sum3) THEN LET l_sum3=0 END IF
         LET l_amt1=l_amt1+l_sum1
         LET l_amt2=l_amt2+l_sum2
         LET l_amt3=l_amt3+l_sum3
      END IF
      #當不包含CE或YE憑證時，減去CE或YE傳票金額
      IF tm.show_ce<>'Y' OR tm.show_ye<>'Y' THEN
         EXECUTE aglq750_sel_pr3 USING l_glar001,l_period INTO l_sum1,l_sum2,l_sum3
         IF SQLCA.sqlcode THEN
            CALL cl_errmsg('','aglq750_sel_pr3','',SQLCA.sqlcode,1)
            LET l_success = FALSE
         END IF
         IF cl_null(l_sum1) THEN LET l_sum1=0 END IF
         IF cl_null(l_sum2) THEN LET l_sum2=0 END IF
         IF cl_null(l_sum3) THEN LET l_sum3=0 END IF
         LET l_amt1=l_amt1-l_sum1
         LET l_amt2=l_amt2-l_sum2
         LET l_amt3=l_amt3-l_sum3
      END IF
      #借貸平否
      CASE
         WHEN l_amt1>0 
            LET l_state='1'
         WHEN l_amt1<0
            LET l_state='2'
            LET l_amt1=(-1)*l_amt1
            LET l_amt2=(-1)*l_amt2
            LET l_amt3=(-1)*l_amt3
         WHEN l_amt1=0
            LET l_state='3'
      END CASE
      INSERT INTO aglq750_tmp
      VALUES(l_seq,l_glar001,l_glar012,l_glar013,l_glar014,l_glar015,l_glar016,l_glar017,
             l_glar018,l_glar019,l_glar020,l_glar021,l_glar022,l_glar023,NULL,'1',
             NULL,NULL,NULL,NULL,NULL,NULL,l_state,l_amt1,l_amt2,l_amt3)
      IF SQLCA.sqlcode THEN
         CALL cl_errmsg('','insert','',SQLCA.sqlcode,1)
         LET l_success = FALSE
      END IF
      LET l_seq=l_seq+1
      
      FOR l_glar003=tm.speriod TO tm.eperiod   
         #本期合計
         IF tm.stus MATCHES '[23]' THEN
            EXECUTE aglq750_sel_pr5 USING l_glar001,l_glar003,l_glar001,l_glar003
                                     INTO l_glar005,l_glar006,l_glar034,l_glar035,l_glar036,l_glar037
         ELSE
            EXECUTE aglq750_sel_pr5 USING l_glar001,l_glar003
                                     INTO l_glar005,l_glar006,l_glar034,l_glar035,l_glar036,l_glar037
         END IF
         IF cl_null(l_glar005) THEN LET l_glar005=0 END IF
         IF cl_null(l_glar006) THEN LET l_glar006=0 END IF
         IF cl_null(l_glar034) THEN LET l_glar034=0 END IF
         IF cl_null(l_glar035) THEN LET l_glar035=0 END IF
         IF cl_null(l_glar036) THEN LET l_glar036=0 END IF
         IF cl_null(l_glar037) THEN LET l_glar037=0 END IF
         #當不包含CE或YE憑證時，減去CE或YE傳票金額
         IF tm.show_ce<>'Y' OR tm.show_ye<>'Y' THEN
            EXECUTE aglq750_sel_pr4 USING l_glar001,l_glar003 
                                     INTO l_glaq003,l_glaq004,l_glaq040,l_glaq041,l_glaq043,l_glaq044
            IF SQLCA.sqlcode THEN
               CALL cl_errmsg('','aglq750_sel_pr4','',SQLCA.sqlcode,1)
               LET l_success = FALSE
            END IF
            IF cl_null(l_glaq003) THEN LET l_glaq003=0 END IF
            IF cl_null(l_glaq004) THEN LET l_glaq004=0 END IF
            IF cl_null(l_glaq040) THEN LET l_glaq040=0 END IF
            IF cl_null(l_glaq041) THEN LET l_glaq041=0 END IF
            IF cl_null(l_glaq043) THEN LET l_glaq043=0 END IF
            IF cl_null(l_glaq044) THEN LET l_glaq044=0 END IF
            LET l_glar005=l_glar005-l_glaq003
            LET l_glar006=l_glar006-l_glaq004
            LET l_glar034=l_glar034-l_glaq040
            LET l_glar035=l_glar035-l_glaq041
            LET l_glar036=l_glar036-l_glaq043
            LET l_glar037=l_glar037-l_glaq044
         END IF
         LET l_sum1=l_glar005-l_glar006
	      LET l_sum2=l_glar034-l_glar035
	      LET l_sum3=l_glar036-l_glar037
	      
	      #借餘
         IF l_state='1' THEN 
            LET l_sum1=l_sum1+l_amt1
            LET l_sum2=l_sum2+l_amt2
            LET l_sum3=l_sum3+l_amt3
         END IF
         #貸餘
         IF l_state='2' THEN 
            LET l_sum1=l_sum1-l_amt1
            LET l_sum2=l_sum2-l_amt2
            LET l_sum3=l_sum3-l_amt3
         END IF
         #借貸平否
         CASE
            WHEN l_sum1>0 
               LET l_state='1'
            WHEN l_sum1<0
               LET l_state='2'
               LET l_sum1=(-1)*l_sum1
               LET l_sum2=(-1)*l_sum2
               LET l_sum3=(-1)*l_sum3
            WHEN l_sum1=0
               LET l_state='3'
         END CASE
         INSERT INTO aglq750_tmp
         VALUES(l_seq,l_glar001,l_glar012,l_glar013,l_glar014,l_glar015,l_glar016,l_glar017,
                l_glar018,l_glar019,l_glar020,l_glar021,l_glar022,l_glar023,l_glar003,'2',
                l_glar005,l_glar006,l_glar034,l_glar035,l_glar036,l_glar037,
                l_state,l_sum1,l_sum2,l_sum3)
         IF SQLCA.sqlcode THEN
            CALL cl_errmsg('','insert','',SQLCA.sqlcode,1)
            LET l_success = FALSE
         END IF
         LET l_amt1=l_sum1
         LET l_amt2=l_sum2
         LET l_amt3=l_sum3
         LET l_seq=l_seq+1
      
         #本年累計
         EXECUTE aglq750_sel_pr1 USING l_glar001,l_glar003 INTO l_amt4,l_amt5,l_amt6
         IF SQLCA.sqlcode THEN
               CALL cl_errmsg('','aglq750_sel_pr1','',SQLCA.sqlcode,1)
               LET l_success = FALSE
            END IF
         IF cl_null(l_amt4) THEN LET l_amt4=0 END IF
         IF cl_null(l_amt5) THEN LET l_amt5=0 END IF
         IF cl_null(l_amt6) THEN LET l_amt6=0 END IF
         IF tm.stus MATCHES '[23]' THEN
            EXECUTE aglq750_sel_pr2 USING l_glar001,l_glar003 INTO l_sum1,l_sum2,l_sum3
            IF SQLCA.sqlcode THEN
               CALL cl_errmsg('','aglq750_sel_pr2','',SQLCA.sqlcode,1)
               LET l_success = FALSE
            END IF
            IF cl_null(l_sum1) THEN LET l_sum1=0 END IF
            IF cl_null(l_sum2) THEN LET l_sum2=0 END IF
            IF cl_null(l_sum3) THEN LET l_sum3=0 END IF
            LET l_amt4=l_amt4+l_sum1
            LET l_amt5=l_amt5+l_sum2
            LET l_amt6=l_amt6+l_sum3
         END IF
         #當不包含CE或YE憑證時，減去CE或YE傳票金額
         IF tm.show_ce<>'Y' OR tm.show_ye<>'Y' THEN
            EXECUTE aglq750_sel_pr3 USING l_glar001,l_glar003 INTO l_sum1,l_sum2,l_sum3
            IF SQLCA.sqlcode THEN
               CALL cl_errmsg('','aglq750_sel_pr3','',SQLCA.sqlcode,1)
               LET l_success = FALSE
            END IF
            IF cl_null(l_sum1) THEN LET l_sum1=0 END IF
            IF cl_null(l_sum2) THEN LET l_sum2=0 END IF
            IF cl_null(l_sum3) THEN LET l_sum3=0 END IF
            LET l_amt4=l_amt4-l_sum1
            LET l_amt5=l_amt5-l_sum2
            LET l_amt6=l_amt6-l_sum3
         END IF
         #借貸平否
         CASE
            WHEN l_amt4>0 
               LET l_state='1'
            WHEN l_amt4<0
               LET l_state='2'
               LET l_amt4=(-1)*l_amt4
               LET l_amt5=(-1)*l_amt5
               LET l_amt6=(-1)*l_amt6
            WHEN l_amt4=0
               LET l_state='3'
         END CASE
         INSERT INTO aglq750_tmp
         VALUES(l_seq,l_glar001,l_glar012,l_glar013,l_glar014,l_glar015,l_glar016,l_glar017,
                l_glar018,l_glar019,l_glar020,l_glar021,l_glar022,l_glar023,NULL,'3',
                NULL,NULL,NULL,NULL,NULL,NULL,
                l_state,l_amt4,l_amt5,l_amt6)
         IF SQLCA.sqlcode THEN
            CALL cl_errmsg('','insert','',SQLCA.sqlcode,1)
            LET l_success = FALSE
         END IF
         LET l_seq=l_seq+1
      END FOR
   END FOR
   IF l_success = FALSE THEN
      CALL cl_err_showmsg()
      DELETE FROM aglq750_tmp
   END IF
END FUNCTION]]>
</point>
  <point name="function.aglq750_b_fill1" cite_std="N" status="" ver="1" src="s" new="Y" order="6" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 填充单身资料
# Memo...........:
# Usage..........: CALL aglq750_b_fill1()
# Date & Author..: 2014/03/18 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_b_fill1()
   DEFINE l_seq      LIKE type_t.num10
   
   LET g_sql="SELECT UNIQUE seq,glar001,'',glar012,'',glar013,'',glar014,'',glar015,'',glar016,'',glar017,'',",
             "       glar018,'',glar019,'',glar020,'',glar021,'',glar022,glar023,",
             "       glar003,style,glar005,glar006,glar034,glar035,glar036,glar037,",
             "       state,amt1,amt2,amt3 ",
             "  FROM aglq750_tmp "
   #是否按照幣別分頁
   IF NOT cl_null(g_glar001) THEN
      LET g_sql=g_sql," WHERE glar001='",g_glar001,"'"
   END IF
   LET g_sql=g_sql," ORDER BY glar001,glar012,glar013,glar014,glar015,glar016,glar017,glar018,",
                   "          glar019,glar020,glar021,glar022,glar023,seq "
  
   PREPARE aglq750_pb1 FROM g_sql
   DECLARE b_fill_curs1 CURSOR FOR aglq750_pb1
   OPEN b_fill_curs1
   
   CALL g_glar_d.clear()
   LET g_cnt = l_ac
   LET l_ac = 1   
   ERROR "Searching!"
   
   FOREACH b_fill_curs1 INTO l_seq,g_glar_d[l_ac].glar001,g_glar_d[l_ac].glar001_desc,g_glar_d[l_ac].glar012, 
       g_glar_d[l_ac].glar012_desc,g_glar_d[l_ac].glar013,g_glar_d[l_ac].glar013_desc,g_glar_d[l_ac].glar014, 
       g_glar_d[l_ac].glar014_desc,g_glar_d[l_ac].glar015,g_glar_d[l_ac].glar015_desc,g_glar_d[l_ac].glar016, 
       g_glar_d[l_ac].glar016_desc,g_glar_d[l_ac].glar017,g_glar_d[l_ac].glar017_desc,g_glar_d[l_ac].glar018, 
       g_glar_d[l_ac].glar018_desc,g_glar_d[l_ac].glar019,g_glar_d[l_ac].glar019_desc,g_glar_d[l_ac].glar020, 
       g_glar_d[l_ac].glar020_desc,g_glar_d[l_ac].glar021,g_glar_d[l_ac].glar021_desc,g_glar_d[l_ac].glar022, 
       g_glar_d[l_ac].glar023,g_glar_d[l_ac].glar003,g_glar_d[l_ac].style,g_glar_d[l_ac].glar005,g_glar_d[l_ac].glar006, 
       g_glar_d[l_ac].glar034,g_glar_d[l_ac].glar035,g_glar_d[l_ac].glar036,g_glar_d[l_ac].glar037,g_glar_d[l_ac].state, 
       g_glar_d[l_ac].amt1,g_glar_d[l_ac].amt2,g_glar_d[l_ac].amt3
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF
      
      CALL aglq750_detail_show()      
 
      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         IF g_error_show = 1 THEN
            CALL cl_err( "", 9035, 1 )
         END IF
         EXIT FOREACH
      END IF
      
   END FOREACH
   LET g_error_show = 0
   
   CALL g_glar_d.deleteElement(g_glar_d.getLength())   
    
   LET g_detail_cnt = l_ac - 1 
   DISPLAY g_detail_cnt TO FORMONLY.cnt
   LET l_ac = g_cnt
   LET g_cnt = 0
   
   CLOSE b_fill_curs1
   FREE aglq750_pb1
   
   LET l_ac = 1
   
   CALL aglq750_filter_show('glar001','b_glar001')
END FUNCTION]]>
</point>
  <point name="function.aglq750_set_default_value" cite_std="N" status="" ver="1" src="s" new="Y" order="7" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 設置默認值
# Memo...........:
# Usage..........: CALL aglq750_set_default_value()
# Date & Author..: 2014/03/13 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_set_default_value()
   DEFINE l_flag           LIKE type_t.chr1
   DEFINE l_errno          LIKE type_t.chr100
   DEFINE l_glav002        LIKE glav_t.glav002
   DEFINE l_glav005        LIKE glav_t.glav005
   DEFINE l_sdate_s        LIKE glav_t.glav004
   DEFINE l_sdate_e        LIKE glav_t.glav004
   DEFINE l_glav006        LIKE glav_t.glav006
   DEFINE l_pdate_s        LIKE glav_t.glav004
   DEFINE l_pdate_e        LIKE glav_t.glav004
   DEFINE l_glav007        LIKE glav_t.glav007
   DEFINE l_wdate_s        LIKE glav_t.glav004
   DEFINE l_wdate_e        LIKE glav_t.glav004
   
   CALL s_get_accdate(g_glaa003,g_today,'','')
   RETURNING l_flag,l_errno,l_glav002,l_glav005,l_sdate_s,l_sdate_e,
             l_glav006,l_pdate_s,l_pdate_e,l_glav007,l_wdate_s,l_wdate_e
   IF l_flag='N' THEN
      CALL cl_err('',l_errno,0)
   END IF
   LET tm.year=l_glav002
   LET tm.speriod=l_glav006
   LET tm.eperiod=l_glav006
   #獲取現行會計週期最大期別
   SELECT MAX(glav006) INTO g_max_period FROM glav_t 
   WHERE glavent=g_enterprise AND glav001=g_glaa003 AND glav002=tm.year

   #按科目分頁
   LET tm.acc_p='N'
   #統制科目
   LET tm.show_acc='Y'
   #科目層級
   LET tm.glac005=99
   #單據狀態
   LET tm.stus='1'
   #含內部管理科目
   LET tm.glac009='Y'
   #含月結傳票
   LET tm.show_ce='Y'
   #含年結傳票
   LET tm.show_ye='Y'
   #核算項
   LET tm.comp='Y'
   LET tm.glad007='N'
   LET tm.glad008='N'
   LET tm.glad009='N'
   LET tm.glad010='N'
   LET tm.glad027='N'
   LET tm.glad011='N'
   LET tm.glad012='N'
   LET tm.glad013='N'
   LET tm.glad014='N'
   LET tm.glad015='N'
   LET tm.glad016='N'
   CALL cl_set_comp_visible("b_glar013,b_glar013_desc,b_glar014,b_glar014_desc,b_glar015,b_glar015_desc,
                             b_glar016,b_glar016_desc,b_glar017,b_glar017_desc,b_glar018,b_glar018_desc,
                             b_glar019,b_glar019_desc,b_glar020,b_glar020_desc,b_glar021,b_glar021_desc,
                             b_glar022,b_glar023",FALSE)
END FUNCTION]]>
</point>
  <point name="function.aglq750_set_page" cite_std="N" status="" ver="1" src="s" new="Y" order="8" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 设置分页
# Memo...........:
# Usage..........: CALL aglq750_set_page()
# Date & Author..: 2014/03/18 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_set_page()
   DEFINE l_sql    STRING
   DEFINE l_idx    LIKE type_t.num5
   
   CALL g_glar_s.clear()
   IF tm.acc_p <>'Y' THEN
      LET g_glar_s[1].glar001=''
      LET g_header_cnt = 1
      LET g_rec_b = 1
   ELSE      
      LET l_sql="SELECT DISTINCT glar001 FROM aglq750_tmp ORDER BY glar001 "
      PREPARE aglq750_sel_s_pr FROM l_sql
      DECLARE aglq750_sel_s_cr CURSOR FOR aglq750_sel_s_pr
      LET l_idx=1
      FOREACH aglq750_sel_s_cr INTO g_glar_s[l_idx].glar001
         IF SQLCA.sqlcode THEN
            CALL cl_err('FOREACH aglq750_sel_s_cr',SQLCA.sqlcode,0)
            EXIT FOREACH
         END IF
         LET l_idx=l_idx+1
         IF l_idx > g_max_rec THEN
            CALL cl_err('',9035,0)
            EXIT FOREACH
         END IF
      END FOREACH
      CALL g_glar_s.deleteElement(l_idx)
      LET g_header_cnt = g_glar_s.getLength()
      LET g_rec_b = l_idx - 1
   END IF
   DISPLAY g_header_cnt TO FORMONLY.h_count
END FUNCTION]]>
</point>
  <point name="function.aglq750_show" cite_std="N" status="" ver="1" src="s" new="Y" order="9" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 显示资料
# Memo...........:
# Usage..........: CALL aglq750_show()
# Date & Author..:  2014/03/18 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_show()
   DISPLAY g_glaald,g_glaald_desc,g_glaacomp,g_glaacomp_desc,g_glaa001,g_glaa016,g_glaa020,
           tm.year,tm.speriod,tm.eperiod,tm.acc_p,tm.ctype,
           tm.show_acc,tm.glac005,tm.stus,tm.glac009,tm.show_ce,tm.show_ye,
           tm.comp,tm.glad007,tm.glad008,tm.glad009,tm.glad010,tm.glad027,tm.glad011,
           tm.glad012,tm.glad013,tm.glad014,tm.glad015,tm.glad016
        TO glaald,glaald_desc,glaacomp,glaacomp_desc,glaa001,glaa016,glaa020,
           year,speriod,eperiod,acc_p,ctype,
           show_acc,glac005,stus,glac009,show_ce,show_ye,
           comp,glad007,glad008,glad009,glad010,glad027,glad011,
           glad012,glad013,glad014,glad015,glad016
END FUNCTION]]>
</point>
  <point name="function.aglq750_fix_acc_sql" cite_std="N" status="" ver="1" src="s" new="Y" order="10" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 描述说明
# Memo...........:
# Usage..........: CALL aglq750_fix_acc_sql(p_glar012,p_glar013,p_glar014,p_glar015,p_glar016,p_glar017,p_glar018,p_glar019,p_glar020,p_glar021,p_glar022,p_glar023)
#                  RETURNING r_sql,r_sql1
# Input parameter: p_glar012,p_glar013,p_glar014,p_glar015,p_glar016,p_glar017,p_glar018,p_glar019,p_glar020,p_glar021,p_glar022,p_glar023  12組固定核算項   传入参数变量说明1
# Return code....: r_sql，r_sql1 組合SQL語句
# Date & Author..: 2014/03/25 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_fix_acc_sql(p_glar012,p_glar013,p_glar014,p_glar015,p_glar016,p_glar017,p_glar018,p_glar019,p_glar020,p_glar021,p_glar022,p_glar023)
   DEFINE p_glar012            LIKE glar_t.glar012
   DEFINE p_glar013            LIKE glar_t.glar013
   DEFINE p_glar014            LIKE glar_t.glar014
   DEFINE p_glar015            LIKE glar_t.glar015
   DEFINE p_glar016            LIKE glar_t.glar016
   DEFINE p_glar017            LIKE glar_t.glar017
   DEFINE p_glar018            LIKE glar_t.glar018
   DEFINE p_glar019            LIKE glar_t.glar019
   DEFINE p_glar020            LIKE glar_t.glar020
   DEFINE p_glar021            LIKE glar_t.glar021
   DEFINE p_glar022            LIKE glar_t.glar022
   DEFINE p_glar023            LIKE glar_t.glar023
   DEFINE r_sql,r_sql1         STRING
   
   LET r_sql=''
   LET r_sql1=''
   IF tm.comp='Y' THEN
      IF p_glar012 IS NULL THEN
         LET r_sql=r_sql," AND glar012 IS NULL"
         LET r_sql1=r_sql1," AND glaq017 IS NULL"
      ELSE
         LET r_sql=r_sql," AND glar012='",p_glar012,"'"
         LET r_sql1=r_sql1," AND glaq017='",p_glar012,"'"
      END IF
   END IF
   
   IF tm.glad007='Y' THEN
      IF p_glar013 IS NULL THEN
         LET r_sql=r_sql," AND glar013 IS NULL"
         LET r_sql1=r_sql1," AND glaq018 IS NULL"
      ELSE
         LET r_sql=r_sql," AND glar013='",p_glar013,"'"
         LET r_sql1=r_sql1," AND glaq018='",p_glar013,"'"
      END IF
   END IF
   
   IF tm.glad008='Y' THEN
      IF p_glar014 IS NULL THEN
         LET r_sql=r_sql," AND glar014 IS NULL "
         LET r_sql1=r_sql1," AND glaq019 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar014='",p_glar014,"'"
         LET r_sql1=r_sql1," AND glaq019='",p_glar014,"'"
      END IF
   END IF
   
   IF tm.glad009='Y' THEN
      IF p_glar015 IS NULL THEN
         LET r_sql=r_sql," AND glar015 IS NULL "
         LET r_sql1=r_sql1," AND glaq020 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar015='",p_glar015,"'"
         LET r_sql1=r_sql1," AND glaq020='",p_glar015,"'"
      END IF
   END IF
   
   IF tm.glad010='Y' THEN
      IF p_glar016 IS NULL THEN
         LET r_sql=r_sql," AND glar016 IS NULL "
         LET r_sql1=r_sql1," AND glaq021 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar016='",p_glar016,"'"
         LET r_sql1=r_sql1," AND glaq021='",p_glar016,"'"
      END IF
   END IF
   
   IF tm.glad027='Y' THEN
      IF p_glar017 IS NULL THEN
         LET r_sql=r_sql," AND glar017 IS NULL "
         LET r_sql1=r_sql1," AND glaq022 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar017='",p_glar017,"'"
         LET r_sql1=r_sql1," AND glaq022='",p_glar017,"'"
      END IF
   END IF
      
   IF tm.glad011='Y' THEN
      IF p_glar018 IS NULL THEN
         LET r_sql=r_sql," AND glar018 IS NULL "
         LET r_sql1=r_sql1," AND glaq023 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar018='",p_glar018,"'"
         LET r_sql1=r_sql1," AND glaq023='",p_glar018,"'"
      END IF
   END IF
   
   IF tm.glad012='Y' THEN
      IF p_glar019 IS NULL THEN
         LET r_sql=r_sql," AND glar019 IS NULL "
         LET r_sql1=r_sql1," AND glaq024 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar019='",p_glar019,"'"
         LET r_sql1=r_sql1," AND glaq024='",p_glar019,"'"
      END IF
   END IF
   
   IF tm.glad013='Y' THEN
      IF p_glar020 IS NULL THEN
         LET r_sql=r_sql," AND glar020 IS NULL "
         LET r_sql1=r_sql1," AND glaq025 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar020='",p_glar020,"'"
         LET r_sql1=r_sql1," AND glaq025='",p_glar020,"'"
      END IF
   END IF
   
   IF tm.glad014='Y' THEN
      IF p_glar021 IS NULL THEN
         LET r_sql=r_sql," AND glar021 IS NULL "
         LET r_sql1=r_sql1," AND glaq026 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar021='",p_glar021,"'"
         LET r_sql1=r_sql1," AND glaq026='",p_glar021,"'"
      END IF
   END IF
   
   IF tm.glad015='Y' THEN
      IF p_glar022 IS NULL THEN
         LET r_sql=r_sql," AND glar022 IS NULL "
         LET r_sql1=r_sql1," AND glaq027 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar022='",p_glar022,"'"
         LET r_sql1=r_sql1," AND glaq027='",p_glar022,"'"
      END IF
   END IF
   
   IF tm.glad016='Y' THEN
      IF p_glar023 IS NULL THEN
         LET r_sql=r_sql," AND glar023 IS NULL "
         LET r_sql1=r_sql1," AND glaq028 IS NULL "
      ELSE
         LET r_sql=r_sql," AND glar023='",p_glar023,"'"
         LET r_sql1=r_sql1," AND glaq028='",p_glar023,"'"
      END IF
   END IF
   RETURN r_sql,r_sql1
END FUNCTION]]>
</point>
  <point name="function.aglq750_fix_acc_get_sql" cite_std="N" status="" ver="1" src="s" new="Y" order="11" mark_hard="N">
<![CDATA[
################################################################################
# Descriptions...: 根據核算項勾選組SQL語句
# Memo...........:
# Usage..........: CALL aglq750_fix_acc_get_sql()
#                  RETURNING r_sql,r_sql1
# Return code....: r_sql    關於glar_t的SQL語句
#                : r_sql1   關於glaq_t的SQL語句
# Date & Author..: 2014/03/24 By wangrr
# Modify.........:
################################################################################
PRIVATE FUNCTION aglq750_fix_acc_get_sql()
   DEFINE r_sql,r_sql1,r_sql2   STRING 
   
   LET r_sql=''
   LET r_sql1=''
   LET r_sql2=''
   IF tm.comp='Y' THEN
      LET r_sql =r_sql,",glar012"
      LET r_sql1=r_sql1,",glaq017"
      LET r_sql2=r_sql2,",glaq017 glar012"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad007='Y' THEN
      LET r_sql =r_sql,",glar013"
      LET r_sql1=r_sql1,",glaq018"
      LET r_sql2=r_sql2,",glaq018 glar013"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad008='Y' THEN
      LET r_sql =r_sql,",glar014"
      LET r_sql1=r_sql1,",glaq019"
      LET r_sql2=r_sql2,",glaq019 glar014"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad009='Y' THEN
      LET r_sql =r_sql,",glar015"
      LET r_sql1=r_sql1,",glaq020"
      LET r_sql2=r_sql2,",glaq020 glar015"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad010='Y' THEN
      LET r_sql =r_sql,",glar016"
      LET r_sql1=r_sql1,",glaq021"
      LET r_sql2=r_sql2,",glaq021 glar016"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad027='Y' THEN
      LET r_sql =r_sql,",glar017"
      LET r_sql1=r_sql1,",glaq022"
      LET r_sql2=r_sql2,",glaq022 glar017"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad011='Y' THEN
      LET r_sql =r_sql,",glar018"
      LET r_sql1=r_sql1,",glaq023"
      LET r_sql2=r_sql2,",glaq023 glar018"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad012='Y' THEN
      LET r_sql =r_sql,",glar019"
      LET r_sql1=r_sql1,",glaq024"
      LET r_sql2=r_sql2,",glaq024 glar019"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad013='Y' THEN
      LET r_sql =r_sql,",glar020"
      LET r_sql1=r_sql1,",glaq025"
      LET r_sql2=r_sql2,",glaq025 glar020"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad014='Y' THEN
      LET r_sql =r_sql,",glar021"
      LET r_sql1=r_sql1,",glaq026"
      LET r_sql2=r_sql2,",glaq026 glar021"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad015='Y' THEN
      LET r_sql =r_sql,",glar022"
      LET r_sql1=r_sql1,",glaq027"
      LET r_sql2=r_sql2,",glaq027 glar022"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   IF tm.glad016='Y' THEN
      LET r_sql =r_sql,",glar023"
      LET r_sql1=r_sql1,",glaq028"
      LET r_sql2=r_sql2,",glaq028 glar023"
   ELSE
      LET r_sql =r_sql,",''"
      LET r_sql1=r_sql1,",''"
      LET r_sql2=r_sql2,",''"
   END IF
   
   RETURN r_sql,r_sql1,r_sql2
END FUNCTION]]>
</point>
  <point name="b_fill.sql_before" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[   RETURN]]>
</point>
  <point name="cs.after_construct" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[   IF l_flag=TRUE THEN
      CALL aglq750_get_data()
      SELECT COUNT(*) INTO l_cnt FROM aglq750_tmp
      IF l_cnt=0 THEN 
         CALL cl_err('',-100,0)
         RETURN
      END IF
      CALL aglq750_set_page()
      CALL aglq750_fetch1('F')
   ELSE
      CALL aglq750_b_fill1()
      DISPLAY g_current_idx TO FORMONLY.h_index
      DISPLAY g_glar_s.getLength() TO FORMONLY.h_count
      DISPLAY g_detail_idx TO FORMONLY.idx
   END IF]]>
</point>
  <point name="detail_show.body.reference" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[    #科目編號
   INITIALIZE g_ref_fields TO NULL
   LET g_ref_fields[1] = g_glar_d[l_ac].glar001
   CALL ap_ref_array2(g_ref_fields,"SELECT glacl004 FROM glacl_t WHERE glaclent='"||g_enterprise||"' AND glacl001 = '"||g_glaa004||"' AND glacl002 = ? AND glacl003='"||g_dlang||"'","") RETURNING g_rtn_fields
   LET g_glar_d[l_ac].glar001_desc=g_rtn_fields[1]
   #營運據點
   IF tm.comp='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =g_glar_d[l_ac].glar012
      CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar012_desc=g_rtn_fields[1]
   END IF
   #部門
   IF tm.glad007='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =g_glar_d[l_ac].glar013
      CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar013_desc=g_rtn_fields[1]
   END IF
   #成本中心
   IF tm.glad008='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] =g_glar_d[l_ac].glar014
      CALL ap_ref_array2(g_ref_fields,"SELECT ooefl003 FROM ooefl_t WHERE ooeflent='"||g_enterprise||"' AND ooefl001=? AND ooefl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar014_desc=g_rtn_fields[1]
   END IF
   #區域
   IF tm.glad009='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = '287'
      LET g_ref_fields[2] = g_glar_d[l_ac].glar015
      CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar015_desc=g_rtn_fields[1] 
   END IF
   #交易客戶
   IF tm.glad010='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glar_d[l_ac].glar016
      CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar016_desc=g_rtn_fields[1]
   END IF
   #帳款客戶
   IF tm.glad027='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glar_d[l_ac].glar017
      CALL ap_ref_array2(g_ref_fields,"SELECT pmaal004 FROM pmaal_t WHERE pmaalent='"||g_enterprise||"' AND pmaal001=? AND pmaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar017_desc=g_rtn_fields[1]
   END IF
   #客群   
   IF tm.glad011='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = '281'
      LET g_ref_fields[2] = g_glar_d[l_ac].glar018
      CALL ap_ref_array2(g_ref_fields,"SELECT oocql004 FROM oocql_t WHERE oocqlent='"||g_enterprise||"' AND oocql001=? AND oocql002=? AND oocql003='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar018_desc=g_rtn_fields[1] 
   END IF
   #產品類別
   IF tm.glad012='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glar_d[l_ac].glar019
      CALL ap_ref_array2(g_ref_fields,"SELECT rtaxl003 FROM rtaxl_t WHERE rtaxlent='"||g_enterprise||"' AND rtaxl001=? AND rtaxl002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar019_desc=g_rtn_fields[1]
   END IF
   #人員編號
   IF tm.glad013='Y' THEN
      SELECT oofa011 INTO g_glar_d[l_ac].glar020_desc FROM oofa_t
       WHERE oofaent = g_enterprise
         AND oofa001 IN (SELECT ooag002 FROM ooag_t WHERE ooagent = g_enterprise
                            AND ooag001 = g_glar_d[l_ac].glar020)
   END IF
   #預算編號
   IF tm.glad014='Y' THEN
      INITIALIZE g_ref_fields TO NULL
      LET g_ref_fields[1] = g_glar_d[l_ac].glar021
      CALL ap_ref_array2(g_ref_fields,"SELECT bgaal003 FROM bgaal_t WHERE bgaalent='"||g_enterprise||"' AND bgaal001=? AND bgaal002='"||g_dlang||"'","") RETURNING g_rtn_fields
      LET g_glar_d[l_ac].glar021_desc=g_rtn_fields[1]
   END IF]]>
</point>
  <point name="fetch.define" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[   RETURN]]>
</point>
  <point name="global.variable" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[#依据当前账别，抓取账别所归属的法人，使用币别，汇率参照表号，会计科目参照表号
DEFINE g_bookno        LIKE glap_t.glapld
DEFINE g_glaald        LIKE glaa_t.glaald
DEFINE g_glaald_desc   LIKE glaal_t.glaal002
DEFINE g_glaacomp      LIKE glaa_t.glaacomp
DEFINE g_glaacomp_desc LIKE ooefl_t.ooefl003
DEFINE g_glaa001       LIKE glaa_t.glaa001
DEFINE g_glaa002       LIKE glaa_t.glaa002
DEFINE g_glaa003       LIKE glaa_t.glaa003
DEFINE g_glaa004       LIKE glaa_t.glaa004
DEFINE g_glaa013       LIKE glaa_t.glaa013
DEFINE g_glaa015       LIKE glaa_t.glaa015
DEFINE g_glaa016       LIKE glaa_t.glaa016
DEFINE g_glaa017       LIKE glaa_t.glaa017
DEFINE g_glaa018       LIKE glaa_t.glaa018
DEFINE g_glaa019       LIKE glaa_t.glaa019
DEFINE g_glaa020       LIKE glaa_t.glaa020
DEFINE g_glaa021       LIKE glaa_t.glaa021
DEFINE g_glaa022       LIKE glaa_t.glaa022
#查询条件定义
DEFINE tm              RECORD
       year            LIKE glap_t.glap002,    #起始年度
       speriod         LIKE glap_t.glap004,    #起始期別
       eperiod         LIKE glap_t.glap004,    #截止期別
       acc_p           LIKE type_t.chr1,       #按科目分頁
       ctype           LIKE type_t.chr1,       #多本位幣
       show_acc        LIKE type_t.chr1, 
       glac005	       LIKE glac_t.glac005,
       stus            LIKE type_t.chr1,
       glac009	       LIKE glac_t.glac009,
       show_ce         LIKE type_t.chr1,
       show_ye         LIKE type_t.chr1,
       comp            LIKE type_t.chr1,
       glad007         LIKE type_t.chr1,
       glad008         LIKE type_t.chr1,
       glad009         LIKE type_t.chr1,
       glad010         LIKE type_t.chr1,
       glad027         LIKE type_t.chr1,
       glad011         LIKE type_t.chr1,
       glad012         LIKE type_t.chr1,
       glad013         LIKE type_t.chr1,
       glad014         LIKE type_t.chr1,
       glad015         LIKE type_t.chr1,
       glad016         LIKE type_t.chr1
       END RECORD
DEFINE g_glar001       LIKE glar_t.glar001
DEFINE g_glar_s        DYNAMIC ARRAY OF RECORD    #資料瀏覽之欄位 
       glar001         LIKE glar_t.glar001
      END RECORD 
DEFINE g_current_row   LIKE type_t.num5 
DEFINE g_current_idx   LIKE type_t.num10     
DEFINE g_jump          LIKE type_t.num10        
DEFINE g_no_ask        LIKE type_t.num5  
DEFINE g_rec_b         LIKE type_t.num5
DEFINE g_max_period    LIKE glap_t.glap004]]>
</point>
  <point name="init.define" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[   DEFINE l_success   LIKE type_t.num5
   DEFINE l_pass      LIKE type_t.num5]]>
</point>
  <point name="init.init" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[   LET g_detail_idx  = 1
   CALL cl_set_combo_scc('stus','9922')
   CALL cl_set_combo_scc('state','9926')
   CALL cl_set_combo_scc('style','9927')
   #获取账别
   IF cl_null(g_glaald) THEN
      CALL s_ld_bookno()  RETURNING l_success,g_glaald
      IF l_success = FALSE THEN
         RETURN 
      END IF 
      CALL s_ld_chk_authorization(g_user,g_glaald) RETURNING l_pass
      IF l_pass = FALSE THEN
         CALL cl_err(g_glaald,'agl-00164',1)
         RETURN
      END IF
   END IF      
   CALL aglq750_glaald_desc(g_glaald)
   CALL aglq750_set_default_value()
   #建立临时表
   CALL aglq750_create_temp_table()]]>
</point>
  <point name="input.body.before_row" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               DISPLAY g_current_idx TO FORMONLY.h_index
               DISPLAY g_glar_s.getLength() TO FORMONLY.h_count
               DISPLAY g_detail_idx TO FORMONLY.idx
               DISPLAY g_glar_d.getLength() TO FORMONLY.cnt]]>
</point>
  <point name="menu.exchange_ld" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               CALL aglt310_01(g_glaald) RETURNING g_bookno
               IF g_glaald <> g_bookno THEN
                  CLEAR FORM
                  CALL g_glar_s.clear()
                  CALL g_glar_d.clear()
               END IF
               LET g_glaald = g_bookno
               #依据对应的主账套编码，抓取对应法人，币别，汇率参照编号，会计科目参照编号,关账日期
               CALL aglq750_glaald_desc(g_glaald)
               CALL aglq750_show()
                IF cl_null(g_wc) THEN
                   LET g_wc = '1=1'
                END IF ]]>
</point>
  <point name="menu.first1" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               CALL aglq750_fetch1('F')
               LET g_current_row = g_current_idx
               LET g_curr_diag = ui.DIALOG.getCurrent()]]>
</point>
  <point name="menu.jump1" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               CALL aglq750_fetch1('/')
               LET g_current_row = g_current_idx
               LET g_curr_diag = ui.DIALOG.getCurrent()]]>
</point>
  <point name="menu.last1" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               CALL aglq750_fetch1('L')
               LET g_current_row = g_current_idx
               LET g_curr_diag = ui.DIALOG.getCurrent()]]>
</point>
  <point name="menu.next1" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               CALL aglq750_fetch1('N')
               LET g_current_row = g_current_idx
               LET g_curr_diag = ui.DIALOG.getCurrent()]]>
</point>
  <point name="menu.output" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[              ]]>
</point>
  <point name="menu.previous1" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               CALL aglq750_fetch1('P')
               LET g_current_row = g_current_idx
               LET g_curr_diag = ui.DIALOG.getCurrent()]]>
</point>
  <point name="menu.query" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[               EXIT DIALOG]]>
</point>
  <point name="query.define" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[   DEFINE l_flag     LIKE type_t.num5
   DEFINE l_cnt      LIKE type_t.num5    
   
   LET l_flag=TRUE]]>
</point>
  <point name="query.more_construct" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[      INPUT BY NAME tm.year,tm.speriod,tm.eperiod,tm.acc_p,tm.ctype,tm.show_acc,tm.glac005,tm.stus,
                    tm.glac009,tm.show_ce,tm.show_ye,tm.comp,tm.glad007,tm.glad008,tm.glad009,
                    tm.glad010,tm.glad027,tm.glad011,tm.glad012,tm.glad013,tm.glad014,tm.glad015,tm.glad016
         ATTRIBUTE(WITHOUT DEFAULTS)
         BEFORE INPUT
         
         AFTER FIELD year
            IF not cl_null(tm.year) THEN
               #獲取現行會計週期最大期別
               SELECT MAX(glav006) INTO g_max_period FROM glav_t 
               WHERE glavent=g_enterprise AND glav001=g_glaa003 AND glav002=tm.year
            END IF
            
         AFTER FIELD speriod
            IF NOT cl_ap_chk_Range(tm.speriod,"0","1",g_max_period,"1","azz-00087",1) THEN
               NEXT FIELD speriod
            END IF
            IF NOT cl_null(tm.speriod) AND NOT cl_null(tm.eperiod) AND (tm.speriod>tm.eperiod) THEN
               CALL cl_err('','agl-00227',0)
               NEXT FIELD speriod
            END IF
            
         AFTER FIELD eperiod
            IF NOT cl_ap_chk_Range(tm.eperiod,"0","1",g_max_period,"1","azz-00087",1) THEN
               NEXT FIELD eperiod
            END IF
            IF NOT cl_null(tm.speriod) AND NOT cl_null(tm.eperiod) AND (tm.speriod>tm.eperiod) THEN
               CALL cl_err('','agl-00228',0)
               NEXT FIELD eperiod
            END IF
         
         AFTER FIELD acc_p
            IF tm.acc_p NOT MATCHES '[yYnN]' THEN
               NEXT FIELD acc_p
            END IF
            
         ON CHANGE ctype
            IF tm.ctype MATCHES '[123]' THEN
               CALL aglq750_set_curr_show()
            ELSE
               NEXT FIELD ctype
            END IF
            
         AFTER FIELD show_acc
            IF tm.show_acc NOT MATCHES '[yYnN]' THEN
               NEXT FIELD show_acc
            END IF
         
         AFTER FIELD glac005
            IF NOT cl_ap_chk_Range(tm.glac005,"1","1","99","1","azz-00087",1) THEN
               NEXT FIELD glac005
            END IF
         
         AFTER FIELD stus
            IF tm.stus NOT MATCHES '[123]' THEN
               NEXT FIELD stus
            END IF
            
         AFTER FIELD glac009
            IF tm.glac009 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glac009
            END IF
            
         AFTER FIELD show_ce
            IF tm.show_ce NOT MATCHES '[yYnN]' THEN
               NEXT FIELD show_ce
            END IF
         
         AFTER FIELD show_ye
            IF tm.show_ye NOT MATCHES '[yYnN]' THEN
               NEXT FIELD show_ye
            END IF
         
         ON CHANGE comp
            IF tm.comp NOT MATCHES '[yYnN]' THEN
               NEXT FIELD comp
            END IF
            IF tm.comp='Y' THEN
               CALL cl_set_comp_visible("b_glar012,b_glar012_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar012,b_glar012_desc",FALSE)
            END IF
            
         ON CHANGE glad007
            IF tm.glad007 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad007
            END IF
            IF tm.glad007='Y' THEN
               CALL cl_set_comp_visible("b_glar013,b_glar013_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar013,b_glar013_desc",FALSE)
            END IF
            
         ON CHANGE glad008
            IF tm.glad008 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad008
            END IF
            IF tm.glad008='Y' THEN
               CALL cl_set_comp_visible("b_glar014,b_glar014_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar014,b_glar014_desc",FALSE)
            END IF
            
         ON CHANGE glad009
            IF tm.glad009 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad009
            END IF
            IF tm.glad009='Y' THEN
               CALL cl_set_comp_visible("b_glar015,b_glar015_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar015,b_glar015_desc",FALSE)
            END IF
         
         ON CHANGE glad010
            IF tm.glad010 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad010
            END IF
            IF tm.glad010='Y' THEN
               CALL cl_set_comp_visible("b_glar016,b_glar016_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar016,b_glar016_desc",FALSE)
            END IF
            
         ON CHANGE glad027
            IF tm.glad027 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad027
            END IF
            IF tm.glad027='Y' THEN
               CALL cl_set_comp_visible("b_glar017,b_glar017_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar017,b_glar017_desc",FALSE)
            END IF
            
         ON CHANGE glad011
            IF tm.glad011 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad011
            END IF
            IF tm.glad011='Y' THEN
               CALL cl_set_comp_visible("b_glar018,b_glar018_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar018,b_glar018_desc",FALSE)
            END IF
            
         ON CHANGE glad012
            IF tm.glad012 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad012
            END IF
            IF tm.glad012='Y' THEN
               CALL cl_set_comp_visible("b_glar019,b_glar019_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar019,b_glar019_desc",FALSE)
            END IF
         
         ON CHANGE glad013
            IF tm.glad013 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad013
            END IF
            IF tm.glad013='Y' THEN
               CALL cl_set_comp_visible("b_glar020,b_glar020_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar020,b_glar020_desc",FALSE)
            END IF 
         
         ON CHANGE glad014
            IF tm.glad014 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad014
            END IF
            IF tm.glad014='Y' THEN
               CALL cl_set_comp_visible("b_glar021,b_glar021_desc",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar021,b_glar021_desc",FALSE)
            END IF

         ON CHANGE glad015
            IF tm.glad015 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad015
            END IF
            IF tm.glad015='Y' THEN
               CALL cl_set_comp_visible("b_glar022",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar022",FALSE)
            END IF
            
         ON CHANGE glad016
            IF tm.glad016 NOT MATCHES '[yYnN]' THEN
               NEXT FIELD glad016
            END IF
            IF tm.glad016='Y' THEN
               CALL cl_set_comp_visible("b_glar023",TRUE)
            ELSE
               CALL cl_set_comp_visible("b_glar023",FALSE)
            END IF
         AFTER INPUT 
            IF NOT cl_null(tm.speriod) AND NOT cl_ap_chk_Range(tm.speriod,"0","1",g_max_period,"1","azz-00087",1) THEN
               NEXT FIELD speriod
            END IF
            
            IF NOT cl_null(tm.eperiod) AND NOT cl_ap_chk_Range(tm.eperiod,"0","1",g_max_period,"1","azz-00087",1) THEN
               NEXT FIELD eperiod
            END IF
      END INPUT
      
      BEFORE DIALOG
        #預設
        CALL aglq750_show()
        ]]>
</point>
  <point name="ui_dialog.bef_dialog" cite_std="N" status="" ver="1" src="s" new="N" mark_hard="N">
<![CDATA[            #上下筆按鈕顯示否設置
            IF g_header_cnt=1 THEN
               CALL cl_set_act_visible("first,previous,jump,next,last",FALSE) 
            ELSE
               IF g_current_idx=1 THEN
                  CALL cl_set_act_visible("first,previous", FALSE) 
                  CALL cl_set_act_visible("jump,next,last", TRUE) 
               ELSE
                  IF g_current_idx<>g_header_cnt THEN
                     CALL cl_set_act_visible("first,previous,jump,next,last",TRUE) 
                  ELSE
                     CALL cl_set_act_visible("first,previous,jump",TRUE) 
                     CALL cl_set_act_visible("next,last", FALSE) 
                  END IF
               END IF
            END IF
            CALL gfrm_curr.setFieldHidden("formonly.sel", TRUE)]]>
</point>
  <point name="global.memo" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="global.import" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="global.inc" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="global.argv" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.init" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.define_sql" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.after_define_sql" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.after_refresh_sql" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.servicecall" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.before_close" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="main.exit" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="ui_dialog.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="ui_dialog.before_dialog" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="ui_dialog.more_displayarray" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="menu.datainfo" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="ui_dialog.onaction_selall" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="ui_dialog.onaction_selnone" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="ui_dialog.onaction_sel" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="ui_dialog.onaction_unsel" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="menu.filter" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="cs.head.before_construct" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar001" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar001" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar012" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar012" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.c.page1.b_glar012" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar013" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar013" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.c.page1.b_glar013" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar014" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar014" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar015" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar015" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar016" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar016" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar017" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar017" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar018" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar018" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar019" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar019" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar020" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar020" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.b.page1.b_glar021" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="construct.a.page1.b_glar021" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="b_fill.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="b_fill.sql_after" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="b_fill.fill" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="b_fill.others.fill" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="fetch.after_fill" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="detail_show.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="detail_show.before" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="detail_show.after" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="filter.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="filter.add_cs" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="filter.b_dialog" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="filter_parser.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="insert.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="insert.control" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="modify.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="modify.control" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="reproduce.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="reproduce.control" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="delete.define" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <point name="delete.control" cite_std="N" status="" ver="" src="s" new="Y">
<![CDATA[]]>
</point>
  <section id="aglq750.query" ver="1" status="" src="m">
<![CDATA[#+ QBE資料查詢
PRIVATE FUNCTION aglq750_query()
   {<Local define>}
   DEFINE ls_wc      LIKE type_t.chr500
   DEFINE ls_return  STRING
   DEFINE ls_result  STRING 
   {</Local define>}
   #add-point:query段define
{<point name="query.define"/>}
   #end add-point 
   
   LET INT_FLAG = 0
   CLEAR FORM
   CALL g_glar_d.clear()
   LET g_wc_filter = " 1=1"
   
   CALL gfrm_curr.setFieldHidden("formonly.sel", TRUE)
   CALL gfrm_curr.setFieldHidden("formonly.statepic", TRUE)
   
   LET g_qryparam.state = "c"
   LET g_detail_idx  = 1
   LET g_detail_idx2 = 1
   
   #wc備份
   LET ls_wc = g_wc
   LET g_master_idx = l_ac
 
   
 
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
      #單身根據table分拆construct
      CONSTRUCT g_wc_table ON glar001,glar012,glar013,glar014,glar015,glar016,glar017,glar018,glar019, 
          glar020,glar021
           FROM s_detail1[1].b_glar001,s_detail1[1].b_glar012,s_detail1[1].b_glar013,s_detail1[1].b_glar014, 
               s_detail1[1].b_glar015,s_detail1[1].b_glar016,s_detail1[1].b_glar017,s_detail1[1].b_glar018, 
               s_detail1[1].b_glar019,s_detail1[1].b_glar020,s_detail1[1].b_glar021
                      
         BEFORE CONSTRUCT
            #add-point:cs段more_construct
{<point name="cs.head.before_construct"/>}
            #end add-point 
            
       #單身公用欄位開窗相關處理
       
         
       #單身一般欄位開窗相關處理
       #---------------------<  Detail: page1  >---------------------
         #----<<b_glar001>>----
         #Ctrlp:construct.c.page1.b_glar001
         ON ACTION controlp INFIELD b_glar001
            #add-point:ON ACTION controlp INFIELD b_glar001
{<point name="construct.c.page1.b_glar001" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar001
            #add-point:BEFORE FIELD b_glar001
{<point name="construct.b.page1.b_glar001" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar001
            
            #add-point:AFTER FIELD b_glar001
{<point name="construct.a.page1.b_glar001" />}
            #END add-point
            
 
         #----<<b_glar012>>----
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar012
            #add-point:BEFORE FIELD b_glar012
{<point name="construct.b.page1.b_glar012" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar012
            
            #add-point:AFTER FIELD b_glar012
{<point name="construct.a.page1.b_glar012" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.b_glar012
         ON ACTION controlp INFIELD b_glar012
            #add-point:ON ACTION controlp INFIELD b_glar012
{<point name="construct.c.page1.b_glar012" />}
            #END add-point
 
         #----<<b_glar013>>----
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar013
            #add-point:BEFORE FIELD b_glar013
{<point name="construct.b.page1.b_glar013" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar013
            
            #add-point:AFTER FIELD b_glar013
{<point name="construct.a.page1.b_glar013" />}
            #END add-point
            
 
         #Ctrlp:construct.c.page1.b_glar013
         ON ACTION controlp INFIELD b_glar013
            #add-point:ON ACTION controlp INFIELD b_glar013
{<point name="construct.c.page1.b_glar013" />}
            #END add-point
 
         #----<<b_glar014>>----
         #Ctrlp:construct.c.page1.b_glar014
         ON ACTION controlp INFIELD b_glar014
            #add-point:ON ACTION controlp INFIELD b_glar014
{<point name="construct.c.page1.b_glar014" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar014
            #add-point:BEFORE FIELD b_glar014
{<point name="construct.b.page1.b_glar014" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar014
            
            #add-point:AFTER FIELD b_glar014
{<point name="construct.a.page1.b_glar014" />}
            #END add-point
            
 
         #----<<b_glar015>>----
         #Ctrlp:construct.c.page1.b_glar015
         ON ACTION controlp INFIELD b_glar015
            #add-point:ON ACTION controlp INFIELD b_glar015
{<point name="construct.c.page1.b_glar015" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar015
            #add-point:BEFORE FIELD b_glar015
{<point name="construct.b.page1.b_glar015" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar015
            
            #add-point:AFTER FIELD b_glar015
{<point name="construct.a.page1.b_glar015" />}
            #END add-point
            
 
         #----<<b_glar016>>----
         #Ctrlp:construct.c.page1.b_glar016
         ON ACTION controlp INFIELD b_glar016
            #add-point:ON ACTION controlp INFIELD b_glar016
{<point name="construct.c.page1.b_glar016" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar016
            #add-point:BEFORE FIELD b_glar016
{<point name="construct.b.page1.b_glar016" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar016
            
            #add-point:AFTER FIELD b_glar016
{<point name="construct.a.page1.b_glar016" />}
            #END add-point
            
 
         #----<<b_glar017>>----
         #Ctrlp:construct.c.page1.b_glar017
         ON ACTION controlp INFIELD b_glar017
            #add-point:ON ACTION controlp INFIELD b_glar017
{<point name="construct.c.page1.b_glar017" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar017
            #add-point:BEFORE FIELD b_glar017
{<point name="construct.b.page1.b_glar017" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar017
            
            #add-point:AFTER FIELD b_glar017
{<point name="construct.a.page1.b_glar017" />}
            #END add-point
            
 
         #----<<b_glar018>>----
         #Ctrlp:construct.c.page1.b_glar018
         ON ACTION controlp INFIELD b_glar018
            #add-point:ON ACTION controlp INFIELD b_glar018
{<point name="construct.c.page1.b_glar018" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar018
            #add-point:BEFORE FIELD b_glar018
{<point name="construct.b.page1.b_glar018" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar018
            
            #add-point:AFTER FIELD b_glar018
{<point name="construct.a.page1.b_glar018" />}
            #END add-point
            
 
         #----<<b_glar019>>----
         #Ctrlp:construct.c.page1.b_glar019
         ON ACTION controlp INFIELD b_glar019
            #add-point:ON ACTION controlp INFIELD b_glar019
{<point name="construct.c.page1.b_glar019" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar019
            #add-point:BEFORE FIELD b_glar019
{<point name="construct.b.page1.b_glar019" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar019
            
            #add-point:AFTER FIELD b_glar019
{<point name="construct.a.page1.b_glar019" />}
            #END add-point
            
 
         #----<<b_glar020>>----
         #Ctrlp:construct.c.page1.b_glar020
         ON ACTION controlp INFIELD b_glar020
            #add-point:ON ACTION controlp INFIELD b_glar020
{<point name="construct.c.page1.b_glar020" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar020
            #add-point:BEFORE FIELD b_glar020
{<point name="construct.b.page1.b_glar020" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar020
            
            #add-point:AFTER FIELD b_glar020
{<point name="construct.a.page1.b_glar020" />}
            #END add-point
            
 
         #----<<b_glar021>>----
         #Ctrlp:construct.c.page1.b_glar021
         ON ACTION controlp INFIELD b_glar021
            #add-point:ON ACTION controlp INFIELD b_glar021
{<point name="construct.c.page1.b_glar021" />}
            #END add-point
 
         #此段落由子樣板a01產生
         BEFORE FIELD b_glar021
            #add-point:BEFORE FIELD b_glar021
{<point name="construct.b.page1.b_glar021" />}
            #END add-point
 
         #此段落由子樣板a02產生
         AFTER FIELD b_glar021
            
            #add-point:AFTER FIELD b_glar021
{<point name="construct.a.page1.b_glar021" />}
            #END add-point
            
 
   
       
      END CONSTRUCT
      
 
      
 
  
      #add-point:query段more_construct
{<point name="query.more_construct"/>}
      #end add-point 
      
      ON ACTION accept
         ACCEPT DIALOG
         
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG
      
      #交談指令共用ACTION
      &include "common_action.4gl"
         CONTINUE DIALOG 
   END DIALOG
 
   
 
   IF INT_FLAG THEN
      LET INT_FLAG = 0
      #還原
      LET g_wc = ls_wc
      LET l_flag=FALSE
   ELSE
      LET g_master_idx = 1
   END IF
   
   LET g_wc = g_wc_table 
 
 
        
   LET g_wc2 = " 1=1"
 
        
   #add-point:cs段after_construct
{<point name="cs.after_construct"/>}
   #end add-point
        
   LET g_error_show = 1
   CALL aglq750_b_fill()
   LET l_ac = g_master_idx
   CALL aglq750_fetch()
#   IF g_detail_cnt = 0 AND NOT INT_FLAG THEN
#      CALL cl_err("",-100,1)
#   END IF
   
   CALL gfrm_curr.setFieldHidden("formonly.sel", FALSE)
   CALL gfrm_curr.setFieldHidden("formonly.statepic", FALSE)
   
END FUNCTION
]]>
</section>
  <section id="aglq750.ui_dialog" ver="1" status="" src="m">
<![CDATA[#+ 功能選單 
PRIVATE FUNCTION aglq750_ui_dialog()
   {<Local define>}
   DEFINE li_idx   LIKE type_t.num5
   {</Local define>}
   #add-point:ui_dialog段define
{<point name="ui_dialog.define"/>}
   #end add-point 
 
   LET gwin_curr = ui.Window.getCurrent()
   LET gfrm_curr = gwin_curr.getForm()   
   
   LET g_action_choice = " "  
   CALL cl_set_act_visible("accept,cancel", FALSE)
         
   #add-point:ui_dialog段before dialog 
{<point name="ui_dialog.before_dialog"/>}
   #end add-point
   
   CALL aglq750_query()
   
   WHILE TRUE
   
      DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
         DISPLAY ARRAY g_glar_d TO s_detail1.* ATTRIBUTE(COUNT=g_detail_cnt) 
      
            BEFORE DISPLAY 
               LET g_current_page = 1
 
            BEFORE ROW
               LET g_detail_idx = DIALOG.getCurrentRow("s_detail1")
               LET l_ac = g_detail_idx
               DISPLAY g_detail_idx TO FORMONLY.h_index
               DISPLAY g_glar_d.getLength() TO FORMONLY.h_count
               LET g_master_idx = l_ac
               CALL aglq750_fetch()
               #add-point:input段before row
{<point name="input.body.before_row"/>}
               #end add-point  
            
            #自訂ACTION(detail_show,page_1)
            
               
         END DISPLAY
      
 
         
 
      
         #add-point:ui_dialog段define
{<point name="ui_dialog.more_displayarray"/>}
         #end add-point
         
         BEFORE DIALOG      
            CALL DIALOG.setSelectionMode("s_detail1", 1)
 
            #add-point:ui_dialog段before dialog
{<point name="ui_dialog.bef_dialog"/>}
            #end add-point
 
            NEXT FIELD sel
      
         
 
         ON ACTION last
 
            LET g_action_choice="last"
            IF cl_auth_chk_act("last") THEN 
               #add-point:ON ACTION last
{<point name="menu.last1" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         ON ACTION jump
 
            LET g_action_choice="jump"
            IF cl_auth_chk_act("jump") THEN 
               #add-point:ON ACTION jump
{<point name="menu.jump1" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         ON ACTION output
 
            LET g_action_choice="output"
            IF cl_auth_chk_act("output") THEN 
               #add-point:ON ACTION output
{<point name="menu.output" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         ON ACTION exchange_ld
 
            LET g_action_choice="exchange_ld"
            IF cl_auth_chk_act("exchange_ld") THEN 
               #add-point:ON ACTION exchange_ld
{<point name="menu.exchange_ld" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         ON ACTION previous
 
            LET g_action_choice="previous"
            IF cl_auth_chk_act("previous") THEN 
               #add-point:ON ACTION previous
{<point name="menu.previous1" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         ON ACTION datainfo
 
            LET g_action_choice="datainfo"
            IF cl_auth_chk_act("datainfo") THEN 
               #add-point:ON ACTION datainfo
{<point name="menu.datainfo" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         ON ACTION query
 
            LET g_action_choice="query"
            IF cl_auth_chk_act("query") THEN 
               CALL aglq750_query()
               #add-point:ON ACTION query
{<point name="menu.query" />}
               #END add-point
            END IF
 
 
         ON ACTION next
 
            LET g_action_choice="next"
            IF cl_auth_chk_act("next") THEN 
               #add-point:ON ACTION next
{<point name="menu.next1" />}
               #END add-point
               EXIT DIALOG
            END IF
 
 
         ON ACTION first
 
            LET g_action_choice="first"
            IF cl_auth_chk_act("first") THEN 
               #add-point:ON ACTION first
{<point name="menu.first1" />}
               #END add-point
               EXIT DIALOG
            END IF
 
      
         #選擇全部
         ON ACTION selall
            CALL DIALOG.setSelectionRange("s_detail1", 1, -1, 1)
            FOR li_idx = 1 TO g_glar_d.getLength()
               LET g_glar_d[li_idx].sel = "Y"
            END FOR
 
            #add-point:ui_dialog段on action selall
{<point name="ui_dialog.onaction_selall"/>}
            #end add-point
 
         #取消全部
         ON ACTION selnone
            CALL DIALOG.setSelectionRange("s_detail1", 1, -1, 0)
            FOR li_idx = 1 TO g_glar_d.getLength()
               LET g_glar_d[li_idx].sel = "N"
            END FOR
 
            #add-point:ui_dialog段on action selnone
{<point name="ui_dialog.onaction_selnone"/>}
            #end add-point
 
         #勾選所選資料
         ON ACTION sel
            FOR li_idx = 1 TO g_glar_d.getLength()
               IF DIALOG.isRowSelected("s_detail1", li_idx) THEN
                  LET g_glar_d[li_idx].sel = "Y"
               END IF
            END FOR
 
            #add-point:ui_dialog段on action sel
{<point name="ui_dialog.onaction_sel"/>}
            #end add-point
 
         #取消所選資料
         ON ACTION unsel
            FOR li_idx = 1 TO g_glar_d.getLength()
               IF DIALOG.isRowSelected("s_detail1", li_idx) THEN
                  LET g_glar_d[li_idx].sel = "N"
               END IF
            END FOR
 
            #add-point:ui_dialog段on action unsel
{<point name="ui_dialog.onaction_unsel"/>}
            #end add-point
      
         ON ACTION filter
            LET g_action_choice="filter"
            CALL aglq750_filter()
            #add-point:ON ACTION filter
{<point name="menu.filter" />}
            #END add-point
            EXIT DIALOG
      
         ON ACTION close
            LET INT_FLAG=FALSE         
            LET g_action_choice = "exit"
            EXIT DIALOG
      
         ON ACTION exit
            LET g_action_choice="exit"
            EXIT DIALOG
 
         # 重新整理
         ON ACTION datarefresh
            LET g_error_show = 1
            CALL aglq750_b_fill()
            CALL aglq750_fetch()
            
         
      
         #主選單用ACTION
         &include "main_menu.4gl"
         &include "relating_action.4gl"
         #交談指令共用ACTION
         &include "common_action.4gl"
            CONTINUE DIALOG
      END DIALOG
      
      IF g_action_choice = "exit" AND NOT cl_null(g_action_choice) THEN
         EXIT WHILE
      END IF
      
   END WHILE
 
   CALL cl_set_act_visible("accept,cancel", TRUE)
 
END FUNCTION
]]>
</section>
  <section id="aglq750.b_fill" ver="12" status="" src="s">
<![CDATA[#+ 單身陣列填充
PRIVATE FUNCTION aglq750_b_fill()
   {<Local define>}
   DEFINE ls_wc           STRING
   {</Local define>}
   #add-point:b_fill段define
   {<point name="b_fill.define"/>}
   #end add-point
 
   #add-point:b_fill段sql_before
   {<point name="b_fill.sql_before"/>}
   #end add-point
   
   IF cl_null(g_wc_filter) THEN
      LET g_wc_filter = " 1=1"
   END IF
   IF cl_null(g_wc) THEN
      LET g_wc = " 1=1"
   END IF
   IF cl_null(g_wc2) THEN
      LET g_wc2 = " 1=1"
   END IF
   
   LET ls_wc = g_wc, " AND ", g_wc2, " AND ", g_wc_filter
   
   LET g_sql = "SELECT  UNIQUE glar001,'',glar012,'',glar013,'',glar014,'',glar015,'',glar016,'',glar017, 
       '',glar018,'',glar019,'',glar020,'',glar021,'',glar022,glar023,'','','','','','','','','','', 
       '','' FROM glar_t",
 
 
               "",
               " WHERE glarent= ? AND 1=1 AND ", ls_wc
    
   LET g_sql = g_sql, " ORDER BY glar_t.glarld,glar_t.glar001,glar_t.glar002,glar_t.glar003,glar_t.glar004"
  
   #add-point:b_fill段sql_after
   {<point name="b_fill.sql_after"/>}
   #end add-point
  
   PREPARE aglq750_pb FROM g_sql
   DECLARE b_fill_curs CURSOR FOR aglq750_pb
   
   OPEN b_fill_curs USING g_enterprise
 
   CALL g_glar_d.clear()
 
 
   LET g_cnt = l_ac
   LET l_ac = 1   
   ERROR "Searching!" 
 
   FOREACH b_fill_curs INTO g_glar_d[l_ac].glar001,g_glar_d[l_ac].glar001_desc,g_glar_d[l_ac].glar012, 
       g_glar_d[l_ac].glar012_desc,g_glar_d[l_ac].glar013,g_glar_d[l_ac].glar013_desc,g_glar_d[l_ac].glar014, 
       g_glar_d[l_ac].glar014_desc,g_glar_d[l_ac].glar015,g_glar_d[l_ac].glar015_desc,g_glar_d[l_ac].glar016, 
       g_glar_d[l_ac].glar016_desc,g_glar_d[l_ac].glar017,g_glar_d[l_ac].glar017_desc,g_glar_d[l_ac].glar018, 
       g_glar_d[l_ac].glar018_desc,g_glar_d[l_ac].glar019,g_glar_d[l_ac].glar019_desc,g_glar_d[l_ac].glar020, 
       g_glar_d[l_ac].glar020_desc,g_glar_d[l_ac].glar021,g_glar_d[l_ac].glar021_desc,g_glar_d[l_ac].glar022, 
       g_glar_d[l_ac].glar023,g_glar_d[l_ac].glar003,g_glar_d[l_ac].style,g_glar_d[l_ac].glar005,g_glar_d[l_ac].glar006, 
       g_glar_d[l_ac].glar034,g_glar_d[l_ac].glar035,g_glar_d[l_ac].glar036,g_glar_d[l_ac].glar037,g_glar_d[l_ac].state, 
       g_glar_d[l_ac].amt1,g_glar_d[l_ac].amt2,g_glar_d[l_ac].amt3
      IF SQLCA.sqlcode THEN
         CALL cl_err("FOREACH:",SQLCA.sqlcode,1)
         EXIT FOREACH
      END IF
      
      LET g_glar_d[l_ac].sel = "N"
      #LET g_glar_d[l_ac].statepic = cl_get_actipic(g_glar_d[l_ac].statepic)
 
      
 
      #add-point:b_fill段資料填充
      {<point name="b_fill.fill"/>}
      #end add-point
      
      CALL aglq750_detail_show()      
 
      LET l_ac = l_ac + 1
      IF l_ac > g_max_rec THEN
         IF g_error_show = 1 THEN
            CALL cl_err( "", 9035, 1 )
         END IF
         EXIT FOREACH
      END IF
      
   END FOREACH
   LET g_error_show = 0
   
 
   
   CALL g_glar_d.deleteElement(g_glar_d.getLength())   
 
   
   #add-point:b_fill段資料填充(其他單身)
   {<point name="b_fill.others.fill"/>}
   #end add-point
    
   LET g_detail_cnt = l_ac - 1 
   DISPLAY g_detail_cnt TO FORMONLY.h_count
   LET l_ac = g_cnt
   LET g_cnt = 0
   
   CLOSE b_fill_curs
   FREE aglq750_pb
   
   LET l_ac = 1
   CALL aglq750_fetch()
   
      CALL aglq750_filter_show('glar001','b_glar001')
   CALL aglq750_filter_show('glar012','b_glar012')
   CALL aglq750_filter_show('glar013','b_glar013')
   CALL aglq750_filter_show('glar014','b_glar014')
   CALL aglq750_filter_show('glar015','b_glar015')
   CALL aglq750_filter_show('glar016','b_glar016')
   CALL aglq750_filter_show('glar017','b_glar017')
   CALL aglq750_filter_show('glar018','b_glar018')
   CALL aglq750_filter_show('glar019','b_glar019')
   CALL aglq750_filter_show('glar020','b_glar020')
   CALL aglq750_filter_show('glar021','b_glar021')
   CALL aglq750_filter_show('glar022','b_glar022')
   CALL aglq750_filter_show('glar023','b_glar023')
   CALL aglq750_filter_show('glar003','b_glar023')
   CALL aglq750_filter_show('glar005','b_glar023')
   CALL aglq750_filter_show('glar006','b_glar023')
   CALL aglq750_filter_show('glar034','b_glar023')
   CALL aglq750_filter_show('glar035','b_glar023')
   CALL aglq750_filter_show('glar036','b_glar023')
   CALL aglq750_filter_show('glar037','b_glar023')
 
   
END FUNCTION
]]>
</section>
  <section id="aglq750.delete" ver="1" status="" src="s">
<![CDATA[#+ delete
PRIVATE FUNCTION aglq750_delete()
   #add-point:delete段define
   {<point name="delete.define"/>}
   #end add-point
 
   #add-point:delete段control
   {<point name="delete.control"/>}
   #end add-point 
END FUNCTION
]]>
</section>
  <section id="aglq750.description" ver="66" status="" src="s">
<![CDATA[#+ Version..: T100-ERP-1.00.00(版次:1) Build-000065
#+ 
#+ Filename...: aglq750
#+ Description: 總分類帳(核算項)查詢作業
#+ Creator....: 02599(2014/03/27)
#+ Modifier...: 02599(2014/03/28)
#+ Buildtype..: 應用 q02 樣板自動產生
#+ 以上段落由子樣板a00產生
]]>
</section>
  <section id="aglq750.detail_show" ver="1" status="" src="s">
<![CDATA[#+ 顯示相關資料
PRIVATE FUNCTION aglq750_detail_show()
   #add-point:show段define
   {<point name="detail_show.define"/>}
   #end add-point
 
   #add-point:detail_show段之前
   {<point name="detail_show.before"/>}
   #end add-point
   
   
   
   #帶出公用欄位reference值page1
   
    
 
   
   #讀入ref值
   #add-point:show段單身reference
   {<point name="detail_show.body.reference"/>}
   #end add-point
   
 
 
   #add-point:detail_show段之後
   {<point name="detail_show.after"/>}
   #end add-point
 
END FUNCTION
]]>
</section>
  <section id="aglq750.fetch" ver="1" status="" src="s">
<![CDATA[#+ 單身陣列填充2
PRIVATE FUNCTION aglq750_fetch()
   {<Local define>}
   DEFINE li_ac           LIKE type_t.num5
   {</Local define>}
   #add-point:fetch段define
   {<point name="fetch.define"/>}
   #end add-point
   
 
   
   LET li_ac = l_ac 
   
 
   
   #DISPLAY g_detail_cnt TO FORMONLY.cnt
 
   #add-point:單身填充後
   {<point name="fetch.after_fill" />}
   #end add-point 
   
 
   
   LET l_ac = li_ac
   
END FUNCTION
]]>
</section>
  <section id="aglq750.filter" ver="10" status="" src="s">
<![CDATA[#+ filter過濾功能
PRIVATE FUNCTION aglq750_filter()
   {<Local define>}
   {</Local define>}
   #add-point:filter段define
   {<point name="filter.define"/>}
   #end add-point    
   
   LET l_ac = 1
   LET g_detail_idx = 1
   LET g_detail_idx2 = 1
 
   LET INT_FLAG = 0
 
   LET g_qryparam.state = 'c'
 
   LET g_wc_filter_t = g_wc_filter
   LET g_wc_t = g_wc
   
   CALL gfrm_curr.setFieldHidden("formonly.sel", TRUE)
   CALL gfrm_curr.setFieldHidden("formonly.statepic", TRUE)
 
   LET g_wc = cl_replace_str(g_wc, g_wc_filter, '')
 
   #使用DIALOG包住 單頭CONSTRUCT及單身CONSTRUCT
   DIALOG ATTRIBUTES(UNBUFFERED,FIELD ORDER FORM)
 
      #單頭
      CONSTRUCT g_wc_filter ON glar001,glar012,glar013,glar014,glar015,glar016,glar017,glar018,glar019, 
          glar020,glar021,glar022,glar023,glar003,glar005,glar006,glar034,glar035,glar036,glar037
                          FROM s_detail1[1].b_glar001,s_detail1[1].b_glar012,s_detail1[1].b_glar013, 
                              s_detail1[1].b_glar014,s_detail1[1].b_glar015,s_detail1[1].b_glar016,s_detail1[1].b_glar017, 
                              s_detail1[1].b_glar018,s_detail1[1].b_glar019,s_detail1[1].b_glar020,s_detail1[1].b_glar021, 
                              s_detail1[1].b_glar022,s_detail1[1].b_glar023,s_detail1[1].b_glar023,s_detail1[1].b_glar023, 
                              s_detail1[1].b_glar023,s_detail1[1].b_glar023,s_detail1[1].b_glar023,s_detail1[1].b_glar023, 
                              s_detail1[1].b_glar023
 
         BEFORE CONSTRUCT
#saki       CALL cl_qbe_init()
                     DISPLAY aglq750_filter_parser('glar001') TO s_detail1[1].b_glar001
            DISPLAY aglq750_filter_parser('glar012') TO s_detail1[1].b_glar012
            DISPLAY aglq750_filter_parser('glar013') TO s_detail1[1].b_glar013
            DISPLAY aglq750_filter_parser('glar014') TO s_detail1[1].b_glar014
            DISPLAY aglq750_filter_parser('glar015') TO s_detail1[1].b_glar015
            DISPLAY aglq750_filter_parser('glar016') TO s_detail1[1].b_glar016
            DISPLAY aglq750_filter_parser('glar017') TO s_detail1[1].b_glar017
            DISPLAY aglq750_filter_parser('glar018') TO s_detail1[1].b_glar018
            DISPLAY aglq750_filter_parser('glar019') TO s_detail1[1].b_glar019
            DISPLAY aglq750_filter_parser('glar020') TO s_detail1[1].b_glar020
            DISPLAY aglq750_filter_parser('glar021') TO s_detail1[1].b_glar021
            DISPLAY aglq750_filter_parser('glar022') TO s_detail1[1].b_glar022
            DISPLAY aglq750_filter_parser('glar023') TO s_detail1[1].b_glar023
            DISPLAY aglq750_filter_parser('glar003') TO s_detail1[1].b_glar023
            DISPLAY aglq750_filter_parser('glar005') TO s_detail1[1].b_glar023
            DISPLAY aglq750_filter_parser('glar006') TO s_detail1[1].b_glar023
            DISPLAY aglq750_filter_parser('glar034') TO s_detail1[1].b_glar023
            DISPLAY aglq750_filter_parser('glar035') TO s_detail1[1].b_glar023
            DISPLAY aglq750_filter_parser('glar036') TO s_detail1[1].b_glar023
            DISPLAY aglq750_filter_parser('glar037') TO s_detail1[1].b_glar023
 
 
      END CONSTRUCT
 
      #add-point:filter段add_cs
      {<point name="filter.add_cs"/>}
      #end add-point
 
      BEFORE DIALOG
         #add-point:filter段b_dialog
         {<point name="filter.b_dialog"/>}
         #end add-point  
 
      ON ACTION accept
         ACCEPT DIALOG 
 
      ON ACTION cancel
         LET INT_FLAG = 1
         EXIT DIALOG 
 
      #交談指令共用ACTION
      &include "common_action.4gl" 
         CONTINUE DIALOG
 
   END DIALOG
 
   IF NOT INT_FLAG THEN
      LET g_wc_filter = g_wc_filter, " "
   ELSE
      LET g_wc_filter = g_wc_filter_t
   END IF
   
      CALL aglq750_filter_show('glar001','b_glar001')
   CALL aglq750_filter_show('glar012','b_glar012')
   CALL aglq750_filter_show('glar013','b_glar013')
   CALL aglq750_filter_show('glar014','b_glar014')
   CALL aglq750_filter_show('glar015','b_glar015')
   CALL aglq750_filter_show('glar016','b_glar016')
   CALL aglq750_filter_show('glar017','b_glar017')
   CALL aglq750_filter_show('glar018','b_glar018')
   CALL aglq750_filter_show('glar019','b_glar019')
   CALL aglq750_filter_show('glar020','b_glar020')
   CALL aglq750_filter_show('glar021','b_glar021')
   CALL aglq750_filter_show('glar022','b_glar022')
   CALL aglq750_filter_show('glar023','b_glar023')
   CALL aglq750_filter_show('glar003','b_glar023')
   CALL aglq750_filter_show('glar005','b_glar023')
   CALL aglq750_filter_show('glar006','b_glar023')
   CALL aglq750_filter_show('glar034','b_glar023')
   CALL aglq750_filter_show('glar035','b_glar023')
   CALL aglq750_filter_show('glar036','b_glar023')
   CALL aglq750_filter_show('glar037','b_glar023')
 
    
   CALL aglq750_b_fill()
   CALL aglq750_fetch()
   
   CALL gfrm_curr.setFieldHidden("formonly.sel", FALSE)
   CALL gfrm_curr.setFieldHidden("formonly.statepic", FALSE)
 
END FUNCTION
]]>
</section>
  <section id="aglq750.filter_parser" ver="1" status="" src="s">
<![CDATA[#+ filter欄位解析
PRIVATE FUNCTION aglq750_filter_parser(ps_field)
   {<Local define>}
   DEFINE ps_field   STRING
   DEFINE ls_tmp     STRING
   DEFINE li_tmp     LIKE type_t.num5
   DEFINE li_tmp2    LIKE type_t.num5
   DEFINE ls_var     STRING
   {</Local define>}
   #add-point:filter段define
   {<point name="filter_parser.define"/>}
   #end add-point    
 
   #一般條件解析
   LET ls_tmp = ps_field, "='"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
   END IF
 
   #模糊條件解析
   LET ls_tmp = ps_field, " like '"
   LET li_tmp = g_wc_filter.getIndexOf(ls_tmp,1)
   IF li_tmp > 0 THEN
      LET li_tmp = ls_tmp.getLength() + li_tmp
      LET li_tmp2 = g_wc_filter.getIndexOf("'",li_tmp + 1) - 1
      LET ls_var = g_wc_filter.subString(li_tmp,li_tmp2)
      LET ls_var = cl_replace_str(ls_var,'%','*')
   END IF
 
   RETURN ls_var
 
END FUNCTION
]]>
</section>
  <section id="aglq750.filter_show" ver="1" status="" src="s">
<![CDATA[#+ Browser標題欄位顯示搜尋條件
PRIVATE FUNCTION aglq750_filter_show(ps_field,ps_object)
   DEFINE ps_field         STRING
   DEFINE ps_object        STRING
   DEFINE lnode_item       om.DomNode
   DEFINE ls_title         STRING
   DEFINE ls_name          STRING
   DEFINE ls_condition     STRING
 
   LET ls_name = "formonly.", ps_object
 
   LET lnode_item = gfrm_curr.findNode("TableColumn", ls_name)
   LET ls_title = lnode_item.getAttribute("text")
   IF ls_title.getIndexOf('※',1) > 0 THEN
      LEt ls_title = ls_title.subString(1,ls_title.getIndexOf('※',1)-1)
   END IF
 
   #顯示資料組合
   LET ls_condition = aglq750_filter_parser(ps_field)
   IF NOT cl_null(ls_condition) THEN
      LET ls_title = ls_title, '※', ls_condition, '※'
   END IF
 
   #將資料顯示回去
   CALL lnode_item.setAttribute("text",ls_title)
 
END FUNCTION
]]>
</section>
  <section id="aglq750.global" ver="8" status="" src="s">
<![CDATA[{<point name="global.memo" />}
 
IMPORT os
IMPORT util
#add-point:增加匯入項目
{<point name="global.import" />}
#end add-point
 
SCHEMA ds
 
GLOBALS "../../cfg/top_global.inc"
 
#add-point:增加匯入變數檔
{<point name="global.inc" />}
#end add-point
 
#單身 type 宣告
PRIVATE TYPE type_g_glar_d RECORD
       #statepic       LIKE type_t.chr1,
       sel            LIKE type_t.chr1,
       glar001 LIKE glar_t.glar001, 
   glar001_desc LIKE type_t.chr500, 
   glar012 LIKE glar_t.glar012, 
   glar012_desc LIKE type_t.chr500, 
   glar013 LIKE glar_t.glar013, 
   glar013_desc LIKE type_t.chr500, 
   glar014 LIKE glar_t.glar014, 
   glar014_desc LIKE type_t.chr500, 
   glar015 LIKE glar_t.glar015, 
   glar015_desc LIKE type_t.chr500, 
   glar016 LIKE glar_t.glar016, 
   glar016_desc LIKE type_t.chr500, 
   glar017 LIKE glar_t.glar017, 
   glar017_desc LIKE type_t.chr500, 
   glar018 LIKE glar_t.glar018, 
   glar018_desc LIKE type_t.chr500, 
   glar019 LIKE glar_t.glar019, 
   glar019_desc LIKE type_t.chr500, 
   glar020 LIKE glar_t.glar020, 
   glar020_desc LIKE type_t.chr500, 
   glar021 LIKE glar_t.glar021, 
   glar021_desc LIKE type_t.chr500, 
   glar022 LIKE glar_t.glar022, 
   glar023 LIKE glar_t.glar023, 
   glar003 LIKE type_t.chr80, 
   style LIKE type_t.chr80, 
   glar005 LIKE type_t.chr500, 
   glar006 LIKE type_t.chr500, 
   glar034 LIKE type_t.chr500, 
   glar035 LIKE type_t.chr500, 
   glar036 LIKE type_t.chr500, 
   glar037 LIKE type_t.chr500, 
   state LIKE type_t.chr80, 
   amt1 LIKE type_t.chr500, 
   amt2 LIKE type_t.chr500, 
   amt3 LIKE type_t.chr500 
       END RECORD
 
 
#模組變數(Module Variables)
DEFINE g_master                     type_g_glar_d
DEFINE g_master_t                   type_g_glar_d
DEFINE g_glar_d          DYNAMIC ARRAY OF type_g_glar_d
DEFINE g_glar_d_t        type_g_glar_d
 
      
DEFINE g_wc                 STRING
DEFINE g_wc_t               STRING                        #儲存 user 的查詢條件
DEFINE g_wc2                STRING
DEFINE g_wc_filter          STRING
DEFINE g_wc_filter_t        STRING
DEFINE g_sql                STRING
DEFINE g_forupd_sql         STRING                        #SELECT ... FOR UPDATE SQL
DEFINE g_before_input_done  LIKE type_t.num5
DEFINE g_cnt                LIKE type_t.num10    
DEFINE l_ac                 LIKE type_t.num5              
DEFINE l_ac_d               LIKE type_t.num5              #單身idx 
DEFINE g_curr_diag          ui.Dialog                     #Current Dialog
DEFINE gwin_curr            ui.Window                     #Current Window
DEFINE gfrm_curr            ui.Form                       #Current Form
DEFINE g_current_page       LIKE type_t.num5              #目前所在頁數
DEFINE g_detail_cnt         LIKE type_t.num5              #單身 總筆數(所有資料)
DEFINE g_ref_fields         DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_rtn_fields         DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE g_ref_vars           DYNAMIC ARRAY OF VARCHAR(500) #ap_ref用陣列
DEFINE gs_keys              DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE gs_keys_bak          DYNAMIC ARRAY OF VARCHAR(500) #同步資料用陣列
DEFINE g_insert             LIKE type_t.chr5              #是否導到其他page
DEFINE g_error_show         LIKE type_t.num5
DEFINE g_master_idx         LIKE type_t.num5
DEFINE g_detail_idx         LIKE type_t.num5
DEFINE g_detail_idx2        LIKE type_t.num5
DEFINE g_hyper_url          STRING                        #hyperlink的主要網址
 
 
#多table用wc
DEFINE g_wc_table           STRING
 
 
 
DEFINE g_wc_filter_table           STRING
 
 
 
 
#add-point:自定義模組變數(Module Variable)
{<point name="global.variable"/>}
#end add-point
 
#add-point:傳入參數說明
{<point name="global.argv"/>}
#end add-point
]]>
</section>
  <section id="aglq750.init" ver="1" status="" src="s">
<![CDATA[#+ 畫面資料初始化
PRIVATE FUNCTION aglq750_init()
   #add-point:init段define
   {<point name="init.define"/>}
   #end add-point   
   
   LET g_error_show  = 1
   LET g_wc_filter   = " 1=1"
   LET g_wc_filter_t = " 1=1"
   
   
   
   #add-point:畫面資料初始化
   {<point name="init.init" />}
   #end add-point
   
END FUNCTION
]]>
</section>
  <section id="aglq750.insert" ver="1" status="" src="s">
<![CDATA[#+ insert
PRIVATE FUNCTION aglq750_insert()
   #add-point:insert段define
   {<point name="insert.define"/>}
   #end add-point
 
   #add-point:insert段control
   {<point name="insert.control"/>}
   #end add-point    
   
END FUNCTION
]]>
</section>
  <section id="aglq750.main" ver="2" status="" src="s">
<![CDATA[#+ 此段落由子樣板a26產生
#OPTIONS SHORT CIRCUIT
#+ 作業開始 
MAIN
   #add-point:main段define
   {<point name="main.define"/>}
   #end add-point   
 
   OPTIONS
   INPUT NO WRAP
   DEFER INTERRUPT
   
   #設定SQL錯誤記錄方式 (模組內定義有效)
   WHENEVER ERROR CALL cl_err_msg_log
       
   #依模組進行系統初始化設定(系統設定)
   CALL cl_ap_init("agl","")
 
   #add-point:作業初始化
   {<point name="main.init" />}
   #end add-point
   
   
   
 
   #LOCK CURSOR (identifier)
   #add-point:SQL_define
   {<point name="main.define_sql" />}
   #end add-point
   LET g_forupd_sql = ""
   #add-point:SQL_define
   {<point name="main.after_define_sql"/>}
   #end add-point
   LET g_forupd_sql = cl_sql_forupd(g_forupd_sql)                #轉換不同資料庫語法
   DECLARE aglq750_cl CURSOR FROM g_forupd_sql                 # LOCK CURSOR
 
   LET g_sql = " SELECT UNIQUE ",
               " FROM ",
               " WHERE  "
   #add-point:SQL_define
   {<point name="main.after_refresh_sql"/>}
   #end add-point
   PREPARE aglq750_master_referesh FROM g_sql
 
   IF g_bgjob = "Y" THEN
 
      #add-point:Service Call
      {<point name="main.servicecall" />}
      #end add-point
 
   ELSE
      
      #畫面開啟 (identifier)
      OPEN WINDOW w_aglq750 WITH FORM cl_ap_formpath("agl",g_code)
   
      #瀏覽頁簽資料初始化
      CALL cl_ui_init()
   
      #程式初始化
      CALL aglq750_init()   
 
      #進入選單 Menu (="N")
      CALL aglq750_ui_dialog() 
      
      #add-point:畫面關閉前
      {<point name="main.before_close" />}
      #end add-point
 
      #畫面關閉
      CLOSE WINDOW w_aglq750
      
   END IF 
   
   CLOSE aglq750_cl
   
   
 
   #add-point:作業離開前
   {<point name="main.exit" />}
   #end add-point
 
   #離開作業
   CALL cl_ap_exitprogram("0")
   
END MAIN
 
 
]]>
</section>
  <section id="aglq750.modify" ver="1" status="" src="s">
<![CDATA[#+ modify
PRIVATE FUNCTION aglq750_modify()
   #add-point:modify段define
   {<point name="modify.define"/>}
   #end add-point
 
   #add-point:modify段control
   {<point name="modify.control"/>}
   #end add-point 
END FUNCTION
]]>
</section>
  <section id="aglq750.other_function" ver="1" status="" src="s">
<![CDATA[{<point name="other.function"/>}
]]>
</section>
  <section id="aglq750.reproduce" ver="1" status="" src="s">
<![CDATA[#+ reproduce
PRIVATE FUNCTION aglq750_reproduce()
   #add-point:reproduce段define
   {<point name="reproduce.define"/>}
   #end add-point
 
   #add-point:reproduce段control
   {<point name="reproduce.control"/>}
   #end add-point 
END FUNCTION
]]>
</section>
</add_points>